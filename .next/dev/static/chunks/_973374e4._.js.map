{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/ChatHeader.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Bot } from 'lucide-react';\r\n\r\ninterface Props {\r\n  userRole: 'admin' | 'user' | null;\r\n  userInfo: { name?: string } | null;\r\n}\r\n\r\nconst ChatHeader: React.FC<Props> = ({ userRole, userInfo }) => (\r\n  <div className=\"mb-4\">\r\n    <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n      <Bot className=\"h-6 w-6 text-blue-600\" />\r\n      AI Property Assistant\r\n    </h1>\r\n    <p className=\"text-slate-600 dark:text-slate-400 mt-1\">\r\n      {userRole === 'admin'\r\n        ? `Welcome back, ${userInfo?.name}! You have admin access to enhanced features.`\r\n        : `Hi ${userInfo?.name || ''}! How can I help you find your perfect property today?`}\r\n    </p>\r\n  </div>\r\n);\r\n\r\nexport default ChatHeader;\r\n"],"names":[],"mappings":";;;;;AACA;;;AAOA,MAAM,aAA8B,CAAC,EAAE,QAAQ,EAAE,QAAQ,EAAE,iBACzD,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;;kCACZ,6LAAC,0MAAG;wBAAC,WAAU;;;;;;oBAA0B;;;;;;;0BAG3C,6LAAC;gBAAE,WAAU;0BACV,aAAa,UACV,CAAC,cAAc,EAAE,UAAU,KAAK,6CAA6C,CAAC,GAC9E,CAAC,GAAG,EAAE,UAAU,QAAQ,GAAG,sDAAsD,CAAC;;;;;;;;;;;;KATtF;uCAcS"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/ChatMessages.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ntype Message = { role: 'user' | 'assistant' | 'system'; content: string };\r\n\r\ninterface Props {\r\n  messages: Message[];\r\n  messagesEndRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nconst ChatMessages: React.FC<Props> = ({ messages, messagesEndRef }) => (\r\n  <div className=\"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm mb-4 flex-1 overflow-y-auto max-h-[50vh]\">\r\n    <div className=\"p-4 space-y-4\">\r\n      {messages.map((m, idx) => (\r\n        <div key={idx} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>\r\n          <div className={`max-w-[80%] p-3 rounded-2xl ${\r\n            m.role === 'user' ? 'bg-blue-600 text-white rounded-br-md' : 'bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white rounded-bl-md'\r\n          }`}>\r\n            <div className=\"text-sm whitespace-pre-wrap\">{m.content}</div>\r\n          </div>\r\n        </div>\r\n      ))}\r\n      <div ref={messagesEndRef} />\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport default ChatMessages;\r\n"],"names":[],"mappings":";;;;;;AASA,MAAM,eAAgC,CAAC,EAAE,QAAQ,EAAE,cAAc,EAAE,iBACjE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;gBACZ,SAAS,GAAG,CAAC,CAAC,GAAG,oBAChB,6LAAC;wBAAc,WAAW,CAAC,KAAK,EAAE,EAAE,IAAI,KAAK,SAAS,gBAAgB,iBAAiB;kCACrF,cAAA,6LAAC;4BAAI,WAAW,CAAC,4BAA4B,EAC3C,EAAE,IAAI,KAAK,SAAS,yCAAyC,+EAC7D;sCACA,cAAA,6LAAC;gCAAI,WAAU;0CAA+B,EAAE,OAAO;;;;;;;;;;;uBAJjD;;;;;8BAQZ,6LAAC;oBAAI,KAAK;;;;;;;;;;;;;;;;;KAZV;uCAiBS"}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/ChatInput.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface Props {\r\n  input: string;\r\n  setInput: (v: string) => void;\r\n  sendMessage: () => void;\r\n  loading: boolean;\r\n}\r\n\r\nconst ChatInput: React.FC<Props> = ({ input, setInput, sendMessage, loading }) => (\r\n  <div className=\"flex gap-2\">\r\n    <input\r\n      value={input}\r\n      onChange={(e) => setInput(e.target.value)}\r\n      onKeyDown={(e) => { if (e.key === 'Enter') sendMessage(); }}\r\n      placeholder=\"Ask about properties, e.g. 'Show me houses in Nairobi'\"\r\n      className=\"flex-1 rounded-lg border border-border p-2\"\r\n    />\r\n    <button\r\n      onClick={sendMessage}\r\n      disabled={loading}\r\n      className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60\"\r\n    >\r\n      {loading ? 'Sending...' : 'Send'}\r\n    </button>\r\n  </div>\r\n);\r\n\r\nexport default ChatInput;\r\n"],"names":[],"mappings":";;;;;;AASA,MAAM,YAA6B,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,OAAO,EAAE,iBAC3E,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBACC,OAAO;gBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW,CAAC;oBAAQ,IAAI,EAAE,GAAG,KAAK,SAAS;gBAAe;gBAC1D,aAAY;gBACZ,WAAU;;;;;;0BAEZ,6LAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAU;0BAET,UAAU,eAAe;;;;;;;;;;;;KAd1B;uCAmBS"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/ui/input.tsx"],"sourcesContent":["import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\r\n  ({ className, type, ...props }, ref) => {\r\n    return (\r\n      <input\r\n        type={type}\r\n        className={cn(\r\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\r\n          className,\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nInput.displayName = \"Input\";\r\n\r\nexport { Input };\r\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,6LAAC;QACC,MAAM;QACN,WAAW,IAAA,qHAAE,EACX,kYACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/ui/label.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst labelVariants = cva(\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\");\r\n\r\nconst Label = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> & VariantProps<typeof labelVariants>\r\n>(({ className, ...props }, ref) => (\r\n  <LabelPrimitive.Root ref={ref} className={cn(labelVariants(), className)} {...props} />\r\n));\r\nLabel.displayName = LabelPrimitive.Root.displayName;\r\n\r\nexport { Label };\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EAAC;AAE1B,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,4KAAmB;QAAC,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,iBAAiB;QAAa,GAAG,KAAK;;;;;;;AAErF,MAAM,WAAW,GAAG,4KAAmB,CAAC,WAAW"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/ui/card.tsx"],"sourcesContent":["import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(({ className, ...props }, ref) => (\r\n  <div ref={ref} className={cn(\"rounded-lg border bg-card text-card-foreground shadow-sm\", className)} {...props} />\r\n));\r\nCard.displayName = \"Card\";\r\n\r\nconst CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  ({ className, ...props }, ref) => (\r\n    <div ref={ref} className={cn(\"flex flex-col space-y-1.5 p-6\", className)} {...props} />\r\n  ),\r\n);\r\nCardHeader.displayName = \"CardHeader\";\r\n\r\nconst CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(\r\n  ({ className, ...props }, ref) => (\r\n    <h3 ref={ref} className={cn(\"text-2xl font-semibold leading-none tracking-tight\", className)} {...props} />\r\n  ),\r\n);\r\nCardTitle.displayName = \"CardTitle\";\r\n\r\nconst CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\r\n  ({ className, ...props }, ref) => (\r\n    <p ref={ref} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />\r\n  ),\r\n);\r\nCardDescription.displayName = \"CardDescription\";\r\n\r\nconst CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  ({ className, ...props }, ref) => <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />,\r\n);\r\nCardContent.displayName = \"CardContent\";\r\n\r\nconst CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  ({ className, ...props }, ref) => (\r\n    <div ref={ref} className={cn(\"flex items-center p-6 pt-0\", className)} {...props} />\r\n  ),\r\n);\r\nCardFooter.displayName = \"CardFooter\";\r\n\r\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAAuD,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC5G,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,4DAA4D;QAAa,GAAG,KAAK;;;;;;;AAEhH,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OACjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAAa,GAAG,KAAK;;;;;;;AAGvF,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAChC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,6LAAC;QAAG,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,sDAAsD;QAAa,GAAG,KAAK;;;;;;;AAG3G,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OACtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,6LAAC;QAAE,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAAa,GAAG,KAAK;;;;;;;AAGrF,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAClC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAAQ,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;AAElG,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QACjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAAa,GAAG,KAAK;;;;;;;AAGpF,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/PreChatForm.tsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"@/components/ui/card\";\r\nimport { User, Phone, Bot } from \"lucide-react\";\r\n\r\ntype FormData = {\r\n  name: string;\r\n  phone: string;\r\n};\r\n\r\ntype FormErrors = Partial<FormData>;\r\n\r\ninterface PreChatFormProps {\r\n  onSubmit: (data: FormData) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nexport const PreChatForm: React.FC<PreChatFormProps> = ({\r\n  onSubmit,\r\n  onCancel,\r\n}) => {\r\n  const [form, setForm] = useState<FormData>({ name: \"\", phone: \"\" });\r\n  const [errors, setErrors] = useState<FormErrors>({});\r\n\r\n  const updateField = (field: keyof FormData, value: string) => {\r\n    setForm((prev) => ({ ...prev, [field]: value }));\r\n    setErrors((prev) => ({ ...prev, [field]: undefined }));\r\n  };\r\n\r\n  const validate = (): boolean => {\r\n    const nextErrors: FormErrors = {};\r\n    const phone = form.phone.replace(/\\s/g, \"\");\r\n\r\n    if (!form.name.trim()) {\r\n      nextErrors.name = \"Full name is required\";\r\n    }\r\n\r\n    if (!phone) {\r\n      nextErrors.phone = \"Phone number is required\";\r\n    } else if (!/^(\\+254|0)[17]\\d{8}$/.test(phone)) {\r\n      nextErrors.phone = \"Enter a valid Kenyan phone number\";\r\n    }\r\n\r\n    setErrors(nextErrors);\r\n    return Object.keys(nextErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    console.log('[PreChatForm] submit', { name: form.name, phone: form.phone });\r\n    const ok = validate();\r\n    if (!ok) {\r\n      console.log('[PreChatForm] validation failed', { errors });\r\n      return;\r\n    }\r\n\r\n    console.log('[PreChatForm] calling onSubmit with', { name: form.name.trim(), phone: form.phone.trim() });\r\n    onSubmit({\r\n      name: form.name.trim(),\r\n      phone: form.phone.trim(),\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-full items-center justify-center p-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader className=\"text-center\">\r\n          <div className=\"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10\">\r\n            <Bot className=\"h-6 w-6 text-primary\" />\r\n          </div>\r\n\r\n          <CardTitle className=\"text-xl\">Mary — Virtual Assistant</CardTitle>\r\n\r\n          <p className=\"mt-2 text-sm text-muted-foreground\">\r\n            Share your contact details so I can assist you better and follow up\r\n            on your property inquiries.\r\n          </p>\r\n        </CardHeader>\r\n\r\n        <CardContent>\r\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            {/* Name */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"name\" className=\"flex items-center gap-2\">\r\n                <User className=\"h-4 w-4\" />\r\n                Full Name\r\n              </Label>\r\n\r\n              <Input\r\n                id=\"name\"\r\n                value={form.name}\r\n                placeholder=\"Enter your full name\"\r\n                onChange={(e) => updateField(\"name\", e.target.value)}\r\n                aria-invalid={!!errors.name}\r\n                aria-describedby={errors.name ? \"name-error\" : undefined}\r\n                className={errors.name ? \"border-destructive\" : \"\"}\r\n              />\r\n\r\n              {errors.name && (\r\n                <p\r\n                  id=\"name-error\"\r\n                  className=\"text-sm text-destructive\"\r\n                >\r\n                  {errors.name}\r\n                </p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Phone */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"phone\" className=\"flex items-center gap-2\">\r\n                <Phone className=\"h-4 w-4\" />\r\n                Phone Number\r\n              </Label>\r\n\r\n              <Input\r\n                id=\"phone\"\r\n                type=\"tel\"\r\n                value={form.phone}\r\n                placeholder=\"+254 712 345 678 or 0712 345 678\"\r\n                onChange={(e) => updateField(\"phone\", e.target.value)}\r\n                aria-invalid={!!errors.phone}\r\n                aria-describedby={errors.phone ? \"phone-error\" : undefined}\r\n                className={errors.phone ? \"border-destructive\" : \"\"}\r\n              />\r\n\r\n              {errors.phone && (\r\n                <p\r\n                  id=\"phone-error\"\r\n                  className=\"text-sm text-destructive\"\r\n                >\r\n                  {errors.phone}\r\n                </p>\r\n              )}\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex gap-3 pt-4\">\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                onClick={onCancel}\r\n                className=\"flex-1\"\r\n              >\r\n                Cancel\r\n              </Button>\r\n\r\n              <Button type=\"submit\" className=\"flex-1\">\r\n                Start Chat\r\n              </Button>\r\n            </div>\r\n          </form>\r\n\r\n          <p className=\"mt-4 text-center text-xs text-muted-foreground\">\r\n            Your information is used strictly for follow-up and handled\r\n            confidentially.\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AAMA;AAAA;AAAA;;;;;;;;;AAcO,MAAM,cAA0C,CAAC,EACtD,QAAQ,EACR,QAAQ,EACT;;IACC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAW;QAAE,MAAM;QAAI,OAAO;IAAG;IACjE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAa,CAAC;IAElD,MAAM,cAAc,CAAC,OAAuB;QAC1C,QAAQ,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,CAAC,MAAM,EAAE;YAAM,CAAC;QAC9C,UAAU,CAAC,OAAS,CAAC;gBAAE,GAAG,IAAI;gBAAE,CAAC,MAAM,EAAE;YAAU,CAAC;IACtD;IAEA,MAAM,WAAW;QACf,MAAM,aAAyB,CAAC;QAChC,MAAM,QAAQ,KAAK,KAAK,CAAC,OAAO,CAAC,OAAO;QAExC,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,IAAI;YACrB,WAAW,IAAI,GAAG;QACpB;QAEA,IAAI,CAAC,OAAO;YACV,WAAW,KAAK,GAAG;QACrB,OAAO,IAAI,CAAC,uBAAuB,IAAI,CAAC,QAAQ;YAC9C,WAAW,KAAK,GAAG;QACrB;QAEA,UAAU;QACV,OAAO,OAAO,IAAI,CAAC,YAAY,MAAM,KAAK;IAC5C;IAEA,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,QAAQ,GAAG,CAAC,wBAAwB;YAAE,MAAM,KAAK,IAAI;YAAE,OAAO,KAAK,KAAK;QAAC;QACzE,MAAM,KAAK;QACX,IAAI,CAAC,IAAI;YACP,QAAQ,GAAG,CAAC,mCAAmC;gBAAE;YAAO;YACxD;QACF;QAEA,QAAQ,GAAG,CAAC,uCAAuC;YAAE,MAAM,KAAK,IAAI,CAAC,IAAI;YAAI,OAAO,KAAK,KAAK,CAAC,IAAI;QAAG;QACtG,SAAS;YACP,MAAM,KAAK,IAAI,CAAC,IAAI;YACpB,OAAO,KAAK,KAAK,CAAC,IAAI;QACxB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,sHAAI;YAAC,WAAU;;8BACd,6LAAC,4HAAU;oBAAC,WAAU;;sCACpB,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,0MAAG;gCAAC,WAAU;;;;;;;;;;;sCAGjB,6LAAC,2HAAS;4BAAC,WAAU;sCAAU;;;;;;sCAE/B,6LAAC;4BAAE,WAAU;sCAAqC;;;;;;;;;;;;8BAMpD,6LAAC,6HAAW;;sCACV,6LAAC;4BAAK,UAAU;4BAAc,WAAU;;8CAEtC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC,wHAAK;4CAAC,SAAQ;4CAAO,WAAU;;8DAC9B,6LAAC,6MAAI;oDAAC,WAAU;;;;;;gDAAY;;;;;;;sDAI9B,6LAAC,wHAAK;4CACJ,IAAG;4CACH,OAAO,KAAK,IAAI;4CAChB,aAAY;4CACZ,UAAU,CAAC,IAAM,YAAY,QAAQ,EAAE,MAAM,CAAC,KAAK;4CACnD,gBAAc,CAAC,CAAC,OAAO,IAAI;4CAC3B,oBAAkB,OAAO,IAAI,GAAG,eAAe;4CAC/C,WAAW,OAAO,IAAI,GAAG,uBAAuB;;;;;;wCAGjD,OAAO,IAAI,kBACV,6LAAC;4CACC,IAAG;4CACH,WAAU;sDAET,OAAO,IAAI;;;;;;;;;;;;8CAMlB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC,wHAAK;4CAAC,SAAQ;4CAAQ,WAAU;;8DAC/B,6LAAC,gNAAK;oDAAC,WAAU;;;;;;gDAAY;;;;;;;sDAI/B,6LAAC,wHAAK;4CACJ,IAAG;4CACH,MAAK;4CACL,OAAO,KAAK,KAAK;4CACjB,aAAY;4CACZ,UAAU,CAAC,IAAM,YAAY,SAAS,EAAE,MAAM,CAAC,KAAK;4CACpD,gBAAc,CAAC,CAAC,OAAO,KAAK;4CAC5B,oBAAkB,OAAO,KAAK,GAAG,gBAAgB;4CACjD,WAAW,OAAO,KAAK,GAAG,uBAAuB;;;;;;wCAGlD,OAAO,KAAK,kBACX,6LAAC;4CACC,IAAG;4CACH,WAAU;sDAET,OAAO,KAAK;;;;;;;;;;;;8CAMnB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC,0HAAM;4CACL,MAAK;4CACL,SAAQ;4CACR,SAAS;4CACT,WAAU;sDACX;;;;;;sDAID,6LAAC,0HAAM;4CAAC,MAAK;4CAAS,WAAU;sDAAS;;;;;;;;;;;;;;;;;;sCAM7C,6LAAC;4BAAE,WAAU;sCAAiD;;;;;;;;;;;;;;;;;;;;;;;AAQxE;GAhJa;KAAA"}},
    {"offset": {"line": 642, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/integrations/supabase/client.ts"],"sourcesContent":["// This file is automatically generated. Do not edit it directly.\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport type { Database } from './types';\r\n\r\nconst SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst SUPABASE_PUBLISHABLE_KEY = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\r\n\r\nif (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {\r\n  // Helpful runtime warning during development if env vars are missing\r\n  // (don't throw — allow server-side tooling to import the file safely)\r\n  console.warn('[supabase] VITE_SUPABASE_URL or VITE_SUPABASE_PUBLISHABLE_KEY is not set. Supabase client may not work.');\r\n}\r\n\r\n// Import the supabase client like this:\r\n// import { supabase } from \"@/integrations/supabase/client\";\r\n\r\n// Guard access to `localStorage` to avoid errors in non-browser environments\r\nconst storage = typeof window !== 'undefined' && typeof window.localStorage !== 'undefined' ? window.localStorage : undefined;\r\n\r\n// If the env vars are missing, avoid calling `createClient` with empty strings (which throws)\r\n// and instead export a lightweight proxy that throws a helpful error when used.\r\nfunction createDisabledClient() {\r\n  const err = new Error('[supabase] VITE_SUPABASE_URL or VITE_SUPABASE_PUBLISHABLE_KEY is not set. Initialize these variables to use Supabase client.');\r\n  const handler: ProxyHandler<Record<string, any>> = {\n    get() {\r\n      throw err;\r\n    },\r\n    apply() {\r\n      throw err;\r\n    },\r\n    construct() {\r\n      throw err;\r\n    }\r\n  };\r\n  return new Proxy({}, handler) as unknown as ReturnType<typeof createClient<Database>>;\r\n}\r\n\r\nexport const supabase = (SUPABASE_URL && SUPABASE_PUBLISHABLE_KEY)\r\n  ? createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {\r\n      auth: {\r\n        storage,\r\n        persistSession: true,\r\n        autoRefreshToken: true,\r\n      }\r\n    })\r\n  : createDisabledClient();\r\n\r\n// Debug helper: optional runtime logging for outgoing requests to Supabase endpoints.\r\n// Enable by setting `localStorage.setItem('debug_supabase', '1')` in the browser, then reload.\r\n// This wrapper only logs when the flag is set to avoid noisy logs in production.\r\ntry {\r\n  if (typeof window !== 'undefined' && typeof window.fetch === 'function') {\r\n    const _w = window as unknown as { fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> };\r\n    const originalFetch = _w.fetch.bind(_w);\r\n    _w.fetch = async (input: RequestInfo, init?: RequestInit) => {\r\n      try {\r\n        const url = typeof input === 'string' ? input : (input as Request).url;\r\n        const enabled = typeof window.localStorage !== 'undefined' && window.localStorage.getItem('debug_supabase') === '1';\r\n        if (enabled && typeof url === 'string' && url.includes('.supabase.co')) {\r\n          // Mask key when printing\r\n          const maskedKey = SUPABASE_PUBLISHABLE_KEY ? `${String(SUPABASE_PUBLISHABLE_KEY).slice(0, 6)}...` : 'not-set';\r\n          console.groupCollapsed('[supabase-debug] outgoing request to Supabase');\r\n          console.log('URL:', url);\r\n          console.log('Masked publishable key:', maskedKey);\r\n          // Print headers if available\r\n          if (init?.headers) {\r\n            // Normalized printing for Headers / object\r\n            const h = init.headers instanceof Headers ? Object.fromEntries(init.headers.entries()) as Record<string, string> : (init.headers as Record<string, string> | undefined);\r\n            console.log('Request headers:', h);\r\n            console.log('Authorization:', (h && (h['Authorization'] || h['authorization'])) ?? null);\r\n            console.log('apikey:', h ? h['apikey'] ?? null : null);\r\n          }\r\n          console.groupEnd();\r\n        }\r\n      } catch (e) {\r\n        // swallow\r\n      }\r\n      return originalFetch(input, init);\r\n    };\r\n  }\r\n} catch (err) {\r\n  // ignore\r\n}"],"names":[],"mappings":";;;;AAIqB;AAJrB,iEAAiE;AACjE;;AAGA,MAAM;AACN,MAAM;AAEN;;AAMA,wCAAwC;AACxC,6DAA6D;AAE7D,6EAA6E;AAC7E,MAAM,UAAU,+CAAkB,eAAe,OAAO,OAAO,YAAY,KAAK,cAAc,OAAO,YAAY,GAAG;AAEpH,8FAA8F;AAC9F,gFAAgF;AAChF,SAAS;IACP,MAAM,MAAM,IAAI,MAAM;IACtB,MAAM,UAA6C;QACjD;YACE,MAAM;QACR;QACA;YACE,MAAM;QACR;QACA;YACE,MAAM;QACR;IACF;IACA,OAAO,IAAI,MAAM,CAAC,GAAG;AACvB;AAEO,MAAM,WAAW,uCACpB,IAAA,iMAAY,EAAW,cAAc,0BAA0B;IAC7D,MAAM;QACJ;QACA,gBAAgB;QAChB,kBAAkB;IACpB;AACF,KACA;AAEJ,sFAAsF;AACtF,+FAA+F;AAC/F,iFAAiF;AACjF,IAAI;IACF,IAAI,+CAAkB,eAAe,OAAO,OAAO,KAAK,KAAK,YAAY;QACvE,MAAM,KAAK;QACX,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC;QACpC,GAAG,KAAK,GAAG,OAAO,OAAoB;YACpC,IAAI;gBACF,MAAM,MAAM,OAAO,UAAU,WAAW,QAAQ,AAAC,MAAkB,GAAG;gBACtE,MAAM,UAAU,OAAO,OAAO,YAAY,KAAK,eAAe,OAAO,YAAY,CAAC,OAAO,CAAC,sBAAsB;gBAChH,IAAI,WAAW,OAAO,QAAQ,YAAY,IAAI,QAAQ,CAAC,iBAAiB;oBACtE,yBAAyB;oBACzB,MAAM,YAAY,uCAA2B,GAAG,OAAO,0BAA0B,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG;oBACpG,QAAQ,cAAc,CAAC;oBACvB,QAAQ,GAAG,CAAC,QAAQ;oBACpB,QAAQ,GAAG,CAAC,2BAA2B;oBACvC,6BAA6B;oBAC7B,IAAI,MAAM,SAAS;wBACjB,2CAA2C;wBAC3C,MAAM,IAAI,KAAK,OAAO,YAAY,UAAU,OAAO,WAAW,CAAC,KAAK,OAAO,CAAC,OAAO,MAAiC,KAAK,OAAO;wBAChI,QAAQ,GAAG,CAAC,oBAAoB;wBAChC,QAAQ,GAAG,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,gBAAgB,IAAI,CAAC,CAAC,gBAAgB,CAAC,KAAK;wBACnF,QAAQ,GAAG,CAAC,WAAW,IAAI,CAAC,CAAC,SAAS,IAAI,OAAO;oBACnD;oBACA,QAAQ,QAAQ;gBAClB;YACF,EAAE,OAAO,GAAG;YACV,UAAU;YACZ;YACA,OAAO,cAAc,OAAO;QAC9B;IACF;AACF,EAAE,OAAO,KAAK;AACZ,SAAS;AACX"}},
    {"offset": {"line": 725, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/chatService.tsx"],"sourcesContent":["import { supabase } from '@/integrations/supabase/client';\r\nimport { retry } from '@/lib/utils';\r\n\r\nconst SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL ?? '';\r\nconst SUPABASE_PUBLISHABLE_KEY = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY ?? '';\r\nconst SERVER_API = (process.env.NEXT_PUBLIC_SERVER_API_URL || '').replace(/\\/$/, '');\r\n\r\nexport async function restUpsertConversation(payload: Record<string, unknown>) {\r\n  const body = { ...payload };\r\n  if ('id' in body) delete body.id;\r\n\r\n  if (SERVER_API) {\r\n    const proxy = async () => {\r\n      const res = await fetch(`${SERVER_API}/api/chat/conversations`, {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)\r\n      });\r\n      if (!res.ok) throw new Error(`proxy upsert failed: ${res.status}`);\r\n      return res.json().catch(() => null);\r\n    };\r\n    return retry(proxy, 3, 200);\r\n  }\r\n\r\n  const doUpsert = async () => {\r\n    const { data, error } = await supabase.from('chat_conversations').upsert(body, { onConflict: 'conversation_id' }).select();\r\n    if (error) throw error;\r\n    return data;\r\n  };\r\n  return retry(doUpsert, 3, 200);\r\n}\r\n\r\nexport async function restInsertMessage(payload: Record<string, unknown> | Array<Record<string, unknown>>) {\r\n  if (SERVER_API) {\r\n    const proxy = async () => {\r\n      const res = await fetch(`${SERVER_API}/api/chat/messages`, {\r\n        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)\r\n      });\r\n      if (!res.ok) throw new Error(`proxy insert failed: ${res.status}`);\r\n      return res.json().catch(() => null);\r\n    };\r\n    return retry(proxy, 3, 200);\r\n  }\r\n\r\n  const doInsert = async () => {\r\n    const { data, error } = await supabase.from('chat_messages').insert(payload);\r\n    if (error) throw error;\r\n    return data;\r\n  };\r\n  return retry(doInsert, 3, 200);\r\n}\r\n\r\nexport async function restPatchConversation(conversation_id: string, patch: Record<string, unknown>) {\r\n  if (SERVER_API) {\r\n    const res = await fetch(`${SERVER_API}/api/chat/conversations`, {\r\n      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ conversation_id, ...patch })\r\n    });\r\n    if (!res.ok) throw new Error(`proxy patch failed: ${res.status}`);\r\n    return res.json().catch(() => null);\r\n  }\r\n\r\n  const { data, error } = await supabase.from('chat_conversations').update(patch).eq('conversation_id', conversation_id).select();\r\n  if (error) throw error;\r\n  return data;\r\n}\r\n\r\nexport type ChatResponse = { reply: string; properties?: any[]; session_id?: string; error?: string } | null;\r\n\r\nexport async function fetchReply(payload: Record<string, unknown>, timeout = 15000): Promise<ChatResponse> {\r\n  const url = `${SUPABASE_URL}/functions/v1/chat`;\r\n  console.debug('[chatService] fetchReply called', { url, payload });\r\n  if (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY) {\r\n    console.error('[chatService] Missing Supabase configuration', { SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY });\r\n    throw new Error('Chat service not configured. Missing Supabase URL or publishable key.');\r\n  }\r\n  const controller = new AbortController();\r\n  const id = setTimeout(() => controller.abort(), timeout);\r\n  try {\r\n    const res = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        apikey: SUPABASE_PUBLISHABLE_KEY,\r\n        Authorization: `Bearer ${SUPABASE_PUBLISHABLE_KEY}`,\r\n      },\r\n      body: JSON.stringify(payload),\r\n      signal: controller.signal,\r\n    });\r\n    clearTimeout(id);\r\n    if (!res.ok) {\r\n      const txt = await res.text().catch(() => '');\r\n      console.error('[chatService] edge function responded with error', { status: res.status, body: txt });\r\n      throw new Error(`edge function error ${res.status}: ${txt}`);\r\n    }\r\n    const json = await res.json().catch(() => null);\r\n    console.debug('[chatService] fetchReply response', json);\r\n    return json;\r\n  } finally { clearTimeout(id); }\r\n}\r\n\r\nexport default { restUpsertConversation, restInsertMessage, restPatchConversation, fetchReply };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 864, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/AdminChat.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { Bot } from 'lucide-react';\r\nimport ChatHeader from '@/components/chat/ChatHeader';\r\nimport ChatMessages from '@/components/chat/ChatMessages';\r\nimport ChatInput from '@/components/chat/ChatInput';\r\nimport { PreChatForm } from '@/components/chat/PreChatForm';\r\nimport { useAuth } from '@/contexts/AuthContextValue';\r\nimport { restUpsertConversation, restInsertMessage, restPatchConversation, fetchReply } from './chatService';\r\nimport { safeSessionGet, safeSessionSet } from '@/lib/utils';\r\n\r\ntype Message = { role: 'user' | 'assistant' | 'system'; content: string };\r\ntype ChatPhase = 'form' | 'chat' | 'completed';\r\n\r\nconst AdminChat: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [phase, setPhase] = useState<ChatPhase>('chat');\r\n  const [conversationId] = useState(() => `conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`);\r\n  const sessionIdRef = useRef<string>('');\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    let sid = safeSessionGet<string>('chat_session_id');\r\n    if (!sid) { sid = `s_${Date.now()}`; safeSessionSet('chat_session_id', sid); }\r\n    sessionIdRef.current = sid as string;\r\n    if (!safeSessionGet(`chat:${sid}`)) {\r\n      setMessages([{ role: 'assistant', content: \"Hello Admin! I'm your AI property assistant with enhanced capabilities.\" }]);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }), [messages]);\r\n\r\n  const createConversation = async () => {\r\n    await restUpsertConversation({ conversation_id: conversationId, user_display_name: user?.email ?? 'admin', started_at: new Date().toISOString(), summary: JSON.stringify({ is_admin: true }) });\r\n  };\r\n\r\n  const saveMessage = async (role: string, content: string) => {\r\n    await restInsertMessage({ conversation_id: conversationId, session_id: sessionIdRef.current, role, content });\r\n    await restPatchConversation(conversationId, { last_message: content.substring(0, 100) });\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    const text = input.trim(); if (!text) return;\r\n    setInput('');\r\n    const userMsg = { role: 'user' as const, content: text };\r\n    setMessages(m => [...m, userMsg]);\r\n    setLoading(true);\r\n    await saveMessage('user', text);\r\n    try {\r\n      const payload = { message: text, session_id: sessionIdRef.current, conversation_id: conversationId, user_role: 'admin' };\r\n      const data = await fetchReply(payload);\r\n      if (data?.reply) {\r\n        await saveMessage('assistant', data.reply);\r\n        setMessages(m => [...m, { role: 'assistant', content: data.reply }]);\r\n      }\r\n    } catch (e) {\r\n      setMessages(m => [...m, { role: 'assistant', content: 'Failed to get reply.' }]);\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  if (phase === 'form') return <PreChatForm onSubmit={() => setPhase('chat')} onCancel={() => {}} />;\r\n  // Rating & analytics moved to the admin dashboard UI\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <div className=\"flex-1 p-4 overflow-hidden\">\r\n        <ChatHeader userRole={'admin'} userInfo={null} />\r\n        <ChatMessages messages={messages} messagesEndRef={messagesEndRef} />\r\n        <ChatInput input={input} setInput={setInput} sendMessage={sendMessage} loading={loading} />\r\n        {/* Rating removed from chat; admins will manage feedback in dashboard */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminChat;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1057, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/CustomerChat.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport ChatHeader from '@/components/chat/ChatHeader';\r\nimport ChatMessages from '@/components/chat/ChatMessages';\r\nimport ChatInput from '@/components/chat/ChatInput';\r\nimport { PreChatForm } from '@/components/chat/PreChatForm';\r\nimport { restUpsertConversation, restInsertMessage, restPatchConversation, fetchReply } from './chatService';\r\nimport { safeSessionGet, safeSessionSet } from '@/lib/utils';\r\n\r\ntype Message = { role: 'user' | 'assistant' | 'system'; content: string };\r\ntype ChatPhase = 'form' | 'chat' | 'completed';\r\n\r\nconst CustomerChat: React.FC = () => {\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [phase, setPhase] = useState<ChatPhase>('form');\r\n  const [conversationId] = useState(() => `conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`);\r\n  const sessionIdRef = useRef<string>('');\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    // For customer chats we avoid persisting session identifiers to storage\r\n    // to keep conversations ephemeral on the client. Generate an in-memory\r\n    // session id for server-side tracking only.\r\n    let sid = safeSessionGet<string>('chat_session_id');\r\n    if (!sid) { sid = `s_${Date.now()}_${Math.random().toString(36).slice(2,9)}`; }\r\n    sessionIdRef.current = sid as string;\r\n  }, []);\r\n\r\n  useEffect(() => messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }), [messages]);\r\n\r\n  const createConversation = async (name: string, phone: string) => {\r\n    // Runtime check: if the app was built without a SUPABASE URL / publishable\r\n    // key and no server proxy, provide a clear error rather than letting a\r\n    // low-level proxy throw (which may be silent in the console).\r\n    const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL || '';\r\n    const SUPABASE_PUBLISHABLE_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY || '';\r\n    const SERVER_API = (import.meta.env.VITE_SERVER_API_URL || '').replace(/\\/$/, '');\r\n    if (!SERVER_API && (!SUPABASE_URL || !SUPABASE_PUBLISHABLE_KEY)) {\r\n      const msg = 'Chat not configured: missing Supabase URL or publishable key in site build.';\r\n      console.error('[CustomerChat] createConversation aborted', { SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, SERVER_API });\r\n      throw new Error(msg);\r\n    }\r\n\r\n    await restUpsertConversation({ conversation_id: conversationId, user_display_name: name, started_at: new Date().toISOString(), summary: JSON.stringify({ phone }) });\r\n  };\r\n\r\n  const saveMessage = async (role: string, content: string) => {\r\n    await restInsertMessage({ conversation_id: conversationId, session_id: sessionIdRef.current, role, content });\r\n    await restPatchConversation(conversationId, { last_message: content.substring(0, 100) });\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    const text = input.trim(); if (!text) return;\r\n    setInput('');\r\n    const userMsg = { role: 'user' as const, content: text };\r\n    setMessages(m => [...m, userMsg]);\r\n    setLoading(true);\r\n    await saveMessage('user', text);\r\n    try {\r\n      const payload = { message: text, session_id: sessionIdRef.current, conversation_id: conversationId, user_role: 'user' };\r\n      const data = await fetchReply(payload);\r\n      if (data?.reply) {\r\n        await saveMessage('assistant', data.reply);\r\n        setMessages(m => [...m, { role: 'assistant', content: data.reply }]);\r\n      }\r\n    } catch (e) {\r\n      setMessages(m => [...m, { role: 'assistant', content: 'Unable to reach chat service.' }]);\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  if (phase === 'form') return (\r\n    <PreChatForm\r\n      onSubmit={async (info) => {\r\n        try {\r\n          await createConversation(info.name, info.phone);\r\n          setPhase('chat');\r\n        } catch (err) {\r\n          console.error('[CustomerChat] createConversation failed', err);\r\n          // Visible feedback to the user so they know something went wrong\r\n          // and to encourage checking the console/network logs.\r\n          // Keep this simple for debugging; can be removed later.\r\n          // eslint-disable-next-line no-alert\r\n          alert('Failed to start chat. Check the browser console for details.');\r\n        }\r\n      }}\r\n      onCancel={() => { window.history.back(); }}\r\n    />\r\n  );\r\n  // rating is now handled in the admin dashboard; chat is only for messaging\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      <div className=\"flex-1 p-4 overflow-hidden\">\r\n        <ChatHeader userRole={'user'} userInfo={null} />\r\n        <ChatMessages messages={messages} messagesEndRef={messagesEndRef} />\r\n        <ChatInput input={input} setInput={setInput} sendMessage={sendMessage} loading={loading} />\r\n        {/* Rating removed from chat; admins will manage feedback in dashboard */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomerChat;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1271, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/ChatContainer.tsx"],"sourcesContent":["import React from 'react';\r\nimport { useAuth } from '@/contexts/AuthContextValue';\r\nimport AdminChat from './AdminChat';\r\nimport CustomerChat from './CustomerChat';\r\n\r\nconst ChatContainer: React.FC = () => {\r\n  const { isAdmin } = useAuth();\r\n  return isAdmin ? <AdminChat /> : <CustomerChat />;\r\n};\r\n\r\nexport default ChatContainer;\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;;AAEA,MAAM,gBAA0B;;IAC9B,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,0IAAO;IAC3B,OAAO,wBAAU,6LAAC,8IAAS;;;;iEAAM,6LAAC,iJAAY;;;;;AAChD;GAHM;;QACgB,0IAAO;;;KADvB;uCAKS"}},
    {"offset": {"line": 1313, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ndung/julin-real-estate-hub/components/chat/Chat.tsx"],"sourcesContent":["import React from 'react';\r\nimport ChatContainer from '@/components/chat/ChatContainer';\r\n\r\nconst Chat: React.FC = () => {\r\n  return <ChatContainer />;\r\n};\r\n\r\nexport default Chat;\r\n"],"names":[],"mappings":";;;;;AACA;;;AAEA,MAAM,OAAiB;IACrB,qBAAO,6LAAC,kJAAa;;;;;AACvB;KAFM;uCAIS"}}]
}