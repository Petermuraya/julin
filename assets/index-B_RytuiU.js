import{r as B,b as Ng,R as $e,d as F5,e as kI,a as Bi,c as vv}from"./react-2v7z3eUw.js";import{_ as Nh,a as B5,b as $X,c as UX}from"./vendor-v1RthXxQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const _ of m.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function n(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(h){if(h.ep)return;h.ep=!0;const m=n(h);fetch(h.href,m)}})();var V5={exports:{}},_T={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GX=B,HX=Symbol.for("react.element"),WX=Symbol.for("react.fragment"),qX=Object.prototype.hasOwnProperty,ZX=GX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,XX={key:!0,ref:!0,__self:!0,__source:!0};function $5(e,t,n){var s,h={},m=null,_=null;n!==void 0&&(m=""+n),t.key!==void 0&&(m=""+t.key),t.ref!==void 0&&(_=t.ref);for(s in t)qX.call(t,s)&&!XX.hasOwnProperty(s)&&(h[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)h[s]===void 0&&(h[s]=t[s]);return{$$typeof:HX,type:e,key:m,ref:_,props:h,_owner:ZX.current}}_T.Fragment=WX;_T.jsx=$5;_T.jsxs=$5;V5.exports=_T;var b=V5.exports,U5,dL=Ng;U5=dL.createRoot,dL.hydrateRoot;const KX=1,YX=1e6;let GE=0;function JX(){return GE=(GE+1)%Number.MAX_SAFE_INTEGER,GE.toString()}const HE=new Map,fL=e=>{if(HE.has(e))return;const t=setTimeout(()=>{HE.delete(e),Ev({type:"REMOVE_TOAST",toastId:e})},YX);HE.set(e,t)},QX=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,KX)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(n=>n.id===t.toast.id?{...n,...t.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?fL(n):e.toasts.forEach(s=>{fL(s.id)}),{...e,toasts:e.toasts.map(s=>s.id===n||n===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(n=>n.id!==t.toastId)}}},D1=[];let k1={toasts:[]};function Ev(e){k1=QX(k1,e),D1.forEach(t=>{t(k1)})}function rn({...e}){const t=JX(),n=h=>Ev({type:"UPDATE_TOAST",toast:{...h,id:t}}),s=()=>Ev({type:"DISMISS_TOAST",toastId:t});return Ev({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:h=>{h||s()}}}),{id:t,dismiss:s,update:n}}function G5(){const[e,t]=B.useState(k1);return B.useEffect(()=>(D1.push(t),()=>{const n=D1.indexOf(t);n>-1&&D1.splice(n,1)}),[e]),{...e,toast:rn,dismiss:n=>Ev({type:"DISMISS_TOAST",toastId:n})}}function Ar(e,t,{checkForDefaultPrevented:n=!0}={}){return function(h){if(e?.(h),n===!1||!h.defaultPrevented)return t?.(h)}}function pL(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function vT(...e){return t=>{let n=!1;const s=e.map(h=>{const m=pL(h,t);return!n&&typeof m=="function"&&(n=!0),m});if(n)return()=>{for(let h=0;h<s.length;h++){const m=s[h];typeof m=="function"?m():pL(e[h],null)}}}}function li(...e){return B.useCallback(vT(...e),e)}function eK(e,t){const n=B.createContext(t),s=m=>{const{children:_,...i}=m,S=B.useMemo(()=>i,Object.values(i));return b.jsx(n.Provider,{value:S,children:_})};s.displayName=e+"Provider";function h(m){const _=B.useContext(n);if(_)return _;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${e}\``)}return[s,h]}function cc(e,t=[]){let n=[];function s(m,_){const i=B.createContext(_),S=n.length;n=[...n,_];const A=M=>{const{scope:L,children:z,...G}=M,F=L?.[e]?.[S]||i,U=B.useMemo(()=>G,Object.values(G));return b.jsx(F.Provider,{value:U,children:z})};A.displayName=m+"Provider";function I(M,L){const z=L?.[e]?.[S]||i,G=B.useContext(z);if(G)return G;if(_!==void 0)return _;throw new Error(`\`${M}\` must be used within \`${m}\``)}return[A,I]}const h=()=>{const m=n.map(_=>B.createContext(_));return function(i){const S=i?.[e]||m;return B.useMemo(()=>({[`__scope${e}`]:{...i,[e]:S}}),[i,S])}};return h.scopeName=e,[s,tK(h,...t)]}function tK(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const _=s.reduce((i,{useScope:S,scopeName:A})=>{const M=S(m)[`__scope${A}`];return{...i,...M}},{});return B.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return n.scopeName=t.scopeName,n}function wf(e){const t=rK(e),n=B.forwardRef((s,h)=>{const{children:m,..._}=s,i=B.Children.toArray(m),S=i.find(iK);if(S){const A=S.props.children,I=i.map(M=>M===S?B.Children.count(A)>1?B.Children.only(null):B.isValidElement(A)?A.props.children:null:M);return b.jsx(t,{..._,ref:h,children:B.isValidElement(A)?B.cloneElement(A,void 0,I):null})}return b.jsx(t,{..._,ref:h,children:m})});return n.displayName=`${e}.Slot`,n}var H5=wf("Slot");function rK(e){const t=B.forwardRef((n,s)=>{const{children:h,...m}=n;if(B.isValidElement(h)){const _=sK(h),i=oK(m,h.props);return h.type!==B.Fragment&&(i.ref=s?vT(s,_):_),B.cloneElement(h,i)}return B.Children.count(h)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var W5=Symbol("radix.slottable");function nK(e){const t=({children:n})=>b.jsx(b.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=W5,t}function iK(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===W5}function oK(e,t){const n={...t};for(const s in t){const h=e[s],m=t[s];/^on[A-Z]/.test(s)?h&&m?n[s]=(...i)=>{const S=m(...i);return h(...i),S}:h&&(n[s]=h):s==="style"?n[s]={...h,...m}:s==="className"&&(n[s]=[h,m].filter(Boolean).join(" "))}return{...e,...n}}function sK(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function O0(e){const t=e+"CollectionProvider",[n,s]=cc(t),[h,m]=n(t,{collectionRef:{current:null},itemMap:new Map}),_=F=>{const{scope:U,children:K}=F,J=$e.useRef(null),X=$e.useRef(new Map).current;return b.jsx(h,{scope:U,itemMap:X,collectionRef:J,children:K})};_.displayName=t;const i=e+"CollectionSlot",S=wf(i),A=$e.forwardRef((F,U)=>{const{scope:K,children:J}=F,X=m(i,K),ie=li(U,X.collectionRef);return b.jsx(S,{ref:ie,children:J})});A.displayName=i;const I=e+"CollectionItemSlot",M="data-radix-collection-item",L=wf(I),z=$e.forwardRef((F,U)=>{const{scope:K,children:J,...X}=F,ie=$e.useRef(null),Q=li(U,ie),ae=m(I,K);return $e.useEffect(()=>(ae.itemMap.set(ie,{ref:ie,...X}),()=>void ae.itemMap.delete(ie))),b.jsx(L,{[M]:"",ref:Q,children:J})});z.displayName=I;function G(F){const U=m(e+"CollectionConsumer",F);return $e.useCallback(()=>{const J=U.collectionRef.current;if(!J)return[];const X=Array.from(J.querySelectorAll(`[${M}]`));return Array.from(U.itemMap.values()).sort((ae,pe)=>X.indexOf(ae.ref.current)-X.indexOf(pe.ref.current))},[U.collectionRef,U.itemMap])}return[{Provider:_,Slot:A,ItemSlot:z},G,s]}var aK=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],En=aK.reduce((e,t)=>{const n=wf(`Primitive.${t}`),s=B.forwardRef((h,m)=>{const{asChild:_,...i}=h,S=_?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(S,{...i,ref:m})});return s.displayName=`Primitive.${t}`,{...e,[t]:s}},{});function jI(e,t){e&&Ng.flushSync(()=>e.dispatchEvent(t))}function va(e){const t=B.useRef(e);return B.useEffect(()=>{t.current=e}),B.useMemo(()=>(...n)=>t.current?.(...n),[])}function lK(e,t=globalThis?.document){const n=va(e);B.useEffect(()=>{const s=h=>{h.key==="Escape"&&n(h)};return t.addEventListener("keydown",s,{capture:!0}),()=>t.removeEventListener("keydown",s,{capture:!0})},[n,t])}var cK="DismissableLayer",iP="dismissableLayer.update",uK="dismissableLayer.pointerDownOutside",hK="dismissableLayer.focusOutside",mL,q5=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),zg=B.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:h,onFocusOutside:m,onInteractOutside:_,onDismiss:i,...S}=e,A=B.useContext(q5),[I,M]=B.useState(null),L=I?.ownerDocument??globalThis?.document,[,z]=B.useState({}),G=li(t,pe=>M(pe)),F=Array.from(A.layers),[U]=[...A.layersWithOutsidePointerEventsDisabled].slice(-1),K=F.indexOf(U),J=I?F.indexOf(I):-1,X=A.layersWithOutsidePointerEventsDisabled.size>0,ie=J>=K,Q=fK(pe=>{const Pe=pe.target,Fe=[...A.branches].some(tt=>tt.contains(Pe));!ie||Fe||(h?.(pe),_?.(pe),pe.defaultPrevented||i?.())},L),ae=pK(pe=>{const Pe=pe.target;[...A.branches].some(tt=>tt.contains(Pe))||(m?.(pe),_?.(pe),pe.defaultPrevented||i?.())},L);return lK(pe=>{J===A.layers.size-1&&(s?.(pe),!pe.defaultPrevented&&i&&(pe.preventDefault(),i()))},L),B.useEffect(()=>{if(I)return n&&(A.layersWithOutsidePointerEventsDisabled.size===0&&(mL=L.body.style.pointerEvents,L.body.style.pointerEvents="none"),A.layersWithOutsidePointerEventsDisabled.add(I)),A.layers.add(I),gL(),()=>{n&&A.layersWithOutsidePointerEventsDisabled.size===1&&(L.body.style.pointerEvents=mL)}},[I,L,n,A]),B.useEffect(()=>()=>{I&&(A.layers.delete(I),A.layersWithOutsidePointerEventsDisabled.delete(I),gL())},[I,A]),B.useEffect(()=>{const pe=()=>z({});return document.addEventListener(iP,pe),()=>document.removeEventListener(iP,pe)},[]),b.jsx(En.div,{...S,ref:G,style:{pointerEvents:X?ie?"auto":"none":void 0,...e.style},onFocusCapture:Ar(e.onFocusCapture,ae.onFocusCapture),onBlurCapture:Ar(e.onBlurCapture,ae.onBlurCapture),onPointerDownCapture:Ar(e.onPointerDownCapture,Q.onPointerDownCapture)})});zg.displayName=cK;var dK="DismissableLayerBranch",Z5=B.forwardRef((e,t)=>{const n=B.useContext(q5),s=B.useRef(null),h=li(t,s);return B.useEffect(()=>{const m=s.current;if(m)return n.branches.add(m),()=>{n.branches.delete(m)}},[n.branches]),b.jsx(En.div,{...e,ref:h})});Z5.displayName=dK;function fK(e,t=globalThis?.document){const n=va(e),s=B.useRef(!1),h=B.useRef(()=>{});return B.useEffect(()=>{const m=i=>{if(i.target&&!s.current){let S=function(){X5(uK,n,A,{discrete:!0})};const A={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",h.current),h.current=S,t.addEventListener("click",h.current,{once:!0})):S()}else t.removeEventListener("click",h.current);s.current=!1},_=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(_),t.removeEventListener("pointerdown",m),t.removeEventListener("click",h.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function pK(e,t=globalThis?.document){const n=va(e),s=B.useRef(!1);return B.useEffect(()=>{const h=m=>{m.target&&!s.current&&X5(hK,n,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",h),()=>t.removeEventListener("focusin",h)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function gL(){const e=new CustomEvent(iP);document.dispatchEvent(e)}function X5(e,t,n,{discrete:s}){const h=n.originalEvent.target,m=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&h.addEventListener(e,t,{once:!0}),s?jI(h,m):h.dispatchEvent(m)}var mK=zg,gK=Z5,Ds=globalThis?.document?B.useLayoutEffect:()=>{},yK="Portal",R0=B.forwardRef((e,t)=>{const{container:n,...s}=e,[h,m]=B.useState(!1);Ds(()=>m(!0),[]);const _=n||h&&globalThis?.document?.body;return _?F5.createPortal(b.jsx(En.div,{...s,ref:t}),_):null});R0.displayName=yK;function _K(e,t){return B.useReducer((n,s)=>t[n][s]??n,e)}var uc=e=>{const{present:t,children:n}=e,s=vK(t),h=typeof n=="function"?n({present:s.isPresent}):B.Children.only(n),m=li(s.ref,xK(h));return typeof n=="function"||s.isPresent?B.cloneElement(h,{ref:m}):null};uc.displayName="Presence";function vK(e){const[t,n]=B.useState(),s=B.useRef(null),h=B.useRef(e),m=B.useRef("none"),_=e?"mounted":"unmounted",[i,S]=_K(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const A=t1(s.current);m.current=i==="mounted"?A:"none"},[i]),Ds(()=>{const A=s.current,I=h.current;if(I!==e){const L=m.current,z=t1(A);e?S("MOUNT"):z==="none"||A?.display==="none"?S("UNMOUNT"):S(I&&L!==z?"ANIMATION_OUT":"UNMOUNT"),h.current=e}},[e,S]),Ds(()=>{if(t){let A;const I=t.ownerDocument.defaultView??window,M=z=>{const F=t1(s.current).includes(z.animationName);if(z.target===t&&F&&(S("ANIMATION_END"),!h.current)){const U=t.style.animationFillMode;t.style.animationFillMode="forwards",A=I.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=U)})}},L=z=>{z.target===t&&(m.current=t1(s.current))};return t.addEventListener("animationstart",L),t.addEventListener("animationcancel",M),t.addEventListener("animationend",M),()=>{I.clearTimeout(A),t.removeEventListener("animationstart",L),t.removeEventListener("animationcancel",M),t.removeEventListener("animationend",M)}}else S("ANIMATION_END")},[t,S]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:B.useCallback(A=>{s.current=A?getComputedStyle(A):null,n(A)},[])}}function t1(e){return e?.animationName||"none"}function xK(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var bK=kI[" useInsertionEffect ".trim().toString()]||Ds;function Wh({prop:e,defaultProp:t,onChange:n=()=>{},caller:s}){const[h,m,_]=wK({defaultProp:t,onChange:n}),i=e!==void 0,S=i?e:h;{const I=B.useRef(e!==void 0);B.useEffect(()=>{const M=I.current;M!==i&&console.warn(`${s} is changing from ${M?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),I.current=i},[i,s])}const A=B.useCallback(I=>{if(i){const M=TK(I)?I(e):I;M!==e&&_.current?.(M)}else m(I)},[i,e,m,_]);return[S,A]}function wK({defaultProp:e,onChange:t}){const[n,s]=B.useState(e),h=B.useRef(n),m=B.useRef(t);return bK(()=>{m.current=t},[t]),B.useEffect(()=>{h.current!==n&&(m.current?.(n),h.current=n)},[n,h]),[n,s,m]}function TK(e){return typeof e=="function"}var K5=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),SK="VisuallyHidden",ng=B.forwardRef((e,t)=>b.jsx(En.span,{...e,ref:t,style:{...K5,...e.style}}));ng.displayName=SK;var EK=ng,LI="ToastProvider",[NI,AK,PK]=O0("Toast"),[Y5,Aze]=cc("Toast",[PK]),[CK,xT]=Y5(LI),J5=e=>{const{__scopeToast:t,label:n="Notification",duration:s=5e3,swipeDirection:h="right",swipeThreshold:m=50,children:_}=e,[i,S]=B.useState(null),[A,I]=B.useState(0),M=B.useRef(!1),L=B.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${LI}\`. Expected non-empty \`string\`.`),b.jsx(NI.Provider,{scope:t,children:b.jsx(CK,{scope:t,label:n,duration:s,swipeDirection:h,swipeThreshold:m,toastCount:A,viewport:i,onViewportChange:S,onToastAdd:B.useCallback(()=>I(z=>z+1),[]),onToastRemove:B.useCallback(()=>I(z=>z-1),[]),isFocusedToastEscapeKeyDownRef:M,isClosePausedRef:L,children:_})})};J5.displayName=LI;var Q5="ToastViewport",IK=["F8"],oP="toast.viewportPause",sP="toast.viewportResume",e4=B.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:s=IK,label:h="Notifications ({hotkey})",...m}=e,_=xT(Q5,n),i=AK(n),S=B.useRef(null),A=B.useRef(null),I=B.useRef(null),M=B.useRef(null),L=li(t,M,_.onViewportChange),z=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),G=_.toastCount>0;B.useEffect(()=>{const U=K=>{s.length!==0&&s.every(X=>K[X]||K.code===X)&&M.current?.focus()};return document.addEventListener("keydown",U),()=>document.removeEventListener("keydown",U)},[s]),B.useEffect(()=>{const U=S.current,K=M.current;if(G&&U&&K){const J=()=>{if(!_.isClosePausedRef.current){const ae=new CustomEvent(oP);K.dispatchEvent(ae),_.isClosePausedRef.current=!0}},X=()=>{if(_.isClosePausedRef.current){const ae=new CustomEvent(sP);K.dispatchEvent(ae),_.isClosePausedRef.current=!1}},ie=ae=>{!U.contains(ae.relatedTarget)&&X()},Q=()=>{U.contains(document.activeElement)||X()};return U.addEventListener("focusin",J),U.addEventListener("focusout",ie),U.addEventListener("pointermove",J),U.addEventListener("pointerleave",Q),window.addEventListener("blur",J),window.addEventListener("focus",X),()=>{U.removeEventListener("focusin",J),U.removeEventListener("focusout",ie),U.removeEventListener("pointermove",J),U.removeEventListener("pointerleave",Q),window.removeEventListener("blur",J),window.removeEventListener("focus",X)}}},[G,_.isClosePausedRef]);const F=B.useCallback(({tabbingDirection:U})=>{const J=i().map(X=>{const ie=X.ref.current,Q=[ie,...$K(ie)];return U==="forwards"?Q:Q.reverse()});return(U==="forwards"?J.reverse():J).flat()},[i]);return B.useEffect(()=>{const U=M.current;if(U){const K=J=>{const X=J.altKey||J.ctrlKey||J.metaKey;if(J.key==="Tab"&&!X){const Q=document.activeElement,ae=J.shiftKey;if(J.target===U&&ae){A.current?.focus();return}const Fe=F({tabbingDirection:ae?"backwards":"forwards"}),tt=Fe.findIndex(Be=>Be===Q);WE(Fe.slice(tt+1))?J.preventDefault():ae?A.current?.focus():I.current?.focus()}};return U.addEventListener("keydown",K),()=>U.removeEventListener("keydown",K)}},[i,F]),b.jsxs(gK,{ref:S,role:"region","aria-label":h.replace("{hotkey}",z),tabIndex:-1,style:{pointerEvents:G?void 0:"none"},children:[G&&b.jsx(aP,{ref:A,onFocusFromOutsideViewport:()=>{const U=F({tabbingDirection:"forwards"});WE(U)}}),b.jsx(NI.Slot,{scope:n,children:b.jsx(En.ol,{tabIndex:-1,...m,ref:L})}),G&&b.jsx(aP,{ref:I,onFocusFromOutsideViewport:()=>{const U=F({tabbingDirection:"backwards"});WE(U)}})]})});e4.displayName=Q5;var t4="ToastFocusProxy",aP=B.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:s,...h}=e,m=xT(t4,n);return b.jsx(ng,{"aria-hidden":!0,tabIndex:0,...h,ref:t,style:{position:"fixed"},onFocus:_=>{const i=_.relatedTarget;!m.viewport?.contains(i)&&s()}})});aP.displayName=t4;var D0="Toast",MK="toast.swipeStart",OK="toast.swipeMove",RK="toast.swipeCancel",DK="toast.swipeEnd",r4=B.forwardRef((e,t)=>{const{forceMount:n,open:s,defaultOpen:h,onOpenChange:m,..._}=e,[i,S]=Wh({prop:s,defaultProp:h??!0,onChange:m,caller:D0});return b.jsx(uc,{present:n||i,children:b.jsx(LK,{open:i,..._,ref:t,onClose:()=>S(!1),onPause:va(e.onPause),onResume:va(e.onResume),onSwipeStart:Ar(e.onSwipeStart,A=>{A.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ar(e.onSwipeMove,A=>{const{x:I,y:M}=A.detail.delta;A.currentTarget.setAttribute("data-swipe","move"),A.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${I}px`),A.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${M}px`)}),onSwipeCancel:Ar(e.onSwipeCancel,A=>{A.currentTarget.setAttribute("data-swipe","cancel"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),A.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ar(e.onSwipeEnd,A=>{const{x:I,y:M}=A.detail.delta;A.currentTarget.setAttribute("data-swipe","end"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),A.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),A.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${I}px`),A.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${M}px`),S(!1)})})})});r4.displayName=D0;var[kK,jK]=Y5(D0,{onClose(){}}),LK=B.forwardRef((e,t)=>{const{__scopeToast:n,type:s="foreground",duration:h,open:m,onClose:_,onEscapeKeyDown:i,onPause:S,onResume:A,onSwipeStart:I,onSwipeMove:M,onSwipeCancel:L,onSwipeEnd:z,...G}=e,F=xT(D0,n),[U,K]=B.useState(null),J=li(t,Ke=>K(Ke)),X=B.useRef(null),ie=B.useRef(null),Q=h||F.duration,ae=B.useRef(0),pe=B.useRef(Q),Pe=B.useRef(0),{onToastAdd:Fe,onToastRemove:tt}=F,Be=va(()=>{U?.contains(document.activeElement)&&F.viewport?.focus(),_()}),Ge=B.useCallback(Ke=>{!Ke||Ke===1/0||(window.clearTimeout(Pe.current),ae.current=new Date().getTime(),Pe.current=window.setTimeout(Be,Ke))},[Be]);B.useEffect(()=>{const Ke=F.viewport;if(Ke){const ct=()=>{Ge(pe.current),A?.()},He=()=>{const qe=new Date().getTime()-ae.current;pe.current=pe.current-qe,window.clearTimeout(Pe.current),S?.()};return Ke.addEventListener(oP,He),Ke.addEventListener(sP,ct),()=>{Ke.removeEventListener(oP,He),Ke.removeEventListener(sP,ct)}}},[F.viewport,Q,S,A,Ge]),B.useEffect(()=>{m&&!F.isClosePausedRef.current&&Ge(Q)},[m,Q,F.isClosePausedRef,Ge]),B.useEffect(()=>(Fe(),()=>tt()),[Fe,tt]);const Qe=B.useMemo(()=>U?c4(U):null,[U]);return F.viewport?b.jsxs(b.Fragment,{children:[Qe&&b.jsx(NK,{__scopeToast:n,role:"status","aria-live":s==="foreground"?"assertive":"polite","aria-atomic":!0,children:Qe}),b.jsx(kK,{scope:n,onClose:Be,children:Ng.createPortal(b.jsx(NI.ItemSlot,{scope:n,children:b.jsx(mK,{asChild:!0,onEscapeKeyDown:Ar(i,()=>{F.isFocusedToastEscapeKeyDownRef.current||Be(),F.isFocusedToastEscapeKeyDownRef.current=!1}),children:b.jsx(En.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":m?"open":"closed","data-swipe-direction":F.swipeDirection,...G,ref:J,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ar(e.onKeyDown,Ke=>{Ke.key==="Escape"&&(i?.(Ke.nativeEvent),Ke.nativeEvent.defaultPrevented||(F.isFocusedToastEscapeKeyDownRef.current=!0,Be()))}),onPointerDown:Ar(e.onPointerDown,Ke=>{Ke.button===0&&(X.current={x:Ke.clientX,y:Ke.clientY})}),onPointerMove:Ar(e.onPointerMove,Ke=>{if(!X.current)return;const ct=Ke.clientX-X.current.x,He=Ke.clientY-X.current.y,qe=!!ie.current,ut=["left","right"].includes(F.swipeDirection),nt=["left","up"].includes(F.swipeDirection)?Math.min:Math.max,Kt=ut?nt(0,ct):0,cr=ut?0:nt(0,He),Bt=Ke.pointerType==="touch"?10:2,Vt={x:Kt,y:cr},xr={originalEvent:Ke,delta:Vt};qe?(ie.current=Vt,r1(OK,M,xr,{discrete:!1})):yL(Vt,F.swipeDirection,Bt)?(ie.current=Vt,r1(MK,I,xr,{discrete:!1}),Ke.target.setPointerCapture(Ke.pointerId)):(Math.abs(ct)>Bt||Math.abs(He)>Bt)&&(X.current=null)}),onPointerUp:Ar(e.onPointerUp,Ke=>{const ct=ie.current,He=Ke.target;if(He.hasPointerCapture(Ke.pointerId)&&He.releasePointerCapture(Ke.pointerId),ie.current=null,X.current=null,ct){const qe=Ke.currentTarget,ut={originalEvent:Ke,delta:ct};yL(ct,F.swipeDirection,F.swipeThreshold)?r1(DK,z,ut,{discrete:!0}):r1(RK,L,ut,{discrete:!0}),qe.addEventListener("click",nt=>nt.preventDefault(),{once:!0})}})})})}),F.viewport)})]}):null}),NK=e=>{const{__scopeToast:t,children:n,...s}=e,h=xT(D0,t),[m,_]=B.useState(!1),[i,S]=B.useState(!1);return BK(()=>_(!0)),B.useEffect(()=>{const A=window.setTimeout(()=>S(!0),1e3);return()=>window.clearTimeout(A)},[]),i?null:b.jsx(R0,{asChild:!0,children:b.jsx(ng,{...s,children:m&&b.jsxs(b.Fragment,{children:[h.label," ",n]})})})},zK="ToastTitle",n4=B.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e;return b.jsx(En.div,{...s,ref:t})});n4.displayName=zK;var FK="ToastDescription",i4=B.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e;return b.jsx(En.div,{...s,ref:t})});i4.displayName=FK;var o4="ToastAction",s4=B.forwardRef((e,t)=>{const{altText:n,...s}=e;return n.trim()?b.jsx(l4,{altText:n,asChild:!0,children:b.jsx(zI,{...s,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${o4}\`. Expected non-empty \`string\`.`),null)});s4.displayName=o4;var a4="ToastClose",zI=B.forwardRef((e,t)=>{const{__scopeToast:n,...s}=e,h=jK(a4,n);return b.jsx(l4,{asChild:!0,children:b.jsx(En.button,{type:"button",...s,ref:t,onClick:Ar(e.onClick,h.onClose)})})});zI.displayName=a4;var l4=B.forwardRef((e,t)=>{const{__scopeToast:n,altText:s,...h}=e;return b.jsx(En.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...h,ref:t})});function c4(e){const t=[];return Array.from(e.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&t.push(s.textContent),VK(s)){const h=s.ariaHidden||s.hidden||s.style.display==="none",m=s.dataset.radixToastAnnounceExclude==="";if(!h)if(m){const _=s.dataset.radixToastAnnounceAlt;_&&t.push(_)}else t.push(...c4(s))}}),t}function r1(e,t,n,{discrete:s}){const h=n.originalEvent.currentTarget,m=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&h.addEventListener(e,t,{once:!0}),s?jI(h,m):h.dispatchEvent(m)}var yL=(e,t,n=0)=>{const s=Math.abs(e.x),h=Math.abs(e.y),m=s>h;return t==="left"||t==="right"?m&&s>n:!m&&h>n};function BK(e=()=>{}){const t=va(e);Ds(()=>{let n=0,s=0;return n=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(s)}},[t])}function VK(e){return e.nodeType===e.ELEMENT_NODE}function $K(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const h=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||h?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function WE(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var UK=J5,u4=e4,h4=r4,d4=n4,f4=i4,p4=s4,m4=zI;function g4(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var h=e.length;for(t=0;t<h;t++)e[t]&&(n=g4(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function Ei(){for(var e,t,n=0,s="",h=arguments.length;n<h;n++)(e=arguments[n])&&(t=g4(e))&&(s&&(s+=" "),s+=t);return s}const _L=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,vL=Ei,k0=(e,t)=>n=>{var s;if(t?.variants==null)return vL(e,n?.class,n?.className);const{variants:h,defaultVariants:m}=t,_=Object.keys(h).map(A=>{const I=n?.[A],M=m?.[A];if(I===null)return null;const L=_L(I)||_L(M);return h[A][L]}),i=n&&Object.entries(n).reduce((A,I)=>{let[M,L]=I;return L===void 0||(A[M]=L),A},{}),S=t==null||(s=t.compoundVariants)===null||s===void 0?void 0:s.reduce((A,I)=>{let{class:M,className:L,...z}=I;return Object.entries(z).every(G=>{let[F,U]=G;return Array.isArray(U)?U.includes({...m,...i}[F]):{...m,...i}[F]===U})?[...A,M,L]:A},[]);return vL(e,_,S,n?.class,n?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GK=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),y4=(...e)=>e.filter((t,n,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var HK={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WK=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:s,className:h="",children:m,iconNode:_,...i},S)=>B.createElement("svg",{ref:S,...HK,width:t,height:t,stroke:e,strokeWidth:s?Number(n)*24/Number(t):n,className:y4("lucide",h),...i},[..._.map(([A,I])=>B.createElement(A,I)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=(e,t)=>{const n=B.forwardRef(({className:s,...h},m)=>B.createElement(WK,{ref:m,iconNode:t,className:y4(`lucide-${GK(e)}`,s),...h}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lP=Zr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q1=Zr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qK=Zr("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qE=Zr("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FI=Zr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=Zr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _4=Zr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZK=Zr("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z1=Zr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=Zr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v4=Zr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XK=Zr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BI=Zr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x4=Zr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xv=Zr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=Zr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KK=Zr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b4=Zr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YK=Zr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w4=Zr("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nc=Zr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JK=Zr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QK=Zr("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xL=Zr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=Zr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bL=Zr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eY=Zr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tY=Zr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rY=Zr("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nY=Zr("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iY=Zr("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X1=Zr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=Zr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qc=Zr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oY=Zr("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sY=Zr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nm=Zr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aY=Zr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lY=Zr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cY=Zr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=Zr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uY=Zr("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hY=Zr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dY=Zr("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=Zr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fY=Zr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pY=Zr("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZE=Zr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mY=Zr("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Av=Zr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gY=Zr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yf=Zr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yY=Zr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T4=Zr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S4=Zr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Y=Zr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vY=Zr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j0=Zr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wL=Zr("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xY=Zr("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bY=Zr("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oc=Zr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),VI="-",wY=e=>{const t=SY(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:_=>{const i=_.split(VI);return i[0]===""&&i.length!==1&&i.shift(),E4(i,t)||TY(_)},getConflictingClassGroupIds:(_,i)=>{const S=n[_]||[];return i&&s[_]?[...S,...s[_]]:S}}},E4=(e,t)=>{if(e.length===0)return t.classGroupId;const n=e[0],s=t.nextPart.get(n),h=s?E4(e.slice(1),s):void 0;if(h)return h;if(t.validators.length===0)return;const m=e.join(VI);return t.validators.find(({validator:_})=>_(m))?.classGroupId},TL=/^\[(.+)\]$/,TY=e=>{if(TL.test(e)){const t=TL.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},SY=e=>{const{theme:t,prefix:n}=e,s={nextPart:new Map,validators:[]};return AY(Object.entries(e.classGroups),n).forEach(([m,_])=>{cP(_,s,m,t)}),s},cP=(e,t,n,s)=>{e.forEach(h=>{if(typeof h=="string"){const m=h===""?t:SL(t,h);m.classGroupId=n;return}if(typeof h=="function"){if(EY(h)){cP(h(s),t,n,s);return}t.validators.push({validator:h,classGroupId:n});return}Object.entries(h).forEach(([m,_])=>{cP(_,SL(t,m),n,s)})})},SL=(e,t)=>{let n=e;return t.split(VI).forEach(s=>{n.nextPart.has(s)||n.nextPart.set(s,{nextPart:new Map,validators:[]}),n=n.nextPart.get(s)}),n},EY=e=>e.isThemeGetter,AY=(e,t)=>t?e.map(([n,s])=>{const h=s.map(m=>typeof m=="string"?t+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([_,i])=>[t+_,i])):m);return[n,h]}):e,PY=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,s=new Map;const h=(m,_)=>{n.set(m,_),t++,t>e&&(t=0,s=n,n=new Map)};return{get(m){let _=n.get(m);if(_!==void 0)return _;if((_=s.get(m))!==void 0)return h(m,_),_},set(m,_){n.has(m)?n.set(m,_):h(m,_)}}},A4="!",CY=e=>{const{separator:t,experimentalParseClassName:n}=e,s=t.length===1,h=t[0],m=t.length,_=i=>{const S=[];let A=0,I=0,M;for(let U=0;U<i.length;U++){let K=i[U];if(A===0){if(K===h&&(s||i.slice(U,U+m)===t)){S.push(i.slice(I,U)),I=U+m;continue}if(K==="/"){M=U;continue}}K==="["?A++:K==="]"&&A--}const L=S.length===0?i:i.substring(I),z=L.startsWith(A4),G=z?L.substring(1):L,F=M&&M>I?M-I:void 0;return{modifiers:S,hasImportantModifier:z,baseClassName:G,maybePostfixModifierPosition:F}};return n?i=>n({className:i,parseClassName:_}):_},IY=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(s=>{s[0]==="["?(t.push(...n.sort(),s),n=[]):n.push(s)}),t.push(...n.sort()),t},MY=e=>({cache:PY(e.cacheSize),parseClassName:CY(e),...wY(e)}),OY=/\s+/,RY=(e,t)=>{const{parseClassName:n,getClassGroupId:s,getConflictingClassGroupIds:h}=t,m=[],_=e.trim().split(OY);let i="";for(let S=_.length-1;S>=0;S-=1){const A=_[S],{modifiers:I,hasImportantModifier:M,baseClassName:L,maybePostfixModifierPosition:z}=n(A);let G=!!z,F=s(G?L.substring(0,z):L);if(!F){if(!G){i=A+(i.length>0?" "+i:i);continue}if(F=s(L),!F){i=A+(i.length>0?" "+i:i);continue}G=!1}const U=IY(I).join(":"),K=M?U+A4:U,J=K+F;if(m.includes(J))continue;m.push(J);const X=h(F,G);for(let ie=0;ie<X.length;++ie){const Q=X[ie];m.push(K+Q)}i=A+(i.length>0?" "+i:i)}return i};function DY(){let e=0,t,n,s="";for(;e<arguments.length;)(t=arguments[e++])&&(n=P4(t))&&(s&&(s+=" "),s+=n);return s}const P4=e=>{if(typeof e=="string")return e;let t,n="";for(let s=0;s<e.length;s++)e[s]&&(t=P4(e[s]))&&(n&&(n+=" "),n+=t);return n};function kY(e,...t){let n,s,h,m=_;function _(S){const A=t.reduce((I,M)=>M(I),e());return n=MY(A),s=n.cache.get,h=n.cache.set,m=i,i(S)}function i(S){const A=s(S);if(A)return A;const I=RY(S,n);return h(S,I),I}return function(){return m(DY.apply(null,arguments))}}const ho=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},C4=/^\[(?:([a-z-]+):)?(.+)\]$/i,jY=/^\d+\/\d+$/,LY=new Set(["px","full","screen"]),NY=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,zY=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,FY=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,BY=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,VY=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Au=e=>qm(e)||LY.has(e)||jY.test(e),Oh=e=>Fg(e,"length",XY),qm=e=>!!e&&!Number.isNaN(Number(e)),XE=e=>Fg(e,"number",qm),nv=e=>!!e&&Number.isInteger(Number(e)),$Y=e=>e.endsWith("%")&&qm(e.slice(0,-1)),ii=e=>C4.test(e),Rh=e=>NY.test(e),UY=new Set(["length","size","percentage"]),GY=e=>Fg(e,UY,I4),HY=e=>Fg(e,"position",I4),WY=new Set(["image","url"]),qY=e=>Fg(e,WY,YY),ZY=e=>Fg(e,"",KY),iv=()=>!0,Fg=(e,t,n)=>{const s=C4.exec(e);return s?s[1]?typeof t=="string"?s[1]===t:t.has(s[1]):n(s[2]):!1},XY=e=>zY.test(e)&&!FY.test(e),I4=()=>!1,KY=e=>BY.test(e),YY=e=>VY.test(e),JY=()=>{const e=ho("colors"),t=ho("spacing"),n=ho("blur"),s=ho("brightness"),h=ho("borderColor"),m=ho("borderRadius"),_=ho("borderSpacing"),i=ho("borderWidth"),S=ho("contrast"),A=ho("grayscale"),I=ho("hueRotate"),M=ho("invert"),L=ho("gap"),z=ho("gradientColorStops"),G=ho("gradientColorStopPositions"),F=ho("inset"),U=ho("margin"),K=ho("opacity"),J=ho("padding"),X=ho("saturate"),ie=ho("scale"),Q=ho("sepia"),ae=ho("skew"),pe=ho("space"),Pe=ho("translate"),Fe=()=>["auto","contain","none"],tt=()=>["auto","hidden","clip","visible","scroll"],Be=()=>["auto",ii,t],Ge=()=>[ii,t],Qe=()=>["",Au,Oh],Ke=()=>["auto",qm,ii],ct=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],He=()=>["solid","dashed","dotted","double","none"],qe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ut=()=>["start","end","center","between","around","evenly","stretch"],nt=()=>["","0",ii],Kt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],cr=()=>[qm,ii];return{cacheSize:500,separator:":",theme:{colors:[iv],spacing:[Au,Oh],blur:["none","",Rh,ii],brightness:cr(),borderColor:[e],borderRadius:["none","","full",Rh,ii],borderSpacing:Ge(),borderWidth:Qe(),contrast:cr(),grayscale:nt(),hueRotate:cr(),invert:nt(),gap:Ge(),gradientColorStops:[e],gradientColorStopPositions:[$Y,Oh],inset:Be(),margin:Be(),opacity:cr(),padding:Ge(),saturate:cr(),scale:cr(),sepia:nt(),skew:cr(),space:Ge(),translate:Ge()},classGroups:{aspect:[{aspect:["auto","square","video",ii]}],container:["container"],columns:[{columns:[Rh]}],"break-after":[{"break-after":Kt()}],"break-before":[{"break-before":Kt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ct(),ii]}],overflow:[{overflow:tt()}],"overflow-x":[{"overflow-x":tt()}],"overflow-y":[{"overflow-y":tt()}],overscroll:[{overscroll:Fe()}],"overscroll-x":[{"overscroll-x":Fe()}],"overscroll-y":[{"overscroll-y":Fe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[F]}],"inset-x":[{"inset-x":[F]}],"inset-y":[{"inset-y":[F]}],start:[{start:[F]}],end:[{end:[F]}],top:[{top:[F]}],right:[{right:[F]}],bottom:[{bottom:[F]}],left:[{left:[F]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",nv,ii]}],basis:[{basis:Be()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ii]}],grow:[{grow:nt()}],shrink:[{shrink:nt()}],order:[{order:["first","last","none",nv,ii]}],"grid-cols":[{"grid-cols":[iv]}],"col-start-end":[{col:["auto",{span:["full",nv,ii]},ii]}],"col-start":[{"col-start":Ke()}],"col-end":[{"col-end":Ke()}],"grid-rows":[{"grid-rows":[iv]}],"row-start-end":[{row:["auto",{span:[nv,ii]},ii]}],"row-start":[{"row-start":Ke()}],"row-end":[{"row-end":Ke()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ii]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ii]}],gap:[{gap:[L]}],"gap-x":[{"gap-x":[L]}],"gap-y":[{"gap-y":[L]}],"justify-content":[{justify:["normal",...ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[J]}],px:[{px:[J]}],py:[{py:[J]}],ps:[{ps:[J]}],pe:[{pe:[J]}],pt:[{pt:[J]}],pr:[{pr:[J]}],pb:[{pb:[J]}],pl:[{pl:[J]}],m:[{m:[U]}],mx:[{mx:[U]}],my:[{my:[U]}],ms:[{ms:[U]}],me:[{me:[U]}],mt:[{mt:[U]}],mr:[{mr:[U]}],mb:[{mb:[U]}],ml:[{ml:[U]}],"space-x":[{"space-x":[pe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[pe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ii,t]}],"min-w":[{"min-w":[ii,t,"min","max","fit"]}],"max-w":[{"max-w":[ii,t,"none","full","min","max","fit","prose",{screen:[Rh]},Rh]}],h:[{h:[ii,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ii,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ii,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ii,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Rh,Oh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",XE]}],"font-family":[{font:[iv]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ii]}],"line-clamp":[{"line-clamp":["none",qm,XE]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Au,ii]}],"list-image":[{"list-image":["none",ii]}],"list-style-type":[{list:["none","disc","decimal",ii]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[K]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[K]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...He(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Au,Oh]}],"underline-offset":[{"underline-offset":["auto",Au,ii]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ge()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ii]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ii]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[K]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ct(),HY]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",GY]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},qY]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[z]}],"gradient-via":[{via:[z]}],"gradient-to":[{to:[z]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[K]}],"border-style":[{border:[...He(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[K]}],"divide-style":[{divide:He()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-s":[{"border-s":[h]}],"border-color-e":[{"border-e":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...He()]}],"outline-offset":[{"outline-offset":[Au,ii]}],"outline-w":[{outline:[Au,Oh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Qe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[K]}],"ring-offset-w":[{"ring-offset":[Au,Oh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Rh,ZY]}],"shadow-color":[{shadow:[iv]}],opacity:[{opacity:[K]}],"mix-blend":[{"mix-blend":[...qe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":qe()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[s]}],contrast:[{contrast:[S]}],"drop-shadow":[{"drop-shadow":["","none",Rh,ii]}],grayscale:[{grayscale:[A]}],"hue-rotate":[{"hue-rotate":[I]}],invert:[{invert:[M]}],saturate:[{saturate:[X]}],sepia:[{sepia:[Q]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[S]}],"backdrop-grayscale":[{"backdrop-grayscale":[A]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[I]}],"backdrop-invert":[{"backdrop-invert":[M]}],"backdrop-opacity":[{"backdrop-opacity":[K]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[Q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ii]}],duration:[{duration:cr()}],ease:[{ease:["linear","in","out","in-out",ii]}],delay:[{delay:cr()}],animate:[{animate:["none","spin","ping","pulse","bounce",ii]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ie]}],"scale-x":[{"scale-x":[ie]}],"scale-y":[{"scale-y":[ie]}],rotate:[{rotate:[nv,ii]}],"translate-x":[{"translate-x":[Pe]}],"translate-y":[{"translate-y":[Pe]}],"skew-x":[{"skew-x":[ae]}],"skew-y":[{"skew-y":[ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ii]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ii]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ge()}],"scroll-mx":[{"scroll-mx":Ge()}],"scroll-my":[{"scroll-my":Ge()}],"scroll-ms":[{"scroll-ms":Ge()}],"scroll-me":[{"scroll-me":Ge()}],"scroll-mt":[{"scroll-mt":Ge()}],"scroll-mr":[{"scroll-mr":Ge()}],"scroll-mb":[{"scroll-mb":Ge()}],"scroll-ml":[{"scroll-ml":Ge()}],"scroll-p":[{"scroll-p":Ge()}],"scroll-px":[{"scroll-px":Ge()}],"scroll-py":[{"scroll-py":Ge()}],"scroll-ps":[{"scroll-ps":Ge()}],"scroll-pe":[{"scroll-pe":Ge()}],"scroll-pt":[{"scroll-pt":Ge()}],"scroll-pr":[{"scroll-pr":Ge()}],"scroll-pb":[{"scroll-pb":Ge()}],"scroll-pl":[{"scroll-pl":Ge()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ii]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Au,Oh,XE]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},QY=kY(JY);function Wr(...e){return QY(Ei(e))}async function eJ(e,t={},n=1e4){const s=new AbortController,h=setTimeout(()=>s.abort(),n);try{return await fetch(e,{...t,signal:s.signal})}finally{clearTimeout(h)}}function tJ(e,t){try{if(typeof window>"u"||typeof window.sessionStorage>"u")return;sessionStorage.setItem(e,JSON.stringify(t))}catch(n){console.warn("safeSessionSet failed",n)}}function uP(e){try{if(typeof window>"u"||typeof window.sessionStorage>"u")return null;const t=sessionStorage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}catch(t){return console.warn("safeSessionGet failed",t),null}}async function K1(e,t=3,n=300){let s;for(let h=0;h<t;h++)try{return await e()}catch(m){s=m;const _=n*Math.pow(2,h);await new Promise(i=>setTimeout(i,_))}throw s}const rJ=UK,M4=B.forwardRef(({className:e,...t},n)=>b.jsx(u4,{ref:n,className:Wr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));M4.displayName=u4.displayName;const nJ=k0("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),O4=B.forwardRef(({className:e,variant:t,...n},s)=>b.jsx(h4,{ref:s,className:Wr(nJ({variant:t}),e),...n}));O4.displayName=h4.displayName;const iJ=B.forwardRef(({className:e,...t},n)=>b.jsx(p4,{ref:n,className:Wr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));iJ.displayName=p4.displayName;const R4=B.forwardRef(({className:e,...t},n)=>b.jsx(m4,{ref:n,className:Wr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:b.jsx(oc,{className:"h-4 w-4"})}));R4.displayName=m4.displayName;const D4=B.forwardRef(({className:e,...t},n)=>b.jsx(d4,{ref:n,className:Wr("text-sm font-semibold",e),...t}));D4.displayName=d4.displayName;const k4=B.forwardRef(({className:e,...t},n)=>b.jsx(f4,{ref:n,className:Wr("text-sm opacity-90",e),...t}));k4.displayName=f4.displayName;function oJ(){const{toasts:e}=G5();return b.jsxs(rJ,{children:[e.map(function({id:t,title:n,description:s,action:h,...m}){return b.jsxs(O4,{...m,children:[b.jsxs("div",{className:"grid gap-1",children:[n&&b.jsx(D4,{children:n}),s&&b.jsx(k4,{children:s})]}),h,b.jsx(R4,{})]},t)}),b.jsx(M4,{})]})}var EL=["light","dark"],sJ="(prefers-color-scheme: dark)",aJ=B.createContext(void 0),lJ={setTheme:e=>{},themes:[]},cJ=()=>{var e;return(e=B.useContext(aJ))!=null?e:lJ};B.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:s,enableColorScheme:h,defaultTheme:m,value:_,attrs:i,nonce:S})=>{let A=m==="system",I=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(G=>`'${G}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,M=h?EL.includes(m)&&m?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${m}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",L=(G,F=!1,U=!0)=>{let K=_?_[G]:G,J=F?G+"|| ''":`'${K}'`,X="";return h&&U&&!F&&EL.includes(G)&&(X+=`d.style.colorScheme = '${G}';`),n==="class"?F||K?X+=`c.add(${J})`:X+="null":K&&(X+=`d[s](n,${J})`),X},z=e?`!function(){${I}${L(e)}}()`:s?`!function(){try{${I}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${A})){var t='${sJ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${L("dark")}}else{${L("light")}}}else if(e){${_?`var x=${JSON.stringify(_)};`:""}${L(_?"x[e]":"e",!0)}}${A?"":"else{"+L(m,!1,!1)+"}"}${M}}catch(e){}}()`:`!function(){try{${I}var e=localStorage.getItem('${t}');if(e){${_?`var x=${JSON.stringify(_)};`:""}${L(_?"x[e]":"e",!0)}}else{${L(m,!1,!1)};}${M}}catch(t){}}();`;return B.createElement("script",{nonce:S,dangerouslySetInnerHTML:{__html:z}})});var uJ=e=>{switch(e){case"success":return fJ;case"info":return mJ;case"warning":return pJ;case"error":return gJ;default:return null}},hJ=Array(12).fill(0),dJ=({visible:e,className:t})=>$e.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},$e.createElement("div",{className:"sonner-spinner"},hJ.map((n,s)=>$e.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),fJ=$e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},$e.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),pJ=$e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},$e.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),mJ=$e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},$e.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),gJ=$e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},$e.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),yJ=$e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},$e.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),$e.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),_J=()=>{let[e,t]=$e.useState(document.hidden);return $e.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},hP=1,vJ=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:n,...s}=e,h=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:hP++,m=this.toasts.find(i=>i.id===h),_=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(h)&&this.dismissedToasts.delete(h),m?this.toasts=this.toasts.map(i=>i.id===h?(this.publish({...i,...e,id:h,title:n}),{...i,...e,id:h,dismissible:_,title:n}):i):this.addToast({title:n,...s,dismissible:_,id:h}),h},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let s=e instanceof Promise?e:e(),h=n!==void 0,m,_=s.then(async S=>{if(m=["resolve",S],$e.isValidElement(S))h=!1,this.create({id:n,type:"default",message:S});else if(bJ(S)&&!S.ok){h=!1;let A=typeof t.error=="function"?await t.error(`HTTP error! status: ${S.status}`):t.error,I=typeof t.description=="function"?await t.description(`HTTP error! status: ${S.status}`):t.description;this.create({id:n,type:"error",message:A,description:I})}else if(t.success!==void 0){h=!1;let A=typeof t.success=="function"?await t.success(S):t.success,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:n,type:"success",message:A,description:I})}}).catch(async S=>{if(m=["reject",S],t.error!==void 0){h=!1;let A=typeof t.error=="function"?await t.error(S):t.error,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:n,type:"error",message:A,description:I})}}).finally(()=>{var S;h&&(this.dismiss(n),n=void 0),(S=t.finally)==null||S.call(t)}),i=()=>new Promise((S,A)=>_.then(()=>m[0]==="reject"?A(m[1]):S(m[1])).catch(A));return typeof n!="string"&&typeof n!="number"?{unwrap:i}:Object.assign(n,{unwrap:i})},this.custom=(e,t)=>{let n=t?.id||hP++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},pa=new vJ,xJ=(e,t)=>{let n=t?.id||hP++;return pa.addToast({title:e,...t,id:n}),n},bJ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",wJ=xJ,TJ=()=>pa.toasts,SJ=()=>pa.getActiveToasts(),ma=Object.assign(wJ,{success:pa.success,info:pa.info,warning:pa.warning,error:pa.error,custom:pa.custom,message:pa.message,promise:pa.promise,dismiss:pa.dismiss,loading:pa.loading},{getHistory:TJ,getToasts:SJ});function EJ(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}EJ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function n1(e){return e.label!==void 0}var AJ=3,PJ="32px",CJ="16px",AL=4e3,IJ=356,MJ=14,OJ=20,RJ=200;function Wl(...e){return e.filter(Boolean).join(" ")}function DJ(e){let[t,n]=e.split("-"),s=[];return t&&s.push(t),n&&s.push(n),s}var kJ=e=>{var t,n,s,h,m,_,i,S,A,I,M;let{invert:L,toast:z,unstyled:G,interacting:F,setHeights:U,visibleToasts:K,heights:J,index:X,toasts:ie,expanded:Q,removeToast:ae,defaultRichColors:pe,closeButton:Pe,style:Fe,cancelButtonStyle:tt,actionButtonStyle:Be,className:Ge="",descriptionClassName:Qe="",duration:Ke,position:ct,gap:He,loadingIcon:qe,expandByDefault:ut,classNames:nt,icons:Kt,closeButtonAriaLabel:cr="Close toast",pauseWhenPageIsHidden:Bt}=e,[Vt,xr]=$e.useState(null),[nn,Hn]=$e.useState(null),[lr,an]=$e.useState(!1),[Lt,nr]=$e.useState(!1),[pr,Nt]=$e.useState(!1),[Nr,un]=$e.useState(!1),[ci,Un]=$e.useState(!1),[zn,Kn]=$e.useState(0),[ks,ds]=$e.useState(0),ao=$e.useRef(z.duration||Ke||AL),bo=$e.useRef(null),mo=$e.useRef(null),Hi=X===0,Yo=X+1<=K,wo=z.type,Po=z.dismissible!==!1,Gs=z.className||"",Co=z.descriptionClassName||"",js=$e.useMemo(()=>J.findIndex(on=>on.toastId===z.id)||0,[J,z.id]),ba=$e.useMemo(()=>{var on;return(on=z.closeButton)!=null?on:Pe},[z.closeButton,Pe]),Zt=$e.useMemo(()=>z.duration||Ke||AL,[z.duration,Ke]),qt=$e.useRef(0),fr=$e.useRef(0),Ir=$e.useRef(0),On=$e.useRef(null),[Ii,eo]=ct.split("-"),ko=$e.useMemo(()=>J.reduce((on,Wn,Yn)=>Yn>=js?on:on+Wn.height,0),[J,js]),Io=_J(),wa=z.invert||L,Mi=wo==="loading";fr.current=$e.useMemo(()=>js*He+ko,[js,ko]),$e.useEffect(()=>{ao.current=Zt},[Zt]),$e.useEffect(()=>{an(!0)},[]),$e.useEffect(()=>{let on=mo.current;if(on){let Wn=on.getBoundingClientRect().height;return ds(Wn),U(Yn=>[{toastId:z.id,height:Wn,position:z.position},...Yn]),()=>U(Yn=>Yn.filter(jo=>jo.toastId!==z.id))}},[U,z.id]),$e.useLayoutEffect(()=>{if(!lr)return;let on=mo.current,Wn=on.style.height;on.style.height="auto";let Yn=on.getBoundingClientRect().height;on.style.height=Wn,ds(Yn),U(jo=>jo.find(mt=>mt.toastId===z.id)?jo.map(mt=>mt.toastId===z.id?{...mt,height:Yn}:mt):[{toastId:z.id,height:Yn,position:z.position},...jo])},[lr,z.title,z.description,U,z.id]);let ln=$e.useCallback(()=>{nr(!0),Kn(fr.current),U(on=>on.filter(Wn=>Wn.toastId!==z.id)),setTimeout(()=>{ae(z)},RJ)},[z,ae,U,fr]);$e.useEffect(()=>{if(z.promise&&wo==="loading"||z.duration===1/0||z.type==="loading")return;let on;return Q||F||Bt&&Io?(()=>{if(Ir.current<qt.current){let Wn=new Date().getTime()-qt.current;ao.current=ao.current-Wn}Ir.current=new Date().getTime()})():ao.current!==1/0&&(qt.current=new Date().getTime(),on=setTimeout(()=>{var Wn;(Wn=z.onAutoClose)==null||Wn.call(z,z),ln()},ao.current)),()=>clearTimeout(on)},[Q,F,z,wo,Bt,Io,ln]),$e.useEffect(()=>{z.delete&&ln()},[ln,z.delete]);function si(){var on,Wn,Yn;return Kt!=null&&Kt.loading?$e.createElement("div",{className:Wl(nt?.loader,(on=z?.classNames)==null?void 0:on.loader,"sonner-loader"),"data-visible":wo==="loading"},Kt.loading):qe?$e.createElement("div",{className:Wl(nt?.loader,(Wn=z?.classNames)==null?void 0:Wn.loader,"sonner-loader"),"data-visible":wo==="loading"},qe):$e.createElement(dJ,{className:Wl(nt?.loader,(Yn=z?.classNames)==null?void 0:Yn.loader),visible:wo==="loading"})}return $e.createElement("li",{tabIndex:0,ref:mo,className:Wl(Ge,Gs,nt?.toast,(t=z?.classNames)==null?void 0:t.toast,nt?.default,nt?.[wo],(n=z?.classNames)==null?void 0:n[wo]),"data-sonner-toast":"","data-rich-colors":(s=z.richColors)!=null?s:pe,"data-styled":!(z.jsx||z.unstyled||G),"data-mounted":lr,"data-promise":!!z.promise,"data-swiped":ci,"data-removed":Lt,"data-visible":Yo,"data-y-position":Ii,"data-x-position":eo,"data-index":X,"data-front":Hi,"data-swiping":pr,"data-dismissible":Po,"data-type":wo,"data-invert":wa,"data-swipe-out":Nr,"data-swipe-direction":nn,"data-expanded":!!(Q||ut&&lr),style:{"--index":X,"--toasts-before":X,"--z-index":ie.length-X,"--offset":`${Lt?zn:fr.current}px`,"--initial-height":ut?"auto":`${ks}px`,...Fe,...z.style},onDragEnd:()=>{Nt(!1),xr(null),On.current=null},onPointerDown:on=>{Mi||!Po||(bo.current=new Date,Kn(fr.current),on.target.setPointerCapture(on.pointerId),on.target.tagName!=="BUTTON"&&(Nt(!0),On.current={x:on.clientX,y:on.clientY}))},onPointerUp:()=>{var on,Wn,Yn,jo;if(Nr||!Po)return;On.current=null;let mt=Number(((on=mo.current)==null?void 0:on.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Vo=Number(((Wn=mo.current)==null?void 0:Wn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ta=new Date().getTime()-((Yn=bo.current)==null?void 0:Yn.getTime()),Lo=Vt==="x"?mt:Vo,qr=Math.abs(Lo)/Ta;if(Math.abs(Lo)>=OJ||qr>.11){Kn(fr.current),(jo=z.onDismiss)==null||jo.call(z,z),Hn(Vt==="x"?mt>0?"right":"left":Vo>0?"down":"up"),ln(),un(!0),Un(!1);return}Nt(!1),xr(null)},onPointerMove:on=>{var Wn,Yn,jo,mt;if(!On.current||!Po||((Wn=window.getSelection())==null?void 0:Wn.toString().length)>0)return;let Vo=on.clientY-On.current.y,Ta=on.clientX-On.current.x,Lo=(Yn=e.swipeDirections)!=null?Yn:DJ(ct);!Vt&&(Math.abs(Ta)>1||Math.abs(Vo)>1)&&xr(Math.abs(Ta)>Math.abs(Vo)?"x":"y");let qr={x:0,y:0};Vt==="y"?(Lo.includes("top")||Lo.includes("bottom"))&&(Lo.includes("top")&&Vo<0||Lo.includes("bottom")&&Vo>0)&&(qr.y=Vo):Vt==="x"&&(Lo.includes("left")||Lo.includes("right"))&&(Lo.includes("left")&&Ta<0||Lo.includes("right")&&Ta>0)&&(qr.x=Ta),(Math.abs(qr.x)>0||Math.abs(qr.y)>0)&&Un(!0),(jo=mo.current)==null||jo.style.setProperty("--swipe-amount-x",`${qr.x}px`),(mt=mo.current)==null||mt.style.setProperty("--swipe-amount-y",`${qr.y}px`)}},ba&&!z.jsx?$e.createElement("button",{"aria-label":cr,"data-disabled":Mi,"data-close-button":!0,onClick:Mi||!Po?()=>{}:()=>{var on;ln(),(on=z.onDismiss)==null||on.call(z,z)},className:Wl(nt?.closeButton,(h=z?.classNames)==null?void 0:h.closeButton)},(m=Kt?.close)!=null?m:yJ):null,z.jsx||B.isValidElement(z.title)?z.jsx?z.jsx:typeof z.title=="function"?z.title():z.title:$e.createElement($e.Fragment,null,wo||z.icon||z.promise?$e.createElement("div",{"data-icon":"",className:Wl(nt?.icon,(_=z?.classNames)==null?void 0:_.icon)},z.promise||z.type==="loading"&&!z.icon?z.icon||si():null,z.type!=="loading"?z.icon||Kt?.[wo]||uJ(wo):null):null,$e.createElement("div",{"data-content":"",className:Wl(nt?.content,(i=z?.classNames)==null?void 0:i.content)},$e.createElement("div",{"data-title":"",className:Wl(nt?.title,(S=z?.classNames)==null?void 0:S.title)},typeof z.title=="function"?z.title():z.title),z.description?$e.createElement("div",{"data-description":"",className:Wl(Qe,Co,nt?.description,(A=z?.classNames)==null?void 0:A.description)},typeof z.description=="function"?z.description():z.description):null),B.isValidElement(z.cancel)?z.cancel:z.cancel&&n1(z.cancel)?$e.createElement("button",{"data-button":!0,"data-cancel":!0,style:z.cancelButtonStyle||tt,onClick:on=>{var Wn,Yn;n1(z.cancel)&&Po&&((Yn=(Wn=z.cancel).onClick)==null||Yn.call(Wn,on),ln())},className:Wl(nt?.cancelButton,(I=z?.classNames)==null?void 0:I.cancelButton)},z.cancel.label):null,B.isValidElement(z.action)?z.action:z.action&&n1(z.action)?$e.createElement("button",{"data-button":!0,"data-action":!0,style:z.actionButtonStyle||Be,onClick:on=>{var Wn,Yn;n1(z.action)&&((Yn=(Wn=z.action).onClick)==null||Yn.call(Wn,on),!on.defaultPrevented&&ln())},className:Wl(nt?.actionButton,(M=z?.classNames)==null?void 0:M.actionButton)},z.action.label):null))};function PL(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function jJ(e,t){let n={};return[e,t].forEach((s,h)=>{let m=h===1,_=m?"--mobile-offset":"--offset",i=m?CJ:PJ;function S(A){["top","right","bottom","left"].forEach(I=>{n[`${_}-${I}`]=typeof A=="number"?`${A}px`:A})}typeof s=="number"||typeof s=="string"?S(s):typeof s=="object"?["top","right","bottom","left"].forEach(A=>{s[A]===void 0?n[`${_}-${A}`]=i:n[`${_}-${A}`]=typeof s[A]=="number"?`${s[A]}px`:s[A]}):S(i)}),n}var LJ=B.forwardRef(function(e,t){let{invert:n,position:s="bottom-right",hotkey:h=["altKey","KeyT"],expand:m,closeButton:_,className:i,offset:S,mobileOffset:A,theme:I="light",richColors:M,duration:L,style:z,visibleToasts:G=AJ,toastOptions:F,dir:U=PL(),gap:K=MJ,loadingIcon:J,icons:X,containerAriaLabel:ie="Notifications",pauseWhenPageIsHidden:Q}=e,[ae,pe]=$e.useState([]),Pe=$e.useMemo(()=>Array.from(new Set([s].concat(ae.filter(Bt=>Bt.position).map(Bt=>Bt.position)))),[ae,s]),[Fe,tt]=$e.useState([]),[Be,Ge]=$e.useState(!1),[Qe,Ke]=$e.useState(!1),[ct,He]=$e.useState(I!=="system"?I:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),qe=$e.useRef(null),ut=h.join("+").replace(/Key/g,"").replace(/Digit/g,""),nt=$e.useRef(null),Kt=$e.useRef(!1),cr=$e.useCallback(Bt=>{pe(Vt=>{var xr;return(xr=Vt.find(nn=>nn.id===Bt.id))!=null&&xr.delete||pa.dismiss(Bt.id),Vt.filter(({id:nn})=>nn!==Bt.id)})},[]);return $e.useEffect(()=>pa.subscribe(Bt=>{if(Bt.dismiss){pe(Vt=>Vt.map(xr=>xr.id===Bt.id?{...xr,delete:!0}:xr));return}setTimeout(()=>{F5.flushSync(()=>{pe(Vt=>{let xr=Vt.findIndex(nn=>nn.id===Bt.id);return xr!==-1?[...Vt.slice(0,xr),{...Vt[xr],...Bt},...Vt.slice(xr+1)]:[Bt,...Vt]})})})}),[]),$e.useEffect(()=>{if(I!=="system"){He(I);return}if(I==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?He("dark"):He("light")),typeof window>"u")return;let Bt=window.matchMedia("(prefers-color-scheme: dark)");try{Bt.addEventListener("change",({matches:Vt})=>{He(Vt?"dark":"light")})}catch{Bt.addListener(({matches:xr})=>{try{He(xr?"dark":"light")}catch(nn){console.error(nn)}})}},[I]),$e.useEffect(()=>{ae.length<=1&&Ge(!1)},[ae]),$e.useEffect(()=>{let Bt=Vt=>{var xr,nn;h.every(Hn=>Vt[Hn]||Vt.code===Hn)&&(Ge(!0),(xr=qe.current)==null||xr.focus()),Vt.code==="Escape"&&(document.activeElement===qe.current||(nn=qe.current)!=null&&nn.contains(document.activeElement))&&Ge(!1)};return document.addEventListener("keydown",Bt),()=>document.removeEventListener("keydown",Bt)},[h]),$e.useEffect(()=>{if(qe.current)return()=>{nt.current&&(nt.current.focus({preventScroll:!0}),nt.current=null,Kt.current=!1)}},[qe.current]),$e.createElement("section",{ref:t,"aria-label":`${ie} ${ut}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Pe.map((Bt,Vt)=>{var xr;let[nn,Hn]=Bt.split("-");return ae.length?$e.createElement("ol",{key:Bt,dir:U==="auto"?PL():U,tabIndex:-1,ref:qe,className:i,"data-sonner-toaster":!0,"data-theme":ct,"data-y-position":nn,"data-lifted":Be&&ae.length>1&&!m,"data-x-position":Hn,style:{"--front-toast-height":`${((xr=Fe[0])==null?void 0:xr.height)||0}px`,"--width":`${IJ}px`,"--gap":`${K}px`,...z,...jJ(S,A)},onBlur:lr=>{Kt.current&&!lr.currentTarget.contains(lr.relatedTarget)&&(Kt.current=!1,nt.current&&(nt.current.focus({preventScroll:!0}),nt.current=null))},onFocus:lr=>{lr.target instanceof HTMLElement&&lr.target.dataset.dismissible==="false"||Kt.current||(Kt.current=!0,nt.current=lr.relatedTarget)},onMouseEnter:()=>Ge(!0),onMouseMove:()=>Ge(!0),onMouseLeave:()=>{Qe||Ge(!1)},onDragEnd:()=>Ge(!1),onPointerDown:lr=>{lr.target instanceof HTMLElement&&lr.target.dataset.dismissible==="false"||Ke(!0)},onPointerUp:()=>Ke(!1)},ae.filter(lr=>!lr.position&&Vt===0||lr.position===Bt).map((lr,an)=>{var Lt,nr;return $e.createElement(kJ,{key:lr.id,icons:X,index:an,toast:lr,defaultRichColors:M,duration:(Lt=F?.duration)!=null?Lt:L,className:F?.className,descriptionClassName:F?.descriptionClassName,invert:n,visibleToasts:G,closeButton:(nr=F?.closeButton)!=null?nr:_,interacting:Qe,position:Bt,style:F?.style,unstyled:F?.unstyled,classNames:F?.classNames,cancelButtonStyle:F?.cancelButtonStyle,actionButtonStyle:F?.actionButtonStyle,removeToast:cr,toasts:ae.filter(pr=>pr.position==lr.position),heights:Fe.filter(pr=>pr.position==lr.position),setHeights:tt,expandByDefault:m,gap:K,loadingIcon:J,expanded:Be,pauseWhenPageIsHidden:Q,swipeDirections:e.swipeDirections})})):null}))});const NJ=({...e})=>{const{theme:t="system"}=cJ();return b.jsx(LJ,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var zJ=kI[" useId ".trim().toString()]||(()=>{}),FJ=0;function Du(e){const[t,n]=B.useState(zJ());return Ds(()=>{n(s=>s??String(FJ++))},[e]),t?`radix-${t}`:""}const BJ=["top","right","bottom","left"],qh=Math.min,za=Math.max,Y1=Math.round,i1=Math.floor,$c=e=>({x:e,y:e}),VJ={left:"right",right:"left",bottom:"top",top:"bottom"},$J={start:"end",end:"start"};function dP(e,t,n){return za(e,qh(t,n))}function zu(e,t){return typeof e=="function"?e(t):e}function Fu(e){return e.split("-")[0]}function Bg(e){return e.split("-")[1]}function $I(e){return e==="x"?"y":"x"}function UI(e){return e==="y"?"height":"width"}const UJ=new Set(["top","bottom"]);function zc(e){return UJ.has(Fu(e))?"y":"x"}function GI(e){return $I(zc(e))}function GJ(e,t,n){n===void 0&&(n=!1);const s=Bg(e),h=GI(e),m=UI(h);let _=h==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[m]>t.floating[m]&&(_=J1(_)),[_,J1(_)]}function HJ(e){const t=J1(e);return[fP(e),t,fP(t)]}function fP(e){return e.replace(/start|end/g,t=>$J[t])}const CL=["left","right"],IL=["right","left"],WJ=["top","bottom"],qJ=["bottom","top"];function ZJ(e,t,n){switch(e){case"top":case"bottom":return n?t?IL:CL:t?CL:IL;case"left":case"right":return t?WJ:qJ;default:return[]}}function XJ(e,t,n,s){const h=Bg(e);let m=ZJ(Fu(e),n==="start",s);return h&&(m=m.map(_=>_+"-"+h),t&&(m=m.concat(m.map(fP)))),m}function J1(e){return e.replace(/left|right|bottom|top/g,t=>VJ[t])}function KJ(e){return{top:0,right:0,bottom:0,left:0,...e}}function j4(e){return typeof e!="number"?KJ(e):{top:e,right:e,bottom:e,left:e}}function Q1(e){const{x:t,y:n,width:s,height:h}=e;return{width:s,height:h,top:n,left:t,right:t+s,bottom:n+h,x:t,y:n}}function ML(e,t,n){let{reference:s,floating:h}=e;const m=zc(t),_=GI(t),i=UI(_),S=Fu(t),A=m==="y",I=s.x+s.width/2-h.width/2,M=s.y+s.height/2-h.height/2,L=s[i]/2-h[i]/2;let z;switch(S){case"top":z={x:I,y:s.y-h.height};break;case"bottom":z={x:I,y:s.y+s.height};break;case"right":z={x:s.x+s.width,y:M};break;case"left":z={x:s.x-h.width,y:M};break;default:z={x:s.x,y:s.y}}switch(Bg(t)){case"start":z[_]-=L*(n&&A?-1:1);break;case"end":z[_]+=L*(n&&A?-1:1);break}return z}const YJ=async(e,t,n)=>{const{placement:s="bottom",strategy:h="absolute",middleware:m=[],platform:_}=n,i=m.filter(Boolean),S=await(_.isRTL==null?void 0:_.isRTL(t));let A=await _.getElementRects({reference:e,floating:t,strategy:h}),{x:I,y:M}=ML(A,s,S),L=s,z={},G=0;for(let F=0;F<i.length;F++){const{name:U,fn:K}=i[F],{x:J,y:X,data:ie,reset:Q}=await K({x:I,y:M,initialPlacement:s,placement:L,strategy:h,middlewareData:z,rects:A,platform:_,elements:{reference:e,floating:t}});I=J??I,M=X??M,z={...z,[U]:{...z[U],...ie}},Q&&G<=50&&(G++,typeof Q=="object"&&(Q.placement&&(L=Q.placement),Q.rects&&(A=Q.rects===!0?await _.getElementRects({reference:e,floating:t,strategy:h}):Q.rects),{x:I,y:M}=ML(A,L,S)),F=-1)}return{x:I,y:M,placement:L,strategy:h,middlewareData:z}};async function Nv(e,t){var n;t===void 0&&(t={});const{x:s,y:h,platform:m,rects:_,elements:i,strategy:S}=e,{boundary:A="clippingAncestors",rootBoundary:I="viewport",elementContext:M="floating",altBoundary:L=!1,padding:z=0}=zu(t,e),G=j4(z),U=i[L?M==="floating"?"reference":"floating":M],K=Q1(await m.getClippingRect({element:(n=await(m.isElement==null?void 0:m.isElement(U)))==null||n?U:U.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(i.floating)),boundary:A,rootBoundary:I,strategy:S})),J=M==="floating"?{x:s,y:h,width:_.floating.width,height:_.floating.height}:_.reference,X=await(m.getOffsetParent==null?void 0:m.getOffsetParent(i.floating)),ie=await(m.isElement==null?void 0:m.isElement(X))?await(m.getScale==null?void 0:m.getScale(X))||{x:1,y:1}:{x:1,y:1},Q=Q1(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:J,offsetParent:X,strategy:S}):J);return{top:(K.top-Q.top+G.top)/ie.y,bottom:(Q.bottom-K.bottom+G.bottom)/ie.y,left:(K.left-Q.left+G.left)/ie.x,right:(Q.right-K.right+G.right)/ie.x}}const JJ=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:s,placement:h,rects:m,platform:_,elements:i,middlewareData:S}=t,{element:A,padding:I=0}=zu(e,t)||{};if(A==null)return{};const M=j4(I),L={x:n,y:s},z=GI(h),G=UI(z),F=await _.getDimensions(A),U=z==="y",K=U?"top":"left",J=U?"bottom":"right",X=U?"clientHeight":"clientWidth",ie=m.reference[G]+m.reference[z]-L[z]-m.floating[G],Q=L[z]-m.reference[z],ae=await(_.getOffsetParent==null?void 0:_.getOffsetParent(A));let pe=ae?ae[X]:0;(!pe||!await(_.isElement==null?void 0:_.isElement(ae)))&&(pe=i.floating[X]||m.floating[G]);const Pe=ie/2-Q/2,Fe=pe/2-F[G]/2-1,tt=qh(M[K],Fe),Be=qh(M[J],Fe),Ge=tt,Qe=pe-F[G]-Be,Ke=pe/2-F[G]/2+Pe,ct=dP(Ge,Ke,Qe),He=!S.arrow&&Bg(h)!=null&&Ke!==ct&&m.reference[G]/2-(Ke<Ge?tt:Be)-F[G]/2<0,qe=He?Ke<Ge?Ke-Ge:Ke-Qe:0;return{[z]:L[z]+qe,data:{[z]:ct,centerOffset:Ke-ct-qe,...He&&{alignmentOffset:qe}},reset:He}}}),QJ=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,s;const{placement:h,middlewareData:m,rects:_,initialPlacement:i,platform:S,elements:A}=t,{mainAxis:I=!0,crossAxis:M=!0,fallbackPlacements:L,fallbackStrategy:z="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:F=!0,...U}=zu(e,t);if((n=m.arrow)!=null&&n.alignmentOffset)return{};const K=Fu(h),J=zc(i),X=Fu(i)===i,ie=await(S.isRTL==null?void 0:S.isRTL(A.floating)),Q=L||(X||!F?[J1(i)]:HJ(i)),ae=G!=="none";!L&&ae&&Q.push(...XJ(i,F,G,ie));const pe=[i,...Q],Pe=await Nv(t,U),Fe=[];let tt=((s=m.flip)==null?void 0:s.overflows)||[];if(I&&Fe.push(Pe[K]),M){const Ke=GJ(h,_,ie);Fe.push(Pe[Ke[0]],Pe[Ke[1]])}if(tt=[...tt,{placement:h,overflows:Fe}],!Fe.every(Ke=>Ke<=0)){var Be,Ge;const Ke=(((Be=m.flip)==null?void 0:Be.index)||0)+1,ct=pe[Ke];if(ct&&(!(M==="alignment"?J!==zc(ct):!1)||tt.every(ut=>ut.overflows[0]>0&&zc(ut.placement)===J)))return{data:{index:Ke,overflows:tt},reset:{placement:ct}};let He=(Ge=tt.filter(qe=>qe.overflows[0]<=0).sort((qe,ut)=>qe.overflows[1]-ut.overflows[1])[0])==null?void 0:Ge.placement;if(!He)switch(z){case"bestFit":{var Qe;const qe=(Qe=tt.filter(ut=>{if(ae){const nt=zc(ut.placement);return nt===J||nt==="y"}return!0}).map(ut=>[ut.placement,ut.overflows.filter(nt=>nt>0).reduce((nt,Kt)=>nt+Kt,0)]).sort((ut,nt)=>ut[1]-nt[1])[0])==null?void 0:Qe[0];qe&&(He=qe);break}case"initialPlacement":He=i;break}if(h!==He)return{reset:{placement:He}}}return{}}}};function OL(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function RL(e){return BJ.some(t=>e[t]>=0)}const eQ=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:s="referenceHidden",...h}=zu(e,t);switch(s){case"referenceHidden":{const m=await Nv(t,{...h,elementContext:"reference"}),_=OL(m,n.reference);return{data:{referenceHiddenOffsets:_,referenceHidden:RL(_)}}}case"escaped":{const m=await Nv(t,{...h,altBoundary:!0}),_=OL(m,n.floating);return{data:{escapedOffsets:_,escaped:RL(_)}}}default:return{}}}}},L4=new Set(["left","top"]);async function tQ(e,t){const{placement:n,platform:s,elements:h}=e,m=await(s.isRTL==null?void 0:s.isRTL(h.floating)),_=Fu(n),i=Bg(n),S=zc(n)==="y",A=L4.has(_)?-1:1,I=m&&S?-1:1,M=zu(t,e);let{mainAxis:L,crossAxis:z,alignmentAxis:G}=typeof M=="number"?{mainAxis:M,crossAxis:0,alignmentAxis:null}:{mainAxis:M.mainAxis||0,crossAxis:M.crossAxis||0,alignmentAxis:M.alignmentAxis};return i&&typeof G=="number"&&(z=i==="end"?G*-1:G),S?{x:z*I,y:L*A}:{x:L*A,y:z*I}}const rQ=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,s;const{x:h,y:m,placement:_,middlewareData:i}=t,S=await tQ(t,e);return _===((n=i.offset)==null?void 0:n.placement)&&(s=i.arrow)!=null&&s.alignmentOffset?{}:{x:h+S.x,y:m+S.y,data:{...S,placement:_}}}}},nQ=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:s,placement:h}=t,{mainAxis:m=!0,crossAxis:_=!1,limiter:i={fn:U=>{let{x:K,y:J}=U;return{x:K,y:J}}},...S}=zu(e,t),A={x:n,y:s},I=await Nv(t,S),M=zc(Fu(h)),L=$I(M);let z=A[L],G=A[M];if(m){const U=L==="y"?"top":"left",K=L==="y"?"bottom":"right",J=z+I[U],X=z-I[K];z=dP(J,z,X)}if(_){const U=M==="y"?"top":"left",K=M==="y"?"bottom":"right",J=G+I[U],X=G-I[K];G=dP(J,G,X)}const F=i.fn({...t,[L]:z,[M]:G});return{...F,data:{x:F.x-n,y:F.y-s,enabled:{[L]:m,[M]:_}}}}}},iQ=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:s,placement:h,rects:m,middlewareData:_}=t,{offset:i=0,mainAxis:S=!0,crossAxis:A=!0}=zu(e,t),I={x:n,y:s},M=zc(h),L=$I(M);let z=I[L],G=I[M];const F=zu(i,t),U=typeof F=="number"?{mainAxis:F,crossAxis:0}:{mainAxis:0,crossAxis:0,...F};if(S){const X=L==="y"?"height":"width",ie=m.reference[L]-m.floating[X]+U.mainAxis,Q=m.reference[L]+m.reference[X]-U.mainAxis;z<ie?z=ie:z>Q&&(z=Q)}if(A){var K,J;const X=L==="y"?"width":"height",ie=L4.has(Fu(h)),Q=m.reference[M]-m.floating[X]+(ie&&((K=_.offset)==null?void 0:K[M])||0)+(ie?0:U.crossAxis),ae=m.reference[M]+m.reference[X]+(ie?0:((J=_.offset)==null?void 0:J[M])||0)-(ie?U.crossAxis:0);G<Q?G=Q:G>ae&&(G=ae)}return{[L]:z,[M]:G}}}},oQ=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,s;const{placement:h,rects:m,platform:_,elements:i}=t,{apply:S=()=>{},...A}=zu(e,t),I=await Nv(t,A),M=Fu(h),L=Bg(h),z=zc(h)==="y",{width:G,height:F}=m.floating;let U,K;M==="top"||M==="bottom"?(U=M,K=L===(await(_.isRTL==null?void 0:_.isRTL(i.floating))?"start":"end")?"left":"right"):(K=M,U=L==="end"?"top":"bottom");const J=F-I.top-I.bottom,X=G-I.left-I.right,ie=qh(F-I[U],J),Q=qh(G-I[K],X),ae=!t.middlewareData.shift;let pe=ie,Pe=Q;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(Pe=X),(s=t.middlewareData.shift)!=null&&s.enabled.y&&(pe=J),ae&&!L){const tt=za(I.left,0),Be=za(I.right,0),Ge=za(I.top,0),Qe=za(I.bottom,0);z?Pe=G-2*(tt!==0||Be!==0?tt+Be:za(I.left,I.right)):pe=F-2*(Ge!==0||Qe!==0?Ge+Qe:za(I.top,I.bottom))}await S({...t,availableWidth:Pe,availableHeight:pe});const Fe=await _.getDimensions(i.floating);return G!==Fe.width||F!==Fe.height?{reset:{rects:!0}}:{}}}};function ET(){return typeof window<"u"}function Vg(e){return N4(e)?(e.nodeName||"").toLowerCase():"#document"}function Ba(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Jc(e){var t;return(t=(N4(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function N4(e){return ET()?e instanceof Node||e instanceof Ba(e).Node:!1}function sc(e){return ET()?e instanceof Element||e instanceof Ba(e).Element:!1}function Zc(e){return ET()?e instanceof HTMLElement||e instanceof Ba(e).HTMLElement:!1}function DL(e){return!ET()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ba(e).ShadowRoot}const sQ=new Set(["inline","contents"]);function L0(e){const{overflow:t,overflowX:n,overflowY:s,display:h}=ac(e);return/auto|scroll|overlay|hidden|clip/.test(t+s+n)&&!sQ.has(h)}const aQ=new Set(["table","td","th"]);function lQ(e){return aQ.has(Vg(e))}const cQ=[":popover-open",":modal"];function AT(e){return cQ.some(t=>{try{return e.matches(t)}catch{return!1}})}const uQ=["transform","translate","scale","rotate","perspective"],hQ=["transform","translate","scale","rotate","perspective","filter"],dQ=["paint","layout","strict","content"];function HI(e){const t=WI(),n=sc(e)?ac(e):e;return uQ.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||hQ.some(s=>(n.willChange||"").includes(s))||dQ.some(s=>(n.contain||"").includes(s))}function fQ(e){let t=Zh(e);for(;Zc(t)&&!og(t);){if(HI(t))return t;if(AT(t))return null;t=Zh(t)}return null}function WI(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const pQ=new Set(["html","body","#document"]);function og(e){return pQ.has(Vg(e))}function ac(e){return Ba(e).getComputedStyle(e)}function PT(e){return sc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Zh(e){if(Vg(e)==="html")return e;const t=e.assignedSlot||e.parentNode||DL(e)&&e.host||Jc(e);return DL(t)?t.host:t}function z4(e){const t=Zh(e);return og(t)?e.ownerDocument?e.ownerDocument.body:e.body:Zc(t)&&L0(t)?t:z4(t)}function zv(e,t,n){var s;t===void 0&&(t=[]),n===void 0&&(n=!0);const h=z4(e),m=h===((s=e.ownerDocument)==null?void 0:s.body),_=Ba(h);if(m){const i=pP(_);return t.concat(_,_.visualViewport||[],L0(h)?h:[],i&&n?zv(i):[])}return t.concat(h,zv(h,[],n))}function pP(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function F4(e){const t=ac(e);let n=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const h=Zc(e),m=h?e.offsetWidth:n,_=h?e.offsetHeight:s,i=Y1(n)!==m||Y1(s)!==_;return i&&(n=m,s=_),{width:n,height:s,$:i}}function qI(e){return sc(e)?e:e.contextElement}function Zm(e){const t=qI(e);if(!Zc(t))return $c(1);const n=t.getBoundingClientRect(),{width:s,height:h,$:m}=F4(t);let _=(m?Y1(n.width):n.width)/s,i=(m?Y1(n.height):n.height)/h;return(!_||!Number.isFinite(_))&&(_=1),(!i||!Number.isFinite(i))&&(i=1),{x:_,y:i}}const mQ=$c(0);function B4(e){const t=Ba(e);return!WI()||!t.visualViewport?mQ:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function gQ(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Ba(e)?!1:t}function Tf(e,t,n,s){t===void 0&&(t=!1),n===void 0&&(n=!1);const h=e.getBoundingClientRect(),m=qI(e);let _=$c(1);t&&(s?sc(s)&&(_=Zm(s)):_=Zm(e));const i=gQ(m,n,s)?B4(m):$c(0);let S=(h.left+i.x)/_.x,A=(h.top+i.y)/_.y,I=h.width/_.x,M=h.height/_.y;if(m){const L=Ba(m),z=s&&sc(s)?Ba(s):s;let G=L,F=pP(G);for(;F&&s&&z!==G;){const U=Zm(F),K=F.getBoundingClientRect(),J=ac(F),X=K.left+(F.clientLeft+parseFloat(J.paddingLeft))*U.x,ie=K.top+(F.clientTop+parseFloat(J.paddingTop))*U.y;S*=U.x,A*=U.y,I*=U.x,M*=U.y,S+=X,A+=ie,G=Ba(F),F=pP(G)}}return Q1({width:I,height:M,x:S,y:A})}function ZI(e,t){const n=PT(e).scrollLeft;return t?t.left+n:Tf(Jc(e)).left+n}function V4(e,t,n){n===void 0&&(n=!1);const s=e.getBoundingClientRect(),h=s.left+t.scrollLeft-(n?0:ZI(e,s)),m=s.top+t.scrollTop;return{x:h,y:m}}function yQ(e){let{elements:t,rect:n,offsetParent:s,strategy:h}=e;const m=h==="fixed",_=Jc(s),i=t?AT(t.floating):!1;if(s===_||i&&m)return n;let S={scrollLeft:0,scrollTop:0},A=$c(1);const I=$c(0),M=Zc(s);if((M||!M&&!m)&&((Vg(s)!=="body"||L0(_))&&(S=PT(s)),Zc(s))){const z=Tf(s);A=Zm(s),I.x=z.x+s.clientLeft,I.y=z.y+s.clientTop}const L=_&&!M&&!m?V4(_,S,!0):$c(0);return{width:n.width*A.x,height:n.height*A.y,x:n.x*A.x-S.scrollLeft*A.x+I.x+L.x,y:n.y*A.y-S.scrollTop*A.y+I.y+L.y}}function _Q(e){return Array.from(e.getClientRects())}function vQ(e){const t=Jc(e),n=PT(e),s=e.ownerDocument.body,h=za(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),m=za(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let _=-n.scrollLeft+ZI(e);const i=-n.scrollTop;return ac(s).direction==="rtl"&&(_+=za(t.clientWidth,s.clientWidth)-h),{width:h,height:m,x:_,y:i}}function xQ(e,t){const n=Ba(e),s=Jc(e),h=n.visualViewport;let m=s.clientWidth,_=s.clientHeight,i=0,S=0;if(h){m=h.width,_=h.height;const A=WI();(!A||A&&t==="fixed")&&(i=h.offsetLeft,S=h.offsetTop)}return{width:m,height:_,x:i,y:S}}const bQ=new Set(["absolute","fixed"]);function wQ(e,t){const n=Tf(e,!0,t==="fixed"),s=n.top+e.clientTop,h=n.left+e.clientLeft,m=Zc(e)?Zm(e):$c(1),_=e.clientWidth*m.x,i=e.clientHeight*m.y,S=h*m.x,A=s*m.y;return{width:_,height:i,x:S,y:A}}function kL(e,t,n){let s;if(t==="viewport")s=xQ(e,n);else if(t==="document")s=vQ(Jc(e));else if(sc(t))s=wQ(t,n);else{const h=B4(e);s={x:t.x-h.x,y:t.y-h.y,width:t.width,height:t.height}}return Q1(s)}function $4(e,t){const n=Zh(e);return n===t||!sc(n)||og(n)?!1:ac(n).position==="fixed"||$4(n,t)}function TQ(e,t){const n=t.get(e);if(n)return n;let s=zv(e,[],!1).filter(i=>sc(i)&&Vg(i)!=="body"),h=null;const m=ac(e).position==="fixed";let _=m?Zh(e):e;for(;sc(_)&&!og(_);){const i=ac(_),S=HI(_);!S&&i.position==="fixed"&&(h=null),(m?!S&&!h:!S&&i.position==="static"&&!!h&&bQ.has(h.position)||L0(_)&&!S&&$4(e,_))?s=s.filter(I=>I!==_):h=i,_=Zh(_)}return t.set(e,s),s}function SQ(e){let{element:t,boundary:n,rootBoundary:s,strategy:h}=e;const _=[...n==="clippingAncestors"?AT(t)?[]:TQ(t,this._c):[].concat(n),s],i=_[0],S=_.reduce((A,I)=>{const M=kL(t,I,h);return A.top=za(M.top,A.top),A.right=qh(M.right,A.right),A.bottom=qh(M.bottom,A.bottom),A.left=za(M.left,A.left),A},kL(t,i,h));return{width:S.right-S.left,height:S.bottom-S.top,x:S.left,y:S.top}}function EQ(e){const{width:t,height:n}=F4(e);return{width:t,height:n}}function AQ(e,t,n){const s=Zc(t),h=Jc(t),m=n==="fixed",_=Tf(e,!0,m,t);let i={scrollLeft:0,scrollTop:0};const S=$c(0);function A(){S.x=ZI(h)}if(s||!s&&!m)if((Vg(t)!=="body"||L0(h))&&(i=PT(t)),s){const z=Tf(t,!0,m,t);S.x=z.x+t.clientLeft,S.y=z.y+t.clientTop}else h&&A();m&&!s&&h&&A();const I=h&&!s&&!m?V4(h,i):$c(0),M=_.left+i.scrollLeft-S.x-I.x,L=_.top+i.scrollTop-S.y-I.y;return{x:M,y:L,width:_.width,height:_.height}}function KE(e){return ac(e).position==="static"}function jL(e,t){if(!Zc(e)||ac(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Jc(e)===n&&(n=n.ownerDocument.body),n}function U4(e,t){const n=Ba(e);if(AT(e))return n;if(!Zc(e)){let h=Zh(e);for(;h&&!og(h);){if(sc(h)&&!KE(h))return h;h=Zh(h)}return n}let s=jL(e,t);for(;s&&lQ(s)&&KE(s);)s=jL(s,t);return s&&og(s)&&KE(s)&&!HI(s)?n:s||fQ(e)||n}const PQ=async function(e){const t=this.getOffsetParent||U4,n=this.getDimensions,s=await n(e.floating);return{reference:AQ(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function CQ(e){return ac(e).direction==="rtl"}const IQ={convertOffsetParentRelativeRectToViewportRelativeRect:yQ,getDocumentElement:Jc,getClippingRect:SQ,getOffsetParent:U4,getElementRects:PQ,getClientRects:_Q,getDimensions:EQ,getScale:Zm,isElement:sc,isRTL:CQ};function G4(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function MQ(e,t){let n=null,s;const h=Jc(e);function m(){var i;clearTimeout(s),(i=n)==null||i.disconnect(),n=null}function _(i,S){i===void 0&&(i=!1),S===void 0&&(S=1),m();const A=e.getBoundingClientRect(),{left:I,top:M,width:L,height:z}=A;if(i||t(),!L||!z)return;const G=i1(M),F=i1(h.clientWidth-(I+L)),U=i1(h.clientHeight-(M+z)),K=i1(I),X={rootMargin:-G+"px "+-F+"px "+-U+"px "+-K+"px",threshold:za(0,qh(1,S))||1};let ie=!0;function Q(ae){const pe=ae[0].intersectionRatio;if(pe!==S){if(!ie)return _();pe?_(!1,pe):s=setTimeout(()=>{_(!1,1e-7)},1e3)}pe===1&&!G4(A,e.getBoundingClientRect())&&_(),ie=!1}try{n=new IntersectionObserver(Q,{...X,root:h.ownerDocument})}catch{n=new IntersectionObserver(Q,X)}n.observe(e)}return _(!0),m}function OQ(e,t,n,s){s===void 0&&(s={});const{ancestorScroll:h=!0,ancestorResize:m=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:S=!1}=s,A=qI(e),I=h||m?[...A?zv(A):[],...zv(t)]:[];I.forEach(K=>{h&&K.addEventListener("scroll",n,{passive:!0}),m&&K.addEventListener("resize",n)});const M=A&&i?MQ(A,n):null;let L=-1,z=null;_&&(z=new ResizeObserver(K=>{let[J]=K;J&&J.target===A&&z&&(z.unobserve(t),cancelAnimationFrame(L),L=requestAnimationFrame(()=>{var X;(X=z)==null||X.observe(t)})),n()}),A&&!S&&z.observe(A),z.observe(t));let G,F=S?Tf(e):null;S&&U();function U(){const K=Tf(e);F&&!G4(F,K)&&n(),F=K,G=requestAnimationFrame(U)}return n(),()=>{var K;I.forEach(J=>{h&&J.removeEventListener("scroll",n),m&&J.removeEventListener("resize",n)}),M?.(),(K=z)==null||K.disconnect(),z=null,S&&cancelAnimationFrame(G)}}const RQ=rQ,DQ=nQ,kQ=QJ,jQ=oQ,LQ=eQ,LL=JJ,NQ=iQ,zQ=(e,t,n)=>{const s=new Map,h={platform:IQ,...n},m={...h.platform,_c:s};return YJ(e,t,{...h,platform:m})};var FQ=typeof document<"u",BQ=function(){},j1=FQ?B.useLayoutEffect:BQ;function ew(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,s,h;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(s=n;s--!==0;)if(!ew(e[s],t[s]))return!1;return!0}if(h=Object.keys(e),n=h.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(t,h[s]))return!1;for(s=n;s--!==0;){const m=h[s];if(!(m==="_owner"&&e.$$typeof)&&!ew(e[m],t[m]))return!1}return!0}return e!==e&&t!==t}function H4(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function NL(e,t){const n=H4(e);return Math.round(t*n)/n}function YE(e){const t=B.useRef(e);return j1(()=>{t.current=e}),t}function VQ(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:s=[],platform:h,elements:{reference:m,floating:_}={},transform:i=!0,whileElementsMounted:S,open:A}=e,[I,M]=B.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[L,z]=B.useState(s);ew(L,s)||z(s);const[G,F]=B.useState(null),[U,K]=B.useState(null),J=B.useCallback(ut=>{ut!==ae.current&&(ae.current=ut,F(ut))},[]),X=B.useCallback(ut=>{ut!==pe.current&&(pe.current=ut,K(ut))},[]),ie=m||G,Q=_||U,ae=B.useRef(null),pe=B.useRef(null),Pe=B.useRef(I),Fe=S!=null,tt=YE(S),Be=YE(h),Ge=YE(A),Qe=B.useCallback(()=>{if(!ae.current||!pe.current)return;const ut={placement:t,strategy:n,middleware:L};Be.current&&(ut.platform=Be.current),zQ(ae.current,pe.current,ut).then(nt=>{const Kt={...nt,isPositioned:Ge.current!==!1};Ke.current&&!ew(Pe.current,Kt)&&(Pe.current=Kt,Ng.flushSync(()=>{M(Kt)}))})},[L,t,n,Be,Ge]);j1(()=>{A===!1&&Pe.current.isPositioned&&(Pe.current.isPositioned=!1,M(ut=>({...ut,isPositioned:!1})))},[A]);const Ke=B.useRef(!1);j1(()=>(Ke.current=!0,()=>{Ke.current=!1}),[]),j1(()=>{if(ie&&(ae.current=ie),Q&&(pe.current=Q),ie&&Q){if(tt.current)return tt.current(ie,Q,Qe);Qe()}},[ie,Q,Qe,tt,Fe]);const ct=B.useMemo(()=>({reference:ae,floating:pe,setReference:J,setFloating:X}),[J,X]),He=B.useMemo(()=>({reference:ie,floating:Q}),[ie,Q]),qe=B.useMemo(()=>{const ut={position:n,left:0,top:0};if(!He.floating)return ut;const nt=NL(He.floating,I.x),Kt=NL(He.floating,I.y);return i?{...ut,transform:"translate("+nt+"px, "+Kt+"px)",...H4(He.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:nt,top:Kt}},[n,i,He.floating,I.x,I.y]);return B.useMemo(()=>({...I,update:Qe,refs:ct,elements:He,floatingStyles:qe}),[I,Qe,ct,He,qe])}const $Q=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:s,padding:h}=typeof e=="function"?e(n):e;return s&&t(s)?s.current!=null?LL({element:s.current,padding:h}).fn(n):{}:s?LL({element:s,padding:h}).fn(n):{}}}},UQ=(e,t)=>({...RQ(e),options:[e,t]}),GQ=(e,t)=>({...DQ(e),options:[e,t]}),HQ=(e,t)=>({...NQ(e),options:[e,t]}),WQ=(e,t)=>({...kQ(e),options:[e,t]}),qQ=(e,t)=>({...jQ(e),options:[e,t]}),ZQ=(e,t)=>({...LQ(e),options:[e,t]}),XQ=(e,t)=>({...$Q(e),options:[e,t]});var KQ="Arrow",W4=B.forwardRef((e,t)=>{const{children:n,width:s=10,height:h=5,...m}=e;return b.jsx(En.svg,{...m,ref:t,width:s,height:h,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:b.jsx("polygon",{points:"0,0 30,0 15,10"})})});W4.displayName=KQ;var YQ=W4;function XI(e){const[t,n]=B.useState(void 0);return Ds(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const s=new ResizeObserver(h=>{if(!Array.isArray(h)||!h.length)return;const m=h[0];let _,i;if("borderBoxSize"in m){const S=m.borderBoxSize,A=Array.isArray(S)?S[0]:S;_=A.inlineSize,i=A.blockSize}else _=e.offsetWidth,i=e.offsetHeight;n({width:_,height:i})});return s.observe(e,{box:"border-box"}),()=>s.unobserve(e)}else n(void 0)},[e]),t}var KI="Popper",[q4,$g]=cc(KI),[JQ,Z4]=q4(KI),X4=e=>{const{__scopePopper:t,children:n}=e,[s,h]=B.useState(null);return b.jsx(JQ,{scope:t,anchor:s,onAnchorChange:h,children:n})};X4.displayName=KI;var K4="PopperAnchor",Y4=B.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:s,...h}=e,m=Z4(K4,n),_=B.useRef(null),i=li(t,_);return B.useEffect(()=>{m.onAnchorChange(s?.current||_.current)}),s?null:b.jsx(En.div,{...h,ref:i})});Y4.displayName=K4;var YI="PopperContent",[QQ,eee]=q4(YI),J4=B.forwardRef((e,t)=>{const{__scopePopper:n,side:s="bottom",sideOffset:h=0,align:m="center",alignOffset:_=0,arrowPadding:i=0,avoidCollisions:S=!0,collisionBoundary:A=[],collisionPadding:I=0,sticky:M="partial",hideWhenDetached:L=!1,updatePositionStrategy:z="optimized",onPlaced:G,...F}=e,U=Z4(YI,n),[K,J]=B.useState(null),X=li(t,lr=>J(lr)),[ie,Q]=B.useState(null),ae=XI(ie),pe=ae?.width??0,Pe=ae?.height??0,Fe=s+(m!=="center"?"-"+m:""),tt=typeof I=="number"?I:{top:0,right:0,bottom:0,left:0,...I},Be=Array.isArray(A)?A:[A],Ge=Be.length>0,Qe={padding:tt,boundary:Be.filter(ree),altBoundary:Ge},{refs:Ke,floatingStyles:ct,placement:He,isPositioned:qe,middlewareData:ut}=VQ({strategy:"fixed",placement:Fe,whileElementsMounted:(...lr)=>OQ(...lr,{animationFrame:z==="always"}),elements:{reference:U.anchor},middleware:[UQ({mainAxis:h+Pe,alignmentAxis:_}),S&&GQ({mainAxis:!0,crossAxis:!1,limiter:M==="partial"?HQ():void 0,...Qe}),S&&WQ({...Qe}),qQ({...Qe,apply:({elements:lr,rects:an,availableWidth:Lt,availableHeight:nr})=>{const{width:pr,height:Nt}=an.reference,Nr=lr.floating.style;Nr.setProperty("--radix-popper-available-width",`${Lt}px`),Nr.setProperty("--radix-popper-available-height",`${nr}px`),Nr.setProperty("--radix-popper-anchor-width",`${pr}px`),Nr.setProperty("--radix-popper-anchor-height",`${Nt}px`)}}),ie&&XQ({element:ie,padding:i}),nee({arrowWidth:pe,arrowHeight:Pe}),L&&ZQ({strategy:"referenceHidden",...Qe})]}),[nt,Kt]=tV(He),cr=va(G);Ds(()=>{qe&&cr?.()},[qe,cr]);const Bt=ut.arrow?.x,Vt=ut.arrow?.y,xr=ut.arrow?.centerOffset!==0,[nn,Hn]=B.useState();return Ds(()=>{K&&Hn(window.getComputedStyle(K).zIndex)},[K]),b.jsx("div",{ref:Ke.setFloating,"data-radix-popper-content-wrapper":"",style:{...ct,transform:qe?ct.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:nn,"--radix-popper-transform-origin":[ut.transformOrigin?.x,ut.transformOrigin?.y].join(" "),...ut.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:b.jsx(QQ,{scope:n,placedSide:nt,onArrowChange:Q,arrowX:Bt,arrowY:Vt,shouldHideArrow:xr,children:b.jsx(En.div,{"data-side":nt,"data-align":Kt,...F,ref:X,style:{...F.style,animation:qe?void 0:"none"}})})})});J4.displayName=YI;var Q4="PopperArrow",tee={top:"bottom",right:"left",bottom:"top",left:"right"},eV=B.forwardRef(function(t,n){const{__scopePopper:s,...h}=t,m=eee(Q4,s),_=tee[m.placedSide];return b.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[_]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:b.jsx(YQ,{...h,ref:n,style:{...h.style,display:"block"}})})});eV.displayName=Q4;function ree(e){return e!==null}var nee=e=>({name:"transformOrigin",options:e,fn(t){const{placement:n,rects:s,middlewareData:h}=t,_=h.arrow?.centerOffset!==0,i=_?0:e.arrowWidth,S=_?0:e.arrowHeight,[A,I]=tV(n),M={start:"0%",center:"50%",end:"100%"}[I],L=(h.arrow?.x??0)+i/2,z=(h.arrow?.y??0)+S/2;let G="",F="";return A==="bottom"?(G=_?M:`${L}px`,F=`${-S}px`):A==="top"?(G=_?M:`${L}px`,F=`${s.floating.height+S}px`):A==="right"?(G=`${-S}px`,F=_?M:`${z}px`):A==="left"&&(G=`${s.floating.width+S}px`,F=_?M:`${z}px`),{data:{x:G,y:F}}}});function tV(e){const[t,n="center"]=e.split("-");return[t,n]}var rV=X4,JI=Y4,QI=J4,eM=eV,[CT,Pze]=cc("Tooltip",[$g]),tM=$g(),nV="TooltipProvider",iee=700,zL="tooltip.open",[oee,iV]=CT(nV),oV=e=>{const{__scopeTooltip:t,delayDuration:n=iee,skipDelayDuration:s=300,disableHoverableContent:h=!1,children:m}=e,_=B.useRef(!0),i=B.useRef(!1),S=B.useRef(0);return B.useEffect(()=>{const A=S.current;return()=>window.clearTimeout(A)},[]),b.jsx(oee,{scope:t,isOpenDelayedRef:_,delayDuration:n,onOpen:B.useCallback(()=>{window.clearTimeout(S.current),_.current=!1},[]),onClose:B.useCallback(()=>{window.clearTimeout(S.current),S.current=window.setTimeout(()=>_.current=!0,s)},[s]),isPointerInTransitRef:i,onPointerInTransitChange:B.useCallback(A=>{i.current=A},[]),disableHoverableContent:h,children:m})};oV.displayName=nV;var sV="Tooltip",[Cze,IT]=CT(sV),mP="TooltipTrigger",see=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...s}=e,h=IT(mP,n),m=iV(mP,n),_=tM(n),i=B.useRef(null),S=li(t,i,h.onTriggerChange),A=B.useRef(!1),I=B.useRef(!1),M=B.useCallback(()=>A.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",M),[M]),b.jsx(JI,{asChild:!0,..._,children:b.jsx(En.button,{"aria-describedby":h.open?h.contentId:void 0,"data-state":h.stateAttribute,...s,ref:S,onPointerMove:Ar(e.onPointerMove,L=>{L.pointerType!=="touch"&&!I.current&&!m.isPointerInTransitRef.current&&(h.onTriggerEnter(),I.current=!0)}),onPointerLeave:Ar(e.onPointerLeave,()=>{h.onTriggerLeave(),I.current=!1}),onPointerDown:Ar(e.onPointerDown,()=>{h.open&&h.onClose(),A.current=!0,document.addEventListener("pointerup",M,{once:!0})}),onFocus:Ar(e.onFocus,()=>{A.current||h.onOpen()}),onBlur:Ar(e.onBlur,h.onClose),onClick:Ar(e.onClick,h.onClose)})})});see.displayName=mP;var aee="TooltipPortal",[Ize,lee]=CT(aee,{forceMount:void 0}),sg="TooltipContent",aV=B.forwardRef((e,t)=>{const n=lee(sg,e.__scopeTooltip),{forceMount:s=n.forceMount,side:h="top",...m}=e,_=IT(sg,e.__scopeTooltip);return b.jsx(uc,{present:s||_.open,children:_.disableHoverableContent?b.jsx(lV,{side:h,...m,ref:t}):b.jsx(cee,{side:h,...m,ref:t})})}),cee=B.forwardRef((e,t)=>{const n=IT(sg,e.__scopeTooltip),s=iV(sg,e.__scopeTooltip),h=B.useRef(null),m=li(t,h),[_,i]=B.useState(null),{trigger:S,onClose:A}=n,I=h.current,{onPointerInTransitChange:M}=s,L=B.useCallback(()=>{i(null),M(!1)},[M]),z=B.useCallback((G,F)=>{const U=G.currentTarget,K={x:G.clientX,y:G.clientY},J=pee(K,U.getBoundingClientRect()),X=mee(K,J),ie=gee(F.getBoundingClientRect()),Q=_ee([...X,...ie]);i(Q),M(!0)},[M]);return B.useEffect(()=>()=>L(),[L]),B.useEffect(()=>{if(S&&I){const G=U=>z(U,I),F=U=>z(U,S);return S.addEventListener("pointerleave",G),I.addEventListener("pointerleave",F),()=>{S.removeEventListener("pointerleave",G),I.removeEventListener("pointerleave",F)}}},[S,I,z,L]),B.useEffect(()=>{if(_){const G=F=>{const U=F.target,K={x:F.clientX,y:F.clientY},J=S?.contains(U)||I?.contains(U),X=!yee(K,_);J?L():X&&(L(),A())};return document.addEventListener("pointermove",G),()=>document.removeEventListener("pointermove",G)}},[S,I,_,A,L]),b.jsx(lV,{...e,ref:m})}),[uee,hee]=CT(sV,{isInside:!1}),dee=nK("TooltipContent"),lV=B.forwardRef((e,t)=>{const{__scopeTooltip:n,children:s,"aria-label":h,onEscapeKeyDown:m,onPointerDownOutside:_,...i}=e,S=IT(sg,n),A=tM(n),{onClose:I}=S;return B.useEffect(()=>(document.addEventListener(zL,I),()=>document.removeEventListener(zL,I)),[I]),B.useEffect(()=>{if(S.trigger){const M=L=>{L.target?.contains(S.trigger)&&I()};return window.addEventListener("scroll",M,{capture:!0}),()=>window.removeEventListener("scroll",M,{capture:!0})}},[S.trigger,I]),b.jsx(zg,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:_,onFocusOutside:M=>M.preventDefault(),onDismiss:I,children:b.jsxs(QI,{"data-state":S.stateAttribute,...A,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[b.jsx(dee,{children:s}),b.jsx(uee,{scope:n,isInside:!0,children:b.jsx(EK,{id:S.contentId,role:"tooltip",children:h||s})})]})})});aV.displayName=sg;var cV="TooltipArrow",fee=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...s}=e,h=tM(n);return hee(cV,n).isInside?null:b.jsx(eM,{...h,...s,ref:t})});fee.displayName=cV;function pee(e,t){const n=Math.abs(t.top-e.y),s=Math.abs(t.bottom-e.y),h=Math.abs(t.right-e.x),m=Math.abs(t.left-e.x);switch(Math.min(n,s,h,m)){case m:return"left";case h:return"right";case n:return"top";case s:return"bottom";default:throw new Error("unreachable")}}function mee(e,t,n=5){const s=[];switch(t){case"top":s.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":s.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":s.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":s.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return s}function gee(e){const{top:t,right:n,bottom:s,left:h}=e;return[{x:h,y:t},{x:n,y:t},{x:n,y:s},{x:h,y:s}]}function yee(e,t){const{x:n,y:s}=e;let h=!1;for(let m=0,_=t.length-1;m<t.length;_=m++){const i=t[m],S=t[_],A=i.x,I=i.y,M=S.x,L=S.y;I>s!=L>s&&n<(M-A)*(s-I)/(L-I)+A&&(h=!h)}return h}function _ee(e){const t=e.slice();return t.sort((n,s)=>n.x<s.x?-1:n.x>s.x?1:n.y<s.y?-1:n.y>s.y?1:0),vee(t)}function vee(e){if(e.length<=1)return e.slice();const t=[];for(let s=0;s<e.length;s++){const h=e[s];for(;t.length>=2;){const m=t[t.length-1],_=t[t.length-2];if((m.x-_.x)*(h.y-_.y)>=(m.y-_.y)*(h.x-_.x))t.pop();else break}t.push(h)}t.pop();const n=[];for(let s=e.length-1;s>=0;s--){const h=e[s];for(;n.length>=2;){const m=n[n.length-1],_=n[n.length-2];if((m.x-_.x)*(h.y-_.y)>=(m.y-_.y)*(h.x-_.x))n.pop();else break}n.push(h)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var xee=oV,uV=aV;const bee=xee,wee=B.forwardRef(({className:e,sideOffset:t=4,...n},s)=>b.jsx(uV,{ref:s,sideOffset:t,className:Wr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));wee.displayName=uV.displayName;function Tee(){const[e,t]=B.useState(0);return B.useEffect(()=>{const n=()=>{const s=window.scrollY||document.documentElement.scrollTop,h=document.documentElement.scrollHeight-document.documentElement.clientHeight,m=h>0?Math.min(100,s/h*100):0;t(m)};return window.addEventListener("scroll",n,{passive:!0}),n(),()=>window.removeEventListener("scroll",n)},[]),b.jsx("div",{"aria-hidden":!0,className:"fixed inset-x-0 top-0 z-[60] h-0 pointer-events-none",children:b.jsx("div",{className:"h-0.5 bg-gradient-to-r from-primary to-secondary origin-left transition-width duration-150",style:{width:`${e}%`}})})}const rM=B.createContext({});function Ug(e){const t=B.useRef(null);return t.current===null&&(t.current=e()),t.current}const nM=typeof window<"u",MT=nM?B.useLayoutEffect:B.useEffect,OT=B.createContext(null);function iM(e,t){e.indexOf(t)===-1&&e.push(t)}function oM(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Xc=(e,t,n)=>n>t?t:n<e?e:n;let ag=()=>{};const Bu={},hV=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function dV(e){return typeof e=="object"&&e!==null}const fV=e=>/^0[^.\s]+$/u.test(e);function sM(e){let t;return()=>(t===void 0&&(t=e()),t)}const _a=e=>e,See=(e,t)=>n=>t(e(n)),N0=(...e)=>e.reduce(See),lg=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s};class aM{constructor(){this.subscriptions=[]}add(t){return iM(this.subscriptions,t),()=>oM(this.subscriptions,t)}notify(t,n,s){const h=this.subscriptions.length;if(h)if(h===1)this.subscriptions[0](t,n,s);else for(let m=0;m<h;m++){const _=this.subscriptions[m];_&&_(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Uc=e=>e*1e3,dl=e=>e/1e3;function lM(e,t){return t?e*(1e3/t):0}const pV=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Eee=1e-7,Aee=12;function Pee(e,t,n,s,h){let m,_,i=0;do _=t+(n-t)/2,m=pV(_,s,h)-e,m>0?n=_:t=_;while(Math.abs(m)>Eee&&++i<Aee);return _}function z0(e,t,n,s){if(e===t&&n===s)return _a;const h=m=>Pee(m,0,1,e,n);return m=>m===0||m===1?m:pV(h(m),t,s)}const mV=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gV=e=>t=>1-e(1-t),yV=z0(.33,1.53,.69,.99),cM=gV(yV),_V=mV(cM),vV=e=>(e*=2)<1?.5*cM(e):.5*(2-Math.pow(2,-10*(e-1))),uM=e=>1-Math.sin(Math.acos(e)),xV=gV(uM),bV=mV(uM),Cee=z0(.42,0,1,1),Iee=z0(0,0,.58,1),wV=z0(.42,0,.58,1),Mee=e=>Array.isArray(e)&&typeof e[0]!="number",TV=e=>Array.isArray(e)&&typeof e[0]=="number",FL={linear:_a,easeIn:Cee,easeInOut:wV,easeOut:Iee,circIn:uM,circInOut:bV,circOut:xV,backIn:cM,backInOut:_V,backOut:yV,anticipate:vV},Oee=e=>typeof e=="string",BL=e=>{if(TV(e)){ag(e.length===4);const[t,n,s,h]=e;return z0(t,n,s,h)}else if(Oee(e))return ag(FL[e]!==void 0),FL[e];return e},o1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],VL={value:null,addProjectionMetrics:null};function Ree(e,t){let n=new Set,s=new Set,h=!1,m=!1;const _=new WeakSet;let i={delta:0,timestamp:0,isProcessing:!1},S=0;function A(M){_.has(M)&&(I.schedule(M),e()),S++,M(i)}const I={schedule:(M,L=!1,z=!1)=>{const F=z&&h?n:s;return L&&_.add(M),F.has(M)||F.add(M),M},cancel:M=>{s.delete(M),_.delete(M)},process:M=>{if(i=M,h){m=!0;return}h=!0,[n,s]=[s,n],n.forEach(A),t&&VL.value&&VL.value.frameloop[t].push(S),S=0,n.clear(),h=!1,m&&(m=!1,I.process(M))}};return I}const Dee=40;function SV(e,t){let n=!1,s=!0;const h={delta:0,timestamp:0,isProcessing:!1},m=()=>n=!0,_=o1.reduce((X,ie)=>(X[ie]=Ree(m,t?ie:void 0),X),{}),{setup:i,read:S,resolveKeyframes:A,preUpdate:I,update:M,preRender:L,render:z,postRender:G}=_,F=()=>{const X=Bu.useManualTiming?h.timestamp:performance.now();n=!1,Bu.useManualTiming||(h.delta=s?1e3/60:Math.max(Math.min(X-h.timestamp,Dee),1)),h.timestamp=X,h.isProcessing=!0,i.process(h),S.process(h),A.process(h),I.process(h),M.process(h),L.process(h),z.process(h),G.process(h),h.isProcessing=!1,n&&t&&(s=!1,e(F))},U=()=>{n=!0,s=!0,h.isProcessing||e(F)};return{schedule:o1.reduce((X,ie)=>{const Q=_[ie];return X[ie]=(ae,pe=!1,Pe=!1)=>(n||U(),Q.schedule(ae,pe,Pe)),X},{}),cancel:X=>{for(let ie=0;ie<o1.length;ie++)_[o1[ie]].cancel(X)},state:h,steps:_}}const{schedule:Ui,cancel:lc,state:xs,steps:JE}=SV(typeof requestAnimationFrame<"u"?requestAnimationFrame:_a,!0);let L1;function kee(){L1=void 0}const ga={now:()=>(L1===void 0&&ga.set(xs.isProcessing||Bu.useManualTiming?xs.timestamp:performance.now()),L1),set:e=>{L1=e,queueMicrotask(kee)}},EV=e=>t=>typeof t=="string"&&t.startsWith(e),AV=EV("--"),jee=EV("var(--"),hM=e=>jee(e)?Lee.test(e.split("/*")[0].trim()):!1,Lee=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Gg={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Fv={...Gg,transform:e=>Xc(0,1,e)},s1={...Gg,default:1},Pv=e=>Math.round(e*1e5)/1e5,dM=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Nee(e){return e==null}const zee=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,fM=(e,t)=>n=>!!(typeof n=="string"&&zee.test(n)&&n.startsWith(e)||t&&!Nee(n)&&Object.prototype.hasOwnProperty.call(n,t)),PV=(e,t,n)=>s=>{if(typeof s!="string")return s;const[h,m,_,i]=s.match(dM);return{[e]:parseFloat(h),[t]:parseFloat(m),[n]:parseFloat(_),alpha:i!==void 0?parseFloat(i):1}},Fee=e=>Xc(0,255,e),QE={...Gg,transform:e=>Math.round(Fee(e))},hf={test:fM("rgb","red"),parse:PV("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+QE.transform(e)+", "+QE.transform(t)+", "+QE.transform(n)+", "+Pv(Fv.transform(s))+")"};function Bee(e){let t="",n="",s="",h="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),h=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),h=e.substring(4,5),t+=t,n+=n,s+=s,h+=h),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:h?parseInt(h,16)/255:1}}const gP={test:fM("#"),parse:Bee,transform:hf.transform},F0=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),kh=F0("deg"),Gc=F0("%"),Nn=F0("px"),Vee=F0("vh"),$ee=F0("vw"),$L={...Gc,parse:e=>Gc.parse(e)/100,transform:e=>Gc.transform(e*100)},zm={test:fM("hsl","hue"),parse:PV("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+Gc.transform(Pv(t))+", "+Gc.transform(Pv(n))+", "+Pv(Fv.transform(s))+")"},Xo={test:e=>hf.test(e)||gP.test(e)||zm.test(e),parse:e=>hf.test(e)?hf.parse(e):zm.test(e)?zm.parse(e):gP.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?hf.transform(e):zm.transform(e),getAnimatableNone:e=>{const t=Xo.parse(e);return t.alpha=0,Xo.transform(t)}},Uee=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Gee(e){return isNaN(e)&&typeof e=="string"&&(e.match(dM)?.length||0)+(e.match(Uee)?.length||0)>0}const CV="number",IV="color",Hee="var",Wee="var(",UL="${}",qee=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Bv(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},h=[];let m=0;const i=t.replace(qee,S=>(Xo.test(S)?(s.color.push(m),h.push(IV),n.push(Xo.parse(S))):S.startsWith(Wee)?(s.var.push(m),h.push(Hee),n.push(S)):(s.number.push(m),h.push(CV),n.push(parseFloat(S))),++m,UL)).split(UL);return{values:n,split:i,indexes:s,types:h}}function MV(e){return Bv(e).values}function OV(e){const{split:t,types:n}=Bv(e),s=t.length;return h=>{let m="";for(let _=0;_<s;_++)if(m+=t[_],h[_]!==void 0){const i=n[_];i===CV?m+=Pv(h[_]):i===IV?m+=Xo.transform(h[_]):m+=h[_]}return m}}const Zee=e=>typeof e=="number"?0:Xo.test(e)?Xo.getAnimatableNone(e):e;function Xee(e){const t=MV(e);return OV(e)(t.map(Zee))}const Xh={test:Gee,parse:MV,createTransformer:OV,getAnimatableNone:Xee};function eA(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Kee({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let h=0,m=0,_=0;if(!t)h=m=_=n;else{const i=n<.5?n*(1+t):n+t-n*t,S=2*n-i;h=eA(S,i,e+1/3),m=eA(S,i,e),_=eA(S,i,e-1/3)}return{red:Math.round(h*255),green:Math.round(m*255),blue:Math.round(_*255),alpha:s}}function tw(e,t){return n=>n>0?t:e}const Ao=(e,t,n)=>e+(t-e)*n,tA=(e,t,n)=>{const s=e*e,h=n*(t*t-s)+s;return h<0?0:Math.sqrt(h)},Yee=[gP,hf,zm],Jee=e=>Yee.find(t=>t.test(e));function GL(e){const t=Jee(e);if(!t)return!1;let n=t.parse(e);return t===zm&&(n=Kee(n)),n}const HL=(e,t)=>{const n=GL(e),s=GL(t);if(!n||!s)return tw(e,t);const h={...n};return m=>(h.red=tA(n.red,s.red,m),h.green=tA(n.green,s.green,m),h.blue=tA(n.blue,s.blue,m),h.alpha=Ao(n.alpha,s.alpha,m),hf.transform(h))},yP=new Set(["none","hidden"]);function Qee(e,t){return yP.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function ete(e,t){return n=>Ao(e,t,n)}function pM(e){return typeof e=="number"?ete:typeof e=="string"?hM(e)?tw:Xo.test(e)?HL:nte:Array.isArray(e)?RV:typeof e=="object"?Xo.test(e)?HL:tte:tw}function RV(e,t){const n=[...e],s=n.length,h=e.map((m,_)=>pM(m)(m,t[_]));return m=>{for(let _=0;_<s;_++)n[_]=h[_](m);return n}}function tte(e,t){const n={...e,...t},s={};for(const h in n)e[h]!==void 0&&t[h]!==void 0&&(s[h]=pM(e[h])(e[h],t[h]));return h=>{for(const m in s)n[m]=s[m](h);return n}}function rte(e,t){const n=[],s={color:0,var:0,number:0};for(let h=0;h<t.values.length;h++){const m=t.types[h],_=e.indexes[m][s[m]],i=e.values[_]??0;n[h]=i,s[m]++}return n}const nte=(e,t)=>{const n=Xh.createTransformer(t),s=Bv(e),h=Bv(t);return s.indexes.var.length===h.indexes.var.length&&s.indexes.color.length===h.indexes.color.length&&s.indexes.number.length>=h.indexes.number.length?yP.has(e)&&!h.values.length||yP.has(t)&&!s.values.length?Qee(e,t):N0(RV(rte(s,h),h.values),n):tw(e,t)};function DV(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Ao(e,t,n):pM(e)(e,t)}const ite=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>Ui.update(t,n),stop:()=>lc(t),now:()=>xs.isProcessing?xs.timestamp:ga.now()}},kV=(e,t,n=10)=>{let s="";const h=Math.max(Math.round(t/n),2);for(let m=0;m<h;m++)s+=Math.round(e(m/(h-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},rw=2e4;function mM(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<rw;)t+=n,s=e.next(t);return t>=rw?1/0:t}function ote(e,t=100,n){const s=n({...e,keyframes:[0,t]}),h=Math.min(mM(s),rw);return{type:"keyframes",ease:m=>s.next(h*m).value/t,duration:dl(h)}}const ste=5;function jV(e,t,n){const s=Math.max(t-ste,0);return lM(n-e(s),t-s)}const Oo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},rA=.001;function ate({duration:e=Oo.duration,bounce:t=Oo.bounce,velocity:n=Oo.velocity,mass:s=Oo.mass}){let h,m,_=1-t;_=Xc(Oo.minDamping,Oo.maxDamping,_),e=Xc(Oo.minDuration,Oo.maxDuration,dl(e)),_<1?(h=A=>{const I=A*_,M=I*e,L=I-n,z=_P(A,_),G=Math.exp(-M);return rA-L/z*G},m=A=>{const M=A*_*e,L=M*n+n,z=Math.pow(_,2)*Math.pow(A,2)*e,G=Math.exp(-M),F=_P(Math.pow(A,2),_);return(-h(A)+rA>0?-1:1)*((L-z)*G)/F}):(h=A=>{const I=Math.exp(-A*e),M=(A-n)*e+1;return-rA+I*M},m=A=>{const I=Math.exp(-A*e),M=(n-A)*(e*e);return I*M});const i=5/e,S=cte(h,m,i);if(e=Uc(e),isNaN(S))return{stiffness:Oo.stiffness,damping:Oo.damping,duration:e};{const A=Math.pow(S,2)*s;return{stiffness:A,damping:_*2*Math.sqrt(s*A),duration:e}}}const lte=12;function cte(e,t,n){let s=n;for(let h=1;h<lte;h++)s=s-e(s)/t(s);return s}function _P(e,t){return e*Math.sqrt(1-t*t)}const ute=["duration","bounce"],hte=["stiffness","damping","mass"];function WL(e,t){return t.some(n=>e[n]!==void 0)}function dte(e){let t={velocity:Oo.velocity,stiffness:Oo.stiffness,damping:Oo.damping,mass:Oo.mass,isResolvedFromDuration:!1,...e};if(!WL(e,hte)&&WL(e,ute))if(e.visualDuration){const n=e.visualDuration,s=2*Math.PI/(n*1.2),h=s*s,m=2*Xc(.05,1,1-(e.bounce||0))*Math.sqrt(h);t={...t,mass:Oo.mass,stiffness:h,damping:m}}else{const n=ate(e);t={...t,...n,mass:Oo.mass},t.isResolvedFromDuration=!0}return t}function nw(e=Oo.visualDuration,t=Oo.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:s,restDelta:h}=n;const m=n.keyframes[0],_=n.keyframes[n.keyframes.length-1],i={done:!1,value:m},{stiffness:S,damping:A,mass:I,duration:M,velocity:L,isResolvedFromDuration:z}=dte({...n,velocity:-dl(n.velocity||0)}),G=L||0,F=A/(2*Math.sqrt(S*I)),U=_-m,K=dl(Math.sqrt(S/I)),J=Math.abs(U)<5;s||(s=J?Oo.restSpeed.granular:Oo.restSpeed.default),h||(h=J?Oo.restDelta.granular:Oo.restDelta.default);let X;if(F<1){const Q=_P(K,F);X=ae=>{const pe=Math.exp(-F*K*ae);return _-pe*((G+F*K*U)/Q*Math.sin(Q*ae)+U*Math.cos(Q*ae))}}else if(F===1)X=Q=>_-Math.exp(-K*Q)*(U+(G+K*U)*Q);else{const Q=K*Math.sqrt(F*F-1);X=ae=>{const pe=Math.exp(-F*K*ae),Pe=Math.min(Q*ae,300);return _-pe*((G+F*K*U)*Math.sinh(Pe)+Q*U*Math.cosh(Pe))/Q}}const ie={calculatedDuration:z&&M||null,next:Q=>{const ae=X(Q);if(z)i.done=Q>=M;else{let pe=Q===0?G:0;F<1&&(pe=Q===0?Uc(G):jV(X,Q,ae));const Pe=Math.abs(pe)<=s,Fe=Math.abs(_-ae)<=h;i.done=Pe&&Fe}return i.value=i.done?_:ae,i},toString:()=>{const Q=Math.min(mM(ie),rw),ae=kV(pe=>ie.next(Q*pe).value,Q,30);return Q+"ms "+ae},toTransition:()=>{}};return ie}nw.applyToOptions=e=>{const t=ote(e,100,nw);return e.ease=t.ease,e.duration=Uc(t.duration),e.type="keyframes",e};function vP({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:h=10,bounceStiffness:m=500,modifyTarget:_,min:i,max:S,restDelta:A=.5,restSpeed:I}){const M=e[0],L={done:!1,value:M},z=Pe=>i!==void 0&&Pe<i||S!==void 0&&Pe>S,G=Pe=>i===void 0?S:S===void 0||Math.abs(i-Pe)<Math.abs(S-Pe)?i:S;let F=n*t;const U=M+F,K=_===void 0?U:_(U);K!==U&&(F=K-M);const J=Pe=>-F*Math.exp(-Pe/s),X=Pe=>K+J(Pe),ie=Pe=>{const Fe=J(Pe),tt=X(Pe);L.done=Math.abs(Fe)<=A,L.value=L.done?K:tt};let Q,ae;const pe=Pe=>{z(L.value)&&(Q=Pe,ae=nw({keyframes:[L.value,G(L.value)],velocity:jV(X,Pe,L.value),damping:h,stiffness:m,restDelta:A,restSpeed:I}))};return pe(0),{calculatedDuration:null,next:Pe=>{let Fe=!1;return!ae&&Q===void 0&&(Fe=!0,ie(Pe),pe(Pe)),Q!==void 0&&Pe>=Q?ae.next(Pe-Q):(!Fe&&ie(Pe),L)}}}function fte(e,t,n){const s=[],h=n||Bu.mix||DV,m=e.length-1;for(let _=0;_<m;_++){let i=h(e[_],e[_+1]);if(t){const S=Array.isArray(t)?t[_]||_a:t;i=N0(S,i)}s.push(i)}return s}function gM(e,t,{clamp:n=!0,ease:s,mixer:h}={}){const m=e.length;if(ag(m===t.length),m===1)return()=>t[0];if(m===2&&t[0]===t[1])return()=>t[1];const _=e[0]===e[1];e[0]>e[m-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=fte(t,s,h),S=i.length,A=I=>{if(_&&I<e[0])return t[0];let M=0;if(S>1)for(;M<e.length-2&&!(I<e[M+1]);M++);const L=lg(e[M],e[M+1],I);return i[M](L)};return n?I=>A(Xc(e[0],e[m-1],I)):A}function pte(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const h=lg(0,t,s);e.push(Ao(n,1,h))}}function LV(e){const t=[0];return pte(t,e.length-1),t}function mte(e,t){return e.map(n=>n*t)}function gte(e,t){return e.map(()=>t||wV).splice(0,e.length-1)}function Cv({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const h=Mee(s)?s.map(BL):BL(s),m={done:!1,value:t[0]},_=mte(n&&n.length===t.length?n:LV(t),e),i=gM(_,t,{ease:Array.isArray(h)?h:gte(t,h)});return{calculatedDuration:e,next:S=>(m.value=i(S),m.done=S>=e,m)}}const yte=e=>e!==null;function yM(e,{repeat:t,repeatType:n="loop"},s,h=1){const m=e.filter(yte),i=h<0||t&&n!=="loop"&&t%2===1?0:m.length-1;return!i||s===void 0?m[i]:s}const _te={decay:vP,inertia:vP,tween:Cv,keyframes:Cv,spring:nw};function NV(e){typeof e.type=="string"&&(e.type=_te[e.type])}class _M{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const vte=e=>e/100;class vM extends _M{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==ga.now()&&this.tick(ga.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;NV(t);const{type:n=Cv,repeat:s=0,repeatDelay:h=0,repeatType:m,velocity:_=0}=t;let{keyframes:i}=t;const S=n||Cv;S!==Cv&&typeof i[0]!="number"&&(this.mixKeyframes=N0(vte,DV(i[0],i[1])),i=[0,100]);const A=S({...t,keyframes:i});m==="mirror"&&(this.mirroredGenerator=S({...t,keyframes:[...i].reverse(),velocity:-_})),A.calculatedDuration===null&&(A.calculatedDuration=mM(A));const{calculatedDuration:I}=A;this.calculatedDuration=I,this.resolvedDuration=I+h,this.totalDuration=this.resolvedDuration*(s+1)-h,this.generator=A}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:s,totalDuration:h,mixKeyframes:m,mirroredGenerator:_,resolvedDuration:i,calculatedDuration:S}=this;if(this.startTime===null)return s.next(0);const{delay:A=0,keyframes:I,repeat:M,repeatType:L,repeatDelay:z,type:G,onUpdate:F,finalKeyframe:U}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const K=this.currentTime-A*(this.playbackSpeed>=0?1:-1),J=this.playbackSpeed>=0?K<0:K>h;this.currentTime=Math.max(K,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let X=this.currentTime,ie=s;if(M){const Pe=Math.min(this.currentTime,h)/i;let Fe=Math.floor(Pe),tt=Pe%1;!tt&&Pe>=1&&(tt=1),tt===1&&Fe--,Fe=Math.min(Fe,M+1),!!(Fe%2)&&(L==="reverse"?(tt=1-tt,z&&(tt-=z/i)):L==="mirror"&&(ie=_)),X=Xc(0,1,tt)*i}const Q=J?{done:!1,value:I[0]}:ie.next(X);m&&(Q.value=m(Q.value));let{done:ae}=Q;!J&&S!==null&&(ae=this.playbackSpeed>=0?this.currentTime>=h:this.currentTime<=0);const pe=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ae);return pe&&G!==vP&&(Q.value=yM(I,this.options,U,this.speed)),F&&F(Q.value),pe&&this.finish(),Q}then(t,n){return this.finished.then(t,n)}get duration(){return dl(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+dl(t)}get time(){return dl(this.currentTime)}set time(t){t=Uc(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(ga.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=dl(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=ite,startTime:n}=this.options;this.driver||(this.driver=t(h=>this.tick(h))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=n??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ga.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function xte(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const df=e=>e*180/Math.PI,xP=e=>{const t=df(Math.atan2(e[1],e[0]));return bP(t)},bte={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:xP,rotateZ:xP,skewX:e=>df(Math.atan(e[1])),skewY:e=>df(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},bP=e=>(e=e%360,e<0&&(e+=360),e),qL=xP,ZL=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),XL=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),wte={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ZL,scaleY:XL,scale:e=>(ZL(e)+XL(e))/2,rotateX:e=>bP(df(Math.atan2(e[6],e[5]))),rotateY:e=>bP(df(Math.atan2(-e[2],e[0]))),rotateZ:qL,rotate:qL,skewX:e=>df(Math.atan(e[4])),skewY:e=>df(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function wP(e){return e.includes("scale")?1:0}function TP(e,t){if(!e||e==="none")return wP(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,h;if(n)s=wte,h=n;else{const i=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=bte,h=i}if(!h)return wP(t);const m=s[t],_=h[1].split(",").map(Ste);return typeof m=="function"?m(_):_[m]}const Tte=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return TP(n,t)};function Ste(e){return parseFloat(e.trim())}const Hg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Wg=new Set(Hg),KL=e=>e===Gg||e===Nn,Ete=new Set(["x","y","z"]),Ate=Hg.filter(e=>!Ete.has(e));function Pte(e){const t=[];return Ate.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const _f={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>TP(t,"x"),y:(e,{transform:t})=>TP(t,"y")};_f.translateX=_f.x;_f.translateY=_f.y;const vf=new Set;let SP=!1,EP=!1,AP=!1;function zV(){if(EP){const e=Array.from(vf).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const h=Pte(s);h.length&&(n.set(s,h),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const h=n.get(s);h&&h.forEach(([m,_])=>{s.getValue(m)?.set(_)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}EP=!1,SP=!1,vf.forEach(e=>e.complete(AP)),vf.clear()}function FV(){vf.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(EP=!0)})}function Cte(){AP=!0,FV(),zV(),AP=!1}class xM{constructor(t,n,s,h,m,_=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=h,this.element=m,this.isAsync=_}scheduleResolve(){this.state="scheduled",this.isAsync?(vf.add(this),SP||(SP=!0,Ui.read(FV),Ui.resolveKeyframes(zV))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:h}=this;if(t[0]===null){const m=h?.get(),_=t[t.length-1];if(m!==void 0)t[0]=m;else if(s&&n){const i=s.readValue(n,_);i!=null&&(t[0]=i)}t[0]===void 0&&(t[0]=_),h&&m===void 0&&h.set(t[0])}xte(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),vf.delete(this)}cancel(){this.state==="scheduled"&&(vf.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Ite=e=>e.startsWith("--");function Mte(e,t,n){Ite(t)?e.style.setProperty(t,n):e.style[t]=n}const BV=sM(()=>window.ScrollTimeline!==void 0),Ote={};function Rte(e,t){const n=sM(e);return()=>Ote[t]??n()}const VV=Rte(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),bv=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,YL={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:bv([0,.65,.55,1]),circOut:bv([.55,0,1,.45]),backIn:bv([.31,.01,.66,-.59]),backOut:bv([.33,1.53,.69,.99])};function $V(e,t){if(e)return typeof e=="function"?VV()?kV(e,t):"ease-out":TV(e)?bv(e):Array.isArray(e)?e.map(n=>$V(n,t)||YL.easeOut):YL[e]}function Dte(e,t,n,{delay:s=0,duration:h=300,repeat:m=0,repeatType:_="loop",ease:i="easeOut",times:S}={},A=void 0){const I={[t]:n};S&&(I.offset=S);const M=$V(i,h);Array.isArray(M)&&(I.easing=M);const L={delay:s,duration:h,easing:Array.isArray(M)?"linear":M,fill:"both",iterations:m+1,direction:_==="reverse"?"alternate":"normal"};return A&&(L.pseudoElement=A),e.animate(I,L)}function UV(e){return typeof e=="function"&&"applyToOptions"in e}function kte({type:e,...t}){return UV(e)&&VV()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class jte extends _M{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:n,name:s,keyframes:h,pseudoElement:m,allowFlatten:_=!1,finalKeyframe:i,onComplete:S}=t;this.isPseudoElement=!!m,this.allowFlatten=_,this.options=t,ag(typeof t.type!="string");const A=kte(t);this.animation=Dte(n,s,h,A,m),A.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const I=yM(h,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(I):Mte(n,s,I),this.animation.cancel()}S?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return dl(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+dl(t)}get time(){return dl(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=Uc(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&BV()?(this.animation.timeline=t,_a):n(this)}}const GV={anticipate:vV,backInOut:_V,circInOut:bV};function Lte(e){return e in GV}function Nte(e){typeof e.ease=="string"&&Lte(e.ease)&&(e.ease=GV[e.ease])}const JL=10;class zte extends jte{constructor(t){Nte(t),NV(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:s,onComplete:h,element:m,..._}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const i=new vM({..._,autoplay:!1}),S=Uc(this.finishedTime??this.time);n.setWithVelocity(i.sample(S-JL).value,i.sample(S).value,JL),i.stop()}}const QL=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Xh.test(e)||e==="0")&&!e.startsWith("url("));function Fte(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function Bte(e,t,n,s){const h=e[0];if(h===null)return!1;if(t==="display"||t==="visibility")return!0;const m=e[e.length-1],_=QL(h,t),i=QL(m,t);return!_||!i?!1:Fte(e)||(n==="spring"||UV(n))&&s}function PP(e){e.duration=0,e.type="keyframes"}const Vte=new Set(["opacity","clipPath","filter","transform"]),$te=sM(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Ute(e){const{motionValue:t,name:n,repeatDelay:s,repeatType:h,damping:m,type:_}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:S,transformTemplate:A}=t.owner.getProps();return $te()&&n&&Vte.has(n)&&(n!=="transform"||!A)&&!S&&!s&&h!=="mirror"&&m!==0&&_!=="inertia"}const Gte=40;class Hte extends _M{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:h=0,repeatDelay:m=0,repeatType:_="loop",keyframes:i,name:S,motionValue:A,element:I,...M}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=ga.now();const L={autoplay:t,delay:n,type:s,repeat:h,repeatDelay:m,repeatType:_,name:S,motionValue:A,element:I,...M},z=I?.KeyframeResolver||xM;this.keyframeResolver=new z(i,(G,F,U)=>this.onKeyframesResolved(G,F,L,!U),S,A,I),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,n,s,h){this.keyframeResolver=void 0;const{name:m,type:_,velocity:i,delay:S,isHandoff:A,onUpdate:I}=s;this.resolvedAt=ga.now(),Bte(t,m,_,i)||((Bu.instantAnimations||!S)&&I?.(yM(t,s,n)),t[0]=t[t.length-1],PP(s),s.repeat=0);const L={startTime:h?this.resolvedAt?this.resolvedAt-this.createdAt>Gte?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...s,keyframes:t},z=!A&&Ute(L)?new zte({...L,element:L.motionValue.owner.current}):new vM(L);z.finished.then(()=>this.notifyFinished()).catch(_a),this.pendingTimeline&&(this.stopTimeline=z.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=z}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Cte()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Wte=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function qte(e){const t=Wte.exec(e);if(!t)return[,];const[,n,s,h]=t;return[`--${n??s}`,h]}function HV(e,t,n=1){const[s,h]=qte(e);if(!s)return;const m=window.getComputedStyle(t).getPropertyValue(s);if(m){const _=m.trim();return hV(_)?parseFloat(_):_}return hM(h)?HV(h,t,n+1):h}function bM(e,t){return e?.[t]??e?.default??e}const WV=new Set(["width","height","top","left","right","bottom",...Hg]),Zte={test:e=>e==="auto",parse:e=>e},qV=e=>t=>t.test(e),ZV=[Gg,Nn,Gc,kh,$ee,Vee,Zte],eN=e=>ZV.find(qV(e));function Xte(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||fV(e):!0}const Kte=new Set(["brightness","contrast","saturate","opacity"]);function Yte(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(dM)||[];if(!s)return e;const h=n.replace(s,"");let m=Kte.has(t)?1:0;return s!==n&&(m*=100),t+"("+m+h+")"}const Jte=/\b([a-z-]*)\(.*?\)/gu,CP={...Xh,getAnimatableNone:e=>{const t=e.match(Jte);return t?t.map(Yte).join(" "):e}},tN={...Gg,transform:Math.round},Qte={rotate:kh,rotateX:kh,rotateY:kh,rotateZ:kh,scale:s1,scaleX:s1,scaleY:s1,scaleZ:s1,skew:kh,skewX:kh,skewY:kh,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:Fv,originX:$L,originY:$L,originZ:Nn},wM={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn,...Qte,zIndex:tN,fillOpacity:Fv,strokeOpacity:Fv,numOctaves:tN},ere={...wM,color:Xo,backgroundColor:Xo,outlineColor:Xo,fill:Xo,stroke:Xo,borderColor:Xo,borderTopColor:Xo,borderRightColor:Xo,borderBottomColor:Xo,borderLeftColor:Xo,filter:CP,WebkitFilter:CP},XV=e=>ere[e];function KV(e,t){let n=XV(e);return n!==CP&&(n=Xh),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const tre=new Set(["auto","none","0"]);function rre(e,t,n){let s=0,h;for(;s<e.length&&!h;){const m=e[s];typeof m=="string"&&!tre.has(m)&&Bv(m).values.length&&(h=e[s]),s++}if(h&&n)for(const m of t)e[m]=KV(n,h)}class nre extends xM{constructor(t,n,s,h,m){super(t,n,s,h,m,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let S=0;S<t.length;S++){let A=t[S];if(typeof A=="string"&&(A=A.trim(),hM(A))){const I=HV(A,n.current);I!==void 0&&(t[S]=I),S===t.length-1&&(this.finalKeyframe=A)}}if(this.resolveNoneKeyframes(),!WV.has(s)||t.length!==2)return;const[h,m]=t,_=eN(h),i=eN(m);if(_!==i)if(KL(_)&&KL(i))for(let S=0;S<t.length;S++){const A=t[S];typeof A=="string"&&(t[S]=parseFloat(A))}else _f[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let h=0;h<t.length;h++)(t[h]===null||Xte(t[h]))&&s.push(h);s.length&&rre(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=_f[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const h=n[n.length-1];h!==void 0&&t.getValue(s,h).jump(h,!1)}measureEndState(){const{element:t,name:n,unresolvedKeyframes:s}=this;if(!t||!t.current)return;const h=t.getValue(n);h&&h.jump(this.measuredOrigin,!1);const m=s.length-1,_=s[m];s[m]=_f[n](t.measureViewportBox(),window.getComputedStyle(t.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),this.removedTransforms?.length&&this.removedTransforms.forEach(([i,S])=>{t.getValue(i).set(S)}),this.resolveNoneKeyframes()}}function TM(e,t,n){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const h=document.querySelectorAll(e);return h?Array.from(h):[]}return Array.from(e)}const YV=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function SM(e){return dV(e)&&"offsetHeight"in e}const rN=30,ire=e=>!isNaN(parseFloat(e)),Iv={current:void 0};class ore{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const h=ga.now();if(this.updatedAt!==h&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const m of this.dependents)m.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=ga.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=ire(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new aM);const s=this.events[t].add(n);return t==="change"?()=>{s(),Ui.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return Iv.current&&Iv.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=ga.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>rN)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,rN);return lM(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function rc(e,t){return new ore(e,t)}const{schedule:EM,cancel:Mze}=SV(queueMicrotask,!1),Xl={x:!1,y:!1};function JV(){return Xl.x||Xl.y}function sre(e){return e==="x"||e==="y"?Xl[e]?null:(Xl[e]=!0,()=>{Xl[e]=!1}):Xl.x||Xl.y?null:(Xl.x=Xl.y=!0,()=>{Xl.x=Xl.y=!1})}function QV(e,t){const n=TM(e),s=new AbortController,h={passive:!0,...t,signal:s.signal};return[n,h,()=>s.abort()]}function nN(e){return!(e.pointerType==="touch"||JV())}function are(e,t,n={}){const[s,h,m]=QV(e,n),_=i=>{if(!nN(i))return;const{target:S}=i,A=t(S,i);if(typeof A!="function"||!S)return;const I=M=>{nN(M)&&(A(M),S.removeEventListener("pointerleave",I))};S.addEventListener("pointerleave",I,h)};return s.forEach(i=>{i.addEventListener("pointerenter",_,h)}),m}const e$=(e,t)=>t?e===t?!0:e$(e,t.parentElement):!1,AM=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,lre=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function cre(e){return lre.has(e.tagName)||e.tabIndex!==-1}const N1=new WeakSet;function iN(e){return t=>{t.key==="Enter"&&e(t)}}function nA(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const ure=(e,t)=>{const n=e.currentTarget;if(!n)return;const s=iN(()=>{if(N1.has(n))return;nA(n,"down");const h=iN(()=>{nA(n,"up")}),m=()=>nA(n,"cancel");n.addEventListener("keyup",h,t),n.addEventListener("blur",m,t)});n.addEventListener("keydown",s,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",s),t)};function oN(e){return AM(e)&&!JV()}function hre(e,t,n={}){const[s,h,m]=QV(e,n),_=i=>{const S=i.currentTarget;if(!oN(i))return;N1.add(S);const A=t(S,i),I=(z,G)=>{window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",L),N1.has(S)&&N1.delete(S),oN(z)&&typeof A=="function"&&A(z,{success:G})},M=z=>{I(z,S===window||S===document||n.useGlobalTarget||e$(S,z.target))},L=z=>{I(z,!1)};window.addEventListener("pointerup",M,h),window.addEventListener("pointercancel",L,h)};return s.forEach(i=>{(n.useGlobalTarget?window:i).addEventListener("pointerdown",_,h),SM(i)&&(i.addEventListener("focus",A=>ure(A,h)),!cre(i)&&!i.hasAttribute("tabindex")&&(i.tabIndex=0))}),m}function PM(e){return dV(e)&&"ownerSVGElement"in e}const z1=new WeakMap;let F1;const t$=(e,t,n)=>(s,h)=>h&&h[0]?h[0][e+"Size"]:PM(s)&&"getBBox"in s?s.getBBox()[t]:s[n],dre=t$("inline","width","offsetWidth"),fre=t$("block","height","offsetHeight");function pre({target:e,borderBoxSize:t}){z1.get(e)?.forEach(n=>{n(e,{get width(){return dre(e,t)},get height(){return fre(e,t)}})})}function mre(e){e.forEach(pre)}function gre(){typeof ResizeObserver>"u"||(F1=new ResizeObserver(mre))}function yre(e,t){F1||gre();const n=TM(e);return n.forEach(s=>{let h=z1.get(s);h||(h=new Set,z1.set(s,h)),h.add(t),F1?.observe(s)}),()=>{n.forEach(s=>{const h=z1.get(s);h?.delete(t),h?.size||F1?.unobserve(s)})}}const B1=new Set;let Fm;function _re(){Fm=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};B1.forEach(t=>t(e))},window.addEventListener("resize",Fm)}function vre(e){return B1.add(e),Fm||_re(),()=>{B1.delete(e),!B1.size&&typeof Fm=="function"&&(window.removeEventListener("resize",Fm),Fm=void 0)}}function xre(e,t){return typeof e=="function"?vre(e):yre(e,t)}function r$(e,t){let n;const s=()=>{const{currentTime:h}=t,_=(h===null?0:h.value)/100;n!==_&&e(_),n=_};return Ui.preUpdate(s,!0),()=>lc(s)}function bre(e){return PM(e)&&e.tagName==="svg"}function wre(...e){const t=!Array.isArray(e[0]),n=t?0:-1,s=e[0+n],h=e[1+n],m=e[2+n],_=e[3+n],i=gM(h,m,_);return t?i(s):i}const $s=e=>!!(e&&e.getVelocity),Tre=[...ZV,Xo,Xh],Sre=e=>Tre.find(qV(e)),RT=B.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function sN(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Ere(...e){return t=>{let n=!1;const s=e.map(h=>{const m=sN(h,t);return!n&&typeof m=="function"&&(n=!0),m});if(n)return()=>{for(let h=0;h<s.length;h++){const m=s[h];typeof m=="function"?m():sN(e[h],null)}}}}function Are(...e){return B.useCallback(Ere(...e),e)}class Pre extends B.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=n.offsetParent,h=SM(s)&&s.offsetWidth||0,m=this.props.sizeRef.current;m.height=n.offsetHeight||0,m.width=n.offsetWidth||0,m.top=n.offsetTop,m.left=n.offsetLeft,m.right=h-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Cre({children:e,isPresent:t,anchorX:n,root:s}){const h=B.useId(),m=B.useRef(null),_=B.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:i}=B.useContext(RT),S=Are(m,e?.ref);return B.useInsertionEffect(()=>{const{width:A,height:I,top:M,left:L,right:z}=_.current;if(t||!m.current||!A||!I)return;const G=n==="left"?`left: ${L}`:`right: ${z}`;m.current.dataset.motionPopId=h;const F=document.createElement("style");i&&(F.nonce=i);const U=s??document.head;return U.appendChild(F),F.sheet&&F.sheet.insertRule(`
          [data-motion-pop-id="${h}"] {
            position: absolute !important;
            width: ${A}px !important;
            height: ${I}px !important;
            ${G}px !important;
            top: ${M}px !important;
          }
        `),()=>{U.contains(F)&&U.removeChild(F)}},[t]),b.jsx(Pre,{isPresent:t,childRef:m,sizeRef:_,children:B.cloneElement(e,{ref:S})})}const Ire=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:h,presenceAffectsLayout:m,mode:_,anchorX:i,root:S})=>{const A=Ug(Mre),I=B.useId();let M=!0,L=B.useMemo(()=>(M=!1,{id:I,initial:t,isPresent:n,custom:h,onExitComplete:z=>{A.set(z,!0);for(const G of A.values())if(!G)return;s&&s()},register:z=>(A.set(z,!1),()=>A.delete(z))}),[n,A,s]);return m&&M&&(L={...L}),B.useMemo(()=>{A.forEach((z,G)=>A.set(G,!1))},[n]),B.useEffect(()=>{!n&&!A.size&&s&&s()},[n]),_==="popLayout"&&(e=b.jsx(Cre,{isPresent:n,anchorX:i,root:S,children:e})),b.jsx(OT.Provider,{value:L,children:e})};function Mre(){return new Map}function n$(e=!0){const t=B.useContext(OT);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:s,register:h}=t,m=B.useId();B.useEffect(()=>{if(e)return h(m)},[e]);const _=B.useCallback(()=>e&&s&&s(m),[m,s,e]);return!n&&s?[!1,_]:[!0]}const a1=e=>e.key||"";function aN(e){const t=[];return B.Children.forEach(e,n=>{B.isValidElement(n)&&t.push(n)}),t}const cg=({children:e,custom:t,initial:n=!0,onExitComplete:s,presenceAffectsLayout:h=!0,mode:m="sync",propagate:_=!1,anchorX:i="left",root:S})=>{const[A,I]=n$(_),M=B.useMemo(()=>aN(e),[e]),L=_&&!A?[]:M.map(a1),z=B.useRef(!0),G=B.useRef(M),F=Ug(()=>new Map),[U,K]=B.useState(M),[J,X]=B.useState(M);MT(()=>{z.current=!1,G.current=M;for(let ae=0;ae<J.length;ae++){const pe=a1(J[ae]);L.includes(pe)?F.delete(pe):F.get(pe)!==!0&&F.set(pe,!1)}},[J,L.length,L.join("-")]);const ie=[];if(M!==U){let ae=[...M];for(let pe=0;pe<J.length;pe++){const Pe=J[pe],Fe=a1(Pe);L.includes(Fe)||(ae.splice(pe,0,Pe),ie.push(Pe))}return m==="wait"&&ie.length&&(ae=ie),X(aN(ae)),K(M),null}const{forceRender:Q}=B.useContext(rM);return b.jsx(b.Fragment,{children:J.map(ae=>{const pe=a1(ae),Pe=_&&!A?!1:M===J||L.includes(pe),Fe=()=>{if(F.has(pe))F.set(pe,!0);else return;let tt=!0;F.forEach(Be=>{Be||(tt=!1)}),tt&&(Q?.(),X(G.current),_&&I?.(),s&&s())};return b.jsx(Ire,{isPresent:Pe,initial:!z.current||n?void 0:!1,custom:t,presenceAffectsLayout:h,mode:m,root:S,onExitComplete:Pe?void 0:Fe,anchorX:i,children:ae},pe)})})},i$=B.createContext({strict:!1}),lN={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ug={};for(const e in lN)ug[e]={isEnabled:t=>lN[e].some(n=>!!t[n])};function Ore(e){for(const t in e)ug[t]={...ug[t],...e[t]}}const Rre=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function iw(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Rre.has(e)}let o$=e=>!iw(e);function Dre(e){typeof e=="function"&&(o$=t=>t.startsWith("on")?!iw(t):e(t))}try{Dre(require("@emotion/is-prop-valid").default)}catch{}function kre(e,t,n){const s={};for(const h in e)h==="values"&&typeof e.values=="object"||(o$(h)||n===!0&&iw(h)||!t&&!iw(h)||e.draggable&&h.startsWith("onDrag"))&&(s[h]=e[h]);return s}const DT=B.createContext({});function kT(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Vv(e){return typeof e=="string"||Array.isArray(e)}const CM=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],IM=["initial",...CM];function jT(e){return kT(e.animate)||IM.some(t=>Vv(e[t]))}function s$(e){return!!(jT(e)||e.variants)}function jre(e,t){if(jT(e)){const{initial:n,animate:s}=e;return{initial:n===!1||Vv(n)?n:void 0,animate:Vv(s)?s:void 0}}return e.inherit!==!1?t:{}}function Lre(e){const{initial:t,animate:n}=jre(e,B.useContext(DT));return B.useMemo(()=>({initial:t,animate:n}),[cN(t),cN(n)])}function cN(e){return Array.isArray(e)?e.join(" "):e}function uN(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ov={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Nn.test(e))e=parseFloat(e);else return e;const n=uN(e,t.target.x),s=uN(e,t.target.y);return`${n}% ${s}%`}},Nre={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,h=Xh.parse(e);if(h.length>5)return s;const m=Xh.createTransformer(e),_=typeof h[0]!="number"?1:0,i=n.x.scale*t.x,S=n.y.scale*t.y;h[0+_]/=i,h[1+_]/=S;const A=Ao(i,S,.5);return typeof h[2+_]=="number"&&(h[2+_]/=A),typeof h[3+_]=="number"&&(h[3+_]/=A),m(h)}},IP={borderRadius:{...ov,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ov,borderTopRightRadius:ov,borderBottomLeftRadius:ov,borderBottomRightRadius:ov,boxShadow:Nre};function a$(e,{layout:t,layoutId:n}){return Wg.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!IP[e]||e==="opacity")}const zre={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Fre=Hg.length;function Bre(e,t,n){let s="",h=!0;for(let m=0;m<Fre;m++){const _=Hg[m],i=e[_];if(i===void 0)continue;let S=!0;if(typeof i=="number"?S=i===(_.startsWith("scale")?1:0):S=parseFloat(i)===0,!S||n){const A=YV(i,wM[_]);if(!S){h=!1;const I=zre[_]||_;s+=`${I}(${A}) `}n&&(t[_]=A)}}return s=s.trim(),n?s=n(t,h?"":s):h&&(s="none"),s}function MM(e,t,n){const{style:s,vars:h,transformOrigin:m}=e;let _=!1,i=!1;for(const S in t){const A=t[S];if(Wg.has(S)){_=!0;continue}else if(AV(S)){h[S]=A;continue}else{const I=YV(A,wM[S]);S.startsWith("origin")?(i=!0,m[S]=I):s[S]=I}}if(t.transform||(_||n?s.transform=Bre(t,e.transform,n):s.transform&&(s.transform="none")),i){const{originX:S="50%",originY:A="50%",originZ:I=0}=m;s.transformOrigin=`${S} ${A} ${I}`}}const OM=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function l$(e,t,n){for(const s in t)!$s(t[s])&&!a$(s,n)&&(e[s]=t[s])}function Vre({transformTemplate:e},t){return B.useMemo(()=>{const n=OM();return MM(n,t,e),Object.assign({},n.vars,n.style)},[t])}function $re(e,t){const n=e.style||{},s={};return l$(s,n,e),Object.assign(s,Vre(e,t)),s}function Ure(e,t){const n={},s=$re(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const Gre={offset:"stroke-dashoffset",array:"stroke-dasharray"},Hre={offset:"strokeDashoffset",array:"strokeDasharray"};function Wre(e,t,n=1,s=0,h=!0){e.pathLength=1;const m=h?Gre:Hre;e[m.offset]=Nn.transform(-s);const _=Nn.transform(t),i=Nn.transform(n);e[m.array]=`${_} ${i}`}function c$(e,{attrX:t,attrY:n,attrScale:s,pathLength:h,pathSpacing:m=1,pathOffset:_=0,...i},S,A,I){if(MM(e,i,A),S){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:M,style:L}=e;M.transform&&(L.transform=M.transform,delete M.transform),(L.transform||M.transformOrigin)&&(L.transformOrigin=M.transformOrigin??"50% 50%",delete M.transformOrigin),L.transform&&(L.transformBox=I?.transformBox??"fill-box",delete M.transformBox),t!==void 0&&(M.x=t),n!==void 0&&(M.y=n),s!==void 0&&(M.scale=s),h!==void 0&&Wre(M,h,m,_,!1)}const u$=()=>({...OM(),attrs:{}}),h$=e=>typeof e=="string"&&e.toLowerCase()==="svg";function qre(e,t,n,s){const h=B.useMemo(()=>{const m=u$();return c$(m,t,h$(s),e.transformTemplate,e.style),{...m.attrs,style:{...m.style}}},[t]);if(e.style){const m={};l$(m,e.style,e),h.style={...m,...h.style}}return h}const Zre=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function RM(e){return typeof e!="string"||e.includes("-")?!1:!!(Zre.indexOf(e)>-1||/[A-Z]/u.test(e))}function Xre(e,t,n,{latestValues:s},h,m=!1){const i=(RM(e)?qre:Ure)(t,s,h,e),S=kre(t,typeof e=="string",m),A=e!==B.Fragment?{...S,...i,ref:n}:{},{children:I}=t,M=B.useMemo(()=>$s(I)?I.get():I,[I]);return B.createElement(e,{...A,children:M})}function hN(e){const t=[{},{}];return e?.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function DM(e,t,n,s){if(typeof t=="function"){const[h,m]=hN(s);t=t(n!==void 0?n:e.custom,h,m)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[h,m]=hN(s);t=t(n!==void 0?n:e.custom,h,m)}return t}function V1(e){return $s(e)?e.get():e}function Kre({scrapeMotionValuesFromProps:e,createRenderState:t},n,s,h){return{latestValues:Yre(n,s,h,e),renderState:t()}}function Yre(e,t,n,s){const h={},m=s(e,{});for(const L in m)h[L]=V1(m[L]);let{initial:_,animate:i}=e;const S=jT(e),A=s$(e);t&&A&&!S&&e.inherit!==!1&&(_===void 0&&(_=t.initial),i===void 0&&(i=t.animate));let I=n?n.initial===!1:!1;I=I||_===!1;const M=I?i:_;if(M&&typeof M!="boolean"&&!kT(M)){const L=Array.isArray(M)?M:[M];for(let z=0;z<L.length;z++){const G=DM(e,L[z]);if(G){const{transitionEnd:F,transition:U,...K}=G;for(const J in K){let X=K[J];if(Array.isArray(X)){const ie=I?X.length-1:0;X=X[ie]}X!==null&&(h[J]=X)}for(const J in F)h[J]=F[J]}}}return h}const d$=e=>(t,n)=>{const s=B.useContext(DT),h=B.useContext(OT),m=()=>Kre(e,t,s,h);return n?m():Ug(m)};function kM(e,t,n){const{style:s}=e,h={};for(const m in s)($s(s[m])||t.style&&$s(t.style[m])||a$(m,e)||n?.getValue(m)?.liveStyle!==void 0)&&(h[m]=s[m]);return h}const Jre=d$({scrapeMotionValuesFromProps:kM,createRenderState:OM});function f$(e,t,n){const s=kM(e,t,n);for(const h in e)if($s(e[h])||$s(t[h])){const m=Hg.indexOf(h)!==-1?"attr"+h.charAt(0).toUpperCase()+h.substring(1):h;s[m]=e[h]}return s}const Qre=d$({scrapeMotionValuesFromProps:f$,createRenderState:u$}),ene=Symbol.for("motionComponentSymbol");function Bm(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function tne(e,t,n){return B.useCallback(s=>{s&&e.onMount&&e.onMount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):Bm(n)&&(n.current=s))},[t])}const jM=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),rne="framerAppearId",p$="data-"+jM(rne),m$=B.createContext({});function nne(e,t,n,s,h){const{visualElement:m}=B.useContext(DT),_=B.useContext(i$),i=B.useContext(OT),S=B.useContext(RT).reducedMotion,A=B.useRef(null);s=s||_.renderer,!A.current&&s&&(A.current=s(e,{visualState:t,parent:m,props:n,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:S}));const I=A.current,M=B.useContext(m$);I&&!I.projection&&h&&(I.type==="html"||I.type==="svg")&&ine(A.current,n,h,M);const L=B.useRef(!1);B.useInsertionEffect(()=>{I&&L.current&&I.update(n,i)});const z=n[p$],G=B.useRef(!!z&&!window.MotionHandoffIsComplete?.(z)&&window.MotionHasOptimisedAnimation?.(z));return MT(()=>{I&&(L.current=!0,window.MotionIsMounted=!0,I.updateFeatures(),I.scheduleRenderMicrotask(),G.current&&I.animationState&&I.animationState.animateChanges())}),B.useEffect(()=>{I&&(!G.current&&I.animationState&&I.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(z)}),G.current=!1),I.enteringChildren=void 0)}),I}function ine(e,t,n,s){const{layoutId:h,layout:m,drag:_,dragConstraints:i,layoutScroll:S,layoutRoot:A,layoutCrossfade:I}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:g$(e.parent)),e.projection.setOptions({layoutId:h,layout:m,alwaysMeasureLayout:!!_||i&&Bm(i),visualElement:e,animationType:typeof m=="string"?m:"both",initialPromotionConfig:s,crossfade:I,layoutScroll:S,layoutRoot:A})}function g$(e){if(e)return e.options.allowProjection!==!1?e.projection:g$(e.parent)}function iA(e,{forwardMotionProps:t=!1}={},n,s){n&&Ore(n);const h=RM(e)?Qre:Jre;function m(i,S){let A;const I={...B.useContext(RT),...i,layoutId:one(i)},{isStatic:M}=I,L=Lre(i),z=h(i,M);if(!M&&nM){sne();const G=ane(I);A=G.MeasureLayout,L.visualElement=nne(e,z,I,s,G.ProjectionNode)}return b.jsxs(DT.Provider,{value:L,children:[A&&L.visualElement?b.jsx(A,{visualElement:L.visualElement,...I}):null,Xre(e,i,tne(z,L.visualElement,S),z,M,t)]})}m.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const _=B.forwardRef(m);return _[ene]=e,_}function one({layoutId:e}){const t=B.useContext(rM).id;return t&&e!==void 0?t+"-"+e:e}function sne(e,t){B.useContext(i$).strict}function ane(e){const{drag:t,layout:n}=ug;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function lne(e,t){if(typeof Proxy>"u")return iA;const n=new Map,s=(m,_)=>iA(m,_,e,t),h=(m,_)=>s(m,_);return new Proxy(h,{get:(m,_)=>_==="create"?s:(n.has(_)||n.set(_,iA(_,void 0,e,t)),n.get(_))})}function y$({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function cne({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function une(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function oA(e){return e===void 0||e===1}function MP({scale:e,scaleX:t,scaleY:n}){return!oA(e)||!oA(t)||!oA(n)}function sf(e){return MP(e)||_$(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function _$(e){return dN(e.x)||dN(e.y)}function dN(e){return e&&e!=="0%"}function ow(e,t,n){const s=e-n,h=t*s;return n+h}function fN(e,t,n,s,h){return h!==void 0&&(e=ow(e,h,s)),ow(e,n,s)+t}function OP(e,t=0,n=1,s,h){e.min=fN(e.min,t,n,s,h),e.max=fN(e.max,t,n,s,h)}function v$(e,{x:t,y:n}){OP(e.x,t.translate,t.scale,t.originPoint),OP(e.y,n.translate,n.scale,n.originPoint)}const pN=.999999999999,mN=1.0000000000001;function hne(e,t,n,s=!1){const h=n.length;if(!h)return;t.x=t.y=1;let m,_;for(let i=0;i<h;i++){m=n[i],_=m.projectionDelta;const{visualElement:S}=m.options;S&&S.props.style&&S.props.style.display==="contents"||(s&&m.options.layoutScroll&&m.scroll&&m!==m.root&&$m(e,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),_&&(t.x*=_.x.scale,t.y*=_.y.scale,v$(e,_)),s&&sf(m.latestValues)&&$m(e,m.latestValues))}t.x<mN&&t.x>pN&&(t.x=1),t.y<mN&&t.y>pN&&(t.y=1)}function Vm(e,t){e.min=e.min+t,e.max=e.max+t}function gN(e,t,n,s,h=.5){const m=Ao(e.min,e.max,h);OP(e,t,n,m,s)}function $m(e,t){gN(e.x,t.x,t.scaleX,t.scale,t.originX),gN(e.y,t.y,t.scaleY,t.scale,t.originY)}function x$(e,t){return y$(une(e.getBoundingClientRect(),t))}function dne(e,t,n){const s=x$(e,n),{scroll:h}=t;return h&&(Vm(s.x,h.offset.x),Vm(s.y,h.offset.y)),s}const yN=()=>({translate:0,scale:1,origin:0,originPoint:0}),Um=()=>({x:yN(),y:yN()}),_N=()=>({min:0,max:0}),is=()=>({x:_N(),y:_N()}),RP={current:null},b$={current:!1};function fne(){if(b$.current=!0,!!nM)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>RP.current=e.matches;e.addEventListener("change",t),t()}else RP.current=!1}const pne=new WeakMap;function mne(e,t,n){for(const s in t){const h=t[s],m=n[s];if($s(h))e.addValue(s,h);else if($s(m))e.addValue(s,rc(h,{owner:e}));else if(m!==h)if(e.hasValue(s)){const _=e.getValue(s);_.liveStyle===!0?_.jump(h):_.hasAnimated||_.set(h)}else{const _=e.getStaticValue(s);e.addValue(s,rc(_!==void 0?_:h,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const vN=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class gne{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:h,blockInitialAnimation:m,visualState:_},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=xM,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=ga.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,Ui.render(this.render,!1,!0))};const{latestValues:S,renderState:A}=_;this.latestValues=S,this.baseTarget={...S},this.initialValues=n.initial?{...S}:{},this.renderState=A,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=h,this.options=i,this.blockInitialAnimation=!!m,this.isControllingVariants=jT(n),this.isVariantNode=s$(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...M}=this.scrapeMotionValuesFromProps(n,{},this);for(const L in M){const z=M[L];S[L]!==void 0&&$s(z)&&z.set(S[L])}}mount(t){this.current=t,pne.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),b$.current||fne(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:RP.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),lc(this.notifyUpdate),lc(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=Wg.has(t);s&&this.onBindTransform&&this.onBindTransform();const h=n.on("change",_=>{this.latestValues[t]=_,this.props.onUpdate&&Ui.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{h(),m&&m(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in ug){const n=ug[t];if(!n)continue;const{isEnabled:s,Feature:h}=n;if(!this.features[t]&&h&&s(this.props)&&(this.features[t]=new h(this)),this.features[t]){const m=this.features[t];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):is()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<vN.length;s++){const h=vN[s];this.propEventSubscriptions[h]&&(this.propEventSubscriptions[h](),delete this.propEventSubscriptions[h]);const m="on"+h,_=t[m];_&&(this.propEventSubscriptions[h]=this.on(h,_))}this.prevMotionValues=mne(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=rc(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){let s=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return s!=null&&(typeof s=="string"&&(hV(s)||fV(s))?s=parseFloat(s):!Sre(s)&&Xh.test(n)&&(s=KV(t,n)),this.setBaseTarget(t,$s(s)?s.get():s)),$s(s)?s.get():s}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){const{initial:n}=this.props;let s;if(typeof n=="string"||typeof n=="object"){const m=DM(this.props,n,this.presenceContext?.custom);m&&(s=m[t])}if(n&&s!==void 0)return s;const h=this.getBaseTargetFromProps(this.props,t);return h!==void 0&&!$s(h)?h:this.initialValues[t]!==void 0&&s===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new aM),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){EM.render(this.render)}}class w$ extends gne{constructor(){super(...arguments),this.KeyframeResolver=nre}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;$s(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function T$(e,{style:t,vars:n},s,h){const m=e.style;let _;for(_ in t)m[_]=t[_];h?.applyProjectionStyles(m,s);for(_ in n)m.setProperty(_,n[_])}function yne(e){return window.getComputedStyle(e)}class _ne extends w${constructor(){super(...arguments),this.type="html",this.renderInstance=T$}readValueFromInstance(t,n){if(Wg.has(n))return this.projection?.isProjecting?wP(n):Tte(t,n);{const s=yne(t),h=(AV(n)?s.getPropertyValue(n):s[n])||0;return typeof h=="string"?h.trim():h}}measureInstanceViewportBox(t,{transformPagePoint:n}){return x$(t,n)}build(t,n,s){MM(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return kM(t,n,s)}}const S$=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function vne(e,t,n,s){T$(e,t,void 0,s);for(const h in t.attrs)e.setAttribute(S$.has(h)?h:jM(h),t.attrs[h])}class xne extends w${constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=is}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(Wg.has(n)){const s=XV(n);return s&&s.default||0}return n=S$.has(n)?n:jM(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return f$(t,n,s)}build(t,n,s){c$(t,n,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(t,n,s,h){vne(t,n,s,h)}mount(t){this.isSVGTag=h$(t.tagName),super.mount(t)}}const bne=(e,t)=>RM(e)?new xne(t):new _ne(t,{allowProjection:e!==B.Fragment});function Xm(e,t,n){const s=e.getProps();return DM(s,t,n!==void 0?n:s.custom,e)}const DP=e=>Array.isArray(e);function wne(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,rc(n))}function Tne(e){return DP(e)?e[e.length-1]||0:e}function Sne(e,t){const n=Xm(e,t);let{transitionEnd:s={},transition:h={},...m}=n||{};m={...m,...s};for(const _ in m){const i=Tne(m[_]);wne(e,_,i)}}function Ene(e){return!!($s(e)&&e.add)}function kP(e,t){const n=e.getValue("willChange");if(Ene(n))return n.add(t);if(!n&&Bu.WillChange){const s=new Bu.WillChange("auto");e.addValue("willChange",s),s.add(t)}}function E$(e){return e.props[p$]}const Ane=e=>e!==null;function Pne(e,{repeat:t,repeatType:n="loop"},s){const h=e.filter(Ane),m=t&&n!=="loop"&&t%2===1?0:h.length-1;return!m||s===void 0?h[m]:s}const Cne={type:"spring",stiffness:500,damping:25,restSpeed:10},Ine=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Mne={type:"keyframes",duration:.8},One={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Rne=(e,{keyframes:t})=>t.length>2?Mne:Wg.has(e)?e.startsWith("scale")?Ine(t[1]):Cne:One;function Dne({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:h,repeat:m,repeatType:_,repeatDelay:i,from:S,elapsed:A,...I}){return!!Object.keys(I).length}const LM=(e,t,n,s={},h,m)=>_=>{const i=bM(s,e)||{},S=i.delay||s.delay||0;let{elapsed:A=0}=s;A=A-Uc(S);const I={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...i,delay:-A,onUpdate:L=>{t.set(L),i.onUpdate&&i.onUpdate(L)},onComplete:()=>{_(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:m?void 0:h};Dne(i)||Object.assign(I,Rne(e,I)),I.duration&&(I.duration=Uc(I.duration)),I.repeatDelay&&(I.repeatDelay=Uc(I.repeatDelay)),I.from!==void 0&&(I.keyframes[0]=I.from);let M=!1;if((I.type===!1||I.duration===0&&!I.repeatDelay)&&(PP(I),I.delay===0&&(M=!0)),(Bu.instantAnimations||Bu.skipAnimations)&&(M=!0,PP(I),I.delay=0),I.allowFlatten=!i.type&&!i.ease,M&&!m&&t.get()!==void 0){const L=Pne(I.keyframes,i);if(L!==void 0){Ui.update(()=>{I.onUpdate(L),I.onComplete()});return}}return i.isSync?new vM(I):new Hte(I)};function kne({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function A$(e,t,{delay:n=0,transitionOverride:s,type:h}={}){let{transition:m=e.getDefaultTransition(),transitionEnd:_,...i}=t;s&&(m=s);const S=[],A=h&&e.animationState&&e.animationState.getState()[h];for(const I in i){const M=e.getValue(I,e.latestValues[I]??null),L=i[I];if(L===void 0||A&&kne(A,I))continue;const z={delay:n,...bM(m||{},I)},G=M.get();if(G!==void 0&&!M.isAnimating&&!Array.isArray(L)&&L===G&&!z.velocity)continue;let F=!1;if(window.MotionHandoffAnimation){const K=E$(e);if(K){const J=window.MotionHandoffAnimation(K,I,Ui);J!==null&&(z.startTime=J,F=!0)}}kP(e,I),M.start(LM(I,M,L,e.shouldReduceMotion&&WV.has(I)?{type:!1}:z,e,F));const U=M.animation;U&&S.push(U)}return _&&Promise.all(S).then(()=>{Ui.update(()=>{_&&Sne(e,_)})}),S}function P$(e,t,n,s=0,h=1){const m=Array.from(e).sort((A,I)=>A.sortNodePosition(I)).indexOf(t),_=e.size,i=(_-1)*s;return typeof n=="function"?n(m,_):h===1?m*s:i-m*s}function jP(e,t,n={}){const s=Xm(e,t,n.type==="exit"?e.presenceContext?.custom:void 0);let{transition:h=e.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(h=n.transitionOverride);const m=s?()=>Promise.all(A$(e,s,n)):()=>Promise.resolve(),_=e.variantChildren&&e.variantChildren.size?(S=0)=>{const{delayChildren:A=0,staggerChildren:I,staggerDirection:M}=h;return jne(e,t,S,A,I,M,n)}:()=>Promise.resolve(),{when:i}=h;if(i){const[S,A]=i==="beforeChildren"?[m,_]:[_,m];return S().then(()=>A())}else return Promise.all([m(),_(n.delay)])}function jne(e,t,n=0,s=0,h=0,m=1,_){const i=[];for(const S of e.variantChildren)S.notify("AnimationStart",t),i.push(jP(S,t,{..._,delay:n+(typeof s=="function"?0:s)+P$(e.variantChildren,S,s,h,m)}).then(()=>S.notify("AnimationComplete",t)));return Promise.all(i)}function Lne(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const h=t.map(m=>jP(e,m,n));s=Promise.all(h)}else if(typeof t=="string")s=jP(e,t,n);else{const h=typeof t=="function"?Xm(e,t,n.custom):t;s=Promise.all(A$(e,h,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}function C$(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}const Nne=IM.length;function I$(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?I$(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<Nne;n++){const s=IM[n],h=e.props[s];(Vv(h)||h===!1)&&(t[s]=h)}return t}const zne=[...CM].reverse(),Fne=CM.length;function Bne(e){return t=>Promise.all(t.map(({animation:n,options:s})=>Lne(e,n,s)))}function Vne(e){let t=Bne(e),n=xN(),s=!0;const h=S=>(A,I)=>{const M=Xm(e,I,S==="exit"?e.presenceContext?.custom:void 0);if(M){const{transition:L,transitionEnd:z,...G}=M;A={...A,...G,...z}}return A};function m(S){t=S(e)}function _(S){const{props:A}=e,I=I$(e.parent)||{},M=[],L=new Set;let z={},G=1/0;for(let U=0;U<Fne;U++){const K=zne[U],J=n[K],X=A[K]!==void 0?A[K]:I[K],ie=Vv(X),Q=K===S?J.isActive:null;Q===!1&&(G=U);let ae=X===I[K]&&X!==A[K]&&ie;if(ae&&s&&e.manuallyAnimateOnMount&&(ae=!1),J.protectedKeys={...z},!J.isActive&&Q===null||!X&&!J.prevProp||kT(X)||typeof X=="boolean")continue;const pe=$ne(J.prevProp,X);let Pe=pe||K===S&&J.isActive&&!ae&&ie||U>G&&ie,Fe=!1;const tt=Array.isArray(X)?X:[X];let Be=tt.reduce(h(K),{});Q===!1&&(Be={});const{prevResolvedValues:Ge={}}=J,Qe={...Ge,...Be},Ke=qe=>{Pe=!0,L.has(qe)&&(Fe=!0,L.delete(qe)),J.needsAnimating[qe]=!0;const ut=e.getValue(qe);ut&&(ut.liveStyle=!1)};for(const qe in Qe){const ut=Be[qe],nt=Ge[qe];if(z.hasOwnProperty(qe))continue;let Kt=!1;DP(ut)&&DP(nt)?Kt=!C$(ut,nt):Kt=ut!==nt,Kt?ut!=null?Ke(qe):L.add(qe):ut!==void 0&&L.has(qe)?Ke(qe):J.protectedKeys[qe]=!0}J.prevProp=X,J.prevResolvedValues=Be,J.isActive&&(z={...z,...Be}),s&&e.blockInitialAnimation&&(Pe=!1);const ct=ae&&pe;Pe&&(!ct||Fe)&&M.push(...tt.map(qe=>{const ut={type:K};if(typeof qe=="string"&&s&&!ct&&e.manuallyAnimateOnMount&&e.parent){const{parent:nt}=e,Kt=Xm(nt,qe);if(nt.enteringChildren&&Kt){const{delayChildren:cr}=Kt.transition||{};ut.delay=P$(nt.enteringChildren,e,cr)}}return{animation:qe,options:ut}}))}if(L.size){const U={};if(typeof A.initial!="boolean"){const K=Xm(e,Array.isArray(A.initial)?A.initial[0]:A.initial);K&&K.transition&&(U.transition=K.transition)}L.forEach(K=>{const J=e.getBaseTarget(K),X=e.getValue(K);X&&(X.liveStyle=!0),U[K]=J??null}),M.push({animation:U})}let F=!!M.length;return s&&(A.initial===!1||A.initial===A.animate)&&!e.manuallyAnimateOnMount&&(F=!1),s=!1,F?t(M):Promise.resolve()}function i(S,A){if(n[S].isActive===A)return Promise.resolve();e.variantChildren?.forEach(M=>M.animationState?.setActive(S,A)),n[S].isActive=A;const I=_(S);for(const M in n)n[M].protectedKeys={};return I}return{animateChanges:_,setActive:i,setAnimateFunction:m,getState:()=>n,reset:()=>{n=xN()}}}function $ne(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!C$(t,e):!1}function rf(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function xN(){return{animate:rf(!0),whileInView:rf(),whileHover:rf(),whileTap:rf(),whileDrag:rf(),whileFocus:rf(),exit:rf()}}class Yh{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Une extends Yh{constructor(t){super(t),t.animationState||(t.animationState=Vne(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();kT(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Gne=0;class Hne extends Yh{constructor(){super(...arguments),this.id=Gne++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const h=this.node.animationState.setActive("exit",!t);n&&!t&&h.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Wne={animation:{Feature:Une},exit:{Feature:Hne}};function $v(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function B0(e){return{point:{x:e.pageX,y:e.pageY}}}const qne=e=>t=>AM(t)&&e(t,B0(t));function Mv(e,t,n,s){return $v(e,t,qne(n),s)}const M$=1e-4,Zne=1-M$,Xne=1+M$,O$=.01,Kne=0-O$,Yne=0+O$;function ea(e){return e.max-e.min}function Jne(e,t,n){return Math.abs(e-t)<=n}function bN(e,t,n,s=.5){e.origin=s,e.originPoint=Ao(t.min,t.max,e.origin),e.scale=ea(n)/ea(t),e.translate=Ao(n.min,n.max,e.origin)-e.originPoint,(e.scale>=Zne&&e.scale<=Xne||isNaN(e.scale))&&(e.scale=1),(e.translate>=Kne&&e.translate<=Yne||isNaN(e.translate))&&(e.translate=0)}function Ov(e,t,n,s){bN(e.x,t.x,n.x,s?s.originX:void 0),bN(e.y,t.y,n.y,s?s.originY:void 0)}function wN(e,t,n){e.min=n.min+t.min,e.max=e.min+ea(t)}function Qne(e,t,n){wN(e.x,t.x,n.x),wN(e.y,t.y,n.y)}function TN(e,t,n){e.min=t.min-n.min,e.max=e.min+ea(t)}function sw(e,t,n){TN(e.x,t.x,n.x),TN(e.y,t.y,n.y)}function al(e){return[e("x"),e("y")]}const R$=({current:e})=>e?e.ownerDocument.defaultView:null,SN=(e,t)=>Math.abs(e-t);function eie(e,t){const n=SN(e.x,t.x),s=SN(e.y,t.y);return Math.sqrt(n**2+s**2)}class D${constructor(t,n,{transformPagePoint:s,contextWindow:h=window,dragSnapToOrigin:m=!1,distanceThreshold:_=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=aA(this.lastMoveEventInfo,this.history),z=this.startEvent!==null,G=eie(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!z&&!G)return;const{point:F}=L,{timestamp:U}=xs;this.history.push({...F,timestamp:U});const{onStart:K,onMove:J}=this.handlers;z||(K&&K(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,L)},this.handlePointerMove=(L,z)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=sA(z,this.transformPagePoint),Ui.update(this.updatePoint,!0)},this.handlePointerUp=(L,z)=>{this.end();const{onEnd:G,onSessionEnd:F,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const K=aA(L.type==="pointercancel"?this.lastMoveEventInfo:sA(z,this.transformPagePoint),this.history);this.startEvent&&G&&G(L,K),F&&F(L,K)},!AM(t))return;this.dragSnapToOrigin=m,this.handlers=n,this.transformPagePoint=s,this.distanceThreshold=_,this.contextWindow=h||window;const i=B0(t),S=sA(i,this.transformPagePoint),{point:A}=S,{timestamp:I}=xs;this.history=[{...A,timestamp:I}];const{onSessionStart:M}=n;M&&M(t,aA(S,this.history)),this.removeListeners=N0(Mv(this.contextWindow,"pointermove",this.handlePointerMove),Mv(this.contextWindow,"pointerup",this.handlePointerUp),Mv(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),lc(this.updatePoint)}}function sA(e,t){return t?{point:t(e.point)}:e}function EN(e,t){return{x:e.x-t.x,y:e.y-t.y}}function aA({point:e},t){return{point:e,delta:EN(e,k$(t)),offset:EN(e,tie(t)),velocity:rie(t,.1)}}function tie(e){return e[0]}function k$(e){return e[e.length-1]}function rie(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const h=k$(e);for(;n>=0&&(s=e[n],!(h.timestamp-s.timestamp>Uc(t)));)n--;if(!s)return{x:0,y:0};const m=dl(h.timestamp-s.timestamp);if(m===0)return{x:0,y:0};const _={x:(h.x-s.x)/m,y:(h.y-s.y)/m};return _.x===1/0&&(_.x=0),_.y===1/0&&(_.y=0),_}function nie(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?Ao(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?Ao(n,e,s.max):Math.min(e,n)),e}function AN(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function iie(e,{top:t,left:n,bottom:s,right:h}){return{x:AN(e.x,n,h),y:AN(e.y,t,s)}}function PN(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function oie(e,t){return{x:PN(e.x,t.x),y:PN(e.y,t.y)}}function sie(e,t){let n=.5;const s=ea(e),h=ea(t);return h>s?n=lg(t.min,t.max-s,e.min):s>h&&(n=lg(e.min,e.max-h,t.min)),Xc(0,1,n)}function aie(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const LP=.35;function lie(e=LP){return e===!1?e=0:e===!0&&(e=LP),{x:CN(e,"left","right"),y:CN(e,"top","bottom")}}function CN(e,t,n){return{min:IN(e,t),max:IN(e,n)}}function IN(e,t){return typeof e=="number"?e:e[t]||0}const cie=new WeakMap;class uie{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=is(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:s}={}){const{presenceContext:h}=this.visualElement;if(h&&h.isPresent===!1)return;const m=M=>{const{dragSnapToOrigin:L}=this.getProps();L?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(B0(M).point)},_=(M,L)=>{const{drag:z,dragPropagation:G,onDragStart:F}=this.getProps();if(z&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=sre(z),!this.openDragLock))return;this.latestPointerEvent=M,this.latestPanInfo=L,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),al(K=>{let J=this.getAxisMotionValue(K).get()||0;if(Gc.test(J)){const{projection:X}=this.visualElement;if(X&&X.layout){const ie=X.layout.layoutBox[K];ie&&(J=ea(ie)*(parseFloat(J)/100))}}this.originPoint[K]=J}),F&&Ui.postRender(()=>F(M,L)),kP(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},i=(M,L)=>{this.latestPointerEvent=M,this.latestPanInfo=L;const{dragPropagation:z,dragDirectionLock:G,onDirectionLock:F,onDrag:U}=this.getProps();if(!z&&!this.openDragLock)return;const{offset:K}=L;if(G&&this.currentDirection===null){this.currentDirection=hie(K),this.currentDirection!==null&&F&&F(this.currentDirection);return}this.updateAxis("x",L.point,K),this.updateAxis("y",L.point,K),this.visualElement.render(),U&&U(M,L)},S=(M,L)=>{this.latestPointerEvent=M,this.latestPanInfo=L,this.stop(M,L),this.latestPointerEvent=null,this.latestPanInfo=null},A=()=>al(M=>this.getAnimationState(M)==="paused"&&this.getAxisMotionValue(M).animation?.play()),{dragSnapToOrigin:I}=this.getProps();this.panSession=new D$(t,{onSessionStart:m,onStart:_,onMove:i,onSessionEnd:S,resumeAnimation:A},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:I,distanceThreshold:s,contextWindow:R$(this.visualElement)})}stop(t,n){const s=t||this.latestPointerEvent,h=n||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!h||!s)return;const{velocity:_}=h;this.startAnimation(_);const{onDragEnd:i}=this.getProps();i&&Ui.postRender(()=>i(s,h))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:h}=this.getProps();if(!s||!l1(t,h,this.currentDirection))return;const m=this.getAxisMotionValue(t);let _=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(_=nie(_,this.constraints[t],this.elastic[t])),m.set(_)}resolveConstraints(){const{dragConstraints:t,dragElastic:n}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,h=this.constraints;t&&Bm(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=iie(s.layoutBox,t):this.constraints=!1,this.elastic=lie(n),h!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&al(m=>{this.constraints!==!1&&this.getAxisMotionValue(m)&&(this.constraints[m]=aie(s.layoutBox[m],this.constraints[m]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!Bm(t))return!1;const s=t.current,{projection:h}=this.visualElement;if(!h||!h.layout)return!1;const m=dne(s,h.root,this.visualElement.getTransformPagePoint());let _=oie(h.layout.layoutBox,m);if(n){const i=n(cne(_));this.hasMutatedConstraints=!!i,i&&(_=y$(i))}return _}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:h,dragTransition:m,dragSnapToOrigin:_,onDragTransitionEnd:i}=this.getProps(),S=this.constraints||{},A=al(I=>{if(!l1(I,n,this.currentDirection))return;let M=S&&S[I]||{};_&&(M={min:0,max:0});const L=h?200:1e6,z=h?40:1e7,G={type:"inertia",velocity:s?t[I]:0,bounceStiffness:L,bounceDamping:z,timeConstant:750,restDelta:1,restSpeed:10,...m,...M};return this.startAxisValueAnimation(I,G)});return Promise.all(A).then(i)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return kP(this.visualElement,t),s.start(LM(t,s,0,n,this.visualElement,!1))}stopAnimation(){al(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){al(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),h=s[n];return h||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){al(n=>{const{drag:s}=this.getProps();if(!l1(n,s,this.currentDirection))return;const{projection:h}=this.visualElement,m=this.getAxisMotionValue(n);if(h&&h.layout){const{min:_,max:i}=h.layout.layoutBox[n];m.set(t[n]-Ao(_,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!Bm(n)||!s||!this.constraints)return;this.stopAnimation();const h={x:0,y:0};al(_=>{const i=this.getAxisMotionValue(_);if(i&&this.constraints!==!1){const S=i.get();h[_]=sie({min:S,max:S},this.constraints[_])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),al(_=>{if(!l1(_,t,null))return;const i=this.getAxisMotionValue(_),{min:S,max:A}=this.constraints[_];i.set(Ao(S,A,h[_]))})}addListeners(){if(!this.visualElement.current)return;cie.set(this.visualElement,this);const t=this.visualElement.current,n=Mv(t,"pointerdown",S=>{const{drag:A,dragListener:I=!0}=this.getProps();A&&I&&this.start(S)}),s=()=>{const{dragConstraints:S}=this.getProps();Bm(S)&&S.current&&(this.constraints=this.resolveRefConstraints())},{projection:h}=this.visualElement,m=h.addEventListener("measure",s);h&&!h.layout&&(h.root&&h.root.updateScroll(),h.updateLayout()),Ui.read(s);const _=$v(window,"resize",()=>this.scalePositionWithinConstraints()),i=h.addEventListener("didUpdate",({delta:S,hasLayoutChanged:A})=>{this.isDragging&&A&&(al(I=>{const M=this.getAxisMotionValue(I);M&&(this.originPoint[I]+=S[I].translate,M.set(M.get()+S[I].translate))}),this.visualElement.render())});return()=>{_(),n(),m(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:h=!1,dragConstraints:m=!1,dragElastic:_=LP,dragMomentum:i=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:h,dragConstraints:m,dragElastic:_,dragMomentum:i}}}function l1(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function hie(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class die extends Yh{constructor(t){super(t),this.removeGroupControls=_a,this.removeListeners=_a,this.controls=new uie(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||_a}unmount(){this.removeGroupControls(),this.removeListeners()}}const MN=e=>(t,n)=>{e&&Ui.postRender(()=>e(t,n))};class fie extends Yh{constructor(){super(...arguments),this.removePointerDownListener=_a}onPointerDown(t){this.session=new D$(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:R$(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:h}=this.node.getProps();return{onSessionStart:MN(t),onStart:MN(n),onMove:s,onEnd:(m,_)=>{delete this.session,h&&Ui.postRender(()=>h(m,_))}}}mount(){this.removePointerDownListener=Mv(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const $1={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let lA=!1;class pie extends B.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:h}=this.props,{projection:m}=t;m&&(n.group&&n.group.add(m),s&&s.register&&h&&s.register(m),lA&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),$1.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:h,isPresent:m}=this.props,{projection:_}=s;return _&&(_.isPresent=m,lA=!0,h||t.layoutDependency!==n||n===void 0||t.isPresent!==m?_.willUpdate():this.safeToRemove(),t.isPresent!==m&&(m?_.promote():_.relegate()||Ui.postRender(()=>{const i=_.getStack();(!i||!i.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),EM.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:h}=t;lA=!0,h&&(h.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(h),s&&s.deregister&&s.deregister(h))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function j$(e){const[t,n]=n$(),s=B.useContext(rM);return b.jsx(pie,{...e,layoutGroup:s,switchLayoutGroup:B.useContext(m$),isPresent:t,safeToRemove:n})}function mie(e,t,n){const s=$s(e)?e:rc(e);return s.start(LM("",s,t,n)),s.animation}const gie=(e,t)=>e.depth-t.depth;class yie{constructor(){this.children=[],this.isDirty=!1}add(t){iM(this.children,t),this.isDirty=!0}remove(t){oM(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(gie),this.isDirty=!1,this.children.forEach(t)}}function _ie(e,t){const n=ga.now(),s=({timestamp:h})=>{const m=h-n;m>=t&&(lc(s),e(m-t))};return Ui.setup(s,!0),()=>lc(s)}const L$=["TopLeft","TopRight","BottomLeft","BottomRight"],vie=L$.length,ON=e=>typeof e=="string"?parseFloat(e):e,RN=e=>typeof e=="number"||Nn.test(e);function xie(e,t,n,s,h,m){h?(e.opacity=Ao(0,n.opacity??1,bie(s)),e.opacityExit=Ao(t.opacity??1,0,wie(s))):m&&(e.opacity=Ao(t.opacity??1,n.opacity??1,s));for(let _=0;_<vie;_++){const i=`border${L$[_]}Radius`;let S=DN(t,i),A=DN(n,i);if(S===void 0&&A===void 0)continue;S||(S=0),A||(A=0),S===0||A===0||RN(S)===RN(A)?(e[i]=Math.max(Ao(ON(S),ON(A),s),0),(Gc.test(A)||Gc.test(S))&&(e[i]+="%")):e[i]=A}(t.rotate||n.rotate)&&(e.rotate=Ao(t.rotate||0,n.rotate||0,s))}function DN(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const bie=N$(0,.5,xV),wie=N$(.5,.95,_a);function N$(e,t,n){return s=>s<e?0:s>t?1:n(lg(e,t,s))}function kN(e,t){e.min=t.min,e.max=t.max}function ql(e,t){kN(e.x,t.x),kN(e.y,t.y)}function jN(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function LN(e,t,n,s,h){return e-=t,e=ow(e,1/n,s),h!==void 0&&(e=ow(e,1/h,s)),e}function Tie(e,t=0,n=1,s=.5,h,m=e,_=e){if(Gc.test(t)&&(t=parseFloat(t),t=Ao(_.min,_.max,t/100)-_.min),typeof t!="number")return;let i=Ao(m.min,m.max,s);e===m&&(i-=t),e.min=LN(e.min,t,n,i,h),e.max=LN(e.max,t,n,i,h)}function NN(e,t,[n,s,h],m,_){Tie(e,t[n],t[s],t[h],t.scale,m,_)}const Sie=["x","scaleX","originX"],Eie=["y","scaleY","originY"];function zN(e,t,n,s){NN(e.x,t,Sie,n?n.x:void 0,s?s.x:void 0),NN(e.y,t,Eie,n?n.y:void 0,s?s.y:void 0)}function FN(e){return e.translate===0&&e.scale===1}function z$(e){return FN(e.x)&&FN(e.y)}function BN(e,t){return e.min===t.min&&e.max===t.max}function Aie(e,t){return BN(e.x,t.x)&&BN(e.y,t.y)}function VN(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function F$(e,t){return VN(e.x,t.x)&&VN(e.y,t.y)}function $N(e){return ea(e.x)/ea(e.y)}function UN(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Pie{constructor(){this.members=[]}add(t){iM(this.members,t),t.scheduleRender()}remove(t){if(oM(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(h=>t===h);if(n===0)return!1;let s;for(let h=n;h>=0;h--){const m=this.members[h];if(m.isPresent!==!1){s=m;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:h}=t.options;h===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Cie(e,t,n){let s="";const h=e.x.translate/t.x,m=e.y.translate/t.y,_=n?.z||0;if((h||m||_)&&(s=`translate3d(${h}px, ${m}px, ${_}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:A,rotate:I,rotateX:M,rotateY:L,skewX:z,skewY:G}=n;A&&(s=`perspective(${A}px) ${s}`),I&&(s+=`rotate(${I}deg) `),M&&(s+=`rotateX(${M}deg) `),L&&(s+=`rotateY(${L}deg) `),z&&(s+=`skewX(${z}deg) `),G&&(s+=`skewY(${G}deg) `)}const i=e.x.scale*t.x,S=e.y.scale*t.y;return(i!==1||S!==1)&&(s+=`scale(${i}, ${S})`),s||"none"}const cA=["","X","Y","Z"],Iie=1e3;let Mie=0;function uA(e,t,n,s){const{latestValues:h}=t;h[e]&&(n[e]=h[e],t.setStaticValue(e,0),s&&(s[e]=0))}function B$(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=E$(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:h,layoutId:m}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Ui,!(h||m))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&B$(s)}function V$({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:h}){return class{constructor(_={},i=t?.()){this.id=Mie++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Die),this.nodes.forEach(Nie),this.nodes.forEach(zie),this.nodes.forEach(kie)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=_,this.root=i?i.root||i:this,this.path=i?[...i.path,i]:[],this.parent=i,this.depth=i?i.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new yie)}addEventListener(_,i){return this.eventHandlers.has(_)||this.eventHandlers.set(_,new aM),this.eventHandlers.get(_).add(i)}notifyListeners(_,...i){const S=this.eventHandlers.get(_);S&&S.notify(...i)}hasListeners(_){return this.eventHandlers.has(_)}mount(_){if(this.instance)return;this.isSVG=PM(_)&&!bre(_),this.instance=_;const{layoutId:i,layout:S,visualElement:A}=this.options;if(A&&!A.current&&A.mount(_),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(S||i)&&(this.isLayoutDirty=!0),e){let I,M=0;const L=()=>this.root.updateBlockedByResize=!1;Ui.read(()=>{M=window.innerWidth}),e(_,()=>{const z=window.innerWidth;z!==M&&(M=z,this.root.updateBlockedByResize=!0,I&&I(),I=_ie(L,250),$1.hasAnimatedSinceResize&&($1.hasAnimatedSinceResize=!1,this.nodes.forEach(WN)))})}i&&this.root.registerSharedNode(i,this),this.options.animate!==!1&&A&&(i||S)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:M,hasRelativeLayoutChanged:L,layout:z})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||A.getDefaultTransition()||Uie,{onLayoutAnimationStart:F,onLayoutAnimationComplete:U}=A.getProps(),K=!this.targetLayout||!F$(this.targetLayout,z),J=!M&&L;if(this.options.layoutRoot||this.resumeFrom||J||M&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const X={...bM(G,"layout"),onPlay:F,onComplete:U};(A.shouldReduceMotion||this.options.layoutRoot)&&(X.delay=0,X.type=!1),this.startAnimation(X),this.setAnimationOrigin(I,J)}else M||WN(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=z})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const _=this.getStack();_&&_.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),lc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Fie),this.animationId++)}getTransformTemplate(){const{visualElement:_}=this.options;return _&&_.getProps().transformTemplate}willUpdate(_=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&B$(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let I=0;I<this.path.length;I++){const M=this.path[I];M.shouldResetTransform=!0,M.updateScroll("snapshot"),M.options.layoutRoot&&M.willUpdate(!1)}const{layoutId:i,layout:S}=this.options;if(i===void 0&&!S)return;const A=this.getTransformTemplate();this.prevTransformTemplateValue=A?A(this.latestValues,""):void 0,this.updateSnapshot(),_&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(GN);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(HN);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Lie),this.nodes.forEach(Oie),this.nodes.forEach(Rie)):this.nodes.forEach(HN),this.clearAllSnapshots();const i=ga.now();xs.delta=Xc(0,1e3/60,i-xs.timestamp),xs.timestamp=i,xs.isProcessing=!0,JE.update.process(xs),JE.preRender.process(xs),JE.render.process(xs),xs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,EM.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(jie),this.sharedNodes.forEach(Bie)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ui.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ui.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ea(this.snapshot.measuredBox.x)&&!ea(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const _=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=is(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:i}=this.options;i&&i.notify("LayoutMeasure",this.layout.layoutBox,_?_.layoutBox:void 0)}updateScroll(_="measure"){let i=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===_&&(i=!1),i&&this.instance){const S=s(this.instance);this.scroll={animationId:this.root.animationId,phase:_,isRoot:S,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:S}}}resetTransform(){if(!h)return;const _=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,i=this.projectionDelta&&!z$(this.projectionDelta),S=this.getTransformTemplate(),A=S?S(this.latestValues,""):void 0,I=A!==this.prevTransformTemplateValue;_&&this.instance&&(i||sf(this.latestValues)||I)&&(h(this.instance,A),this.shouldResetTransform=!1,this.scheduleRender())}measure(_=!0){const i=this.measurePageBox();let S=this.removeElementScroll(i);return _&&(S=this.removeTransform(S)),Gie(S),{animationId:this.root.animationId,measuredBox:i,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:_}=this.options;if(!_)return is();const i=_.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Hie))){const{scroll:A}=this.root;A&&(Vm(i.x,A.offset.x),Vm(i.y,A.offset.y))}return i}removeElementScroll(_){const i=is();if(ql(i,_),this.scroll?.wasRoot)return i;for(let S=0;S<this.path.length;S++){const A=this.path[S],{scroll:I,options:M}=A;A!==this.root&&I&&M.layoutScroll&&(I.wasRoot&&ql(i,_),Vm(i.x,I.offset.x),Vm(i.y,I.offset.y))}return i}applyTransform(_,i=!1){const S=is();ql(S,_);for(let A=0;A<this.path.length;A++){const I=this.path[A];!i&&I.options.layoutScroll&&I.scroll&&I!==I.root&&$m(S,{x:-I.scroll.offset.x,y:-I.scroll.offset.y}),sf(I.latestValues)&&$m(S,I.latestValues)}return sf(this.latestValues)&&$m(S,this.latestValues),S}removeTransform(_){const i=is();ql(i,_);for(let S=0;S<this.path.length;S++){const A=this.path[S];if(!A.instance||!sf(A.latestValues))continue;MP(A.latestValues)&&A.updateSnapshot();const I=is(),M=A.measurePageBox();ql(I,M),zN(i,A.latestValues,A.snapshot?A.snapshot.layoutBox:void 0,I)}return sf(this.latestValues)&&zN(i,this.latestValues),i}setTargetDelta(_){this.targetDelta=_,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(_){this.options={...this.options,..._,crossfade:_.crossfade!==void 0?_.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==xs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(_=!1){const i=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=i.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=i.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=i.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==i;if(!(_||S&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:M}=this.options;if(!this.layout||!(I||M))return;this.resolvedRelativeTargetAt=xs.timestamp;const L=this.getClosestProjectingParent();L&&this.linkedParentVersion!==L.layoutVersion&&!L.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(L&&L.layout?this.createRelativeTarget(L,this.layout.layoutBox,L.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=is(),this.targetWithTransforms=is()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Qne(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ql(this.target,this.layout.layoutBox),v$(this.target,this.targetDelta)):ql(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?this.createRelativeTarget(L,this.target,L.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||MP(this.parent.latestValues)||_$(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(_,i,S){this.relativeParent=_,this.linkedParentVersion=_.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=is(),this.relativeTargetOrigin=is(),sw(this.relativeTargetOrigin,i,S),ql(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const _=this.getLead(),i=!!this.resumingFrom||this!==_;let S=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(S=!1),i&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===xs.timestamp&&(S=!1),S)return;const{layout:A,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(A||I))return;ql(this.layoutCorrected,this.layout.layoutBox);const M=this.treeScale.x,L=this.treeScale.y;hne(this.layoutCorrected,this.treeScale,this.path,i),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=is());const{target:z}=_;if(!z){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(jN(this.prevProjectionDelta.x,this.projectionDelta.x),jN(this.prevProjectionDelta.y,this.projectionDelta.y)),Ov(this.projectionDelta,this.layoutCorrected,z,this.latestValues),(this.treeScale.x!==M||this.treeScale.y!==L||!UN(this.projectionDelta.x,this.prevProjectionDelta.x)||!UN(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",z))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(_=!0){if(this.options.visualElement?.scheduleRender(),_){const i=this.getStack();i&&i.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Um(),this.projectionDelta=Um(),this.projectionDeltaWithTransform=Um()}setAnimationOrigin(_,i=!1){const S=this.snapshot,A=S?S.latestValues:{},I={...this.latestValues},M=Um();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!i;const L=is(),z=S?S.source:void 0,G=this.layout?this.layout.source:void 0,F=z!==G,U=this.getStack(),K=!U||U.members.length<=1,J=!!(F&&!K&&this.options.crossfade===!0&&!this.path.some($ie));this.animationProgress=0;let X;this.mixTargetDelta=ie=>{const Q=ie/1e3;qN(M.x,_.x,Q),qN(M.y,_.y,Q),this.setTargetDelta(M),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(sw(L,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Vie(this.relativeTarget,this.relativeTargetOrigin,L,Q),X&&Aie(this.relativeTarget,X)&&(this.isProjectionDirty=!1),X||(X=is()),ql(X,this.relativeTarget)),F&&(this.animationValues=I,xie(I,A,this.latestValues,Q,J,K)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Q},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(_){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(lc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ui.update(()=>{$1.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=rc(0)),this.currentAnimation=mie(this.motionValue,[0,1e3],{..._,velocity:0,isSync:!0,onUpdate:i=>{this.mixTargetDelta(i),_.onUpdate&&_.onUpdate(i)},onStop:()=>{},onComplete:()=>{_.onComplete&&_.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const _=this.getStack();_&&_.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Iie),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const _=this.getLead();let{targetWithTransforms:i,target:S,layout:A,latestValues:I}=_;if(!(!i||!S||!A)){if(this!==_&&this.layout&&A&&$$(this.options.animationType,this.layout.layoutBox,A.layoutBox)){S=this.target||is();const M=ea(this.layout.layoutBox.x);S.x.min=_.target.x.min,S.x.max=S.x.min+M;const L=ea(this.layout.layoutBox.y);S.y.min=_.target.y.min,S.y.max=S.y.min+L}ql(i,S),$m(i,I),Ov(this.projectionDeltaWithTransform,this.layoutCorrected,i,I)}}registerSharedNode(_,i){this.sharedNodes.has(_)||this.sharedNodes.set(_,new Pie),this.sharedNodes.get(_).add(i);const A=i.options.initialPromotionConfig;i.promote({transition:A?A.transition:void 0,preserveFollowOpacity:A&&A.shouldPreserveFollowOpacity?A.shouldPreserveFollowOpacity(i):void 0})}isLead(){const _=this.getStack();return _?_.lead===this:!0}getLead(){const{layoutId:_}=this.options;return _?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:_}=this.options;return _?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:_}=this.options;if(_)return this.root.sharedNodes.get(_)}promote({needsReset:_,transition:i,preserveFollowOpacity:S}={}){const A=this.getStack();A&&A.promote(this,S),_&&(this.projectionDelta=void 0,this.needsReset=!0),i&&this.setOptions({transition:i})}relegate(){const _=this.getStack();return _?_.relegate(this):!1}resetSkewAndRotation(){const{visualElement:_}=this.options;if(!_)return;let i=!1;const{latestValues:S}=_;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(i=!0),!i)return;const A={};S.z&&uA("z",_,A,this.animationValues);for(let I=0;I<cA.length;I++)uA(`rotate${cA[I]}`,_,A,this.animationValues),uA(`skew${cA[I]}`,_,A,this.animationValues);_.render();for(const I in A)_.setStaticValue(I,A[I]),this.animationValues&&(this.animationValues[I]=A[I]);_.scheduleRender()}applyProjectionStyles(_,i){if(!this.instance||this.isSVG)return;if(!this.isVisible){_.visibility="hidden";return}const S=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,_.visibility="",_.opacity="",_.pointerEvents=V1(i?.pointerEvents)||"",_.transform=S?S(this.latestValues,""):"none";return}const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){this.options.layoutId&&(_.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,_.pointerEvents=V1(i?.pointerEvents)||""),this.hasProjected&&!sf(this.latestValues)&&(_.transform=S?S({},""):"none",this.hasProjected=!1);return}_.visibility="";const I=A.animationValues||A.latestValues;this.applyTransformsToTarget();let M=Cie(this.projectionDeltaWithTransform,this.treeScale,I);S&&(M=S(I,M)),_.transform=M;const{x:L,y:z}=this.projectionDelta;_.transformOrigin=`${L.origin*100}% ${z.origin*100}% 0`,A.animationValues?_.opacity=A===this?I.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:I.opacityExit:_.opacity=A===this?I.opacity!==void 0?I.opacity:"":I.opacityExit!==void 0?I.opacityExit:0;for(const G in IP){if(I[G]===void 0)continue;const{correct:F,applyTo:U,isCSSVariable:K}=IP[G],J=M==="none"?I[G]:F(I[G],A);if(U){const X=U.length;for(let ie=0;ie<X;ie++)_[U[ie]]=J}else K?this.options.visualElement.renderState.vars[G]=J:_[G]=J}this.options.layoutId&&(_.pointerEvents=A===this?V1(i?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(_=>_.currentAnimation?.stop()),this.root.nodes.forEach(GN),this.root.sharedNodes.clear()}}}function Oie(e){e.updateLayout()}function Rie(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:s}=e.layout,{animationType:h}=e.options,m=t.source!==e.layout.source;h==="size"?al(I=>{const M=m?t.measuredBox[I]:t.layoutBox[I],L=ea(M);M.min=n[I].min,M.max=M.min+L}):$$(h,t.layoutBox,n)&&al(I=>{const M=m?t.measuredBox[I]:t.layoutBox[I],L=ea(n[I]);M.max=M.min+L,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[I].max=e.relativeTarget[I].min+L)});const _=Um();Ov(_,n,t.layoutBox);const i=Um();m?Ov(i,e.applyTransform(s,!0),t.measuredBox):Ov(i,n,t.layoutBox);const S=!z$(_);let A=!1;if(!e.resumeFrom){const I=e.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:M,layout:L}=I;if(M&&L){const z=is();sw(z,t.layoutBox,M.layoutBox);const G=is();sw(G,n,L.layoutBox),F$(z,G)||(A=!0),I.options.layoutRoot&&(e.relativeTarget=G,e.relativeTargetOrigin=z,e.relativeParent=I)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:i,layoutDelta:_,hasLayoutChanged:S,hasRelativeLayoutChanged:A})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Die(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function kie(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function jie(e){e.clearSnapshot()}function GN(e){e.clearMeasurements()}function HN(e){e.isLayoutDirty=!1}function Lie(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function WN(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Nie(e){e.resolveTargetDelta()}function zie(e){e.calcProjection()}function Fie(e){e.resetSkewAndRotation()}function Bie(e){e.removeLeadSnapshot()}function qN(e,t,n){e.translate=Ao(t.translate,0,n),e.scale=Ao(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function ZN(e,t,n,s){e.min=Ao(t.min,n.min,s),e.max=Ao(t.max,n.max,s)}function Vie(e,t,n,s){ZN(e.x,t.x,n.x,s),ZN(e.y,t.y,n.y,s)}function $ie(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Uie={duration:.45,ease:[.4,0,.1,1]},XN=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),KN=XN("applewebkit/")&&!XN("chrome/")?Math.round:_a;function YN(e){e.min=KN(e.min),e.max=KN(e.max)}function Gie(e){YN(e.x),YN(e.y)}function $$(e,t,n){return e==="position"||e==="preserve-aspect"&&!Jne($N(t),$N(n),.2)}function Hie(e){return e!==e.root&&e.scroll?.wasRoot}const Wie=V$({attachResizeListener:(e,t)=>$v(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),hA={current:void 0},U$=V$({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!hA.current){const e=new Wie({});e.mount(window),e.setOptions({layoutScroll:!0}),hA.current=e}return hA.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),qie={pan:{Feature:fie},drag:{Feature:die,ProjectionNode:U$,MeasureLayout:j$}};function JN(e,t,n){const{props:s}=e;e.animationState&&s.whileHover&&e.animationState.setActive("whileHover",n==="Start");const h="onHover"+n,m=s[h];m&&Ui.postRender(()=>m(t,B0(t)))}class Zie extends Yh{mount(){const{current:t}=this.node;t&&(this.unmount=are(t,(n,s)=>(JN(this.node,s,"Start"),h=>JN(this.node,h,"End"))))}unmount(){}}class Xie extends Yh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=N0($v(this.node.current,"focus",()=>this.onFocus()),$v(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function QN(e,t,n){const{props:s}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&s.whileTap&&e.animationState.setActive("whileTap",n==="Start");const h="onTap"+(n==="End"?"":n),m=s[h];m&&Ui.postRender(()=>m(t,B0(t)))}class Kie extends Yh{mount(){const{current:t}=this.node;t&&(this.unmount=hre(t,(n,s)=>(QN(this.node,s,"Start"),(h,{success:m})=>QN(this.node,h,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const NP=new WeakMap,dA=new WeakMap,Yie=e=>{const t=NP.get(e.target);t&&t(e)},Jie=e=>{e.forEach(Yie)};function Qie({root:e,...t}){const n=e||document;dA.has(n)||dA.set(n,{});const s=dA.get(n),h=JSON.stringify(t);return s[h]||(s[h]=new IntersectionObserver(Jie,{root:e,...t})),s[h]}function eoe(e,t,n){const s=Qie(t);return NP.set(e,n),s.observe(e),()=>{NP.delete(e),s.unobserve(e)}}const toe={some:0,all:1};class roe extends Yh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:h="some",once:m}=t,_={root:n?n.current:void 0,rootMargin:s,threshold:typeof h=="number"?h:toe[h]},i=S=>{const{isIntersecting:A}=S;if(this.isInView===A||(this.isInView=A,m&&!A&&this.hasEnteredView))return;A&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",A);const{onViewportEnter:I,onViewportLeave:M}=this.node.getProps(),L=A?I:M;L&&L(S)};return eoe(this.node.current,_,i)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(noe(t,n))&&this.startObserver()}unmount(){}}function noe({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const ioe={inView:{Feature:roe},tap:{Feature:Kie},focus:{Feature:Xie},hover:{Feature:Zie}},ooe={layout:{ProjectionNode:U$,MeasureLayout:j$}},soe={...Wne,...ioe,...qie,...ooe},_n=lne(soe,bne),aoe=50,ez=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),loe=()=>({time:0,x:ez(),y:ez()}),coe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function tz(e,t,n,s){const h=n[t],{length:m,position:_}=coe[t],i=h.current,S=n.time;h.current=e[`scroll${_}`],h.scrollLength=e[`scroll${m}`]-e[`client${m}`],h.offset.length=0,h.offset[0]=0,h.offset[1]=h.scrollLength,h.progress=lg(0,h.scrollLength,h.current);const A=s-S;h.velocity=A>aoe?0:lM(h.current-i,A)}function uoe(e,t,n){tz(e,"x",t,n),tz(e,"y",t,n),t.time=n}function hoe(e,t){const n={x:0,y:0};let s=e;for(;s&&s!==t;)if(SM(s))n.x+=s.offsetLeft,n.y+=s.offsetTop,s=s.offsetParent;else if(s.tagName==="svg"){const h=s.getBoundingClientRect();s=s.parentElement;const m=s.getBoundingClientRect();n.x+=h.left-m.left,n.y+=h.top-m.top}else if(s instanceof SVGGraphicsElement){const{x:h,y:m}=s.getBBox();n.x+=h,n.y+=m;let _=null,i=s.parentNode;for(;!_;)i.tagName==="svg"&&(_=i),i=s.parentNode;s=_}else break;return n}const zP={start:0,center:.5,end:1};function rz(e,t,n=0){let s=0;if(e in zP&&(e=zP[e]),typeof e=="string"){const h=parseFloat(e);e.endsWith("px")?s=h:e.endsWith("%")?e=h/100:e.endsWith("vw")?s=h/100*document.documentElement.clientWidth:e.endsWith("vh")?s=h/100*document.documentElement.clientHeight:e=h}return typeof e=="number"&&(s=t*e),n+s}const doe=[0,0];function foe(e,t,n,s){let h=Array.isArray(e)?e:doe,m=0,_=0;return typeof e=="number"?h=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?h=e.split(" "):h=[e,zP[e]?e:"0"]),m=rz(h[0],n,s),_=rz(h[1],t),m-_}const poe={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},moe={x:0,y:0};function goe(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function yoe(e,t,n){const{offset:s=poe.All}=n,{target:h=e,axis:m="y"}=n,_=m==="y"?"height":"width",i=h!==e?hoe(h,e):moe,S=h===e?{width:e.scrollWidth,height:e.scrollHeight}:goe(h),A={width:e.clientWidth,height:e.clientHeight};t[m].offset.length=0;let I=!t[m].interpolate;const M=s.length;for(let L=0;L<M;L++){const z=foe(s[L],A[_],S[_],i[m]);!I&&z!==t[m].interpolatorOffsets[L]&&(I=!0),t[m].offset[L]=z}I&&(t[m].interpolate=gM(t[m].offset,LV(s),{clamp:!1}),t[m].interpolatorOffsets=[...t[m].offset]),t[m].progress=Xc(0,1,t[m].interpolate(t[m].current))}function _oe(e,t=e,n){if(n.x.targetOffset=0,n.y.targetOffset=0,t!==e){let s=t;for(;s&&s!==e;)n.x.targetOffset+=s.offsetLeft,n.y.targetOffset+=s.offsetTop,s=s.offsetParent}n.x.targetLength=t===e?t.scrollWidth:t.clientWidth,n.y.targetLength=t===e?t.scrollHeight:t.clientHeight,n.x.containerLength=e.clientWidth,n.y.containerLength=e.clientHeight}function voe(e,t,n,s={}){return{measure:h=>{_oe(e,s.target,n),uoe(e,n,h),(s.offset||s.target)&&yoe(e,n,s)},notify:()=>t(n)}}const sv=new WeakMap,nz=new WeakMap,fA=new WeakMap,iz=e=>e===document.scrollingElement?window:e;function G$(e,{container:t=document.scrollingElement,...n}={}){if(!t)return _a;let s=fA.get(t);s||(s=new Set,fA.set(t,s));const h=loe(),m=voe(t,e,h,n);if(s.add(m),!sv.has(t)){const i=()=>{for(const M of s)M.measure(xs.timestamp);Ui.preUpdate(S)},S=()=>{for(const M of s)M.notify()},A=()=>Ui.read(i);sv.set(t,A);const I=iz(t);window.addEventListener("resize",A,{passive:!0}),t!==document.documentElement&&nz.set(t,xre(t,A)),I.addEventListener("scroll",A,{passive:!0}),A()}const _=sv.get(t);return Ui.read(_,!1,!0),()=>{lc(_);const i=fA.get(t);if(!i||(i.delete(m),i.size))return;const S=sv.get(t);sv.delete(t),S&&(iz(t).removeEventListener("scroll",S),nz.get(t)?.(),window.removeEventListener("resize",S))}}const oz=new Map;function xoe(e){const t={value:0},n=G$(s=>{t.value=s[e.axis].progress*100},e);return{currentTime:t,cancel:n}}function H$({source:e,container:t,...n}){const{axis:s}=n;e&&(t=e);const h=oz.get(t)??new Map;oz.set(t,h);const m=n.target??"self",_=h.get(m)??{},i=s+(n.offset??[]).join(",");return _[i]||(_[i]=!n.target&&BV()?new ScrollTimeline({source:t,axis:s}):xoe({container:t,...n})),_[i]}function boe(e,t){const n=H$(t);return e.attachTimeline({timeline:t.target?void 0:n,observe:s=>(s.pause(),r$(h=>{s.time=s.iterationDuration*h},n))})}function woe(e){return e.length===2}function Toe(e,t){return woe(e)?G$(n=>{e(n[t.axis].progress,n)},t):r$(e,H$(t))}function Soe(e,{axis:t="y",container:n=document.scrollingElement,...s}={}){if(!n)return _a;const h={axis:t,container:n,...s};return typeof e=="function"?Toe(e,h):boe(e,h)}const Eoe=()=>({scrollX:rc(0),scrollY:rc(0),scrollXProgress:rc(0),scrollYProgress:rc(0)}),c1=e=>e?!e.current:!1;function Aoe({container:e,target:t,...n}={}){const s=Ug(Eoe),h=B.useRef(null),m=B.useRef(!1),_=B.useCallback(()=>(h.current=Soe((i,{x:S,y:A})=>{s.scrollX.set(S.current),s.scrollXProgress.set(S.progress),s.scrollY.set(A.current),s.scrollYProgress.set(A.progress)},{...n,container:e?.current||void 0,target:t?.current||void 0}),()=>{h.current?.()}),[e,t,JSON.stringify(n.offset)]);return MT(()=>{if(m.current=!1,c1(e)||c1(t)){m.current=!0;return}else return _()},[_]),B.useEffect(()=>{if(m.current)return ag(!c1(e)),ag(!c1(t)),_()},[_]),s}function Poe(e){const t=Ug(()=>rc(e)),{isStatic:n}=B.useContext(RT);if(n){const[,s]=B.useState(e);B.useEffect(()=>t.on("change",s),[])}return t}function W$(e,t){const n=Poe(t()),s=()=>n.set(t());return s(),MT(()=>{const h=()=>Ui.preRender(s,!1,!0),m=e.map(_=>_.on("change",h));return()=>{m.forEach(_=>_()),lc(s)}}),n}function Coe(e){Iv.current=[],e();const t=W$(Iv.current,e);return Iv.current=void 0,t}function Ioe(e,t,n,s){if(typeof e=="function")return Coe(e);const h=typeof t=="function"?t:wre(t,n,s);return Array.isArray(e)?sz(e,h):sz([e],([m])=>h(m))}function sz(e,t){const n=Ug(()=>[]);return W$(e,()=>{n.length=0;const s=e.length;for(let h=0;h<s;h++)n[h]=e[h].get();return t(n)})}const Moe={some:0,all:1};function Ooe(e,t,{root:n,margin:s,amount:h="some"}={}){const m=TM(e),_=new WeakMap,i=A=>{A.forEach(I=>{const M=_.get(I.target);if(I.isIntersecting!==!!M)if(I.isIntersecting){const L=t(I.target,I);typeof L=="function"?_.set(I.target,L):S.unobserve(I.target)}else typeof M=="function"&&(M(I),_.delete(I.target))})},S=new IntersectionObserver(i,{root:n,rootMargin:s,threshold:typeof h=="number"?h:Moe[h]});return m.forEach(A=>S.observe(A)),()=>S.disconnect()}function Roe(e,{root:t,margin:n,amount:s,once:h=!1,initial:m=!1}={}){const[_,i]=B.useState(m);return B.useEffect(()=>{if(!e.current||h&&_)return;const S=()=>(i(!0),h?void 0:()=>i(!1)),A={root:t&&t.current||void 0,margin:n,amount:s};return Ooe(e.current,S,A)},[t,e,n,h,s]),_}function Doe(){const[e,t]=B.useState(!1);B.useEffect(()=>{const s=()=>t(window.scrollY>360);return window.addEventListener("scroll",s,{passive:!0}),s(),()=>window.removeEventListener("scroll",s)},[]);const n=()=>window.scrollTo({top:0,behavior:"smooth"});return b.jsx(cg,{children:e&&b.jsx(_n.button,{initial:{opacity:0,y:16,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:12},onClick:n,"aria-label":"Back to top",className:"fixed right-6 bottom-6 z-50 rounded-full bg-primary text-primary-foreground shadow-lg p-3 hover:scale-105 focus:outline-none",children:b.jsx(qK,{className:"h-4 w-4"})})})}var V0=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},LT=typeof window>"u"||"Deno"in globalThis;function cl(){}function koe(e,t){return typeof e=="function"?e(t):e}function joe(e){return typeof e=="number"&&e>=0&&e!==1/0}function Loe(e,t){return Math.max(e+(t||0)-Date.now(),0)}function FP(e,t){return typeof e=="function"?e(t):e}function Noe(e,t){return typeof e=="function"?e(t):e}function az(e,t){const{type:n="all",exact:s,fetchStatus:h,predicate:m,queryKey:_,stale:i}=e;if(_){if(s){if(t.queryHash!==NM(_,t.options))return!1}else if(!Uv(t.queryKey,_))return!1}if(n!=="all"){const S=t.isActive();if(n==="active"&&!S||n==="inactive"&&S)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||h&&h!==t.state.fetchStatus||m&&!m(t))}function lz(e,t){const{exact:n,status:s,predicate:h,mutationKey:m}=e;if(m){if(!t.options.mutationKey)return!1;if(n){if(Sf(t.options.mutationKey)!==Sf(m))return!1}else if(!Uv(t.options.mutationKey,m))return!1}return!(s&&t.state.status!==s||h&&!h(t))}function NM(e,t){return(t?.queryKeyHashFn||Sf)(e)}function Sf(e){return JSON.stringify(e,(t,n)=>BP(n)?Object.keys(n).sort().reduce((s,h)=>(s[h]=n[h],s),{}):n)}function Uv(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Uv(e[n],t[n])):!1}function q$(e,t){if(e===t)return e;const n=cz(e)&&cz(t);if(n||BP(e)&&BP(t)){const s=n?e:Object.keys(e),h=s.length,m=n?t:Object.keys(t),_=m.length,i=n?[]:{},S=new Set(s);let A=0;for(let I=0;I<_;I++){const M=n?I:m[I];(!n&&S.has(M)||n)&&e[M]===void 0&&t[M]===void 0?(i[M]=void 0,A++):(i[M]=q$(e[M],t[M]),i[M]===e[M]&&e[M]!==void 0&&A++)}return h===_&&A===h?e:i}return t}function zoe(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function cz(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function BP(e){if(!uz(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!uz(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function uz(e){return Object.prototype.toString.call(e)==="[object Object]"}function Foe(e){return new Promise(t=>{setTimeout(t,e)})}function Boe(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?q$(e,t):t}function Voe(e,t,n=0){const s=[...e,t];return n&&s.length>n?s.slice(1):s}function $oe(e,t,n=0){const s=[t,...e];return n&&s.length>n?s.slice(0,-1):s}var zM=Symbol();function Z$(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===zM?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Uoe(e,t){return typeof e=="function"?e(...t):!!e}var Goe=class extends V0{#e;#t;#r;constructor(){super(),this.#r=e=>{if(!LT&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},X$=new Goe,Hoe=class extends V0{#e=!0;#t;#r;constructor(){super(),this.#r=e=>{if(!LT&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(n=>{n(e)}))}isOnline(){return this.#e}},aw=new Hoe;function Woe(){let e,t;const n=new Promise((h,m)=>{e=h,t=m});n.status="pending",n.catch(()=>{});function s(h){Object.assign(n,h),delete n.resolve,delete n.reject}return n.resolve=h=>{s({status:"fulfilled",value:h}),e(h)},n.reject=h=>{s({status:"rejected",reason:h}),t(h)},n}function qoe(e){return Math.min(1e3*2**e,3e4)}function K$(e){return(e??"online")==="online"?aw.isOnline():!0}var Y$=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function pA(e){return e instanceof Y$}function J$(e){let t=!1,n=0,s=!1,h;const m=Woe(),_=F=>{s||(L(new Y$(F)),e.abort?.())},i=()=>{t=!0},S=()=>{t=!1},A=()=>X$.isFocused()&&(e.networkMode==="always"||aw.isOnline())&&e.canRun(),I=()=>K$(e.networkMode)&&e.canRun(),M=F=>{s||(s=!0,e.onSuccess?.(F),h?.(),m.resolve(F))},L=F=>{s||(s=!0,e.onError?.(F),h?.(),m.reject(F))},z=()=>new Promise(F=>{h=U=>{(s||A())&&F(U)},e.onPause?.()}).then(()=>{h=void 0,s||e.onContinue?.()}),G=()=>{if(s)return;let F;const U=n===0?e.initialPromise:void 0;try{F=U??e.fn()}catch(K){F=Promise.reject(K)}Promise.resolve(F).then(M).catch(K=>{if(s)return;const J=e.retry??(LT?0:3),X=e.retryDelay??qoe,ie=typeof X=="function"?X(n,K):X,Q=J===!0||typeof J=="number"&&n<J||typeof J=="function"&&J(n,K);if(t||!Q){L(K);return}n++,e.onFail?.(n,K),Foe(ie).then(()=>A()?void 0:z()).then(()=>{t?L(K):G()})})};return{promise:m,cancel:_,continue:()=>(h?.(),m),cancelRetry:i,continueRetry:S,canStart:I,start:()=>(I()?G():z().then(G),m)}}var Zoe=e=>setTimeout(e,0);function Xoe(){let e=[],t=0,n=i=>{i()},s=i=>{i()},h=Zoe;const m=i=>{t?e.push(i):h(()=>{n(i)})},_=()=>{const i=e;e=[],i.length&&h(()=>{s(()=>{i.forEach(S=>{n(S)})})})};return{batch:i=>{let S;t++;try{S=i()}finally{t--,t||_()}return S},batchCalls:i=>(...S)=>{m(()=>{i(...S)})},schedule:m,setNotifyFunction:i=>{n=i},setBatchNotifyFunction:i=>{s=i},setScheduler:i=>{h=i}}}var Os=Xoe(),Q$=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),joe(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(LT?1/0:5*60*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},Koe=class extends Q${#e;#t;#r;#n;#i;#s;#a;constructor(e){super(),this.#a=!1,this.#s=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#n=e.client,this.#r=this.#n.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Joe(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(e){this.options={...this.#s,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(e,t){const n=Boe(this.state.data,e,this.options);return this.#o({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#o({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#i?.promise;return this.#i?.cancel(e),t?t.then(cl).catch(cl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Noe(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===zM||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>FP(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!Loe(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#i&&(this.#a?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}fetch(e,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(e&&this.setOptions(e),!this.options.queryFn){const S=this.observers.find(A=>A.options.queryFn);S&&this.setOptions(S.options)}const n=new AbortController,s=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},h=()=>{const S=Z$(this.options,t),I=(()=>{const M={client:this.#n,queryKey:this.queryKey,meta:this.meta};return s(M),M})();return this.#a=!1,this.options.persister?this.options.persister(S,I,this):S(I)},_=(()=>{const S={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:h};return s(S),S})();this.options.behavior?.onFetch(_,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==_.fetchOptions?.meta)&&this.#o({type:"fetch",meta:_.fetchOptions?.meta});const i=S=>{pA(S)&&S.silent||this.#o({type:"error",error:S}),pA(S)||(this.#r.config.onError?.(S,this),this.#r.config.onSettled?.(this.state.data,S,this)),this.scheduleGc()};return this.#i=J$({initialPromise:t?.initialPromise,fn:_.fetchFn,abort:n.abort.bind(n),onSuccess:S=>{if(S===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(S)}catch(A){i(A);return}this.#r.config.onSuccess?.(S,this),this.#r.config.onSettled?.(S,this.state.error,this),this.scheduleGc()},onError:i,onFail:(S,A)=>{this.#o({type:"failed",failureCount:S,error:A})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:_.options.retry,retryDelay:_.options.retryDelay,networkMode:_.options.networkMode,canRun:()=>!0}),this.#i.start()}#o(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Yoe(n.data,this.options),fetchMeta:e.meta??null};case"success":return this.#t=void 0,{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const s=e.error;return pA(s)&&s.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...n,error:s,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),Os.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:e})})}};function Yoe(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:K$(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Joe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,s=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Qoe=class extends V0{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,n){const s=t.queryKey,h=t.queryHash??NM(s,t);let m=this.get(h);return m||(m=new Koe({client:e,queryKey:s,queryHash:h,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(s)}),this.add(m)),m}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Os.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>az(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>az(e,n)):t}notify(e){Os.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Os.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Os.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ese=class extends Q${#e;#t;#r;constructor(e){super(),this.mutationId=e.mutationId,this.#t=e.mutationCache,this.#e=[],this.state=e.state||eU(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#e.includes(e)||(this.#e.push(e),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#e=this.#e.filter(t=>t!==e),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#n({type:"continue"})};this.#r=J$({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(h,m)=>{this.#n({type:"failed",failureCount:h,error:m})},onPause:()=>{this.#n({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const n=this.state.status==="pending",s=!this.#r.canStart();try{if(n)t();else{this.#n({type:"pending",variables:e,isPaused:s}),await this.#t.config.onMutate?.(e,this);const m=await this.options.onMutate?.(e);m!==this.state.context&&this.#n({type:"pending",context:m,variables:e,isPaused:s})}const h=await this.#r.start();return await this.#t.config.onSuccess?.(h,e,this.state.context,this),await this.options.onSuccess?.(h,e,this.state.context),await this.#t.config.onSettled?.(h,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(h,null,e,this.state.context),this.#n({type:"success",data:h}),h}catch(h){try{throw await this.#t.config.onError?.(h,e,this.state.context,this),await this.options.onError?.(h,e,this.state.context),await this.#t.config.onSettled?.(void 0,h,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,h,e,this.state.context),h}finally{this.#n({type:"error",error:h})}}finally{this.#t.runNext(this)}}#n(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Os.batch(()=>{this.#e.forEach(n=>{n.onMutationUpdate(e)}),this.#t.notify({mutation:this,type:"updated",action:e})})}};function eU(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var tse=class extends V0{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(e,t,n){const s=new ese({mutationCache:this,mutationId:++this.#r,options:e.defaultMutationOptions(t),state:n});return this.add(s),s}add(e){this.#e.add(e);const t=u1(e);if(typeof t=="string"){const n=this.#t.get(t);n?n.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=u1(e);if(typeof t=="string"){const n=this.#t.get(t);if(n)if(n.length>1){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}else n[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=u1(e);if(typeof t=="string"){const s=this.#t.get(t)?.find(h=>h.state.status==="pending");return!s||s===e}else return!0}runNext(e){const t=u1(e);return typeof t=="string"?this.#t.get(t)?.find(s=>s!==e&&s.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Os.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(n=>lz(t,n))}findAll(e={}){return this.getAll().filter(t=>lz(e,t))}notify(e){Os.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Os.batch(()=>Promise.all(e.map(t=>t.continue().catch(cl))))}};function u1(e){return e.options.scope?.id}function hz(e){return{onFetch:(t,n)=>{const s=t.options,h=t.fetchOptions?.meta?.fetchMore?.direction,m=t.state.data?.pages||[],_=t.state.data?.pageParams||[];let i={pages:[],pageParams:[]},S=0;const A=async()=>{let I=!1;const M=G=>{Object.defineProperty(G,"signal",{enumerable:!0,get:()=>(t.signal.aborted?I=!0:t.signal.addEventListener("abort",()=>{I=!0}),t.signal)})},L=Z$(t.options,t.fetchOptions),z=async(G,F,U)=>{if(I)return Promise.reject();if(F==null&&G.pages.length)return Promise.resolve(G);const J=(()=>{const ae={client:t.client,queryKey:t.queryKey,pageParam:F,direction:U?"backward":"forward",meta:t.options.meta};return M(ae),ae})(),X=await L(J),{maxPages:ie}=t.options,Q=U?$oe:Voe;return{pages:Q(G.pages,X,ie),pageParams:Q(G.pageParams,F,ie)}};if(h&&m.length){const G=h==="backward",F=G?rse:dz,U={pages:m,pageParams:_},K=F(s,U);i=await z(U,K,G)}else{const G=e??m.length;do{const F=S===0?_[0]??s.initialPageParam:dz(s,i);if(S>0&&F==null)break;i=await z(i,F),S++}while(S<G)}return i};t.options.persister?t.fetchFn=()=>t.options.persister?.(A,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=A}}}function dz(e,{pages:t,pageParams:n}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,n[s],n):void 0}function rse(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var nse=class{#e;#t;#r;#n;#i;#s;#a;#o;constructor(e={}){this.#e=e.queryCache||new Qoe,this.#t=e.mutationCache||new tse,this.#r=e.defaultOptions||{},this.#n=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#a=X$.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=aw.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#e.build(this,t),s=n.state.data;return s===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(FP(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:n})=>{const s=n.data;return[t,s]})}setQueryData(e,t,n){const s=this.defaultQueryOptions({queryKey:e}),m=this.#e.get(s.queryHash)?.state.data,_=koe(t,m);if(_!==void 0)return this.#e.build(this,s).setData(_,{...n,manual:!0})}setQueriesData(e,t,n){return Os.batch(()=>this.#e.findAll(e).map(({queryKey:s})=>[s,this.setQueryData(s,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;Os.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=this.#e;return Os.batch(()=>(n.findAll(e).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},s=Os.batch(()=>this.#e.findAll(e).map(h=>h.cancel(n)));return Promise.all(s).then(cl).catch(cl)}invalidateQueries(e,t={}){return Os.batch(()=>(this.#e.findAll(e).forEach(n=>{n.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},s=Os.batch(()=>this.#e.findAll(e).filter(h=>!h.isDisabled()&&!h.isStatic()).map(h=>{let m=h.fetch(void 0,n);return n.throwOnError||(m=m.catch(cl)),h.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(s).then(cl)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=this.#e.build(this,t);return n.isStaleByTime(FP(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(cl).catch(cl)}fetchInfiniteQuery(e){return e.behavior=hz(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(cl).catch(cl)}ensureInfiniteQueryData(e){return e.behavior=hz(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return aw.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(e){this.#r=e}setQueryDefaults(e,t){this.#n.set(Sf(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#n.values()],n={};return t.forEach(s=>{Uv(e,s.queryKey)&&Object.assign(n,s.defaultOptions)}),n}setMutationDefaults(e,t){this.#i.set(Sf(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#i.values()],n={};return t.forEach(s=>{Uv(e,s.mutationKey)&&Object.assign(n,s.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#r.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=NM(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===zM&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#r.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},ise=class extends V0{#e;#t=void 0;#r;#n;constructor(t,n){super(),this.#e=t,this.setOptions(n),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const n=this.options;this.options=this.#e.defaultMutationOptions(t),zoe(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&Sf(n.mutationKey)!==Sf(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#s(t)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#s()}mutate(t,n){return this.#n=n,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(t)}#i(){const t=this.#r?.state??eU();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#s(t){Os.batch(()=>{if(this.#n&&this.hasListeners()){const n=this.#t.variables,s=this.#t.context;t?.type==="success"?(this.#n.onSuccess?.(t.data,n,s),this.#n.onSettled?.(t.data,null,n,s)):t?.type==="error"&&(this.#n.onError?.(t.error,n,s),this.#n.onSettled?.(void 0,t.error,n,s))}this.listeners.forEach(n=>{n(this.#t)})})}},tU=B.createContext(void 0),rU=e=>{const t=B.useContext(tU);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},ose=({client:e,children:t})=>(B.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),b.jsx(tU.Provider,{value:e,children:t}));function sse(e,t){const n=rU(),[s]=B.useState(()=>new ise(n,e));B.useEffect(()=>{s.setOptions(e)},[s,e]);const h=B.useSyncExternalStore(B.useCallback(_=>s.subscribe(Os.batchCalls(_)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),m=B.useCallback((_,i)=>{s.mutate(_,i).catch(cl)},[s]);if(h.error&&Uoe(s.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:m,mutateAsync:h.mutate}}/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gv(){return Gv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Gv.apply(this,arguments)}var Fh;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Fh||(Fh={}));const fz="popstate";function ase(e){e===void 0&&(e={});function t(h,m){let{pathname:_="/",search:i="",hash:S=""}=Lf(h.location.hash.substr(1));return!_.startsWith("/")&&!_.startsWith(".")&&(_="/"+_),VP("",{pathname:_,search:i,hash:S},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function n(h,m){let _=h.document.querySelector("base"),i="";if(_&&_.getAttribute("href")){let S=h.location.href,A=S.indexOf("#");i=A===-1?S:S.slice(0,A)}return i+"#"+(typeof m=="string"?m:lw(m))}function s(h,m){NT(h.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(m)+")")}return cse(t,n,s,e)}function Do(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function NT(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function lse(){return Math.random().toString(36).substr(2,8)}function pz(e,t){return{usr:e.state,key:e.key,idx:t}}function VP(e,t,n,s){return n===void 0&&(n=null),Gv({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Lf(t):t,{state:n,key:t&&t.key||s||lse()})}function lw(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function Lf(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function cse(e,t,n,s){s===void 0&&(s={});let{window:h=document.defaultView,v5Compat:m=!1}=s,_=h.history,i=Fh.Pop,S=null,A=I();A==null&&(A=0,_.replaceState(Gv({},_.state,{idx:A}),""));function I(){return(_.state||{idx:null}).idx}function M(){i=Fh.Pop;let U=I(),K=U==null?null:U-A;A=U,S&&S({action:i,location:F.location,delta:K})}function L(U,K){i=Fh.Push;let J=VP(F.location,U,K);n&&n(J,U),A=I()+1;let X=pz(J,A),ie=F.createHref(J);try{_.pushState(X,"",ie)}catch(Q){if(Q instanceof DOMException&&Q.name==="DataCloneError")throw Q;h.location.assign(ie)}m&&S&&S({action:i,location:F.location,delta:1})}function z(U,K){i=Fh.Replace;let J=VP(F.location,U,K);n&&n(J,U),A=I();let X=pz(J,A),ie=F.createHref(J);_.replaceState(X,"",ie),m&&S&&S({action:i,location:F.location,delta:0})}function G(U){let K=h.location.origin!=="null"?h.location.origin:h.location.href,J=typeof U=="string"?U:lw(U);return J=J.replace(/ $/,"%20"),Do(K,"No window.location.(origin|href) available to create URL for href: "+J),new URL(J,K)}let F={get action(){return i},get location(){return e(h,_)},listen(U){if(S)throw new Error("A history only accepts one active listener");return h.addEventListener(fz,M),S=U,()=>{h.removeEventListener(fz,M),S=null}},createHref(U){return t(h,U)},createURL:G,encodeLocation(U){let K=G(U);return{pathname:K.pathname,search:K.search,hash:K.hash}},push:L,replace:z,go(U){return _.go(U)}};return F}var mz;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(mz||(mz={}));function use(e,t,n){return n===void 0&&(n="/"),hse(e,t,n,!1)}function hse(e,t,n,s){let h=typeof t=="string"?Lf(t):t,m=hg(h.pathname||"/",n);if(m==null)return null;let _=nU(e);dse(_);let i=null;for(let S=0;i==null&&S<_.length;++S){let A=Tse(m);i=bse(_[S],A,s)}return i}function nU(e,t,n,s){t===void 0&&(t=[]),n===void 0&&(n=[]),s===void 0&&(s="");let h=(m,_,i)=>{let S={relativePath:i===void 0?m.path||"":i,caseSensitive:m.caseSensitive===!0,childrenIndex:_,route:m};S.relativePath.startsWith("/")&&(Do(S.relativePath.startsWith(s),'Absolute route path "'+S.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),S.relativePath=S.relativePath.slice(s.length));let A=Vh([s,S.relativePath]),I=n.concat(S);m.children&&m.children.length>0&&(Do(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+A+'".')),nU(m.children,t,I,A)),!(m.path==null&&!m.index)&&t.push({path:A,score:vse(A,m.index),routesMeta:I})};return e.forEach((m,_)=>{var i;if(m.path===""||!((i=m.path)!=null&&i.includes("?")))h(m,_);else for(let S of iU(m.path))h(m,_,S)}),t}function iU(e){let t=e.split("/");if(t.length===0)return[];let[n,...s]=t,h=n.endsWith("?"),m=n.replace(/\?$/,"");if(s.length===0)return h?[m,""]:[m];let _=iU(s.join("/")),i=[];return i.push(..._.map(S=>S===""?m:[m,S].join("/"))),h&&i.push(..._),i.map(S=>e.startsWith("/")&&S===""?"/":S)}function dse(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:xse(t.routesMeta.map(s=>s.childrenIndex),n.routesMeta.map(s=>s.childrenIndex)))}const fse=/^:[\w-]+$/,pse=3,mse=2,gse=1,yse=10,_se=-2,gz=e=>e==="*";function vse(e,t){let n=e.split("/"),s=n.length;return n.some(gz)&&(s+=_se),t&&(s+=mse),n.filter(h=>!gz(h)).reduce((h,m)=>h+(fse.test(m)?pse:m===""?gse:yse),s)}function xse(e,t){return e.length===t.length&&e.slice(0,-1).every((s,h)=>s===t[h])?e[e.length-1]-t[t.length-1]:0}function bse(e,t,n){let{routesMeta:s}=e,h={},m="/",_=[];for(let i=0;i<s.length;++i){let S=s[i],A=i===s.length-1,I=m==="/"?t:t.slice(m.length)||"/",M=cw({path:S.relativePath,caseSensitive:S.caseSensitive,end:A},I),L=S.route;if(!M&&A&&n&&!s[s.length-1].route.index&&(M=cw({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},I)),!M)return null;Object.assign(h,M.params),_.push({params:h,pathname:Vh([m,M.pathname]),pathnameBase:Cse(Vh([m,M.pathnameBase])),route:L}),M.pathnameBase!=="/"&&(m=Vh([m,M.pathnameBase]))}return _}function cw(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=wse(e.path,e.caseSensitive,e.end),h=t.match(n);if(!h)return null;let m=h[0],_=m.replace(/(.)\/+$/,"$1"),i=h.slice(1);return{params:s.reduce((A,I,M)=>{let{paramName:L,isOptional:z}=I;if(L==="*"){let F=i[M]||"";_=m.slice(0,m.length-F.length).replace(/(.)\/+$/,"$1")}const G=i[M];return z&&!G?A[L]=void 0:A[L]=(G||"").replace(/%2F/g,"/"),A},{}),pathname:m,pathnameBase:_,pattern:e}}function wse(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),NT(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],h="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,i,S)=>(s.push({paramName:i,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),h+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?h+="\\/*$":e!==""&&e!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,t?void 0:"i"),s]}function Tse(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return NT(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function hg(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&s!=="/"?null:e.slice(n)||"/"}const Sse=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ese=e=>Sse.test(e);function Ase(e,t){t===void 0&&(t="/");let{pathname:n,search:s="",hash:h=""}=typeof e=="string"?Lf(e):e,m;if(n)if(Ese(n))m=n;else{if(n.includes("//")){let _=n;n=n.replace(/\/\/+/g,"/"),NT(!1,"Pathnames cannot have embedded double slashes - normalizing "+(_+" -> "+n))}n.startsWith("/")?m=yz(n.substring(1),"/"):m=yz(n,t)}else m=t;return{pathname:m,search:Ise(s),hash:Mse(h)}}function yz(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(h=>{h===".."?n.length>1&&n.pop():h!=="."&&n.push(h)}),n.length>1?n.join("/"):"/"}function mA(e,t,n,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Pse(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function oU(e,t){let n=Pse(e);return t?n.map((s,h)=>h===n.length-1?s.pathname:s.pathnameBase):n.map(s=>s.pathnameBase)}function sU(e,t,n,s){s===void 0&&(s=!1);let h;typeof e=="string"?h=Lf(e):(h=Gv({},e),Do(!h.pathname||!h.pathname.includes("?"),mA("?","pathname","search",h)),Do(!h.pathname||!h.pathname.includes("#"),mA("#","pathname","hash",h)),Do(!h.search||!h.search.includes("#"),mA("#","search","hash",h)));let m=e===""||h.pathname==="",_=m?"/":h.pathname,i;if(_==null)i=n;else{let M=t.length-1;if(!s&&_.startsWith("..")){let L=_.split("/");for(;L[0]==="..";)L.shift(),M-=1;h.pathname=L.join("/")}i=M>=0?t[M]:"/"}let S=Ase(h,i),A=_&&_!=="/"&&_.endsWith("/"),I=(m||_===".")&&n.endsWith("/");return!S.pathname.endsWith("/")&&(A||I)&&(S.pathname+="/"),S}const Vh=e=>e.join("/").replace(/\/\/+/g,"/"),Cse=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Ise=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Mse=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Ose(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const aU=["post","put","patch","delete"];new Set(aU);const Rse=["get",...aU];new Set(Rse);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hv(){return Hv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Hv.apply(this,arguments)}const zT=B.createContext(null),lU=B.createContext(null),Jh=B.createContext(null),FT=B.createContext(null),Wu=B.createContext({outlet:null,matches:[],isDataRoute:!1}),cU=B.createContext(null);function Dse(e,t){let{relative:n}=t===void 0?{}:t;$0()||Do(!1);let{basename:s,navigator:h}=B.useContext(Jh),{hash:m,pathname:_,search:i}=BT(e,{relative:n}),S=_;return s!=="/"&&(S=_==="/"?s:Vh([s,_])),h.createHref({pathname:S,search:i,hash:m})}function $0(){return B.useContext(FT)!=null}function hc(){return $0()||Do(!1),B.useContext(FT).location}function uU(e){B.useContext(Jh).static||B.useLayoutEffect(e)}function qg(){let{isDataRoute:e}=B.useContext(Wu);return e?Zse():kse()}function kse(){$0()||Do(!1);let e=B.useContext(zT),{basename:t,future:n,navigator:s}=B.useContext(Jh),{matches:h}=B.useContext(Wu),{pathname:m}=hc(),_=JSON.stringify(oU(h,n.v7_relativeSplatPath)),i=B.useRef(!1);return uU(()=>{i.current=!0}),B.useCallback(function(A,I){if(I===void 0&&(I={}),!i.current)return;if(typeof A=="number"){s.go(A);return}let M=sU(A,JSON.parse(_),m,I.relative==="path");e==null&&t!=="/"&&(M.pathname=M.pathname==="/"?t:Vh([t,M.pathname])),(I.replace?s.replace:s.push)(M,I.state,I)},[t,s,_,m,e])}const jse=B.createContext(null);function Lse(e){let t=B.useContext(Wu).outlet;return t&&B.createElement(jse.Provider,{value:e},t)}function hU(){let{matches:e}=B.useContext(Wu),t=e[e.length-1];return t?t.params:{}}function BT(e,t){let{relative:n}=t===void 0?{}:t,{future:s}=B.useContext(Jh),{matches:h}=B.useContext(Wu),{pathname:m}=hc(),_=JSON.stringify(oU(h,s.v7_relativeSplatPath));return B.useMemo(()=>sU(e,JSON.parse(_),m,n==="path"),[e,_,m,n])}function Nse(e,t){return zse(e,t)}function zse(e,t,n,s){$0()||Do(!1);let{navigator:h}=B.useContext(Jh),{matches:m}=B.useContext(Wu),_=m[m.length-1],i=_?_.params:{};_&&_.pathname;let S=_?_.pathnameBase:"/";_&&_.route;let A=hc(),I;if(t){var M;let U=typeof t=="string"?Lf(t):t;S==="/"||(M=U.pathname)!=null&&M.startsWith(S)||Do(!1),I=U}else I=A;let L=I.pathname||"/",z=L;if(S!=="/"){let U=S.replace(/^\//,"").split("/");z="/"+L.replace(/^\//,"").split("/").slice(U.length).join("/")}let G=use(e,{pathname:z}),F=Use(G&&G.map(U=>Object.assign({},U,{params:Object.assign({},i,U.params),pathname:Vh([S,h.encodeLocation?h.encodeLocation(U.pathname).pathname:U.pathname]),pathnameBase:U.pathnameBase==="/"?S:Vh([S,h.encodeLocation?h.encodeLocation(U.pathnameBase).pathname:U.pathnameBase])})),m,n,s);return t&&F?B.createElement(FT.Provider,{value:{location:Hv({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:Fh.Pop}},F):F}function Fse(){let e=qse(),t=Ose(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},t),n?B.createElement("pre",{style:h},n):null,null)}const Bse=B.createElement(Fse,null);class Vse extends B.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?B.createElement(Wu.Provider,{value:this.props.routeContext},B.createElement(cU.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function $se(e){let{routeContext:t,match:n,children:s}=e,h=B.useContext(zT);return h&&h.static&&h.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=n.route.id),B.createElement(Wu.Provider,{value:t},s)}function Use(e,t,n,s){var h;if(t===void 0&&(t=[]),n===void 0&&(n=null),s===void 0&&(s=null),e==null){var m;if(!n)return null;if(n.errors)e=n.matches;else if((m=s)!=null&&m.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let _=e,i=(h=n)==null?void 0:h.errors;if(i!=null){let I=_.findIndex(M=>M.route.id&&i?.[M.route.id]!==void 0);I>=0||Do(!1),_=_.slice(0,Math.min(_.length,I+1))}let S=!1,A=-1;if(n&&s&&s.v7_partialHydration)for(let I=0;I<_.length;I++){let M=_[I];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(A=I),M.route.id){let{loaderData:L,errors:z}=n,G=M.route.loader&&L[M.route.id]===void 0&&(!z||z[M.route.id]===void 0);if(M.route.lazy||G){S=!0,A>=0?_=_.slice(0,A+1):_=[_[0]];break}}}return _.reduceRight((I,M,L)=>{let z,G=!1,F=null,U=null;n&&(z=i&&M.route.id?i[M.route.id]:void 0,F=M.route.errorElement||Bse,S&&(A<0&&L===0?(G=!0,U=null):A===L&&(G=!0,U=M.route.hydrateFallbackElement||null)));let K=t.concat(_.slice(0,L+1)),J=()=>{let X;return z?X=F:G?X=U:M.route.Component?X=B.createElement(M.route.Component,null):M.route.element?X=M.route.element:X=I,B.createElement($se,{match:M,routeContext:{outlet:I,matches:K,isDataRoute:n!=null},children:X})};return n&&(M.route.ErrorBoundary||M.route.errorElement||L===0)?B.createElement(Vse,{location:n.location,revalidation:n.revalidation,component:F,error:z,children:J(),routeContext:{outlet:null,matches:K,isDataRoute:!0}}):J()},null)}var dU=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(dU||{}),uw=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(uw||{});function Gse(e){let t=B.useContext(zT);return t||Do(!1),t}function Hse(e){let t=B.useContext(lU);return t||Do(!1),t}function Wse(e){let t=B.useContext(Wu);return t||Do(!1),t}function fU(e){let t=Wse(),n=t.matches[t.matches.length-1];return n.route.id||Do(!1),n.route.id}function qse(){var e;let t=B.useContext(cU),n=Hse(uw.UseRouteError),s=fU(uw.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[s]}function Zse(){let{router:e}=Gse(dU.UseNavigateStable),t=fU(uw.UseNavigateStable),n=B.useRef(!1);return uU(()=>{n.current=!0}),B.useCallback(function(h,m){m===void 0&&(m={}),n.current&&(typeof h=="number"?e.navigate(h):e.navigate(h,Hv({fromRouteId:t},m)))},[e,t])}function Xse(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function Kse(e){return Lse(e.context)}function rs(e){Do(!1)}function Yse(e){let{basename:t="/",children:n=null,location:s,navigationType:h=Fh.Pop,navigator:m,static:_=!1,future:i}=e;$0()&&Do(!1);let S=t.replace(/^\/*/,"/"),A=B.useMemo(()=>({basename:S,navigator:m,static:_,future:Hv({v7_relativeSplatPath:!1},i)}),[S,i,m,_]);typeof s=="string"&&(s=Lf(s));let{pathname:I="/",search:M="",hash:L="",state:z=null,key:G="default"}=s,F=B.useMemo(()=>{let U=hg(I,S);return U==null?null:{location:{pathname:U,search:M,hash:L,state:z,key:G},navigationType:h}},[S,I,M,L,z,G,h]);return F==null?null:B.createElement(Jh.Provider,{value:A},B.createElement(FT.Provider,{children:n,value:F}))}function Jse(e){let{children:t,location:n}=e;return Nse($P(t),n)}new Promise(()=>{});function $P(e,t){t===void 0&&(t=[]);let n=[];return B.Children.forEach(e,(s,h)=>{if(!B.isValidElement(s))return;let m=[...t,h];if(s.type===B.Fragment){n.push.apply(n,$P(s.props.children,m));return}s.type!==rs&&Do(!1),!s.props.index||!s.props.children||Do(!1);let _={id:s.props.id||m.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=$P(s.props.children,m)),n.push(_)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hw(){return hw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},hw.apply(this,arguments)}function pU(e,t){if(e==null)return{};var n={},s=Object.keys(e),h,m;for(m=0;m<s.length;m++)h=s[m],!(t.indexOf(h)>=0)&&(n[h]=e[h]);return n}function Qse(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function eae(e,t){return e.button===0&&(!t||t==="_self")&&!Qse(e)}const tae=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],rae=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],nae="6";try{window.__reactRouterVersion=nae}catch{}const iae=B.createContext({isTransitioning:!1}),oae="startTransition",_z=kI[oae];function sae(e){let{basename:t,children:n,future:s,window:h}=e,m=B.useRef();m.current==null&&(m.current=ase({window:h,v5Compat:!0}));let _=m.current,[i,S]=B.useState({action:_.action,location:_.location}),{v7_startTransition:A}=s||{},I=B.useCallback(M=>{A&&_z?_z(()=>S(M)):S(M)},[S,A]);return B.useLayoutEffect(()=>_.listen(I),[_,I]),B.useEffect(()=>Xse(s),[s]),B.createElement(Yse,{basename:t,children:n,location:i.location,navigationType:i.action,navigator:_,future:s})}const aae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",lae=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,us=B.forwardRef(function(t,n){let{onClick:s,relative:h,reloadDocument:m,replace:_,state:i,target:S,to:A,preventScrollReset:I,viewTransition:M}=t,L=pU(t,tae),{basename:z}=B.useContext(Jh),G,F=!1;if(typeof A=="string"&&lae.test(A)&&(G=A,aae))try{let X=new URL(window.location.href),ie=A.startsWith("//")?new URL(X.protocol+A):new URL(A),Q=hg(ie.pathname,z);ie.origin===X.origin&&Q!=null?A=Q+ie.search+ie.hash:F=!0}catch{}let U=Dse(A,{relative:h}),K=uae(A,{replace:_,state:i,target:S,preventScrollReset:I,relative:h,viewTransition:M});function J(X){s&&s(X),X.defaultPrevented||K(X)}return B.createElement("a",hw({},L,{href:G||U,onClick:F||m?s:J,ref:n,target:S}))}),FM=B.forwardRef(function(t,n){let{"aria-current":s="page",caseSensitive:h=!1,className:m="",end:_=!1,style:i,to:S,viewTransition:A,children:I}=t,M=pU(t,rae),L=BT(S,{relative:M.relative}),z=hc(),G=B.useContext(lU),{navigator:F,basename:U}=B.useContext(Jh),K=G!=null&&hae(L)&&A===!0,J=F.encodeLocation?F.encodeLocation(L).pathname:L.pathname,X=z.pathname,ie=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;h||(X=X.toLowerCase(),ie=ie?ie.toLowerCase():null,J=J.toLowerCase()),ie&&U&&(ie=hg(ie,U)||ie);const Q=J!=="/"&&J.endsWith("/")?J.length-1:J.length;let ae=X===J||!_&&X.startsWith(J)&&X.charAt(Q)==="/",pe=ie!=null&&(ie===J||!_&&ie.startsWith(J)&&ie.charAt(J.length)==="/"),Pe={isActive:ae,isPending:pe,isTransitioning:K},Fe=ae?s:void 0,tt;typeof m=="function"?tt=m(Pe):tt=[m,ae?"active":null,pe?"pending":null,K?"transitioning":null].filter(Boolean).join(" ");let Be=typeof i=="function"?i(Pe):i;return B.createElement(us,hw({},M,{"aria-current":Fe,className:tt,ref:n,style:Be,to:S,viewTransition:A}),typeof I=="function"?I(Pe):I)});var UP;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(UP||(UP={}));var vz;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(vz||(vz={}));function cae(e){let t=B.useContext(zT);return t||Do(!1),t}function uae(e,t){let{target:n,replace:s,state:h,preventScrollReset:m,relative:_,viewTransition:i}=t===void 0?{}:t,S=qg(),A=hc(),I=BT(e,{relative:_});return B.useCallback(M=>{if(eae(M,n)){M.preventDefault();let L=s!==void 0?s:lw(A)===lw(I);S(e,{replace:L,state:h,preventScrollReset:m,relative:_,viewTransition:i})}},[A,S,I,s,h,n,e,m,_,i])}function hae(e,t){t===void 0&&(t={});let n=B.useContext(iae);n==null&&Do(!1);let{basename:s}=cae(UP.useViewTransitionState),h=BT(e,{relative:t.relative});if(!n.isTransitioning)return!1;let m=hg(n.currentLocation.pathname,s)||n.currentLocation.pathname,_=hg(n.nextLocation.pathname,s)||n.nextLocation.pathname;return cw(h.pathname,_)!=null||cw(h.pathname,m)!=null}var dae=typeof Element<"u",fae=typeof Map=="function",pae=typeof Set=="function",mae=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function U1(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,h;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!U1(e[s],t[s]))return!1;return!0}var m;if(fae&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(m=e.entries();!(s=m.next()).done;)if(!t.has(s.value[0]))return!1;for(m=e.entries();!(s=m.next()).done;)if(!U1(s.value[1],t.get(s.value[0])))return!1;return!0}if(pae&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(m=e.entries();!(s=m.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(mae&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(h=Object.keys(e),n=h.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,h[s]))return!1;if(dae&&e instanceof Element)return!1;for(s=n;s--!==0;)if(!((h[s]==="_owner"||h[s]==="__v"||h[s]==="__o")&&e.$$typeof)&&!U1(e[h[s]],t[h[s]]))return!1;return!0}return e!==e&&t!==t}var gae=function(t,n){try{return U1(t,n)}catch(s){if((s.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw s}};const yae=Bi(gae);var _ae=function(e,t,n,s,h,m,_,i){if(!e){var S;if(t===void 0)S=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var A=[n,s,h,m,_,i],I=0;S=new Error(t.replace(/%s/g,function(){return A[I++]})),S.name="Invariant Violation"}throw S.framesToPop=1,S}},vae=_ae;const xz=Bi(vae);var xae=function(t,n,s,h){var m=s?s.call(h,t,n):void 0;if(m!==void 0)return!!m;if(t===n)return!0;if(typeof t!="object"||!t||typeof n!="object"||!n)return!1;var _=Object.keys(t),i=Object.keys(n);if(_.length!==i.length)return!1;for(var S=Object.prototype.hasOwnProperty.bind(n),A=0;A<_.length;A++){var I=_[A];if(!S(I))return!1;var M=t[I],L=n[I];if(m=s?s.call(h,M,L,I):void 0,m===!1||m===void 0&&M!==L)return!1}return!0};const bae=Bi(xae);var mU=(e=>(e.BASE="base",e.BODY="body",e.HEAD="head",e.HTML="html",e.LINK="link",e.META="meta",e.NOSCRIPT="noscript",e.SCRIPT="script",e.STYLE="style",e.TITLE="title",e.FRAGMENT="Symbol(react.fragment)",e))(mU||{}),gA={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},bz=Object.values(mU),BM={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},wae=Object.entries(BM).reduce((e,[t,n])=>(e[n]=t,e),{}),nc="data-rh",Km={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},Ym=(e,t)=>{for(let n=e.length-1;n>=0;n-=1){const s=e[n];if(Object.prototype.hasOwnProperty.call(s,t))return s[t]}return null},Tae=e=>{let t=Ym(e,"title");const n=Ym(e,Km.TITLE_TEMPLATE);if(Array.isArray(t)&&(t=t.join("")),n&&t)return n.replace(/%s/g,()=>t);const s=Ym(e,Km.DEFAULT_TITLE);return t||s||void 0},Sae=e=>Ym(e,Km.ON_CHANGE_CLIENT_STATE)||(()=>{}),yA=(e,t)=>t.filter(n=>typeof n[e]<"u").map(n=>n[e]).reduce((n,s)=>({...n,...s}),{}),Eae=(e,t)=>t.filter(n=>typeof n.base<"u").map(n=>n.base).reverse().reduce((n,s)=>{if(!n.length){const h=Object.keys(s);for(let m=0;m<h.length;m+=1){const i=h[m].toLowerCase();if(e.indexOf(i)!==-1&&s[i])return n.concat(s)}}return n},[]),Aae=e=>console&&typeof console.warn=="function"&&console.warn(e),av=(e,t,n)=>{const s={};return n.filter(h=>Array.isArray(h[e])?!0:(typeof h[e]<"u"&&Aae(`Helmet: ${e} should be of type "Array". Instead found type "${typeof h[e]}"`),!1)).map(h=>h[e]).reverse().reduce((h,m)=>{const _={};m.filter(S=>{let A;const I=Object.keys(S);for(let L=0;L<I.length;L+=1){const z=I[L],G=z.toLowerCase();t.indexOf(G)!==-1&&!(A==="rel"&&S[A].toLowerCase()==="canonical")&&!(G==="rel"&&S[G].toLowerCase()==="stylesheet")&&(A=G),t.indexOf(z)!==-1&&(z==="innerHTML"||z==="cssText"||z==="itemprop")&&(A=z)}if(!A||!S[A])return!1;const M=S[A].toLowerCase();return s[A]||(s[A]={}),_[A]||(_[A]={}),s[A][M]?!1:(_[A][M]=!0,!0)}).reverse().forEach(S=>h.push(S));const i=Object.keys(_);for(let S=0;S<i.length;S+=1){const A=i[S],I={...s[A],..._[A]};s[A]=I}return h},[]).reverse()},Pae=(e,t)=>{if(Array.isArray(e)&&e.length){for(let n=0;n<e.length;n+=1)if(e[n][t])return!0}return!1},Cae=e=>({baseTag:Eae(["href"],e),bodyAttributes:yA("bodyAttributes",e),defer:Ym(e,Km.DEFER),encode:Ym(e,Km.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:yA("htmlAttributes",e),linkTags:av("link",["rel","href"],e),metaTags:av("meta",["name","charset","http-equiv","property","itemprop"],e),noscriptTags:av("noscript",["innerHTML"],e),onChangeClientState:Sae(e),scriptTags:av("script",["src","innerHTML"],e),styleTags:av("style",["cssText"],e),title:Tae(e),titleAttributes:yA("titleAttributes",e),prioritizeSeoTags:Pae(e,Km.PRIORITIZE_SEO_TAGS)}),gU=e=>Array.isArray(e)?e.join(""):e,Iae=(e,t)=>{const n=Object.keys(e);for(let s=0;s<n.length;s+=1)if(t[n[s]]&&t[n[s]].includes(e[n[s]]))return!0;return!1},_A=(e,t)=>Array.isArray(e)?e.reduce((n,s)=>(Iae(s,t)?n.priority.push(s):n.default.push(s),n),{priority:[],default:[]}):{default:e,priority:[]},wz=(e,t)=>({...e,[t]:void 0}),Mae=["noscript","script","style"],GP=(e,t=!0)=>t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),yU=e=>Object.keys(e).reduce((t,n)=>{const s=typeof e[n]<"u"?`${n}="${e[n]}"`:`${n}`;return t?`${t} ${s}`:s},""),Oae=(e,t,n,s)=>{const h=yU(n),m=gU(t);return h?`<${e} ${nc}="true" ${h}>${GP(m,s)}</${e}>`:`<${e} ${nc}="true">${GP(m,s)}</${e}>`},Rae=(e,t,n=!0)=>t.reduce((s,h)=>{const m=h,_=Object.keys(m).filter(A=>!(A==="innerHTML"||A==="cssText")).reduce((A,I)=>{const M=typeof m[I]>"u"?I:`${I}="${GP(m[I],n)}"`;return A?`${A} ${M}`:M},""),i=m.innerHTML||m.cssText||"",S=Mae.indexOf(e)===-1;return`${s}<${e} ${nc}="true" ${_}${S?"/>":`>${i}</${e}>`}`},""),_U=(e,t={})=>Object.keys(e).reduce((n,s)=>{const h=BM[s];return n[h||s]=e[s],n},t),Dae=(e,t,n)=>{const s={key:t,[nc]:!0},h=_U(n,s);return[$e.createElement("title",h,t)]},G1=(e,t)=>t.map((n,s)=>{const h={key:s,[nc]:!0};return Object.keys(n).forEach(m=>{const i=BM[m]||m;if(i==="innerHTML"||i==="cssText"){const S=n.innerHTML||n.cssText;h.dangerouslySetInnerHTML={__html:S}}else h[i]=n[m]}),$e.createElement(e,h)}),ll=(e,t,n=!0)=>{switch(e){case"title":return{toComponent:()=>Dae(e,t.title,t.titleAttributes),toString:()=>Oae(e,t.title,t.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>_U(t),toString:()=>yU(t)};default:return{toComponent:()=>G1(e,t),toString:()=>Rae(e,t,n)}}},kae=({metaTags:e,linkTags:t,scriptTags:n,encode:s})=>{const h=_A(e,gA.meta),m=_A(t,gA.link),_=_A(n,gA.script);return{priorityMethods:{toComponent:()=>[...G1("meta",h.priority),...G1("link",m.priority),...G1("script",_.priority)],toString:()=>`${ll("meta",h.priority,s)} ${ll("link",m.priority,s)} ${ll("script",_.priority,s)}`},metaTags:h.default,linkTags:m.default,scriptTags:_.default}},jae=e=>{const{baseTag:t,bodyAttributes:n,encode:s=!0,htmlAttributes:h,noscriptTags:m,styleTags:_,title:i="",titleAttributes:S,prioritizeSeoTags:A}=e;let{linkTags:I,metaTags:M,scriptTags:L}=e,z={toComponent:()=>{},toString:()=>""};return A&&({priorityMethods:z,linkTags:I,metaTags:M,scriptTags:L}=kae(e)),{priority:z,base:ll("base",t,s),bodyAttributes:ll("bodyAttributes",n,s),htmlAttributes:ll("htmlAttributes",h,s),link:ll("link",I,s),meta:ll("meta",M,s),noscript:ll("noscript",m,s),script:ll("script",L,s),style:ll("style",_,s),title:ll("title",{title:i,titleAttributes:S},s)}},HP=jae,h1=[],vU=!!(typeof window<"u"&&window.document&&window.document.createElement),WP=class{instances=[];canUseDOM=vU;context;value={setHelmet:e=>{this.context.helmet=e},helmetInstances:{get:()=>this.canUseDOM?h1:this.instances,add:e=>{(this.canUseDOM?h1:this.instances).push(e)},remove:e=>{const t=(this.canUseDOM?h1:this.instances).indexOf(e);(this.canUseDOM?h1:this.instances).splice(t,1)}}};constructor(e,t){this.context=e,this.canUseDOM=t||!1,t||(e.helmet=HP({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},Lae={},xU=$e.createContext(Lae),bU=class wU extends B.Component{static canUseDOM=vU;helmetData;constructor(t){super(t),this.helmetData=new WP(this.props.context||{},wU.canUseDOM)}render(){return $e.createElement(xU.Provider,{value:this.helmetData.value},this.props.children)}},Im=(e,t)=>{const n=document.head||document.querySelector("head"),s=n.querySelectorAll(`${e}[${nc}]`),h=[].slice.call(s),m=[];let _;return t&&t.length&&t.forEach(i=>{const S=document.createElement(e);for(const A in i)if(Object.prototype.hasOwnProperty.call(i,A))if(A==="innerHTML")S.innerHTML=i.innerHTML;else if(A==="cssText")S.styleSheet?S.styleSheet.cssText=i.cssText:S.appendChild(document.createTextNode(i.cssText));else{const I=A,M=typeof i[I]>"u"?"":i[I];S.setAttribute(A,M)}S.setAttribute(nc,"true"),h.some((A,I)=>(_=I,S.isEqualNode(A)))?h.splice(_,1):m.push(S)}),h.forEach(i=>i.parentNode?.removeChild(i)),m.forEach(i=>n.appendChild(i)),{oldTags:h,newTags:m}},qP=(e,t)=>{const n=document.getElementsByTagName(e)[0];if(!n)return;const s=n.getAttribute(nc),h=s?s.split(","):[],m=[...h],_=Object.keys(t);for(const i of _){const S=t[i]||"";n.getAttribute(i)!==S&&n.setAttribute(i,S),h.indexOf(i)===-1&&h.push(i);const A=m.indexOf(i);A!==-1&&m.splice(A,1)}for(let i=m.length-1;i>=0;i-=1)n.removeAttribute(m[i]);h.length===m.length?n.removeAttribute(nc):n.getAttribute(nc)!==_.join(",")&&n.setAttribute(nc,_.join(","))},Nae=(e,t)=>{typeof e<"u"&&document.title!==e&&(document.title=gU(e)),qP("title",t)},Tz=(e,t)=>{const{baseTag:n,bodyAttributes:s,htmlAttributes:h,linkTags:m,metaTags:_,noscriptTags:i,onChangeClientState:S,scriptTags:A,styleTags:I,title:M,titleAttributes:L}=e;qP("body",s),qP("html",h),Nae(M,L);const z={baseTag:Im("base",n),linkTags:Im("link",m),metaTags:Im("meta",_),noscriptTags:Im("noscript",i),scriptTags:Im("script",A),styleTags:Im("style",I)},G={},F={};Object.keys(z).forEach(U=>{const{newTags:K,oldTags:J}=z[U];K.length&&(G[U]=K),J.length&&(F[U]=z[U].oldTags)}),t&&t(),S(e,G,F)},lv=null,zae=e=>{lv&&cancelAnimationFrame(lv),e.defer?lv=requestAnimationFrame(()=>{Tz(e,()=>{lv=null})}):(Tz(e),lv=null)},Fae=zae,Sz=class extends B.Component{rendered=!1;shouldComponentUpdate(e){return!bae(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:t}=this.props.context;let n=null;const s=Cae(e.get().map(h=>{const m={...h.props};return delete m.context,m}));bU.canUseDOM?Fae(s):HP&&(n=HP(s)),t(n)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},Kh=class extends B.Component{static defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1};shouldComponentUpdate(e){return!yae(wz(this.props,"helmetData"),wz(e,"helmetData"))}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case"script":case"noscript":return{innerHTML:t};case"style":return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,t,n,s){return{...t,[e.type]:[...t[e.type]||[],{...n,...this.mapNestedChildrenToProps(e,s)}]}}mapObjectTypeChildren(e,t,n,s){switch(e.type){case"title":return{...t,[e.type]:s,titleAttributes:{...n}};case"body":return{...t,bodyAttributes:{...n}};case"html":return{...t,htmlAttributes:{...n}};default:return{...t,[e.type]:{...n}}}}mapArrayTypeChildrenToProps(e,t){let n={...t};return Object.keys(e).forEach(s=>{n={...n,[s]:e[s]}}),n}warnOnInvalidChildren(e,t){return xz(bz.some(n=>e.type===n),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${bz.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),xz(!t||typeof t=="string"||Array.isArray(t)&&!t.some(n=>typeof n!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,t){let n={};return $e.Children.forEach(e,s=>{if(!s||!s.props)return;const{children:h,...m}=s.props,_=Object.keys(m).reduce((S,A)=>(S[wae[A]||A]=m[A],S),{});let{type:i}=s;switch(typeof i=="symbol"?i=i.toString():this.warnOnInvalidChildren(s,h),i){case"Symbol(react.fragment)":t=this.mapChildrenToProps(h,t);break;case"link":case"meta":case"noscript":case"script":case"style":n=this.flattenArrayTypeChildren(s,n,_,h);break;default:t=this.mapObjectTypeChildren(s,t,_,h);break}}),this.mapArrayTypeChildrenToProps(n,t)}render(){const{children:e,...t}=this.props;let n={...t},{helmetData:s}=t;if(e&&(n=this.mapChildrenToProps(e,n)),s&&!(s instanceof WP)){const h=s;s=new WP(h.context,!0),delete n.helmetData}return s?$e.createElement(Sz,{...n,context:s.value}):$e.createElement(xU.Consumer,null,h=>$e.createElement(Sz,{...n,context:h}))}};const Bae=20,Vae=768,$ae=200,dw=[{label:"Home",to:"/",icon:Lc,ariaLabel:"Go to homepage"},{label:"Properties",to:"/properties",icon:_4,ariaLabel:"Browse properties",sectionId:"featured-properties"},{label:"Blog",to:"/blogs",icon:FI,ariaLabel:"Read our blog",sectionId:"latest-posts"},{label:"About",to:"/about",icon:eY,ariaLabel:"Learn about us",sectionId:"our-story"},{label:"Contact",to:"/contact",icon:jf,ariaLabel:"Contact us",sectionId:"contact-form"}],Uae=e=>{const[t,n]=B.useState(!1),s=B.useRef(null),h=B.useRef(0);return B.useEffect(()=>{let m=!0;const _=()=>{m&&(n(h.current>e),s.current=null)},i=()=>{h.current=window.scrollY,s.current==null&&(s.current=window.requestAnimationFrame(_))};return window.addEventListener("scroll",i,{passive:!0}),h.current=window.scrollY,n(window.scrollY>e),()=>{m=!1,window.removeEventListener("scroll",i),s.current!=null&&window.cancelAnimationFrame(s.current)}},[e]),t},Gae=e=>{const[t,n]=B.useState(()=>typeof window<"u"?window.innerWidth<e:!1);return B.useEffect(()=>{const s=()=>{n(window.innerWidth<e)};s();let h;const m=()=>{clearTimeout(h),h=setTimeout(s,150)};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),clearTimeout(h)}},[e]),t},Hae=e=>{const t=B.useRef(null),n=B.useRef(0);B.useEffect(()=>{if(!(typeof window>"u")&&e){n.current=window.scrollY;const s=document.body.style,h=window.getComputedStyle(document.body);t.current={top:s.top||"",position:s.position||"",overflow:s.overflow||h.overflow||"",width:s.width||"",height:s.height||""},s.overflow="hidden",s.position="fixed",s.top=`-${n.current}px`,s.width="100%",s.height="100vh";const m=document.querySelector("main");return m&&m.setAttribute("aria-hidden","true"),()=>{const _=t.current;_&&(s.overflow=_.overflow,s.position=_.position,s.top=_.top,s.width=_.width,s.height=_.height),m&&m.removeAttribute("aria-hidden"),window.scrollTo(0,n.current),t.current=null}}},[e])},Wae=(e,t)=>{B.useEffect(()=>{if(!t)return;const n=s=>{(s.key==="Escape"||s.key==="Esc")&&e()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,t])},qae=()=>{const{scrollYProgress:e}=Aoe(),[t,n]=B.useState(0),[s,h]=B.useState(0),m=Ioe(e,[0,1],[0,100]);return B.useEffect(()=>{const _=m.on("change",i=>{h(i)});return()=>_()},[m]),B.useEffect(()=>{const _=()=>{const A=document.querySelector("article, main, .content, .prose");if(A){const M=(A.textContent||"").trim().split(/\s+/).filter(z=>z.length>0).length,L=Math.max(1,Math.ceil(M/$ae));n(L)}else n(0)},i=new MutationObserver(_);i.observe(document.body,{childList:!0,subtree:!0,characterData:!0});const S=setTimeout(_,1e3);return()=>{clearTimeout(S),i.disconnect()}},[]),{scrollProgress:s,progressRounded:Math.round(s),estimatedReadingTime:t,scrollYProgress:e}},Zae=({isActive:e})=>b.jsx("nav",{className:"hidden md:block","aria-label":"Main desktop navigation",role:"navigation",children:b.jsx("div",{className:"relative",children:b.jsx("div",{className:"relative flex items-center justify-center gap-1 bg-background/70 backdrop-blur-sm rounded-lg px-2 py-1 shadow-sm ring-1 ring-border/30",children:b.jsx("ul",{className:"relative flex items-center list-none m-0 p-0",children:dw.map(({label:t,to:n,ariaLabel:s,sectionId:h},m)=>{const _=e(n),i=m===dw.length-1;return b.jsxs(_n.li,{className:"relative m-0 p-0",initial:!1,whileHover:{y:-2},whileTap:{y:0},transition:{duration:.2},children:[b.jsxs(FM,{to:n,"aria-label":s||`Navigate to ${t}`,"aria-current":_?"page":void 0,className:({isActive:S})=>{const A=`
                        relative z-10 block px-5 py-2 text-sm font-medium 
                        transition-all duration-200 rounded-lg
                        focus-visible:outline-none focus-visible:ring-2 
                        focus-visible:ring-primary/50 focus-visible:ring-offset-2 
                        focus-visible:ring-offset-background
                        focus-visible:z-20
                        select-none
                      `;return S?`${A} text-primary font-semibold`:`
                        ${A} 
                        text-muted-foreground 
                        hover:text-primary 
                        hover:bg-primary/5 
                        active:bg-primary/10
                      `},onClick:S=>{if(h&&window.location.pathname===n){S.preventDefault();const A=document.getElementById(h);if(A){const L=A.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:L,behavior:"smooth"});const z=`${n}#${h}`;window.location.href!==z&&window.history.pushState(null,"",z)}}},end:!0,children:[_&&b.jsx(_n.div,{layoutId:"desktop-nav-background",className:"absolute inset-0 bg-gradient-to-r from-primary/10 via-primary/15 to-primary/10 rounded-2xl border border-primary/20",transition:{type:"spring",stiffness:300,damping:25},"aria-hidden":"true"}),b.jsx("span",{className:"relative z-10 whitespace-nowrap",children:t}),_&&b.jsx(_n.div,{layoutId:"desktop-nav-underline",className:"absolute bottom-2 left-4 right-4 h-[3px] rounded-full bg-gradient-to-r from-primary via-primary/80 to-primary",transition:{type:"spring",stiffness:380,damping:28,mass:.8},"aria-hidden":"true"})]}),!i&&b.jsx("div",{className:`absolute top-1/2 right-0 w-px h-4 -translate-y-1/2 \r
                               bg-gradient-to-b from-transparent via-border/30 to-transparent`,"aria-hidden":"true"})]},`desktop-nav-${n}-${m}`)})})})})}),Xae=({progress:e,readingTime:t})=>{const[n,s]=B.useState(!1),h=B.useRef(null),_=typeof window<"u"?document.documentElement.scrollHeight>window.innerHeight*1.2:!1,i=Math.max(0,Math.min(100,Number(e||0))),S=20,A=2*Math.PI*S,I=A*(1-i/100),M=_&&i>3&&i<99,L=B.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),z=B.useMemo(()=>{if(!t||t<=0)return null;const F=t*60*((100-e)/100),U=Math.floor(F/60),K=Math.floor(F%60);return U>0?`${U}m ${K}s`:`${K}s`},[e,t]);return B.useEffect(()=>{const G=F=>{h.current&&!h.current.contains(F.target)&&s(!1)};return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[]),b.jsxs(_n.div,{ref:h,initial:{opacity:0,scale:.9,x:20},animate:{opacity:M?1:0,scale:M?1:.9,x:M?0:20},transition:{duration:.3,ease:"easeOut"},className:"fixed right-4 top-1/2 -translate-y-1/2 z-40 hidden lg:flex flex-col items-center gap-3",role:"progressbar","aria-valuenow":Math.round(i),"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Scroll progress","aria-valuetext":t&&t>0?`${Math.round(i)}%  ${z??""} remaining`:`${Math.round(i)}%`,children:[b.jsxs("div",{className:"relative w-12 h-12 cursor-pointer group",onClick:L,onMouseEnter:()=>s(!0),onFocus:()=>s(!0),onBlur:()=>s(!1),role:"button",tabIndex:0,"aria-label":`Back to top. Scroll progress: ${e}%`,onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),L())},children:[b.jsx("div",{className:"absolute inset-0 rounded-full bg-background/80 backdrop-blur-sm border border-border/50 shadow-lg"}),b.jsxs("svg",{className:"w-12 h-12 transform -rotate-90",viewBox:"0 0 48 48","aria-hidden":"true",children:[b.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",stroke:"currentColor",className:"text-border",strokeWidth:"2",strokeLinecap:"round"}),b.jsx(_n.circle,{cx:"24",cy:"24",r:S,fill:"none",stroke:"currentColor",className:"text-primary",strokeWidth:"2",strokeLinecap:"round",strokeDasharray:String(A),strokeDashoffset:I,initial:!1,transition:{duration:.25}})]}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:b.jsxs("span",{className:"text-xs font-semibold text-foreground",children:[Math.round(i),"%"]})}),b.jsx(cg,{children:n&&b.jsx(_n.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:"absolute right-full top-1/2 -translate-y-1/2 mr-3 whitespace-nowrap pointer-events-none",children:b.jsxs("div",{className:"relative bg-background border border-border rounded-lg px-3 py-2 shadow-lg",children:[b.jsxs("div",{className:"text-sm font-medium text-foreground",children:[Math.round(i),"% scrolled"]}),z&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"h-px bg-border my-1"}),b.jsxs("div",{className:"text-xs text-muted-foreground",children:["~",z," remaining"]})]}),b.jsx("div",{className:"absolute top-1/2 -right-2 -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-l-4 border-t-transparent border-b-transparent border-l-background"})]})})})]}),e<10&&b.jsx(_n.div,{animate:{y:[0,5,0]},transition:{repeat:1/0,duration:2},className:"text-muted-foreground","aria-hidden":"true",children:b.jsx(x4,{className:"h-4 w-4 rotate-180"})})]})},Kae=({progress:e})=>{const t=e>5&&e<95,n=()=>{const h=document.querySelectorAll("section[id], article, main, [class*='content']");let m=null;for(const _ of h){const i=_.getBoundingClientRect();if(i.top<=window.innerHeight*.3&&i.bottom>=window.innerHeight*.3){m=_;break}}if(m){const _=m.nextElementSibling;if(_&&_ instanceof HTMLElement){const A=_.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:A,behavior:"smooth"})}}else window.scrollTo({top:0,behavior:"smooth"})},s=e;return b.jsx(_n.div,{initial:{y:100},animate:{y:t?0:100},transition:{type:"spring",stiffness:200,damping:25},className:"fixed bottom-20 left-4 right-4 z-30 md:hidden",role:"progressbar","aria-valuenow":Math.round(s),"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Scroll progress: ${s}%`,children:b.jsxs("div",{className:"relative h-3 bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-lg overflow-hidden cursor-pointer active:scale-95 transition-transform",onClick:n,role:"button",tabIndex:0,"aria-label":`Jump to next section. Progress: ${s}%`,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),n())},children:[b.jsx("div",{className:"absolute inset-0 bg-muted/30"}),b.jsx(_n.div,{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-primary via-primary/80 to-primary",style:{width:`${s}%`},initial:!1,transition:{duration:.2}}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:b.jsxs("span",{className:"text-[10px] font-semibold text-primary-foreground mix-blend-difference select-none",children:[Math.round(s),"%"]})}),b.jsx("div",{className:"absolute inset-y-0 left-0 right-0 flex justify-between px-2",children:[0,25,50,75,100].map(h=>b.jsx("div",{className:"w-px h-full bg-border/50",style:{marginLeft:`calc(${h}% - 1px)`,transform:h===50?"scaleY(1.5)":"scaleY(1)"},"aria-hidden":"true"},h))})]})})},Yae=({isOpen:e,onClose:t,isActive:n,scrollProgress:s})=>{const h=hc(),m=B.useRef(null);B.useEffect(()=>{t()},[h.pathname,t]),Hae(e),Wae(t,e);const _=B.useRef(null);return B.useEffect(()=>{e&&_.current&&setTimeout(()=>{_.current?.focus()},100)},[e]),B.useEffect(()=>{if(!e||!m.current)return;const i=m.current,A=Array.from(i.querySelectorAll('a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])')).filter(M=>!M.hasAttribute("disabled"));if(A.length===0)return;const I=M=>{if(M.key!=="Tab")return;const L=A[0],z=A[A.length-1];M.shiftKey?document.activeElement===L&&(M.preventDefault(),z.focus()):document.activeElement===z&&(M.preventDefault(),L.focus())};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)},[e]),b.jsx(cg,{children:e&&b.jsxs(b.Fragment,{children:[b.jsx(_n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-background/90 backdrop-blur-xl z-40 md:hidden","aria-hidden":"true"}),b.jsxs(_n.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"100%"},transition:{type:"spring",damping:25,stiffness:200},ref:i=>{m.current=i},className:"md:hidden fixed top-0 right-0 bottom-0 w-80 max-w-full z-50 flex flex-col bg-card border-l shadow-2xl",role:"dialog","aria-modal":"true","aria-label":"Mobile navigation menu",children:[b.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[b.jsxs("div",{children:[b.jsx("h2",{className:"text-xl font-bold",children:"Navigation"}),b.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Scroll progress: ",s,"%"]})]}),b.jsx("button",{onClick:t,"aria-label":"Close menu",className:"p-2 rounded-lg hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors",children:b.jsx(oc,{className:"h-6 w-6"})})]}),b.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:dw.map(({label:i,to:S,icon:A,ariaLabel:I},M)=>{const L=n(S);return b.jsxs(FM,{ref:M===0?_:void 0,to:S,"aria-label":I,"aria-current":L?"page":void 0,className:({isActive:z})=>`flex items-center gap-3 rounded-lg px-4 py-4 text-base font-medium transition-all
                       focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2
                       ${z?"bg-primary/10 text-primary shadow-sm":"hover:bg-muted hover:translate-x-1"}`,onClick:t,children:[b.jsx(A,{className:"h-5 w-5 flex-shrink-0"}),b.jsx("span",{className:"flex-1",children:i}),L&&b.jsx(_n.div,{layoutId:"mobile-active",className:"h-2 w-2 rounded-full bg-primary flex-shrink-0","aria-hidden":"true"})]},`mobile-${S}-${M}`)})}),b.jsxs("div",{className:"p-4 border-t",children:[b.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Current scroll"}),b.jsx("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:b.jsx(_n.div,{className:"h-full bg-primary",initial:!1,style:{width:`${s}%`},transition:{duration:.3}})})]})]})]})})},Jae=({isActive:e,scrollProgress:t})=>{const n=t>3,s=t;return b.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-40 md:hidden","aria-label":"Bottom navigation",children:b.jsx("div",{className:"container mx-auto px-4 pb-4",children:b.jsxs(_n.div,{initial:{y:100},animate:{y:0},transition:{type:"spring",stiffness:200,damping:25},className:"mx-auto max-w-md rounded-2xl bg-background/95 backdrop-blur-xl border shadow-xl overflow-hidden",children:[n&&b.jsx(_n.div,{initial:{height:0,opacity:0},animate:{height:3,opacity:1},exit:{height:0,opacity:0},className:"rounded-t-2xl overflow-hidden",role:"progressbar","aria-valuenow":s,children:b.jsx("div",{className:"h-full bg-gradient-to-r from-primary via-primary/80 to-primary transition-all duration-200",style:{width:`${s}%`}})}),b.jsx("div",{className:"flex justify-between items-center px-4 py-2",children:dw.map(({to:h,icon:m,ariaLabel:_})=>{const i=e(h);return b.jsxs(FM,{to:h,"aria-label":_,"aria-current":i?"page":void 0,className:`relative flex flex-col items-center p-2 rounded-lg focus-visible:outline-none \r
                           focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,children:[b.jsx(_n.div,{whileTap:{scale:.9},className:`p-2 rounded-full transition-all duration-200 ${i?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:text-primary hover:bg-muted/50"}`,children:b.jsx(m,{className:"h-5 w-5"})}),i&&b.jsxs(b.Fragment,{children:[b.jsx(_n.span,{layoutId:"bottom-indicator",className:"absolute -bottom-1 h-1 w-6 rounded-full bg-primary","aria-hidden":"true"}),s>0&&s<100&&b.jsx(_n.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2},className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary/80","aria-hidden":"true"})]})]},`bottom-${h}`)})})]})})})};function Ef(){const[e,t]=B.useState(!1),n=Gae(Vae),s=Uae(Bae),h=hc(),{scrollProgress:m,estimatedReadingTime:_}=qae(),i=B.useCallback(L=>L==="/"?h.pathname==="/":h.pathname.startsWith(L),[h.pathname]),S=B.useCallback(()=>{t(L=>!L)},[]),A=B.useCallback(()=>{t(!1)},[]),I=s?"h-16":"h-20",M=s?"h-12 sm:h-14 md:h-16 lg:h-20":"h-16 sm:h-20 md:h-24 lg:h-28";return B.useLayoutEffect(()=>{e?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")},[e]),b.jsxs(b.Fragment,{children:[b.jsx(_n.header,{initial:{y:-80},animate:{y:0},transition:{duration:.6,ease:"easeOut"},className:"fixed inset-x-0 top-0 z-50",role:"banner",children:b.jsx(_n.div,{animate:{backdropFilter:s?"blur(20px)":"blur(10px)",backgroundColor:s?"rgba(var(--background-rgb), 0.85)":"rgba(var(--background-rgb), 0.7)",boxShadow:s?"0 10px 30px rgba(0,0,0,0.15), 0 0 0 1px rgba(var(--border-rgb), 0.1)":"0 4px 12px rgba(0,0,0,0.05)"},className:`relative border-b border-border/40 transition-all duration-300 ${I}`,children:b.jsx("div",{className:"container mx-auto px-4 sm:px-6 h-full",children:b.jsxs("div",{className:"flex items-center justify-between h-full",children:[b.jsx("div",{className:"flex-shrink-0",children:b.jsx(us,{to:"/","aria-label":"Julin Real Estate - Home",className:`focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring \r
                           focus-visible:ring-offset-2 rounded-lg inline-block bg-transparent`,children:b.jsx(_n.img,{src:"/julin/logo.png",alt:"Julin Real Estate Logo",className:`${M} w-auto object-contain transition-all duration-300`,width:160,height:64,whileHover:{scale:1.05},whileTap:{scale:.95},loading:"eager",onError:L=>{const z=L.target;z.style.display="none",console.error("Failed to load logo image")}})})}),b.jsx(Zae,{isActive:i}),b.jsx("div",{className:"md:hidden flex-shrink-0",children:b.jsx(_n.button,{"aria-label":e?"Close menu":"Open menu","aria-expanded":e,"aria-controls":"mobile-menu",onClick:S,whileTap:{scale:.95},className:`h-10 w-10 rounded-full border bg-background/80 backdrop-blur \r
                           flex items-center justify-center hover:bg-muted transition-colors\r
                           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\r
                           relative`,children:e?b.jsx(oc,{className:"h-5 w-5"}):b.jsxs(b.Fragment,{children:[b.jsx(sY,{className:"h-5 w-5"}),m>0&&b.jsx(_n.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary","aria-hidden":"true"})]})})})]})})})}),b.jsx(Xae,{progress:m,readingTime:_}),n&&b.jsx(Kae,{progress:m}),b.jsx(Yae,{isOpen:e,onClose:A,isActive:i,scrollProgress:m}),n&&b.jsx(Jae,{isActive:i,scrollProgress:m})]})}const Qae="modulepreload",ele=function(e){return"/julin/"+e},Ez={},VM=function(t,n,s){let h=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const _=document.querySelector("meta[property=csp-nonce]"),i=_?.nonce||_?.getAttribute("nonce");h=Promise.allSettled(n.map(S=>{if(S=ele(S),S in Ez)return;Ez[S]=!0;const A=S.endsWith(".css"),I=A?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${I}`))return;const M=document.createElement("link");if(M.rel=A?"stylesheet":Qae,A||(M.as="script"),M.crossOrigin="",M.href=S,i&&M.setAttribute("nonce",i),document.head.appendChild(M),A)return new Promise((L,z)=>{M.addEventListener("load",L),M.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${S}`)))})}))}function m(_){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=_,window.dispatchEvent(i),!i.defaultPrevented)throw _}return h.then(_=>{for(const i of _||[])i.status==="rejected"&&m(i.reason);return t().catch(m)})},tle=k0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg hover:shadow-xl hover:scale-105 font-semibold",heroOutline:"border-2 border-primary-foreground/30 bg-primary-foreground/10 text-primary-foreground hover:bg-primary-foreground/20 backdrop-blur-sm font-semibold",accent:"bg-accent text-accent-foreground hover:bg-accent/90 shadow-md hover:shadow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-lg px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Cr=B.forwardRef(({className:e,variant:t,size:n,asChild:s=!1,...h},m)=>{const _=s?H5:"button";return b.jsx(_,{className:Wr(tle({variant:t,size:n,className:e})),ref:m,...h})});Cr.displayName="Button";const rle="/julin/assets/hero-property-DHUdNZVA.jpg",nle="/julin/assets/kenya-real-estate-hero--SBKbFpu.jpg";function ile(e){const[t,n]=B.useState(!1);return B.useEffect(()=>{const s=window.matchMedia(e);s.matches!==t&&n(s.matches);const h=()=>n(s.matches);return window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[t,e]),t}const nf=({icon:e,label:t,children:n,isActive:s=!1})=>b.jsx(_n.div,{className:`
      flex flex-col sm:flex-row items-start sm:items-center gap-3 p-4 
      bg-white/10 backdrop-blur-sm rounded-xl w-full border-2 transition-all duration-300
      hover:bg-white/15 hover:border-accent/50 hover:shadow-lg
      ${s?"border-accent bg-white/15 shadow-lg":"border-transparent"}
      dark:bg-gray-900/20 dark:hover:bg-gray-900/30
    `,whileHover:{scale:1.02},whileTap:{scale:.98},children:b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("div",{className:"p-2 bg-accent/10 rounded-lg",children:b.jsx(e,{className:"h-5 w-5 text-accent flex-shrink-0"})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("label",{className:"text-xs font-medium text-primary-foreground/70 uppercase tracking-wider block mb-1",children:t}),b.jsx("div",{className:"text-foreground font-medium",children:n})]})]})}),ole=()=>{const[e,t]=B.useState(""),[n,s]=B.useState(!1),[h,m]=B.useState([]),[_,i]=B.useState(0),[S,A]=B.useState(!1),[I,M]=B.useState(0),[L,z]=B.useState(""),G=ile("(max-width: 640px)"),F=[rle,nle],U=()=>{if(h.length>0&&!S){const X=h[_%h.length];return X?.images?.[0]||X?.image_url||F[0]}return F[_%F.length]};B.useEffect(()=>{(async()=>{try{const{supabase:ie}=await VM(async()=>{const{supabase:Fe}=await Promise.resolve().then(()=>uce);return{supabase:Fe}},void 0),{data:Q,error:ae}=await ie.from("properties").select("id, title, location, price, property_type, images").eq("status","available").order("created_at",{ascending:!1}).limit(20);if(ae){console.warn("Failed to fetch properties for hero:",ae);return}const pe=Q||[];M(pe.length);const Pe=pe.filter(Fe=>Fe.images&&Fe.images.length>0);Pe.length>0&&m(Pe)}catch(ie){console.warn("Failed to fetch properties for hero:",ie)}})()},[]),B.useEffect(()=>{const X=setInterval(()=>{i(ie=>ie+1),A(!1)},8e3);return()=>clearInterval(X)},[h.length]),B.useEffect(()=>{const X="Discover verified properties across Kenya.";let ie=0;z("");const Q=setInterval(()=>{ie+=1,z(X.slice(0,ie)),ie>=X.length&&clearInterval(Q)},28);return()=>clearInterval(Q)},[]);const K=X=>{X.preventDefault()},J=()=>{document.getElementById("search-section")?.scrollIntoView({behavior:"smooth",block:"center"})};return b.jsxs("section",{id:"home",className:"relative min-h-[70vh] md:min-h-screen flex items-center justify-center pt-16 md:pt-32 overflow-hidden","aria-label":"Hero section",children:[b.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[b.jsx(cg,{mode:"wait",children:b.jsx(_n.img,{src:U(),alt:"Real estate property in Kenya",className:"w-full h-full object-cover object-center",style:{filter:"brightness(0.72) saturate(1.02)"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:1.2,ease:"easeOut"},loading:"eager",fetchPriority:"high",onError:()=>A(!0)},_)}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-navy/40 via-navy/28 to-navy/20"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-navy/10 via-transparent to-transparent opacity-30"}),b.jsx(_n.div,{className:"absolute top-20 right-20 w-72 h-72 bg-accent/10 rounded-full blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),b.jsx(_n.div,{className:"absolute bottom-20 left-20 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl",animate:{scale:[1.2,1,1.2],opacity:[.2,.4,.2]},transition:{duration:10,repeat:1/0,ease:"easeInOut",delay:1}})]}),h.length>0&&b.jsxs(_n.div,{className:"absolute bottom-6 left-6 z-20 hidden md:flex flex-col gap-2 bg-white/10 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20 max-w-xs",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1},children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(qc,{className:"h-4 w-4 text-accent"}),b.jsx("span",{className:"text-sm font-medium text-primary-foreground/90",children:h[_%h.length]?.location||"Featured Property"})]}),b.jsx("div",{className:"text-xs text-primary-foreground/70",children:h[_%h.length]?.title||"Premium Real Estate"}),b.jsx("div",{className:"flex items-center gap-1 mt-1",children:h.map((X,ie)=>b.jsx("button",{onClick:()=>i(ie),className:`w-2 h-2 rounded-full transition-all ${ie===_%h.length?"bg-accent scale-125":"bg-white/40 hover:bg-white/60"}`},ie))})]},_),I>=300&&b.jsxs("div",{className:"absolute top-6 right-6 z-20 hidden md:flex flex-col gap-2",children:[b.jsxs(_n.div,{className:"flex items-center gap-2 bg-white/10 backdrop-blur-md rounded-full px-4 py-2 border border-white/20",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:[b.jsx(pY,{className:"h-4 w-4 text-green-400"}),b.jsxs("span",{className:"text-xs font-medium text-primary-foreground/90",children:[I>=1e3?`${Math.floor(I/100)*100}+`:I.toLocaleString()," Verified Properties"]})]}),b.jsxs(_n.div,{className:"flex items-center gap-2 bg-white/10 backdrop-blur-md rounded-full px-4 py-2 border border-white/20",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7},children:[b.jsx(S4,{className:"h-4 w-4 text-yellow-400"}),b.jsx("span",{className:"text-xs font-medium text-primary-foreground/90",children:"98% Client Satisfaction"})]})]}),b.jsxs("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 xl:px-20",children:[b.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[b.jsxs(_n.div,{className:"text-center lg:text-left",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:[b.jsxs(_n.span,{className:"inline-flex items-center gap-2 text-accent font-semibold text-sm tracking-widest uppercase mb-3 px-3 py-1 bg-accent/10 rounded-full",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[b.jsx("div",{className:"w-2 h-2 bg-accent rounded-full animate-pulse"}),"Julin Real Estate"]}),b.jsx(_n.h1,{className:"font-serif text-3xl sm:text-4xl lg:text-5xl font-bold text-primary-foreground mb-3 leading-tight",initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{delay:.25},children:"Find verified properties in Kenya"}),b.jsxs(_n.p,{className:"text-sm sm:text-base text-primary-foreground/90 mb-6 max-w-md lg:max-w-xl leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[L,b.jsx("span",{className:"ml-1 inline-block text-accent","aria-hidden":!0,children:b.jsx("span",{className:"animate-pulse",children:""})})]}),I>=300&&b.jsxs(_n.div,{className:"flex flex-wrap justify-center lg:justify-start gap-6 mb-10",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[b.jsxs("div",{className:"text-center lg:text-left",children:[b.jsx("div",{className:"text-3xl font-bold text-accent",children:I>=1e3?`${Math.floor(I/100)*100}+`:I.toLocaleString()}),b.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Properties Listed"})]}),b.jsxs("div",{className:"text-center lg:text-left",children:[b.jsx("div",{className:"text-3xl font-bold text-accent",children:"98%"}),b.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Client Satisfaction"})]}),b.jsxs("div",{className:"text-center lg:text-left",children:[b.jsx("div",{className:"text-3xl font-bold text-accent",children:"24/7"}),b.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Support Available"})]})]}),b.jsxs(_n.div,{className:"flex flex-col sm:flex-row gap-3 justify-center lg:justify-start mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[b.jsx(us,{to:"/properties",className:"flex-1 sm:flex-initial",children:b.jsxs(Cr,{variant:"hero",size:G?"default":"lg",className:"w-full sm:w-auto group",children:[b.jsx(ig,{className:"h-5 w-5 mr-2 group-hover:rotate-12 transition-transform"}),"Browse Properties",b.jsx(q1,{className:"h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"})]})}),b.jsxs(Cr,{variant:"heroOutline",size:G?"default":"lg",className:"group",onClick:J,children:[b.jsx(xL,{className:"h-4 w-4 mr-2"}),"Advanced Search"]})]})]}),b.jsxs(_n.div,{id:"search-section",className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 lg:p-8 shadow-2xl border border-white/20",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.7},whileHover:{y:-5},children:[b.jsxs("div",{className:"mb-8",children:[b.jsx("h2",{className:"text-2xl font-bold text-primary-foreground mb-2",children:"Find Your Dream Property"}),b.jsx("p",{className:"text-primary-foreground/70",children:"Search through our verified listings with advanced filters"})]}),b.jsxs("form",{onSubmit:K,className:"space-y-6",children:[b.jsxs("div",{className:"space-y-4",children:[b.jsx(nf,{icon:qc,label:"Location",isActive:e==="location",children:b.jsx("input",{type:"text",placeholder:"Nairobi, Mombasa, Kisumu...",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50",onFocus:()=>t("location"),onBlur:()=>t("")})}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.jsx(nf,{icon:Lc,label:"Property Type",isActive:e==="type",children:b.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",onFocus:()=>t("type"),onBlur:()=>t(""),children:[b.jsx("option",{value:"",children:"Any Type"}),b.jsx("option",{value:"house",children:"House"}),b.jsx("option",{value:"apartment",children:"Apartment"}),b.jsx("option",{value:"land",children:"Land"}),b.jsx("option",{value:"commercial",children:"Commercial"}),b.jsx("option",{value:"villa",children:"Villa"})]})}),b.jsx(nf,{icon:YK,label:"Price Range",isActive:e==="price",children:b.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",onFocus:()=>t("price"),onBlur:()=>t(""),children:[b.jsx("option",{value:"",children:"Any Price"}),b.jsx("option",{value:"0-5",children:"Under KES 5M"}),b.jsx("option",{value:"5-10",children:"KES 5M - 10M"}),b.jsx("option",{value:"10-20",children:"KES 10M - 20M"}),b.jsx("option",{value:"20-50",children:"KES 20M - 50M"}),b.jsx("option",{value:"50+",children:"Above KES 50M"})]})})]})]}),b.jsxs("button",{type:"button",className:"flex items-center gap-2 text-sm text-primary-foreground/70 hover:text-accent transition-colors",onClick:()=>s(!n),children:[b.jsx(xL,{className:"h-4 w-4"}),n?"Hide":"Show"," Advanced Filters"]}),b.jsx(cg,{children:n&&b.jsxs(_n.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4 overflow-hidden",children:[b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.jsx(nf,{icon:Lc,label:"Bedrooms",children:b.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",children:[b.jsx("option",{children:"Any"}),b.jsx("option",{children:"1+"}),b.jsx("option",{children:"2+"}),b.jsx("option",{children:"3+"}),b.jsx("option",{children:"4+"}),b.jsx("option",{children:"5+"})]})}),b.jsx(nf,{icon:Lc,label:"Bathrooms",children:b.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",children:[b.jsx("option",{children:"Any"}),b.jsx("option",{children:"1+"}),b.jsx("option",{children:"2+"}),b.jsx("option",{children:"3+"}),b.jsx("option",{children:"4+"})]})})]}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.jsx(nf,{icon:Lc,label:"Square Feet",children:b.jsx("input",{type:"text",placeholder:"Min sq ft",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50"})}),b.jsx(nf,{icon:Lc,label:"Year Built",children:b.jsx("input",{type:"text",placeholder:"After year",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50"})})]})]})}),b.jsx(_n.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:b.jsxs(Cr,{type:"submit",variant:"default",size:"lg",className:"w-full h-14 text-lg font-semibold bg-gradient-to-r from-accent to-blue-600 hover:from-accent/90 hover:to-blue-600/90",children:[b.jsx(ig,{className:"h-5 w-5 mr-2"}),"Search Properties",b.jsx("span",{className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]})}),b.jsxs("div",{className:"pt-4 border-t border-white/10",children:[b.jsx("p",{className:"text-sm text-primary-foreground/70 mb-3",children:"Popular Searches:"}),b.jsx("div",{className:"flex flex-wrap gap-2",children:["Nairobi Apartments","Mombasa Beach House","Kisumu Land","Nakuru Commercial"].map(X=>b.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm bg-white/5 hover:bg-accent/20 rounded-full border border-white/10 hover:border-accent/30 transition-colors",children:X},X))})]})]})]})]}),b.jsx(_n.div,{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 hidden md:block",animate:{y:[0,10,0]},transition:{duration:2,repeat:1/0},children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-xs text-primary-foreground/60 mb-2",children:"Scroll to explore"}),b.jsx("div",{className:"w-6 h-10 border-2 border-primary-foreground/30 rounded-full flex justify-center",children:b.jsx("div",{className:"w-1 h-3 bg-primary-foreground/50 rounded-full mt-2"})})]})})]})]})},sle=k0("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold",{variants:{variant:{default:"bg-muted text-muted-foreground",secondary:"bg-secondary text-secondary-foreground",destructive:"bg-destructive text-destructive-foreground",outline:"border border-input bg-background"}},defaultVariants:{variant:"default"}}),Us=B.forwardRef(({className:e,variant:t,asChild:n=!1,...s},h)=>{const m=n?H5:"span";return b.jsx(m,{ref:h,className:Wr(sle({variant:t}),e),...s})});Us.displayName="Badge";var vA="focusScope.autoFocusOnMount",xA="focusScope.autoFocusOnUnmount",Az={bubbles:!1,cancelable:!0},ale="FocusScope",VT=B.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:h,onUnmountAutoFocus:m,..._}=e,[i,S]=B.useState(null),A=va(h),I=va(m),M=B.useRef(null),L=li(t,F=>S(F)),z=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(s){let F=function(X){if(z.paused||!i)return;const ie=X.target;i.contains(ie)?M.current=ie:jh(M.current,{select:!0})},U=function(X){if(z.paused||!i)return;const ie=X.relatedTarget;ie!==null&&(i.contains(ie)||jh(M.current,{select:!0}))},K=function(X){if(document.activeElement===document.body)for(const Q of X)Q.removedNodes.length>0&&jh(i)};document.addEventListener("focusin",F),document.addEventListener("focusout",U);const J=new MutationObserver(K);return i&&J.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",F),document.removeEventListener("focusout",U),J.disconnect()}}},[s,i,z.paused]),B.useEffect(()=>{if(i){Cz.add(z);const F=document.activeElement;if(!i.contains(F)){const K=new CustomEvent(vA,Az);i.addEventListener(vA,A),i.dispatchEvent(K),K.defaultPrevented||(lle(fle(TU(i)),{select:!0}),document.activeElement===F&&jh(i))}return()=>{i.removeEventListener(vA,A),setTimeout(()=>{const K=new CustomEvent(xA,Az);i.addEventListener(xA,I),i.dispatchEvent(K),K.defaultPrevented||jh(F??document.body,{select:!0}),i.removeEventListener(xA,I),Cz.remove(z)},0)}}},[i,A,I,z]);const G=B.useCallback(F=>{if(!n&&!s||z.paused)return;const U=F.key==="Tab"&&!F.altKey&&!F.ctrlKey&&!F.metaKey,K=document.activeElement;if(U&&K){const J=F.currentTarget,[X,ie]=cle(J);X&&ie?!F.shiftKey&&K===ie?(F.preventDefault(),n&&jh(X,{select:!0})):F.shiftKey&&K===X&&(F.preventDefault(),n&&jh(ie,{select:!0})):K===J&&F.preventDefault()}},[n,s,z.paused]);return b.jsx(En.div,{tabIndex:-1,..._,ref:L,onKeyDown:G})});VT.displayName=ale;function lle(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(jh(s,{select:t}),document.activeElement!==n)return}function cle(e){const t=TU(e),n=Pz(t,e),s=Pz(t.reverse(),e);return[n,s]}function TU(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const h=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||h?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Pz(e,t){for(const n of e)if(!ule(n,{upTo:t}))return n}function ule(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function hle(e){return e instanceof HTMLInputElement&&"select"in e}function jh(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&hle(e)&&t&&e.select()}}var Cz=dle();function dle(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=Iz(e,t),e.unshift(t)},remove(t){e=Iz(e,t),e[0]?.resume()}}}function Iz(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function fle(e){return e.filter(t=>t.tagName!=="A")}var bA=0;function $M(){B.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Mz()),document.body.insertAdjacentElement("beforeend",e[1]??Mz()),bA++,()=>{bA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),bA--}},[])}function Mz(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var H1="right-scroll-bar-position",W1="width-before-scroll-bar",ple="with-scroll-bars-hidden",mle="--removed-body-scroll-bar-size";function wA(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function gle(e,t){var n=B.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var h=n.value;h!==s&&(n.value=s,n.callback(s,h))}}}})[0];return n.callback=t,n.facade}var yle=typeof window<"u"?B.useLayoutEffect:B.useEffect,Oz=new WeakMap;function _le(e,t){var n=gle(null,function(s){return e.forEach(function(h){return wA(h,s)})});return yle(function(){var s=Oz.get(n);if(s){var h=new Set(s),m=new Set(e),_=n.current;h.forEach(function(i){m.has(i)||wA(i,null)}),m.forEach(function(i){h.has(i)||wA(i,_)})}Oz.set(n,e)},[e]),n}function vle(e){return e}function xle(e,t){t===void 0&&(t=vle);var n=[],s=!1,h={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(m){var _=t(m,s);return n.push(_),function(){n=n.filter(function(i){return i!==_})}},assignSyncMedium:function(m){for(s=!0;n.length;){var _=n;n=[],_.forEach(m)}n={push:function(i){return m(i)},filter:function(){return n}}},assignMedium:function(m){s=!0;var _=[];if(n.length){var i=n;n=[],i.forEach(m),_=n}var S=function(){var I=_;_=[],I.forEach(m)},A=function(){return Promise.resolve().then(S)};A(),n={push:function(I){_.push(I),A()},filter:function(I){return _=_.filter(I),n}}}};return h}function ble(e){e===void 0&&(e={});var t=xle(null);return t.options=Nh({async:!0,ssr:!1},e),t}var SU=function(e){var t=e.sideCar,n=B5(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return B.createElement(s,Nh({},n))};SU.isSideCarExport=!0;function wle(e,t){return e.useMedium(t),SU}var EU=ble(),TA=function(){},$T=B.forwardRef(function(e,t){var n=B.useRef(null),s=B.useState({onScrollCapture:TA,onWheelCapture:TA,onTouchMoveCapture:TA}),h=s[0],m=s[1],_=e.forwardProps,i=e.children,S=e.className,A=e.removeScrollBar,I=e.enabled,M=e.shards,L=e.sideCar,z=e.noRelative,G=e.noIsolation,F=e.inert,U=e.allowPinchZoom,K=e.as,J=K===void 0?"div":K,X=e.gapMode,ie=B5(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Q=L,ae=_le([n,t]),pe=Nh(Nh({},ie),h);return B.createElement(B.Fragment,null,I&&B.createElement(Q,{sideCar:EU,removeScrollBar:A,shards:M,noRelative:z,noIsolation:G,inert:F,setCallbacks:m,allowPinchZoom:!!U,lockRef:n,gapMode:X}),_?B.cloneElement(B.Children.only(i),Nh(Nh({},pe),{ref:ae})):B.createElement(J,Nh({},pe,{className:S,ref:ae}),i))});$T.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};$T.classNames={fullWidth:W1,zeroRight:H1};var Tle=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Sle(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Tle();return t&&e.setAttribute("nonce",t),e}function Ele(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function Ale(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var Ple=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Sle())&&(Ele(t,n),Ale(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Cle=function(){var e=Ple();return function(t,n){B.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},AU=function(){var e=Cle(),t=function(n){var s=n.styles,h=n.dynamic;return e(s,h),null};return t},Ile={left:0,top:0,right:0,gap:0},SA=function(e){return parseInt(e||"",10)||0},Mle=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],h=t[e==="padding"?"paddingRight":"marginRight"];return[SA(n),SA(s),SA(h)]},Ole=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Ile;var t=Mle(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},Rle=AU(),Jm="data-scroll-locked",Dle=function(e,t,n,s){var h=e.left,m=e.top,_=e.right,i=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(ple,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(i,"px ").concat(s,`;
  }
  body[`).concat(Jm,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(h,`px;
    padding-top: `).concat(m,`px;
    padding-right: `).concat(_,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(i,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(H1,` {
    right: `).concat(i,"px ").concat(s,`;
  }
  
  .`).concat(W1,` {
    margin-right: `).concat(i,"px ").concat(s,`;
  }
  
  .`).concat(H1," .").concat(H1,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(W1," .").concat(W1,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Jm,`] {
    `).concat(mle,": ").concat(i,`px;
  }
`)},Rz=function(){var e=parseInt(document.body.getAttribute(Jm)||"0",10);return isFinite(e)?e:0},kle=function(){B.useEffect(function(){return document.body.setAttribute(Jm,(Rz()+1).toString()),function(){var e=Rz()-1;e<=0?document.body.removeAttribute(Jm):document.body.setAttribute(Jm,e.toString())}},[])},jle=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,h=s===void 0?"margin":s;kle();var m=B.useMemo(function(){return Ole(h)},[h]);return B.createElement(Rle,{styles:Dle(m,!t,h,n?"":"!important")})},ZP=!1;if(typeof window<"u")try{var d1=Object.defineProperty({},"passive",{get:function(){return ZP=!0,!0}});window.addEventListener("test",d1,d1),window.removeEventListener("test",d1,d1)}catch{ZP=!1}var Mm=ZP?{passive:!1}:!1,Lle=function(e){return e.tagName==="TEXTAREA"},PU=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Lle(e)&&n[t]==="visible")},Nle=function(e){return PU(e,"overflowY")},zle=function(e){return PU(e,"overflowX")},Dz=function(e,t){var n=t.ownerDocument,s=t;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var h=CU(e,s);if(h){var m=IU(e,s),_=m[1],i=m[2];if(_>i)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},Fle=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},Ble=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},CU=function(e,t){return e==="v"?Nle(t):zle(t)},IU=function(e,t){return e==="v"?Fle(t):Ble(t)},Vle=function(e,t){return e==="h"&&t==="rtl"?-1:1},$le=function(e,t,n,s,h){var m=Vle(e,window.getComputedStyle(t).direction),_=m*s,i=n.target,S=t.contains(i),A=!1,I=_>0,M=0,L=0;do{if(!i)break;var z=IU(e,i),G=z[0],F=z[1],U=z[2],K=F-U-m*G;(G||K)&&CU(e,i)&&(M+=K,L+=G);var J=i.parentNode;i=J&&J.nodeType===Node.DOCUMENT_FRAGMENT_NODE?J.host:J}while(!S&&i!==document.body||S&&(t.contains(i)||t===i));return(I&&(Math.abs(M)<1||!h)||!I&&(Math.abs(L)<1||!h))&&(A=!0),A},f1=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},kz=function(e){return[e.deltaX,e.deltaY]},jz=function(e){return e&&"current"in e?e.current:e},Ule=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Gle=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Hle=0,Om=[];function Wle(e){var t=B.useRef([]),n=B.useRef([0,0]),s=B.useRef(),h=B.useState(Hle++)[0],m=B.useState(AU)[0],_=B.useRef(e);B.useEffect(function(){_.current=e},[e]),B.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(h));var F=$X([e.lockRef.current],(e.shards||[]).map(jz),!0).filter(Boolean);return F.forEach(function(U){return U.classList.add("allow-interactivity-".concat(h))}),function(){document.body.classList.remove("block-interactivity-".concat(h)),F.forEach(function(U){return U.classList.remove("allow-interactivity-".concat(h))})}}},[e.inert,e.lockRef.current,e.shards]);var i=B.useCallback(function(F,U){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!_.current.allowPinchZoom;var K=f1(F),J=n.current,X="deltaX"in F?F.deltaX:J[0]-K[0],ie="deltaY"in F?F.deltaY:J[1]-K[1],Q,ae=F.target,pe=Math.abs(X)>Math.abs(ie)?"h":"v";if("touches"in F&&pe==="h"&&ae.type==="range")return!1;var Pe=Dz(pe,ae);if(!Pe)return!0;if(Pe?Q=pe:(Q=pe==="v"?"h":"v",Pe=Dz(pe,ae)),!Pe)return!1;if(!s.current&&"changedTouches"in F&&(X||ie)&&(s.current=Q),!Q)return!0;var Fe=s.current||Q;return $le(Fe,U,F,Fe==="h"?X:ie,!0)},[]),S=B.useCallback(function(F){var U=F;if(!(!Om.length||Om[Om.length-1]!==m)){var K="deltaY"in U?kz(U):f1(U),J=t.current.filter(function(Q){return Q.name===U.type&&(Q.target===U.target||U.target===Q.shadowParent)&&Ule(Q.delta,K)})[0];if(J&&J.should){U.cancelable&&U.preventDefault();return}if(!J){var X=(_.current.shards||[]).map(jz).filter(Boolean).filter(function(Q){return Q.contains(U.target)}),ie=X.length>0?i(U,X[0]):!_.current.noIsolation;ie&&U.cancelable&&U.preventDefault()}}},[]),A=B.useCallback(function(F,U,K,J){var X={name:F,delta:U,target:K,should:J,shadowParent:qle(K)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(ie){return ie!==X})},1)},[]),I=B.useCallback(function(F){n.current=f1(F),s.current=void 0},[]),M=B.useCallback(function(F){A(F.type,kz(F),F.target,i(F,e.lockRef.current))},[]),L=B.useCallback(function(F){A(F.type,f1(F),F.target,i(F,e.lockRef.current))},[]);B.useEffect(function(){return Om.push(m),e.setCallbacks({onScrollCapture:M,onWheelCapture:M,onTouchMoveCapture:L}),document.addEventListener("wheel",S,Mm),document.addEventListener("touchmove",S,Mm),document.addEventListener("touchstart",I,Mm),function(){Om=Om.filter(function(F){return F!==m}),document.removeEventListener("wheel",S,Mm),document.removeEventListener("touchmove",S,Mm),document.removeEventListener("touchstart",I,Mm)}},[]);var z=e.removeScrollBar,G=e.inert;return B.createElement(B.Fragment,null,G?B.createElement(m,{styles:Gle(h)}):null,z?B.createElement(jle,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function qle(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const Zle=wle(EU,Wle);var UT=B.forwardRef(function(e,t){return B.createElement($T,Nh({},e,{ref:t,sideCar:Zle}))});UT.classNames=$T.classNames;var Xle=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Rm=new WeakMap,p1=new WeakMap,m1={},EA=0,MU=function(e){return e&&(e.host||MU(e.parentNode))},Kle=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=MU(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},Yle=function(e,t,n,s){var h=Kle(t,Array.isArray(e)?e:[e]);m1[n]||(m1[n]=new WeakMap);var m=m1[n],_=[],i=new Set,S=new Set(h),A=function(M){!M||i.has(M)||(i.add(M),A(M.parentNode))};h.forEach(A);var I=function(M){!M||S.has(M)||Array.prototype.forEach.call(M.children,function(L){if(i.has(L))I(L);else try{var z=L.getAttribute(s),G=z!==null&&z!=="false",F=(Rm.get(L)||0)+1,U=(m.get(L)||0)+1;Rm.set(L,F),m.set(L,U),_.push(L),F===1&&G&&p1.set(L,!0),U===1&&L.setAttribute(n,"true"),G||L.setAttribute(s,"true")}catch(K){console.error("aria-hidden: cannot operate on ",L,K)}})};return I(t),i.clear(),EA++,function(){_.forEach(function(M){var L=Rm.get(M)-1,z=m.get(M)-1;Rm.set(M,L),m.set(M,z),L||(p1.has(M)||M.removeAttribute(s),p1.delete(M)),z||M.removeAttribute(n)}),EA--,EA||(Rm=new WeakMap,Rm=new WeakMap,p1=new WeakMap,m1={})}},UM=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),h=Xle(e);return h?(s.push.apply(s,Array.from(h.querySelectorAll("[aria-live]"))),Yle(s,h,n,"aria-hidden")):function(){return null}},GT="Dialog",[OU,Dze]=cc(GT),[Jle,dc]=OU(GT),RU=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:h,onOpenChange:m,modal:_=!0}=e,i=B.useRef(null),S=B.useRef(null),[A,I]=Wh({prop:s,defaultProp:h??!1,onChange:m,caller:GT});return b.jsx(Jle,{scope:t,triggerRef:i,contentRef:S,contentId:Du(),titleId:Du(),descriptionId:Du(),open:A,onOpenChange:I,onOpenToggle:B.useCallback(()=>I(M=>!M),[I]),modal:_,children:n})};RU.displayName=GT;var DU="DialogTrigger",kU=B.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,h=dc(DU,n),m=li(t,h.triggerRef);return b.jsx(En.button,{type:"button","aria-haspopup":"dialog","aria-expanded":h.open,"aria-controls":h.contentId,"data-state":WM(h.open),...s,ref:m,onClick:Ar(e.onClick,h.onOpenToggle)})});kU.displayName=DU;var GM="DialogPortal",[Qle,jU]=OU(GM,{forceMount:void 0}),LU=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:h}=e,m=dc(GM,t);return b.jsx(Qle,{scope:t,forceMount:n,children:B.Children.map(s,_=>b.jsx(uc,{present:n||m.open,children:b.jsx(R0,{asChild:!0,container:h,children:_})}))})};LU.displayName=GM;var fw="DialogOverlay",NU=B.forwardRef((e,t)=>{const n=jU(fw,e.__scopeDialog),{forceMount:s=n.forceMount,...h}=e,m=dc(fw,e.__scopeDialog);return m.modal?b.jsx(uc,{present:s||m.open,children:b.jsx(tce,{...h,ref:t})}):null});NU.displayName=fw;var ece=wf("DialogOverlay.RemoveScroll"),tce=B.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,h=dc(fw,n);return b.jsx(UT,{as:ece,allowPinchZoom:!0,shards:[h.contentRef],children:b.jsx(En.div,{"data-state":WM(h.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),Af="DialogContent",zU=B.forwardRef((e,t)=>{const n=jU(Af,e.__scopeDialog),{forceMount:s=n.forceMount,...h}=e,m=dc(Af,e.__scopeDialog);return b.jsx(uc,{present:s||m.open,children:m.modal?b.jsx(rce,{...h,ref:t}):b.jsx(nce,{...h,ref:t})})});zU.displayName=Af;var rce=B.forwardRef((e,t)=>{const n=dc(Af,e.__scopeDialog),s=B.useRef(null),h=li(t,n.contentRef,s);return B.useEffect(()=>{const m=s.current;if(m)return UM(m)},[]),b.jsx(FU,{...e,ref:h,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ar(e.onCloseAutoFocus,m=>{m.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Ar(e.onPointerDownOutside,m=>{const _=m.detail.originalEvent,i=_.button===0&&_.ctrlKey===!0;(_.button===2||i)&&m.preventDefault()}),onFocusOutside:Ar(e.onFocusOutside,m=>m.preventDefault())})}),nce=B.forwardRef((e,t)=>{const n=dc(Af,e.__scopeDialog),s=B.useRef(!1),h=B.useRef(!1);return b.jsx(FU,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{e.onCloseAutoFocus?.(m),m.defaultPrevented||(s.current||n.triggerRef.current?.focus(),m.preventDefault()),s.current=!1,h.current=!1},onInteractOutside:m=>{e.onInteractOutside?.(m),m.defaultPrevented||(s.current=!0,m.detail.originalEvent.type==="pointerdown"&&(h.current=!0));const _=m.target;n.triggerRef.current?.contains(_)&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&h.current&&m.preventDefault()}})}),FU=B.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:h,onCloseAutoFocus:m,..._}=e,i=dc(Af,n),S=B.useRef(null),A=li(t,S);return $M(),b.jsxs(b.Fragment,{children:[b.jsx(VT,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:h,onUnmountAutoFocus:m,children:b.jsx(zg,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":WM(i.open),..._,ref:A,onDismiss:()=>i.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(ice,{titleId:i.titleId}),b.jsx(sce,{contentRef:S,descriptionId:i.descriptionId})]})]})}),HM="DialogTitle",BU=B.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,h=dc(HM,n);return b.jsx(En.h2,{id:h.titleId,...s,ref:t})});BU.displayName=HM;var VU="DialogDescription",$U=B.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,h=dc(VU,n);return b.jsx(En.p,{id:h.descriptionId,...s,ref:t})});$U.displayName=VU;var UU="DialogClose",GU=B.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,h=dc(UU,n);return b.jsx(En.button,{type:"button",...s,ref:t,onClick:Ar(e.onClick,()=>h.onOpenChange(!1))})});GU.displayName=UU;function WM(e){return e?"open":"closed"}var HU="DialogTitleWarning",[kze,WU]=eK(HU,{contentName:Af,titleName:HM,docsSlug:"dialog"}),ice=({titleId:e})=>{const t=WU(HU),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return B.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},oce="DialogDescriptionWarning",sce=({contentRef:e,descriptionId:t})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${WU(oce).contentName}}.`;return B.useEffect(()=>{const h=e.current?.getAttribute("aria-describedby");t&&h&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},qU=RU,ZU=kU,XU=LU,HT=NU,WT=zU,qT=BU,ZT=$U,KU=GU;const Vu=qU,YU=ZU,ace=XU,JU=B.forwardRef(({className:e,...t},n)=>b.jsx(HT,{ref:n,className:Wr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));JU.displayName=HT.displayName;const Kc=B.forwardRef(({className:e,children:t,...n},s)=>b.jsxs(ace,{children:[b.jsx(JU,{}),b.jsxs(WT,{ref:s,className:Wr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[t,b.jsxs(KU,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[b.jsx(oc,{className:"h-4 w-4"}),b.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Kc.displayName=WT.displayName;const Qh=({className:e,...t})=>b.jsx("div",{className:Wr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});Qh.displayName="DialogHeader";const U0=({className:e,...t})=>b.jsx("div",{className:Wr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});U0.displayName="DialogFooter";const qu=B.forwardRef(({className:e,...t},n)=>b.jsx(qT,{ref:n,className:Wr("text-lg font-semibold leading-none tracking-tight",e),...t}));qu.displayName=qT.displayName;const qM=B.forwardRef(({className:e,...t},n)=>b.jsx(ZT,{ref:n,className:Wr("text-sm text-muted-foreground",e),...t}));qM.displayName=ZT.displayName;const Mn=B.forwardRef(({className:e,type:t,...n},s)=>b.jsx("input",{type:t,className:Wr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:s,...n}));Mn.displayName="Input";const fl=B.forwardRef(({className:e,...t},n)=>b.jsx("textarea",{className:Wr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));fl.displayName="Textarea";const lce="https://fakkzdfwpucpgndofgcu.supabase.co",XP="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",cce=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:void 0,Er=UX(lce,XP,{auth:{storage:cce,persistSession:!0,autoRefreshToken:!0}});try{if(typeof window<"u"&&typeof window.fetch=="function"){const e=window,t=e.fetch.bind(e);e.fetch=async(n,s)=>{try{const h=typeof n=="string"?n:n.url;if(typeof window.localStorage<"u"&&window.localStorage.getItem("debug_supabase")==="1"&&typeof h=="string"&&h.includes(".supabase.co")){const _=XP?`${String(XP).slice(0,6)}...`:"not-set";if(console.groupCollapsed("[supabase-debug] outgoing request to Supabase"),console.log("URL:",h),console.log("Masked publishable key:",_),s?.headers){const i=s.headers instanceof Headers?Object.fromEntries(s.headers.entries()):s.headers;console.log("Request headers:",i),console.log("Authorization:",(i&&(i.Authorization||i.authorization))??null),console.log("apikey:",i?i.apikey??null:null)}console.groupEnd()}}catch{}return t(n,s)}}}catch{}const uce=Object.freeze(Object.defineProperty({__proto__:null,supabase:Er},Symbol.toStringTag,{value:"Module"}));function KP(e,t="254"){if(!e)return null;let n=e.trim().replace(/[^\d+]/g,"");return n.startsWith("+")&&(n=n.slice(1)),/^0\d{9}$/.test(n)&&(n=`${t}${n.slice(1)}`),new RegExp(`^${t}\\d{9}$`).test(n)?n:null}function pw(e,t=""){const n=KP(e),s=encodeURIComponent(t.trim());return n?s?`https://wa.me/${n}?text=${s}`:`https://wa.me/${n}`:s?`https://wa.me/?text=${s}`:"https://wa.me/"}function $h(e){const t=B.useRef(null),[n,s]=B.useState(!1);return B.useEffect(()=>{if(!t.current)return;const h=t.current,m=new IntersectionObserver(_=>{_.forEach(i=>{if(i.isIntersecting){s(!0);try{m.unobserve(i.target)}catch{}}})},{threshold:.15});return m.observe(h),()=>m.disconnect()},[t,e]),{ref:t,inView:n}}const QU=({property:e})=>{const t=$h(),{id:n,title:s,location:h,price:m,size:_,description:i,seller_phone:S,images:A=[],video_url:I,status:M}=e,L=rU(),[z,G]=B.useState(!1),[F,U]=B.useState(""),[K,J]=B.useState(""),[X,ie]=B.useState(`I'm interested in ${s}. Kindly share more details.`),Q=sse({mutationFn:async He=>{const{error:qe}=await Er.from("buyer_inquiries").insert([He]);if(qe)throw qe;return He},onSuccess:He=>{const qe=pw(S||"",He.message);G(!1),L.invalidateQueries({queryKey:["properties"]}),window.open(qe,"_blank")},onError:He=>{console.error(He),rn({title:"Error",description:He?.message||"Failed to record inquiry.",variant:"destructive"})}}),ae=He=>{if(He?.preventDefault(),He?.stopPropagation(),!F||!K){rn({title:"Missing info",description:"Please provide your name and phone number.",variant:"destructive"});return}Q.mutate({property_id:n,buyer_name:F,buyer_phone:K,message:X})},pe=A||[],[Pe,Fe]=B.useState(!1),[tt,Be]=B.useState(0),Ge=B.useCallback((He,qe)=>{qe?.preventDefault(),qe?.stopPropagation(),Be(He),Fe(!0)},[]),Qe=B.useCallback(He=>{He?.stopPropagation(),Be(qe=>(qe-1+pe.length)%Math.max(1,pe.length))},[pe.length]),Ke=B.useCallback(He=>{He?.stopPropagation(),Be(qe=>(qe+1)%Math.max(1,pe.length))},[pe.length]);B.useEffect(()=>{if(!Pe)return;const He=qe=>{qe.key==="ArrowLeft"&&Qe(),qe.key==="ArrowRight"&&Ke(),qe.key==="Escape"&&Fe(!1)};return window.addEventListener("keydown",He),()=>window.removeEventListener("keydown",He)},[Pe,pe.length,Qe,Ke]);const ct=M==="available"?"For Sale":M==="sold"?"Sold":M==="pending"?"Pending":String(M);return b.jsxs(us,{to:`/property/${n}`,className:"block","aria-label":`View details for ${s}`,children:[b.jsxs("article",{ref:t.ref,style:{transitionDelay:`${e.__delay??0}ms`},className:`group bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-card-hover transition-all duration-300 hover:-translate-y-1 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsxs("div",{className:"relative h-64 overflow-hidden",children:[b.jsxs("button",{onClick:He=>Ge(0,He),className:"block w-full h-full p-0 border-0 bg-transparent cursor-zoom-in","aria-label":`Open gallery for ${s}`,title:"Open gallery",children:[b.jsx("img",{src:pe[0]||"/placeholder.svg",alt:s,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-navy/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),b.jsx(Us,{className:`absolute top-4 left-4 ${ct==="For Sale"?"bg-primary text-primary-foreground":ct==="Sold"?"bg-destructive text-destructive-foreground":"bg-muted text-muted-foreground"}`,"aria-hidden":!0,children:ct}),b.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[b.jsxs("span",{className:"flex items-center gap-1 bg-navy/80 text-primary-foreground text-xs px-2 py-1 rounded",children:[b.jsx(bL,{className:"h-3 w-3"}),pe.length]}),I&&b.jsxs("span",{className:"flex items-center gap-1 bg-accent/90 text-accent-foreground text-xs px-2 py-1 rounded",children:[b.jsx(uY,{className:"h-3 w-3"}),"Video"]})]})]}),b.jsxs("div",{className:"p-6",children:[b.jsx("h3",{className:"font-display text-xl font-semibold text-foreground mb-2 line-clamp-1",children:s}),b.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-4",children:[b.jsx(qc,{className:"h-4 w-4 text-primary"}),b.jsx("span",{className:"text-sm",children:h})]}),b.jsx("div",{className:"flex items-center gap-4 mb-4",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(oY,{className:"h-4 w-4 text-primary"}),b.jsx("span",{className:"text-sm text-muted-foreground",children:_})]})}),b.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:i}),b.jsx("div",{className:"border-t border-border pt-4",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),b.jsx("p",{className:"font-display text-2xl font-bold text-primary",children:`KES ${Number(m).toLocaleString()}`})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Cr,{variant:"ghost",size:"sm",asChild:!0,children:b.jsxs("a",{href:`tel:${S}`,className:"flex items-center gap-2",onClick:He=>He.stopPropagation(),"aria-label":`Call seller of ${s}`,children:[b.jsx(jf,{className:"h-4 w-4"}),"Call"]})}),b.jsxs(Vu,{open:z,onOpenChange:G,children:[b.jsx(YU,{asChild:!0,children:b.jsx(Cr,{size:"sm",onClick:He=>(He.stopPropagation(),G(!0)),children:"Inquire"})}),b.jsxs(Kc,{onClick:He=>He.stopPropagation(),children:[b.jsx(Qh,{children:b.jsx(qu,{children:"Contact Seller"})}),b.jsxs("div",{className:"grid gap-2",children:[b.jsx(Mn,{placeholder:"Your name",value:F,onChange:He=>U(He.target.value)}),b.jsx(Mn,{placeholder:"Your phone (e.g. 07xxxxxxxx)",value:K,onChange:He=>J(He.target.value)}),b.jsx(fl,{value:X,onChange:He=>ie(He.target.value)})]}),b.jsx(U0,{children:b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Cr,{variant:"outline",onClick:He=>{He.stopPropagation(),G(!1)},children:"Cancel"}),b.jsx(Cr,{onClick:ae,disabled:Q.isPending,children:Q.isPending?"Sending":"Send & WhatsApp"})]})})]})]})]})]})})]})]}),b.jsx(Vu,{open:Pe,onOpenChange:Fe,children:b.jsx(Kc,{onClick:He=>He.stopPropagation(),children:b.jsxs("div",{className:"flex flex-col items-center gap-4",children:[b.jsx("div",{className:"relative w-full max-w-3xl",children:pe.length>0?b.jsxs(b.Fragment,{children:[b.jsx("img",{src:pe[tt],alt:`${s} (${tt+1}/${pe.length})`,className:"w-full h-[480px] object-cover rounded"}),b.jsx("button",{"aria-label":"Previous image",className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded",onClick:Qe,children:b.jsx(XK,{className:"h-5 w-5 text-white"})}),b.jsx("button",{"aria-label":"Next image",className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded",onClick:Ke,children:b.jsx(BI,{className:"h-5 w-5 text-white"})})]}):b.jsx("div",{className:"w-full h-64 bg-muted rounded flex items-center justify-center",children:b.jsx(bL,{})})}),pe.length>1&&b.jsx("div",{className:"flex gap-2 overflow-x-auto mt-2",children:pe.map((He,qe)=>b.jsx("button",{onClick:ut=>{ut.stopPropagation(),Be(qe)},className:`w-20 h-12 rounded overflow-hidden border ${qe===tt?"ring-2 ring-primary":"border-border"}`,"aria-label":`Show image ${qe+1}`,children:b.jsx("img",{src:He,alt:`thumb-${qe}`,className:"w-full h-full object-cover"})},He+qe))})]})})})]})},hce=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(null),_=async()=>{s(!0),m(null);try{const{data:i,error:S}=await Er.from("properties").select("*").eq("status","available").order("created_at",{ascending:!1}).limit(6);if(S)throw S;const I=(i||[]).map(M=>{const z=(M.images||[])[0]||void 0;return{...M,_firstImage:z}});t(I)}catch(i){console.error(i);const S=i instanceof Error?i.message:String(i);m(S||"Failed to load properties")}finally{s(!1)}};return B.useEffect(()=>{_();const i=Er.channel("properties-realtime").on("postgres_changes",{event:"*",schema:"public",table:"properties"},S=>{console.log("Real-time update:",S),_()}).subscribe();return()=>{Er.removeChannel(i)}},[]),b.jsx("section",{id:"properties",className:"py-20 bg-secondary",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs("div",{className:"text-center mb-12",children:[b.jsx("span",{className:"inline-block text-primary font-semibold text-sm uppercase tracking-widest mb-4",children:"Featured Listings"}),b.jsx("h2",{className:"font-display text-3xl md:text-4xl font-bold text-foreground mb-4",children:"Discover Our Properties"}),b.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Explore verified properties. Click on a property to view details or contact the seller directly."})]}),n?b.jsx("div",{className:"flex justify-center py-12",children:b.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-primary border-t-transparent rounded-full"})}):h?b.jsx("p",{className:"text-center text-red-500",children:h}):e.length===0?b.jsx("p",{className:"text-center text-muted-foreground",children:"No properties available right now."}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((i,S)=>b.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${S*.05}s`},children:b.jsx(QU,{property:i})},i.id))}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(Cr,{asChild:!0,size:"lg",children:b.jsxs(us,{to:"/properties",className:"inline-flex items-center gap-2",children:["View All Properties",b.jsx(q1,{size:18})]})})})]})]})})},Pf=()=>{const e=new Date().getFullYear();return b.jsx("footer",{className:"bg-slate-50 text-slate-700 mt-20 border-t",children:b.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-20 py-12",children:[b.jsxs("div",{className:"grid grid-cols-1 gap-10 md:grid-cols-3",children:[b.jsxs("div",{className:"text-center md:text-left",children:[b.jsx("div",{className:"flex justify-center md:justify-start items-center gap-3 mb-4",children:b.jsx("img",{src:"/julin/logo.png",alt:"Julin Real Estate logo",className:"h-16 md:h-20 lg:h-24 w-auto object-contain"})}),b.jsx("p",{className:"text-sm leading-relaxed text-slate-600 max-w-sm mx-auto md:mx-0",children:"Premium real estate services. Connecting buyers and sellers across Kenya with trust, transparency, and excellence."}),b.jsxs("div",{className:"flex justify-center md:justify-start gap-4 mt-5",children:[b.jsx("a",{href:"#","aria-label":"Facebook",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:b.jsx(JK,{className:"h-4 w-4"})}),b.jsx("a",{href:"#","aria-label":"Instagram",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:b.jsx(tY,{className:"h-4 w-4"})}),b.jsx("a",{href:"#","aria-label":"LinkedIn",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:b.jsx(nY,{className:"h-4 w-4"})})]})]}),b.jsxs("div",{className:"text-center md:text-left",children:[b.jsx("h4",{className:"font-semibold text-base mb-4",children:"Quick Links"}),b.jsx("ul",{className:"space-y-2 text-sm",children:[{name:"Home",href:"/"},{name:"Properties",href:"/properties"},{name:"About Us",href:"/about"},{name:"Contact",href:"/contact"}].map(t=>b.jsx("li",{children:b.jsx(us,{to:t.href,className:"hover:text-accent transition-colors",children:t.name})},t.name))})]}),b.jsxs("div",{className:"text-center md:text-left",children:[b.jsx("h4",{className:"font-semibold text-base mb-4",children:"Contact"}),b.jsxs("ul",{className:"space-y-3 text-sm",children:[b.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[b.jsx(jf,{className:"h-4 w-4 text-accent"}),b.jsx("a",{href:"tel:+254725671504",className:"hover:text-accent",children:"+254 725 671 504"})]}),b.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[b.jsx(Nm,{className:"h-4 w-4 text-accent"}),b.jsx("a",{href:"https://wa.me/254725671504",target:"_blank",rel:"noopener noreferrer",className:"hover:text-accent",children:"WhatsApp"})]}),b.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[b.jsx(ST,{className:"h-4 w-4 text-accent"}),b.jsx("a",{href:"mailto:juliusmurigi90@gmail.com",className:"hover:text-accent break-all",children:"juliusmurigi90@gmail.com"})]}),b.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[b.jsx(qc,{className:"h-4 w-4 text-accent"}),b.jsx("span",{children:"Nairobi, Kenya"})]})]})]})]}),b.jsxs("div",{className:"mt-10 pt-6 border-t text-center text-xs text-slate-500",children:[" ",e," Julin Real Estate. All rights reserved."]})]})})};function _l({children:e,className:t="",delay:n=0}){const s=B.useRef(null),h=Roe(s,{once:!0,margin:"-80px"});return b.jsx(_n.div,{ref:s,initial:{opacity:0,y:18},animate:h?{opacity:1,y:0}:{},transition:{duration:.6,delay:n},className:t,children:e})}const dce=()=>b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"Julin Real Estate | Buy & Sell Properties in Kenya"}),b.jsx("meta",{name:"description",content:"Julin Real Estate connects buyers and sellers of real estate properties in Kenya. Find your dream home or list your property today."})]}),b.jsxs("div",{className:"min-h-screen",children:[b.jsx(Ef,{}),b.jsxs("main",{className:"pt-28",children:[b.jsx(_l,{children:b.jsx(ole,{})}),b.jsx("section",{className:"container mx-auto px-4",children:b.jsx(_l,{children:b.jsx(hce,{})})})]}),b.jsx(Pf,{})]})]}),AA=8,fce={hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}},pce={initial:{y:-20},animate:{y:[-20,0,-20],transition:{duration:6,repeat:1/0}}},mce={initial:{opacity:.3},animate:{opacity:[.3,.7,.3],transition:{duration:4,repeat:1/0}}},gce=()=>{const e=hc(),t=qg(),[n,s]=B.useState(AA),h=B.useRef(null),m=B.useRef(null);B.useEffect(()=>(h.current=window.setInterval(()=>{s(i=>i<=1?(m.current&&(clearTimeout(m.current),m.current=null),t("/",{replace:!0}),0):i-1)},1e3),m.current=window.setTimeout(()=>{t("/",{replace:!0}),m.current=null},AA*1e3),()=>{h.current&&(clearInterval(h.current),h.current=null),m.current&&(clearTimeout(m.current),m.current=null)}),[e.pathname,e.search,t]);const _=n/AA*100;return b.jsxs(_n.main,{variants:fce,initial:"hidden",animate:"visible",exit:"exit",className:`relative flex min-h-screen items-center justify-center overflow-hidden\r
                 bg-gradient-to-b from-sky-300 via-sky-150 to-white px-4`,children:[b.jsxs(_n.div,{variants:mce,initial:"initial",animate:"animate",children:[b.jsx(yf,{className:"absolute top-16 left-10 text-sky-400",size:22}),b.jsx(yf,{className:"absolute top-44 right-20 text-sky-300",size:18}),b.jsx(yf,{className:"absolute bottom-36 left-28 text-sky-300",size:20})]}),b.jsxs("section",{className:"relative z-10 w-full max-w-xl text-center",children:[b.jsx(_n.div,{variants:pce,initial:"initial",animate:"animate",className:`mx-auto mb-8 flex h-24 w-24 items-center justify-center\r
                     rounded-full bg-sky-300/40 shadow-xl backdrop-blur`,children:b.jsx(lY,{size:42,className:"text-sky-800"})}),b.jsx("h1",{className:"text-8xl font-extrabold text-sky-500/30 mb-3",children:"404"}),b.jsx("h2",{className:"text-3xl font-bold text-sky-900 mb-4",children:"Lost in Space"}),b.jsxs("p",{className:"text-lg text-sky-700 mb-6 leading-relaxed",children:["The page youre looking for drifted beyond our radar.",b.jsx("br",{}),"Returning you safely home in"," ",b.jsx("span",{className:"font-semibold",children:n})," seconds."]}),b.jsx("div",{className:"mx-auto mb-8 h-2 w-64 overflow-hidden rounded-full bg-sky-200",children:b.jsx(_n.div,{className:"h-full bg-sky-500",initial:{width:"100%"},animate:{width:`${_}%`},transition:{ease:"linear"}})}),b.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[b.jsx(_n.div,{whileHover:{scale:1.06},whileTap:{scale:.96},children:b.jsxs(us,{to:"/",className:`inline-flex items-center gap-2 rounded-lg\r
                         bg-sky-600 px-6 py-3 font-medium text-white\r
                         shadow-md transition hover:bg-sky-700`,children:[b.jsx(Lc,{size:18}),"Home"]})}),b.jsx(_n.div,{whileHover:{scale:1.06},whileTap:{scale:.96},children:b.jsxs("button",{onClick:()=>t(-1),className:`inline-flex items-center gap-2 rounded-lg\r
                         border border-sky-300 px-6 py-3 font-medium\r
                         text-sky-700 transition hover:bg-sky-100`,children:[b.jsx(lP,{size:18}),"Back"]})})]})]})]})},yce=()=>{const{pathname:e}=hc();return B.useEffect(()=>{try{typeof window<"u"&&window.scrollTo&&window.scrollTo({top:0,left:0,behavior:"instant"})}catch{}},[e]),null};function _ce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"}))}const vce=B.forwardRef(_ce);function xce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"}))}const bce=B.forwardRef(xce);function wce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const Tce=B.forwardRef(wce);function Sce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const Ece=B.forwardRef(Sce);function Ace({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const Pce=B.forwardRef(Ace);function Cce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"}))}const e6=B.forwardRef(Cce);function Ice({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Mce=B.forwardRef(Ice);function Oce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const YP=B.forwardRef(Oce);function Rce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"}))}const Dce=B.forwardRef(Rce);function kce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}const t6=B.forwardRef(kce);function jce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))}const Lce=B.forwardRef(jce);function Nce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))}const zce=B.forwardRef(Nce);function Fce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const Bce=B.forwardRef(Fce);function Vce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const $ce=B.forwardRef(Vce);function Uce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"}))}const Gce=B.forwardRef(Uce);function Hce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const Wce=B.forwardRef(Hce);function qce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const Zce=B.forwardRef(qce);function Xce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}const Kce=B.forwardRef(Xce);function Yce({title:e,titleId:t,...n},s){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const Jce=B.forwardRef(Yce);function Qce(){const[e,t]=B.useState(0);return B.useEffect(()=>{const n=()=>{const s=window.scrollY||document.documentElement.scrollTop,h=document.documentElement.scrollHeight-document.documentElement.clientHeight,m=h>0?Math.min(100,s/h*100):0;t(m)};return window.addEventListener("scroll",n,{passive:!0}),n(),()=>window.removeEventListener("scroll",n)},[]),b.jsx("div",{className:"absolute left-0 top-0 right-0 h-0 pointer-events-none",children:b.jsx("div",{className:"h-0.5 bg-gradient-to-r from-blue-500 to-cyan-400 transition-width duration-150",style:{width:`${e}%`}})})}const r6=B.createContext({user:null,isAdmin:!1,loading:!0,signInWithEmail:async()=>{},signOut:async()=>{}}),G0=()=>B.useContext(r6),eue=()=>{const[e,t]=B.useState(!0),{user:n,isAdmin:s,loading:h}=G0(),m=hc(),_=qg(),i=[{href:"/admin",label:"Dashboard",icon:Wce},{href:"/admin/properties",label:"Properties",icon:t6},{href:"/admin/chats",label:"Chat Analytics",icon:Pce},{href:"/admin/blogs",label:"Blog Posts",icon:YP},{href:"/admin/submissions",label:"Submissions",icon:YP},{href:"/admin/inquiries",label:"Buyer Inquiries",icon:e6},{href:"/admin/profile",label:"Profile",icon:Mce}],S=I=>m.pathname===I;B.useEffect(()=>{!h&&!n&&_("/admin/login")},[n,h,_]),B.useEffect(()=>{const I=M=>{(M.ctrlKey||M.metaKey)&&M.key.toLowerCase()==="b"&&(M.preventDefault(),t(L=>!L))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[]);const A=async()=>{await Er.auth.signOut(),rn({title:"Logged out",description:"See you next time!"}),_("/admin/login")};return h?b.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin inline-block w-10 h-10 border-4 border-slate-300 border-t-blue-600 rounded-full mb-4"}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading..."})]})}):n?b.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[b.jsxs(_n.aside,{className:"fixed left-0 top-0 h-screen bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-700 z-50",animate:{width:e?256:80},transition:{type:"spring",stiffness:260,damping:30},children:[b.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e&&b.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"JulinHub"}),b.jsx("button",{onClick:()=>t(!e),className:"ml-auto p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800","aria-label":"Toggle sidebar",children:e?b.jsx(Jce,{className:"h-5 w-5"}):b.jsx(Tce,{className:"h-5 w-5"})})]}),b.jsx("nav",{className:"flex-1 p-4 space-y-2",children:i.map(I=>{const M=I.icon;return b.jsxs(us,{to:I.href,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${S(I.href)?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 font-medium":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[b.jsx(_n.div,{whileHover:{x:-4},className:"flex-shrink-0",children:b.jsx(M,{className:"h-5 w-5"})}),e&&b.jsx("span",{children:I.label})]},I.href)})}),b.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:[e&&n&&b.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[b.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:b.jsx(Zce,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white truncate",children:n.email}),b.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Admin"})]})]}),b.jsx("button",{onClick:A,className:`w-full text-left p-2 rounded-md text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-950 ${e?"":"px-3"}`,children:b.jsxs("div",{className:"inline-flex items-center gap-3",children:[b.jsx(vce,{className:"h-5 w-5 flex-shrink-0 text-red-600 dark:text-red-400"}),e&&b.jsx("span",{className:"ml-1",children:"Logout"})]})})]})]}),b.jsxs(_n.main,{className:"transition-all duration-300 relative",animate:{marginLeft:e?256:80},transition:{type:"spring",stiffness:260,damping:30},children:[b.jsx(Qce,{}),b.jsx("div",{className:"p-6 md:p-8",children:b.jsx(Kse,{})})]})]}):null},tue=()=>{const[e,t]=B.useState(""),[n,s]=B.useState(""),[h,m]=B.useState(!1),[_,i]=B.useState(!1),S=qg(),A=async I=>{if(I.preventDefault(),console.log("[admin-login] handleAuth start",{email:!!e,passwordSet:!!n}),!e.trim()||!n.trim()){rn({title:"Missing fields",description:"Please enter email and password",variant:"destructive"});return}if(n.length<6){rn({title:"Password too short",description:"Password must be at least 6 characters",variant:"destructive"});return}i(!0);try{const{data:M,error:L}=await Er.auth.signInWithPassword({email:e.trim(),password:n.trim()});if(console.debug("[admin-login] signInWithPassword response:",{data:M,error:L}),L)throw console.error("[admin-login] sign in error",L),L;const z=`${window.location.origin}/julin/`.replace(/\/$/,""),G=()=>{try{window.location.href=`${z}#/admin`}catch{S("/admin")}};if(M?.session){rn({title:"Welcome back!",description:"Logged in successfully"}),G();return}const F=Date.now();let U=!1;for(;Date.now()-F<3e3;){try{if((await Er.auth.getSession())?.data?.session){U=!0;break}}catch{}await new Promise(K=>setTimeout(K,250))}if(U||M?.user){rn({title:"Welcome back!",description:"Logged in successfully"}),G();return}rn({title:"Check your email",description:"Sign-in did not create a session. Check your email for a confirmation link or complete any required steps.",variant:"destructive"})}catch(M){console.error("Auth error:",M);const L=M instanceof Error?M.message:String(M);rn({title:"Login failed",description:L||"An error occurred",variant:"destructive"})}finally{i(!1)}};return b.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:b.jsxs("div",{className:"w-full max-w-md",children:[b.jsxs("div",{className:"text-center mb-8",children:[b.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"JulinHub"}),b.jsx("p",{className:"text-slate-400",children:"Admin Portal"})]}),b.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-8",children:[b.jsxs("div",{className:"text-center mb-6",children:[b.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full mb-4",children:b.jsx(X1,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),b.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Admin Login"}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Sign in to manage properties"})]}),b.jsxs("form",{onSubmit:A,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Email"}),b.jsxs("div",{className:"relative",children:[b.jsx(ST,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),b.jsx(Mn,{type:"email",placeholder:"admin@example.com",value:e,onChange:I=>t(I.target.value),className:"pl-10",disabled:_,autoComplete:"username"})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Password"}),b.jsxs("div",{className:"relative",children:[b.jsx(X1,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),b.jsx(Mn,{type:h?"text":"password",placeholder:"",value:n,onChange:I=>s(I.target.value),className:"pl-10 pr-10",disabled:_,autoComplete:"current-password"}),b.jsx("button",{type:"button",onClick:()=>m(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:h?b.jsx(w4,{className:"w-5 h-5"}):b.jsx(Nc,{className:"w-5 h-5"})})]})]}),b.jsx(Cr,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:_,children:_?"Signing in...":"Sign In"})]}),b.jsx("div",{className:"mt-6 text-center",children:b.jsx("a",{href:"/",className:"text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400",children:" Back to Website"})})]}),b.jsx("p",{className:"text-center text-slate-500 text-sm mt-6",children:"Julin Real Estate Admin Portal"})]})})};function rue(){return b.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Dashboard"}),b.jsx("p",{className:"text-muted-foreground mt-1",children:"Quick overview  manage properties, submissions and leads"})]}),b.jsxs("div",{className:"flex gap-3 flex-wrap",children:[b.jsx(Cr,{asChild:!0,className:"bg-primary hover:bg-primary/90",children:b.jsxs(us,{to:"/admin/properties",className:"inline-flex items-center gap-2",children:[b.jsx(t6,{className:"h-5 w-5"}),b.jsx("span",{children:"Properties"})]})}),b.jsx(Cr,{variant:"outline",asChild:!0,children:b.jsxs(us,{to:"/admin/submissions",className:"inline-flex items-center gap-2",children:[b.jsx(YP,{className:"h-5 w-5"}),b.jsx("span",{children:"Submissions"})]})})]})]})}function nue({counts:e}){return b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Properties"}),b.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white mt-2",children:e.properties}),b.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-3",children:b.jsxs("span",{className:"inline-block bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-400 px-2 py-1 rounded",children:[e.verified," verified"]})})]}),b.jsx("div",{className:"bg-primary/5 p-3 rounded-lg",children:b.jsx(Lc,{size:24,className:"text-primary"})})]})}),b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Submissions"}),b.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:e.submissions}),b.jsx(Cr,{asChild:!0,size:"sm",variant:"ghost",className:"mt-3 h-auto p-0 text-xs text-primary",children:b.jsxs(us,{to:"/admin/submissions",className:"inline-flex items-center gap-1",children:["Review submissions ",b.jsx(q1,{size:14})]})})]}),b.jsx("div",{className:"bg-orange-50 dark:bg-orange-950 p-3 rounded-lg",children:b.jsx(b4,{size:24,className:"text-orange-600 dark:text-orange-400"})})]})}),b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Buyer Inquiries"}),b.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:e.inquiries}),b.jsx(Cr,{asChild:!0,size:"sm",variant:"ghost",className:"mt-3 h-auto p-0 text-xs text-primary",children:b.jsxs(us,{to:"/admin/inquiries",className:"inline-flex items-center gap-1",children:["View leads ",b.jsx(q1,{size:14})]})})]}),b.jsx("div",{className:"bg-purple-50 dark:bg-purple-950 p-3 rounded-lg",children:b.jsx(aY,{size:24,className:"text-purple-600 dark:text-purple-400"})})]})}),b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),b.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:"Active"}),b.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"All systems operational"})]}),b.jsx("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-lg",children:b.jsx(TT,{size:24,className:"text-green-600 dark:text-green-400"})})]})})]})}function Wv({children:e,stagger:t=.06}){const n=B.Children.toArray(e);return b.jsx(b.Fragment,{children:n.map((s,h)=>b.jsx(_l,{delay:h*t,children:s},h))})}function iue({submissions:e,loading:t,onApprove:n,onReject:s}){return b.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[b.jsx("div",{className:"flex items-center justify-between mb-4",children:b.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Submissions"})}),t?b.jsx("div",{className:"space-y-3",children:[1,2,3].map(h=>b.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},h))}):e.length===0?b.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent submissions"}):b.jsx("div",{className:"space-y-3",children:b.jsx(Wv,{children:e.map(h=>b.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:[b.jsxs("div",{className:"flex gap-3",children:[h._firstImage?b.jsx("img",{src:h._firstImage,alt:h.title,className:"w-16 h-12 object-cover rounded flex-shrink-0"}):b.jsx("div",{className:"w-16 h-12 bg-slate-300 dark:bg-slate-600 rounded flex-shrink-0"}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:h.title}),b.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 truncate",children:h.seller_name}),b.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["KES ",Number(h.price||0).toLocaleString()]})]})]}),b.jsxs("div",{className:"flex gap-2 mt-2",children:[b.jsx(Cr,{size:"sm",variant:"destructive",className:"flex-1 h-7 text-xs",onClick:()=>s(h),children:"Reject"}),b.jsx(Cr,{size:"sm",className:"flex-1 h-7 text-xs bg-green-600 hover:bg-green-700",onClick:()=>n(h),children:"Approve"})]})]},h.id))})})]})}function oue({inquiries:e,loading:t}){return b.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[b.jsx("div",{className:"flex items-center justify-between mb-4",children:b.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Inquiries"})}),t?b.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>b.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},n))}):e.length===0?b.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent inquiries"}):b.jsx("div",{className:"space-y-3",children:b.jsx(Wv,{children:e.map(n=>b.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:b.jsxs("div",{className:"flex items-start justify-between gap-2",children:[b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm",children:n.buyer_name}),b.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:[" ",n.buyer_phone]}),b.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2 line-clamp-2",children:[(n.message||"").slice(0,60),(n.message||"").length>60?"...":""]})]}),b.jsx(Us,{variant:"outline",className:`flex-shrink-0 text-xs ${n.lead_status==="hot"?"bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-400 border-red-200 dark:border-red-700":n.lead_status==="warm"?"bg-orange-50 dark:bg-orange-950 text-orange-700 dark:text-orange-400 border-orange-200 dark:border-orange-700":"bg-primary/5 text-primary border-primary/20"}`,children:n.lead_status||"Warm"})]})},n.id))})})]})}function sue({properties:e,loading:t}){return b.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[b.jsx("div",{className:"flex items-center justify-between mb-4",children:b.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Properties"})}),t?b.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>b.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},n))}):e.length===0?b.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent properties"}):b.jsx("div",{className:"space-y-3",children:b.jsx(Wv,{children:e.map(n=>b.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:b.jsxs("div",{className:"flex gap-3",children:[n._firstImage?b.jsx("img",{src:n._firstImage,alt:n.title,className:"w-16 h-12 object-cover rounded flex-shrink-0"}):b.jsx("div",{className:"w-16 h-12 bg-slate-300 dark:bg-slate-600 rounded flex-shrink-0"}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:n.title}),b.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 truncate",children:n.location}),b.jsxs("div",{className:"flex items-center justify-between mt-1",children:[b.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["KES ",Number(n.price||0).toLocaleString()]}),n.is_verified&&b.jsx(Us,{variant:"secondary",className:"text-xs h-5",children:" Verified"})]})]})]})},n.id))})})]})}function aue({open:e,action:t,item:n,onClose:s,onConfirm:h}){return b.jsx(Vu,{open:e,onOpenChange:s,children:b.jsxs(Kc,{children:[b.jsx(Qh,{children:b.jsx(qu,{className:"text-lg",children:t==="approve"?" Approve Submission":" Reject Submission"})}),b.jsx("div",{className:"py-4",children:t==="approve"?b.jsxs("p",{className:"text-slate-700 dark:text-slate-300",children:["Are you sure you want to approve and publish ",b.jsx("strong",{children:n?.title}),"? It will be visible to buyers immediately."]}):b.jsxs("p",{className:"text-slate-700 dark:text-slate-300",children:["Are you sure you want to reject ",b.jsx("strong",{children:n?.title}),"? The seller will be notified."]})}),b.jsx(U0,{children:b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Cr,{variant:"outline",onClick:s,children:"Cancel"}),b.jsx(Cr,{className:t==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",onClick:h,children:t==="approve"?"Approve":"Reject"})]})})]})})}const os=B.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Wr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));os.displayName="Card";const ss=B.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Wr("flex flex-col space-y-1.5 p-6",e),...t}));ss.displayName="CardHeader";const as=B.forwardRef(({className:e,...t},n)=>b.jsx("h3",{ref:n,className:Wr("text-2xl font-semibold leading-none tracking-tight",e),...t}));as.displayName="CardTitle";const JP=B.forwardRef(({className:e,...t},n)=>b.jsx("p",{ref:n,className:Wr("text-sm text-muted-foreground",e),...t}));JP.displayName="CardDescription";const ls=B.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Wr("p-6 pt-0",e),...t}));ls.displayName="CardContent";const lue=B.forwardRef(({className:e,...t},n)=>b.jsx("div",{ref:n,className:Wr("flex items-center p-6 pt-0",e),...t}));lue.displayName="CardFooter";var cue=Array.isArray,xa=cue,uue=typeof vv=="object"&&vv&&vv.Object===Object&&vv,n6=uue,hue=n6,due=typeof self=="object"&&self&&self.Object===Object&&self,fue=hue||due||Function("return this")(),Qc=fue,pue=Qc,mue=pue.Symbol,H0=mue,Lz=H0,i6=Object.prototype,gue=i6.hasOwnProperty,yue=i6.toString,cv=Lz?Lz.toStringTag:void 0;function _ue(e){var t=gue.call(e,cv),n=e[cv];try{e[cv]=void 0;var s=!0}catch{}var h=yue.call(e);return s&&(t?e[cv]=n:delete e[cv]),h}var vue=_ue,xue=Object.prototype,bue=xue.toString;function wue(e){return bue.call(e)}var Tue=wue,Nz=H0,Sue=vue,Eue=Tue,Aue="[object Null]",Pue="[object Undefined]",zz=Nz?Nz.toStringTag:void 0;function Cue(e){return e==null?e===void 0?Pue:Aue:zz&&zz in Object(e)?Sue(e):Eue(e)}var Zu=Cue;function Iue(e){return e!=null&&typeof e=="object"}var Xu=Iue,Mue=Zu,Oue=Xu,Rue="[object Symbol]";function Due(e){return typeof e=="symbol"||Oue(e)&&Mue(e)==Rue}var Zg=Due,kue=xa,jue=Zg,Lue=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Nue=/^\w*$/;function zue(e,t){if(kue(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||jue(e)?!0:Nue.test(e)||!Lue.test(e)||t!=null&&e in Object(t)}var ZM=zue;function Fue(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ed=Fue;const Xg=Bi(ed);var Bue=Zu,Vue=ed,$ue="[object AsyncFunction]",Uue="[object Function]",Gue="[object GeneratorFunction]",Hue="[object Proxy]";function Wue(e){if(!Vue(e))return!1;var t=Bue(e);return t==Uue||t==Gue||t==$ue||t==Hue}var XM=Wue;const ai=Bi(XM);var que=Qc,Zue=que["__core-js_shared__"],Xue=Zue,PA=Xue,Fz=function(){var e=/[^.]+$/.exec(PA&&PA.keys&&PA.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Kue(e){return!!Fz&&Fz in e}var Yue=Kue,Jue=Function.prototype,Que=Jue.toString;function ehe(e){if(e!=null){try{return Que.call(e)}catch{}try{return e+""}catch{}}return""}var o6=ehe,the=XM,rhe=Yue,nhe=ed,ihe=o6,ohe=/[\\^$.*+?()[\]{}|]/g,she=/^\[object .+?Constructor\]$/,ahe=Function.prototype,lhe=Object.prototype,che=ahe.toString,uhe=lhe.hasOwnProperty,hhe=RegExp("^"+che.call(uhe).replace(ohe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function dhe(e){if(!nhe(e)||rhe(e))return!1;var t=the(e)?hhe:she;return t.test(ihe(e))}var fhe=dhe;function phe(e,t){return e?.[t]}var mhe=phe,ghe=fhe,yhe=mhe;function _he(e,t){var n=yhe(e,t);return ghe(n)?n:void 0}var Nf=_he,vhe=Nf,xhe=vhe(Object,"create"),XT=xhe,Bz=XT;function bhe(){this.__data__=Bz?Bz(null):{},this.size=0}var whe=bhe;function The(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var She=The,Ehe=XT,Ahe="__lodash_hash_undefined__",Phe=Object.prototype,Che=Phe.hasOwnProperty;function Ihe(e){var t=this.__data__;if(Ehe){var n=t[e];return n===Ahe?void 0:n}return Che.call(t,e)?t[e]:void 0}var Mhe=Ihe,Ohe=XT,Rhe=Object.prototype,Dhe=Rhe.hasOwnProperty;function khe(e){var t=this.__data__;return Ohe?t[e]!==void 0:Dhe.call(t,e)}var jhe=khe,Lhe=XT,Nhe="__lodash_hash_undefined__";function zhe(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Lhe&&t===void 0?Nhe:t,this}var Fhe=zhe,Bhe=whe,Vhe=She,$he=Mhe,Uhe=jhe,Ghe=Fhe;function Kg(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Kg.prototype.clear=Bhe;Kg.prototype.delete=Vhe;Kg.prototype.get=$he;Kg.prototype.has=Uhe;Kg.prototype.set=Ghe;var Hhe=Kg;function Whe(){this.__data__=[],this.size=0}var qhe=Whe;function Zhe(e,t){return e===t||e!==e&&t!==t}var KM=Zhe,Xhe=KM;function Khe(e,t){for(var n=e.length;n--;)if(Xhe(e[n][0],t))return n;return-1}var KT=Khe,Yhe=KT,Jhe=Array.prototype,Qhe=Jhe.splice;function ede(e){var t=this.__data__,n=Yhe(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Qhe.call(t,n,1),--this.size,!0}var tde=ede,rde=KT;function nde(e){var t=this.__data__,n=rde(t,e);return n<0?void 0:t[n][1]}var ide=nde,ode=KT;function sde(e){return ode(this.__data__,e)>-1}var ade=sde,lde=KT;function cde(e,t){var n=this.__data__,s=lde(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}var ude=cde,hde=qhe,dde=tde,fde=ide,pde=ade,mde=ude;function Yg(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Yg.prototype.clear=hde;Yg.prototype.delete=dde;Yg.prototype.get=fde;Yg.prototype.has=pde;Yg.prototype.set=mde;var YT=Yg,gde=Nf,yde=Qc,_de=gde(yde,"Map"),YM=_de,Vz=Hhe,vde=YT,xde=YM;function bde(){this.size=0,this.__data__={hash:new Vz,map:new(xde||vde),string:new Vz}}var wde=bde;function Tde(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Sde=Tde,Ede=Sde;function Ade(e,t){var n=e.__data__;return Ede(t)?n[typeof t=="string"?"string":"hash"]:n.map}var JT=Ade,Pde=JT;function Cde(e){var t=Pde(this,e).delete(e);return this.size-=t?1:0,t}var Ide=Cde,Mde=JT;function Ode(e){return Mde(this,e).get(e)}var Rde=Ode,Dde=JT;function kde(e){return Dde(this,e).has(e)}var jde=kde,Lde=JT;function Nde(e,t){var n=Lde(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}var zde=Nde,Fde=wde,Bde=Ide,Vde=Rde,$de=jde,Ude=zde;function Jg(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Jg.prototype.clear=Fde;Jg.prototype.delete=Bde;Jg.prototype.get=Vde;Jg.prototype.has=$de;Jg.prototype.set=Ude;var JM=Jg,s6=JM,Gde="Expected a function";function QM(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Gde);var n=function(){var s=arguments,h=t?t.apply(this,s):s[0],m=n.cache;if(m.has(h))return m.get(h);var _=e.apply(this,s);return n.cache=m.set(h,_)||m,_};return n.cache=new(QM.Cache||s6),n}QM.Cache=s6;var a6=QM;const Hde=Bi(a6);var Wde=a6,qde=500;function Zde(e){var t=Wde(e,function(s){return n.size===qde&&n.clear(),s}),n=t.cache;return t}var Xde=Zde,Kde=Xde,Yde=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jde=/\\(\\)?/g,Qde=Kde(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Yde,function(n,s,h,m){t.push(h?m.replace(Jde,"$1"):s||n)}),t}),efe=Qde;function tfe(e,t){for(var n=-1,s=e==null?0:e.length,h=Array(s);++n<s;)h[n]=t(e[n],n,e);return h}var eO=tfe,$z=H0,rfe=eO,nfe=xa,ife=Zg,ofe=1/0,Uz=$z?$z.prototype:void 0,Gz=Uz?Uz.toString:void 0;function l6(e){if(typeof e=="string")return e;if(nfe(e))return rfe(e,l6)+"";if(ife(e))return Gz?Gz.call(e):"";var t=e+"";return t=="0"&&1/e==-ofe?"-0":t}var sfe=l6,afe=sfe;function lfe(e){return e==null?"":afe(e)}var c6=lfe,cfe=xa,ufe=ZM,hfe=efe,dfe=c6;function ffe(e,t){return cfe(e)?e:ufe(e,t)?[e]:hfe(dfe(e))}var u6=ffe,pfe=Zg,mfe=1/0;function gfe(e){if(typeof e=="string"||pfe(e))return e;var t=e+"";return t=="0"&&1/e==-mfe?"-0":t}var QT=gfe,yfe=u6,_fe=QT;function vfe(e,t){t=yfe(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[_fe(t[n++])];return n&&n==s?e:void 0}var tO=vfe,xfe=tO;function bfe(e,t,n){var s=e==null?void 0:xfe(e,t);return s===void 0?n:s}var h6=bfe;const ml=Bi(h6);function wfe(e){return e==null}var Tfe=wfe;const mi=Bi(Tfe);var Sfe=Zu,Efe=xa,Afe=Xu,Pfe="[object String]";function Cfe(e){return typeof e=="string"||!Efe(e)&&Afe(e)&&Sfe(e)==Pfe}var Ife=Cfe;const Cf=Bi(Ife);var d6={exports:{}},Gi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rO=Symbol.for("react.element"),nO=Symbol.for("react.portal"),eS=Symbol.for("react.fragment"),tS=Symbol.for("react.strict_mode"),rS=Symbol.for("react.profiler"),nS=Symbol.for("react.provider"),iS=Symbol.for("react.context"),Mfe=Symbol.for("react.server_context"),oS=Symbol.for("react.forward_ref"),sS=Symbol.for("react.suspense"),aS=Symbol.for("react.suspense_list"),lS=Symbol.for("react.memo"),cS=Symbol.for("react.lazy"),Ofe=Symbol.for("react.offscreen"),f6;f6=Symbol.for("react.module.reference");function xl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case rO:switch(e=e.type,e){case eS:case rS:case tS:case sS:case aS:return e;default:switch(e=e&&e.$$typeof,e){case Mfe:case iS:case oS:case cS:case lS:case nS:return e;default:return t}}case nO:return t}}}Gi.ContextConsumer=iS;Gi.ContextProvider=nS;Gi.Element=rO;Gi.ForwardRef=oS;Gi.Fragment=eS;Gi.Lazy=cS;Gi.Memo=lS;Gi.Portal=nO;Gi.Profiler=rS;Gi.StrictMode=tS;Gi.Suspense=sS;Gi.SuspenseList=aS;Gi.isAsyncMode=function(){return!1};Gi.isConcurrentMode=function(){return!1};Gi.isContextConsumer=function(e){return xl(e)===iS};Gi.isContextProvider=function(e){return xl(e)===nS};Gi.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===rO};Gi.isForwardRef=function(e){return xl(e)===oS};Gi.isFragment=function(e){return xl(e)===eS};Gi.isLazy=function(e){return xl(e)===cS};Gi.isMemo=function(e){return xl(e)===lS};Gi.isPortal=function(e){return xl(e)===nO};Gi.isProfiler=function(e){return xl(e)===rS};Gi.isStrictMode=function(e){return xl(e)===tS};Gi.isSuspense=function(e){return xl(e)===sS};Gi.isSuspenseList=function(e){return xl(e)===aS};Gi.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===eS||e===rS||e===tS||e===sS||e===aS||e===Ofe||typeof e=="object"&&e!==null&&(e.$$typeof===cS||e.$$typeof===lS||e.$$typeof===nS||e.$$typeof===iS||e.$$typeof===oS||e.$$typeof===f6||e.getModuleId!==void 0)};Gi.typeOf=xl;d6.exports=Gi;var Rfe=d6.exports,Dfe=Zu,kfe=Xu,jfe="[object Number]";function Lfe(e){return typeof e=="number"||kfe(e)&&Dfe(e)==jfe}var p6=Lfe;const Nfe=Bi(p6);var zfe=p6;function Ffe(e){return zfe(e)&&e!=+e}var Bfe=Ffe;const W0=Bi(Bfe);var ic=function(t){return t===0?0:t>0?1:-1},ff=function(t){return Cf(t)&&t.indexOf("%")===t.length-1},wr=function(t){return Nfe(t)&&!W0(t)},Vfe=function(t){return mi(t)},cs=function(t){return wr(t)||Cf(t)},$fe=0,q0=function(t){var n=++$fe;return"".concat(t||"").concat(n)},If=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!wr(t)&&!Cf(t))return s;var m;if(ff(t)){var _=t.indexOf("%");m=n*parseFloat(t.slice(0,_))/100}else m=+t;return W0(m)&&(m=s),h&&m>n&&(m=n),m},zh=function(t){if(!t)return null;var n=Object.keys(t);return n&&n.length?t[n[0]]:null},Ufe=function(t){if(!Array.isArray(t))return!1;for(var n=t.length,s={},h=0;h<n;h++)if(!s[t[h]])s[t[h]]=!0;else return!0;return!1},ec=function(t,n){return wr(t)&&wr(n)?function(s){return t+s*(n-t)}:function(){return n}};function mw(e,t,n){return!e||!e.length?null:e.find(function(s){return s&&(typeof t=="function"?t(s):ml(s,t))===n})}var Gfe=function(t,n){return wr(t)&&wr(n)?t-n:Cf(t)&&Cf(n)?t.localeCompare(n):t instanceof Date&&n instanceof Date?t.getTime()-n.getTime():String(t).localeCompare(String(n))};function Qm(e,t){for(var n in e)if({}.hasOwnProperty.call(e,n)&&(!{}.hasOwnProperty.call(t,n)||e[n]!==t[n]))return!1;for(var s in t)if({}.hasOwnProperty.call(t,s)&&!{}.hasOwnProperty.call(e,s))return!1;return!0}function QP(e){"@babel/helpers - typeof";return QP=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},QP(e)}var Hfe=["viewBox","children"],Wfe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Hz=["points","pathLength"],CA={svg:Hfe,polygon:Hz,polyline:Hz},iO=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],gw=function(t,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var s=t;if(B.isValidElement(t)&&(s=t.props),!Xg(s))return null;var h={};return Object.keys(s).forEach(function(m){iO.includes(m)&&(h[m]=n||function(_){return s[m](s,_)})}),h},qfe=function(t,n,s){return function(h){return t(n,s,h),null}},yw=function(t,n,s){if(!Xg(t)||QP(t)!=="object")return null;var h=null;return Object.keys(t).forEach(function(m){var _=t[m];iO.includes(m)&&typeof _=="function"&&(h||(h={}),h[m]=qfe(_,n,s))}),h},Zfe=["children"],Xfe=["children"];function Wz(e,t){if(e==null)return{};var n=Kfe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Kfe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function eC(e){"@babel/helpers - typeof";return eC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eC(e)}var qz={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},ku=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},Zz=null,IA=null,oO=function e(t){if(t===Zz&&Array.isArray(IA))return IA;var n=[];return B.Children.forEach(t,function(s){mi(s)||(Rfe.isFragment(s)?n=n.concat(e(s.props.children)):n.push(s))}),IA=n,Zz=t,n};function gl(e,t){var n=[],s=[];return Array.isArray(t)?s=t.map(function(h){return ku(h)}):s=[ku(t)],oO(e).forEach(function(h){var m=ml(h,"type.displayName")||ml(h,"type.name");s.indexOf(m)!==-1&&n.push(h)}),n}function Na(e,t){var n=gl(e,t);return n&&n[0]}var Xz=function(t){if(!t||!t.props)return!1;var n=t.props,s=n.width,h=n.height;return!(!wr(s)||s<=0||!wr(h)||h<=0)},Yfe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],Jfe=function(t){return t&&t.type&&Cf(t.type)&&Yfe.indexOf(t.type)>=0},Qfe=function(t){return t&&eC(t)==="object"&&"clipDot"in t},epe=function(t,n,s,h){var m,_=(m=CA?.[h])!==null&&m!==void 0?m:[];return n.startsWith("data-")||!ai(t)&&(h&&_.includes(n)||Wfe.includes(n))||s&&iO.includes(n)},Si=function(t,n,s){if(!t||typeof t=="function"||typeof t=="boolean")return null;var h=t;if(B.isValidElement(t)&&(h=t.props),!Xg(h))return null;var m={};return Object.keys(h).forEach(function(_){var i;epe((i=h)===null||i===void 0?void 0:i[_],_,n,s)&&(m[_]=h[_])}),m},tC=function e(t,n){if(t===n)return!0;var s=B.Children.count(t);if(s!==B.Children.count(n))return!1;if(s===0)return!0;if(s===1)return Kz(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n);for(var h=0;h<s;h++){var m=t[h],_=n[h];if(Array.isArray(m)||Array.isArray(_)){if(!e(m,_))return!1}else if(!Kz(m,_))return!1}return!0},Kz=function(t,n){if(mi(t)&&mi(n))return!0;if(!mi(t)&&!mi(n)){var s=t.props||{},h=s.children,m=Wz(s,Zfe),_=n.props||{},i=_.children,S=Wz(_,Xfe);return h&&i?Qm(m,S)&&tC(h,i):!h&&!i?Qm(m,S):!1}return!1},Yz=function(t,n){var s=[],h={};return oO(t).forEach(function(m,_){if(Jfe(m))s.push(m);else if(m){var i=ku(m.type),S=n[i]||{},A=S.handler,I=S.once;if(A&&(!I||!h[i])){var M=A(m,i,_);s.push(M),h[i]=!0}}}),s},tpe=function(t){var n=t&&t.type;return n&&qz[n]?qz[n]:null},rpe=function(t,n){return oO(n).indexOf(t)},npe=["children","width","height","viewBox","className","style","title","desc"];function rC(){return rC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},rC.apply(this,arguments)}function ipe(e,t){if(e==null)return{};var n=ope(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function ope(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function nC(e){var t=e.children,n=e.width,s=e.height,h=e.viewBox,m=e.className,_=e.style,i=e.title,S=e.desc,A=ipe(e,npe),I=h||{width:n,height:s,x:0,y:0},M=Ei("recharts-surface",m);return $e.createElement("svg",rC({},Si(A,!0,"svg"),{className:M,width:n,height:s,style:_,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height)}),$e.createElement("title",null,i),$e.createElement("desc",null,S),t)}var spe=["children","className"];function iC(){return iC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},iC.apply(this,arguments)}function ape(e,t){if(e==null)return{};var n=lpe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function lpe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}var Bo=$e.forwardRef(function(e,t){var n=e.children,s=e.className,h=ape(e,spe),m=Ei("recharts-layer",s);return $e.createElement("g",iC({className:m},Si(h,!0),{ref:t}),n)}),ju=function(t,n){for(var s=arguments.length,h=new Array(s>2?s-2:0),m=2;m<s;m++)h[m-2]=arguments[m]};function cpe(e,t,n){var s=-1,h=e.length;t<0&&(t=-t>h?0:h+t),n=n>h?h:n,n<0&&(n+=h),h=t>n?0:n-t>>>0,t>>>=0;for(var m=Array(h);++s<h;)m[s]=e[s+t];return m}var upe=cpe,hpe=upe;function dpe(e,t,n){var s=e.length;return n=n===void 0?s:n,!t&&n>=s?e:hpe(e,t,n)}var fpe=dpe,ppe="\\ud800-\\udfff",mpe="\\u0300-\\u036f",gpe="\\ufe20-\\ufe2f",ype="\\u20d0-\\u20ff",_pe=mpe+gpe+ype,vpe="\\ufe0e\\ufe0f",xpe="\\u200d",bpe=RegExp("["+xpe+ppe+_pe+vpe+"]");function wpe(e){return bpe.test(e)}var m6=wpe;function Tpe(e){return e.split("")}var Spe=Tpe,g6="\\ud800-\\udfff",Epe="\\u0300-\\u036f",Ape="\\ufe20-\\ufe2f",Ppe="\\u20d0-\\u20ff",Cpe=Epe+Ape+Ppe,Ipe="\\ufe0e\\ufe0f",Mpe="["+g6+"]",oC="["+Cpe+"]",sC="\\ud83c[\\udffb-\\udfff]",Ope="(?:"+oC+"|"+sC+")",y6="[^"+g6+"]",_6="(?:\\ud83c[\\udde6-\\uddff]){2}",v6="[\\ud800-\\udbff][\\udc00-\\udfff]",Rpe="\\u200d",x6=Ope+"?",b6="["+Ipe+"]?",Dpe="(?:"+Rpe+"(?:"+[y6,_6,v6].join("|")+")"+b6+x6+")*",kpe=b6+x6+Dpe,jpe="(?:"+[y6+oC+"?",oC,_6,v6,Mpe].join("|")+")",Lpe=RegExp(sC+"(?="+sC+")|"+jpe+kpe,"g");function Npe(e){return e.match(Lpe)||[]}var zpe=Npe,Fpe=Spe,Bpe=m6,Vpe=zpe;function $pe(e){return Bpe(e)?Vpe(e):Fpe(e)}var Upe=$pe,Gpe=fpe,Hpe=m6,Wpe=Upe,qpe=c6;function Zpe(e){return function(t){t=qpe(t);var n=Hpe(t)?Wpe(t):void 0,s=n?n[0]:t.charAt(0),h=n?Gpe(n,1).join(""):t.slice(1);return s[e]()+h}}var Xpe=Zpe,Kpe=Xpe,Ype=Kpe("toUpperCase"),Jpe=Ype;const uS=Bi(Jpe);function so(e){return function(){return e}}const w6=Math.cos,_w=Math.sin,fc=Math.sqrt,vw=Math.PI,hS=2*vw,aC=Math.PI,lC=2*aC,af=1e-6,Qpe=lC-af;function T6(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function eme(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return T6;const n=10**t;return function(s){this._+=s[0];for(let h=1,m=s.length;h<m;++h)this._+=Math.round(arguments[h]*n)/n+s[h]}}class tme{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?T6:eme(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,s,h){this._append`Q${+t},${+n},${this._x1=+s},${this._y1=+h}`}bezierCurveTo(t,n,s,h,m,_){this._append`C${+t},${+n},${+s},${+h},${this._x1=+m},${this._y1=+_}`}arcTo(t,n,s,h,m){if(t=+t,n=+n,s=+s,h=+h,m=+m,m<0)throw new Error(`negative radius: ${m}`);let _=this._x1,i=this._y1,S=s-t,A=h-n,I=_-t,M=i-n,L=I*I+M*M;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(L>af)if(!(Math.abs(M*S-A*I)>af)||!m)this._append`L${this._x1=t},${this._y1=n}`;else{let z=s-_,G=h-i,F=S*S+A*A,U=z*z+G*G,K=Math.sqrt(F),J=Math.sqrt(L),X=m*Math.tan((aC-Math.acos((F+L-U)/(2*K*J)))/2),ie=X/J,Q=X/K;Math.abs(ie-1)>af&&this._append`L${t+ie*I},${n+ie*M}`,this._append`A${m},${m},0,0,${+(M*z>I*G)},${this._x1=t+Q*S},${this._y1=n+Q*A}`}}arc(t,n,s,h,m,_){if(t=+t,n=+n,s=+s,_=!!_,s<0)throw new Error(`negative radius: ${s}`);let i=s*Math.cos(h),S=s*Math.sin(h),A=t+i,I=n+S,M=1^_,L=_?h-m:m-h;this._x1===null?this._append`M${A},${I}`:(Math.abs(this._x1-A)>af||Math.abs(this._y1-I)>af)&&this._append`L${A},${I}`,s&&(L<0&&(L=L%lC+lC),L>Qpe?this._append`A${s},${s},0,1,${M},${t-i},${n-S}A${s},${s},0,1,${M},${this._x1=A},${this._y1=I}`:L>af&&this._append`A${s},${s},0,${+(L>=aC)},${M},${this._x1=t+s*Math.cos(m)},${this._y1=n+s*Math.sin(m)}`)}rect(t,n,s,h){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${s=+s}v${+h}h${-s}Z`}toString(){return this._}}function sO(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const s=Math.floor(n);if(!(s>=0))throw new RangeError(`invalid digits: ${n}`);t=s}return e},()=>new tme(t)}function aO(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function S6(e){this._context=e}S6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function dS(e){return new S6(e)}function E6(e){return e[0]}function A6(e){return e[1]}function P6(e,t){var n=so(!0),s=null,h=dS,m=null,_=sO(i);e=typeof e=="function"?e:e===void 0?E6:so(e),t=typeof t=="function"?t:t===void 0?A6:so(t);function i(S){var A,I=(S=aO(S)).length,M,L=!1,z;for(s==null&&(m=h(z=_())),A=0;A<=I;++A)!(A<I&&n(M=S[A],A,S))===L&&((L=!L)?m.lineStart():m.lineEnd()),L&&m.point(+e(M,A,S),+t(M,A,S));if(z)return m=null,z+""||null}return i.x=function(S){return arguments.length?(e=typeof S=="function"?S:so(+S),i):e},i.y=function(S){return arguments.length?(t=typeof S=="function"?S:so(+S),i):t},i.defined=function(S){return arguments.length?(n=typeof S=="function"?S:so(!!S),i):n},i.curve=function(S){return arguments.length?(h=S,s!=null&&(m=h(s)),i):h},i.context=function(S){return arguments.length?(S==null?s=m=null:m=h(s=S),i):s},i}function g1(e,t,n){var s=null,h=so(!0),m=null,_=dS,i=null,S=sO(A);e=typeof e=="function"?e:e===void 0?E6:so(+e),t=typeof t=="function"?t:so(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?A6:so(+n);function A(M){var L,z,G,F=(M=aO(M)).length,U,K=!1,J,X=new Array(F),ie=new Array(F);for(m==null&&(i=_(J=S())),L=0;L<=F;++L){if(!(L<F&&h(U=M[L],L,M))===K)if(K=!K)z=L,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),G=L-1;G>=z;--G)i.point(X[G],ie[G]);i.lineEnd(),i.areaEnd()}K&&(X[L]=+e(U,L,M),ie[L]=+t(U,L,M),i.point(s?+s(U,L,M):X[L],n?+n(U,L,M):ie[L]))}if(J)return i=null,J+""||null}function I(){return P6().defined(h).curve(_).context(m)}return A.x=function(M){return arguments.length?(e=typeof M=="function"?M:so(+M),s=null,A):e},A.x0=function(M){return arguments.length?(e=typeof M=="function"?M:so(+M),A):e},A.x1=function(M){return arguments.length?(s=M==null?null:typeof M=="function"?M:so(+M),A):s},A.y=function(M){return arguments.length?(t=typeof M=="function"?M:so(+M),n=null,A):t},A.y0=function(M){return arguments.length?(t=typeof M=="function"?M:so(+M),A):t},A.y1=function(M){return arguments.length?(n=M==null?null:typeof M=="function"?M:so(+M),A):n},A.lineX0=A.lineY0=function(){return I().x(e).y(t)},A.lineY1=function(){return I().x(e).y(n)},A.lineX1=function(){return I().x(s).y(t)},A.defined=function(M){return arguments.length?(h=typeof M=="function"?M:so(!!M),A):h},A.curve=function(M){return arguments.length?(_=M,m!=null&&(i=_(m)),A):_},A.context=function(M){return arguments.length?(M==null?m=i=null:i=_(m=M),A):m},A}class C6{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function rme(e){return new C6(e,!0)}function nme(e){return new C6(e,!1)}const lO={draw(e,t){const n=fc(t/vw);e.moveTo(n,0),e.arc(0,0,n,0,hS)}},ime={draw(e,t){const n=fc(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},I6=fc(1/3),ome=I6*2,sme={draw(e,t){const n=fc(t/ome),s=n*I6;e.moveTo(0,-n),e.lineTo(s,0),e.lineTo(0,n),e.lineTo(-s,0),e.closePath()}},ame={draw(e,t){const n=fc(t),s=-n/2;e.rect(s,s,n,n)}},lme=.8908130915292852,M6=_w(vw/10)/_w(7*vw/10),cme=_w(hS/10)*M6,ume=-w6(hS/10)*M6,hme={draw(e,t){const n=fc(t*lme),s=cme*n,h=ume*n;e.moveTo(0,-n),e.lineTo(s,h);for(let m=1;m<5;++m){const _=hS*m/5,i=w6(_),S=_w(_);e.lineTo(S*n,-i*n),e.lineTo(i*s-S*h,S*s+i*h)}e.closePath()}},MA=fc(3),dme={draw(e,t){const n=-fc(t/(MA*3));e.moveTo(0,n*2),e.lineTo(-MA*n,-n),e.lineTo(MA*n,-n),e.closePath()}},il=-.5,ol=fc(3)/2,cC=1/fc(12),fme=(cC/2+1)*3,pme={draw(e,t){const n=fc(t/fme),s=n/2,h=n*cC,m=s,_=n*cC+n,i=-m,S=_;e.moveTo(s,h),e.lineTo(m,_),e.lineTo(i,S),e.lineTo(il*s-ol*h,ol*s+il*h),e.lineTo(il*m-ol*_,ol*m+il*_),e.lineTo(il*i-ol*S,ol*i+il*S),e.lineTo(il*s+ol*h,il*h-ol*s),e.lineTo(il*m+ol*_,il*_-ol*m),e.lineTo(il*i+ol*S,il*S-ol*i),e.closePath()}};function mme(e,t){let n=null,s=sO(h);e=typeof e=="function"?e:so(e||lO),t=typeof t=="function"?t:so(t===void 0?64:+t);function h(){let m;if(n||(n=m=s()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),m)return n=null,m+""||null}return h.type=function(m){return arguments.length?(e=typeof m=="function"?m:so(m),h):e},h.size=function(m){return arguments.length?(t=typeof m=="function"?m:so(+m),h):t},h.context=function(m){return arguments.length?(n=m??null,h):n},h}function xw(){}function bw(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function O6(e){this._context=e}O6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:bw(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:bw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function gme(e){return new O6(e)}function R6(e){this._context=e}R6.prototype={areaStart:xw,areaEnd:xw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:bw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function yme(e){return new R6(e)}function D6(e){this._context=e}D6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,s=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,s):this._context.moveTo(n,s);break;case 3:this._point=4;default:bw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function _me(e){return new D6(e)}function k6(e){this._context=e}k6.prototype={areaStart:xw,areaEnd:xw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function vme(e){return new k6(e)}function Jz(e){return e<0?-1:1}function Qz(e,t,n){var s=e._x1-e._x0,h=t-e._x1,m=(e._y1-e._y0)/(s||h<0&&-0),_=(n-e._y1)/(h||s<0&&-0),i=(m*h+_*s)/(s+h);return(Jz(m)+Jz(_))*Math.min(Math.abs(m),Math.abs(_),.5*Math.abs(i))||0}function e3(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function OA(e,t,n){var s=e._x0,h=e._y0,m=e._x1,_=e._y1,i=(m-s)/3;e._context.bezierCurveTo(s+i,h+i*t,m-i,_-i*n,m,_)}function ww(e){this._context=e}ww.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:OA(this,this._t0,e3(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,OA(this,e3(this,n=Qz(this,e,t)),n);break;default:OA(this,this._t0,n=Qz(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function j6(e){this._context=new L6(e)}(j6.prototype=Object.create(ww.prototype)).point=function(e,t){ww.prototype.point.call(this,t,e)};function L6(e){this._context=e}L6.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,s,h,m){this._context.bezierCurveTo(t,e,s,n,m,h)}};function xme(e){return new ww(e)}function bme(e){return new j6(e)}function N6(e){this._context=e}N6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var s=t3(e),h=t3(t),m=0,_=1;_<n;++m,++_)this._context.bezierCurveTo(s[0][m],h[0][m],s[1][m],h[1][m],e[_],t[_]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function t3(e){var t,n=e.length-1,s,h=new Array(n),m=new Array(n),_=new Array(n);for(h[0]=0,m[0]=2,_[0]=e[0]+2*e[1],t=1;t<n-1;++t)h[t]=1,m[t]=4,_[t]=4*e[t]+2*e[t+1];for(h[n-1]=2,m[n-1]=7,_[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)s=h[t]/m[t-1],m[t]-=s,_[t]-=s*_[t-1];for(h[n-1]=_[n-1]/m[n-1],t=n-2;t>=0;--t)h[t]=(_[t]-h[t+1])/m[t];for(m[n-1]=(e[n]+h[n-1])/2,t=0;t<n-1;++t)m[t]=2*e[t+1]-h[t+1];return[h,m]}function wme(e){return new N6(e)}function fS(e,t){this._context=e,this._t=t}fS.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Tme(e){return new fS(e,.5)}function Sme(e){return new fS(e,0)}function Eme(e){return new fS(e,1)}function dg(e,t){if((_=e.length)>1)for(var n=1,s,h,m=e[t[0]],_,i=m.length;n<_;++n)for(h=m,m=e[t[n]],s=0;s<i;++s)m[s][1]+=m[s][0]=isNaN(h[s][1])?h[s][0]:h[s][1]}function uC(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function Ame(e,t){return e[t]}function Pme(e){const t=[];return t.key=e,t}function Cme(){var e=so([]),t=uC,n=dg,s=Ame;function h(m){var _=Array.from(e.apply(this,arguments),Pme),i,S=_.length,A=-1,I;for(const M of m)for(i=0,++A;i<S;++i)(_[i][A]=[0,+s(M,_[i].key,A,m)]).data=M;for(i=0,I=aO(t(_));i<S;++i)_[I[i]].index=i;return n(_,I),_}return h.keys=function(m){return arguments.length?(e=typeof m=="function"?m:so(Array.from(m)),h):e},h.value=function(m){return arguments.length?(s=typeof m=="function"?m:so(+m),h):s},h.order=function(m){return arguments.length?(t=m==null?uC:typeof m=="function"?m:so(Array.from(m)),h):t},h.offset=function(m){return arguments.length?(n=m??dg,h):n},h}function Ime(e,t){if((s=e.length)>0){for(var n,s,h=0,m=e[0].length,_;h<m;++h){for(_=n=0;n<s;++n)_+=e[n][h][1]||0;if(_)for(n=0;n<s;++n)e[n][h][1]/=_}dg(e,t)}}function Mme(e,t){if((h=e.length)>0){for(var n=0,s=e[t[0]],h,m=s.length;n<m;++n){for(var _=0,i=0;_<h;++_)i+=e[_][n][1]||0;s[n][1]+=s[n][0]=-i/2}dg(e,t)}}function Ome(e,t){if(!(!((_=e.length)>0)||!((m=(h=e[t[0]]).length)>0))){for(var n=0,s=1,h,m,_;s<m;++s){for(var i=0,S=0,A=0;i<_;++i){for(var I=e[t[i]],M=I[s][1]||0,L=I[s-1][1]||0,z=(M-L)/2,G=0;G<i;++G){var F=e[t[G]],U=F[s][1]||0,K=F[s-1][1]||0;z+=U-K}S+=M,A+=z*M}h[s-1][1]+=h[s-1][0]=n,S&&(n-=A/S)}h[s-1][1]+=h[s-1][0]=n,dg(e,t)}}function qv(e){"@babel/helpers - typeof";return qv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qv(e)}var Rme=["type","size","sizeType"];function hC(){return hC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},hC.apply(this,arguments)}function r3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function n3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r3(Object(n),!0).forEach(function(s){Dme(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Dme(e,t,n){return t=kme(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kme(e){var t=jme(e,"string");return qv(t)=="symbol"?t:t+""}function jme(e,t){if(qv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(qv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Lme(e,t){if(e==null)return{};var n=Nme(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Nme(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}var z6={symbolCircle:lO,symbolCross:ime,symbolDiamond:sme,symbolSquare:ame,symbolStar:hme,symbolTriangle:dme,symbolWye:pme},zme=Math.PI/180,Fme=function(t){var n="symbol".concat(uS(t));return z6[n]||lO},Bme=function(t,n,s){if(n==="area")return t;switch(s){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var h=18*zme;return 1.25*t*t*(Math.tan(h)-Math.tan(h*2)*Math.pow(Math.tan(h),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},Vme=function(t,n){z6["symbol".concat(uS(t))]=n},cO=function(t){var n=t.type,s=n===void 0?"circle":n,h=t.size,m=h===void 0?64:h,_=t.sizeType,i=_===void 0?"area":_,S=Lme(t,Rme),A=n3(n3({},S),{},{type:s,size:m,sizeType:i}),I=function(){var U=Fme(s),K=mme().type(U).size(Bme(m,i,s));return K()},M=A.className,L=A.cx,z=A.cy,G=Si(A,!0);return L===+L&&z===+z&&m===+m?$e.createElement("path",hC({},G,{className:Ei("recharts-symbols",M),transform:"translate(".concat(L,", ").concat(z,")"),d:I()})):null};cO.registerSymbol=Vme;function fg(e){"@babel/helpers - typeof";return fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fg(e)}function dC(){return dC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},dC.apply(this,arguments)}function i3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function $me(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?i3(Object(n),!0).forEach(function(s){Zv(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Ume(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gme(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,B6(s.key),s)}}function Hme(e,t,n){return t&&Gme(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Wme(e,t,n){return t=Tw(t),qme(e,F6()?Reflect.construct(t,n||[],Tw(e).constructor):t.apply(e,n))}function qme(e,t){if(t&&(fg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zme(e)}function Zme(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F6(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(F6=function(){return!!e})()}function Tw(e){return Tw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Tw(e)}function Xme(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fC(e,t)}function fC(e,t){return fC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},fC(e,t)}function Zv(e,t,n){return t=B6(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B6(e){var t=Kme(e,"string");return fg(t)=="symbol"?t:t+""}function Kme(e,t){if(fg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(fg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sl=32,uO=function(e){function t(){return Ume(this,t),Wme(this,t,arguments)}return Xme(t,e),Hme(t,[{key:"renderIcon",value:function(s){var h=this.props.inactiveColor,m=sl/2,_=sl/6,i=sl/3,S=s.inactive?h:s.color;if(s.type==="plainline")return $e.createElement("line",{strokeWidth:4,fill:"none",stroke:S,strokeDasharray:s.payload.strokeDasharray,x1:0,y1:m,x2:sl,y2:m,className:"recharts-legend-icon"});if(s.type==="line")return $e.createElement("path",{strokeWidth:4,fill:"none",stroke:S,d:"M0,".concat(m,"h").concat(i,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(2*i,",").concat(m,`
            H`).concat(sl,"M").concat(2*i,",").concat(m,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(i,",").concat(m),className:"recharts-legend-icon"});if(s.type==="rect")return $e.createElement("path",{stroke:"none",fill:S,d:"M0,".concat(sl/8,"h").concat(sl,"v").concat(sl*3/4,"h").concat(-sl,"z"),className:"recharts-legend-icon"});if($e.isValidElement(s.legendIcon)){var A=$me({},s);return delete A.legendIcon,$e.cloneElement(s.legendIcon,A)}return $e.createElement(cO,{fill:S,cx:m,cy:m,size:sl,sizeType:"diameter",type:s.type})}},{key:"renderItems",value:function(){var s=this,h=this.props,m=h.payload,_=h.iconSize,i=h.layout,S=h.formatter,A=h.inactiveColor,I={x:0,y:0,width:sl,height:sl},M={display:i==="horizontal"?"inline-block":"block",marginRight:10},L={display:"inline-block",verticalAlign:"middle",marginRight:4};return m.map(function(z,G){var F=z.formatter||S,U=Ei(Zv(Zv({"recharts-legend-item":!0},"legend-item-".concat(G),!0),"inactive",z.inactive));if(z.type==="none")return null;var K=ai(z.value)?null:z.value;ju(!ai(z.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var J=z.inactive?A:z.color;return $e.createElement("li",dC({className:U,style:M,key:"legend-item-".concat(G)},yw(s.props,z,G)),$e.createElement(nC,{width:_,height:_,viewBox:I,style:L},s.renderIcon(z)),$e.createElement("span",{className:"recharts-legend-item-text",style:{color:J}},F?F(K,z,G):K))})}},{key:"render",value:function(){var s=this.props,h=s.payload,m=s.layout,_=s.align;if(!h||!h.length)return null;var i={padding:0,margin:0,textAlign:m==="horizontal"?_:"left"};return $e.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(B.PureComponent);Zv(uO,"displayName","Legend");Zv(uO,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var Yme=YT;function Jme(){this.__data__=new Yme,this.size=0}var Qme=Jme;function ege(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var tge=ege;function rge(e){return this.__data__.get(e)}var nge=rge;function ige(e){return this.__data__.has(e)}var oge=ige,sge=YT,age=YM,lge=JM,cge=200;function uge(e,t){var n=this.__data__;if(n instanceof sge){var s=n.__data__;if(!age||s.length<cge-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new lge(s)}return n.set(e,t),this.size=n.size,this}var hge=uge,dge=YT,fge=Qme,pge=tge,mge=nge,gge=oge,yge=hge;function Qg(e){var t=this.__data__=new dge(e);this.size=t.size}Qg.prototype.clear=fge;Qg.prototype.delete=pge;Qg.prototype.get=mge;Qg.prototype.has=gge;Qg.prototype.set=yge;var V6=Qg,_ge="__lodash_hash_undefined__";function vge(e){return this.__data__.set(e,_ge),this}var xge=vge;function bge(e){return this.__data__.has(e)}var wge=bge,Tge=JM,Sge=xge,Ege=wge;function Sw(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Tge;++t<n;)this.add(e[t])}Sw.prototype.add=Sw.prototype.push=Sge;Sw.prototype.has=Ege;var $6=Sw;function Age(e,t){for(var n=-1,s=e==null?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1}var U6=Age;function Pge(e,t){return e.has(t)}var G6=Pge,Cge=$6,Ige=U6,Mge=G6,Oge=1,Rge=2;function Dge(e,t,n,s,h,m){var _=n&Oge,i=e.length,S=t.length;if(i!=S&&!(_&&S>i))return!1;var A=m.get(e),I=m.get(t);if(A&&I)return A==t&&I==e;var M=-1,L=!0,z=n&Rge?new Cge:void 0;for(m.set(e,t),m.set(t,e);++M<i;){var G=e[M],F=t[M];if(s)var U=_?s(F,G,M,t,e,m):s(G,F,M,e,t,m);if(U!==void 0){if(U)continue;L=!1;break}if(z){if(!Ige(t,function(K,J){if(!Mge(z,J)&&(G===K||h(G,K,n,s,m)))return z.push(J)})){L=!1;break}}else if(!(G===F||h(G,F,n,s,m))){L=!1;break}}return m.delete(e),m.delete(t),L}var H6=Dge,kge=Qc,jge=kge.Uint8Array,Lge=jge;function Nge(e){var t=-1,n=Array(e.size);return e.forEach(function(s,h){n[++t]=[h,s]}),n}var zge=Nge;function Fge(e){var t=-1,n=Array(e.size);return e.forEach(function(s){n[++t]=s}),n}var hO=Fge,o3=H0,s3=Lge,Bge=KM,Vge=H6,$ge=zge,Uge=hO,Gge=1,Hge=2,Wge="[object Boolean]",qge="[object Date]",Zge="[object Error]",Xge="[object Map]",Kge="[object Number]",Yge="[object RegExp]",Jge="[object Set]",Qge="[object String]",eye="[object Symbol]",tye="[object ArrayBuffer]",rye="[object DataView]",a3=o3?o3.prototype:void 0,RA=a3?a3.valueOf:void 0;function nye(e,t,n,s,h,m,_){switch(n){case rye:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case tye:return!(e.byteLength!=t.byteLength||!m(new s3(e),new s3(t)));case Wge:case qge:case Kge:return Bge(+e,+t);case Zge:return e.name==t.name&&e.message==t.message;case Yge:case Qge:return e==t+"";case Xge:var i=$ge;case Jge:var S=s&Gge;if(i||(i=Uge),e.size!=t.size&&!S)return!1;var A=_.get(e);if(A)return A==t;s|=Hge,_.set(e,t);var I=Vge(i(e),i(t),s,h,m,_);return _.delete(e),I;case eye:if(RA)return RA.call(e)==RA.call(t)}return!1}var iye=nye;function oye(e,t){for(var n=-1,s=t.length,h=e.length;++n<s;)e[h+n]=t[n];return e}var W6=oye,sye=W6,aye=xa;function lye(e,t,n){var s=t(e);return aye(e)?s:sye(s,n(e))}var cye=lye;function uye(e,t){for(var n=-1,s=e==null?0:e.length,h=0,m=[];++n<s;){var _=e[n];t(_,n,e)&&(m[h++]=_)}return m}var hye=uye;function dye(){return[]}var fye=dye,pye=hye,mye=fye,gye=Object.prototype,yye=gye.propertyIsEnumerable,l3=Object.getOwnPropertySymbols,_ye=l3?function(e){return e==null?[]:(e=Object(e),pye(l3(e),function(t){return yye.call(e,t)}))}:mye,vye=_ye;function xye(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}var bye=xye,wye=Zu,Tye=Xu,Sye="[object Arguments]";function Eye(e){return Tye(e)&&wye(e)==Sye}var Aye=Eye,c3=Aye,Pye=Xu,q6=Object.prototype,Cye=q6.hasOwnProperty,Iye=q6.propertyIsEnumerable,Mye=c3(function(){return arguments}())?c3:function(e){return Pye(e)&&Cye.call(e,"callee")&&!Iye.call(e,"callee")},dO=Mye,Ew={exports:{}};function Oye(){return!1}var Rye=Oye;Ew.exports;(function(e,t){var n=Qc,s=Rye,h=t&&!t.nodeType&&t,m=h&&!0&&e&&!e.nodeType&&e,_=m&&m.exports===h,i=_?n.Buffer:void 0,S=i?i.isBuffer:void 0,A=S||s;e.exports=A})(Ew,Ew.exports);var Z6=Ew.exports,Dye=9007199254740991,kye=/^(?:0|[1-9]\d*)$/;function jye(e,t){var n=typeof e;return t=t??Dye,!!t&&(n=="number"||n!="symbol"&&kye.test(e))&&e>-1&&e%1==0&&e<t}var fO=jye,Lye=9007199254740991;function Nye(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Lye}var pO=Nye,zye=Zu,Fye=pO,Bye=Xu,Vye="[object Arguments]",$ye="[object Array]",Uye="[object Boolean]",Gye="[object Date]",Hye="[object Error]",Wye="[object Function]",qye="[object Map]",Zye="[object Number]",Xye="[object Object]",Kye="[object RegExp]",Yye="[object Set]",Jye="[object String]",Qye="[object WeakMap]",e_e="[object ArrayBuffer]",t_e="[object DataView]",r_e="[object Float32Array]",n_e="[object Float64Array]",i_e="[object Int8Array]",o_e="[object Int16Array]",s_e="[object Int32Array]",a_e="[object Uint8Array]",l_e="[object Uint8ClampedArray]",c_e="[object Uint16Array]",u_e="[object Uint32Array]",fo={};fo[r_e]=fo[n_e]=fo[i_e]=fo[o_e]=fo[s_e]=fo[a_e]=fo[l_e]=fo[c_e]=fo[u_e]=!0;fo[Vye]=fo[$ye]=fo[e_e]=fo[Uye]=fo[t_e]=fo[Gye]=fo[Hye]=fo[Wye]=fo[qye]=fo[Zye]=fo[Xye]=fo[Kye]=fo[Yye]=fo[Jye]=fo[Qye]=!1;function h_e(e){return Bye(e)&&Fye(e.length)&&!!fo[zye(e)]}var d_e=h_e;function f_e(e){return function(t){return e(t)}}var X6=f_e,Aw={exports:{}};Aw.exports;(function(e,t){var n=n6,s=t&&!t.nodeType&&t,h=s&&!0&&e&&!e.nodeType&&e,m=h&&h.exports===s,_=m&&n.process,i=function(){try{var S=h&&h.require&&h.require("util").types;return S||_&&_.binding&&_.binding("util")}catch{}}();e.exports=i})(Aw,Aw.exports);var p_e=Aw.exports,m_e=d_e,g_e=X6,u3=p_e,h3=u3&&u3.isTypedArray,y_e=h3?g_e(h3):m_e,K6=y_e,__e=bye,v_e=dO,x_e=xa,b_e=Z6,w_e=fO,T_e=K6,S_e=Object.prototype,E_e=S_e.hasOwnProperty;function A_e(e,t){var n=x_e(e),s=!n&&v_e(e),h=!n&&!s&&b_e(e),m=!n&&!s&&!h&&T_e(e),_=n||s||h||m,i=_?__e(e.length,String):[],S=i.length;for(var A in e)(t||E_e.call(e,A))&&!(_&&(A=="length"||h&&(A=="offset"||A=="parent")||m&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||w_e(A,S)))&&i.push(A);return i}var P_e=A_e,C_e=Object.prototype;function I_e(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||C_e;return e===n}var M_e=I_e;function O_e(e,t){return function(n){return e(t(n))}}var Y6=O_e,R_e=Y6,D_e=R_e(Object.keys,Object),k_e=D_e,j_e=M_e,L_e=k_e,N_e=Object.prototype,z_e=N_e.hasOwnProperty;function F_e(e){if(!j_e(e))return L_e(e);var t=[];for(var n in Object(e))z_e.call(e,n)&&n!="constructor"&&t.push(n);return t}var B_e=F_e,V_e=XM,$_e=pO;function U_e(e){return e!=null&&$_e(e.length)&&!V_e(e)}var Z0=U_e,G_e=P_e,H_e=B_e,W_e=Z0;function q_e(e){return W_e(e)?G_e(e):H_e(e)}var pS=q_e,Z_e=cye,X_e=vye,K_e=pS;function Y_e(e){return Z_e(e,K_e,X_e)}var J_e=Y_e,d3=J_e,Q_e=1,eve=Object.prototype,tve=eve.hasOwnProperty;function rve(e,t,n,s,h,m){var _=n&Q_e,i=d3(e),S=i.length,A=d3(t),I=A.length;if(S!=I&&!_)return!1;for(var M=S;M--;){var L=i[M];if(!(_?L in t:tve.call(t,L)))return!1}var z=m.get(e),G=m.get(t);if(z&&G)return z==t&&G==e;var F=!0;m.set(e,t),m.set(t,e);for(var U=_;++M<S;){L=i[M];var K=e[L],J=t[L];if(s)var X=_?s(J,K,L,t,e,m):s(K,J,L,e,t,m);if(!(X===void 0?K===J||h(K,J,n,s,m):X)){F=!1;break}U||(U=L=="constructor")}if(F&&!U){var ie=e.constructor,Q=t.constructor;ie!=Q&&"constructor"in e&&"constructor"in t&&!(typeof ie=="function"&&ie instanceof ie&&typeof Q=="function"&&Q instanceof Q)&&(F=!1)}return m.delete(e),m.delete(t),F}var nve=rve,ive=Nf,ove=Qc,sve=ive(ove,"DataView"),ave=sve,lve=Nf,cve=Qc,uve=lve(cve,"Promise"),hve=uve,dve=Nf,fve=Qc,pve=dve(fve,"Set"),J6=pve,mve=Nf,gve=Qc,yve=mve(gve,"WeakMap"),_ve=yve,pC=ave,mC=YM,gC=hve,yC=J6,_C=_ve,Q6=Zu,ey=o6,f3="[object Map]",vve="[object Object]",p3="[object Promise]",m3="[object Set]",g3="[object WeakMap]",y3="[object DataView]",xve=ey(pC),bve=ey(mC),wve=ey(gC),Tve=ey(yC),Sve=ey(_C),lf=Q6;(pC&&lf(new pC(new ArrayBuffer(1)))!=y3||mC&&lf(new mC)!=f3||gC&&lf(gC.resolve())!=p3||yC&&lf(new yC)!=m3||_C&&lf(new _C)!=g3)&&(lf=function(e){var t=Q6(e),n=t==vve?e.constructor:void 0,s=n?ey(n):"";if(s)switch(s){case xve:return y3;case bve:return f3;case wve:return p3;case Tve:return m3;case Sve:return g3}return t});var Eve=lf,DA=V6,Ave=H6,Pve=iye,Cve=nve,_3=Eve,v3=xa,x3=Z6,Ive=K6,Mve=1,b3="[object Arguments]",w3="[object Array]",y1="[object Object]",Ove=Object.prototype,T3=Ove.hasOwnProperty;function Rve(e,t,n,s,h,m){var _=v3(e),i=v3(t),S=_?w3:_3(e),A=i?w3:_3(t);S=S==b3?y1:S,A=A==b3?y1:A;var I=S==y1,M=A==y1,L=S==A;if(L&&x3(e)){if(!x3(t))return!1;_=!0,I=!1}if(L&&!I)return m||(m=new DA),_||Ive(e)?Ave(e,t,n,s,h,m):Pve(e,t,S,n,s,h,m);if(!(n&Mve)){var z=I&&T3.call(e,"__wrapped__"),G=M&&T3.call(t,"__wrapped__");if(z||G){var F=z?e.value():e,U=G?t.value():t;return m||(m=new DA),h(F,U,n,s,m)}}return L?(m||(m=new DA),Cve(e,t,n,s,h,m)):!1}var Dve=Rve,kve=Dve,S3=Xu;function e8(e,t,n,s,h){return e===t?!0:e==null||t==null||!S3(e)&&!S3(t)?e!==e&&t!==t:kve(e,t,n,s,e8,h)}var mO=e8,jve=V6,Lve=mO,Nve=1,zve=2;function Fve(e,t,n,s){var h=n.length,m=h,_=!s;if(e==null)return!m;for(e=Object(e);h--;){var i=n[h];if(_&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++h<m;){i=n[h];var S=i[0],A=e[S],I=i[1];if(_&&i[2]){if(A===void 0&&!(S in e))return!1}else{var M=new jve;if(s)var L=s(A,I,S,e,t,M);if(!(L===void 0?Lve(I,A,Nve|zve,s,M):L))return!1}}return!0}var Bve=Fve,Vve=ed;function $ve(e){return e===e&&!Vve(e)}var t8=$ve,Uve=t8,Gve=pS;function Hve(e){for(var t=Gve(e),n=t.length;n--;){var s=t[n],h=e[s];t[n]=[s,h,Uve(h)]}return t}var Wve=Hve;function qve(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var r8=qve,Zve=Bve,Xve=Wve,Kve=r8;function Yve(e){var t=Xve(e);return t.length==1&&t[0][2]?Kve(t[0][0],t[0][1]):function(n){return n===e||Zve(n,e,t)}}var Jve=Yve;function Qve(e,t){return e!=null&&t in Object(e)}var e0e=Qve,t0e=u6,r0e=dO,n0e=xa,i0e=fO,o0e=pO,s0e=QT;function a0e(e,t,n){t=t0e(t,e);for(var s=-1,h=t.length,m=!1;++s<h;){var _=s0e(t[s]);if(!(m=e!=null&&n(e,_)))break;e=e[_]}return m||++s!=h?m:(h=e==null?0:e.length,!!h&&o0e(h)&&i0e(_,h)&&(n0e(e)||r0e(e)))}var l0e=a0e,c0e=e0e,u0e=l0e;function h0e(e,t){return e!=null&&u0e(e,t,c0e)}var d0e=h0e,f0e=mO,p0e=h6,m0e=d0e,g0e=ZM,y0e=t8,_0e=r8,v0e=QT,x0e=1,b0e=2;function w0e(e,t){return g0e(e)&&y0e(t)?_0e(v0e(e),t):function(n){var s=p0e(n,e);return s===void 0&&s===t?m0e(n,e):f0e(t,s,x0e|b0e)}}var T0e=w0e;function S0e(e){return e}var ty=S0e;function E0e(e){return function(t){return t?.[e]}}var A0e=E0e,P0e=tO;function C0e(e){return function(t){return P0e(t,e)}}var I0e=C0e,M0e=A0e,O0e=I0e,R0e=ZM,D0e=QT;function k0e(e){return R0e(e)?M0e(D0e(e)):O0e(e)}var j0e=k0e,L0e=Jve,N0e=T0e,z0e=ty,F0e=xa,B0e=j0e;function V0e(e){return typeof e=="function"?e:e==null?z0e:typeof e=="object"?F0e(e)?N0e(e[0],e[1]):L0e(e):B0e(e)}var td=V0e;function $0e(e,t,n,s){for(var h=e.length,m=n+(s?1:-1);s?m--:++m<h;)if(t(e[m],m,e))return m;return-1}var n8=$0e;function U0e(e){return e!==e}var G0e=U0e;function H0e(e,t,n){for(var s=n-1,h=e.length;++s<h;)if(e[s]===t)return s;return-1}var W0e=H0e,q0e=n8,Z0e=G0e,X0e=W0e;function K0e(e,t,n){return t===t?X0e(e,t,n):q0e(e,Z0e,n)}var Y0e=K0e,J0e=Y0e;function Q0e(e,t){var n=e==null?0:e.length;return!!n&&J0e(e,t,0)>-1}var exe=Q0e;function txe(e,t,n){for(var s=-1,h=e==null?0:e.length;++s<h;)if(n(t,e[s]))return!0;return!1}var rxe=txe;function nxe(){}var ixe=nxe,kA=J6,oxe=ixe,sxe=hO,axe=1/0,lxe=kA&&1/sxe(new kA([,-0]))[1]==axe?function(e){return new kA(e)}:oxe,cxe=lxe,uxe=$6,hxe=exe,dxe=rxe,fxe=G6,pxe=cxe,mxe=hO,gxe=200;function yxe(e,t,n){var s=-1,h=hxe,m=e.length,_=!0,i=[],S=i;if(n)_=!1,h=dxe;else if(m>=gxe){var A=t?null:pxe(e);if(A)return mxe(A);_=!1,h=fxe,S=new uxe}else S=t?[]:i;e:for(;++s<m;){var I=e[s],M=t?t(I):I;if(I=n||I!==0?I:0,_&&M===M){for(var L=S.length;L--;)if(S[L]===M)continue e;t&&S.push(M),i.push(I)}else h(S,M,n)||(S!==i&&S.push(M),i.push(I))}return i}var _xe=yxe,vxe=td,xxe=_xe;function bxe(e,t){return e&&e.length?xxe(e,vxe(t)):[]}var wxe=bxe;const E3=Bi(wxe);function i8(e,t,n){return t===!0?E3(e,n):ai(t)?E3(e,t):e}function pg(e){"@babel/helpers - typeof";return pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pg(e)}var Txe=["ref"];function A3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Pu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?A3(Object(n),!0).forEach(function(s){mS(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Sxe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P3(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s8(s.key),s)}}function Exe(e,t,n){return t&&P3(e.prototype,t),n&&P3(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Axe(e,t,n){return t=Pw(t),Pxe(e,o8()?Reflect.construct(t,n||[],Pw(e).constructor):t.apply(e,n))}function Pxe(e,t){if(t&&(pg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cxe(e)}function Cxe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(o8=function(){return!!e})()}function Pw(e){return Pw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Pw(e)}function Ixe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vC(e,t)}function vC(e,t){return vC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},vC(e,t)}function mS(e,t,n){return t=s8(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s8(e){var t=Mxe(e,"string");return pg(t)=="symbol"?t:t+""}function Mxe(e,t){if(pg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(pg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Oxe(e,t){if(e==null)return{};var n=Rxe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Rxe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Dxe(e){return e.value}function kxe(e,t){if($e.isValidElement(e))return $e.cloneElement(e,t);if(typeof e=="function")return $e.createElement(e,t);t.ref;var n=Oxe(t,Txe);return $e.createElement(uO,n)}var C3=1,eg=function(e){function t(){var n;Sxe(this,t);for(var s=arguments.length,h=new Array(s),m=0;m<s;m++)h[m]=arguments[m];return n=Axe(this,t,[].concat(h)),mS(n,"lastBoundingBox",{width:-1,height:-1}),n}return Ixe(t,e),Exe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var s=this.wrapperNode.getBoundingClientRect();return s.height=this.wrapperNode.offsetHeight,s.width=this.wrapperNode.offsetWidth,s}return null}},{key:"updateBBox",value:function(){var s=this.props.onBBoxUpdate,h=this.getBBox();h?(Math.abs(h.width-this.lastBoundingBox.width)>C3||Math.abs(h.height-this.lastBoundingBox.height)>C3)&&(this.lastBoundingBox.width=h.width,this.lastBoundingBox.height=h.height,s&&s(h)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,s&&s(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Pu({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(s){var h=this.props,m=h.layout,_=h.align,i=h.verticalAlign,S=h.margin,A=h.chartWidth,I=h.chartHeight,M,L;if(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))if(_==="center"&&m==="vertical"){var z=this.getBBoxSnapshot();M={left:((A||0)-z.width)/2}}else M=_==="right"?{right:S&&S.right||0}:{left:S&&S.left||0};if(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))if(i==="middle"){var G=this.getBBoxSnapshot();L={top:((I||0)-G.height)/2}}else L=i==="bottom"?{bottom:S&&S.bottom||0}:{top:S&&S.top||0};return Pu(Pu({},M),L)}},{key:"render",value:function(){var s=this,h=this.props,m=h.content,_=h.width,i=h.height,S=h.wrapperStyle,A=h.payloadUniqBy,I=h.payload,M=Pu(Pu({position:"absolute",width:_||"auto",height:i||"auto"},this.getDefaultPosition(S)),S);return $e.createElement("div",{className:"recharts-legend-wrapper",style:M,ref:function(z){s.wrapperNode=z}},kxe(m,Pu(Pu({},this.props),{},{payload:i8(I,A,Dxe)})))}}],[{key:"getWithHeight",value:function(s,h){var m=Pu(Pu({},this.defaultProps),s.props),_=m.layout;return _==="vertical"&&wr(s.props.height)?{height:s.props.height}:_==="horizontal"?{width:s.props.width||h}:null}}])}(B.PureComponent);mS(eg,"displayName","Legend");mS(eg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var I3=H0,jxe=dO,Lxe=xa,M3=I3?I3.isConcatSpreadable:void 0;function Nxe(e){return Lxe(e)||jxe(e)||!!(M3&&e&&e[M3])}var zxe=Nxe,Fxe=W6,Bxe=zxe;function a8(e,t,n,s,h){var m=-1,_=e.length;for(n||(n=Bxe),h||(h=[]);++m<_;){var i=e[m];t>0&&n(i)?t>1?a8(i,t-1,n,s,h):Fxe(h,i):s||(h[h.length]=i)}return h}var l8=a8;function Vxe(e){return function(t,n,s){for(var h=-1,m=Object(t),_=s(t),i=_.length;i--;){var S=_[e?i:++h];if(n(m[S],S,m)===!1)break}return t}}var $xe=Vxe,Uxe=$xe,Gxe=Uxe(),Hxe=Gxe,Wxe=Hxe,qxe=pS;function Zxe(e,t){return e&&Wxe(e,t,qxe)}var c8=Zxe,Xxe=Z0;function Kxe(e,t){return function(n,s){if(n==null)return n;if(!Xxe(n))return e(n,s);for(var h=n.length,m=t?h:-1,_=Object(n);(t?m--:++m<h)&&s(_[m],m,_)!==!1;);return n}}var Yxe=Kxe,Jxe=c8,Qxe=Yxe,ebe=Qxe(Jxe),gO=ebe,tbe=gO,rbe=Z0;function nbe(e,t){var n=-1,s=rbe(e)?Array(e.length):[];return tbe(e,function(h,m,_){s[++n]=t(h,m,_)}),s}var u8=nbe;function ibe(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}var obe=ibe,O3=Zg;function sbe(e,t){if(e!==t){var n=e!==void 0,s=e===null,h=e===e,m=O3(e),_=t!==void 0,i=t===null,S=t===t,A=O3(t);if(!i&&!A&&!m&&e>t||m&&_&&S&&!i&&!A||s&&_&&S||!n&&S||!h)return 1;if(!s&&!m&&!A&&e<t||A&&n&&h&&!s&&!m||i&&n&&h||!_&&h||!S)return-1}return 0}var abe=sbe,lbe=abe;function cbe(e,t,n){for(var s=-1,h=e.criteria,m=t.criteria,_=h.length,i=n.length;++s<_;){var S=lbe(h[s],m[s]);if(S){if(s>=i)return S;var A=n[s];return S*(A=="desc"?-1:1)}}return e.index-t.index}var ube=cbe,jA=eO,hbe=tO,dbe=td,fbe=u8,pbe=obe,mbe=X6,gbe=ube,ybe=ty,_be=xa;function vbe(e,t,n){t.length?t=jA(t,function(m){return _be(m)?function(_){return hbe(_,m.length===1?m[0]:m)}:m}):t=[ybe];var s=-1;t=jA(t,mbe(dbe));var h=fbe(e,function(m,_,i){var S=jA(t,function(A){return A(m)});return{criteria:S,index:++s,value:m}});return pbe(h,function(m,_){return gbe(m,_,n)})}var xbe=vbe;function bbe(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var wbe=bbe,Tbe=wbe,R3=Math.max;function Sbe(e,t,n){return t=R3(t===void 0?e.length-1:t,0),function(){for(var s=arguments,h=-1,m=R3(s.length-t,0),_=Array(m);++h<m;)_[h]=s[t+h];h=-1;for(var i=Array(t+1);++h<t;)i[h]=s[h];return i[t]=n(_),Tbe(e,this,i)}}var Ebe=Sbe;function Abe(e){return function(){return e}}var Pbe=Abe,Cbe=Nf,Ibe=function(){try{var e=Cbe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),h8=Ibe,Mbe=Pbe,D3=h8,Obe=ty,Rbe=D3?function(e,t){return D3(e,"toString",{configurable:!0,enumerable:!1,value:Mbe(t),writable:!0})}:Obe,Dbe=Rbe,kbe=800,jbe=16,Lbe=Date.now;function Nbe(e){var t=0,n=0;return function(){var s=Lbe(),h=jbe-(s-n);if(n=s,h>0){if(++t>=kbe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var zbe=Nbe,Fbe=Dbe,Bbe=zbe,Vbe=Bbe(Fbe),$be=Vbe,Ube=ty,Gbe=Ebe,Hbe=$be;function Wbe(e,t){return Hbe(Gbe(e,t,Ube),e+"")}var qbe=Wbe,Zbe=KM,Xbe=Z0,Kbe=fO,Ybe=ed;function Jbe(e,t,n){if(!Ybe(n))return!1;var s=typeof t;return(s=="number"?Xbe(n)&&Kbe(t,n.length):s=="string"&&t in n)?Zbe(n[t],e):!1}var gS=Jbe,Qbe=l8,e1e=xbe,t1e=qbe,k3=gS,r1e=t1e(function(e,t){if(e==null)return[];var n=t.length;return n>1&&k3(e,t[0],t[1])?t=[]:n>2&&k3(t[0],t[1],t[2])&&(t=[t[0]]),e1e(e,Qbe(t,1),[])}),n1e=r1e;const yO=Bi(n1e);function Xv(e){"@babel/helpers - typeof";return Xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xv(e)}function xC(){return xC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},xC.apply(this,arguments)}function i1e(e,t){return l1e(e)||a1e(e,t)||s1e(e,t)||o1e()}function o1e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s1e(e,t){if(e){if(typeof e=="string")return j3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j3(e,t)}}function j3(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function a1e(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function l1e(e){if(Array.isArray(e))return e}function L3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function LA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L3(Object(n),!0).forEach(function(s){c1e(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function c1e(e,t,n){return t=u1e(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u1e(e){var t=h1e(e,"string");return Xv(t)=="symbol"?t:t+""}function h1e(e,t){if(Xv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Xv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d1e(e){return Array.isArray(e)&&cs(e[0])&&cs(e[1])?e.join(" ~ "):e}var f1e=function(t){var n=t.separator,s=n===void 0?" : ":n,h=t.contentStyle,m=h===void 0?{}:h,_=t.itemStyle,i=_===void 0?{}:_,S=t.labelStyle,A=S===void 0?{}:S,I=t.payload,M=t.formatter,L=t.itemSorter,z=t.wrapperClassName,G=t.labelClassName,F=t.label,U=t.labelFormatter,K=t.accessibilityLayer,J=K===void 0?!1:K,X=function(){if(I&&I.length){var Ge={padding:0,margin:0},Qe=(L?yO(I,L):I).map(function(Ke,ct){if(Ke.type==="none")return null;var He=LA({display:"block",paddingTop:4,paddingBottom:4,color:Ke.color||"#000"},i),qe=Ke.formatter||M||d1e,ut=Ke.value,nt=Ke.name,Kt=ut,cr=nt;if(qe&&Kt!=null&&cr!=null){var Bt=qe(ut,nt,Ke,ct,I);if(Array.isArray(Bt)){var Vt=i1e(Bt,2);Kt=Vt[0],cr=Vt[1]}else Kt=Bt}return $e.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ct),style:He},cs(cr)?$e.createElement("span",{className:"recharts-tooltip-item-name"},cr):null,cs(cr)?$e.createElement("span",{className:"recharts-tooltip-item-separator"},s):null,$e.createElement("span",{className:"recharts-tooltip-item-value"},Kt),$e.createElement("span",{className:"recharts-tooltip-item-unit"},Ke.unit||""))});return $e.createElement("ul",{className:"recharts-tooltip-item-list",style:Ge},Qe)}return null},ie=LA({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},m),Q=LA({margin:0},A),ae=!mi(F),pe=ae?F:"",Pe=Ei("recharts-default-tooltip",z),Fe=Ei("recharts-tooltip-label",G);ae&&U&&I!==void 0&&I!==null&&(pe=U(F,I));var tt=J?{role:"status","aria-live":"assertive"}:{};return $e.createElement("div",xC({className:Pe,style:ie},tt),$e.createElement("p",{className:Fe,style:Q},$e.isValidElement(pe)?pe:"".concat(pe)),X())};function Kv(e){"@babel/helpers - typeof";return Kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kv(e)}function _1(e,t,n){return t=p1e(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p1e(e){var t=m1e(e,"string");return Kv(t)=="symbol"?t:t+""}function m1e(e,t){if(Kv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Kv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uv="recharts-tooltip-wrapper",g1e={visibility:"hidden"};function y1e(e){var t=e.coordinate,n=e.translateX,s=e.translateY;return Ei(uv,_1(_1(_1(_1({},"".concat(uv,"-right"),wr(n)&&t&&wr(t.x)&&n>=t.x),"".concat(uv,"-left"),wr(n)&&t&&wr(t.x)&&n<t.x),"".concat(uv,"-bottom"),wr(s)&&t&&wr(t.y)&&s>=t.y),"".concat(uv,"-top"),wr(s)&&t&&wr(t.y)&&s<t.y))}function N3(e){var t=e.allowEscapeViewBox,n=e.coordinate,s=e.key,h=e.offsetTopLeft,m=e.position,_=e.reverseDirection,i=e.tooltipDimension,S=e.viewBox,A=e.viewBoxDimension;if(m&&wr(m[s]))return m[s];var I=n[s]-i-h,M=n[s]+h;if(t[s])return _[s]?I:M;if(_[s]){var L=I,z=S[s];return L<z?Math.max(M,S[s]):Math.max(I,S[s])}var G=M+i,F=S[s]+A;return G>F?Math.max(I,S[s]):Math.max(M,S[s])}function _1e(e){var t=e.translateX,n=e.translateY,s=e.useTranslate3d;return{transform:s?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}function v1e(e){var t=e.allowEscapeViewBox,n=e.coordinate,s=e.offsetTopLeft,h=e.position,m=e.reverseDirection,_=e.tooltipBox,i=e.useTranslate3d,S=e.viewBox,A,I,M;return _.height>0&&_.width>0&&n?(I=N3({allowEscapeViewBox:t,coordinate:n,key:"x",offsetTopLeft:s,position:h,reverseDirection:m,tooltipDimension:_.width,viewBox:S,viewBoxDimension:S.width}),M=N3({allowEscapeViewBox:t,coordinate:n,key:"y",offsetTopLeft:s,position:h,reverseDirection:m,tooltipDimension:_.height,viewBox:S,viewBoxDimension:S.height}),A=_1e({translateX:I,translateY:M,useTranslate3d:i})):A=g1e,{cssProperties:A,cssClasses:y1e({translateX:I,translateY:M,coordinate:n})}}function mg(e){"@babel/helpers - typeof";return mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mg(e)}function z3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function F3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z3(Object(n),!0).forEach(function(s){wC(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function x1e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b1e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,f8(s.key),s)}}function w1e(e,t,n){return t&&b1e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function T1e(e,t,n){return t=Cw(t),S1e(e,d8()?Reflect.construct(t,n||[],Cw(e).constructor):t.apply(e,n))}function S1e(e,t){if(t&&(mg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E1e(e)}function E1e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(d8=function(){return!!e})()}function Cw(e){return Cw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Cw(e)}function A1e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bC(e,t)}function bC(e,t){return bC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},bC(e,t)}function wC(e,t,n){return t=f8(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f8(e){var t=P1e(e,"string");return mg(t)=="symbol"?t:t+""}function P1e(e,t){if(mg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(mg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var B3=1,C1e=function(e){function t(){var n;x1e(this,t);for(var s=arguments.length,h=new Array(s),m=0;m<s;m++)h[m]=arguments[m];return n=T1e(this,t,[].concat(h)),wC(n,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),wC(n,"handleKeyDown",function(_){if(_.key==="Escape"){var i,S,A,I;n.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(S=n.props.coordinate)===null||S===void 0?void 0:S.x)!==null&&i!==void 0?i:0,y:(A=(I=n.props.coordinate)===null||I===void 0?void 0:I.y)!==null&&A!==void 0?A:0}})}}),n}return A1e(t,e),w1e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var s=this.wrapperNode.getBoundingClientRect();(Math.abs(s.width-this.state.lastBoundingBox.width)>B3||Math.abs(s.height-this.state.lastBoundingBox.height)>B3)&&this.setState({lastBoundingBox:{width:s.width,height:s.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var s,h;this.props.active&&this.updateBBox(),this.state.dismissed&&(((s=this.props.coordinate)===null||s===void 0?void 0:s.x)!==this.state.dismissedAtCoordinate.x||((h=this.props.coordinate)===null||h===void 0?void 0:h.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var s=this,h=this.props,m=h.active,_=h.allowEscapeViewBox,i=h.animationDuration,S=h.animationEasing,A=h.children,I=h.coordinate,M=h.hasPayload,L=h.isAnimationActive,z=h.offset,G=h.position,F=h.reverseDirection,U=h.useTranslate3d,K=h.viewBox,J=h.wrapperStyle,X=v1e({allowEscapeViewBox:_,coordinate:I,offsetTopLeft:z,position:G,reverseDirection:F,tooltipBox:this.state.lastBoundingBox,useTranslate3d:U,viewBox:K}),ie=X.cssClasses,Q=X.cssProperties,ae=F3(F3({transition:L&&m?"transform ".concat(i,"ms ").concat(S):void 0},Q),{},{pointerEvents:"none",visibility:!this.state.dismissed&&m&&M?"visible":"hidden",position:"absolute",top:0,left:0},J);return $e.createElement("div",{tabIndex:-1,className:ie,style:ae,ref:function(Pe){s.wrapperNode=Pe}},A)}}])}(B.PureComponent),I1e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Lu={isSsr:I1e(),get:function(t){return Lu[t]},set:function(t,n){if(typeof t=="string")Lu[t]=n;else{var s=Object.keys(t);s&&s.length&&s.forEach(function(h){Lu[h]=t[h]})}}};function gg(e){"@babel/helpers - typeof";return gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gg(e)}function V3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function $3(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V3(Object(n),!0).forEach(function(s){_O(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function M1e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O1e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,m8(s.key),s)}}function R1e(e,t,n){return t&&O1e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function D1e(e,t,n){return t=Iw(t),k1e(e,p8()?Reflect.construct(t,n||[],Iw(e).constructor):t.apply(e,n))}function k1e(e,t){if(t&&(gg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j1e(e)}function j1e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(p8=function(){return!!e})()}function Iw(e){return Iw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Iw(e)}function L1e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TC(e,t)}function TC(e,t){return TC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},TC(e,t)}function _O(e,t,n){return t=m8(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m8(e){var t=N1e(e,"string");return gg(t)=="symbol"?t:t+""}function N1e(e,t){if(gg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(gg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z1e(e){return e.dataKey}function F1e(e,t){return $e.isValidElement(e)?$e.cloneElement(e,t):typeof e=="function"?$e.createElement(e,t):$e.createElement(f1e,t)}var Yl=function(e){function t(){return M1e(this,t),D1e(this,t,arguments)}return L1e(t,e),R1e(t,[{key:"render",value:function(){var s=this,h=this.props,m=h.active,_=h.allowEscapeViewBox,i=h.animationDuration,S=h.animationEasing,A=h.content,I=h.coordinate,M=h.filterNull,L=h.isAnimationActive,z=h.offset,G=h.payload,F=h.payloadUniqBy,U=h.position,K=h.reverseDirection,J=h.useTranslate3d,X=h.viewBox,ie=h.wrapperStyle,Q=G??[];M&&Q.length&&(Q=i8(G.filter(function(pe){return pe.value!=null&&(pe.hide!==!0||s.props.includeHidden)}),F,z1e));var ae=Q.length>0;return $e.createElement(C1e,{allowEscapeViewBox:_,animationDuration:i,animationEasing:S,isAnimationActive:L,active:m,coordinate:I,hasPayload:ae,offset:z,position:U,reverseDirection:K,useTranslate3d:J,viewBox:X,wrapperStyle:ie},F1e(A,$3($3({},this.props),{},{payload:Q})))}}])}(B.PureComponent);_O(Yl,"displayName","Tooltip");_O(Yl,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Lu.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var B1e=Qc,V1e=function(){return B1e.Date.now()},$1e=V1e,U1e=/\s/;function G1e(e){for(var t=e.length;t--&&U1e.test(e.charAt(t)););return t}var H1e=G1e,W1e=H1e,q1e=/^\s+/;function Z1e(e){return e&&e.slice(0,W1e(e)+1).replace(q1e,"")}var X1e=Z1e,K1e=X1e,U3=ed,Y1e=Zg,G3=NaN,J1e=/^[-+]0x[0-9a-f]+$/i,Q1e=/^0b[01]+$/i,ewe=/^0o[0-7]+$/i,twe=parseInt;function rwe(e){if(typeof e=="number")return e;if(Y1e(e))return G3;if(U3(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=U3(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=K1e(e);var n=Q1e.test(e);return n||ewe.test(e)?twe(e.slice(2),n?2:8):J1e.test(e)?G3:+e}var g8=rwe,nwe=ed,NA=$1e,H3=g8,iwe="Expected a function",owe=Math.max,swe=Math.min;function awe(e,t,n){var s,h,m,_,i,S,A=0,I=!1,M=!1,L=!0;if(typeof e!="function")throw new TypeError(iwe);t=H3(t)||0,nwe(n)&&(I=!!n.leading,M="maxWait"in n,m=M?owe(H3(n.maxWait)||0,t):m,L="trailing"in n?!!n.trailing:L);function z(ae){var pe=s,Pe=h;return s=h=void 0,A=ae,_=e.apply(Pe,pe),_}function G(ae){return A=ae,i=setTimeout(K,t),I?z(ae):_}function F(ae){var pe=ae-S,Pe=ae-A,Fe=t-pe;return M?swe(Fe,m-Pe):Fe}function U(ae){var pe=ae-S,Pe=ae-A;return S===void 0||pe>=t||pe<0||M&&Pe>=m}function K(){var ae=NA();if(U(ae))return J(ae);i=setTimeout(K,F(ae))}function J(ae){return i=void 0,L&&s?z(ae):(s=h=void 0,_)}function X(){i!==void 0&&clearTimeout(i),A=0,s=S=h=i=void 0}function ie(){return i===void 0?_:J(NA())}function Q(){var ae=NA(),pe=U(ae);if(s=arguments,h=this,S=ae,pe){if(i===void 0)return G(S);if(M)return clearTimeout(i),i=setTimeout(K,t),z(S)}return i===void 0&&(i=setTimeout(K,t)),_}return Q.cancel=X,Q.flush=ie,Q}var lwe=awe,cwe=lwe,uwe=ed,hwe="Expected a function";function dwe(e,t,n){var s=!0,h=!0;if(typeof e!="function")throw new TypeError(hwe);return uwe(n)&&(s="leading"in n?!!n.leading:s,h="trailing"in n?!!n.trailing:h),cwe(e,t,{leading:s,maxWait:t,trailing:h})}var fwe=dwe;const y8=Bi(fwe);function Yv(e){"@babel/helpers - typeof";return Yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yv(e)}function W3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function v1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?W3(Object(n),!0).forEach(function(s){pwe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pwe(e,t,n){return t=mwe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mwe(e){var t=gwe(e,"string");return Yv(t)=="symbol"?t:t+""}function gwe(e,t){if(Yv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Yv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ywe(e,t){return bwe(e)||xwe(e,t)||vwe(e,t)||_we()}function _we(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vwe(e,t){if(e){if(typeof e=="string")return q3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q3(e,t)}}function q3(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function xwe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function bwe(e){if(Array.isArray(e))return e}var Z3=B.forwardRef(function(e,t){var n=e.aspect,s=e.initialDimension,h=s===void 0?{width:-1,height:-1}:s,m=e.width,_=m===void 0?"100%":m,i=e.height,S=i===void 0?"100%":i,A=e.minWidth,I=A===void 0?0:A,M=e.minHeight,L=e.maxHeight,z=e.children,G=e.debounce,F=G===void 0?0:G,U=e.id,K=e.className,J=e.onResize,X=e.style,ie=X===void 0?{}:X,Q=B.useRef(null),ae=B.useRef();ae.current=J,B.useImperativeHandle(t,function(){return Object.defineProperty(Q.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),Q.current},configurable:!0})});var pe=B.useState({containerWidth:h.width,containerHeight:h.height}),Pe=ywe(pe,2),Fe=Pe[0],tt=Pe[1],Be=B.useCallback(function(Qe,Ke){tt(function(ct){var He=Math.round(Qe),qe=Math.round(Ke);return ct.containerWidth===He&&ct.containerHeight===qe?ct:{containerWidth:He,containerHeight:qe}})},[]);B.useEffect(function(){var Qe=function(nt){var Kt,cr=nt[0].contentRect,Bt=cr.width,Vt=cr.height;Be(Bt,Vt),(Kt=ae.current)===null||Kt===void 0||Kt.call(ae,Bt,Vt)};F>0&&(Qe=y8(Qe,F,{trailing:!0,leading:!1}));var Ke=new ResizeObserver(Qe),ct=Q.current.getBoundingClientRect(),He=ct.width,qe=ct.height;return Be(He,qe),Ke.observe(Q.current),function(){Ke.disconnect()}},[Be,F]);var Ge=B.useMemo(function(){var Qe=Fe.containerWidth,Ke=Fe.containerHeight;if(Qe<0||Ke<0)return null;ju(ff(_)||ff(S),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,_,S),ju(!n||n>0,"The aspect(%s) must be greater than zero.",n);var ct=ff(_)?Qe:_,He=ff(S)?Ke:S;n&&n>0&&(ct?He=ct/n:He&&(ct=He*n),L&&He>L&&(He=L)),ju(ct>0||He>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ct,He,_,S,I,M,n);var qe=!Array.isArray(z)&&ku(z.type).endsWith("Chart");return $e.Children.map(z,function(ut){return $e.isValidElement(ut)?B.cloneElement(ut,v1({width:ct,height:He},qe?{style:v1({height:"100%",width:"100%",maxHeight:He,maxWidth:ct},ut.props.style)}:{})):ut})},[n,z,S,L,M,I,Fe,_]);return $e.createElement("div",{id:U?"".concat(U):void 0,className:Ei("recharts-responsive-container",K),style:v1(v1({},ie),{},{width:_,height:S,minWidth:I,minHeight:M,maxHeight:L}),ref:Q},Ge)}),_8=function(t){return null};_8.displayName="Cell";function Jv(e){"@babel/helpers - typeof";return Jv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jv(e)}function X3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function SC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X3(Object(n),!0).forEach(function(s){wwe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X3(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function wwe(e,t,n){return t=Twe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Twe(e){var t=Swe(e,"string");return Jv(t)=="symbol"?t:t+""}function Swe(e,t){if(Jv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Jv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dm={widthCache:{},cacheCount:0},Ewe=2e3,Awe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},K3="recharts_measurement_span";function Pwe(e){var t=SC({},e);return Object.keys(t).forEach(function(n){t[n]||delete t[n]}),t}var Rv=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Lu.isSsr)return{width:0,height:0};var s=Pwe(n),h=JSON.stringify({text:t,copyStyle:s});if(Dm.widthCache[h])return Dm.widthCache[h];try{var m=document.getElementById(K3);m||(m=document.createElement("span"),m.setAttribute("id",K3),m.setAttribute("aria-hidden","true"),document.body.appendChild(m));var _=SC(SC({},Awe),s);Object.assign(m.style,_),m.textContent="".concat(t);var i=m.getBoundingClientRect(),S={width:i.width,height:i.height};return Dm.widthCache[h]=S,++Dm.cacheCount>Ewe&&(Dm.cacheCount=0,Dm.widthCache={}),S}catch{return{width:0,height:0}}},Cwe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Qv(e){"@babel/helpers - typeof";return Qv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qv(e)}function Mw(e,t){return Rwe(e)||Owe(e,t)||Mwe(e,t)||Iwe()}function Iwe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mwe(e,t){if(e){if(typeof e=="string")return Y3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y3(e,t)}}function Y3(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Owe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;S=!1}else for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function Rwe(e){if(Array.isArray(e))return e}function Dwe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function J3(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,jwe(s.key),s)}}function kwe(e,t,n){return t&&J3(e.prototype,t),n&&J3(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function jwe(e){var t=Lwe(e,"string");return Qv(t)=="symbol"?t:t+""}function Lwe(e,t){if(Qv(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(Qv(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Q3=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,eF=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Nwe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,zwe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,v8={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},Fwe=Object.keys(v8),Gm="NaN";function Bwe(e,t){return e*v8[t]}var x1=function(){function e(t,n){Dwe(this,e),this.num=t,this.unit=n,this.num=t,this.unit=n,Number.isNaN(t)&&(this.unit=""),n!==""&&!Nwe.test(n)&&(this.num=NaN,this.unit=""),Fwe.includes(n)&&(this.num=Bwe(t,n),this.unit="px")}return kwe(e,[{key:"add",value:function(n){return this.unit!==n.unit?new e(NaN,""):new e(this.num+n.num,this.unit)}},{key:"subtract",value:function(n){return this.unit!==n.unit?new e(NaN,""):new e(this.num-n.num,this.unit)}},{key:"multiply",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new e(NaN,""):new e(this.num*n.num,this.unit||n.unit)}},{key:"divide",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new e(NaN,""):new e(this.num/n.num,this.unit||n.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(n){var s,h=(s=zwe.exec(n))!==null&&s!==void 0?s:[],m=Mw(h,3),_=m[1],i=m[2];return new e(parseFloat(_),i??"")}}])}();function x8(e){if(e.includes(Gm))return Gm;for(var t=e;t.includes("*")||t.includes("/");){var n,s=(n=Q3.exec(t))!==null&&n!==void 0?n:[],h=Mw(s,4),m=h[1],_=h[2],i=h[3],S=x1.parse(m??""),A=x1.parse(i??""),I=_==="*"?S.multiply(A):S.divide(A);if(I.isNaN())return Gm;t=t.replace(Q3,I.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var M,L=(M=eF.exec(t))!==null&&M!==void 0?M:[],z=Mw(L,4),G=z[1],F=z[2],U=z[3],K=x1.parse(G??""),J=x1.parse(U??""),X=F==="+"?K.add(J):K.subtract(J);if(X.isNaN())return Gm;t=t.replace(eF,X.toString())}return t}var tF=/\(([^()]*)\)/;function Vwe(e){for(var t=e;t.includes("(");){var n=tF.exec(t),s=Mw(n,2),h=s[1];t=t.replace(tF,x8(h))}return t}function $we(e){var t=e.replace(/\s+/g,"");return t=Vwe(t),t=x8(t),t}function Uwe(e){try{return $we(e)}catch{return Gm}}function zA(e){var t=Uwe(e.slice(5,-1));return t===Gm?"":t}var Gwe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],Hwe=["dx","dy","angle","className","breakAll"];function EC(){return EC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},EC.apply(this,arguments)}function rF(e,t){if(e==null)return{};var n=Wwe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Wwe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function nF(e,t){return Kwe(e)||Xwe(e,t)||Zwe(e,t)||qwe()}function qwe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zwe(e,t){if(e){if(typeof e=="string")return iF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iF(e,t)}}function iF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Xwe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;S=!1}else for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function Kwe(e){if(Array.isArray(e))return e}var b8=/[ \f\n\r\t\v\u2028\u2029]+/,w8=function(t){var n=t.children,s=t.breakAll,h=t.style;try{var m=[];mi(n)||(s?m=n.toString().split(""):m=n.toString().split(b8));var _=m.map(function(S){return{word:S,width:Rv(S,h).width}}),i=s?0:Rv("",h).width;return{wordsWithComputedWidth:_,spaceWidth:i}}catch{return null}},Ywe=function(t,n,s,h,m){var _=t.maxLines,i=t.children,S=t.style,A=t.breakAll,I=wr(_),M=i,L=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ct.reduce(function(He,qe){var ut=qe.word,nt=qe.width,Kt=He[He.length-1];if(Kt&&(h==null||m||Kt.width+nt+s<Number(h)))Kt.words.push(ut),Kt.width+=nt+s;else{var cr={words:[ut],width:nt};He.push(cr)}return He},[])},z=L(n),G=function(ct){return ct.reduce(function(He,qe){return He.width>qe.width?He:qe})};if(!I)return z;for(var F="",U=function(ct){var He=M.slice(0,ct),qe=w8({breakAll:A,style:S,children:He+F}).wordsWithComputedWidth,ut=L(qe),nt=ut.length>_||G(ut).width>Number(h);return[nt,ut]},K=0,J=M.length-1,X=0,ie;K<=J&&X<=M.length-1;){var Q=Math.floor((K+J)/2),ae=Q-1,pe=U(ae),Pe=nF(pe,2),Fe=Pe[0],tt=Pe[1],Be=U(Q),Ge=nF(Be,1),Qe=Ge[0];if(!Fe&&!Qe&&(K=Q+1),Fe&&Qe&&(J=Q-1),!Fe&&Qe){ie=tt;break}X++}return ie||z},oF=function(t){var n=mi(t)?[]:t.toString().split(b8);return[{words:n}]},Jwe=function(t){var n=t.width,s=t.scaleToFit,h=t.children,m=t.style,_=t.breakAll,i=t.maxLines;if((n||s)&&!Lu.isSsr){var S,A,I=w8({breakAll:_,children:h,style:m});if(I){var M=I.wordsWithComputedWidth,L=I.spaceWidth;S=M,A=L}else return oF(h);return Ywe({breakAll:_,children:h,maxLines:i,style:m},S,A,n,s)}return oF(h)},sF="#808080",Ow=function(t){var n=t.x,s=n===void 0?0:n,h=t.y,m=h===void 0?0:h,_=t.lineHeight,i=_===void 0?"1em":_,S=t.capHeight,A=S===void 0?"0.71em":S,I=t.scaleToFit,M=I===void 0?!1:I,L=t.textAnchor,z=L===void 0?"start":L,G=t.verticalAnchor,F=G===void 0?"end":G,U=t.fill,K=U===void 0?sF:U,J=rF(t,Gwe),X=B.useMemo(function(){return Jwe({breakAll:J.breakAll,children:J.children,maxLines:J.maxLines,scaleToFit:M,style:J.style,width:J.width})},[J.breakAll,J.children,J.maxLines,M,J.style,J.width]),ie=J.dx,Q=J.dy,ae=J.angle,pe=J.className,Pe=J.breakAll,Fe=rF(J,Hwe);if(!cs(s)||!cs(m))return null;var tt=s+(wr(ie)?ie:0),Be=m+(wr(Q)?Q:0),Ge;switch(F){case"start":Ge=zA("calc(".concat(A,")"));break;case"middle":Ge=zA("calc(".concat((X.length-1)/2," * -").concat(i," + (").concat(A," / 2))"));break;default:Ge=zA("calc(".concat(X.length-1," * -").concat(i,")"));break}var Qe=[];if(M){var Ke=X[0].width,ct=J.width;Qe.push("scale(".concat((wr(ct)?ct/Ke:1)/Ke,")"))}return ae&&Qe.push("rotate(".concat(ae,", ").concat(tt,", ").concat(Be,")")),Qe.length&&(Fe.transform=Qe.join(" ")),$e.createElement("text",EC({},Si(Fe,!0),{x:tt,y:Be,className:Ei("recharts-text",pe),textAnchor:z,fill:K.includes("url")?sF:K}),X.map(function(He,qe){var ut=He.words.join(Pe?"":" ");return $e.createElement("tspan",{x:tt,dy:qe===0?Ge:i,key:"".concat(ut,"-").concat(qe)},ut)}))};function Uh(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Qwe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function vO(e){let t,n,s;e.length!==2?(t=Uh,n=(i,S)=>Uh(e(i),S),s=(i,S)=>e(i)-S):(t=e===Uh||e===Qwe?e:eTe,n=e,s=e);function h(i,S,A=0,I=i.length){if(A<I){if(t(S,S)!==0)return I;do{const M=A+I>>>1;n(i[M],S)<0?A=M+1:I=M}while(A<I)}return A}function m(i,S,A=0,I=i.length){if(A<I){if(t(S,S)!==0)return I;do{const M=A+I>>>1;n(i[M],S)<=0?A=M+1:I=M}while(A<I)}return A}function _(i,S,A=0,I=i.length){const M=h(i,S,A,I-1);return M>A&&s(i[M-1],S)>-s(i[M],S)?M-1:M}return{left:h,center:_,right:m}}function eTe(){return 0}function T8(e){return e===null?NaN:+e}function*tTe(e,t){for(let n of e)n!=null&&(n=+n)>=n&&(yield n)}const rTe=vO(Uh),X0=rTe.right;vO(T8).center;class aF extends Map{constructor(t,n=oTe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[s,h]of t)this.set(s,h)}get(t){return super.get(lF(this,t))}has(t){return super.has(lF(this,t))}set(t,n){return super.set(nTe(this,t),n)}delete(t){return super.delete(iTe(this,t))}}function lF({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):n}function nTe({_intern:e,_key:t},n){const s=t(n);return e.has(s)?e.get(s):(e.set(s,n),n)}function iTe({_intern:e,_key:t},n){const s=t(n);return e.has(s)&&(n=e.get(s),e.delete(s)),n}function oTe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function sTe(e=Uh){if(e===Uh)return S8;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const s=e(t,n);return s||s===0?s:(e(n,n)===0)-(e(t,t)===0)}}function S8(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const aTe=Math.sqrt(50),lTe=Math.sqrt(10),cTe=Math.sqrt(2);function Rw(e,t,n){const s=(t-e)/Math.max(0,n),h=Math.floor(Math.log10(s)),m=s/Math.pow(10,h),_=m>=aTe?10:m>=lTe?5:m>=cTe?2:1;let i,S,A;return h<0?(A=Math.pow(10,-h)/_,i=Math.round(e*A),S=Math.round(t*A),i/A<e&&++i,S/A>t&&--S,A=-A):(A=Math.pow(10,h)*_,i=Math.round(e/A),S=Math.round(t/A),i*A<e&&++i,S*A>t&&--S),S<i&&.5<=n&&n<2?Rw(e,t,n*2):[i,S,A]}function AC(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const s=t<e,[h,m,_]=s?Rw(t,e,n):Rw(e,t,n);if(!(m>=h))return[];const i=m-h+1,S=new Array(i);if(s)if(_<0)for(let A=0;A<i;++A)S[A]=(m-A)/-_;else for(let A=0;A<i;++A)S[A]=(m-A)*_;else if(_<0)for(let A=0;A<i;++A)S[A]=(h+A)/-_;else for(let A=0;A<i;++A)S[A]=(h+A)*_;return S}function PC(e,t,n){return t=+t,e=+e,n=+n,Rw(e,t,n)[2]}function CC(e,t,n){t=+t,e=+e,n=+n;const s=t<e,h=s?PC(t,e,n):PC(e,t,n);return(s?-1:1)*(h<0?1/-h:h)}function cF(e,t){let n;for(const s of e)s!=null&&(n<s||n===void 0&&s>=s)&&(n=s);return n}function uF(e,t){let n;for(const s of e)s!=null&&(n>s||n===void 0&&s>=s)&&(n=s);return n}function E8(e,t,n=0,s=1/0,h){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),s=Math.floor(Math.min(e.length-1,s)),!(n<=t&&t<=s))return e;for(h=h===void 0?S8:sTe(h);s>n;){if(s-n>600){const S=s-n+1,A=t-n+1,I=Math.log(S),M=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*M*(S-M)/S)*(A-S/2<0?-1:1),z=Math.max(n,Math.floor(t-A*M/S+L)),G=Math.min(s,Math.floor(t+(S-A)*M/S+L));E8(e,t,z,G,h)}const m=e[t];let _=n,i=s;for(hv(e,n,t),h(e[s],m)>0&&hv(e,n,s);_<i;){for(hv(e,_,i),++_,--i;h(e[_],m)<0;)++_;for(;h(e[i],m)>0;)--i}h(e[n],m)===0?hv(e,n,i):(++i,hv(e,i,s)),i<=t&&(n=i+1),t<=i&&(s=i-1)}return e}function hv(e,t,n){const s=e[t];e[t]=e[n],e[n]=s}function uTe(e,t,n){if(e=Float64Array.from(tTe(e)),!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return uF(e);if(t>=1)return cF(e);var s,h=(s-1)*t,m=Math.floor(h),_=cF(E8(e,m).subarray(0,m+1)),i=uF(e.subarray(m+1));return _+(i-_)*(h-m)}}function hTe(e,t,n=T8){if(!(!(s=e.length)||isNaN(t=+t))){if(t<=0||s<2)return+n(e[0],0,e);if(t>=1)return+n(e[s-1],s-1,e);var s,h=(s-1)*t,m=Math.floor(h),_=+n(e[m],m,e),i=+n(e[m+1],m+1,e);return _+(i-_)*(h-m)}}function dTe(e,t,n){e=+e,t=+t,n=(h=arguments.length)<2?(t=e,e=0,1):h<3?1:+n;for(var s=-1,h=Math.max(0,Math.ceil((t-e)/n))|0,m=new Array(h);++s<h;)m[s]=e+s*n;return m}function bl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ku(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const IC=Symbol("implicit");function xO(){var e=new aF,t=[],n=[],s=IC;function h(m){let _=e.get(m);if(_===void 0){if(s!==IC)return s;e.set(m,_=t.push(m)-1)}return n[_%n.length]}return h.domain=function(m){if(!arguments.length)return t.slice();t=[],e=new aF;for(const _ of m)e.has(_)||e.set(_,t.push(_)-1);return h},h.range=function(m){return arguments.length?(n=Array.from(m),h):n.slice()},h.unknown=function(m){return arguments.length?(s=m,h):s},h.copy=function(){return xO(t,n).unknown(s)},bl.apply(h,arguments),h}function e0(){var e=xO().unknown(void 0),t=e.domain,n=e.range,s=0,h=1,m,_,i=!1,S=0,A=0,I=.5;delete e.unknown;function M(){var L=t().length,z=h<s,G=z?h:s,F=z?s:h;m=(F-G)/Math.max(1,L-S+A*2),i&&(m=Math.floor(m)),G+=(F-G-m*(L-S))*I,_=m*(1-S),i&&(G=Math.round(G),_=Math.round(_));var U=dTe(L).map(function(K){return G+m*K});return n(z?U.reverse():U)}return e.domain=function(L){return arguments.length?(t(L),M()):t()},e.range=function(L){return arguments.length?([s,h]=L,s=+s,h=+h,M()):[s,h]},e.rangeRound=function(L){return[s,h]=L,s=+s,h=+h,i=!0,M()},e.bandwidth=function(){return _},e.step=function(){return m},e.round=function(L){return arguments.length?(i=!!L,M()):i},e.padding=function(L){return arguments.length?(S=Math.min(1,A=+L),M()):S},e.paddingInner=function(L){return arguments.length?(S=Math.min(1,L),M()):S},e.paddingOuter=function(L){return arguments.length?(A=+L,M()):A},e.align=function(L){return arguments.length?(I=Math.max(0,Math.min(1,L)),M()):I},e.copy=function(){return e0(t(),[s,h]).round(i).paddingInner(S).paddingOuter(A).align(I)},bl.apply(M(),arguments)}function A8(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return A8(t())},e}function Dv(){return A8(e0.apply(null,arguments).paddingInner(1))}function bO(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function P8(e,t){var n=Object.create(e.prototype);for(var s in t)n[s]=t[s];return n}function K0(){}var t0=.7,Dw=1/t0,tg="\\s*([+-]?\\d+)\\s*",r0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fTe=/^#([0-9a-f]{3,8})$/,pTe=new RegExp(`^rgb\\(${tg},${tg},${tg}\\)$`),mTe=new RegExp(`^rgb\\(${Hc},${Hc},${Hc}\\)$`),gTe=new RegExp(`^rgba\\(${tg},${tg},${tg},${r0}\\)$`),yTe=new RegExp(`^rgba\\(${Hc},${Hc},${Hc},${r0}\\)$`),_Te=new RegExp(`^hsl\\(${r0},${Hc},${Hc}\\)$`),vTe=new RegExp(`^hsla\\(${r0},${Hc},${Hc},${r0}\\)$`),hF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bO(K0,n0,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:dF,formatHex:dF,formatHex8:xTe,formatHsl:bTe,formatRgb:fF,toString:fF});function dF(){return this.rgb().formatHex()}function xTe(){return this.rgb().formatHex8()}function bTe(){return C8(this).formatHsl()}function fF(){return this.rgb().formatRgb()}function n0(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=fTe.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?pF(t):n===3?new ya(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?b1(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?b1(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=pTe.exec(e))?new ya(t[1],t[2],t[3],1):(t=mTe.exec(e))?new ya(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=gTe.exec(e))?b1(t[1],t[2],t[3],t[4]):(t=yTe.exec(e))?b1(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_Te.exec(e))?yF(t[1],t[2]/100,t[3]/100,1):(t=vTe.exec(e))?yF(t[1],t[2]/100,t[3]/100,t[4]):hF.hasOwnProperty(e)?pF(hF[e]):e==="transparent"?new ya(NaN,NaN,NaN,0):null}function pF(e){return new ya(e>>16&255,e>>8&255,e&255,1)}function b1(e,t,n,s){return s<=0&&(e=t=n=NaN),new ya(e,t,n,s)}function wTe(e){return e instanceof K0||(e=n0(e)),e?(e=e.rgb(),new ya(e.r,e.g,e.b,e.opacity)):new ya}function MC(e,t,n,s){return arguments.length===1?wTe(e):new ya(e,t,n,s??1)}function ya(e,t,n,s){this.r=+e,this.g=+t,this.b=+n,this.opacity=+s}bO(ya,MC,P8(K0,{brighter(e){return e=e==null?Dw:Math.pow(Dw,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?t0:Math.pow(t0,e),new ya(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ya(xf(this.r),xf(this.g),xf(this.b),kw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mF,formatHex:mF,formatHex8:TTe,formatRgb:gF,toString:gF}));function mF(){return`#${pf(this.r)}${pf(this.g)}${pf(this.b)}`}function TTe(){return`#${pf(this.r)}${pf(this.g)}${pf(this.b)}${pf((isNaN(this.opacity)?1:this.opacity)*255)}`}function gF(){const e=kw(this.opacity);return`${e===1?"rgb(":"rgba("}${xf(this.r)}, ${xf(this.g)}, ${xf(this.b)}${e===1?")":`, ${e})`}`}function kw(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function xf(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function pf(e){return e=xf(e),(e<16?"0":"")+e.toString(16)}function yF(e,t,n,s){return s<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new tc(e,t,n,s)}function C8(e){if(e instanceof tc)return new tc(e.h,e.s,e.l,e.opacity);if(e instanceof K0||(e=n0(e)),!e)return new tc;if(e instanceof tc)return e;e=e.rgb();var t=e.r/255,n=e.g/255,s=e.b/255,h=Math.min(t,n,s),m=Math.max(t,n,s),_=NaN,i=m-h,S=(m+h)/2;return i?(t===m?_=(n-s)/i+(n<s)*6:n===m?_=(s-t)/i+2:_=(t-n)/i+4,i/=S<.5?m+h:2-m-h,_*=60):i=S>0&&S<1?0:_,new tc(_,i,S,e.opacity)}function STe(e,t,n,s){return arguments.length===1?C8(e):new tc(e,t,n,s??1)}function tc(e,t,n,s){this.h=+e,this.s=+t,this.l=+n,this.opacity=+s}bO(tc,STe,P8(K0,{brighter(e){return e=e==null?Dw:Math.pow(Dw,e),new tc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?t0:Math.pow(t0,e),new tc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,s=n+(n<.5?n:1-n)*t,h=2*n-s;return new ya(FA(e>=240?e-240:e+120,h,s),FA(e,h,s),FA(e<120?e+240:e-120,h,s),this.opacity)},clamp(){return new tc(_F(this.h),w1(this.s),w1(this.l),kw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=kw(this.opacity);return`${e===1?"hsl(":"hsla("}${_F(this.h)}, ${w1(this.s)*100}%, ${w1(this.l)*100}%${e===1?")":`, ${e})`}`}}));function _F(e){return e=(e||0)%360,e<0?e+360:e}function w1(e){return Math.max(0,Math.min(1,e||0))}function FA(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const wO=e=>()=>e;function ETe(e,t){return function(n){return e+n*t}}function ATe(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(s){return Math.pow(e+s*t,n)}}function PTe(e){return(e=+e)==1?I8:function(t,n){return n-t?ATe(t,n,e):wO(isNaN(t)?n:t)}}function I8(e,t){var n=t-e;return n?ETe(e,n):wO(isNaN(e)?t:e)}const vF=function e(t){var n=PTe(t);function s(h,m){var _=n((h=MC(h)).r,(m=MC(m)).r),i=n(h.g,m.g),S=n(h.b,m.b),A=I8(h.opacity,m.opacity);return function(I){return h.r=_(I),h.g=i(I),h.b=S(I),h.opacity=A(I),h+""}}return s.gamma=e,s}(1);function CTe(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,s=t.slice(),h;return function(m){for(h=0;h<n;++h)s[h]=e[h]*(1-m)+t[h]*m;return s}}function ITe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function MTe(e,t){var n=t?t.length:0,s=e?Math.min(n,e.length):0,h=new Array(s),m=new Array(n),_;for(_=0;_<s;++_)h[_]=ry(e[_],t[_]);for(;_<n;++_)m[_]=t[_];return function(i){for(_=0;_<s;++_)m[_]=h[_](i);return m}}function OTe(e,t){var n=new Date;return e=+e,t=+t,function(s){return n.setTime(e*(1-s)+t*s),n}}function jw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function RTe(e,t){var n={},s={},h;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(h in t)h in e?n[h]=ry(e[h],t[h]):s[h]=t[h];return function(m){for(h in n)s[h]=n[h](m);return s}}var OC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BA=new RegExp(OC.source,"g");function DTe(e){return function(){return e}}function kTe(e){return function(t){return e(t)+""}}function jTe(e,t){var n=OC.lastIndex=BA.lastIndex=0,s,h,m,_=-1,i=[],S=[];for(e=e+"",t=t+"";(s=OC.exec(e))&&(h=BA.exec(t));)(m=h.index)>n&&(m=t.slice(n,m),i[_]?i[_]+=m:i[++_]=m),(s=s[0])===(h=h[0])?i[_]?i[_]+=h:i[++_]=h:(i[++_]=null,S.push({i:_,x:jw(s,h)})),n=BA.lastIndex;return n<t.length&&(m=t.slice(n),i[_]?i[_]+=m:i[++_]=m),i.length<2?S[0]?kTe(S[0].x):DTe(t):(t=S.length,function(A){for(var I=0,M;I<t;++I)i[(M=S[I]).i]=M.x(A);return i.join("")})}function ry(e,t){var n=typeof t,s;return t==null||n==="boolean"?wO(t):(n==="number"?jw:n==="string"?(s=n0(t))?(t=s,vF):jTe:t instanceof n0?vF:t instanceof Date?OTe:ITe(t)?CTe:Array.isArray(t)?MTe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?RTe:jw)(e,t)}function TO(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function LTe(e,t){t===void 0&&(t=e,e=ry);for(var n=0,s=t.length-1,h=t[0],m=new Array(s<0?0:s);n<s;)m[n]=e(h,h=t[++n]);return function(_){var i=Math.max(0,Math.min(s-1,Math.floor(_*=s)));return m[i](_-i)}}function NTe(e){return function(){return e}}function Lw(e){return+e}var xF=[0,1];function ta(e){return e}function RC(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:NTe(isNaN(t)?NaN:.5)}function zTe(e,t){var n;return e>t&&(n=e,e=t,t=n),function(s){return Math.max(e,Math.min(t,s))}}function FTe(e,t,n){var s=e[0],h=e[1],m=t[0],_=t[1];return h<s?(s=RC(h,s),m=n(_,m)):(s=RC(s,h),m=n(m,_)),function(i){return m(s(i))}}function BTe(e,t,n){var s=Math.min(e.length,t.length)-1,h=new Array(s),m=new Array(s),_=-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++_<s;)h[_]=RC(e[_],e[_+1]),m[_]=n(t[_],t[_+1]);return function(i){var S=X0(e,i,1,s)-1;return m[S](h[S](i))}}function Y0(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yS(){var e=xF,t=xF,n=ry,s,h,m,_=ta,i,S,A;function I(){var L=Math.min(e.length,t.length);return _!==ta&&(_=zTe(e[0],e[L-1])),i=L>2?BTe:FTe,S=A=null,M}function M(L){return L==null||isNaN(L=+L)?m:(S||(S=i(e.map(s),t,n)))(s(_(L)))}return M.invert=function(L){return _(h((A||(A=i(t,e.map(s),jw)))(L)))},M.domain=function(L){return arguments.length?(e=Array.from(L,Lw),I()):e.slice()},M.range=function(L){return arguments.length?(t=Array.from(L),I()):t.slice()},M.rangeRound=function(L){return t=Array.from(L),n=TO,I()},M.clamp=function(L){return arguments.length?(_=L?!0:ta,I()):_!==ta},M.interpolate=function(L){return arguments.length?(n=L,I()):n},M.unknown=function(L){return arguments.length?(m=L,M):m},function(L,z){return s=L,h=z,I()}}function SO(){return yS()(ta,ta)}function VTe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Nw(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,s=e.slice(0,n);return[s.length>1?s[0]+s.slice(2):s,+e.slice(n+1)]}function yg(e){return e=Nw(Math.abs(e)),e?e[1]:NaN}function $Te(e,t){return function(n,s){for(var h=n.length,m=[],_=0,i=e[0],S=0;h>0&&i>0&&(S+i+1>s&&(i=Math.max(1,s-S)),m.push(n.substring(h-=i,h+i)),!((S+=i+1)>s));)i=e[_=(_+1)%e.length];return m.reverse().join(t)}}function UTe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var GTe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function i0(e){if(!(t=GTe.exec(e)))throw new Error("invalid format: "+e);var t;return new EO({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}i0.prototype=EO.prototype;function EO(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}EO.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function HTe(e){e:for(var t=e.length,n=1,s=-1,h;n<t;++n)switch(e[n]){case".":s=h=n;break;case"0":s===0&&(s=n),h=n;break;default:if(!+e[n])break e;s>0&&(s=0);break}return s>0?e.slice(0,s)+e.slice(h+1):e}var M8;function WTe(e,t){var n=Nw(e,t);if(!n)return e+"";var s=n[0],h=n[1],m=h-(M8=Math.max(-8,Math.min(8,Math.floor(h/3)))*3)+1,_=s.length;return m===_?s:m>_?s+new Array(m-_+1).join("0"):m>0?s.slice(0,m)+"."+s.slice(m):"0."+new Array(1-m).join("0")+Nw(e,Math.max(0,t+m-1))[0]}function bF(e,t){var n=Nw(e,t);if(!n)return e+"";var s=n[0],h=n[1];return h<0?"0."+new Array(-h).join("0")+s:s.length>h+1?s.slice(0,h+1)+"."+s.slice(h+1):s+new Array(h-s.length+2).join("0")}const wF={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:VTe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bF(e*100,t),r:bF,s:WTe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function TF(e){return e}var SF=Array.prototype.map,EF=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function qTe(e){var t=e.grouping===void 0||e.thousands===void 0?TF:$Te(SF.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",s=e.currency===void 0?"":e.currency[1]+"",h=e.decimal===void 0?".":e.decimal+"",m=e.numerals===void 0?TF:UTe(SF.call(e.numerals,String)),_=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",S=e.nan===void 0?"NaN":e.nan+"";function A(M){M=i0(M);var L=M.fill,z=M.align,G=M.sign,F=M.symbol,U=M.zero,K=M.width,J=M.comma,X=M.precision,ie=M.trim,Q=M.type;Q==="n"?(J=!0,Q="g"):wF[Q]||(X===void 0&&(X=12),ie=!0,Q="g"),(U||L==="0"&&z==="=")&&(U=!0,L="0",z="=");var ae=F==="$"?n:F==="#"&&/[boxX]/.test(Q)?"0"+Q.toLowerCase():"",pe=F==="$"?s:/[%p]/.test(Q)?_:"",Pe=wF[Q],Fe=/[defgprs%]/.test(Q);X=X===void 0?6:/[gprs]/.test(Q)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X));function tt(Be){var Ge=ae,Qe=pe,Ke,ct,He;if(Q==="c")Qe=Pe(Be)+Qe,Be="";else{Be=+Be;var qe=Be<0||1/Be<0;if(Be=isNaN(Be)?S:Pe(Math.abs(Be),X),ie&&(Be=HTe(Be)),qe&&+Be==0&&G!=="+"&&(qe=!1),Ge=(qe?G==="("?G:i:G==="-"||G==="("?"":G)+Ge,Qe=(Q==="s"?EF[8+M8/3]:"")+Qe+(qe&&G==="("?")":""),Fe){for(Ke=-1,ct=Be.length;++Ke<ct;)if(He=Be.charCodeAt(Ke),48>He||He>57){Qe=(He===46?h+Be.slice(Ke+1):Be.slice(Ke))+Qe,Be=Be.slice(0,Ke);break}}}J&&!U&&(Be=t(Be,1/0));var ut=Ge.length+Be.length+Qe.length,nt=ut<K?new Array(K-ut+1).join(L):"";switch(J&&U&&(Be=t(nt+Be,nt.length?K-Qe.length:1/0),nt=""),z){case"<":Be=Ge+Be+Qe+nt;break;case"=":Be=Ge+nt+Be+Qe;break;case"^":Be=nt.slice(0,ut=nt.length>>1)+Ge+Be+Qe+nt.slice(ut);break;default:Be=nt+Ge+Be+Qe;break}return m(Be)}return tt.toString=function(){return M+""},tt}function I(M,L){var z=A((M=i0(M),M.type="f",M)),G=Math.max(-8,Math.min(8,Math.floor(yg(L)/3)))*3,F=Math.pow(10,-G),U=EF[8+G/3];return function(K){return z(F*K)+U}}return{format:A,formatPrefix:I}}var T1,AO,O8;ZTe({thousands:",",grouping:[3],currency:["$",""]});function ZTe(e){return T1=qTe(e),AO=T1.format,O8=T1.formatPrefix,T1}function XTe(e){return Math.max(0,-yg(Math.abs(e)))}function KTe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yg(t)/3)))*3-yg(Math.abs(e)))}function YTe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,yg(t)-yg(e))+1}function R8(e,t,n,s){var h=CC(e,t,n),m;switch(s=i0(s??",f"),s.type){case"s":{var _=Math.max(Math.abs(e),Math.abs(t));return s.precision==null&&!isNaN(m=KTe(h,_))&&(s.precision=m),O8(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(m=YTe(h,Math.max(Math.abs(e),Math.abs(t))))&&(s.precision=m-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(m=XTe(h))&&(s.precision=m-(s.type==="%")*2);break}}return AO(s)}function rd(e){var t=e.domain;return e.ticks=function(n){var s=t();return AC(s[0],s[s.length-1],n??10)},e.tickFormat=function(n,s){var h=t();return R8(h[0],h[h.length-1],n??10,s)},e.nice=function(n){n==null&&(n=10);var s=t(),h=0,m=s.length-1,_=s[h],i=s[m],S,A,I=10;for(i<_&&(A=_,_=i,i=A,A=h,h=m,m=A);I-- >0;){if(A=PC(_,i,n),A===S)return s[h]=_,s[m]=i,t(s);if(A>0)_=Math.floor(_/A)*A,i=Math.ceil(i/A)*A;else if(A<0)_=Math.ceil(_*A)/A,i=Math.floor(i*A)/A;else break;S=A}return e},e}function zw(){var e=SO();return e.copy=function(){return Y0(e,zw())},bl.apply(e,arguments),rd(e)}function D8(e){var t;function n(s){return s==null||isNaN(s=+s)?t:s}return n.invert=n,n.domain=n.range=function(s){return arguments.length?(e=Array.from(s,Lw),n):e.slice()},n.unknown=function(s){return arguments.length?(t=s,n):t},n.copy=function(){return D8(e).unknown(t)},e=arguments.length?Array.from(e,Lw):[0,1],rd(n)}function k8(e,t){e=e.slice();var n=0,s=e.length-1,h=e[n],m=e[s],_;return m<h&&(_=n,n=s,s=_,_=h,h=m,m=_),e[n]=t.floor(h),e[s]=t.ceil(m),e}function AF(e){return Math.log(e)}function PF(e){return Math.exp(e)}function JTe(e){return-Math.log(-e)}function QTe(e){return-Math.exp(-e)}function eSe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function tSe(e){return e===10?eSe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function rSe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function CF(e){return(t,n)=>-e(-t,n)}function PO(e){const t=e(AF,PF),n=t.domain;let s=10,h,m;function _(){return h=rSe(s),m=tSe(s),n()[0]<0?(h=CF(h),m=CF(m),e(JTe,QTe)):e(AF,PF),t}return t.base=function(i){return arguments.length?(s=+i,_()):s},t.domain=function(i){return arguments.length?(n(i),_()):n()},t.ticks=i=>{const S=n();let A=S[0],I=S[S.length-1];const M=I<A;M&&([A,I]=[I,A]);let L=h(A),z=h(I),G,F;const U=i==null?10:+i;let K=[];if(!(s%1)&&z-L<U){if(L=Math.floor(L),z=Math.ceil(z),A>0){for(;L<=z;++L)for(G=1;G<s;++G)if(F=L<0?G/m(-L):G*m(L),!(F<A)){if(F>I)break;K.push(F)}}else for(;L<=z;++L)for(G=s-1;G>=1;--G)if(F=L>0?G/m(-L):G*m(L),!(F<A)){if(F>I)break;K.push(F)}K.length*2<U&&(K=AC(A,I,U))}else K=AC(L,z,Math.min(z-L,U)).map(m);return M?K.reverse():K},t.tickFormat=(i,S)=>{if(i==null&&(i=10),S==null&&(S=s===10?"s":","),typeof S!="function"&&(!(s%1)&&(S=i0(S)).precision==null&&(S.trim=!0),S=AO(S)),i===1/0)return S;const A=Math.max(1,s*i/t.ticks().length);return I=>{let M=I/m(Math.round(h(I)));return M*s<s-.5&&(M*=s),M<=A?S(I):""}},t.nice=()=>n(k8(n(),{floor:i=>m(Math.floor(h(i))),ceil:i=>m(Math.ceil(h(i)))})),t}function j8(){const e=PO(yS()).domain([1,10]);return e.copy=()=>Y0(e,j8()).base(e.base()),bl.apply(e,arguments),e}function IF(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function MF(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function CO(e){var t=1,n=e(IF(t),MF(t));return n.constant=function(s){return arguments.length?e(IF(t=+s),MF(t)):t},rd(n)}function L8(){var e=CO(yS());return e.copy=function(){return Y0(e,L8()).constant(e.constant())},bl.apply(e,arguments)}function OF(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function nSe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function iSe(e){return e<0?-e*e:e*e}function IO(e){var t=e(ta,ta),n=1;function s(){return n===1?e(ta,ta):n===.5?e(nSe,iSe):e(OF(n),OF(1/n))}return t.exponent=function(h){return arguments.length?(n=+h,s()):n},rd(t)}function MO(){var e=IO(yS());return e.copy=function(){return Y0(e,MO()).exponent(e.exponent())},bl.apply(e,arguments),e}function oSe(){return MO.apply(null,arguments).exponent(.5)}function RF(e){return Math.sign(e)*e*e}function sSe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function N8(){var e=SO(),t=[0,1],n=!1,s;function h(m){var _=sSe(e(m));return isNaN(_)?s:n?Math.round(_):_}return h.invert=function(m){return e.invert(RF(m))},h.domain=function(m){return arguments.length?(e.domain(m),h):e.domain()},h.range=function(m){return arguments.length?(e.range((t=Array.from(m,Lw)).map(RF)),h):t.slice()},h.rangeRound=function(m){return h.range(m).round(!0)},h.round=function(m){return arguments.length?(n=!!m,h):n},h.clamp=function(m){return arguments.length?(e.clamp(m),h):e.clamp()},h.unknown=function(m){return arguments.length?(s=m,h):s},h.copy=function(){return N8(e.domain(),t).round(n).clamp(e.clamp()).unknown(s)},bl.apply(h,arguments),rd(h)}function z8(){var e=[],t=[],n=[],s;function h(){var _=0,i=Math.max(1,t.length);for(n=new Array(i-1);++_<i;)n[_-1]=hTe(e,_/i);return m}function m(_){return _==null||isNaN(_=+_)?s:t[X0(n,_)]}return m.invertExtent=function(_){var i=t.indexOf(_);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]},m.domain=function(_){if(!arguments.length)return e.slice();e=[];for(let i of _)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Uh),h()},m.range=function(_){return arguments.length?(t=Array.from(_),h()):t.slice()},m.unknown=function(_){return arguments.length?(s=_,m):s},m.quantiles=function(){return n.slice()},m.copy=function(){return z8().domain(e).range(t).unknown(s)},bl.apply(m,arguments)}function F8(){var e=0,t=1,n=1,s=[.5],h=[0,1],m;function _(S){return S!=null&&S<=S?h[X0(s,S,0,n)]:m}function i(){var S=-1;for(s=new Array(n);++S<n;)s[S]=((S+1)*t-(S-n)*e)/(n+1);return _}return _.domain=function(S){return arguments.length?([e,t]=S,e=+e,t=+t,i()):[e,t]},_.range=function(S){return arguments.length?(n=(h=Array.from(S)).length-1,i()):h.slice()},_.invertExtent=function(S){var A=h.indexOf(S);return A<0?[NaN,NaN]:A<1?[e,s[0]]:A>=n?[s[n-1],t]:[s[A-1],s[A]]},_.unknown=function(S){return arguments.length&&(m=S),_},_.thresholds=function(){return s.slice()},_.copy=function(){return F8().domain([e,t]).range(h).unknown(m)},bl.apply(rd(_),arguments)}function B8(){var e=[.5],t=[0,1],n,s=1;function h(m){return m!=null&&m<=m?t[X0(e,m,0,s)]:n}return h.domain=function(m){return arguments.length?(e=Array.from(m),s=Math.min(e.length,t.length-1),h):e.slice()},h.range=function(m){return arguments.length?(t=Array.from(m),s=Math.min(e.length,t.length-1),h):t.slice()},h.invertExtent=function(m){var _=t.indexOf(m);return[e[_-1],e[_]]},h.unknown=function(m){return arguments.length?(n=m,h):n},h.copy=function(){return B8().domain(e).range(t).unknown(n)},bl.apply(h,arguments)}const VA=new Date,$A=new Date;function hs(e,t,n,s){function h(m){return e(m=arguments.length===0?new Date:new Date(+m)),m}return h.floor=m=>(e(m=new Date(+m)),m),h.ceil=m=>(e(m=new Date(m-1)),t(m,1),e(m),m),h.round=m=>{const _=h(m),i=h.ceil(m);return m-_<i-m?_:i},h.offset=(m,_)=>(t(m=new Date(+m),_==null?1:Math.floor(_)),m),h.range=(m,_,i)=>{const S=[];if(m=h.ceil(m),i=i==null?1:Math.floor(i),!(m<_)||!(i>0))return S;let A;do S.push(A=new Date(+m)),t(m,i),e(m);while(A<m&&m<_);return S},h.filter=m=>hs(_=>{if(_>=_)for(;e(_),!m(_);)_.setTime(_-1)},(_,i)=>{if(_>=_)if(i<0)for(;++i<=0;)for(;t(_,-1),!m(_););else for(;--i>=0;)for(;t(_,1),!m(_););}),n&&(h.count=(m,_)=>(VA.setTime(+m),$A.setTime(+_),e(VA),e($A),Math.floor(n(VA,$A))),h.every=m=>(m=Math.floor(m),!isFinite(m)||!(m>0)?null:m>1?h.filter(s?_=>s(_)%m===0:_=>h.count(0,_)%m===0):h)),h}const Fw=hs(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Fw.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?hs(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Fw);Fw.range;const Cu=1e3,pl=Cu*60,Iu=pl*60,$u=Iu*24,OO=$u*7,DF=$u*30,UA=$u*365,mf=hs(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Cu)},(e,t)=>(t-e)/Cu,e=>e.getUTCSeconds());mf.range;const RO=hs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Cu)},(e,t)=>{e.setTime(+e+t*pl)},(e,t)=>(t-e)/pl,e=>e.getMinutes());RO.range;const DO=hs(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*pl)},(e,t)=>(t-e)/pl,e=>e.getUTCMinutes());DO.range;const kO=hs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Cu-e.getMinutes()*pl)},(e,t)=>{e.setTime(+e+t*Iu)},(e,t)=>(t-e)/Iu,e=>e.getHours());kO.range;const jO=hs(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Iu)},(e,t)=>(t-e)/Iu,e=>e.getUTCHours());jO.range;const J0=hs(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*pl)/$u,e=>e.getDate()-1);J0.range;const _S=hs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/$u,e=>e.getUTCDate()-1);_S.range;const V8=hs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/$u,e=>Math.floor(e/$u));V8.range;function zf(e){return hs(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*pl)/OO)}const vS=zf(0),Bw=zf(1),aSe=zf(2),lSe=zf(3),_g=zf(4),cSe=zf(5),uSe=zf(6);vS.range;Bw.range;aSe.range;lSe.range;_g.range;cSe.range;uSe.range;function Ff(e){return hs(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/OO)}const xS=Ff(0),Vw=Ff(1),hSe=Ff(2),dSe=Ff(3),vg=Ff(4),fSe=Ff(5),pSe=Ff(6);xS.range;Vw.range;hSe.range;dSe.range;vg.range;fSe.range;pSe.range;const LO=hs(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());LO.range;const NO=hs(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());NO.range;const Uu=hs(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Uu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:hs(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Uu.range;const Gu=hs(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Gu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:hs(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Gu.range;function $8(e,t,n,s,h,m){const _=[[mf,1,Cu],[mf,5,5*Cu],[mf,15,15*Cu],[mf,30,30*Cu],[m,1,pl],[m,5,5*pl],[m,15,15*pl],[m,30,30*pl],[h,1,Iu],[h,3,3*Iu],[h,6,6*Iu],[h,12,12*Iu],[s,1,$u],[s,2,2*$u],[n,1,OO],[t,1,DF],[t,3,3*DF],[e,1,UA]];function i(A,I,M){const L=I<A;L&&([A,I]=[I,A]);const z=M&&typeof M.range=="function"?M:S(A,I,M),G=z?z.range(A,+I+1):[];return L?G.reverse():G}function S(A,I,M){const L=Math.abs(I-A)/M,z=vO(([,,U])=>U).right(_,L);if(z===_.length)return e.every(CC(A/UA,I/UA,M));if(z===0)return Fw.every(Math.max(CC(A,I,M),1));const[G,F]=_[L/_[z-1][2]<_[z][2]/L?z-1:z];return G.every(F)}return[i,S]}const[mSe,gSe]=$8(Gu,NO,xS,V8,jO,DO),[ySe,_Se]=$8(Uu,LO,vS,J0,kO,RO);function GA(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function HA(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function dv(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function vSe(e){var t=e.dateTime,n=e.date,s=e.time,h=e.periods,m=e.days,_=e.shortDays,i=e.months,S=e.shortMonths,A=fv(h),I=pv(h),M=fv(m),L=pv(m),z=fv(_),G=pv(_),F=fv(i),U=pv(i),K=fv(S),J=pv(S),X={a:qe,A:ut,b:nt,B:Kt,c:null,d:FF,e:FF,f:$Se,g:JSe,G:e2e,H:FSe,I:BSe,j:VSe,L:U8,m:USe,M:GSe,p:cr,q:Bt,Q:$F,s:UF,S:HSe,u:WSe,U:qSe,V:ZSe,w:XSe,W:KSe,x:null,X:null,y:YSe,Y:QSe,Z:t2e,"%":VF},ie={a:Vt,A:xr,b:nn,B:Hn,c:null,d:BF,e:BF,f:o2e,g:m2e,G:y2e,H:r2e,I:n2e,j:i2e,L:H8,m:s2e,M:a2e,p:lr,q:an,Q:$F,s:UF,S:l2e,u:c2e,U:u2e,V:h2e,w:d2e,W:f2e,x:null,X:null,y:p2e,Y:g2e,Z:_2e,"%":VF},Q={a:tt,A:Be,b:Ge,B:Qe,c:Ke,d:NF,e:NF,f:jSe,g:LF,G:jF,H:zF,I:zF,j:OSe,L:kSe,m:MSe,M:RSe,p:Fe,q:ISe,Q:NSe,s:zSe,S:DSe,u:SSe,U:ESe,V:ASe,w:TSe,W:PSe,x:ct,X:He,y:LF,Y:jF,Z:CSe,"%":LSe};X.x=ae(n,X),X.X=ae(s,X),X.c=ae(t,X),ie.x=ae(n,ie),ie.X=ae(s,ie),ie.c=ae(t,ie);function ae(Lt,nr){return function(pr){var Nt=[],Nr=-1,un=0,ci=Lt.length,Un,zn,Kn;for(pr instanceof Date||(pr=new Date(+pr));++Nr<ci;)Lt.charCodeAt(Nr)===37&&(Nt.push(Lt.slice(un,Nr)),(zn=kF[Un=Lt.charAt(++Nr)])!=null?Un=Lt.charAt(++Nr):zn=Un==="e"?" ":"0",(Kn=nr[Un])&&(Un=Kn(pr,zn)),Nt.push(Un),un=Nr+1);return Nt.push(Lt.slice(un,Nr)),Nt.join("")}}function pe(Lt,nr){return function(pr){var Nt=dv(1900,void 0,1),Nr=Pe(Nt,Lt,pr+="",0),un,ci;if(Nr!=pr.length)return null;if("Q"in Nt)return new Date(Nt.Q);if("s"in Nt)return new Date(Nt.s*1e3+("L"in Nt?Nt.L:0));if(nr&&!("Z"in Nt)&&(Nt.Z=0),"p"in Nt&&(Nt.H=Nt.H%12+Nt.p*12),Nt.m===void 0&&(Nt.m="q"in Nt?Nt.q:0),"V"in Nt){if(Nt.V<1||Nt.V>53)return null;"w"in Nt||(Nt.w=1),"Z"in Nt?(un=HA(dv(Nt.y,0,1)),ci=un.getUTCDay(),un=ci>4||ci===0?Vw.ceil(un):Vw(un),un=_S.offset(un,(Nt.V-1)*7),Nt.y=un.getUTCFullYear(),Nt.m=un.getUTCMonth(),Nt.d=un.getUTCDate()+(Nt.w+6)%7):(un=GA(dv(Nt.y,0,1)),ci=un.getDay(),un=ci>4||ci===0?Bw.ceil(un):Bw(un),un=J0.offset(un,(Nt.V-1)*7),Nt.y=un.getFullYear(),Nt.m=un.getMonth(),Nt.d=un.getDate()+(Nt.w+6)%7)}else("W"in Nt||"U"in Nt)&&("w"in Nt||(Nt.w="u"in Nt?Nt.u%7:"W"in Nt?1:0),ci="Z"in Nt?HA(dv(Nt.y,0,1)).getUTCDay():GA(dv(Nt.y,0,1)).getDay(),Nt.m=0,Nt.d="W"in Nt?(Nt.w+6)%7+Nt.W*7-(ci+5)%7:Nt.w+Nt.U*7-(ci+6)%7);return"Z"in Nt?(Nt.H+=Nt.Z/100|0,Nt.M+=Nt.Z%100,HA(Nt)):GA(Nt)}}function Pe(Lt,nr,pr,Nt){for(var Nr=0,un=nr.length,ci=pr.length,Un,zn;Nr<un;){if(Nt>=ci)return-1;if(Un=nr.charCodeAt(Nr++),Un===37){if(Un=nr.charAt(Nr++),zn=Q[Un in kF?nr.charAt(Nr++):Un],!zn||(Nt=zn(Lt,pr,Nt))<0)return-1}else if(Un!=pr.charCodeAt(Nt++))return-1}return Nt}function Fe(Lt,nr,pr){var Nt=A.exec(nr.slice(pr));return Nt?(Lt.p=I.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function tt(Lt,nr,pr){var Nt=z.exec(nr.slice(pr));return Nt?(Lt.w=G.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Be(Lt,nr,pr){var Nt=M.exec(nr.slice(pr));return Nt?(Lt.w=L.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Ge(Lt,nr,pr){var Nt=K.exec(nr.slice(pr));return Nt?(Lt.m=J.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Qe(Lt,nr,pr){var Nt=F.exec(nr.slice(pr));return Nt?(Lt.m=U.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Ke(Lt,nr,pr){return Pe(Lt,t,nr,pr)}function ct(Lt,nr,pr){return Pe(Lt,n,nr,pr)}function He(Lt,nr,pr){return Pe(Lt,s,nr,pr)}function qe(Lt){return _[Lt.getDay()]}function ut(Lt){return m[Lt.getDay()]}function nt(Lt){return S[Lt.getMonth()]}function Kt(Lt){return i[Lt.getMonth()]}function cr(Lt){return h[+(Lt.getHours()>=12)]}function Bt(Lt){return 1+~~(Lt.getMonth()/3)}function Vt(Lt){return _[Lt.getUTCDay()]}function xr(Lt){return m[Lt.getUTCDay()]}function nn(Lt){return S[Lt.getUTCMonth()]}function Hn(Lt){return i[Lt.getUTCMonth()]}function lr(Lt){return h[+(Lt.getUTCHours()>=12)]}function an(Lt){return 1+~~(Lt.getUTCMonth()/3)}return{format:function(Lt){var nr=ae(Lt+="",X);return nr.toString=function(){return Lt},nr},parse:function(Lt){var nr=pe(Lt+="",!1);return nr.toString=function(){return Lt},nr},utcFormat:function(Lt){var nr=ae(Lt+="",ie);return nr.toString=function(){return Lt},nr},utcParse:function(Lt){var nr=pe(Lt+="",!0);return nr.toString=function(){return Lt},nr}}}var kF={"-":"",_:" ",0:"0"},ws=/^\s*\d+/,xSe=/^%/,bSe=/[\\^$*+?|[\]().{}]/g;function ji(e,t,n){var s=e<0?"-":"",h=(s?-e:e)+"",m=h.length;return s+(m<n?new Array(n-m+1).join(t)+h:h)}function wSe(e){return e.replace(bSe,"\\$&")}function fv(e){return new RegExp("^(?:"+e.map(wSe).join("|")+")","i")}function pv(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function TSe(e,t,n){var s=ws.exec(t.slice(n,n+1));return s?(e.w=+s[0],n+s[0].length):-1}function SSe(e,t,n){var s=ws.exec(t.slice(n,n+1));return s?(e.u=+s[0],n+s[0].length):-1}function ESe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.U=+s[0],n+s[0].length):-1}function ASe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.V=+s[0],n+s[0].length):-1}function PSe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.W=+s[0],n+s[0].length):-1}function jF(e,t,n){var s=ws.exec(t.slice(n,n+4));return s?(e.y=+s[0],n+s[0].length):-1}function LF(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.y=+s[0]+(+s[0]>68?1900:2e3),n+s[0].length):-1}function CSe(e,t,n){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return s?(e.Z=s[1]?0:-(s[2]+(s[3]||"00")),n+s[0].length):-1}function ISe(e,t,n){var s=ws.exec(t.slice(n,n+1));return s?(e.q=s[0]*3-3,n+s[0].length):-1}function MSe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.m=s[0]-1,n+s[0].length):-1}function NF(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.d=+s[0],n+s[0].length):-1}function OSe(e,t,n){var s=ws.exec(t.slice(n,n+3));return s?(e.m=0,e.d=+s[0],n+s[0].length):-1}function zF(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.H=+s[0],n+s[0].length):-1}function RSe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.M=+s[0],n+s[0].length):-1}function DSe(e,t,n){var s=ws.exec(t.slice(n,n+2));return s?(e.S=+s[0],n+s[0].length):-1}function kSe(e,t,n){var s=ws.exec(t.slice(n,n+3));return s?(e.L=+s[0],n+s[0].length):-1}function jSe(e,t,n){var s=ws.exec(t.slice(n,n+6));return s?(e.L=Math.floor(s[0]/1e3),n+s[0].length):-1}function LSe(e,t,n){var s=xSe.exec(t.slice(n,n+1));return s?n+s[0].length:-1}function NSe(e,t,n){var s=ws.exec(t.slice(n));return s?(e.Q=+s[0],n+s[0].length):-1}function zSe(e,t,n){var s=ws.exec(t.slice(n));return s?(e.s=+s[0],n+s[0].length):-1}function FF(e,t){return ji(e.getDate(),t,2)}function FSe(e,t){return ji(e.getHours(),t,2)}function BSe(e,t){return ji(e.getHours()%12||12,t,2)}function VSe(e,t){return ji(1+J0.count(Uu(e),e),t,3)}function U8(e,t){return ji(e.getMilliseconds(),t,3)}function $Se(e,t){return U8(e,t)+"000"}function USe(e,t){return ji(e.getMonth()+1,t,2)}function GSe(e,t){return ji(e.getMinutes(),t,2)}function HSe(e,t){return ji(e.getSeconds(),t,2)}function WSe(e){var t=e.getDay();return t===0?7:t}function qSe(e,t){return ji(vS.count(Uu(e)-1,e),t,2)}function G8(e){var t=e.getDay();return t>=4||t===0?_g(e):_g.ceil(e)}function ZSe(e,t){return e=G8(e),ji(_g.count(Uu(e),e)+(Uu(e).getDay()===4),t,2)}function XSe(e){return e.getDay()}function KSe(e,t){return ji(Bw.count(Uu(e)-1,e),t,2)}function YSe(e,t){return ji(e.getFullYear()%100,t,2)}function JSe(e,t){return e=G8(e),ji(e.getFullYear()%100,t,2)}function QSe(e,t){return ji(e.getFullYear()%1e4,t,4)}function e2e(e,t){var n=e.getDay();return e=n>=4||n===0?_g(e):_g.ceil(e),ji(e.getFullYear()%1e4,t,4)}function t2e(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ji(t/60|0,"0",2)+ji(t%60,"0",2)}function BF(e,t){return ji(e.getUTCDate(),t,2)}function r2e(e,t){return ji(e.getUTCHours(),t,2)}function n2e(e,t){return ji(e.getUTCHours()%12||12,t,2)}function i2e(e,t){return ji(1+_S.count(Gu(e),e),t,3)}function H8(e,t){return ji(e.getUTCMilliseconds(),t,3)}function o2e(e,t){return H8(e,t)+"000"}function s2e(e,t){return ji(e.getUTCMonth()+1,t,2)}function a2e(e,t){return ji(e.getUTCMinutes(),t,2)}function l2e(e,t){return ji(e.getUTCSeconds(),t,2)}function c2e(e){var t=e.getUTCDay();return t===0?7:t}function u2e(e,t){return ji(xS.count(Gu(e)-1,e),t,2)}function W8(e){var t=e.getUTCDay();return t>=4||t===0?vg(e):vg.ceil(e)}function h2e(e,t){return e=W8(e),ji(vg.count(Gu(e),e)+(Gu(e).getUTCDay()===4),t,2)}function d2e(e){return e.getUTCDay()}function f2e(e,t){return ji(Vw.count(Gu(e)-1,e),t,2)}function p2e(e,t){return ji(e.getUTCFullYear()%100,t,2)}function m2e(e,t){return e=W8(e),ji(e.getUTCFullYear()%100,t,2)}function g2e(e,t){return ji(e.getUTCFullYear()%1e4,t,4)}function y2e(e,t){var n=e.getUTCDay();return e=n>=4||n===0?vg(e):vg.ceil(e),ji(e.getUTCFullYear()%1e4,t,4)}function _2e(){return"+0000"}function VF(){return"%"}function $F(e){return+e}function UF(e){return Math.floor(+e/1e3)}var km,q8,Z8;v2e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function v2e(e){return km=vSe(e),q8=km.format,km.parse,Z8=km.utcFormat,km.utcParse,km}function x2e(e){return new Date(e)}function b2e(e){return e instanceof Date?+e:+new Date(+e)}function zO(e,t,n,s,h,m,_,i,S,A){var I=SO(),M=I.invert,L=I.domain,z=A(".%L"),G=A(":%S"),F=A("%I:%M"),U=A("%I %p"),K=A("%a %d"),J=A("%b %d"),X=A("%B"),ie=A("%Y");function Q(ae){return(S(ae)<ae?z:i(ae)<ae?G:_(ae)<ae?F:m(ae)<ae?U:s(ae)<ae?h(ae)<ae?K:J:n(ae)<ae?X:ie)(ae)}return I.invert=function(ae){return new Date(M(ae))},I.domain=function(ae){return arguments.length?L(Array.from(ae,b2e)):L().map(x2e)},I.ticks=function(ae){var pe=L();return e(pe[0],pe[pe.length-1],ae??10)},I.tickFormat=function(ae,pe){return pe==null?Q:A(pe)},I.nice=function(ae){var pe=L();return(!ae||typeof ae.range!="function")&&(ae=t(pe[0],pe[pe.length-1],ae??10)),ae?L(k8(pe,ae)):I},I.copy=function(){return Y0(I,zO(e,t,n,s,h,m,_,i,S,A))},I}function w2e(){return bl.apply(zO(ySe,_Se,Uu,LO,vS,J0,kO,RO,mf,q8).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function T2e(){return bl.apply(zO(mSe,gSe,Gu,NO,xS,_S,jO,DO,mf,Z8).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function bS(){var e=0,t=1,n,s,h,m,_=ta,i=!1,S;function A(M){return M==null||isNaN(M=+M)?S:_(h===0?.5:(M=(m(M)-n)*h,i?Math.max(0,Math.min(1,M)):M))}A.domain=function(M){return arguments.length?([e,t]=M,n=m(e=+e),s=m(t=+t),h=n===s?0:1/(s-n),A):[e,t]},A.clamp=function(M){return arguments.length?(i=!!M,A):i},A.interpolator=function(M){return arguments.length?(_=M,A):_};function I(M){return function(L){var z,G;return arguments.length?([z,G]=L,_=M(z,G),A):[_(0),_(1)]}}return A.range=I(ry),A.rangeRound=I(TO),A.unknown=function(M){return arguments.length?(S=M,A):S},function(M){return m=M,n=M(e),s=M(t),h=n===s?0:1/(s-n),A}}function nd(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function X8(){var e=rd(bS()(ta));return e.copy=function(){return nd(e,X8())},Ku.apply(e,arguments)}function K8(){var e=PO(bS()).domain([1,10]);return e.copy=function(){return nd(e,K8()).base(e.base())},Ku.apply(e,arguments)}function Y8(){var e=CO(bS());return e.copy=function(){return nd(e,Y8()).constant(e.constant())},Ku.apply(e,arguments)}function FO(){var e=IO(bS());return e.copy=function(){return nd(e,FO()).exponent(e.exponent())},Ku.apply(e,arguments)}function S2e(){return FO.apply(null,arguments).exponent(.5)}function J8(){var e=[],t=ta;function n(s){if(s!=null&&!isNaN(s=+s))return t((X0(e,s,1)-1)/(e.length-1))}return n.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let h of s)h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(Uh),n},n.interpolator=function(s){return arguments.length?(t=s,n):t},n.range=function(){return e.map((s,h)=>t(h/(e.length-1)))},n.quantiles=function(s){return Array.from({length:s+1},(h,m)=>uTe(e,m/s))},n.copy=function(){return J8(t).domain(e)},Ku.apply(n,arguments)}function wS(){var e=0,t=.5,n=1,s=1,h,m,_,i,S,A=ta,I,M=!1,L;function z(F){return isNaN(F=+F)?L:(F=.5+((F=+I(F))-m)*(s*F<s*m?i:S),A(M?Math.max(0,Math.min(1,F)):F))}z.domain=function(F){return arguments.length?([e,t,n]=F,h=I(e=+e),m=I(t=+t),_=I(n=+n),i=h===m?0:.5/(m-h),S=m===_?0:.5/(_-m),s=m<h?-1:1,z):[e,t,n]},z.clamp=function(F){return arguments.length?(M=!!F,z):M},z.interpolator=function(F){return arguments.length?(A=F,z):A};function G(F){return function(U){var K,J,X;return arguments.length?([K,J,X]=U,A=LTe(F,[K,J,X]),z):[A(0),A(.5),A(1)]}}return z.range=G(ry),z.rangeRound=G(TO),z.unknown=function(F){return arguments.length?(L=F,z):L},function(F){return I=F,h=F(e),m=F(t),_=F(n),i=h===m?0:.5/(m-h),S=m===_?0:.5/(_-m),s=m<h?-1:1,z}}function Q8(){var e=rd(wS()(ta));return e.copy=function(){return nd(e,Q8())},Ku.apply(e,arguments)}function eG(){var e=PO(wS()).domain([.1,1,10]);return e.copy=function(){return nd(e,eG()).base(e.base())},Ku.apply(e,arguments)}function tG(){var e=CO(wS());return e.copy=function(){return nd(e,tG()).constant(e.constant())},Ku.apply(e,arguments)}function BO(){var e=IO(wS());return e.copy=function(){return nd(e,BO()).exponent(e.exponent())},Ku.apply(e,arguments)}function E2e(){return BO.apply(null,arguments).exponent(.5)}const GF=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:e0,scaleDiverging:Q8,scaleDivergingLog:eG,scaleDivergingPow:BO,scaleDivergingSqrt:E2e,scaleDivergingSymlog:tG,scaleIdentity:D8,scaleImplicit:IC,scaleLinear:zw,scaleLog:j8,scaleOrdinal:xO,scalePoint:Dv,scalePow:MO,scaleQuantile:z8,scaleQuantize:F8,scaleRadial:N8,scaleSequential:X8,scaleSequentialLog:K8,scaleSequentialPow:FO,scaleSequentialQuantile:J8,scaleSequentialSqrt:S2e,scaleSequentialSymlog:Y8,scaleSqrt:oSe,scaleSymlog:L8,scaleThreshold:B8,scaleTime:w2e,scaleUtc:T2e,tickFormat:R8},Symbol.toStringTag,{value:"Module"}));var A2e=Zg;function P2e(e,t,n){for(var s=-1,h=e.length;++s<h;){var m=e[s],_=t(m);if(_!=null&&(i===void 0?_===_&&!A2e(_):n(_,i)))var i=_,S=m}return S}var rG=P2e;function C2e(e,t){return e>t}var I2e=C2e,M2e=rG,O2e=I2e,R2e=ty;function D2e(e){return e&&e.length?M2e(e,R2e,O2e):void 0}var k2e=D2e;const TS=Bi(k2e);function j2e(e,t){return e<t}var L2e=j2e,N2e=rG,z2e=L2e,F2e=ty;function B2e(e){return e&&e.length?N2e(e,F2e,z2e):void 0}var V2e=B2e;const SS=Bi(V2e);var $2e=eO,U2e=td,G2e=u8,H2e=xa;function W2e(e,t){var n=H2e(e)?$2e:G2e;return n(e,U2e(t))}var q2e=W2e,Z2e=l8,X2e=q2e;function K2e(e,t){return Z2e(X2e(e,t),1)}var Y2e=K2e;const J2e=Bi(Y2e);var Q2e=mO;function eEe(e,t){return Q2e(e,t)}var tEe=eEe;const ES=Bi(tEe);var ny=1e9,rEe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},$O,xo=!0,vl="[DecimalError] ",bf=vl+"Invalid argument: ",VO=vl+"Exponent out of range: ",iy=Math.floor,cf=Math.pow,nEe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fa,bs=1e7,po=7,nG=9007199254740991,$w=iy(nG/po),Hr={};Hr.absoluteValue=Hr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Hr.comparedTo=Hr.cmp=function(e){var t,n,s,h,m=this;if(e=new m.constructor(e),m.s!==e.s)return m.s||-e.s;if(m.e!==e.e)return m.e>e.e^m.s<0?1:-1;for(s=m.d.length,h=e.d.length,t=0,n=s<h?s:h;t<n;++t)if(m.d[t]!==e.d[t])return m.d[t]>e.d[t]^m.s<0?1:-1;return s===h?0:s>h^m.s<0?1:-1};Hr.decimalPlaces=Hr.dp=function(){var e=this,t=e.d.length-1,n=(t-e.e)*po;if(t=e.d[t],t)for(;t%10==0;t/=10)n--;return n<0?0:n};Hr.dividedBy=Hr.div=function(e){return Nu(this,new this.constructor(e))};Hr.dividedToIntegerBy=Hr.idiv=function(e){var t=this,n=t.constructor;return Qi(Nu(t,new n(e),0,1),n.precision)};Hr.equals=Hr.eq=function(e){return!this.cmp(e)};Hr.exponent=function(){return Ko(this)};Hr.greaterThan=Hr.gt=function(e){return this.cmp(e)>0};Hr.greaterThanOrEqualTo=Hr.gte=function(e){return this.cmp(e)>=0};Hr.isInteger=Hr.isint=function(){return this.e>this.d.length-2};Hr.isNegative=Hr.isneg=function(){return this.s<0};Hr.isPositive=Hr.ispos=function(){return this.s>0};Hr.isZero=function(){return this.s===0};Hr.lessThan=Hr.lt=function(e){return this.cmp(e)<0};Hr.lessThanOrEqualTo=Hr.lte=function(e){return this.cmp(e)<1};Hr.logarithm=Hr.log=function(e){var t,n=this,s=n.constructor,h=s.precision,m=h+5;if(e===void 0)e=new s(10);else if(e=new s(e),e.s<1||e.eq(Fa))throw Error(vl+"NaN");if(n.s<1)throw Error(vl+(n.s?"NaN":"-Infinity"));return n.eq(Fa)?new s(0):(xo=!1,t=Nu(o0(n,m),o0(e,m),m),xo=!0,Qi(t,h))};Hr.minus=Hr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?sG(t,e):iG(t,(e.s=-e.s,e))};Hr.modulo=Hr.mod=function(e){var t,n=this,s=n.constructor,h=s.precision;if(e=new s(e),!e.s)throw Error(vl+"NaN");return n.s?(xo=!1,t=Nu(n,e,0,1).times(e),xo=!0,n.minus(t)):Qi(new s(n),h)};Hr.naturalExponential=Hr.exp=function(){return oG(this)};Hr.naturalLogarithm=Hr.ln=function(){return o0(this)};Hr.negated=Hr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Hr.plus=Hr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?iG(t,e):sG(t,(e.s=-e.s,e))};Hr.precision=Hr.sd=function(e){var t,n,s,h=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(bf+e);if(t=Ko(h)+1,s=h.d.length-1,n=s*po+1,s=h.d[s],s){for(;s%10==0;s/=10)n--;for(s=h.d[0];s>=10;s/=10)n++}return e&&t>n?t:n};Hr.squareRoot=Hr.sqrt=function(){var e,t,n,s,h,m,_,i=this,S=i.constructor;if(i.s<1){if(!i.s)return new S(0);throw Error(vl+"NaN")}for(e=Ko(i),xo=!1,h=Math.sqrt(+i),h==0||h==1/0?(t=Fc(i.d),(t.length+e)%2==0&&(t+="0"),h=Math.sqrt(t),e=iy((e+1)/2)-(e<0||e%2),h==1/0?t="5e"+e:(t=h.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),s=new S(t)):s=new S(h.toString()),n=S.precision,h=_=n+3;;)if(m=s,s=m.plus(Nu(i,m,_+2)).times(.5),Fc(m.d).slice(0,_)===(t=Fc(s.d)).slice(0,_)){if(t=t.slice(_-3,_+1),h==_&&t=="4999"){if(Qi(m,n+1,0),m.times(m).eq(i)){s=m;break}}else if(t!="9999")break;_+=4}return xo=!0,Qi(s,n)};Hr.times=Hr.mul=function(e){var t,n,s,h,m,_,i,S,A,I=this,M=I.constructor,L=I.d,z=(e=new M(e)).d;if(!I.s||!e.s)return new M(0);for(e.s*=I.s,n=I.e+e.e,S=L.length,A=z.length,S<A&&(m=L,L=z,z=m,_=S,S=A,A=_),m=[],_=S+A,s=_;s--;)m.push(0);for(s=A;--s>=0;){for(t=0,h=S+s;h>s;)i=m[h]+z[s]*L[h-s-1]+t,m[h--]=i%bs|0,t=i/bs|0;m[h]=(m[h]+t)%bs|0}for(;!m[--_];)m.pop();return t?++n:m.shift(),e.d=m,e.e=n,xo?Qi(e,M.precision):e};Hr.toDecimalPlaces=Hr.todp=function(e,t){var n=this,s=n.constructor;return n=new s(n),e===void 0?n:(Yc(e,0,ny),t===void 0?t=s.rounding:Yc(t,0,8),Qi(n,e+Ko(n)+1,t))};Hr.toExponential=function(e,t){var n,s=this,h=s.constructor;return e===void 0?n=Mf(s,!0):(Yc(e,0,ny),t===void 0?t=h.rounding:Yc(t,0,8),s=Qi(new h(s),e+1,t),n=Mf(s,!0,e+1)),n};Hr.toFixed=function(e,t){var n,s,h=this,m=h.constructor;return e===void 0?Mf(h):(Yc(e,0,ny),t===void 0?t=m.rounding:Yc(t,0,8),s=Qi(new m(h),e+Ko(h)+1,t),n=Mf(s.abs(),!1,e+Ko(s)+1),h.isneg()&&!h.isZero()?"-"+n:n)};Hr.toInteger=Hr.toint=function(){var e=this,t=e.constructor;return Qi(new t(e),Ko(e)+1,t.rounding)};Hr.toNumber=function(){return+this};Hr.toPower=Hr.pow=function(e){var t,n,s,h,m,_,i=this,S=i.constructor,A=12,I=+(e=new S(e));if(!e.s)return new S(Fa);if(i=new S(i),!i.s){if(e.s<1)throw Error(vl+"Infinity");return i}if(i.eq(Fa))return i;if(s=S.precision,e.eq(Fa))return Qi(i,s);if(t=e.e,n=e.d.length-1,_=t>=n,m=i.s,_){if((n=I<0?-I:I)<=nG){for(h=new S(Fa),t=Math.ceil(s/po+4),xo=!1;n%2&&(h=h.times(i),WF(h.d,t)),n=iy(n/2),n!==0;)i=i.times(i),WF(i.d,t);return xo=!0,e.s<0?new S(Fa).div(h):Qi(h,s)}}else if(m<0)throw Error(vl+"NaN");return m=m<0&&e.d[Math.max(t,n)]&1?-1:1,i.s=1,xo=!1,h=e.times(o0(i,s+A)),xo=!0,h=oG(h),h.s=m,h};Hr.toPrecision=function(e,t){var n,s,h=this,m=h.constructor;return e===void 0?(n=Ko(h),s=Mf(h,n<=m.toExpNeg||n>=m.toExpPos)):(Yc(e,1,ny),t===void 0?t=m.rounding:Yc(t,0,8),h=Qi(new m(h),e,t),n=Ko(h),s=Mf(h,e<=n||n<=m.toExpNeg,e)),s};Hr.toSignificantDigits=Hr.tosd=function(e,t){var n=this,s=n.constructor;return e===void 0?(e=s.precision,t=s.rounding):(Yc(e,1,ny),t===void 0?t=s.rounding:Yc(t,0,8)),Qi(new s(n),e,t)};Hr.toString=Hr.valueOf=Hr.val=Hr.toJSON=Hr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Ko(e),n=e.constructor;return Mf(e,t<=n.toExpNeg||t>=n.toExpPos)};function iG(e,t){var n,s,h,m,_,i,S,A,I=e.constructor,M=I.precision;if(!e.s||!t.s)return t.s||(t=new I(e)),xo?Qi(t,M):t;if(S=e.d,A=t.d,_=e.e,h=t.e,S=S.slice(),m=_-h,m){for(m<0?(s=S,m=-m,i=A.length):(s=A,h=_,i=S.length),_=Math.ceil(M/po),i=_>i?_+1:i+1,m>i&&(m=i,s.length=1),s.reverse();m--;)s.push(0);s.reverse()}for(i=S.length,m=A.length,i-m<0&&(m=i,s=A,A=S,S=s),n=0;m;)n=(S[--m]=S[m]+A[m]+n)/bs|0,S[m]%=bs;for(n&&(S.unshift(n),++h),i=S.length;S[--i]==0;)S.pop();return t.d=S,t.e=h,xo?Qi(t,M):t}function Yc(e,t,n){if(e!==~~e||e<t||e>n)throw Error(bf+e)}function Fc(e){var t,n,s,h=e.length-1,m="",_=e[0];if(h>0){for(m+=_,t=1;t<h;t++)s=e[t]+"",n=po-s.length,n&&(m+=Lh(n)),m+=s;_=e[t],s=_+"",n=po-s.length,n&&(m+=Lh(n))}else if(_===0)return"0";for(;_%10===0;)_/=10;return m+_}var Nu=function(){function e(s,h){var m,_=0,i=s.length;for(s=s.slice();i--;)m=s[i]*h+_,s[i]=m%bs|0,_=m/bs|0;return _&&s.unshift(_),s}function t(s,h,m,_){var i,S;if(m!=_)S=m>_?1:-1;else for(i=S=0;i<m;i++)if(s[i]!=h[i]){S=s[i]>h[i]?1:-1;break}return S}function n(s,h,m){for(var _=0;m--;)s[m]-=_,_=s[m]<h[m]?1:0,s[m]=_*bs+s[m]-h[m];for(;!s[0]&&s.length>1;)s.shift()}return function(s,h,m,_){var i,S,A,I,M,L,z,G,F,U,K,J,X,ie,Q,ae,pe,Pe,Fe=s.constructor,tt=s.s==h.s?1:-1,Be=s.d,Ge=h.d;if(!s.s)return new Fe(s);if(!h.s)throw Error(vl+"Division by zero");for(S=s.e-h.e,pe=Ge.length,Q=Be.length,z=new Fe(tt),G=z.d=[],A=0;Ge[A]==(Be[A]||0);)++A;if(Ge[A]>(Be[A]||0)&&--S,m==null?J=m=Fe.precision:_?J=m+(Ko(s)-Ko(h))+1:J=m,J<0)return new Fe(0);if(J=J/po+2|0,A=0,pe==1)for(I=0,Ge=Ge[0],J++;(A<Q||I)&&J--;A++)X=I*bs+(Be[A]||0),G[A]=X/Ge|0,I=X%Ge|0;else{for(I=bs/(Ge[0]+1)|0,I>1&&(Ge=e(Ge,I),Be=e(Be,I),pe=Ge.length,Q=Be.length),ie=pe,F=Be.slice(0,pe),U=F.length;U<pe;)F[U++]=0;Pe=Ge.slice(),Pe.unshift(0),ae=Ge[0],Ge[1]>=bs/2&&++ae;do I=0,i=t(Ge,F,pe,U),i<0?(K=F[0],pe!=U&&(K=K*bs+(F[1]||0)),I=K/ae|0,I>1?(I>=bs&&(I=bs-1),M=e(Ge,I),L=M.length,U=F.length,i=t(M,F,L,U),i==1&&(I--,n(M,pe<L?Pe:Ge,L))):(I==0&&(i=I=1),M=Ge.slice()),L=M.length,L<U&&M.unshift(0),n(F,M,U),i==-1&&(U=F.length,i=t(Ge,F,pe,U),i<1&&(I++,n(F,pe<U?Pe:Ge,U))),U=F.length):i===0&&(I++,F=[0]),G[A++]=I,i&&F[0]?F[U++]=Be[ie]||0:(F=[Be[ie]],U=1);while((ie++<Q||F[0]!==void 0)&&J--)}return G[0]||G.shift(),z.e=S,Qi(z,_?m+Ko(z)+1:m)}}();function oG(e,t){var n,s,h,m,_,i,S=0,A=0,I=e.constructor,M=I.precision;if(Ko(e)>16)throw Error(VO+Ko(e));if(!e.s)return new I(Fa);for(t==null?(xo=!1,i=M):i=t,_=new I(.03125);e.abs().gte(.1);)e=e.times(_),A+=5;for(s=Math.log(cf(2,A))/Math.LN10*2+5|0,i+=s,n=h=m=new I(Fa),I.precision=i;;){if(h=Qi(h.times(e),i),n=n.times(++S),_=m.plus(Nu(h,n,i)),Fc(_.d).slice(0,i)===Fc(m.d).slice(0,i)){for(;A--;)m=Qi(m.times(m),i);return I.precision=M,t==null?(xo=!0,Qi(m,M)):m}m=_}}function Ko(e){for(var t=e.e*po,n=e.d[0];n>=10;n/=10)t++;return t}function WA(e,t,n){if(t>e.LN10.sd())throw xo=!0,n&&(e.precision=n),Error(vl+"LN10 precision limit exceeded");return Qi(new e(e.LN10),t)}function Lh(e){for(var t="";e--;)t+="0";return t}function o0(e,t){var n,s,h,m,_,i,S,A,I,M=1,L=10,z=e,G=z.d,F=z.constructor,U=F.precision;if(z.s<1)throw Error(vl+(z.s?"NaN":"-Infinity"));if(z.eq(Fa))return new F(0);if(t==null?(xo=!1,A=U):A=t,z.eq(10))return t==null&&(xo=!0),WA(F,A);if(A+=L,F.precision=A,n=Fc(G),s=n.charAt(0),m=Ko(z),Math.abs(m)<15e14){for(;s<7&&s!=1||s==1&&n.charAt(1)>3;)z=z.times(e),n=Fc(z.d),s=n.charAt(0),M++;m=Ko(z),s>1?(z=new F("0."+n),m++):z=new F(s+"."+n.slice(1))}else return S=WA(F,A+2,U).times(m+""),z=o0(new F(s+"."+n.slice(1)),A-L).plus(S),F.precision=U,t==null?(xo=!0,Qi(z,U)):z;for(i=_=z=Nu(z.minus(Fa),z.plus(Fa),A),I=Qi(z.times(z),A),h=3;;){if(_=Qi(_.times(I),A),S=i.plus(Nu(_,new F(h),A)),Fc(S.d).slice(0,A)===Fc(i.d).slice(0,A))return i=i.times(2),m!==0&&(i=i.plus(WA(F,A+2,U).times(m+""))),i=Nu(i,new F(M),A),F.precision=U,t==null?(xo=!0,Qi(i,U)):i;i=S,h+=2}}function HF(e,t){var n,s,h;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(s=t.search(/e/i))>0?(n<0&&(n=s),n+=+t.slice(s+1),t=t.substring(0,s)):n<0&&(n=t.length),s=0;t.charCodeAt(s)===48;)++s;for(h=t.length;t.charCodeAt(h-1)===48;)--h;if(t=t.slice(s,h),t){if(h-=s,n=n-s-1,e.e=iy(n/po),e.d=[],s=(n+1)%po,n<0&&(s+=po),s<h){for(s&&e.d.push(+t.slice(0,s)),h-=po;s<h;)e.d.push(+t.slice(s,s+=po));t=t.slice(s),s=po-t.length}else s-=h;for(;s--;)t+="0";if(e.d.push(+t),xo&&(e.e>$w||e.e<-$w))throw Error(VO+n)}else e.s=0,e.e=0,e.d=[0];return e}function Qi(e,t,n){var s,h,m,_,i,S,A,I,M=e.d;for(_=1,m=M[0];m>=10;m/=10)_++;if(s=t-_,s<0)s+=po,h=t,A=M[I=0];else{if(I=Math.ceil((s+1)/po),m=M.length,I>=m)return e;for(A=m=M[I],_=1;m>=10;m/=10)_++;s%=po,h=s-po+_}if(n!==void 0&&(m=cf(10,_-h-1),i=A/m%10|0,S=t<0||M[I+1]!==void 0||A%m,S=n<4?(i||S)&&(n==0||n==(e.s<0?3:2)):i>5||i==5&&(n==4||S||n==6&&(s>0?h>0?A/cf(10,_-h):0:M[I-1])%10&1||n==(e.s<0?8:7))),t<1||!M[0])return S?(m=Ko(e),M.length=1,t=t-m-1,M[0]=cf(10,(po-t%po)%po),e.e=iy(-t/po)||0):(M.length=1,M[0]=e.e=e.s=0),e;if(s==0?(M.length=I,m=1,I--):(M.length=I+1,m=cf(10,po-s),M[I]=h>0?(A/cf(10,_-h)%cf(10,h)|0)*m:0),S)for(;;)if(I==0){(M[0]+=m)==bs&&(M[0]=1,++e.e);break}else{if(M[I]+=m,M[I]!=bs)break;M[I--]=0,m=1}for(s=M.length;M[--s]===0;)M.pop();if(xo&&(e.e>$w||e.e<-$w))throw Error(VO+Ko(e));return e}function sG(e,t){var n,s,h,m,_,i,S,A,I,M,L=e.constructor,z=L.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new L(e),xo?Qi(t,z):t;if(S=e.d,M=t.d,s=t.e,A=e.e,S=S.slice(),_=A-s,_){for(I=_<0,I?(n=S,_=-_,i=M.length):(n=M,s=A,i=S.length),h=Math.max(Math.ceil(z/po),i)+2,_>h&&(_=h,n.length=1),n.reverse(),h=_;h--;)n.push(0);n.reverse()}else{for(h=S.length,i=M.length,I=h<i,I&&(i=h),h=0;h<i;h++)if(S[h]!=M[h]){I=S[h]<M[h];break}_=0}for(I&&(n=S,S=M,M=n,t.s=-t.s),i=S.length,h=M.length-i;h>0;--h)S[i++]=0;for(h=M.length;h>_;){if(S[--h]<M[h]){for(m=h;m&&S[--m]===0;)S[m]=bs-1;--S[m],S[h]+=bs}S[h]-=M[h]}for(;S[--i]===0;)S.pop();for(;S[0]===0;S.shift())--s;return S[0]?(t.d=S,t.e=s,xo?Qi(t,z):t):new L(0)}function Mf(e,t,n){var s,h=Ko(e),m=Fc(e.d),_=m.length;return t?(n&&(s=n-_)>0?m=m.charAt(0)+"."+m.slice(1)+Lh(s):_>1&&(m=m.charAt(0)+"."+m.slice(1)),m=m+(h<0?"e":"e+")+h):h<0?(m="0."+Lh(-h-1)+m,n&&(s=n-_)>0&&(m+=Lh(s))):h>=_?(m+=Lh(h+1-_),n&&(s=n-h-1)>0&&(m=m+"."+Lh(s))):((s=h+1)<_&&(m=m.slice(0,s)+"."+m.slice(s)),n&&(s=n-_)>0&&(h+1===_&&(m+="."),m+=Lh(s))),e.s<0?"-"+m:m}function WF(e,t){if(e.length>t)return e.length=t,!0}function aG(e){var t,n,s;function h(m){var _=this;if(!(_ instanceof h))return new h(m);if(_.constructor=h,m instanceof h){_.s=m.s,_.e=m.e,_.d=(m=m.d)?m.slice():m;return}if(typeof m=="number"){if(m*0!==0)throw Error(bf+m);if(m>0)_.s=1;else if(m<0)m=-m,_.s=-1;else{_.s=0,_.e=0,_.d=[0];return}if(m===~~m&&m<1e7){_.e=0,_.d=[m];return}return HF(_,m.toString())}else if(typeof m!="string")throw Error(bf+m);if(m.charCodeAt(0)===45?(m=m.slice(1),_.s=-1):_.s=1,nEe.test(m))HF(_,m);else throw Error(bf+m)}if(h.prototype=Hr,h.ROUND_UP=0,h.ROUND_DOWN=1,h.ROUND_CEIL=2,h.ROUND_FLOOR=3,h.ROUND_HALF_UP=4,h.ROUND_HALF_DOWN=5,h.ROUND_HALF_EVEN=6,h.ROUND_HALF_CEIL=7,h.ROUND_HALF_FLOOR=8,h.clone=aG,h.config=h.set=iEe,e===void 0&&(e={}),e)for(s=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<s.length;)e.hasOwnProperty(n=s[t++])||(e[n]=this[n]);return h.config(e),h}function iEe(e){if(!e||typeof e!="object")throw Error(vl+"Object expected");var t,n,s,h=["precision",1,ny,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<h.length;t+=3)if((s=e[n=h[t]])!==void 0)if(iy(s)===s&&s>=h[t+1]&&s<=h[t+2])this[n]=s;else throw Error(bf+n+": "+s);if((s=e[n="LN10"])!==void 0)if(s==Math.LN10)this[n]=new this(s);else throw Error(bf+n+": "+s);return this}var $O=aG(rEe);Fa=new $O(1);const Ki=$O;function oEe(e){return cEe(e)||lEe(e)||aEe(e)||sEe()}function sEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aEe(e,t){if(e){if(typeof e=="string")return DC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DC(e,t)}}function lEe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function cEe(e){if(Array.isArray(e))return DC(e)}function DC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var uEe=function(t){return t},lG={"@@functional/placeholder":!0},cG=function(t){return t===lG},qF=function(t){return function n(){return arguments.length===0||arguments.length===1&&cG(arguments.length<=0?void 0:arguments[0])?n:t.apply(void 0,arguments)}},hEe=function e(t,n){return t===1?n:qF(function(){for(var s=arguments.length,h=new Array(s),m=0;m<s;m++)h[m]=arguments[m];var _=h.filter(function(i){return i!==lG}).length;return _>=t?n.apply(void 0,h):e(t-_,qF(function(){for(var i=arguments.length,S=new Array(i),A=0;A<i;A++)S[A]=arguments[A];var I=h.map(function(M){return cG(M)?S.shift():M});return n.apply(void 0,oEe(I).concat(S))}))})},AS=function(t){return hEe(t.length,t)},kC=function(t,n){for(var s=[],h=t;h<n;++h)s[h-t]=h;return s},dEe=AS(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(n){return t[n]}).map(e)}),fEe=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];if(!n.length)return uEe;var h=n.reverse(),m=h[0],_=h.slice(1);return function(){return _.reduce(function(i,S){return S(i)},m.apply(void 0,arguments))}},jC=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},uG=function(t){var n=null,s=null;return function(){for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return n&&m.every(function(i,S){return i===n[S]})||(n=m,s=t.apply(void 0,m)),s}};function pEe(e){var t;return e===0?t=1:t=Math.floor(new Ki(e).abs().log(10).toNumber())+1,t}function mEe(e,t,n){for(var s=new Ki(e),h=0,m=[];s.lt(t)&&h<1e5;)m.push(s.toNumber()),s=s.add(n),h++;return m}var gEe=AS(function(e,t,n){var s=+e,h=+t;return s+n*(h-s)}),yEe=AS(function(e,t,n){var s=t-+e;return s=s||1/0,(n-e)/s}),_Ee=AS(function(e,t,n){var s=t-+e;return s=s||1/0,Math.max(0,Math.min(1,(n-e)/s))});const PS={rangeStep:mEe,getDigitCount:pEe,interpolateNumber:gEe,uninterpolateNumber:yEe,uninterpolateTruncation:_Ee};function LC(e){return bEe(e)||xEe(e)||hG(e)||vEe()}function vEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xEe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function bEe(e){if(Array.isArray(e))return NC(e)}function s0(e,t){return SEe(e)||TEe(e,t)||hG(e,t)||wEe()}function wEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hG(e,t){if(e){if(typeof e=="string")return NC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return NC(e,t)}}function NC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function TEe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],s=!0,h=!1,m=void 0;try{for(var _=e[Symbol.iterator](),i;!(s=(i=_.next()).done)&&(n.push(i.value),!(t&&n.length===t));s=!0);}catch(S){h=!0,m=S}finally{try{!s&&_.return!=null&&_.return()}finally{if(h)throw m}}return n}}function SEe(e){if(Array.isArray(e))return e}function dG(e){var t=s0(e,2),n=t[0],s=t[1],h=n,m=s;return n>s&&(h=s,m=n),[h,m]}function fG(e,t,n){if(e.lte(0))return new Ki(0);var s=PS.getDigitCount(e.toNumber()),h=new Ki(10).pow(s),m=e.div(h),_=s!==1?.05:.1,i=new Ki(Math.ceil(m.div(_).toNumber())).add(n).mul(_),S=i.mul(h);return t?S:new Ki(Math.ceil(S))}function EEe(e,t,n){var s=1,h=new Ki(e);if(!h.isint()&&n){var m=Math.abs(e);m<1?(s=new Ki(10).pow(PS.getDigitCount(e)-1),h=new Ki(Math.floor(h.div(s).toNumber())).mul(s)):m>1&&(h=new Ki(Math.floor(e)))}else e===0?h=new Ki(Math.floor((t-1)/2)):n||(h=new Ki(Math.floor(e)));var _=Math.floor((t-1)/2),i=fEe(dEe(function(S){return h.add(new Ki(S-_).mul(s)).toNumber()}),kC);return i(0,t)}function pG(e,t,n,s){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(n-1)))return{step:new Ki(0),tickMin:new Ki(0),tickMax:new Ki(0)};var m=fG(new Ki(t).sub(e).div(n-1),s,h),_;e<=0&&t>=0?_=new Ki(0):(_=new Ki(e).add(t).div(2),_=_.sub(new Ki(_).mod(m)));var i=Math.ceil(_.sub(e).div(m).toNumber()),S=Math.ceil(new Ki(t).sub(_).div(m).toNumber()),A=i+S+1;return A>n?pG(e,t,n,s,h+1):(A<n&&(S=t>0?S+(n-A):S,i=t>0?i:i+(n-A)),{step:m,tickMin:_.sub(new Ki(i).mul(m)),tickMax:_.add(new Ki(S).mul(m))})}function AEe(e){var t=s0(e,2),n=t[0],s=t[1],h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=Math.max(h,2),i=dG([n,s]),S=s0(i,2),A=S[0],I=S[1];if(A===-1/0||I===1/0){var M=I===1/0?[A].concat(LC(kC(0,h-1).map(function(){return 1/0}))):[].concat(LC(kC(0,h-1).map(function(){return-1/0})),[I]);return n>s?jC(M):M}if(A===I)return EEe(A,h,m);var L=pG(A,I,_,m),z=L.step,G=L.tickMin,F=L.tickMax,U=PS.rangeStep(G,F.add(new Ki(.1).mul(z)),z);return n>s?jC(U):U}function PEe(e,t){var n=s0(e,2),s=n[0],h=n[1],m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=dG([s,h]),i=s0(_,2),S=i[0],A=i[1];if(S===-1/0||A===1/0)return[s,h];if(S===A)return[S];var I=Math.max(t,2),M=fG(new Ki(A).sub(S).div(I-1),m,0),L=[].concat(LC(PS.rangeStep(new Ki(S),new Ki(A).sub(new Ki(.99).mul(M)),M)),[A]);return s>h?jC(L):L}var CEe=uG(AEe),IEe=uG(PEe),MEe="Invariant failed";function Of(e,t){throw new Error(MEe)}var OEe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function xg(e){"@babel/helpers - typeof";return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xg(e)}function Uw(){return Uw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Uw.apply(this,arguments)}function REe(e,t){return LEe(e)||jEe(e,t)||kEe(e,t)||DEe()}function DEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kEe(e,t){if(e){if(typeof e=="string")return ZF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ZF(e,t)}}function ZF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function jEe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function LEe(e){if(Array.isArray(e))return e}function NEe(e,t){if(e==null)return{};var n=zEe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function zEe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function FEe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BEe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,yG(s.key),s)}}function VEe(e,t,n){return t&&BEe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $Ee(e,t,n){return t=Gw(t),UEe(e,mG()?Reflect.construct(t,n||[],Gw(e).constructor):t.apply(e,n))}function UEe(e,t){if(t&&(xg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GEe(e)}function GEe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mG=function(){return!!e})()}function Gw(e){return Gw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Gw(e)}function HEe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zC(e,t)}function zC(e,t){return zC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},zC(e,t)}function gG(e,t,n){return t=yG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yG(e){var t=WEe(e,"string");return xg(t)=="symbol"?t:t+""}function WEe(e,t){if(xg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(xg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Q0=function(e){function t(){return FEe(this,t),$Ee(this,t,arguments)}return HEe(t,e),VEe(t,[{key:"render",value:function(){var s=this.props,h=s.offset,m=s.layout,_=s.width,i=s.dataKey,S=s.data,A=s.dataPointFormatter,I=s.xAxis,M=s.yAxis,L=NEe(s,OEe),z=Si(L,!1);this.props.direction==="x"&&I.type!=="number"&&Of();var G=S.map(function(F){var U=A(F,i),K=U.x,J=U.y,X=U.value,ie=U.errorVal;if(!ie)return null;var Q=[],ae,pe;if(Array.isArray(ie)){var Pe=REe(ie,2);ae=Pe[0],pe=Pe[1]}else ae=pe=ie;if(m==="vertical"){var Fe=I.scale,tt=J+h,Be=tt+_,Ge=tt-_,Qe=Fe(X-ae),Ke=Fe(X+pe);Q.push({x1:Ke,y1:Be,x2:Ke,y2:Ge}),Q.push({x1:Qe,y1:tt,x2:Ke,y2:tt}),Q.push({x1:Qe,y1:Be,x2:Qe,y2:Ge})}else if(m==="horizontal"){var ct=M.scale,He=K+h,qe=He-_,ut=He+_,nt=ct(X-ae),Kt=ct(X+pe);Q.push({x1:qe,y1:Kt,x2:ut,y2:Kt}),Q.push({x1:He,y1:nt,x2:He,y2:Kt}),Q.push({x1:qe,y1:nt,x2:ut,y2:nt})}return $e.createElement(Bo,Uw({className:"recharts-errorBar",key:"bar-".concat(Q.map(function(cr){return"".concat(cr.x1,"-").concat(cr.x2,"-").concat(cr.y1,"-").concat(cr.y2)}))},z),Q.map(function(cr){return $e.createElement("line",Uw({},cr,{key:"line-".concat(cr.x1,"-").concat(cr.x2,"-").concat(cr.y1,"-").concat(cr.y2)}))}))});return $e.createElement(Bo,{className:"recharts-errorBars"},G)}}])}($e.Component);gG(Q0,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});gG(Q0,"displayName","ErrorBar");function a0(e){"@babel/helpers - typeof";return a0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a0(e)}function XF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function of(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XF(Object(n),!0).forEach(function(s){qEe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function qEe(e,t,n){return t=ZEe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZEe(e){var t=XEe(e,"string");return a0(t)=="symbol"?t:t+""}function XEe(e,t){if(a0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(a0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _G=function(t){var n=t.children,s=t.formattedGraphicalItems,h=t.legendWidth,m=t.legendContent,_=Na(n,eg);if(!_)return null;var i=eg.defaultProps,S=i!==void 0?of(of({},i),_.props):{},A;return _.props&&_.props.payload?A=_.props&&_.props.payload:m==="children"?A=(s||[]).reduce(function(I,M){var L=M.item,z=M.props,G=z.sectors||z.data||[];return I.concat(G.map(function(F){return{type:_.props.iconType||L.props.legendType,value:F.name,color:F.fill,payload:F}}))},[]):A=(s||[]).map(function(I){var M=I.item,L=M.type.defaultProps,z=L!==void 0?of(of({},L),M.props):{},G=z.dataKey,F=z.name,U=z.legendType,K=z.hide;return{inactive:K,dataKey:G,type:S.iconType||U||"square",color:UO(M),value:F||G,payload:z}}),of(of(of({},S),eg.getWithHeight(_,h)),{},{payload:A,item:_})};function l0(e){"@babel/helpers - typeof";return l0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l0(e)}function KF(e){return QEe(e)||JEe(e)||YEe(e)||KEe()}function KEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YEe(e,t){if(e){if(typeof e=="string")return FC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return FC(e,t)}}function JEe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function QEe(e){if(Array.isArray(e))return FC(e)}function FC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function YF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Ro(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YF(Object(n),!0).forEach(function(s){rg(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YF(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function rg(e,t,n){return t=eAe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eAe(e){var t=tAe(e,"string");return l0(t)=="symbol"?t:t+""}function tAe(e,t){if(l0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(l0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Va(e,t,n){return mi(e)||mi(t)?n:cs(t)?ml(e,t,n):ai(t)?t(e):n}function kv(e,t,n,s){var h=J2e(e,function(i){return Va(i,t)});if(n==="number"){var m=h.filter(function(i){return wr(i)||parseFloat(i)});return m.length?[SS(m),TS(m)]:[1/0,-1/0]}var _=s?h.filter(function(i){return!mi(i)}):h;return _.map(function(i){return cs(i)||i instanceof Date?i:""})}var rAe=function(t){var n,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],h=arguments.length>2?arguments[2]:void 0,m=arguments.length>3?arguments[3]:void 0,_=-1,i=(n=s?.length)!==null&&n!==void 0?n:0;if(i<=1)return 0;if(m&&m.axisType==="angleAxis"&&Math.abs(Math.abs(m.range[1]-m.range[0])-360)<=1e-6)for(var S=m.range,A=0;A<i;A++){var I=A>0?h[A-1].coordinate:h[i-1].coordinate,M=h[A].coordinate,L=A>=i-1?h[0].coordinate:h[A+1].coordinate,z=void 0;if(ic(M-I)!==ic(L-M)){var G=[];if(ic(L-M)===ic(S[1]-S[0])){z=L;var F=M+S[1]-S[0];G[0]=Math.min(F,(F+I)/2),G[1]=Math.max(F,(F+I)/2)}else{z=I;var U=L+S[1]-S[0];G[0]=Math.min(M,(U+M)/2),G[1]=Math.max(M,(U+M)/2)}var K=[Math.min(M,(z+M)/2),Math.max(M,(z+M)/2)];if(t>K[0]&&t<=K[1]||t>=G[0]&&t<=G[1]){_=h[A].index;break}}else{var J=Math.min(I,L),X=Math.max(I,L);if(t>(J+M)/2&&t<=(X+M)/2){_=h[A].index;break}}}else for(var ie=0;ie<i;ie++)if(ie===0&&t<=(s[ie].coordinate+s[ie+1].coordinate)/2||ie>0&&ie<i-1&&t>(s[ie].coordinate+s[ie-1].coordinate)/2&&t<=(s[ie].coordinate+s[ie+1].coordinate)/2||ie===i-1&&t>(s[ie].coordinate+s[ie-1].coordinate)/2){_=s[ie].index;break}return _},UO=function(t){var n,s=t,h=s.type.displayName,m=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Ro(Ro({},t.type.defaultProps),t.props):t.props,_=m.stroke,i=m.fill,S;switch(h){case"Line":S=_;break;case"Area":case"Radar":S=_&&_!=="none"?_:i;break;default:S=i;break}return S},nAe=function(t){var n=t.barSize,s=t.totalSize,h=t.stackGroups,m=h===void 0?{}:h;if(!m)return{};for(var _={},i=Object.keys(m),S=0,A=i.length;S<A;S++)for(var I=m[i[S]].stackGroups,M=Object.keys(I),L=0,z=M.length;L<z;L++){var G=I[M[L]],F=G.items,U=G.cateAxisId,K=F.filter(function(pe){return ku(pe.type).indexOf("Bar")>=0});if(K&&K.length){var J=K[0].type.defaultProps,X=J!==void 0?Ro(Ro({},J),K[0].props):K[0].props,ie=X.barSize,Q=X[U];_[Q]||(_[Q]=[]);var ae=mi(ie)?n:ie;_[Q].push({item:K[0],stackList:K.slice(1),barSize:mi(ae)?void 0:If(ae,s,0)})}}return _},iAe=function(t){var n=t.barGap,s=t.barCategoryGap,h=t.bandSize,m=t.sizeList,_=m===void 0?[]:m,i=t.maxBarSize,S=_.length;if(S<1)return null;var A=If(n,h,0,!0),I,M=[];if(_[0].barSize===+_[0].barSize){var L=!1,z=h/S,G=_.reduce(function(ie,Q){return ie+Q.barSize||0},0);G+=(S-1)*A,G>=h&&(G-=(S-1)*A,A=0),G>=h&&z>0&&(L=!0,z*=.9,G=S*z);var F=(h-G)/2>>0,U={offset:F-A,size:0};I=_.reduce(function(ie,Q){var ae={item:Q.item,position:{offset:U.offset+U.size+A,size:L?z:Q.barSize}},pe=[].concat(KF(ie),[ae]);return U=pe[pe.length-1].position,Q.stackList&&Q.stackList.length&&Q.stackList.forEach(function(Pe){pe.push({item:Pe,position:U})}),pe},M)}else{var K=If(s,h,0,!0);h-2*K-(S-1)*A<=0&&(A=0);var J=(h-2*K-(S-1)*A)/S;J>1&&(J>>=0);var X=i===+i?Math.min(J,i):J;I=_.reduce(function(ie,Q,ae){var pe=[].concat(KF(ie),[{item:Q.item,position:{offset:K+(J+A)*ae+(J-X)/2,size:X}}]);return Q.stackList&&Q.stackList.length&&Q.stackList.forEach(function(Pe){pe.push({item:Pe,position:pe[pe.length-1].position})}),pe},M)}return I},oAe=function(t,n,s,h){var m=s.children,_=s.width,i=s.margin,S=_-(i.left||0)-(i.right||0),A=_G({children:m,legendWidth:S});if(A){var I=h||{},M=I.width,L=I.height,z=A.align,G=A.verticalAlign,F=A.layout;if((F==="vertical"||F==="horizontal"&&G==="middle")&&z!=="center"&&wr(t[z]))return Ro(Ro({},t),{},rg({},z,t[z]+(M||0)));if((F==="horizontal"||F==="vertical"&&z==="center")&&G!=="middle"&&wr(t[G]))return Ro(Ro({},t),{},rg({},G,t[G]+(L||0)))}return t},sAe=function(t,n,s){return mi(n)?!0:t==="horizontal"?n==="yAxis":t==="vertical"||s==="x"?n==="xAxis":s==="y"?n==="yAxis":!0},vG=function(t,n,s,h,m){var _=n.props.children,i=gl(_,Q0).filter(function(A){return sAe(h,m,A.props.direction)});if(i&&i.length){var S=i.map(function(A){return A.props.dataKey});return t.reduce(function(A,I){var M=Va(I,s);if(mi(M))return A;var L=Array.isArray(M)?[SS(M),TS(M)]:[M,M],z=S.reduce(function(G,F){var U=Va(I,F,0),K=L[0]-Math.abs(Array.isArray(U)?U[0]:U),J=L[1]+Math.abs(Array.isArray(U)?U[1]:U);return[Math.min(K,G[0]),Math.max(J,G[1])]},[1/0,-1/0]);return[Math.min(z[0],A[0]),Math.max(z[1],A[1])]},[1/0,-1/0])}return null},aAe=function(t,n,s,h,m){var _=n.map(function(i){return vG(t,i,s,m,h)}).filter(function(i){return!mi(i)});return _&&_.length?_.reduce(function(i,S){return[Math.min(i[0],S[0]),Math.max(i[1],S[1])]},[1/0,-1/0]):null},xG=function(t,n,s,h,m){var _=n.map(function(S){var A=S.props.dataKey;return s==="number"&&A&&vG(t,S,A,h)||kv(t,A,s,m)});if(s==="number")return _.reduce(function(S,A){return[Math.min(S[0],A[0]),Math.max(S[1],A[1])]},[1/0,-1/0]);var i={};return _.reduce(function(S,A){for(var I=0,M=A.length;I<M;I++)i[A[I]]||(i[A[I]]=!0,S.push(A[I]));return S},[])},bG=function(t,n){return t==="horizontal"&&n==="xAxis"||t==="vertical"&&n==="yAxis"||t==="centric"&&n==="angleAxis"||t==="radial"&&n==="radiusAxis"},wG=function(t,n,s,h){if(h)return t.map(function(S){return S.coordinate});var m,_,i=t.map(function(S){return S.coordinate===n&&(m=!0),S.coordinate===s&&(_=!0),S.coordinate});return m||i.push(n),_||i.push(s),i},Mu=function(t,n,s){if(!t)return null;var h=t.scale,m=t.duplicateDomain,_=t.type,i=t.range,S=t.realScaleType==="scaleBand"?h.bandwidth()/2:2,A=(n||s)&&_==="category"&&h.bandwidth?h.bandwidth()/S:0;if(A=t.axisType==="angleAxis"&&i?.length>=2?ic(i[0]-i[1])*2*A:A,n&&(t.ticks||t.niceTicks)){var I=(t.ticks||t.niceTicks).map(function(M){var L=m?m.indexOf(M):M;return{coordinate:h(L)+A,value:M,offset:A}});return I.filter(function(M){return!W0(M.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(M,L){return{coordinate:h(M)+A,value:M,index:L,offset:A}}):h.ticks&&!s?h.ticks(t.tickCount).map(function(M){return{coordinate:h(M)+A,value:M,offset:A}}):h.domain().map(function(M,L){return{coordinate:h(M)+A,value:m?m[M]:M,index:L,offset:A}})},qA=new WeakMap,S1=function(t,n){if(typeof n!="function")return t;qA.has(t)||qA.set(t,new WeakMap);var s=qA.get(t);if(s.has(n))return s.get(n);var h=function(){t.apply(void 0,arguments),n.apply(void 0,arguments)};return s.set(n,h),h},lAe=function(t,n,s){var h=t.scale,m=t.type,_=t.layout,i=t.axisType;if(h==="auto")return _==="radial"&&i==="radiusAxis"?{scale:e0(),realScaleType:"band"}:_==="radial"&&i==="angleAxis"?{scale:zw(),realScaleType:"linear"}:m==="category"&&n&&(n.indexOf("LineChart")>=0||n.indexOf("AreaChart")>=0||n.indexOf("ComposedChart")>=0&&!s)?{scale:Dv(),realScaleType:"point"}:m==="category"?{scale:e0(),realScaleType:"band"}:{scale:zw(),realScaleType:"linear"};if(Cf(h)){var S="scale".concat(uS(h));return{scale:(GF[S]||Dv)(),realScaleType:GF[S]?S:"point"}}return ai(h)?{scale:h}:{scale:Dv(),realScaleType:"point"}},JF=1e-4,cAe=function(t){var n=t.domain();if(!(!n||n.length<=2)){var s=n.length,h=t.range(),m=Math.min(h[0],h[1])-JF,_=Math.max(h[0],h[1])+JF,i=t(n[0]),S=t(n[s-1]);(i<m||i>_||S<m||S>_)&&t.domain([n[0],n[s-1]])}},uAe=function(t,n){if(!t)return null;for(var s=0,h=t.length;s<h;s++)if(t[s].item===n)return t[s].position;return null},hAe=function(t,n){if(!n||n.length!==2||!wr(n[0])||!wr(n[1]))return t;var s=Math.min(n[0],n[1]),h=Math.max(n[0],n[1]),m=[t[0],t[1]];return(!wr(t[0])||t[0]<s)&&(m[0]=s),(!wr(t[1])||t[1]>h)&&(m[1]=h),m[0]>h&&(m[0]=h),m[1]<s&&(m[1]=s),m},dAe=function(t){var n=t.length;if(!(n<=0))for(var s=0,h=t[0].length;s<h;++s)for(var m=0,_=0,i=0;i<n;++i){var S=W0(t[i][s][1])?t[i][s][0]:t[i][s][1];S>=0?(t[i][s][0]=m,t[i][s][1]=m+S,m=t[i][s][1]):(t[i][s][0]=_,t[i][s][1]=_+S,_=t[i][s][1])}},fAe=function(t){var n=t.length;if(!(n<=0))for(var s=0,h=t[0].length;s<h;++s)for(var m=0,_=0;_<n;++_){var i=W0(t[_][s][1])?t[_][s][0]:t[_][s][1];i>=0?(t[_][s][0]=m,t[_][s][1]=m+i,m=t[_][s][1]):(t[_][s][0]=0,t[_][s][1]=0)}},pAe={sign:dAe,expand:Ime,none:dg,silhouette:Mme,wiggle:Ome,positive:fAe},mAe=function(t,n,s){var h=n.map(function(i){return i.props.dataKey}),m=pAe[s],_=Cme().keys(h).value(function(i,S){return+Va(i,S,0)}).order(uC).offset(m);return _(t)},gAe=function(t,n,s,h,m,_){if(!t)return null;var i=_?n.reverse():n,S={},A=i.reduce(function(M,L){var z,G=(z=L.type)!==null&&z!==void 0&&z.defaultProps?Ro(Ro({},L.type.defaultProps),L.props):L.props,F=G.stackId,U=G.hide;if(U)return M;var K=G[s],J=M[K]||{hasStack:!1,stackGroups:{}};if(cs(F)){var X=J.stackGroups[F]||{numericAxisId:s,cateAxisId:h,items:[]};X.items.push(L),J.hasStack=!0,J.stackGroups[F]=X}else J.stackGroups[q0("_stackId_")]={numericAxisId:s,cateAxisId:h,items:[L]};return Ro(Ro({},M),{},rg({},K,J))},S),I={};return Object.keys(A).reduce(function(M,L){var z=A[L];if(z.hasStack){var G={};z.stackGroups=Object.keys(z.stackGroups).reduce(function(F,U){var K=z.stackGroups[U];return Ro(Ro({},F),{},rg({},U,{numericAxisId:s,cateAxisId:h,items:K.items,stackedData:mAe(t,K.items,m)}))},G)}return Ro(Ro({},M),{},rg({},L,z))},I)},yAe=function(t,n){var s=n.realScaleType,h=n.type,m=n.tickCount,_=n.originalDomain,i=n.allowDecimals,S=s||n.scale;if(S!=="auto"&&S!=="linear")return null;if(m&&h==="number"&&_&&(_[0]==="auto"||_[1]==="auto")){var A=t.domain();if(!A.length)return null;var I=CEe(A,m,i);return t.domain([SS(I),TS(I)]),{niceTicks:I}}if(m&&h==="number"){var M=t.domain(),L=IEe(M,m,i);return{niceTicks:L}}return null};function QF(e){var t=e.axis,n=e.ticks,s=e.bandSize,h=e.entry,m=e.index,_=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!mi(h[t.dataKey])){var i=mw(n,"value",h[t.dataKey]);if(i)return i.coordinate+s/2}return n[m]?n[m].coordinate+s/2:null}var S=Va(h,mi(_)?t.dataKey:_);return mi(S)?null:t.scale(S)}var eB=function(t){var n=t.axis,s=t.ticks,h=t.offset,m=t.bandSize,_=t.entry,i=t.index;if(n.type==="category")return s[i]?s[i].coordinate+h:null;var S=Va(_,n.dataKey,n.domain[i]);return mi(S)?null:n.scale(S)-m/2+h},_Ae=function(t){var n=t.numericAxis,s=n.scale.domain();if(n.type==="number"){var h=Math.min(s[0],s[1]),m=Math.max(s[0],s[1]);return h<=0&&m>=0?0:m<0?m:h}return s[0]},vAe=function(t,n){var s,h=(s=t.type)!==null&&s!==void 0&&s.defaultProps?Ro(Ro({},t.type.defaultProps),t.props):t.props,m=h.stackId;if(cs(m)){var _=n[m];if(_){var i=_.items.indexOf(t);return i>=0?_.stackedData[i]:null}}return null},xAe=function(t){return t.reduce(function(n,s){return[SS(s.concat([n[0]]).filter(wr)),TS(s.concat([n[1]]).filter(wr))]},[1/0,-1/0])},TG=function(t,n,s){return Object.keys(t).reduce(function(h,m){var _=t[m],i=_.stackedData,S=i.reduce(function(A,I){var M=xAe(I.slice(n,s+1));return[Math.min(A[0],M[0]),Math.max(A[1],M[1])]},[1/0,-1/0]);return[Math.min(S[0],h[0]),Math.max(S[1],h[1])]},[1/0,-1/0]).map(function(h){return h===1/0||h===-1/0?0:h})},tB=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,rB=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,BC=function(t,n,s){if(ai(t))return t(n,s);if(!Array.isArray(t))return n;var h=[];if(wr(t[0]))h[0]=s?t[0]:Math.min(t[0],n[0]);else if(tB.test(t[0])){var m=+tB.exec(t[0])[1];h[0]=n[0]-m}else ai(t[0])?h[0]=t[0](n[0]):h[0]=n[0];if(wr(t[1]))h[1]=s?t[1]:Math.max(t[1],n[1]);else if(rB.test(t[1])){var _=+rB.exec(t[1])[1];h[1]=n[1]+_}else ai(t[1])?h[1]=t[1](n[1]):h[1]=n[1];return h},Hw=function(t,n,s){if(t&&t.scale&&t.scale.bandwidth){var h=t.scale.bandwidth();if(!s||h>0)return h}if(t&&n&&n.length>=2){for(var m=yO(n,function(M){return M.coordinate}),_=1/0,i=1,S=m.length;i<S;i++){var A=m[i],I=m[i-1];_=Math.min((A.coordinate||0)-(I.coordinate||0),_)}return _===1/0?0:_}return s?void 0:0},nB=function(t,n,s){return!t||!t.length||ES(t,ml(s,"type.defaultProps.domain"))?n:t},SG=function(t,n){var s=t.type.defaultProps?Ro(Ro({},t.type.defaultProps),t.props):t.props,h=s.dataKey,m=s.name,_=s.unit,i=s.formatter,S=s.tooltipType,A=s.chartType,I=s.hide;return Ro(Ro({},Si(t,!1)),{},{dataKey:h,unit:_,formatter:i,name:m||h,color:UO(t),value:Va(n,h),type:S,payload:n,chartType:A,hide:I})};function c0(e){"@babel/helpers - typeof";return c0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c0(e)}function iB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function oB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iB(Object(n),!0).forEach(function(s){bAe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function bAe(e,t,n){return t=wAe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wAe(e){var t=TAe(e,"string");return c0(t)=="symbol"?t:t+""}function TAe(e,t){if(c0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(c0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ww=Math.PI/180,SAe=function(t){return t*180/Math.PI},Rs=function(t,n,s,h){return{x:t+Math.cos(-Ww*h)*s,y:n+Math.sin(-Ww*h)*s}},EAe=function(t,n){var s=t.x,h=t.y,m=n.x,_=n.y;return Math.sqrt(Math.pow(s-m,2)+Math.pow(h-_,2))},AAe=function(t,n){var s=t.x,h=t.y,m=n.cx,_=n.cy,i=EAe({x:s,y:h},{x:m,y:_});if(i<=0)return{radius:i};var S=(s-m)/i,A=Math.acos(S);return h>_&&(A=2*Math.PI-A),{radius:i,angle:SAe(A),angleInRadian:A}},PAe=function(t){var n=t.startAngle,s=t.endAngle,h=Math.floor(n/360),m=Math.floor(s/360),_=Math.min(h,m);return{startAngle:n-_*360,endAngle:s-_*360}},CAe=function(t,n){var s=n.startAngle,h=n.endAngle,m=Math.floor(s/360),_=Math.floor(h/360),i=Math.min(m,_);return t+i*360},sB=function(t,n){var s=t.x,h=t.y,m=AAe({x:s,y:h},n),_=m.radius,i=m.angle,S=n.innerRadius,A=n.outerRadius;if(_<S||_>A)return!1;if(_===0)return!0;var I=PAe(n),M=I.startAngle,L=I.endAngle,z=i,G;if(M<=L){for(;z>L;)z-=360;for(;z<M;)z+=360;G=z>=M&&z<=L}else{for(;z>M;)z-=360;for(;z<L;)z+=360;G=z>=L&&z<=M}return G?oB(oB({},n),{},{radius:_,angle:CAe(z,n)}):null};function u0(e){"@babel/helpers - typeof";return u0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u0(e)}var IAe=["offset"];function MAe(e){return kAe(e)||DAe(e)||RAe(e)||OAe()}function OAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RAe(e,t){if(e){if(typeof e=="string")return VC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return VC(e,t)}}function DAe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kAe(e){if(Array.isArray(e))return VC(e)}function VC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function jAe(e,t){if(e==null)return{};var n=LAe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function LAe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function aB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function ns(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aB(Object(n),!0).forEach(function(s){NAe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function NAe(e,t,n){return t=zAe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zAe(e){var t=FAe(e,"string");return u0(t)=="symbol"?t:t+""}function FAe(e,t){if(u0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(u0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h0(){return h0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},h0.apply(this,arguments)}var BAe=function(t){var n=t.value,s=t.formatter,h=mi(t.children)?n:t.children;return ai(s)?s(h):h},VAe=function(t,n){var s=ic(n-t),h=Math.min(Math.abs(n-t),360);return s*h},$Ae=function(t,n,s){var h=t.position,m=t.viewBox,_=t.offset,i=t.className,S=m,A=S.cx,I=S.cy,M=S.innerRadius,L=S.outerRadius,z=S.startAngle,G=S.endAngle,F=S.clockWise,U=(M+L)/2,K=VAe(z,G),J=K>=0?1:-1,X,ie;h==="insideStart"?(X=z+J*_,ie=F):h==="insideEnd"?(X=G-J*_,ie=!F):h==="end"&&(X=G+J*_,ie=F),ie=K<=0?ie:!ie;var Q=Rs(A,I,U,X),ae=Rs(A,I,U,X+(ie?1:-1)*359),pe="M".concat(Q.x,",").concat(Q.y,`
    A`).concat(U,",").concat(U,",0,1,").concat(ie?0:1,`,
    `).concat(ae.x,",").concat(ae.y),Pe=mi(t.id)?q0("recharts-radial-line-"):t.id;return $e.createElement("text",h0({},s,{dominantBaseline:"central",className:Ei("recharts-radial-bar-label",i)}),$e.createElement("defs",null,$e.createElement("path",{id:Pe,d:pe})),$e.createElement("textPath",{xlinkHref:"#".concat(Pe)},n))},UAe=function(t){var n=t.viewBox,s=t.offset,h=t.position,m=n,_=m.cx,i=m.cy,S=m.innerRadius,A=m.outerRadius,I=m.startAngle,M=m.endAngle,L=(I+M)/2;if(h==="outside"){var z=Rs(_,i,A+s,L),G=z.x,F=z.y;return{x:G,y:F,textAnchor:G>=_?"start":"end",verticalAnchor:"middle"}}if(h==="center")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(h==="centerTop")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"start"};if(h==="centerBottom")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"end"};var U=(S+A)/2,K=Rs(_,i,U,L),J=K.x,X=K.y;return{x:J,y:X,textAnchor:"middle",verticalAnchor:"middle"}},GAe=function(t){var n=t.viewBox,s=t.parentViewBox,h=t.offset,m=t.position,_=n,i=_.x,S=_.y,A=_.width,I=_.height,M=I>=0?1:-1,L=M*h,z=M>0?"end":"start",G=M>0?"start":"end",F=A>=0?1:-1,U=F*h,K=F>0?"end":"start",J=F>0?"start":"end";if(m==="top"){var X={x:i+A/2,y:S-M*h,textAnchor:"middle",verticalAnchor:z};return ns(ns({},X),s?{height:Math.max(S-s.y,0),width:A}:{})}if(m==="bottom"){var ie={x:i+A/2,y:S+I+L,textAnchor:"middle",verticalAnchor:G};return ns(ns({},ie),s?{height:Math.max(s.y+s.height-(S+I),0),width:A}:{})}if(m==="left"){var Q={x:i-U,y:S+I/2,textAnchor:K,verticalAnchor:"middle"};return ns(ns({},Q),s?{width:Math.max(Q.x-s.x,0),height:I}:{})}if(m==="right"){var ae={x:i+A+U,y:S+I/2,textAnchor:J,verticalAnchor:"middle"};return ns(ns({},ae),s?{width:Math.max(s.x+s.width-ae.x,0),height:I}:{})}var pe=s?{width:A,height:I}:{};return m==="insideLeft"?ns({x:i+U,y:S+I/2,textAnchor:J,verticalAnchor:"middle"},pe):m==="insideRight"?ns({x:i+A-U,y:S+I/2,textAnchor:K,verticalAnchor:"middle"},pe):m==="insideTop"?ns({x:i+A/2,y:S+L,textAnchor:"middle",verticalAnchor:G},pe):m==="insideBottom"?ns({x:i+A/2,y:S+I-L,textAnchor:"middle",verticalAnchor:z},pe):m==="insideTopLeft"?ns({x:i+U,y:S+L,textAnchor:J,verticalAnchor:G},pe):m==="insideTopRight"?ns({x:i+A-U,y:S+L,textAnchor:K,verticalAnchor:G},pe):m==="insideBottomLeft"?ns({x:i+U,y:S+I-L,textAnchor:J,verticalAnchor:z},pe):m==="insideBottomRight"?ns({x:i+A-U,y:S+I-L,textAnchor:K,verticalAnchor:z},pe):Xg(m)&&(wr(m.x)||ff(m.x))&&(wr(m.y)||ff(m.y))?ns({x:i+If(m.x,A),y:S+If(m.y,I),textAnchor:"end",verticalAnchor:"end"},pe):ns({x:i+A/2,y:S+I/2,textAnchor:"middle",verticalAnchor:"middle"},pe)},HAe=function(t){return"cx"in t&&wr(t.cx)};function Bs(e){var t=e.offset,n=t===void 0?5:t,s=jAe(e,IAe),h=ns({offset:n},s),m=h.viewBox,_=h.position,i=h.value,S=h.children,A=h.content,I=h.className,M=I===void 0?"":I,L=h.textBreakAll;if(!m||mi(i)&&mi(S)&&!B.isValidElement(A)&&!ai(A))return null;if(B.isValidElement(A))return B.cloneElement(A,h);var z;if(ai(A)){if(z=B.createElement(A,h),B.isValidElement(z))return z}else z=BAe(h);var G=HAe(m),F=Si(h,!0);if(G&&(_==="insideStart"||_==="insideEnd"||_==="end"))return $Ae(h,z,F);var U=G?UAe(h):GAe(h);return $e.createElement(Ow,h0({className:Ei("recharts-label",M)},F,U,{breakAll:L}),z)}Bs.displayName="Label";var EG=function(t){var n=t.cx,s=t.cy,h=t.angle,m=t.startAngle,_=t.endAngle,i=t.r,S=t.radius,A=t.innerRadius,I=t.outerRadius,M=t.x,L=t.y,z=t.top,G=t.left,F=t.width,U=t.height,K=t.clockWise,J=t.labelViewBox;if(J)return J;if(wr(F)&&wr(U)){if(wr(M)&&wr(L))return{x:M,y:L,width:F,height:U};if(wr(z)&&wr(G))return{x:z,y:G,width:F,height:U}}return wr(M)&&wr(L)?{x:M,y:L,width:0,height:0}:wr(n)&&wr(s)?{cx:n,cy:s,startAngle:m||h||0,endAngle:_||h||0,innerRadius:A||0,outerRadius:I||S||i||0,clockWise:K}:t.viewBox?t.viewBox:{}},WAe=function(t,n){return t?t===!0?$e.createElement(Bs,{key:"label-implicit",viewBox:n}):cs(t)?$e.createElement(Bs,{key:"label-implicit",viewBox:n,value:t}):B.isValidElement(t)?t.type===Bs?B.cloneElement(t,{key:"label-implicit",viewBox:n}):$e.createElement(Bs,{key:"label-implicit",content:t,viewBox:n}):ai(t)?$e.createElement(Bs,{key:"label-implicit",content:t,viewBox:n}):Xg(t)?$e.createElement(Bs,h0({viewBox:n},t,{key:"label-implicit"})):null:null},qAe=function(t,n){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&s&&!t.label)return null;var h=t.children,m=EG(t),_=gl(h,Bs).map(function(S,A){return B.cloneElement(S,{viewBox:n||m,key:"label-".concat(A)})});if(!s)return _;var i=WAe(t.label,n||m);return[i].concat(MAe(_))};Bs.parseViewBox=EG;Bs.renderCallByParent=qAe;function ZAe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var XAe=ZAe;const KAe=Bi(XAe);function d0(e){"@babel/helpers - typeof";return d0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d0(e)}var YAe=["valueAccessor"],JAe=["data","dataKey","clockWise","id","textBreakAll"];function QAe(e){return nPe(e)||rPe(e)||tPe(e)||ePe()}function ePe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tPe(e,t){if(e){if(typeof e=="string")return $C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $C(e,t)}}function rPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nPe(e){if(Array.isArray(e))return $C(e)}function $C(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function qw(){return qw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},qw.apply(this,arguments)}function lB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function cB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lB(Object(n),!0).forEach(function(s){iPe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function iPe(e,t,n){return t=oPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oPe(e){var t=sPe(e,"string");return d0(t)=="symbol"?t:t+""}function sPe(e,t){if(d0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(d0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uB(e,t){if(e==null)return{};var n=aPe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function aPe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}var lPe=function(t){return Array.isArray(t.value)?KAe(t.value):t.value};function Gh(e){var t=e.valueAccessor,n=t===void 0?lPe:t,s=uB(e,YAe),h=s.data,m=s.dataKey,_=s.clockWise,i=s.id,S=s.textBreakAll,A=uB(s,JAe);return!h||!h.length?null:$e.createElement(Bo,{className:"recharts-label-list"},h.map(function(I,M){var L=mi(m)?n(I,M):Va(I&&I.payload,m),z=mi(i)?{}:{id:"".concat(i,"-").concat(M)};return $e.createElement(Bs,qw({},Si(I,!0),A,z,{parentViewBox:I.parentViewBox,value:L,textBreakAll:S,viewBox:Bs.parseViewBox(mi(_)?I:cB(cB({},I),{},{clockWise:_})),key:"label-".concat(M),index:M}))}))}Gh.displayName="LabelList";function cPe(e,t){return e?e===!0?$e.createElement(Gh,{key:"labelList-implicit",data:t}):$e.isValidElement(e)||ai(e)?$e.createElement(Gh,{key:"labelList-implicit",data:t,content:e}):Xg(e)?$e.createElement(Gh,qw({data:t},e,{key:"labelList-implicit"})):null:null}function uPe(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var s=e.children,h=gl(s,Gh).map(function(_,i){return B.cloneElement(_,{data:t,key:"labelList-".concat(i)})});if(!n)return h;var m=cPe(e.label,t);return[m].concat(QAe(h))}Gh.renderCallByParent=uPe;function f0(e){"@babel/helpers - typeof";return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f0(e)}function UC(){return UC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},UC.apply(this,arguments)}function hB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function dB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hB(Object(n),!0).forEach(function(s){hPe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function hPe(e,t,n){return t=dPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dPe(e){var t=fPe(e,"string");return f0(t)=="symbol"?t:t+""}function fPe(e,t){if(f0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(f0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var pPe=function(t,n){var s=ic(n-t),h=Math.min(Math.abs(n-t),359.999);return s*h},E1=function(t){var n=t.cx,s=t.cy,h=t.radius,m=t.angle,_=t.sign,i=t.isExternal,S=t.cornerRadius,A=t.cornerIsExternal,I=S*(i?1:-1)+h,M=Math.asin(S/I)/Ww,L=A?m:m+_*M,z=Rs(n,s,I,L),G=Rs(n,s,h,L),F=A?m-_*M:m,U=Rs(n,s,I*Math.cos(M*Ww),F);return{center:z,circleTangency:G,lineTangency:U,theta:M}},AG=function(t){var n=t.cx,s=t.cy,h=t.innerRadius,m=t.outerRadius,_=t.startAngle,i=t.endAngle,S=pPe(_,i),A=_+S,I=Rs(n,s,m,_),M=Rs(n,s,m,A),L="M ".concat(I.x,",").concat(I.y,`
    A `).concat(m,",").concat(m,`,0,
    `).concat(+(Math.abs(S)>180),",").concat(+(_>A),`,
    `).concat(M.x,",").concat(M.y,`
  `);if(h>0){var z=Rs(n,s,h,_),G=Rs(n,s,h,A);L+="L ".concat(G.x,",").concat(G.y,`
            A `).concat(h,",").concat(h,`,0,
            `).concat(+(Math.abs(S)>180),",").concat(+(_<=A),`,
            `).concat(z.x,",").concat(z.y," Z")}else L+="L ".concat(n,",").concat(s," Z");return L},mPe=function(t){var n=t.cx,s=t.cy,h=t.innerRadius,m=t.outerRadius,_=t.cornerRadius,i=t.forceCornerRadius,S=t.cornerIsExternal,A=t.startAngle,I=t.endAngle,M=ic(I-A),L=E1({cx:n,cy:s,radius:m,angle:A,sign:M,cornerRadius:_,cornerIsExternal:S}),z=L.circleTangency,G=L.lineTangency,F=L.theta,U=E1({cx:n,cy:s,radius:m,angle:I,sign:-M,cornerRadius:_,cornerIsExternal:S}),K=U.circleTangency,J=U.lineTangency,X=U.theta,ie=S?Math.abs(A-I):Math.abs(A-I)-F-X;if(ie<0)return i?"M ".concat(G.x,",").concat(G.y,`
        a`).concat(_,",").concat(_,",0,0,1,").concat(_*2,`,0
        a`).concat(_,",").concat(_,",0,0,1,").concat(-_*2,`,0
      `):AG({cx:n,cy:s,innerRadius:h,outerRadius:m,startAngle:A,endAngle:I});var Q="M ".concat(G.x,",").concat(G.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(z.x,",").concat(z.y,`
    A`).concat(m,",").concat(m,",0,").concat(+(ie>180),",").concat(+(M<0),",").concat(K.x,",").concat(K.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(J.x,",").concat(J.y,`
  `);if(h>0){var ae=E1({cx:n,cy:s,radius:h,angle:A,sign:M,isExternal:!0,cornerRadius:_,cornerIsExternal:S}),pe=ae.circleTangency,Pe=ae.lineTangency,Fe=ae.theta,tt=E1({cx:n,cy:s,radius:h,angle:I,sign:-M,isExternal:!0,cornerRadius:_,cornerIsExternal:S}),Be=tt.circleTangency,Ge=tt.lineTangency,Qe=tt.theta,Ke=S?Math.abs(A-I):Math.abs(A-I)-Fe-Qe;if(Ke<0&&_===0)return"".concat(Q,"L").concat(n,",").concat(s,"Z");Q+="L".concat(Ge.x,",").concat(Ge.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(Be.x,",").concat(Be.y,`
      A`).concat(h,",").concat(h,",0,").concat(+(Ke>180),",").concat(+(M>0),",").concat(pe.x,",").concat(pe.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(Pe.x,",").concat(Pe.y,"Z")}else Q+="L".concat(n,",").concat(s,"Z");return Q},gPe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},PG=function(t){var n=dB(dB({},gPe),t),s=n.cx,h=n.cy,m=n.innerRadius,_=n.outerRadius,i=n.cornerRadius,S=n.forceCornerRadius,A=n.cornerIsExternal,I=n.startAngle,M=n.endAngle,L=n.className;if(_<m||I===M)return null;var z=Ei("recharts-sector",L),G=_-m,F=If(i,G,0,!0),U;return F>0&&Math.abs(I-M)<360?U=mPe({cx:s,cy:h,innerRadius:m,outerRadius:_,cornerRadius:Math.min(F,G/2),forceCornerRadius:S,cornerIsExternal:A,startAngle:I,endAngle:M}):U=AG({cx:s,cy:h,innerRadius:m,outerRadius:_,startAngle:I,endAngle:M}),$e.createElement("path",UC({},Si(n,!0),{className:z,d:U,role:"img"}))};function p0(e){"@babel/helpers - typeof";return p0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p0(e)}function GC(){return GC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},GC.apply(this,arguments)}function fB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function pB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fB(Object(n),!0).forEach(function(s){yPe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yPe(e,t,n){return t=_Pe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _Pe(e){var t=vPe(e,"string");return p0(t)=="symbol"?t:t+""}function vPe(e,t){if(p0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(p0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mB={curveBasisClosed:yme,curveBasisOpen:_me,curveBasis:gme,curveBumpX:rme,curveBumpY:nme,curveLinearClosed:vme,curveLinear:dS,curveMonotoneX:xme,curveMonotoneY:bme,curveNatural:wme,curveStep:Tme,curveStepAfter:Eme,curveStepBefore:Sme},A1=function(t){return t.x===+t.x&&t.y===+t.y},mv=function(t){return t.x},gv=function(t){return t.y},xPe=function(t,n){if(ai(t))return t;var s="curve".concat(uS(t));return(s==="curveMonotone"||s==="curveBump")&&n?mB["".concat(s).concat(n==="vertical"?"Y":"X")]:mB[s]||dS},bPe=function(t){var n=t.type,s=n===void 0?"linear":n,h=t.points,m=h===void 0?[]:h,_=t.baseLine,i=t.layout,S=t.connectNulls,A=S===void 0?!1:S,I=xPe(s,i),M=A?m.filter(function(F){return A1(F)}):m,L;if(Array.isArray(_)){var z=A?_.filter(function(F){return A1(F)}):_,G=M.map(function(F,U){return pB(pB({},F),{},{base:z[U]})});return i==="vertical"?L=g1().y(gv).x1(mv).x0(function(F){return F.base.x}):L=g1().x(mv).y1(gv).y0(function(F){return F.base.y}),L.defined(A1).curve(I),L(G)}return i==="vertical"&&wr(_)?L=g1().y(gv).x1(mv).x0(_):wr(_)?L=g1().x(mv).y1(gv).y0(_):L=P6().x(mv).y(gv),L.defined(A1).curve(I),L(M)},HC=function(t){var n=t.className,s=t.points,h=t.path,m=t.pathRef;if((!s||!s.length)&&!h)return null;var _=s&&s.length?bPe(t):h;return B.createElement("path",GC({},Si(t,!1),gw(t),{className:Ei("recharts-curve",n),d:_,ref:m}))},CG={exports:{}},wPe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",TPe=wPe,SPe=TPe;function IG(){}function MG(){}MG.resetWarningCache=IG;var EPe=function(){function e(s,h,m,_,i,S){if(S!==SPe){var A=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw A.name="Invariant Violation",A}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:MG,resetWarningCache:IG};return n.PropTypes=n,n};CG.exports=EPe();var APe=CG.exports;const Fi=Bi(APe);var PPe=Object.getOwnPropertyNames,CPe=Object.getOwnPropertySymbols,IPe=Object.prototype.hasOwnProperty;function gB(e,t){return function(s,h,m){return e(s,h,m)&&t(s,h,m)}}function P1(e){return function(n,s,h){if(!n||!s||typeof n!="object"||typeof s!="object")return e(n,s,h);var m=h.cache,_=m.get(n),i=m.get(s);if(_&&i)return _===s&&i===n;m.set(n,s),m.set(s,n);var S=e(n,s,h);return m.delete(n),m.delete(s),S}}function yB(e){return PPe(e).concat(CPe(e))}var MPe=Object.hasOwn||function(e,t){return IPe.call(e,t)};function Bf(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var OPe="__v",RPe="__o",DPe="_owner",_B=Object.getOwnPropertyDescriptor,vB=Object.keys;function kPe(e,t,n){var s=e.length;if(t.length!==s)return!1;for(;s-- >0;)if(!n.equals(e[s],t[s],s,s,e,t,n))return!1;return!0}function jPe(e,t){return Bf(e.getTime(),t.getTime())}function LPe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function NPe(e,t){return e===t}function xB(e,t,n){var s=e.size;if(s!==t.size)return!1;if(!s)return!0;for(var h=new Array(s),m=e.entries(),_,i,S=0;(_=m.next())&&!_.done;){for(var A=t.entries(),I=!1,M=0;(i=A.next())&&!i.done;){if(h[M]){M++;continue}var L=_.value,z=i.value;if(n.equals(L[0],z[0],S,M,e,t,n)&&n.equals(L[1],z[1],L[0],z[0],e,t,n)){I=h[M]=!0;break}M++}if(!I)return!1;S++}return!0}var zPe=Bf;function FPe(e,t,n){var s=vB(e),h=s.length;if(vB(t).length!==h)return!1;for(;h-- >0;)if(!OG(e,t,n,s[h]))return!1;return!0}function yv(e,t,n){var s=yB(e),h=s.length;if(yB(t).length!==h)return!1;for(var m,_,i;h-- >0;)if(m=s[h],!OG(e,t,n,m)||(_=_B(e,m),i=_B(t,m),(_||i)&&(!_||!i||_.configurable!==i.configurable||_.enumerable!==i.enumerable||_.writable!==i.writable)))return!1;return!0}function BPe(e,t){return Bf(e.valueOf(),t.valueOf())}function VPe(e,t){return e.source===t.source&&e.flags===t.flags}function bB(e,t,n){var s=e.size;if(s!==t.size)return!1;if(!s)return!0;for(var h=new Array(s),m=e.values(),_,i;(_=m.next())&&!_.done;){for(var S=t.values(),A=!1,I=0;(i=S.next())&&!i.done;){if(!h[I]&&n.equals(_.value,i.value,_.value,i.value,e,t,n)){A=h[I]=!0;break}I++}if(!A)return!1}return!0}function $Pe(e,t){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(e[n]!==t[n])return!1;return!0}function UPe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function OG(e,t,n,s){return(s===DPe||s===RPe||s===OPe)&&(e.$$typeof||t.$$typeof)?!0:MPe(t,s)&&n.equals(e[s],t[s],s,s,e,t,n)}var GPe="[object Arguments]",HPe="[object Boolean]",WPe="[object Date]",qPe="[object Error]",ZPe="[object Map]",XPe="[object Number]",KPe="[object Object]",YPe="[object RegExp]",JPe="[object Set]",QPe="[object String]",eCe="[object URL]",tCe=Array.isArray,wB=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,TB=Object.assign,rCe=Object.prototype.toString.call.bind(Object.prototype.toString);function nCe(e){var t=e.areArraysEqual,n=e.areDatesEqual,s=e.areErrorsEqual,h=e.areFunctionsEqual,m=e.areMapsEqual,_=e.areNumbersEqual,i=e.areObjectsEqual,S=e.arePrimitiveWrappersEqual,A=e.areRegExpsEqual,I=e.areSetsEqual,M=e.areTypedArraysEqual,L=e.areUrlsEqual;return function(G,F,U){if(G===F)return!0;if(G==null||F==null)return!1;var K=typeof G;if(K!==typeof F)return!1;if(K!=="object")return K==="number"?_(G,F,U):K==="function"?h(G,F,U):!1;var J=G.constructor;if(J!==F.constructor)return!1;if(J===Object)return i(G,F,U);if(tCe(G))return t(G,F,U);if(wB!=null&&wB(G))return M(G,F,U);if(J===Date)return n(G,F,U);if(J===RegExp)return A(G,F,U);if(J===Map)return m(G,F,U);if(J===Set)return I(G,F,U);var X=rCe(G);return X===WPe?n(G,F,U):X===YPe?A(G,F,U):X===ZPe?m(G,F,U):X===JPe?I(G,F,U):X===KPe?typeof G.then!="function"&&typeof F.then!="function"&&i(G,F,U):X===eCe?L(G,F,U):X===qPe?s(G,F,U):X===GPe?i(G,F,U):X===HPe||X===XPe||X===QPe?S(G,F,U):!1}}function iCe(e){var t=e.circular,n=e.createCustomConfig,s=e.strict,h={areArraysEqual:s?yv:kPe,areDatesEqual:jPe,areErrorsEqual:LPe,areFunctionsEqual:NPe,areMapsEqual:s?gB(xB,yv):xB,areNumbersEqual:zPe,areObjectsEqual:s?yv:FPe,arePrimitiveWrappersEqual:BPe,areRegExpsEqual:VPe,areSetsEqual:s?gB(bB,yv):bB,areTypedArraysEqual:s?yv:$Pe,areUrlsEqual:UPe};if(n&&(h=TB({},h,n(h))),t){var m=P1(h.areArraysEqual),_=P1(h.areMapsEqual),i=P1(h.areObjectsEqual),S=P1(h.areSetsEqual);h=TB({},h,{areArraysEqual:m,areMapsEqual:_,areObjectsEqual:i,areSetsEqual:S})}return h}function oCe(e){return function(t,n,s,h,m,_,i){return e(t,n,i)}}function sCe(e){var t=e.circular,n=e.comparator,s=e.createState,h=e.equals,m=e.strict;if(s)return function(S,A){var I=s(),M=I.cache,L=M===void 0?t?new WeakMap:void 0:M,z=I.meta;return n(S,A,{cache:L,equals:h,meta:z,strict:m})};if(t)return function(S,A){return n(S,A,{cache:new WeakMap,equals:h,meta:void 0,strict:m})};var _={cache:void 0,equals:h,meta:void 0,strict:m};return function(S,A){return n(S,A,_)}}var aCe=id();id({strict:!0});id({circular:!0});id({circular:!0,strict:!0});id({createInternalComparator:function(){return Bf}});id({strict:!0,createInternalComparator:function(){return Bf}});id({circular:!0,createInternalComparator:function(){return Bf}});id({circular:!0,createInternalComparator:function(){return Bf},strict:!0});function id(e){e===void 0&&(e={});var t=e.circular,n=t===void 0?!1:t,s=e.createInternalComparator,h=e.createState,m=e.strict,_=m===void 0?!1:m,i=iCe(e),S=nCe(i),A=s?s(S):oCe(S);return sCe({circular:n,comparator:S,createState:h,equals:A,strict:_})}function lCe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function SB(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=-1,s=function h(m){n<0&&(n=m),m-n>t?(e(m),n=-1):lCe(h)};requestAnimationFrame(s)}function WC(e){"@babel/helpers - typeof";return WC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WC(e)}function cCe(e){return fCe(e)||dCe(e)||hCe(e)||uCe()}function uCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hCe(e,t){if(e){if(typeof e=="string")return EB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return EB(e,t)}}function EB(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function dCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function fCe(e){if(Array.isArray(e))return e}function pCe(){var e={},t=function(){return null},n=!1,s=function h(m){if(!n){if(Array.isArray(m)){if(!m.length)return;var _=m,i=cCe(_),S=i[0],A=i.slice(1);if(typeof S=="number"){SB(h.bind(null,A),S);return}h(S),SB(h.bind(null,A));return}WC(m)==="object"&&(e=m,t(e)),typeof m=="function"&&m()}};return{stop:function(){n=!0},start:function(m){n=!1,s(m)},subscribe:function(m){return t=m,function(){t=function(){return null}}}}}function m0(e){"@babel/helpers - typeof";return m0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m0(e)}function AB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function PB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AB(Object(n),!0).forEach(function(s){RG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function RG(e,t,n){return t=mCe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mCe(e){var t=gCe(e,"string");return m0(t)==="symbol"?t:String(t)}function gCe(e,t){if(m0(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(m0(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yCe=function(t,n){return[Object.keys(t),Object.keys(n)].reduce(function(s,h){return s.filter(function(m){return h.includes(m)})})},_Ce=function(t){return t},vCe=function(t){return t.replace(/([A-Z])/g,function(n){return"-".concat(n.toLowerCase())})},jv=function(t,n){return Object.keys(n).reduce(function(s,h){return PB(PB({},s),{},RG({},h,t(h,n[h])))},{})},CB=function(t,n,s){return t.map(function(h){return"".concat(vCe(h)," ").concat(n,"ms ").concat(s)}).join(",")};function xCe(e,t){return TCe(e)||wCe(e,t)||DG(e,t)||bCe()}function bCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wCe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function TCe(e){if(Array.isArray(e))return e}function SCe(e){return PCe(e)||ACe(e)||DG(e)||ECe()}function ECe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DG(e,t){if(e){if(typeof e=="string")return qC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qC(e,t)}}function ACe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function PCe(e){if(Array.isArray(e))return qC(e)}function qC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var Zw=1e-4,kG=function(t,n){return[0,3*t,3*n-6*t,3*t-3*n+1]},jG=function(t,n){return t.map(function(s,h){return s*Math.pow(n,h)}).reduce(function(s,h){return s+h})},IB=function(t,n){return function(s){var h=kG(t,n);return jG(h,s)}},CCe=function(t,n){return function(s){var h=kG(t,n),m=[].concat(SCe(h.map(function(_,i){return _*i}).slice(1)),[0]);return jG(m,s)}},MB=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];var h=n[0],m=n[1],_=n[2],i=n[3];if(n.length===1)switch(n[0]){case"linear":h=0,m=0,_=1,i=1;break;case"ease":h=.25,m=.1,_=.25,i=1;break;case"ease-in":h=.42,m=0,_=1,i=1;break;case"ease-out":h=.42,m=0,_=.58,i=1;break;case"ease-in-out":h=0,m=0,_=.58,i=1;break;default:{var S=n[0].split("(");if(S[0]==="cubic-bezier"&&S[1].split(")")[0].split(",").length===4){var A=S[1].split(")")[0].split(",").map(function(U){return parseFloat(U)}),I=xCe(A,4);h=I[0],m=I[1],_=I[2],i=I[3]}}}var M=IB(h,_),L=IB(m,i),z=CCe(h,_),G=function(K){return K>1?1:K<0?0:K},F=function(K){for(var J=K>1?1:K,X=J,ie=0;ie<8;++ie){var Q=M(X)-J,ae=z(X);if(Math.abs(Q-J)<Zw||ae<Zw)return L(X);X=G(X-Q/ae)}return L(X)};return F.isStepper=!1,F},ICe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.stiff,s=n===void 0?100:n,h=t.damping,m=h===void 0?8:h,_=t.dt,i=_===void 0?17:_,S=function(I,M,L){var z=-(I-M)*s,G=L*m,F=L+(z-G)*i/1e3,U=L*i/1e3+I;return Math.abs(U-M)<Zw&&Math.abs(F)<Zw?[M,0]:[U,F]};return S.isStepper=!0,S.dt=i,S},MCe=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];var h=n[0];if(typeof h=="string")switch(h){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return MB(h);case"spring":return ICe();default:if(h.split("(")[0]==="cubic-bezier")return MB(h)}return typeof h=="function"?h:null};function g0(e){"@babel/helpers - typeof";return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g0(e)}function OB(e){return DCe(e)||RCe(e)||LG(e)||OCe()}function OCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function DCe(e){if(Array.isArray(e))return XC(e)}function RB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Ms(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RB(Object(n),!0).forEach(function(s){ZC(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function ZC(e,t,n){return t=kCe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kCe(e){var t=jCe(e,"string");return g0(t)==="symbol"?t:String(t)}function jCe(e,t){if(g0(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(g0(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LCe(e,t){return FCe(e)||zCe(e,t)||LG(e,t)||NCe()}function NCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LG(e,t){if(e){if(typeof e=="string")return XC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return XC(e,t)}}function XC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function zCe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function FCe(e){if(Array.isArray(e))return e}var Xw=function(t,n,s){return t+(n-t)*s},KC=function(t){var n=t.from,s=t.to;return n!==s},BCe=function e(t,n,s){var h=jv(function(m,_){if(KC(_)){var i=t(_.from,_.to,_.velocity),S=LCe(i,2),A=S[0],I=S[1];return Ms(Ms({},_),{},{from:A,velocity:I})}return _},n);return s<1?jv(function(m,_){return KC(_)?Ms(Ms({},_),{},{velocity:Xw(_.velocity,h[m].velocity,s),from:Xw(_.from,h[m].from,s)}):_},n):e(t,h,s-1)};const VCe=function(e,t,n,s,h){var m=yCe(e,t),_=m.reduce(function(U,K){return Ms(Ms({},U),{},ZC({},K,[e[K],t[K]]))},{}),i=m.reduce(function(U,K){return Ms(Ms({},U),{},ZC({},K,{from:e[K],velocity:0,to:t[K]}))},{}),S=-1,A,I,M=function(){return null},L=function(){return jv(function(K,J){return J.from},i)},z=function(){return!Object.values(i).filter(KC).length},G=function(K){A||(A=K);var J=K-A,X=J/n.dt;i=BCe(n,i,X),h(Ms(Ms(Ms({},e),t),L())),A=K,z()||(S=requestAnimationFrame(M))},F=function(K){I||(I=K);var J=(K-I)/s,X=jv(function(Q,ae){return Xw.apply(void 0,OB(ae).concat([n(J)]))},_);if(h(Ms(Ms(Ms({},e),t),X)),J<1)S=requestAnimationFrame(M);else{var ie=jv(function(Q,ae){return Xw.apply(void 0,OB(ae).concat([n(1)]))},_);h(Ms(Ms(Ms({},e),t),ie))}};return M=n.isStepper?G:F,function(){return requestAnimationFrame(M),function(){cancelAnimationFrame(S)}}};function bg(e){"@babel/helpers - typeof";return bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bg(e)}var $Ce=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function UCe(e,t){if(e==null)return{};var n=GCe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function GCe(e,t){if(e==null)return{};var n={},s=Object.keys(e),h,m;for(m=0;m<s.length;m++)h=s[m],!(t.indexOf(h)>=0)&&(n[h]=e[h]);return n}function ZA(e){return ZCe(e)||qCe(e)||WCe(e)||HCe()}function HCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WCe(e,t){if(e){if(typeof e=="string")return YC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return YC(e,t)}}function qCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ZCe(e){if(Array.isArray(e))return YC(e)}function YC(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function DB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Zl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DB(Object(n),!0).forEach(function(s){wv(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function wv(e,t,n){return t=NG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XCe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KCe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,NG(s.key),s)}}function YCe(e,t,n){return t&&KCe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function NG(e){var t=JCe(e,"string");return bg(t)==="symbol"?t:String(t)}function JCe(e,t){if(bg(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(bg(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QCe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&JC(e,t)}function JC(e,t){return JC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},JC(e,t)}function eIe(e){var t=tIe();return function(){var s=Kw(e),h;if(t){var m=Kw(this).constructor;h=Reflect.construct(s,arguments,m)}else h=s.apply(this,arguments);return QC(this,h)}}function QC(e,t){if(t&&(bg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eI(e)}function eI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tIe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Kw(e){return Kw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Kw(e)}var Hu=function(e){QCe(n,e);var t=eIe(n);function n(s,h){var m;XCe(this,n),m=t.call(this,s,h);var _=m.props,i=_.isActive,S=_.attributeName,A=_.from,I=_.to,M=_.steps,L=_.children,z=_.duration;if(m.handleStyleChange=m.handleStyleChange.bind(eI(m)),m.changeStyle=m.changeStyle.bind(eI(m)),!i||z<=0)return m.state={style:{}},typeof L=="function"&&(m.state={style:I}),QC(m);if(M&&M.length)m.state={style:M[0].style};else if(A){if(typeof L=="function")return m.state={style:A},QC(m);m.state={style:S?wv({},S,A):A}}else m.state={style:{}};return m}return YCe(n,[{key:"componentDidMount",value:function(){var h=this.props,m=h.isActive,_=h.canBegin;this.mounted=!0,!(!m||!_)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(h){var m=this.props,_=m.isActive,i=m.canBegin,S=m.attributeName,A=m.shouldReAnimate,I=m.to,M=m.from,L=this.state.style;if(i){if(!_){var z={style:S?wv({},S,I):I};this.state&&L&&(S&&L[S]!==I||!S&&L!==I)&&this.setState(z);return}if(!(aCe(h.to,I)&&h.canBegin&&h.isActive)){var G=!h.canBegin||!h.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var F=G||A?M:h.to;if(this.state&&L){var U={style:S?wv({},S,F):F};(S&&L[S]!==F||!S&&L!==F)&&this.setState(U)}this.runAnimation(Zl(Zl({},this.props),{},{from:F,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var h=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),h&&h()}},{key:"handleStyleChange",value:function(h){this.changeStyle(h)}},{key:"changeStyle",value:function(h){this.mounted&&this.setState({style:h})}},{key:"runJSAnimation",value:function(h){var m=this,_=h.from,i=h.to,S=h.duration,A=h.easing,I=h.begin,M=h.onAnimationEnd,L=h.onAnimationStart,z=VCe(_,i,MCe(A),S,this.changeStyle),G=function(){m.stopJSAnimation=z()};this.manager.start([L,I,G,S,M])}},{key:"runStepAnimation",value:function(h){var m=this,_=h.steps,i=h.begin,S=h.onAnimationStart,A=_[0],I=A.style,M=A.duration,L=M===void 0?0:M,z=function(F,U,K){if(K===0)return F;var J=U.duration,X=U.easing,ie=X===void 0?"ease":X,Q=U.style,ae=U.properties,pe=U.onAnimationEnd,Pe=K>0?_[K-1]:U,Fe=ae||Object.keys(Q);if(typeof ie=="function"||ie==="spring")return[].concat(ZA(F),[m.runJSAnimation.bind(m,{from:Pe.style,to:Q,duration:J,easing:ie}),J]);var tt=CB(Fe,J,ie),Be=Zl(Zl(Zl({},Pe.style),Q),{},{transition:tt});return[].concat(ZA(F),[Be,J,pe]).filter(_Ce)};return this.manager.start([S].concat(ZA(_.reduce(z,[I,Math.max(L,i)])),[h.onAnimationEnd]))}},{key:"runAnimation",value:function(h){this.manager||(this.manager=pCe());var m=h.begin,_=h.duration,i=h.attributeName,S=h.to,A=h.easing,I=h.onAnimationStart,M=h.onAnimationEnd,L=h.steps,z=h.children,G=this.manager;if(this.unSubscribe=G.subscribe(this.handleStyleChange),typeof A=="function"||typeof z=="function"||A==="spring"){this.runJSAnimation(h);return}if(L.length>1){this.runStepAnimation(h);return}var F=i?wv({},i,S):S,U=CB(Object.keys(F),_,A);G.start([I,m,Zl(Zl({},F),{},{transition:U}),_,M])}},{key:"render",value:function(){var h=this.props,m=h.children;h.begin;var _=h.duration;h.attributeName,h.easing;var i=h.isActive;h.steps,h.from,h.to,h.canBegin,h.onAnimationEnd,h.shouldReAnimate,h.onAnimationReStart;var S=UCe(h,$Ce),A=B.Children.count(m),I=this.state.style;if(typeof m=="function")return m(I);if(!i||A===0||_<=0)return m;var M=function(z){var G=z.props,F=G.style,U=F===void 0?{}:F,K=G.className,J=B.cloneElement(z,Zl(Zl({},S),{},{style:Zl(Zl({},U),I),className:K}));return J};return A===1?M(B.Children.only(m)):$e.createElement("div",null,B.Children.map(m,function(L){return M(L)}))}}]),n}(B.PureComponent);Hu.displayName="Animate";Hu.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Hu.propTypes={from:Fi.oneOfType([Fi.object,Fi.string]),to:Fi.oneOfType([Fi.object,Fi.string]),attributeName:Fi.string,duration:Fi.number,begin:Fi.number,easing:Fi.oneOfType([Fi.string,Fi.func]),steps:Fi.arrayOf(Fi.shape({duration:Fi.number.isRequired,style:Fi.object.isRequired,easing:Fi.oneOfType([Fi.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Fi.func]),properties:Fi.arrayOf("string"),onAnimationEnd:Fi.func})),children:Fi.oneOfType([Fi.node,Fi.func]),isActive:Fi.bool,canBegin:Fi.bool,onAnimationEnd:Fi.func,shouldReAnimate:Fi.bool,onAnimationStart:Fi.func,onAnimationReStart:Fi.func};function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y0(e)}function Yw(){return Yw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Yw.apply(this,arguments)}function rIe(e,t){return sIe(e)||oIe(e,t)||iIe(e,t)||nIe()}function nIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iIe(e,t){if(e){if(typeof e=="string")return kB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kB(e,t)}}function kB(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function oIe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function sIe(e){if(Array.isArray(e))return e}function jB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function LB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jB(Object(n),!0).forEach(function(s){aIe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function aIe(e,t,n){return t=lIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lIe(e){var t=cIe(e,"string");return y0(t)=="symbol"?t:t+""}function cIe(e,t){if(y0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(y0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var NB=function(t,n,s,h,m){var _=Math.min(Math.abs(s)/2,Math.abs(h)/2),i=h>=0?1:-1,S=s>=0?1:-1,A=h>=0&&s>=0||h<0&&s<0?1:0,I;if(_>0&&m instanceof Array){for(var M=[0,0,0,0],L=0,z=4;L<z;L++)M[L]=m[L]>_?_:m[L];I="M".concat(t,",").concat(n+i*M[0]),M[0]>0&&(I+="A ".concat(M[0],",").concat(M[0],",0,0,").concat(A,",").concat(t+S*M[0],",").concat(n)),I+="L ".concat(t+s-S*M[1],",").concat(n),M[1]>0&&(I+="A ".concat(M[1],",").concat(M[1],",0,0,").concat(A,`,
        `).concat(t+s,",").concat(n+i*M[1])),I+="L ".concat(t+s,",").concat(n+h-i*M[2]),M[2]>0&&(I+="A ".concat(M[2],",").concat(M[2],",0,0,").concat(A,`,
        `).concat(t+s-S*M[2],",").concat(n+h)),I+="L ".concat(t+S*M[3],",").concat(n+h),M[3]>0&&(I+="A ".concat(M[3],",").concat(M[3],",0,0,").concat(A,`,
        `).concat(t,",").concat(n+h-i*M[3])),I+="Z"}else if(_>0&&m===+m&&m>0){var G=Math.min(_,m);I="M ".concat(t,",").concat(n+i*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(A,",").concat(t+S*G,",").concat(n,`
            L `).concat(t+s-S*G,",").concat(n,`
            A `).concat(G,",").concat(G,",0,0,").concat(A,",").concat(t+s,",").concat(n+i*G,`
            L `).concat(t+s,",").concat(n+h-i*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(A,",").concat(t+s-S*G,",").concat(n+h,`
            L `).concat(t+S*G,",").concat(n+h,`
            A `).concat(G,",").concat(G,",0,0,").concat(A,",").concat(t,",").concat(n+h-i*G," Z")}else I="M ".concat(t,",").concat(n," h ").concat(s," v ").concat(h," h ").concat(-s," Z");return I},uIe=function(t,n){if(!t||!n)return!1;var s=t.x,h=t.y,m=n.x,_=n.y,i=n.width,S=n.height;if(Math.abs(i)>0&&Math.abs(S)>0){var A=Math.min(m,m+i),I=Math.max(m,m+i),M=Math.min(_,_+S),L=Math.max(_,_+S);return s>=A&&s<=I&&h>=M&&h<=L}return!1},hIe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},GO=function(t){var n=LB(LB({},hIe),t),s=B.useRef(),h=B.useState(-1),m=rIe(h,2),_=m[0],i=m[1];B.useEffect(function(){if(s.current&&s.current.getTotalLength)try{var ie=s.current.getTotalLength();ie&&i(ie)}catch{}},[]);var S=n.x,A=n.y,I=n.width,M=n.height,L=n.radius,z=n.className,G=n.animationEasing,F=n.animationDuration,U=n.animationBegin,K=n.isAnimationActive,J=n.isUpdateAnimationActive;if(S!==+S||A!==+A||I!==+I||M!==+M||I===0||M===0)return null;var X=Ei("recharts-rectangle",z);return J?$e.createElement(Hu,{canBegin:_>0,from:{width:I,height:M,x:S,y:A},to:{width:I,height:M,x:S,y:A},duration:F,animationEasing:G,isActive:J},function(ie){var Q=ie.width,ae=ie.height,pe=ie.x,Pe=ie.y;return $e.createElement(Hu,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:U,duration:F,isActive:K,easing:G},$e.createElement("path",Yw({},Si(n,!0),{className:X,d:NB(pe,Pe,Q,ae,L),ref:s})))}):$e.createElement("path",Yw({},Si(n,!0),{className:X,d:NB(S,A,I,M,L)}))};function tI(){return tI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},tI.apply(this,arguments)}var HO=function(t){var n=t.cx,s=t.cy,h=t.r,m=t.className,_=Ei("recharts-dot",m);return n===+n&&s===+s&&h===+h?B.createElement("circle",tI({},Si(t,!1),gw(t),{className:_,cx:n,cy:s,r:h})):null};function _0(e){"@babel/helpers - typeof";return _0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_0(e)}var dIe=["x","y","top","left","width","height","className"];function rI(){return rI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},rI.apply(this,arguments)}function zB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function fIe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zB(Object(n),!0).forEach(function(s){pIe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pIe(e,t,n){return t=mIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mIe(e){var t=gIe(e,"string");return _0(t)=="symbol"?t:t+""}function gIe(e,t){if(_0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(_0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function yIe(e,t){if(e==null)return{};var n=_Ie(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function _Ie(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}var vIe=function(t,n,s,h,m,_){return"M".concat(t,",").concat(m,"v").concat(h,"M").concat(_,",").concat(n,"h").concat(s)},xIe=function(t){var n=t.x,s=n===void 0?0:n,h=t.y,m=h===void 0?0:h,_=t.top,i=_===void 0?0:_,S=t.left,A=S===void 0?0:S,I=t.width,M=I===void 0?0:I,L=t.height,z=L===void 0?0:L,G=t.className,F=yIe(t,dIe),U=fIe({x:s,y:m,top:i,left:A,width:M,height:z},F);return!wr(s)||!wr(m)||!wr(M)||!wr(z)||!wr(i)||!wr(A)?null:$e.createElement("path",rI({},Si(U,!0),{className:Ei("recharts-cross",G),d:vIe(s,m,M,z,i,A)}))},bIe=Y6,wIe=bIe(Object.getPrototypeOf,Object),TIe=wIe,SIe=Zu,EIe=TIe,AIe=Xu,PIe="[object Object]",CIe=Function.prototype,IIe=Object.prototype,zG=CIe.toString,MIe=IIe.hasOwnProperty,OIe=zG.call(Object);function RIe(e){if(!AIe(e)||SIe(e)!=PIe)return!1;var t=EIe(e);if(t===null)return!0;var n=MIe.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&zG.call(n)==OIe}var DIe=RIe;const kIe=Bi(DIe);var jIe=Zu,LIe=Xu,NIe="[object Boolean]";function zIe(e){return e===!0||e===!1||LIe(e)&&jIe(e)==NIe}var FIe=zIe;const BIe=Bi(FIe);function v0(e){"@babel/helpers - typeof";return v0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v0(e)}function Jw(){return Jw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Jw.apply(this,arguments)}function VIe(e,t){return HIe(e)||GIe(e,t)||UIe(e,t)||$Ie()}function $Ie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function UIe(e,t){if(e){if(typeof e=="string")return FB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return FB(e,t)}}function FB(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function GIe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function HIe(e){if(Array.isArray(e))return e}function BB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function VB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BB(Object(n),!0).forEach(function(s){WIe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function WIe(e,t,n){return t=qIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qIe(e){var t=ZIe(e,"string");return v0(t)=="symbol"?t:t+""}function ZIe(e,t){if(v0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(v0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $B=function(t,n,s,h,m){var _=s-h,i;return i="M ".concat(t,",").concat(n),i+="L ".concat(t+s,",").concat(n),i+="L ".concat(t+s-_/2,",").concat(n+m),i+="L ".concat(t+s-_/2-h,",").concat(n+m),i+="L ".concat(t,",").concat(n," Z"),i},XIe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},KIe=function(t){var n=VB(VB({},XIe),t),s=B.useRef(),h=B.useState(-1),m=VIe(h,2),_=m[0],i=m[1];B.useEffect(function(){if(s.current&&s.current.getTotalLength)try{var X=s.current.getTotalLength();X&&i(X)}catch{}},[]);var S=n.x,A=n.y,I=n.upperWidth,M=n.lowerWidth,L=n.height,z=n.className,G=n.animationEasing,F=n.animationDuration,U=n.animationBegin,K=n.isUpdateAnimationActive;if(S!==+S||A!==+A||I!==+I||M!==+M||L!==+L||I===0&&M===0||L===0)return null;var J=Ei("recharts-trapezoid",z);return K?$e.createElement(Hu,{canBegin:_>0,from:{upperWidth:0,lowerWidth:0,height:L,x:S,y:A},to:{upperWidth:I,lowerWidth:M,height:L,x:S,y:A},duration:F,animationEasing:G,isActive:K},function(X){var ie=X.upperWidth,Q=X.lowerWidth,ae=X.height,pe=X.x,Pe=X.y;return $e.createElement(Hu,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:U,duration:F,easing:G},$e.createElement("path",Jw({},Si(n,!0),{className:J,d:$B(pe,Pe,ie,Q,ae),ref:s})))}):$e.createElement("g",null,$e.createElement("path",Jw({},Si(n,!0),{className:J,d:$B(S,A,I,M,L)})))},YIe=["option","shapeType","propTransformer","activeClassName","isActive"];function x0(e){"@babel/helpers - typeof";return x0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x0(e)}function JIe(e,t){if(e==null)return{};var n=QIe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function QIe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function UB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Qw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UB(Object(n),!0).forEach(function(s){eMe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function eMe(e,t,n){return t=tMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tMe(e){var t=rMe(e,"string");return x0(t)=="symbol"?t:t+""}function rMe(e,t){if(x0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(x0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function nMe(e,t){return Qw(Qw({},t),e)}function iMe(e,t){return e==="symbols"}function GB(e){var t=e.shapeType,n=e.elementProps;switch(t){case"rectangle":return $e.createElement(GO,n);case"trapezoid":return $e.createElement(KIe,n);case"sector":return $e.createElement(PG,n);case"symbols":if(iMe(t))return $e.createElement(cO,n);break;default:return null}}function oMe(e){return B.isValidElement(e)?e.props:e}function sMe(e){var t=e.option,n=e.shapeType,s=e.propTransformer,h=s===void 0?nMe:s,m=e.activeClassName,_=m===void 0?"recharts-active-shape":m,i=e.isActive,S=JIe(e,YIe),A;if(B.isValidElement(t))A=B.cloneElement(t,Qw(Qw({},S),oMe(t)));else if(ai(t))A=t(S);else if(kIe(t)&&!BIe(t)){var I=h(t,S);A=$e.createElement(GB,{shapeType:n,elementProps:I})}else{var M=S;A=$e.createElement(GB,{shapeType:n,elementProps:M})}return i?$e.createElement(Bo,{className:_},A):A}function CS(e,t){return t!=null&&"trapezoids"in e.props}function IS(e,t){return t!=null&&"sectors"in e.props}function b0(e,t){return t!=null&&"points"in e.props}function aMe(e,t){var n,s,h=e.x===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.x)||e.x===t.x,m=e.y===(t==null||(s=t.labelViewBox)===null||s===void 0?void 0:s.y)||e.y===t.y;return h&&m}function lMe(e,t){var n=e.endAngle===t.endAngle,s=e.startAngle===t.startAngle;return n&&s}function cMe(e,t){var n=e.x===t.x,s=e.y===t.y,h=e.z===t.z;return n&&s&&h}function uMe(e,t){var n;return CS(e,t)?n=aMe:IS(e,t)?n=lMe:b0(e,t)&&(n=cMe),n}function hMe(e,t){var n;return CS(e,t)?n="trapezoids":IS(e,t)?n="sectors":b0(e,t)&&(n="points"),n}function dMe(e,t){if(CS(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}if(IS(e,t)){var s;return(s=t.tooltipPayload)===null||s===void 0||(s=s[0])===null||s===void 0||(s=s.payload)===null||s===void 0?void 0:s.payload}return b0(e,t)?t.payload:{}}function fMe(e){var t=e.activeTooltipItem,n=e.graphicalItem,s=e.itemData,h=hMe(n,t),m=dMe(n,t),_=s.filter(function(S,A){var I=ES(m,S),M=n.props[h].filter(function(G){var F=uMe(n,t);return F(G,t)}),L=n.props[h].indexOf(M[M.length-1]),z=A===L;return I&&z}),i=s.indexOf(_[_.length-1]);return i}var pMe=Math.ceil,mMe=Math.max;function gMe(e,t,n,s){for(var h=-1,m=mMe(pMe((t-e)/(n||1)),0),_=Array(m);m--;)_[s?m:++h]=e,e+=n;return _}var yMe=gMe,_Me=g8,HB=1/0,vMe=17976931348623157e292;function xMe(e){if(!e)return e===0?e:0;if(e=_Me(e),e===HB||e===-HB){var t=e<0?-1:1;return t*vMe}return e===e?e:0}var FG=xMe,bMe=yMe,wMe=gS,XA=FG;function TMe(e){return function(t,n,s){return s&&typeof s!="number"&&wMe(t,n,s)&&(n=s=void 0),t=XA(t),n===void 0?(n=t,t=0):n=XA(n),s=s===void 0?t<n?1:-1:XA(s),bMe(t,n,s,e)}}var SMe=TMe,EMe=SMe,AMe=EMe(),PMe=AMe;const eT=Bi(PMe);function w0(e){"@babel/helpers - typeof";return w0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w0(e)}function WB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function qB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WB(Object(n),!0).forEach(function(s){BG(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function BG(e,t,n){return t=CMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CMe(e){var t=IMe(e,"string");return w0(t)=="symbol"?t:t+""}function IMe(e,t){if(w0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(w0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var MMe=["Webkit","Moz","O","ms"],OMe=function(t,n){var s=t.replace(/(\w)/,function(m){return m.toUpperCase()}),h=MMe.reduce(function(m,_){return qB(qB({},m),{},BG({},_+s,n))},{});return h[t]=n,h};function wg(e){"@babel/helpers - typeof";return wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wg(e)}function tT(){return tT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},tT.apply(this,arguments)}function ZB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function KA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZB(Object(n),!0).forEach(function(s){La(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function RMe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XB(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,$G(s.key),s)}}function DMe(e,t,n){return t&&XB(e.prototype,t),n&&XB(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kMe(e,t,n){return t=rT(t),jMe(e,VG()?Reflect.construct(t,n||[],rT(e).constructor):t.apply(e,n))}function jMe(e,t){if(t&&(wg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LMe(e)}function LMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function VG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VG=function(){return!!e})()}function rT(e){return rT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},rT(e)}function NMe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nI(e,t)}function nI(e,t){return nI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},nI(e,t)}function La(e,t,n){return t=$G(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $G(e){var t=zMe(e,"string");return wg(t)=="symbol"?t:t+""}function zMe(e,t){if(wg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(wg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var FMe=function(t){var n=t.data,s=t.startIndex,h=t.endIndex,m=t.x,_=t.width,i=t.travellerWidth;if(!n||!n.length)return{};var S=n.length,A=Dv().domain(eT(0,S)).range([m,m+_-i]),I=A.domain().map(function(M){return A(M)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:A(s),endX:A(h),scale:A,scaleValues:I}},KB=function(t){return t.changedTouches&&!!t.changedTouches.length},Tg=function(e){function t(n){var s;return RMe(this,t),s=kMe(this,t,[n]),La(s,"handleDrag",function(h){s.leaveTimer&&(clearTimeout(s.leaveTimer),s.leaveTimer=null),s.state.isTravellerMoving?s.handleTravellerMove(h):s.state.isSlideMoving&&s.handleSlideDrag(h)}),La(s,"handleTouchMove",function(h){h.changedTouches!=null&&h.changedTouches.length>0&&s.handleDrag(h.changedTouches[0])}),La(s,"handleDragEnd",function(){s.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var h=s.props,m=h.endIndex,_=h.onDragEnd,i=h.startIndex;_?.({endIndex:m,startIndex:i})}),s.detachDragEndListener()}),La(s,"handleLeaveWrapper",function(){(s.state.isTravellerMoving||s.state.isSlideMoving)&&(s.leaveTimer=window.setTimeout(s.handleDragEnd,s.props.leaveTimeOut))}),La(s,"handleEnterSlideOrTraveller",function(){s.setState({isTextActive:!0})}),La(s,"handleLeaveSlideOrTraveller",function(){s.setState({isTextActive:!1})}),La(s,"handleSlideDragStart",function(h){var m=KB(h)?h.changedTouches[0]:h;s.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:m.pageX}),s.attachDragEndListener()}),s.travellerDragStartHandlers={startX:s.handleTravellerDragStart.bind(s,"startX"),endX:s.handleTravellerDragStart.bind(s,"endX")},s.state={},s}return NMe(t,e),DMe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(s){var h=s.startX,m=s.endX,_=this.state.scaleValues,i=this.props,S=i.gap,A=i.data,I=A.length-1,M=Math.min(h,m),L=Math.max(h,m),z=t.getIndexInRange(_,M),G=t.getIndexInRange(_,L);return{startIndex:z-z%S,endIndex:G===I?I:G-G%S}}},{key:"getTextOfTick",value:function(s){var h=this.props,m=h.data,_=h.tickFormatter,i=h.dataKey,S=Va(m[s],i,s);return ai(_)?_(S,s):S}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(s){var h=this.state,m=h.slideMoveStartX,_=h.startX,i=h.endX,S=this.props,A=S.x,I=S.width,M=S.travellerWidth,L=S.startIndex,z=S.endIndex,G=S.onChange,F=s.pageX-m;F>0?F=Math.min(F,A+I-M-i,A+I-M-_):F<0&&(F=Math.max(F,A-_,A-i));var U=this.getIndex({startX:_+F,endX:i+F});(U.startIndex!==L||U.endIndex!==z)&&G&&G(U),this.setState({startX:_+F,endX:i+F,slideMoveStartX:s.pageX})}},{key:"handleTravellerDragStart",value:function(s,h){var m=KB(h)?h.changedTouches[0]:h;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:s,brushMoveStartX:m.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(s){var h=this.state,m=h.brushMoveStartX,_=h.movingTravellerId,i=h.endX,S=h.startX,A=this.state[_],I=this.props,M=I.x,L=I.width,z=I.travellerWidth,G=I.onChange,F=I.gap,U=I.data,K={startX:this.state.startX,endX:this.state.endX},J=s.pageX-m;J>0?J=Math.min(J,M+L-z-A):J<0&&(J=Math.max(J,M-A)),K[_]=A+J;var X=this.getIndex(K),ie=X.startIndex,Q=X.endIndex,ae=function(){var Pe=U.length-1;return _==="startX"&&(i>S?ie%F===0:Q%F===0)||i<S&&Q===Pe||_==="endX"&&(i>S?Q%F===0:ie%F===0)||i>S&&Q===Pe};this.setState(La(La({},_,A+J),"brushMoveStartX",s.pageX),function(){G&&ae()&&G(X)})}},{key:"handleTravellerMoveKeyboard",value:function(s,h){var m=this,_=this.state,i=_.scaleValues,S=_.startX,A=_.endX,I=this.state[h],M=i.indexOf(I);if(M!==-1){var L=M+s;if(!(L===-1||L>=i.length)){var z=i[L];h==="startX"&&z>=A||h==="endX"&&z<=S||this.setState(La({},h,z),function(){m.props.onChange(m.getIndex({startX:m.state.startX,endX:m.state.endX}))})}}}},{key:"renderBackground",value:function(){var s=this.props,h=s.x,m=s.y,_=s.width,i=s.height,S=s.fill,A=s.stroke;return $e.createElement("rect",{stroke:A,fill:S,x:h,y:m,width:_,height:i})}},{key:"renderPanorama",value:function(){var s=this.props,h=s.x,m=s.y,_=s.width,i=s.height,S=s.data,A=s.children,I=s.padding,M=B.Children.only(A);return M?$e.cloneElement(M,{x:h,y:m,width:_,height:i,margin:I,compact:!0,data:S}):null}},{key:"renderTravellerLayer",value:function(s,h){var m,_,i=this,S=this.props,A=S.y,I=S.travellerWidth,M=S.height,L=S.traveller,z=S.ariaLabel,G=S.data,F=S.startIndex,U=S.endIndex,K=Math.max(s,this.props.x),J=KA(KA({},Si(this.props,!1)),{},{x:K,y:A,width:I,height:M}),X=z||"Min value: ".concat((m=G[F])===null||m===void 0?void 0:m.name,", Max value: ").concat((_=G[U])===null||_===void 0?void 0:_.name);return $e.createElement(Bo,{tabIndex:0,role:"slider","aria-label":X,"aria-valuenow":s,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[h],onTouchStart:this.travellerDragStartHandlers[h],onKeyDown:function(Q){["ArrowLeft","ArrowRight"].includes(Q.key)&&(Q.preventDefault(),Q.stopPropagation(),i.handleTravellerMoveKeyboard(Q.key==="ArrowRight"?1:-1,h))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(L,J))}},{key:"renderSlide",value:function(s,h){var m=this.props,_=m.y,i=m.height,S=m.stroke,A=m.travellerWidth,I=Math.min(s,h)+A,M=Math.max(Math.abs(h-s)-A,0);return $e.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:S,fillOpacity:.2,x:I,y:_,width:M,height:i})}},{key:"renderText",value:function(){var s=this.props,h=s.startIndex,m=s.endIndex,_=s.y,i=s.height,S=s.travellerWidth,A=s.stroke,I=this.state,M=I.startX,L=I.endX,z=5,G={pointerEvents:"none",fill:A};return $e.createElement(Bo,{className:"recharts-brush-texts"},$e.createElement(Ow,tT({textAnchor:"end",verticalAnchor:"middle",x:Math.min(M,L)-z,y:_+i/2},G),this.getTextOfTick(h)),$e.createElement(Ow,tT({textAnchor:"start",verticalAnchor:"middle",x:Math.max(M,L)+S+z,y:_+i/2},G),this.getTextOfTick(m)))}},{key:"render",value:function(){var s=this.props,h=s.data,m=s.className,_=s.children,i=s.x,S=s.y,A=s.width,I=s.height,M=s.alwaysShowText,L=this.state,z=L.startX,G=L.endX,F=L.isTextActive,U=L.isSlideMoving,K=L.isTravellerMoving,J=L.isTravellerFocused;if(!h||!h.length||!wr(i)||!wr(S)||!wr(A)||!wr(I)||A<=0||I<=0)return null;var X=Ei("recharts-brush",m),ie=$e.Children.count(_)===1,Q=OMe("userSelect","none");return $e.createElement(Bo,{className:X,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Q},this.renderBackground(),ie&&this.renderPanorama(),this.renderSlide(z,G),this.renderTravellerLayer(z,"startX"),this.renderTravellerLayer(G,"endX"),(F||U||K||J||M)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(s){var h=s.x,m=s.y,_=s.width,i=s.height,S=s.stroke,A=Math.floor(m+i/2)-1;return $e.createElement($e.Fragment,null,$e.createElement("rect",{x:h,y:m,width:_,height:i,fill:S,stroke:"none"}),$e.createElement("line",{x1:h+1,y1:A,x2:h+_-1,y2:A,fill:"none",stroke:"#fff"}),$e.createElement("line",{x1:h+1,y1:A+2,x2:h+_-1,y2:A+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(s,h){var m;return $e.isValidElement(s)?m=$e.cloneElement(s,h):ai(s)?m=s(h):m=t.renderDefaultTraveller(h),m}},{key:"getDerivedStateFromProps",value:function(s,h){var m=s.data,_=s.width,i=s.x,S=s.travellerWidth,A=s.updateId,I=s.startIndex,M=s.endIndex;if(m!==h.prevData||A!==h.prevUpdateId)return KA({prevData:m,prevTravellerWidth:S,prevUpdateId:A,prevX:i,prevWidth:_},m&&m.length?FMe({data:m,width:_,x:i,travellerWidth:S,startIndex:I,endIndex:M}):{scale:null,scaleValues:null});if(h.scale&&(_!==h.prevWidth||i!==h.prevX||S!==h.prevTravellerWidth)){h.scale.range([i,i+_-S]);var L=h.scale.domain().map(function(z){return h.scale(z)});return{prevData:m,prevTravellerWidth:S,prevUpdateId:A,prevX:i,prevWidth:_,startX:h.scale(s.startIndex),endX:h.scale(s.endIndex),scaleValues:L}}return null}},{key:"getIndexInRange",value:function(s,h){for(var m=s.length,_=0,i=m-1;i-_>1;){var S=Math.floor((_+i)/2);s[S]>h?i=S:_=S}return h>=s[i]?i:_}}])}(B.PureComponent);La(Tg,"displayName","Brush");La(Tg,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var BMe=gO;function VMe(e,t){var n;return BMe(e,function(s,h,m){return n=t(s,h,m),!n}),!!n}var $Me=VMe,UMe=U6,GMe=td,HMe=$Me,WMe=xa,qMe=gS;function ZMe(e,t,n){var s=WMe(e)?UMe:HMe;return n&&qMe(e,t,n)&&(t=void 0),s(e,GMe(t))}var XMe=ZMe;const KMe=Bi(XMe);var Wc=function(t,n){var s=t.alwaysShow,h=t.ifOverflow;return s&&(h="extendDomain"),h===n},YB=h8;function YMe(e,t,n){t=="__proto__"&&YB?YB(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var JMe=YMe,QMe=JMe,eOe=c8,tOe=td;function rOe(e,t){var n={};return t=tOe(t),eOe(e,function(s,h,m){QMe(n,h,t(s,h,m))}),n}var nOe=rOe;const iOe=Bi(nOe);function oOe(e,t){for(var n=-1,s=e==null?0:e.length;++n<s;)if(!t(e[n],n,e))return!1;return!0}var sOe=oOe,aOe=gO;function lOe(e,t){var n=!0;return aOe(e,function(s,h,m){return n=!!t(s,h,m),n}),n}var cOe=lOe,uOe=sOe,hOe=cOe,dOe=td,fOe=xa,pOe=gS;function mOe(e,t,n){var s=fOe(e)?uOe:hOe;return n&&pOe(e,t,n)&&(t=void 0),s(e,dOe(t))}var gOe=mOe;const UG=Bi(gOe);var yOe=["x","y"];function T0(e){"@babel/helpers - typeof";return T0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T0(e)}function iI(){return iI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},iI.apply(this,arguments)}function JB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function _v(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JB(Object(n),!0).forEach(function(s){_Oe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JB(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function _Oe(e,t,n){return t=vOe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vOe(e){var t=xOe(e,"string");return T0(t)=="symbol"?t:t+""}function xOe(e,t){if(T0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(T0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bOe(e,t){if(e==null)return{};var n=wOe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function wOe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function TOe(e,t){var n=e.x,s=e.y,h=bOe(e,yOe),m="".concat(n),_=parseInt(m,10),i="".concat(s),S=parseInt(i,10),A="".concat(t.height||h.height),I=parseInt(A,10),M="".concat(t.width||h.width),L=parseInt(M,10);return _v(_v(_v(_v(_v({},t),h),_?{x:_}:{}),S?{y:S}:{}),{},{height:I,width:L,name:t.name,radius:t.radius})}function QB(e){return $e.createElement(sMe,iI({shapeType:"rectangle",propTransformer:TOe,activeClassName:"recharts-active-bar"},e))}var SOe=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(s,h){if(typeof t=="number")return t;var m=wr(s)||Vfe(s);return m?t(s,h):(m||Of(),n)}},EOe=["value","background"],GG;function Sg(e){"@babel/helpers - typeof";return Sg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sg(e)}function AOe(e,t){if(e==null)return{};var n=POe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function POe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function nT(){return nT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},nT.apply(this,arguments)}function e5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Zo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e5(Object(n),!0).forEach(function(s){Bh(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function COe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t5(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,WG(s.key),s)}}function IOe(e,t,n){return t&&t5(e.prototype,t),n&&t5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function MOe(e,t,n){return t=iT(t),OOe(e,HG()?Reflect.construct(t,n||[],iT(e).constructor):t.apply(e,n))}function OOe(e,t){if(t&&(Sg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ROe(e)}function ROe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HG=function(){return!!e})()}function iT(e){return iT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},iT(e)}function DOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oI(e,t)}function oI(e,t){return oI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},oI(e,t)}function Bh(e,t,n){return t=WG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WG(e){var t=kOe(e,"string");return Sg(t)=="symbol"?t:t+""}function kOe(e,t){if(Sg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Sg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Vf=function(e){function t(){var n;COe(this,t);for(var s=arguments.length,h=new Array(s),m=0;m<s;m++)h[m]=arguments[m];return n=MOe(this,t,[].concat(h)),Bh(n,"state",{isAnimationFinished:!1}),Bh(n,"id",q0("recharts-bar-")),Bh(n,"handleAnimationEnd",function(){var _=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),_&&_()}),Bh(n,"handleAnimationStart",function(){var _=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),_&&_()}),n}return DOe(t,e),IOe(t,[{key:"renderRectanglesStatically",value:function(s){var h=this,m=this.props,_=m.shape,i=m.dataKey,S=m.activeIndex,A=m.activeBar,I=Si(this.props,!1);return s&&s.map(function(M,L){var z=L===S,G=z?A:_,F=Zo(Zo(Zo({},I),M),{},{isActive:z,option:G,index:L,dataKey:i,onAnimationStart:h.handleAnimationStart,onAnimationEnd:h.handleAnimationEnd});return $e.createElement(Bo,nT({className:"recharts-bar-rectangle"},yw(h.props,M,L),{key:"rectangle-".concat(M?.x,"-").concat(M?.y,"-").concat(M?.value,"-").concat(L)}),$e.createElement(QB,F))})}},{key:"renderRectanglesWithAnimation",value:function(){var s=this,h=this.props,m=h.data,_=h.layout,i=h.isAnimationActive,S=h.animationBegin,A=h.animationDuration,I=h.animationEasing,M=h.animationId,L=this.state.prevData;return $e.createElement(Hu,{begin:S,duration:A,isActive:i,easing:I,from:{t:0},to:{t:1},key:"bar-".concat(M),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(z){var G=z.t,F=m.map(function(U,K){var J=L&&L[K];if(J){var X=ec(J.x,U.x),ie=ec(J.y,U.y),Q=ec(J.width,U.width),ae=ec(J.height,U.height);return Zo(Zo({},U),{},{x:X(G),y:ie(G),width:Q(G),height:ae(G)})}if(_==="horizontal"){var pe=ec(0,U.height),Pe=pe(G);return Zo(Zo({},U),{},{y:U.y+U.height-Pe,height:Pe})}var Fe=ec(0,U.width),tt=Fe(G);return Zo(Zo({},U),{},{width:tt})});return $e.createElement(Bo,null,s.renderRectanglesStatically(F))})}},{key:"renderRectangles",value:function(){var s=this.props,h=s.data,m=s.isAnimationActive,_=this.state.prevData;return m&&h&&h.length&&(!_||!ES(_,h))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(h)}},{key:"renderBackground",value:function(){var s=this,h=this.props,m=h.data,_=h.dataKey,i=h.activeIndex,S=Si(this.props.background,!1);return m.map(function(A,I){A.value;var M=A.background,L=AOe(A,EOe);if(!M)return null;var z=Zo(Zo(Zo(Zo(Zo({},L),{},{fill:"#eee"},M),S),yw(s.props,A,I)),{},{onAnimationStart:s.handleAnimationStart,onAnimationEnd:s.handleAnimationEnd,dataKey:_,index:I,className:"recharts-bar-background-rectangle"});return $e.createElement(QB,nT({key:"background-bar-".concat(I),option:s.props.background,isActive:I===i},z))})}},{key:"renderErrorBar",value:function(s,h){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var m=this.props,_=m.data,i=m.xAxis,S=m.yAxis,A=m.layout,I=m.children,M=gl(I,Q0);if(!M)return null;var L=A==="vertical"?_[0].height/2:_[0].width/2,z=function(U,K){var J=Array.isArray(U.value)?U.value[1]:U.value;return{x:U.x,y:U.y,value:J,errorVal:Va(U,K)}},G={clipPath:s?"url(#clipPath-".concat(h,")"):null};return $e.createElement(Bo,G,M.map(function(F){return $e.cloneElement(F,{key:"error-bar-".concat(h,"-").concat(F.props.dataKey),data:_,xAxis:i,yAxis:S,layout:A,offset:L,dataPointFormatter:z})}))}},{key:"render",value:function(){var s=this.props,h=s.hide,m=s.data,_=s.className,i=s.xAxis,S=s.yAxis,A=s.left,I=s.top,M=s.width,L=s.height,z=s.isAnimationActive,G=s.background,F=s.id;if(h||!m||!m.length)return null;var U=this.state.isAnimationFinished,K=Ei("recharts-bar",_),J=i&&i.allowDataOverflow,X=S&&S.allowDataOverflow,ie=J||X,Q=mi(F)?this.id:F;return $e.createElement(Bo,{className:K},J||X?$e.createElement("defs",null,$e.createElement("clipPath",{id:"clipPath-".concat(Q)},$e.createElement("rect",{x:J?A:A-M/2,y:X?I:I-L/2,width:J?M:M*2,height:X?L:L*2}))):null,$e.createElement(Bo,{className:"recharts-bar-rectangles",clipPath:ie?"url(#clipPath-".concat(Q,")"):null},G?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(ie,Q),(!z||U)&&Gh.renderCallByParent(this.props,m))}}],[{key:"getDerivedStateFromProps",value:function(s,h){return s.animationId!==h.prevAnimationId?{prevAnimationId:s.animationId,curData:s.data,prevData:h.curData}:s.data!==h.curData?{curData:s.data}:null}}])}(B.PureComponent);GG=Vf;Bh(Vf,"displayName","Bar");Bh(Vf,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Lu.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Bh(Vf,"getComposedData",function(e){var t=e.props,n=e.item,s=e.barPosition,h=e.bandSize,m=e.xAxis,_=e.yAxis,i=e.xAxisTicks,S=e.yAxisTicks,A=e.stackedData,I=e.dataStartIndex,M=e.displayedData,L=e.offset,z=uAe(s,n);if(!z)return null;var G=t.layout,F=n.type.defaultProps,U=F!==void 0?Zo(Zo({},F),n.props):n.props,K=U.dataKey,J=U.children,X=U.minPointSize,ie=G==="horizontal"?_:m,Q=A?ie.scale.domain():null,ae=_Ae({numericAxis:ie}),pe=gl(J,_8),Pe=M.map(function(Fe,tt){var Be,Ge,Qe,Ke,ct,He;A?Be=hAe(A[I+tt],Q):(Be=Va(Fe,K),Array.isArray(Be)||(Be=[ae,Be]));var qe=SOe(X,GG.defaultProps.minPointSize)(Be[1],tt);if(G==="horizontal"){var ut,nt=[_.scale(Be[0]),_.scale(Be[1])],Kt=nt[0],cr=nt[1];Ge=eB({axis:m,ticks:i,bandSize:h,offset:z.offset,entry:Fe,index:tt}),Qe=(ut=cr??Kt)!==null&&ut!==void 0?ut:void 0,Ke=z.size;var Bt=Kt-cr;if(ct=Number.isNaN(Bt)?0:Bt,He={x:Ge,y:_.y,width:Ke,height:_.height},Math.abs(qe)>0&&Math.abs(ct)<Math.abs(qe)){var Vt=ic(ct||qe)*(Math.abs(qe)-Math.abs(ct));Qe-=Vt,ct+=Vt}}else{var xr=[m.scale(Be[0]),m.scale(Be[1])],nn=xr[0],Hn=xr[1];if(Ge=nn,Qe=eB({axis:_,ticks:S,bandSize:h,offset:z.offset,entry:Fe,index:tt}),Ke=Hn-nn,ct=z.size,He={x:m.x,y:Qe,width:m.width,height:ct},Math.abs(qe)>0&&Math.abs(Ke)<Math.abs(qe)){var lr=ic(Ke||qe)*(Math.abs(qe)-Math.abs(Ke));Ke+=lr}}return Zo(Zo(Zo({},Fe),{},{x:Ge,y:Qe,width:Ke,height:ct,value:A?Be:Be[1],payload:Fe,background:He},pe&&pe[tt]&&pe[tt].props),{},{tooltipPayload:[SG(n,Fe)],tooltipPosition:{x:Ge+Ke/2,y:Qe+ct/2}})});return Zo({data:Pe,layout:G},L)});function S0(e){"@babel/helpers - typeof";return S0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S0(e)}function jOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r5(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,qG(s.key),s)}}function LOe(e,t,n){return t&&r5(e.prototype,t),n&&r5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function n5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Jl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(n),!0).forEach(function(s){MS(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function MS(e,t,n){return t=qG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qG(e){var t=NOe(e,"string");return S0(t)=="symbol"?t:t+""}function NOe(e,t){if(S0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(S0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZG=function(t,n,s,h,m){var _=t.width,i=t.height,S=t.layout,A=t.children,I=Object.keys(n),M={left:s.left,leftMirror:s.left,right:_-s.right,rightMirror:_-s.right,top:s.top,topMirror:s.top,bottom:i-s.bottom,bottomMirror:i-s.bottom},L=!!Na(A,Vf);return I.reduce(function(z,G){var F=n[G],U=F.orientation,K=F.domain,J=F.padding,X=J===void 0?{}:J,ie=F.mirror,Q=F.reversed,ae="".concat(U).concat(ie?"Mirror":""),pe,Pe,Fe,tt,Be;if(F.type==="number"&&(F.padding==="gap"||F.padding==="no-gap")){var Ge=K[1]-K[0],Qe=1/0,Ke=F.categoricalDomain.sort(Gfe);if(Ke.forEach(function(xr,nn){nn>0&&(Qe=Math.min((xr||0)-(Ke[nn-1]||0),Qe))}),Number.isFinite(Qe)){var ct=Qe/Ge,He=F.layout==="vertical"?s.height:s.width;if(F.padding==="gap"&&(pe=ct*He/2),F.padding==="no-gap"){var qe=If(t.barCategoryGap,ct*He),ut=ct*He/2;pe=ut-qe-(ut-qe)/He*qe}}}h==="xAxis"?Pe=[s.left+(X.left||0)+(pe||0),s.left+s.width-(X.right||0)-(pe||0)]:h==="yAxis"?Pe=S==="horizontal"?[s.top+s.height-(X.bottom||0),s.top+(X.top||0)]:[s.top+(X.top||0)+(pe||0),s.top+s.height-(X.bottom||0)-(pe||0)]:Pe=F.range,Q&&(Pe=[Pe[1],Pe[0]]);var nt=lAe(F,m,L),Kt=nt.scale,cr=nt.realScaleType;Kt.domain(K).range(Pe),cAe(Kt);var Bt=yAe(Kt,Jl(Jl({},F),{},{realScaleType:cr}));h==="xAxis"?(Be=U==="top"&&!ie||U==="bottom"&&ie,Fe=s.left,tt=M[ae]-Be*F.height):h==="yAxis"&&(Be=U==="left"&&!ie||U==="right"&&ie,Fe=M[ae]-Be*F.width,tt=s.top);var Vt=Jl(Jl(Jl({},F),Bt),{},{realScaleType:cr,x:Fe,y:tt,scale:Kt,width:h==="xAxis"?s.width:F.width,height:h==="yAxis"?s.height:F.height});return Vt.bandSize=Hw(Vt,Bt),!F.hide&&h==="xAxis"?M[ae]+=(Be?-1:1)*Vt.height:F.hide||(M[ae]+=(Be?-1:1)*Vt.width),Jl(Jl({},z),{},MS({},G,Vt))},{})},XG=function(t,n){var s=t.x,h=t.y,m=n.x,_=n.y;return{x:Math.min(s,m),y:Math.min(h,_),width:Math.abs(m-s),height:Math.abs(_-h)}},zOe=function(t){var n=t.x1,s=t.y1,h=t.x2,m=t.y2;return XG({x:n,y:s},{x:h,y:m})},KG=function(){function e(t){jOe(this,e),this.scale=t}return LOe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=s.bandAware,m=s.position;if(n!==void 0){if(m)switch(m){case"start":return this.scale(n);case"middle":{var _=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+_}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(n)+i}default:return this.scale(n)}if(h){var S=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+S}return this.scale(n)}}},{key:"isInRange",value:function(n){var s=this.range(),h=s[0],m=s[s.length-1];return h<=m?n>=h&&n<=m:n>=m&&n<=h}}],[{key:"create",value:function(n){return new e(n)}}])}();MS(KG,"EPS",1e-4);var WO=function(t){var n=Object.keys(t).reduce(function(s,h){return Jl(Jl({},s),{},MS({},h,KG.create(t[h])))},{});return Jl(Jl({},n),{},{apply:function(h){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=m.bandAware,i=m.position;return iOe(h,function(S,A){return n[A].apply(S,{bandAware:_,position:i})})},isInRange:function(h){return UG(h,function(m,_){return n[_].isInRange(m)})}})};function FOe(e){return(e%180+180)%180}var BOe=function(t){var n=t.width,s=t.height,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=FOe(h),_=m*Math.PI/180,i=Math.atan(s/n),S=_>i&&_<Math.PI-i?s/Math.sin(_):n/Math.cos(_);return Math.abs(S)},VOe=td,$Oe=Z0,UOe=pS;function GOe(e){return function(t,n,s){var h=Object(t);if(!$Oe(t)){var m=VOe(n);t=UOe(t),n=function(i){return m(h[i],i,h)}}var _=e(t,n,s);return _>-1?h[m?t[_]:_]:void 0}}var HOe=GOe,WOe=FG;function qOe(e){var t=WOe(e),n=t%1;return t===t?n?t-n:t:0}var ZOe=qOe,XOe=n8,KOe=td,YOe=ZOe,JOe=Math.max;function QOe(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var h=n==null?0:YOe(n);return h<0&&(h=JOe(s+h,0)),XOe(e,KOe(t),h)}var eRe=QOe,tRe=HOe,rRe=eRe,nRe=tRe(rRe),iRe=nRe;const oRe=Bi(iRe);var sRe=Hde(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),qO=B.createContext(void 0),ZO=B.createContext(void 0),YG=B.createContext(void 0),JG=B.createContext({}),QG=B.createContext(void 0),eH=B.createContext(0),tH=B.createContext(0),i5=function(t){var n=t.state,s=n.xAxisMap,h=n.yAxisMap,m=n.offset,_=t.clipPathId,i=t.children,S=t.width,A=t.height,I=sRe(m);return $e.createElement(qO.Provider,{value:s},$e.createElement(ZO.Provider,{value:h},$e.createElement(JG.Provider,{value:m},$e.createElement(YG.Provider,{value:I},$e.createElement(QG.Provider,{value:_},$e.createElement(eH.Provider,{value:A},$e.createElement(tH.Provider,{value:S},i)))))))},aRe=function(){return B.useContext(QG)},rH=function(t){var n=B.useContext(qO);n==null&&Of();var s=n[t];return s==null&&Of(),s},lRe=function(){var t=B.useContext(qO);return zh(t)},cRe=function(){var t=B.useContext(ZO),n=oRe(t,function(s){return UG(s.domain,Number.isFinite)});return n||zh(t)},nH=function(t){var n=B.useContext(ZO);n==null&&Of();var s=n[t];return s==null&&Of(),s},uRe=function(){var t=B.useContext(YG);return t},hRe=function(){return B.useContext(JG)},XO=function(){return B.useContext(tH)},KO=function(){return B.useContext(eH)};function Eg(e){"@babel/helpers - typeof";return Eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eg(e)}function dRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fRe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,oH(s.key),s)}}function pRe(e,t,n){return t&&fRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function mRe(e,t,n){return t=oT(t),gRe(e,iH()?Reflect.construct(t,n||[],oT(e).constructor):t.apply(e,n))}function gRe(e,t){if(t&&(Eg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yRe(e)}function yRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iH=function(){return!!e})()}function oT(e){return oT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},oT(e)}function _Re(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sI(e,t)}function sI(e,t){return sI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},sI(e,t)}function o5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function s5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o5(Object(n),!0).forEach(function(s){YO(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function YO(e,t,n){return t=oH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oH(e){var t=vRe(e,"string");return Eg(t)=="symbol"?t:t+""}function vRe(e,t){if(Eg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Eg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xRe(e,t){return SRe(e)||TRe(e,t)||wRe(e,t)||bRe()}function bRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wRe(e,t){if(e){if(typeof e=="string")return a5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a5(e,t)}}function a5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function TRe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function SRe(e){if(Array.isArray(e))return e}function aI(){return aI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},aI.apply(this,arguments)}var ERe=function(t,n){var s;return $e.isValidElement(t)?s=$e.cloneElement(t,n):ai(t)?s=t(n):s=$e.createElement("line",aI({},n,{className:"recharts-reference-line-line"})),s},ARe=function(t,n,s,h,m,_,i,S,A){var I=m.x,M=m.y,L=m.width,z=m.height;if(s){var G=A.y,F=t.y.apply(G,{position:_});if(Wc(A,"discard")&&!t.y.isInRange(F))return null;var U=[{x:I+L,y:F},{x:I,y:F}];return S==="left"?U.reverse():U}if(n){var K=A.x,J=t.x.apply(K,{position:_});if(Wc(A,"discard")&&!t.x.isInRange(J))return null;var X=[{x:J,y:M+z},{x:J,y:M}];return i==="top"?X.reverse():X}if(h){var ie=A.segment,Q=ie.map(function(ae){return t.apply(ae,{position:_})});return Wc(A,"discard")&&KMe(Q,function(ae){return!t.isInRange(ae)})?null:Q}return null};function PRe(e){var t=e.x,n=e.y,s=e.segment,h=e.xAxisId,m=e.yAxisId,_=e.shape,i=e.className,S=e.alwaysShow,A=aRe(),I=rH(h),M=nH(m),L=uRe();if(!A||!L)return null;ju(S===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var z=WO({x:I.scale,y:M.scale}),G=cs(t),F=cs(n),U=s&&s.length===2,K=ARe(z,G,F,U,L,e.position,I.orientation,M.orientation,e);if(!K)return null;var J=xRe(K,2),X=J[0],ie=X.x,Q=X.y,ae=J[1],pe=ae.x,Pe=ae.y,Fe=Wc(e,"hidden")?"url(#".concat(A,")"):void 0,tt=s5(s5({clipPath:Fe},Si(e,!0)),{},{x1:ie,y1:Q,x2:pe,y2:Pe});return $e.createElement(Bo,{className:Ei("recharts-reference-line",i)},ERe(_,tt),Bs.renderCallByParent(e,zOe({x1:ie,y1:Q,x2:pe,y2:Pe})))}var JO=function(e){function t(){return dRe(this,t),mRe(this,t,arguments)}return _Re(t,e),pRe(t,[{key:"render",value:function(){return $e.createElement(PRe,this.props)}}])}($e.Component);YO(JO,"displayName","ReferenceLine");YO(JO,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function lI(){return lI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},lI.apply(this,arguments)}function Ag(e){"@babel/helpers - typeof";return Ag=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ag(e)}function l5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function c5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?l5(Object(n),!0).forEach(function(s){OS(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function CRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IRe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,aH(s.key),s)}}function MRe(e,t,n){return t&&IRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ORe(e,t,n){return t=sT(t),RRe(e,sH()?Reflect.construct(t,n||[],sT(e).constructor):t.apply(e,n))}function RRe(e,t){if(t&&(Ag(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DRe(e)}function DRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sH=function(){return!!e})()}function sT(e){return sT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},sT(e)}function kRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&cI(e,t)}function cI(e,t){return cI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},cI(e,t)}function OS(e,t,n){return t=aH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aH(e){var t=jRe(e,"string");return Ag(t)=="symbol"?t:t+""}function jRe(e,t){if(Ag(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Ag(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var LRe=function(t){var n=t.x,s=t.y,h=t.xAxis,m=t.yAxis,_=WO({x:h.scale,y:m.scale}),i=_.apply({x:n,y:s},{bandAware:!0});return Wc(t,"discard")&&!_.isInRange(i)?null:i},RS=function(e){function t(){return CRe(this,t),ORe(this,t,arguments)}return kRe(t,e),MRe(t,[{key:"render",value:function(){var s=this.props,h=s.x,m=s.y,_=s.r,i=s.alwaysShow,S=s.clipPathId,A=cs(h),I=cs(m);if(ju(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!A||!I)return null;var M=LRe(this.props);if(!M)return null;var L=M.x,z=M.y,G=this.props,F=G.shape,U=G.className,K=Wc(this.props,"hidden")?"url(#".concat(S,")"):void 0,J=c5(c5({clipPath:K},Si(this.props,!0)),{},{cx:L,cy:z});return $e.createElement(Bo,{className:Ei("recharts-reference-dot",U)},t.renderDot(F,J),Bs.renderCallByParent(this.props,{x:L-_,y:z-_,width:2*_,height:2*_}))}}])}($e.Component);OS(RS,"displayName","ReferenceDot");OS(RS,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});OS(RS,"renderDot",function(e,t){var n;return $e.isValidElement(e)?n=$e.cloneElement(e,t):ai(e)?n=e(t):n=$e.createElement(HO,lI({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),n});function uI(){return uI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},uI.apply(this,arguments)}function Pg(e){"@babel/helpers - typeof";return Pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pg(e)}function u5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function h5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?u5(Object(n),!0).forEach(function(s){DS(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function NRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zRe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,cH(s.key),s)}}function FRe(e,t,n){return t&&zRe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function BRe(e,t,n){return t=aT(t),VRe(e,lH()?Reflect.construct(t,n||[],aT(e).constructor):t.apply(e,n))}function VRe(e,t){if(t&&(Pg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $Re(e)}function $Re(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lH=function(){return!!e})()}function aT(e){return aT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},aT(e)}function URe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hI(e,t)}function hI(e,t){return hI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},hI(e,t)}function DS(e,t,n){return t=cH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cH(e){var t=GRe(e,"string");return Pg(t)=="symbol"?t:t+""}function GRe(e,t){if(Pg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Pg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var HRe=function(t,n,s,h,m){var _=m.x1,i=m.x2,S=m.y1,A=m.y2,I=m.xAxis,M=m.yAxis;if(!I||!M)return null;var L=WO({x:I.scale,y:M.scale}),z={x:t?L.x.apply(_,{position:"start"}):L.x.rangeMin,y:s?L.y.apply(S,{position:"start"}):L.y.rangeMin},G={x:n?L.x.apply(i,{position:"end"}):L.x.rangeMax,y:h?L.y.apply(A,{position:"end"}):L.y.rangeMax};return Wc(m,"discard")&&(!L.isInRange(z)||!L.isInRange(G))?null:XG(z,G)},kS=function(e){function t(){return NRe(this,t),BRe(this,t,arguments)}return URe(t,e),FRe(t,[{key:"render",value:function(){var s=this.props,h=s.x1,m=s.x2,_=s.y1,i=s.y2,S=s.className,A=s.alwaysShow,I=s.clipPathId;ju(A===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var M=cs(h),L=cs(m),z=cs(_),G=cs(i),F=this.props.shape;if(!M&&!L&&!z&&!G&&!F)return null;var U=HRe(M,L,z,G,this.props);if(!U&&!F)return null;var K=Wc(this.props,"hidden")?"url(#".concat(I,")"):void 0;return $e.createElement(Bo,{className:Ei("recharts-reference-area",S)},t.renderRect(F,h5(h5({clipPath:K},Si(this.props,!0)),U)),Bs.renderCallByParent(this.props,U))}}])}($e.Component);DS(kS,"displayName","ReferenceArea");DS(kS,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});DS(kS,"renderRect",function(e,t){var n;return $e.isValidElement(e)?n=$e.cloneElement(e,t):ai(e)?n=e(t):n=$e.createElement(GO,uI({},t,{className:"recharts-reference-area-rect"})),n});function uH(e,t,n){if(t<1)return[];if(t===1&&n===void 0)return e;for(var s=[],h=0;h<e.length;h+=t)s.push(e[h]);return s}function WRe(e,t,n){var s={width:e.width+t.width,height:e.height+t.height};return BOe(s,n)}function qRe(e,t,n){var s=n==="width",h=e.x,m=e.y,_=e.width,i=e.height;return t===1?{start:s?h:m,end:s?h+_:m+i}:{start:s?h+_:m+i,end:s?h:m}}function lT(e,t,n,s,h){if(e*t<e*s||e*t>e*h)return!1;var m=n();return e*(t-e*m/2-s)>=0&&e*(t+e*m/2-h)<=0}function ZRe(e,t){return uH(e,t+1)}function XRe(e,t,n,s,h){for(var m=(s||[]).slice(),_=t.start,i=t.end,S=0,A=1,I=_,M=function(){var G=s?.[S];if(G===void 0)return{v:uH(s,A)};var F=S,U,K=function(){return U===void 0&&(U=n(G,F)),U},J=G.coordinate,X=S===0||lT(e,J,K,I,i);X||(S=0,I=_,A+=1),X&&(I=J+e*(K()/2+h),S+=A)},L;A<=m.length;)if(L=M(),L)return L.v;return[]}function E0(e){"@babel/helpers - typeof";return E0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E0(e)}function d5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Fs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d5(Object(n),!0).forEach(function(s){KRe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function KRe(e,t,n){return t=YRe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YRe(e){var t=JRe(e,"string");return E0(t)=="symbol"?t:t+""}function JRe(e,t){if(E0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(E0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QRe(e,t,n,s,h){for(var m=(s||[]).slice(),_=m.length,i=t.start,S=t.end,A=function(L){var z=m[L],G,F=function(){return G===void 0&&(G=n(z,L)),G};if(L===_-1){var U=e*(z.coordinate+e*F()/2-S);m[L]=z=Fs(Fs({},z),{},{tickCoord:U>0?z.coordinate-U*e:z.coordinate})}else m[L]=z=Fs(Fs({},z),{},{tickCoord:z.coordinate});var K=lT(e,z.tickCoord,F,i,S);K&&(S=z.tickCoord-e*(F()/2+h),m[L]=Fs(Fs({},z),{},{isShow:!0}))},I=_-1;I>=0;I--)A(I);return m}function eDe(e,t,n,s,h,m){var _=(s||[]).slice(),i=_.length,S=t.start,A=t.end;if(m){var I=s[i-1],M=n(I,i-1),L=e*(I.coordinate+e*M/2-A);_[i-1]=I=Fs(Fs({},I),{},{tickCoord:L>0?I.coordinate-L*e:I.coordinate});var z=lT(e,I.tickCoord,function(){return M},S,A);z&&(A=I.tickCoord-e*(M/2+h),_[i-1]=Fs(Fs({},I),{},{isShow:!0}))}for(var G=m?i-1:i,F=function(J){var X=_[J],ie,Q=function(){return ie===void 0&&(ie=n(X,J)),ie};if(J===0){var ae=e*(X.coordinate-e*Q()/2-S);_[J]=X=Fs(Fs({},X),{},{tickCoord:ae<0?X.coordinate-ae*e:X.coordinate})}else _[J]=X=Fs(Fs({},X),{},{tickCoord:X.coordinate});var pe=lT(e,X.tickCoord,Q,S,A);pe&&(S=X.tickCoord+e*(Q()/2+h),_[J]=Fs(Fs({},X),{},{isShow:!0}))},U=0;U<G;U++)F(U);return _}function QO(e,t,n){var s=e.tick,h=e.ticks,m=e.viewBox,_=e.minTickGap,i=e.orientation,S=e.interval,A=e.tickFormatter,I=e.unit,M=e.angle;if(!h||!h.length||!s)return[];if(wr(S)||Lu.isSsr)return ZRe(h,typeof S=="number"&&wr(S)?S:0);var L=[],z=i==="top"||i==="bottom"?"width":"height",G=I&&z==="width"?Rv(I,{fontSize:t,letterSpacing:n}):{width:0,height:0},F=function(X,ie){var Q=ai(A)?A(X.value,ie):X.value;return z==="width"?WRe(Rv(Q,{fontSize:t,letterSpacing:n}),G,M):Rv(Q,{fontSize:t,letterSpacing:n})[z]},U=h.length>=2?ic(h[1].coordinate-h[0].coordinate):1,K=qRe(m,U,z);return S==="equidistantPreserveStart"?XRe(U,K,F,h,_):(S==="preserveStart"||S==="preserveStartEnd"?L=eDe(U,K,F,h,_,S==="preserveStartEnd"):L=QRe(U,K,F,h,_),L.filter(function(J){return J.isShow}))}var tDe=["viewBox"],rDe=["viewBox"],nDe=["ticks"];function Cg(e){"@babel/helpers - typeof";return Cg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cg(e)}function Hm(){return Hm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Hm.apply(this,arguments)}function f5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(n),!0).forEach(function(s){eR(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function YA(e,t){if(e==null)return{};var n=iDe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function iDe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function oDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p5(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,dH(s.key),s)}}function sDe(e,t,n){return t&&p5(e.prototype,t),n&&p5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function aDe(e,t,n){return t=cT(t),lDe(e,hH()?Reflect.construct(t,n||[],cT(e).constructor):t.apply(e,n))}function lDe(e,t){if(t&&(Cg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cDe(e)}function cDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hH=function(){return!!e})()}function cT(e){return cT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},cT(e)}function uDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&dI(e,t)}function dI(e,t){return dI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},dI(e,t)}function eR(e,t,n){return t=dH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dH(e){var t=hDe(e,"string");return Cg(t)=="symbol"?t:t+""}function hDe(e,t){if(Cg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Cg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oy=function(e){function t(n){var s;return oDe(this,t),s=aDe(this,t,[n]),s.state={fontSize:"",letterSpacing:""},s}return uDe(t,e),sDe(t,[{key:"shouldComponentUpdate",value:function(s,h){var m=s.viewBox,_=YA(s,tDe),i=this.props,S=i.viewBox,A=YA(i,rDe);return!Qm(m,S)||!Qm(_,A)||!Qm(h,this.state)}},{key:"componentDidMount",value:function(){var s=this.layerReference;if(s){var h=s.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];h&&this.setState({fontSize:window.getComputedStyle(h).fontSize,letterSpacing:window.getComputedStyle(h).letterSpacing})}}},{key:"getTickLineCoord",value:function(s){var h=this.props,m=h.x,_=h.y,i=h.width,S=h.height,A=h.orientation,I=h.tickSize,M=h.mirror,L=h.tickMargin,z,G,F,U,K,J,X=M?-1:1,ie=s.tickSize||I,Q=wr(s.tickCoord)?s.tickCoord:s.coordinate;switch(A){case"top":z=G=s.coordinate,U=_+ +!M*S,F=U-X*ie,J=F-X*L,K=Q;break;case"left":F=U=s.coordinate,G=m+ +!M*i,z=G-X*ie,K=z-X*L,J=Q;break;case"right":F=U=s.coordinate,G=m+ +M*i,z=G+X*ie,K=z+X*L,J=Q;break;default:z=G=s.coordinate,U=_+ +M*S,F=U+X*ie,J=F+X*L,K=Q;break}return{line:{x1:z,y1:F,x2:G,y2:U},tick:{x:K,y:J}}}},{key:"getTickTextAnchor",value:function(){var s=this.props,h=s.orientation,m=s.mirror,_;switch(h){case"left":_=m?"start":"end";break;case"right":_=m?"end":"start";break;default:_="middle";break}return _}},{key:"getTickVerticalAnchor",value:function(){var s=this.props,h=s.orientation,m=s.mirror,_="end";switch(h){case"left":case"right":_="middle";break;case"top":_=m?"start":"end";break;default:_=m?"end":"start";break}return _}},{key:"renderAxisLine",value:function(){var s=this.props,h=s.x,m=s.y,_=s.width,i=s.height,S=s.orientation,A=s.mirror,I=s.axisLine,M=ts(ts(ts({},Si(this.props,!1)),Si(I,!1)),{},{fill:"none"});if(S==="top"||S==="bottom"){var L=+(S==="top"&&!A||S==="bottom"&&A);M=ts(ts({},M),{},{x1:h,y1:m+L*i,x2:h+_,y2:m+L*i})}else{var z=+(S==="left"&&!A||S==="right"&&A);M=ts(ts({},M),{},{x1:h+z*_,y1:m,x2:h+z*_,y2:m+i})}return $e.createElement("line",Hm({},M,{className:Ei("recharts-cartesian-axis-line",ml(I,"className"))}))}},{key:"renderTicks",value:function(s,h,m){var _=this,i=this.props,S=i.tickLine,A=i.stroke,I=i.tick,M=i.tickFormatter,L=i.unit,z=QO(ts(ts({},this.props),{},{ticks:s}),h,m),G=this.getTickTextAnchor(),F=this.getTickVerticalAnchor(),U=Si(this.props,!1),K=Si(I,!1),J=ts(ts({},U),{},{fill:"none"},Si(S,!1)),X=z.map(function(ie,Q){var ae=_.getTickLineCoord(ie),pe=ae.line,Pe=ae.tick,Fe=ts(ts(ts(ts({textAnchor:G,verticalAnchor:F},U),{},{stroke:"none",fill:A},K),Pe),{},{index:Q,payload:ie,visibleTicksCount:z.length,tickFormatter:M});return $e.createElement(Bo,Hm({className:"recharts-cartesian-axis-tick",key:"tick-".concat(ie.value,"-").concat(ie.coordinate,"-").concat(ie.tickCoord)},yw(_.props,ie,Q)),S&&$e.createElement("line",Hm({},J,pe,{className:Ei("recharts-cartesian-axis-tick-line",ml(S,"className"))})),I&&t.renderTickItem(I,Fe,"".concat(ai(M)?M(ie.value,Q):ie.value).concat(L||"")))});return $e.createElement("g",{className:"recharts-cartesian-axis-ticks"},X)}},{key:"render",value:function(){var s=this,h=this.props,m=h.axisLine,_=h.width,i=h.height,S=h.ticksGenerator,A=h.className,I=h.hide;if(I)return null;var M=this.props,L=M.ticks,z=YA(M,nDe),G=L;return ai(S)&&(G=L&&L.length>0?S(this.props):S(z)),_<=0||i<=0||!G||!G.length?null:$e.createElement(Bo,{className:Ei("recharts-cartesian-axis",A),ref:function(U){s.layerReference=U}},m&&this.renderAxisLine(),this.renderTicks(G,this.state.fontSize,this.state.letterSpacing),Bs.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(s,h,m){var _,i=Ei(h.className,"recharts-cartesian-axis-tick-value");return $e.isValidElement(s)?_=$e.cloneElement(s,ts(ts({},h),{},{className:i})):ai(s)?_=s(ts(ts({},h),{},{className:i})):_=$e.createElement(Ow,Hm({},h,{className:"recharts-cartesian-axis-tick-value"}),m),_}}])}(B.Component);eR(oy,"displayName","CartesianAxis");eR(oy,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var dDe=["x1","y1","x2","y2","key"],fDe=["offset"];function Rf(e){"@babel/helpers - typeof";return Rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rf(e)}function m5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Vs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(n),!0).forEach(function(s){pDe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pDe(e,t,n){return t=mDe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mDe(e){var t=gDe(e,"string");return Rf(t)=="symbol"?t:t+""}function gDe(e,t){if(Rf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Rf(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gf(){return gf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},gf.apply(this,arguments)}function g5(e,t){if(e==null)return{};var n=yDe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function yDe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}var _De=function(t){var n=t.fill;if(!n||n==="none")return null;var s=t.fillOpacity,h=t.x,m=t.y,_=t.width,i=t.height,S=t.ry;return $e.createElement("rect",{x:h,y:m,ry:S,width:_,height:i,stroke:"none",fill:n,fillOpacity:s,className:"recharts-cartesian-grid-bg"})};function fH(e,t){var n;if($e.isValidElement(e))n=$e.cloneElement(e,t);else if(ai(e))n=e(t);else{var s=t.x1,h=t.y1,m=t.x2,_=t.y2,i=t.key,S=g5(t,dDe),A=Si(S,!1);A.offset;var I=g5(A,fDe);n=$e.createElement("line",gf({},I,{x1:s,y1:h,x2:m,y2:_,fill:"none",key:i}))}return n}function vDe(e){var t=e.x,n=e.width,s=e.horizontal,h=s===void 0?!0:s,m=e.horizontalPoints;if(!h||!m||!m.length)return null;var _=m.map(function(i,S){var A=Vs(Vs({},e),{},{x1:t,y1:i,x2:t+n,y2:i,key:"line-".concat(S),index:S});return fH(h,A)});return $e.createElement("g",{className:"recharts-cartesian-grid-horizontal"},_)}function xDe(e){var t=e.y,n=e.height,s=e.vertical,h=s===void 0?!0:s,m=e.verticalPoints;if(!h||!m||!m.length)return null;var _=m.map(function(i,S){var A=Vs(Vs({},e),{},{x1:i,y1:t,x2:i,y2:t+n,key:"line-".concat(S),index:S});return fH(h,A)});return $e.createElement("g",{className:"recharts-cartesian-grid-vertical"},_)}function bDe(e){var t=e.horizontalFill,n=e.fillOpacity,s=e.x,h=e.y,m=e.width,_=e.height,i=e.horizontalPoints,S=e.horizontal,A=S===void 0?!0:S;if(!A||!t||!t.length)return null;var I=i.map(function(L){return Math.round(L+h-h)}).sort(function(L,z){return L-z});h!==I[0]&&I.unshift(0);var M=I.map(function(L,z){var G=!I[z+1],F=G?h+_-L:I[z+1]-L;if(F<=0)return null;var U=z%t.length;return $e.createElement("rect",{key:"react-".concat(z),y:L,x:s,height:F,width:m,stroke:"none",fill:t[U],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return $e.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},M)}function wDe(e){var t=e.vertical,n=t===void 0?!0:t,s=e.verticalFill,h=e.fillOpacity,m=e.x,_=e.y,i=e.width,S=e.height,A=e.verticalPoints;if(!n||!s||!s.length)return null;var I=A.map(function(L){return Math.round(L+m-m)}).sort(function(L,z){return L-z});m!==I[0]&&I.unshift(0);var M=I.map(function(L,z){var G=!I[z+1],F=G?m+i-L:I[z+1]-L;if(F<=0)return null;var U=z%s.length;return $e.createElement("rect",{key:"react-".concat(z),x:L,y:_,width:F,height:S,stroke:"none",fill:s[U],fillOpacity:h,className:"recharts-cartesian-grid-bg"})});return $e.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},M)}var TDe=function(t,n){var s=t.xAxis,h=t.width,m=t.height,_=t.offset;return wG(QO(Vs(Vs(Vs({},oy.defaultProps),s),{},{ticks:Mu(s,!0),viewBox:{x:0,y:0,width:h,height:m}})),_.left,_.left+_.width,n)},SDe=function(t,n){var s=t.yAxis,h=t.width,m=t.height,_=t.offset;return wG(QO(Vs(Vs(Vs({},oy.defaultProps),s),{},{ticks:Mu(s,!0),viewBox:{x:0,y:0,width:h,height:m}})),_.top,_.top+_.height,n)},jm={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function pH(e){var t,n,s,h,m,_,i=XO(),S=KO(),A=hRe(),I=Vs(Vs({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:jm.stroke,fill:(n=e.fill)!==null&&n!==void 0?n:jm.fill,horizontal:(s=e.horizontal)!==null&&s!==void 0?s:jm.horizontal,horizontalFill:(h=e.horizontalFill)!==null&&h!==void 0?h:jm.horizontalFill,vertical:(m=e.vertical)!==null&&m!==void 0?m:jm.vertical,verticalFill:(_=e.verticalFill)!==null&&_!==void 0?_:jm.verticalFill,x:wr(e.x)?e.x:A.left,y:wr(e.y)?e.y:A.top,width:wr(e.width)?e.width:A.width,height:wr(e.height)?e.height:A.height}),M=I.x,L=I.y,z=I.width,G=I.height,F=I.syncWithTicks,U=I.horizontalValues,K=I.verticalValues,J=lRe(),X=cRe();if(!wr(z)||z<=0||!wr(G)||G<=0||!wr(M)||M!==+M||!wr(L)||L!==+L)return null;var ie=I.verticalCoordinatesGenerator||TDe,Q=I.horizontalCoordinatesGenerator||SDe,ae=I.horizontalPoints,pe=I.verticalPoints;if((!ae||!ae.length)&&ai(Q)){var Pe=U&&U.length,Fe=Q({yAxis:X?Vs(Vs({},X),{},{ticks:Pe?U:X.ticks}):void 0,width:i,height:S,offset:A},Pe?!0:F);ju(Array.isArray(Fe),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Rf(Fe),"]")),Array.isArray(Fe)&&(ae=Fe)}if((!pe||!pe.length)&&ai(ie)){var tt=K&&K.length,Be=ie({xAxis:J?Vs(Vs({},J),{},{ticks:tt?K:J.ticks}):void 0,width:i,height:S,offset:A},tt?!0:F);ju(Array.isArray(Be),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Rf(Be),"]")),Array.isArray(Be)&&(pe=Be)}return $e.createElement("g",{className:"recharts-cartesian-grid"},$e.createElement(_De,{fill:I.fill,fillOpacity:I.fillOpacity,x:I.x,y:I.y,width:I.width,height:I.height,ry:I.ry}),$e.createElement(vDe,gf({},I,{offset:A,horizontalPoints:ae,xAxis:J,yAxis:X})),$e.createElement(xDe,gf({},I,{offset:A,verticalPoints:pe,xAxis:J,yAxis:X})),$e.createElement(bDe,gf({},I,{horizontalPoints:ae})),$e.createElement(wDe,gf({},I,{verticalPoints:pe})))}pH.displayName="CartesianGrid";var EDe=["type","layout","connectNulls","ref"],ADe=["key"];function Ig(e){"@babel/helpers - typeof";return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ig(e)}function y5(e,t){if(e==null)return{};var n=PDe(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function PDe(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Lv(){return Lv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Lv.apply(this,arguments)}function _5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function ja(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_5(Object(n),!0).forEach(function(s){Ql(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Lm(e){return ODe(e)||MDe(e)||IDe(e)||CDe()}function CDe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IDe(e,t){if(e){if(typeof e=="string")return fI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fI(e,t)}}function MDe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ODe(e){if(Array.isArray(e))return fI(e)}function fI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function RDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v5(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,gH(s.key),s)}}function DDe(e,t,n){return t&&v5(e.prototype,t),n&&v5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kDe(e,t,n){return t=uT(t),jDe(e,mH()?Reflect.construct(t,n||[],uT(e).constructor):t.apply(e,n))}function jDe(e,t){if(t&&(Ig(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return LDe(e)}function LDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mH=function(){return!!e})()}function uT(e){return uT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},uT(e)}function NDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pI(e,t)}function pI(e,t){return pI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},pI(e,t)}function Ql(e,t,n){return t=gH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gH(e){var t=zDe(e,"string");return Ig(t)=="symbol"?t:t+""}function zDe(e,t){if(Ig(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Ig(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ex=function(e){function t(){var n;RDe(this,t);for(var s=arguments.length,h=new Array(s),m=0;m<s;m++)h[m]=arguments[m];return n=kDe(this,t,[].concat(h)),Ql(n,"state",{isAnimationFinished:!0,totalLength:0}),Ql(n,"generateSimpleStrokeDasharray",function(_,i){return"".concat(i,"px ").concat(_-i,"px")}),Ql(n,"getStrokeDasharray",function(_,i,S){var A=S.reduce(function(K,J){return K+J});if(!A)return n.generateSimpleStrokeDasharray(i,_);for(var I=Math.floor(_/A),M=_%A,L=i-_,z=[],G=0,F=0;G<S.length;F+=S[G],++G)if(F+S[G]>M){z=[].concat(Lm(S.slice(0,G)),[M-F]);break}var U=z.length%2===0?[0,L]:[L];return[].concat(Lm(t.repeat(S,I)),Lm(z),U).map(function(K){return"".concat(K,"px")}).join(", ")}),Ql(n,"id",q0("recharts-line-")),Ql(n,"pathRef",function(_){n.mainCurve=_}),Ql(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),Ql(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return NDe(t,e),DDe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();this.setState({totalLength:s})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();s!==this.state.totalLength&&this.setState({totalLength:s})}}},{key:"getTotalLength",value:function(){var s=this.mainCurve;try{return s&&s.getTotalLength&&s.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(s,h){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var m=this.props,_=m.points,i=m.xAxis,S=m.yAxis,A=m.layout,I=m.children,M=gl(I,Q0);if(!M)return null;var L=function(F,U){return{x:F.x,y:F.y,value:F.value,errorVal:Va(F.payload,U)}},z={clipPath:s?"url(#clipPath-".concat(h,")"):null};return $e.createElement(Bo,z,M.map(function(G){return $e.cloneElement(G,{key:"bar-".concat(G.props.dataKey),data:_,xAxis:i,yAxis:S,layout:A,dataPointFormatter:L})}))}},{key:"renderDots",value:function(s,h,m){var _=this.props.isAnimationActive;if(_&&!this.state.isAnimationFinished)return null;var i=this.props,S=i.dot,A=i.points,I=i.dataKey,M=Si(this.props,!1),L=Si(S,!0),z=A.map(function(F,U){var K=ja(ja(ja({key:"dot-".concat(U),r:3},M),L),{},{index:U,cx:F.x,cy:F.y,value:F.value,dataKey:I,payload:F.payload,points:A});return t.renderDotItem(S,K)}),G={clipPath:s?"url(#clipPath-".concat(h?"":"dots-").concat(m,")"):null};return $e.createElement(Bo,Lv({className:"recharts-line-dots",key:"dots"},G),z)}},{key:"renderCurveStatically",value:function(s,h,m,_){var i=this.props,S=i.type,A=i.layout,I=i.connectNulls;i.ref;var M=y5(i,EDe),L=ja(ja(ja({},Si(M,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:h?"url(#clipPath-".concat(m,")"):null,points:s},_),{},{type:S,layout:A,connectNulls:I});return $e.createElement(HC,Lv({},L,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(s,h){var m=this,_=this.props,i=_.points,S=_.strokeDasharray,A=_.isAnimationActive,I=_.animationBegin,M=_.animationDuration,L=_.animationEasing,z=_.animationId,G=_.animateNewValues,F=_.width,U=_.height,K=this.state,J=K.prevPoints,X=K.totalLength;return $e.createElement(Hu,{begin:I,duration:M,isActive:A,easing:L,from:{t:0},to:{t:1},key:"line-".concat(z),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(ie){var Q=ie.t;if(J){var ae=J.length/i.length,pe=i.map(function(Ge,Qe){var Ke=Math.floor(Qe*ae);if(J[Ke]){var ct=J[Ke],He=ec(ct.x,Ge.x),qe=ec(ct.y,Ge.y);return ja(ja({},Ge),{},{x:He(Q),y:qe(Q)})}if(G){var ut=ec(F*2,Ge.x),nt=ec(U/2,Ge.y);return ja(ja({},Ge),{},{x:ut(Q),y:nt(Q)})}return ja(ja({},Ge),{},{x:Ge.x,y:Ge.y})});return m.renderCurveStatically(pe,s,h)}var Pe=ec(0,X),Fe=Pe(Q),tt;if(S){var Be="".concat(S).split(/[,\s]+/gim).map(function(Ge){return parseFloat(Ge)});tt=m.getStrokeDasharray(Fe,X,Be)}else tt=m.generateSimpleStrokeDasharray(X,Fe);return m.renderCurveStatically(i,s,h,{strokeDasharray:tt})})}},{key:"renderCurve",value:function(s,h){var m=this.props,_=m.points,i=m.isAnimationActive,S=this.state,A=S.prevPoints,I=S.totalLength;return i&&_&&_.length&&(!A&&I>0||!ES(A,_))?this.renderCurveWithAnimation(s,h):this.renderCurveStatically(_,s,h)}},{key:"render",value:function(){var s,h=this.props,m=h.hide,_=h.dot,i=h.points,S=h.className,A=h.xAxis,I=h.yAxis,M=h.top,L=h.left,z=h.width,G=h.height,F=h.isAnimationActive,U=h.id;if(m||!i||!i.length)return null;var K=this.state.isAnimationFinished,J=i.length===1,X=Ei("recharts-line",S),ie=A&&A.allowDataOverflow,Q=I&&I.allowDataOverflow,ae=ie||Q,pe=mi(U)?this.id:U,Pe=(s=Si(_,!1))!==null&&s!==void 0?s:{r:3,strokeWidth:2},Fe=Pe.r,tt=Fe===void 0?3:Fe,Be=Pe.strokeWidth,Ge=Be===void 0?2:Be,Qe=Qfe(_)?_:{},Ke=Qe.clipDot,ct=Ke===void 0?!0:Ke,He=tt*2+Ge;return $e.createElement(Bo,{className:X},ie||Q?$e.createElement("defs",null,$e.createElement("clipPath",{id:"clipPath-".concat(pe)},$e.createElement("rect",{x:ie?L:L-z/2,y:Q?M:M-G/2,width:ie?z:z*2,height:Q?G:G*2})),!ct&&$e.createElement("clipPath",{id:"clipPath-dots-".concat(pe)},$e.createElement("rect",{x:L-He/2,y:M-He/2,width:z+He,height:G+He}))):null,!J&&this.renderCurve(ae,pe),this.renderErrorBar(ae,pe),(J||_)&&this.renderDots(ae,ct,pe),(!F||K)&&Gh.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(s,h){return s.animationId!==h.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:h.curPoints}:s.points!==h.curPoints?{curPoints:s.points}:null}},{key:"repeat",value:function(s,h){for(var m=s.length%2!==0?[].concat(Lm(s),[0]):s,_=[],i=0;i<h;++i)_=[].concat(Lm(_),Lm(m));return _}},{key:"renderDotItem",value:function(s,h){var m;if($e.isValidElement(s))m=$e.cloneElement(s,h);else if(ai(s))m=s(h);else{var _=h.key,i=y5(h,ADe),S=Ei("recharts-line-dot",typeof s!="boolean"?s.className:"");m=$e.createElement(HO,Lv({key:_},i,{className:S}))}return m}}])}(B.PureComponent);Ql(ex,"displayName","Line");Ql(ex,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Lu.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Ql(ex,"getComposedData",function(e){var t=e.props,n=e.xAxis,s=e.yAxis,h=e.xAxisTicks,m=e.yAxisTicks,_=e.dataKey,i=e.bandSize,S=e.displayedData,A=e.offset,I=t.layout,M=S.map(function(L,z){var G=Va(L,_);return I==="horizontal"?{x:QF({axis:n,ticks:h,bandSize:i,entry:L,index:z}),y:mi(G)?null:s.scale(G),value:G,payload:L}:{x:mi(G)?null:n.scale(G),y:QF({axis:s,ticks:m,bandSize:i,entry:L,index:z}),value:G,payload:L}});return ja({points:M,layout:I},A)});function Mg(e){"@babel/helpers - typeof";return Mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mg(e)}function FDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BDe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,vH(s.key),s)}}function VDe(e,t,n){return t&&BDe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $De(e,t,n){return t=hT(t),UDe(e,yH()?Reflect.construct(t,n||[],hT(e).constructor):t.apply(e,n))}function UDe(e,t){if(t&&(Mg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GDe(e)}function GDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yH=function(){return!!e})()}function hT(e){return hT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},hT(e)}function HDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mI(e,t)}function mI(e,t){return mI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},mI(e,t)}function _H(e,t,n){return t=vH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vH(e){var t=WDe(e,"string");return Mg(t)=="symbol"?t:t+""}function WDe(e,t){if(Mg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Mg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gI(){return gI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},gI.apply(this,arguments)}function qDe(e){var t=e.xAxisId,n=XO(),s=KO(),h=rH(t);return h==null?null:B.createElement(oy,gI({},h,{className:Ei("recharts-".concat(h.axisType," ").concat(h.axisType),h.className),viewBox:{x:0,y:0,width:n,height:s},ticksGenerator:function(_){return Mu(_,!0)}}))}var Og=function(e){function t(){return FDe(this,t),$De(this,t,arguments)}return HDe(t,e),VDe(t,[{key:"render",value:function(){return B.createElement(qDe,this.props)}}])}(B.Component);_H(Og,"displayName","XAxis");_H(Og,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Rg(e){"@babel/helpers - typeof";return Rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rg(e)}function ZDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XDe(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,wH(s.key),s)}}function KDe(e,t,n){return t&&XDe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function YDe(e,t,n){return t=dT(t),JDe(e,xH()?Reflect.construct(t,n||[],dT(e).constructor):t.apply(e,n))}function JDe(e,t){if(t&&(Rg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QDe(e)}function QDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xH=function(){return!!e})()}function dT(e){return dT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},dT(e)}function eke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yI(e,t)}function yI(e,t){return yI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},yI(e,t)}function bH(e,t,n){return t=wH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wH(e){var t=tke(e,"string");return Rg(t)=="symbol"?t:t+""}function tke(e,t){if(Rg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Rg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _I(){return _I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_I.apply(this,arguments)}var rke=function(t){var n=t.yAxisId,s=XO(),h=KO(),m=nH(n);return m==null?null:B.createElement(oy,_I({},m,{className:Ei("recharts-".concat(m.axisType," ").concat(m.axisType),m.className),viewBox:{x:0,y:0,width:s,height:h},ticksGenerator:function(i){return Mu(i,!0)}}))},Dg=function(e){function t(){return ZDe(this,t),YDe(this,t,arguments)}return eke(t,e),KDe(t,[{key:"render",value:function(){return B.createElement(rke,this.props)}}])}(B.Component);bH(Dg,"displayName","YAxis");bH(Dg,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function x5(e){return ske(e)||oke(e)||ike(e)||nke()}function nke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ike(e,t){if(e){if(typeof e=="string")return vI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vI(e,t)}}function oke(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ske(e){if(Array.isArray(e))return vI(e)}function vI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var xI=function(t,n,s,h,m){var _=gl(t,JO),i=gl(t,RS),S=[].concat(x5(_),x5(i)),A=gl(t,kS),I="".concat(h,"Id"),M=h[0],L=n;if(S.length&&(L=S.reduce(function(F,U){if(U.props[I]===s&&Wc(U.props,"extendDomain")&&wr(U.props[M])){var K=U.props[M];return[Math.min(F[0],K),Math.max(F[1],K)]}return F},L)),A.length){var z="".concat(M,"1"),G="".concat(M,"2");L=A.reduce(function(F,U){if(U.props[I]===s&&Wc(U.props,"extendDomain")&&wr(U.props[z])&&wr(U.props[G])){var K=U.props[z],J=U.props[G];return[Math.min(F[0],K,J),Math.max(F[1],K,J)]}return F},L)}return m&&m.length&&(L=m.reduce(function(F,U){return wr(U)?[Math.min(F[0],U),Math.max(F[1],U)]:F},L)),L},TH={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function h(S,A,I){this.fn=S,this.context=A,this.once=I||!1}function m(S,A,I,M,L){if(typeof I!="function")throw new TypeError("The listener must be a function");var z=new h(I,M||S,L),G=n?n+A:A;return S._events[G]?S._events[G].fn?S._events[G]=[S._events[G],z]:S._events[G].push(z):(S._events[G]=z,S._eventsCount++),S}function _(S,A){--S._eventsCount===0?S._events=new s:delete S._events[A]}function i(){this._events=new s,this._eventsCount=0}i.prototype.eventNames=function(){var A=[],I,M;if(this._eventsCount===0)return A;for(M in I=this._events)t.call(I,M)&&A.push(n?M.slice(1):M);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(I)):A},i.prototype.listeners=function(A){var I=n?n+A:A,M=this._events[I];if(!M)return[];if(M.fn)return[M.fn];for(var L=0,z=M.length,G=new Array(z);L<z;L++)G[L]=M[L].fn;return G},i.prototype.listenerCount=function(A){var I=n?n+A:A,M=this._events[I];return M?M.fn?1:M.length:0},i.prototype.emit=function(A,I,M,L,z,G){var F=n?n+A:A;if(!this._events[F])return!1;var U=this._events[F],K=arguments.length,J,X;if(U.fn){switch(U.once&&this.removeListener(A,U.fn,void 0,!0),K){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,I),!0;case 3:return U.fn.call(U.context,I,M),!0;case 4:return U.fn.call(U.context,I,M,L),!0;case 5:return U.fn.call(U.context,I,M,L,z),!0;case 6:return U.fn.call(U.context,I,M,L,z,G),!0}for(X=1,J=new Array(K-1);X<K;X++)J[X-1]=arguments[X];U.fn.apply(U.context,J)}else{var ie=U.length,Q;for(X=0;X<ie;X++)switch(U[X].once&&this.removeListener(A,U[X].fn,void 0,!0),K){case 1:U[X].fn.call(U[X].context);break;case 2:U[X].fn.call(U[X].context,I);break;case 3:U[X].fn.call(U[X].context,I,M);break;case 4:U[X].fn.call(U[X].context,I,M,L);break;default:if(!J)for(Q=1,J=new Array(K-1);Q<K;Q++)J[Q-1]=arguments[Q];U[X].fn.apply(U[X].context,J)}}return!0},i.prototype.on=function(A,I,M){return m(this,A,I,M,!1)},i.prototype.once=function(A,I,M){return m(this,A,I,M,!0)},i.prototype.removeListener=function(A,I,M,L){var z=n?n+A:A;if(!this._events[z])return this;if(!I)return _(this,z),this;var G=this._events[z];if(G.fn)G.fn===I&&(!L||G.once)&&(!M||G.context===M)&&_(this,z);else{for(var F=0,U=[],K=G.length;F<K;F++)(G[F].fn!==I||L&&!G[F].once||M&&G[F].context!==M)&&U.push(G[F]);U.length?this._events[z]=U.length===1?U[0]:U:_(this,z)}return this},i.prototype.removeAllListeners=function(A){var I;return A?(I=n?n+A:A,this._events[I]&&_(this,I)):(this._events=new s,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,e.exports=i})(TH);var ake=TH.exports;const lke=Bi(ake);var JA=new lke,QA="recharts.syncMouseEvents";function A0(e){"@babel/helpers - typeof";return A0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A0(e)}function cke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uke(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,SH(s.key),s)}}function hke(e,t,n){return t&&uke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function eP(e,t,n){return t=SH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function SH(e){var t=dke(e,"string");return A0(t)=="symbol"?t:t+""}function dke(e,t){if(A0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(A0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var fke=function(){function e(){cke(this,e),eP(this,"activeIndex",0),eP(this,"coordinateList",[]),eP(this,"layout","horizontal")}return hke(e,[{key:"setDetails",value:function(n){var s,h=n.coordinateList,m=h===void 0?null:h,_=n.container,i=_===void 0?null:_,S=n.layout,A=S===void 0?null:S,I=n.offset,M=I===void 0?null:I,L=n.mouseHandlerCallback,z=L===void 0?null:L;this.coordinateList=(s=m??this.coordinateList)!==null&&s!==void 0?s:[],this.container=i??this.container,this.layout=A??this.layout,this.offset=M??this.offset,this.mouseHandlerCallback=z??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(n){if(this.coordinateList.length!==0)switch(n.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(n){this.activeIndex=n}},{key:"spoofMouse",value:function(){var n,s;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var h=this.container.getBoundingClientRect(),m=h.x,_=h.y,i=h.height,S=this.coordinateList[this.activeIndex].coordinate,A=((n=window)===null||n===void 0?void 0:n.scrollX)||0,I=((s=window)===null||s===void 0?void 0:s.scrollY)||0,M=m+S+A,L=_+this.offset.top+i/2+I;this.mouseHandlerCallback({pageX:M,pageY:L})}}}])}();function pke(e,t,n){if(n==="number"&&t===!0&&Array.isArray(e)){var s=e?.[0],h=e?.[1];if(s&&h&&wr(s)&&wr(h))return!0}return!1}function mke(e,t,n,s){var h=s/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-h:n.left+.5,y:e==="horizontal"?n.top+.5:t.y-h,width:e==="horizontal"?s:n.width-1,height:e==="horizontal"?n.height-1:s}}function EH(e){var t=e.cx,n=e.cy,s=e.radius,h=e.startAngle,m=e.endAngle,_=Rs(t,n,s,h),i=Rs(t,n,s,m);return{points:[_,i],cx:t,cy:n,radius:s,startAngle:h,endAngle:m}}function gke(e,t,n){var s,h,m,_;if(e==="horizontal")s=t.x,m=s,h=n.top,_=n.top+n.height;else if(e==="vertical")h=t.y,_=h,s=n.left,m=n.left+n.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,S=t.cy,A=t.innerRadius,I=t.outerRadius,M=t.angle,L=Rs(i,S,A,M),z=Rs(i,S,I,M);s=L.x,h=L.y,m=z.x,_=z.y}else return EH(t);return[{x:s,y:h},{x:m,y:_}]}function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P0(e)}function b5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function C1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(n),!0).forEach(function(s){yke(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yke(e,t,n){return t=_ke(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _ke(e){var t=vke(e,"string");return P0(t)=="symbol"?t:t+""}function vke(e,t){if(P0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(P0(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xke(e){var t,n,s=e.element,h=e.tooltipEventType,m=e.isActive,_=e.activeCoordinate,i=e.activePayload,S=e.offset,A=e.activeTooltipIndex,I=e.tooltipAxisBandSize,M=e.layout,L=e.chartName,z=(t=s.props.cursor)!==null&&t!==void 0?t:(n=s.type.defaultProps)===null||n===void 0?void 0:n.cursor;if(!s||!z||!m||!_||L!=="ScatterChart"&&h!=="axis")return null;var G,F=HC;if(L==="ScatterChart")G=_,F=xIe;else if(L==="BarChart")G=mke(M,_,S,I),F=GO;else if(M==="radial"){var U=EH(_),K=U.cx,J=U.cy,X=U.radius,ie=U.startAngle,Q=U.endAngle;G={cx:K,cy:J,startAngle:ie,endAngle:Q,innerRadius:X,outerRadius:X},F=PG}else G={points:gke(M,_,S)},F=HC;var ae=C1(C1(C1(C1({stroke:"#ccc",pointerEvents:"none"},S),G),Si(z,!1)),{},{payload:i,payloadIndex:A,className:Ei("recharts-tooltip-cursor",z.className)});return B.isValidElement(z)?B.cloneElement(z,ae):B.createElement(F,ae)}var bke=["item"],wke=["children","className","width","height","style","compact","title","desc"];function kg(e){"@babel/helpers - typeof";return kg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kg(e)}function Wm(){return Wm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Wm.apply(this,arguments)}function w5(e,t){return Eke(e)||Ske(e,t)||PH(e,t)||Tke()}function Tke(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ske(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,h,m,_,i=[],S=!0,A=!1;try{if(m=(n=n.call(e)).next,t!==0)for(;!(S=(s=m.call(n)).done)&&(i.push(s.value),i.length!==t);S=!0);}catch(I){A=!0,h=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(A)throw h}}return i}}function Eke(e){if(Array.isArray(e))return e}function T5(e,t){if(e==null)return{};var n=Ake(e,t),s,h;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(h=0;h<m.length;h++)s=m[h],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Ake(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Pke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cke(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,CH(s.key),s)}}function Ike(e,t,n){return t&&Cke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mke(e,t,n){return t=fT(t),Oke(e,AH()?Reflect.construct(t,n||[],fT(e).constructor):t.apply(e,n))}function Oke(e,t){if(t&&(kg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Rke(e)}function Rke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function AH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AH=function(){return!!e})()}function fT(e){return fT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fT(e)}function Dke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bI(e,t)}function bI(e,t){return bI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,h){return s.__proto__=h,s},bI(e,t)}function jg(e){return Lke(e)||jke(e)||PH(e)||kke()}function kke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PH(e,t){if(e){if(typeof e=="string")return wI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wI(e,t)}}function jke(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Lke(e){if(Array.isArray(e))return wI(e)}function wI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function S5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),n.push.apply(n,s)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S5(Object(n),!0).forEach(function(s){In(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function In(e,t,n){return t=CH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CH(e){var t=Nke(e,"string");return kg(t)=="symbol"?t:t+""}function Nke(e,t){if(kg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(kg(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var zke={xAxis:["bottom","top"],yAxis:["left","right"]},Fke={width:"100%",height:"100%"},IH={x:0,y:0};function I1(e){return e}var Bke=function(t,n){return n==="horizontal"?t.x:n==="vertical"?t.y:n==="centric"?t.angle:t.radius},Vke=function(t,n,s,h){var m=n.find(function(I){return I&&I.index===s});if(m){if(t==="horizontal")return{x:m.coordinate,y:h.y};if(t==="vertical")return{x:h.x,y:m.coordinate};if(t==="centric"){var _=m.coordinate,i=h.radius;return Wt(Wt(Wt({},h),Rs(h.cx,h.cy,i,_)),{},{angle:_,radius:i})}var S=m.coordinate,A=h.angle;return Wt(Wt(Wt({},h),Rs(h.cx,h.cy,S,A)),{},{angle:A,radius:S})}return IH},jS=function(t,n){var s=n.graphicalItems,h=n.dataStartIndex,m=n.dataEndIndex,_=(s??[]).reduce(function(i,S){var A=S.props.data;return A&&A.length?[].concat(jg(i),jg(A)):i},[]);return _.length>0?_:t&&t.length&&wr(h)&&wr(m)?t.slice(h,m+1):[]};function MH(e){return e==="number"?[0,"auto"]:void 0}var TI=function(t,n,s,h){var m=t.graphicalItems,_=t.tooltipAxis,i=jS(n,t);return s<0||!m||!m.length||s>=i.length?null:m.reduce(function(S,A){var I,M=(I=A.props.data)!==null&&I!==void 0?I:n;M&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=s&&(M=M.slice(t.dataStartIndex,t.dataEndIndex+1));var L;if(_.dataKey&&!_.allowDuplicatedCategory){var z=M===void 0?i:M;L=mw(z,_.dataKey,h)}else L=M&&M[s]||i[s];return L?[].concat(jg(S),[SG(A,L)]):S},[])},E5=function(t,n,s,h){var m=h||{x:t.chartX,y:t.chartY},_=Bke(m,s),i=t.orderedTooltipTicks,S=t.tooltipAxis,A=t.tooltipTicks,I=rAe(_,i,A,S);if(I>=0&&A){var M=A[I]&&A[I].value,L=TI(t,n,I,M),z=Vke(s,i,I,m);return{activeTooltipIndex:I,activeLabel:M,activePayload:L,activeCoordinate:z}}return null},$ke=function(t,n){var s=n.axes,h=n.graphicalItems,m=n.axisType,_=n.axisIdKey,i=n.stackGroups,S=n.dataStartIndex,A=n.dataEndIndex,I=t.layout,M=t.children,L=t.stackOffset,z=bG(I,m);return s.reduce(function(G,F){var U,K=F.type.defaultProps!==void 0?Wt(Wt({},F.type.defaultProps),F.props):F.props,J=K.type,X=K.dataKey,ie=K.allowDataOverflow,Q=K.allowDuplicatedCategory,ae=K.scale,pe=K.ticks,Pe=K.includeHidden,Fe=K[_];if(G[Fe])return G;var tt=jS(t.data,{graphicalItems:h.filter(function(Bt){var Vt,xr=_ in Bt.props?Bt.props[_]:(Vt=Bt.type.defaultProps)===null||Vt===void 0?void 0:Vt[_];return xr===Fe}),dataStartIndex:S,dataEndIndex:A}),Be=tt.length,Ge,Qe,Ke;pke(K.domain,ie,J)&&(Ge=BC(K.domain,null,ie),z&&(J==="number"||ae!=="auto")&&(Ke=kv(tt,X,"category")));var ct=MH(J);if(!Ge||Ge.length===0){var He,qe=(He=K.domain)!==null&&He!==void 0?He:ct;if(X){if(Ge=kv(tt,X,J),J==="category"&&z){var ut=Ufe(Ge);Q&&ut?(Qe=Ge,Ge=eT(0,Be)):Q||(Ge=nB(qe,Ge,F).reduce(function(Bt,Vt){return Bt.indexOf(Vt)>=0?Bt:[].concat(jg(Bt),[Vt])},[]))}else if(J==="category")Q?Ge=Ge.filter(function(Bt){return Bt!==""&&!mi(Bt)}):Ge=nB(qe,Ge,F).reduce(function(Bt,Vt){return Bt.indexOf(Vt)>=0||Vt===""||mi(Vt)?Bt:[].concat(jg(Bt),[Vt])},[]);else if(J==="number"){var nt=aAe(tt,h.filter(function(Bt){var Vt,xr,nn=_ in Bt.props?Bt.props[_]:(Vt=Bt.type.defaultProps)===null||Vt===void 0?void 0:Vt[_],Hn="hide"in Bt.props?Bt.props.hide:(xr=Bt.type.defaultProps)===null||xr===void 0?void 0:xr.hide;return nn===Fe&&(Pe||!Hn)}),X,m,I);nt&&(Ge=nt)}z&&(J==="number"||ae!=="auto")&&(Ke=kv(tt,X,"category"))}else z?Ge=eT(0,Be):i&&i[Fe]&&i[Fe].hasStack&&J==="number"?Ge=L==="expand"?[0,1]:TG(i[Fe].stackGroups,S,A):Ge=xG(tt,h.filter(function(Bt){var Vt=_ in Bt.props?Bt.props[_]:Bt.type.defaultProps[_],xr="hide"in Bt.props?Bt.props.hide:Bt.type.defaultProps.hide;return Vt===Fe&&(Pe||!xr)}),J,I,!0);if(J==="number")Ge=xI(M,Ge,Fe,m,pe),qe&&(Ge=BC(qe,Ge,ie));else if(J==="category"&&qe){var Kt=qe,cr=Ge.every(function(Bt){return Kt.indexOf(Bt)>=0});cr&&(Ge=Kt)}}return Wt(Wt({},G),{},In({},Fe,Wt(Wt({},K),{},{axisType:m,domain:Ge,categoricalDomain:Ke,duplicateDomain:Qe,originalDomain:(U=K.domain)!==null&&U!==void 0?U:ct,isCategorical:z,layout:I})))},{})},Uke=function(t,n){var s=n.graphicalItems,h=n.Axis,m=n.axisType,_=n.axisIdKey,i=n.stackGroups,S=n.dataStartIndex,A=n.dataEndIndex,I=t.layout,M=t.children,L=jS(t.data,{graphicalItems:s,dataStartIndex:S,dataEndIndex:A}),z=L.length,G=bG(I,m),F=-1;return s.reduce(function(U,K){var J=K.type.defaultProps!==void 0?Wt(Wt({},K.type.defaultProps),K.props):K.props,X=J[_],ie=MH("number");if(!U[X]){F++;var Q;return G?Q=eT(0,z):i&&i[X]&&i[X].hasStack?(Q=TG(i[X].stackGroups,S,A),Q=xI(M,Q,X,m)):(Q=BC(ie,xG(L,s.filter(function(ae){var pe,Pe,Fe=_ in ae.props?ae.props[_]:(pe=ae.type.defaultProps)===null||pe===void 0?void 0:pe[_],tt="hide"in ae.props?ae.props.hide:(Pe=ae.type.defaultProps)===null||Pe===void 0?void 0:Pe.hide;return Fe===X&&!tt}),"number",I),h.defaultProps.allowDataOverflow),Q=xI(M,Q,X,m)),Wt(Wt({},U),{},In({},X,Wt(Wt({axisType:m},h.defaultProps),{},{hide:!0,orientation:ml(zke,"".concat(m,".").concat(F%2),null),domain:Q,originalDomain:ie,isCategorical:G,layout:I})))}return U},{})},Gke=function(t,n){var s=n.axisType,h=s===void 0?"xAxis":s,m=n.AxisComp,_=n.graphicalItems,i=n.stackGroups,S=n.dataStartIndex,A=n.dataEndIndex,I=t.children,M="".concat(h,"Id"),L=gl(I,m),z={};return L&&L.length?z=$ke(t,{axes:L,graphicalItems:_,axisType:h,axisIdKey:M,stackGroups:i,dataStartIndex:S,dataEndIndex:A}):_&&_.length&&(z=Uke(t,{Axis:m,graphicalItems:_,axisType:h,axisIdKey:M,stackGroups:i,dataStartIndex:S,dataEndIndex:A})),z},Hke=function(t){var n=zh(t),s=Mu(n,!1,!0);return{tooltipTicks:s,orderedTooltipTicks:yO(s,function(h){return h.coordinate}),tooltipAxis:n,tooltipAxisBandSize:Hw(n,s)}},A5=function(t){var n=t.children,s=t.defaultShowTooltip,h=Na(n,Tg),m=0,_=0;return t.data&&t.data.length!==0&&(_=t.data.length-1),h&&h.props&&(h.props.startIndex>=0&&(m=h.props.startIndex),h.props.endIndex>=0&&(_=h.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:m,dataEndIndex:_,activeTooltipIndex:-1,isTooltipActive:!!s}},Wke=function(t){return!t||!t.length?!1:t.some(function(n){var s=ku(n&&n.type);return s&&s.indexOf("Bar")>=0})},P5=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},qke=function(t,n){var s=t.props,h=t.graphicalItems,m=t.xAxisMap,_=m===void 0?{}:m,i=t.yAxisMap,S=i===void 0?{}:i,A=s.width,I=s.height,M=s.children,L=s.margin||{},z=Na(M,Tg),G=Na(M,eg),F=Object.keys(S).reduce(function(Q,ae){var pe=S[ae],Pe=pe.orientation;return!pe.mirror&&!pe.hide?Wt(Wt({},Q),{},In({},Pe,Q[Pe]+pe.width)):Q},{left:L.left||0,right:L.right||0}),U=Object.keys(_).reduce(function(Q,ae){var pe=_[ae],Pe=pe.orientation;return!pe.mirror&&!pe.hide?Wt(Wt({},Q),{},In({},Pe,ml(Q,"".concat(Pe))+pe.height)):Q},{top:L.top||0,bottom:L.bottom||0}),K=Wt(Wt({},U),F),J=K.bottom;z&&(K.bottom+=z.props.height||Tg.defaultProps.height),G&&n&&(K=oAe(K,h,s,n));var X=A-K.left-K.right,ie=I-K.top-K.bottom;return Wt(Wt({brushBottom:J},K),{},{width:Math.max(X,0),height:Math.max(ie,0)})},Zke=function(t,n){if(n==="xAxis")return t[n].width;if(n==="yAxis")return t[n].height},OH=function(t){var n=t.chartName,s=t.GraphicalChild,h=t.defaultTooltipEventType,m=h===void 0?"axis":h,_=t.validateTooltipEventTypes,i=_===void 0?["axis"]:_,S=t.axisComponents,A=t.legendContent,I=t.formatAxisMap,M=t.defaultProps,L=function(K,J){var X=J.graphicalItems,ie=J.stackGroups,Q=J.offset,ae=J.updateId,pe=J.dataStartIndex,Pe=J.dataEndIndex,Fe=K.barSize,tt=K.layout,Be=K.barGap,Ge=K.barCategoryGap,Qe=K.maxBarSize,Ke=P5(tt),ct=Ke.numericAxisName,He=Ke.cateAxisName,qe=Wke(X),ut=[];return X.forEach(function(nt,Kt){var cr=jS(K.data,{graphicalItems:[nt],dataStartIndex:pe,dataEndIndex:Pe}),Bt=nt.type.defaultProps!==void 0?Wt(Wt({},nt.type.defaultProps),nt.props):nt.props,Vt=Bt.dataKey,xr=Bt.maxBarSize,nn=Bt["".concat(ct,"Id")],Hn=Bt["".concat(He,"Id")],lr={},an=S.reduce(function(ao,bo){var mo=J["".concat(bo.axisType,"Map")],Hi=Bt["".concat(bo.axisType,"Id")];mo&&mo[Hi]||bo.axisType==="zAxis"||Of();var Yo=mo[Hi];return Wt(Wt({},ao),{},In(In({},bo.axisType,Yo),"".concat(bo.axisType,"Ticks"),Mu(Yo)))},lr),Lt=an[He],nr=an["".concat(He,"Ticks")],pr=ie&&ie[nn]&&ie[nn].hasStack&&vAe(nt,ie[nn].stackGroups),Nt=ku(nt.type).indexOf("Bar")>=0,Nr=Hw(Lt,nr),un=[],ci=qe&&nAe({barSize:Fe,stackGroups:ie,totalSize:Zke(an,He)});if(Nt){var Un,zn,Kn=mi(xr)?Qe:xr,ks=(Un=(zn=Hw(Lt,nr,!0))!==null&&zn!==void 0?zn:Kn)!==null&&Un!==void 0?Un:0;un=iAe({barGap:Be,barCategoryGap:Ge,bandSize:ks!==Nr?ks:Nr,sizeList:ci[Hn],maxBarSize:Kn}),ks!==Nr&&(un=un.map(function(ao){return Wt(Wt({},ao),{},{position:Wt(Wt({},ao.position),{},{offset:ao.position.offset-ks/2})})}))}var ds=nt&&nt.type&&nt.type.getComposedData;ds&&ut.push({props:Wt(Wt({},ds(Wt(Wt({},an),{},{displayedData:cr,props:K,dataKey:Vt,item:nt,bandSize:Nr,barPosition:un,offset:Q,stackedData:pr,layout:tt,dataStartIndex:pe,dataEndIndex:Pe}))),{},In(In(In({key:nt.key||"item-".concat(Kt)},ct,an[ct]),He,an[He]),"animationId",ae)),childIndex:rpe(nt,K.children),item:nt})}),ut},z=function(K,J){var X=K.props,ie=K.dataStartIndex,Q=K.dataEndIndex,ae=K.updateId;if(!Xz({props:X}))return null;var pe=X.children,Pe=X.layout,Fe=X.stackOffset,tt=X.data,Be=X.reverseStackOrder,Ge=P5(Pe),Qe=Ge.numericAxisName,Ke=Ge.cateAxisName,ct=gl(pe,s),He=gAe(tt,ct,"".concat(Qe,"Id"),"".concat(Ke,"Id"),Fe,Be),qe=S.reduce(function(Bt,Vt){var xr="".concat(Vt.axisType,"Map");return Wt(Wt({},Bt),{},In({},xr,Gke(X,Wt(Wt({},Vt),{},{graphicalItems:ct,stackGroups:Vt.axisType===Qe&&He,dataStartIndex:ie,dataEndIndex:Q}))))},{}),ut=qke(Wt(Wt({},qe),{},{props:X,graphicalItems:ct}),J?.legendBBox);Object.keys(qe).forEach(function(Bt){qe[Bt]=I(X,qe[Bt],ut,Bt.replace("Map",""),n)});var nt=qe["".concat(Ke,"Map")],Kt=Hke(nt),cr=L(X,Wt(Wt({},qe),{},{dataStartIndex:ie,dataEndIndex:Q,updateId:ae,graphicalItems:ct,stackGroups:He,offset:ut}));return Wt(Wt({formattedGraphicalItems:cr,graphicalItems:ct,offset:ut,stackGroups:He},Kt),qe)},G=function(U){function K(J){var X,ie,Q;return Pke(this,K),Q=Mke(this,K,[J]),In(Q,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),In(Q,"accessibilityManager",new fke),In(Q,"handleLegendBBoxUpdate",function(ae){if(ae){var pe=Q.state,Pe=pe.dataStartIndex,Fe=pe.dataEndIndex,tt=pe.updateId;Q.setState(Wt({legendBBox:ae},z({props:Q.props,dataStartIndex:Pe,dataEndIndex:Fe,updateId:tt},Wt(Wt({},Q.state),{},{legendBBox:ae}))))}}),In(Q,"handleReceiveSyncEvent",function(ae,pe,Pe){if(Q.props.syncId===ae){if(Pe===Q.eventEmitterSymbol&&typeof Q.props.syncMethod!="function")return;Q.applySyncEvent(pe)}}),In(Q,"handleBrushChange",function(ae){var pe=ae.startIndex,Pe=ae.endIndex;if(pe!==Q.state.dataStartIndex||Pe!==Q.state.dataEndIndex){var Fe=Q.state.updateId;Q.setState(function(){return Wt({dataStartIndex:pe,dataEndIndex:Pe},z({props:Q.props,dataStartIndex:pe,dataEndIndex:Pe,updateId:Fe},Q.state))}),Q.triggerSyncEvent({dataStartIndex:pe,dataEndIndex:Pe})}}),In(Q,"handleMouseEnter",function(ae){var pe=Q.getMouseInfo(ae);if(pe){var Pe=Wt(Wt({},pe),{},{isTooltipActive:!0});Q.setState(Pe),Q.triggerSyncEvent(Pe);var Fe=Q.props.onMouseEnter;ai(Fe)&&Fe(Pe,ae)}}),In(Q,"triggeredAfterMouseMove",function(ae){var pe=Q.getMouseInfo(ae),Pe=pe?Wt(Wt({},pe),{},{isTooltipActive:!0}):{isTooltipActive:!1};Q.setState(Pe),Q.triggerSyncEvent(Pe);var Fe=Q.props.onMouseMove;ai(Fe)&&Fe(Pe,ae)}),In(Q,"handleItemMouseEnter",function(ae){Q.setState(function(){return{isTooltipActive:!0,activeItem:ae,activePayload:ae.tooltipPayload,activeCoordinate:ae.tooltipPosition||{x:ae.cx,y:ae.cy}}})}),In(Q,"handleItemMouseLeave",function(){Q.setState(function(){return{isTooltipActive:!1}})}),In(Q,"handleMouseMove",function(ae){ae.persist(),Q.throttleTriggeredAfterMouseMove(ae)}),In(Q,"handleMouseLeave",function(ae){Q.throttleTriggeredAfterMouseMove.cancel();var pe={isTooltipActive:!1};Q.setState(pe),Q.triggerSyncEvent(pe);var Pe=Q.props.onMouseLeave;ai(Pe)&&Pe(pe,ae)}),In(Q,"handleOuterEvent",function(ae){var pe=tpe(ae),Pe=ml(Q.props,"".concat(pe));if(pe&&ai(Pe)){var Fe,tt;/.*touch.*/i.test(pe)?tt=Q.getMouseInfo(ae.changedTouches[0]):tt=Q.getMouseInfo(ae),Pe((Fe=tt)!==null&&Fe!==void 0?Fe:{},ae)}}),In(Q,"handleClick",function(ae){var pe=Q.getMouseInfo(ae);if(pe){var Pe=Wt(Wt({},pe),{},{isTooltipActive:!0});Q.setState(Pe),Q.triggerSyncEvent(Pe);var Fe=Q.props.onClick;ai(Fe)&&Fe(Pe,ae)}}),In(Q,"handleMouseDown",function(ae){var pe=Q.props.onMouseDown;if(ai(pe)){var Pe=Q.getMouseInfo(ae);pe(Pe,ae)}}),In(Q,"handleMouseUp",function(ae){var pe=Q.props.onMouseUp;if(ai(pe)){var Pe=Q.getMouseInfo(ae);pe(Pe,ae)}}),In(Q,"handleTouchMove",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.throttleTriggeredAfterMouseMove(ae.changedTouches[0])}),In(Q,"handleTouchStart",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.handleMouseDown(ae.changedTouches[0])}),In(Q,"handleTouchEnd",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.handleMouseUp(ae.changedTouches[0])}),In(Q,"handleDoubleClick",function(ae){var pe=Q.props.onDoubleClick;if(ai(pe)){var Pe=Q.getMouseInfo(ae);pe(Pe,ae)}}),In(Q,"handleContextMenu",function(ae){var pe=Q.props.onContextMenu;if(ai(pe)){var Pe=Q.getMouseInfo(ae);pe(Pe,ae)}}),In(Q,"triggerSyncEvent",function(ae){Q.props.syncId!==void 0&&JA.emit(QA,Q.props.syncId,ae,Q.eventEmitterSymbol)}),In(Q,"applySyncEvent",function(ae){var pe=Q.props,Pe=pe.layout,Fe=pe.syncMethod,tt=Q.state.updateId,Be=ae.dataStartIndex,Ge=ae.dataEndIndex;if(ae.dataStartIndex!==void 0||ae.dataEndIndex!==void 0)Q.setState(Wt({dataStartIndex:Be,dataEndIndex:Ge},z({props:Q.props,dataStartIndex:Be,dataEndIndex:Ge,updateId:tt},Q.state)));else if(ae.activeTooltipIndex!==void 0){var Qe=ae.chartX,Ke=ae.chartY,ct=ae.activeTooltipIndex,He=Q.state,qe=He.offset,ut=He.tooltipTicks;if(!qe)return;if(typeof Fe=="function")ct=Fe(ut,ae);else if(Fe==="value"){ct=-1;for(var nt=0;nt<ut.length;nt++)if(ut[nt].value===ae.activeLabel){ct=nt;break}}var Kt=Wt(Wt({},qe),{},{x:qe.left,y:qe.top}),cr=Math.min(Qe,Kt.x+Kt.width),Bt=Math.min(Ke,Kt.y+Kt.height),Vt=ut[ct]&&ut[ct].value,xr=TI(Q.state,Q.props.data,ct),nn=ut[ct]?{x:Pe==="horizontal"?ut[ct].coordinate:cr,y:Pe==="horizontal"?Bt:ut[ct].coordinate}:IH;Q.setState(Wt(Wt({},ae),{},{activeLabel:Vt,activeCoordinate:nn,activePayload:xr,activeTooltipIndex:ct}))}else Q.setState(ae)}),In(Q,"renderCursor",function(ae){var pe,Pe=Q.state,Fe=Pe.isTooltipActive,tt=Pe.activeCoordinate,Be=Pe.activePayload,Ge=Pe.offset,Qe=Pe.activeTooltipIndex,Ke=Pe.tooltipAxisBandSize,ct=Q.getTooltipEventType(),He=(pe=ae.props.active)!==null&&pe!==void 0?pe:Fe,qe=Q.props.layout,ut=ae.key||"_recharts-cursor";return $e.createElement(xke,{key:ut,activeCoordinate:tt,activePayload:Be,activeTooltipIndex:Qe,chartName:n,element:ae,isActive:He,layout:qe,offset:Ge,tooltipAxisBandSize:Ke,tooltipEventType:ct})}),In(Q,"renderPolarAxis",function(ae,pe,Pe){var Fe=ml(ae,"type.axisType"),tt=ml(Q.state,"".concat(Fe,"Map")),Be=ae.type.defaultProps,Ge=Be!==void 0?Wt(Wt({},Be),ae.props):ae.props,Qe=tt&&tt[Ge["".concat(Fe,"Id")]];return B.cloneElement(ae,Wt(Wt({},Qe),{},{className:Ei(Fe,Qe.className),key:ae.key||"".concat(pe,"-").concat(Pe),ticks:Mu(Qe,!0)}))}),In(Q,"renderPolarGrid",function(ae){var pe=ae.props,Pe=pe.radialLines,Fe=pe.polarAngles,tt=pe.polarRadius,Be=Q.state,Ge=Be.radiusAxisMap,Qe=Be.angleAxisMap,Ke=zh(Ge),ct=zh(Qe),He=ct.cx,qe=ct.cy,ut=ct.innerRadius,nt=ct.outerRadius;return B.cloneElement(ae,{polarAngles:Array.isArray(Fe)?Fe:Mu(ct,!0).map(function(Kt){return Kt.coordinate}),polarRadius:Array.isArray(tt)?tt:Mu(Ke,!0).map(function(Kt){return Kt.coordinate}),cx:He,cy:qe,innerRadius:ut,outerRadius:nt,key:ae.key||"polar-grid",radialLines:Pe})}),In(Q,"renderLegend",function(){var ae=Q.state.formattedGraphicalItems,pe=Q.props,Pe=pe.children,Fe=pe.width,tt=pe.height,Be=Q.props.margin||{},Ge=Fe-(Be.left||0)-(Be.right||0),Qe=_G({children:Pe,formattedGraphicalItems:ae,legendWidth:Ge,legendContent:A});if(!Qe)return null;var Ke=Qe.item,ct=T5(Qe,bke);return B.cloneElement(Ke,Wt(Wt({},ct),{},{chartWidth:Fe,chartHeight:tt,margin:Be,onBBoxUpdate:Q.handleLegendBBoxUpdate}))}),In(Q,"renderTooltip",function(){var ae,pe=Q.props,Pe=pe.children,Fe=pe.accessibilityLayer,tt=Na(Pe,Yl);if(!tt)return null;var Be=Q.state,Ge=Be.isTooltipActive,Qe=Be.activeCoordinate,Ke=Be.activePayload,ct=Be.activeLabel,He=Be.offset,qe=(ae=tt.props.active)!==null&&ae!==void 0?ae:Ge;return B.cloneElement(tt,{viewBox:Wt(Wt({},He),{},{x:He.left,y:He.top}),active:qe,label:ct,payload:qe?Ke:[],coordinate:Qe,accessibilityLayer:Fe})}),In(Q,"renderBrush",function(ae){var pe=Q.props,Pe=pe.margin,Fe=pe.data,tt=Q.state,Be=tt.offset,Ge=tt.dataStartIndex,Qe=tt.dataEndIndex,Ke=tt.updateId;return B.cloneElement(ae,{key:ae.key||"_recharts-brush",onChange:S1(Q.handleBrushChange,ae.props.onChange),data:Fe,x:wr(ae.props.x)?ae.props.x:Be.left,y:wr(ae.props.y)?ae.props.y:Be.top+Be.height+Be.brushBottom-(Pe.bottom||0),width:wr(ae.props.width)?ae.props.width:Be.width,startIndex:Ge,endIndex:Qe,updateId:"brush-".concat(Ke)})}),In(Q,"renderReferenceElement",function(ae,pe,Pe){if(!ae)return null;var Fe=Q,tt=Fe.clipPathId,Be=Q.state,Ge=Be.xAxisMap,Qe=Be.yAxisMap,Ke=Be.offset,ct=ae.type.defaultProps||{},He=ae.props,qe=He.xAxisId,ut=qe===void 0?ct.xAxisId:qe,nt=He.yAxisId,Kt=nt===void 0?ct.yAxisId:nt;return B.cloneElement(ae,{key:ae.key||"".concat(pe,"-").concat(Pe),xAxis:Ge[ut],yAxis:Qe[Kt],viewBox:{x:Ke.left,y:Ke.top,width:Ke.width,height:Ke.height},clipPathId:tt})}),In(Q,"renderActivePoints",function(ae){var pe=ae.item,Pe=ae.activePoint,Fe=ae.basePoint,tt=ae.childIndex,Be=ae.isRange,Ge=[],Qe=pe.props.key,Ke=pe.item.type.defaultProps!==void 0?Wt(Wt({},pe.item.type.defaultProps),pe.item.props):pe.item.props,ct=Ke.activeDot,He=Ke.dataKey,qe=Wt(Wt({index:tt,dataKey:He,cx:Pe.x,cy:Pe.y,r:4,fill:UO(pe.item),strokeWidth:2,stroke:"#fff",payload:Pe.payload,value:Pe.value},Si(ct,!1)),gw(ct));return Ge.push(K.renderActiveDot(ct,qe,"".concat(Qe,"-activePoint-").concat(tt))),Fe?Ge.push(K.renderActiveDot(ct,Wt(Wt({},qe),{},{cx:Fe.x,cy:Fe.y}),"".concat(Qe,"-basePoint-").concat(tt))):Be&&Ge.push(null),Ge}),In(Q,"renderGraphicChild",function(ae,pe,Pe){var Fe=Q.filterFormatItem(ae,pe,Pe);if(!Fe)return null;var tt=Q.getTooltipEventType(),Be=Q.state,Ge=Be.isTooltipActive,Qe=Be.tooltipAxis,Ke=Be.activeTooltipIndex,ct=Be.activeLabel,He=Q.props.children,qe=Na(He,Yl),ut=Fe.props,nt=ut.points,Kt=ut.isRange,cr=ut.baseLine,Bt=Fe.item.type.defaultProps!==void 0?Wt(Wt({},Fe.item.type.defaultProps),Fe.item.props):Fe.item.props,Vt=Bt.activeDot,xr=Bt.hide,nn=Bt.activeBar,Hn=Bt.activeShape,lr=!!(!xr&&Ge&&qe&&(Vt||nn||Hn)),an={};tt!=="axis"&&qe&&qe.props.trigger==="click"?an={onClick:S1(Q.handleItemMouseEnter,ae.props.onClick)}:tt!=="axis"&&(an={onMouseLeave:S1(Q.handleItemMouseLeave,ae.props.onMouseLeave),onMouseEnter:S1(Q.handleItemMouseEnter,ae.props.onMouseEnter)});var Lt=B.cloneElement(ae,Wt(Wt({},Fe.props),an));function nr(bo){return typeof Qe.dataKey=="function"?Qe.dataKey(bo.payload):null}if(lr)if(Ke>=0){var pr,Nt;if(Qe.dataKey&&!Qe.allowDuplicatedCategory){var Nr=typeof Qe.dataKey=="function"?nr:"payload.".concat(Qe.dataKey.toString());pr=mw(nt,Nr,ct),Nt=Kt&&cr&&mw(cr,Nr,ct)}else pr=nt?.[Ke],Nt=Kt&&cr&&cr[Ke];if(Hn||nn){var un=ae.props.activeIndex!==void 0?ae.props.activeIndex:Ke;return[B.cloneElement(ae,Wt(Wt(Wt({},Fe.props),an),{},{activeIndex:un})),null,null]}if(!mi(pr))return[Lt].concat(jg(Q.renderActivePoints({item:Fe,activePoint:pr,basePoint:Nt,childIndex:Ke,isRange:Kt})))}else{var ci,Un=(ci=Q.getItemByXY(Q.state.activeCoordinate))!==null&&ci!==void 0?ci:{graphicalItem:Lt},zn=Un.graphicalItem,Kn=zn.item,ks=Kn===void 0?ae:Kn,ds=zn.childIndex,ao=Wt(Wt(Wt({},Fe.props),an),{},{activeIndex:ds});return[B.cloneElement(ks,ao),null,null]}return Kt?[Lt,null,null]:[Lt,null]}),In(Q,"renderCustomized",function(ae,pe,Pe){return B.cloneElement(ae,Wt(Wt({key:"recharts-customized-".concat(Pe)},Q.props),Q.state))}),In(Q,"renderMap",{CartesianGrid:{handler:I1,once:!0},ReferenceArea:{handler:Q.renderReferenceElement},ReferenceLine:{handler:I1},ReferenceDot:{handler:Q.renderReferenceElement},XAxis:{handler:I1},YAxis:{handler:I1},Brush:{handler:Q.renderBrush,once:!0},Bar:{handler:Q.renderGraphicChild},Line:{handler:Q.renderGraphicChild},Area:{handler:Q.renderGraphicChild},Radar:{handler:Q.renderGraphicChild},RadialBar:{handler:Q.renderGraphicChild},Scatter:{handler:Q.renderGraphicChild},Pie:{handler:Q.renderGraphicChild},Funnel:{handler:Q.renderGraphicChild},Tooltip:{handler:Q.renderCursor,once:!0},PolarGrid:{handler:Q.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Q.renderPolarAxis},PolarRadiusAxis:{handler:Q.renderPolarAxis},Customized:{handler:Q.renderCustomized}}),Q.clipPathId="".concat((X=J.id)!==null&&X!==void 0?X:q0("recharts"),"-clip"),Q.throttleTriggeredAfterMouseMove=y8(Q.triggeredAfterMouseMove,(ie=J.throttleDelay)!==null&&ie!==void 0?ie:1e3/60),Q.state={},Q}return Dke(K,U),Ike(K,[{key:"componentDidMount",value:function(){var X,ie;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(X=this.props.margin.left)!==null&&X!==void 0?X:0,top:(ie=this.props.margin.top)!==null&&ie!==void 0?ie:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var X=this.props,ie=X.children,Q=X.data,ae=X.height,pe=X.layout,Pe=Na(ie,Yl);if(Pe){var Fe=Pe.props.defaultIndex;if(!(typeof Fe!="number"||Fe<0||Fe>this.state.tooltipTicks.length-1)){var tt=this.state.tooltipTicks[Fe]&&this.state.tooltipTicks[Fe].value,Be=TI(this.state,Q,Fe,tt),Ge=this.state.tooltipTicks[Fe].coordinate,Qe=(this.state.offset.top+ae)/2,Ke=pe==="horizontal",ct=Ke?{x:Ge,y:Qe}:{y:Ge,x:Qe},He=this.state.formattedGraphicalItems.find(function(ut){var nt=ut.item;return nt.type.name==="Scatter"});He&&(ct=Wt(Wt({},ct),He.props.points[Fe].tooltipPosition),Be=He.props.points[Fe].tooltipPayload);var qe={activeTooltipIndex:Fe,isTooltipActive:!0,activeLabel:tt,activePayload:Be,activeCoordinate:ct};this.setState(qe),this.renderCursor(Pe),this.accessibilityManager.setIndex(Fe)}}}},{key:"getSnapshotBeforeUpdate",value:function(X,ie){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ie.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==X.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==X.margin){var Q,ae;this.accessibilityManager.setDetails({offset:{left:(Q=this.props.margin.left)!==null&&Q!==void 0?Q:0,top:(ae=this.props.margin.top)!==null&&ae!==void 0?ae:0}})}return null}},{key:"componentDidUpdate",value:function(X){tC([Na(X.children,Yl)],[Na(this.props.children,Yl)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var X=Na(this.props.children,Yl);if(X&&typeof X.props.shared=="boolean"){var ie=X.props.shared?"axis":"item";return i.indexOf(ie)>=0?ie:m}return m}},{key:"getMouseInfo",value:function(X){if(!this.container)return null;var ie=this.container,Q=ie.getBoundingClientRect(),ae=Cwe(Q),pe={chartX:Math.round(X.pageX-ae.left),chartY:Math.round(X.pageY-ae.top)},Pe=Q.width/ie.offsetWidth||1,Fe=this.inRange(pe.chartX,pe.chartY,Pe);if(!Fe)return null;var tt=this.state,Be=tt.xAxisMap,Ge=tt.yAxisMap,Qe=this.getTooltipEventType(),Ke=E5(this.state,this.props.data,this.props.layout,Fe);if(Qe!=="axis"&&Be&&Ge){var ct=zh(Be).scale,He=zh(Ge).scale,qe=ct&&ct.invert?ct.invert(pe.chartX):null,ut=He&&He.invert?He.invert(pe.chartY):null;return Wt(Wt({},pe),{},{xValue:qe,yValue:ut},Ke)}return Ke?Wt(Wt({},pe),Ke):null}},{key:"inRange",value:function(X,ie){var Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ae=this.props.layout,pe=X/Q,Pe=ie/Q;if(ae==="horizontal"||ae==="vertical"){var Fe=this.state.offset,tt=pe>=Fe.left&&pe<=Fe.left+Fe.width&&Pe>=Fe.top&&Pe<=Fe.top+Fe.height;return tt?{x:pe,y:Pe}:null}var Be=this.state,Ge=Be.angleAxisMap,Qe=Be.radiusAxisMap;if(Ge&&Qe){var Ke=zh(Ge);return sB({x:pe,y:Pe},Ke)}return null}},{key:"parseEventsOfWrapper",value:function(){var X=this.props.children,ie=this.getTooltipEventType(),Q=Na(X,Yl),ae={};Q&&ie==="axis"&&(Q.props.trigger==="click"?ae={onClick:this.handleClick}:ae={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var pe=gw(this.props,this.handleOuterEvent);return Wt(Wt({},pe),ae)}},{key:"addListener",value:function(){JA.on(QA,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){JA.removeListener(QA,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(X,ie,Q){for(var ae=this.state.formattedGraphicalItems,pe=0,Pe=ae.length;pe<Pe;pe++){var Fe=ae[pe];if(Fe.item===X||Fe.props.key===X.key||ie===ku(Fe.item.type)&&Q===Fe.childIndex)return Fe}return null}},{key:"renderClipPath",value:function(){var X=this.clipPathId,ie=this.state.offset,Q=ie.left,ae=ie.top,pe=ie.height,Pe=ie.width;return $e.createElement("defs",null,$e.createElement("clipPath",{id:X},$e.createElement("rect",{x:Q,y:ae,height:pe,width:Pe})))}},{key:"getXScales",value:function(){var X=this.state.xAxisMap;return X?Object.entries(X).reduce(function(ie,Q){var ae=w5(Q,2),pe=ae[0],Pe=ae[1];return Wt(Wt({},ie),{},In({},pe,Pe.scale))},{}):null}},{key:"getYScales",value:function(){var X=this.state.yAxisMap;return X?Object.entries(X).reduce(function(ie,Q){var ae=w5(Q,2),pe=ae[0],Pe=ae[1];return Wt(Wt({},ie),{},In({},pe,Pe.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(X){var ie;return(ie=this.state.xAxisMap)===null||ie===void 0||(ie=ie[X])===null||ie===void 0?void 0:ie.scale}},{key:"getYScaleByAxisId",value:function(X){var ie;return(ie=this.state.yAxisMap)===null||ie===void 0||(ie=ie[X])===null||ie===void 0?void 0:ie.scale}},{key:"getItemByXY",value:function(X){var ie=this.state,Q=ie.formattedGraphicalItems,ae=ie.activeItem;if(Q&&Q.length)for(var pe=0,Pe=Q.length;pe<Pe;pe++){var Fe=Q[pe],tt=Fe.props,Be=Fe.item,Ge=Be.type.defaultProps!==void 0?Wt(Wt({},Be.type.defaultProps),Be.props):Be.props,Qe=ku(Be.type);if(Qe==="Bar"){var Ke=(tt.data||[]).find(function(ut){return uIe(X,ut)});if(Ke)return{graphicalItem:Fe,payload:Ke}}else if(Qe==="RadialBar"){var ct=(tt.data||[]).find(function(ut){return sB(X,ut)});if(ct)return{graphicalItem:Fe,payload:ct}}else if(CS(Fe,ae)||IS(Fe,ae)||b0(Fe,ae)){var He=fMe({graphicalItem:Fe,activeTooltipItem:ae,itemData:Ge.data}),qe=Ge.activeIndex===void 0?He:Ge.activeIndex;return{graphicalItem:Wt(Wt({},Fe),{},{childIndex:qe}),payload:b0(Fe,ae)?Ge.data[He]:Fe.props.data[He]}}}return null}},{key:"render",value:function(){var X=this;if(!Xz(this))return null;var ie=this.props,Q=ie.children,ae=ie.className,pe=ie.width,Pe=ie.height,Fe=ie.style,tt=ie.compact,Be=ie.title,Ge=ie.desc,Qe=T5(ie,wke),Ke=Si(Qe,!1);if(tt)return $e.createElement(i5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},$e.createElement(nC,Wm({},Ke,{width:pe,height:Pe,title:Be,desc:Ge}),this.renderClipPath(),Yz(Q,this.renderMap)));if(this.props.accessibilityLayer){var ct,He;Ke.tabIndex=(ct=this.props.tabIndex)!==null&&ct!==void 0?ct:0,Ke.role=(He=this.props.role)!==null&&He!==void 0?He:"application",Ke.onKeyDown=function(ut){X.accessibilityManager.keyboardEvent(ut)},Ke.onFocus=function(){X.accessibilityManager.focus()}}var qe=this.parseEventsOfWrapper();return $e.createElement(i5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},$e.createElement("div",Wm({className:Ei("recharts-wrapper",ae),style:Wt({position:"relative",cursor:"default",width:pe,height:Pe},Fe)},qe,{ref:function(nt){X.container=nt}}),$e.createElement(nC,Wm({},Ke,{width:pe,height:Pe,title:Be,desc:Ge,style:Fke}),this.renderClipPath(),Yz(Q,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(B.Component);In(G,"displayName",n),In(G,"defaultProps",Wt({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},M)),In(G,"getDerivedStateFromProps",function(U,K){var J=U.dataKey,X=U.data,ie=U.children,Q=U.width,ae=U.height,pe=U.layout,Pe=U.stackOffset,Fe=U.margin,tt=K.dataStartIndex,Be=K.dataEndIndex;if(K.updateId===void 0){var Ge=A5(U);return Wt(Wt(Wt({},Ge),{},{updateId:0},z(Wt(Wt({props:U},Ge),{},{updateId:0}),K)),{},{prevDataKey:J,prevData:X,prevWidth:Q,prevHeight:ae,prevLayout:pe,prevStackOffset:Pe,prevMargin:Fe,prevChildren:ie})}if(J!==K.prevDataKey||X!==K.prevData||Q!==K.prevWidth||ae!==K.prevHeight||pe!==K.prevLayout||Pe!==K.prevStackOffset||!Qm(Fe,K.prevMargin)){var Qe=A5(U),Ke={chartX:K.chartX,chartY:K.chartY,isTooltipActive:K.isTooltipActive},ct=Wt(Wt({},E5(K,X,pe)),{},{updateId:K.updateId+1}),He=Wt(Wt(Wt({},Qe),Ke),ct);return Wt(Wt(Wt({},He),z(Wt({props:U},He),K)),{},{prevDataKey:J,prevData:X,prevWidth:Q,prevHeight:ae,prevLayout:pe,prevStackOffset:Pe,prevMargin:Fe,prevChildren:ie})}if(!tC(ie,K.prevChildren)){var qe,ut,nt,Kt,cr=Na(ie,Tg),Bt=cr&&(qe=(ut=cr.props)===null||ut===void 0?void 0:ut.startIndex)!==null&&qe!==void 0?qe:tt,Vt=cr&&(nt=(Kt=cr.props)===null||Kt===void 0?void 0:Kt.endIndex)!==null&&nt!==void 0?nt:Be,xr=Bt!==tt||Vt!==Be,nn=!mi(X),Hn=nn&&!xr?K.updateId:K.updateId+1;return Wt(Wt({updateId:Hn},z(Wt(Wt({props:U},K),{},{updateId:Hn,dataStartIndex:Bt,dataEndIndex:Vt}),K)),{},{prevChildren:ie,dataStartIndex:Bt,dataEndIndex:Vt})}return null}),In(G,"renderActiveDot",function(U,K,J){var X;return B.isValidElement(U)?X=B.cloneElement(U,K):ai(U)?X=U(K):X=$e.createElement(HO,K),$e.createElement(Bo,{className:"recharts-active-dot",key:J},X)});var F=B.forwardRef(function(K,J){return $e.createElement(G,Wm({},K,{ref:J}))});return F.displayName=G.displayName,F},Xke=OH({chartName:"LineChart",GraphicalChild:ex,axisComponents:[{axisType:"xAxis",AxisComp:Og},{axisType:"yAxis",AxisComp:Dg}],formatAxisMap:ZG}),Kke=OH({chartName:"BarChart",GraphicalChild:Vf,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Og},{axisType:"yAxis",AxisComp:Dg}],formatAxisMap:ZG});function Yke(){const[e,t]=B.useState({properties:0,submissions:0,inquiries:0,verified:0}),n=async()=>{try{const[m,_,i,S]=await Promise.all([Er.from("properties").select("id",{count:"exact"}),Er.from("property_submissions").select("id",{count:"exact"}),Er.from("buyer_inquiries").select("id",{count:"exact"}),Er.from("properties").select("id",{count:"exact"}).eq("is_verified",!0)]);t({properties:m.count??0,submissions:_.count??0,inquiries:i.count??0,verified:S.count??0})}catch(m){console.warn("Failed to fetch realtime counts",m)}};B.useEffect(()=>{n();const m=Er.channel("realtime-admin-charts").on("postgres_changes",{event:"*",schema:"public",table:"properties"},()=>n()).on("postgres_changes",{event:"*",schema:"public",table:"property_submissions"},()=>n()).on("postgres_changes",{event:"*",schema:"public",table:"buyer_inquiries"},()=>n()).subscribe();return()=>{Er.removeChannel(m)}},[]);const s=[{name:"Properties",value:e.properties},{name:"Submissions",value:e.submissions},{name:"Inquiries",value:e.inquiries},{name:"Verified",value:e.verified}],h=[{name:"T-3",v:Math.max(0,e.properties-2)},{name:"T-2",v:Math.max(0,e.properties-1)},{name:"Now",v:e.properties}];return b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[b.jsxs(os,{children:[b.jsx(ss,{children:b.jsx(as,{children:"Live Overview"})}),b.jsx(ls,{children:b.jsx(Z3,{width:"100%",height:120,children:b.jsxs(Kke,{data:s,margin:{top:8,right:12,left:0,bottom:8},children:[b.jsx(Og,{dataKey:"name",tick:{fontSize:12}}),b.jsx(Dg,{}),b.jsx(Yl,{}),b.jsx(Vf,{dataKey:"value",fill:"#06b6d4",radius:[6,6,0,0]})]})})})]}),b.jsxs(os,{children:[b.jsx(ss,{children:b.jsx(as,{children:"Properties Trend"})}),b.jsx(ls,{children:b.jsx(Z3,{width:"100%",height:120,children:b.jsxs(Xke,{data:h,margin:{top:8,right:12,left:0,bottom:8},children:[b.jsx(pH,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),b.jsx(Og,{dataKey:"name",tick:{fontSize:12}}),b.jsx(Dg,{}),b.jsx(Yl,{}),b.jsx(ex,{type:"monotone",dataKey:"v",stroke:"#3b82f6",strokeWidth:2,dot:{r:2}})]})})})]}),b.jsxs(os,{children:[b.jsx(ss,{children:b.jsx(as,{children:"Quick Stats"})}),b.jsx(ls,{children:b.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[b.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Properties",b.jsx("br",{}),b.jsx("strong",{children:e.properties})]}),b.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Verified",b.jsx("br",{}),b.jsx("strong",{children:e.verified})]}),b.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Submissions",b.jsx("br",{}),b.jsx("strong",{children:e.submissions})]}),b.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Inquiries",b.jsx("br",{}),b.jsx("strong",{children:e.inquiries})]})]})})]})]})}const Jke=()=>{const[e,t]=B.useState({properties:0,submissions:0,inquiries:0,verified:0}),[n,s]=B.useState([]),[h,m]=B.useState([]),[_,i]=B.useState([]),[S,A]=B.useState(!0),[I,M]=B.useState(!1),[L,z]=B.useState(null),[G,F]=B.useState(null),U=(ie,Q)=>{z(ie),F(Q),M(!0)},K=async()=>{if(!L||!G)return M(!1);const ie=n;s(Q=>Q.filter(ae=>ae.id!==G.id)),t(Q=>({...Q,submissions:Math.max(0,Q.submissions-1)})),M(!1);try{L==="approve"?await J(G):await X(G)}catch{s(ie),rn({title:"Error",description:"Action failed. Changes rolled back.",variant:"destructive"})}finally{z(null),F(null)}};B.useEffect(()=>{(async()=>{A(!0);try{const[Q,ae,pe,Pe,Fe,tt,Be]=await Promise.all([Er.from("properties").select("id",{count:"exact"}),Er.from("property_submissions").select("id",{count:"exact"}),Er.from("buyer_inquiries").select("id",{count:"exact"}),Er.from("properties").select("id",{count:"exact"}).eq("is_verified",!0),Er.from("property_submissions").select("id,title,seller_name,seller_phone,price,status,images").order("created_at",{ascending:!1}).limit(5),Er.from("buyer_inquiries").select("id,buyer_name,buyer_phone,property_id,message,lead_status,created_at").order("created_at",{ascending:!1}).limit(5),Er.from("properties").select("id,title,location,price,status,is_verified,images").order("created_at",{ascending:!1}).limit(5)]);t({properties:Q.count??0,submissions:ae.count??0,inquiries:pe.count??0,verified:Pe.count??0}),s(Fe.data.map(Ge=>({...Ge,_firstImage:Ge.images?.[0]?Er.storage.from("properties").getPublicUrl(Ge.images[0]).data?.publicUrl:void 0}))||[]),m(tt.data||[]),i(Be.data.map(Ge=>({...Ge,_firstImage:Ge.images?.[0]?Er.storage.from("properties").getPublicUrl(Ge.images[0]).data?.publicUrl:void 0}))||[])}catch(Q){console.error(Q)}finally{A(!1)}})()},[]);const J=async ie=>{try{const{data:Q,error:ae}=await Er.from("properties").insert([{title:ie.title,description:ie.description||null,property_type:ie.property_type||"land",price:ie.price||0,location:ie.location||"",images:ie.images||null,seller_name:ie.seller_name||null,seller_phone:ie.seller_phone||null,is_admin_property:!1,approved_at:new Date().toISOString()}]).select().single();if(ae)throw ae;await Er.from("property_submissions").update({status:"approved",created_property_id:Q.id,reviewed_at:new Date().toISOString()}).eq("id",ie.id),t(pe=>({...pe,properties:pe.properties+1})),rn({title:"Approved",description:"Submission approved and published.",variant:"default"})}catch(Q){console.error(Q),rn({title:"Error",description:Q.message||"Failed to approve submission.",variant:"destructive"})}},X=async ie=>{try{await Er.from("property_submissions").update({status:"rejected",reviewed_at:new Date().toISOString()}).eq("id",ie.id),rn({title:"Rejected",description:"Submission rejected.",variant:"default"})}catch(Q){console.error(Q),rn({title:"Error",description:Q.message||"Failed to reject submission.",variant:"destructive"})}};return b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsx(rue,{}),b.jsxs(Wv,{children:[b.jsx(Yke,{}),b.jsx(nue,{counts:e})]}),b.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:b.jsxs(Wv,{children:[b.jsx(iue,{submissions:n,loading:S,onApprove:U.bind(null,"approve"),onReject:U.bind(null,"reject")}),b.jsx(oue,{inquiries:h,loading:S}),b.jsx(sue,{properties:_,loading:S})]})}),b.jsx(aue,{open:I,action:L,item:G,onClose:()=>M(!1),onConfirm:K})]})})};var RH={exports:{}};(function(e,t){(function(n,s){e.exports=s()})(vv,function(){var n,s,h;function m(i,S){if(!n)n=S;else if(!s)s=S;else{var A="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",I={};n(I),h=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}m(["exports"],function(i){var S=1e-6,A=typeof Float32Array<"u"?Float32Array:Array;function I(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=a*g-d*u;return y?(l[0]=g*(y=1/y),l[1]=-u*y,l[2]=-d*y,l[3]=a*y,l):null}function M(){var l=new A(9);return A!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function L(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=r[4],x=r[5],E=r[6],C=r[7],R=r[8];return l[0]=y*R-x*C,l[1]=d*C-u*R,l[2]=u*x-d*y,l[3]=x*E-g*R,l[4]=a*R-d*E,l[5]=d*g-a*x,l[6]=g*C-y*E,l[7]=u*E-a*C,l[8]=a*y-u*g,l}function z(l,r,a){var u=r[0],d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],C=r[6],R=r[7],D=r[8],j=a[0],V=a[1],$=a[2],Z=a[3],re=a[4],te=a[5],le=a[6],ue=a[7],fe=a[8];return l[0]=j*u+V*y+$*C,l[1]=j*d+V*x+$*R,l[2]=j*g+V*E+$*D,l[3]=Z*u+re*y+te*C,l[4]=Z*d+re*x+te*R,l[5]=Z*g+re*E+te*D,l[6]=le*u+ue*y+fe*C,l[7]=le*d+ue*x+fe*R,l[8]=le*g+ue*E+fe*D,l}function G(){var l=new A(16);return A!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function F(l){var r=new A(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r}function U(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function K(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=r[4],x=r[5],E=r[6],C=r[7],R=r[8],D=r[9],j=r[10],V=r[11],$=r[12],Z=r[13],re=r[14],te=r[15],le=a*x-u*y,ue=a*E-d*y,fe=a*C-g*y,we=u*E-d*x,_e=u*C-g*x,Ee=d*C-g*E,Me=R*Z-D*$,De=R*re-j*$,rt=R*te-V*$,Ne=D*re-j*Z,at=D*te-V*Z,ft=j*te-V*re,pt=le*ft-ue*at+fe*Ne+we*rt-_e*De+Ee*Me;return pt?(l[0]=(x*ft-E*at+C*Ne)*(pt=1/pt),l[1]=(d*at-u*ft-g*Ne)*pt,l[2]=(Z*Ee-re*_e+te*we)*pt,l[3]=(j*_e-D*Ee-V*we)*pt,l[4]=(E*rt-y*ft-C*De)*pt,l[5]=(a*ft-d*rt+g*De)*pt,l[6]=(re*fe-$*Ee-te*ue)*pt,l[7]=(R*Ee-j*fe+V*ue)*pt,l[8]=(y*at-x*rt+C*Me)*pt,l[9]=(u*rt-a*at-g*Me)*pt,l[10]=($*_e-Z*fe+te*le)*pt,l[11]=(D*fe-R*_e-V*le)*pt,l[12]=(x*De-y*Ne-E*Me)*pt,l[13]=(a*Ne-u*De+d*Me)*pt,l[14]=(Z*ue-$*we-re*le)*pt,l[15]=(R*we-D*ue+j*le)*pt,l):null}function J(l,r,a){var u=r[0],d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],C=r[6],R=r[7],D=r[8],j=r[9],V=r[10],$=r[11],Z=r[12],re=r[13],te=r[14],le=r[15],ue=a[0],fe=a[1],we=a[2],_e=a[3];return l[0]=ue*u+fe*x+we*D+_e*Z,l[1]=ue*d+fe*E+we*j+_e*re,l[2]=ue*g+fe*C+we*V+_e*te,l[3]=ue*y+fe*R+we*$+_e*le,l[4]=(ue=a[4])*u+(fe=a[5])*x+(we=a[6])*D+(_e=a[7])*Z,l[5]=ue*d+fe*E+we*j+_e*re,l[6]=ue*g+fe*C+we*V+_e*te,l[7]=ue*y+fe*R+we*$+_e*le,l[8]=(ue=a[8])*u+(fe=a[9])*x+(we=a[10])*D+(_e=a[11])*Z,l[9]=ue*d+fe*E+we*j+_e*re,l[10]=ue*g+fe*C+we*V+_e*te,l[11]=ue*y+fe*R+we*$+_e*le,l[12]=(ue=a[12])*u+(fe=a[13])*x+(we=a[14])*D+(_e=a[15])*Z,l[13]=ue*d+fe*E+we*j+_e*re,l[14]=ue*g+fe*C+we*V+_e*te,l[15]=ue*y+fe*R+we*$+_e*le,l}function X(l,r,a){var u,d,g,y,x,E,C,R,D,j,V,$,Z=a[0],re=a[1],te=a[2];return r===l?(l[12]=r[0]*Z+r[4]*re+r[8]*te+r[12],l[13]=r[1]*Z+r[5]*re+r[9]*te+r[13],l[14]=r[2]*Z+r[6]*re+r[10]*te+r[14],l[15]=r[3]*Z+r[7]*re+r[11]*te+r[15]):(d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],C=r[6],R=r[7],D=r[8],j=r[9],V=r[10],$=r[11],l[0]=u=r[0],l[1]=d,l[2]=g,l[3]=y,l[4]=x,l[5]=E,l[6]=C,l[7]=R,l[8]=D,l[9]=j,l[10]=V,l[11]=$,l[12]=u*Z+x*re+D*te+r[12],l[13]=d*Z+E*re+j*te+r[13],l[14]=g*Z+C*re+V*te+r[14],l[15]=y*Z+R*re+$*te+r[15]),l}function ie(l,r,a){var u=a[0],d=a[1],g=a[2];return l[0]=r[0]*u,l[1]=r[1]*u,l[2]=r[2]*u,l[3]=r[3]*u,l[4]=r[4]*d,l[5]=r[5]*d,l[6]=r[6]*d,l[7]=r[7]*d,l[8]=r[8]*g,l[9]=r[9]*g,l[10]=r[10]*g,l[11]=r[11]*g,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l}function Q(l,r,a){var u=Math.sin(a),d=Math.cos(a),g=r[4],y=r[5],x=r[6],E=r[7],C=r[8],R=r[9],D=r[10],j=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=g*d+C*u,l[5]=y*d+R*u,l[6]=x*d+D*u,l[7]=E*d+j*u,l[8]=C*d-g*u,l[9]=R*d-y*u,l[10]=D*d-x*u,l[11]=j*d-E*u,l}function ae(l,r,a){var u=Math.sin(a),d=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],C=r[8],R=r[9],D=r[10],j=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=g*d-C*u,l[1]=y*d-R*u,l[2]=x*d-D*u,l[3]=E*d-j*u,l[8]=g*u+C*d,l[9]=y*u+R*d,l[10]=x*u+D*d,l[11]=E*u+j*d,l}function pe(l,r,a){var u=Math.sin(a),d=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],C=r[4],R=r[5],D=r[6],j=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=g*d+C*u,l[1]=y*d+R*u,l[2]=x*d+D*u,l[3]=E*d+j*u,l[4]=C*d-g*u,l[5]=R*d-y*u,l[6]=D*d-x*u,l[7]=j*d-E*u,l}function Pe(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Fe(l,r,a){var u,d,g,y=a[0],x=a[1],E=a[2],C=Math.sqrt(y*y+x*x+E*E);return C<S?null:(y*=C=1/C,x*=C,E*=C,u=Math.sin(r),d=Math.cos(r),l[0]=y*y*(g=1-d)+d,l[1]=x*y*g+E*u,l[2]=E*y*g-x*u,l[3]=0,l[4]=y*x*g-E*u,l[5]=x*x*g+d,l[6]=E*x*g+y*u,l[7]=0,l[8]=y*E*g+x*u,l[9]=x*E*g-y*u,l[10]=E*E*g+d,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function tt(l,r){var a=r[0],u=r[1],d=r[2],g=r[4],y=r[5],x=r[6],E=r[8],C=r[9],R=r[10];return l[0]=Math.sqrt(a*a+u*u+d*d),l[1]=Math.sqrt(g*g+y*y+x*x),l[2]=Math.sqrt(E*E+C*C+R*R),l}function Be(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=a+a,x=u+u,E=d+d,C=a*y,R=u*y,D=u*x,j=d*y,V=d*x,$=d*E,Z=g*y,re=g*x,te=g*E;return l[0]=1-D-$,l[1]=R+te,l[2]=j-re,l[3]=0,l[4]=R-te,l[5]=1-C-$,l[6]=V+Z,l[7]=0,l[8]=j+re,l[9]=V-Z,l[10]=1-C-D,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var Ge=J;function Qe(){var l=new A(3);return A!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Ke(l){var r=new A(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r}function ct(l){var r=l[0],a=l[1],u=l[2];return Math.sqrt(r*r+a*a+u*u)}function He(l,r,a){var u=new A(3);return u[0]=l,u[1]=r,u[2]=a,u}function qe(l,r,a,u){return l[0]=r,l[1]=a,l[2]=u,l}function ut(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l[2]=r[2]+a[2],l}function nt(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l[2]=r[2]-a[2],l}function Kt(l,r,a){return l[0]=r[0]*a[0],l[1]=r[1]*a[1],l[2]=r[2]*a[2],l}function cr(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l}function Bt(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l}function Vt(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l}function xr(l,r,a,u){return l[0]=r[0]+a[0]*u,l[1]=r[1]+a[1]*u,l[2]=r[2]+a[2]*u,l}function nn(l,r){var a=r[0]-l[0],u=r[1]-l[1],d=r[2]-l[2];return Math.sqrt(a*a+u*u+d*d)}function Hn(l,r){var a=r[0]-l[0],u=r[1]-l[1],d=r[2]-l[2];return a*a+u*u+d*d}function lr(l){var r=l[0],a=l[1],u=l[2];return r*r+a*a+u*u}function an(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l}function Lt(l,r){var a=r[0],u=r[1],d=r[2],g=a*a+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),l[0]=r[0]*g,l[1]=r[1]*g,l[2]=r[2]*g,l}function nr(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]}function pr(l,r,a){var u=r[0],d=r[1],g=r[2],y=a[0],x=a[1],E=a[2];return l[0]=d*E-g*x,l[1]=g*y-u*E,l[2]=u*x-d*y,l}function Nt(l,r,a,u){var d=r[0],g=r[1],y=r[2];return l[0]=d+u*(a[0]-d),l[1]=g+u*(a[1]-g),l[2]=y+u*(a[2]-y),l}function Nr(l,r,a){var u=r[0],d=r[1],g=r[2],y=a[3]*u+a[7]*d+a[11]*g+a[15];return l[0]=(a[0]*u+a[4]*d+a[8]*g+a[12])/(y=y||1),l[1]=(a[1]*u+a[5]*d+a[9]*g+a[13])/y,l[2]=(a[2]*u+a[6]*d+a[10]*g+a[14])/y,l}function un(l,r,a){var u=r[0],d=r[1],g=r[2];return l[0]=u*a[0]+d*a[3]+g*a[6],l[1]=u*a[1]+d*a[4]+g*a[7],l[2]=u*a[2]+d*a[5]+g*a[8],l}function ci(l,r,a){var u=a[0],d=a[1],g=a[2],y=a[3],x=r[0],E=r[1],C=r[2],R=d*C-g*E,D=g*x-u*C,j=u*E-d*x;return l[0]=x+y*(R+=R)+d*(j+=j)-g*(D+=D),l[1]=E+y*D+g*R-u*j,l[2]=C+y*j+u*D-d*R,l}function Un(l){return l[0]=0,l[1]=0,l[2]=0,l}function zn(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]}var Kn=nt,ks=Kt,ds=ct;function ao(){var l=new A(4);return A!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function bo(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l[3]=r[3]*a,l}function mo(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=a*a+u*u+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),l[0]=a*y,l[1]=u*y,l[2]=d*y,l[3]=g*y,l}function Hi(l,r,a){var u=r[0],d=r[1],g=r[2],y=r[3];return l[0]=a[0]*u+a[4]*d+a[8]*g+a[12]*y,l[1]=a[1]*u+a[5]*d+a[9]*g+a[13]*y,l[2]=a[2]*u+a[6]*d+a[10]*g+a[14]*y,l[3]=a[3]*u+a[7]*d+a[11]*g+a[15]*y,l}function Yo(){var l=new A(4);return A!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function wo(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function Po(l,r,a){a*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return l[0]=u*E+y*x,l[1]=d*E+g*x,l[2]=g*E-d*x,l[3]=y*E-u*x,l}function Gs(l,r,a){a*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return l[0]=u*E-g*x,l[1]=d*E+y*x,l[2]=g*E+u*x,l[3]=y*E-d*x,l}Qe(),ao();var Co,js,ba,Zt=mo,qt=(Co=Qe(),js=He(1,0,0),ba=He(0,1,0),function(l,r,a){var u=nr(r,a);return u<-.999999?(pr(Co,js,r),ds(Co)<1e-6&&pr(Co,ba,r),Lt(Co,Co),function(d,g,y){y*=.5;var x=Math.sin(y);d[0]=x*g[0],d[1]=x*g[1],d[2]=x*g[2],d[3]=Math.cos(y)}(l,Co,Math.PI),l):u>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(pr(Co,r,a),l[0]=Co[0],l[1]=Co[1],l[2]=Co[2],l[3]=1+u,Zt(l,l))});function fr(){var l=new A(2);return A!=Float32Array&&(l[0]=0,l[1]=0),l}function Ir(l,r){var a=new A(2);return a[0]=l,a[1]=r,a}function On(l,r,a){return l[0]=r,l[1]=a,l}function Ii(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l}function eo(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l}function ko(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l}function Io(l){var r=l[0],a=l[1];return Math.sqrt(r*r+a*a)}function wa(l,r){var a=r[0],u=r[1],d=a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),l[0]=r[0]*d,l[1]=r[1]*d,l}function Mi(l,r){return l[0]*r[0]+l[1]*r[1]}Yo(),Yo(),M();var ln,si,on=eo;function Wn(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}fr();var Yn=function(){if(si)return ln;function l(r,a,u,d){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=u,this.p2y=d}return si=1,ln=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(a===void 0&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,d=0;d<8;d++){var g=this.sampleCurveX(u)-r;if(Math.abs(g)<a)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var x=0,E=1;for(u=r,d=0;d<20&&(g=this.sampleCurveX(u),!(Math.abs(g-r)<a));d++)r>g?x=u:E=u,u=.5*(E-x)+x;return u},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},ln}(),jo=Wn(Yn);function mt(l,r){this.x=l,this.y=r}function Vo(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(!Vo(l[a],r[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const a in l)if(!Vo(l[a],r[a]))return!1;return!0}return l===r}mt.prototype={clone(){return new mt(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,a=l.y-this.y;return r*r+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),a=Math.sin(l),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround(l,r){const a=Math.cos(l),u=Math.sin(l),d=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mt},mt.convert=function(l){if(l instanceof mt)return l;if(Array.isArray(l))return new mt(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new mt(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ta=Math.PI/180,Lo=180/Math.PI;function qr(l){return l*Ta}function Jo(l){return l*Lo}const ly=[[0,0],[1,0],[1,1],[0,1]];function eu(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,a=r*l;return 4*(l<.5?a:3*(l-r)+a-.75)}function ad(l,r,a,u){const d=new jo(l,r,a,u);return function(g){return d.solve(g)}}const Ue=ad(.25,.1,.25,1);function ne(l,r,a){return Math.min(a,Math.max(r,l))}function ce(l,r,a){return(a=ne((a-l)/(r-l),0,1))*a*(3-2*a)}function ge(l,r,a){const u=a-r,d=((l-r)%u+u)%u+r;return d===r?a:d}function Oe(l,r,a){if(!l.length)return a(null,[]);let u=l.length;const d=new Array(l.length);let g=null;l.forEach((y,x)=>{r(y,(E,C)=>{E&&(g=E),d[x]=C,--u==0&&a(g,d)})})}let Ie=1;function je(){return Ie++}function Ye(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function ze(l,r){l.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Xe(l,r,a){const u={};for(const d in l)u[d]=r.call(this,l[d],d,l);return u}function Tt(l,r,a){const u={};for(const d in l)r.call(this,l[d],d,l)&&(u[d]=l[d]);return u}function dt(l){return Array.isArray(l)?l.map(dt):typeof l=="object"&&l?Xe(l,dt):l}function Xt(l,r){for(let a=0;a<l.length;a++)if(r.indexOf(l[a])>=0)return!0;return!1}const hr={};function Ut(l){hr[l]||(typeof console<"u"&&console.warn(l),hr[l]=!0)}function zr(l,r,a){return(a.y-l.y)*(r.x-l.x)>(r.y-l.y)*(a.x-l.x)}function jr(l){let r=0;for(let a,u,d=0,g=l.length,y=g-1;d<g;y=d++)a=l[d],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}function Dr([l,r,a]){const u=qr(r+90),d=qr(a);return{x:l*Math.cos(u)*Math.sin(d),y:l*Math.sin(u)*Math.sin(d),z:l*Math.cos(d),azimuthal:r,polar:a}}function hn(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function Ai(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,d,g)=>{const y=d||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Wi=null;function Oi(l,r){return[l[4*r],l[4*r+1],l[4*r+2],l[4*r+3]]}function Ji(l,r,a,u){for(;r<a;){const d=r+a>>1;l[d]<u?r=d+1:a=d}return r}function xi(l,r,a,u){for(;r<a;){const d=r+a>>1;l[d]<=u?r=d+1:a=d}return r}function mn(l){return l>0?1/(1.001-l):1+l}function bi(l){return l>0?1-1/(1.001-l):-l}function Jn(l,r,a){return(l-r.min)*(a.max-a.min)/(r.max-r.min)+a.min}const Jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Jr.API_URL)return null;try{const l=new URL(Jr.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ri(l){return Jr.API_URL_REGEX.test(l)}function No(l){return Jr.API_SPRITE_REGEX.test(l)}let $o,Ts,tu,To,Hs,Qo;function $a(){return $o==null&&($o=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),$o}const go={now:()=>To!==void 0?To:performance.now(),setNow(l){To=l},restoreNow(){To=void 0},frame(l){const r=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(l,r=0){const{width:a,height:u}=l;Hs||(Hs=document.createElement("canvas"));const d=Hs.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>Hs.width||u>Hs.height)&&(Hs.width=a,Hs.height=u),d.clearRect(-r,-r,a+2*r,u+2*r),d.drawImage(l,0,0,a,u),d.getImageData(-r,-r,a+2*r,u+2*r)},resolveURL:l=>(Ts||(Ts=document.createElement("a")),Ts.href=l,Ts.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(tu==null&&(tu=window.matchMedia("(prefers-reduced-motion: reduce)")),tu.matches)},hasCanvasFingerprintNoise(){if(Qo!==void 0)return Qo;if(!$a())return Qo=!1,!1;const l=new OffscreenCanvas(85,1),r=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let d=0;d<l.width;++d)r.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,r.fillRect(d,0,1,1);const u=r.getImageData(0,0,l.width,l.height);a=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&a++!==u.data[d])return Qo=!0,!0;return Qo=!1,!1}};function ru(l,r){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(l.slice(a));for(const d in r)u.set(d,r[d]);return`${l.slice(0,a)}?${u.toString()}`}function Yu(l,r={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const u=new URLSearchParams,d=new URLSearchParams(l.slice(a));for(const y of r.persistentParams){const x=d.get(y);x&&u.set(y,x)}const g=u.toString();return`${l.slice(0,a)}${g.length>0?`?${g}`:""}`}const Gf="mapbox-tiles";let Hf=500,Wf=50;const ld=["language","worldview","jobid"];let Ua,Ss;function Sa(){try{return caches}catch{}}function Ea(){const l=Sa();l&&Ua==null&&(Ua=l.open(Gf))}let na=1/0;const Ga={supported:!1,testSupport:function(l){!qf&&nu&&(iu?ix(l):pc=l)}};let pc,nu,qf=!1,iu=!1;const Zf=typeof self<"u"?self:{};function ix(l){const r=l.createTexture();l.bindTexture(l.TEXTURE_2D,r);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,nu),l.isContextLost())return;Ga.supported=!0}catch{}l.deleteTexture(r),qf=!0}Zf.document&&(nu=Zf.document.createElement("img"),nu.onload=function(){pc&&ix(pc),pc=null,iu=!0},nu.onerror=function(){qf=!0,pc=null},nu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(cd);class Ls extends Error{constructor(r,a,u){a===401&&Ri(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Xf=hn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ou=function(l,r){if(!(/^file:/.test(a=l.url)||/^file:/.test(Xf())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Xf(),referrerPolicy:u.referrerPolicy,signal:g.signal});let x=!1,E=!1;const C=(R=y.url).indexOf("sku=")>0&&Ri(R);var R;u.type==="json"&&y.headers.set("Accept","application/json");const D=(V,$,Z)=>{if(E)return;if(V&&V.message!=="SecurityError"&&Ut(V.toString()),$&&Z)return j($);const re=Date.now();fetch(y).then(te=>{if(te.ok){const le=C?te.clone():null;return j(te,le,re)}return d(new Ls(te.statusText,te.status,u.url))}).catch(te=>{te.name!=="AbortError"&&d(new Error(`${te.message} ${u.url}`))})},j=(V,$,Z)=>{(u.type==="arrayBuffer"?V.arrayBuffer():u.type==="json"?V.json():V.text()).then(re=>{E||($&&Z&&function(te,le,ue){if(Ea(),Ua==null)return;const fe=Ai(le.headers.get("Cache-Control")||"");if(fe["no-store"])return;const we={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Me,De)=>we.headers.set(De,Me)),fe["max-age"]&&we.headers.set("Expires",new Date(ue+1e3*fe["max-age"]).toUTCString());const _e=we.headers.get("Expires");if(!_e||new Date(_e).getTime()-ue<42e4)return;let Ee=Yu(te.url,{persistentParams:ld});if(le.status===206){const Me=te.headers.get("Range");if(!Me)return;we.status=200,Ee=ru(Ee,{range:Me})}(function(Me,De){if(Ss===void 0)try{new Response(new ReadableStream),Ss=!0}catch{Ss=!1}Ss?De(Me.body):Me.blob().then(De).catch(rt=>Ut(rt.message))})(le,Me=>{const De=new Response((rt=le.status)!==200&&rt!==404&&[101,103,204,205,304].includes(rt)?null:Me,we);var rt;Ea(),Ua?.then(Ne=>Ne.put(Ee,De)).catch(Ne=>Ut(Ne.message))})}(y,$,Z),x=!0,d(null,re,V.headers))}).catch(re=>{E||d(new Error(re.message))})};return C?function(V,$){if(Ea(),Ua==null)return $(null);Ua.then(Z=>{let re=Yu(V.url,{persistentParams:ld});const te=V.headers.get("Range");te&&(re=ru(re,{range:te})),Z.match(re).then(le=>{const ue=function(fe){if(!fe)return!1;const we=new Date(fe.headers.get("Expires")||0),_e=Ai(fe.headers.get("Cache-Control")||"");return Number(we)>Date.now()&&!_e["no-cache"]}(le);Z.delete(re).catch($),ue&&Z.put(re,le.clone()).catch($),$(null,le,ue)}).catch($)}).catch($)}(y,D):D(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(l,r);if(hn(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,r,void 0,!0)}var a;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(E){return d(E)}const x=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(E=>{const C=E.split(": "),R=C.shift(),D=C.join(": ");x.append(R,D)}),d(null,y,x)}else d(new Ls(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(l,r)},wl=function(l,r){return ou(Object.assign(l,{type:"arrayBuffer"}),r)};function HS(l){const r=document.createElement("a");return r.href=l,r.protocol===location.protocol&&r.host===location.host}const ox="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ud,gn;ud=[],gn=0;const Kf=function(l,r){if(Ga.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),gn>=Jr.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:l,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return ud.push(g),g}gn++;let a=!1;const u=()=>{if(!a)for(a=!0,gn--;ud.length&&gn<Jr.MAX_PARALLEL_IMAGE_REQUESTS;){const g=ud.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=Kf(y,x).cancel)}},d=wl(l,(g,y,x)=>{u(),g?r(g):y&&(self.createImageBitmap?function(E,C){const R=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(R).then(D=>{C(null,D)}).catch(D=>{C(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,C)=>r(E,C,x)):function(E,C){const R=new Image;R.onload=()=>{C(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=ox})},R.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(E)],{type:"image/png"});R.src=E.byteLength?URL.createObjectURL(D):ox}(y,(E,C)=>r(E,C,x)))});return{cancel:()=>{d.cancel(),u()}}};var cy,sx,ax,mc={exports:{}},hd={exports:{}},dd={exports:{}},uy=function(){if(ax)return mc.exports;ax=1;var l=(cy||(cy=1,hd.exports=function(a,u){var d,g,y,x,E,C,R,D;for(g=a.length-(d=3&a.length),y=u,E=3432918353,C=461845907,D=0;D<g;)R=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,y=27492+(65535&(x=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(R=0,d){case 3:R^=(255&a.charCodeAt(D+2))<<16;case 2:R^=(255&a.charCodeAt(D+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&a.charCodeAt(D)))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),hd.exports),r=(sx||(sx=1,dd.exports=function(a,u){for(var d,g=a.length,y=u^g,x=0;g>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(x)|(255&a.charCodeAt(++x))<<8|(255&a.charCodeAt(++x))<<16|(255&a.charCodeAt(++x))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++x;switch(g){case 3:y^=(255&a.charCodeAt(x+2))<<16;case 2:y^=(255&a.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),dd.exports);return mc.exports=l,mc.exports.murmur3=l,mc.exports.murmur2=r,mc.exports}(),Yf=Wn(uy);class Ha{constructor(r,...a){Object.assign(this,a[0]||{}),this.type=r}}class fd extends Ha{constructor(r,a={}){super("error",Object.assign({error:r},a))}}function hy(l,r,a){a[l]&&a[l].indexOf(r)!==-1||(a[l]=a[l]||[],a[l].push(r))}function gc(l,r,a){if(a&&a[l]){const u=a[l].indexOf(r);u!==-1&&a[l].splice(u,1)}}class su{on(r,a){return this._listeners=this._listeners||{},hy(r,a,this._listeners),this}off(r,a){return gc(r,a,this._listeners),gc(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},hy(r,a,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,a){const u=typeof r=="string"?new Ha(r,a):r,d=u.type;if(this.listens(d)){u.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of g)E.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of y)gc(d,E,this._oneTimeListeners),E.call(this,u);const x=this._eventedParent;if(x){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,E),x.fire(u)}}else u instanceof fd&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}class es{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new es(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[a,u]=r.split("");return new es({name:a,iconsetId:u})}static isEqual(r,a){return r.name===a.name&&r.iconsetId===a.iconsetId}toString(){return es.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Jf,pd={},ia=function(){if(Jf)return pd;Jf=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(g){return(g=Math.round(g))<0?0:g>255?255:g}function a(g){return r(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function d(g,y,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?g+(y-g)*x*6:2*x<1?y:3*x<2?g+(y-g)*(2/3-x)*6:g}try{pd.parseCSSColor=function(g){var y,x=g.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(y=parseInt(x.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:x.length===7&&(y=parseInt(x.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=x.indexOf("("),C=x.indexOf(")");if(E!==-1&&C+1===x.length){var R=x.substr(0,E),D=x.substr(E+1,C-(E+1)).split(","),j=1;switch(R){case"rgba":if(D.length!==4)return null;j=u(D.pop());case"rgb":return D.length!==3?null:[a(D[0]),a(D[1]),a(D[2]),j];case"hsla":if(D.length!==4)return null;j=u(D.pop());case"hsl":if(D.length!==3)return null;var V=(parseFloat(D[0])%360+360)%360/360,$=u(D[1]),Z=u(D[2]),re=Z<=.5?Z*($+1):Z+$-Z*$,te=2*Z-re;return[r(255*d(te,re,V+1/3)),r(255*d(te,re,V)),r(255*d(te,re,V-1/3)),j];default:return null}}return null}}catch{}return pd}();class Dn{constructor(r,a,u,d=1){this.r=r,this.g=a,this.b=u,this.a=d}static parse(r){if(!r)return;if(r instanceof Dn)return r;if(typeof r!="string")return;const a=ia.parseCSSColor(r);return a?new Dn(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[r,a,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*a)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(r){const{r:a,g:u,b:d,a:g}=this;return new cx(r,a,u,d,g)}toPremultipliedRenderColor(r){const{r:a,g:u,b:d,a:g}=this;return new ux(r,a*g,u*g,d*g,g)}clone(){return new Dn(this.r,this.g,this.b,this.a)}}class lx{constructor(r,a,u,d,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,r){const x=r.image.height,E=x*x;this.premultiplied?(a=g===0?0:a/g*(x-1),u=g===0?0:u/g*(x-1),d=g===0?0:d/g*(x-1)):(a*=x-1,u*=x-1,d*=x-1);const C=Math.floor(a),R=Math.floor(u),D=Math.floor(d),j=Math.ceil(a),V=Math.ceil(u),$=Math.ceil(d),Z=a-C,re=u-R,te=d-D,le=r.image.data,ue=4*(C+R*E+D*x),fe=4*(C+R*E+$*x),we=4*(C+V*E+D*x),_e=4*(C+V*E+$*x),Ee=4*(j+R*E+D*x),Me=4*(j+R*E+$*x),De=4*(j+V*E+D*x),rt=4*(j+V*E+$*x);if(ue<0||rt>=le.length)throw new Error("out of range");this.r=vr(vr(vr(le[ue],le[fe],te),vr(le[we],le[_e],te),re),vr(vr(le[Ee],le[Me],te),vr(le[De],le[rt],te),re),Z)/255*(this.premultiplied?g:1),this.g=vr(vr(vr(le[ue+1],le[fe+1],te),vr(le[we+1],le[_e+1],te),re),vr(vr(le[Ee+1],le[Me+1],te),vr(le[De+1],le[rt+1],te),re),Z)/255*(this.premultiplied?g:1),this.b=vr(vr(vr(le[ue+2],le[fe+2],te),vr(le[we+2],le[_e+2],te),re),vr(vr(le[Ee+2],le[Me+2],te),vr(le[De+2],le[rt+2],te),re),Z)/255*(this.premultiplied?g:1),this.a=g}else this.r=a,this.g=u,this.b=d,this.a=g}toArray(){const{r,g:a,b:u,a:d}=this;return[255*r,255*a,255*u,d]}toHslaArray(){let{r,g:a,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const $=1/d;r*=$,a*=$,u*=$}const g=Math.min(Math.max(r,0),1),y=Math.min(Math.max(a,0),1),x=Math.min(Math.max(u,0),1),E=Math.min(g,y,x),C=Math.max(g,y,x),R=C-E,D=.5*(E+C);if(R===0)return[0,0,100*D,d];const j=D>.5?R/(2-C-E):R/(C+E);let V;switch(C){case g:V=60*((y-x)/R+(y<x?6:0));break;case y:V=60*((x-g)/R+2);break;default:V=60*((g-y)/R+4)}return[V,100*j,100*D,d]}toArray01(){const{r,g:a,b:u,a:d}=this;return[r,a,u,d]}toArray01Scaled(r){const{r:a,g:u,b:d}=this;return[a*r,u*r,d*r]}toArray01Linear(){const{r,g:a,b:u,a:d}=this;return[Math.pow(r,2.2),Math.pow(a,2.2),Math.pow(u,2.2),d]}}class cx extends lx{constructor(r,a,u,d,g){super(r,a,u,d,g,!1)}}class ux extends lx{constructor(r,a,u,d,g){super(r,a,u,d,g,!0)}}function vr(l,r,a){return l*(1-a)+r*a}function dy(l,r,a){return l.map((u,d)=>vr(u,r[d],a))}Dn.black=new Dn(0,0,0,1),Dn.white=new Dn(1,1,1,1),Dn.transparent=new Dn(0,0,0,0),Dn.red=new Dn(1,0,0,1),Dn.blue=new Dn(0,0,1,1);var md=Object.freeze({__proto__:null,array:dy,color:function(l,r,a){return new Dn(vr(l.r,r.r,a),vr(l.g,r.g,a),vr(l.b,r.b,a),vr(l.a,r.a,a))},number:vr});class oa extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class Ju{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(r){return new Ju(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Aa={kind:"null"},ar={kind:"number"},cn={kind:"string"},Fn={kind:"boolean"},Es={kind:"color"},Wa={kind:"object"},Rn={kind:"value"},Qf={kind:"collator"},gd={kind:"formatted"},yd={kind:"resolvedImage"};function Uo(l,r){return{kind:"array",itemType:l,N:r}}function qi(l){if(l.kind==="array"){const r=qi(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const WS=[Aa,ar,cn,Fn,Es,gd,Wa,Uo(Rn),yd];function yc(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!yc(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const a of WS)if(!yc(a,r))return null}}return`Expected ${qi(l)} but found ${qi(r)} instead.`}function fy(l,r){return r.some(a=>a.kind===l.kind)}function _d(l,r){return r.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function ep(l,r){return l.kind==="array"&&r.kind==="array"?l.N===r.N&&ep(l.itemType,r.itemType):l.kind===r.kind}class py{constructor(r,a,u){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tp{constructor(r,a,u,d,g){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=u,this.fontStack=d,this.textColor=g}}class fs{constructor(r){this.sections=r}static fromString(r){return new fs([new tp(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof fs?r:fs.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){const d=a.image.getPrimary().id.toString();r.push(["image",d]);continue}r.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class Tl{constructor(r,a={}){this.id=es.from(r),this.params=a.params,this.sx=a.sx||1,this.sy=a.sy||1}toString(){return JSON.stringify(this)}static parse(r){let a,u,d,g;try{({id:a,params:u,sx:d,sy:g}=JSON.parse(r)||{})}catch{return null}return a?new Tl(a,{params:u,sx:d,sy:g}):null}scaleSelf(r,a=r){return this.sx*=r,this.sy*=a,this}}class ps{constructor(r,a,u,d,g=!1){this.primaryId=es.from(r),this.primaryOptions=a,u&&(this.secondaryId=es.from(u)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Tl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Tl(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?ps.build({name:r}):r}static build(r,a,u,d){return!r||typeof r=="object"&&!("name"in r)?null:new ps(r,u,a,d)}}function au(l,r,a,u){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,r,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,r,a,u]:[l,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qu(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Dn||l instanceof py||l instanceof fs||l instanceof ps)return!0;if(Array.isArray(l)){for(const r of l)if(!Qu(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!Qu(l[r]))return!1;return!0}return!1}function yo(l){if(l===null)return Aa;if(typeof l=="string")return cn;if(typeof l=="boolean")return Fn;if(typeof l=="number")return ar;if(l instanceof Dn)return Es;if(l instanceof py)return Qf;if(l instanceof fs)return gd;if(l instanceof ps)return yd;if(Array.isArray(l)){const r=l.length;let a;for(const u of l){const d=yo(u);if(a){if(a===d)continue;a=Rn;break}a=d}return Uo(a||Rn,r)}return Wa}function sa(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof fs||l instanceof ps||l instanceof Dn?l.toString():JSON.stringify(l)}class Sl{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Qu(r[1]))return a.error("invalid value");const u=r[1];let d=yo(u);const g=a.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Sl(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Dn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof fs?this.value.serialize():this.value}}class lo{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const my={string:cn,number:ar,boolean:Fn,object:Wa};class Pa{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let u,d=1;const g=r[0];if(g==="array"){let x,E;if(r.length>2){const C=r[1];if(typeof C!="string"||!(C in my)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=my[C],d++}else x=Rn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=r[2],d++}u=Uo(x,E)}else u=my[g];const y=[];for(;d<r.length;d++){const x=a.parse(r[d],d,Rn);if(!x)return null;y.push(x)}return new Pa(u,y)}evaluate(r){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(r);if(!yc(this.type,yo(u)))return u;if(a===this.args.length-1)throw new lo(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${qi(yo(u))} but was expected to be of type ${qi(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const d=r.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(u=>u.serialize()))}}class qa{constructor(r){this.type=gd,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=a.parseObjectValue(x["font-scale"],y,"font-scale",ar),!E))return null;let C=null;if(x["text-font"]&&(C=a.parseObjectValue(x["text-font"],y,"text-font",Uo(cn)),!C))return null;let R=null;if(x["text-color"]&&(R=a.parseObjectValue(x["text-color"],y,"text-color",Es),!R))return null;const D=d[d.length-1];D.scale=E,D.font=C,D.textColor=R}else{const E=a.parse(r[y],y,Rn);if(!E)return null;const C=E.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:E,scale:null,font:null,textColor:null})}}return new qa(d)}evaluate(r){return new fs(this.sections.map(a=>{const u=a.content.evaluate(r);return ep(yo(u),yd)?new tp("",u,null,null,null):new tp(sa(u),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),r.push(u)}return r}}class Lr{constructor(r,a,u,d){this._imageWarnHistory={},this.type=yd,this.namePrimary=r,this.nameSecondary=a,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(r,a){if(r.length<2)return a.error("Expected two or more arguments.");let u=1;const d=[];function g(){if(u<r.length){const x=a.parse(r[u],u++,cn);return x?(d.push({image:x,options:{}}),!0):(a.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<r.length){const E=r[u];if((x=E)===null||typeof x!="object"||Array.isArray(x))return!0;const C=E.params,R=E.iconset,D=a.concat(u);if(!C&&!R)return u++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const j={},V=D.concat(void 0,"params");for(const $ in C){if(!$)return V.error("Image parameter name should be non-empty"),!1;const Z=V.concat(void 0,$).parse(C[$],void 0,Es,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;j[$]=Z}d[d.length-1].options.params=j}if(R){if(typeof R!="object"||R.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!R.id)return D.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=R}return u++,!0}var x;return!0}for(let x=0;x<2;x++)if(!g()||!y())return;return new Lr(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(r,a){const u={};if(a){for(const d in a)if(a[d])try{u[d]=a[d].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const a={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,d=ps.build(a,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(d&&r.availableImages){const g=d.getPrimary().id;if(d.available=r.availableImages.some(y=>es.isEqual(y,g)),d.available){const y=d.getSecondary()?d.getSecondary().id:null;y&&(d.available=r.availableImages.some(x=>es.isEqual(x,y)))}}return d}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&r(this.paramsPrimary[a]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&r(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(r,a){const u={};if(a&&(u.iconset={id:a}),r){u.params={};for(const d in r)r[d]&&(u.params[d]=r[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&r.push(a)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&r.push(a)}return r}}function ir(l){return Tr(l)?"string":eh(l)?"number":np(l)?"boolean":Array.isArray(l)?"array":l===null?"null":rp(l)?"object":typeof l}function rp(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function Tr(l){return typeof l=="string"||l instanceof String}function eh(l){return typeof l=="number"||l instanceof Number}function np(l){return typeof l=="boolean"||l instanceof Boolean}const br={"to-boolean":Fn,"to-color":Es,"to-number":ar,"to-string":cn};class Za{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[0],d=[];let g=Aa;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const y=r[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);g=Uo(a.expectedType.itemType,y)}else{if(!(y>0&&Qu(r[1][0])))return null;g=Uo(yo(r[1][0]),y)}for(let x=0;x<y;x++){const E=r[1][x];let C;if(Array.isArray(E))C=a.parse(E,void 0,g.itemType);else{const R=ir(E);if(R!==g.itemType.kind)return a.error(`Expected ${g.itemType.kind} but found ${R}.`);C=a.registry.literal.parse(["literal",E===void 0?null:E],a)}if(!C)return null;d.push(C)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return a.error("Expected one argument.");g=br[u];for(let y=1;y<r.length;y++){const x=a.parse(r[y],y,Rn);if(!x)return null;d.push(x)}}return new Za(g,d)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let a,u;for(const d of this.args){if(a=d.evaluate(r),u=null,a instanceof Dn)return a;if(typeof a=="string"){const g=r.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:au(a[0],a[1],a[2],a[3]),!u))return new Dn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new lo(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(r),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new lo(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?fs.fromString(sa(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?ps.build(sa(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(a=>a.evaluate(r)):sa(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new qa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lr(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const gy=["Unknown","Point","LineString","Polygon"];class ip{constructor(r,a,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=a,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?gy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-r[0])+this.featureDistanceData.bearing[1]*(d*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=Dn.parse(r)),a}getConfig(r){return this.options?this.options.get(r):null}}class ms{constructor(r,a,u,d,g){this.name=r,this.type=a,this._evaluate=u,this.args=d,this._overloadIndex=g}evaluate(r){if(!this._evaluate){const a=ms.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const u=r[0],d=ms.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=[];let E=null,C=-1;for(const[R,D]of y){if(Array.isArray(R)&&R.length!==r.length-1)continue;x.push(R),C++,E=new gp(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const j=[];let V=!1;for(let $=1;$<r.length;$++){const Z=r[$],re=Array.isArray(R)?R[$-1]:R.type,te=E.parse(Z,1+j.length,re);if(!te){V=!0;break}j.push(te)}if(!V)if(Array.isArray(R)&&R.length!==j.length)E.error(`Expected ${R.length} arguments, but found ${j.length} instead.`);else{for(let $=0;$<j.length;$++){const Z=Array.isArray(R)?R[$]:R.type,re=j[$];E.concat($+1).checkSubtype(Z,re.type)}if(E.errors.length===0)return new ms(u,g,D,j,C)}}if(x.length===1)a.errors.push(...E.errors);else{const R=(x.length?x:y.map(([j])=>j)).map(op).join(" | "),D=[];for(let j=1;j<r.length;j++){const V=a.parse(r[j],1+D.length);if(!V)return null;D.push(qi(V.type))}a.error(`Expected arguments of type ${R}, but found (${D.join(", ")}) instead.`)}return null}static register(r,a){ms.definitions=a;for(const u in a)r[u]=ms}}function op(l){return Array.isArray(l)?`(${l.map(qi).join(", ")})`:`(${qi(l.type)}...)`}class So{constructor(r,a,u){this.type=Qf,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?a.parse(!1,1,Fn):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Fn);if(!d)return null;const g=u["diacritic-sensitive"]===void 0?a.parse(!1,1,Fn):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Fn);if(!g)return null;let y=null;return u.locale&&(y=a.parseObjectValue(u.locale,1,"locale",cn),!y)?null:new So(d,g,y)}evaluate(r){return new py(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function sp(l,r,a=0,u=l.length-1,d=yy){for(;u>a;){if(u-a>600){const E=u-a+1,C=r-a+1,R=Math.log(E),D=.5*Math.exp(2*R/3),j=.5*Math.sqrt(R*D*(E-D)/E)*(C-E/2<0?-1:1);sp(l,r,Math.max(a,Math.floor(r-C*D/E+j)),Math.min(u,Math.floor(r+(E-C)*D/E+j)),d)}const g=l[r];let y=a,x=u;for(Ca(l,a,r),d(l[u],g)>0&&Ca(l,a,u);y<x;){for(Ca(l,y,x),y++,x--;d(l[y],g)<0;)y++;for(;d(l[x],g)>0;)x--}d(l[a],g)===0?Ca(l,a,x):(x++,Ca(l,x,u)),x<=r&&(a=x+1),r<=x&&(u=x-1)}}function Ca(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}function yy(l,r){return l<r?-1:l>r?1:0}function _c(l){let r=0;for(let a,u,d=0,g=l.length,y=g-1;d<g;y=d++)a=l[d],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}function aa(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function vd(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function qS(l,r,a){const u=l[0]-r[0],d=l[1]-r[1],g=l[0]-a[0],y=l[1]-a[1];return u*y-g*d==0&&u*g<=0&&d*y<=0}function th(l,r,a=!1){let u=!1;for(let x=0,E=r.length;x<E;x++){const C=r[x];for(let R=0,D=C.length,j=D-1;R<D;j=R++){const V=C[j],$=C[R];if(qS(l,V,$))return a;(g=V)[1]>(d=l)[1]!=(y=$)[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var d,g,y;return u}function xd(l,r,a,u){const d=u[0]-a[0],g=u[1]-a[1],y=(l[0]-a[0])*g-d*(l[1]-a[1]),x=(r[0]-a[0])*g-d*(r[1]-a[1]);return y>0&&x<0||y<0&&x>0}function bd(l,r,a,u){return(d=[u[0]-a[0],u[1]-a[1]])[0]*(g=[r[0]-l[0],r[1]-l[1]])[1]-d[1]*g[0]!=0&&!(!xd(l,r,a,u)||!xd(a,u,l,r));var d,g}function El(l){const r=new mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of l[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:r,max:a}}const vc=8192;function ZS(l,r){const a=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,d=Math.pow(2,r.z);return[Math.round(a*d*vc),Math.round(u*d*vc)]}function _y(l,r){for(let a=0;a<r.length;a++)if(th(l,r[a]))return!0;return!1}function XS(l,r,a){for(const u of a)for(let d=0,g=u.length,y=g-1;d<g;y=d++)if(bd(l,r,u[y],u[d]))return!0;return!1}function hx(l,r){for(let a=0;a<l.length;++a)if(!th(l[a],r))return!1;for(let a=0;a<l.length-1;++a)if(XS(l[a],l[a+1],r))return!1;return!0}function dx(l,r){for(let a=0;a<r.length;a++)if(hx(l,r[a]))return!0;return!1}function vy(l,r,a){const u=[];for(let d=0;d<l.length;d++){const g=[];for(let y=0;y<l[d].length;y++){const x=ZS(l[d][y],a);aa(r,x),g.push(x)}u.push(g)}return u}function xc(l,r,a){const u=[];for(let d=0;d<l.length;d++){const g=vy(l[d],r,a);u.push(g)}return u}function fx(l,r,a,u){if(l[0]<a[0]||l[0]>a[2]){const d=.5*u;let g=l[0]-a[0]>d?-u:a[0]-l[0]>d?u:0;g===0&&(g=l[0]-a[2]>d?-u:a[2]-l[0]>d?u:0),l[0]+=g}aa(r,l)}function px(l,r,a,u){const d=Math.pow(2,u.z)*vc,g=[u.x*vc,u.y*vc],y=[];if(!l)return y;for(const x of l)for(const E of x){const C=[E.x+g[0],E.y+g[1]];fx(C,r,a,d),y.push(C)}return y}function ap(l,r,a,u){const d=Math.pow(2,u.z)*vc,g=[u.x*vc,u.y*vc],y=[];if(!l)return y;for(const E of l){const C=[];for(const R of E){const D=[R.x+g[0],R.y+g[1]];aa(r,D),C.push(D)}y.push(C)}if(r[2]-r[0]<=d/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const C of E)fx(C,r,a,d)}var x;return y}class bc{constructor(r,a){this.type=Fn,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Qu(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new bc(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new bc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new bc(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const x=vy(u.coordinates,g,y),E=px(a.geometry(),d,g,y);if(!vd(d,g))return!1;for(const C of E)if(!th(C,x))return!1}if(u.type==="MultiPolygon"){const x=xc(u.coordinates,g,y),E=px(a.geometry(),d,g,y);if(!vd(d,g))return!1;for(const C of E)if(!_y(C,x))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const x=vy(u.coordinates,g,y),E=ap(a.geometry(),d,g,y);if(!vd(d,g))return!1;for(const C of E)if(!hx(C,x))return!1}if(u.type==="MultiPolygon"){const x=xc(u.coordinates,g,y),E=ap(a.geometry(),d,g,y);if(!vd(d,g))return!1;for(const C of E)if(!dx(C,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const wd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},la=1/298.257223563,mx=la*(2-la),rh=Math.PI/180;class nh{static fromTile(r,a,u){const d=Math.PI*(1-2*(r+.5)/Math.pow(2,a)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/rh;return new nh(g,u)}static get units(){return wd}constructor(r,a){if(r===void 0)throw new Error("No latitude given.");if(a&&!wd[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(wd).join(", ")}`);const u=6378.137*rh*(a?wd[a]:1),d=Math.cos(r*rh),g=1/(1-mx*(1-d*d)),y=Math.sqrt(g);this.kx=u*y*d,this.ky=u*y*g*(1-mx)}distance(r,a){const u=Ws(r[0]-a[0])*this.kx,d=(r[1]-a[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(r,a){const u=Ws(a[0]-r[0])*this.kx;return Math.atan2(u,(a[1]-r[1])*this.ky)/rh}destination(r,a,u){const d=u*rh;return this.offset(r,Math.sin(d)*a,Math.cos(d)*a)}offset(r,a,u){return[r[0]+a/this.kx,r[1]+u/this.ky]}lineDistance(r){let a=0;for(let u=0;u<r.length-1;u++)a+=this.distance(r[u],r[u+1]);return a}area(r){let a=0;for(let u=0;u<r.length;u++){const d=r[u];for(let g=0,y=d.length,x=y-1;g<y;x=g++)a+=Ws(d[g][0]-d[x][0])*(d[g][1]+d[x][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(r,a){let u=0;if(a<=0)return r[0];for(let d=0;d<r.length-1;d++){const g=r[d],y=r[d+1],x=this.distance(g,y);if(u+=x,u>a)return lp(g,y,(a-(u-x))/x)}return r[r.length-1]}pointToSegmentDistance(r,a,u){let[d,g]=a,y=Ws(u[0]-d)*this.kx,x=(u[1]-g)*this.ky;if(y!==0||x!==0){const E=(Ws(r[0]-d)*this.kx*y+(r[1]-g)*this.ky*x)/(y*y+x*x);E>1?(d=u[0],g=u[1]):E>0&&(d+=y/this.kx*E,g+=x/this.ky*E)}return y=Ws(r[0]-d)*this.kx,x=(r[1]-g)*this.ky,Math.sqrt(y*y+x*x)}pointOnLine(r,a){let u=1/0,d=r[0][0],g=r[0][1],y=0,x=0;for(let E=0;E<r.length-1;E++){let C=r[E][0],R=r[E][1],D=Ws(r[E+1][0]-C)*this.kx,j=(r[E+1][1]-R)*this.ky,V=0;D===0&&j===0||(V=(Ws(a[0]-C)*this.kx*D+(a[1]-R)*this.ky*j)/(D*D+j*j),V>1?(C=r[E+1][0],R=r[E+1][1]):V>0&&(C+=D/this.kx*V,R+=j/this.ky*V)),D=Ws(a[0]-C)*this.kx,j=(a[1]-R)*this.ky;const $=D*D+j*j;$<u&&(u=$,d=C,g=R,y=E,x=V)}return{point:[d,g],index:y,t:Math.max(0,Math.min(1,x))}}lineSlice(r,a,u){let d=this.pointOnLine(u,r),g=this.pointOnLine(u,a);if(d.index>g.index||d.index===g.index&&d.t>g.t){const C=d;d=g,g=C}const y=[d.point],x=d.index+1,E=g.index;!xy(u[x],y[0])&&x<=E&&y.push(u[x]);for(let C=x+1;C<=E;C++)y.push(u[C]);return xy(u[E],g.point)||y.push(g.point),y}lineSliceAlong(r,a,u){let d=0;const g=[];for(let y=0;y<u.length-1;y++){const x=u[y],E=u[y+1],C=this.distance(x,E);if(d+=C,d>r&&g.length===0&&g.push(lp(x,E,(r-(d-C))/C)),d>=a)return g.push(lp(x,E,(a-(d-C))/C)),g;d>r&&g.push(E)}return g}bufferPoint(r,a){const u=a/this.ky,d=a/this.kx;return[r[0]-d,r[1]-u,r[0]+d,r[1]+u]}bufferBBox(r,a){const u=a/this.ky,d=a/this.kx;return[r[0]-d,r[1]-u,r[2]+d,r[3]+u]}insideBBox(r,a){return Ws(r[0]-a[0])>=0&&Ws(r[0]-a[2])<=0&&r[1]>=a[1]&&r[1]<=a[3]}}function xy(l,r){return l[0]===r[0]&&l[1]===r[1]}function lp(l,r,a){const u=Ws(r[0]-l[0]);return[l[0]+u*a,l[1]+(r[1]-l[1])*a]}function Ws(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class cp{constructor(r=[],a=(u,d)=>u<d?-1:u>d?1:0){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:u}=this,d=a[r];for(;r>0;){const g=r-1>>1,y=a[g];if(u(d,y)>=0)break;a[r]=y,r=g}a[r]=d}_down(r){const{data:a,compare:u}=this,d=this.length>>1,g=a[r];for(;r<d;){let y=1+(r<<1);const x=y+1;if(x<this.length&&u(a[x],a[y])<0&&(y=x),u(a[y],g)>=0)break;a[r]=a[y],r=y}a[r]=g}}var Mt=8192;function by(l,r){return r.dist-l.dist}const up=100,hp=50;function wy(l){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==l.length)return!1;for(let a=0;a<r.length;a++)if(r[a]!==l[a])return!1;return!0}function Td(l){return l[1]-l[0]+1}function Xa(l,r){const a=l[1]>=l[0]&&l[1]<r;return a||console.warn("Distance Expression: Index is out of range"),a}function Ty(l,r){if(l[0]>l[1])return[null,null];const a=Td(l);if(r){if(a===2)return[l,null];const u=Math.floor(a/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(a===1)return[l,null];const u=Math.floor(a/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function lu(l,r){const a=[1/0,1/0,-1/0,-1/0];if(!Xa(r,l.length))return a;for(let u=r[0];u<=r[1];++u)aa(a,l[u]);return a}function cu(l){const r=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let u=0;u<l[a].length;++u)aa(r,l[a][u]);return r}function wc(l,r,a){if(wy(l)||wy(r))return NaN;let u=0,d=0;return l[2]<r[0]&&(u=r[0]-l[2]),l[0]>r[2]&&(u=l[0]-r[2]),l[1]>r[3]&&(d=l[1]-r[3]),l[3]<r[1]&&(d=r[1]-l[3]),a.distance([0,0],[u,d])}function dp(l){return 360*l-180}function gx(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function fp(l,r){const a=Math.pow(2,r.z),u=(l.y/Mt+r.y)/a;return[dp((l.x/Mt+r.x)/a),gx(u)]}function KS(l,r){const a=[];for(let u=0;u<l.length;++u)a.push(fp(l[u],r));return a}function yx(l,r,a){const u=a.pointOnLine(r,l).point;return a.distance(l,u)}function Sy(l,r,a,u,d){const g=a.slice(u[0],u[1]+1);let y=1/0;for(let x=r[0];x<=r[1];++x)if((y=Math.min(y,yx(l[x],g,d)))===0)return 0;return y}function Tc(l,r,a,u,d){const g=Math.min(d.pointToSegmentDistance(l,a,u),d.pointToSegmentDistance(r,a,u)),y=Math.min(d.pointToSegmentDistance(a,l,r),d.pointToSegmentDistance(u,l,r));return Math.min(g,y)}function dn(l,r,a,u,d){if(!Xa(r,l.length)||!Xa(u,a.length))return NaN;let g=1/0;for(let y=r[0];y<r[1];++y)for(let x=u[0];x<u[1];++x){if(bd(l[y],l[y+1],a[x],a[x+1]))return 0;g=Math.min(g,Tc(l[y],l[y+1],a[x],a[x+1],d))}return g}function YS(l,r,a,u,d){if(!Xa(r,l.length)||!Xa(u,a.length))return NaN;let g=1/0;for(let y=r[0];y<=r[1];++y)for(let x=u[0];x<=u[1];++x)if((g=Math.min(g,d.distance(l[y],a[x])))===0)return g;return g}function JS(l,r,a){if(th(l,r,!0))return 0;let u=1/0;for(const d of r){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(u=Math.min(u,a.pointToSegmentDistance(l,d[g-1],d[0])))===0||(u=Math.min(u,yx(l,d,a)))===0)return u}return u}function QS(l,r,a,u){if(!Xa(r,l.length))return NaN;for(let g=r[0];g<=r[1];++g)if(th(l[g],a,!0))return 0;let d=1/0;for(let g=r[0];g<r[1];++g)for(const y of a)for(let x=0,E=y.length,C=E-1;x<E;C=x++){if(bd(l[g],l[g+1],y[C],y[x]))return 0;d=Math.min(d,Tc(l[g],l[g+1],y[C],y[x],u))}return d}function Ey(l,r){for(const a of l)for(let u=0;u<=a.length-1;++u)if(th(a[u],r,!0))return!0;return!1}function e2(l,r,a,u=1/0){const d=cu(l),g=cu(r);if(u!==1/0&&wc(d,g,a)>=u)return u;if(vd(d,g)){if(Ey(l,r))return 0}else if(Ey(r,l))return 0;let y=u;for(const x of l)for(let E=0,C=x.length,R=C-1;E<C;R=E++)for(const D of r)for(let j=0,V=D.length,$=V-1;j<V;$=j++){if(bd(x[R],x[E],D[$],D[j]))return 0;y=Math.min(y,Tc(x[R],x[E],D[$],D[j],a))}return y}function fi(l,r,a,u,d,g,y){if(g===null||y===null)return;const x=wc(lu(u,g),lu(d,y),a);x<r&&l.push({dist:x,range1:g,range2:y})}function t2(l,r,a,u,d=1/0){let g=Math.min(u.distance(l[0],a[0][0]),d);if(g===0)return g;const y=new cp([{dist:0,range1:[0,l.length-1],range2:[0,0]}],by),x=r?hp:up,E=cu(a);for(;y.length;){const C=y.pop();if(C.dist>=g)continue;const R=C.range1;if(Td(R)<=x){if(!Xa(R,l.length))return NaN;if(r){const D=QS(l,R,a,u);if((g=Math.min(g,D))===0)return g}else for(let D=R[0];D<=R[1];++D){const j=JS(l[D],a,u);if((g=Math.min(g,j))===0)return g}}else{const D=Ty(R,r);if(D[0]!==null){const j=wc(lu(l,D[0]),E,u);j<g&&y.push({dist:j,range1:D[0],range2:[0,0]})}if(D[1]!==null){const j=wc(lu(l,D[1]),E,u);j<g&&y.push({dist:j,range1:D[1],range2:[0,0]})}}}return g}function _x(l,r,a,u,d,g=1/0){let y=Math.min(g,d.distance(l[0],a[0]));if(y===0)return y;const x=new cp([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],by),E=r?hp:up,C=u?hp:up;for(;x.length;){const R=x.pop();if(R.dist>=y)continue;const D=R.range1,j=R.range2;if(Td(D)<=E&&Td(j)<=C){if(!Xa(D,l.length)||!Xa(j,a.length))return NaN;if(r&&u?y=Math.min(y,dn(l,D,a,j,d)):r||u?r&&!u?y=Math.min(y,Sy(a,j,l,D,d)):!r&&u&&(y=Math.min(y,Sy(l,D,a,j,d))):y=Math.min(y,YS(l,D,a,j,d)),y===0)return y}else{const V=Ty(D,r),$=Ty(j,u);fi(x,y,d,l,a,V[0],$[0]),fi(x,y,d,l,a,V[0],$[1]),fi(x,y,d,l,a,V[1],$[0]),fi(x,y,d,l,a,V[1],$[1])}}return y}function Ay(l,r,a,u,d=1/0){let g=d;const y=lu(l,[0,l.length-1]);for(const x of a)if(!(g!==1/0&&wc(y,lu(x,[0,x.length-1]),u)>=g)&&(g=Math.min(g,_x(l,r,x,!0,u,g)),g===0))return g;return g}function pp(l,r,a,u,d=1/0){let g=d;const y=lu(l,[0,l.length-1]);for(const x of a){if(g!==1/0&&wc(y,cu(x),u)>=g)continue;const E=t2(l,r,x,u,g);if(isNaN(E))return E;if((g=Math.min(g,E))===0)return g}return g}function Py(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class uu{constructor(r,a){this.type=ar,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(Qu(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(Py(u.features[d].geometry.type))return new uu(u,u.features[d].geometry)}else if(u.type==="Feature"){if(Py(u.geometry.type))return new uu(u,u.geometry)}else if(Py(u.type))return new uu(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const a=r.geometry(),u=r.canonicalID();if(a!=null&&u!=null){if(r.geometryType()==="Point")return function(d,g,y){const x=[];for(const C of d)for(const R of C)x.push(fp(R,g));const E=new nh(x[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?_x(x,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",E):y.type==="MultiLineString"?Ay(x,!1,y.coordinates,E):y.type==="Polygon"||y.type==="MultiPolygon"?pp(x,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,E):null}(a,u,this.geometries);if(r.geometryType()==="LineString")return function(d,g,y){const x=[];for(const C of d){const R=[];for(const D of C)R.push(fp(D,g));x.push(R)}const E=new nh(x[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Ay(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",x,E);if(y.type==="MultiLineString"){let C=1/0;for(let R=0;R<y.coordinates.length;R++){const D=Ay(y.coordinates[R],!0,x,E,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}if(y.type==="Polygon"||y.type==="MultiPolygon"){let C=1/0;for(let R=0;R<x.length;R++){const D=pp(x[R],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,E,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}return null}(a,u,this.geometries);if(r.geometryType()==="Polygon")return function(d,g,y){const x=[];for(const C of function(R,D){const j=R.length;if(j<=1)return[R];const V=[];let $,Z;for(let re=0;re<j;re++){const te=_c(R[re]);te!==0&&(R[re].area=Math.abs(te),Z===void 0&&(Z=te<0),Z===te<0?($&&V.push($),$=[R[re]]):$.push(R[re]))}return $&&V.push($),V}(d)){const R=[];for(let D=0;D<C.length;++D)R.push(KS(C[D],g));x.push(R)}const E=new nh(x[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return pp(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",x,E);if(y.type==="MultiLineString"){let C=1/0;for(let R=0;R<y.coordinates.length;R++){const D=pp(y.coordinates[R],!0,x,E,C);if(isNaN(D))return D;if((C=Math.min(C,D))===0)return C}return C}return y.type==="Polygon"||y.type==="MultiPolygon"?function(C,R,D){let j=1/0;for(const V of C)for(const $ of R){const Z=e2(V,$,D,j);if(isNaN(Z))return Z;if((j=Math.min(j,Z))===0)return j}return j}(y.type==="Polygon"?[y.coordinates]:y.coordinates,x,E):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ih(l){if(l instanceof ms&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof bc||l instanceof uu)return!1;if(l instanceof sh)return l.featureConstant;let r=!0;return l.eachChild(a=>{r&&!ih(a)&&(r=!1)}),r}function Sd(l){if(l instanceof ms&&l.name==="feature-state")return!1;let r=!0;return l.eachChild(a=>{r&&!Sd(a)&&(r=!1)}),r}function oh(l,r){if(l instanceof ms&&r.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(u=>{a&&!oh(u,r)&&(a=!1)}),a}function vx(l,r,a){return[l,r,a].filter(Boolean).join("")}function Cy(l,r){switch(l){case"string":return sa(r);case"number":return+r;case"boolean":return!!r;case"color":return Dn.parse(r);case"formatted":return fs.fromString(sa(r));case"resolvedImage":return ps.build(sa(r))}return r}function xx(l,r,a,u){return u!==void 0&&(l=u*Math.round(l/u)),r!==void 0&&l<r&&(l=r),a!==void 0&&l>a&&(l=a),l}class sh{constructor(r,a,u,d=!1){this.type=r,this.key=a,this.scope=u,this.featureConstant=d}static parse(r,a){let u=a.expectedType;if(u==null&&(u=Rn),r.length<2||r.length>3)return a.error("Invalid number of arguments for 'config' expression.");const d=a.parse(r[1],1);if(!(d instanceof Sl))return a.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const x=sa(d.value);if(r.length>=3){const E=a.parse(r[2],2);if(!(E instanceof Sl))return a.error("Scope of 'config' expression must be a string literal.");g=sa(E.value)}if(a.options){const E=vx(x,g,a._scope),C=a.options.get(E);C&&(y=ih(C.value||C.default))}return new sh(u,x,g,y)}evaluate(r){const a=vx(this.key,this.scope,r.scope),u=r.getConfig(a);if(!u)return null;const{type:d,value:g,values:y,minValue:x,maxValue:E,stepValue:C}=u,R=u.default.evaluate(r);let D=R;if(g){const j=r.scope;r.scope=(j||"").split("").slice(1).join(""),D=g.evaluate(r),r.scope=j}return d&&(D=Cy(d,D)),D===void 0||x===void 0&&E===void 0&&C===void 0||(typeof D=="number"?D=xx(D,x,E,C):Array.isArray(D)&&(D=D.map(j=>typeof j=="number"?xx(j,x,E,C):j))),g!==void 0&&D!==void 0&&y&&!y.includes(D)&&(D=R,d&&(D=Cy(d,D))),(d&&d!==this.type||D!==void 0&&!ep(yo(D),this.type))&&(D=Cy(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class mp{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=r[1];return a.scope.has(u)?new mp(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class gp{constructor(r,a=[],u,d=new Ju,g=[],y,x,E){this.registry=r,this.path=a,this.key=a.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u,this._scope=y,this.options=x,this.iconImageUseTheme=E}parse(r,a,u,d,g={}){return a||u?this.concat(a,null,u,d)._parse(r,g):this._parse(r,g)}parseObjectValue(r,a,u,d,g,y={}){return this.concat(a,u,d,g)._parse(r,y)}_parse(r,a){function u(d,g,y){return y==="assert"?new Pa(g,[d]):y==="coerce"?new Za(g,[d]):d}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(d){let g=d.parse(r,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else g=u(g,y,a.typeAnnotation||"coerce");else g=u(g,y,a.typeAnnotation||"assert")}if(!(g instanceof Sl)&&g.type.kind!=="resolvedImage"&&Iy(g)){const y=new ip(this._scope,this.options,this.iconImageUseTheme);try{g=new Sl(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return Za.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,u,d){let g=typeof r=="number"?this.path.concat(r):this.path;g=typeof a=="string"?g.concat(a):g;const y=d?this.scope.concat(d):this.scope;return new gp(this.registry,g,u||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...a){const u=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new oa(u,r))}checkSubtype(r,a){const u=yc(r,a);return u&&this.error(u),u}}function Iy(l){if(l instanceof mp)return Iy(l.boundExpression);if(l instanceof ms&&l.name==="error"||l instanceof So||l instanceof bc||l instanceof uu||l instanceof sh)return!1;const r=l instanceof Za||l instanceof Pa;let a=!0;return l.eachChild(u=>{a=r?a&&Iy(u):a&&u instanceof Sl}),!!a&&ih(l)&&oh(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function yp(l,r){const a=l.length-1;let u,d,g=0,y=a,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),u=l[x],d=l[x+1],u<=r){if(x===a||r<d)return x;g=x+1}else{if(!(u>r))throw new lo("Input is not a number.");y=x-1}return 0}class Ed{constructor(r,a,u){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(r[1],1,ar);if(!u)return null;const d=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<r.length;y+=2){const x=y===1?-1/0:r[y],E=r[y+1],C=y,R=y+1;if(typeof x!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(d.length&&d[d.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const D=a.parse(E,R,g);if(!D)return null;g=g||D.type,d.push([x,D])}return new Ed(g,u,d)}evaluate(r){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(r);const d=this.input.evaluate(r);if(d<=a[0])return u[0].evaluate(r);const g=a.length;return d>=a[g-1]?u[g-1].evaluate(r):u[yp(a,d)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}const bx=.95047,wx=1.08883,Tx=4/29,ah=6/29,Sx=3*ah*ah,r2=ah*ah*ah,n2=Math.PI/180,i2=180/Math.PI;function My(l){return l>r2?Math.pow(l,1/3):l/Sx+Tx}function Oy(l){return l>ah?l*l*l:Sx*(l-Tx)}function Ry(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Dy(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Ex(l){const r=Dy(l.r),a=Dy(l.g),u=Dy(l.b),d=My((.4124564*r+.3575761*a+.1804375*u)/bx),g=My((.2126729*r+.7151522*a+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-My((.0193339*r+.119192*a+.9503041*u)/wx)),alpha:l.a}}function _p(l){let r=(l.l+16)/116,a=isNaN(l.a)?r:r+l.a/500,u=isNaN(l.b)?r:r-l.b/200;return r=1*Oy(r),a=bx*Oy(a),u=wx*Oy(u),new Dn(Ry(3.2404542*a-1.5371385*r-.4985314*u),Ry(-.969266*a+1.8760108*r+.041556*u),Ry(.0556434*a-.2040259*r+1.0572252*u),l.alpha)}function vp(l,r,a){const u=r-l;return l+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const lh={forward:Ex,reverse:_p,interpolate:function(l,r,a){return{l:vr(l.l,r.l,a),a:vr(l.a,r.a,a),b:vr(l.b,r.b,a),alpha:vr(l.alpha,r.alpha,a)}}},Ad={forward:function(l){const{l:r,a,b:u}=Ex(l),d=Math.atan2(u,a)*i2;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:r,alpha:l.a}},reverse:function(l){const r=l.h*n2,a=l.c;return _p({l:l.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:l.alpha})},interpolate:function(l,r,a){return{h:vp(l.h,r.h,a),c:vr(l.c,r.c,a),l:vr(l.l,r.l,a),alpha:vr(l.alpha,r.alpha,a)}}};var Ax=Object.freeze({__proto__:null,hcl:Ad,lab:lh});class qs{constructor(r,a,u,d,g){this.type=r,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,a,u,d){let g=0;if(r.name==="exponential")g=xp(a,r.base,u,d);else if(r.name==="linear")g=xp(a,1,u,d);else if(r.name==="cubic-bezier"){const y=r.controlPoints;g=new jo(y[0],y[1],y[2],y[3]).solve(xp(a,1,u,d))}return g}static parse(r,a){let[u,d,g,...y]=r;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const C=d[1];if(typeof C!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:C}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const C=d.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:C}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,ar),!g)return null;const x=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=Es:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let C=0;C<y.length;C+=2){const R=y[C],D=y[C+1],j=C+3,V=C+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(x.length&&x[x.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const $=a.parse(D,V,E);if(!$)return null;E=E||$.type,x.push([R,$])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new qs(E,u,d,g,x):a.error(`Type ${qi(E)} is not interpolatable.`)}evaluate(r){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(r);const d=this.input.evaluate(r);if(d<=a[0])return u[0].evaluate(r);const g=a.length;if(d>=a[g-1])return u[g-1].evaluate(r);const y=yp(a,d),x=qs.interpolationFactor(this.interpolation,d,a[y],a[y+1]),E=u[y].evaluate(r),C=u[y+1].evaluate(r);return this.operator==="interpolate"?md[this.type.kind.toLowerCase()](E,C,x):this.operator==="interpolate-hcl"?Ad.reverse(Ad.interpolate(Ad.forward(E),Ad.forward(C),x)):lh.reverse(lh.interpolate(lh.forward(E),lh.forward(C),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function xp(l,r,a,u){const d=u-a,g=l-a;return d===0?0:r===1?g/d:(Math.pow(r,g)-1)/(Math.pow(r,d)-1)}class Pd{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const x of r.slice(1)){const E=a.parse(x,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,g.push(E)}const y=d&&g.some(x=>yc(d,x.type));return new Pd(y?Rn:u,g)}evaluate(r){let a,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(r),u&&u instanceof ps&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class Al{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=a.parse(r[g+1],g+1);if(!x)return null;u.push([y,x])}const d=a.parse(r[r.length-1],r.length-1,a.expectedType,u);return d?new Al(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,u]of this.bindings)r.push(a,u.serialize());return r.push(this.result.serialize()),r}}class bp{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,ar),d=a.parse(r[2],2,Uo(a.expectedType||Rn));return u&&d?new bp(d.type.itemType,u,d):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new lo("Array index out of bounds: negative index");if(a>=u.length)throw new lo("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new lo("Array index must be an integer. Use at-interpolated for fractional indices");return u[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class wp{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,ar),d=a.parse(r[2],2,Uo(a.expectedType||Rn));return u&&d?new wp(d.type.itemType,u,d):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new lo(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new lo(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const d=Math.floor(a),g=Math.ceil(a),y=u[d],x=u[g];if(typeof y!="number"||typeof x!="number")throw new lo(`Cannot interpolate between non-number values at index ${a}.`);const E=a-d;return y*(1-E)+x*E}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ky{constructor(r,a){this.type=Fn,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),d=a.parse(r[2],2,Rn);return u&&d?fy(u.type,[Fn,cn,ar,Aa,Rn])?new ky(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(u.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!_d(a,["boolean","string","number","null"]))throw new lo(`Expected first argument to be of type boolean, string, number or null, but found ${qi(yo(a))} instead.`);if(!_d(u,["string","array"]))throw new lo(`Expected second argument to be of type array or string, but found ${qi(yo(u))} instead.`);return u.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ch{constructor(r,a,u){this.type=ar,this.needle=r,this.haystack=a,this.fromIndex=u}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),d=a.parse(r[2],2,Rn);if(!u||!d)return null;if(!fy(u.type,[Fn,cn,ar,Aa,Rn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(u.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,ar);return g?new ch(u,d,g):null}return new ch(u,d)}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!_d(a,["boolean","string","number","null"]))throw new lo(`Expected first argument to be of type boolean, string, number or null, but found ${qi(yo(a))} instead.`);if(!_d(u,["string","array"]))throw new lo(`Expected second argument to be of type array or string, but found ${qi(yo(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(r);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Cd{constructor(r,a,u,d,g,y){this.inputType=r,this.type=a,this.input=u,this.cases=d,this.outputs=g,this.otherwise=y}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const g={},y=[];for(let C=2;C<r.length-1;C+=2){let R=r[C];const D=r[C+1];Array.isArray(R)||(R=[R]);const j=a.concat(C);if(R.length===0)return j.error("Expected at least one branch label.");for(const $ of R){if(typeof $!="number"&&typeof $!="string")return j.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,yo($)))return null}else u=yo($);if(g[String($)]!==void 0)return j.error("Branch labels must be unique.");g[String($)]=y.length}const V=a.parse(D,C,d);if(!V)return null;d=d||V.type,y.push(V)}const x=a.parse(r[1],1,Rn);if(!x)return null;const E=a.parse(r[r.length-1],r.length-1,d);return E?x.type.kind!=="value"&&a.concat(1).checkSubtype(u,x.type)?null:new Cd(u,d,x,g,y,E):null}evaluate(r){const a=this.input.evaluate(r);return(ep(yo(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const y of a){const x=d[this.cases[y]];x===void 0?(d[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[x][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,x]of u)r.push(x.length===1?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class Id{constructor(r,a,u){this.type=r,this.branches=a,this.otherwise=u}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let y=1;y<r.length-1;y+=2){const x=a.parse(r[y],y,Fn);if(!x)return null;const E=a.parse(r[y+1],y+1,u);if(!E)return null;d.push([x,E]),u=u||E.type}const g=a.parse(r[r.length-1],r.length-1,u);return g?new Id(u,d,g):null}evaluate(r){for(const[a,u]of this.branches)if(a.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,u]of this.branches)r(a),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class Tp{constructor(r,a,u,d){this.type=r,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),d=a.parse(r[2],2,ar);if(!u||!d)return null;if(!fy(u.type,[Uo(Rn),cn,Rn]))return a.error(`Expected first argument to be of type array or string, but found ${qi(u.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,ar);return g?new Tp(u.type,u,d,g):null}return new Tp(u.type,u,d)}evaluate(r){const a=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!_d(a,["string","array"]))throw new lo(`Expected first argument to be of type array or string, but found ${qi(yo(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(r);return a.slice(u,d)}return a.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class jy{constructor(r,a){this.type=Uo(cn),this.str=r,this.delimiter=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,cn),d=a.parse(r[2],2,cn);return u&&d?new jy(u,d):void 0}evaluate(r){const a=this.str.evaluate(r),u=this.delimiter.evaluate(r);return a.split(u)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Ly(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Ny(l,r,a,u){return u.compare(r,a)===0}function uh(l,r,a){const u=l!=="=="&&l!=="!=";return class DH{constructor(g,y,x){this.type=Fn,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,Rn);if(!E)return null;if(!Ly(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${qi(E.type)}'.`);let C=y.parse(g[2],2,Rn);if(!C)return null;if(!Ly(x,C.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${qi(C.type)}'.`);if(E.type.kind!==C.type.kind&&E.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${qi(E.type)}' and '${qi(C.type)}'.`);u&&(E.type.kind==="value"&&C.type.kind!=="value"?E=new Pa(C.type,[E]):E.type.kind!=="value"&&C.type.kind==="value"&&(C=new Pa(E.type,[C])));let R=null;if(g.length===4){if(E.type.kind!=="string"&&C.type.kind!=="string"&&E.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(R=y.parse(g[3],3,Qf),!R)return null}return new DH(E,C,R)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const E=yo(y),C=yo(x);if(E.kind!==C.kind||E.kind!=="string"&&E.kind!=="number")throw new lo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${E.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=yo(y),C=yo(x);if(E.kind!=="string"||C.kind!=="string")return r(g,y,x)}return this.collator?a(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[l];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const o2=uh("==",function(l,r,a){return r===a},Ny),s2=uh("!=",function(l,r,a){return r!==a},function(l,r,a,u){return!Ny(0,r,a,u)}),Px=uh("<",function(l,r,a){return r<a},function(l,r,a,u){return u.compare(r,a)<0}),Cx=uh(">",function(l,r,a){return r>a},function(l,r,a,u){return u.compare(r,a)>0}),Sp=uh("<=",function(l,r,a){return r<=a},function(l,r,a,u){return u.compare(r,a)<=0}),a2=uh(">=",function(l,r,a){return r>=a},function(l,r,a,u){return u.compare(r,a)>=0});class Ep{constructor(r,a,u,d,g,y){this.type=cn,this.number=r,this.locale=a,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const u=a.parse(r[1],1,ar);if(!u)return null;const d=r[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=a.parseObjectValue(d.locale,2,"locale",cn),!g))return null;let y=null;if(d.currency&&(y=a.parseObjectValue(d.currency,2,"currency",cn),!y))return null;let x=null;if(d.unit&&(x=a.parseObjectValue(d.unit,2,"unit",cn),!x))return null;let E=null;if(d["min-fraction-digits"]&&(E=a.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",ar),!E))return null;let C=null;return d["max-fraction-digits"]&&(C=a.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",ar),!C)?null:new Ep(u,g,y,x,E,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class zy{constructor(r){this.type=ar,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=a.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${qi(u.type)} instead.`):new zy(u):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string"||Array.isArray(a))return a.length;throw new lo(`Expected value to be of type string or array, but found ${qi(yo(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}function Ix(l){return function(){l=1831565813+(l|=0)|0;let r=Math.imul(l^l>>>15,1|l);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const hh={"==":o2,"!=":s2,">":Cx,"<":Px,">=":a2,"<=":Sp,array:Pa,at:bp,"at-interpolated":wp,boolean:Pa,case:Id,coalesce:Pd,collator:So,format:qa,image:Lr,in:ky,"index-of":ch,interpolate:qs,"interpolate-hcl":qs,"interpolate-lab":qs,length:zy,let:Al,literal:Sl,match:Cd,number:Pa,"number-format":Ep,object:Pa,slice:Tp,step:Ed,string:Pa,"to-boolean":Za,"to-color":Za,"to-number":Za,"to-string":Za,var:mp,within:bc,distance:uu,config:sh,split:jy};function Fy(l,[r,a,u,d]){r=r.evaluate(l),a=a.evaluate(l),u=u.evaluate(l);const g=d?d.evaluate(l):1,y=au(r,a,u,g);if(y)throw new lo(y);return new Dn(r/255,a/255,u/255,g)}function By(l,[r,a,u,d]){r=r.evaluate(l),a=a.evaluate(l),u=u.evaluate(l);const g=d?d.evaluate(l):1,y=function(C,R,D,j){return typeof C=="number"&&C>=0&&C<=360?typeof R=="number"&&R>=0&&R<=100&&typeof D=="number"&&D>=0&&D<=100?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid hsla value [${[C,R,D,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof j=="number"?[C,R,D,j]:[C,R,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof j=="number"?[C,R,D,j]:[C,R,D]).join(", ")}]: 'h' must be between 0 and 360.`}(r,a,u,g);if(y)throw new lo(y);const x=`hsla(${r}, ${a}%, ${u}%, ${g})`,E=Dn.parse(x);if(!E)throw new lo(`Failed to parse HSLA color: ${x}`);return E}function Mx(l,r){return l in r}function Vy(l,r){const a=r[l];return a===void 0?null:a}function Sc(l){return{type:l}}function hu(l){if(l instanceof sh)return new Set([l.key]);let r=new Set;return l.eachChild(a=>{r=new Set([...r,...hu(a)])}),r}function Ap(l){if(l instanceof ms&&l.name==="is-active-floor")return!0;let r=!1;return l.eachChild(a=>{!r&&Ap(a)&&(r=!0)}),r}function Ox(l){return{result:"success",value:l}}function Ec(l){return{result:"error",value:l}}function $y(l,r){return!!l&&!!l.parameters&&l.parameters.indexOf(r)>-1}function Md(l){return l["property-type"]==="data-driven"}function Rx(l){return $y(l.expression,"measure-light")}function Dx(l){return $y(l.expression,"zoom")}function Pp(l){return!!l.expression&&l.expression.interpolated}function Cp(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function kx(l){return l}function jx(l,r){const a=r.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",d=u||!(u||l.property!==void 0),g=l.type||(Pp(r)?"exponential":"interval");if(a&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(C=>[C[0],Dn.parse(C[1])])),l.default=Dn.parse(l.default?l.default:r.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Ax[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,x,E;if(g==="exponential")y=Lx;else if(g==="interval")y=c2;else if(g==="categorical"){y=l2,x=Object.create(null);for(const C of l.stops)x[C[0]]=C[1];E=typeof l.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=Nx}if(u){const C={},R=[];for(let V=0;V<l.stops.length;V++){const $=l.stops[V],Z=$[0].zoom;C[Z]===void 0&&(C[Z]={zoom:Z,type:l.type,property:l.property,default:l.default,stops:[]},R.push(Z)),C[Z].stops.push([$[0].value,$[1]])}const D=[];for(const V of R)D.push([C[V].zoom,jx(C[V],r)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:qs.interpolationFactor.bind(void 0,j),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},$)=>Lx({stops:D,base:l.base},r,V).evaluate(V,$)}}if(d){const C=g==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:qs.interpolationFactor.bind(void 0,C),zoomStops:l.stops.map(R=>R[0]),evaluate:({zoom:R})=>y(l,r,R,x,E)}}return{kind:"source",evaluate(C,R){const D=R&&R.properties?R.properties[l.property]:void 0;return D===void 0?Ka(l.default,r.default):y(l,r,D,x,E)}}}function Ka(l,r,a){return l!==void 0?l:r!==void 0?r:a!==void 0?a:void 0}function l2(l,r,a,u,d){return Ka(typeof a===d?u[a]:void 0,l.default,r.default)}function c2(l,r,a){if(!eh(a))return Ka(l.default,r.default);const u=l.stops.length;if(u===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[u-1][0])return l.stops[u-1][1];const d=yp(l.stops.map(g=>g[0]),a);return l.stops[d][1]}function Lx(l,r,a){const u=l.base!==void 0?l.base:1;if(!eh(a))return Ka(l.default,r.default);const d=l.stops.length;if(d===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[d-1][0])return l.stops[d-1][1];const g=yp(l.stops.map(R=>R[0]),a),y=function(R,D,j,V){const $=V-j,Z=R-j;return $===0?0:D===1?Z/$:(Math.pow(D,Z)-1)/(Math.pow(D,$)-1)}(a,u,l.stops[g][0],l.stops[g+1][0]),x=l.stops[g][1],E=l.stops[g+1][1];let C=md[r.type]||kx;if(l.colorSpace&&l.colorSpace!=="rgb"){const R=Ax[l.colorSpace];C=(D,j)=>R.reverse(R.interpolate(R.forward(D),R.forward(j),y))}return typeof x.evaluate=="function"?{evaluate(...R){const D=x.evaluate.apply(void 0,R),j=E.evaluate.apply(void 0,R);if(D!==void 0&&j!==void 0)return C(D,j,y)}}:C(x,E,y)}function Nx(l,r,a){return r.type==="color"?a=Dn.parse(a):r.type==="formatted"?a=fs.fromString(a.toString()):r.type==="resolvedImage"?a=ps.build(a.toString()):ir(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),Ka(a,l.default,r.default)}ms.register(hh,{error:[{kind:"error"},[cn],(l,[r])=>{throw new lo(r.evaluate(l))}],typeof:[cn,[Rn],(l,[r])=>qi(yo(r.evaluate(l)))],"to-rgba":[Uo(ar,4),[Es],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Uo(ar,4),[Es],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Es,[ar,ar,ar],Fy],rgba:[Es,[ar,ar,ar,ar],Fy],hsl:[Es,[ar,ar,ar],By],hsla:[Es,[ar,ar,ar,ar],By],has:{type:Fn,overloads:[[[cn],(l,[r])=>Mx(r.evaluate(l),l.properties())],[[cn,Wa],(l,[r,a])=>Mx(r.evaluate(l),a.evaluate(l))]]},get:{type:Rn,overloads:[[[cn],(l,[r])=>Vy(r.evaluate(l),l.properties())],[[cn,Wa],(l,[r,a])=>Vy(r.evaluate(l),a.evaluate(l))]]},"feature-state":[Rn,[cn],(l,[r])=>Vy(r.evaluate(l),l.featureState||{})],properties:[Wa,[],l=>l.properties()],"geometry-type":[cn,[],l=>l.geometryType()],worldview:[cn,[],l=>l.globals.worldview||""],"is-active-floor":[Fn,Sc(cn),(l,r)=>{if(!(l.globals.activeFloors&&l.globals.activeFloors.size>0))return!1;const a=l.globals.activeFloors;return r.some(u=>{const d=u.evaluate(l);return a.has(d)})}],id:[Rn,[],l=>l.id()],zoom:[ar,[],l=>l.globals.zoom],pitch:[ar,[],l=>l.globals.pitch||0],"distance-from-center":[ar,[],l=>l.distanceFromCenter()],"measure-light":[ar,[cn],(l,[r])=>l.measureLight(r.evaluate(l))],"heatmap-density":[ar,[],l=>l.globals.heatmapDensity||0],"line-progress":[ar,[],l=>l.globals.lineProgress||0],"raster-value":[ar,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[ar,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[ar,[],l=>l.globals.skyRadialProgress||0],accumulated:[Rn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[ar,Sc(ar),(l,r)=>{let a=0;for(const u of r)a+=u.evaluate(l);return a}],"*":[ar,Sc(ar),(l,r)=>{let a=1;for(const u of r)a*=u.evaluate(l);return a}],"-":{type:ar,overloads:[[[ar,ar],(l,[r,a])=>r.evaluate(l)-a.evaluate(l)],[[ar],(l,[r])=>-r.evaluate(l)]]},"/":[ar,[ar,ar],(l,[r,a])=>r.evaluate(l)/a.evaluate(l)],"%":[ar,[ar,ar],(l,[r,a])=>r.evaluate(l)%a.evaluate(l)],ln2:[ar,[],()=>Math.LN2],pi:[ar,[],()=>Math.PI],e:[ar,[],()=>Math.E],"^":[ar,[ar,ar],(l,[r,a])=>Math.pow(r.evaluate(l),a.evaluate(l))],sqrt:[ar,[ar],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[ar,[ar],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[ar,[ar],(l,[r])=>Math.log(r.evaluate(l))],log2:[ar,[ar],(l,[r])=>Math.log2(r.evaluate(l))],sin:[ar,[ar],(l,[r])=>Math.sin(r.evaluate(l))],cos:[ar,[ar],(l,[r])=>Math.cos(r.evaluate(l))],tan:[ar,[ar],(l,[r])=>Math.tan(r.evaluate(l))],asin:[ar,[ar],(l,[r])=>Math.asin(r.evaluate(l))],acos:[ar,[ar],(l,[r])=>Math.acos(r.evaluate(l))],atan:[ar,[ar],(l,[r])=>Math.atan(r.evaluate(l))],min:[ar,Sc(ar),(l,r)=>Math.min(...r.map(a=>a.evaluate(l)))],max:[ar,Sc(ar),(l,r)=>Math.max(...r.map(a=>a.evaluate(l)))],abs:[ar,[ar],(l,[r])=>Math.abs(r.evaluate(l))],round:[ar,[ar],(l,[r])=>{const a=r.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[ar,[ar],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[ar,[ar],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[Fn,[cn,Rn],(l,[r,a])=>l.properties()[r.value]===a.value],"filter-id-==":[Fn,[Rn],(l,[r])=>l.id()===r.value],"filter-type-==":[Fn,[cn],(l,[r])=>l.geometryType()===r.value],"filter-<":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[Fn,[Rn],(l,[r])=>r.value in l.properties()],"filter-has-id":[Fn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Fn,[Uo(cn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[Fn,[Uo(Rn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[Fn,[cn,Uo(Rn)],(l,[r,a])=>a.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[Fn,[cn,Uo(Rn)],(l,[r,a])=>function(u,d,g,y){for(;g<=y;){const x=g+y>>1;if(d[x]===u)return!0;d[x]>u?y=x-1:g=x+1}return!1}(l.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Fn,overloads:[[[Fn,Fn],(l,[r,a])=>r.evaluate(l)&&a.evaluate(l)],[Sc(Fn),(l,r)=>{for(const a of r)if(!a.evaluate(l))return!1;return!0}]]},any:{type:Fn,overloads:[[[Fn,Fn],(l,[r,a])=>r.evaluate(l)||a.evaluate(l)],[Sc(Fn),(l,r)=>{for(const a of r)if(a.evaluate(l))return!0;return!1}]]},"!":[Fn,[Fn],(l,[r])=>!r.evaluate(l)],"is-supported-script":[Fn,[cn],(l,[r])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(r.evaluate(l))}],upcase:[cn,[cn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[cn,[cn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[cn,Sc(Rn),(l,r)=>r.map(a=>sa(a.evaluate(l))).join("")],"resolved-locale":[cn,[Qf],(l,[r])=>r.evaluate(l).resolvedLocale()],random:[ar,[ar,ar,Rn],(l,r)=>{const[a,u,d]=r.map(y=>y.evaluate(l));if(a>u||a===u)return a;let g;if(typeof d=="string")g=function(y){let x=0;if(y.length===0)return x;for(let E=0;E<y.length;E++)x=(x<<5)-x+y.charCodeAt(E),x|=0;return x}(d);else{if(typeof d!="number")throw new lo(`Invalid seed input: ${d}`);g=d}return a+Ix(g)()*(u-a)}]});class Ip{constructor(r,a,u,d,g){this.expression=r,this._warningHistory={},this._scope=u,this._options=d,this._iconImageUseTheme=g,this._evaluator=new ip(u,d,g),this._defaultValue=a?function(y){return y.type==="color"&&(Cp(y.default)||Array.isArray(y.default))?new Dn(0,0,0,0):y.type==="color"?Dn.parse(y.default)||null:y.default===void 0?null:y.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=hu(r),this.isIndoorDependent=Ap(r)}evaluateWithoutErrorHandling(r,a,u,d,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,u,d,g,y,x,E,C){this._evaluator||(this._evaluator=new ip(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=C||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new lo(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){const D=R;return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Od(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in hh}function Ac(l,r,a,u,d){const g=new gp(hh,[],r?function(x){const E={color:Es,string:cn,number:ar,enum:cn,boolean:Fn,formatted:gd,resolvedImage:yd};return x.type==="array"?Uo(E[x.value]||Rn,x.length):E[x.type]}(r):void 0,void 0,void 0,a,u,d),y=g.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Ox(new Ip(y,r,a,u,d)):Ec(g.errors)}class dh{constructor(r,a,u,d){this.kind=r,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=r!=="constant"&&!Sd(a.expression),this.configDependencies=hu(a.expression),this.isIndoorDependent=Ap(a.expression)}evaluateWithoutErrorHandling(r,a,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,d,g,y)}evaluate(r,a,u,d,g,y,x){return this._styleExpression.evaluate(r,a,u,d,g,y,void 0,void 0,x)}}class du{constructor(r,a,u,d,g,y){this.kind=r,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!Sd(a.expression),this.isIndoorDependent=Ap(a.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=hu(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(r,a,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,d,g,y)}evaluate(r,a,u,d,g,y){return this._styleExpression.evaluate(r,a,u,d,g,y)}interpolationFactor(r,a,u){return this.interpolationType?qs.interpolationFactor(this.interpolationType,r,a,u):0}}function Uy(l,r,a,u,d){if((l=Ac(l,r,a,u,d)).result==="error")return l;const g=l.value.expression,y=ih(g);if(!y&&!Md(r))return Ec([new oa("","data expressions not supported")]);const x=oh(g,["zoom","pitch","distance-from-center"]);if(!x&&!Dx(r))return Ec([new oa("","zoom expressions not supported")]);const E=oh(g,["measure-light"]);if(!E&&!Rx(r))return Ec([new oa("","measure-light expression not supported")]);const C=oh(g,["line-progress"]);if(!C&&!function(j){return $y(j.expression,"line-progress")}(r))return Ec([new oa("","line-progress expression not supported")]);const R=r.expression&&r.expression.relaxZoomRestriction,D=Ia(g);return D||x||R?D instanceof oa?Ec([D]):D instanceof qs&&!Pp(r)?Ec([new oa("",'"interpolate" expressions cannot be used with this property')]):Ox(D?new du(y&&C?"camera":"composite",l.value,D.labels,D instanceof qs?D.interpolation:void 0,E,C):new dh(y&&C?"constant":"source",l.value,E,C)):Ec([new oa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Mp{constructor(r,a){this._parameters=r,this._specification=a,Object.assign(this,jx(this._parameters,this._specification))}static deserialize(r){return new Mp(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ia(l){let r=null;if(l instanceof Al)r=Ia(l.result);else if(l instanceof Pd){for(const a of l.args)if(r=Ia(a),r)break}else(l instanceof Ed||l instanceof qs)&&l.input instanceof ms&&l.input.name==="zoom"&&(r=l);return r instanceof oa||l.eachChild(a=>{const u=Ia(a);u instanceof oa?r=u:r&&u&&r!==u&&(r=new oa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var Gy,zx,Fx=function(){if(zx)return Gy;zx=1,Gy=r;var l=3;function r(a,u,d){var g=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(u=y[1])+2*(d=y[2]);for(var x=0;x<this.d*this.d;x++){var E=y[l+x],C=y[l+x+1];g.push(E===C?null:y.subarray(E,C))}var R=y[l+g.length+1];this.keys=y.subarray(y[l+g.length],R),this.bboxes=y.subarray(R),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var D=0;D<this.d*this.d;D++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=d,this.scale=u/a,this.uid=0;var j=d/u*a;this.min=-j,this.max=a+j}return r.prototype.insert=function(a,u,d,g,y){this._forEachCell(u,d,g,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(a,u,d,g,y,x){this.cells[y].push(x)},r.prototype.query=function(a,u,d,g,y){var x=this.min,E=this.max;if(a<=x&&u<=x&&E<=d&&E<=g&&!y)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,u,d,g,this._queryCell,C,{},y),C},r.prototype._queryCell=function(a,u,d,g,y,x,E,C){var R=this.cells[y];if(R!==null)for(var D=this.keys,j=this.bboxes,V=0;V<R.length;V++){var $=R[V];if(E[$]===void 0){var Z=4*$;(C?C(j[Z+0],j[Z+1],j[Z+2],j[Z+3]):a<=j[Z+2]&&u<=j[Z+3]&&d>=j[Z+0]&&g>=j[Z+1])?(E[$]=!0,x.push(D[$])):E[$]=!1}}},r.prototype._forEachCell=function(a,u,d,g,y,x,E,C){for(var R=this._convertToCellCoord(a),D=this._convertToCellCoord(u),j=this._convertToCellCoord(d),V=this._convertToCellCoord(g),$=R;$<=j;$++)for(var Z=D;Z<=V;Z++){var re=this.d*Z+$;if((!C||C(this._convertFromCellCoord($),this._convertFromCellCoord(Z),this._convertFromCellCoord($+1),this._convertFromCellCoord(Z+1)))&&y.call(this,a,u,d,g,re,x,E,C))return}},r.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},r.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=l+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var y=new Int32Array(u+d+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var x=u,E=0;E<a.length;E++){var C=a[E];y[l+E]=x,y.set(C,x),x+=C.length}return y[l+a.length]=x,y.set(this.keys,x),y[l+a.length+1]=x+=this.keys.length,y.set(this.bboxes,x),x+=this.bboxes.length,y.buffer},Gy}(),fh=Wn(Fx);const fu={};function Yt(l,r,a={}){Object.defineProperty(l,"_classRegistryKey",{value:r,writable:!1}),fu[r]={klass:l,omit:a.omit||[]}}Yt(Object,"Object"),fh.serialize=function(l,r){const a=l.toArrayBuffer();return r&&r.add(a),{buffer:a}},fh.deserialize=function(l){return new fh(l.buffer)},Object.defineProperty(fh,"name",{value:"Grid"}),Yt(fh,"Grid"),delete mt.prototype.constructor,Yt(Dn,"Color"),Yt(Error,"Error"),Yt(fs,"Formatted"),Yt(tp,"FormattedSection"),Yt(Ls,"AJAXError"),Yt(ps,"ResolvedImage"),Yt(Mp,"StylePropertyFunction"),Yt(Ip,"StyleExpression",{omit:["_evaluator"]}),Yt(es,"ImageId"),Yt(Tl,"ImageVariant"),Yt(du,"ZoomDependentExpression"),Yt(dh,"ZoomConstantExpression"),Yt(ms,"CompoundExpression",{omit:["_evaluate"]});for(const l in hh)fu[hh[l]._classRegistryKey]||Yt(hh[l],`Expression${l}`);function Rd(l){return l&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Pl(l,r){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Rd(l)||l instanceof ImageBitmap)return r&&r.add(l),l;if(ArrayBuffer.isView(l))return r&&r.add(l.buffer),l;if(l instanceof ImageData)return r&&r.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const u of l)a.push(Pl(u,r));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[u,d]of l.entries())a.entries.push(Pl(u),Pl(d,r));return a}if(l instanceof Set){const a={$name:"Set"};let u=0;for(const d of l.values())a[++u]=Pl(d);return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const d=a.serialize?a.serialize(l,r):{};if(!a.serialize){for(const g in l)l.hasOwnProperty(g)&&(fu[u].omit.indexOf(g)>=0||(d[g]=Pl(l[g],r)));l instanceof Error&&(d.message=l.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof l)}function Pc(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Rd(l)||l instanceof ImageBitmap||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Pc);if(typeof l=="object"){const r=l.$name||"Object";if(r==="Map"){const d=l.entries||[],g=new Map;for(let y=0;y<d.length;y+=2)g.set(Pc(d[y]),Pc(d[y+1]));return g}if(r==="Set"){const d=new Set;for(const g of Object.keys(l))g!=="$name"&&d.add(Pc(l[g]));return d}if(r==="BigInt")return BigInt(l.value);const{klass:a}=fu[r];if(!a)throw new Error(`Can't deserialize unregistered class "${r}".`);if(a.deserialize)return a.deserialize(l);const u=Object.create(a.prototype);for(const d of Object.keys(l))d!=="$name"&&(u[d]=Pc(l[d]));return u}throw new Error("can't deserialize object of type "+typeof l)}const mr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Dd(l){for(const r of l)if(Op(r.charCodeAt(0)))return!0;return!1}function Hy(l){for(const r of l)if(!Bx(r.charCodeAt(0)))return!1;return!0}function Bx(l){return!(mr.Arabic(l)||mr["Arabic Supplement"](l)||mr["Arabic Extended-A"](l)||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l))}function Op(l){return!(l!==746&&l!==747&&(l<4352||!(mr["Bopomofo Extended"](l)||mr.Bopomofo(l)||mr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||mr["CJK Compatibility Ideographs"](l)||mr["CJK Compatibility"](l)||mr["CJK Radicals Supplement"](l)||mr["CJK Strokes"](l)||!(!mr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||mr["CJK Unified Ideographs Extension A"](l)||mr["CJK Unified Ideographs"](l)||mr["Enclosed CJK Letters and Months"](l)||mr["Hangul Compatibility Jamo"](l)||mr["Hangul Jamo Extended-A"](l)||mr["Hangul Jamo Extended-B"](l)||mr["Hangul Jamo"](l)||mr["Hangul Syllables"](l)||mr.Hiragana(l)||mr["Ideographic Description Characters"](l)||mr.Kanbun(l)||mr["Kangxi Radicals"](l)||mr["Katakana Phonetic Extensions"](l)||mr.Katakana(l)&&l!==12540||!(!mr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!mr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||mr["Unified Canadian Aboriginal Syllabics"](l)||mr["Unified Canadian Aboriginal Syllabics Extended"](l)||mr["Vertical Forms"](l)||mr["Yijing Hexagram Symbols"](l)||mr["Yi Syllables"](l)||mr["Yi Radicals"](l))))}function Rp(l){return!(Op(l)||function(r){return!!(mr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||mr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||mr["Letterlike Symbols"](r)||mr["Number Forms"](r)||mr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||mr["Control Pictures"](r)&&r!==9251||mr["Optical Character Recognition"](r)||mr["Enclosed Alphanumerics"](r)||mr["Geometric Shapes"](r)||mr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||mr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||mr["CJK Symbols and Punctuation"](r)||mr.Katakana(r)||mr["Private Use Area"](r)||mr["CJK Compatibility Forms"](r)||mr["Small Form Variants"](r)||mr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(l))}function Dp(l){return mr.Arabic(l)||mr["Arabic Supplement"](l)||mr["Arabic Extended-A"](l)||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l)}function Wy(l){return l>=1424&&l<=2303||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l)}function Cl(l,r){return!(!r&&Wy(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||mr.Khmer(l))}function u2(l){for(const r of l)if(Wy(r.charCodeAt(0)))return!0;return!1}const Ns={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let qy=null,gs=Ns.unavailable,Il=null;const kd=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(gs=Ns.error),qy&&qy(l)};function kp(){jp.fire(new Ha("pluginStateChange",{pluginStatus:gs,pluginURL:Il}))}const jp=new su,jd=function(){return gs},Vx=function(){if(gs!==Ns.deferred||!Il)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gs=Ns.loading,kp(),Il&&wl({url:Il},l=>{l?kd(l):(gs=Ns.loaded,kp())})},Ml={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>gs===Ns.loaded||Ml.applyArabicShaping!=null,isLoading:()=>gs===Ns.loading,setState(l){gs=l.pluginStatus,Il=l.pluginURL},isParsing:()=>gs===Ns.parsing,isParsed:()=>gs===Ns.parsed,getPluginURL:()=>Il};class ri{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(a,u){for(const d of a)if(!Cl(d.charCodeAt(0),u))return!1;return!0}(r,Ml.isLoaded())}}class Lp{constructor(r,a,u,d,g){this.property=r,this.value=a,this.expression=function(y,x,E,C,R){if(Cp(y))return new Mp(y,x);if(Od(y)||Array.isArray(y)&&y.length>0){const D=Uy(y,x,E,C,R);if(D.result==="error")throw new Error(D.value.map(j=>`${j.key}: ${j.message}`).join(", "));return D.value}{let D=y;return typeof y=="string"&&x.type==="color"&&(D=Dn.parse(y)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}}(a===void 0?r.specification.default:a,r.specification,u,d,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,u,d){return this.property.possiblyEvaluate(this,r,a,u,d)}}class Zy{constructor(r,a,u,d){this.property=r,this.value=new Lp(r,void 0,a,u,d)}transitioned(r,a){return new Ux(this.property,this.value,a,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new Ux(this.property,this.value,null,{},0)}}class $x{constructor(r,a,u,d){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return dt(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Zy(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new Lp(this._values[r].property,a===null?void 0:dt(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].value.isIndoorDependent())}setTransitionOrValue(r,a){a&&(this._options=a);const u=this._properties.properties;if(r)for(const d in r){const g=r[d];if(d.endsWith("-transition")){const y=d.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(r){return dt(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Zy(this._values[r].property)),this._values[r].transition=dt(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(r[a]=u);const d=this.getTransition(a);d!==void 0&&(r[`${a}-transition`]=d)}return r}transitioned(r,a){const u=new Gx(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(r,a._values[d]);return u}untransitioned(){const r=new Gx(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}isIndoorDependent(){return this._isIndoorDependent}}class Ux{constructor(r,a,u,d,g){const y=d.delay||0,x=d.duration||0;g=g||0,this.property=r,this.value=a,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(r,a,u){const d=r.now||0,g=this.value.possiblyEvaluate(r,a,u),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(r,a,u);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,a,u),g,eu(x))}}return g}}class Gx{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,u){const d=new mu(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(r,a,u);return d}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Hx{constructor(r,a,u,d){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return dt(this._values[r].value)}setValue(r,a){this._values[r]=new Lp(this._values[r].property,a===null?void 0:dt(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].isIndoorDependent())}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(r[a]=u)}return r}possiblyEvaluate(r,a,u,d){const g=new mu(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,a,u,d);return g}isIndoorDependent(){return this._isIndoorDependent}}class pu{constructor(r,a,u,d){this.property=r,this.value=a,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,u,d){return this.property.evaluate(this.value,this.parameters,r,a,u,d,this.iconImageUseTheme)}}class mu{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ct{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,u){const d=md[this.specification.type];return d?d(r,a,u):r}}class Dt{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,u,d,g){return r.expression.kind==="constant"||r.expression.kind==="camera"?new pu(this,{kind:"constant",value:r.expression.evaluate(a,null,{},u,d,void 0,g)},a):new pu(this,r.expression,a,g)}interpolate(r,a,u){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new pu(this,{kind:"constant",value:void 0},r.parameters);const d=md[this.specification.type];return d?new pu(this,{kind:"constant",value:d(r.value.value,a.value.value,u)},r.parameters):r}evaluate(r,a,u,d,g,y,x){return r.kind==="constant"?r.value:r.evaluate(a,u,d,g,y,void 0,x)}}class gu{constructor(r){this.specification=r}possiblyEvaluate(r,a,u,d){return!!r.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class Pi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new ri(0,{});for(const u in r){const d=r[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Lp(d,void 0),y=this.defaultTransitionablePropertyValues[u]=new Zy(d);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(a)}}}Yt(Dt,"DataDrivenProperty"),Yt(Ct,"DataConstantProperty"),Yt(gu,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Wx(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Np(l){if(Array.isArray(l))return l.map(Np);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const a in l)r[a]=Np(l[a]);return r}return Wx(l)}function Ya(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!Ya(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function zp(l,r="",a=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ya(l)||(l=Fp(l));const d=l;let g=!0;try{g=function(R){if(!ph(R))return R;let D=Np(R);return qx(D),D=yu(D),D}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let y=null,x=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){x=Ve[`filter_${u}`];const R=Ac(g,x,r,a);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,j,V)=>R.value.evaluate(D,j,{},V)}let E=null,C=null;if(g!==d){const R=Ac(d,x,r,a);if(R.result==="error")throw new Error(R.value.map(D=>`${D.key}: ${D.message}`).join(", "));E=(D,j,V,$,Z)=>R.value.evaluate(D,j,{},V,void 0,void 0,$,Z),C=!ih(R.value.expression)}return{filter:y,dynamicFilter:E||void 0,needGeometry:Zx(g),needFeature:!!C}}function yu(l){if(!Array.isArray(l))return l;const r=function(a){if(h2.has(a[0])){for(let u=1;u<a.length;u++)if(ph(a[u]))return!0}return a}(l);return r===!0?r:r.map(a=>yu(a))}function qx(l){let r=!1;const a=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)r=r||ph(l[u]),a.push(l[u+1]);a.push(l[l.length-1])}else if(l[0]==="match"){r=r||ph(l[1]);for(let u=2;u<l.length-1;u+=2)a.push(l[u+1]);a.push(l[l.length-1])}else if(l[0]==="step"){r=r||ph(l[1]);for(let u=1;u<l.length-1;u+=2)a.push(l[u+1])}r&&(l.length=0,l.push("any",...a));for(let u=1;u<l.length;u++)qx(l[u])}function ph(l){if(!Array.isArray(l))return!1;if((r=l[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let a=1;a<l.length;a++)if(ph(l[a]))return!0;return!1}const h2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function d2(l,r){return l<r?-1:l>r?1:0}function Zx(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(Zx(l[r]))return!0;return!1}function Fp(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?Bp(l[1],l[2],"=="):r==="!="?Ld(Bp(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Bp(l[1],l[2],r):r==="any"?(a=l.slice(1),["any"].concat(a.map(Fp))):r==="all"?["all"].concat(l.slice(1).map(Fp)):r==="none"?["all"].concat(l.slice(1).map(Fp).map(Ld)):r==="in"?Vp(l[1],l.slice(2)):r==="!in"?Ld(Vp(l[1],l.slice(2))):r==="has"?$p(l[1]):r!=="!has"||Ld($p(l[1]));var a}function Bp(l,r,a){switch(l){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,l,r]}}function Vp(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",l,["literal",r.sort(d2)]]:["filter-in-small",l,["literal",r]]}}function $p(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ld(l){return["!",l]}const _u="";function Ma(l,r){return r?`${l}${_u}${r}`:l}let Xx;const Kx=()=>Xx||(Xx=new Pi({"icon-size":new Dt(Ve.layout_symbol["icon-size"]),"icon-image":new Dt(Ve.layout_symbol["icon-image"]),"icon-rotate":new Dt(Ve.layout_symbol["icon-rotate"]),"icon-offset":new Dt(Ve.layout_symbol["icon-offset"]),"text-size":new Dt(Ve.layout_symbol["text-size"]),"text-rotate":new Dt(Ve.layout_symbol["text-rotate"]),"text-offset":new Dt(Ve.layout_symbol["text-offset"])}));class Yx{constructor(r,a,u,d,g,y){const x=Ac(r,Ve.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=a,u){this.properties=new mu(Kx()),this.unevaluatedLayout=new Hx(Kx(),d,g,y);for(const E in u)this.unevaluatedLayout.setValue(E,u[E])}}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(r){return this.unevaluatedLayout._values[r]}recalculate(r,a,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(r,void 0,a,u))}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.unevaluatedLayout&&(r.properties=this.unevaluatedLayout.serialize()),r}hasIconProperties(){const r=this.hasProperty("icon-image"),a=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),d=this.hasProperty("icon-rotate");return r||a||u||d}hasTextProperties(){const r=this.hasProperty("text-size"),a=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return r||a||u}hasProperty(r){return this.getUnevaluatedProperty(r).value!==void 0}}const Jx="-transition",Ja=new Set(["fill","line","background","hillshade","raster"]);class ys extends su{constructor(r,a,u,d,g,y){if(super(),this.id=r.id,this.fqid=Ma(this.id,u),this.type=r.type,this.scope=u,this.lut=d,this.options=g,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const x=Ac(this.filter,Ve[`filter_${r.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(r.slot&&(this.slot=r.slot),r.appearances&&this.setAppearances(r.appearances),a.layout&&(this._unevaluatedLayout=new Hx(a.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new $x(a.paint,this.scope,g);for(const x in r.paint)this.setPaintProperty(x,r.paint[x]);for(const x in r.layout)this.setLayoutProperty(x,r.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mu(a.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&Ja.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a){if(this.type==="custom"&&r==="visibility")return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),r==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(r){this.appearances=[],r.forEach(a=>{this.appearances.push(new Yx(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(Jx)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}isPaintProperty(r){return!!this._transitionablePaint._properties.properties[r]}setPaintProperty(r,a){const u=this._transitionablePaint,d=u._properties.properties;if(r.endsWith(Jx)){const D=r.slice(0,-11);return d[D]&&u.setTransition(D,a||void 0),!1}if(!d[r])return!1;const g=u._values[r],y=g.value.isDataDriven(),x=g.value;u.setValue(r,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(r);const E=u._values[r].value,C=E.isDataDriven(),R=r.endsWith("pattern")||r==="line-dasharray";return C||y||R||this._handleOverridablePaintPropertyUpdate(r,x,E)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,a,u){return null}_handleOverridablePaintPropertyUpdate(r,a,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map(a=>a.serialize())),Tt(r,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof pu&&Md(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const r of this.appearances)if(!Sd(r.condition.expression))return!0;return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=zp(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(r,a,u){return{}}queryRadius(r){}queryIntersectsFeature(r,a,u,d,g,y,x,E,C){}}const Qx={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nd{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const f2=new ArrayBuffer(0);class ui{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(r,a){return r._trim(),a&&r.arrayBuffer&&a.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,r.arrayBuffer?a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement:(a.capacity=0,a.arrayBuffer=f2),a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this._reallocCount++,this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}reserveForAdditional(r){this.reserve(this.length+r)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xr(l,r=1){let a=0,u=0;return{members:l.map(d=>{const g=Qx[d.type].BYTES_PER_ELEMENT,y=a=eb(a,Math.max(r,g)),x=d.components||1;return u=Math.max(u,g),a+=g*x,{name:d.name,type:d.type,components:x,offset:y}}),size:eb(a,Math.max(u,r)),alignment:r}}function eb(l,r){return Math.ceil(l/r)*r}class Cc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const d=2*r;return this.int16[d+0]=a,this.int16[d+1]=u,r}}Cc.prototype.bytesPerElement=4,Yt(Cc,"StructArrayLayout2i4");class mh extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,u)}emplace(r,a,u,d){const g=3*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=d,r}}mh.prototype.bytesPerElement=6,Yt(mh,"StructArrayLayout3i6");class gh extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,d)}emplace(r,a,u,d,g){const y=4*r;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=d,this.int16[y+3]=g,r}}gh.prototype.bytesPerElement=8,Yt(gh,"StructArrayLayout4i8");class Ol extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ol.prototype.bytesPerElement=4,Yt(Ol,"StructArrayLayout1f4");class Xy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,u)}emplace(r,a,u,d){const g=4*r,y=2*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.float32[y+1]=d,r}}Xy.prototype.bytesPerElement=8,Yt(Xy,"StructArrayLayout2i1f8");class Ky extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,u)}emplace(r,a,u,d){const g=4*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=d,r}}Ky.prototype.bytesPerElement=8,Yt(Ky,"StructArrayLayout3i8");class Yy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,d,g)}emplace(r,a,u,d,g,y){const x=5*r;return this.int16[x+0]=a,this.int16[x+1]=u,this.int16[x+2]=d,this.int16[x+3]=g,this.int16[x+4]=y,r}}Yy.prototype.bytesPerElement=10,Yt(Yy,"StructArrayLayout5i10");class Up extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,d,g,y,x)}emplace(r,a,u,d,g,y,x,E){const C=6*r,R=12*r,D=3*r;return this.int16[C+0]=a,this.int16[C+1]=u,this.uint8[R+4]=d,this.uint8[R+5]=g,this.uint8[R+6]=y,this.uint8[R+7]=x,this.float32[D+2]=E,r}}Up.prototype.bytesPerElement=12,Yt(Up,"StructArrayLayout2i4ub1f12");class Zs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,u)}emplace(r,a,u,d){const g=3*r;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=d,r}}Zs.prototype.bytesPerElement=12,Yt(Zs,"StructArrayLayout3f12");class As extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,d,g)}emplace(r,a,u,d,g,y){const x=6*r,E=3*r;return this.uint16[x+0]=a,this.uint16[x+1]=u,this.uint16[x+2]=d,this.uint16[x+3]=g,this.float32[E+2]=y,r}}As.prototype.bytesPerElement=12,Yt(As,"StructArrayLayout4ui1f12");class vu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,d)}emplace(r,a,u,d,g){const y=4*r;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=d,this.uint16[y+3]=g,r}}vu.prototype.bytesPerElement=8,Yt(vu,"StructArrayLayout4ui8");class Gp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,d,g,y)}emplace(r,a,u,d,g,y,x){const E=6*r;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=d,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}Gp.prototype.bytesPerElement=12,Yt(Gp,"StructArrayLayout6i12");class Jy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D,j){const V=this.length;return this.resize(V+1),this.emplace(V,r,a,u,d,g,y,x,E,C,R,D,j)}emplace(r,a,u,d,g,y,x,E,C,R,D,j,V){const $=12*r;return this.int16[$+0]=a,this.int16[$+1]=u,this.int16[$+2]=d,this.int16[$+3]=g,this.uint16[$+4]=y,this.uint16[$+5]=x,this.uint16[$+6]=E,this.uint16[$+7]=C,this.int16[$+8]=R,this.int16[$+9]=D,this.int16[$+10]=j,this.int16[$+11]=V,r}}Jy.prototype.bytesPerElement=24,Yt(Jy,"StructArrayLayout4i4ui4i24");class Qy extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,d,g,y)}emplace(r,a,u,d,g,y,x){const E=10*r,C=5*r;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=d,this.float32[C+2]=g,this.float32[C+3]=y,this.float32[C+4]=x,r}}Qy.prototype.bytesPerElement=20,Yt(Qy,"StructArrayLayout3i3f20");class Ic extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,d)}emplace(r,a,u,d,g){const y=4*r;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=d,this.float32[y+3]=g,r}}Ic.prototype.bytesPerElement=16,Yt(Ic,"StructArrayLayout4f16");class Hp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Hp.prototype.bytesPerElement=4,Yt(Hp,"StructArrayLayout1ul4");class Xs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const d=2*r;return this.uint16[d+0]=a,this.uint16[d+1]=u,r}}Xs.prototype.bytesPerElement=4,Yt(Xs,"StructArrayLayout2ui4");class Wp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D,j,V){const $=this.length;return this.resize($+1),this.emplace($,r,a,u,d,g,y,x,E,C,R,D,j,V)}emplace(r,a,u,d,g,y,x,E,C,R,D,j,V,$){const Z=20*r,re=10*r;return this.int16[Z+0]=a,this.int16[Z+1]=u,this.int16[Z+2]=d,this.int16[Z+3]=g,this.int16[Z+4]=y,this.float32[re+3]=x,this.float32[re+4]=E,this.float32[re+5]=C,this.float32[re+6]=R,this.int16[Z+14]=D,this.uint32[re+8]=j,this.uint16[Z+18]=V,this.uint16[Z+19]=$,r}}Wp.prototype.bytesPerElement=40,Yt(Wp,"StructArrayLayout5i4f1i1ul2ui40");class qp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,d,g,y,x)}emplace(r,a,u,d,g,y,x,E){const C=8*r;return this.int16[C+0]=a,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+4]=g,this.int16[C+5]=y,this.int16[C+6]=x,this.int16[C+7]=E,r}}qp.prototype.bytesPerElement=16,Yt(qp,"StructArrayLayout3i2i2i16");class Zp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,d,g)}emplace(r,a,u,d,g,y){const x=4*r,E=8*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=d,this.int16[E+6]=g,this.int16[E+7]=y,r}}Zp.prototype.bytesPerElement=16,Yt(Zp,"StructArrayLayout2f1f2i16");class e_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,d,g,y)}emplace(r,a,u,d,g,y,x){const E=20*r,C=5*r;return this.uint8[E+0]=a,this.uint8[E+1]=u,this.float32[C+1]=d,this.float32[C+2]=g,this.float32[C+3]=y,this.float32[C+4]=x,r}}e_.prototype.bytesPerElement=20,Yt(e_,"StructArrayLayout2ub4f20");class to extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,r,a,u)}emplace(r,a,u,d){const g=3*r;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=d,r}}to.prototype.bytesPerElement=6,Yt(to,"StructArrayLayout3ui6");class yh extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we){const _e=this.length;return this.resize(_e+1),this.emplace(_e,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we)}emplace(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we,_e){const Ee=30*r,Me=15*r,De=60*r;return this.int16[Ee+0]=a,this.int16[Ee+1]=u,this.int16[Ee+2]=d,this.float32[Me+2]=g,this.float32[Me+3]=y,this.uint16[Ee+8]=x,this.uint16[Ee+9]=E,this.uint32[Me+5]=C,this.uint32[Me+6]=R,this.uint32[Me+7]=D,this.uint16[Ee+16]=j,this.uint16[Ee+17]=V,this.uint16[Ee+18]=$,this.float32[Me+10]=Z,this.float32[Me+11]=re,this.uint8[De+48]=te,this.uint8[De+49]=le,this.uint8[De+50]=ue,this.uint32[Me+13]=fe,this.int16[Ee+28]=we,this.uint8[De+58]=_e,r}}yh.prototype.bytesPerElement=60,Yt(yh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class t_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we,_e,Ee,Me,De,rt,Ne,at,ft,pt,xt,wt,yt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we,_e,Ee,Me,De,rt,Ne,at,ft,pt,xt,wt,yt)}emplace(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we,_e,Ee,Me,De,rt,Ne,at,ft,pt,xt,wt,yt,_t){const st=20*r,it=40*r,vt=80*r;return this.float32[st+0]=a,this.float32[st+1]=u,this.int16[it+4]=d,this.int16[it+5]=g,this.int16[it+6]=y,this.int16[it+7]=x,this.int16[it+8]=E,this.int16[it+9]=C,this.int16[it+10]=R,this.int16[it+11]=D,this.int16[it+12]=j,this.uint16[it+13]=V,this.uint16[it+14]=$,this.uint16[it+15]=Z,this.uint16[it+16]=re,this.uint16[it+17]=te,this.uint16[it+18]=le,this.uint16[it+19]=ue,this.uint16[it+20]=fe,this.uint16[it+21]=we,this.uint16[it+22]=_e,this.uint16[it+23]=Ee,this.uint16[it+24]=Me,this.uint16[it+25]=De,this.uint16[it+26]=rt,this.uint16[it+27]=Ne,this.uint32[st+14]=at,this.float32[st+15]=ft,this.float32[st+16]=pt,this.float32[st+17]=xt,this.float32[st+18]=wt,this.uint8[vt+76]=yt,this.uint16[it+39]=_t,r}}t_.prototype.bytesPerElement=80,Yt(t_,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class r_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,u,d,g,y)}emplace(r,a,u,d,g,y,x){const E=6*r;return this.float32[E+0]=a,this.float32[E+1]=u,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=y,this.float32[E+5]=x,r}}r_.prototype.bytesPerElement=24,Yt(r_,"StructArrayLayout6f24");class xu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,d,g)}emplace(r,a,u,d,g,y){const x=5*r;return this.float32[x+0]=a,this.float32[x+1]=u,this.float32[x+2]=d,this.float32[x+3]=g,this.float32[x+4]=y,r}}xu.prototype.bytesPerElement=20,Yt(xu,"StructArrayLayout5f20");class n_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,d,g,y,x)}emplace(r,a,u,d,g,y,x,E){const C=7*r;return this.float32[C+0]=a,this.float32[C+1]=u,this.float32[C+2]=d,this.float32[C+3]=g,this.float32[C+4]=y,this.float32[C+5]=x,this.float32[C+6]=E,r}}n_.prototype.bytesPerElement=28,Yt(n_,"StructArrayLayout7f28");class i_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D){const j=this.length;return this.resize(j+1),this.emplace(j,r,a,u,d,g,y,x,E,C,R,D)}emplace(r,a,u,d,g,y,x,E,C,R,D,j){const V=11*r;return this.float32[V+0]=a,this.float32[V+1]=u,this.float32[V+2]=d,this.float32[V+3]=g,this.float32[V+4]=y,this.float32[V+5]=x,this.float32[V+6]=E,this.float32[V+7]=C,this.float32[V+8]=R,this.float32[V+9]=D,this.float32[V+10]=j,r}}i_.prototype.bytesPerElement=44,Yt(i_,"StructArrayLayout11f44");class _h extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C){const R=this.length;return this.resize(R+1),this.emplace(R,r,a,u,d,g,y,x,E,C)}emplace(r,a,u,d,g,y,x,E,C,R){const D=9*r;return this.float32[D+0]=a,this.float32[D+1]=u,this.float32[D+2]=d,this.float32[D+3]=g,this.float32[D+4]=y,this.float32[D+5]=x,this.float32[D+6]=E,this.float32[D+7]=C,this.float32[D+8]=R,r}}_h.prototype.bytesPerElement=36,Yt(_h,"StructArrayLayout9f36");class Qa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const d=2*r;return this.float32[d+0]=a,this.float32[d+1]=u,r}}Qa.prototype.bytesPerElement=8,Yt(Qa,"StructArrayLayout2f8");class Ps extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,d)}emplace(r,a,u,d,g){const y=6*r;return this.uint32[3*r+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=d,this.uint16[y+4]=g,r}}Ps.prototype.bytesPerElement=12,Yt(Ps,"StructArrayLayout1ul3ui12");class Mc extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Mc.prototype.bytesPerElement=2,Yt(Mc,"StructArrayLayout1ui2");class o_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re){const te=this.length;return this.resize(te+1),this.emplace(te,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re)}emplace(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te){const le=16*r;return this.float32[le+0]=a,this.float32[le+1]=u,this.float32[le+2]=d,this.float32[le+3]=g,this.float32[le+4]=y,this.float32[le+5]=x,this.float32[le+6]=E,this.float32[le+7]=C,this.float32[le+8]=R,this.float32[le+9]=D,this.float32[le+10]=j,this.float32[le+11]=V,this.float32[le+12]=$,this.float32[le+13]=Z,this.float32[le+14]=re,this.float32[le+15]=te,r}}o_.prototype.bytesPerElement=64,Yt(o_,"StructArrayLayout16f64");class Xp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,u,d,g,y,x)}emplace(r,a,u,d,g,y,x,E){const C=10*r,R=5*r;return this.uint16[C+0]=a,this.uint16[C+1]=u,this.uint16[C+2]=d,this.uint16[C+3]=g,this.float32[R+2]=y,this.float32[R+3]=x,this.float32[R+4]=E,r}}Xp.prototype.bytesPerElement=20,Yt(Xp,"StructArrayLayout4ui3f20");class s_ extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.int16[1*r+0]=a,r}}s_.prototype.bytesPerElement=2,Yt(s_,"StructArrayLayout1i2");class Kp extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint8[1*r+0]=a,r}}Kp.prototype.bytesPerElement=1,Yt(Kp,"StructArrayLayout1ub1");class Yp extends Nd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Yp.prototype.size=40;class tb extends Wp{get(r){return new Yp(this,r)}}Yt(tb,"CollisionBoxArray");class Jp extends Nd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Jp.prototype.size=60;class rb extends yh{get(r){return new Jp(this,r)}}Yt(rb,"PlacedSymbolArray");class nb extends Nd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}nb.prototype.size=80;class a_ extends t_{get(r){return new nb(this,r)}}Yt(a_,"SymbolInstanceArray");class Qp extends Ol{getoffsetX(r){return this.float32[1*r+0]}}Yt(Qp,"GlyphOffsetArray");class ib extends Cc{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Yt(ib,"SymbolLineVertexArray");class l_ extends Nd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}l_.prototype.size=12;class c_ extends Ps{get(r){return new l_(this,r)}}Yt(c_,"FeatureIndexArray");class ob extends Xs{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Yt(ob,"FillExtrusionCentroidArray");class em extends Nd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}em.prototype.size=6;class zd extends mh{get(r){return new em(this,r)}}Yt(zd,"FillExtrusionWallArray");const sb=Xr([{name:"a_pos",components:2,type:"Int16"}],4),p2=Xr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ab=Xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class gi{constructor(r=[]){this.segments=r}_prepareSegment(r,a,u,d){let g=this.segments[this.segments.length-1];return r>gi.MAX_VERTEX_ARRAY_LENGTH&&Ut(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>gi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(r,a,u,d){return this._prepareSegment(r,a.length,u.length,d)}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,u,d){return new gi([{vertexOffset:r,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function tm(l,r){return 256*(l=ne(Math.floor(l),0,255))+ne(Math.floor(r),0,255)}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt(gi,"SegmentVector");const m2=Xr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),g2=Xr([{name:"a_pattern_b",components:4,type:"Uint16"}]),y2=Xr([{name:"a_dash",components:4,type:"Uint16"}]);class Fd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,a,u,d){this.ids.push(u_(r)),this.positions.push(a,u,d)}eachPosition(r,a){const u=u_(r);let d=0,g=this.ids.length-1;for(;d<g;){const y=d+g>>1;this.ids[y]>=u?g=y:d=y+1}for(;this.ids[d]===u;)a(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(r,a){const u=new Float64Array(r.ids),d=new Uint32Array(r.positions);return h_(u,d,0,u.length-1),a&&(a.add(u.buffer),a.add(d.buffer)),{ids:u,positions:d}}static deserialize(r){const a=new Fd;let u;a.ids=r.ids,a.positions=r.positions;for(const d of a.ids)d!==u&&a.uniqueIds.push(d),u=d;return a.indexed=!0,a}}function u_(l){const r=+l;return Number.isSafeInteger(r)?r:Yf(String(l))}function h_(l,r,a,u){for(;a<u;){const d=l[a+u>>1];let g=a-1,y=u+1;for(;;){do g++;while(l[g]<d);do y--;while(l[y]>d);if(g>=y)break;rm(l,g,y),rm(r,3*g,3*y),rm(r,3*g+1,3*y+1),rm(r,3*g+2,3*y+2)}y-a<u-y?(h_(l,r,a,y),a=y+1):(h_(l,r,y+1,u),u=y)}}function rm(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}Yt(Fd,"FeaturePositionMap");class Rl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}set(r,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class nm extends Rl{constructor(r){super(r),this.current=0}set(r,a,u){this.fetchUniformLocation(r,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ro extends Rl{constructor(r){super(r),this.current=0}set(r,a,u){this.fetchUniformLocation(r,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class el extends Rl{constructor(r){super(r),this.current=[0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Bd extends Rl{constructor(r){super(r),this.current=[0,0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class im extends Rl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Vd extends Rl{constructor(r){super(r),this.current=Dn.transparent.toPremultipliedRenderColor(null)}set(r,a,u){this.fetchUniformLocation(r,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const _2=new Float32Array(16);class $d extends Rl{constructor(r){super(r),this.current=_2}set(r,a,u){if(this.fetchUniformLocation(r,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const om=new Float32Array(9),v2=new Float32Array(4);class sm extends Rl{constructor(r){super(r),this.current=v2}set(r,a,u){if(this.fetchUniformLocation(r,a)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function d_(l){return[tm(255*l.r,255*l.g),tm(255*l.b,255*l.a)]}function Ud(l,r,a,u,d,g,y,x){return!!l&&(l.kind==="composite"||l.kind==="source"?l.evaluate(new ri(0,{brightness:g,worldview:x}),r,a,d,u,y)==="none":l.value==="none")}class Gd{constructor(r,a,u,d){this.value=r,this.uniformNames=a.map(g=>`u_${g}`),this.type=u,this.context=d}setUniform(r,a,u,d,g){const y=d.constantOr(this.value);a.set(r,g,y instanceof Dn?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(r,a){return this.type==="color"?new Vd(r):new ro(r)}}class vh{constructor(r,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,a){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(r,a,u,d,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&a.set(r,g,y)}getBinding(r,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new im(r):new ro(r)}}class Dl{constructor(r,a,u,d){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(r,a,u,d,g,y,x,E){const C=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ri(0,{brightness:y,worldview:E}),a,{},g,d,x):this.expression.kind==="constant"&&this.expression.value,D=Ud(this.lutExpression,a,{},d,g,y,x,E);this.paintVertexArray.resize(r),this._setPaintValue(C,r,R,D?null:this.context.lut)}updatePaintArray(r,a,u,d,g,y,x,E){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:E},u,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,R=Ud(this.lutExpression,u,d,g,void 0,x,void 0,E);this._setPaintValue(r,a,C,R?null:this.context.lut)}_setPaintValue(r,a,u,d){if(this.type==="color"){const g=d_(u.toPremultipliedRenderColor(d));for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kl{constructor(r,a,u,d,g,y){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=u,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,a,u,d,g,y,x,E){const C=this.expression.evaluate(new ri(this.context.zoom,{brightness:y,worldview:E}),a,{},g,d,x),R=this.expression.evaluate(new ri(this.context.zoom+1,{brightness:y,worldview:E}),a,{},g,d,x),D=Ud(this.lutExpression,a,{},d,g,y,x,E),j=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(j,r,C,R,D?null:this.context.lut)}updatePaintArray(r,a,u,d,g,y,x,E){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:E},u,d,void 0,g),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:E},u,d,void 0,g),D=Ud(this.lutExpression,u,d,g,void 0,x,void 0,E);this._setPaintValue(r,a,C,R,D?null:this.context.lut)}_setPaintValue(r,a,u,d,g){if(this.type==="color"){const y=d_(u.toPremultipliedRenderColor(g)),x=d_(u.toPremultipliedRenderColor(g));for(let E=r;E<a;E++)this.paintVertexArray.emplace(E,y[0],y[1],x[0],x[1])}else{for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,u,d,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=ne(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(r,g,x)}getBinding(r,a){return new ro(r)}}class jl{constructor(r,a,u,d,g){this.expression=r,this.layerId=g,this.paintVertexAttributes=(u==="array"?y2:m2).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new d,this.paintTransitionVertexArray=new vu}populatePaintArray(r,a,u,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(g,r,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(r,a,u,d,g,y,x){this._setPaintValues(r,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,a,u,d){if(!d||!u)return;const g=d[u[0]],y=d[u[1]];if(g){if(g){const{tl:x,br:E,pixelRatio:C}=g;for(let R=r;R<a;R++)this.paintVertexArray.emplace(R,x[0],x[1],E[0],E[1],C)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:E}=y;for(let C=r;C<a;C++)this.paintTransitionVertexArray.emplace(C,x[0],x[1],E[0],E[1])}}}upload(r){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,g2.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Oc{constructor(r,a,u=()=>!0){this.binders={},this._buffers=[],this.context=a;const d=[];for(const g in r.paint._values){const y=r.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof pu&&Md(y.property.specification)))continue;const x=b2(g,r.type),E=y.value,C=y.property.specification.type,R=!!y.property.useIntegerZoom,D=g==="line-dasharray"||g.endsWith("pattern"),j=r.paint.get(`${g}-use-theme`),V=g==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||j&&j.value.kind!=="constant";if(E.kind!=="constant"||V)if(E.kind==="source"||V||D){const $=f_(g,C,"source");this.binders[g]=D?new jl(E,x,C,$,r.id):new Dl(E,x,C,$),d.push(`/a_${g}`)}else{const $=f_(g,C,"composite");this.binders[g]=new kl(E,x,C,R,a,$),d.push(`/z_${g}`)}else this.binders[g]=D?new vh(E.value,x):new Gd(E.value,x,C,a),d.push(`/u_${g}`);j&&(this.binders[g].lutExpression=j.value)}this.cacheKey=d.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Dl||a instanceof kl?a.maxValue:0}populatePaintArrays(r,a,u,d,g,y,x,E){for(const C in this.binders){const R=this.binders[C];R.context=this.context,(R instanceof Dl||R instanceof kl||R instanceof jl)&&R.populatePaintArray(r,a,u,d,g,y,x,E)}}setConstantPatternPositions(r,a){for(const u in this.binders){const d=this.binders[u];d instanceof vh&&d.setConstantPatternPositions(r,a)}}getPatternTransitionVertexBuffer(r){const a=this.binders[r];return a instanceof jl?a.paintTransitionVertexBuffer:null}updatePaintArrays(r,a,u,d,g,y,x,E,C,R){let D=!1;const j=Object.keys(r),V=j.length!==0&&!E,$=V?j:a.uniqueIds;this.context.lut=g.lut;for(const Z in this.binders){const re=this.binders[Z];if(re.context=this.context,(re instanceof Dl||re instanceof kl||re instanceof jl)&&re.expression&&re.expression.kind&&re.expression.kind!=="constant"&&(re.expression.isStateDependent===!0||re.expression.isLightConstant===!1)){const te=g.paint.get(Z);re.expression=te.value;for(const le of $){const ue=r[le.toString()];a.eachPosition(le,(fe,we,_e)=>{const Ee=d.feature(fe);re.updatePaintArray(we,_e,Ee,ue,y,x,C,R)})}if(!V)for(const le of u.uniqueIds){const ue=r[le.toString()];u.eachPosition(le,(fe,we,_e)=>{const Ee=d.feature(fe);re.updatePaintArray(we,_e,Ee,ue,y,x,C,R)})}D=!0}}return D}defines(){const r=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Gd||u instanceof vh)&&r.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Gd||d instanceof vh||d instanceof kl)for(const g of d.uniformNames)a.push({name:g,property:u,binding:d.getBinding(r,g)})}return a}setUniforms(r,a,u,d,g){for(const{name:y,property:x,binding:E}of u)this.binders[x].setUniform(r,E,g,d.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Dl||a instanceof kl||a instanceof jl)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof jl&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(r){for(const a in this.binders){const u=this.binders[a];(u instanceof Dl||u instanceof kl||u instanceof jl)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Dl||a instanceof kl||a instanceof jl)&&a.destroy()}}}class Oa{constructor(r,a,u=()=>!0){this.programConfigurations={};for(const d of r)this.programConfigurations[d.id]=new Oc(d,a,u);this.needsUpload=!1,this._featureMap=new Fd,this._featureMapWithoutIds=new Fd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,a,u,d,g,y,x,E,C){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(r,a,d,g,y,x,E,C);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,u,d,g,y,x,E){for(const C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,a,C,d,g,y,x||0,E)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const x2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function b2(l,r){return x2[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}const w2={"line-pattern":{source:As,composite:As},"fill-pattern":{source:As,composite:As},"fill-extrusion-pattern":{source:As,composite:As},"line-dasharray":{source:vu,composite:vu}},T2={color:{source:Qa,composite:Ic},number:{source:Ol,composite:Qa}};function f_(l,r,a){const u=w2[l];return u&&u[a]||T2[r][a]}Yt(Gd,"ConstantBinder"),Yt(vh,"PatternConstantBinder"),Yt(Dl,"SourceExpressionBinder"),Yt(jl,"PatternCompositeBinder"),Yt(kl,"CompositeExpressionBinder"),Yt(Oc,"ProgramConfiguration",{omit:["_buffers"]}),Yt(Oa,"ProgramConfigurationSet");const Go=Mt/Math.PI/2,ca=5,am=6,S2=16383,xh=64,p_=[xh,32,16],ua=-Go,ha=Go;function bu(l,r,a,u=Go){return a=qr(a),[l*Math.sin(a)*u,-r*u,l*Math.cos(a)*u]}function bh(l,r,a){return bu(Math.cos(qr(l)),Math.sin(qr(l)),r,a)}const f=63710088e-1,o=2*Math.PI*f;class c{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,u=this.lat*a,d=r.lat*a,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((r.lng-this.lng)*a);return f*Math.acos(Math.min(g,1))}toBounds(r=0){const a=360*r/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new p({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(r){return bh(this.lat,this.lng,Go+r*Go/f)}static convert(r){if(r instanceof c)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new c(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new c(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class p{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof c?new c(r.lng,r.lat):c.convert(r),this}setSouthWest(r){return this._sw=r instanceof c?new c(r.lng,r.lat):c.convert(r),this}extend(r){const a=this._sw,u=this._ne;let d,g;if(r instanceof c)d=r,g=r;else{if(!(r instanceof p))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(p.convert(r)):this.extend(c.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(c.convert(r)):this;if(d=r._sw,g=r._ne,!d||!g)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new c(d.lng,d.lat),this._ne=new c(g.lng,g.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:u}=c.convert(r);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(r){if(r)return r instanceof p?r:new p(r)}}const v=0,w=25.5;function T(l){return o*Math.cos(l*Math.PI/180)}function P(l){return(180+l)/360}function O(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function k(l,r){return l/T(r)}function N(l){return 360*l-180}function W(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function H(l,r){return l*T(W(r))}const q=85.051129;function ee(l){return Math.cos(qr(ne(l,-q,q)))}function Y(l,r){const a=ne(r,v,w),u=Math.pow(2,a);return ee(l)*o/(512*u)}function se(l){return 1/Math.cos(l*Math.PI/180)}function oe(l,r=0){const a=Math.exp(Math.PI*(1-(l.y+r/Mt)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Mt/(1<<l.z)}class he{constructor(r,a,u=0){this.x=+r,this.y=+a,this.z=+u}static fromLngLat(r,a=0){const u=c.convert(r);return new he(P(u.lng),O(u.lat),k(a,u.lat))}toLngLat(){return new c(N(this.x),W(this.y))}toAltitude(){return H(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*se(W(this.y))}}function me(l,r,a,u,d,g,y,x,E){const C=(r+u)/2,R=(a+d)/2,D=new mt(C,R);x(D),function(j,V,$,Z,re,te){const le=$-re,ue=Z-te;return Math.abs((Z-V)*le-($-j)*ue)/Math.hypot(le,ue)}(D.x,D.y,g.x,g.y,y.x,y.y)>=E?(me(l,r,a,C,R,g,D,x,E),me(l,C,R,u,d,D,y,x,E)):l.push(y)}function de(l,r,a){let u=l[0],d=u.x,g=u.y;r(u);const y=[u];for(let x=1;x<l.length;x++){const E=l[x],{x:C,y:R}=E;r(E),me(y,d,g,C,R,u,E,r,a),d=C,g=R,u=E}return y}function Ae(l,r,a,u){if(u(r,a)){const d=r.add(a)._mult(.5);Ae(l,r,d,u),Ae(l,d,a,u)}else l.push(a)}function be(l,r){let a=l[0];const u=[a];for(let d=1;d<l.length;d++){const g=l[d];Ae(u,a,g,r),a=g}return u}const Se=Math.pow(2,14)-1,xe=-Se-1;function ye(l,r){const a=Math.round(l.x*r),u=Math.round(l.y*r);return l.x=ne(a,xe,Se),l.y=ne(u,xe,Se),(a<l.x||a>l.x+1||u<l.y||u>l.y+1)&&Ut("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ce(l,r,a){const u=l.loadGeometry(),d=l.extent,g=Mt/d;if(r&&a&&a.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:C,projection:R}=a,D=j=>{const V=N((r.x+j.x/d)/y),$=W((r.y+j.y/d)/y),Z=R.project(V,$);j.x=(Z.x*x-E)*d,j.y=(Z.y*x-C)*d};for(let j=0;j<u.length;j++)if(l.type!==1)u[j]=de(u[j],D,1);else{const V=[];for(const $ of u[j])$.x<0||$.x>=d||$.y<0||$.y>=d||(D($),V.push($));u[j]=V}}for(const y of u)for(const x of y)ye(x,g);return u}function Le(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?Ce(l):[]}}class ke{constructor(r,a,u,d,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=d,this._values=g,r.readFields(Je,this,a)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos,u=[];let d,g=1,y=0,x=0,E=0;for(;r.pos<a;){if(y<=0){const C=r.readVarint();g=7&C,y=C>>3}if(y--,g===1||g===2)x+=r.readSVarint(),E+=r.readSVarint(),g===1&&(d&&u.push(d),d=[]),d&&d.push(new mt(x,E));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos;let u=1,d=0,g=0,y=0,x=1/0,E=-1/0,C=1/0,R=-1/0;for(;r.pos<a;){if(d<=0){const D=r.readVarint();u=7&D,d=D>>3}if(d--,u===1||u===2)g+=r.readSVarint(),y+=r.readSVarint(),g<x&&(x=g),g>E&&(E=g),y<C&&(C=y),y>R&&(R=y);else if(u!==7)throw new Error(`unknown command ${u}`)}return[x,C,E,R]}toGeoJSON(r,a,u){const d=this.extent*Math.pow(2,u),g=this.extent*r,y=this.extent*a,x=this.loadGeometry();function E(j){return[360*(j.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+y)/d)*Math.PI))-90]}function C(j){return j.map(E)}let R;if(this.type===1){const j=[];for(const $ of x)j.push($[0]);const V=C(j);R=j.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const j=x.map(C);R=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{const j=function($){const Z=$.length;if(Z<=1)return[$];const re=[];let te,le;for(let ue=0;ue<Z;ue++){const fe=et($[ue]);fe!==0&&(le===void 0&&(le=fe<0),le===fe<0?(te&&re.push(te),te=[$[ue]]):te&&te.push($[ue]))}return te&&re.push(te),re}(x),V=[];for(const $ of j)V.push($.map(C));R=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const D={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function Je(l,r,a){l===1?r.id=a.readVarint():l===2?function(u,d){const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=d._keys[u.readVarint()],x=d._values[u.readVarint()];d.properties[y]=x}}(a,r):l===3?r.type=a.readVarint():l===4&&(r._geometry=a.pos)}function et(l){let r=0;for(let a,u,d=0,g=l.length,y=g-1;d<g;y=d++)a=l[d],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}ke.types=["Unknown","Point","LineString","Polygon"];class ht{constructor(r,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(St,this,a),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const a=this._pbf.readVarint()+this._pbf.pos;return new ke(this._pbf,a,this.extent,this._keys,this._values)}}function St(l,r,a){l===15?r.version=a.readVarint():l===1?r.name=a.readString():l===5?r.extent=a.readVarint():l===2?r._features.push(a.pos):l===3?r._keys.push(a.readString()):l===4&&r._values.push(function(u){let d=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=u.readVarint()>>3;d=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d}(a))}class We{constructor(r,a){this.layers=r.readFields(Re,{},a)}}function Re(l,r,a){if(l===3){const u=new ht(a,a.readVarint()+a.pos);u.length&&(r[u.name]=u)}}const ot="3d_elevation_id",Ze="level";class gt{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,a){return this._valid&&r(a(this._geometry)),this}require(r,a,u){return this.get(r,!0,a,u)}optional(r,a,u){return this.get(r,!1,a,u)}success(){return this._valid}get(r,a,u,d){const g=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(d?d(g):g):a&&(this._valid=!1),this}}class Rt{constructor(r,a){this.featureFunc=r,this.vertexFunc=a}parseFeature(r,a,u){return this.featureFunc(r,a,u)}parseVertex(r,a,u){return this.vertexFunc(r,a,u)}}const $t=new Rt((l,r,a)=>l.reset(r).require(ot,u=>{a.id=u}).optional("fixed_height_relative",u=>{a.constantHeight=u},Et.decodeRelativeHeight).geometry(u=>{a.bounds=u},El).success(),(l,r,a)=>l.reset(r).require(ot,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height_relative",u=>{a.height=u},Et.decodeRelativeHeight).geometry(u=>{a.position=u},Et.getPoint).success()),It=new Rt((l,r,a)=>l.reset(r).require(ot,u=>{a.id=u}).optional("fixed_height",u=>{a.constantHeight=u},Et.decodeMetricHeight).geometry(u=>{a.bounds=u},El).success(),(l,r,a)=>l.reset(r).require(ot,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height",u=>{a.height=u},Et.decodeMetricHeight).geometry(u=>{a.position=u},Et.getPoint).success());class Et{static getPoint(r){return Ir(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?It:void 0:$t}static parse(r){const a=[],u=[],d=r.length,g=new gt;for(let y=0;y<d;y++){const x=r.feature(y),E=x.properties.version,C=Et.getVersionSchema(E);if(C===void 0){Ut(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const R=x.properties.type;if(!R)continue;const D=ke.types[x.type];if(D==="Point"&&R==="curve_point"){const j={};C.parseVertex(g,x,j)&&a.push(j)}else if(D==="Polygon"&&R==="curve_meta"){const j={};C.parseFeature(g,x,j)&&u.push(j)}}return{vertices:a,features:u}}}class tr{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,u){const d=Mi(a,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class Jt{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,u){const d=nr(a,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(r,a,u){if(function(V,$){var Z=V[0],re=V[1],te=V[2],le=$[0],ue=$[1],fe=$[2];return Math.abs(Z-le)<=S*Math.max(1,Math.abs(Z),Math.abs(le))&&Math.abs(re-ue)<=S*Math.max(1,Math.abs(re),Math.abs(ue))&&Math.abs(te-fe)<=S*Math.max(1,Math.abs(te),Math.abs(fe))}(this.pos,r)||a===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,y]=this.dir,x=this.pos[0]-r[0],E=this.pos[1]-r[1],C=this.pos[2]-r[2],R=d*d+g*g+y*y,D=2*(x*d+E*g+C*y),j=D*D-4*R*(x*x+E*E+C*C-a*a);if(j<0){const V=Math.max(-D/2,0),$=x+d*V,Z=E+g*V,re=C+y*V,te=Math.hypot($,Z,re);return u[0]=$*a/te,u[1]=Z*a/te,u[2]=re*a/te,!1}{const V=(-D-Math.sqrt(j))/(2*R);if(V<0){const $=Math.hypot(x,E,C);return u[0]=x*a/$,u[1]=E*a/$,u[2]=C*a/$,!1}return u[0]=x+d*V,u[1]=E+g*V,u[2]=C+y*V,!0}}}class zt{constructor(r,a,u,d,g){this.TL=r,this.TR=a,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(r,a,u){const d=[-1,1,1],g=[1,1,1],y=[1,-1,1],x=[-1,-1,1],E=Nr(d,d,r),C=Nr(g,g,r),R=Nr(y,y,r),D=Nr(x,x,r);return new zt(E,C,R,D,a/u)}}function Gt(l,r,a){let u=1/0,d=-1/0;const g=[];for(const y of l){Kn(g,y,r);const x=nr(g,a);u=Math.min(u,x),d=Math.max(d,x)}return[u,d]}function dr(l,r){let a=!0;for(let u=0;u<l.planes.length;u++){const d=l.planes[u];let g=0;for(let y=0;y<r.length;y++)g+=+(nr(d,r[y])+d[3]>=0);if(g===0)return 0;g!==r.length&&(a=!1)}return a?2:1}function Or(l,r){for(const a of l.projections){const u=Gt(r,l.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function Qr(l,r){let a=0;const u=[0,0,0,0];for(let y=0;y<l.length;y++)u[0]=l[y][0],u[1]=l[y][1],u[2]=l[y][2],u[3]=1,(d=u)[0]*(g=r)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&a++;var d,g;return a}class wn{constructor(r,a){this.points=r||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=rr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Kn([],this.points[2],this.points[3]),Kn([],this.points[0],this.points[3]),Kn([],this.points[4],this.points[0]),Kn([],this.points[5],this.points[1]),Kn([],this.points[6],this.points[2]),Kn([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:d,projection:Gt(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:Gt(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(r,a,u,d){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const R=Hi([],C,r),D=1/R[3]/a*g;return(j=R)[0]=(V=R)[0]*($=[D,D,d?1/R[3]:D,D])[0],j[1]=V[1]*$[1],j[2]=V[2]*$[2],j[3]=V[3]*$[3],j;var j,V,$}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const R=Lt([],pr([],Kn([],y[C[0]],y[C[1]]),Kn([],y[C[2]],y[C[1]]))),D=-nr(R,y[C[1]]);return R.concat(D)}),E=[];for(let C=0;C<y.length;C++)E.push([y[C][0],y[C][1],y[C][2]]);return new wn(E,x)}intersectsPrecise(r,a,u){for(let d=0;d<a.length;d++)if(!Qr(r,a[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Qr(r,this.planes[d]))return 0;for(const d of u)for(const g of this.frustumEdges){const y=pr([],d,g),x=ct(y);if(x===0)continue;Vt(y,y,1/x);const E=Gt(this.points,this.points[0],y),C=Gt(r,this.points[0],y);if(E[0]>C[1]||C[0]>E[1])return 0}return 1}containsPoint(r){for(const a of this.planes){const u=a[3];if(nr([a[0],a[1],a[2]],r)+u<0)return!1}return!0}}class rr{static fromPoints(r){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of r)cr(a,a,d),Bt(u,u,d);return new rr(a,u)}static fromTileIdAndHeight(r,a,u){const d=1<<r.canonical.z,g=r.canonical.x,y=r.canonical.y;return new rr([g/d,y/d,a],[(g+1)/d,(y+1)/d,u])}static applyTransform(r,a){const u=r.getCorners();for(let d=0;d<u.length;++d)Nr(u[d],u[d],a);return rr.fromPoints(u)}static applyTransformFast(r,a){const u=[a[12],a[13],a[14]],d=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const x=a[4*y+g],E=x*r.min[y],C=x*r.max[y];u[g]+=Math.min(E,C),d[g]+=Math.max(E,C)}return new rr(u,d)}static projectAabbCorners(r,a){const u=r.getCorners();for(let d=0;d<u.length;++d)Nr(u[d],u[d],a);return u}constructor(r,a){this.min=r,this.max=a,this.center=Vt([],ut([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],u=Ke(this.min),d=Ke(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],d[g]=a[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new rr(u,d)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?dr(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?dr(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,a){return a||this.intersects(r)?Or(r,this.getCorners()):0}intersectsPreciseFlat(r,a){return a||this.intersectsFlat(r)?Or(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let a=0;a<3;++a)if(this.min[a]>r.max[a]||r.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r.min[a]),this.max[a]=Math.max(this.max[a],r.max[a])}encapsulatePoint(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r[a]),this.max[a]=Math.max(this.max[a],r[a])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}Yt(rr,"Aabb");class vn{constructor(r,a){this.feature=r,this.metersToTile=a,this.index=0}get(){const r=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,u=a[1],d=-a[0],g=(r.extent+1)*this.metersToTile;return[new mt(Math.trunc(r.position[0]+u*g),Math.trunc(r.position[1]+d*g)),new mt(Math.trunc(r.position[0]-u*g),Math.trunc(r.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mr{constructor(r,a,u,d,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[fr(),fr(),fr(),fr(),fr(),fr(),fr()],this.id=r,this.heightRange={min:u,max:u},this.safeArea=a,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((E=this.vertices[x.a].position)[0]===(C=this.vertices[x.b].position)[0]&&E[1]===C[1]);var E,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:Ir(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const E=this.vertices[x.a].position,C=this.vertices[x.b].position,R=eo(fr(),C,E),D=Io(R),j=ko(fr(),R,1/D);this.edgeProps.push({vec:R,dir:j,len:D});const V=this.vertexProps[x.a].dir,$=this.vertexProps[x.b].dir;Ii(V,V,j),Ii($,$,j)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||wa(x.dir,x.dir);this.tessellate(y)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(r);if(a==null)return 0;const[u,d]=a;return vr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(r,a){const u=this.getClosestEdge(r);if(!u)return He(0,0,1);const d=u[0],g=this.edges[d],y=this.edgeProps[d].vec,x=He(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*a),E=He(x[1],-x[0],0);pr(E,E,x);const C=ct(E);return C>0?Vt(E,E,1/C):qe(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let a=0,u=Number.POSITIVE_INFINITY,d=0;const[g,y,x,E,C,R,D]=this._tmpVec2;On(D,r.x,r.y);const j=new tr(D,null);for(let V=0;V<this.edges.length;V++){const $=this.edges[V],Z=this.edgeProps[V].dir;j.dir=Z;const re=this.vertices[$.a].position,te=this.vertices[$.b].position,le=j.intersectsPlane(re,this.vertexProps[$.a].dir,g),ue=j.intersectsPlane(te,this.vertexProps[$.b].dir,y);if(!le||!ue)continue;eo(x,y,g),eo(E,D,g);const fe=Mi(x,x),we=fe>0?Mi(E,x)/fe:0,_e=ne(we,0,1),Ee=Math.abs((we-_e)*this.edgeProps[V].len);eo(C,D,re),On(R,Z[1],-Z[0]);const Me=Ee+Math.abs(Mi(C,R));Me<u&&(a=V,u=Me,d=_e)}return[a,d]}tessellate(r){const a=Qe(),u=Qe(),d=Qe(),g=Qe();for(let y=this.edges.length-1;y>=0;--y){const x=this.edges[y].a,E=this.edges[y].b,{position:C,height:R,extent:D}=this.vertices[x],{position:j,height:V,extent:$}=this.vertices[E],Z=this.vertexProps[x].dir,re=this.vertexProps[E].dir;if(qe(a,C[0]/r,C[1]/r,R),qe(u,j[0]/r,j[1]/r,V),qe(d,Z[1],-Z[0],0),Vt(d,d,D),qe(g,re[1],-re[0],0),Vt(g,g,$),this.distSqLines(He(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]),He(u[0]-.5*g[0],u[1]-.5*g[1],u[2]-.5*g[2]),He(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),He(u[0]+.5*g[0],u[1]+.5*g[1],u[2]+.5*g[2]))<=.0025000000000000005)continue;const te=this.vertices.length,le=Ii(fr(),C,j);this.vertices.push({position:ko(le,le,.5),height:.5*(R+V),extent:.5*(D+$)});const ue=Ii(fr(),Z,re);this.vertexProps.push({dir:wa(ue,ue)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:x,b:te}),this.edges.push({a:te,b:E});const fe=eo(fr(),this.vertices[te].position,C),we=Io(fe),_e={vec:fe,dir:ko(fr(),fe,1/we),len:we};this.edgeProps.push(_e),this.edgeProps.push(_e)}}distSqLines(r,a,u,d){const g=nt(Qe(),a,r),y=nt(Qe(),d,u),x=nt(Qe(),r,u),E=nr(g,g),C=nr(g,y),R=nr(g,x),D=nr(y,y),j=nr(y,x),V=E*D-C*C;if(V===0)return Hn(Nt(g,u,d,nr(x,y)/nr(y,y)),r);const $=(E*j-C*R)/V;return Hn(Nt(g,r,a,(C*j-R*D)/V),Nt(y,u,d,$))}}class An{static parseFrom(r,a){const u=Et.parse(r);if(!u)return[];let{vertices:d,features:g}=u;const y=1/oe(a);g.sort((R,D)=>R.id-D.id),d.sort((R,D)=>R.id-D.id||R.idx-D.idx),d=d.filter((R,D,j)=>D===j.findIndex(V=>V.id===R.id&&V.idx===R.idx));const x=new Array;let E=0;const C=d.length;for(const R of g){if(R.constantHeight){x.push(new Mr(R.id,R.bounds,R.constantHeight));continue}for(;E!==C&&d[E].id<R.id;)E++;if(E===C||d[E].id!==R.id)continue;const D=new Array,j=new Array,V=E;for(;E!==C&&d[E].id===R.id;){const $=d[E];if(D.push({position:$.position,height:$.height,extent:$.extent}),E!==V&&d[E-1].idx===$.idx-1){const Z=E-V;j.push({a:Z-1,b:Z})}E++}x.push(new Mr(R.id,R.bounds,void 0,D,j,y))}return x}static getElevationFeature(r,a){if(!a)return;const u=+r.properties[ot];return Number.isNaN(u)?void 0:a.find(d=>d.id===u)}}class Bn{constructor(r,a){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(a)||(this.zScale=Math.pow(2,a.z-r.z),this.xOffset=(r.x*this.zScale-a.x)*Mt,this.yOffset=(r.y*this.zScale-a.y)*Mt)}constantElevation(r,a){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,a)}pointElevation(r,a,u){const d=this.constantElevation(a,u);return d??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(r),u))}computeBiasedHeight(r,a){return a<=0?r:r+a*ce(0,a,r>=0?r:Math.abs(.5*r))}}Yt(Mr,"ElevationFeature");class kn{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Cc,this.indexArray=new to,this.segments=new gi,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ol),this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,d){}populate(r,a,u,d){const g=this.layers[0],y=[];let x=null;g.type==="circle"&&(x=g.layout.get("circle-sort-key"));for(const{feature:C,id:R,index:D,sourceLayerIndex:j}of r){const V=this.layers[0]._featureFilter.needGeometry,$=Le(C,V);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),$,u))continue;const Z=x?x.evaluate($,{},u):void 0,re={id:R,properties:C.properties,type:C.type,sourceLayerIndex:j,index:D,geometry:V?$.geometry:Ce(C,u,d),patterns:{},sortKey:Z};y.push(re)}x&&y.sort((C,R)=>C.sortKey-R.sortKey);let E=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new Gp,E=d.projection);for(const C of y){const{geometry:R,index:D,sourceLayerIndex:j}=C,V=r[D].feature;this.addFeature(C,R,D,a.availableImages,u,E,a.brightness,a.elevationFeatures),a.featureIndex.insert(V,R,D,j,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,a,u,d,g,y,x){this.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,sb.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,ab.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,p2.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,a,u,d,g,y,x,E){let C;this.elevationMode!=="none"&&(C=An.getElevationFeature(r,E));for(const R of a)for(const D of R){const j=D.x,V=D.y;if(j<0||j>=Mt||V<0||V>=Mt)continue;if(y){const re=y.projectTilePoint(j,V,g),te=y.upVector(g,j,V);this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),Z=$.vertexLength;if(this.addCircleVertex(j,V,-1,-1),this.addCircleVertex(j,V,1,-1),this.addCircleVertex(j,V,1,1),this.addCircleVertex(j,V,-1,1),this.elevationMode!=="none"){const re=C?C.pointElevation(new mt(j,V)):0;this.hasElevation=this.hasElevation||re!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(re)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},d,g,x,void 0,this.worldview)}addCircleVertex(r,a,u,d){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*a+(d+1)/2)}addGlobeExtVertex(r,a){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function yn(l,r){for(let a=0;a<l.length;a++)if(qn(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(qn(l,r[a]))return!0;return!!hi(l,r)}function Fr(l,r,a){return!!qn(l,r)||!!oi(r,l,a)}function Sn(l,r){if(l.length===1)return yi(r,l[0]);for(let a=0;a<r.length;a++){const u=r[a];for(let d=0;d<u.length;d++)if(qn(l,u[d]))return!0}for(let a=0;a<l.length;a++)if(yi(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(hi(l,r[a]))return!0;return!1}function wi(l,r,a){if(l.length>1){if(hi(l,r))return!0;for(let u=0;u<r.length;u++)if(oi(r[u],l,a))return!0}for(let u=0;u<l.length;u++)if(oi(l[u],r,a))return!0;return!1}function hi(l,r){if(l.length===0||r.length===0)return!1;for(let a=0;a<l.length-1;a++){const u=l[a],d=l[a+1];for(let g=0;g<r.length-1;g++)if(Pn(u,d,r[g],r[g+1]))return!0}return!1}function Pn(l,r,a,u){return zr(l,a,u)!==zr(r,a,u)&&zr(l,r,a)!==zr(l,r,u)}function fn(l,r,a){return(l.x-a.x)*(r.y-a.y)-(l.y-a.y)*(r.x-a.x)}function Br(l,r,a,u){const d=fn(l,r,u),g=fn(l,r,a);if(Math.sign(d)===Math.sign(g))return;const y=fn(a,u,l),x=y+g-d;return Math.sign(y)!==Math.sign(x)?[y/(y-x),g/(g-d)]:void 0}function oi(l,r,a){const u=a*a;if(r.length===1)return l.distSqr(r[0])<u;for(let d=1;d<r.length;d++)if(Di(l,r[d-1],r[d])<u)return!0;return!1}function Di(l,r,a){const u=r.distSqr(a);if(u===0)return l.distSqr(r);const d=((l.x-r.x)*(a.x-r.x)+(l.y-r.y)*(a.y-r.y))/u;return l.distSqr(d<0?r:d>1?a:a.sub(r)._mult(d)._add(r))}function yi(l,r){let a,u,d,g=!1;for(let y=0;y<l.length;y++){a=l[y];for(let x=0,E=a.length-1;x<a.length;E=x++)u=a[x],d=a[E],u.y>r.y!=d.y>r.y&&r.x<(d.x-u.x)*(r.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function qn(l,r){let a=!1;for(let u=0,d=l.length-1;u<l.length;d=u++){const g=l[u],y=l[d];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function _s(l,r,a,u,d){for(const y of l)if(r<=y.x&&a<=y.y&&u>=y.x&&d>=y.y)return!0;const g=[new mt(r,a),new mt(r,d),new mt(u,d),new mt(u,a)];if(l.length>2){for(const y of g)if(qn(l,y))return!0}for(let y=0;y<l.length-1;y++)if(zo(l[y],l[y+1],g))return!0;return!1}function zo(l,r,a){const u=a[0],d=a[2];if(l.x<u.x&&r.x<u.x||l.x>d.x&&r.x>d.x||l.y<u.y&&r.y<u.y||l.y>d.y&&r.y>d.y)return!1;const g=zr(l,r,a[0]);return g!==zr(l,r,a[1])||g!==zr(l,r,a[2])||g!==zr(l,r,a[3])}function no(l,r,a,u,d,g){let y=r.y-l.y,x=l.x-r.x;if(g=g||0){const E=y*y+x*x;if(E===0)return!0;const C=Math.sqrt(E);y/=C,x/=C}return!((a.x-l.x)*y+(a.y-l.y)*x-g<0||(u.x-l.x)*y+(u.y-l.y)*x-g<0||(d.x-l.x)*y+(d.y-l.y)*x-g<0)}function Ho(l,r,a,u,d,g,y){return!(no(l,r,u,d,g,y)||no(r,a,u,d,g,y)||no(a,l,u,d,g,y)||no(u,d,l,r,a,y)||no(d,g,l,r,a,y)||no(g,u,l,r,a,y))}function Wo(l,r,a){const u=r.paint.get(l).value;return u.kind==="constant"?u.value:a.programConfigurations.get(r.id).getMaxValue(l)}function Mo(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Ks(l,r,a,u,d){if(!r[0]&&!r[1])return l;const g=mt.convert(r)._mult(d);a==="viewport"&&g._rotate(-u);const y=[];for(let x=0;x<l.length;x++)y.push(l[x].sub(g));return y}function da(l,r,a,u){const d=mt.convert(l)._mult(u);return r==="viewport"&&d._rotate(-a),d}let Cs,Ci;function Li(l,r,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[l*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}Yt(kn,"CircleBucket",{omit:["layers"]});class Zn{constructor(r,a,u){this.z=r,this.x=a,this.y=u,this.key=_i(0,r,r,a,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const a=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>a&&r.y===this.y>>a}url(r,a){const u=function(g,y,x){var E=Li(256*g,256*(y=Math.pow(2,x)-y-1),x),C=Li(256*(g+1),256*(y+1),x);return E[0]+","+E[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),d=function(g,y,x){let E,C="";for(let R=g;R>0;R--)E=1<<R-1,C+=(y&E?1:0)+(x&E?2:0);return C}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vi{constructor(r,a){this.wrap=r,this.canonical=a,this.key=_i(r,a.z,a.z,a.x,a.y)}}class Ti{constructor(r,a,u,d,g){this.overscaledZ=r,this.wrap=a,this.canonical=new Zn(u,+d,+g),this.key=a===0&&r===u?this.canonical.key:_i(a,r,u,d,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Ti(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ti(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return _i(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return _i(this.wrap*+a,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ti(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new Ti(a,this.wrap,a,u,d),new Ti(a,this.wrap,a,u+1,d),new Ti(a,this.wrap,a,u,d+1),new Ti(a,this.wrap,a,u+1,d+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ti(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ti(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _i(l,r,a,u,d){const g=1<<Math.min(a,22);let y=g*(d%g)+u%g;return l&&a<22&&(y+=g*g*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*y+a)+(r-a)}const fa=[l=>{let r=l.canonical.x-1,a=l.wrap;return r<0&&(r=(1<<l.canonical.z)-1,a--),new Ti(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>{let r=l.canonical.x+1,a=l.wrap;return r===1<<l.canonical.z&&(r=0,a++),new Ti(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>new Ti(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new Ti(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Yt(Zn,"CanonicalTileID"),Yt(Ti,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Hd=Xr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ra}=Hd,Wd=Xr([{name:"a_pos_3",components:3,type:"Int16"}]);var wh=Xr([{name:"a_pos",type:"Int16",components:2}]);function tl(l){return l*Go/f}const Ll=[new rr([ua,ua,ua],[ha,ha,ha]),new rr([ua,ua,ua],[0,0,ha]),new rr([0,ua,ua],[ha,0,ha]),new rr([ua,0,ua],[0,ha,ha]),new rr([0,0,ua],[ha,ha,ha])];function Th(l,r,a,u=!0){const d=Vt([],l._camera.position,l.worldSize),g=[r,a,1,1];Hi(g,g,l.pixelMatrixInverse),bo(g,g,1/g[3]);const y=Lt([],Kn([],g,d)),x=l.globeMatrix,E=[x[12],x[13],x[14]],C=Kn([],E,d),R=ct(C),D=Lt([],C),j=l.worldSize/(2*Math.PI),V=nr(D,y),$=Math.asin(j/R);if($<Math.acos(V)){if(!u)return null;const rt=[],Ne=[];Vt(rt,y,R/V),Lt(Ne,Kn(Ne,rt,C)),Lt(y,ut(y,C,Vt(y,Ne,Math.tan($)*R)))}const Z=[];new Jt(d,y).closestPointOnSphere(E,j,Z);const re=Lt([],Oi(x,0)),te=Lt([],Oi(x,1)),le=Lt([],Oi(x,2)),ue=nr(re,Z),fe=nr(te,Z),we=nr(le,Z),_e=Jo(Math.asin(-fe/j));let Ee=Jo(Math.atan2(ue,we));Ee=l.center.lng+function(rt,Ne){const at=(Ne-rt+180)%360-180;return at<-180?at+360:at}(l.center.lng,Ee);const Me=P(Ee),De=ne(O(_e),0,1);return new he(Me,De)}class Rc{constructor(r,a,u){this.a=Kn([],r,u),this.b=Kn([],a,u),this.center=u;const d=Lt([],this.a),g=Lt([],this.b);this.angle=Math.acos(nr(d,g))}}function Nl(l,r){if(l.angle===0)return null;let a;return a=l.a[r]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[r]/l.a[r]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:function(u,d,g,y){const x=Math.sin(g);return u*(Math.sin((1-y)*g)/x)+d*(Math.sin(y*g)/x)}(l.a[r],l.b[r],l.angle,ne(a,0,1))+l.center[r]}function Da(l){if(l.z<=1)return Ll[l.z+2*l.y+l.x];const r=E2(lb(l));return rr.fromPoints(r)}function zl(l,r,a){return Vt(l,l,1-a),xr(l,l,r,a)}function gR(l,r,a){for(const u of l)Nr(u,u,r),Vt(u,u,a)}function yR(l,r,a,u){const d=r/l.worldSize,g=l.globeMatrix;if(a.z<=1){const De=Da(a).getCorners();return gR(De,g,d),rr.fromPoints(De)}const y=lb(a,u),x=E2(y,Go+tl(l._tileCoverLift));gR(x,g,d);const E=Number.MAX_VALUE,C=[-E,-E,-E],R=[E,E,E];if(y.contains(l.center)){for(const Ne of x)cr(R,R,Ne),Bt(C,C,Ne);C[2]=0;const De=l.point,rt=[De.x*d,De.y*d,0];return cr(R,R,rt),Bt(C,C,rt),new rr(R,C)}if(l._tileCoverLift>0){for(const De of x)cr(R,R,De),Bt(C,C,De);return new rr(R,C)}const D=[g[12]*d,g[13]*d,g[14]*d],j=y.getCenter(),V=ne(l.center.lat,-q,q),$=ne(j.lat,-q,q),Z=P(l.center.lng),re=O(V);let te=Z-P(j.lng);const le=re-O($);te>.5?te-=1:te<-.5&&(te+=1);let ue=0;Math.abs(te)>Math.abs(le)?ue=te>=0?1:3:(ue=le>=0?0:2,xr(D,D,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(qr(le>=0?y.getSouth():y.getNorth()))*Go));const fe=x[ue],we=x[(ue+1)%4],_e=new Rc(fe,we,D),Ee=[Nl(_e,0)||fe[0],Nl(_e,1)||fe[1],Nl(_e,2)||fe[2]],Me=Sh(l.zoom);if(Me>0){const De=function({x:Ne,y:at,z:ft},pt,xt,wt,yt){const _t=1/(1<<ft);let st=Ne*_t,it=st+_t,vt=at*_t,Ot=vt+_t,At=0;const or=(st+it)/2-wt;return or>.5?At=-1:or<-.5&&(At=1),st=((st+At)*pt-(wt*=pt))*xt+wt,it=((it+At)*pt-wt)*xt+wt,vt=(vt*pt-(yt*=pt))*xt+yt,Ot=(Ot*pt-yt)*xt+yt,[[st,Ot,0],[it,Ot,0],[it,vt,0],[st,vt,0]]}(a,r,l._pixelsPerMercatorPixel,Z,re);for(let Ne=0;Ne<x.length;Ne++)zl(x[Ne],De[Ne],Me);const rt=ut([],De[ue],De[(ue+1)%4]);Vt(rt,rt,.5),zl(Ee,rt,Me)}for(const De of x)cr(R,R,De),Bt(C,C,De);return R[2]=Math.min(fe[2],we[2]),cr(R,R,Ee),Bt(C,C,Ee),new rr(R,C)}function lb({x:l,y:r,z:a},u=!1){const d=1/(1<<a),g=new c(N(l*d),r===(1<<a)-1&&u?-90:W((r+1)*d)),y=new c(N((l+1)*d),r===0&&u?90:W(r*d));return new p(g,y)}function E2(l,r=Go){const a=qr(l.getNorth()),u=qr(l.getSouth()),d=Math.cos(a),g=Math.cos(u),y=Math.sin(a),x=Math.sin(u),E=l.getWest(),C=l.getEast();return[bu(g,x,E,r),bu(g,x,C,r),bu(d,y,C,r),bu(d,y,E,r)]}function m_(l,r,a,u){const d=1<<a.z,g=(l/Mt+a.x)/d;return bh(W((r/Mt+a.y)/d),N(g),u)}function cb({min:l,max:r}){return S2/Math.max(r[0]-l[0],r[1]-l[1],r[2]-l[2])}const _R=new Float64Array(16);function ub(l){const r=cb(l),a=Pe(_R,[r,r,r]);return X(a,a,an([],l.min))}function A2(l){const r=(u=l.min,(a=_R)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const d=1/cb(l);return ie(r,r,[d,d,d])}function P2(l){const r=Mt/(2*Math.PI);return l/(2*Math.PI)/r}function vR(l,r){return Mt/(512*Math.pow(2,l))*cb(Da(r))}function xR(l,r,a,u,d){const g=P2(a),y=[l,r,-a/(2*Math.PI)],x=U(new Float64Array(16));return X(x,x,y),ie(x,x,[g,g,g]),Q(x,x,qr(-d)),ae(x,x,qr(-u)),x}function Sh(l){return ce(ca,am,l)}function bR(l,r){const a=bh(r.lat,r.lng),u=function($){const Z=bh($._center.lat,$._center.lng);let re=pr([],He(0,1,0),Z);const te=Fe([],-$.angle,Z);re=Nr(re,re,te),Fe(te,-$._pitch,re);const le=Lt([],Z);return Vt(le,le,tl($.cameraToCenterDistance/$.pixelsPerMeter)),Nr(le,le,te),ut([],Z,le)}(l);return y=(d=nt([],u,a))[0],x=d[1],E=d[2],C=(g=a)[0],R=g[1],D=g[2],V=(j=Math.sqrt((y*y+x*x+E*E)*(C*C+R*R+D*D)))&&nr(d,g)/j,Math.acos(Math.min(Math.max(V,-1),1));var d,g,y,x,E,C,R,D,j,V}function C2(l,r){return bR(l,r)>Math.PI/2*1.01}const wR=qr(85),i9=Math.cos(wR),o9=Math.sin(wR),s9=G(),TR=l=>{const r=[];return l.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function SR(l,r,a,u,d,g,y,x,E){if(g&&l.queryGeometry.isAboveHorizon)return!1;g&&(E*=l.pixelToTileUnitsFactor);const C=l.tileID.canonical,R=a.projection.upVectorScale(C,a.center.lat,a.worldSize).metersToTile;for(const D of r)for(const j of D){const V=j.add(x),$=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(V.x,V.y,!0):0,Z=a.projection.projectTilePoint(V.x,V.y,C);if($>0){const ue=a.projection.upVector(C,V.x,V.y);Z.x+=ue[0]*R*$,Z.y+=ue[1]*R*$,Z.z+=ue[2]*R*$}const re=g?V:a9(Z.x,Z.y,Z.z,u),te=g?l.tilespaceRays.map(ue=>c9(ue,$)):l.queryGeometry.screenGeometry,le=Hi([],[Z.x,Z.y,Z.z,1],u);if(!y&&g?E*=le[3]/a.cameraToCenterDistance:y&&!g&&(E*=a.cameraToCenterDistance/le[3]),g){const ue=W((j.y/Mt+C.y)/(1<<C.z));E/=a.projection.pixelsPerMeter(ue,1)/k(1,ue)}if(Fr(te,re,E))return!0}return!1}function a9(l,r,a,u){const d=Hi([],[l,r,a,1],u);return new mt(d[0]/d[3],d[1]/d[3])}const ER=He(0,0,0),l9=He(0,0,1);function c9(l,r){const a=Qe();return ER[2]=r,l.intersectsPlane(ER,l9,a),new mt(a[0],a[1])}class AR extends kn{}let PR,CR,IR,MR;function OR(l,{width:r,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==r*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(r*a*u);return l.width=r,l.height=a,l.data=d,l}function RR(l,r,a){const{width:u,height:d}=r;u===l.width&&d===l.height||(I2(l,r,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,d)},a,null),l.width=u,l.height=d,l.data=r.data)}function I2(l,r,a,u,d,g,y,x){if(d.width===0||d.height===0)return r;if(d.width>l.width||d.height>l.height||a.x>l.width-d.width||a.y>l.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>r.width||d.height>r.height||u.x>r.width-d.width||u.y>r.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const E=l.data,C=r.data,R=g===4&&x;for(let D=0;D<d.height;D++){const j=((a.y+D)*l.width+a.x)*g,V=((u.y+D)*r.width+u.x)*g;if(R)for(let $=0;$<d.width;$++){const Z=j+$*g+3,re=V+$*g;C[re+0]=255,C[re+1]=255,C[re+2]=255,C[re+3]=E[Z]}else if(y)for(let $=0;$<d.width;$++){const Z=j+$*g,re=V+$*g,te=new Dn(E[Z+0]/255,E[Z+1]/255,E[Z+2]/255,E[Z+3]).toNonPremultipliedRenderColor(y).toArray();C[re+0]=te[0],C[re+1]=te[1],C[re+2]=te[2],C[re+3]=te[3]}else for(let $=0;$<d.width*g;$++)C[V+$]=E[j+$]}return r}Yt(AR,"HeatmapBucket",{omit:["layers"]});class Eh{constructor(r,a){OR(this,r,1,a)}resize(r){RR(this,new Eh(r),1)}clone(){return new Eh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,d,g){I2(r,a,u,d,g,1,null)}}class qo{constructor(r,a){OR(this,r,4,a)}resize(r){RR(this,new qo(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,d,g,y,x){I2(r,a,u,d,g,4,y,x)}}class DR{constructor(r,a){this.width=r.width,this.height=r.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function g_(l){const r={},a=l.resolution||256,u=l.clips?l.clips.length:1,d=l.image||new qo({width:a,height:u}),g=(y,x,E)=>{r[l.evaluationKey]=E;const C=l.expression.evaluate(r),R=C?C.toNonPremultipliedRenderColor(null):null;R&&(d.data[y+x+0]=Math.floor(255*R.r),d.data[y+x+1]=Math.floor(255*R.g),d.data[y+x+2]=Math.floor(255*R.b),d.data[y+x+3]=Math.floor(255*R.a))};if(l.clips)for(let y=0,x=0;y<u;++y,x+=4*a)for(let E=0,C=0;E<a;E++,C+=4){const R=E/(a-1),{start:D,end:j}=l.clips[y];g(x,C,D*(1-R)+j*R)}else for(let y=0,x=0;y<a;y++,x+=4)g(0,x,y/(a-1));return d}Yt(Eh,"AlphaImage"),Yt(qo,"RGBAImage");const u9=Xr([{name:"a_pos",components:2,type:"Int16"}],4),h9=Xr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),d9=Xr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),f9=Xr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function lm(l,r,a=2){const u=r&&r.length,d=u?r[0]*a:l.length;let g=kR(l,0,d,a,!0);const y=[];if(!g||g.next===g.prev)return y;let x,E,C;if(u&&(g=function(R,D,j,V){const $=[];for(let Z=0,re=D.length;Z<re;Z++){const te=kR(R,D[Z]*V,Z<re-1?D[Z+1]*V:R.length,V,!1);te===te.next&&(te.steiner=!0),$.push(b9(te))}$.sort(_9);for(let Z=0;Z<$.length;Z++)j=v9($[Z],j);return j}(l,r,g,a)),l.length>80*a){x=l[0],E=l[1];let R=x,D=E;for(let j=a;j<d;j+=a){const V=l[j],$=l[j+1];V<x&&(x=V),$<E&&(E=$),V>R&&(R=V),$>D&&(D=$)}C=Math.max(R-x,D-E),C=C!==0?32767/C:0}return y_(g,y,a,x,E,C,0),y}function kR(l,r,a,u,d){let g;if(d===function(y,x,E,C){let R=0;for(let D=x,j=E-C;D<E;D+=C)R+=(y[j]-y[D])*(y[D+1]+y[j+1]),j=D;return R}(l,r,a,u)>0)for(let y=r;y<a;y+=u)g=zR(y/u|0,l[y],l[y+1],g);else for(let y=a-u;y>=r;y-=u)g=zR(y/u|0,l[y],l[y+1],g);return g&&cm(g,g.next)&&(x_(g),g=g.next),g}function qd(l,r){if(!l)return l;r||(r=l);let a,u=l;do if(a=!1,u.steiner||!cm(u,u.next)&&Eo(u.prev,u,u.next)!==0)u=u.next;else{if(x_(u),u=r=u.prev,u===u.next)break;a=!0}while(a||u!==r);return r}function y_(l,r,a,u,d,g,y){if(!l)return;!y&&g&&function(E,C,R,D){let j=E;do j.z===0&&(j.z=M2(j.x,j.y,C,R,D)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==E);j.prevZ.nextZ=null,j.prevZ=null,function(V){let $,Z=1;do{let re,te=V;V=null;let le=null;for($=0;te;){$++;let ue=te,fe=0;for(let _e=0;_e<Z&&(fe++,ue=ue.nextZ,ue);_e++);let we=Z;for(;fe>0||we>0&&ue;)fe!==0&&(we===0||!ue||te.z<=ue.z)?(re=te,te=te.nextZ,fe--):(re=ue,ue=ue.nextZ,we--),le?le.nextZ=re:V=re,re.prevZ=le,le=re;te=ue}le.nextZ=null,Z*=2}while($>1)}(j)}(l,u,d,g);let x=l;for(;l.prev!==l.next;){const E=l.prev,C=l.next;if(g?m9(l,u,d,g):p9(l))r.push(E.i,l.i,C.i),x_(l),l=C.next,x=C.next;else if((l=C)===x){y?y===1?y_(l=g9(qd(l),r),r,a,u,d,g,2):y===2&&y9(l,r,a,u,d,g):y_(qd(l),r,a,u,d,g,1);break}}}function p9(l){const r=l.prev,a=l,u=l.next;if(Eo(r,a,u)>=0)return!1;const d=r.x,g=a.x,y=u.x,x=r.y,E=a.y,C=u.y,R=Math.min(d,g,y),D=Math.min(x,E,C),j=Math.max(d,g,y),V=Math.max(x,E,C);let $=u.next;for(;$!==r;){if($.x>=R&&$.x<=j&&$.y>=D&&$.y<=V&&__(d,x,g,E,y,C,$.x,$.y)&&Eo($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function m9(l,r,a,u){const d=l.prev,g=l,y=l.next;if(Eo(d,g,y)>=0)return!1;const x=d.x,E=g.x,C=y.x,R=d.y,D=g.y,j=y.y,V=Math.min(x,E,C),$=Math.min(R,D,j),Z=Math.max(x,E,C),re=Math.max(R,D,j),te=M2(V,$,r,a,u),le=M2(Z,re,r,a,u);let ue=l.prevZ,fe=l.nextZ;for(;ue&&ue.z>=te&&fe&&fe.z<=le;){if(ue.x>=V&&ue.x<=Z&&ue.y>=$&&ue.y<=re&&ue!==d&&ue!==y&&__(x,R,E,D,C,j,ue.x,ue.y)&&Eo(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,fe.x>=V&&fe.x<=Z&&fe.y>=$&&fe.y<=re&&fe!==d&&fe!==y&&__(x,R,E,D,C,j,fe.x,fe.y)&&Eo(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ue&&ue.z>=te;){if(ue.x>=V&&ue.x<=Z&&ue.y>=$&&ue.y<=re&&ue!==d&&ue!==y&&__(x,R,E,D,C,j,ue.x,ue.y)&&Eo(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;fe&&fe.z<=le;){if(fe.x>=V&&fe.x<=Z&&fe.y>=$&&fe.y<=re&&fe!==d&&fe!==y&&__(x,R,E,D,C,j,fe.x,fe.y)&&Eo(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function g9(l,r){let a=l;do{const u=a.prev,d=a.next.next;!cm(u,d)&&LR(u,a,a.next,d)&&v_(u,d)&&v_(d,u)&&(r.push(u.i,a.i,d.i),x_(a),x_(a.next),a=l=d),a=a.next}while(a!==l);return qd(a)}function y9(l,r,a,u,d,g){let y=l;do{let x=y.next.next;for(;x!==y.prev;){if(y.i!==x.i&&w9(y,x)){let E=NR(y,x);return y=qd(y,y.next),E=qd(E,E.next),y_(y,r,a,u,d,g,0),void y_(E,r,a,u,d,g,0)}x=x.next}y=y.next}while(y!==l)}function _9(l,r){let a=l.x-r.x;return a===0&&(a=l.y-r.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),a}function v9(l,r){const a=function(d,g){let y=g;const x=d.x,E=d.y;let C,R=-1/0;if(cm(d,y))return y;do{if(cm(d,y.next))return y.next;if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){const Z=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(Z<=x&&Z>R&&(R=Z,C=y.x<y.next.x?y:y.next,Z===x))return C}y=y.next}while(y!==g);if(!C)return null;const D=C,j=C.x,V=C.y;let $=1/0;y=C;do{if(x>=y.x&&y.x>=j&&x!==y.x&&jR(E<V?x:R,E,j,V,E<V?R:x,E,y.x,y.y)){const Z=Math.abs(E-y.y)/(x-y.x);v_(y,d)&&(Z<$||Z===$&&(y.x>C.x||y.x===C.x&&x9(C,y)))&&(C=y,$=Z)}y=y.next}while(y!==D);return C}(l,r);if(!a)return r;const u=NR(a,l);return qd(u,u.next),qd(a,a.next)}function x9(l,r){return Eo(l.prev,l,r.prev)<0&&Eo(r.next,l,l.next)<0}function M2(l,r,a,u,d){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*d|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function b9(l){let r=l,a=l;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==l);return a}function jR(l,r,a,u,d,g,y,x){return(d-y)*(r-x)>=(l-y)*(g-x)&&(l-y)*(u-x)>=(a-y)*(r-x)&&(a-y)*(g-x)>=(d-y)*(u-x)}function __(l,r,a,u,d,g,y,x){return!(l===y&&r===x)&&jR(l,r,a,u,d,g,y,x)}function w9(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!function(a,u){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&LR(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1}(l,r)&&(v_(l,r)&&v_(r,l)&&function(a,u){let d=a,g=!1;const y=(a.x+u.x)/2,x=(a.y+u.y)/2;do d.y>x!=d.next.y>x&&d.next.y!==d.y&&y<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==a);return g}(l,r)&&(Eo(l.prev,l,r.prev)||Eo(l,r.prev,r))||cm(l,r)&&Eo(l.prev,l,l.next)>0&&Eo(r.prev,r,r.next)>0)}function Eo(l,r,a){return(r.y-l.y)*(a.x-r.x)-(r.x-l.x)*(a.y-r.y)}function cm(l,r){return l.x===r.x&&l.y===r.y}function LR(l,r,a,u){const d=db(Eo(l,r,a)),g=db(Eo(l,r,u)),y=db(Eo(a,u,l)),x=db(Eo(a,u,r));return d!==g&&y!==x||!(d!==0||!hb(l,a,r))||!(g!==0||!hb(l,u,r))||!(y!==0||!hb(a,l,u))||!(x!==0||!hb(a,r,u))}function hb(l,r,a){return r.x<=Math.max(l.x,a.x)&&r.x>=Math.min(l.x,a.x)&&r.y<=Math.max(l.y,a.y)&&r.y>=Math.min(l.y,a.y)}function db(l){return l>0?1:l<0?-1:0}function v_(l,r){return Eo(l.prev,l,l.next)<0?Eo(l,r,l.next)>=0&&Eo(l,l.prev,r)>=0:Eo(l,r,l.prev)<0||Eo(l,l.next,r)<0}function NR(l,r){const a=O2(l.i,l.x,l.y),u=O2(r.i,r.x,r.y),d=l.next,g=r.prev;return l.next=r,r.prev=l,a.next=d,d.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function zR(l,r,a,u){const d=O2(l,r,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function x_(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function O2(l,r,a){return{i:l,x:r,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function b_(l,r){const a=l.length;if(a<=1)return[l];const u=[];let d,g;for(let y=0;y<a;y++){const x=jr(l[y]);x!==0&&(l[y].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(d&&u.push(d),d=[l[y]]):d.push(l[y]))}if(d&&u.push(d),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(sp(u[y],r,1,u[y].length-1,T9),u[y]=u[y].slice(0,r));return u}function T9(l,r){return r.area-l.area}function FR(l,r,a=1){if(!l)return null;const u=typeof l=="string"?ps.from(l).getPrimary():l.getPrimary(),d=typeof l=="string"?null:l.getSecondary();for(const g of[u,d]){if(!g)continue;const y=g.id.toString();r.has(y)||r.set(y,[]),g.scaleSelf(a),r.get(y).push(g)}return{primary:u.toString(),secondary:d?d.toString():null}}function R2(l,r,a,u){const d=u.patternDependencies;let g=!1;for(const y of r){const x=y.paint.get(`${l}-pattern`);x.isConstant()||(g=!0),FR(x.constantOr(null),d,a)&&(g=!0)}return g}function D2(l,r,a,u,d,g){const y=g.patternDependencies;for(const x of r){const E=x.paint.get(`${l}-pattern`).value;if(E.kind!=="constant"){let C=E.evaluate({zoom:u},a,{},g.availableImages);C=C&&C.name?C.name:C;const R=FR(C,y,d);if(!R)continue;const{primary:D,secondary:j}=R;D&&(a.patterns[x.id]=[D,j].filter(Boolean))}}return a}class BR{constructor(){this.polygons=new Map}add(r,...a){const u=this.polygons.get(r);u?u.push(...a):this.polygons.set(r,a)}merge(r){for(const[a,u]of r.polygons)this.add(a,...u)}}class wu{constructor(){this.portals=[]}static isOnBorder(r,a){return r<=0&&a<=0||r>=Mt&&a>=Mt}static evaluate(r){if(r.length===0)return new wu;let a=[];for(const E of r)a.push(...E.portals);if(a.length===0)return new wu;for(const E of a){const C=E.va,R=E.vb;(wu.isOnBorder(C.x,R.x)||wu.isOnBorder(C.y,R.y))&&(E.type="border")}const u=a.filter(E=>E.type!=="unevaluated"),d=a.filter(E=>E.type==="unevaluated");if(d.length===0)return new wu;d.sort((E,C)=>E.hash===C.hash?E.isTunnel===C.isTunnel?0:E.isTunnel?-1:1:E.hash<C.hash?1:-1),a=u.concat(d);let g=u.length,y=g,x=g;do if(y++,y===a.length||a[g].hash!==a[y].hash){if(y-g==2){x<g&&(a[x]=a[g],a[g]=null);const E=a[x],C=a[y-1];E.type=E.isTunnel!==C.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:C.connection.a},x++}g=y}while(g!==a.length);return a.splice(x),a.sort((E,C)=>E.hash<C.hash?1:-1),{portals:a}}}Yt(wu,"ElevationPortalGraph"),Yt(BR,"ElevationPolygons");class S9{constructor(r,a,u){this.outPositions=r,this.outNormals=a,this.outIndices=u,this.vertexLookup=new Map}addVertex(r,a,u){let d=r[2];u!=null&&(d*=u);const g=`${r[0]},${r[1]},${r[2]},${a[0]},${a[1]},${a[2]}`,y=this.vertexLookup.get(g);if(y!=null)return y;const x=this.outPositions.length;this.vertexLookup.set(g,x);const E=Math.trunc(16384*a[0]),C=Math.trunc(16384*a[1]),R=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(r[0],r[1],d),this.outNormals.emplaceBack(E,C,R),x}addTriangle(r,a,u){this.outIndices.emplaceBack(r,a,u)}addTriangles(r,a,u){if(r.length===0)return;const d=u.length===1,g=Qe(),y=Qe();for(let x=0;x<r.length;x+=3){const E=a[r[x+0]],C=a[r[x+1]],R=a[r[x+2]],D=d?u[0]:u[r[x+1]],j=d?u[0]:u[r[x+2]];qe(g,E.x,E.y,d?u[0]:u[r[x+0]]);const V=this.addVertex(g,y);qe(g,C.x,C.y,D);const $=this.addVertex(g,y);qe(g,R.x,R.y,j);const Z=this.addVertex(g,y);this.outIndices.emplaceBack(V,$,Z)}}addQuad(r,a,u,d,g,y){const x=this.addVertex(r,g,y),E=this.addVertex(a,g,y),C=this.addVertex(u,g,y),R=this.addVertex(d,g,y);this.addTriangle(x,E,C),this.addTriangle(C,R,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ys{constructor(r,a,u,d){this.unevaluatedPortals=new wu,this.portalPolygons=new BR,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Xy,this.vertexNormals=new Ky,this.indexArray=new to,this.tileToMeters=oe(r),this.bridgeProgramConfigurations=new Oa(a,{zoom:u,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Oa(a,{zoom:u,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(r,a){const u=this.unevalVertices.length;for(let d=0;d<r.length;d++)this.unevalVertices.push(r[d]),this.unevalHeights.push(a[d]);return u}addTriangles(r,a,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of r)d.push(g+a)}addRenderableRing(r,a,u,d,g,y){const x=[new mt(g.min.x,g.min.y),new mt(g.max.x,g.min.y),new mt(g.max.x,g.max.y),new mt(g.min.x,g.max.y)];for(let E=0;E<u-1;E++){const C=a+E,R=C+1,D=this.unevalVertices[C],j=this.unevalVertices[R];if(!(D.x>=g.min.x&&D.x<=g.max.x&&D.y>=g.min.y&&D.y<=g.max.y||j.x>=g.min.x&&j.x<=g.max.x&&j.y>=g.min.y&&j.y<=g.max.y||zo(D,j,x))||this.isOnBorder(D.x,j.x)||this.isOnBorder(D.y,j.y))continue;const V=Ys.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[R]);let $,Z=this.vertexHashLookup.get(Ys.computePosHash(D));Z!=null?$=Z.next:(Z=this.vertexHashLookup.get(Ys.computePosHash(j)),$=Z!=null?Z.prev:V),this.unevalEdges.push({polygonIdx:r,a:C,b:R,hash:V,portalHash:$,isTunnel:d,type:"unevaluated",featureInfo:y})}}addPortalCandidates(r,a,u,d,g){if(a.length===0)return;this.portalPolygons.add(r,{geometry:a,zLevel:g});const y=a[0];this.vertexHashLookup.clear();let x=Ys.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let E=0;E<y.length-1;E++){const C=y[E+0],R=y[E+1],D=Ir(R.x-C.x,R.y-C.y),j=Io(D);if(j===0)continue;let V="unevaluated";const $=d.pointElevation(C),Z=d.pointElevation(R);Math.abs($)<.01&&Math.abs(Z)<.01?V="entrance":(this.isOnBorder(C.x,R.x)||this.isOnBorder(C.y,R.y))&&(V="border");const re=Ys.computeEdgeHash(C,R);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:C,vb:R,vab:D,length:j,hash:re,isTunnel:u,type:V});const te=Ys.computePosHash(C);this.vertexHashLookup.set(te,{prev:x,next:re}),x=re}}construct(r){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=j=>{j.primitiveLength=this.indexArray.length-j.primitiveOffset},d=new S9(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const g=a(),y=a(),x=a(),E=(j,V)=>{j.sort((Z,re)=>Z.type===V&&re.type!==V?-1:Z.type!==V&&re.type===V?1:0);const $=j.findIndex(Z=>Z.type!==V);return $>=0?$:j.length};let C=0;this.unevalEdges.length>0&&(C=E(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),u(x);const R=a(),D=a();if(this.unevalEdges.length>0){const j=this.unevalEdges.splice(C),V=E(j,"tunnel")+C;this.unevalEdges.push(...j),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:V})}u(R),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(D),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=gi.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=gi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=gi.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=gi.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=gi.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(r,a,u,d,g,y,x,E){this.bridgeProgramConfigurations.updatePaintArrays(r,a,g,u,d,y,x,E),this.tunnelProgramConfigurations.updatePaintArrays(r,a,g,u,d,y,x,E)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,d9.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,f9.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,a,u,d,g){const y=(x,E)=>{for(let C=0;C<E.length-1;C++){const R=E[C].featureIndex,D=E[C+1].vertexStart,j=r.feature(R);x.populatePaintArrays(D,j,R,{},u,a,d,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,a,u,d,g){const y=new Map;for(let x=d;x<g;x++){const E=u[x],C=E.a,R=E.b,D=Ys.computePosHash(r[C]),j=Ys.computePosHash(r[R]);let V=y.get(D);V||(V={},y.set(D,V));let $=y.get(j);$||($={},y.set(j,$)),a[C]<=0&&a[R]<=0||(V.to=R,$.from=C)}return y}isTerminalVertex(r,a){const u=Ys.computePosHash(this.unevalVertices[r]),d=a.get(u);return!d||!d.from||!d.to}constructBridgeStructures(r,a,u,d,g,y){r.clearVertexLookup();const x=this.computeVertexConnections(a,u,d,g.min,g.max),E=1/y,C=.5*E,R=(xt,wt)=>qe(xt,a[wt].x,a[wt].y,u[wt]*E),D=Qe(),j=Qe(),V=Qe(),$=Qe(),Z=Qe(),re=(xt,wt)=>{const yt=x.get(Ys.computePosHash(a[wt])),_t=yt.from,st=yt.to;if(!_t||!st)return;R(D,_t),R(j,wt),R(V,st),Un($),zn(D,j)||(Kn(Z,j,D),Lt($,Z)),zn(V,j)||(Kn(Z,V,j),ut($,$,Lt(Z,Z)));const it=ds($);return it>0?Vt(xt,$,1/it):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(xt,wt)=>xt.featureInfo.featureIndex-wt.featureInfo.featureIndex);const le=Qe(),ue=Qe(),fe=Qe(),we=Qe(),_e=Qe(),Ee=Qe(),Me=Qe(),De=Qe(),rt=Qe(),Ne=[Qe(),Qe(),Qe(),Qe()],at=[Qe(),Qe(),Qe(),Qe()],ft=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],pt=(xt,wt)=>xt>wt;for(let xt=g.min;xt<g.max;xt++){const wt=d[xt];if(!wt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ft,a,u,wt,pt))continue;const[yt,_t]=ft;if(qe(le,yt.coord.x,yt.coord.y,E*yt.height),qe(ue,_t.coord.x,_t.coord.y,E*_t.height),zn(le,ue))continue;Kn(fe,ue,le),Lt(fe,fe);const st=re(De,wt.a)||fe,it=re(rt,wt.b)||fe;qe(we,st[1],-st[0],0),Lt(we,we),qe(_e,it[1],-it[0],0),Lt(_e,_e),pr(De,we,st),Lt(Ee,De),pr(De,_e,it),Lt(Me,De),ut(Ne[0],le,Vt(De,Kn(De,we,Ee),C)),ut(Ne[1],le,Vt(De,ut(De,we,Ee),C)),ut(Ne[2],le,Vt(De,Ee,C)),Ne[3]=le,ut(at[0],ue,Vt(De,Kn(De,_e,Me),C)),ut(at[1],ue,Vt(De,ut(De,_e,Me),C)),ut(at[2],ue,Vt(De,Me,C)),at[3]=ue,te=this.addFeatureSection(wt.featureInfo.featureIndex,te,this.bridgeFeatureSections,r);const vt=r.addVertex(Ne[0],we,y),Ot=r.addVertex(Ne[1],we,y),At=r.addVertex(at[0],_e,y),or=r.addVertex(at[1],_e,y);r.addTriangle(vt,Ot,At),r.addTriangle(Ot,or,At);const Ft=r.addVertex(Ne[1],Ee,y),Ht=r.addVertex(Ne[2],Ee,y),Qt=r.addVertex(at[1],Me,y),Gr=r.addVertex(at[2],Me,y);r.addTriangle(Ft,Ht,Qt),r.addTriangle(Ht,Gr,Qt),an(we,we),an(_e,_e);const Pt=r.addVertex(Ne[2],we,y),er=r.addVertex(Ne[3],we,y),Pr=r.addVertex(at[2],_e,y),en=r.addVertex(at[3],_e,y);r.addTriangle(Pt,er,Pr),r.addTriangle(er,en,Pr);const sn=this.isTerminalVertex(wt.a,x),kr=this.isTerminalVertex(wt.b,x);yt.height<.01&&sn&&r.addQuad(Ne[3],Ne[2],Ne[1],Ne[0],an(st,st),y),_t.height<.01&&kr&&r.addQuad(at[0],at[1],at[2],at[3],it,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,a,u,d,g,y){r.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const E=(te,le)=>te.featureInfo.featureIndex-le.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,E),this.sortSubarray(d,y.min,y.max,E);const C=te=>Lt(te,te),R=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],D=(te,le)=>te<le,j=Qe(),V=Qe(),$=Qe(),Z=Qe(),re=Qe();for(let te=g.min;te<g.max;te++){if(!this.prepareEdgePoints(R,a,u,d[te],D))continue;const[le,ue]=R,fe=C(qe(re,-(ue.coord.y-le.coord.y),ue.coord.x-le.coord.x,0));x=this.addFeatureSection(d[te].featureInfo.featureIndex,x,this.tunnelFeatureSections,r),r.addQuad(qe(j,le.coord.x,le.coord.y,le.height),qe(V,ue.coord.x,ue.coord.y,ue.height),qe($,ue.coord.x,ue.coord.y,d[te].isTunnel?-.1:0),qe(Z,le.coord.x,le.coord.y,d[te].isTunnel?-.1:0),fe)}for(let te=y.min;te<y.max;te++){const le=d[te];le.isTunnel&&([le.a,le.b]=[le.b,le.a]);const ue=a[le.a],fe=a[le.b],we=C(qe(re,-(fe.y-ue.y),fe.x-ue.x,0));x=this.addFeatureSection(le.featureInfo.featureIndex,x,this.tunnelFeatureSections,r),r.addQuad(qe(j,fe.x,fe.y,0),qe(V,ue.x,ue.y,0),qe($,ue.x,ue.y,u[le.a]+4),qe(Z,fe.x,fe.y,u[le.b]+4),we),r.addQuad(qe(j,ue.x,ue.y,0),qe(V,fe.x,fe.y,0),qe($,fe.x,fe.y,u[le.b]+4),qe(Z,ue.x,ue.y,u[le.a]+4),we)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,a,u,d){r.coord.x=a,r.coord.y=u,r.height=d}prepareEdgePoints(r,a,u,d,g){let y=a[d.a].x,x=a[d.a].y,E=a[d.b].x,C=a[d.b].y,R=u[d.a],D=u[d.b];const j=g(R,0),V=g(D,0);if(j&&V)return this.setElevatedPoint(r[0],y,x,R),this.setElevatedPoint(r[1],E,C,D),!0;if(!j&&!V)return!1;if(j){if(!V){const $=D/(D-R);E=vr(E,y,$),C=vr(C,x,$),D=vr(D,R,$)}}else{const $=R/(R-D);y=vr(y,E,$),x=vr(x,C,$),R=vr(R,D,$)}return this.setElevatedPoint(r[0],y,x,R),this.setElevatedPoint(r[1],E,C,D),!0}prepareEdges(r,a){if(a.length===0)return;a.sort((x,E)=>x.hash===E.hash?E.polygonIdx-x.polygonIdx:E.hash>x.hash?1:-1);let u=0,d=0,g=0,y=a[u].polygonIdx;do d++,(d===a.length||a[u].hash!==a[d].hash)&&((d-u==1||a[d-1].polygonIdx!==y)&&(g<u&&(a[g]=a[u],a[u]=null),a[g].type="none",g++),u=d,u!==a.length&&(y=a[u].polygonIdx));while(u!==a.length);if(a.splice(g),a.length!==0&&r.length!==0){a.sort((C,R)=>C.portalHash<R.portalHash?1:-1);let x=0,E=0;for(;x!==a.length&&E!==r.length;){const C=a[x],R=r[E];C.portalHash>R.hash?x++:R.hash>C.portalHash?E++:(C.type=R.type,x++)}}}isOnBorder(r,a){return r<=0&&a<=0||r>=Mt&&a>=Mt}addFeatureSection(r,a,u,d){return r!==a&&(a=r,u.push({featureIndex:r,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),a}sortSubarray(r,a,u,d){const g=r.slice(a,u);g.sort(d),r.splice(a,g.length,...g)}static computeEdgeHash(r,a){return(r.y===a.y&&r.x>a.x||r.y>a.y)&&([r,a]=[a,r]),BigInt(Ys.computePosHash(r))<<32n|BigInt(Ys.computePosHash(a))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var VR,$R={exports:{}},UR=(VR||(VR=1,function(l){function r(ve,Te){return ve>Te?1:ve<Te?-1:0}var a=function(ve,Te){ve===void 0&&(ve=r),Te===void 0&&(Te=!1),this._compare=ve,this._root=null,this._size=0,this._noDuplicates=!!Te},u={size:{configurable:!0}};function d(ve,Te,lt,bt,kt){var jt=kt-bt;if(jt>0){var sr=bt+Math.floor(jt/2),ur={key:Te[sr],data:lt[sr],parent:ve};return ur.left=d(ur,Te,lt,bt,sr),ur.right=d(ur,Te,lt,sr+1,kt),ur}return null}function g(ve,Te,lt,bt,kt){if(!(lt>=bt)){for(var jt=ve[lt+bt>>1],sr=lt-1,ur=bt+1;;){do sr++;while(kt(ve[sr],jt)<0);do ur--;while(kt(ve[ur],jt)>0);if(sr>=ur)break;var Rr=ve[sr];ve[sr]=ve[ur],ve[ur]=Rr,Rr=Te[sr],Te[sr]=Te[ur],Te[ur]=Rr}g(ve,Te,lt,ur,kt),g(ve,Te,ur+1,bt,kt)}}a.prototype.rotateLeft=function(ve){var Te=ve.right;Te&&(ve.right=Te.left,Te.left&&(Te.left.parent=ve),Te.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.left=ve),ve.parent=Te},a.prototype.rotateRight=function(ve){var Te=ve.left;Te&&(ve.left=Te.right,Te.right&&(Te.right.parent=ve),Te.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.right=ve),ve.parent=Te},a.prototype._splay=function(ve){for(;ve.parent;){var Te=ve.parent;Te.parent?Te.left===ve&&Te.parent.left===Te?(this.rotateRight(Te.parent),this.rotateRight(Te)):Te.right===ve&&Te.parent.right===Te?(this.rotateLeft(Te.parent),this.rotateLeft(Te)):Te.left===ve&&Te.parent.right===Te?(this.rotateRight(Te),this.rotateLeft(Te)):(this.rotateLeft(Te),this.rotateRight(Te)):Te.left===ve?this.rotateRight(Te):this.rotateLeft(Te)}},a.prototype.splay=function(ve){for(var Te,lt,bt,kt,jt;ve.parent;)(lt=(Te=ve.parent).parent)&&lt.parent?((bt=lt.parent).left===lt?bt.left=ve:bt.right=ve,ve.parent=bt):(ve.parent=null,this._root=ve),kt=ve.left,jt=ve.right,ve===Te.left?(lt&&(lt.left===Te?(Te.right?(lt.left=Te.right,lt.left.parent=lt):lt.left=null,Te.right=lt,lt.parent=Te):(kt?(lt.right=kt,kt.parent=lt):lt.right=null,ve.left=lt,lt.parent=ve)),jt?(Te.left=jt,jt.parent=Te):Te.left=null,ve.right=Te,Te.parent=ve):(lt&&(lt.right===Te?(Te.left?(lt.right=Te.left,lt.right.parent=lt):lt.right=null,Te.left=lt,lt.parent=Te):(jt?(lt.left=jt,jt.parent=lt):lt.left=null,ve.right=lt,lt.parent=ve)),kt?(Te.right=kt,kt.parent=Te):Te.right=null,ve.left=Te,Te.parent=ve)},a.prototype.replace=function(ve,Te){ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.parent=ve.parent)},a.prototype.minNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},a.prototype.maxNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},a.prototype.insert=function(ve,Te){var lt=this._root,bt=null,kt=this._compare;if(this._noDuplicates)for(;lt;){if(bt=lt,kt(lt.key,ve)===0)return;lt=kt(lt.key,ve)<0?lt.right:lt.left}else for(;lt;)bt=lt,lt=kt(lt.key,ve)<0?lt.right:lt.left;return lt={key:ve,data:Te,left:null,right:null,parent:bt},bt?kt(bt.key,lt.key)<0?bt.right=lt:bt.left=lt:this._root=lt,this.splay(lt),this._size++,lt},a.prototype.find=function(ve){for(var Te=this._root,lt=this._compare;Te;){var bt=lt(Te.key,ve);if(bt<0)Te=Te.right;else{if(!(bt>0))return Te;Te=Te.left}}return null},a.prototype.contains=function(ve){for(var Te=this._root,lt=this._compare;Te;){var bt=lt(ve,Te.key);if(bt===0)return!0;Te=bt<0?Te.left:Te.right}return!1},a.prototype.remove=function(ve){var Te=this.find(ve);if(!Te)return!1;if(this.splay(Te),Te.left)if(Te.right){var lt=this.minNode(Te.right);lt.parent!==Te&&(this.replace(lt,lt.right),lt.right=Te.right,lt.right.parent=lt),this.replace(Te,lt),lt.left=Te.left,lt.left.parent=lt}else this.replace(Te,Te.left);else this.replace(Te,Te.right);return this._size--,!0},a.prototype.removeNode=function(ve){if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var Te=this.minNode(ve.right);Te.parent!==ve&&(this.replace(Te,Te.right),Te.right=ve.right,Te.right.parent=Te),this.replace(ve,Te),Te.left=ve.left,Te.left.parent=Te}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},a.prototype.erase=function(ve){var Te=this.find(ve);if(Te){this.splay(Te);var lt=Te.left,bt=Te.right,kt=null;lt&&(lt.parent=null,kt=this.maxNode(lt),this.splay(kt),this._root=kt),bt&&(lt?kt.right=bt:this._root=bt,bt.parent=kt),this._size--}},a.prototype.pop=function(){var ve=this._root,Te=null;if(ve){for(;ve.left;)ve=ve.left;Te={key:ve.key,data:ve.data},this.remove(ve.key)}return Te},a.prototype.next=function(ve){var Te=ve;if(Te)if(Te.right)for(Te=Te.right;Te&&Te.left;)Te=Te.left;else for(Te=ve.parent;Te&&Te.right===ve;)ve=Te,Te=Te.parent;return Te},a.prototype.prev=function(ve){var Te=ve;if(Te)if(Te.left)for(Te=Te.left;Te&&Te.right;)Te=Te.right;else for(Te=ve.parent;Te&&Te.left===ve;)ve=Te,Te=Te.parent;return Te},a.prototype.forEach=function(ve){for(var Te=this._root,lt=[],bt=!1,kt=0;!bt;)Te?(lt.push(Te),Te=Te.left):lt.length>0?(ve(Te=lt.pop(),kt++),Te=Te.right):bt=!0;return this},a.prototype.range=function(ve,Te,lt,bt){for(var kt=[],jt=this._compare,sr=this._root;kt.length!==0||sr;)if(sr)kt.push(sr),sr=sr.left;else{if(jt((sr=kt.pop()).key,Te)>0)break;if(jt(sr.key,ve)>=0&&lt.call(bt,sr))return this;sr=sr.right}return this},a.prototype.keys=function(){for(var ve=this._root,Te=[],lt=[],bt=!1;!bt;)ve?(Te.push(ve),ve=ve.left):Te.length>0?(ve=Te.pop(),lt.push(ve.key),ve=ve.right):bt=!0;return lt},a.prototype.values=function(){for(var ve=this._root,Te=[],lt=[],bt=!1;!bt;)ve?(Te.push(ve),ve=ve.left):Te.length>0?(ve=Te.pop(),lt.push(ve.data),ve=ve.right):bt=!0;return lt},a.prototype.at=function(ve){for(var Te=this._root,lt=[],bt=!1,kt=0;!bt;)if(Te)lt.push(Te),Te=Te.left;else if(lt.length>0){if(Te=lt.pop(),kt===ve)return Te;kt++,Te=Te.right}else bt=!0;return null},a.prototype.load=function(ve,Te,lt){if(ve===void 0&&(ve=[]),Te===void 0&&(Te=[]),lt===void 0&&(lt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bt=ve.length;return lt&&g(ve,Te,0,bt-1,this._compare),this._root=d(null,ve,Te,0,bt),this._size=bt,this},a.prototype.min=function(){var ve=this.minNode(this._root);return ve?ve.key:null},a.prototype.max=function(){var ve=this.maxNode(this._root);return ve?ve.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(ve,Te,lt,bt,kt){return new a(lt,kt).load(ve,Te,bt)},Object.defineProperties(a.prototype,u);var y=0,x=1,E=2,C=3,R=0,D=1,j=2,V=3;function $(ve,Te,lt){Te===null?(ve.inOut=!1,ve.otherInOut=!0):(ve.isSubject===Te.isSubject?(ve.inOut=!Te.inOut,ve.otherInOut=Te.otherInOut):(ve.inOut=!Te.otherInOut,ve.otherInOut=Te.isVertical()?!Te.inOut:Te.inOut),Te&&(ve.prevInResult=!Z(Te,lt)||Te.isVertical()?Te.prevInResult:Te));var bt=Z(ve,lt);ve.resultTransition=bt?function(kt,jt){var sr,ur=!kt.inOut,Rr=!kt.otherInOut;switch(jt){case R:sr=ur&&Rr;break;case D:sr=ur||Rr;break;case V:sr=ur^Rr;break;case j:sr=kt.isSubject?ur&&!Rr:Rr&&!ur}return sr?1:-1}(ve,lt):0}function Z(ve,Te){switch(ve.type){case y:switch(Te){case R:return!ve.otherInOut;case D:return ve.otherInOut;case j:return ve.isSubject&&ve.otherInOut||!ve.isSubject&&!ve.otherInOut;case V:return!0}break;case E:return Te===R||Te===D;case C:return Te===j;case x:return!1}return!1}var re=function(ve,Te,lt,bt,kt){this.left=Te,this.point=ve,this.otherEvent=lt,this.isSubject=bt,this.type=kt||y,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},te={inResult:{configurable:!0}};function le(ve,Te){return ve[0]===Te[0]&&ve[1]===Te[1]}re.prototype.isBelow=function(ve){var Te=this.point,lt=this.otherEvent.point;return this.left?(Te[0]-ve[0])*(lt[1]-ve[1])-(lt[0]-ve[0])*(Te[1]-ve[1])>0:(lt[0]-ve[0])*(Te[1]-ve[1])-(Te[0]-ve[0])*(lt[1]-ve[1])>0},re.prototype.isAbove=function(ve){return!this.isBelow(ve)},re.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},te.inResult.get=function(){return this.resultTransition!==0},re.prototype.clone=function(){var ve=new re(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ve.contourId=this.contourId,ve.resultTransition=this.resultTransition,ve.prevInResult=this.prevInResult,ve.isExteriorRing=this.isExteriorRing,ve.inOut=this.inOut,ve.otherInOut=this.otherInOut,ve},Object.defineProperties(re.prototype,te);var ue=11102230246251565e-32,fe=134217729,we=(3+8*ue)*ue;function _e(ve,Te,lt,bt,kt){var jt,sr,ur,Rr,Vr=Te[0],Ur=bt[0],Kr=0,_r=0;Ur>Vr==Ur>-Vr?(jt=Vr,Vr=Te[++Kr]):(jt=Ur,Ur=bt[++_r]);var Sr=0;if(Kr<ve&&_r<lt)for(Ur>Vr==Ur>-Vr?(ur=jt-((sr=Vr+jt)-Vr),Vr=Te[++Kr]):(ur=jt-((sr=Ur+jt)-Ur),Ur=bt[++_r]),jt=sr,ur!==0&&(kt[Sr++]=ur);Kr<ve&&_r<lt;)Ur>Vr==Ur>-Vr?(ur=jt-((sr=jt+Vr)-(Rr=sr-jt))+(Vr-Rr),Vr=Te[++Kr]):(ur=jt-((sr=jt+Ur)-(Rr=sr-jt))+(Ur-Rr),Ur=bt[++_r]),jt=sr,ur!==0&&(kt[Sr++]=ur);for(;Kr<ve;)ur=jt-((sr=jt+Vr)-(Rr=sr-jt))+(Vr-Rr),Vr=Te[++Kr],jt=sr,ur!==0&&(kt[Sr++]=ur);for(;_r<lt;)ur=jt-((sr=jt+Ur)-(Rr=sr-jt))+(Ur-Rr),Ur=bt[++_r],jt=sr,ur!==0&&(kt[Sr++]=ur);return jt===0&&Sr!==0||(kt[Sr++]=jt),Sr}function Ee(ve){return new Float64Array(ve)}var Me=33306690738754716e-32,De=22204460492503146e-32,rt=11093356479670487e-47,Ne=Ee(4),at=Ee(8),ft=Ee(12),pt=Ee(16),xt=Ee(4);function wt(ve,Te,lt){var bt=function(kt,jt,sr,ur,Rr,Vr){var Ur=(jt-Vr)*(sr-Rr),Kr=(kt-Rr)*(ur-Vr),_r=Ur-Kr;if(Ur===0||Kr===0||Ur>0!=Kr>0)return _r;var Sr=Math.abs(Ur+Kr);return Math.abs(_r)>=Me*Sr?_r:-function(pn,xn,bn,jn,Xn,$n,Tn){var Cn,$r,tn,pi,gr,Yr,Gn,Qn,ni,Ni,ei,yr,vi,Ln,di,io,vo,Zi,Xi=pn-Xn,uo=bn-Xn,Is=xn-$n,ti=jn-$n;Ne[0]=(di=(Qn=Xi-(Gn=(Yr=fe*Xi)-(Yr-Xi)))*(Ni=ti-(ni=(Yr=fe*ti)-(Yr-ti)))-((Ln=Xi*ti)-Gn*ni-Qn*ni-Gn*Ni))-((ei=di-(vo=(Qn=Is-(Gn=(Yr=fe*Is)-(Yr-Is)))*(Ni=uo-(ni=(Yr=fe*uo)-(Yr-uo)))-((io=Is*uo)-Gn*ni-Qn*ni-Gn*Ni)))+(gr=di-ei))+(gr-vo),Ne[1]=(vi=Ln-((yr=Ln+ei)-(gr=yr-Ln))+(ei-gr))-((ei=vi-io)+(gr=vi-ei))+(gr-io),Ne[2]=yr-((Zi=yr+ei)-(gr=Zi-yr))+(ei-gr),Ne[3]=Zi;var ki=function(jc,Fo){for(var vs=Fo[0],Qs=1;Qs<4;Qs++)vs+=Fo[Qs];return vs}(0,Ne),zi=De*Tn;if(ki>=zi||-ki>=zi||(Cn=pn-(Xi+(gr=pn-Xi))+(gr-Xn),tn=bn-(uo+(gr=bn-uo))+(gr-Xn),$r=xn-(Is+(gr=xn-Is))+(gr-$n),pi=jn-(ti+(gr=jn-ti))+(gr-$n),Cn===0&&$r===0&&tn===0&&pi===0)||(zi=rt*Tn+we*Math.abs(ki),(ki+=Xi*pi+ti*Cn-(Is*tn+uo*$r))>=zi||-ki>=zi))return ki;xt[0]=(di=(Qn=Cn-(Gn=(Yr=fe*Cn)-(Yr-Cn)))*(Ni=ti-(ni=(Yr=fe*ti)-(Yr-ti)))-((Ln=Cn*ti)-Gn*ni-Qn*ni-Gn*Ni))-((ei=di-(vo=(Qn=$r-(Gn=(Yr=fe*$r)-(Yr-$r)))*(Ni=uo-(ni=(Yr=fe*uo)-(Yr-uo)))-((io=$r*uo)-Gn*ni-Qn*ni-Gn*Ni)))+(gr=di-ei))+(gr-vo),xt[1]=(vi=Ln-((yr=Ln+ei)-(gr=yr-Ln))+(ei-gr))-((ei=vi-io)+(gr=vi-ei))+(gr-io),xt[2]=yr-((Zi=yr+ei)-(gr=Zi-yr))+(ei-gr),xt[3]=Zi;var zs=_e(4,Ne,4,xt,at);xt[0]=(di=(Qn=Xi-(Gn=(Yr=fe*Xi)-(Yr-Xi)))*(Ni=pi-(ni=(Yr=fe*pi)-(Yr-pi)))-((Ln=Xi*pi)-Gn*ni-Qn*ni-Gn*Ni))-((ei=di-(vo=(Qn=Is-(Gn=(Yr=fe*Is)-(Yr-Is)))*(Ni=tn-(ni=(Yr=fe*tn)-(Yr-tn)))-((io=Is*tn)-Gn*ni-Qn*ni-Gn*Ni)))+(gr=di-ei))+(gr-vo),xt[1]=(vi=Ln-((yr=Ln+ei)-(gr=yr-Ln))+(ei-gr))-((ei=vi-io)+(gr=vi-ei))+(gr-io),xt[2]=yr-((Zi=yr+ei)-(gr=Zi-yr))+(ei-gr),xt[3]=Zi;var oo=_e(zs,at,4,xt,ft);xt[0]=(di=(Qn=Cn-(Gn=(Yr=fe*Cn)-(Yr-Cn)))*(Ni=pi-(ni=(Yr=fe*pi)-(Yr-pi)))-((Ln=Cn*pi)-Gn*ni-Qn*ni-Gn*Ni))-((ei=di-(vo=(Qn=$r-(Gn=(Yr=fe*$r)-(Yr-$r)))*(Ni=tn-(ni=(Yr=fe*tn)-(Yr-tn)))-((io=$r*tn)-Gn*ni-Qn*ni-Gn*Ni)))+(gr=di-ei))+(gr-vo),xt[1]=(vi=Ln-((yr=Ln+ei)-(gr=yr-Ln))+(ei-gr))-((ei=vi-io)+(gr=vi-ei))+(gr-io),xt[2]=yr-((Zi=yr+ei)-(gr=Zi-yr))+(ei-gr),xt[3]=Zi;var nl=_e(oo,ft,4,xt,pt);return pt[nl-1]}(kt,jt,sr,ur,Rr,Vr,Sr)}(ve[0],ve[1],Te[0],Te[1],lt[0],lt[1]);return bt>0?-1:bt<0?1:0}function yt(ve,Te){var lt=ve.point,bt=Te.point;return lt[0]>bt[0]?1:lt[0]<bt[0]?-1:lt[1]!==bt[1]?lt[1]>bt[1]?1:-1:function(kt,jt,sr,ur){return kt.left!==jt.left?kt.left?1:-1:wt(sr,kt.otherEvent.point,jt.otherEvent.point)!==0?kt.isBelow(jt.otherEvent.point)?-1:1:!kt.isSubject&&jt.isSubject?1:-1}(ve,Te,lt)}function _t(ve,Te,lt){var bt=new re(Te,!1,ve,ve.isSubject),kt=new re(Te,!0,ve.otherEvent,ve.isSubject);return le(ve.point,ve.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ve),bt.contourId=kt.contourId=ve.contourId,yt(kt,ve.otherEvent)>0&&(ve.otherEvent.left=!0,kt.left=!1),ve.otherEvent.otherEvent=kt,ve.otherEvent=bt,lt.push(kt),lt.push(bt),lt}function st(ve,Te){return ve[0]*Te[1]-ve[1]*Te[0]}function it(ve,Te){return ve[0]*Te[0]+ve[1]*Te[1]}function vt(ve,Te,lt){var bt=function(Rr,Vr,Ur,Kr,_r){var Sr=[Vr[0]-Rr[0],Vr[1]-Rr[1]],pn=[Kr[0]-Ur[0],Kr[1]-Ur[1]];function xn(Yr,Gn,Qn){return[Yr[0]+Gn*Qn[0],Yr[1]+Gn*Qn[1]]}var bn=[Ur[0]-Rr[0],Ur[1]-Rr[1]],jn=st(Sr,pn),Xn=jn*jn,$n=it(Sr,Sr);if(Xn>0){var Tn=st(bn,pn)/jn;if(Tn<0||Tn>1)return null;var Cn=st(bn,Sr)/jn;return Cn<0||Cn>1?null:Tn===0||Tn===1?[xn(Rr,Tn,Sr)]:Cn===0||Cn===1?[xn(Ur,Cn,pn)]:[xn(Rr,Tn,Sr)]}if((Xn=(jn=st(bn,Sr))*jn)>0)return null;var $r=it(Sr,bn)/$n,tn=$r+it(Sr,pn)/$n,pi=Math.min($r,tn),gr=Math.max($r,tn);return pi<=1&&gr>=0?pi===1?[xn(Rr,pi>0?pi:0,Sr)]:gr===0?[xn(Rr,gr<1?gr:1,Sr)]:[xn(Rr,pi>0?pi:0,Sr),xn(Rr,gr<1?gr:1,Sr)]:null}(ve.point,ve.otherEvent.point,Te.point,Te.otherEvent.point),kt=bt?bt.length:0;if(kt===0||kt===1&&(le(ve.point,Te.point)||le(ve.otherEvent.point,Te.otherEvent.point))||kt===2&&ve.isSubject===Te.isSubject)return 0;if(kt===1)return le(ve.point,bt[0])||le(ve.otherEvent.point,bt[0])||_t(ve,bt[0],lt),le(Te.point,bt[0])||le(Te.otherEvent.point,bt[0])||_t(Te,bt[0],lt),1;var jt=[],sr=!1,ur=!1;return le(ve.point,Te.point)?sr=!0:yt(ve,Te)===1?jt.push(Te,ve):jt.push(ve,Te),le(ve.otherEvent.point,Te.otherEvent.point)?ur=!0:yt(ve.otherEvent,Te.otherEvent)===1?jt.push(Te.otherEvent,ve.otherEvent):jt.push(ve.otherEvent,Te.otherEvent),sr&&ur||sr?(Te.type=x,ve.type=Te.inOut===ve.inOut?E:C,sr&&!ur&&_t(jt[1].otherEvent,jt[0].point,lt),2):ur?(_t(jt[0],jt[1].point,lt),3):jt[0]!==jt[3].otherEvent?(_t(jt[0],jt[1].point,lt),_t(jt[1],jt[2].point,lt),3):(_t(jt[0],jt[1].point,lt),_t(jt[3].otherEvent,jt[2].point,lt),3)}function Ot(ve,Te){if(ve===Te)return 0;if(wt(ve.point,ve.otherEvent.point,Te.point)!==0||wt(ve.point,ve.otherEvent.point,Te.otherEvent.point)!==0)return le(ve.point,Te.point)?ve.isBelow(Te.otherEvent.point)?-1:1:ve.point[0]===Te.point[0]?ve.point[1]<Te.point[1]?-1:1:yt(ve,Te)===1?Te.isAbove(ve.point)?-1:1:ve.isBelow(Te.point)?-1:1;if(ve.isSubject!==Te.isSubject)return ve.isSubject?-1:1;var lt=ve.point,bt=Te.point;return lt[0]===bt[0]&&lt[1]===bt[1]?(lt=ve.otherEvent.point)[0]===(bt=Te.otherEvent.point)[0]&&lt[1]===bt[1]?0:ve.contourId>Te.contourId?1:-1:yt(ve,Te)===1?1:-1}var At=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function or(ve,Te,lt,bt){var kt,jt=ve+1,sr=Te[ve].point,ur=Te.length;for(jt<ur&&(kt=Te[jt].point);jt<ur&&kt[0]===sr[0]&&kt[1]===sr[1];){if(!lt[jt])return jt;++jt<ur&&(kt=Te[jt].point)}for(jt=ve-1;lt[jt]&&jt>bt;)jt--;return jt}At.prototype.isExterior=function(){return this.holeOf==null};var Ft=Qt,Ht=Qt;function Qt(ve,Te){if(!(this instanceof Qt))return new Qt(ve,Te);if(this.data=ve||[],this.length=this.data.length,this.compare=Te||Gr,this.length>0)for(var lt=(this.length>>1)-1;lt>=0;lt--)this._down(lt)}function Gr(ve,Te){return ve<Te?-1:ve>Te?1:0}Qt.prototype={push:function(ve){this.data.push(ve),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ve=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ve}},peek:function(){return this.data[0]},_up:function(ve){for(var Te=this.data,lt=this.compare,bt=Te[ve];ve>0;){var kt=ve-1>>1,jt=Te[kt];if(lt(bt,jt)>=0)break;Te[ve]=jt,ve=kt}Te[ve]=bt},_down:function(ve){for(var Te=this.data,lt=this.compare,bt=this.length>>1,kt=Te[ve];ve<bt;){var jt=1+(ve<<1),sr=jt+1,ur=Te[jt];if(sr<this.length&&lt(Te[sr],ur)<0&&(jt=sr,ur=Te[sr]),lt(ur,kt)>=0)break;Te[ve]=ur,ve=jt}Te[ve]=kt}},Ft.default=Ht;var Pt=Math.max,er=Math.min,Pr=0;function en(ve,Te,lt,bt,kt,jt){var sr,ur,Rr,Vr,Ur,Kr;for(sr=0,ur=ve.length-1;sr<ur;sr++)if(Vr=ve[sr+1],Ur=new re(Rr=ve[sr],!1,void 0,Te),Kr=new re(Vr,!1,Ur,Te),Ur.otherEvent=Kr,Rr[0]!==Vr[0]||Rr[1]!==Vr[1]){Ur.contourId=Kr.contourId=lt,jt||(Ur.isExteriorRing=!1,Kr.isExteriorRing=!1),yt(Ur,Kr)>0?Kr.left=!0:Ur.left=!0;var _r=Rr[0],Sr=Rr[1];kt[0]=er(kt[0],_r),kt[1]=er(kt[1],Sr),kt[2]=Pt(kt[2],_r),kt[3]=Pt(kt[3],Sr),bt.push(Ur),bt.push(Kr)}}var sn=[];function kr(ve,Te,lt){typeof ve[0][0][0]=="number"&&(ve=[ve]),typeof Te[0][0][0]=="number"&&(Te=[Te]);var bt=function(Sr,pn,xn){var bn=null;return Sr.length*pn.length==0&&(xn===R?bn=sn:xn===j?bn=Sr:xn!==D&&xn!==V||(bn=Sr.length===0?pn:Sr)),bn}(ve,Te,lt);if(bt)return bt===sn?null:bt;var kt=[1/0,1/0,-1/0,-1/0],jt=[1/0,1/0,-1/0,-1/0],sr=function(Sr,pn,xn,bn,jn){var Xn,$n,Tn,Cn,$r,tn,pi=new Ft(null,yt);for(Tn=0,Cn=Sr.length;Tn<Cn;Tn++)for($r=0,tn=(Xn=Sr[Tn]).length;$r<tn;$r++)($n=$r===0)&&Pr++,en(Xn[$r],!0,Pr,pi,xn,$n);for(Tn=0,Cn=pn.length;Tn<Cn;Tn++)for($r=0,tn=(Xn=pn[Tn]).length;$r<tn;$r++)$n=$r===0,jn===j&&($n=!1),$n&&Pr++,en(Xn[$r],!1,Pr,pi,bn,$n);return pi}(ve,Te,kt,jt,lt);if(bt=function(Sr,pn,xn,bn,jn){var Xn=null;return(xn[0]>bn[2]||bn[0]>xn[2]||xn[1]>bn[3]||bn[1]>xn[3])&&(jn===R?Xn=sn:jn===j?Xn=Sr:jn!==D&&jn!==V||(Xn=Sr.concat(pn))),Xn}(ve,Te,kt,jt,lt))return bt===sn?null:bt;for(var ur=function(Sr){var pn,xn,bn=function(Tn){var Cn,$r,tn,pi,gr=[];for($r=0,tn=Tn.length;$r<tn;$r++)((Cn=Tn[$r]).left&&Cn.inResult||!Cn.left&&Cn.otherEvent.inResult)&&gr.push(Cn);for(var Yr=!1;!Yr;)for(Yr=!0,$r=0,tn=gr.length;$r<tn;$r++)$r+1<tn&&yt(gr[$r],gr[$r+1])===1&&(pi=gr[$r],gr[$r]=gr[$r+1],gr[$r+1]=pi,Yr=!1);for($r=0,tn=gr.length;$r<tn;$r++)(Cn=gr[$r]).otherPos=$r;for($r=0,tn=gr.length;$r<tn;$r++)(Cn=gr[$r]).left||(pi=Cn.otherPos,Cn.otherPos=Cn.otherEvent.otherPos,Cn.otherEvent.otherPos=pi);return gr}(Sr),jn={},Xn=[],$n=function(){if(!jn[pn]){var Tn=Xn.length,Cn=function(gr,Yr,Gn){var Qn=new At;if(gr.prevInResult!=null){var ni=gr.prevInResult,Ni=ni.outputContourId;if(ni.resultTransition>0){var ei=Yr[Ni];if(ei.holeOf!=null){var yr=ei.holeOf;Yr[yr].holeIds.push(Gn),Qn.holeOf=yr,Qn.depth=Yr[Ni].depth}else Yr[Ni].holeIds.push(Gn),Qn.holeOf=Ni,Qn.depth=Yr[Ni].depth+1}else Qn.holeOf=null,Qn.depth=Yr[Ni].depth}else Qn.holeOf=null,Qn.depth=0;return Qn}(bn[pn],Xn,Tn),$r=function(gr){jn[gr]=!0,gr<bn.length&&bn[gr]&&(bn[gr].outputContourId=Tn)},tn=pn,pi=pn;for(Cn.points.push(bn[pn].point);$r(tn),$r(tn=bn[tn].otherPos),Cn.points.push(bn[tn].point),!((tn=or(tn,bn,jn,pi))==pi||tn>=bn.length)&&bn[tn];);Xn.push(Cn)}};for(pn=0,xn=bn.length;pn<xn;pn++)$n();return Xn}(function(Sr,pn,xn,bn,jn,Xn){for(var $n,Tn,Cn,$r=new a(Ot),tn=[],pi=Math.min(bn[2],jn[2]);Sr.length!==0;){var gr=Sr.pop();if(tn.push(gr),Xn===R&&gr.point[0]>pi||Xn===j&&gr.point[0]>bn[2])break;if(gr.left){Tn=$n=$r.insert(gr),$n=$n!==(Cn=$r.minNode())?$r.prev($n):null,Tn=$r.next(Tn);var Yr=$n?$n.key:null;if($(gr,Yr,Xn),Tn&&vt(gr,Tn.key,Sr)===2&&($(gr,Yr,Xn),$(Tn.key,gr,Xn)),$n&&vt($n.key,gr,Sr)===2){var Gn=$n;$(Yr,(Gn=Gn!==Cn?$r.prev(Gn):null)?Gn.key:null,Xn),$(gr,Yr,Xn)}}else Tn=$n=$r.find(gr=gr.otherEvent),$n&&Tn&&($n=$n!==Cn?$r.prev($n):null,Tn=$r.next(Tn),$r.remove(gr),Tn&&$n&&vt($n.key,Tn.key,Sr))}return tn}(sr,0,0,kt,jt,lt)),Rr=[],Vr=0;Vr<ur.length;Vr++){var Ur=ur[Vr];if(Ur.isExterior()){for(var Kr=[Ur.points],_r=0;_r<Ur.holeIds.length;_r++)Kr.push(ur[Ur.holeIds[_r]].points);Rr.push(Kr)}}return Rr}var Vn={UNION:D,DIFFERENCE:j,INTERSECTION:R,XOR:V};l.diff=function(ve,Te){return kr(ve,Te,j)},l.intersection=function(ve,Te){return kr(ve,Te,R)},l.operations=Vn,l.union=function(ve,Te){return kr(ve,Te,D)},l.xor=function(ve,Te){return kr(ve,Te,V)},Object.defineProperty(l,"__esModule",{value:!0})}($R.exports)),$R.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function fb(l,r,a,u){const d=[],g=u===0?(y,x,E,C,R,D)=>{y.push(new mt(D,E+(D-x)/(C-x)*(R-E)))}:(y,x,E,C,R,D)=>{y.push(new mt(x+(D-E)/(R-E)*(C-x),D))};for(const y of l){const x=[];for(const E of y){if(E.length<=2)continue;const C=[];for(let j=0;j<E.length-1;j++){const V=E[j].x,$=E[j].y,Z=E[j+1].x,re=E[j+1].y,te=u===0?V:$,le=u===0?Z:re;te<r?le>r&&g(C,V,$,Z,re,r):te>a?le<a&&g(C,V,$,Z,re,a):C.push(E[j]),le<r&&te>=r&&g(C,V,$,Z,re,r),le>a&&te<=a&&g(C,V,$,Z,re,a)}let R=E[E.length-1];const D=u===0?R.x:R.y;D>=r&&D<=a&&C.push(R),C.length&&(R=C[C.length-1],C[0].x===R.x&&C[0].y===R.y||C.push(C[0]),x.push(C))}x.length&&d.push(x)}return d}function E9(l,r){const a=k2(l),u=k2([r]),d=UR.intersection(a,u);return d==null?[]:GR(d)}function A9(l,r){let u=k2(l,65536);const d=[];for(;r.valid();r.next()){const[g,y]=r.get(),x=g.x*65536,E=g.y*65536,C=y.x*65536,R=y.y*65536,D=C-x,j=R-E,V=Math.hypot(D,j);if(V===0)continue;const $=Math.trunc(j/V*3),Z=-Math.trunc(D/V*3);d.push([[[x,E],[C,R],[C+$,R+Z],[x+$,E+Z],[x,E]]])}return d.length>0&&(u=UR.diff(u,d)),GR(u,1/65536)}function k2(l,r=1){return[l.map(a=>a.map(u=>[u.x*r,u.y*r]))]}function GR(l,r=1){return l.map(a=>a.map((u,d)=>{const g=u.map(y=>new mt(y[0]*r,y[1]*r).round());return d>0&&g.reverse(),g}))}class j2{constructor(r,a){this.layoutVertexArray=new Cc,this.indexArray=new to,this.lineIndexArray=new Xs,this.triangleSegments=new gi,this.lineSegments=new gi,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Ol)}update(r,a,u,d,g,y,x,E){this.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,u9.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,h9.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,a,u,d,g,y,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,a,u,d,g,y,void 0,x)}}class L2{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new j2(r,!1),this.elevationBufferData=new j2(r,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,d){}populate(r,a,u,d){this.hasPattern=R2("fill",this.layers,this.pixelRatio,a);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:C,sourceLayerIndex:R}of r){const D=this.layers[0]._featureFilter.needGeometry,j=Le(x,D);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),j,u))continue;const V=g?g.evaluate(j,{},u,a.availableImages):void 0,$={id:E,properties:x.properties,type:x.type,sourceLayerIndex:R,index:C,geometry:D?j.geometry:Ce(x,u,d),patterns:{},sortKey:V};y.push($)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:C,sourceLayerIndex:R}=x;if(this.hasPattern){const D=D2("fill",this.layers,x,this.zoom,this.pixelRatio,a);this.patternFeatures.push(D)}else this.addFeature(x,E,C,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(r[C].feature,E,C,R,this.index)}}update(r,a,u,d,g,y,x){this.bufferData.update(r,a,u,d,g,y,x,this.worldview),this.elevationBufferData.update(r,a,u,d,g,y,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,a,u,d,g,y,x,this.worldview)}addFeatures(r,a,u,d,g,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,u,d,y,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,a,u,d,g,y=[],x,E){const C=b_(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,C,d,u,E):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(r,u,g,y,d,x,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,g,y,d,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,a,u,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(a,u,d,g,this.worldview))}addElevatedRoadFeature(r,a,u,d,g){const y=new Array,x=An.getElevationFeature(r,g);if(!x)return void this.addGeometry(a,this.bufferData);{const C=this.clipPolygonsToTile(a,1);C.length>0&&y.push({polygons:C,elevationFeature:x,elevationTileID:u})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:d};for(const C of y)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ys(C.elevationTileID,this.layers,this.zoom,this.lut));const D=C.elevationFeature.isTunnel();let j=0;r.properties.hasOwnProperty(Ze)&&(j=+r.properties[Ze]);for(const V of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,V,D,C.elevationFeature,j)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const R=new Bn(u,C.elevationTileID);this.addElevatedGeometry(C.polygons,R,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,E)}}addElevatedGeometry(r,a,u,d,g,y){const x={elevation:u,elevationSampler:a,bias:d,index:g,featureInfo:y},[E,C]=this.addGeometry(r,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(r,a,u){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(d=y,g=y));const x=(E,C,R)=>{if(u!=null)if(C.push(E),y!=null)a.elevatedLayoutVertexArray.emplaceBack(y),R.push(y);else{const D=u.elevationSampler.pointElevation(E,u.elevation,u.bias);a.elevatedLayoutVertexArray.emplaceBack(D),R.push(D),d=Math.min(d,D),g=Math.max(g,D)}};for(const E of r){let C=0;for(const ue of E)C+=ue.length;const R=a.triangleSegments.prepareSegment(C,a.layoutVertexArray,a.indexArray),D=R.vertexLength,j=[],V=[],$=[],Z=[],re=[],te=a.layoutVertexArray.length;for(const ue of E){if(ue.length===0)continue;ue!==E[0]&&V.push(j.length/2);const fe=a.lineSegments.prepareSegment(ue.length,a.layoutVertexArray,a.lineIndexArray),we=fe.vertexLength;u&&re.push(a.layoutVertexArray.length-te),x(ue[0],$,Z),a.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),a.lineIndexArray.emplaceBack(we+ue.length-1,we),j.push(ue[0].x),j.push(ue[0].y);for(let _e=1;_e<ue.length;_e++)x(ue[_e],$,Z),a.layoutVertexArray.emplaceBack(ue[_e].x,ue[_e].y),a.lineIndexArray.emplaceBack(we+_e-1,we+_e),j.push(ue[_e].x),j.push(ue[_e].y);fe.vertexLength+=ue.length,fe.primitiveLength+=ue.length}const le=lm(j,V);for(let ue=0;ue<le.length;ue+=3)a.indexArray.emplaceBack(D+le[ue],D+le[ue+1],D+le[ue+2]);if(le.length>0&&u&&this.elevationMode==="hd-road-base"){const ue=u.elevation.isTunnel(),fe=u.elevation.safeArea,we=this.elevatedStructures.addVertices($,Z);this.elevatedStructures.addTriangles(le,we,ue);const _e=re.length;if(_e>0){for(let Ee=0;Ee<_e-1;Ee++)this.elevatedStructures.addRenderableRing(u.index,re[Ee]+we,re[Ee+1]-re[Ee],ue,fe,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,re[_e-1]+we,$.length-re[_e-1],ue,fe,u.featureInfo)}}R.vertexLength+=C,R.primitiveLength+=le.length/3}return[d,g]}prepareElevatedPolygons(r,a,u){const d=1/oe(u),g=[];for(const y of r){const x=A9(y,new vn(a,d));g.push(...x)}return g}clipPolygonsToTile(r,a){const u=-a,d=-a,g=Mt+a,y=Mt+a;let x=0;const E=[],C=[];for(;x<r.length;x++){const j=r[x],V=El(j);(V.min.x>=u&&V.max.x<=g&&V.min.y>=d&&V.max.y<=y?E:C).push(j)}if(E.length===r.length)return r;const R=[new mt(u,d),new mt(g,d),new mt(g,y),new mt(u,y),new mt(u,d)],D=E;for(const j of C)D.push(...E9(j,R));return D}}let HR,WR,qR,ZR;Yt(L2,"FillBucket",{omit:["layers","patternFeatures"]}),Yt(j2,"FillBufferData"),Yt(Ys,"ElevatedStructures");class pb{constructor(r,a,u,d){if(this.triangleCount=a.length/3,this.min=new mt(0,0),this.max=new mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[g,y]=[r[0].clone(),r[0].clone()];for(let D=1;D<r.length;++D){const j=r[D];g.x=Math.min(g.x,j.x),g.y=Math.min(g.y,j.y),y.x=Math.max(y.x,j.x),y.y=Math.max(y.y,j.y)}if(d){const D=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/d);u=Math.max(u,D)}if(u===0)return;this.min=g,this.max=y;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const E=Math.max(x.x,x.y)/u;this.cellsX=Math.max(1,Math.ceil(x.x/E)),this.cellsY=Math.max(1,Math.ceil(x.y/E)),this.xScale=1/E,this.yScale=1/E;const C=[];for(let D=0;D<this.triangleCount;D++){const j=r[a[3*D+0]].sub(this.min),V=r[a[3*D+1]].sub(this.min),$=r[a[3*D+2]].sub(this.min),Z=Dc(Math.floor(Math.min(j.x,V.x,$.x)),this.xScale,this.cellsX),re=Dc(Math.floor(Math.max(j.x,V.x,$.x)),this.xScale,this.cellsX),te=Dc(Math.floor(Math.min(j.y,V.y,$.y)),this.yScale,this.cellsY),le=Dc(Math.floor(Math.max(j.y,V.y,$.y)),this.yScale,this.cellsY),ue=new mt(0,0),fe=new mt(0,0),we=new mt(0,0),_e=new mt(0,0);for(let Ee=te;Ee<=le;++Ee){ue.y=fe.y=Ee*E,we.y=_e.y=(Ee+1)*E;for(let Me=Z;Me<=re;++Me)ue.x=we.x=Me*E,fe.x=_e.x=(Me+1)*E,(Ho(j,V,$,ue,fe,_e)||Ho(j,V,$,ue,_e,we))&&C.push({cellIdx:Ee*this.cellsX+Me,triIdx:D})}}if(C.length===0)return;C.sort((D,j)=>D.cellIdx-j.cellIdx||D.triIdx-j.triIdx);let R=0;for(;R<C.length;){const D=C[R].cellIdx,j={start:this.payload.length,len:0};for(;R<C.length&&C[R].cellIdx===D;)++j.len,this.payload.push(C[R++].triIdx);this.cells[D]=j}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,a){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Dc(r.x-this.min.x,this.xScale,this.cellsX),d=Dc(r.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const x=this.payload[g.start+y],E=Math.floor(x/8),C=1<<x%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,a.push(x),a.length===this.triangleCount))return}}}query(r,a,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>a.x||r.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const d=Dc(r.x-this.min.x,this.xScale,this.cellsX),g=Dc(a.x-this.min.x,this.xScale,this.cellsX),y=Dc(r.y-this.min.y,this.yScale,this.cellsY),x=Dc(a.y-this.min.y,this.yScale,this.cellsY);for(let E=y;E<=x;E++)for(let C=d;C<=g;C++){const R=this.cells[E*this.cellsX+C];if(R)for(let D=0;D<R.len;D++){const j=this.payload[R.start+D],V=Math.floor(j/8),$=1<<j%8;if(!(this.lookup[V]&$)&&(this.lookup[V]|=$,u.push(j),u.length===this.triangleCount))return}}}}function Dc(l,r,a){return Math.max(0,Math.min(a-1,Math.floor(l*r)))}Yt(pb,"TriangleGridIndex");class XR{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){for(const u of this.footprints)a.push({footprint:u,id:r})}updateAppearances(r,a,u,d){}populate(r,a,u,d){const g=[];for(const{feature:y,id:x,index:E,sourceLayerIndex:C}of r){const R=this.layers[0]._featureFilter.needGeometry,D=Le(y,R);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),D,u))continue;const j={id:x,properties:y.properties,type:y.type,sourceLayerIndex:C,index:E,geometry:R?D.geometry:Ce(y,u,d),patterns:{}};g.push(j)}for(const y of g){const{geometry:x,index:E,sourceLayerIndex:C}=y;this.addFeature(y,x,E,u,{},a.availableImages,a.brightness),a.featureIndex.insert(r[E].feature,x,E,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,a,u,d,g,y,x){}destroy(){}addFeature(r,a,u,d,g,y=[],x){for(const E of b_(a,2)){const C=[],R=[],D=[],j=new mt(1/0,1/0),V=new mt(-1/0,-1/0);for(const re of E)if(re.length!==0){re!==E[0]&&D.push(R.length/2);for(let te=0;te<re.length;te++)R.push(re[te].x),R.push(re[te].y),C.push(re[te]),j.x=Math.min(j.x,re[te].x),j.y=Math.min(j.y,re[te].y),V.x=Math.max(V.x,re[te].x),V.y=Math.max(V.y,re[te].y)}const $=lm(R,D),Z=new pb(C,$,8,256);this.footprints.push({vertices:C,indices:$,grid:Z,min:j,max:V})}}}Yt(XR,"ClipBucket",{omit:["layers"]});const P9=Xr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),C9=Xr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),I9=Xr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),M9=Xr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),O9=Xr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),R9=Xr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),D9=Xr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:k9}=P9,w_=Number.MAX_SAFE_INTEGER,KR=w_-1;function YR(l,r,a,u){return l.order<r||l.order===w_||!(l.clipMask&a)||function(d,g){return g.length!==0&&g.find(y=>y===d)===void 0}(u,l.clipScope)}function mb(l,r){return l.x-r.x||l.y-r.y}function JR(l,r){return mb(l.min,r.min)===0&&mb(l.max,r.max)===0}function N2(l,r){return!(l.min.x>r.max.x||l.max.x<r.min.x||l.min.y>r.max.y||l.max.y<r.min.y)}function gb(l,r){if(l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==r[a].sourceId||!JR(l[a],r[a])||l[a].order!==r[a].order||l[a].clipMask!==r[a].clipMask||!Vo(l[a].clipScope,r[a].clipScope))return!1;return!0}function QR(l,r,a){const u=1/Mt,d=1/(1<<a.canonical.z),g=(r.x*u+a.canonical.x)*d+a.wrap,y=(r.y*u+a.canonical.y)*d;return{min:new mt((l.x*u+a.canonical.x)*d+a.wrap,(l.y*u+a.canonical.y)*d),max:new mt(g,y)}}function j9(l,r,a){const u=1<<a.canonical.z,d=((r.x-a.wrap)*u-a.canonical.x)*Mt,g=(r.y*u-a.canonical.y)*Mt;return{min:new mt(((l.x-a.wrap)*u-a.canonical.x)*Mt,(l.y*u-a.canonical.y)*Mt),max:new mt(d,g)}}function z2(l,r,a,u,d,g,y){const x=l.indices,E=l.vertices,C=[];for(let R=u;R<u+d;R+=3){const D=r[a[R+0]+g],j=r[a[R+1]+g],V=r[a[R+2]+g],$=Math.min(D.x,j.x,V.x),Z=Math.max(D.x,j.x,V.x),re=Math.min(D.y,j.y,V.y),te=Math.max(D.y,j.y,V.y);C.length=0,l.grid.query(new mt($,re),new mt(Z,te),C);for(let le=0;le<C.length;le++){const ue=C[le];if(Ho(E[x[3*ue+0]],E[x[3*ue+1]],E[x[3*ue+2]],D,j,V,y))return!0}}return!1}function eD(l,r,a,u){if(!l||!a)return!1;let d=l.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(a.vertices.length<l.vertices.length)return eD(a,u,l,r);const g=r.canonical,y=u.canonical,x=Math.pow(2,y.z-g.z);d=l.vertices.map(E=>new mt((E.x+g.x*Mt)*x-y.x*Mt,(E.y+g.y*Mt)*x-y.y*Mt))}return z2(a,d,l.indices,0,l.indices.length,0,0)}function tD(l,r,a,u){const d=Math.pow(2,u.z-a.z);return new mt((l+a.x*Mt)*d-u.x*Mt,(r+a.y*Mt)*d-u.y*Mt)}function rD(l,r){const a=[];r.grid.queryPoint(l,a);const u=r.indices,d=r.vertices;for(let g=0;g<a.length;g++){const y=a[g];if(qn([d[u[3*y+0]],d[u[3*y+1]],d[u[3*y+2]]],l))return!0}return!1}const F2=[new mt(0,0),new mt(Mt,0),new mt(Mt,Mt),new mt(0,Mt)];function nD(l,r){const a=[];let u=[];if(!r||l.length<2)return[l];if(l.length===2)return zo(l[0],l[1],F2)?[l]:[];for(let d=0;d<l.length+2;d++){const g=l[d%l.length],y=l[(d+1)%l.length],x=zo(d===0?l[l.length-1]:l[(d-1)%l.length],g,F2),E=zo(g,y,F2),C=x||E;C&&u.push(g),C&&E||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const B2=ke.types,L9=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],N9=["fill-extrusion-flood-light-ground-radius"],z9=Math.pow(2,13),F9=Math.pow(2,15)-1,iD=new mt(0,1),Tu=2147483648,oD=7,sD=450;function T_(l,r,a,u,d,g,y,x){l.emplaceBack((r<<1)+y,(a<<1)+g,(Math.floor(u*z9)<<1)+d,Math.round(x))}function S_(l,r,a){l.emplaceBack(r.x*Mt,r.y*Mt,a?1:0)}function yb(l,r,a,u,d,g){l.emplaceBack(r.x,r.y,(a.x<<1)+u,(a.y<<1)+d,g)}function E_(l,r,a){l.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}class aD{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lD{constructor(){this.centroidXY=new mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class cD{constructor(){this.acc=new mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,a){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=a.x,r.min.y=r.max.y=a.y)}appendEdge(r,a,u){this.accCount++,this.acc._add(a);let d=!!this.borders;a.x<r.min.x?(r.min.x=a.x,d=!0):a.x>r.max.x&&(r.max.x=a.x,d=!0),a.y<r.min.y?(r.min.y=a.y,d=!0):a.y>r.max.y&&(r.max.y=a.y,d=!0),((a.x===0||a.x===Mt)&&a.x===u.x)!=((a.y===0||a.y===Mt)&&a.y===u.y)&&this.processBorderOverlap(a,u),d&&this.checkBorderIntersection(a,u)}checkBorderIntersection(r,a){a.x<0!=r.x<0&&this.addBorderIntersection(0,vr(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Mt!=r.x>Mt&&this.addBorderIntersection(1,vr(a.y,r.y,(Mt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,vr(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Mt!=r.y>Mt&&this.addBorderIntersection(3,vr(a.x,r.x,(Mt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new mt(0,0):new mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0):0}}function uD(l,r){const a=l.add(r)._unit(),u=ne(l.x*a.x+l.y*a.y,-1,1);var d,g,y;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*F9*((g=l).x*(y=r).y-g.y*y.x<0?-1:1)}const B9=[l=>l.x<0,l=>l.x>Mt,l=>l.y<0,l=>l.y>Mt];function V9(l,r,a,u){const d=[4];if(u===0)return d;a._mult(u);const g=l.sub(a),y=r.sub(a),x=[l,r,g,y];for(let E=0;E<4;E++)for(const C of x)if(B9[E](C)){d.push(E);break}return d}class V2{constructor(r){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Yy,this.indexArray=new to,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut},a=>N9.includes(a)),this._segments=new gi,this.hiddenByLandmarkVertexArray=new Kp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new gi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,a,u,d=!1){const g=r.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let E;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const C=r[0],R=r[1];E=uD(C.sub(r[g-1])._perp()._unit(),R.sub(C)._perp()._unit())}for(let C=0;C<g;C++){const R=C===g-1?0:C+1,D=r[C],j=r[R],V=r[R===g-1?0:R+1],$=j.sub(D)._perp()._unit(),Z=uD($,V.sub(j)._perp()._unit()),re=E,te=Z;if($2(D,j,a)||d&&fD(D,a)&&fD(j,a)){E=Z;continue}const le=x.vertexLength;yb(this.vertexArray,D,j,1,1,re),yb(this.vertexArray,D,j,1,0,re),yb(this.vertexArray,D,j,0,1,te),yb(this.vertexArray,D,j,0,0,te),x.vertexLength+=4;const ue=V9(D,j,$,u);for(const fe of ue)this._segmentToGroundQuads[y].push({id:le,region:fe}),this._segmentToRegionTriCounts[y][fe]+=2,x.primitiveLength+=2;E=Z}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),a=r.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((d,g)=>d.region-g.region);for(let u=0;u<a;u++){const d=this._segmentToGroundQuads[u],g=r[u],y=this._segmentToRegionTriCounts[u];y.reduce((E,C)=>E+C,0);let x=0;for(let E=0;E<=4;E++){const C=y[E];if(C!==0){let R=this.regionSegments[E];R||(R=this.regionSegments[E]=new gi);const D={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+x,vertexLength:g.vertexLength,primitiveLength:C};R.get().push(D)}x+=C}for(let E=0;E<d.length;E++){const C=d[E].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,a,u,d,g,y,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,a,u,d,g,y,void 0,x)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,C9.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=r.createVertexBuffer(this.groundRadiusArray,I9.members)))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,a,u,d,g,y,x,E){this.hasData()&&this.programConfigurations.updatePaintArrays(r,a,u,d,g,y,x,E)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&Tu))}updateHiddenByLandmarkRange(r,a,u){if(!this.hasData())return;const d=a+r;if(a!==0){for(let g=r;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,R9.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const a=this.regionSegments[r];a&&a.destroy()}}}}class _b{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new to,this.footprintVertices=new Cc,this.footprintSegments=[],this.layoutVertexArray=new gh,this.centroidVertexArray=new ob,this.wallVertexArray=new zd,this.indexArray=new to,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut},a=>L9.includes(a)),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new V2(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,d){}populate(r,a,u,d){this.features=[],this.hasPattern=R2("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=oe(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const C=this.layers[0]._featureFilter.needGeometry,R=Le(g,C);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),R,u))continue;const D={id:y,sourceLayerIndex:E,index:x,geometry:C?R.geometry:Ce(g,u,d),properties:g.properties,type:g.type,patterns:{}},j=this.layoutVertexArray.length,V=B2[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:D2("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const $ of D.geometry)for(const Z of nD($,V))this.addFeature(g.id,D,[Z],x,u,{},a.availableImages,d,a.brightness);else this.addFeature(g.id,D,D.geometry,x,u,{},a.availableImages,d,a.brightness);a.featureIndex.insert(g,D.geometry,x,E,this.index,j)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,a,u,d,g,y){for(const{featureId:x,feature:E}of this.features){const C=B2[E.type]==="Polygon",{geometry:R}=E;if(this.wallMode)for(const D of R)for(const j of nD(D,C))this.addFeature(x,E,[j],E.index,a,u,d,g,y);else this.addFeature(x,E,R,E.index,a,u,d,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,a,u,d,g,y,x){this.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,this.worldview),this.groundEffect.update(r,a,g,u,d,y,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,k9),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,O9.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,D9.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,M9.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,u,d,g,y,x,E,C){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,D=[new mt(0,0),new mt(Mt,Mt)],j=E.projection,V=j.name==="globe",$=this.wallMode||B2[a.type]==="Polygon",Z=new cD;Z.centroidDataIndex=this.centroidData.length;const re=new lD;re.buildingId=r,a.properties&&a.properties.hasOwnProperty("building_id")&&(re.buildingId=a.properties.building_id);const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},g)<=0,le=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},g);let ue;if(re.height=le,re.vertexArrayOffset=this.layoutVertexArray.length,re.groundVertexArrayOffset=this.groundEffect.vertexArray.length,V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Gp),this.wallMode){if(V)return void Ut("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ue=function(Ne){const at=Ne[0].x===Ne[Ne.length-1].x&&Ne[0].y===Ne[Ne.length-1].y;(function(Ht){let Qt=0;const Gr=Ht.length;for(let Pt=0;Pt<Gr;Pt++)Qt+=(Ht[(Pt+1)%Gr].x-Ht[Pt].x)*(Ht[(Pt+1)%Gr].y+Ht[Pt].y);return Qt>=0})(Ne)||(Ne=Ne.reverse());const pt={geometry:[],joinNormals:[],indices:[]},xt=[],wt=[],yt=[];let _t=Ne.length;for(;_t>=2&&Ne[_t-1].equals(Ne[_t-2]);)_t--;if(_t<(at?3:2))return pt;let st,it,vt,Ot,At,or=0;for(;or<_t-1&&Ne[or].equals(Ne[or+1]);)or++;at&&(st=Ne[_t-2],At=Ne[or].sub(st)._unit()._perp());for(let Ht=or;Ht<_t;Ht++){if(vt=Ht===_t-1?at?Ne[or+1]:void 0:Ne[Ht+1],vt&&Ne[Ht].equals(vt))continue;At&&(Ot=At),st&&(it=st),st=Ne[Ht],At=vt?vt.sub(st)._unit()._perp():Ot,Ot=Ot||At;let Qt=Ot.add(At);Qt.x===0&&Qt.y===0||Qt._unit();const Gr=Qt.x*At.x+Qt.y*At.y,Pt=Gr!==0?1/Gr:1/0,er=Ot.x*At.y-Ot.y*At.x>0;let Pr="miter";const en=2;Pr==="miter"&&Pt>en&&(Pr="bevel"),Pr==="bevel"&&(Pt>100&&(Pr="flipbevel"),Pt<en&&(Pr="miter"));const sn=(kr,Vn,ve,Te)=>{const lt=new mt(kr.x,kr.y),bt=new mt(kr.x,kr.y);lt.x+=Vn.x*Te,lt.y+=Vn.y*Te,bt.x-=Vn.x*Math.max(ve,1),bt.y-=Vn.y*Math.max(ve,1),yt.push(Vn),xt.push(lt),wt.push(bt)};if(Pr==="miter")Qt._mult(Pt),sn(st,Qt,0,0);else if(Pr==="flipbevel")Qt=At.mult(-1),sn(st,Qt,0,0),sn(st,Qt.mult(-1),0,0);else{const kr=-Math.sqrt(Pt*Pt-1),Vn=er?kr:0,ve=er?0:kr;it&&sn(st,Ot,Vn,ve),vt&&sn(st,At,Vn,ve)}}pt.geometry=[...xt,...wt.reverse(),xt[0]],pt.joinNormals=[...yt,...yt.reverse(),yt[yt.length-1]];const Ft=pt.geometry.length-1;for(let Ht=0;Ht<Ft/2;Ht++)if(Ht+1<Ft/2){let Qt=Ht,Gr=Ht+1,Pt=Ft-1-Ht,er=Ft-2-Ht;Qt=Qt===0?Ft-1:Qt-1,Gr=Gr===0?Ft-1:Gr-1,Pt=Pt===0?Ft-1:Pt-1,er=er===0?Ft-1:er-1,pt.indices.push(Pt),pt.indices.push(Gr),pt.indices.push(Qt),pt.indices.push(Pt),pt.indices.push(er),pt.indices.push(Gr)}return pt}(u[0]),u=[ue.geometry]}const fe=(Ne,at)=>Ne<(at.length-1)/2||Ne===at.length-1,we=this.wallMode?[u]:b_(u,500);for(let Ne=we.length-1;Ne>=0;Ne--){const at=we[Ne];(at.length===0||(_e=at[0]).every(ft=>ft.x<=0)||_e.every(ft=>ft.x>=Mt)||_e.every(ft=>ft.y<=0)||_e.every(ft=>ft.y>=Mt))&&we.splice(Ne,1)}var _e;let Ee;if(V)Ee=yD(we,D,g);else{Ee=[];for(const Ne of we)Ee.push({polygon:Ne,bounds:D})}const Me=$?this.edgeRadius:0,De=Me>0&&this.zoom<17,rt=(Ne,at)=>{if(Ne.length===0)return!1;const ft=Ne[Ne.length-1];return at.x===ft.x&&at.y===ft.y};for(const{polygon:Ne,bounds:at}of Ee){let ft=0,pt=0;for(const _t of Ne)$&&!_t[0].equals(_t[_t.length-1])&&_t.push(_t[0]),pt+=$?_t.length-1:_t.length;const xt=this.segments.prepareSegment(($?5:4)*pt,this.layoutVertexArray,this.indexArray);re.footprintSegIdx<0&&(re.footprintSegIdx=this.footprintSegments.length),re.polygonSegIdx<0&&(re.polygonSegIdx=this.polygonSegments.length);const wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},yt=new aD;if(yt.vertexOffset=this.footprintVertices.length,yt.indexOffset=3*this.footprintIndices.length,yt.ringIndices=[],$){const _t=[],st=[];ft=xt.vertexLength;for(let vt=0;vt<Ne.length;vt++){const Ot=Ne[vt];Ot.length&&vt!==0&&st.push(_t.length/2);const At=[];let or,Ft;or=Ot[1].sub(Ot[0])._perp()._unit(),yt.ringIndices.push(Ot.length-1);for(let Ht=1;Ht<Ot.length;Ht++){const Qt=Ot[Ht],Gr=Ot[Ht===Ot.length-1?1:Ht+1],Pt=Qt.clone();if(Me){Ft=Gr.sub(Qt)._perp()._unit();const er=or.add(Ft)._unit(),Pr=Me*Math.min(4,1/(or.x*er.x+or.y*er.y));Pt.x+=Pr*er.x,Pt.y+=Pr*er.y,Pt.x=Math.round(Pt.x),Pt.y=Math.round(Pt.y),or=Ft}if(!te||Me!==0&&!De||rt(At,Pt)||At.push(Pt),T_(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),this.wallMode){const er=fe(Ht,Ot);S_(this.wallVertexArray,ue.joinNormals[Ht],!er)}xt.vertexLength++,this.footprintVertices.emplaceBack(Qt.x,Qt.y),_t.push(Qt.x,Qt.y),V&&E_(this.layoutVertexExtArray,j.projectTilePoint(Pt.x,Pt.y,g),j.upVector(g,Pt.x,Pt.y))}te&&(Me===0||De)&&(At.length!==0&&rt(At,At[0])&&At.pop(),this.groundEffect.addData(At,at,R))}const it=this.wallMode?ue.indices:lm(_t,st);for(let vt=0;vt<it.length;vt+=3)this.footprintIndices.emplaceBack(yt.vertexOffset+it[vt+0],yt.vertexOffset+it[vt+1],yt.vertexOffset+it[vt+2]),this.indexArray.emplaceBack(ft+it[vt],ft+it[vt+2],ft+it[vt+1]),xt.primitiveLength++;yt.indexCount+=it.length,yt.vertexCount+=this.footprintVertices.length-yt.vertexOffset}for(let _t=0;_t<Ne.length;_t++){const st=Ne[_t];Z.startRing(re,st[0]);let it=st.length>4&&pD(st[st.length-2],st[0],st[1]),vt=Me?$9(st[st.length-2],st[0],st[1],Me):0;const Ot=[];let At,or,Ft;or=st[1].sub(st[0])._perp()._unit();let Ht=!0;for(let Qt=1,Gr=0;Qt<st.length;Qt++){let Pt=st[Qt-1],er=st[Qt];const Pr=st[Qt===st.length-1?1:Qt+1];if(Z.appendEdge(re,er,Pt),$2(er,Pt,at)){Me&&(or=Pr.sub(er)._perp()._unit(),Ht=!Ht);continue}const en=er.sub(Pt)._perp(),sn=en.x/(Math.abs(en.x)+Math.abs(en.y)),kr=en.y>0?1:0,Vn=Pt.dist(er);if(Gr+Vn>32768&&(Gr=0),Me){Ft=Pr.sub(er)._perp()._unit();let bt=dD(Pt,er,Pr,hD(or,Ft),Me);isNaN(bt)&&(bt=0);const kt=er.sub(Pt)._unit();Pt=Pt.add(kt.mult(vt))._round(),er=er.add(kt.mult(-bt))._round(),vt=bt,or=Ft,te&&this.zoom>=17&&(rt(Ot,Pt)||Ot.push(Pt),rt(Ot,er)||Ot.push(er))}const ve=xt.vertexLength,Te=st.length>4&&pD(Pt,er,Pr);let lt=mD(Gr,it,Ht);if(T_(this.layoutVertexArray,Pt.x,Pt.y,sn,kr,0,0,lt),T_(this.layoutVertexArray,Pt.x,Pt.y,sn,kr,0,1,lt),this.wallMode){const bt=fe(Qt-1,st),kt=ue.joinNormals[Qt-1];S_(this.wallVertexArray,kt,bt),S_(this.wallVertexArray,kt,bt)}if(Gr+=Vn,lt=mD(Gr,Te,!Ht),it=Te,T_(this.layoutVertexArray,er.x,er.y,sn,kr,0,0,lt),T_(this.layoutVertexArray,er.x,er.y,sn,kr,0,1,lt),this.wallMode){const bt=fe(Qt,st),kt=ue.joinNormals[Qt];S_(this.wallVertexArray,kt,bt),S_(this.wallVertexArray,kt,bt)}if(xt.vertexLength+=4,this.indexArray.emplaceBack(ve+0,ve+1,ve+2),this.indexArray.emplaceBack(ve+1,ve+3,ve+2),xt.primitiveLength+=2,Me){const bt=ft+(Qt===1?st.length-2:Qt-2),kt=Qt===1?ft:bt+1;if(this.indexArray.emplaceBack(ve+1,bt,ve+3),this.indexArray.emplaceBack(bt,kt,ve+3),xt.primitiveLength+=2,At===void 0&&(At=ve),!$2(Pr,st[Qt],at)){const jt=Qt===st.length-1?At:xt.vertexLength;this.indexArray.emplaceBack(ve+2,ve+3,jt),this.indexArray.emplaceBack(ve+3,jt+1,jt),this.indexArray.emplaceBack(ve+3,kt,jt+1),xt.primitiveLength+=3}Ht=!Ht}if(V){const bt=this.layoutVertexExtArray,kt=j.projectTilePoint(Pt.x,Pt.y,g),jt=j.projectTilePoint(er.x,er.y,g),sr=j.upVector(g,Pt.x,Pt.y),ur=j.upVector(g,er.x,er.y);E_(bt,kt,sr),E_(bt,kt,sr),E_(bt,jt,ur),E_(bt,jt,ur)}}$&&(ft+=st.length-1),te&&Me&&this.zoom>=17&&(Ot.length!==0&&rt(Ot,Ot[0])&&Ot.pop(),this.groundEffect.addData(Ot,at,R,Me>0))}this.footprintSegments.push(yt),wt.triangleCount=this.indexArray.length-wt.triangleArrayOffset,this.polygonSegments.push(wt),++re.footprintSegLen,++re.polygonSegLen}if(re.vertexCount=this.layoutVertexArray.length-re.vertexArrayOffset,re.groundVertexCount=this.groundEffect.vertexArray.length-re.groundVertexArrayOffset,re.vertexCount!==0){if(re.centroidXY=Z.borders?iD:this.encodeCentroid(Z,re),this.centroidData.push(re),Z.borders){this.featuresOnBorder.push(Z);const Ne=this.featuresOnBorder.length-1;for(let at=0;at<Z.borders.length;at++)Z.borders[at][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[at].push(Ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,y,x,g,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,d,y,x,g,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,le)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((a,u)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let x=0;x<this.centroidData.length;x++){const E=this.centroidData[x],C=+(E.min.y+E.max.y>Mt),R=2*C+(+(E.min.x+E.max.x>Mt)^C);for(let D=0;D<E.polygonSegLen;D++){const j=E.polygonSegIdx+D;r.push({centroidIdx:x,subtile:R,polygonSegmentIdx:j,triangleSegmentIdx:this.polygonSegments[j].triangleSegIdx})}}const a=new to;r.sort((x,E)=>x.triangleSegmentIdx===E.triangleSegmentIdx?x.subtile-E.subtile:x.triangleSegmentIdx-E.triangleSegmentIdx);let u=0,d=0,g=0;for(const x of r){if(x.triangleSegmentIdx!==u)break;g++}const y=r.length;for(;d!==r.length;){u=r[d].triangleSegmentIdx;let x=0,E=d,C=d;for(let R=E;R<g&&r[R].subtile===x;R++)C++;for(;E!==g;){const R=r[E];x=R.subtile;const D=this.centroidData[R.centroidIdx].min.clone(),j=this.centroidData[R.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=E;$<C;$++){const Z=r[$],re=this.polygonSegments[Z.polygonSegmentIdx],te=this.centroidData[Z.centroidIdx].min,le=this.centroidData[Z.centroidIdx].max,ue=this.indexArray.uint16;for(let fe=re.triangleArrayOffset;fe<re.triangleArrayOffset+re.triangleCount;fe++)a.emplaceBack(ue[3*fe],ue[3*fe+1],ue[3*fe+2]);V.primitiveLength+=re.triangleCount,D.x=Math.min(D.x,te.x),D.y=Math.min(D.y,te.y),j.x=Math.max(j.x,le.x),j.y=Math.max(j.y,le.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:D,max:j}),E=C;for(let $=E;$<g&&r[$].subtile===r[E].subtile;$++)C++}d=g;for(let R=d;R<y&&r[R].triangleSegmentIdx===r[d].triangleSegmentIdx;R++)g++}a._trim(),this.indexArray=a}getVisibleSegments(r,a,u){const d=new gi;if(this.wallMode){for(const Z of this.triangleSubSegments)d.segments.push(Z.segment);return d}let g=0,y=0;const x=1<<r.canonical.z;if(a){const Z=a.getMinMaxForTile(r);Z&&(g=Z.min,y=Z.max)}y+=this.maxHeight;const E=r.toUnwrapped();let C;const R=[E.canonical.x/x+E.wrap,E.canonical.y/x],D=[(E.canonical.x+1)/x+E.wrap,(E.canonical.y+1)/x],j=(Z,re,te)=>[Z[0]*(1-te[0])+re[0]*te[0],Z[1]*(1-te[1])+re[1]*te[1]],V=[],$=[];for(const Z of this.triangleSubSegments){V[0]=Z.min.x/Mt,V[1]=Z.min.y/Mt,$[0]=Z.max.x/Mt,$[1]=Z.max.y/Mt;const re=j(R,D,V),te=j(R,D,$);if(new rr([re[0],re[1],g],[te[0],te[1],y]).intersectsPrecise(u)===0){C&&(d.segments.push(C),C=void 0);continue}const le=Z.segment;C&&C.vertexOffset!==le.vertexOffset&&(d.segments.push(C),C=void 0),C?(C.vertexLength+=le.vertexLength,C.primitiveLength+=le.primitiveLength):C={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&d.segments.push(C),d}encodeCentroid(r,a){const u=r.centroid(),d=a.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),y=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new mt(ne(u.x,1,Mt-1)<<3|g,ne(u.y,1,Mt-1)<<3|y)}encodeBorderCentroid(r){if(!r.borders)return new mt(0,0);const a=r.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const d=a[0][0]!==u?0:1;return new mt(6|(a[0][0]!==u?0:65528),(a[d][0]+a[d][1])/2<<3|6)}{const d=a[2][0]!==u?2:3;return new mt((a[d][0]+a[d][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(r){const a=this.centroidData[r.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const a=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,d=r.flags&Tu?iD:r.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==d.y||g!==d.x){for(let y=a;y<u;++y)this.centroidVertexArray.emplace(y,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(r.toUnwrapped());if(gb(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const x=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));if(y.footprint.buildingIds)for(const E of this.centroidData)E.flags&Tu||y.min.x>E.max.x||E.min.x>y.max.x||y.min.y>E.max.y||E.min.y>y.max.y||y.footprint.buildingIds.has(E.buildingId)&&(E.flags|=Tu);else for(const E of this.centroidData)if(!(E.flags&Tu||y.min.x>E.max.x||E.min.x>y.max.x||y.min.y>E.max.y||E.min.y>y.max.y))for(let C=0;C<E.footprintSegLen;C++){const R=this.footprintSegments[E.footprintSegIdx+C];if(g.length=0,U9(this.footprintVertices,R.vertexOffset,R.vertexCount,y.footprintTileId.canonical,r.canonical,g),z2(y.footprint,g,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-x)){E.flags|=Tu;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,a,u){let d=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let x=0;for(const E of y.ringIndices){for(let C=x,R=E+x-1;C<E+x;R=C++){const D=this.footprintVertices.int16[2*(C+y.vertexOffset)+0],j=this.footprintVertices.int16[2*(C+y.vertexOffset)+1],V=this.footprintVertices.int16[2*(R+y.vertexOffset)+1];j>a!=V>a&&r<(this.footprintVertices.int16[2*(R+y.vertexOffset)+0]-D)*(a-j)/(V-j)+D&&(d=!d)}x=E}}return d}getHeightAtTileCoord(r,a){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(r+Mt)*Mt+(a+Mt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&Tu)}:void 0}for(const y of this.centroidData)r>y.max.x||y.min.x>r||a>y.max.y||y.min.y>a||y.height<=u||this.footprintContainsPoint(r,a,y)&&(u=y.height,this.partLookup[g]=y,d=!!(y.flags&Tu));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[g]=void 0}}function hD(l,r){const a=l.add(r)._unit();return l.x*a.x+l.y*a.y}function $9(l,r,a,u){const d=r.sub(l)._perp()._unit(),g=a.sub(r)._perp()._unit();return dD(l,r,a,hD(d,g),u)}function dD(l,r,a,u,d){const g=Math.sqrt(1-u*u);return Math.min(l.dist(r)/3,r.dist(a)/3,d*g/u)}function $2(l,r,a){return l.x<a[0].x&&r.x<a[0].x||l.x>a[1].x&&r.x>a[1].x||l.y<a[0].y&&r.y<a[0].y||l.y>a[1].y&&r.y>a[1].y}function fD(l,r){return l.x<r[0].x||l.x>r[1].x||l.y<r[0].y||l.y>r[1].y}function pD(l,r,a){if(l.x<0||l.x>=Mt||r.x<0||r.x>=Mt||a.x<0||a.x>=Mt)return!1;const u=a.sub(r),d=u.perp(),g=l.sub(r);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function mD(l,r,a){const u=r?2|l:-3&l;return a?1|u:-2&u}function gD(){const l=Math.PI/32,r=Math.tan(l),a=f;return a*Math.sqrt(1+2*r*r)-a}function yD(l,r,a){const u=1<<a.z,d=N(a.x/u),g=N((a.x+1)/u),y=W(a.y/u),x=W((a.y+1)/u);return function(E,C,R,D,j=0,V){const $=[];if(!E.length||!R||!D)return $;const Z=(_e,Ee)=>{for(const Me of _e)$.push({polygon:Me,bounds:Ee})},re=Math.ceil(Math.log2(R)),te=Math.ceil(Math.log2(D)),le=re-te,ue=[];for(let _e=0;_e<Math.abs(le);_e++)ue.push(le>0?0:1);for(let _e=0;_e<Math.min(re,te);_e++)ue.push(0),ue.push(1);let fe=E;if(fe=fb(fe,C[0].y-j,C[1].y+j,1),fe=fb(fe,C[0].x-j,C[1].x+j,0),!fe.length)return $;const we=[];for(ue.length?we.push({polygons:fe,bounds:C,depth:0}):Z(fe,C);we.length;){const _e=we.pop(),Ee=_e.depth,Me=ue[Ee],De=_e.bounds[0],rt=_e.bounds[1],Ne=Me===0?De.x:De.y,at=Me===0?rt.x:rt.y,ft=V?V(Me,Ne,at):.5*(Ne+at),pt=fb(_e.polygons,Ne-j,ft+j,Me),xt=fb(_e.polygons,ft-j,at+j,Me);if(pt.length){const wt=[De,new mt(Me===0?ft:rt.x,Me===1?ft:rt.y)];ue.length>Ee+1?we.push({polygons:pt,bounds:wt,depth:Ee+1}):Z(pt,wt)}if(xt.length){const wt=[new mt(Me===0?ft:De.x,Me===1?ft:De.y),rt];ue.length>Ee+1?we.push({polygons:xt,bounds:wt,depth:Ee+1}):Z(xt,wt)}}return $}(l,r,Math.ceil((g-d)/11.25),Math.ceil((y-x)/11.25),1,(E,C,R)=>{if(E===0)return .5*(C+R);{const D=W((a.y+C/Mt)/u);return(O(.5*(W((a.y+R/Mt)/u)+D))*u-a.y)*Mt}})}function U9(l,r,a,u,d,g){const y=Math.pow(2,u.z-d.z);for(let x=0;x<a;x++){let E=l.int16[2*(x+r)+0],C=l.int16[2*(x+r)+1];E=(E+d.x*Mt)*y-u.x*Mt,C=(C+d.y*Mt)*y-u.y*Mt,g.push(new mt(E,C))}}let _D,vD;Yt(_b,"FillExtrusionBucket",{omit:["layers","features"]}),Yt(lD,"PartData"),Yt(aD,"FootprintSegment"),Yt(cD,"BorderCentroidData"),Yt(V2,"GroundEffect");class Zd extends mt{constructor(r,a,u){super(r,a),this.z=u}}class xD extends Zd{constructor(r,a,u,d){super(r,a,u),this.w=d}}function bD(l,r,a,u){const d=a==="x"?"y":"x",g=(u-l[a])/(r[a]-l[a]);l[d]=Math.round(l[d]+(r[d]-l[d])*g),l[a]=u,l.hasOwnProperty("z")&&(l.z=vr(l.z,r.z,g)),l.hasOwnProperty("w")&&(l.w=vr(l.w,r.w,g))}function wD(l,r,a,u){const d=a,g=u;for(const y of["x","y"]){let x=l,E=r;x[y]>=E[y]&&(x=r,E=l),x[y]<d&&E[y]>d&&bD(x,E,y,d),x[y]<g&&E[y]>g&&bD(E,x,y,g)}}function vb(l,r,a,u,d,g){const y=[];for(let x=0;x<l.length;x++){const E=l[x];let C;const R=y.length;let D=0;for(let j=0;j<E.length-1;j++){let V=E[j],$=E[j+1],Z=0;const re=D;let te,le;g&&(Z=Math.hypot($.x-V.x,$.y-V.y),D+=Z,te=V,le=$),V.x<r&&$.x<r||(V.x<r?V=new mt(r,V.y+(r-V.x)/($.x-V.x)*($.y-V.y))._round():$.x<r&&($=new mt(r,V.y+(r-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y<a&&$.y<a||(V.y<a?V=new mt(V.x+(a-V.y)/($.y-V.y)*($.x-V.x),a)._round():$.y<a&&($=new mt(V.x+(a-V.y)/($.y-V.y)*($.x-V.x),a)._round()),V.x>=u&&$.x>=u||(V.x>=u?V=new mt(u,V.y+(u-V.x)/($.x-V.x)*($.y-V.y))._round():$.x>=u&&($=new mt(u,V.y+(u-V.x)/($.x-V.x)*($.y-V.y))._round()),V.y>=d&&$.y>=d||(V.y>=d?V=new mt(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round():$.y>=d&&($=new mt(V.x+(d-V.y)/($.y-V.y)*($.x-V.x),d)._round()),C&&V.equals(C[C.length-1])||(C=[V],y.push(C),g&&g.push({progress:{min:re+TD(te,le,V)*Z,max:1},parentIndex:x,prevPoint:te,nextPoint:le})),C.push($),g&&(g[g.length-1].progress.max=re+TD(te,le,$)*Z,g[g.length-1].nextPoint=le)))))}if(g&&D>0)for(let j=R;j<y.length;j++)g[j].progress.min/=D,g[j].progress.max/=D}return y}function G9(l,r,a,u,d){if(l.length<2)return void u.push(l);const g=[];for(;r.valid();){const[C,R]=r.get();for(let D=0;D<l.length-1;D++){const j=l[D],V=l[D+1],$=Br(j,V,C,R);if($){const[Z]=$,re=new mt(vr(j.x,V.x,Z),vr(j.y,V.y,Z));g.push({t:D+Z,distance:0,point:re})}}r.next()}if(g.length===0)return void u.push(l);g.sort((C,R)=>C.t-R.t);let y=0,x=0,E=[];for(u.push(E);y!==l.length;){if(x===g.length){for(;y!==l.length;)E.length!==0&&E[E.length-1].equals(l[y])||E.push(l[y]),y++;break}g[x].t<=y?(E.length!==0&&E[E.length-1].equals(g[x].point)||E.push(g[x].point),Math.trunc(g[x].t),x++):(E.length!==0&&E[E.length-1].equals(l[y])||E.push(l[y]),y++)}}function TD(l,r,a){return l.x!==r.x?(a.x-l.x)/(r.x-l.x):l.y!==r.y?(a.y-l.y)/(r.y-l.y):0}function A_(l,r){return l.x*r.x+l.y*r.y}function SD(l,r){if(l.length===1){let a=0;const u=r[a++];let d;for(;!d||u.equals(d);)if(d=r[a++],!d)return 1/0;for(;a<r.length;a++){const g=r[a],y=l[0],x=d.sub(u),E=g.sub(u),C=y.sub(u),R=A_(x,x),D=A_(x,E),j=A_(E,E),V=A_(C,x),$=A_(C,E),Z=R*j-D*D,re=(j*V-D*$)/Z,te=(R*$-D*V)/Z,le=u.z*(1-re-te)+d.z*re+g.z*te;if(isFinite(le))return le}return 1/0}{let a=1/0;for(const u of r)a=Math.min(a,u.z);return a}}function ED(l,r,a){let u=1/0;Sn(a,r)&&(u=SD(a,r[0]));for(let d=0;d<r.length;d++){const g=r[d],y=l[d];for(let x=0;x<g.length-1;x++){const E=g[x],C=[E,g[x+1],y[x+1],y[x],E];yn(a,C)&&(u=Math.min(u,SD(a,C)))}}return u!==1/0&&u}function AD(l,r,a,u,d,g,y,x,E,C,R){return l.projection.name==="globe"?function(D,j,V,$,Z,re,te,le,ue,fe,we){const _e=[],Ee=[],Me=D.projection.upVectorScale(we,D.center.lat,D.worldSize).metersToTile,De=[0,0,0,1],rt=[0,0,0,1],Ne=(ft,pt,xt,wt)=>{ft[0]=pt,ft[1]=xt,ft[2]=wt,ft[3]=1},at=gD();V>0&&(V+=at),$+=at;for(const ft of j){const pt=[],xt=[];for(const wt of ft){const yt=wt.x+Z.x,_t=wt.y+Z.y,st=D.projection.projectTilePoint(yt,_t,we),it=D.projection.upVector(we,wt.x,wt.y);let vt=V,Ot=$;if(te){const At=PD(yt,_t,V,$,te,le,ue,fe);vt+=At.base,Ot+=At.top}V!==0?Ne(De,st.x+it[0]*Me*vt,st.y+it[1]*Me*vt,st.z+it[2]*Me*vt):Ne(De,st.x,st.y,st.z),Ne(rt,st.x+it[0]*Me*Ot,st.y+it[1]*Me*Ot,st.z+it[2]*Me*Ot),Nr(De,De,re),Nr(rt,rt,re),pt.push(new Zd(De[0],De[1],De[2])),xt.push(new Zd(rt[0],rt[1],rt[2]))}_e.push(pt),Ee.push(xt)}return[_e,Ee]}(l,r,a,u,d,g,y,x,E,C,R):y?function(D,j,V,$,Z,re,te,le,ue){const fe=[],we=[],_e=[0,0,0,1];for(const Ee of D){const Me=[],De=[];for(const rt of Ee){const Ne=rt.x+$.x,at=rt.y+$.y,ft=PD(Ne,at,j,V,re,te,le,ue);_e[0]=Ne,_e[1]=at,_e[2]=ft.base,_e[3]=1,Hi(_e,_e,Z),_e[3]=Math.max(_e[3],1e-5);const pt=new Zd(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);_e[0]=Ne,_e[1]=at,_e[2]=ft.top,_e[3]=1,Hi(_e,_e,Z),_e[3]=Math.max(_e[3],1e-5);const xt=new Zd(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);Me.push(pt),De.push(xt)}fe.push(Me),we.push(De)}return[fe,we]}(r,a,u,d,g,y,x,E,C):function(D,j,V,$,Z){const re=[],te=[],le=Z[8]*j,ue=Z[9]*j,fe=Z[10]*j,we=Z[11]*j,_e=Z[8]*V,Ee=Z[9]*V,Me=Z[10]*V,De=Z[11]*V;for(const rt of D){const Ne=[],at=[];for(const ft of rt){const pt=ft.x+$.x,xt=ft.y+$.y,wt=Z[0]*pt+Z[4]*xt+Z[12],yt=Z[1]*pt+Z[5]*xt+Z[13],_t=Z[2]*pt+Z[6]*xt+Z[14],st=Z[3]*pt+Z[7]*xt+Z[15],it=wt+le,vt=yt+ue,Ot=_t+fe,At=Math.max(st+we,1e-5),or=wt+_e,Ft=yt+Ee,Ht=_t+Me,Qt=Math.max(st+De,1e-5);Ne.push(new Zd(it/At,vt/At,Ot/At)),at.push(new Zd(or/Qt,Ft/Qt,Ht/Qt))}re.push(Ne),te.push(at)}return[re,te]}(r,a,u,d,g)}function PD(l,r,a,u,d,g,y,x){const E=y*d.getElevationAt(l,r,!0,!0),C=g[0]!==0,R=C?g[1]===0?y*(g[0]/oD-sD):y*function(D,j,V){const $=Math.floor(j[0]/8),Z=Math.floor(j[1]/8),re=10*(j[0]-8*$),te=10*(j[1]-8*Z),le=D.getElevationAt($,Z,!0,!0),ue=D.getMeterToDEM(V),fe=Math.floor(.5*(re*ue-1)),we=Math.floor(.5*(te*ue-1)),_e=D.tileCoordToPixel($,Z),Ee=2*fe+1,Me=2*we+1,De=function(xt,wt,yt,_t,st){return[xt.getElevationAtPixel(wt,yt,!0),xt.getElevationAtPixel(wt+st,yt,!0),xt.getElevationAtPixel(wt,yt+st,!0),xt.getElevationAtPixel(wt+_t,yt+st,!0)]}(D,_e.x-fe,_e.y-we,Ee,Me),rt=Math.abs(De[0]-De[1]),Ne=Math.abs(De[2]-De[3]),at=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),ft=Math.min(.25,.5*ue*(rt+Ne)/Ee),pt=Math.min(.25,.5*ue*at/Me);return le+Math.max(ft*re,pt*te)}(d,g,x):E;return{base:E+(a===0?-1:a),top:C?Math.max(R+u,E+a+2):E+u}}class H9{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class W9{constructor(){this.tasks={},this.taskQueue=[],ze(["process"],this),this.invoker=new H9(this.process),this.nextId=0}add(r,a){const u=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-x:g==="maybePrepare"&&y?400-x:500:200-x:100-x}(a);if(d===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<a&&(a=g.priority,r=d)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class CD{constructor(r,a,u){this.target=r,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},ze(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new W9}send(r,a,u,d,g=!1,y){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[x]=u);const E=new Set;return this.target.postMessage({id:x,type:r,hasCallback:!!u,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:Pl(a,E)},E),{cancel:()=>{u&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(r){const a=r.data;if(!a)return;const u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(a.mustQueue||hn(self)){const d=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,a),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,a)}processTask(r,a){if(delete this.cancelCallbacks[r],a.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(a.error?u(Pc(a.error)):u(null,Pc(a.data)))}else{const u=new Set,d=a.hasCallback?(y,x)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?Pl(y):null,data:Pl(x,u)},u)}:()=>{},g=Pc(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,g,d);else if(this.parent.getWorkerSource){const y=a.type.split("."),{source:x,scope:E}=g;this.parent.getWorkerSource(a.sourceMapId,y[0],x,E)[y[1]](g,d)}else d(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var P_={workerUrl:"",workerClass:null,workerParams:void 0};const U2="mapboxgl_preloaded_worker_pool";class Xd{constructor(r){this.active={},this.name=r}acquire(r,a=Xd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;){const d=(u=`${this.name||""}WorkerPool: ${r}-${this.workers.length}`,P_.workerClass!=null?new P_.workerClass:new self.Worker(P_.workerUrl,Object.assign({name:u},P_.workerParams)));this.workers.push(d)}var u;return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[U2]}numActive(){return Object.keys(this.active).length}}Xd.workerCount=2;class um{constructor(r,a,u="Worker",d=Xd.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=je();const g=this.workerPool.acquire(this.id,d);for(let y=0;y<g.length;y++){const x=new um.Actor(g[y],a,this.id);x.name=`${u} ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,a,u){Oe(this.actors,(d,g)=>{d.send(r,a,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let C_,G2;function xb(){return C_||(C_=new Xd),C_}um.Actor=CD;const H2=4096;class q9{constructor(r){this.module=r,this.memoryStack=this.module.malloc(H2),this.memoryStackNextFree=this.memoryStack}createIntArray(r){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>H2?-1:(new Int32Array(this.module.heap32.buffer,a,r.length).set(r),a)}createFloatArray(r){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>H2?-1:(new Float32Array(this.module.heapF32.buffer,a,r.length).set(r),a)}readStringBuffer(r){let a="";for(;this.module.heapU8[r]!==0;)a+=String.fromCharCode(this.module.heapU8[r]),++r;return a}setStyle(r){const a=r.normalScale;this.module.setStyle(a[0],a[1],a[2],r.tileToMeters)}setAOOptions(r,a){this.module.setAOOptions(r?1:0,a)}setMetricOptions(r,a){this.module.setMetricOptions(r?1:0,a)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,a){this.module.setFacadeOptions(r,a?1:0)}setFauxFacadeOptions(r,a,u){this.module.setFauxFacadeOptions(r?1:0,a?1:0,u)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,a){this.memoryStackNextFree=this.memoryStack;for(const x of r){const E=this.createIntArray(x.ringIndices),C=this.createFloatArray(x.coordinates);if(E===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,x.roofType,C,E,x.ringIndices.length-1)}for(const x of a){let E;E=x.entrances?JSON.parse(x.entrances):[];const C=this.createFloatArray(E),R=this.createFloatArray(x.coordinates);if(C===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,C,E.length,R,x.coordinates.length)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const u=this.module.getMeshCount(),d=new Array(u);for(let x=0;x<u;x++){const E=this.module.getPositionsPtr(x),C=this.module.getPositionsLength(x),R=new Float32Array(this.module.heapF32.buffer,E,C),D=this.module.getNormalsPtr(x),j=this.module.getNormalsLength(x),V=new Float32Array(this.module.heapF32.buffer,D,j),$=this.module.getAOPtr(x),Z=this.module.getAOLength(x),re=new Float32Array(this.module.heapF32.buffer,$,Z),te=this.module.getUVPtr(x),le=this.module.getUVLength(x),ue=new Float32Array(this.module.heapF32.buffer,te,le),fe=this.module.getFauxFacadePtr(x),we=this.module.getFauxFacadeLength(x),_e=new Uint8Array(this.module.heapU8.buffer,fe,we),Ee=this.module.getIndicesPtr(x),Me=this.module.getIndicesLength(x),De=new Int16Array(this.module.heap16.buffer,Ee,Me),rt=this.module.getBuildingPart(x);d[x]={positions:R,normals:V,ao:re,uv:ue,isFauxFacade:_e,indices:De,buildingPart:rt}}const g=this.module.getRingCount(),y=[];for(let x=0;x<g;x++){const E=this.module.getRingPtr(x),C=this.module.getRingLength(x),R=new Float32Array(this.module.heapF32.buffer,E,C);y.push(R)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let I_,W2,Fl,hm,q2,dm=null,fm=null,ID=null,bb=null;function MD(){return hn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:W2||Jr.DRACO_URL}function OD(){if(hn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(hm)return hm;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return hm=WebAssembly.validate(l)?Jr.MESHOPT_SIMD_URL:Jr.MESHOPT_URL,hm}function Z9(){return bb}const wb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},X9={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},M_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function RD(l,r,a){const u=a.json.bufferViews.length,d=a.buffers.length;r.bufferView=u,a.json.bufferViews[u]={buffer:d,byteLength:l.byteLength},a.buffers[d]=l}const Z2="KHR_draco_mesh_compression";function K9(l,r){const a=l.extensions&&l.extensions[Z2];if(!a)return;const u=new Fl.Decoder,d=LD(r,a.bufferView),g=new Fl.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=r.json.accessors[l.indices],x=wb[y.componentType],E=y.count*x.BYTES_PER_ELEMENT,C=Fl._malloc(E);x===Uint16Array?u.GetTrianglesUInt16Array(g,E,C):u.GetTrianglesUInt32Array(g,E,C),RD(Fl.memory.buffer.slice(C,C+E),y,r),Fl._free(C);for(const R of Object.keys(a.attributes)){const D=u.GetAttributeByUniqueId(g,a.attributes[R]),j=r.json.accessors[l.attributes[R]],V=X9[j.componentType],$=j.count*M_[j.type]*wb[j.componentType].BYTES_PER_ELEMENT,Z=Fl._malloc($);u.GetAttributeDataArrayForAllPoints(g,D,Fl[V],$,Z),RD(Fl.memory.buffer.slice(Z,Z+$),j,r),Fl._free(Z)}u.destroy(),g.destroy(),delete l.extensions[Z2]}const Tb="EXT_meshopt_compression";function Y9(l,r){if(!l.extensions||!l.extensions[Tb])return;const a=l.extensions[Tb],u=new Uint8Array(r.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),d=new Uint8Array(a.count*a.byteStride);q2.decodeGltfBuffer(d,a.count,a.byteStride,u,a.mode,a.filter),l.buffer=r.buffers.length,l.byteOffset=0,r.buffers[l.buffer]=d.buffer,delete l.extensions[Tb]}const DD=1179937895,kD=new TextDecoder("utf8");function jD(l,r){return new URL(l,r).href}function J9(l,r,a,u){return fetch(jD(l.uri,u)).then(d=>d.arrayBuffer()).then(d=>{r.buffers[a]=d})}function LD(l,r){const a=l.json.bufferViews[r];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function Q9(l,r,a,u){if(l.uri){const d=jD(l.uri,u);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{r.images[a]=g})}if(l.bufferView!==void 0){const d=LD(r,l.bufferView),g=new Blob([d],{type:l.mimeType});return createImageBitmap(g).then(y=>{r.images[a]=y})}}function ND(l,r=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(l,r,1)[0]===DD){const R=new Uint32Array(l,r);let D=2;const j=(R[D++]>>2)-3,V=R[D++]>>2;if(D++,u.json=JSON.parse(kD.decode(R.subarray(D,D+V))),D+=V,D<j){const $=R[D++];D++;const Z=r+(D<<2);u.buffers[0]=l.slice(Z,Z+$)}}else u.json=JSON.parse(kD.decode(new Uint8Array(l,r)));const{buffers:d,images:g,meshes:y,extensionsUsed:x,bufferViews:E}=u.json;let C=Promise.resolve();if(d){const R=[];for(let D=0;D<d.length;D++){const j=d[D];j.uri?R.push(J9(j,u,D,a)):u.buffers[D]||(u.buffers[D]=null)}C=Promise.all(R)}return C.then(()=>{const R=[],D=x&&x.includes(Z2),j=x&&x.includes(Tb);if(D&&R.push(function(){if(!Fl)return I_??(I_=function(V){let $,Z=null;function re(){$=new Uint8Array(Z.buffer)}function te(){throw new Error("Unexpected Draco error.")}const le={a:{a:te,d:function(ue,fe,we){return $.copyWithin(ue,fe,fe+we)},c:function(ue){const fe=$.length,we=Math.max(ue>>>0,Math.ceil(1.2*fe)),_e=Math.ceil((we-fe)/65536);try{return Z.grow(_e),re(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,le):V.then(ue=>ue.arrayBuffer()).then(ue=>WebAssembly.instantiate(ue,le))).then(ue=>{const{Rb:fe,Qb:we,P:_e,T:Ee,X:Me,Ja:De,La:rt,Qa:Ne,Va:at,Wa:ft,eb:pt,jb:xt,f:wt,e:yt,yb:_t,zb:st,Ab:it,Bb:vt,Db:Ot,Gb:At}=ue.instance.exports;Z=yt;const or=(()=>{let Ft=0,Ht=0,Qt=0,Gr=0;return Pt=>{Qt&&(fe(Gr),fe(Ft),Ht+=Qt,Qt=Ft=0),Ft||(Ht+=128,Ft=we(Ht));const er=Pt.length+7&-8;let Pr=Ft;er>=Ht&&(Qt=er,Pr=Gr=we(er));for(let en=0;en<Pt.length;en++)$[Pr+en]=Pt[en];return Pr}})();return re(),wt(),{memory:yt,_free:fe,_malloc:we,Mesh:class{constructor(){this.ptr=_e()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){xt(this.ptr)}DecodeArrayToMesh(Ft,Ht,Qt){const Gr=or(Ft),Pt=rt(this.ptr,Gr,Ht,Qt.ptr);return!!Me(Pt)}GetAttributeByUniqueId(Ft,Ht){return{ptr:Ne(this.ptr,Ft.ptr,Ht)}}GetTrianglesUInt16Array(Ft,Ht,Qt){at(this.ptr,Ft.ptr,Ht,Qt)}GetTrianglesUInt32Array(Ft,Ht,Qt){ft(this.ptr,Ft.ptr,Ht,Qt)}GetAttributeDataArrayForAllPoints(Ft,Ht,Qt,Gr,Pt){pt(this.ptr,Ft.ptr,Ht.ptr,Qt,Gr,Pt)}},DT_INT8:_t(),DT_UINT8:st(),DT_INT16:it(),DT_UINT16:vt(),DT_UINT32:Ot(),DT_FLOAT32:At()}})}(fetch(MD())),I_.then(V=>{Fl=V,I_=void 0}))}()),j&&R.push(function(){if(q2)return;const V=function($){let Z;const re=WebAssembly.instantiateStreaming($,{}).then(ue=>{Z=ue.instance,Z.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(ue,fe,we,_e,Ee,Me){(function(De,rt,Ne,at,ft,pt,xt){const wt=De.exports.sbrk,yt=at+3&-4,_t=wt(yt*ft),st=wt(pt.length),it=new Uint8Array(De.exports.memory.buffer);it.set(pt,st);const vt=rt(_t,at,ft,st,pt.length);if(vt===0&&xt&&xt(_t,yt,ft),Ne.set(it.subarray(_t,_t+at*ft)),wt(_t-wt(0)),vt!==0)throw new Error(`Malformed buffer data: ${vt}`)})(Z,Z.exports[le[Ee]],ue,fe,we,_e,Z.exports[te[Me]])}}}(fetch(OD()));return V.ready.then(()=>{q2=V})}()),g)for(let V=0;V<g.length;V++)R.push(Q9(g[V],u,V,a));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(D&&y)for(const{primitives:V}of y)for(const $ of V)K9($,u);if(j&&y&&E)for(const V of E)Y9(V,u);return u})})}function zD(l){return fetch(l).then(r=>r.arrayBuffer()).then(r=>ND(r,0,l))}function X2(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function K2(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Y2{constructor(r,a,u,d){this.context=r,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=r.gl.createTexture(),this.update(a,{premultiply:d&&d.premultiply})}update(r,a){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,d=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:g}=this,{gl:y}=g,{x,y:E}=a&&a.position?a.position:{x:0,y:0},C=x+u,R=E+d;!this.size||this.size[0]===C&&this.size[1]===R||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const D=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&C>0&&R>0){const j=this.useMipmap?Math.floor(Math.log2(Math.max(C,R)))+1:1;y.texStorage2D(y.TEXTURE_2D,j,this.format,C,R),this.size=[C,R]}this.size&&(D?y.texSubImage2D(y.TEXTURE_2D,0,x,E,X2(this.format),K2(this.format),r):"data"in r&&r.data&&y.texSubImage2D(y.TEXTURE_2D,0,x,E,u,d,X2(this.format),K2(this.format),r.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(r,a,u=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),a!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(r,a,u,d,g){const{context:y}=this,{gl:x}=y;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),this.magFilter=a),r!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?r===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,g)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=g)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class O_{constructor(r,a){this.context=r,this.texture=a}bind(r,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,r),this.minFilter=r),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}}const e7=Xr([{name:"a_pos_3f",components:3,type:"Float32"}]),t7=Xr([{name:"a_color_3f",components:3,type:"Float32"}]),r7=Xr([{name:"a_color_4f",components:4,type:"Float32"}]),n7=Xr([{name:"a_uv_2f",components:2,type:"Float32"}]),i7=Xr([{name:"a_normal_3f",components:3,type:"Float32"}]),o7=Xr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),s7=Xr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function FD(l,r){const a=Sb(l.projection,l.zoom,l.width,l.height),u=function(g,y,x,E,C){const R=new c(x.lng-180*Ah,x.lat),D=new c(x.lng+180*Ah,x.lat),j=g.project(R.lng,R.lat),V=g.project(D.lng,D.lat),$=-Math.atan2(V.y-j.y,V.x-j.x),Z=he.fromLngLat(x);Z.y=ne(Z.y,-1+Ah,1-Ah);const re=Z.toLngLat(),te=g.project(re.lng,re.lat),le=he.fromLngLat(re);le.x+=Ah;const ue=le.toLngLat(),fe=g.project(ue.lng,ue.lat),we=VD(fe.x-te.x,fe.y-te.y,$),_e=he.fromLngLat(re);_e.y+=Ah;const Ee=_e.toLngLat(),Me=g.project(Ee.lng,Ee.lat),De=VD(Me.x-te.x,Me.y-te.y,$),rt=Math.abs(we.x)/Math.abs(De.y),Ne=U([]);pe(Ne,Ne,-$*(1-(C?0:E)));const at=U([]);return ie(at,at,[1,1-(1-rt)*E,1]),at[4]=-De.x/De.y*E,pe(at,at,$),J(at,Ne,at),at}(l.projection,0,l.center,a,r),d=BD(l);return ie(u,u,[d,d,1]),u}function BD(l){const r=l.projection,a=Sb(l.projection,l.zoom,l.width,l.height),u=J2(r,l.center),d=J2(r,c.convert(r.center));return Math.pow(2,u*a+(1-a)*d)}function Sb(l,r,a,u,d=1/0){const g=l.range;if(!g)return 0;const y=Math.min(d,Math.max(a,u)),x=Math.log2(y/1024);return ce(g[0]+x,g[1]+x,r)}const Ah=1/4e4;function J2(l,r){const a=ne(r.lat,-q,q),u=new c(r.lng-180*Ah,a),d=new c(r.lng+180*Ah,a),g=l.project(u.lng,a),y=l.project(d.lng,a),x=he.fromLngLat(u),E=he.fromLngLat(d),C=y.x-g.x,R=y.y-g.y,D=E.x-x.x,j=E.y-x.y,V=Math.sqrt((D*D+j*j)/(C*C+R*R));return Math.log2(V)}function VD(l,r,a){const u=Math.cos(a),d=Math.sin(a);return{x:l*u-r*d,y:l*d+r*u}}function $D(l,r,a){U(l),pe(l,l,qr(r[2])),Q(l,l,qr(r[0])),ae(l,l,qr(r[1])),ie(l,l,a),J(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Eb(l,r,a,u,d,g,y,x){const E=[a[0]-r[0],a[1]-r[1],0],C=[u[0]-r[0],u[1]-r[1],0];if(ct(E)<1e-12||ct(C)<1e-12)return wo(l);const R=pr([],E,C);Lt(R,R),nt(C,u,r),E[2]=(g-d)*x,C[2]=(y-d)*x;const D=E;return pr(D,E,C),Lt(D,D),qt(l,R,D)}function Ab(l,r,a=!1){const u=Sh(r.zoom),d=function(g,y,x){const E=y.worldSize,C=[g[12],g[13],g[14]],R=W(C[1]/E),D=N(C[0]/E),j=U([]),V=k(1,R)*E,$=k(1,0)*E*Y(R,y.zoom),Z=1/P2(E);let re=$*Z;if(x){const fe=Sb(y.projection,y.zoom,y.width,y.height,1024);re=Z*y.projection.pixelSpaceConversion(y.center.lat,E,fe)}const te=bh(R,D);ut(te,te,Vt([],Lt([],te),V*re*C[2]));const le=function(fe){const we=[fe[0],fe[1],fe[2]];let _e=[0,1,0];const Ee=pr([],_e,we);return pr(_e,we,Ee),lr(_e)===0&&(_e=[0,1,0],pr(Ee,we,_e)),Lt(Ee,Ee),Lt(_e,_e),Lt(we,we),[Ee[0],Ee[1],Ee[2],0,_e[0],_e[1],_e[2],0,we[0],we[1],we[2],0,fe[0],fe[1],fe[2],1]}(te);ie(j,j,[re,re,re*V]),X(j,j,[-C[0],-C[1],-C[2]]);const ue=J([],y.globeMatrix,le);return J(ue,ue,j),J(ue,ue,g),ue}(l,r,a);if(u>0){const g=function(y,x){const E=x.worldSize,C=k(1,0)*E*Y(x.center.lat,x.zoom)/P2(E),R=k(1,x.center.lat)*E,D=U([]);ae(D,D,qr(x.center.lng)),Q(D,D,qr(x.center.lat)),X(D,D,[0,0,Go]),ie(D,D,[C,C,C*R]);const j=x.point;return X(D,D,[-j.x,-j.y,0]),J(D,D,y),J(D,x.globeMatrix,D)}(l,r);return function(y,x,E){const C=($,Z,re)=>{const te=ct($),le=ct(Z),ue=zl($,Z,re);return Vt(ue,ue,1/ct(ue)*vr(te,le,re))},R=C([y[0],y[1],y[2]],[x[0],x[1],x[2]],E),D=C([y[4],y[5],y[6]],[x[4],x[5],x[6]],E),j=C([y[8],y[9],y[10]],[x[8],x[9],x[10]],E),V=zl([y[12],y[13],y[14]],[x[12],x[13],x[14]],E);return[R[0],R[1],R[2],0,D[0],D[1],D[2],0,j[0],j[1],j[2],0,V[0],V[1],V[2],1]}(d,g,u)}return d}function Q2(l,r,a,u){const d=rr.projectAabbCorners(u,a);let g=Number.MAX_VALUE;for(let x=0;x<d.length;++x){const E=d[x];E[0]=(.5*E[0]+.5)*r.width,E[1]=(.5-.5*E[1])*r.height,E[2]<g&&(g=E[2])}const y=function(x){const E=[];let C=0;for(let V=1;V<x.length;V++)(x[V][0]<x[C][0]||x[V][0]===x[C][0]&&x[V][1]<x[C][1])&&(C=V);let R,D=C;const j=new Uint8Array(x.length);do{if(j[D])break;E.push(new mt(x[D][0],x[D][1])),j[D]=1,R=(D+1)%x.length;for(let V=0;V<x.length;V++){if(x[V][0]===x[R][0]&&x[V][1]===x[R][1]||x[V][0]===x[D][0]&&x[V][1]===x[D][1])continue;const $=[x[V][0]-x[D][0],x[V][1]-x[D][1]],Z=[x[R][0]-x[D][0],x[R][1]-x[D][1]],re=$[0]*Z[1]-$[1]*Z[0];(re>0||re===0&&$[0]*Z[0]+$[1]*Z[1]>=0&&$[0]*$[0]+$[1]*$[1]>Z[0]*Z[0]+Z[1]*Z[1])&&(R=V)}D=R}while(D!==C);return E.length>0&&E.push(E[0]),E}(d);if(yn(l,y))return g}const Kd=64,pm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Pb(l,r,a,u,d,g,y,x,E,C=!1){const R=a.zoom,D=a.project(u),j=Y(u.lat,R),V=1/j;U(l),X(l,l,[D.x+y[0]*V,D.y+y[1]*V,y[2]]);let $=1,Z=1;const re=a.worldSize;if(C){if(a.projection.name==="mercator"){let fe=0;a.elevation&&(fe=a.elevation.getAtPointOrZero(new he(D.x/re,D.y/re),0));const we=Hi([],[D.x,D.y,fe,1],a.projMatrix)[3]/a.cameraToCenterDistance;$=we,Z=we*Y(a.center.lat,R)}else if(a.projection.name==="globe"){const fe=Ab(l,a),we=[0,0,0,1];Hi(we,we,J([],a.projMatrix,fe));const _e=we[3]/a.cameraToCenterDistance,Ee=Sh(R),Me=a.projection.pixelsPerMeter(u.lat,re)*Y(u.lat,R),De=a.projection.pixelsPerMeter(a.center.lat,re)*Y(a.center.lat,R);$=_e/vr(Me,ee(a.center.lat),Ee),Z=_e*j/Me,$*=De,Z*=De}}else $=V;ie(l,l,[$,$,Z]);const te=[...l],le=r.orientation,ue=[];if($D(ue,[le[0]+(d?d[0]:0),le[1]+(d?d[1]:0),le[2]+(d?d[2]:0)],g),J(l,te,ue),x&&a.elevation){let fe=0;const we=[];if(E&&a.elevation){fe=function(Ee,Me,De,rt,Ne){const at=Me.elevation;if(!at)return 0;const ft=rr.projectAabbCorners(De,rt),pt=k(1,Ne.lat)*Me.worldSize,xt=function(Ht,Qt){const Gr=[0,0,1],Pt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const er of Pt){const Pr=Ht[er.corners[0]],en=Ht[er.corners[1]],sn=Ht[er.corners[2]],kr=[en[0]-Pr[0],en[1]-Pr[1],Qt*(en[2]-Pr[2])],Vn=pr(kr,kr,[sn[0]-Pr[0],sn[1]-Pr[1],Qt*(sn[2]-Pr[2])]);Lt(Vn,Vn),er.dotProductWithUp=nr(Vn,Gr)}return Pt.sort((er,Pr)=>er.dotProductWithUp-Pr.dotProductWithUp),Pt[0].corners}(ft,pt),wt=ft[xt[0]],yt=ft[xt[1]],_t=ft[xt[2]],st=ft[xt[3]],it=at.getAtPointOrZero(new he(wt[0]/Me.worldSize,wt[1]/Me.worldSize),0),vt=at.getAtPointOrZero(new he(yt[0]/Me.worldSize,yt[1]/Me.worldSize),0),Ot=at.getAtPointOrZero(new he(_t[0]/Me.worldSize,_t[1]/Me.worldSize),0),At=at.getAtPointOrZero(new he(st[0]/Me.worldSize,st[1]/Me.worldSize),0),or=(it+At)/2,Ft=(vt+Ot)/2;return or>Ft?vt<Ot?Eb(Ee,yt,st,wt,vt,At,it,pt):Eb(Ee,_t,wt,st,Ot,it,At,pt):it<At?Eb(Ee,wt,yt,_t,it,vt,Ot,pt):Eb(Ee,st,_t,yt,At,Ot,vt,pt),Math.max(or,Ft)}(we,a,r.aabb,l,u);const _e=J([],Be([],we),ue);J(l,te,_e)}else fe=a.elevation.getAtPointOrZero(new he(D.x/re,D.y/re),0);fe!==0&&(l[14]+=fe)}}class UD{constructor(r,a,u,d,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=r,this.uri=a,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=d??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,a){J(r.globalMatrix,a,r.localMatrix);const u=this.nodeOverrides.get(r.name);if(u!==void 0){const y=[];g=u.orientation,U(d=y),ae(d,d,qr(g[1])),pe(d,d,qr(g[2])),Q(d,d,qr(g[0])),J(r.globalMatrix,r.globalMatrix,y)}var d,g;if(r.meshes)for(const y of r.meshes){const x=rr.applyTransformFast(y.aabb,r.globalMatrix);this.aabb.encapsulate(x)}if(r.children)for(const y of r.children)this._applyTransformations(y,r.globalMatrix)}computeBoundsAndApplyParent(){const r=U([]);this.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,r)}computeModelMatrix(r,a,u,d,g,y,x=!1){Pb(this.matrix,this,r.transform,this.position,a,u,d,g,y,x)}upload(r){if(!this.uploaded){for(const a of this.nodes)eE(a,r);for(const a of this.nodes)Cb(a);this.uploaded=!0}}destroy(){for(const r of this.nodes)tE(r)}}function R_(l,r,a=!1){l.uploaded||(l.gfxTexture=new Y2(r,l.image,a?r.gl.R8:r.gl.RGBA8,{useMipmap:l.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function a7(l,r,a){l.indexBuffer=r.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=r.createVertexBuffer(l.vertexArray,e7.members,!1,!0),l.normalArray&&(l.normalBuffer=r.createVertexBuffer(l.normalArray,i7.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=r.createVertexBuffer(l.texcoordArray,n7.members,!1,!0)),l.colorArray&&(l.colorBuffer=r.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?t7:r7).members,!1,!0)),l.featureArray&&(l.pbrBuffer=r.createVertexBuffer(l.featureArray,s7.members,!0)),l.segments=gi.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const u=l.material;u.pbrMetallicRoughness.baseColorTexture&&R_(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&R_(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&R_(u.normalTexture,r),u.occlusionTexture&&R_(u.occlusionTexture,r,a),u.emissionTexture&&R_(u.emissionTexture,r)}function eE(l,r,a){if(l.meshes)for(const u of l.meshes)a7(u,r,a);if(l.children)for(const u of l.children)eE(u,r,a)}function Cb(l){if(l.meshes)for(const r of l.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(l.children)for(const r of l.children)Cb(r)}function tE(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((r=a.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(l.children)for(const a of l.children)tE(a)}function Yd(l,r){const a=l.json.bufferViews[r.bufferView],u=wb[r.componentType];return new u(l.buffers[a.buffer],(r.byteOffset||0)+(a.byteOffset||0),r.count*(a.byteStride&&a.byteStride!==M_[r.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:M_[r.type]))}function rE(l,r,a,u){const d=wb[r.componentType],g=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),y=l.json.bufferViews[r.bufferView],x=y.byteStride?y.byteStride/d.BYTES_PER_ELEMENT:M_[r.type],E=a.float32,C=E.length/a.capacity;for(let R=0,D=0;R<r.count*x;R+=x,D+=C)for(let j=0;j<C;j++)E[D+j]=u[R+j]*g;a._trim()}function l7(l,r,a){const u=l.indices,d=l.attributes,g={};g.indexArray=new to;const y=r.json.accessors[u],x=y.count/3;g.indexArray.reserve(x);const E=Yd(r,y);for(let j=0;j<x;j++)g.indexArray.emplaceBack(E[3*j],E[3*j+1],E[3*j+2]);g.indexArray._trim(),g.vertexArray=new Zs;const C=r.json.accessors[d.POSITION];g.vertexArray.reserve(C.count);const R=Yd(r,C);for(let j=0;j<C.count;j++)g.vertexArray.emplaceBack(R[3*j],R[3*j+1],R[3*j+2]);if(g.vertexArray._trim(),g.aabb=new rr(C.min,C.max),g.centroid=function(j,V){const $=[0,0,0],Z=j.length;if(Z>0){for(let re=0;re<Z;re++){const te=3*j[re];$[0]+=V[te],$[1]+=V[te+1],$[2]+=V[te+2]}$[0]/=Z,$[1]/=Z,$[2]/=Z}return $}(E,R),d.COLOR_0!==void 0){const j=r.json.accessors[d.COLOR_0],V=M_[j.type],$=Yd(r,j);g.colorArray=V===3?new Zs:new Ic,g.colorArray.resize(j.count),rE(r,j,g.colorArray,$)}if(d.NORMAL!==void 0){g.normalArray=new Zs;const j=r.json.accessors[d.NORMAL];g.normalArray.resize(j.count);const V=Yd(r,j);rE(r,j,g.normalArray,V)}if(d.TEXCOORD_0!==void 0&&a.length>0){g.texcoordArray=new Qa;const j=r.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(j.count);const V=Yd(r,j);rE(r,j,g.texcoordArray,V)}if(d._FEATURE_ID_RGBA4444!==void 0){const j=r.json.accessors[d._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Yd(r,j))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Yd(r,r.json.accessors[d._FEATURE_RGBA4444]).buffer));const D=l.material;return g.material=function(j,V){const{emissiveFactor:$=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:re=.5,normalTexture:te,occlusionTexture:le,emissiveTexture:ue,doubleSided:fe,name:we}=j,{baseColorFactor:_e=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Me=1,baseColorTexture:De,metallicRoughnessTexture:rt}=j.pbrMetallicRoughness||{},Ne=le?V[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Ne){const at=le.extensions.KHR_texture_transform;Ne.offsetScale=[at.offset[0],at.offset[1],at.scale[0],at.scale[1]]}return{name:we,pbrMetallicRoughness:{baseColorFactor:new Dn(..._e),metallicFactor:Ee,roughnessFactor:Me,baseColorTexture:De?V[De.index]:void 0,metallicRoughnessTexture:rt?V[rt.index]:void 0},doubleSided:fe,emissiveFactor:new Dn(...$),alphaMode:Z,alphaCutoff:re,normalTexture:te?V[te.index]:void 0,occlusionTexture:Ne,emissionTexture:ue?V[ue.index]:void 0,defined:j.defined===void 0}}(D!==void 0?r.json.materials[D]:{defined:!1},a),g}function GD(l,r,a){const{matrix:u,rotation:d,translation:g,scale:y,mesh:x,extras:E,children:C,name:R}=l,D={};if(D.name=R,D.localMatrix=u||function(j,V,$,Z){var re=V[0],te=V[1],le=V[2],ue=V[3],fe=re+re,we=te+te,_e=le+le,Ee=re*fe,Me=re*we,De=re*_e,rt=te*we,Ne=te*_e,at=le*_e,ft=ue*fe,pt=ue*we,xt=ue*_e,wt=Z[0],yt=Z[1],_t=Z[2];return j[0]=(1-(rt+at))*wt,j[1]=(Me+xt)*wt,j[2]=(De-pt)*wt,j[3]=0,j[4]=(Me-xt)*yt,j[5]=(1-(Ee+at))*yt,j[6]=(Ne+ft)*yt,j[7]=0,j[8]=(De+pt)*_t,j[9]=(Ne-ft)*_t,j[10]=(1-(Ee+rt))*_t,j[11]=0,j[12]=$[0],j[13]=$[1],j[14]=$[2],j[15]=1,j}([],d||[0,0,0,1],g||[0,0,0],y||[1,1,1]),D.globalMatrix=F(D.localMatrix),x!==void 0){D.meshes=a[x];const j=D.anchor=[0,0];for(const V of D.meshes){const{min:$,max:Z}=V.aabb;j[0]+=$[0]+Z[0],j[1]+=$[1]+Z[1]}j[0]=Math.floor(j[0]/D.meshes.length/2),j[1]=Math.floor(j[1]/D.meshes.length/2)}if(E&&(E.id&&(D.id=E.id),E.lights&&(D.lights=function(j){if(!j.length)return[];const V=function(le){const ue=atob(le),fe=new Uint8Array(ue.length);for(let we=0;we<ue.length;we++)fe[we]=ue.codePointAt(we);return fe}(j),$=[],Z=V.length/24,re=new Uint16Array(V.buffer),te=new Float32Array(V.buffer);for(let le=0;le<Z;le++){const ue=re[2*le*6]/30,fe=re[2*le*6+1]/30,we=re[2*le*6+10]/100,_e=te[6*le+1],Ee=te[6*le+2],Me=te[6*le+3],De=te[6*le+4],rt=Me-_e,Ne=De-Ee,at=Math.hypot(rt,Ne);$.push({pos:[_e+.5*rt,Ee+.5*Ne,fe],normal:[Ne/at,-rt/at,0],width:at,height:ue,depth:we,points:[_e,Ee,Me,De]})}return $}(E.lights)),E.MAPBOX_geometry_bloom&&(D.isGeometryBloom=E.MAPBOX_geometry_bloom)),C){const j=[];for(const V of C)j.push(GD(r.json.nodes[V],r,a));D.children=j}return D}function c7(l){if(l.vertices.length===0||l.indices.length===0)return null;const r=new pb(l.vertices,l.indices,8,256),[a,u]=[r.min.clone(),r.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:r,min:a,max:u}}function u7(l){if(!l.extras||!l.extras.ground)return null;const r=l.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const a=r[0];if(!a||!Array.isArray(a)||a.length===0)return null;const u=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const x=y[0],E=y[1];typeof x=="number"&&typeof E=="number"&&u.push(new mt(x,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let y=0;y<u.length;y++){const x=u[y],E=u[(y+1)%u.length],C=u[(y+2)%u.length];d+=(x.x-E.x)*(C.y-E.y)-(C.x-E.x)*(x.y-E.y)}d>0&&u.reverse();const g=lm(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function h7(l,r){const a=[],u=[];let d=0;const g=[];for(const y of l){d=a.length;const x=y.vertexArray.float32,E=y.indexArray.uint16;for(let C=0;C<y.vertexArray.length;C++)g[0]=x[3*C+0],g[1]=x[3*C+1],g[2]=x[3*C+2],Nr(g,g,r),a.push(new mt(g[0],g[1]));for(let C=0;C<3*y.indexArray.length;C++)u.push(E[C]+d)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const x=a[u[y+0]],E=a[u[y+1]],C=a[u[y+2]];(x.x-E.x)*(C.y-E.y)-(C.x-E.x)*(x.y-E.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:a,indices:u}}function nE(l){const r=function(E,C){const R=[],D=WebGL2RenderingContext;if(E.json.textures)for(const j of E.json.textures){const V={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};j.sampler!==void 0&&Object.assign(V,E.json.samplers[j.sampler]),R.push({image:C[j.source],sampler:V,uploaded:!1})}return R}(l,l.images),a=function(E,C){const R=[];for(const D of E.json.meshes){const j=[];for(const V of D.primitives)j.push(l7(V,E,C));R.push(j)}return R}(l,r),{scenes:u,scene:d,nodes:g}=l.json,y=u?u[d||0].nodes:[...g.keys()],x=[];for(const E of y)x.push(GD(g[E],l,a));return function(E,C,R){const D={},j=new Set;for(let V=0;V<E.length;V++){const $=R[C[V]];if(!$.extras)continue;const Z=$.extras["mapbox:footprint:version"],re=$.extras["mapbox:footprint:id"];(Z||re)&&j.add(V),Z==="1.0.0"&&re&&(D[re]=V)}for(let V=0;V<E.length;V++){if(j.has(V))continue;const $=E[V],Z=R[C[V]];if(!Z.extras)continue;let re=null;$.id in D&&(re=h7(E[D[$.id]].meshes,$.localMatrix)),re||(re=u7(Z)),re&&($.footprint=c7(re))}if(j.size>0){const V=Array.from(j.values()).sort(($,Z)=>$-Z);for(let $=V.length-1;$>=0;$--)E.splice(V[$],1)}}(x,y,l.json.nodes),x}function d7(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const r=l.vertexArray.float32,a=l.aabb.min[0]-1,u=l.aabb.min[1]-1,d=Kd/(l.aabb.max[0]-a+2),g=Kd/(l.aabb.max[1]-u+2);for(let y=0;y<r.length;y+=3){const x=r[y+2],E=(r[y+0]-a)*d|0,C=(r[y+1]-u)*g|0;x>l.heightmap[C*Kd+E]&&(l.heightmap[C*Kd+E]=x)}}function HD(l,r,a,u,d){a.reserve(a.length+4*l.length),u.reserve(u.length+10*l.length),d.reserve(d.length+10*l.length);let g=u.length;for(const y of l){const x=Math.min(10,Math.max(4,1.3*y.height))*r,E=[-y.normal[1],y.normal[0],0],C=Math.min(.29,.1*y.width/y.depth),R=y.width-2*y.depth*r*(C+.01),D=xr([],y.pos,E,R/2),j=xr([],y.pos,E,-R/2),V=[D[0],D[1],D[2]+y.height],$=[j[0],j[1],j[2]+y.height],Z=xr([],y.normal,E,C);Vt(Z,Z,x);const re=xr([],y.normal,E,-C);Vt(re,re,x),ut(Z,D,Z),ut(re,j,re),D[2]+=.1,j[2]+=.1,u.emplaceBack(Z[0],Z[1],Z[2]),u.emplaceBack(re[0],re[1],re[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(V[0],V[1],V[2]),u.emplaceBack($[0],$[1],$[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(Z[0],Z[1],Z[2]),u.emplaceBack(re[0],re[1],re[2]);const te=R/x/2;d.emplaceBack(-te-C,-1,te,.8),d.emplaceBack(te+C,-1,te,.8),d.emplaceBack(-te,0,te,1.3),d.emplaceBack(te,0,te,1.3),d.emplaceBack(te+C,-.8,te,.7),d.emplaceBack(te+C,-.8,te,.7),d.emplaceBack(0,0,te,1.3),d.emplaceBack(0,0,te,1.3),d.emplaceBack(te+C,-1.2,te,.8),d.emplaceBack(te+C,-1.2,te,.8),a.emplaceBack(6+g,4+g,8+g),a.emplaceBack(7+g,9+g,5+g),a.emplaceBack(0+g,1+g,2+g),a.emplaceBack(1+g,3+g,2+g),g+=10}}function f7(l,r){const a={};a.indexArray=new to,a.vertexArray=new Zs,a.colorArray=new Ic,HD(l,r,a.indexArray,a.vertexArray,a.colorArray);const u={defined:!0};u.emissiveFactor=Dn.black;const d={};return d.baseColorFactor=Dn.white,u.pbrMetallicRoughness=d,a.material=u,a.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const WD=Xr([{name:"a_pos_3f",components:3,type:"Float32"}]),p7=Xr([{name:"a_normal_3",components:3,type:"Int16"}]),m7=Xr([{name:"a_centroid_3",components:3,type:"Int16"}]),qD=Xr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),g7=Xr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),y7=Xr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),_7=Xr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),v7=Xr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),x7=Xr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),ZD=ke.types,Ib=32767;function b7(l,r){const a=Mt+r;for(const u of l)for(const d of u)if(d.x<-r||d.x>a||d.y<-r||d.y>a)return!1;return!0}function w7(l){switch(l){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${l}`)}}class iE{constructor(){this.layoutVertexArray=new Zs,this.layoutAttenuationArray=new Ic,this.layoutColorArray=new Xs,this.indexArray=new to,this.indexArrayForConflation=new to,this.segmentsBucket=new gi}}class oE{constructor(r){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new gi,this.entranceBloom=new iE;const a=66560;this.layoutVertexArray=new Zs,this.layoutVertexArray.reserve(a),this.layoutNormalArray=new mh,this.layoutNormalArray.reserve(a),this.layoutCentroidArray=new mh,this.layoutCentroidArray.reserve(a),this.layoutColorArray=new Xs,this.layoutColorArray.reserve(a),this.layoutFloodLightDataArray=new Mc,this.layoutFloodLightDataArray.reserve(a),this.layoutAOArray=new Kp,this.layoutAOArray.reserve(a),this.indexArray=new to,this.indexArray.reserve(66560),this.indexArrayForConflation=new to,this.segmentsBucket=new gi,this.entranceBloom=new iE,r&&(this.layoutFacadePaintArray=new Xs,this.layoutFacadeDataArray=new vu,this.layoutFacadeVerticalRangeArray=new Xs)}reserve(r,a,u){this.layoutVertexArray.reserveForAdditional(r),this.layoutCentroidArray.reserveForAdditional(r),this.layoutFloodLightDataArray.reserveForAdditional(r),this.layoutNormalArray.reserveForAdditional(r),this.layoutAOArray.reserveForAdditional(r),this.layoutColorArray.reserveForAdditional(r),this.indexArray.reserveForAdditional(a),u&&(this.layoutFacadePaintArray.reserveForAdditional(r),this.layoutFacadeDataArray.reserveForAdditional(r),this.layoutFacadeVerticalRangeArray.reserveForAdditional(r))}}class XD{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Qa,this.footprintsIndices=new Mc,this.footprintsMin=new mt(1/0,1/0),this.footprintsMax=new mt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new oE(!1),this.buildingWithFacade=new oE(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection,this.groundEffect=new V2(r),this.groundEffect.groundRadiusArray=new Ol,this.hasAppearances=null}updateFootprints(r,a){const u=new pb([],[],1),d={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};a.push({footprint:d,id:r})}updateAppearances(r,a,u,d){}prepare(){return function(){if(bb!=null||ID!=null)return null;if(fm!=null)return fm;const r=fetch(Jr.BUILDING_GEN_URL);return fm=function(a){let u,d,g,y,x;function E(){u=new Uint8Array(x.buffer),d=new Int16Array(x.buffer),g=new Int32Array(x.buffer),y=new Float32Array(x.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const R=()=>{},D={a:{a:C,f:function(j){const V=u.length,$=Math.max(j>>>0,Math.ceil(1.2*V)),Z=Math.ceil(($-V)/65536);try{return x.grow(Z),E(),!0}catch{return!1}},g:C,b:R,c:R,d:R,e:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,D):a.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,D))).then(j=>{const V=j.instance.exports;return(0,V.g)(),x=V.f,E(),new q9({setStyle:V.h,setAOOptions:V.i,setMetricOptions:V.j,setStructuralOptions:V.k,setFacadeOptions:V.l,setFauxFacadeOptions:V.m,setFacadeClassifierOptions:V.n,addFeature:V.o,addFacade:V.p,generateMesh:V.q,getLastError:V.r,getOuterRingLength:V.s,getMeshCount:V.t,getPositionsPtr:V.u,getPositionsLength:V.v,getNormalsPtr:V.w,getNormalsLength:V.x,getAOPtr:V.y,getAOLength:V.z,getUVPtr:V.A,getUVLength:V.B,getFauxFacadePtr:V.C,getFauxFacadeLength:V.D,getIndicesPtr:V.E,getIndicesLength:V.F,getBuildingPart:V.G,getRingCount:V.H,getRingPtr:V.I,getRingLength:V.J,malloc:V.K,free:V.L,heapU8:u,heap16:d,heap32:g,heapF32:y})})}(r).then(a=>(fm=null,bb=a,bb)).catch(a=>{Ut("Could not load building-gen"),fm=null,ID=a}),fm}()}populate(r,a,u,d){const g=Z9();if(!g)return;const y=oe(u);this.tileToMeter=y,this.brightness=a.brightness,g.setStyle({normalScale:[1,-1,y],tileToMeters:y}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const x=new Map,E=new Map;let C=0;for(const{feature:te}of r){if(ZD[te.type]!=="LineString"){x.set(te.id,te.properties.source_id);continue}const le=this.layers[0]._featureFilter.needGeometry;if(le&&!this.layers[0]._featureFilter.filter(new ri(this.zoom),te,u))continue;const ue=Le(te,le);if(!le&&!this.layers[0]._featureFilter.filter(new ri(this.zoom),ue,u))continue;const fe=le?ue.geometry:Ce(te,u,d),we=[];for(const De of fe)for(const rt of De)we.push(rt.x),we.push(rt.y);const _e={coordinates:we,crossPerc:te.properties.cross_perc,distanceToRoad:te.properties.distance_to_road,entrances:te.properties.entrances,sourceId:0},Ee=te.properties.source_id;let Me=E.get(Ee);Me||(Me=[],E.set(Ee,Me)),Me.push(_e),++C}this.maxHeight=0;const R=new Array,D=new Set,j=te=>{te!=null&&D.add(te)},V=(te,le)=>{te!=null&&R.push({buildingId:te,footprintIndex:le})},$=64*(r.length-C),Z=$/2;this.buildingWithFacade.reserve($,Z,!0),this.buildingWithoutFacade.reserve(2*$,2*Z,!1),this.footprintsIndices.reserve(16*(r.length-C)),this.footprintsVertices.reserve(8*(r.length-C));for(const{feature:te,id:le,index:ue,sourceLayerIndex:fe}of r){if(ZD[te.type]==="LineString")continue;const we=this.layers[0]._featureFilter.needGeometry;if(we&&!this.layers[0]._featureFilter.filter(new ri(this.zoom),te,u))continue;let _e=null;if(te.properties&&te.properties.hasOwnProperty("building_id")&&(_e=te.properties.building_id,D.has(_e)))continue;const Ee=Le(te,we);if(!we&&!this.layers[0]._featureFilter.filter(new ri(this.zoom),Ee,u))continue;const Me=we?Ee.geometry:Ce(te,u,d),De=b_(Me,500);let rt=!1;for(const yr of De)if(yr.length!==1){rt=!0;break}if(rt){j(_e);continue}if(!b7(Me,163)){j(_e);continue}const Ne=this.layers[0],at=w7(Ne.layout.get("building-roof-shape").evaluate(te,{},u)),ft=Ne.layout.get("building-base").evaluate(te,{},u),pt=Ne.layout.get("building-height").evaluate(te,{},u),xt=Ne.layout.get("building-flood-light-ground-radius").evaluate(te,{},u),wt=Ne.paint.get("building-ambient-occlusion-intensity"),yt=xt/this.tileToMeter;te.properties["building-part"]="roof";const _t=Ne.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),st=Ne.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="wall";const it=Ne.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=Ne.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="window";const Ot=Ne.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),At=Ne.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="door";const or=Ne.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),Ft=Ne.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);let Ht=Ne.layout.get("building-flood-light-wall-radius").evaluate(te,{},u);Ht=ne(Ht,0,2048);const Qt=Ht/2048*Ib,Gr=x.get(le),Pt=E.get(Gr)||[],er=Pt.length!==0&&Ne.layout.get("building-facade").evaluate(te,{},u);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(er,!1,1);let Pr=0,en=0,sn=0,kr=0,Vn=0,ve=0,Te=0,lt=0,bt=0,kt=0,jt=0;if(er){let yr=Math.round(Ne.layout.get("building-facade-floors").evaluate(te,{},u));if(ft===0){yr=Math.max(1,yr-(Pt.length>0?1:0));let Ln=4;if(pt>100){const di=[10,13,15];Ln=di[te.id?te.id%di.length:0]}else pt<=10&&(Ln=3);g.setFacadeOptions(Ln,!0),Vn=(pt<15?1.3:1.61803)*Ln/y}else Vn=ft/y;ve=pt/y,Vn=Math.min(Vn,ve),sn=Ne.layout.get("building-facade-unit-width").evaluate(te,{},u)/y,kr=(ve-Vn)/yr,g.setFauxFacadeOptions(!0,!0,sn);const vi=Ne.layout.get("building-facade-window").evaluate(te,{},u);Pr=vi[0],en=vi[1],Te=Math.floor(65535*Math.min(1,Vn/Mt)),lt=Math.floor(65535*Math.min(1,ve/Mt)),bt=Math.floor(255*Pr)<<8|Math.floor(255*en),kt=Math.floor(65535*Math.min(1,sn/Mt)),jt=Math.floor(65535*Math.min(1,kr/Mt))}const sr=Array(De.length),ur={x:1/0,y:1/0},Rr={x:-1/0,y:-1/0},Vr={x:0,y:0};let Ur=0;for(let yr=0;yr<De.length;yr++){const vi=De[yr];if(vi.length>0){const Ln=[],di=Array(vi.length+1);di[0]=0;for(let io=0;io<vi.length;io++){const vo=vi[io];for(let Zi=0;Zi<vo.length;Zi++){const Xi=vo[vo.length-Zi-1];ur.x=Math.min(ur.x,Xi.x),ur.y=Math.min(ur.y,Xi.y),Rr.x=Math.max(Rr.x,Xi.x),Rr.y=Math.max(Rr.y,Xi.y),Vr.x+=Xi.x,Vr.y+=Xi.y,Ur++,Ln.push(Xi.x),Ln.push(Xi.y)}di[io+1]=Ln.length}sr[yr]={id:te.id?te.id:0,height:pt,minHeight:ft,sourceId:0,roofType:at,coordinates:Ln,ringIndices:di}}}Vr.x/=Ur||1,Vr.y/=Ur||1;const Kr=g.generateMesh(sr,Pt);if(typeof Kr=="string"){Ut(`Unable to generate building ${te.id}: ${Kr}`),j(_e);continue}if(Kr.meshes.length===0||Kr.modifiedPolygonRings.length===0){j(_e);continue}const _r=er?this.buildingWithFacade:this.buildingWithoutFacade;let Sr=0;for(const yr of Kr.meshes)Sr+=yr.positions.length/3;const pn=_r.segmentsBucket.prepareSegment(Sr,_r.layoutVertexArray,_r.indexArray),xn=[];let bn=null,jn=0,Xn=-1;const $n=_r.layoutVertexArray.length,Tn=$n+Sr;_r.layoutVertexArray.resize(Tn),_r.layoutCentroidArray.resize(Tn),_r.layoutNormalArray.resize(Tn),_r.layoutAOArray.resize(Tn),_r.layoutColorArray.resize(Tn),_r.layoutFloodLightDataArray.resize(Tn),er&&(_r.layoutFacadePaintArray.resize(Tn),_r.layoutFacadeDataArray.resize(Tn),_r.layoutFacadeVerticalRangeArray.resize(Tn));const Cn=_r.indexArray.length;let $r=0,tn=$n;for(const yr of Kr.meshes){let vi,Ln;if(yr.buildingPart===1)vi=_t,Ln=st;else if(yr.buildingPart===0)vi=it,Ln=vt;else if(yr.buildingPart===2)vi=Ot,Ln=At;else{if(yr.buildingPart!==3)continue;vi=or,Ln=Ft}if(Ln=ne(Ln,0,1),yr.buildingPart===3){const ti=new Array;for(let oo=0;oo<yr.positions.length;oo+=12){const nl=yr.positions[oo+0],jc=yr.positions[oo+1],Fo=yr.positions[oo+3],vs=yr.positions[oo+4],Qs=yr.positions[oo+2],Mh=yr.positions[oo+8]-Qs,Pm=1,Gl=Fo-nl,Hl=vs-jc,rv=Math.hypot(Gl,Hl);ti.push({pos:[nl+.5*Gl,jc+.5*Hl,Qs],normal:[Hl/rv,-Gl/rv,0],width:rv,height:Mh,depth:Pm,points:[nl,jc,Fo,vs]})}const ki=_r.entranceBloom.segmentsBucket.prepareSegment(10*ti.length,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.indexArray),zi=_r.entranceBloom.layoutVertexArray.length;jn=_r.entranceBloom.indexArray.length,HD(ti,.5/this.tileToMeter,_r.entranceBloom.indexArray,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.layoutAttenuationArray);const zs=_r.entranceBloom.layoutVertexArray.length-zi;Xn=_r.entranceBloom.indexArray.length-jn;for(let oo=0;oo<zs;oo++)_r.entranceBloom.layoutColorArray.emplaceBack(255*or.r<<8|255*or.g,255*or.b<<8|51*Ft);ki.vertexLength+=zs,ki.primitiveLength+=Xn,bn={part:yr.buildingPart,vertexOffset:zi,vertexLength:zs}}_r.layoutVertexArray.float32.set(yr.positions,3*tn);const di=yr.positions.length/3;for(let ti=0;ti<di;++ti){const ki=3*ti;$r=Math.max($r,yr.positions[ki+2]);const zi=yr.normals[ki+1]*Ib,zs=yr.normals[ki+2]*Ib,oo=3*(tn+ti);_r.layoutNormalArray.int16[oo]=yr.normals[ki]*Ib,_r.layoutNormalArray.int16[oo+1]=zi,_r.layoutNormalArray.int16[oo+2]=zs;const nl=yr.ao[ti];_r.layoutAOArray.uint8[tn+ti]=255*nl;const jc=1+(nl-1)*wt,Fo=255*vi.b*jc<<8|255*Ln;_r.layoutColorArray.uint16[2*(tn+ti)]=255*vi.r*jc<<8|255*vi.g*jc,_r.layoutColorArray.uint16[2*(tn+ti)+1]=Fo}const io=Math.floor(Vr.x),vo=Math.floor(Vr.y),Zi=Math.floor(pt);for(let ti=0;ti<di;++ti){const ki=3*(tn+ti);_r.layoutCentroidArray.int16[ki]=io,_r.layoutCentroidArray.int16[ki+1]=vo,_r.layoutCentroidArray.int16[ki+2]=Zi}if(_r.layoutFloodLightDataArray.uint16.fill(yr.buildingPart===0?Qt:0,tn,tn+di),er){const ti=255*Ot.r<<8|255*Ot.g,ki=255*Ot.b<<8|255*At;for(let zi=0;zi<di;++zi){const zs=2*(tn+zi);_r.layoutFacadePaintArray.uint16[zs]=ti,_r.layoutFacadePaintArray.uint16[zs+1]=ki}for(let zi=0;zi<di;++zi)if(yr.isFauxFacade[zi]){const zs=Math.min(65535,Math.floor(yr.uv[2*zi]*Kr.outerRingLength));_r.layoutFacadeDataArray.emplace(tn+zi,1|zs,bt,kt,jt),_r.layoutFacadeVerticalRangeArray.emplace(tn+zi,Te,lt)}else _r.layoutFacadeDataArray.emplace(tn+zi,0,0,0,0),_r.layoutFacadeVerticalRangeArray.emplace(tn+zi,0,0)}const Xi=pn.vertexLength,uo=yr.indices.length/3,Is=_r.indexArray.length;_r.indexArray.resize(Is+uo);for(let ti=0;ti<uo;++ti){const ki=3*ti,zi=3*Is+ki;_r.indexArray.uint16[zi]=Xi+yr.indices[ki],_r.indexArray.uint16[zi+1]=Xi+yr.indices[ki+1],_r.indexArray.uint16[zi+2]=Xi+yr.indices[ki+2]}yr.buildingPart!==1&&yr.buildingPart!==0&&yr.buildingPart!==2&&yr.buildingPart!==3||xn.push({part:yr.buildingPart,vertexOffset:tn,vertexLength:yr.positions.length/3}),tn+=di,pn.vertexLength+=di,pn.primitiveLength+=yr.indices.length/3}this.maxHeight=Math.max(this.maxHeight,$r);const pi=_r.indexArray.length-Cn,gr=this.footprintsIndices.length,Yr=this.footprintsVertices.length,Gn=[],Qn=new mt(1/0,1/0),ni=new mt(-1/0,-1/0),Ni=this.groundEffect.vertexArray.length;for(const yr of Kr.modifiedPolygonRings){const vi=[],Ln=new mt(1/0,1/0),di=new mt(-1/0,-1/0);for(let io=0;io<yr.length;io+=2){const vo=yr.length-io-2;Ln.x=Math.min(Ln.x,yr[vo]),Ln.y=Math.min(Ln.y,yr[vo+1]),di.x=Math.max(di.x,yr[vo]),di.y=Math.max(di.y,yr[vo+1]);const Zi=new mt(yr[vo],yr[vo+1]);vi.push(Zi),Gn.push(Zi.x,Zi.y),this.footprintsVertices.emplaceBack(Zi.x,Zi.y)}Qn.x=Math.min(Qn.x,Ln.x),Qn.y=Math.min(Qn.y,Ln.y),ni.x=Math.max(ni.x,di.x),ni.y=Math.max(ni.y,di.y),this.groundEffect.addData(vi,[Ln,di],yt)}const ei=this.groundEffect.vertexArray.length-Ni;this.groundEffect.groundRadiusArray.reserveForAdditional(ei);for(let yr=0;yr<ei;yr++)this.groundEffect.groundRadiusArray.emplaceBack(xt);(ur.x<0||Rr.x>Mt||ur.y<0||Rr.y>Mt)&&this.featuresOnBorder.push({featureId:te.id,footprintIndex:this.footprints.length});{const yr=lm(Gn,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+yr.length),this.footprintsIndices.uint16.set(yr,gr),this.buildingIds.add(_e??te.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Qn.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Qn.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ni.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ni.y);const vi={footprintVertexOffset:Yr,footprintVertexLength:this.footprintsVertices.length-Yr,footprintIndexOffset:gr,footprintIndexLength:this.footprintsIndices.length-gr,min:Qn,max:ni,hiddenFlags:0,indicesOffset:Cn,indicesLength:pi,bloomIndicesOffset:jn,bloomIndicesLength:Xn,groundEffectVertexOffset:Ni,groundEffectVertexLength:ei,hasFauxFacade:er,height:$r,promoteId:le,feature:Ee,parts:xn,buildingBloom:bn},Ln=this.footprints.length;te.id!==void 0&&this.featureFootprintLookup.set(te.id,Ln),V(_e,Ln),this.footprints.push(vi)}this.programConfigurations.populatePaintArrays(_r.layoutVertexArray.length,te,ue,{},a.availableImages,u,a.brightness),this.groundEffect.addPaintPropertiesData(te,ue,{},a.availableImages,u,a.brightness),a.featureIndex.insert(te,Me,ue,fe,this.index,$n)}R.forEach(({buildingId:te,footprintIndex:le})=>{D.has(te)&&(this.footprints[le].hiddenFlags|=4)});const re=new Set;this.buildingIds.forEach((te,le,ue)=>{D.has(te)||re.add(te)}),this.buildingIds=re,this.groundEffect.prepareBorderSegments()}update(r,a,u,d,g,y,x){this.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x),this.groundEffect.update(r,a,g,u,d,y,x),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const a=u=>{u.layoutVertexBuffer=r.createVertexBuffer(u.layoutVertexArray,WD.members),u.layoutNormalBuffer=r.createVertexBuffer(u.layoutNormalArray,p7.members),u.layoutCentroidBuffer=r.createVertexBuffer(u.layoutCentroidArray,m7.members),u.layoutFloodLightDataBuffer=r.createVertexBuffer(u.layoutFloodLightDataArray,x7.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=r.createVertexBuffer(u.layoutFacadeDataArray,y7.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(u.layoutFacadeVerticalRangeArray,_7.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(u.entranceBloom.layoutVertexArray,WD.members),u.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,v7.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,a,u=!0){let d=!1;const g=u?a:0,y=0|(u?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of r){const E=this.footprints[x],C=E.hiddenFlags&y|g;E.hiddenFlags!==C&&(E.hiddenFlags=C,d=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const a=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const d of this.footprints){const g=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let E=d.indicesOffset;E<y;E++)g.indexArrayForConflation.uint16[3*E+0]=0,g.indexArrayForConflation.uint16[3*E+1]=0,g.indexArrayForConflation.uint16[3*E+2]=0;const x=d.bloomIndicesOffset+d.bloomIndicesLength;for(let E=d.bloomIndicesOffset;E<x;E++)g.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=r.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=r.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const a=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=r.createVertexBuffer(u.layoutColorArray,qD.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=r.createVertexBuffer(u.layoutFacadePaintArray,g7.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=r.createVertexBuffer(u.entranceBloom.layoutColorArray,qD.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,a){const u=r.paint.get("building-ambient-occlusion-intensity");for(const d of this.footprints){if(4&d.hiddenFlags)continue;const g=a[d.promoteId],y=d.feature;y.properties["building-part"]="roof";const x=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),E=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="wall";const C=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),R=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="window";const D=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),j=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="door";const V=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),$=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical),Z=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const te of d.parts){let le,ue=x;te.part===1?(ue=x,le=E):te.part===0?(ue=C,le=R):te.part===2?(ue=D,le=j):te.part===3&&(ue=V,le=$),le=ne(le,0,1);for(let fe=0;fe<te.vertexLength;fe++){const we=te.vertexOffset+fe,_e=1+(Z.layoutAOArray.uint8[we]/255-1)*u;Z.layoutColorArray.emplace(we,ue.r*_e*255<<8|ue.g*_e*255,ue.b*_e*255<<8|255*le),d.hasFauxFacade&&Z.layoutFacadePaintArray.emplace(we,255*D.r<<8|255*D.g,255*D.b<<8|255*j)}}const re=d.buildingBloom;if(re)for(let te=0;te<re.vertexLength;te++)Z.entranceBloom.layoutColorArray.emplace(re.vertexOffset+te,255*V.r<<8|255*V.g,255*V.b<<8|51*$)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(r.toUnwrapped());if(gb(this.activeReplacements,d))return;this.activeReplacements=d;for(const y of this.footprints)y.hiddenFlags&=-2;const g=[];for(const y of this.activeReplacements){if(y.order<=KR)continue;const x=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));for(const E of this.footprints)E.min.x>y.max.x||E.max.x<y.min.x||E.min.y>y.max.y||E.max.y<y.min.y||(g.length=0,S7(this.footprintsVertices,E.footprintVertexOffset,E.footprintVertexLength,y.footprintTileId.canonical,r.canonical,g),z2(y.footprint,g,this.footprintsIndices.uint16,E.footprintIndexOffset,E.footprintIndexLength,0,-x)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(r){if(r.id!==void 0){const a=this.featureFootprintLookup.get(r.id);return this.footprints[a]}return null}getHeightAtTileCoord(r,a){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(r+Mt)*Mt+(a+Mt);if(this.footprintLookup.hasOwnProperty(g)){const x=this.footprintLookup[g];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const y=new mt(r,a);for(const x of this.footprints)r>x.max.x||x.min.x>r||a>x.max.y||x.min.y>a||x.height<=u||T7(y,this.footprintsVertices.float32.subarray(2*x.footprintVertexOffset,2*(x.footprintVertexOffset+x.footprintVertexLength)),this.footprintsIndices.uint16.subarray(x.footprintIndexOffset,x.footprintIndexOffset+x.footprintIndexLength))&&(u=x.height,this.footprintLookup[g]=x,d=x.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[g]=void 0}}function T7(l,r,a){for(let u=0;u<a.length;u+=3){const d=a[u],g=a[u+1],y=a[u+2],x=r[2*d+0],E=r[2*d+1],C=r[2*g+0],R=r[2*g+1],D=r[2*y+0],j=r[2*y+1],V=(x-D)*(l.y-j)-(E-j)*(l.x-D),$=(C-x)*(l.y-E)-(R-E)*(l.x-x);if(V<0!=$<0&&V!==0&&$!==0)continue;const Z=(D-C)*(l.y-R)-(j-R)*(l.x-C);if(Z===0||Z<0==V+$<=0)return!0}return!1}function S7(l,r,a,u,d,g){const y=Math.pow(2,u.z-d.z);for(let x=0;x<a;x++){let E=l.float32[2*(x+r)+0],C=l.float32[2*(x+r)+1];E=(E+d.x*Mt)*y-u.x*Mt,C=(C+d.y*Mt)*y-u.y*Mt,g.push(new mt(E,C))}}let KD,YD;Yt(XD,"BuildingBucket",{omit:["layers"]}),Yt(oE,"BuildingGeometry"),Yt(iE,"BuildingBloomGeometry");const E7=Xr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),A7=Xr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:P7}=E7,C7=Xr([{name:"a_packed",components:3,type:"Float32"}]),{members:I7}=C7,M7=Xr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:O7}=M7;class JD{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new Eh({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const u=this.getKey(r,a);return this.positions[u]}trim(){const r=this.width,a=this.height=Ye(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,u){const d=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,x=!0;d.push({left:g,right:y,isDash:x,zeroLength:r[0]===0});let E=r[0];for(let C=1;C<r.length;C++){x=!x;const R=r[C];g=E*u,E+=R,y=E*u,d.push({left:g,right:y,isDash:x,zeroLength:R===0})}return d}addRoundDash(r,a,u){const d=a/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let x=0,E=r[x];for(let C=0;C<this.width;C++){C/E.right>1&&(E=r[++x]);const R=Math.abs(C-E.left),D=Math.abs(C-E.right),j=Math.min(R,D);let V;const $=g/u*(d+1);if(E.isDash){const Z=d-Math.abs($);V=Math.sqrt(j*j+Z*Z)}else V=d-Math.sqrt(j*j+$*$);this.image.data[y+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(r,a){for(let E=r.length-1;E>=0;--E){const C=r[E],R=r[E+1];C.zeroLength?r.splice(E,1):R&&R.isDash===C.isDash&&(R.left=C.left,r.splice(E,1))}const u=r[0],d=r[r.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const C=Math.abs(E-x.left),R=Math.abs(E-x.right),D=Math.min(C,R);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?D:-D)+a+128))}}addDash(r,a){const u=this.getKey(r,a);if(this.positions[u])return this.positions[u];const d=a==="round",g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Ut("LineAtlas out of space"),null;r.length===0&&r.push(1);let x=0;for(let R=0;R<r.length;R++)r[R]<0&&(Ut("Negative value is found in line dasharray, replacing values with 0"),r[R]=0),x+=r[R];if(x!==0){const R=this.width/x,D=this.getDashRanges(r,this.width,R);d?this.addRoundDash(D,R,g):this.addRegularDash(D,a==="square"?.5*R:0)}const E=this.nextRow+g;this.nextRow+=y;const C={tl:[E,g],br:[x,0]};return this.positions[u]=C,C}}Yt(JD,"LineAtlas");const R7=ke.types,D7=Math.cos(Math.PI/180*37.5),k7=Math.cos(Math.PI/180*5);class sE{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Up,this.layoutVertexArray2=new Zs,this.patternVertexArray=new Zs,this.indexArray=new to,this.programConfigurations=new Oa(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new gi,this.maxLineLength=0,this.zOffsetVertexArray=new Zs,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Mt/64,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,d){}populate(r,a,u,d){this.hasPattern=R2("line",this.layers,this.pixelRatio,a);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=oe(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const j=this.layers[0].layout.get("line-z-offset"),V=j.isConstant()&&!j.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&y==="none"&&Ut(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const E=[];for(const{feature:j,id:V,index:$,sourceLayerIndex:Z}of r){const re=this.layers[0]._featureFilter.needGeometry,te=Le(j,re);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),te,u))continue;const le=g?g.evaluate(te,{},u):void 0,ue={id:V,properties:j.properties,type:j.type,sourceLayerIndex:Z,index:$,geometry:re?te.geometry:Ce(j,u,d),patterns:{},sortKey:le};E.push(ue)}g&&E.sort((j,V)=>j.sortKey-V.sortKey);const{lineAtlas:C,featureIndex:R}=a,D=this.addConstantDashes(C);for(const j of E){const{geometry:V,index:$,sourceLayerIndex:Z}=j;if(D&&this.addFeatureDashes(j,C),this.hasPattern){const re=D2("line",this.layers,j,this.zoom,this.pixelRatio,a);this.patternFeatures.push(re)}else this.addFeature(j,V,$,u,C.positions,a.availableImages,a.brightness,a.elevationFeatures);R.insert(r[$].feature,V,$,Z,this.index)}}addConstantDashes(r){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")a=!0;else{const y=g.value,x=d.value;if(!x)continue;r.addDash(x,y)}}return a}addFeatureDashes(r,a){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let x,E;if(g.kind==="constant"){if(x=g.value,!x)continue}else x=g.evaluate({zoom:u},r);E=y.kind==="constant"?y.value:y.evaluate({zoom:u},r),a.addDash(x,E),r.patterns[d.id]=[a.getKey(x,E)]}}update(r,a,u,d,g,y,x,E){this.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,E)}addFeatures(r,a,u,d,g,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,a,u,d,y,r.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,I7)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,O7)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,A7.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,P7),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,a){let u,d;if(a&&a>0?(u=`mapbox_clip_start_${a}`,d=`mapbox_clip_end_${a}`):(u="mapbox_clip_start",d="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(u)&&r.properties.hasOwnProperty(d))return{start:+r.properties[u],end:+r.properties[d]}}addFeature(r,a,u,d,g,y,x,E){const C=this.layers[0].layout,R=C.get("line-join").evaluate(r,{}),D=C.get("line-cap").evaluate(r,{}),j=C.get("line-miter-limit"),V=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const $=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if(Z.kind!=="constant"&&Z.isLineProgressConstant===!1&&(this.variableWidthValue=Z),this.elevationType==="road"){const re=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,a,d,E,R,D,j,V)){const[te,le]=this.clipRuntimeLinesToTile(a,1);for(let ue=0;ue<te.length;ue++){const fe=te[ue],we=le[ue],_e={progress:{min:we.progress.min,max:we.progress.max},nextDir:this.computeSegNextDir(we,fe),prevDir:this.computeSegPrevDir(we,fe)};this.addLine(fe,r,d,R,D,j,V,_e,$&&we.parentIndex>0?we.parentIndex:null)}this.fillNonElevatedRoadSegment(re)}}else for(let re=0;re<a.length;re++)this.addLine(a[re],r,d,R,D,j,V,void 0,$&&re>0?re:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,d,x,void 0,this.worldview)}computeSegNextDir(r,a){return r.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(r,a){return a[1].sub(r.prevPoint).unit()}clipLinesToTile(r,a){return vb(r,-a,-a,Mt+a,Mt+a)}clipRuntimeLinesToTile(r,a){const u=[];return[vb(r,-a,-a,Mt+a,Mt+a,u),u]}addElevatedRoadFeature(r,a,u,d,g,y,x,E){const C=[],R=An.getElevationFeature(r,d);if(R){const D=this.clipLinesToTile(a,1),j=this.prepareElevatedLines(D,R,u);for(const V of j)C.push({geometry:V,elevation:R,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const D of C){const j=this.layoutVertexArray.length;this.addLine(D.geometry,r,u,g,y,x,E);const V=new Bn(u,D.elevationTileID);if(D.elevation)for(let $=j;$<this.layoutVertexArray.length;$++){const Z=new mt(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),re=V.pointElevation(Z,D.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(j)}return!0}prepareElevatedLines(r,a,u){if(a.constantHeight!=null)return r;const d=[],g=1/oe(u);for(const y of r)G9(y,new vn(a,g),0,d);return d}fillNonElevatedRoadSegment(r){for(let a=r;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,a,u,d,g,y,x,E,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(a,C):this.lineClips;const R=d==="none";this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=E&&E.progress.min>0,j=E&&E.progress.max<1;if(this.lineClips){let De={min:this.lineClips.start,max:this.lineClips.end},rt=1;if(E){const ft=this.lineClips.end-this.lineClips.start;De=function(pt,xt,wt){return{min:Jn(pt.min,xt,wt),max:Jn(pt.max,xt,wt)}}(E.progress,{min:0,max:1},De),ft>0&&(rt=(De.max-De.min)/ft)}const Ne=+a.properties.mapbox_clip_feature_len,at=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Ne)||Number.isNaN(at)){for(let pt=0;pt<r.length-1;pt++)this.totalDistance+=r[pt].dist(r[pt+1]);const ft=this.totalDistance/(De.max-De.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ne,this.distance=at*rt,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const V=R7[a.type]==="Polygon";let $=r.length;for(;$>=2&&r[$-1].equals(r[$-2]);)$--;let Z=0;for(;Z<$-1&&r[Z].equals(r[Z+1]);)Z++;if($<(V?3:2))return;d==="bevel"&&(y=1.05);const re=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let te,le,ue,fe,we,_e,Ee,Me;E&&E.prevDir&&(_e=E.prevDir.perp()),E&&E.nextDir&&(Ee=E.nextDir.perp()),this.e1=this.e2=-1,V&&(te=r[$-2],we=r[Z].sub(te)._unit()._perp());for(let De=Z;De<$;De++){if(ue=De===$-1?V?r[Z+1]:void 0:r[De+1],ue&&r[De].equals(ue))continue;we&&(fe=we),te&&(le=te),te=r[De],Me=this.evaluateLineProgressFeatures(le?le.dist(te):0),we=ue?ue.sub(te)._unit()._perp():fe,fe=fe||we;const rt=le&&ue;let Ne=rt?d:V||R?"butt":g;const at=fe.x*we.x+fe.y*we.y;if(R){const it=function(vt){if(vt.patternJoinNone){const Ot=vt.segmentPoints.length/2,At=vt.lineSoFar-vt.segmentStart;for(let or=0;or<Ot;++or){const Ft=vt.segmentPoints[2*or+1],Ht=Math.round(vt.segmentPoints[2*or])+.5+.25*Ft;vt.patternVertexArray.emplaceBack(Ht,At,vt.segmentStart),vt.patternVertexArray.emplaceBack(Ht,At,vt.segmentStart)}vt.segmentPoints.length=0}vt.e1=vt.e2=-1};if(rt&&at<k7){this.updateDistance(le,te),this.addCurrentVertex(te,fe,1,1,re,Me),it(this),this.addCurrentVertex(te,we,-1,-1,re,Me);continue}if(le){if(!ue){this.updateDistance(le,te),this.addCurrentVertex(te,fe,1,1,re,Me),it(this);continue}Ne="miter"}}let ft=fe.add(we);ft.x===0&&ft.y===0||ft._unit();const pt=ft.x*we.x+ft.y*we.y,xt=pt!==0?1/pt:1/0,wt=2*Math.sqrt(2-2*pt),yt=pt<D7&&le&&ue,_t=fe.x*we.y-fe.y*we.x>0,st=this.overscaling<=16?15*Mt/(512*this.overscaling):0;if(rt&&Ne==="round"){if(xt<x)Ne="miter";else if(xt<=2){const it=aE(te,-10,Mt+10);Ne=this.elevationType==="offset"&&(it||this.hasCrossSlope)?"miter":"fakeround"}}if(Ne==="miter"&&xt>y&&(Ne="bevel"),Ne==="bevel"&&(xt>2&&(Ne="flipbevel"),xt<y&&(Ne="miter")),le&&!(Ne==="miter"&&yt)&&this.updateDistance(le,te),Ne==="miter")if(yt){const it=te.dist(le);if(it>2*st){const Ot=te.sub(te.sub(le)._mult(st/it)._round());this.updateDistance(le,Ot),this.addCurrentVertex(Ot,fe,0,0,re,Me),le=Ot}this.updateDistance(le,te),ft._mult(xt),this.addCurrentVertex(te,ft,0,0,re,Me);const vt=te.dist(ue);if(vt>2*st){const Ot=te.add(ue.sub(te)._mult(st/vt)._round());this.updateDistance(te,Ot),this.addCurrentVertex(Ot,we,0,0,re,Me),te=Ot}}else ft._mult(xt),this.addCurrentVertex(te,ft,0,0,re,Me);else if(Ne==="flipbevel"){if(xt>100)ft=we.mult(-1);else{const it=xt*fe.add(we).mag()/fe.sub(we).mag();ft._perp()._mult(it*(_t?-1:1))}this.addCurrentVertex(te,ft,0,0,re,Me),this.addCurrentVertex(te,ft.mult(-1),0,0,re,Me)}else if(Ne==="bevel"||Ne==="fakeround"){Me!=null&&le&&this.addCurrentVertex(te,Ee||fe,-1,-1,re,Me);const it=te.dist(le)<=2*st&&Ne!=="bevel",vt=ft.mult(_t?1:-1);vt._mult(xt);const Ot=we.mult(_t?-1:1),At=fe.mult(_t?-1:1),or=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(te,vt.x,vt.y,!1,!_t,0,re,or),it||this.addHalfVertex(te,vt.x+2*At.x,vt.y+2*At.y,!1,_t,0,re,or)),Ne==="fakeround"){const Ft=Math.round(180*wt/Math.PI/20);this.addHalfVertex(te,At.x,At.y,!1,_t,0,re,or);for(let Ht=0;Ht<Ft;Ht++){let Qt=Ht/Ft;if(Qt!==.5){const Pt=Qt-.5;Qt+=Qt*Pt*(Qt-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*Pt*Pt+(.848013+at*(.215638*at-1.06021)))}const Gr=Ot.sub(At)._mult(Qt)._add(At)._unit();this.addHalfVertex(te,Gr.x,Gr.y,!1,_t,0,re,or)}this.addHalfVertex(te,Ot.x,Ot.y,!1,_t,0,re,or)}it||Me!=null||this.addHalfVertex(te,vt.x+2*Ot.x,vt.y+2*Ot.y,!1,_t,0,re,or),Me!=null&&ue&&this.addCurrentVertex(te,_e||we,1,1,re,Me)}else if(Ne==="butt")this.addCurrentVertex(te,ft,0,0,re,Me);else if(Ne==="square"){if(!le){const it=D?0:-1;this.addCurrentVertex(te,ft,it,it,re,Me)}if(this.addCurrentVertex(te,ft,0,0,re,Me),le){const it=j?0:1;this.addCurrentVertex(te,ft,it,it,re,Me)}}else if(Ne==="round"){if(le){const it=!rt&&Ee?Ee:fe;this.addCurrentVertex(te,it,0,0,re,Me),!rt&&j||this.addCurrentVertex(te,it,1,1,re,Me,!0)}if(ue){const it=!rt&&_e?_e:we;!rt&&D||this.addCurrentVertex(te,it,-1,-1,re,Me,!0),this.addCurrentVertex(te,it,0,0,re,Me)}}}}addVerticesTo(r,a,u,d,g,y,x,E,C,R){const D=(a.w-r.w)/this.tessellationStep|0;let j=0;const V=this.scaledDistance;if(D>1){this.lineSoFar=r.w;const Z=(a.x-r.x)/D,re=(a.y-r.y)/D,te=(a.z-r.z)/D,le=(a.w-r.w)/D;for(let ue=1;ue<D;++ue){r.x+=Z,r.y+=re,r.z+=te,this.lineSoFar+=le,j+=le;const fe=this.evaluateLineProgressFeatures(this.prevDistance+j);this.scaledDistance=(this.prevDistance+j)/this.totalDistance,this.addHalfVertex(r,u,d,R,!1,x,C,fe),this.addHalfVertex(r,g,y,R,!0,-E,C,fe)}}this.lineSoFar=a.w,this.scaledDistance=V;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,d,R,!1,x,C,$),this.addHalfVertex(a,g,y,R,!0,-E,C,$)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Ut(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(r,a,u,d,g,y,x=!1){const E=a.x+a.y*u,C=a.y-a.x*u,R=a.y*d-a.x,D=-a.y-a.x*d;if(y!=null){const j=this.elevationType==="offset",V=-10,$=Mt+10,Z=y.zOffset,re=new xD(r.x,r.y,Z,this.lineSoFar),te=!!j&&aE(r,V,$),le=this.lineSoFar,ue=this.distance;if(this.currentVertex)if(te){const fe=this.currentVertexIsOutside,we=this.currentVertex,_e=new xD(r.x,r.y,Z,this.lineSoFar);if(wD(we,_e,V,$),!aE(_e,V,$)){if(fe){this.e1=this.e2=-1,this.distance-=we.dist(re),this.lineSoFar=we.w;const Ee=this.evaluateLineProgressFeatures(we.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(we,E,C,x,!1,u,g,Ee),this.addHalfVertex(we,R,D,x,!0,-d,g,Ee),this.prevDistance=this.distance}this.distance=this.prevDistance+we.dist(_e),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(we,_e,E,C,R,D,u,d,g,x),this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}}else{const fe=this.currentVertex;if(this.currentVertexIsOutside){wD(fe,re,V,$),this.e1=this.e2=-1,this.distance-=fe.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=fe.w;const we=this.evaluateLineProgressFeatures(fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(fe,E,C,x,!1,u,g,we),this.addHalfVertex(fe,R,D,x,!0,-d,g,we),this.prevDistance=this.distance,this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(fe,re,E,C,R,D,u,d,g,x)}else te||(this.addHalfVertex(r,E,C,x,!1,u,g,y),this.addHalfVertex(r,R,D,x,!0,-d,g,y));this.currentVertex=re,this.currentVertexIsOutside=te,this.lineSoFar=le}else this.addHalfVertex(r,E,C,x,!1,u,g,y),this.addHalfVertex(r,R,D,x,!0,-d,g,y)}addHalfVertex({x:r,y:a},u,d,g,y,x,E,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=vr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const R=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),E.primitiveLength++),y?this.e2=R:this.e1=R,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,a){this.prevDistance=this.distance,this.distance+=r.dist(a),this.updateScaledDistance()}}function aE(l,r,a){return l.x<r||l.x>a||l.y<r||l.y>a}let QD,ek;function tk(l,r,a){return r*(Mt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}Yt(sE,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const rk=(l,r,a)=>(1-a)*l+a*r;function nk(l,r){return 1/tk(l,1,r.tileZoom)}function ik(l,r,a,u){return l.translatePosMatrix(u||r.tileID.projMatrix,r,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ok=l=>{const r=[];sk(l)&&r.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=l.layout.get("line-join").constantOr("miter")==="none",d=!!l.paint.get("line-pattern").constantOr(1);return u&&d&&r.push("LINE_JOIN_NONE"),r};function sk(l){const r=l.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let lE;const ak=()=>lE||(lE={layout:QD||(QD=new Pi({"line-cap":new Dt(Ve.layout_line["line-cap"]),"line-join":new Dt(Ve.layout_line["line-join"]),"line-miter-limit":new Ct(Ve.layout_line["line-miter-limit"]),"line-round-limit":new Ct(Ve.layout_line["line-round-limit"]),"line-sort-key":new Dt(Ve.layout_line["line-sort-key"]),"line-z-offset":new Dt(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new Ct(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new Ct(Ve.layout_line["line-cross-slope"]),visibility:new Ct(Ve.layout_line.visibility),"line-width-unit":new Ct(Ve.layout_line["line-width-unit"])})),paint:ek||(ek=new Pi({"line-opacity":new Dt(Ve.paint_line["line-opacity"]),"line-color":new Dt(Ve.paint_line["line-color"]),"line-translate":new Ct(Ve.paint_line["line-translate"]),"line-translate-anchor":new Ct(Ve.paint_line["line-translate-anchor"]),"line-width":new Dt(Ve.paint_line["line-width"]),"line-gap-width":new Dt(Ve.paint_line["line-gap-width"]),"line-offset":new Dt(Ve.paint_line["line-offset"]),"line-blur":new Dt(Ve.paint_line["line-blur"]),"line-dasharray":new Dt(Ve.paint_line["line-dasharray"]),"line-pattern":new Dt(Ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ct(Ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new gu(Ve.paint_line["line-gradient"]),"line-trim-offset":new Ct(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ct(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new Ct(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new Dt(Ve.paint_line["line-emissive-strength"]),"line-border-width":new Dt(Ve.paint_line["line-border-width"]),"line-border-color":new Dt(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new Ct(Ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},lE);class j7 extends Dt{possiblyEvaluate(r,a){return a=new ri(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(r,a)}evaluate(r,a,u,d){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,u,d)}}let D_;function lk(l,r){return r>0?r+2*l:l}const L7=Xr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N7=Xr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),z7=Xr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const F7=Xr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),B7=Xr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),V7=Xr([{name:"a_texb",components:2,type:"Uint16"}]),$7=Xr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),U7=Xr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ck=Xr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),G7=Xr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xr([{name:"triangle",components:3,type:"Uint16"}]),Xr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Xr([{type:"Float32",name:"offsetX"}]),Xr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _o=24;function H7(l,r,a){return l.sections.forEach(u=>{u.text=function(d,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?d=d.toLocaleUpperCase():x==="lowercase"&&(d=d.toLocaleLowerCase()),Ml.applyArabicShaping&&(d=Ml.applyArabicShaping(d)),d}(u.text,r,a)}),l}const k_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function W7(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function q7(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}const cE=4294967296,uk=1/cE,hk=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Mb=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,r,a=this.length){for(;this.pos<a;){const u=this.readVarint(),d=u>>3,g=this.pos;this.type=7&u,l(d,r,this),this.pos===g&&this.skip(u)}return r}readMessage(l,r){return this.readFields(l,r,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*cE;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*cE;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const r=this.buf;let a,u;return u=r[this.pos++],a=127&u,u<128?a:(u=r[this.pos++],a|=(127&u)<<7,u<128?a:(u=r[this.pos++],a|=(127&u)<<14,u<128?a:(u=r[this.pos++],a|=(127&u)<<21,u<128?a:(u=r[this.pos],a|=(15&u)<<28,function(d,g,y){const x=y.buf;let E,C;if(C=x[y.pos++],E=(112&C)>>4,C<128||(C=x[y.pos++],E|=(127&C)<<3,C<128)||(C=x[y.pos++],E|=(127&C)<<10,C<128)||(C=x[y.pos++],E|=(127&C)<<17,C<128)||(C=x[y.pos++],E|=(127&C)<<24,C<128)||(C=x[y.pos++],E|=(1&C)<<31,C<128))return mm(d,E,g);throw new Error("Expected varint not more than 10 bytes")}(a,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,r=this.pos;return this.pos=l,l-r>=12&&hk?hk.decode(this.buf.subarray(r,l)):function(a,u,d){let g="",y=u;for(;y<d;){const x=a[y];let E,C,R,D=null,j=x>239?4:x>223?3:x>191?2:1;if(y+j>d)break;j===1?x<128&&(D=x):j===2?(E=a[y+1],(192&E)==128&&(D=(31&x)<<6|63&E,D<=127&&(D=null))):j===3?(E=a[y+1],C=a[y+2],(192&E)==128&&(192&C)==128&&(D=(15&x)<<12|(63&E)<<6|63&C,(D<=2047||D>=55296&&D<=57343)&&(D=null))):j===4&&(E=a[y+1],C=a[y+2],R=a[y+3],(192&E)==128&&(192&C)==128&&(192&R)==128&&(D=(15&x)<<18|(63&E)<<12|(63&C)<<6|63&R,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,j=1):D>65535&&(D-=65536,g+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),g+=String.fromCharCode(D),y+=j}return g}(this.buf,r,l)}readBytes(){const l=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,l);return this.pos=l,r}readPackedVarint(l=[],r){const a=this.readPackedEnd();for(;this.pos<a;)l.push(this.readVarint(r));return l}readPackedSVarint(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const r=7&l;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(l,r){this.writeVarint(l<<3|r)}realloc(l){let r=this.length||16;for(;r<this.pos+l;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*uk),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*uk),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(r,a){let u,d;if(r>=0?(u=r%4294967296|0,d=r/4294967296|0):(u=~(-r%4294967296),d=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(u,0,a),function(g,y){const x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(d,a)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const r=this.pos;this.pos=function(u,d,g){for(let y,x,E=0;E<d.length;E++){if(y=d.charCodeAt(E),y>55295&&y<57344){if(!x){y>56319||E+1===d.length?(u[g++]=239,u[g++]=191,u[g++]=189):x=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[g++]=239,u[g++]=191,u[g++]=189,x=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,l,this.pos);const a=this.pos-r;a>=128&&dk(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const r=l.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=l[a]}writeRawMessage(l,r){this.pos++;const a=this.pos;l(r,this);const u=this.pos-a;u>=128&&dk(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(l,r,a){this.writeTag(l,2),this.writeRawMessage(r,a)}writePackedVarint(l,r){r.length&&this.writeMessage(l,Z7,r)}writePackedSVarint(l,r){r.length&&this.writeMessage(l,X7,r)}writePackedBoolean(l,r){r.length&&this.writeMessage(l,J7,r)}writePackedFloat(l,r){r.length&&this.writeMessage(l,K7,r)}writePackedDouble(l,r){r.length&&this.writeMessage(l,Y7,r)}writePackedFixed32(l,r){r.length&&this.writeMessage(l,Q7,r)}writePackedSFixed32(l,r){r.length&&this.writeMessage(l,eZ,r)}writePackedFixed64(l,r){r.length&&this.writeMessage(l,tZ,r)}writePackedSFixed64(l,r){r.length&&this.writeMessage(l,rZ,r)}writeBytesField(l,r){this.writeTag(l,2),this.writeBytes(r)}writeFixed32Field(l,r){this.writeTag(l,5),this.writeFixed32(r)}writeSFixed32Field(l,r){this.writeTag(l,5),this.writeSFixed32(r)}writeFixed64Field(l,r){this.writeTag(l,1),this.writeFixed64(r)}writeSFixed64Field(l,r){this.writeTag(l,1),this.writeSFixed64(r)}writeVarintField(l,r){this.writeTag(l,0),this.writeVarint(r)}writeSVarintField(l,r){this.writeTag(l,0),this.writeSVarint(r)}writeStringField(l,r){this.writeTag(l,2),this.writeString(r)}writeFloatField(l,r){this.writeTag(l,5),this.writeFloat(r)}writeDoubleField(l,r){this.writeTag(l,1),this.writeDouble(r)}writeBooleanField(l,r){this.writeVarintField(l,+r)}};function mm(l,r,a){return a?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function dk(l,r,a){const u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(u);for(let d=a.pos-1;d>=l;d--)a.buf[d+u]=a.buf[d]}function Z7(l,r){for(let a=0;a<l.length;a++)r.writeVarint(l[a])}function X7(l,r){for(let a=0;a<l.length;a++)r.writeSVarint(l[a])}function K7(l,r){for(let a=0;a<l.length;a++)r.writeFloat(l[a])}function Y7(l,r){for(let a=0;a<l.length;a++)r.writeDouble(l[a])}function J7(l,r){for(let a=0;a<l.length;a++)r.writeBoolean(l[a])}function Q7(l,r){for(let a=0;a<l.length;a++)r.writeFixed32(l[a])}function eZ(l,r){for(let a=0;a<l.length;a++)r.writeSFixed32(l[a])}function tZ(l,r){for(let a=0;a<l.length;a++)r.writeFixed64(l[a])}function rZ(l,r){for(let a=0;a<l.length;a++)r.writeSFixed64(l[a])}const uE=3;function nZ(l,r,a){r.glyphs=[],l===1&&a.readMessage(iZ,r)}function iZ(l,r,a){if(l===3){const{id:u,bitmap:d,width:g,height:y,left:x,top:E,advance:C}=a.readMessage(oZ,{});r.glyphs.push({id:u,bitmap:new Eh({width:g+2*uE,height:y+2*uE},d),metrics:{width:g,height:y,left:x,top:E,advance:C}})}else l===4?r.ascender=a.readSVarint():l===5&&(r.descender=a.readSVarint())}function oZ(l,r,a){l===1?r.id=a.readVarint():l===2?r.bitmap=a.readBytes():l===3?r.width=a.readVarint():l===4?r.height=a.readVarint():l===5?r.left=a.readSVarint():l===6?r.top=a.readSVarint():l===7&&(r.advance=a.readVarint())}const fk=uE,Js={horizontal:1,vertical:2,horizontalOnly:3};class j_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,a){const u=new j_;return u.scale=r||1,u.fontStack=a,u}static forImage(r){const a=new j_;return a.image=r,a}}class gm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a,u){const d=new gm;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?d.addImageSection(y,u):d.addTextSection(y,a)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(a,u){let d="";for(let g=0;g<a.length;g++){const y=a.charCodeAt(g+1)||null,x=a.charCodeAt(g-1)||null;d+=!u&&(y&&Rp(y)&&!k_[a[g+1]]||x&&Rp(x)&&!k_[a[g-1]])||!k_[a[g]]?a[g]:k_[a[g]]}return d}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Ob[this.text.charCodeAt(u)];u++)r++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Ob[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const u=new gm;return u.text=this.text.substring(r,a),u.sectionIndex=this.sectionIndex.slice(r,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(j_.forText(r.scale,r.fontStack||a));const u=this.sections.length-1;for(let d=0;d<r.text.length;++d)this.sectionIndex.push(u)}addImageSection(r,a){const u=r.image?r.image.getPrimary():null;if(!u)return void Ut("Can't add FormattedSection with an empty image.");u.scaleSelf(a);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(j_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ut("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hE(l,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z=1){const re=gm.fromFeature(l,d,Z);D===Js.vertical&&re.verticalizePunctuation(j);let te=[];const le=function(Ee,Me,De,rt,Ne,at){if(!Ee)return[];const ft=[],pt=function(_t,st,it,vt,Ot,At){let or=0;for(let Ft=0;Ft<_t.length();Ft++){const Ht=_t.getSection(Ft);or+=pk(_t.getCodePoint(Ft),Ht,vt,Ot,st,At)}return or/Math.max(1,Math.ceil(or/it))}(Ee,Me,De,rt,Ne,at),xt=Ee.text.indexOf("")>=0;let wt=0;for(let _t=0;_t<Ee.length();_t++){const st=Ee.getSection(_t),it=Ee.getCodePoint(_t);if(Ob[it]||(wt+=pk(it,st,rt,Ne,Me,at)),_t<Ee.length()-1){const vt=!((yt=it)<11904||!(mr["Bopomofo Extended"](yt)||mr.Bopomofo(yt)||mr["CJK Compatibility Forms"](yt)||mr["CJK Compatibility Ideographs"](yt)||mr["CJK Compatibility"](yt)||mr["CJK Radicals Supplement"](yt)||mr["CJK Strokes"](yt)||mr["CJK Symbols and Punctuation"](yt)||mr["CJK Unified Ideographs Extension A"](yt)||mr["CJK Unified Ideographs"](yt)||mr["Enclosed CJK Letters and Months"](yt)||mr["Halfwidth and Fullwidth Forms"](yt)||mr.Hiragana(yt)||mr["Ideographic Description Characters"](yt)||mr["Kangxi Radicals"](yt)||mr["Katakana Phonetic Extensions"](yt)||mr.Katakana(yt)||mr["Vertical Forms"](yt)||mr["Yi Radicals"](yt)||mr["Yi Syllables"](yt)));(sZ[it]||vt||st.image)&&ft.push(gk(_t+1,wt,pt,ft,aZ(it,Ee.getCodePoint(_t+1),vt&&xt),!1))}}var yt;return yk(gk(Ee.length(),wt,pt,ft,0,!0))}(re,C,g,r,u,V),{processBidirectionalText:ue,processStyledBidirectionalText:fe}=Ml;if(ue&&re.sections.length===1){const Ee=ue(re.toString(),le);for(const Me of Ee){const De=new gm;De.text=Me,De.sections=re.sections;for(let rt=0;rt<Me.length;rt++)De.sectionIndex.push(0);te.push(De)}}else if(fe){const Ee=fe(re.text,re.sectionIndex,le);for(const Me of Ee){const De=new gm;De.text=Me[0],De.sectionIndex=Me[1],De.sections=re.sections,te.push(De)}}else te=function(Ee,Me){const De=[],rt=Ee.text;let Ne=0;for(const at of Me)De.push(Ee.substring(Ne,at)),Ne=at;return Ne<rt.length&&De.push(Ee.substring(Ne,rt.length)),De}(re,le);const we=[],_e={positionedLines:we,text:re.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ee,Me,De,rt,Ne,at,ft,pt,xt,wt,yt,_t){let st=0,it=0,vt=0;const Ot=pt==="right"?1:pt==="left"?0:.5;let At=!1;for(const Pt of Ne){const er=Pt.getSections();for(const Pr of er){if(Pr.image)continue;const en=Me[Pr.fontStack];if(en&&(At=en.ascender!==void 0&&en.descender!==void 0,!At))break}if(!At)break}let or=0;for(const Pt of Ne){Pt.trim();const er=Pt.getMaxScale(),Pr=(er-1)*_o,en={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[or]=en;const sn=en.positionedGlyphs;let kr=0;if(!Pt.length()){it+=at,++or;continue}let Vn=0,ve=0;for(let lt=0;lt<Pt.length();lt++){const bt=Pt.getSection(lt),kt=Pt.getSectionIndex(lt),jt=Pt.getCodePoint(lt);let sr=bt.scale,ur=null,Rr=null,Vr=null,Ur=_o,Kr=0,_r=xt;_r===Js.vertical&&((Ft=jt)===12312||Ft===12313||Ft===12316||Ft===12540||Ft===12448)&&(_r=Js.horizontal);const Sr=!(_r===Js.horizontal||!yt&&!Op(jt)||yt&&(Ob[jt]||Dp(jt)));if(bt.image){const pn=rt.get(bt.image.toString());if(!pn)continue;Vr=bt.image,Ee.iconsInText=Ee.iconsInText||!0,Rr=pn.paddedRect;const xn=pn.displaySize;sr=sr*_o/_t,ur={width:xn[0],height:xn[1],left:0,top:-fk,advance:Sr?xn[1]:xn[0],localGlyph:!1},Kr=At?-ur.height*sr:er*_o-17-xn[1]*sr,Ur=ur.advance;const bn=(Sr?xn[0]:xn[1])*sr-_o*er;bn>0&&bn>kr&&(kr=bn)}else{const pn=De[bt.fontStack];if(!pn)continue;pn[jt]&&(Rr=pn[jt]);const xn=Me[bt.fontStack];if(!xn)continue;const bn=xn.glyphs[jt];if(!bn)continue;if(ur=bn.metrics,Ur=jt!==8203?_o:0,At){const jn=xn.ascender!==void 0?Math.abs(xn.ascender):0,Xn=xn.descender!==void 0?Math.abs(xn.descender):0,$n=(jn+Xn)*sr;Vn<$n&&(Vn=$n,ve=(jn-Xn)/2*sr),Kr=-jn*sr}else Kr=(er-sr)*_o-17}Sr?(Ee.verticalizable=!0,sn.push({glyph:jt,image:Vr,x:st,y:it+Kr,vertical:Sr,scale:sr,localGlyph:ur.localGlyph,fontStack:bt.fontStack,sectionIndex:kt,metrics:ur,rect:Rr}),st+=Ur*sr+wt):(sn.push({glyph:jt,image:Vr,x:st,y:it+Kr,vertical:Sr,scale:sr,localGlyph:ur.localGlyph,fontStack:bt.fontStack,sectionIndex:kt,metrics:ur,rect:Rr}),st+=ur.advance*sr+wt)}sn.length!==0&&(vt=Math.max(st-wt,vt),At?_k(sn,Ot,kr,ve,at*er/2):_k(sn,Ot,kr,0,at/2)),st=0;const Te=at*er+kr;en.lineOffset=Math.max(kr,Pr),it+=Te,++or}var Ft;const Ht=it,{horizontalAlign:Qt,verticalAlign:Gr}=dE(ft);(function(Pt,er,Pr,en,sn,kr){const Vn=(er-Pr)*sn,ve=-kr*en;for(const Te of Pt)for(const lt of Te.positionedGlyphs)lt.x+=Vn,lt.y+=ve})(Ee.positionedLines,Ot,Qt,Gr,vt,Ht),Ee.top+=-Gr*Ht,Ee.bottom=Ee.top+Ht,Ee.left+=-Qt*vt,Ee.right=Ee.left+vt,Ee.hasBaseline=At}(_e,r,a,u,te,y,x,E,D,C,j,$),!function(Ee){for(const Me of Ee)if(Me.positionedGlyphs.length!==0)return!1;return!0}(we))return _e}const Ob={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sZ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pk(l,r,a,u,d,g){if(r.image){const y=u.get(r.image.toString());return y?y.displaySize[0]*r.scale*_o/g+d:0}{const y=a[r.fontStack],x=y&&y.glyphs[l];return x?x.metrics.advance*r.scale+d:0}}function mk(l,r,a,u){const d=Math.pow(l-r,2);return u?l<r?d/2:2*d:d+Math.abs(a)*a}function aZ(l,r,a){let u=0;return l===10&&(u-=1e4),a&&(u+=150),l!==40&&l!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function gk(l,r,a,u,d,g){let y=null,x=mk(r,a,d,g);for(const E of u){const C=mk(r-E.x,a,d,g)+E.badness;C<=x&&(y=E,x=C)}return{index:l,x:r,priorBreak:y,badness:x}}function yk(l){return l?yk(l.priorBreak).concat(l.index):[]}function dE(l){let r=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function _k(l,r,a,u,d){if(!(r||a||u||d))return;const g=l.length-1,y=l[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)l[E].x-=x,l[E].y+=a+u+d}function fE(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function Rb(l,r,a,u){const{horizontalAlign:d,verticalAlign:g}=dE(u),y=a[0]-l.displaySize[0]*d,x=a[1]-l.displaySize[1]*g;return{imagePrimary:l,imageSecondary:r,top:x,bottom:x+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function pE(l,r,a,u,d,g){const y=l.imagePrimary;let x;if(y.content){const re=y.content,te=y.pixelRatio||1;x=[re[0]/te,re[1]/te,y.displaySize[0]-re[2]/te,y.displaySize[1]-re[3]/te]}const E=r.left*g,C=r.right*g;let R,D,j,V;a==="width"||a==="both"?(V=d[0]+E-u[3],D=d[0]+C+u[1]):(V=d[0]+(E+C-y.displaySize[0])/2,D=V+y.displaySize[0]);const $=r.top*g,Z=r.bottom*g;return a==="height"||a==="both"?(R=d[1]+$-u[0],j=d[1]+Z+u[2]):(R=d[1]+($+Z-y.displaySize[1])/2,j=R+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:R,right:D,bottom:j,left:V,collisionPadding:x}}function vk(l){return!l.imagePrimary.stretchX}function xk(l){return!l.imagePrimary.stretchY}function bk(l){return{width:l.right-l.left,height:l.bottom-l.top}}const Bl=128;function ym(l,r,a){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new ri(l+1,{worldview:a}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=u;let y=0;for(;y<d.length&&d[y]<=l;)y++;y=Math.max(0,y-1);let x=y;for(;x<d.length&&d[x]<l+1;)x++;x=Math.min(d.length-1,x);const E=d[y],C=d[x];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:C,minSize:u.evaluate(new ri(E,{worldview:a})),maxSize:u.evaluate(new ri(C,{worldview:a})),interpolationType:g}}}function mE(l,{uSize:r,uSizeT:a},{lowerSize:u,upperSize:d}){return l.kind==="source"?u/Bl:l.kind==="composite"?vr(u/Bl,d/Bl,a):r}function _m(l,r,a=1){let u=0,d=0;if(l.kind==="constant")d=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:x}=l,E=g?ne(qs.interpolationFactor(g,r,y,x),0,1):0;l.kind==="camera"?d=vr(l.minSize,l.maxSize,E)*a:u=E*a}return{uSizeT:u,uSize:d}}class Su extends mt{constructor(r,a,u,d,g){super(r,a),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Su(this.x,this.y,this.z,this.angle,this.segment)}}function wk(l,r,a,u,d){if(r.segment===void 0)return!0;let g=r,y=r.segment+1,x=0;for(;x>-a/2;){if(y--,y<0)return!1;x-=l[y].dist(g),g=l[y]}x+=l[y].dist(l[y+1]),y++;const E=[];let C=0;for(;x<a/2;){const R=l[y],D=l[y+1];if(!D)return!1;let j=l[y-1].angleTo(R)-R.angleTo(D);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:j}),C+=j;x-E[0].distance>u;)C-=E.shift().angleDelta;if(C>d)return!1;y++,x+=R.dist(D)}return!0}function Tk(l){let r=0;for(let a=0;a<l.length-1;a++)r+=l[a].dist(l[a+1]);return r}function Sk(l,r,a){return l?.6*r*a:0}function Ek(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function lZ(l,r,a,u,d,g){const y=Sk(a,d,g),x=Ek(a,u)*g;let E=0;const C=Tk(l)/2;for(let R=0;R<l.length-1;R++){const D=l[R],j=l[R+1],V=D.dist(j);if(E+V>C){const $=(C-E)/V,Z=vr(D.x,j.x,$),re=vr(D.y,j.y,$),te=new Su(Z,re,0,j.angleTo(D),R);return!y||wk(l,te,x,y,r)?te:void 0}E+=V}}function cZ(l,r,a,u,d,g,y,x,E){const C=Sk(u,g,y),R=Ek(u,d),D=R*y,j=l[0].x===0||l[0].x===E||l[0].y===0||l[0].y===E;return r-D<r/4&&(r=D+r/4),Ak(l,j?r/2*x%r:(R/2+2*g)*y*x%r,r,C,a,D,j,!1,E)}function Ak(l,r,a,u,d,g,y,x,E){const C=g/2,R=Tk(l);let D=0,j=r-a,V=[];for(let $=0;$<l.length-1;$++){const Z=l[$],re=l[$+1],te=Z.dist(re),le=re.angleTo(Z);for(;j+a<D+te;){j+=a;const ue=(j-D)/te,fe=vr(Z.x,re.x,ue),we=vr(Z.y,re.y,ue);if(fe>=0&&fe<E&&we>=0&&we<E&&j-C>=0&&j+C<=R){const _e=new Su(fe,we,0,le,$);u&&!wk(l,_e,g,u,d)||V.push(_e)}}D+=te}return x||V.length||y||(V=Ak(l,D/2,a,u,d,g,y,!0,E)),V}function Pk(l){let r=0,a=0;for(const y of l)r+=y.w*y.h,a=Math.max(a,y.w);l.sort((y,x)=>x.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let d=0,g=0;for(const y of l)for(let x=u.length-1;x>=0;x--){const E=u[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===E.w&&y.h===E.h){const C=u.pop();C&&x<u.length&&(u[x]=C)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(u.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:d,h:g,fill:r/(d*g)||0}}Yt(Su,"Anchor");const Jd=1;class L_{static getImagePositionScale(r,a,u){if(a&&r){const{sx:d,sy:g}=r;return{x:d,y:g}}return{x:u,y:u}}constructor(r,a,u,d){this.paddedRect=r;const{pixelRatio:g,version:y,stretchX:x,stretchY:E,content:C,sdf:R,usvg:D}=a;this.pixelRatio=g,this.stretchX=x,this.stretchY=E,this.content=C,this.version=y,this.padding=u,this.sdf=R,this.usvg=D,this.scale=L_.getImagePositionScale(d,D,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function gE(l,r,a){const u=Tl.parse(l),d=function(g,y,x=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*x[0])+2*y,h:(g.data?g.data.height:g.height*x[1])+2*y}}(r,a,[u.sx,u.sy]);return{bin:d,imagePosition:new L_(d,r,a,u),imageVariant:u}}class Ck{constructor(r,a,u){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(r,d,Jd,y),this.addImages(a,g,2,y);const{w:x,h:E}=Pk(y),C=new qo({width:x||1,height:E||1});for(const[R,D]of r.entries()){const j=d.get(R).paddedRect;qo.copy(D.data,C,{x:0,y:0},{x:j.x+Jd,y:j.y+Jd},D.data,null,D.sdf)}for(const[R,D]of a.entries()){const j=g.get(R),V=j.paddedRect;let $=j.padding;const Z=V.x+$,re=V.y+$,te=D.data.width,le=D.data.height;$=$>1?$-1:$,qo.copy(D.data,C,{x:0,y:0},{x:Z,y:re},D.data,u),qo.copy(D.data,C,{x:0,y:le-$},{x:Z,y:re-$},{width:te,height:$},u),qo.copy(D.data,C,{x:0,y:0},{x:Z,y:re+le},{width:te,height:$},u),qo.copy(D.data,C,{x:te-$,y:0},{x:Z-$,y:re},{width:$,height:le},u),qo.copy(D.data,C,{x:0,y:0},{x:Z+te,y:re},{width:$,height:le},u),qo.copy(D.data,C,{x:te-$,y:le-$},{x:Z-$,y:re-$},{width:$,height:$},u),qo.copy(D.data,C,{x:0,y:le-$},{x:Z+te,y:re-$},{width:$,height:$},u),qo.copy(D.data,C,{x:0,y:0},{x:Z+te,y:re+le},{width:$,height:$},u),qo.copy(D.data,C,{x:te-$,y:0},{x:Z-$,y:re+le},{width:$,height:$},u)}this.lut=u,this.image=C,this.iconPositions=d,this.patternPositions=g}addImages(r,a,u,d){for(const[g,y]of r.entries()){const{bin:x,imagePosition:E,imageVariant:C}=gE(g,y,u);a.set(g,E),d.push(x),y.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(r,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>r.hasImage(d,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of r.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=Tl.parse(g);if(es.isEqual(y.id,d)){const x=r.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(g),x,a,null)}}for(const g of this.patternPositions.keys()){const y=Tl.parse(g);if(es.isEqual(y.id,d)){const x=r.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(g),x,a,this.lut)}}}}patchUpdatedImage(r,a,u,d=null){if(!r||!a||r.version===a.version)return;r.version=a.version;const[g,y]=r.tl,x=r.sdf;if(this.lut||x){const E={width:a.data.width,height:a.data.height},C=new qo(E);qo.copy(a.data,C,{x:0,y:0},{x:0,y:0},E,d,x),u.update(C,{position:{x:g,y}})}else u.update(a.data,{position:{x:g,y}})}}Yt(L_,"ImagePosition"),Yt(Ck,"ImageAtlas");const N_=1e20;function Ik(l,r,a,u,d,g,y,x,E){for(let C=r;C<r+u;C++)Mk(l,a*g+C,g,d,y,x,E);for(let C=a;C<a+d;C++)Mk(l,C*g+r,1,u,y,x,E)}function Mk(l,r,a,u,d,g,y){g[0]=0,y[0]=-N_,y[1]=N_,d[0]=l[r];for(let x=1,E=0,C=0;x<u;x++){d[x]=l[r+x*a];const R=x*x;do{const D=g[E];C=(d[x]-d[D]+R-D*D)/(x-D)/2}while(C<=y[E]&&--E>-1);E++,g[E]=x,y[E]=C,y[E+1]=N_}for(let x=0,E=0;x<u;x++){for(;y[E+1]<x;)E++;const C=g[E],R=x-C;l[r+x*a]=d[C]+R*R}}const Vl=2,yE={none:0,ideographs:1,all:2};class vm{constructor(r,a,u){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const u=[],d=this.url||Jr.GLYPHS_URL;for(const g in r)for(const y of r[g])u.push({stack:g,id:y});Oe(u,({stack:g,id:y},x)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[y];if(C!==void 0)return void x(null,{stack:g,id:y,glyph:C});if(C=this._tinySDF(E,g,y),C)return E.glyphs[y]=C,void x(null,{stack:g,id:y,glyph:C});const R=Math.floor(y/256);if(256*R>65535)return Ut("glyphs > 65535 not supported"),void x(null,{stack:g,id:y,glyph:C});if(E.ranges[R])return void x(null,{stack:g,id:y,glyph:C});let D=E.requests[R];D||(D=E.requests[R]=[],vm.loadGlyphRange(g,R,d,this.requestManager,(j,V)=>{if(V){E.ascender=V.ascender,E.descender=V.descender;for(const $ in V.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=V.glyphs[+$]);E.ranges[R]=!0}for(const $ of D)$(j,V);delete E.requests[R]})),D.push((j,V)=>{j?x(j):V&&x(null,{stack:g,id:y,glyph:V.glyphs[y]||null})})},(g,y)=>{if(g)a(g);else if(y){const x={};for(const{stack:E,id:C,glyph:R}of y)x[E]===void 0&&(x[E]={}),x[E].glyphs===void 0&&(x[E].glyphs={}),x[E].glyphs[C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},x[E].ascender=this.entries[E].ascender,x[E].descender=this.entries[E].descender;a(null,x)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==yE.none&&(this.localGlyphMode===yE.all?!!this.localFontFamily:!!this.localFontFamily&&(mr["CJK Unified Ideographs"](r)||mr["Hangul Syllables"](r)||mr.Hiragana(r)||mr.Katakana(r)||mr["CJK Symbols and Punctuation"](r)||mr["CJK Unified Ideographs Extension A"](r)||mr["CJK Unified Ideographs Extension B"](r)||mr.Osage(r)))}_tinySDF(r,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let Z="400";/bold/i.test(a)?Z="900":/medium/i.test(a)?Z="500":/light/i.test(a)&&(Z="200"),g=r.tinySDF=new vm.TinySDF({fontFamily:d,fontWeight:Z,fontSize:24*Vl,buffer:3*Vl,radius:8*Vl}),g.fontWeight=Z}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:x,width:E,height:C,glyphWidth:R,glyphHeight:D,glyphLeft:j,glyphTop:V,glyphAdvance:$}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Eh({width:E,height:C},x),metrics:{width:R/Vl,height:D/Vl,left:j/Vl,top:V/Vl-27,advance:$/Vl,localGlyph:!0}}}}vm.loadGlyphRange=function(l,r,a,u,d){const g=256*r,y=g+255,x=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${g}-${y}`),cd.Glyphs);wl(x,(E,C)=>{if(E)d(E);else if(C){const R={},D=function(j){return new Mb(j).readFields(nZ,{})}(C);for(const j of D.glyphs)R[j.id]=j;d(null,{glyphs:R,ascender:D.ascender,descender:D.descender})}})},vm.TinySDF=class{constructor({fontSize:l=24,buffer:r=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:x=null}={}){this.buffer=r,this.cutoff=u,this.radius=a,this.lang=x;const E=this.size=l+4*r,C=this._createCanvas(E),R=this.ctx=C.getContext("2d",{willReadFrequently:!0});R.font=`${y} ${g} ${l}px ${d}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(l){const r=document.createElement("canvas");return r.width=r.height=l,r}draw(l){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(l),y=Math.ceil(a),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),E=Math.min(this.size-this.buffer,y+Math.ceil(u)),C=x+2*this.buffer,R=E+2*this.buffer,D=Math.max(C*R,0),j=new Uint8ClampedArray(D),V={data:j,width:C,height:R,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(x===0||E===0)return V;const{ctx:$,buffer:Z,gridInner:re,gridOuter:te}=this;this.lang&&($.lang=this.lang),$.clearRect(Z,Z,x,E),$.fillText(l,Z,Z+y);const le=$.getImageData(Z,Z,x,E);te.fill(N_,0,D),re.fill(0,0,D);for(let ue=0;ue<E;ue++)for(let fe=0;fe<x;fe++){const we=le.data[4*(ue*x+fe)+3]/255;if(we===0)continue;const _e=(ue+Z)*C+fe+Z;if(we===1)te[_e]=0,re[_e]=N_;else{const Ee=.5-we;te[_e]=Ee>0?Ee*Ee:0,re[_e]=Ee<0?Ee*Ee:0}}Ik(te,0,0,C,R,C,this.f,this.v,this.z),Ik(re,Z,Z,x,E,C,this.f,this.v,this.z);for(let ue=0;ue<D;ue++){const fe=Math.sqrt(te[ue])-Math.sqrt(re[ue]);j[ue]=Math.round(255-255*(fe/this.radius+this.cutoff))}return V}};const kc=Jd;function Ok(l,r){return l+r[1]-r[0]}function _E(l,r,a,u,d=1){const g=[],y=l.imagePrimary,x=y.pixelRatio,E=y.paddedRect.w-2*kc,C=y.paddedRect.h-2*kc,R=(l.right-l.left)*d,D=(l.bottom-l.top)*d,j=y.stretchX||[[0,E]],V=y.stretchY||[[0,C]],$=j.reduce(Ok,0),Z=V.reduce(Ok,0),re=E-$,te=C-Z;let le=0,ue=$,fe=0,we=Z,_e=0,Ee=re,Me=0,De=te;if(y.content&&u){const Ne=y.content;le=Db(j,0,Ne[0]),fe=Db(V,0,Ne[1]),ue=Db(j,Ne[0],Ne[2]),we=Db(V,Ne[1],Ne[3]),_e=Ne[0]-le,Me=Ne[1]-fe,Ee=Ne[2]-Ne[0]-ue,De=Ne[3]-Ne[1]-we}const rt=(Ne,at,ft,pt)=>{const xt=kb(Ne.stretch-le,ue,R,l.left*d),wt=jb(Ne.fixed-_e,Ee,Ne.stretch,$),yt=kb(at.stretch-fe,we,D,l.top*d),_t=jb(at.fixed-Me,De,at.stretch,Z),st=kb(ft.stretch-le,ue,R,l.left*d),it=jb(ft.fixed-_e,Ee,ft.stretch,$),vt=kb(pt.stretch-fe,we,D,l.top*d),Ot=jb(pt.fixed-Me,De,pt.stretch,Z),At=new mt(xt,yt),or=new mt(st,yt),Ft=new mt(st,vt),Ht=new mt(xt,vt),Qt=new mt(wt/x,_t/x),Gr=new mt(it/x,Ot/x),Pt=r*Math.PI/180;if(Pt){const Vn=Math.sin(Pt),ve=Math.cos(Pt),Te=[ve,-Vn,Vn,ve];At._matMult(Te),or._matMult(Te),Ht._matMult(Te),Ft._matMult(Te)}const er=Ne.stretch+Ne.fixed,Pr=ft.stretch+ft.fixed,en=at.stretch+at.fixed,sn=pt.stretch+pt.fixed,kr=l.imageSecondary;return{tl:At,tr:or,bl:Ht,br:Ft,texPrimary:{x:y.paddedRect.x+kc+er,y:y.paddedRect.y+kc+en,w:Pr-er,h:sn-en},texSecondary:kr?{x:kr.paddedRect.x+kc+er,y:kr.paddedRect.y+kc+en,w:Pr-er,h:sn-en}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qt,pixelOffsetBR:Gr,minFontScaleX:Ee/x/R,minFontScaleY:De/x/D,isSDF:a}};if(u&&(y.stretchX||y.stretchY)){const Ne=Rk(j,re,$),at=Rk(V,te,Z);for(let ft=0;ft<Ne.length-1;ft++){const pt=Ne[ft],xt=Ne[ft+1];for(let wt=0;wt<at.length-1;wt++)g.push(rt(pt,at[wt],xt,at[wt+1]))}}else g.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:C+1}));return g}function uZ(l,r){const a=l.stretchY||[[0,l.paddedRect.h-2*kc]];return r&&(l.stretchX||l.stretchY)?Dk(l.stretchX||[[0,l.paddedRect.w-2*kc]])*Dk(a):1}function Db(l,r,a){let u=0;for(const d of l)u+=Math.max(r,Math.min(a,d[1]))-Math.max(r,Math.min(a,d[0]));return u}function Rk(l,r,a){const u=[{fixed:-kc,stretch:0}];for(const[d,g]of l){const y=u[u.length-1];u.push({fixed:d-y.stretch,stretch:y.stretch}),u.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return u.push({fixed:r+kc,stretch:a}),u}function Dk(l){return 2*l.length+1}function kb(l,r,a,u){return l/r*a+u}function jb(l,r,a,u){return l-r*a/u}function hZ(l,r,a,u){const d=r+l.positionedLines[u].lineOffset;return u===0?a+d/2:a+(d+(r+l.positionedLines[u-1].lineOffset))/2}function dZ(l,r=1,a=!1){let u=1/0,d=1/0,g=-1/0,y=-1/0;const x=l[0];for(let V=0;V<x.length;V++){const $=x[V];(!V||$.x<u)&&(u=$.x),(!V||$.y<d)&&(d=$.y),(!V||$.x>g)&&(g=$.x),(!V||$.y>y)&&(y=$.y)}const E=Math.min(g-u,y-d);let C=E/2;const R=new cp([],fZ);if(E===0)return new mt(u,d);for(let V=u;V<g;V+=E)for(let $=d;$<y;$+=E)R.push(new xm(V+C,$+C,C,l));let D=function(V){let $=0,Z=0,re=0;const te=V[0];for(let le=0,ue=te.length,fe=ue-1;le<ue;fe=le++){const we=te[le],_e=te[fe],Ee=we.x*_e.y-_e.x*we.y;Z+=(we.x+_e.x)*Ee,re+=(we.y+_e.y)*Ee,$+=3*Ee}return new xm(Z/$,re/$,0,V)}(l),j=R.length;for(;R.length;){const V=R.pop();(V.d>D.d||!D.d)&&(D=V,a&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,j)),V.max-D.d<=r||(C=V.h/2,R.push(new xm(V.p.x-C,V.p.y-C,C,l)),R.push(new xm(V.p.x+C,V.p.y-C,C,l)),R.push(new xm(V.p.x-C,V.p.y+C,C,l)),R.push(new xm(V.p.x+C,V.p.y+C,C,l)),j+=4)}return a&&(console.log(`num probes: ${j}`),console.log(`best distance: ${D.d}`)),D.p}function fZ(l,r){return r.max-l.max}class xm{constructor(r,a,u,d){this.p=new mt(r,a),this.h=u,this.d=function(g,y){let x=!1,E=1/0;for(let C=0;C<y.length;C++){const R=y[C];for(let D=0,j=R.length,V=j-1;D<j;V=D++){const $=R[D],Z=R[V];$.y>g.y!=Z.y>g.y&&g.x<(Z.x-$.x)*(g.y-$.y)/(Z.y-$.y)+$.x&&(x=!x),E=Math.min(E,Di(g,$,Z))}}return(x?1:-1)*Math.sqrt(E)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const pZ=Object.keys,vE=Number.POSITIVE_INFINITY,mZ=Math.sqrt(2);function Ph(l,r,a,u,d){const g=fE(l)&&l.collisionPadding?l.collisionPadding:[0,0,0,0],y={top:l.top-g[1],bottom:l.bottom+g[3],left:l.left-g[0],right:l.right+g[2],scaled:!1};return u!==void 0&&function(x,E){x.top*=E,x.bottom*=E,x.left*=E,x.right*=E,x.scaled=!0}(y,u),a&&function(x,E){if(!E)return;const C=qr(E),R=new mt(x.left,x.top),D=new mt(x.right,x.top),j=new mt(x.left,x.bottom),V=new mt(x.right,x.bottom),$=new mt(0,0);R._rotateAround(C,$),D._rotateAround(C,$),j._rotateAround(C,$),V._rotateAround(C,$),x.left=Math.min(R.x,D.x,j.x,V.x),x.right=Math.max(R.x,D.x,j.x,V.x),x.top=Math.min(R.y,D.y,j.y,V.y),x.bottom=Math.max(R.y,D.y,j.y,V.y)}(y,a),d&&(y.left+=d[0],y.right+=d[0],y.top+=d[1],y.bottom+=d[1]),r?{top:Math.min(r.top,y.top),bottom:Math.max(r.bottom,y.bottom),left:Math.min(r.left,y.left),right:Math.max(r.right,y.right),scaled:r.scaled||y.scaled}:y}function kk(l,[r,a]){let u=0,d=0;if(a===vE){r<0&&(r=0);const g=r/mZ;switch(l){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-r;break;case"top":d=r-7}switch(l){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),l){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(l){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,d]}function gZ(l,r,a,u,d,g,y,x,E,C,R,D,j,V){const $=l.layers[0],Z=$.appearances;if(Z.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const re={iconBBox:null,iconVerticalBBox:null},te={textBBox:null,textVerticalBBox:null},{baseIconRotate:le,baseTextRotate:ue,iconScaleFactor:fe}=function(_e,Ee,Me){const De=_e.get("icon-rotate").evaluate(Ee,{},Me),rt=_e.get("text-rotate").evaluate(Ee,{},Me),[Ne,at]=_e.get("icon-size-scale-range");return{baseIconRotate:De,baseTextRotate:rt,iconScaleFactor:ne(1,Ne,at)}}(u,d,g);r&&(re.iconBBox=Ph(r,re.iconBBox,le,y),a)&&(re.iconVerticalBBox=Ph(a,re.iconVerticalBBox,le+90,y));const we=Nb(D.horizontal);we&&(te.textBBox=Ph(we,te.textBBox,ue,1,V)),D.vertical&&(te.textVerticalBBox=Ph(D.vertical,te.textVerticalBBox,ue+90,1,V));for(const _e of Z)_e.hasIconProperties()&&yZ(re,l,$,_e,d,g,x,le,y,E,r,C,fe,R),_e.hasTextProperties()&&_Z(te,$,_e,d,g,V,ue,j,we,D.vertical);return{iconBBox:re.iconBBox,iconVerticalBBox:re.iconVerticalBBox,textBBox:te.textBBox,textVerticalBBox:te.textVerticalBBox}}function yZ(l,r,a,u,d,g,y,x,E,C,R,D,j,V){const{appearanceIconOffset:$,appearanceIconRotate:Z,appearanceIconSize:re}=function(fe,we,_e,Ee,Me,De,rt,Ne){const at=fe.hasProperty("icon-offset")?we.getAppearanceValueAndResolveTokens(fe,"icon-offset",_e,Ee,[]):null,ft=at&&Array.isArray(at)?at:Me,pt=fe.hasProperty("icon-rotate")?we.getAppearanceValueAndResolveTokens(fe,"icon-rotate",_e,Ee,[]):null,xt=typeof pt=="number"?pt:De,wt=fe.hasProperty("icon-size")?we.getAppearanceValueAndResolveTokens(fe,"icon-size",_e,Ee,[]):null;return{appearanceIconOffset:ft,appearanceIconRotate:xt,appearanceIconSize:typeof wt=="number"?wt*Ne.iconScaleFactor:rt}}(u,a,d,g,y,x,E,C);let te=null,le=null,ue=null;u.hasProperty("icon-image")?ue=function(fe,we,_e,Ee,Me,De,rt){let Ne=null;const at=we.getAppearanceValueAndResolveTokens(_e,"icon-image",Ee,Me,[]);if(at){const ft=fe.getResolvedImageFromTokens(at),pt=_e.getUnevaluatedProperty("icon-size"),xt=z_(ft,ym(fe.zoom,pt,fe.worldview),pt,Me,fe.zoom,Ee,fe.pixelRatio,rt,fe.worldview);Ne=De.get(xt.iconPrimary.toString())}return Ne}(r,a,u,d,g,D,j):R&&(ue=R.imagePrimary),ue&&(te=Rb(ue,null,$,V),r.allowVerticalPlacement&&(le=Rb(ue,null,$,V))),te&&(l.iconBBox=Ph(te,l.iconBBox,Z,re)),le&&(l.iconVerticalBBox=Ph(le,l.iconVerticalBBox,Z+90,re))}function _Z(l,r,a,u,d,g,y,x,E,C){const{appearanceTextOffset:R,appearanceTextRotate:D,appearanceTextSize:j}=function($,Z,re,te,le,ue,fe){const we=$.hasProperty("text-offset")?Z.getAppearanceValueAndResolveTokens($,"text-offset",re,te,[]):null,_e=we&&Array.isArray(we)?[we[0]*_o,we[1]*_o]:le,Ee=$.hasProperty("text-rotate")?Z.getAppearanceValueAndResolveTokens($,"text-rotate",re,te,[]):null,Me=typeof Ee=="number"?Ee:ue,De=$.hasProperty("text-size")?Z.getAppearanceValueAndResolveTokens($,"text-size",re,te,[]):null;return{appearanceTextOffset:_e,appearanceTextRotate:Me,appearanceTextSize:typeof De=="number"?De:fe}}(a,r,u,d,g,y,x),V=j/x;E&&(l.textBBox=Ph(E,l.textBBox,D,V,R)),C&&(l.textVerticalBBox=Ph(C,l.textVerticalBBox,D+90,V,R))}function Lb(l,r,a,u,d,g,y,x,E){if(!r||!r.usvg)return;const C=bk(u),R=bk(d),D=g!=="both"&&g!=="width"||!vk(u)?1:R.width/C.width,j=g!=="both"&&g!=="height"||!xk(u)?1:R.height/C.height;a.scaleSelf(D,j);const V=a.toString();y.set(V,a),x.set(V,r);const{imagePosition:$}=gE(V,r,Jd);E.set(V,$)}function jk(l,r,a,u,d,g,y,x,E){if(!l)return;const C=function(R,D,j,V,$,Z){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const re=D.possiblyEvaluate(new ri(R.maxZoom,{worldview:Z}),j).evaluate($,{},j),te=D.possiblyEvaluate(new ri(R.minZoom,{worldview:Z}),j).evaluate($,{},j);return Math.max(re,te)}return D.possiblyEvaluate(new ri(V,{worldview:Z})).evaluate($,{},j)}(r,a,u,d,g,E);return l.scaleSelf(C*x*y)}function z_(l,r,a,u,d,g,y,x,E){return{iconPrimary:jk(l.getPrimary(),r,a,u,d,g,y,x,E),iconSecondary:jk(l.getSecondary(),r,a,u,d,g,y,x,E)}}function vZ(l,r,a){if(!r)return;const u=a.get(l.toString()),d=a.get(r.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||Ut(`Mismatch in icon variant sizes: ${l.toString()} and ${r.toString()}`),u.usvg!==d.usvg&&Ut(`Mismatch in icon variant image types: ${l.id} and ${r.id}`))}function Lk(l,r,a,u){if(!l)return;const d=r.get(a.toString());if(l.imagePrimary=d,u){const g=r.get(u.toString());l.imageSecondary=g}}function xZ(l,r){for(const a in l.horizontal)Nk(l.horizontal[a],r);Nk(l.vertical,r)}function Nk(l,r){if(l){for(const a of l.positionedLines)for(const u of a.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=r.get(d).paddedRect}}}function xE(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bZ(l,r,a,u,d,g,y,x,E){const C=Nb(g.horizontal)||g.vertical,R=a.get("icon-text-fit-padding").evaluate(u,{},d);let D,j=r;return r&&E!=="none"&&(l.allowVerticalPlacement&&g.vertical&&(D=pE(r,g.vertical,E,R,x,y)),C&&(j=pE(r,C,E,R,x,y))),{defaultShapedIcon:j,verticallyShapedIcon:D}}function wZ(l,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le,ue,fe,we,_e,Ee){let Me=y.textMaxSize.evaluate(r,{},j);Me===void 0?Me=x*y.textScaleFactor:Me*=y.textScaleFactor;const De=l.layers[0].layout,rt=_o,Ne=x*y.textScaleFactor/rt,at=Nb(a.horizontal)||a.vertical;if(re!=="none"&&l.appearanceFeatureData&&r.index<l.appearanceFeatureData.length){const Ft=l.appearanceFeatureData[r.index];Ft&&(Ft.textShaping=at,Ft.iconTextFitPadding=De.get("icon-text-fit-padding").evaluate(r,{},j),Ft.fontScale=Ne)}const ft=V.name==="globe",pt=l.tilePixelRatio*Me/rt,xt=(vt=l.overscaling,l.zoom>18&&vt>2&&(vt>>=1),Math.max(Mt/(512*vt),1)*De.get("symbol-spacing")),wt=De.get("text-padding")*l.tilePixelRatio,yt=De.get("icon-padding")*l.tilePixelRatio,_t=qr(De.get("text-max-angle")),st=De.get("icon-rotation-alignment")==="map"&&ue!=="point",it=xt/2;var vt;l.hasAnyIconTextFit===!1&&re!=="none"&&(l.hasAnyIconTextFit=!0);const Ot=r.properties?+r.properties[ot]:null,At=Ot&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(Ot):65535,or=(Ft,Ht,Qt)=>{if(Ht.x<0||Ht.x>=Mt||Ht.y<0||Ht.y>=Mt)return;let Gr=null;if(ft){const{x:Pt,y:er,z:Pr}=V.projectTilePoint(Ht.x,Ht.y,Qt);Gr={anchor:new Su(Pt,er,Pr,0,void 0),up:V.upVector(Qt,Ht.x,Ht.y)}}(function(Pt,er,Pr,en,sn,kr,Vn,ve,Te,lt,bt,kt,jt,sr,ur,Rr,Vr,Ur,Kr,_r,Sr,pn,xn,bn,jn,Xn,$n,Tn,Cn,$r,tn,pi,gr){const Yr=Pt.addToLineVertexArray(er,en);let Gn,Qn,ni,Ni,ei,yr,vi,Ln=0,di=0,io=0,vo=0,Zi=-1,Xi=-1;const uo={};let Is=Yf("");const ti=Pr?Pr.anchor:er,ki=Tn!=="none";let zi=0,zs=0;if(Te._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Fo=Te.layout.get("text-offset").evaluate(Sr,{},jn);zi=Fo[0]*_o,zs=Fo[1]*_o}else zi=Te.layout.get("text-radial-offset").evaluate(Sr,{},jn)*_o,zs=vE;if(Pt.allowVerticalPlacement&&sn.vertical){const Fo=sn.vertical;if(ur)yr=bE(Fo),ve&&(vi=bE(ve));else{const vs=Te.layout.get("text-rotate").evaluate(Sr,{},jn)+90;ni=zb(lt,ti,er,bt,kt,jt,Fo,sr,vs,Rr,pi),ve&&(Ni=zb(lt,ti,er,bt,kt,jt,ve,Ur,vs,null,tn))}}if(kr){const Fo=Pt.iconSizeData,vs=Te.layout.get("icon-rotate").evaluate(Sr,{},jn),Qs=_E(kr,vs,xn,ki,pn.iconScaleFactor),Mh=ve?_E(ve,vs,xn,ki,pn.iconScaleFactor):void 0;Qn=zb(lt,ti,er,bt,kt,jt,kr,Ur,vs,null,$r);const Pm=function(Hl,rv,rL,kX,nL,iL,jX,LX){const oL=Hl.layers[0],sL=oL.appearances;let Cm=rv.length;if(rL&&(Cm=Math.max(Cm,rL.length)),sL.length===0)return Cm;const[NX,zX]=kX.get("icon-size-scale-range"),FX=ne(1,NX,zX);for(const aL of sL){const lL=aL.getUnevaluatedProperties();if(lL._values["icon-image"].value!==void 0){const cL=oL.getAppearanceValueAndResolveTokens(aL,"icon-image",nL,iL,[]);if(cL){const uL=Hl.getResolvedImageFromTokens(cL);if(uL){const hL=lL._values["icon-size"],BX=z_(uL,ym(Hl.zoom,hL,Hl.worldview),hL,iL,Hl.zoom,nL,Hl.pixelRatio,FX,Hl.worldview),VX=jX.get(BX.iconPrimary.toString());Cm=Math.max(Cm,uZ(VX,LX))}}}}return Cm}(Pt,Qs,Mh,Te.layout,Sr,jn,Pt.iconAtlasPositions,ki);Ln=4*Pm;let Gl=null;Fo.kind==="source"?(Gl=[Bl*Te.layout.get("icon-size").evaluate(Sr,{},jn)*pn.iconScaleFactor],Gl[0]>Eu&&Ut(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${F_}. Reduce your "icon-size".`)):Fo.kind==="composite"&&(Gl=[Bl*pn.compositeIconSizes[0].evaluate(Sr,{},jn)*pn.iconScaleFactor,Bl*pn.compositeIconSizes[1].evaluate(Sr,{},jn)*pn.iconScaleFactor],(Gl[0]>Eu||Gl[1]>Eu)&&Ut(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${F_}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,Qs,Gl,_r,Kr,Sr,void 0,Pr,er,Yr.lineStartIndex,Yr.lineLength,-1,bn,jn,Xn,$n,Pt.symbolInstances.length,Pm),Zi=Pt.icon.placedSymbolArray.length-1,Mh&&(di=4*Pm,Pt.addSymbols(Pt.icon,Mh,Gl,_r,Kr,Sr,Js.vertical,Pr,er,Yr.lineStartIndex,Yr.lineLength,-1,bn,jn,Xn,$n,Pt.symbolInstances.length,Pm),Xi=Pt.icon.placedSymbolArray.length-1)}for(const Fo in sn.horizontal){const vs=Fo,Qs=sn.horizontal[vs];Gn||(Is=Yf(Qs.text),ur?ei=bE(Qs):Gn=zb(lt,ti,er,bt,kt,jt,Qs,sr,Te.layout.get("text-rotate").evaluate(Sr,{},jn),Rr,pi));const Mh=Qs.positionedLines.length===1;if(io+=zk(Pt,Pr,er,Qs,Vn,Te,ur,Sr,Rr,Yr,sn.vertical?Js.horizontal:Js.horizontalOnly,Mh?pZ(sn.horizontal):[vs],uo,Zi,pn,bn,jn,Pt.symbolInstances.length,Xn),Mh)break}sn.vertical&&(vo+=zk(Pt,Pr,er,sn.vertical,Vn,Te,ur,Sr,Rr,Yr,Js.vertical,["vertical"],uo,Xi,pn,bn,jn,Pt.symbolInstances.length,Xn));let oo=-1;const nl=(Fo,vs)=>Fo?Math.max(Fo,vs):vs;oo=nl(ei,oo),oo=nl(yr,oo),oo=nl(vi,oo);const jc=oo>-1?1:0;Pt.glyphOffsetArray.length>=65535&&Ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sr.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,Sr.sortKey),Pt.symbolInstances.emplaceBack(er.x,er.y,ti.x,ti.y,ti.z,uo.right>=0?uo.right:-1,uo.center>=0?uo.center:-1,uo.left>=0?uo.left:-1,uo.vertical>=0?uo.vertical:-1,Zi,Xi,Is,Gn!==void 0?Gn:Pt.collisionBoxArray.length,Gn!==void 0?Gn+1:Pt.collisionBoxArray.length,ni!==void 0?ni:Pt.collisionBoxArray.length,ni!==void 0?ni+1:Pt.collisionBoxArray.length,Qn!==void 0?Qn:Pt.collisionBoxArray.length,Qn!==void 0?Qn+1:Pt.collisionBoxArray.length,Ni||Pt.collisionBoxArray.length,Ni?Ni+1:Pt.collisionBoxArray.length,bt,io,vo,Ln,di,jc,0,zi,zs,oo,0,ki?1:0,Cn)})(l,Ht,Gr,Ft,a,u,g,d,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,wt,le,C,0,yt,st,te,r,y,R,D,j,$,Z,re,At,fe,we,_e)};if(ue==="line")for(const Ft of vb(r.geometry,0,0,Mt,Mt)){const Ht=cZ(Ft,xt,_t,a.vertical||at,u,rt,pt,l.overscaling,Mt);for(const Qt of Ht)at&&TZ(l,at.text,it,Qt)||or(Ft,Qt,j)}else if(ue==="line-center"){for(const Ft of r.geometry)if(Ft.length>1){const Ht=lZ(Ft,_t,a.vertical||at,u,rt,pt);Ht&&or(Ft,Ht,j)}}else if(r.type==="Polygon")for(const Ft of b_(r.geometry,0)){const Ht=dZ(Ft,16);or(Ft[0],new Su(Ht.x,Ht.y,0,0,void 0),j)}else if(r.type==="LineString")for(const Ft of r.geometry)or(Ft,new Su(Ft[0].x,Ft[0].y,0,0,void 0),j);else if(r.type==="Point")for(const Ft of r.geometry)for(const Ht of Ft)or([Ht],new Su(Ht.x,Ht.y,0,0,void 0),j)}const F_=255,Eu=F_*Bl;function zk(l,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le){const ue=function(_e,Ee,Me,De,rt,Ne,at,ft){const pt=[];if(Ee.positionedLines.length===0)return pt;const xt=De.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,wt=function(vt){const Ot=vt[0],At=vt[1],or=Ot*At;return or>0?[Ot,-At]:or<0?[-Ot,At]:Ot===0?[At,Ot]:[At,-Ot]}(Me);let yt=Math.abs(Ee.top-Ee.bottom);for(const vt of Ee.positionedLines)yt-=vt.lineOffset;const _t=Ee.positionedLines.length,st=yt/_t;let it=Ee.top-Me[1];for(let vt=0;vt<_t;++vt){const Ot=Ee.positionedLines[vt];it=hZ(Ee,st,it,vt);for(const At of Ot.positionedGlyphs){if(!At.rect)continue;const or=At.rect||{};let Ft=fk+1,Ht=!0,Qt=1,Gr=0;if(At.image){const Vr=at.get(At.image.toString());if(!Vr)continue;if(Vr.sdf){Ut("SDF images are not supported in formatted text and will be ignored.");continue}Ht=!1,Qt=Vr.pixelRatio,Ft=Jd/Qt}const Pt=(rt||ft)&&At.vertical,er=At.metrics.advance*At.scale/2,Pr=At.metrics,en=At.rect;if(en===null)continue;ft&&Ee.verticalizable&&(Gr=At.image?er-At.metrics.width*At.scale/2:0);const sn=rt?[At.x+er,At.y]:[0,0];let kr=[0,0],Vn=[0,0],ve=!1;rt||(Pt?(Vn=[At.x+er+wt[0],At.y+wt[1]-Gr],ve=!0):kr=[At.x+er+Me[0],At.y+Me[1]-Gr]);const Te=en.w*At.scale/(Qt*(At.localGlyph?Vl:1)),lt=en.h*At.scale/(Qt*(At.localGlyph?Vl:1));let bt,kt,jt,sr;if(Pt){const Vr=At.y-it,Ur=new mt(-er,er-Vr),Kr=-Math.PI/2,_r=new mt(...Vn);bt=new mt(-er+kr[0],kr[1]),bt._rotateAround(Kr,Ur)._add(_r),bt.x+=-Vr+er,bt.y-=(Pr.left-Ft)*At.scale;const Sr=At.image?Pr.advance*At.scale:_o*At.scale,pn=String.fromCodePoint(At.glyph);W7(pn)?bt.x+=(1-Ft)*At.scale:q7(pn)?bt.x+=Sr-Pr.height*At.scale+(-Ft-1)*At.scale:bt.x+=At.image||Pr.width+2*Ft===en.w&&Pr.height+2*Ft===en.h?(Sr-lt)/2:(Sr-(Pr.height+2*Ft)*At.scale)/2,kt=new mt(bt.x,bt.y-Te),jt=new mt(bt.x+lt,bt.y),sr=new mt(bt.x+lt,bt.y-Te)}else{const Vr=(Pr.left-Ft)*At.scale-er+kr[0],Ur=(-Pr.top-Ft)*At.scale+kr[1],Kr=Vr+Te,_r=Ur+lt;bt=new mt(Vr,Ur),kt=new mt(Kr,Ur),jt=new mt(Vr,_r),sr=new mt(Kr,_r)}if(xt){let Vr;Vr=rt?new mt(0,0):ve?new mt(wt[0],wt[1]):new mt(Me[0],Me[1]),bt._rotateAround(xt,Vr),kt._rotateAround(xt,Vr),jt._rotateAround(xt,Vr),sr._rotateAround(xt,Vr)}const ur=new mt(0,0),Rr=new mt(0,0);pt.push({tl:bt,tr:kt,bl:jt,br:sr,texPrimary:or,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:sn,sectionIndex:At.sectionIndex,isSDF:Ht,pixelOffsetTL:ur,pixelOffsetBR:Rr,minFontScaleX:0,minFontScaleY:0})}}return pt}(0,u,E,g,y,x,d,l.allowVerticalPlacement),fe=l.textSizeData;let we=null;fe.kind==="source"?(we=[Bl*g.layout.get("text-size").evaluate(x,{},re)*$.textScaleFactor],we[0]>Eu&&Ut(`${l.layerIds[0]}: Value for "text-size" is >= ${F_}. Reduce your "text-size".`)):fe.kind==="composite"&&(we=[Bl*$.compositeTextSizes[0].evaluate(x,{},re)*$.textScaleFactor,Bl*$.compositeTextSizes[1].evaluate(x,{},re)*$.textScaleFactor],(we[0]>Eu||we[1]>Eu)&&Ut(`${l.layerIds[0]}: Value for "text-size" is >= ${F_}. Reduce your "text-size".`)),l.addSymbols(l.text,ue,we,E,y,x,R,r,a,C.lineStartIndex,C.lineLength,V,Z,re,le,!1,te,ue.length);for(const _e of D)j[_e]=l.text.placedSymbolArray.length-1;return 4*ue.length}function Nb(l){for(const r in l)return l[r];return null}function zb(l,r,a,u,d,g,y,x,E,C,R){let D,j,V,$;if(D=R?R.top:y.top,j=R?R.bottom:y.bottom,V=R?R.left:y.left,$=R?R.right:y.right,fE(y)&&y.collisionPadding){const Z=y.collisionPadding;V-=Z[0],D-=Z[1],$+=Z[2],j+=Z[3]}if(E){const Z=new mt(V,D),re=new mt($,D),te=new mt(V,j),le=new mt($,j),ue=qr(E);let fe=new mt(0,0);C&&(fe=new mt(C[0],C[1])),Z._rotateAround(ue,fe),re._rotateAround(ue,fe),te._rotateAround(ue,fe),le._rotateAround(ue,fe),V=Math.min(Z.x,re.x,te.x,le.x),$=Math.max(Z.x,re.x,te.x,le.x),D=Math.min(Z.y,re.y,te.y,le.y),j=Math.max(Z.y,re.y,te.y,le.y)}return l.emplaceBack(r.x,r.y,r.z,a.x,a.y,V,D,$,j,x,u,d,g),l.length-1}function bE(l){fE(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const r=l.bottom-l.top;return r>0?Math.max(10,r):null}function TZ(l,r,a,u){const d=l.compareText;if(r in d){const g=d[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<a)return!0}else d[r]=[];return d[r].push(u),!1}function Fk(l,r){const a=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*r:0,d=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),g=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let y=Math.sin(l._pitch)*g+d;const x=d*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let E=Math.max(l.zoom-17,0);l.isOrthographic&&(E/=10),y*=1+E}return Math.min(1.01*y,x)}function B_(l,r){if(!r.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:r};const a=Math.pow(2,-l.z),u=l.x*a,d=(l.x+1)*a,g=l.y*a,y=(l.y+1)*a,x=N(u),E=N(d),C=W(g),R=W(y),D=r.project(x,C),j=r.project(E,C),V=r.project(E,R),$=r.project(x,R);let Z=Math.min(D.x,j.x,V.x,$.x),re=Math.min(D.y,j.y,V.y,$.y),te=Math.max(D.x,j.x,V.x,$.x),le=Math.max(D.y,j.y,V.y,$.y);const ue=a/16;function fe(_e,Ee,Me,De,rt,Ne){const at=(Me+rt)/2,ft=(De+Ne)/2,pt=r.project(N(at),W(ft)),xt=Math.max(0,Z-pt.x,re-pt.y,pt.x-te,pt.y-le);Z=Math.min(Z,pt.x),te=Math.max(te,pt.x),re=Math.min(re,pt.y),le=Math.max(le,pt.y),xt>ue&&(fe(_e,pt,Me,De,at,ft),fe(pt,Ee,at,ft,rt,Ne))}fe(D,j,u,g,d,g),fe(j,V,d,g,d,y),fe(V,$,d,y,u,y),fe($,D,u,y,u,g),Z-=ue,re-=ue,te+=ue,le+=ue;const we=1/Math.max(te-Z,le-re);return{scale:we,x:Z*we,y:re*we,x2:te*we,y2:le*we,projection:r}}function Bk(l,{x:r,y:a},u=0){return new mt(((r-u)*l.scale-l.x)*Mt,(a*l.scale-l.y)*Mt)}const SZ=U(new Float32Array(16));class Ch{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new c(0,0)}projectTilePoint(r,a,u){return{x:r,y:a,z:0}}locationPoint(r,a,u,d=!0){return r._coordinatePoint(r.locationCoordinate(a,u),d)}pixelsPerMeter(r,a){return k(1,r)*a}pixelSpaceConversion(r,a,u){return 1}farthestPixelDistance(r){return Fk(r,r.pixelsPerMeter)}pointCoordinate(r,a,u,d){const g=r.horizonLineFromTop(!1),y=new mt(a,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,d))}pointCoordinate3D(r,a,u){const d=new mt(a,u);if(r.elevation)return r.elevation.pointCoordinate(d);{const g=this.pointCoordinate(r,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(r,a){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,a.x,a.y);const u=r.horizonLineFromTop();return a.y<u}createInversionMatrix(r,a){return SZ}createTileMatrix(r,a,u){let d,g,y;const x=u.canonical,E=U(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=B_(x,this);d=1,g=C.x+u.wrap*C.scale,y=C.y,ie(E,E,[d/C.scale,d/C.scale,r.pixelsPerMeter/a])}else d=a/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*u.wrap)*d,y=x.y*d;return X(E,E,[g,y,0]),ie(E,E,[d/Mt,d/Mt,1]),E}upVector(r,a,u){return[0,0,1]}upVectorScale(r,a,u){return{metersToTile:1}}}class EZ extends Ch{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,u]=this.parallels=r.parallels||[29.5,45.5],d=Math.sin(qr(a));this.n=(d+Math.sin(qr(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:u,c:d,r0:g}=this,y=qr(r-this.center[0]),x=qr(a),E=Math.sqrt(d-2*u*Math.sin(x))/u;return{x:E*Math.sin(y*u),y:E*Math.cos(y*u)-g,z:0}}unproject(r,a){const{n:u,c:d,r0:g}=this,y=g+a;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=qr(this.center[0])*u;x=ge(x,-Math.PI-E,Math.PI-E);const C=ne(Jo(x/u)+this.center[0],-180,180),R=Math.asin(ne((d-(r*r+y*y)*u*u)/(2*u),-1,1)),D=ne(Jo(R),-q,q);return new c(C,D)}}const V_=1.340264,$_=-.081106,U_=893e-6,G_=.003796,Fb=Math.sqrt(3)/2;class AZ extends Ch{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(Fb*Math.sin(a)),d=u*u,g=d*d*d;return{x:.5*(r*Math.cos(u)/(Fb*(V_+3*$_*d+g*(7*U_+9*G_*d)))/Math.PI+.5),y:1-.5*(u*(V_+$_*d+g*(U_+G_*d))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,g=d*d*d;for(let R,D,j,V=0;V<12&&(D=u*(V_+$_*d+g*(U_+G_*d))-a,j=V_+3*$_*d+g*(7*U_+9*G_*d),R=D/j,u=ne(u-R,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(R)<1e-12));++V);const y=Fb*r*(V_+3*$_*d+g*(7*U_+9*G_*d))/Math.cos(u),x=Math.asin(Math.sin(u)/Fb),E=ne(180*y/Math.PI,-180,180),C=ne(180*x/Math.PI,-q,q);return new c(E,C)}}class PZ extends Ch{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const u=360*(r-.5),d=ne(360*(.5-a),-q,q);return new c(u,d)}}const bm=Math.PI/2;function Bb(l){return Math.tan((bm+l)/2)}class CZ extends Ch{constructor(r){super(r),this.center=r.center||[0,30];const[a,u]=this.parallels=r.parallels||[30,30];let d=qr(a),g=qr(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const y=Math.cos(d),x=Bb(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(Bb(g)/x),this.f=y*Math.pow(Bb(d),this.n)/this.n}project(r,a){a=qr(a),this.southernCenter&&(a=-a),r=qr(r-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?a<-bm+u&&(a=-bm+u):a>bm-u&&(a=bm-u);const y=g/Math.pow(Bb(a),d);let x=y*Math.sin(d*r),E=g-y*Math.cos(d*r);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,g=d-a,y=Math.sign(g),x=Math.sign(u)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*u<0&&(E-=Math.PI*Math.sign(r)*y);const C=ne(Jo(E/u)+this.center[0],-180,180),R=ne(Jo(2*Math.atan(Math.pow(d/x,1/u))-bm),-q,q);return new c(C,this.southernCenter?-R:R)}}class Vk extends Ch{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:P(r),y:O(a),z:0}}unproject(r,a){const u=N(r),d=W(a);return new c(u,d)}}const $k=qr(q);class IZ extends Ch{project(r,a){const u=(a=qr(a))*a,d=u*u;return{x:.5*((r=qr(r))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,g=0,y=u*u;do{y=u*u;const C=y*y;g=(u*(1.007226+y*(.015085+C*(.028874*y-.044475-.005916*C)))-a)/(1.007226+y*(.045255+C*(.259866*y-.311325-.005916*11*C))),u=ne(u-g,-$k,$k)}while(Math.abs(g)>1e-6&&--d>0);y=u*u;const x=ne(Jo(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Jo(u);return new c(x,E)}}const Uk=qr(q);class MZ extends Ch{project(r,a){a=qr(a),r=qr(r);const u=Math.cos(a),d=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*d+2*u*Math.sin(r/2)/y)||0,E=.5*(a+Math.sin(a)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,a){let u=r=(2*r-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const C=Math.cos(d),R=Math.sin(d),D=2*R*C,j=R*R,V=C*C,$=Math.cos(u/2),Z=Math.sin(u/2),re=2*$*Z,te=Z*Z,le=1-V*$*$,ue=le?1/le:0,fe=le?Math.acos(C*$)*Math.sqrt(1/le):0,we=.5*(2*fe*C*Z+2*u/Math.PI)-r,_e=.5*(fe*R+d)-a,Ee=.5*ue*(V*te+fe*C*$*j)+1/Math.PI,Me=ue*(re*D/4-fe*R*Z),De=.125*ue*(D*Z-fe*R*V*re),rt=.5*ue*(j*$+fe*te*C)+.5,Ne=Me*De-rt*Ee;x=(_e*Me-we*rt)/Ne,E=(we*De-_e*Ee)/Ne,u=ne(u-x,-Math.PI,Math.PI),d=ne(d-E,-Uk,Uk)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new c(Jo(u),Jo(d))}}class Gk extends Ch{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:u,cosPhi:d}=this;return{x:qr(r)*d*u+.5,y:-Math.sin(qr(a))/d*u+.5,z:0}}unproject(r,a){const{scale:u,cosPhi:d}=this,g=-(a-.5)/u,y=ne(Jo((r-.5)/u)/d,-180,180),x=Math.asin(ne(g*d,-1,1)),E=ne(Jo(x),-q,q);return new c(y,E)}}class OZ extends Vk{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,u){const d=m_(r,a,u);return Nr(d,d,ub(Da(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(r,a,u){const d=bh(a.lat,a.lng),g=Lt([],d),y=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;xr(d,d,g,k(1,0)*Mt*y);const x=U(new Float64Array(16));return J(x,r.pixelMatrix,r.globeMatrix),Nr(d,d,x),new mt(d[0],d[1])}pixelsPerMeter(r,a){return k(1,0)*a}pixelSpaceConversion(r,a,u){const d=k(1,r)*a,g=vr(k(1,45)*a,d,u);return this.pixelsPerMeter(r,a)/g}createTileMatrix(r,a,u){const d=A2(Da(u.canonical));return J(new Float64Array(16),r.globeMatrix,d)}createInversionMatrix(r,a){const{center:u}=r,d=ub(Da(a));return ae(d,d,qr(u.lng)),Q(d,d,qr(u.lat)),ie(d,d,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(r,a,u,d){return Th(r,a,u,!0)||new he(0,0)}pointCoordinate3D(r,a,u){const d=this.pointCoordinate(r,a,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(r,a){return!Th(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(d,g){const y=d.cameraToCenterDistance,x=d._centerAltitude*g,E=d._camera,C=d._camera.forward(),R=ut([],Vt([],C,-y),[0,0,x]),D=d.worldSize/(2*Math.PI),j=[0,0,-D],V=d.width/d.height,$=Math.tan(d.fovAboveCenter),Z=Vt([],E.up(),$),re=Vt([],E.right(),$*V),te=Lt([],ut([],ut([],C,Z),re)),le=[];let ue;if(new Jt(R,te).closestPointOnSphere(j,D,le)){const fe=ut([],le,j),we=Kn([],fe,R);ue=Math.cos(d.fovAboveCenter)*ct(we)}else{const fe=Kn([],R,j),we=Kn([],j,R);Lt(we,we);const _e=ct(fe)-D;ue=Math.sqrt(_e*(_e+2*D));const Ee=Math.acos(ue/(D+_e))-Math.acos(nr(C,we));ue*=Math.cos(Ee)}return 1.01*ue}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Sh(r.zoom);if(u>0){const d=Fk(r,k(1,r.center.lat)*r.worldSize),g=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return vr(a,d+g*(1-Math.cos(y)),Math.pow(u,10))}return a}upVector(r,a,u){return m_(a,u,r,1)}upVectorScale(r){return{metersToTile:tl(cb(Da(r)))}}}function Hk(l){const r=l.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(l.name){case"mercator":return new Vk(l);case"equirectangular":return new PZ(l);case"naturalEarth":return new IZ(l);case"equalEarth":return new AZ(l);case"winkelTripel":return new MZ(l);case"albers":return a?new Gk(l):new EZ(l);case"lambertConformalConic":return a?new Gk(l):new CZ(l);case"globe":return new OZ(l)}throw new Error(`Invalid projection name: ${l.name}`)}const RZ=ke.types,DZ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function H_(l,r,a,u,d,g,y,x,E,C,R,D,j){const V=x?Math.min(Eu,Math.round(x[0])):0,$=x?Math.min(Eu,Math.round(x[1])):0;l.emplaceBack(r,a,Math.round(32*u),Math.round(32*d),g,y,(V<<1)+(E?1:0),0+($<<1),16*C,16*R,256*D,256*j)}function W_(l,r,a){l.emplaceBack(r,a)}function q_(l,r,a,u,d,g,y){l.emplaceBack(r,a,u,d,g,y)}const Vb=(l,r,a,u)=>{for(let d=0;d<r;d++)l.emplaceBack(a[0],a[1],a[2],u[0],u[1],u[2])};function wm(l,r,a,u,d){l.emplaceBack(r,a,u,d),l.emplaceBack(r,a,u,d),l.emplaceBack(r,a,u,d),l.emplaceBack(r,a,u,d)}function kZ(l){for(const r of l.sections)if(u2(r.text))return!0;return!1}class wE{constructor(r){this.layoutVertexArray=new Jy,this.indexArray=new to,this.programConfigurations=r,this.segments=new gi,this.dynamicLayoutVertexArray=new Ic,this.opacityVertexArray=new Hp,this.placedSymbolArray=new rb,this.iconTransitioningVertexArray=new Xs,this.globeExtVertexArray=new Qy,this.zOffsetVertexArray=new Ol,this.orientationVertexArray=new r_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(r,a){const u=[],d=this.layoutVertexArray.uint16;for(let g=0;g<a;++g){const y=12*(r+g);u.push(...d.slice(y,y+12))}return u}updateIconVertexData(r,a,u,d,g,y,x,E,C,R,D,j,V){const $=this.layoutVertexArray.uint16,Z=12*r;$[Z]=a,$[Z+1]=u,$[Z+2]=d,$[Z+3]=g,$[Z+4]=y,$[Z+5]=x,$[Z+6]=E,$[Z+7]=C,$[Z+8]=R,$[Z+9]=D,$[Z+10]=j,$[Z+11]=V}upload(r,a,u,d,g,y){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,L7.members,!!y),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,z7.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,DZ,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,V7.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,N7.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,F7.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,B7.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Yt(wE,"SymbolBuffers");class TE{constructor(r,a,u){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new u,this.segments=new gi,this.collisionVertexArray=new e_,this.collisionVertexArrayExt=new Ic}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,$7.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,U7.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Yt(TE,"CollisionBuffers");class $b{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=U([]),this.placementViewportMatrix=U([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.localizable=r.localizable,this.textSizeData=ym(this.zoom,a["text-size"],this.worldview),this.iconSizeData=ym(this.zoom,a["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.lut=r.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>Js[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(r){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some(u=>u.getProperty(r)!=null)}createArrays(){this.text=new wE(new Oa(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new wE(new Oa(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new Qp,this.lineVertexArray=new ib,this.symbolInstances=new a_}calculateGlyphDependencies(r,a,u,d,g){for(const y of r){const x=y.codePointAt(0);if(x===void 0)break;if(a[x]=!0,d&&g&&x<=65535){const E=k_[y];E&&(a[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(r,a,u,d,g,y){let x=1;const E=r.getUnevaluatedProperties()._values["icon-size"],C=ym(this.zoom,E,this.worldview),R=_m(C,a);if(C.kind!=="constant"&&C.kind!=="camera"||(x=R.uSize),C.kind==="composite"){const{minZoom:D,maxZoom:j}=C,V=E.possiblyEvaluate(new ri(D,{worldview:this.worldview}),d),$=E.possiblyEvaluate(new ri(j,{worldview:this.worldview}),d),Z=V.evaluate(u,{},d,g);x=Z+($.evaluate(u,{},d,g)-Z)*R.uSizeT}return C.kind==="source"&&(x=E.possiblyEvaluate(new ri(this.zoom,{worldview:this.worldview}),d).evaluate(u,{},d,g)),x*y}updateFootprints(r,a){}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!gb(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(r){return typeof r=="string"?ps.build(r):r}populate(r,a,u,d){const g=this.layers[0],y=g.layout,x=this.projection.name==="globe",E=y.get("text-font"),C=y.get("text-field"),R=y.get("icon-image"),[D,j]=y.get("icon-size-scale-range"),V=ne(a.scaleFactor||1,D,j),$=(C.value.kind!=="constant"||C.value.value instanceof fs&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),Z=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,re=this.hasAnyAppearanceProperty("icon-image"),te=y.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!$&&!Z&&!re)return;const le=a.iconDependencies,ue=a.glyphDependencies,fe=a.availableImages,we=new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),_e=Ee=>{const Me=Ee.id.toString();le.has(Me)?le.get(Me).push(Ee):le.set(Me,[Ee])};for(const Ee of r){const{feature:Me,id:De,index:rt,sourceLayerIndex:Ne}=Ee,at=g._featureFilter.needGeometry,ft=Le(Me,at);if(!g._featureFilter.filter(we,ft,u))continue;if(at||(ft.geometry=Ce(Me,u,d)),x&&Me.type!==1&&u.z<=5){const vt=ft.geometry,Ot=.98078528056,At=(or,Ft)=>nr(m_(or.x,or.y,u,1),m_(Ft.x,Ft.y,u,1))<Ot;for(let or=0;or<vt.length;or++)vt[or]=be(vt[or],At)}let pt,xt;if($){const vt=g.getValueAndResolveTokens("text-field",ft,u,fe),Ot=fs.factory(vt);kZ(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||jd()==="unavailable"||this.hasRTLText&&Ml.isParsed())&&(pt=H7(Ot,g,ft))}if(Z){const vt=g.getValueAndResolveTokens("icon-image",ft,u,fe);xt=this.getResolvedImageFromTokens(vt)}const wt=this.layers[0];let yt=!1;if(!xt&&re){const vt=wt.getAppearances();for(const Ot of vt)if(Ot.getProperty("icon-image")){const At=wt.getAppearanceValueAndResolveTokens(Ot,"icon-image",ft,u,fe);if(At){xt=this.getResolvedImageFromTokens(At),yt=!0;break}}}if(!pt&&!xt)continue;const _t=this.sortFeaturesByKey?te.evaluate(ft,{},u):void 0,st={id:De,text:pt,icon:xt,index:rt,sourceLayerIndex:Ne,geometry:ft.geometry,properties:Me.properties,type:RZ[Me.type],sortKey:_t};if(this.features.push(st),this.featureToAppearanceIndex[rt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:De,properties:Me.properties,usesAppearanceIconAsPlaceholder:yt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),xt){const vt=wt._unevaluatedLayout._values,{iconPrimary:Ot,iconSecondary:At}=z_(xt,this.iconSizeData,vt["icon-size"],u,this.zoom,st,this.pixelRatio,V,this.worldview);_e(Ot),At&&(this.hasAnySecondaryIcon=!0,_e(At))}const it=wt.getAppearances();if(it.length!==0&&it.forEach(vt=>{if(!vt.getProperty("icon-image"))return;const Ot=this.getCombinedIconPrimary(vt,wt,ft,u,fe,st,V);Ot&&_e(Ot)}),pt){const vt=E.evaluate(ft,{},u).join(","),Ot=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Js.vertical)>=0;for(const At of pt.sections)if(At.image){const or=At.image.getPrimary().scaleSelf(this.pixelRatio),Ft=or.id.toString(),Ht=le.get(Ft)||[];Ht.push(or),le.set(Ft,Ht)}else{const or=Dd(pt.toString()),Ft=At.fontStack||vt,Ht=ue[Ft]=ue[Ft]||{};this.calculateGlyphDependencies(At.text,Ht,Ot,this.allowVerticalPlacement,or)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(Ee){const Me={},De={},rt=[];let Ne=0;function at(wt){rt.push(Ee[wt]),Ne++}function ft(wt,yt,_t){const st=De[wt];return delete De[wt],De[yt]=st,rt[st].geometry[0].pop(),rt[st].geometry[0]=rt[st].geometry[0].concat(_t[0]),st}function pt(wt,yt,_t){const st=Me[yt];return delete Me[yt],Me[wt]=st,rt[st].geometry[0].shift(),rt[st].geometry[0]=_t[0].concat(rt[st].geometry[0]),st}function xt(wt,yt,_t){const st=_t?yt[0][yt[0].length-1]:yt[0][0];return`${wt}:${st.x}:${st.y}`}for(let wt=0;wt<Ee.length;wt++){const yt=Ee[wt],_t=yt.geometry,st=yt.text?yt.text.toString():null;if(!st){at(wt);continue}const it=xt(st,_t),vt=xt(st,_t,!0);if(it in De&&vt in Me&&De[it]!==Me[vt]){const Ot=pt(it,vt,_t),At=ft(it,vt,rt[Ot].geometry);delete Me[it],delete De[vt],De[xt(st,rt[At].geometry,!0)]=At,rt[Ot].geometry=null}else it in De?ft(it,vt,_t):vt in Me?pt(it,vt,_t):(at(wt),Me[it]=Ne-1,De[vt]=Ne-1)}return rt.filter(wt=>wt.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Me)=>Ee.sortKey-Me.sortKey)}getCombinedIconPrimary(r,a,u,d,g,y,x){let E,C;const R=r.getUnevaluatedProperties();if(R._values["icon-image"].value!==void 0){const D=a.getAppearanceValueAndResolveTokens(r,"icon-image",u,d,g);E=this.getResolvedImageFromTokens(D)}else{const D=a.getValueAndResolveTokens("icon-image",u,d,g);E=this.getResolvedImageFromTokens(D)}if(E){const D=R._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];C=z_(E,ym(this.zoom,D,this.worldview),D,d,this.zoom,y,this.pixelRatio,x,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(r,a,u,d){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let y=!1,x=0;const E=g.layout,[C,R]=E.get("icon-size-scale-range"),D=ne(1,C,R);for(let j=0;j<this.symbolInstances.length;j++){const V=this.symbolInstances.get(j),$=this.featureToAppearanceIndex[V.featureIndex],Z=$!==void 0?this.appearanceFeatureData[$]:void 0;if(Z&&V.placedIconSymbolIndex>=0){const re=Z.id,te=a&&re!==void 0?a[String(re)]:void 0,le={type:"Point",id:Z.id,properties:Z.properties,geometry:[]},ue=this.layers[0].appearances&&this.layers[0].appearances.find(fe=>fe.isActive({globals:d,feature:le,canonical:r,featureState:te}));if(Z.activeAppearance===ue){x+=V.numIconVertices;continue}if(ue){Z.activeAppearance=ue;const fe=this.getCombinedIconPrimary(ue,g,le,r,u,{sortKey:void 0,text:void 0,icon:null,index:V.featureIndex,sourceLayerIndex:V.featureIndex,geometry:[],properties:Z.properties,type:"Point",id:Z.id},D);if(!fe)continue;const we=fe.toString(),_e=this.iconAtlasPositions&&this.iconAtlasPositions.get(we);if(_e){const Ee=g.getAppearanceValueAndResolveTokens(ue,"icon-offset",le,r,u),Me=Ee&&Array.isArray(Ee)?Ee:[0,0];let De=Rb(_e,void 0,Me,g.layout.get("icon-anchor").evaluate(le,{},r));const rt=g.getAppearanceValueAndResolveTokens(ue,"icon-rotate",le,r,u),Ne=typeof rt=="number"?rt:0,at=_e.sdf,ft=g.layout.get("icon-text-fit").constantOr("none");ft!=="none"&&Z.textShaping&&Z.iconTextFitPadding&&Z.fontScale&&(De=pE(De,Z.textShaping,ft,Z.iconTextFitPadding,Me,Z.fontScale));const pt=this.calculateEffectiveAppearanceIconSize(ue,d.zoom,le,r,u,D),xt=0,wt=1+(Math.min(Eu,Math.round(pt*Bl))<<1),yt=_E(De,Ne,at,ft!=="none",D);Z.isUsingAppearanceVertexData||(Z.isUsingAppearanceVertexData=!0,Z.layoutBasedVertexData=this.icon.getIconVertexData(x,V.numIconVertices));for(let st=0;st<yt.length;++st){const it=yt[st],vt=Z.layoutBasedVertexData[0]||V.tileAnchorX,Ot=Z.layoutBasedVertexData[1]||V.tileAnchorY,At=16*it.pixelOffsetTL.x,or=16*it.pixelOffsetTL.y,Ft=16*it.pixelOffsetBR.x,Ht=16*it.pixelOffsetBR.y,Qt=16*it.minFontScaleX,Gr=16*it.minFontScaleY;this.icon.updateIconVertexData(x,vt,Ot,Math.round(32*it.tl.x),Math.round(32*it.tl.y),it.texPrimary.x,it.texPrimary.y,xt,wt,At,or,Qt,Gr),this.icon.updateIconVertexData(x+1,vt,Ot,Math.round(32*it.tr.x),Math.round(32*it.tr.y),it.texPrimary.x+it.texPrimary.w,it.texPrimary.y,xt,wt,Ft,or,Qt,Gr),this.icon.updateIconVertexData(x+2,vt,Ot,Math.round(32*it.bl.x),Math.round(32*it.bl.y),it.texPrimary.x,it.texPrimary.y+it.texPrimary.h,xt,wt,At,Ht,Qt,Gr),this.icon.updateIconVertexData(x+3,vt,Ot,Math.round(32*it.br.x),Math.round(32*it.br.y),it.texPrimary.x+it.texPrimary.w,it.texPrimary.y+it.texPrimary.h,xt,wt,Ft,Ht,Qt,Gr),x+=4}const _t=V.numIconVertices-4*yt.length;for(let st=0;st<_t;++st)this.icon.updateIconVertexData(x+st,0,0,0,0,0,0,0,0,0,0,0,0);y=!0}else x+=V.numIconVertices}else if(Z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),y=!0),x+=V.numIconVertices,Z.activeAppearance=null;else if(Z.isUsingAppearanceVertexData){const we=Z.layoutBasedVertexData.length/12;for(let _e=0;_e<we;++_e){const Ee=_e*12;this.icon.updateIconVertexData(x+_e,Z.layoutBasedVertexData[Ee+0],Z.layoutBasedVertexData[Ee+1],Z.layoutBasedVertexData[Ee+2],Z.layoutBasedVertexData[Ee+3],Z.layoutBasedVertexData[Ee+4],Z.layoutBasedVertexData[Ee+5],Z.layoutBasedVertexData[Ee+6],Z.layoutBasedVertexData[Ee+7],Z.layoutBasedVertexData[Ee+8],Z.layoutBasedVertexData[Ee+9],Z.layoutBasedVertexData[Ee+10],Z.layoutBasedVertexData[Ee+11])}x+=we,Z.isUsingAppearanceVertexData=!1,Z.activeAppearance=null,y=!0}else x+=V.numIconVertices,Z.activeAppearance=null}}return y}update(r,a,u,d,g,y,x){this.text.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,a,g,u,d,y,x,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const u=oe(r),d=1/u;let g=!1,y=!1;for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x),C=He(1,0,0),R=He(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:j,numIconVertices:V,numVerticalIconVertices:$}=E,Z=D>0||j>0,re=V>0,te=this.elevationFeatures[E.elevationFeatureIndex];if(te){const le=new mt(E.tileAnchorX,E.tileAnchorY),ue=.075+te.pointElevation(le);E.zOffset!==ue&&(a=!0,E.zOffset=ue),ue!==0&&(this.hasAnyZOffset=!0);const fe=te.computeSlopeNormal(le,d),we=qt(Yo(),He(0,0,1),fe);ci(C,C,we),ci(R,R,we),C[2]*=u,R[2]*=u,C[0]===1&&C[1]===0&&C[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(g=g||Z,y=y||re)}if(Z&&(Vb(this.text.orientationVertexArray,D,C,R),Vb(this.text.orientationVertexArray,j,C,R)),re){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:ue}=E;le>=0&&Vb(this.icon.orientationVertexArray,V,C,R),ue>=0&&Vb(this.icon.orientationVertexArray,$,C,R)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(g,y,x)=>{u+=y,u>g.length&&g.resize(u);for(let E=-y;E<0;E++)g.emplace(E+u,x)},a=(g,y,x)=>{d+=y,d>g.length&&g.resize(d);for(let E=-y;E<0;E++)g.emplace(E+d,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:E,numIconVertices:C}=y,R=y.zOffset,D=C>0;if((x>0||E>0)&&(r(this.text.zOffsetVertexArray,x,R),r(this.text.zOffsetVertexArray,E,R)),D){const{placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:V}=y;j>=0&&a(this.icon.zOffsetVertexArray,C,R),V>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r,a,u,d,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(y=>y.appearances&&y.appearances.length>0)),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(r,a,u,d){return!!(r&&a&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(r,a,u,d)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Hk(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:d,y:g}of a)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z,re,te,le){const ue=r.indexArray,fe=r.layoutVertexArray,we=r.globeExtVertexArray,_e=r.segments.prepareSegment(4*le,fe,ue,this.canOverlap?y.sortKey:void 0),Ee=this.glyphOffsetArray.length,Me=_e.vertexLength,De=this.allowVerticalPlacement&&x===Js.vertical?Math.PI/2:0,rt=y.text&&y.text.sections;for(let ft=0;ft<a.length;ft++){const{tl:pt,tr:xt,bl:wt,br:yt,texPrimary:_t,texSecondary:st,pixelOffsetTL:it,pixelOffsetBR:vt,minFontScaleX:Ot,minFontScaleY:At,glyphOffset:or,isSDF:Ft,sectionIndex:Ht}=a[ft],Qt=_e.vertexLength,Gr=or[1];if(H_(fe,C.x,C.y,pt.x,Gr+pt.y,_t.x,_t.y,u,Ft,it.x,it.y,Ot,At),H_(fe,C.x,C.y,xt.x,Gr+xt.y,_t.x+_t.w,_t.y,u,Ft,vt.x,it.y,Ot,At),H_(fe,C.x,C.y,wt.x,Gr+wt.y,_t.x,_t.y+_t.h,u,Ft,it.x,vt.y,Ot,At),H_(fe,C.x,C.y,yt.x,Gr+yt.y,_t.x+_t.w,_t.y+_t.h,u,Ft,vt.x,vt.y,Ot,At),E){const{x:Pt,y:er,z:Pr}=E.anchor,[en,sn,kr]=E.up;q_(we,Pt,er,Pr,en,sn,kr),q_(we,Pt,er,Pr,en,sn,kr),q_(we,Pt,er,Pr,en,sn,kr),q_(we,Pt,er,Pr,en,sn,kr),wm(r.dynamicLayoutVertexArray,Pt,er,Pr,De)}else wm(r.dynamicLayoutVertexArray,C.x,C.y,C.z,De);if(re){const Pt=st||_t;W_(r.iconTransitioningVertexArray,Pt.x,Pt.y),W_(r.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y),W_(r.iconTransitioningVertexArray,Pt.x,Pt.y+Pt.h),W_(r.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y+Pt.h)}ue.emplaceBack(Qt,Qt+1,Qt+2),ue.emplaceBack(Qt+1,Qt+2,Qt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(or[0]),ft!==a.length-1&&Ht===a[ft+1].sectionIndex||r.programConfigurations.populatePaintArrays(fe.length,y,y.index,{},V,$,Z,rt&&rt[Ht],this.worldview)}const Ne=le-a.length;Ne!==0&&this._addNullVertices(Ne,fe,u,E,we,r,re,_e,ue);const at=E?E.anchor:C;r.placedSymbolArray.emplaceBack(at.x,at.y,at.z,C.x,C.y,Ee,this.glyphOffsetArray.length-Ee,Me,R,D,C.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],x,0,0,0,j,0),r.symbolInstanceIndices.push(te)}_addNullVertices(r,a,u,d,g,y,x,E,C){for(let R=0;R<r;R++){for(let j=0;j<4;j++)H_(a,0,0,0,0,0,0,u,!1,0,0,0,0),d&&q_(g,0,0,0,0,0,0),wm(y.dynamicLayoutVertexArray,0,0,0,0),x&&W_(y.iconTransitioningVertexArray,0,0);const D=E.vertexLength;C.emplaceBack(D,D+1,D+2),C.emplaceBack(D+1,D+2,D+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(r,a,u,d,g,y,x){r.emplaceBack(a,u,d,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,u,d,g,y,x){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=E.vertexLength,R=x.tileAnchorX,D=x.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,r.padding,x.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,R,D,new mt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,R,D,new mt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,R,D,new mt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,R,D,new mt(r.x1,r.y2)),E.vertexLength+=4;const j=u.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,u,d,g,y){for(let x=d;x<g;x++){const E=u.get(x),C=this.getSymbolInstanceTextSize(r,y,a,x);this._addCollisionDebugVertices(E,C,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,a,u,d,g,y){for(let x=d;x<g;x++){const E=u.get(x),C=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,C,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new TE(qp,ck.members,Xs),this.iconCollisionBox=new TE(qp,ck.members,Xs);const d=_m(this.iconSizeData,r),g=_m(this.textSizeData,r,u);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,r,a,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(g,r,a,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(d,r,a,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(d,r,a,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(r,a,u,d){const g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),y=mE(this.textSizeData,r,g)/_o;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,a,u){const d=this.icon.placedSymbolArray.get(u),g=mE(this.iconSizeData,r,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,a,u,d){r.emplaceBack(a,-u,-u,d),r.emplaceBack(a,u,-u,d),r.emplaceBack(a,u,u,d),r.emplaceBack(a,-u,u,d)}_updateTextDebugCollisionBoxes(r,a,u,d,g,y,x){for(let E=d;E<g;E++){const C=u.get(E),R=this.getSymbolInstanceTextSize(r,y,a,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,C.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(r,a,u,d,g,y,x){for(let E=d;E<g;E++){const C=u.get(E),R=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,C.padding,y.zOffset)}}updateCollisionDebugBuffers(r,a,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=_m(this.iconSizeData,r,d),y=_m(this.textSizeData,r,u);for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(y,r,a,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(y,r,a,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(g,r,a,E.iconBoxStartIndex,E.iconBoxEndIndex,E,d),this._updateIconDebugCollisionBoxes(g,r,a,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,u,d,g,y,x,E,C){const R={};if(a<u){const{x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe,featureIndex:we}=r.get(a);R.textBox={x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe},R.textFeatureIndex=we}if(d<g){const{x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe,featureIndex:we}=r.get(d);R.verticalTextBox={x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe},R.verticalTextFeatureIndex=we}if(y<x){const{x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe,featureIndex:we}=r.get(y);R.iconBox={x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe},R.iconFeatureIndex=we}if(E<C){const{x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe,featureIndex:we}=r.get(E);R.verticalIconBox={x1:D,y1:j,x2:V,y2:$,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:fe},R.verticalIconFeatureIndex=we}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,a){const u=r.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),u=Math.cos(r),d=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);d.push(0|Math.round(a*E.tileAnchorX+u*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>d[x]-d[E]||g[E]-g[x]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:C}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(r){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[r]).elevationFeatureIndex;let u;return this.elevationFeatures&&a<this.elevationFeatures.length&&(u=this.elevationFeatures[a]),u}}function Wk(l,r){return r.replace(/{([^{}]+)}/g,(a,u)=>u in l?String(l[u]):"")}let qk,Zk,SE;Yt($b,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),$b.addDynamicAttributes=wm;class Xk{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Aa,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt(Xk,"FormatSectionOverride",{omit:["defaultValue"]});const EE=()=>SE||(SE={layout:qk||(qk=new Pi({"symbol-placement":new Ct(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ct(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ct(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ct(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new Ct(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Dt(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(Ve.layout_symbol["icon-image"]),"icon-image-use-theme":new Ct({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Dt(Ve.layout_symbol["icon-rotate"]),"icon-padding":new Ct(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Dt(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(Ve.layout_symbol["text-field"]),"text-font":new Dt(Ve.layout_symbol["text-font"]),"text-size":new Dt(Ve.layout_symbol["text-size"]),"text-size-scale-range":new Ct(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new Dt(Ve.layout_symbol["text-max-width"]),"text-line-height":new Dt(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Dt(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Dt(Ve.layout_symbol["text-anchor"]),"text-max-angle":new Ct(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(Ve.layout_symbol["text-rotate"]),"text-padding":new Ct(Ve.layout_symbol["text-padding"]),"text-keep-upright":new Ct(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Dt(Ve.layout_symbol["text-transform"]),"text-offset":new Dt(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(Ve.layout_symbol["text-optional"]),visibility:new Ct(Ve.layout_symbol.visibility)})),paint:Zk||(Zk=new Pi({"icon-opacity":new Dt(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Dt(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Dt(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Dt(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new Dt(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Dt(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ct(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Dt(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Dt(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new Dt(Ve.paint_symbol["text-color"],{runtimeType:Es,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Dt(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(Ve.paint_symbol["text-halo-blur"]),"text-translate":new Ct(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ct(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ct(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ct(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ct(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Dt(Ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},SE);class Ub extends ys{constructor(r,a,u,d){super(r,EE(),a,u,d,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=U([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,a){super.recalculate(r,a),this.appearances&&this.appearances.forEach(d=>{d.recalculate(r,a,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,a,u,d){return this._saturation===r&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(g,y,x,E){g=bi(g),y=mn(y);const C=G(),R=g/3,D=1-2*R,j=[D,R,R,0,R,D,R,0,R,R,D,0,0,0,0,1],V=.5-.5*y,$=E-x;return J(C,[$,0,0,0,0,$,0,0,0,0,$,0,x,x,x,1],[y,0,0,0,0,y,0,0,0,0,y,0,V,V,V,1]),J(C,C,j),C}(r,a,u,d),this._saturation=r,this._contrast=a,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,a,u,d){const g=this.layout.get(r).evaluate(a,{},u,d),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Od(y.value)||!g?g:Wk(a.properties,g)}getAppearanceValueAndResolveTokens(r,a,u,d,g){const y=r.getProperty(a);if(!y)return;const x=y.evaluate(u,{},d,g),E=r.getUnevaluatedProperties()._values[a];return E.isDataDriven()||Od(E.value)||!x||typeof x!="string"?x:Wk(u.properties,x)}createBucket(r){return new $b(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of EE().paint.overridableProperties){if(!Ub.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),u=new Xk(a),d=new Ip(u,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new dh("source",d):new du("composite",d,a.value.zoomStops,a.value.interpolationType),this.paint._values[r]=new pu(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Ub.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const u=r.get("text-field"),d=EE().paint.properties[a];let g=!1;const y=x=>{for(const E of x)if(d.overrides&&d.overrides.hasOverride(E))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof fs)y(u.value.value.sections);else if(u.value.kind==="source"){const x=C=>{g||(C instanceof Sl&&yo(C.value)===gd?y(C.value.sections):C instanceof qa?y(C.sections):C.eachChild(x))},E=u.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,a,u){return{config:new Oc(this,{zoom:a,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Kk,Yk,Jk,Qk;var AE=Xr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Gb(l,r,a,u,d,g,y,x){const E=[l,r,1,a,u,1,d,g,1],C=[y,x,1],R=L([],E),[D,j,V]=un(C,C,R);return z(E,E,[D,0,0,0,j,0,0,0,V])}function ej(l,r,a,u,d,g,y,x){const E=function(C,R,D,j,V,$,Z,re){const te=Gb(0,0,1,0,1,1,0,1),le=Gb(C,R,D,j,V,$,Z,re);return z(le,le,L([],te))}(l,r,a,u,d,g,y,x);return[E[2]/E[8]/Mt,E[5]/E[8]/Mt]}function Hb(l){return[l[0],Math.min(Math.max(l[1],-q),q)]}class tj extends su{constructor(r,a,u,d){super(),this.id=r,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(r,a){if(this._loaded=a||!1,this.fire(new Ha("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=Kf(this.map._requestManager.transformRequest(this.url,cd.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new fd(u)):d&&(this.image=d instanceof HTMLImageElement?go.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new O_(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ha("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof O_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=r[0][1],u=r[0][1];for(const g of r)g[1]>u&&(u=g[1]),g[1]<a&&(a=g[1]);const d=(u+a)/2;if(d>q?this.onNorthPole=!0:d<-q&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=r.map(he.fromLngLat);this.tileID=function(y){let x=1/0,E=1/0,C=-1/0,R=-1/0;for(const Z of y)x=Math.min(x,Z.x),E=Math.min(E,Z.y),C=Math.max(C,Z.x),R=Math.max(R,Z.y);const D=Math.max(C-x,R-E),j=Math.max(0,Math.floor(-Math.log2(D))),V=Math.pow(2,j);let $=Math.floor((x+C)/2*V);return $>1&&($-=1),new Zn(j,$,Math.floor((E+R)/2*V))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ha("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof O_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const te in this.tiles){const le=this.tiles[te];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=B_(new Zn(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const le=te[1].x-te[0].x,ue=te[1].y-te[0].y,fe=te[2].x-te[1].x,we=te[2].y-te[1].y,_e=te[3].x-te[2].x,Ee=te[3].y-te[2].y,Me=te[0].x-te[3].x,De=te[0].y-te[3].y,rt=le*we-fe*ue,Ne=fe*Ee-_e*we,at=_e*De-Me*Ee,ft=Me*ue-le*De;return rt>0&&Ne>0&&at>0&&ft>0||rt<0&&Ne<0&&at<0&&ft<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=B_(this.tileID,this.map.transform.projection),[g,y,x,E]=this.coordinates.map(te=>{const le=d.projection.project(te[0],te[1]);return Bk(d,le)._round()});this.perspectiveTransform=ej(g.x,g.y,y.x,y.y,x.x,x.y,E.x,E.y);const C=this._boundsArray=new gh;C.emplaceBack(g.x,g.y,0,0),C.emplaceBack(y.x,y.y,Mt,0),C.emplaceBack(E.x,E.y,0,Mt),C.emplaceBack(x.x,x.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(C,AE.members),this.boundsSegments=gi.simpleSegment(0,0,4,2);const R=[],D=[Hb((j=this.coordinates)[0]),Hb(j[1]),Hb(j[2]),Hb(j[3])];var j;const[V,$,Z,re]=function(te){let le=te[0][0],ue=le,fe=te[0][1],we=fe;for(let _e=1;_e<te.length;_e++)te[_e][0]<le?le=te[_e][0]:te[_e][0]>ue&&(ue=te[_e][0]),te[_e][1]<fe?fe=te[_e][1]:te[_e][1]>we&&(we=te[_e][1]);return[le,fe,ue-le,we-fe]}(D);{const te=new gh,[le,ue,fe,we]=function(yt){let _t=yt[0].x,st=_t,it=yt[0].y,vt=it;for(let Ot=1;Ot<yt.length;Ot++)yt[Ot].x<_t?_t=yt[Ot].x:yt[Ot].x>st&&(st=yt[Ot].x),yt[Ot].y<it?it=yt[Ot].y:yt[Ot].y>vt&&(vt=yt[Ot].y);return[_t,it,st-_t,vt-it]}(u),_e=yt=>[(yt.x-le)/fe,(yt.y-ue)/we],[Ee,Me,De,rt]=u.map(_e),Ne=function(yt,_t,st,it,vt,Ot,At,or){const Ft=Gb(0,0,1,0,1,1,0,1);return z(Ft,Ft,L([],Gb(yt,_t,st,it,vt,Ot,At,or)))}(Ee[0],Ee[1],Me[0],Me[1],De[0],De[1],rt[0],rt[1]);this.elevatedGlobePerspectiveTransform=ej(Ee[0],Ee[1],Me[0],Me[1],De[0],De[1],rt[0],rt[1]);const at=(yt,_t)=>{R.push(yt.lng);const st=Math.round((yt.lng-V)/Z*Mt),it=Math.round((yt.lat-$)/re*Mt),vt=_e(_t),Ot=un([],[vt[0],vt[1],1],Ne),At=Math.round(Ot[0]/Ot[2]*Mt),or=Math.round(Ot[1]/Ot[2]*Mt);te.emplaceBack(st,it,At,or)},ft=u[3].x-u[0].x,pt=u[3].y-u[0].y,xt=u[2].x-u[1].x,wt=u[2].y-u[1].y;for(let yt=0;yt<65;yt++){const _t=yt/64,st=[u[0].x+_t*ft,u[0].y+_t*pt],it=[u[1].x+_t*xt,u[1].y+_t*wt],vt=it[0]-st[0],Ot=it[1]-st[1];for(let At=0;At<65;At++){const or=At/64,Ft={x:st[0]+vt*or,y:st[1]+Ot*or};at(a.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(te,AE.members)}{this.maxLongitudeTriangleSize=0;let te=[],le=new to;const ue=(fe,we,_e)=>{le.emplaceBack(fe,we,_e);const Ee=R[fe],Me=R[we],De=R[_e],rt=Math.min(Math.min(Ee,Me),De),Ne=Math.max(Math.max(Ee,Me),De)-rt;Ne>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ne),te.push(rt+Ne/2)};for(let fe=0;fe<64;fe++)for(let we=0;we<64;we++){const _e=65*fe+we,Ee=_e+1,Me=_e+65,De=Me+1;ue(_e,Me,Ee),ue(Ee,Me,De)}[te,le]=function(fe,we){const _e=Array.from({length:fe.length},(De,rt)=>rt);_e.sort((De,rt)=>fe[De]-fe[rt]);const Ee=[],Me=new to;for(let De=0;De<_e.length;De++){const rt=_e[De];Ee.push(fe[rt]);const Ne=3*rt,at=Ne+1;Me.emplaceBack(we.uint16[Ne],we.uint16[at],we.uint16[at+1])}return[Ee,Me]}(te,le),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(le)}this.elevatedGlobeSegments=gi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/Mt,0,re/Mt,0,0,$,V,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof O_||(this.texture?this.texture.update(this.image):(this.texture=new Y2(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(a)}loadTile(r,a){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},a(null)):(r.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=r+180)+360*Math.round((u[0]-g)/360);var g;const y=new gi,x=(D,j)=>{y.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:a.segments[0].vertexLength,primitiveLength:j,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=E){const D=xi(u,0,u.length,d+E);return D===u.length||x(D,Ji(u,D+1,u.length,d+360-E)-D),y}d<u[0]&&(d+=360);const C=Ji(u,0,u.length,d-E);if(C===u.length)return x(0,u.length),y;x(0,C-0);const R=xi(u,C+1,u.length,d+E);return R!==u.length&&x(R,u.length-R),y}}const jZ=(Math.pow(256,2)-1)/16907520;class rj extends ys{constructor(r,a,u,d){super(r,{layout:Jk||(Jk=new Pi({visibility:new Ct(Ve.layout_raster.visibility)})),paint:Qk||(Qk=new Pi({"raster-opacity":new Ct(Ve.paint_raster["raster-opacity"]),"raster-color":new gu(Ve.paint_raster["raster-color"]),"raster-color-mix":new Ct(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new Ct(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ct(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(Ve.paint_raster["raster-saturation"]),"raster-contrast":new Ct(Ve.paint_raster["raster-contrast"]),"raster-resampling":new Ct(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ct(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ct(Ve.paint_raster["raster-array-band"]),"raster-elevation":new Ct(Ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof tj&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=g_({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let nj,ij,oj,sj,aj;class lj extends ys{constructor(r,a,u,d){super(r,{layout:nj||(nj=new Pi({visibility:new Ct(Ve["layout_raster-particle"].visibility)})),paint:ij||(ij=new Pi({"raster-particle-array-band":new Ct(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ct(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new gu(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ct(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ct(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ct(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ct(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ct(Ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this._updateColorRamp(),this.lastInvalidatedAt=go.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=g_({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=go.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class LZ extends ys{constructor(r,a){super(r,{},a,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function PE(l,r,a){const u=[0,0,1],d=wo([]);return Gs(d,d,a?-qr(l)+Math.PI:qr(l)),Po(d,d,-qr(r)),ci(u,u,d),Lt(u,u)}const cj={None:0,Model:1,Symbol:2,FillExtrusion:4};class Wb{constructor(r,a,u,d){this.message=(r?`${r}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function CE(l,r){const a=l.indexOf("://")===-1;try{return new URL(l,a&&r?"http://example.com":void 0),!0}catch{return!1}}class uj{constructor(r,a){this.feature=r,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class hj{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new o_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(r){const a=16*r,u=this.instancedDataArray.float32;let d=Math.floor(u[a+2]);const g=1.05*(u[a+2]-d);return d/=100,[u[a]%1*1.05,u[a+1]%1*1.05,g,d]}tileCoordinatesForInstance(r){const a=16*r,u=this.instancedDataArray.float32;let d=u[a+0];return d=d>Mt?d-Mt:d,new mt(Math.trunc(d),Math.trunc(u[a+1]))}translationForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+4],u[a+5],u[a+6]]}rotationScaleForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+10],u[a+11],u[a+12],u[a+13],u[a+14],u[a+15]]}transformForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+4],u[a+10],u[a+11],u[a+12],u[a+5],u[a+13],u[a+14],u[a+15],u[a+6],0,0,0,1]}}class IE{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaledZ=this.canonical.z+Math.log2(r.overscaling),this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,d){}populate(r,a,u,d){this.tileToMeter=oe(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:x,index:E,sourceLayerIndex:C}of r){const R=x??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),D=Le(y,g);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),D,u))continue;const j={id:R,sourceLayerIndex:C,index:E,geometry:g?D.geometry:Ce(y,u,d),properties:y.properties,type:y.type,patterns:{}},V=this.addFeature(j,j.geometry,D);V&&a.featureIndex.insert(y,j.geometry,E,C,this.index,this.instancesPerModel[V].instancedDataArray.length,Mt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const r=this.layers[0].modelManager,a=this.layers[0].scope;let u=0;for(const d of this.modelUris){const g=r.getModel(d,a);if(!g)continue;const y=this.instancesPerModel[d];if(y){const x=.5*nn(g.aabb.max,g.aabb.min)*y.maxScale+y.maxXYTranslationDistance,E=Math.min(Mt,Math.max(x/this.tileToMeter,Mt/32));u=Math.max(E,u)}}return u}update(r,a,u,d){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const x in r)y.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(y.features[y.idToFeaturesIndex[x]],r[x],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const d of u.features){const g=this.layers[0],y=d.feature,x=this.canonical,E=g.paint.get("model-rotation").evaluate(y,{},x),C=g.paint.get("model-scale").evaluate(y,{},x),R=g.paint.get("model-translation").evaluate(y,{},x);zn(d.rotation,E)&&zn(d.scale,C)&&zn(d.translation,R)||(this.evaluate(d,d.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,a,u,d){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const g=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(gb(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const x in this.instancesPerModel){const E=this.instancesPerModel[x],C=E.instancedDataArray;for(const R of E.features){const D=R.instancedDataOffset,j=R.instancedDataCount;for(let V=0;V<j;V++){const $=16*(V+D);let Z=C.float32[$+0];const re=Z>Mt;Z=re?Z-Mt:Z;const te=Math.floor(Z),le=Math.floor(C.float32[$+1]);let ue=!1;for(const fe of this.activeReplacements)if(!YR(fe,u,cj.Model,d)&&!(fe.min.x>te||te>fe.max.x||fe.min.y>le||le>fe.max.y)&&(ue=rD(tD(te,le,r.canonical,fe.footprintTileId.canonical),fe.footprint),ue))break;C.float32[$]=ue?Z+Mt:Z,y=y||ue!==re}}}return y}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,o7.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(r){for(const u in this.instancesPerModel){const d=this.instancesPerModel[u];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(r&&a&&this.modelUris&&this.modelsRequested)for(const u of this.modelUris)a.removeModel(u,"",!0)}addFeature(r,a,u){const d=this.layers[0],g=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Ut(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(CE(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new hj);const y=this.instancesPerModel[g],x=y.instancedDataArray,E=new uj(u,x.length);for(const C of a)for(const R of C){if(R.x<0||R.x>=Mt||R.y<0||R.y>=Mt)continue;if(this.lookupDim!==0){const j=(this.lookupDim-1)/Mt,V=this.lookupDim*(R.y*j|0)+R.x*j|0;if(this.lookup){if(this.lookup[V]!==0)continue;this.lookup[V]=1}}this.instanceCount++;const D=x.length;x.resize(D+1),y.instancesEvaluatedElevation.push(0),x.float32[16*D]=R.x,x.float32[16*D+1]=R.y}return E.instancedDataCount=y.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(r.id&&(y.idToFeaturesIndex[r.id]=y.features.length),y.features.push(E),this.evaluate(E,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(r,a,u,d){const g=this.layers[0],y=r.feature,x=this.canonical,E=r.rotation=g.paint.get("model-rotation").evaluate(y,a,x),C=r.scale=g.paint.get("model-scale").evaluate(y,a,x),R=r.translation=g.paint.get("model-translation").evaluate(y,a,x),D=Object.assign({},g.paint.get("model-color").evaluate(y,a,x));D.a=g.paint.get("model-color-mix-intensity").evaluate(y,a,x);const j=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]);const V=R[0]*R[0]+R[1]*R[1],$=V>0?Math.sqrt(V):0;u.maxScale=Math.max(Math.max(u.maxScale,C[0]),Math.max(C[1],C[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,$),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),$D(j,E,C);const Z=Math.round(100*D.a)+D.b/1.05;for(let re=0;re<r.instancedDataCount;++re){const te=r.instancedDataOffset+re,le=16*te,ue=u.instancedDataArray.float32;let fe=0;d&&(fe=ue[le+6]-u.instancesEvaluatedElevation[te]);const we=0|ue[le+1];ue[le]=(0|ue[le])+D.r/1.05,ue[le+1]=we+D.g/1.05,ue[le+2]=Z,ue[le+3]=1/(x.z>10?this.tileToMeter:oe(x,we)),ue[le+4]=R[0],ue[le+5]=R[1],ue[le+6]=R[2]+fe,ue[le+7]=j[0],ue[le+8]=j[1],ue[le+9]=j[2],ue[le+10]=j[4],ue[le+11]=j[5],ue[le+12]=j[6],ue[le+13]=j[8],ue[le+14]=j[9],ue[le+15]=j[10],u.instancesEvaluatedElevation[te]=R[2]}}}let dj,fj;Yt(IE,"ModelBucket",{omit:["layers"]}),Yt(hj,"PerModelAttributes"),Yt(uj,"ModelFeature");class Tm{constructor(r,a,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(r,a,u){const d=u||r.findDEMTileFor(a);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,x=1<<a.canonical.z-y.canonical.z;return new Tm(d,g.dim/Mt/x,[(a.canonical.x/x-y.canonical.x)*g.dim,(a.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,a){const u=a*this._scale+this._offset[1];return new mt(Math.floor(r*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(r,a,u,d){const g=r*this._scale+this._offset[0],y=a*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),C=this._dem;return d=!!d,u?vr(vr(C.get(x,E,d),C.get(x,E+1,d),y-E),vr(C.get(x+1,E,d),C.get(x+1,E+1,d),y-E),g-x):C.get(x,E,d)}getElevationAtPixel(r,a,u){return this._dem.get(r,a,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*k(1,r)*this._dem.stride}}const ME=new Float32Array(262144),Qd=new Uint8Array(262144);function pj(l){let r=0;if(l.meshes)for(const a of l.meshes)r=Math.max(r,a.aabb.max[2]);if(l.children)for(const a of l.children)r=Math.max(r,pj(a));return r}function mj(l,r,a){if(l.meshes)for(const u of l.meshes){if(u.aabb.min[0]===1/0)continue;const d=rr.applyTransform(u.aabb,l.globalMatrix);a.insert(r,d.min[0],d.min[1],d.max[0],d.max[1])}if(l.children)for(const u of l.children)mj(u,r,a)}const gj=["","wall","door","roof","window","lamp","logo"];class yj{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:pj(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const a=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=rr.applyTransformFast(u.aabb,this.node.globalMatrix),a.encapsulate(u.transformedAabb)),r++;this.aabb=a}return this.aabb}}class qb{constructor(r,a,u,d,g,y,x,E){this.id=u,this.layers=r,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=pm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=pm.HasMapboxMeshFeatures),g&&(this.modelTraits|=pm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of a)this.nodesInfo.push(new yj(C)),mj(C,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(r,a){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&a.push({footprint:d.footprint,id:r})}}updateAppearances(r,a,u,d){}update(r){const a=Object.keys(r).length!==0;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!Vo(r,this.states))for(const d of u)this.evaluate(d,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const d=u.node;this.uploaded?this.updatePbrBuffer(d):eE(d,r,!0)}for(const u of a)Cb(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let a=!1;if(!r.meshes)return a;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(r,a,u){const d=r.transform.projectionOptions,g=r.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Z_(u.paint.get("model-color").value,y)||Z_(u.paint.get("model-color-mix-intensity").value,y)||Z_(u.paint.get("model-roughness").value,y)||Z_(u.paint.get("model-emissive-strength").value,y)||Z_(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=d,this.brightness=g;const x=this.getNodesInfo();for(const E of x)E.state=null;return!0}return!1}evaluateTransform(r,a){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=a.paint.get("model-translation").evaluate(y,{},d),g.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},d)}}evaluate(r,a){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const g=d.feature,y=a&&a[g.id];if(Vo(y,d.state))continue;d.state=structuredClone(y);const x=d.node.meshes&&d.node.meshes[0].featureData,E=d.evaluatedColor[2],C=d.evaluatedRMEA[2],R=this.id.canonical;if(d.hasTranslucentParts=!1,x){for(let D=0;D<gj.length;D++){const j=gj[D];j.length&&(g.properties.part=j);const V=r.paint.get("model-color").evaluate(g,y,R).toPremultipliedRenderColor(null),$=r.paint.get("model-color-mix-intensity").evaluate(g,y,R);d.evaluatedColor[D]=[V.r,V.g,V.b,$],d.evaluatedRMEA[D][0]=r.paint.get("model-roughness").evaluate(g,y,R),d.evaluatedRMEA[D][2]=r.paint.get("model-emissive-strength").evaluate(g,y,R),d.evaluatedRMEA[D][3]=V.a,d.emissionHeightBasedParams[D]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,R),!d.hasTranslucentParts&&V.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,zZ(d,E!==d.evaluatedColor[2]||C!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(g,y,R);d.evaluatedTranslation=r.paint.get("model-translation").evaluate(g,y,R),d.evaluatedScale=r.paint.get("model-scale").evaluate(g,y,R),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,a,u,d){const g=r.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=Tm.create(r,u,g);if(!y)return;this.modelTraits&pm.HasMapboxMeshFeatures&&this.updateDEM(r,y,u,d);for(const x of this.getNodesInfo()){const E=x.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const C=E.footprint.vertices;let R=y.getElevationAt(C[0].x,C[0].y,!0,!0);for(let D=1;D<C.length;D++)R=Math.min(R,y.getElevationAt(C[D].x,C[D].y,!0,!0));E.elevation=R}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=a}}updateDEM(r,a,u,d){let g=a._dem._modifiedForSources[d];if(g===void 0&&(a._dem._modifiedForSources[d]=[],g=a._dem._modifiedForSources[d]),g.includes(u.canonical))return;const y=a._dem.dim;g.push(u.canonical);let x=!1;for(const E of this.getNodesInfo()){const C=E.node;if(!C.footprint||!C.footprint.grid)continue;const R=C.footprint.grid,D=a.tileCoordToPixel(R.min.x,R.min.y),j=a.tileCoordToPixel(R.max.x,R.max.y),V=Math.min(Math.min(y-j.y,D.x),Math.min(D.y,y-j.x));if(V<0)continue;const $=ne(V,2,5);let Z=Math.max(0,D.x-$),re=Math.max(0,D.y-$),te=Math.min(j.x+$,y-1),le=Math.min(j.y+$,y-1);for(let _e=re;_e<=le;++_e)for(let Ee=Z;Ee<=te;++Ee)Qd[_e*y+Ee]=255;let ue=0,fe=0;for(let _e=0;_e<R.cellsY;++_e)for(let Ee=0;Ee<R.cellsX;++Ee){if(!R.cells[_e*R.cellsX+Ee])continue;const Me=a.tileCoordToPixel(R.min.x+Ee/R.xScale,R.min.y+_e/R.yScale),De=a.tileCoordToPixel(R.min.x+(Ee+1)/R.xScale,R.min.y+(_e+1)/R.yScale);for(let rt=Me.y;rt<=Math.min(De.y+1,y-1);++rt)for(let Ne=Me.x;Ne<=Math.min(De.x+1,y-1);++Ne)Qd[rt*y+Ne]===255&&(Qd[rt*y+Ne]=0,ue+=a.getElevationAtPixel(Ne,rt),fe++)}const we=ue/fe;Z=Math.max(1,D.x-$),re=Math.max(1,D.y-$),te=Math.min(j.x+$,y-2),le=Math.min(j.y+$,y-2),x=!0;for(let _e=re;_e<=le;++_e)for(let Ee=Z;Ee<=te;++Ee)Qd[_e*y+Ee]===0&&(ME[_e*y+Ee]=a._dem.set(Ee,_e,we));for(let _e=1;_e<$;++_e){Z=Math.max(1,D.x-_e),re=Math.max(1,D.y-_e),te=Math.min(j.x+_e,y-2),le=Math.min(j.y+_e,y-2);for(let Ee=re;Ee<=le;++Ee)for(let Me=Z;Me<=te;++Me){const De=Ee*y+Me;if(Qd[De]===255){let rt=0,Ne=0,at=-1,ft=-1;for(let pt=-1;pt<=1;++pt)for(let xt=-1;xt<=1;++xt){const wt=(Ee+pt)*y+Me+xt;if(Qd[wt]>=_e)continue;const yt=ME[wt],_t=Math.abs(yt);_t>Ne&&(rt=yt,Ne=_t,at=xt,ft=pt)}if(Ne>.1){const pt=1-(_e+.5*Math.abs(at*ft))/$;let xt=a._dem.get(Me,Ee)+rt*pt;const wt=a._dem.get(Me+at,Ee+ft),yt=a._dem.get(Me-at,Ee-ft,!0);(xt-wt)*(xt-yt)>0&&(xt=(wt+yt)/2),ME[De]=a._dem.set(Me,Ee,xt),Qd[De]=_e}}}}}x&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=go.now())}setFilter(r){this.filter=r?zp(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new ri(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const a of r)Cb(a.node),tE(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(r.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(r,a){const u=[],d=[0,0,0],g=U([]);for(const y of this.getNodesInfo()){const x=y.node.meshes[0],E=x.transformedAabb;if(r<E.min[0]||a<E.min[1]||r>E.max[0]||a>E.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};K(g,y.node.globalMatrix),d[0]=r,d[1]=a,Nr(d,d,g);const C=(d[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Kd|0,R=Math.min(63,(d[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Kd|0)*Kd+Math.min(63,C),D=x.heightmap[R];if(!(D<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:D,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new mt(r,a),new mt(r,a),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function Z_(l,r){return l instanceof dh&&!l.isLightConstant&&r}function NZ(l,r,a,u,d,g,y,x){let E=(61440&r|(61440&r)>>4)>>8,C=(3840&r|(3840&r)>>4)>>4,R=240&r|(240&r)>>4;a[3]>0&&(E=vr(E,255*a[0],a[3]),C=vr(C,255*a[1],a[3]),R=vr(R,255*a[2],a[3]));const D=E<<8|C,j=R<<8|Math.floor(255*u[3]),V=function(_e){const Ee=ne(_e,0,2);return Math.min(Math.round(.5*Ee*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],$=ne(d[0],0,1),Z=ne(d[1],0,1),re=ne(d[2],0,1),te=ne(d[3],0,1);let le,ue,fe,we;if($!==Z&&y!==g&&Z!==$){const _e=y-g;ue=1/(_e*(Z-$)),fe=-(g+_e*$)/(_e*(Z-$));const Ee=ne(d[4],-1,1);we=Math.pow(10,Ee),le=255*re<<8|255*te}else le=65535,ue=0,fe=1,we=1;if(l.emplaceBack(D,j,V,le,ue,fe,we),x){const _e=x.length;x.clear();for(let Ee=0;Ee<_e;Ee++)x.emplaceBack(D,j,V,le,ue,fe,we)}}function zZ(l,r,a){const u=l.node;let d=0;const g=a&pm.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===d||!y.featureData)continue;y.featureArray=new Xp,y.featureArray.reserve(y.featureData.length);let x=r;for(const E of y.featureData){const C=g?65535&E:E>>16&65535,R=g?E>>16&65535:65535&E,D=(15&R)<8?15&R:0,j=l.evaluatedRMEA[D],V=l.evaluatedColor[D],$=l.emissionHeightBasedParams[D];let Z;if(x&&D===2&&u.lights&&(Z=new Xp,Z.resize(10*u.lights.length)),NZ(y.featureArray,C,V,j,$,y.aabb.min[2],y.aabb.max[2],Z),Z&&x){x=!1;const re=u.meshes[u.lightMeshIndex];re.featureArray=Z,re.featureArray._trim()}}y.featureArray._trim(),d++}}Yt(qb,"Tiled3dModelBucket",{omit:["layers"]}),Yt(yj,"Tiled3dModelFeature");const FZ=["id","tile","layer","source","sourceLayer","state"];class ef{constructor(r,a,u,d,g){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=u,this._y=d,this.properties=r?r.properties:{},this.id=g}clone(){const r=new ef(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of FZ)this[a]!==void 0&&(r[a]=this[a]);return r}}class tf extends su{constructor(r,a,u,d){super(),this.id=r,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const r=[];for(const a in this._options.models){const u=this._options.models[a],d=this._modelsInfo.get(a);if(d){const g=d.model;g.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),g.orientation=u.orientation!=null?u.orientation:[0,0,0],d.modelSpec=u,tf.applyModelSpecification(g,u),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=zD(this.map._requestManager.transformRequest(u.uri,cd.Model).url).then(y=>{if(!y)return;const x=nE(y),E=new UD(a,u.uri,u.position,u.orientation,x);tf.applyModelSpecification(E,u),E.computeBoundsAndApplyParent(),this.models.push(E),this._modelsInfo.set(a,{modelSpec:u,model:E})}).catch(y=>{this.fire(new fd(new Error(`Could not load model ${a} from ${u.uri}: ${y.message}`)))});r.push(g)}}Promise.allSettled(r).then(()=>{this._loaded=!0,this.fire(new Ha("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new fd(new Error(`Could not load models: ${a.message}`)))})}static applyModelSpecification(r,a){a.nodeOverrides&&tf.convertNodeOverrides(r,a.nodeOverrides),a.materialOverrides&&tf.convertMaterialOverrides(r,a.materialOverrides),a.nodeOverrideNames&&(r.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(r.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(r.featureProperties=a.featureProperties)}static convertNodeOverrides(r,a){if(Array.isArray(a)&&a.every(u=>typeof u=="string")){r.nodeOverrideNames=[];for(const u of a)r.nodeOverrideNames.push(u)}else Object.entries(a).forEach(([u,d])=>{const g={orientation:[0,0,0]};if(d.hasOwnProperty("orientation")){const y=d.orientation;y&&(g.orientation=y)}r.nodeOverrides.set(u,g)})}static convertMaterialOverrides(r,a){if(Array.isArray(a)&&a.every(u=>typeof u=="string")){r.materialOverrideNames=[];for(const u of a)r.materialOverrideNames.push(u)}else Object.entries(a).forEach(([u,d])=>{const g={color:new Dn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},y=d["model-color"];y!==void 0&&(g.color.r=y[0],g.color.g=y[1],g.color.b=y[2]);const x=d["model-color-mix-intensity"];x!==void 0&&(g.colorMix=x);const E=d["model-emissive-strength"];E!==void 0&&(g.emissionStrength=E);const C=d["model-opacity"];C!==void 0&&(g.opacity=C),r.materialOverrides.set(u,g)})}onAdd(r){this.map=r,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(r,a){}serialize(){return this._options}setProperty(r,a){return!1}reload(){const r=Ma(this.id,this.scope);this.map.style.clearSource(r),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(r){this.models=[];const a=new Map;for(const u in r){const d=r[u];if(this._modelsInfo.has(u)){const g=this._modelsInfo.get(u);g&&g.modelSpec.uri===d.uri&&a.set(u,g)}}this._modelsInfo=a,this._options.models=r,this._loaded=!1,this.load()}}function OE(l,r,a,u){const d=1<<l.z;r.lat=W((u/Mt+l.y)/d),r.lng=N((a/Mt+l.x)/d)}function BZ(l,r,a,u){const d=l.getNodesInfo()[r];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const y=d.node,x=a.tile,E=u.calculatePosMatrix(x.tileID.toUnwrapped(),u.worldSize),C=d.evaluatedScale;let R=0;u.elevation&&y.elevation&&(R=y.elevation*u.elevation.exaggeration()),X(E,E,[(y.anchor?y.anchor[0]:0)*(C[0]-1),(y.anchor?y.anchor[1]:0)*(C[1]-1),R]),ie(E,E,C);const D=a.queryGeometry,j=D.isPointQuery()?D.screenBounds:D.screenGeometry,V=function(Z){const re=J([],E,Z.globalMatrix);J(re,u.expandedFarZProjMatrix,re);for(let te=0;te<Z.meshes.length;++te){const le=Z.meshes[te];if(te===Z.lightMeshIndex)continue;const ue=Q2(j,u,re,le.aabb);ue!=null&&(g=Math.min(ue,g))}if(Z.children)for(const te of Z.children)V(te)};if(V(y),g===Number.MAX_VALUE)return;const $=new c(0,0);return OE(x.tileID.canonical,$,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:$,feature:d.feature}}const VZ={circle:class extends ys{constructor(l,r,a,u){super(l,{layout:Cs||(Cs=new Pi({"circle-sort-key":new Dt(Ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ct(Ve.layout_circle["circle-elevation-reference"]),visibility:new Ct(Ve.layout_circle.visibility)})),paint:Ci||(Ci=new Pi({"circle-radius":new Dt(Ve.paint_circle["circle-radius"]),"circle-color":new Dt(Ve.paint_circle["circle-color"]),"circle-blur":new Dt(Ve.paint_circle["circle-blur"]),"circle-opacity":new Dt(Ve.paint_circle["circle-opacity"]),"circle-translate":new Ct(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ct(Ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}createBucket(l){return new kn(l)}queryRadius(l){const r=l;return Wo("circle-radius",this,r)+Wo("circle-stroke-width",this,r)+Mo(this.paint.get("circle-translate"))}queryIntersectsFeature(l,r,a,u,d,g,y,x){const E=da(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return SR(l,u,g,y,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,r,a){const u=TR(this);return{config:new Oc(this,{zoom:r,lut:a}),defines:u,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ys{createBucket(l){return new AR(l)}constructor(l,r,a,u){super(l,{layout:PR||(PR=new Pi({visibility:new Ct(Ve.layout_heatmap.visibility)})),paint:CR||(CR=new Pi({"heatmap-radius":new Dt(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gu(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(Ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=g_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Wo("heatmap-radius",this,l)}queryIntersectsFeature(l,r,a,u,d,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,a);return SR(l,u,g,y,x,!0,!0,new mt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,r,a){return l==="heatmap"?{config:new Oc(this,{zoom:r,lut:a}),overrideFog:!1}:{}}},hillshade:class extends ys{constructor(l,r,a,u){super(l,{layout:IR||(IR=new Pi({visibility:new Ct(Ve.layout_hillshade.visibility)})),paint:MR||(MR=new Pi({"hillshade-illumination-direction":new Ct(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ct(Ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}},fill:class extends ys{constructor(l,r,a,u){super(l,{layout:HR||(HR=new Pi({"fill-sort-key":new Dt(Ve.layout_fill["fill-sort-key"]),visibility:new Ct(Ve.layout_fill.visibility),"fill-elevation-reference":new Ct(Ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Dt(Ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:WR||(WR=new Pi({"fill-antialias":new Ct(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Dt(Ve.paint_fill["fill-opacity"]),"fill-color":new Dt(Ve.paint_fill["fill-color"]),"fill-outline-color":new Dt(Ve.paint_fill["fill-outline-color"]),"fill-translate":new Ct(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Dt(Ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ct(Ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ct(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Dt(Ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Dt(Ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Dt(Ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}getProgramIds(){const l=this.paint.get("fill-pattern"),r=l&&l.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,r,a){return{config:new Oc(this,{zoom:r,lut:a}),overrideFog:!1}}recalculate(l,r){super.recalculate(l,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new L2(l)}queryRadius(){return Mo(this.paint.get("fill-translate"))}queryIntersectsFeature(l,r,a,u,d,g){return!l.queryGeometry.isAboveHorizon&&Sn(Ks(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?r&&!l:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ys{constructor(l,r,a,u){super(l,{layout:_D||(_D=new Pi({visibility:new Ct(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ct(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:vD||(vD=new Pi({"fill-extrusion-opacity":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Dt(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ct(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new _b(l)}queryRadius(){return Mo(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,r,a,u,d,g,y,x,E){const C=da(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(r,a),D=this.paint.get("fill-extrusion-base").evaluate(r,a),j=[0,0],V=x&&g.elevation,$=g.elevation?g.elevation.exaggeration():1,Z=l.tile.getBucket(this);if(V&&Z instanceof _b){const fe=Z.centroidVertexArray,we=E+1;we<fe.length&&(j[0]=fe.geta_centroid_pos0(we),j[1]=fe.geta_centroid_pos1(we))}if(j[0]===0&&j[1]===1)return!1;g.projection.name==="globe"&&(u=yD([u],[new mt(0,0),new mt(Mt,Mt)],l.tileID.canonical).map(fe=>fe.polygon).flat());const re=V?x:null,[te,le]=AD(g,u,D,R,C,y,re,j,$,g.center.lat,l.tileID.canonical),ue=l.queryGeometry;return ED(te,le,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},building:class extends ys{constructor(l,r,a,u){super(l,{layout:KD||(KD=new Pi({visibility:new Ct(Ve.layout_building.visibility),"building-facade":new Dt(Ve.layout_building["building-facade"]),"building-facade-floors":new Dt(Ve.layout_building["building-facade-floors"]),"building-facade-unit-width":new Dt(Ve.layout_building["building-facade-unit-width"]),"building-facade-window":new Dt(Ve.layout_building["building-facade-window"]),"building-roof-shape":new Dt(Ve.layout_building["building-roof-shape"]),"building-height":new Dt(Ve.layout_building["building-height"]),"building-base":new Dt(Ve.layout_building["building-base"]),"building-flood-light-wall-radius":new Dt(Ve.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Dt(Ve.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Dt(Ve.layout_building["building-flip-roof-orientation"])})),paint:YD||(YD=new Pi({"building-opacity":new Ct(Ve.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ct(Ve.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ct(Ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ct(Ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ct(Ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ct(Ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ct(Ve.paint_building["building-cast-shadows"]),"building-color":new Dt(Ve.paint_building["building-color"]),"building-emissive-strength":new Dt(Ve.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ct(Ve.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ct(Ve.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Ct(Ve.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Ct(Ve.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Ct(Ve.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new XD(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}queryRadius(l){return 0}queryIntersectsFeature(l,r,a,u,d,g,y,x,E){let C=this.layout.get("building-height").evaluate(r,a);const R=this.layout.get("building-base").evaluate(r,a),D=l.tile.getBucket(this).getFootprint(r);if(D){if(D.hiddenFlags!==0)return!1;C=D.height}const[j,V]=AD(g,u,R,C,new mt(0,0),y,null,[0,0],1,g.center.lat,l.tileID.canonical),$=l.queryGeometry;return ED(j,V,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends ys{constructor(l,r,a,u){const d=ak();super(l,d,r,a,u),d.layout&&(this.layout=new mu(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Ed,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(l,r){super.recalculate(l,r),this.paint._values["line-floorwidth"]=(()=>{if(D_)return D_;const a=ak();return D_=new j7(a.paint.properties["line-width"].specification),D_.useIntegerZoom=!0,D_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new sE(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,r,a){const u=ok(this);return{config:new Oc(this,{zoom:r,lut:a}),defines:u,overrideFog:!1}}queryRadius(l){const r=l,a=lk(Wo("line-width",this,r),Wo("line-gap-width",this,r)),u=Wo("line-offset",this,r);return a/2+Math.abs(u)+Mo(this.paint.get("line-translate"))}queryIntersectsFeature(l,r,a,u,d,g){if(l.queryGeometry.isAboveHorizon)return!1;const y=Ks(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*lk(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(u=function(C,R){const D=[],j=new mt(0,0);for(let V=0;V<C.length;V++){const $=C[V],Z=[];for(let re=0;re<$.length;re++){const te=$[re],le=$[re+1],ue=re===0?j:te.sub($[re-1])._unit()._perp(),fe=re===$.length-1?j:le.sub(te)._unit()._perp(),we=ue._add(fe)._unit();we._mult(1/(we.x*fe.x+we.y*fe.y)),Z.push(we._mult(R)._add(te))}D.push(Z)}return D}(u,E*l.pixelToTileUnitsFactor)),function(C,R,D){for(let j=0;j<R.length;j++){const V=R[j];if(C.length>=3){for(let $=0;$<V.length;$++)if(qn(C,V[$]))return!0}if(wi(C,V,D))return!0}return!1}(y,u,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Ub,background:class extends ys{constructor(l,r,a,u){super(l,{layout:Kk||(Kk=new Pi({visibility:new Ct(Ve.layout_background.visibility)})),paint:Yk||(Yk=new Pi({"background-pitch-alignment":new Ct(Ve.paint_background["background-pitch-alignment"]),"background-color":new Ct(Ve.paint_background["background-color"]),"background-pattern":new Ct(Ve.paint_background["background-pattern"]),"background-opacity":new Ct(Ve.paint_background["background-opacity"]),"background-emissive-strength":new Ct(Ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:rj,"raster-particle":lj,sky:class extends ys{constructor(l,r,a,u){super(l,{layout:oj||(oj=new Pi({visibility:new Ct(Ve.layout_sky.visibility)})),paint:sj||(sj=new Pi({"sky-type":new Ct(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new gu(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(Ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=g_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(l,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=l.style.light,y=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&Ut("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?PE(y.azimuthal,90-y.polar,r):PE(u[0],90-u[1],r)}const a=this.paint.get("sky-gradient-center");return PE(a[0],90-a[1],r)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends ys{constructor(l,r,a,u){super(l,{paint:aj||(aj=new Pi({}))},r,null)}},model:class extends ys{constructor(l,r,a,u){super(l,{layout:dj||(dj=new Pi({visibility:new Ct(Ve.layout_model.visibility),"model-id":new Dt(Ve.layout_model["model-id"])})),paint:fj||(fj=new Pi({"model-opacity":new Dt(Ve.paint_model["model-opacity"]),"model-rotation":new Dt(Ve.paint_model["model-rotation"]),"model-scale":new Dt(Ve.paint_model["model-scale"]),"model-translation":new Dt(Ve.paint_model["model-translation"]),"model-color":new Dt(Ve.paint_model["model-color"]),"model-color-mix-intensity":new Dt(Ve.paint_model["model-color-mix-intensity"]),"model-type":new Ct(Ve.paint_model["model-type"]),"model-cast-shadows":new Ct(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ct(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ct(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Dt(Ve.paint_model["model-emissive-strength"]),"model-roughness":new Dt(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Dt(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ct(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ct(Ve.paint_model["model-front-cutoff"]),"model-elevation-reference":new Ct(Ve.paint_model["model-elevation-reference"]),"model-color-use-theme":new Dt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this.layer=l,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new IE(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof qb?Mt-1:0}queryRenderedFeatures(l,r,a){const u=r.getSource();if(!(u&&u instanceof tf))return{};const d=u,g={};g[this.id]=[];const y=g[this.id];let x=0;for(const E of d.models){const C=r.getFeatureState(this.sourceLayer,E.id),R={type:"Unknown",id:E.id,properties:E.featureProperties},D=this.paint.get("model-rotation").evaluate(R,C),j=this.paint.get("model-scale").evaluate(R,C),V=this.paint.get("model-translation").evaluate(R,C),$=this.paint.get("model-elevation-reference");let Z=[];Pb(Z,E,a,E.position,D,j,V,$==="ground",$==="ground",!1),a.projection.name==="globe"&&(Z=Ab(Z,a));const re=J([],a.projMatrix,Z),te=Q2(l.isPointQuery()?l.screenBounds:l.screenGeometry,a,re,E.aabb);if(te!=null){const le=new ef(void 0,0,0,0,E.id);le.layer=this.layer,le.properties=structuredClone(E.featureProperties),le.properties.layer=this.id,le.properties.uri=E.uri,le.properties.orientation=E.orientation,le.sourceLayer=this.sourceLayer,le.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},le.state=C,le.source=this.source,y.push({featureIndex:x,feature:le,intersectionZ:te})}++x}return g}queryIntersectsFeature(l,r,a,u,d,g){if(!this.modelManager)return!1;const y=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof IE))return!1;for(const E in x.instancesPerModel){const C=x.instancesPerModel[E],R=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(R)){const D=C.features[C.idToFeaturesIndex[R]],j=y.getModel(E,this.scope);if(!j)return!1;let V=[];const $=new c(0,0),Z=x.canonical;let re=Number.MAX_VALUE;for(let te=0;te<D.instancedDataCount;++te){const le=16*(D.instancedDataOffset+te),ue=C.instancedDataArray.float32,fe=[ue[le+4],ue[le+5],ue[le+6]];OE(Z,$,Math.floor(ue[le]),Math.floor(ue[le+1])),Pb(V,j,g,$,D.rotation,D.scale,fe,!1,!1,!1),g.projection.name==="globe"&&(V=Ab(V,g));const we=J([],g.projMatrix,V),_e=l.queryGeometry,Ee=Q2(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,g,we,j.aabb);Ee!=null&&(re=Math.min(Ee,re))}return re!==Number.MAX_VALUE&&re}}return!1}_handleOverridablePaintPropertyUpdate(l,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const r=this._transitionablePaint._values[l];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof du}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ys{constructor(l,r,a,u){super(l,{layout:qR||(qR=new Pi({"clip-layer-types":new Ct(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ct(Ve.layout_clip["clip-layer-scope"])})),paint:ZR||(ZR=new Pi({}))},r,a,u)}recalculate(l,r){super.recalculate(l,r)}createBucket(l){return new XR(l)}is3D(l){return!0}}},RE=new Dn(0,0,0),DE={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},kE={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Zb={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},$Z={PAINT_ORDER_FILL_AND_STROKE:1},X_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},_j={MASK_TYPE_LUMINANCE:1};function UZ(l,r,a){l===1&&r.icons.push(function(u,d){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:x}=y;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=g.usvg_tree.width),x.height==null&&(x.height=x.width)}if(y.text_placeholder){const{text_placeholder:x}=y;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return y.stretch_x&&y.stretch_x.length&&vj(y,"x"),y.stretch_y&&y.stretch_y.length&&vj(y,"y"),g}(u.readFields(GZ,{name:void 0},d))}(a,a.readVarint()+a.pos))}function vj(l,r){const a=[],u=l[`stretch_${r}`];let d=null;for(let g=0;g<u.length;g++)d===null?d=a.length===0?u[0]:a[a.length-1][1]+u[g]:(a.push([d,d+u[g]]),d=null);l[`stretch_${r}_areas`]=a}function GZ(l,r,a){l===1?r.name=a.readString():l===2?r.metadata=function(u,d){return u.readFields(HZ,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(a,a.readVarint()+a.pos):l===3&&(r.usvg_tree=function(u,d){return u.readFields(ZZ,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(a,a.readVarint()+a.pos),r.data="usvg_tree")}function HZ(l,r,a){l===1?r.stretch_x=a.readPackedVarint():l===2?r.stretch_y=a.readPackedVarint():l===3?r.content_area=xj(a,a.readVarint()+a.pos):l===4?r.variables.push(function(u,d){return u.readFields(qZ,{name:void 0},d)}(a,a.readVarint()+a.pos)):l===5&&(r.text_placeholder=xj(a,a.readVarint()+a.pos))}function xj(l,r){return l.readFields(WZ,{},r)}function WZ(l,r,a){l===1?r.left=a.readVarint():l===2?r.width=a.readVarint():l===3?r.top=a.readVarint():l===4&&(r.height=a.readVarint())}function qZ(l,r,a){l===1?r.name=a.readString():l===2&&(r.rgb_color=Yb(a.readVarint()),r.value="rgb_color")}function ZZ(l,r,a){l===1?r.width=r.height=a.readVarint():l===2?r.height=a.readVarint():l===3?r.children.push(Xb(a,a.readVarint()+a.pos)):l===4?r.linear_gradients.push(function(u,d){return u.readFields(tX,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(a,a.readVarint()+a.pos)):l===5?r.radial_gradients.push(function(u,d){return u.readFields(nX,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(a,a.readVarint()+a.pos)):l===7?r.clip_paths.push(function(u,d){return u.readFields(iX,{children:[]},d)}(a,a.readVarint()+a.pos)):l===8&&r.masks.push(function(u,d){const g=u.readFields(oX,{left:0,width:20,mask_type:_j.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(a,a.readVarint()+a.pos))}function Xb(l,r){return l.readFields(XZ,{},r)}function XZ(l,r,a){l===1?(r.group=function(u,d){return u.readFields(KZ,{opacity:255,children:[]},d)}(a,a.readVarint()+a.pos),r.node="group"):l===2&&(r.path=function(u,d){return u.readFields(JZ,{paint_order:1,commands:[],step:1,diffs:[],rule:DE.PATH_RULE_NON_ZERO},d)}(a,a.readVarint()+a.pos),r.node="path")}function KZ(l,r,a){l===1?r.transform=Kb(a,a.readVarint()+a.pos):l===2?r.opacity=a.readVarint():l===5?r.clip_path_idx=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(Xb(a,a.readVarint()+a.pos))}function Kb(l,r){return l.readFields(YZ,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function YZ(l,r,a){l===1?r.sx=a.readFloat():l===2?r.ky=a.readFloat():l===3?r.kx=a.readFloat():l===4?r.sy=a.readFloat():l===5?r.tx=a.readFloat():l===6&&(r.ty=a.readFloat())}function JZ(l,r,a){l===1?r.fill=function(u,d){return u.readFields(QZ,{rgb_color:RE,paint:"rgb_color",opacity:255},d)}(a,a.readVarint()+a.pos):l===2?r.stroke=function(u,d){return u.readFields(eX,{rgb_color:RE,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(a,a.readVarint()+a.pos):l===3?r.paint_order=a.readVarint():l===5?a.readPackedVarint(r.commands):l===6?r.step=a.readFloat():l===7?a.readPackedSVarint(r.diffs):l===8&&(r.rule=a.readVarint())}function QZ(l,r,a){l===1?(r.rgb_color=Yb(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5&&(r.opacity=a.readVarint())}function Yb(l){return new Dn((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function eX(l,r,a){l===1?(r.rgb_color=Yb(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5?a.readPackedFloat(r.dasharray):l===6?r.dashoffset=a.readFloat():l===7?r.miterlimit=a.readFloat():l===8?r.opacity=a.readVarint():l===9?r.width=a.readFloat():l===10?r.linecap=a.readVarint():l===11&&(r.linejoin=a.readVarint())}function tX(l,r,a){l===1?r.transform=Kb(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(bj(a,a.readVarint()+a.pos)):l===4?r.x1=a.readFloat():l===5?r.y1=a.readFloat():l===6?r.x2=a.readFloat():l===7&&(r.y2=a.readFloat())}function bj(l,r){return l.readFields(rX,{offset:0,opacity:255,rgb_color:RE},r)}function rX(l,r,a){l===1?r.offset=a.readFloat():l===2?r.opacity=a.readVarint():l===3&&(r.rgb_color=Yb(a.readVarint()))}function nX(l,r,a){l===1?r.transform=Kb(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(bj(a,a.readVarint()+a.pos)):l===4?r.cx=a.readFloat():l===5?r.cy=a.readFloat():l===6?r.r=a.readFloat():l===7?r.fx=a.readFloat():l===8?r.fy=a.readFloat():l===9&&(r.fr=a.readFloat())}function iX(l,r,a){l===1?r.transform=Kb(a,a.readVarint()+a.pos):l===2?r.clip_path_idx=a.readVarint():l===3&&r.children.push(Xb(a,a.readVarint()+a.pos))}function oX(l,r,a){l===1?r.left=r.top=a.readFloat():l===2?r.width=r.height=a.readFloat():l===3?r.top=a.readFloat():l===4?r.height=a.readFloat():l===5?r.mask_type=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(Xb(a,a.readVarint()+a.pos))}class sX{static calculate(r={},a=[]){const u=new Map,d=new Map;if(Object.keys(r).length===0)return u;a.forEach(g=>{d.set(g.name,g.rgb_color||new Dn(0,0,0))});for(const[g,y]of Object.entries(r))d.has(g)?u.set(d.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function Sm(l,r=255,a){const u=r/255,d=l.toString(),g=a.has(d)?a.get(d).clone():l.clone();return g.a*=u,g.toString()}function K_(l,r){if(!$a()){const a=document.createElement("canvas");return a.width=l,a.height=r,a}return new OffscreenCanvas(l,r)}let jE,Y_=null;function LE(l,r,a,u,d){for(const g of u.children)wj(l,r,a,g,d)}function wj(l,r,a,u,d){u.group?(l.save(),function(g,y,x,E,C){const R=E.mask_idx!=null?x.masks[E.mask_idx]:null,D=E.clip_path_idx!=null?x.clip_paths[E.clip_path_idx]:null;if(E.transform&&(y=Em(E.transform).preMultiplySelf(y)),!function($,Z,re){return $.opacity!==255||Z||re}(E,D!=null,R!=null))return void LE(g,y,x,E,C);const j=K_(g.canvas.width,g.canvas.height),V=j.getContext("2d");LE(V,y,x,E,C),D&&Ij(V,y,x,D),R&&Mj(V,y,x,R,C),g.globalAlpha=E.opacity/255,g.drawImage(j,0,0)}(l,r,a,u.group,d),l.restore()):u.path&&(l.save(),function(g,y,x,E,C){g.setTransform(y),E.paint_order===$Z.PAINT_ORDER_FILL_AND_STROKE?(Tj(g,x,E,C),Ej(g,x,E,C)):(Ej(g,x,E,C),Tj(g,x,E,C))}(l,r,a,u.path,d),l.restore())}function Tj(l,r,a,u){const d=a.fill;if(!d)return;const g=d.opacity/255;switch(l.save(),l.beginPath(),Oj(a,l),d.paint){case"rgb_color":l.fillStyle=Sm(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const y=r.linear_gradients[d.linear_gradient_idx];y.transform&&l.setTransform(Em(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=Aj(l,y,g,u);break}case"radial_gradient_idx":{const y=r.radial_gradients[d.radial_gradient_idx];y.transform&&l.setTransform(Em(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=Pj(l,y,g,u)}}l.fill(Sj(a)),l.restore()}function Sj(l){return l.rule===DE.PATH_RULE_NON_ZERO?"nonzero":l.rule===DE.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Ej(l,r,a,u){const d=a.stroke;if(!d)return;const g=Rj(a);l.lineWidth=d.width,l.miterLimit=d.miterlimit,l.setLineDash(d.dasharray),l.lineDashOffset=d.dashoffset;const y=d.opacity/255;switch(d.paint){case"rgb_color":l.strokeStyle=Sm(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":l.strokeStyle=Aj(l,r.linear_gradients[d.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":l.strokeStyle=Pj(l,r.radial_gradients[d.radial_gradient_idx],y,u,!0)}switch(d.linejoin){case Zb.LINE_JOIN_MITER_CLIP:case Zb.LINE_JOIN_MITER:l.lineJoin="miter";break;case Zb.LINE_JOIN_ROUND:l.lineJoin="round";break;case Zb.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(d.linecap){case kE.LINE_CAP_BUTT:l.lineCap="butt";break;case kE.LINE_CAP_ROUND:l.lineCap="round";break;case kE.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(g)}function Aj(l,r,a,u,d=!1){if(r.stops.length===1){const j=r.stops[0];return Sm(j.rgb_color,j.opacity*a,u)}const{x1:g,y1:y,x2:x,y2:E}=r;let C=new DOMPoint(g,y),R=new DOMPoint(x,E);if(d){const j=Em(r.transform);C=j.transformPoint(C),R=j.transformPoint(R)}const D=l.createLinearGradient(C.x,C.y,R.x,R.y);for(const j of r.stops)D.addColorStop(j.offset,Sm(j.rgb_color,j.opacity*a,u));return D}function Pj(l,r,a,u,d=!1){if(r.stops.length===1){const te=r.stops[0];return Sm(te.rgb_color,te.opacity*a,u)}const g=Em(r.transform),{fx:y,fy:x,fr:E,cx:C,cy:R,r:D}=r;let j=new DOMPoint(y,x),V=new DOMPoint(C,R),$=E,Z=D;if(d){j=g.transformPoint(j),V=g.transformPoint(V);const te=(g.a+g.d)/2;$=E*te,Z=r.r*te}const re=l.createRadialGradient(j.x,j.y,$,V.x,V.y,Z);for(const te of r.stops)re.addColorStop(te.offset,Sm(te.rgb_color,te.opacity*a,u));return re}function Cj(l,r,a,u){const d=u.transform?Em(u.transform).preMultiplySelf(r):r,g=K_(l.canvas.width,l.canvas.height),y=g.getContext("2d");for(const E of u.children)if(E.group)Cj(y,d,a,E.group);else if(E.path){const C=E.path,R=new Path2D;R.addPath(Rj(C),d),y.fill(R,Sj(C))}const x=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;x&&Ij(y,d,a,x),l.globalCompositeOperation="source-over",l.drawImage(g,0,0)}function Ij(l,r,a,u){const d=K_(l.canvas.width,l.canvas.height);Cj(d.getContext("2d"),r,a,u),l.globalCompositeOperation="destination-in",l.drawImage(d,0,0)}function Mj(l,r,a,u,d){if(u.children.length===0)return;const g=u.mask_idx!=null?a.masks[u.mask_idx]:null;g&&Mj(l,r,a,g,d);const y=l.canvas.width,x=l.canvas.height,E=K_(y,x),C=E.getContext("2d"),R=u.width,D=u.height,j=u.left,V=u.top,$=new Path2D,Z=new Path2D;Z.rect(j,V,R,D),$.addPath(Z,r),C.clip($);for(const le of u.children)wj(C,r,a,le,d);const re=C.getImageData(0,0,y,x),te=re.data;if(u.mask_type===_j.MASK_TYPE_LUMINANCE)for(let le=0;le<te.length;le+=4)te[le+3]=te[le+3]/255*(.2126*te[le]+.7152*te[le+1]+.0722*te[le+2]);C.putImageData(re,0,0),l.globalCompositeOperation="destination-in",l.drawImage(E,0,0)}function Em(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function Oj(l,r){const a=l.step;let u=l.diffs[0]*a,d=l.diffs[1]*a;r.moveTo(u,d);for(let g=0,y=2;g<l.commands.length;g++)switch(l.commands[g]){case X_.PATH_COMMAND_MOVE:u+=l.diffs[y++]*a,d+=l.diffs[y++]*a,r.moveTo(u,d);break;case X_.PATH_COMMAND_LINE:u+=l.diffs[y++]*a,d+=l.diffs[y++]*a,r.lineTo(u,d);break;case X_.PATH_COMMAND_QUAD:{const x=u+l.diffs[y++]*a,E=d+l.diffs[y++]*a;u=x+l.diffs[y++]*a,d=E+l.diffs[y++]*a,r.quadraticCurveTo(x,E,u,d);break}case X_.PATH_COMMAND_CUBIC:{const x=u+l.diffs[y++]*a,E=d+l.diffs[y++]*a,C=x+l.diffs[y++]*a,R=E+l.diffs[y++]*a;u=C+l.diffs[y++]*a,d=R+l.diffs[y++]*a,r.bezierCurveTo(x,E,C,R,u,d);break}case X_.PATH_COMMAND_CLOSE:r.closePath()}return r}function Rj(l){return Oj(l,new Path2D)}class Jb{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const a=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,a),a}put(r,a){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,a)}delete(r){this.cache.delete(r)}}Yt(Jb,"LRUCache");class NE{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new qo(r,r.data)}getFromCache(r,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Jb(150)),this.cacheMap.get(u).get(Ma(r.toString(),a))}setInCache(r,a,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new Jb(150));const g=this.cacheDependenciesMap.get(d),y=Ma(r.id.toString(),u);g.get(y)||g.set(y,new Set);const x=this.cacheMap.get(d),E=r.toString();g.get(y).add(E),x.put(Ma(r.toString(),u),a)}removeImagesFromCacheByIds(r,a,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of r){const x=Ma(y.toString(),a);if(g.has(x)){for(const E of g.get(x))d.delete(E);g.delete(x)}}}rasterize(r,a,u,d){const g=this.getFromCache(r,u,d);if(g)return g.clone();const y=function(E,C){const R=sX.calculate(C.params,E.metadata?E.metadata.variables:[]),D=E.usvg_tree,j=D.width,V=D.height,$=Math.max(1,Math.round(j*C.sx)),Z=Math.max(1,Math.round(V*C.sy)),re=new DOMMatrix([$/j,0,0,Z/V,0,0]);return Y_===null&&(Y_=K_(10,10),jE=Y_.getContext("2d",{willReadFrequently:!0})),Y_.width=$,Y_.height=Z,LE(jE,re,D,D,R),jE.getImageData(0,0,$,Z)}(a.icon,r),x=NE._getImage(y);return this.setInCache(r,x,u,d),x.clone()}}class Dj{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const u=this.toIdx(r,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function kj(l,r,a,u){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<l[y]||a[y]>r[y])return null}else{const x=1/u[y];let E=(l[y]-a[y])*x,C=(r[y]-a[y])*x;if(E>C){const R=E;E=C,C=R}if(E>d&&(d=E),C<g&&(g=C),d>g)return null}return d}function jj(l,r,a,u,d,g,y,x,E,C,R){const D=u-l,j=d-r,V=g-a,$=y-l,Z=x-r,re=E-a,te=R[1]*re-R[2]*Z,le=R[2]*$-R[0]*re,ue=R[0]*Z-R[1]*$,fe=D*te+j*le+V*ue;if(Math.abs(fe)<1e-15)return null;const we=1/fe,_e=C[0]-l,Ee=C[1]-r,Me=C[2]-a,De=(_e*te+Ee*le+Me*ue)*we;if(De<0||De>1)return null;const rt=Ee*V-Me*j,Ne=Me*D-_e*V,at=_e*j-Ee*D,ft=(R[0]*rt+R[1]*Ne+R[2]*at)*we;return ft<0||De+ft>1?null:($*rt+Z*Ne+re*at)*we}function Lj(l,r,a){return(l-r)/(a-r)}function Nj(l,r,a,u,d,g,y,x,E){const C=1<<a,R=g-u,D=y-d,j=(l+1)/C*R+u,V=(r+0)/C*D+d,$=(r+1)/C*D+d;x[0]=(l+0)/C*R+u,x[1]=V,E[0]=j,E[1]=$}class zj{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const C=1/E,R=(V,$,Z,re,te)=>{const le=re?1:0,ue=(V+1)*Z-le,fe=$*Z,we=($+1)*Z-le;te[0]=V*Z,te[1]=fe,te[2]=ue,te[3]=we};let D=new Dj(E);const j=[];for(let V=0;V<E*E;V++){R(V%E,Math.floor(V/E),C,!1,j);const $=Ih(j[0],j[1],g),Z=Ih(j[2],j[1],g),re=Ih(j[2],j[3],g),te=Ih(j[0],j[3],g);D.minimums.push(Math.min($,Z,re,te)),D.maximums.push(Math.max($,Z,re,te)),D.leaves.push(1)}for(x.push(D),E/=2;E>=1;E/=2){const V=x[x.length-1];D=new Dj(E);for(let $=0;$<E*E;$++){R($%E,Math.floor($/E),2,!0,j);const Z=V.getElevation(j[0],j[1]),re=V.getElevation(j[2],j[1]),te=V.getElevation(j[2],j[3]),le=V.getElevation(j[0],j[3]),ue=V.isLeaf(j[0],j[1]),fe=V.isLeaf(j[2],j[1]),we=V.isLeaf(j[2],j[3]),_e=V.isLeaf(j[0],j[3]),Ee=Math.min(Z.min,re.min,te.min,le.min),Me=Math.max(Z.max,re.max,te.max,le.max),De=ue&&fe&&we&&_e;D.maximums.push(Me),D.minimums.push(Ee),D.leaves.push(Me-Ee<=5&&De?1:0)}x.push(D)}return x}(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(r,a,u,d,g,y,x=1){return kj([r,a,-100],[u,d,this.maximums[0]*x],g,y)}raycast(r,a,u,d,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,a,u,d,g,y,x);if(E==null)return null;const C=[],R=[],D=[],j=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:$,t:Z,nodex:re,nodey:te,depth:le}=V.pop();if(this.leaves[$]){Nj(re,te,le,r,a,u,d,D,j);const fe=1<<le,we=(re+0)/fe,_e=(re+1)/fe,Ee=(te+0)/fe,Me=(te+1)/fe,De=Ih(we,Ee,this.dem)*x,rt=Ih(_e,Ee,this.dem)*x,Ne=Ih(_e,Me,this.dem)*x,at=Ih(we,Me,this.dem)*x,ft=jj(D[0],D[1],De,j[0],D[1],rt,j[0],j[1],Ne,g,y),pt=jj(j[0],j[1],Ne,D[0],j[1],at,D[0],D[1],De,g,y),xt=Math.min(ft!==null?ft:Number.MAX_VALUE,pt!==null?pt:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const wt=xr([],g,y,Z);if(Fj(De,rt,at,Ne,Lj(wt[0],D[0],j[0]),Lj(wt[1],D[1],j[1]))>=wt[2])return Z}continue}let ue=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Nj((re<<1)+this._siblingOffset[fe][0],(te<<1)+this._siblingOffset[fe][1],le+1,r,a,u,d,D,j),D[2]=-100,j[2]=this.maximums[this.childOffsets[$]+fe]*x;const we=kj(D,j,g,y);if(we!=null){const _e=we;C[fe]=_e;let Ee=!1;for(let Me=0;Me<ue&&!Ee;Me++)_e>=C[R[Me]]&&(R.splice(Me,0,fe),Ee=!0);Ee||(R[ue]=fe),ue++}}for(let fe=0;fe<ue;fe++){const we=R[fe];V.push({idx:this.childOffsets[$]+we,t:C[we],nodex:(re<<1)+this._siblingOffset[we][0],nodey:(te<<1)+this._siblingOffset[we][1],depth:le+1})}}return null}_addNode(r,a,u){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,u,d,g){if(r[d].isLeaf(a,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,x=r[y];let E=0,C=0;for(let R=0;R<this._siblingOffset.length;R++){const D=2*a+this._siblingOffset[R][0],j=2*u+this._siblingOffset[R][1],V=x.getElevation(D,j),$=x.isLeaf(D,j),Z=this._addNode(V.min,V.max,$);$&&(E|=1<<R),C||(C=Z)}for(let R=0;R<this._siblingOffset.length;R++)E&1<<R||this._construct(r,2*a+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],y,C+R)}}function Fj(l,r,a,u,d,g){return vr(vr(l,a,g),vr(r,u,g),d)}function Ih(l,r,a){const u=a.dim,d=ne(l*u-.5,0,u-1),g=ne(r*u-.5,0,u-1),y=Math.floor(d),x=Math.floor(g),E=Math.min(y+1,u-1),C=Math.min(x+1,u-1);return Fj(a.get(y,x),a.get(E,x),a.get(y,C),a.get(E,C),d-y,g-x)}const aX={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lX(l,r,a){return(256*l*256+256*r+a)/10-1e4}function cX(l,r,a){return 256*l+r+a/256-32768}class Qb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,u,d=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Ut(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const g=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let E=0;E<g;E++)y[this._idx(-1,E)]=y[this._idx(0,E)],y[this._idx(g,E)]=y[this._idx(g-1,E)],y[this._idx(E,-1)]=y[this._idx(E,0)],y[this._idx(E,g)]=y[this._idx(E,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const x=u==="terrarium"?cX:lX;for(let E=0;E<y.length;++E){const C=4*E;this.floatView[E]=x(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=go.now()}_buildQuadTree(){this._tree=new zj(this)}get(r,a,u=!1){u&&(r=ne(r,-1,this.dim),a=ne(a,-1,this.dim));const d=this._idx(r,a);return this.floatView[d]}set(r,a,u){const d=this._idx(r,a),g=this.floatView[d];return this.floatView[d]=u,u-g}static getUnpackVector(r){return aX[r]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const u=[0,0,0,0],d=Qb.getUnpackVector(a);let g=Math.floor((r+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new DR({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,g=a*this.dim+this.dim,y=u*this.dim,x=u*this.dim+this.dim;switch(a){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:y=x-1;break;case 1:x=y+1}const E=-a*this.dim,C=-u*this.dim;for(let R=y;R<x;R++)for(let D=d;D<g;D++){const j=4*this._idx(D,R),V=4*this._idx(D+E,R+C);this.pixels[j+0]=r.pixels[V+0],this.pixels[j+1]=r.pixels[V+1],this.pixels[j+2]=r.pixels[V+2],this.pixels[j+3]=r.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function uX(l,r,a){l===1?r.headerLength=a.readFixed32():l===2?r.x=a.readVarint():l===3?r.y=a.readVarint():l===4?r.z=a.readVarint():l===5&&r.layers.push(function(u,d){return u.readFields(mX,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(a,a.readVarint()+a.pos))}function hX(l,r,a){l===1?(r.delta_filter=function(u,d){return u.readFields(dX,{blockSize:0},d)}(a,a.readVarint()+a.pos),r.filter="delta_filter"):l===2?(a.readVarint(),r.filter="zigzag_filter"):l===3?(a.readVarint(),r.filter="bitshuffle_filter"):l===4&&(a.readVarint(),r.filter="byteshuffle_filter")}function dX(l,r,a){l===1&&(r.blockSize=a.readVarint())}function fX(l,r,a){l===1?(a.readVarint(),r.codec="gzip_data"):l===2?(a.readVarint(),r.codec="jpeg_image"):l===3?(a.readVarint(),r.codec="webp_image"):l===4&&(a.readVarint(),r.codec="png_image")}function pX(l,r,a){let u=0,d=0;l===1?r.firstByte=a.readFixed64():l===2?r.lastByte=a.readFixed64():l===3?r.filters.push(function(g,y){return g.readFields(hX,{},y)}(a,a.readVarint()+a.pos)):l===4?r.codec=function(g,y){return g.readFields(fX,{},y)}(a,a.readVarint()+a.pos):l===5?d=a.readFloat():l===6?u=a.readFloat():l===7?r.bands.push(a.readString()):l===8?r.offset=a.readDouble():l===9&&(r.scale=a.readDouble()),r.offset===0&&(r.offset=d),r.scale===0&&(r.scale=u)}function mX(l,r,a){l===1?r.version=a.readVarint():l===2?r.name=a.readString():l===3?r.units=a.readString():l===4?r.tileSize=a.readVarint():l===5?r.buffer=a.readVarint():l===6?r.pixelFormat=a.readVarint():l===7&&r.dataIndex.push(function(u,d){return u.readFields(pX,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(a,a.readVarint()+a.pos))}function gX(l,r,a){if(l===2)(function(u,d,g){u.readFields(yX,g,d)})(a,a.readVarint()+a.pos,r);else if(l===3)throw new Error("Not implemented")}function yX(l,r,a){if(l===1){let u=0;const d=a.readVarint()+a.pos;for(;a.pos<d;)r[u++]=a.readVarint()}}function _X(l,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let a=r[3];for(let u=2;u>=1;u--){const d=u===1?1:0,g=u===2?1:0;for(let y=0;y<r[0];y++){const x=r[1]*y;for(let E=d;E<r[1];E++){const C=r[2]*(E+x);for(let R=g;R<r[2];R++){const D=r[3]*(R+C);for(let j=0;j<r[3];j++){const V=D+j;l[V]+=l[V-a]}}}}a*=r[u]}return l}function vX(l){for(let r=0,a=l.length;r<a;r++)l[r]=l[r]>>>1^-(1&l[r]);return l}function xX(l,r){switch(r){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const u=l[a],d=l[a+1];l[a]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,l[a+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const u=l[a],d=l[a+1],g=l[a+2],y=l[a+3];l[a+0]=(192&u)>>6|(192&d)>>4|(192&g)>>2|192&y,l[a+1]=(48&u)>>4|(48&d)>>2|48&g|(48&y)<<2,l[a+2]=(12&u)>>2|12&d|(12&g)<<2|(12&y)<<4,l[a+3]=3&u|(3&d)<<2|(3&g)<<4|(3&y)<<6}return l;default:throw new Error(`Invalid pixel format, "${r}"`)}}Yt(Qb,"DEMData"),Yt(zj,"DemMinMaxQuadTree",{omit:["dem"]});var ka=Uint8Array,J_=Uint16Array,bX=Int32Array,Bj=new ka([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vj=new ka([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wX=new ka([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$j=function(l,r){for(var a=new J_(31),u=0;u<31;++u)a[u]=r+=1<<l[u-1];var d=new bX(a[30]);for(u=1;u<30;++u)for(var g=a[u];g<a[u+1];++g)d[g]=g-a[u]<<5|u;return{b:a,r:d}},Uj=$j(Bj,2),Gj=Uj.b,TX=Uj.r;Gj[28]=258,TX[258]=28;for(var SX=$j(Vj,0).b,Hj=new J_(32768),co=0;co<32768;++co){var Am=(43690&co)>>1|(21845&co)<<1;Hj[co]=((65280&(Am=(61680&(Am=(52428&Am)>>2|(13107&Am)<<2))>>4|(3855&Am)<<4))>>8|(255&Am)<<8)>>1}var Q_=function(l,r,a){for(var u=l.length,d=0,g=new J_(r);d<u;++d)l[d]&&++g[l[d]-1];var y,x=new J_(r);for(d=1;d<r;++d)x[d]=x[d-1]+g[d-1]<<1;y=new J_(1<<r);var E=15-r;for(d=0;d<u;++d)if(l[d])for(var C=d<<4|l[d],R=r-l[d],D=x[l[d]-1]++<<R,j=D|(1<<R)-1;D<=j;++D)y[Hj[D]>>E]=C;return y},ev=new ka(288);for(co=0;co<144;++co)ev[co]=8;for(co=144;co<256;++co)ev[co]=9;for(co=256;co<280;++co)ev[co]=7;for(co=280;co<288;++co)ev[co]=8;var Wj=new ka(32);for(co=0;co<32;++co)Wj[co]=5;var EX=Q_(ev,9),AX=Q_(Wj,5),zE=function(l){for(var r=l[0],a=1;a<l.length;++a)l[a]>r&&(r=l[a]);return r},$l=function(l,r,a){var u=r/8|0;return(l[u]|l[u+1]<<8)>>(7&r)&a},FE=function(l,r){var a=r/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&r)},PX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ul=function(l,r,a){var u=new Error(r||PX[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,Ul),!a)throw u;return u},CX=new ka(0),IX=typeof TextDecoder<"u"&&new TextDecoder;try{IX.decode(CX,{stream:!0})}catch{}const MX={gzip_data:"gzip"};class rl extends Error{constructor(r){super(r),this.name="MRTError"}}const OX={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},qj={uint32:1,uint16:2,uint8:4},RX={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let BE;class e1{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const a=this.layers[r];if(!a)throw new rl(`Layer '${r}' not found`);return a}getHeaderLength(r){const a=new Uint8Array(r),u=new DataView(r);if(a[0]!==13)throw new rl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const a=new Uint8Array(r),u=this.getHeaderLength(r);if(a.length<u)throw new rl(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const d=new BE(a.subarray(0,u)).readFields(uX,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new rl(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new Zj(g,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const a=[],u=this.getLayer(r.layerName);for(let d of r.blockIndices){const g=u.dataIndex[d],y=g.firstByte-r.firstByte,x=g.lastByte-r.firstByte;if(u._blocksInProgress.has(d))continue;const E={layerName:u.name,firstByte:y,lastByte:x,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(C=>C.filter)};u._blocksInProgress.add(d),a.push(E)}return new Xj(a,()=>{a.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(a.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),d)throw d;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class Zj{constructor({version:r,name:a,units:u,tileSize:d,pixelFormat:g,buffer:y,dataIndex:x},E){if(this.version=r,this.version!==1)throw new rl(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=a,this.units=u,this.tileSize=d,this.buffer=y,this.pixelFormat=OX[g],this.dataIndex=x,this.bandShape=[d+2*y,d+2*y,qj[this.pixelFormat]],this._decodedBlocks=new Jb(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return qj[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const a=r.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,r.data)}getBlockForBand(r){let a=0;switch(typeof r){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[g,y]of d.bands.entries())if(y===r)return{bandIndex:a+g,blockIndex:u,blockBandIndex:g};a+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(r>=a&&r<a+d.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-a};a+=d.bands.length}break;default:throw new rl(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let a=1/0,u=-1/0;const d=[],g=new Set;for(const y of r){const{blockIndex:x}=this.getBlockForBand(y);if(x<0)throw new rl(`Invalid band: ${JSON.stringify(y)}`);const E=this.dataIndex[x];d.includes(x)||d.push(x),g.add(x),a=Math.min(a,E.firstByte),u=Math.max(u,E.lastByte)}if(g.size>this.cacheSize)throw new rl(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:d}}hasBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0}hasDataForBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(r){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(r);if(a<0)throw new rl(`Band not found: ${JSON.stringify(r)}`);const d=this._decodedBlocks.get(a.toString());if(!d)throw new rl(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[a],y=this.bandShape.reduce((C,R)=>C*R,1),x=u*y,E=d.subarray(x,x+y);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}e1.setPbf=function(l){BE=l};class Xj{constructor(r,a,u){this.tasks=r,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,a){this._finalized||(this._onComplete(r,a),this._finalized=!0)}}e1.performDecoding=function(l,r){const a=new Uint8Array(l);return Promise.all(r.tasks.map(u=>{const{layerName:d,firstByte:g,lastByte:y,pixelFormat:x,blockShape:E,blockIndex:C,filters:R,codec:D}=u,j=a.subarray(g,y+1),V=new Uint32Array(E[0]*E[1]*E[2]);let $;if(D!=="gzip_data")throw new rl(`Unhandled codec: ${D}`);return $=function(Z,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve(((fe=function(Ee){Ee[0]==31&&Ee[1]==139&&Ee[2]==8||Ul(6,"invalid gzip data");var Me=Ee[3],De=10;4&Me&&(De+=2+(Ee[10]|Ee[11]<<8));for(var rt=(Me>>3&1)+(Me>>4&1);rt>0;rt-=!Ee[De++]);return De+(2&Me)}(ue=Z))+8>ue.length&&Ul(6,"invalid gzip data"),function(Ee,Me,De,rt){var Ne=Ee.length;if(!Ne||Me.f&&!Me.l)return De||new ka(0);var at=!De,ft=at||Me.i!=2,pt=Me.i;at&&(De=new ka(3*Ne));var xt,wt,yt=function($n){var Tn=De.length;if($n>Tn){var Cn=new ka(Math.max(2*Tn,$n));Cn.set(De),De=Cn}},_t=Me.f||0,st=Me.p||0,it=Me.b||0,vt=Me.l,Ot=Me.d,At=Me.m,or=Me.n,Ft=8*Ne;do{if(!vt){_t=$l(Ee,st,1);var Ht=$l(Ee,st+1,3);if(st+=3,!Ht){var Qt=Ee[(lt=4+((st+7)/8|0))-4]|Ee[lt-3]<<8,Gr=lt+Qt;if(Gr>Ne){pt&&Ul(0);break}ft&&yt(it+Qt),De.set(Ee.subarray(lt,Gr),it),Me.b=it+=Qt,Me.p=st=8*Gr,Me.f=_t;continue}if(Ht==1)vt=EX,Ot=AX,At=9,or=5;else if(Ht==2){var Pt=$l(Ee,st,31)+257,er=$l(Ee,st+10,15)+4,Pr=Pt+$l(Ee,st+5,31)+1;st+=14;for(var en=new ka(Pr),sn=new ka(19),kr=0;kr<er;++kr)sn[wX[kr]]=$l(Ee,st+3*kr,7);st+=3*er;var Vn=zE(sn),ve=(1<<Vn)-1,Te=Q_(sn,Vn);for(kr=0;kr<Pr;){var lt,bt=Te[$l(Ee,st,ve)];if(st+=15&bt,(lt=bt>>4)<16)en[kr++]=lt;else{var kt=0,jt=0;for(lt==16?(jt=3+$l(Ee,st,3),st+=2,kt=en[kr-1]):lt==17?(jt=3+$l(Ee,st,7),st+=3):lt==18&&(jt=11+$l(Ee,st,127),st+=7);jt--;)en[kr++]=kt}}var sr=en.subarray(0,Pt),ur=en.subarray(Pt);At=zE(sr),or=zE(ur),vt=Q_(sr,At),Ot=Q_(ur,or)}else Ul(1);if(st>Ft){pt&&Ul(0);break}}ft&&yt(it+131072);for(var Rr=(1<<At)-1,Vr=(1<<or)-1,Ur=st;;Ur=st){var Kr=(kt=vt[FE(Ee,st)&Rr])>>4;if((st+=15&kt)>Ft){pt&&Ul(0);break}if(kt||Ul(2),Kr<256)De[it++]=Kr;else{if(Kr==256){Ur=st,vt=null;break}var _r=Kr-254;Kr>264&&(_r=$l(Ee,st,(1<<(xn=Bj[kr=Kr-257]))-1)+Gj[kr],st+=xn);var Sr=Ot[FE(Ee,st)&Vr],pn=Sr>>4;if(Sr||Ul(3),st+=15&Sr,ur=SX[pn],pn>3){var xn=Vj[pn];ur+=FE(Ee,st)&(1<<xn)-1,st+=xn}if(st>Ft){pt&&Ul(0);break}ft&&yt(it+131072);var bn=it+_r;if(it<ur){var jn=0-ur,Xn=Math.min(ur,bn);for(jn+it<0&&Ul(3);it<Xn;++it)De[it]=(void 0)[jn+it]}for(;it<bn;++it)De[it]=De[it-ur]}}Me.l=vt,Me.p=Ur,Me.b=it,Me.f=_t,vt&&(_t=1,Me.m=At,Me.d=Ot,Me.n=or)}while(!_t);return it!=De.length&&at?(xt=De,((wt=it)==null||wt>xt.length)&&(wt=xt.length),new ka(xt.subarray(0,wt))):De.subarray(0,it)}(ue.subarray(fe,-8),{i:2},new ka(((te=ue)[(le=te.length)-4]|te[le-3]<<8|te[le-2]<<16|te[le-1]<<24)>>>0))));var te,le,ue,fe;const we=MX[re];if(!we)throw new Error(`Unhandled codec: ${re}`);const _e=new globalThis.DecompressionStream(we);return new Response(new Blob([Z]).stream().pipeThrough(_e)).arrayBuffer().then(Ee=>new Uint8Array(Ee))}(j,D).then(Z=>(function(re,te){re.readFields(gX,te)}(new BE(Z),V),new RX[x](V.buffer))),$.then(Z=>{for(let re=R.length-1;re>=0;re--)switch(R[re]){case"delta_filter":_X(Z,E);break;case"zigzag_filter":vX(Z);break;case"bitshuffle_filter":xX(Z,x);break;default:throw new rl(`Unhandled filter "${R[re]}"`)}return{layerName:d,blockIndex:C,data:Z}}).catch(Z=>{throw Z})}))},Yt(Xj,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Yt(e1,"MapboxRasterTile"),Yt(Zj,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Kj{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const u=r[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class Yj{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new fh(Mt,16,0),this.featureIndexArray=new c_,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,a,u,d,g,y=0,x=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,y);const C=this.grid;for(let R=0;R<a.length;R++){const D=a[R],j=[1/0,1/0,-1/0,-1/0];for(let V=0;V<D.length;V++){const $=D[V];j[0]=Math.min(j[0],$.x),j[1]=Math.min(j[1],$.y),j[2]=Math.max(j[2],$.x),j[3]=Math.max(j[3],$.y)}x!==0&&(j[0]-=x,j[1]-=x,j[2]+=x,j[3]+=x),j[0]<Mt&&j[1]<Mt&&j[2]>=0&&j[3]>=0&&C.insert(E,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new We(new Mb(this.rawTileData)).layers,this.sourceLayerCoder=new Kj(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a){const{tilespaceGeometry:u,transform:d,tileTransform:g,pixelPosMatrix:y,availableImages:x,worldview:E}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const C=a.queryRadius?a.queryRadius:0,R=u.bufferedTilespaceBounds,D=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(Z,re,te,le)=>_s(u.bufferedTilespaceGeometry,Z-C,re-C,te+C,le+C));D.sort(DX);let j=null;d.elevation&&D.length>0&&(j=Tm.create(d.elevation,this.tileID));const V={};let $;for(let Z=0;Z<D.length;Z++){const re=D[Z];if(re===$)continue;$=re;const te=this.featureIndexArray.get(re);let le=null;this.is3DTile?this.loadMatchingModelFeature(V,te,r,u,d,E):this.loadMatchingFeature(V,te,r,x,E,(ue,fe,we,_e=0)=>(le||(le=Ce(ue,this.tileID.canonical,g)),fe.queryIntersectsFeature(u,ue,we,le,this.z,d,y,j,_e)))}return V}loadMatchingFeature(r,a,u,d,g,y){const{featureIndex:x,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:R}=a,D=this.bucketLayerIDs[E],j=u.layers,V=Object.keys(j);if(V.length&&!Xt(V,D))return;const $=u.sourceCache,Z=this.sourceLayerCoder.decode(C),re=this.vtLayers[Z].feature(x),te=this.getId(re,Z);for(let le=0;le<D.length;le++){const ue=D[le];if(!j[ue])continue;const{styleLayer:fe,targets:we}=j[ue];let _e={};te!==void 0&&(_e=$.getFeatureState(fe.sourceLayer,te));const Ee=!y||y(re,fe,_e,R);if(!Ee)continue;const Me=new ef(re,this.z,this.x,this.y,te);Me.tile=this.tileID.canonical,Me.state=_e;let De=this.serializedLayersCache.get(ue);De||(De=fe.serialize(),De.id=ue,this.serializedLayersCache.set(ue,De)),Me.source=De.source,Me.sourceLayer=De["source-layer"],Me.layer=Object.assign({},De),Me.layer.paint=Jj(De.paint,fe.paint,re,_e,d),Me.layer.layout=Jj(De.layout,fe.layout,re,_e,d);let rt=!1;for(const Ne of we){this.updateFeatureProperties(Me,Ne);const{filter:at}=Ne;if(at){if(re.properties=Me.properties,at.needGeometry){const ft=Le(re,!0);if(!at.filter(new ri(this.tileID.overscaledZ,{worldview:g}),ft,this.tileID.canonical))continue}else if(!at.filter(new ri(this.tileID.overscaledZ,{worldview:g}),re))continue}rt=!0,Ne.targetId&&this.addFeatureVariant(Me,Ne)}rt&&this.appendToResult(r,ue,x,Me,Ee)}}loadMatchingModelFeature(r,a,u,d,g,y){const{featureIndex:x,bucketIndex:E}=a,C=this.bucketLayerIDs[E],R=u.layers,D=Object.keys(R);if(!D.length||Xt(D,C))for(let j=0;j<C.length;j++){const V=C[j],{styleLayer:$,targets:Z}=R[V];if($.type!=="model")continue;const re=d.tile,te=re.getBucket($);if(!(te&&te instanceof qb))continue;const le=BZ(te,x,d,g);if(!le)continue;const{z:ue,x:fe,y:we}=re.tileID.canonical,{feature:_e,intersectionZ:Ee,position:Me}=le;let De={};_e.id!==void 0&&(De=u.sourceCache.getFeatureState($.sourceLayer,_e.id));const rt=new ef({},ue,fe,we,_e.id);rt.tile=this.tileID.canonical,rt.state=De,rt.properties=_e.properties,rt.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Ne=this.serializedLayersCache.get(V);Ne||(Ne=$.serialize(),Ne.id=V,this.serializedLayersCache.set(V,Ne)),rt.source=Ne.source,rt.sourceLayer=Ne["source-layer"],rt.layer=Object.assign({},Ne);let at=!1;for(const ft of Z){this.updateFeatureProperties(rt,ft);const{filter:pt}=ft;if(pt){if(_e.properties=rt.properties,pt.needGeometry){if(!pt.filter(new ri(this.tileID.overscaledZ,{worldview:y}),_e,this.tileID.canonical))continue}else if(!pt.filter(new ri(this.tileID.overscaledZ,{worldview:y}),_e))continue}at=!0,ft.targetId&&this.addFeatureVariant(rt,ft)}at&&this.appendToResult(r,V,x,rt,Ee)}}updateFeatureProperties(r,a,u){if(a.properties){const d={};for(const g in a.properties){const y=a.properties[g].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);y!=null&&(d[g]=y)}r.properties=d}}addFeatureVariant(r,a,u){const d={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(d.properties=r.properties),r.variants=r.variants||{},r.variants[a.targetId]=r.variants[a.targetId]||[],r.variants[a.targetId].push(d)}appendToResult(r,a,u,d,g){let y=r[a];y===void 0&&(y=r[a]=[]),y.push({featureIndex:u,feature:d,intersectionZ:g})}lookupSymbolFeatures(r,a,u,d,g,y){const x={};this.loadVTLayers();for(const E of r)this.loadMatchingFeature(x,{bucketIndex:a,sourceLayerIndex:u,featureIndex:E,layoutVertexArrayOffset:0},d,g,y);return x}loadFeature(r){const{featureIndex:a,sourceLayerIndex:u}=r;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[a])return g[a];const y=this.vtLayers[d].feature(a);return g[a]=y,y}hasLayer(r){for(const a of this.bucketLayerIDs)for(const u of a)if(r===u)return!0;return!1}getId(r,a){let u=r.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=Ac(d);if(g.result!=="success"){const y=g.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Ut(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function Jj(l,r,a,u,d){return Xe(l,(g,y)=>{const x=r instanceof mu?r.get(y):null;return x&&x.evaluate?x.evaluate(a,u,void 0,d):x})}function DX(l,r){return r-l}Yt(Yj,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Qj=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class VE{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=Qj[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[x]=new Uint32Array(r,4,1);return new VE(x,y,g,r)}constructor(r,a=64,u=Float64Array,d){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const g=Qj.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,x=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=a,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return $E(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:x}=this,E=[0,g.length-1,0],C=[];for(;E.length;){const R=E.pop()||0,D=E.pop()||0,j=E.pop()||0;if(D-j<=x){for(let re=j;re<=D;re++){const te=y[2*re],le=y[2*re+1];te>=r&&te<=u&&le>=a&&le<=d&&C.push(g[re])}continue}const V=j+D>>1,$=y[2*V],Z=y[2*V+1];$>=r&&$<=u&&Z>=a&&Z<=d&&C.push(g[V]),(R===0?r<=$:a<=Z)&&(E.push(j),E.push(V-1),E.push(1-R)),(R===0?u>=$:d>=Z)&&(E.push(V+1),E.push(D),E.push(1-R))}return C}within(r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,x=[0,d.length-1,0],E=[],C=u*u;for(;x.length;){const R=x.pop()||0,D=x.pop()||0,j=x.pop()||0;if(D-j<=y){for(let re=j;re<=D;re++)tL(g[2*re],g[2*re+1],r,a)<=C&&E.push(d[re]);continue}const V=j+D>>1,$=g[2*V],Z=g[2*V+1];tL($,Z,r,a)<=C&&E.push(d[V]),(R===0?r-u<=$:a-u<=Z)&&(x.push(j),x.push(V-1),x.push(1-R)),(R===0?r+u>=$:a+u>=Z)&&(x.push(V+1),x.push(D),x.push(1-R))}return E}}function $E(l,r,a,u,d,g){if(d-u<=a)return;const y=u+d>>1;eL(l,r,y,u,d,g),$E(l,r,a,u,y-1,1-g),$E(l,r,a,y+1,d,1-g)}function eL(l,r,a,u,d,g){for(;d>u;){if(d-u>600){const C=d-u+1,R=a-u+1,D=Math.log(C),j=.5*Math.exp(2*D/3),V=.5*Math.sqrt(D*j*(C-j)/C)*(R-C/2<0?-1:1);eL(l,r,a,Math.max(u,Math.floor(a-R*j/C+V)),Math.min(d,Math.floor(a+(C-R)*j/C+V)),g)}const y=r[2*a+g];let x=u,E=d;for(tv(l,r,u,a),r[2*d+g]>y&&tv(l,r,u,d);x<E;){for(tv(l,r,x,E),x++,E--;r[2*x+g]<y;)x++;for(;r[2*E+g]>y;)E--}r[2*u+g]===y?tv(l,r,u,E):(E++,tv(l,r,E,d)),E<=a&&(u=E+1),a<=E&&(d=E-1)}}function tv(l,r,a,u){UE(l,a,u),UE(r,2*a,2*u),UE(r,2*a+1,2*u+1)}function UE(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}function tL(l,r,a,u){const d=l-a,g=r-u;return d*d+g*g}i.$=np,i.A=Tl,i.B=Ma,i.C=2,i.D=um,i.E=su,i.F=L_,i.G=Pk,i.H=rp,i.I=es,i.J=Wx,i.K=ir,i.L=eh,i.M=Pp,i.N=Md,i.O=Dx,i.P=mt,i.Q=Od,i.R=cd,i.S=Np,i.T=Y2,i.U=Ac,i.V=Wb,i.W=Uy,i.X=oh,i.Y=ih,i.Z=Sd,i._=ms,i.a=function(l){return Jr.API_CDN_URL_REGEX.test(l)},i.a$=W,i.a0=Tr,i.a1=ia,i.a2=Ya,i.a3=class extends Wb{},i.a4=Cp,i.a5=Rx,i.a6=Ve,i.a7=function(l){const r=l.value;return r?Tr(r)?CE(r,!0)?[]:[new Wb(l.key,r,`invalid url "${r}"`)]:[new Wb(l.key,r,`string expected, "${ir(r)}" found`)]:[]},i.a8=$x,i.a9=Pi,i.aA=ne,i.aB=J,i.aC=Hi,i.aD=Go,i.aE=qn,i.aF=P,i.aG=de,i.aH=function(l,r){const a={};for(let u=0;u<r.length;u++){const d=r[u];d in l&&(a[d]=l[d])}return a},i.aI=p,i.aJ=O,i.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,r,a,u){const d=this.entries[l]=this.entries[l]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},r):u(g,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a((g,y)=>{d.result=[g,y];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(g,y)},r):x(g,y);setTimeout(()=>delete this.entries[l],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==u),d.callbacks.length||(d.cancel(),delete this.entries[l]))}}},i.aL=function(l,r,a){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},d=>{const g=wl(l.request,(y,x,E)=>{y?d(y):x&&d(null,{rawData:x,vectorTile:a?void 0:new We(new Mb(x)),responseHeaders:new Map(E.entries())})});return()=>{g.cancel(),d()}},r)},i.aM=function(l){return l?{cacheControl:l.get("Cache-Control"),expires:l.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=Ls,i.aO=function(l){na++,na>Wf&&(l.getActor().send("enforceCacheSizeLimit",Hf),na=0)},i.aP=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},i.aQ=Ti,i.aR=rj,i.aS=lj,i.aT=c,i.aU=tj,i.aV=function(l,r){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let u=0;u<l.length;u++){const d=document.createElement("source");HS(l[u])||(a.crossOrigin="Anonymous"),d.src=l[u],a.appendChild(d)}return{cancel:()=>{}}},i.aW=O_,i.aX=tf,i.aY=ze,i.aZ=B_,i.a_=N,i.aa=Ct,i.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return Dr(l.expression.evaluate(r))}interpolate(l,r,a){return{x:vr(l.x,r.x,a),y:vr(l.y,r.y,a),z:vr(l.z,r.z,a),azimuthal:vr(l.azimuthal,r.azimuthal,a),polar:vr(l.polar,r.polar,a)}}},i.ac=ri,i.ad=du,i.ae=he,i.af=Nr,i.ag=ct,i.ah=ce,i.ai=mu,i.aj=Sh,i.ak=vr,i.al=Mt,i.am=dy,i.an=qr,i.ao=Dn,i.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return function([a,u]){const d=Dr([1,a,u]);return{x:d.x,y:d.y,z:d.z}}(l.expression.evaluate(r))}interpolate(l,r,a){return{x:vr(l.x,r.x,a),y:vr(l.y,r.y,a),z:vr(l.z,r.z,a)}}},i.aq=function(l,r,a=0,u=!0){const d=new mt(a,a),g=l.sub(d),y=r.add(d),x=[g,new mt(y.x,g.y),y,new mt(g.x,y.y)];return u&&x.push(g.clone()),x},i.ar=function(l,r){const a=[];for(let u=0;u<l.length;u++){const d=ge(u-1,-1,l.length-1),g=ge(u+1,-1,l.length-1),y=l[u],x=l[g],E=l[d].sub(y).unit(),C=x.sub(y).unit(),R=C.angleWithSep(E.x,E.y),D=E.add(C).unit().mult(-1*r/Math.sin(R/2));a.push(y.add(D))}return a},i.as=Bk,i.at=_s,i.au=function(l,r,a=0){return He(((r.x-a)*l.scale-l.x)*Mt,(r.y*l.scale-l.y)*Mt,H(r.z,r.y))},i.av=Kn,i.aw=Lt,i.ax=Jt,i.ay=tk,i.az=function(l){let r=1/0,a=1/0,u=-1/0,d=-1/0;for(const g of l)r=Math.min(r,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new mt(r,a),max:new mt(u,d)}},i.b=function(l){return Jr.API_FONTS_REGEX.test(l)},i.b$=tD,i.b0=to,i.b1=gh,i.b2=je,i.b3=tb,i.b4=$b,i.b5=function(){Ml.isLoading()||Ml.isLoaded()||jd()!=="deferred"||Vx()},i.b6=zp,i.b7=Le,i.b8=ef,i.b9=Ai,i.bA=U,i.bB=pe,i.bC=G,i.bD=function(l,r){const{x:a,y:u}=l.point,d=xR(a,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return J(d,d,A2(Da(r)))},i.bE=I,i.bF=Un,i.bG=nn,i.bH=xr,i.bI=pr,i.bJ=nr,i.bK=_m,i.bL=Js,i.bM=mE,i.bN=function(l,r,a,u,d){const g=5*r+2;l.float32[g+0]=a,l.float32[g+1]=u,l.float32[g+2]=d},i.bO=wm,i.bP=Ir,i.bQ=ko,i.bR=Ii,i.bS=on,i.bT=ge,i.bU=function(l,r,a,u){var d=new A(4);return d[0]=l,d[1]=r,d[2]=a,d[3]=u,d},i.bV=class{isDataAvailableAtPoint(l){const r=this._source();if(this.isUsingMockSource()||!r||l.y<0||l.y>1)return!1;const a=r.getSource().maxzoom,u=1<<a,d=Math.floor(l.x),g=Math.floor((l.x-d)*u),y=Math.floor(l.y*u),x=this.findDEMTileFor(new Ti(a,d,a,g,y));return!(!x||!x.dem)}getAtPointOrZero(l,r=0){return this.getAtPoint(l,r)||0}getAtPoint(l,r,a=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||l.y<0||l.y>1)return r;const d=u.getSource().maxzoom,g=1<<d,y=Math.floor(l.x),x=l.x-y,E=new Ti(d,y,d,Math.floor(x*g),Math.floor(l.y*g)),C=this.findDEMTileFor(E);if(!C||!C.dem)return r;const R=C.dem,D=1<<C.tileID.canonical.z,j=(x*D-C.tileID.canonical.x)*R.dim,V=(l.y*D-C.tileID.canonical.y)*R.dim,$=Math.floor(j),Z=Math.floor(V);return(a?this.exaggeration():1)*vr(vr(R.get($,Z),R.get($,Z+1),V-Z),vr(R.get($+1,Z),R.get($+1,Z+1),V-Z),j-$)}static getAtTileOffset(l,r,a,u){const d=1<<l.canonical.z;return u?u.pointElevation(r):a?a.getAtPointOrZero(new he(l.wrap+(l.canonical.x+r.x/Mt)/d,(l.canonical.y+r.y/Mt)/d)):0}static getAtTileOffsetFunc(l,r,a,u){return(d,g,y)=>{const x=this.getAtTileOffset(l,d,g,y),E=u.upVector(l.canonical,d.x,d.y);return Vt(E,E,x*u.upVectorScale(l.canonical,r,a).metersToTile),E}}getForTilePoints(l,r,a,u){if(this.isUsingMockSource())return!1;const d=Tm.create(this,l,u);return!!d&&(r.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(l);if(!r||!r.dem)return null;const a=r.dem.tree,u=r.tileID,d=1<<l.canonical.z-u.canonical.z;let g=l.canonical.x/d-u.canonical.x,y=l.canonical.y/d-u.canonical.y,x=0;for(let E=0;E<l.canonical.z-u.canonical.z&&!a.leaves[x];E++){g*=2,y*=2;const C=2*Math.floor(y)+Math.floor(g);x=a.childOffsets[x]+C,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let r=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of l){const g=this.getMinMaxForTile(d.tileID);g&&(a=Math.min(a,g.min),u=Math.max(u,g.max),r=!0)}return r?{min:a,max:u}:null}},i.bW=vb,i.bX=yn,i.bY=_o,i.bZ=YR,i.b_=cj,i.ba=sE,i.bb=L2,i.bc=Ce,i.bd=Cc,i.be=Mc,i.bf=wh,i.bg=gi,i.bh=lm,i.bi=AE,i.bj=function(l,r){const a=Sh(r.zoom);if(a===0)return Da(l);const u=lb(l),d=E2(u),g=P(u.getWest())*r.worldSize,y=P(u.getEast())*r.worldSize,x=O(u.getNorth())*r.worldSize,E=O(u.getSouth())*r.worldSize,C=[g,x,0],R=[y,x,0],D=[g,E,0],j=[y,E,0],V=K([],r.globeMatrix);return Nr(C,C,V),Nr(R,R,V),Nr(D,D,V),Nr(j,j,V),d[0]=zl(d[0],D,a),d[1]=zl(d[1],j,a),d[2]=zl(d[2],R,a),d[3]=zl(d[3],C,a),rr.fromPoints(d)},i.bk=ub,i.bl=K,i.bm=m_,i.bn=zl,i.bo=mh,i.bp=Wd,i.bq=Pe,i.br=X,i.bs=e1,i.bt=Mb,i.bu=wl,i.bv=function(l,r){const a=[];for(const u in l)u in r||a.push(u);return a},i.bw=Oe,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=Vo,i.bz=F,i.c=No,i.c$=function(l,r,a){let u=0;for(let d=0;d<2;++d)l[d]>0&&(u+=(l[d]-0)*(l[d]-0)),r[d]<0&&(u+=(0-r[d])*(0-r[d]));return u},i.c0=rD,i.c1=dE,i.c2=kk,i.c3=xE,i.c4=VE,i.c5=Vt,i.c6=ds,i.c7=wo,i.c8=function(l,r,a){a*=.5;var u=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return l[0]=u*E+d*x,l[1]=d*E-u*x,l[2]=g*E+y*x,l[3]=y*E-g*x,l},i.c9=Po,i.cA=Qe,i.cB=wn,i.cC=BD,i.cD=Zn,i.cE=yR,i.cF=function(l,r,a,u,d,g,y,x,E){if(E.name==="globe")return yR(l,r,new Zn(a,u,d),!1);const C=B_({z:a,x:u,y:d},E);return new rr([(g+C.x/C.scale)*r,r*(C.y/C.scale),y],[(g+C.x2/C.scale)*r,r*(C.y2/C.scale),x])},i.cG=function(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l[3]=Math.min(r[3],a[3]),l},i.cH=function(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l[3]=Math.max(r[3],a[3]),l},i.cI=function(l){const r=Math.round((l+45+360)%360/90)%4;return ly[r]},i.cJ=q,i.cK=bo,i.cL=am,i.cM=function(l){const r=U(new Float64Array(16));J(r,l.pixelMatrix,l.globeMatrix);const a=[0,ua,0],u=[0,ha,0];return Nr(a,a,r),Nr(u,u,r),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!C2(l,new c(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!C2(l,new c(l.center.lat,-90))]},i.cN=function(l,r){const{scale:a}=l.tileTransform,u=a*Mt/(l.tileSize*Math.pow(2,r.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(d,g,y){var x=g[1],E=g[2],C=g[3],R=y[0],D=y[1];return d[0]=g[0]*R,d[1]=x*R,d[2]=E*D,d[3]=C*D,d}(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},i.cO=Sb,i.cP=Ge,i.cQ=FD,i.cR=function(l){const r=FD(l,!0);return I([],[r[0],r[1],r[4],r[5]])},i.cS=ie,i.cT=zt,i.cU=Q,i.cV=function(l){const{x:r,y:a}=l.point,{lng:u,lat:d}=l._center;return xR(r,a,l.worldSize,u,d)},i.cW=Kt,i.cX=Jo,i.cY=_i,i.cZ=zo,i.c_=ca,i.ca=Oi,i.cb=function(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l[3]=r[3],l},i.cc=Be,i.cd=function(l,r,a,u,d){var g=1/Math.tan(r/2);if(l[0]=g/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=g,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,d!=null&&d!==1/0){var y=1/(u-d);l[10]=(d+u)*y,l[14]=2*d*u*y}else l[10]=-1,l[14]=-2*u;return l},i.ce=function(l,r,a,u,d,g,y){var x=1/(r-a),E=1/(u-d),C=1/(g-y);return l[0]=-2*x,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*E,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*C,l[11]=0,l[12]=(r+a)*x,l[13]=(d+u)*E,l[14]=(y+g)*C,l[15]=1,l},i.cf=k,i.cg=function(l,r,a){l[4*r+0]=a[0],l[4*r+1]=a[1],l[4*r+2]=a[2],l[4*r+3]=a[3]},i.ch=nm,i.ci=Bd,i.cj=ro,i.ck=el,i.cl=$d,i.cm=Hk,i.cn=function(){var l=new A(4);return A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},i.co=function(l,r,a){var u=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return l[0]=u*E+g*x,l[1]=d*E+y*x,l[2]=u*-x+g*E,l[3]=d*-x+y*E,l},i.cp=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]},i.cq=zn,i.cr=function(l){var r=l[0],a=l[1],u=l[2],d=l[3];return Math.sqrt(r*r+a*a+u*u+d*d)},i.cs=Zt,i.ct=ci,i.cu=Vi,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Nt,i.d=function(l){return Jr.API_TILEJSON_REGEX.test(l)},i.d$=class{constructor(l,r,a,u){this.context=l,this.format=u,this.size=a,this.texture=l.gl.createTexture();const[d,g,y]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,d,g,y,0,X2(this.format),K2(this.format),r.data)}bind(l,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.d0=function(l){return l*l*l*l*l},i.d1=T,i.d2=45,i.d3=im,i.d4=function(l,r,a){const u=Math.sqrt(l*l+r*r+a*a),d=u>0?Math.acos(a/u)*Lo:0;let g=l!==0||r!==0?Math.atan2(-r,-l)*Lo+90:0;return g<0&&(g+=360),[u,g,d]},i.d5=He,i.d6=Dr,i.d7=oe,i.d8=ut,i.d9=rr,i.dA=function(l){return l({pluginStatus:gs,pluginURL:Il}),jp.on("pluginStateChange",l),l},i.dB=Vd,i.dC=class extends Rl{constructor(l){super(l),this.current=om}set(l,r,a){if(this.fetchUniformLocation(l,r)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},i.dD=eu,i.dE=function(l,r,a){const u=Sh(a.zoom),d=l.style.map._antialias,g=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!d&&!g},i.dF=function(l){const r=l.pixelsPerMeter,a=r/k(1,l.center.lat),u=U(new Float64Array(16));return X(u,u,[l.point.x,l.point.y,0]),ie(u,u,[a,a,r]),Float32Array.from(u)},i.dG=lb,i.dH=function(l){const r=q-5;l=ne(l,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin(qr(l))),3);return Math.round(a*(p_.length-1))},i.dI=function(l,r,a,u){const d=r.getNorth(),g=r.getSouth(),y=r.getWest(),x=r.getEast(),E=1<<l.z,C=x-y,R=d-g,D=C/xh,j=-R/p_[a],V=[0,D,0,j,0,0,d,y,0];if(l.z>0){const $=180/u;z(V,V,[$/C+1,0,0,0,$/R+1,0,-.5*$/D,.5*$/j,1])}return V[2]=E,V[5]=l.x,V[8]=l.y,V},i.dJ=Da,i.dK=function(l,r,a){const u=U(new Float64Array(16)),d=(r/(1<<l)-.5)*Math.PI*2;return ae(u,a.globeMatrix,d),Float32Array.from(u)},i.dL=DR,i.dM=tl,i.dN=function(l,r){return[Math.pow(l[0],2.2)*r,Math.pow(l[1],2.2)*r,Math.pow(l[2],2.2)*r]},i.dO=M,i.dP=function(l,r){var a=Math.sin(r),u=Math.cos(r);return l[0]=u,l[1]=a,l[2]=0,l[3]=-a,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},i.dQ=un,i.dR=vR,i.dS=mn,i.dT=bi,i.dU=256,i.dV=function(l,r){const a=[0,0,0];return Nr(a,a,ub(Da(r.canonical))),Nr(a,a,l),a},i.dW=l=>({u_matrix:new $d(l),u_texsize:new el(l),u_pixels_to_tile_units:new sm(l),u_device_pixel_ratio:new ro(l),u_width_scale:new ro(l),u_floor_width_scale:new ro(l),u_image:new nm(l),u_units_to_pixels:new el(l),u_tile_units_to_pixels:new ro(l),u_alpha_discard_threshold:new ro(l),u_trim_offset:new el(l),u_trim_fade_range:new el(l),u_trim_color:new im(l),u_zbias_factor:new ro(l),u_tile_to_meter:new ro(l),u_ground_shadow_factor:new Bd(l),u_pattern_transition:new ro(l)}),i.dX=l=>({u_matrix:new $d(l),u_pixels_to_tile_units:new sm(l),u_device_pixel_ratio:new ro(l),u_width_scale:new ro(l),u_floor_width_scale:new ro(l),u_units_to_pixels:new el(l),u_dash_image:new nm(l),u_gradient_image:new nm(l),u_image_height:new ro(l),u_texsize:new el(l),u_tile_units_to_pixels:new ro(l),u_alpha_discard_threshold:new ro(l),u_trim_offset:new el(l),u_trim_fade_range:new el(l),u_trim_color:new im(l),u_zbias_factor:new ro(l),u_tile_to_meter:new ro(l),u_ground_shadow_factor:new Bd(l)}),i.dY=l=>({u_camera_to_center_distance:new ro(l),u_extrude_scale:new sm(l),u_device_pixel_ratio:new ro(l),u_matrix:new $d(l),u_inv_rot_matrix:new $d(l),u_merc_center:new el(l),u_tile_id:new Bd(l),u_zoom_transition:new ro(l),u_up_dir:new Bd(l),u_emissive_strength:new ro(l)}),i.dZ=Zp,i.d_=G7,i.da=nt,i.db=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.dc=zD,i.dd=nE,i.de=UD,i.df=CE,i.dg=function(l,r){return l.readFields(UZ,{icons:[]},r)},i.dh=xb,i.di=vm,i.dj=yE,i.dk=Xf,i.dl=kd,i.dm=Yu,i.dn=Yf,i.dp=dt,i.dq=function(l){const r=l.indexOf(_u);return r>=0?l.slice(0,r):l},i.dr=function(l){return l.indexOf(_u)>=0},i.ds=function(l){const r=l.lastIndexOf(_u);return r>=0?l.slice(r+1):""},i.dt=function(l){const r=[],a=l.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},i.du=function(l,r,a,u){return l.type==="custom"?new LZ(l,r):new VZ[l.type](l,r,a,u)},i.dv=Tt,i.dw=function(l){const r=l.indexOf(_u);return r>=0?l.slice(r+1):""},i.dx=class extends ef{constructor(l,r){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},i.dy=jp,i.dz=ou,i.e=Jr,i.e$=qe,i.e0=TR,i.e1=(l,r,a,u,d,g)=>{const y=l.transform,x=y.projection.name==="globe";let E;if(g.paint.get("circle-pitch-alignment")==="map")if(x){const R=vR(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([R,0,0,R])}else E=y.calculatePixelsToTileUnitsMatrix(a);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(y.projection),u_matrix:l.translatePosMatrix(r.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:go.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:s9,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(x){C.u_inv_rot_matrix=u,C.u_merc_center=d,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=Sh(y.zoom);const R=d[0]*Mt,D=d[1]*Mt;C.u_up_dir=y.projection.upVector(new Zn(0,0,0),R,D)}return C},i.e2=ok,i.e3=ps,i.e4=(l,r,a,u,d,g,y,x,E,C)=>{const R=l.transform,D=R.pitch<15?rk(.07,.7,ne((14-R.zoom)/5,0,1)):.07,j=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:ik(l,r,a,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:nk(r,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:a.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:oe(r.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:C}},i.e5=(l,r,a,u,d,g,y,x,E,C)=>{const R=l.transform,D=R.calculatePixelsToTileUnitsMatrix(r),j=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=R.pitch<15?rk(.07,.7,ne((14-R.zoom)/5,0,1)):.07;return{u_matrix:ik(l,r,a,u),u_pixels_to_tile_units:D,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:x,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:sk(a)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:nk(r,l.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:a.lut).toArray01(),u_zbias_factor:V,u_tile_to_meter:oe(r.tileID.canonical,0),u_ground_shadow_factor:C}},i.e6=Ye,i.e7=g_,i.e8=H,i.e9=fa,i.eA=function(l,r){var a=2*Math.acos(r[3]),u=Math.sin(a/2);return u>S?(l[0]=r[0]/u,l[1]=r[1]/u,l[2]=r[2]/u):(l[0]=1,l[1]=0,l[2]=0),a},i.eB=OE,i.eC=Pb,i.eD=Ab,i.eE=[1,1,1],i.eF=Tm,i.eG=ao,i.eH=function(l,r,a,u){var d=r[0],g=r[1],y=r[2],x=r[3];return l[0]=d+u*(a[0]-d),l[1]=g+u*(a[1]-g),l[2]=y+u*(a[2]-y),l[3]=x+u*(a[3]-x),l},i.eI=pm,i.eJ=Xs,i.eK=Qa,i.eL=function(l,r,a,u,d,g,y,x,E,C,R,D,j,V,$,Z){var re=new A(16);return re[0]=l,re[1]=r,re[2]=a,re[3]=u,re[4]=d,re[5]=g,re[6]=y,re[7]=x,re[8]=E,re[9]=C,re[10]=R,re[11]=D,re[12]=j,re[13]=V,re[14]=$,re[15]=Z,re},i.eM=f,i.eN=_h,i.eO=i_,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new mt(1/0,1/0),max:new mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,r=!1){const a=QR(new mt(0,0),new mt(Mt,Mt),l),u=[];if(r&&!N2(a,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!N2(a,d))continue;const g=j9(d.min,d.max,l);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(l){this._setSources(l.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const a=[];for(const u of r.cache.getVisibleCoordinates()){const d=r.cache.getTile(u).buckets[r.layer];d&&d.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(l){const r=l.getFootprints();if(r.length===0)return;const a=l.getOrder(),u=l.getClipMask(),d=l.getClipScope();for(const g of r){if(!g.footprint)continue;const y=QR(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:a,clipMask:u,clipScope:d})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,a)=>r.priority-a.priority||mb(r.min,a.min)||mb(r.max,a.max)||r.order-a.order||r.clipMask-a.clipMask||function(u,d){const g=(y,x)=>y+x;return u.length-d.length||u.reduce(g,"").localeCompare(d.reduce(g,""))}(r.clipScope,a.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let r=0;for(;!l&&r!==this._activeRegions.length;){const a=this._activeRegions[r],u=this._prevRegions[r];l=a.priority!==u.priority||!JR(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!Vo(a.clipScope,u.clipScope),this._activeRegions[r].hiddenByOverlap=u.hiddenByOverlap,++r}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==w_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const r=a=>{const u=this._activeRegions;if(a>=u.length)return a;const d=u[a].priority;for(;a<u.length&&u[a].priority===d;)++a;return a};if(this._sourceIds.length>1){let a=0,u=r(a);for(;a!==u;){let d=a;const g=a;for(;d!==u;){const y=this._activeRegions[d];y.hiddenByOverlap=!1;for(let x=0;x<g;x++){const E=this._activeRegions[x];if(!E.hiddenByOverlap&&y.order===w_&&N2(y,E)&&(y.hiddenByOverlap=eD(y.footprint,y.tileId,E.footprint,E.tileId),y.hiddenByOverlap))break}++d}a=u,u=r(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=l.length-1;r>=0;r--)this._addSource(l[r]);this._computeReplacement()}},i.eQ=w_,i.eR=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,r){const a=new Cc,u=new to,d=[],g=l+1+2,y=r[0]+1,x=r[0]+1+(1+r.length),E=(C,R,D)=>{let j=C===g-1?C-2:C===0?C:C-1;return j+=D?24575:0,[j,R]};for(let C=0;C<g;++C)a.emplaceBack(...E(C,0,!0));for(let C=0;C<y;++C)for(let R=0;R<g;++R)a.emplaceBack(...E(R,C,(R===0||R===g-1)&&!0));for(let C=0;C<r.length;++C){const R=r[C];for(let D=0;D<g;++D)a.emplaceBack(...E(D,R,!0))}for(let C=0;C<r.length;++C){const R=u.length,D=r[C]+1+2,j=new to;for(let Z=0;Z<D-1;Z++){const re=Z===D-2,te=re?g*(x-r.length+C-Z):g;for(let le=0;le<g-1;le++){const ue=Z*g+le;Z===0||re||le===0||le===g-2?(j.emplaceBack(ue+1,ue,ue+te),j.emplaceBack(ue+te,ue+te+1,ue+1)):(u.emplaceBack(ue+1,ue,ue+te),u.emplaceBack(ue+te,ue+te+1,ue+1))}}const V=gi.simpleSegment(0,R,a.length,u.length-R);for(let Z=0;Z<j.uint16.length;Z+=3)u.emplaceBack(j.uint16[Z],j.uint16[Z+1],j.uint16[Z+2]);const $=gi.simpleSegment(0,R,a.length,u.length-R);d.push({withoutSkirts:V,withSkirts:$})}return{vertices:a,indices:u,segments:d}}_createGrid(l){const r=this._fillGridMeshWithLods(xh,p_);this._gridSegments=r.segments,this._gridBuffer=l.createVertexBuffer(r.vertices,wh.members),this._gridIndexBuffer=l.createIndexBuffer(r.indices,!0)}_createPoles(l){const r=new to;for(let y=0;y<=xh;y++)r.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=l.createIndexBuffer(r,!0);const a=new xu,u=new xu,d=new xu,g=new xu;this._poleSegments=[];for(let y=0,x=0;y<ca;y++){const E=360/(1<<y);a.emplaceBack(0,-Go,0,.5,0),u.emplaceBack(0,-Go,0,.5,1),d.emplaceBack(0,-Go,0,.5,.5),g.emplaceBack(0,-Go,0,.5,.5);for(let C=0;C<=xh;C++){let R=C/xh,D=0;const j=vr(0,E,R),[V,$,Z]=bu(i9,o9,j,Go);a.emplaceBack(V,$,Z,R,D),u.emplaceBack(V,$,Z,R,1-D);const re=qr(j);R=.5+.5*Math.sin(re),D=.5+.5*Math.cos(re),d.emplaceBack(V,$,Z,R,D),g.emplaceBack(V,$,Z,R,1-D)}this._poleSegments.push(gi.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,Ra,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,Ra,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(d,Ra,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(g,Ra,!1)}getGridBuffers(l,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.eS=KR,i.eT=ad,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=Ue,i.eW=se,i.eX=function(l,r,a){return l[0]=r[0]/a[0],l[1]=r[1]/a[1],l[2]=r[2]/a[2],l},i.eY=ks,i.eZ=bh,i.e_=lr,i.ea=_b,i.eb=gD,i.ec=Tu,i.ed=sD,i.ee=oD,i.ef=Y,i.eg=function(l,r){if(l===r){var a=r[1],u=r[2],d=r[3],g=r[6],y=r[7],x=r[11];l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=a,l[6]=r[9],l[7]=r[13],l[8]=u,l[9]=g,l[11]=r[14],l[12]=d,l[13]=y,l[14]=x}else l[0]=r[0],l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=r[1],l[5]=r[5],l[6]=r[9],l[7]=r[13],l[8]=r[2],l[9]=r[6],l[10]=r[10],l[11]=r[14],l[12]=r[3],l[13]=r[7],l[14]=r[11],l[15]=r[15];return l},i.eh=jZ,i.ei=Xr,i.ej=s_,i.ek=256,i.el=A2,i.em=Zs,i.en=ae,i.eo=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[4],l[4]=r[5],l[5]=r[6],l[6]=r[8],l[7]=r[9],l[8]=r[10],l},i.ep=xu,i.eq=Ix,i.er=n_,i.es=function(l,r,a,u,d){return ne((l-r)/(a-r)*(d-u)+u,u,d)},i.et=Gs,i.eu=function(l,r){var a=r[0],u=r[1],d=r[2],g=r[3],y=r[4],x=r[5],E=r[6],C=r[7],R=r[8],D=R*y-x*C,j=-R*g+x*E,V=C*g-y*E,$=a*D+u*j+d*V;return $?(l[0]=D*($=1/$),l[1]=(-R*u+d*C)*$,l[2]=(x*u-d*y)*$,l[3]=j*$,l[4]=(R*a-d*E)*$,l[5]=(-x*a+d*g)*$,l[6]=V*$,l[7]=(-C*a+u*E)*$,l[8]=(y*a-u*g)*$,l):null},i.ev=2,i.ew=an,i.ex=Yo,i.ey=tt,i.ez=function(l,r){var a=new A(3);tt(a,r);var u=1/a[0],d=1/a[1],g=1/a[2],y=r[0]*u,x=r[1]*d,E=r[2]*g,C=r[4]*u,R=r[5]*d,D=r[6]*g,j=r[8]*u,V=r[9]*d,$=r[10]*g,Z=y+R+$,re=0;return Z>0?(re=2*Math.sqrt(Z+1),l[3]=.25*re,l[0]=(D-V)/re,l[1]=(j-E)/re,l[2]=(x-C)/re):y>R&&y>$?(re=2*Math.sqrt(1+y-R-$),l[3]=(D-V)/re,l[0]=.25*re,l[1]=(x+C)/re,l[2]=(j+E)/re):R>$?(re=2*Math.sqrt(1+R-y-$),l[3]=(j-E)/re,l[0]=(x+C)/re,l[1]=.25*re,l[2]=(D+V)/re):(re=2*Math.sqrt(1+$-y-R),l[3]=(x-C)/re,l[0]=(j+E)/re,l[1]=(D+V)/re,l[2]=.25*re),l},i.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(r,a)=>String.fromCharCode(+("0x"+a))))},i.f0=function([l,r,a]){const u=Math.hypot(l,r,a),d=Math.atan2(l,a),g=.5*Math.PI-Math.acos(-r/u);return new c(Jo(d),Jo(g))},i.f1=mo,i.f2=J2,i.f3=function(l){const r=l.navigator?l.navigator.userAgent:null;return!!function(a){if(Wi==null){const u=a.navigator?a.navigator.userAgent:null;Wi=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Wi}(l)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(l,r){Hf=l,Wf=r},i.f5=C2,i.f6=bR,i.f7=function(l){const r=[0,0,0],a=U(new Float64Array(16));return J(a,l.pixelMatrix,l.globeMatrix),Nr(r,r,a),new mt(r[0],r[1])},i.f8=function(){const l=C_;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(U2),C_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){xb().acquire(U2)},i.fA=Qb,i.fB=ke,i.fC=function(l){let r=0;if(new Uint32Array(l,0,1)[0]!==DD){const a=new Uint32Array(l,0,7),[,,u,d,g,y]=a;r=a.byteLength+d+g+y+g,(u!==l.byteLength||r>=l.byteLength)&&Ut("Invalid b3dm header information.")}return ND(l,r)},i.fD=function(l,r){const a=nE(l);for(const u of a){for(const d of u.meshes)d7(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(f7(u.lights,r)))}return a},i.fE=qb,i.fF=hn,i.fG=CD,i.fH=Ml,i.fI=Ns,i.fJ=function(l){Ea(),Ua?.then(r=>{r.keys().then(a=>{for(let u=0;u<a.length-l;u++)r.delete(a[u]).catch(d=>Ut(d.message))}).catch(a=>Ut(a.message))}).catch(r=>Ut(r.message))},i.fa=jd,i.fb=function(l,r,a=!1){if(gs===Ns.deferred||gs===Ns.loading||gs===Ns.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Il=go.resolveURL(l),gs=Ns.deferred,qy=r,kp(),a||Vx()},i.fc=function(l){hm=go.resolveURL(l),dm||(dm=new um(xb(),new su)),dm.broadcast("setMeshoptUrl",hm)},i.fd=OD,i.fe=function(l){W2=go.resolveURL(l),dm||(dm=new um(xb(),new su)),dm.broadcast("setDracoUrl",W2)},i.ff=MD,i.fg=P_,i.fh=function(l){const r=Sa();if(!r)return;const a=r.delete(Gf);l&&a.then(()=>l()).catch(l)},i.fi=Xd,i.fj=Yt,i.fk=Eh,i.fl=Vl,i.fm=Kj,i.fn=Yj,i.fo=JD,i.fp=ot,i.fq="hd_road_elevation",i.fr=An,i.fs=Xe,i.ft=wu,i.fu=gE,i.fv=Jd,i.fw=function(l,r,a,u,d,g,y,x=1,E,C,R){l.createArrays(),l.tilePixelRatio=Mt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const D=l.layers[0].layout,j=l.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=x,V.textSizeScaleRange=D.get("text-size-scale-range"),V.iconSizeScaleRange=D.get("icon-size-scale-range");const[$,Z]=V.textSizeScaleRange,[re,te]=V.iconSizeScaleRange;V.textScaleFactor=ne(V.scaleFactor,$,Z),V.iconScaleFactor=ne(V.scaleFactor,re,te);const le=j["text-size"],ue=j["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:De,maxZoom:rt}=l.textSizeData;V.compositeTextSizes=[le.possiblyEvaluate(new ri(De,{worldview:R}),g),le.possiblyEvaluate(new ri(rt,{worldview:R}),g)]}if(l.iconSizeData.kind==="composite"){const{minZoom:De,maxZoom:rt}=l.iconSizeData;V.compositeIconSizes=[ue.possiblyEvaluate(new ri(De,{worldview:R}),g),ue.possiblyEvaluate(new ri(rt,{worldview:R}),g)]}V.layoutTextSize=le.possiblyEvaluate(new ri(y+1,{worldview:R}),g),V.layoutIconSize=ue.possiblyEvaluate(new ri(y+1,{worldview:R}),g),V.textMaxSize=le.possiblyEvaluate(new ri(18,{worldview:R}),g);const fe=D.get("symbol-placement"),we=D.get("text-rotation-alignment")==="map"&&fe!=="point",_e=D.get("text-size");let Ee=!1;const Me=[];for(const De of l.features){const rt=D.get("text-font").evaluate(De,{},g).join(","),Ne=_e.evaluate(De,{},g)*V.textScaleFactor,at=V.layoutTextSize.evaluate(De,{},g)*V.textScaleFactor,ft=V.layoutIconSize.evaluate(De,{},g)*V.iconScaleFactor,pt={horizontal:{},vertical:void 0},xt=De.text;let wt,yt=[0,0];if(xt){const kr=xt.toString(),Vn=D.get("text-letter-spacing").evaluate(De,{},g)*_o,ve=D.get("text-line-height").evaluate(De,{},g)*_o,Te=Hy(kr)?Vn:0,lt=D.get("text-anchor").evaluate(De,{},g),bt=D.get("text-variable-anchor");if(!bt){const Rr=D.get("text-radial-offset").evaluate(De,{},g);if(Rr)yt=kk(lt,[Rr*_o,vE]);else{const Vr=D.get("text-offset").evaluate(De,{},g);yt=[Vr[0]*_o,Vr[1]*_o]}}let kt=we?"center":D.get("text-justify").evaluate(De,{},g);const jt=fe==="point",sr=jt?D.get("text-max-width").evaluate(De,{},g)*_o:1/0,ur=Rr=>{l.allowVerticalPlacement&&Dd(kr)&&(pt.vertical=hE(xt,r,a,d,rt,sr,ve,lt,Rr,Te,yt,Js.vertical,!0,at,Ne,E))};if(!we&&bt){const Rr=kt==="auto"?bt.map(Ur=>xE(Ur)):[kt];let Vr=!1;for(let Ur=0;Ur<Rr.length;Ur++){const Kr=Rr[Ur];if(!pt.horizontal[Kr])if(Vr)pt.horizontal[Kr]=pt.horizontal[0];else{const _r=hE(xt,r,a,d,rt,sr,ve,"center",Kr,Te,yt,Js.horizontal,!1,at,Ne,E);_r&&(pt.horizontal[Kr]=_r,Vr=_r.positionedLines.length===1)}}ur("left")}else{if(kt==="auto"&&(kt=xE(lt)),jt||D.get("text-writing-mode").indexOf("horizontal")>=0||!Dd(kr)){const Rr=hE(xt,r,a,d,rt,sr,ve,lt,kt,Te,yt,Js.horizontal,!1,at,Ne,E);Rr&&(pt.horizontal[kt]=Rr)}ur(jt?"left":kt)}}let _t,st,it,vt,Ot,At,or=!1;const Ft=D.get("icon-text-fit").evaluate(De,{},g);if(De.icon&&De.icon.hasPrimary()){const kr=z_(De.icon,l.iconSizeData,j["icon-size"],g,l.zoom,De,E,V.iconScaleFactor,R);_t=kr.iconPrimary,it=kr.iconSecondary;const Vn=_t.toString();if(st=u.get(Vn),st&&(Ot=D.get("icon-offset").evaluate(De,{},g),At=D.get("icon-anchor").evaluate(De,{},g),wt=Rb(d.get(Vn),it?d.get(it.toString()):void 0,Ot,At),or=st.sdf,l.sdfIcons===void 0?l.sdfIcons=st.sdf:l.sdfIcons!==st.sdf&&Ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==l.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),it){const ve=it.toString();vt=u.get(ve)}}Ee=Ee||!(!De.icon||!De.icon.hasSecondary());const Ht=Nb(pt.horizontal)||pt.vertical;l.iconsInText||(l.iconsInText=!!Ht&&Ht.iconsInText);const Qt=at*V.textScaleFactor/_o,{defaultShapedIcon:Gr,verticallyShapedIcon:Pt}=bZ(l,wt,D,De,g,pt,Qt,Ot,Ft);Ft!=="none"&&wt&&(vk(wt)||xk(wt))&&(Lb(0,st,_t,wt,Gr,Ft,C,u,d),Lb(0,vt,it,wt,Gr,Ft,C,u,d),Pt&&(Lb(0,st,_t,wt,Pt,Ft,C,u,d),Lb(0,vt,it,wt,Pt,Ft,C,u,d))),wt=Gr;const{iconBBox:er,iconVerticalBBox:Pr,textBBox:en,textVerticalBBox:sn}=gZ(l,wt,Pt,D,De,g,ft,Ot,V,d,At,pt,at,yt);Me.push({feature:De,shapedTextOrientations:pt,shapedText:Ht,shapedIcon:wt,iconPrimary:_t,iconSecondary:it,iconOffset:Ot,iconAnchor:At,verticallyShapedIcon:Pt,layoutTextSize:at,layoutIconSize:ft,textOffset:yt,isSDFIcon:or,iconTextFit:Ft,iconCollisionBounds:er,iconVerticalCollisionBounds:Pr,textCollisionBounds:en,textVerticalCollisionBounds:sn})}return{featureData:Me,sizes:V,hasAnySecondaryIcon:Ee,textAlongLine:we,symbolPlacement:fe}},i.fx=Ck,i.fy=function(l,r,a,u,d,g,y,x,E,C){l.iconAtlasPositions=C.iconPositions;const{featureData:R,hasAnySecondaryIcon:D,sizes:j,textAlongLine:V,symbolPlacement:$}=r;for(const Z of R){const{shapedIcon:re,verticallyShapedIcon:te,feature:le,shapedTextOrientations:ue,shapedText:fe,layoutTextSize:we,textOffset:_e,isSDFIcon:Ee,iconPrimary:Me,iconSecondary:De,iconTextFit:rt,iconOffset:Ne,iconCollisionBounds:at,iconVerticalCollisionBounds:ft,textCollisionBounds:pt}=Z;Lk(re,C.iconPositions,Me,De),Lk(te,C.iconPositions,Me,De),xZ(ue,C.iconPositions),vZ(Me,De,C.iconPositions),(fe||re)&&wZ(l,le,ue,re,te,E,j,we,0,_e,Ee,u,d,y,x,D,rt,Ne,V,$,at,ft,pt)}a&&l.generateCollisionDebugBuffers(g,l.collisionBoxArray,j.textScaleFactor)},i.fz=We,i.g=function(l,r){return ou(Object.assign(l,{method:"GET"}),r)},i.h=function(l){return l.indexOf("mapbox:")===0},i.i=function(l){return Jr.API_STYLE_REGEX.test(l)&&!No(l)},i.j=Ri,i.k=Ga,i.l=function(l){return decodeURIComponent(atob(l).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(l,r){return ou(Object.assign(l,{type:"json"}),r)},i.n=Kf,i.o=go,i.p=function(l,r){return ou(Object.assign(l,{method:"POST"}),r)},i.q=qo,i.r=$a,i.s=function(l){try{const r=self[l];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return G2||(G2=new Xd("ImageRasterizer")),G2},i.u=function(){return function l(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=Ut,i.x=NE,i.y=fd,i.z=Ha}),m(["./shared"],function(i){function S(Ue){const ne=Ue?Ue.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function A(Ue){if(typeof Ue=="number"||typeof Ue=="boolean"||typeof Ue=="string"||Ue==null)return JSON.stringify(Ue);if(Array.isArray(Ue)){let ce="[";for(const ge of Ue)ce+=`${A(ge)},`;return`${ce}]`}let ne="{";for(const ce of Object.keys(Ue).sort())ne+=`${ce}:${A(Ue[ce])},`;return`${ne}}`}function I(Ue){let ne="";for(const ce of i.bx)ne+=`/${A(Ue[ce])}`;return ne}class M{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ce){this._layerConfigs={},this._layers={},this.update(ne,[],ce)}update(ne,ce,ge){this._options=ge;for(const Ie of ne)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=i.du(Ie,this.scope,null,this._options)).compileFilter(ge),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of ce)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Oe=function(Ie,je){const Ye={};for(let Xe=0;Xe<Ie.length;Xe++){const Tt=Ie[Xe];let dt=je&&je[Tt.id];dt||(Tt.type==="symbol"?dt=Tt.id:(dt=I(Tt),Tt.type==="line"&&Tt.paint&&function hr(Ut){return typeof Ut=="string"&&Ut==="line-progress"||(Array.isArray(Ut)?Ut.some(hr):!(!Ut||typeof Ut!="object")&&Object.values(Ut).some(hr))}(Tt.paint["line-width"])&&(dt+=`/${A(Tt.paint["line-width"])}`))),je&&(je[Tt.id]=dt);let Xt=Ye[dt];Xt||(Xt=Ye[dt]=[]),Xt.push(Tt)}const ze=[];for(const Xe in Ye)ze.push(Ye[Xe]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const Ie of Oe){const je=Ie.map(Xt=>this._layers[Xt.id]),Ye=je[0];if(Ye.visibility==="none")continue;const ze=Ye.source||"";let Xe=this.familiesBySource[ze];Xe||(Xe=this.familiesBySource[ze]={});const Tt=Ye.sourceLayer||"_geojsonTileLayer";let dt=Xe[Tt];dt||(dt=Xe[Tt]=[]),dt.push(je)}}}const L=1*i.fl;class z{constructor(ne){const ce={},ge=[];for(const Ye in ne){const ze=ne[Ye],Xe=ce[Ye]={};for(const Tt in ze.glyphs){const dt=ze.glyphs[+Tt];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const Xt=dt.metrics.localGlyph?L:1,hr={x:0,y:0,w:dt.bitmap.width+2*Xt,h:dt.bitmap.height+2*Xt};ge.push(hr),Xe[Tt]=hr}}const{w:Oe,h:Ie}=i.G(ge),je=new i.fk({width:Oe||1,height:Ie||1});for(const Ye in ne){const ze=ne[Ye];for(const Xe in ze.glyphs){const Tt=ze.glyphs[+Xe];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const dt=ce[Ye][Xe],Xt=Tt.metrics.localGlyph?L:1;i.fk.copy(Tt.bitmap,je,{x:0,y:0},{x:dt.x+Xt,y:dt.y+Xt},Tt.bitmap)}}this.image=je,this.positions=ce}}function G(Ue,ne,ce){Ue[ne]?ce&&(Ue[ne].center=ce):Ue[ne]={floorIds:new Set,center:ce||[0,0],floors:{}}}function F(Ue,ne,ce,ge){for(const Oe of ne)G(Ue,Oe),Ue[Oe].floors[ce]=ge,Ue[Oe].floorIds.add(ce)}function U(Ue){return{id:Ue.properties.id.toString(),center:Ue.properties.center.toString().split(";").map(Number)}}function K(Ue){return{id:Ue.properties.id.toString(),isDefault:!!Ue.properties.is_default&&Ue.properties.is_default,connections:Ue.properties.connected_floor_ids?new Set(Ue.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ue.properties.conflicted_floor_ids?new Set(Ue.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ue.properties.building_ids?new Set(Ue.properties.building_ids.toString().split(";")):new Set,name:Ue.properties.name.toString(),zIndex:Ue.properties.z_index}}function J(Ue,ne){return ne.every(ce=>Ue.properties&&Ue.properties[ce]!=null)}function X(Ue){return J(Ue,["type","id","name"])&&Ue.properties.type==="building"}function ie(Ue){return J(Ue,["type","id","name","z_index"])&&Ue.properties.type==="floor"}i.fj(z,"GlyphAtlas");class Q{constructor(ne){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,ce,ge,Oe,Ie,je){this.status="parsing",this.data=ne,this.collisionBoxArray=new i.b3;const Ye=new i.fm(Object.keys(ne.layers).sort()),ze=new i.fn(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Xe={},Tt=new i.fo(256,256),dt={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Tt,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const zr=this.indoor.indoorState.activeFloorsVisible,jr=function(Dr,hn,Ai){const Wi=function(xi,mn){if(!xi)return i.w("No source layers defined in indoor specification"),mn;if(xi.size===0)return mn;const bi=xi.difference(mn);for(const Jn of bi)i.w(`Missing source layer required in indoor specification: ${Jn}`);return mn.intersection(mn)}(hn.sourceLayers,new Set(Object.keys(Dr.layers))),Oi=hn.indoorState,Ji=function(xi,mn,bi,Jn){const Jr=new Set,Ri=new Set,No=new Set,$o=new Map,Ts={},tu=To=>{const Hs=$o.get(To)||new Set;for(const Qo of Jr)if(($o.get(Qo)||new Set).has(To)||Hs.has(Qo))return!0;return!1};for(const To of mn){const Hs=xi.layers[To];if(Hs)for(let Qo=0;Qo<Hs.length;Qo++){const $a=Hs.feature(Qo);if(X($a)){const{id:go,center:ru}=U($a);G(Ts,go,ru),Jr.add(go)}else if(ie($a)){const{id:go,isDefault:ru,connections:Yu,conflicts:Gf,buildings:Hf,name:Wf,zIndex:ld}=K($a);F(Ts,Hf,go,{name:Wf,zIndex:ld}),$o.set(go,Gf),(go===Jn||Yu.has(Jn))&&Jr.add(go),Ri.add(go),ru&&No.add(go)}}else i.w(`indoor source layer not found: ${To}`)}if(bi)for(const To of bi)Ri.has(To)&&(tu(To)||Jr.add(To));for(const To of No)Jr.has(To)||tu(To)||Jr.add(To);return{buildings:Ts,activeFloors:Jr}}(Dr,Wi,Oi.lastActiveFloors,Oi.selectedFloorId);return Ai.send("setIndoorData",Ji),Ji}(ne,this.indoor,Ie);dt.activeFloors=zr?jr.activeFloors:void 0}const Xt=[],hr=ce.familiesBySource[this.source];for(const zr in hr){const jr=ne.layers[zr];if(!jr)continue;let Dr=!1,hn=!1,Ai=!1;for(const mn of hr[zr])mn[0].type==="symbol"?Dr=!0:hn=!0,mn[0].is3D()&&mn[0].type!=="model"&&(Ai=!0);if(this.extraShadowCaster&&!Ai||this.isSymbolTile===!0&&!Dr||this.isSymbolTile===!1&&!hn)continue;jr.version===1&&i.w(`Vector tile source "${this.source}" layer "${zr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wi=Ye.encode(zr),Oi=[],Ji=this.localizableLayerIds&&this.localizableLayerIds.has(zr);let xi=!1;for(let mn=0,bi=0;mn<jr.length;mn++){const Jn=jr.feature(mn),Jr=ze.getId(Jn,zr),Ri=Jn.properties?Jn.properties.worldview:null;if(Ji&&this.worldview&&typeof Ri=="string")if(Ri==="all")Jn.properties.$localized=!0;else{if(!Ri.split(",").includes(this.worldview))continue;Jn.properties.$localized=!0,Jn.properties.worldview=this.worldview}!xi&&Jn.properties&&Jn.properties.hasOwnProperty(i.fp)&&(xi=!0),Oi.push({feature:Jn,id:Jr,index:bi,sourceLayerIndex:Wi}),bi++}xi&&!dt.elevationFeatures&&ne.layers.hasOwnProperty(i.fq)&&(dt.elevationFeatures=i.fr.parseFrom(ne.layers[i.fq],this.canonical));for(const mn of hr[zr]){const bi=mn[0];if(this.extraShadowCaster&&(!bi.is3D()||bi.type==="model")||this.isSymbolTile!==void 0&&bi.type==="symbol"!==this.isSymbolTile||bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility==="none")continue;ae(mn,this.zoom,dt.brightness,ge,this.worldview);const Jn=Xe[bi.id]=bi.createBucket({index:ze.bucketLayerIDs.length,layers:mn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Oe,worldview:this.worldview,localizable:Ji});ze.bucketLayerIDs.push(mn.map(Ri=>i.B(Ri.id,Ri.scope)));let Jr=Jn.prepare?Jn.prepare():null;Jr!=null?(Jr=Jr.then(()=>Jn.populate(Oi,dt,this.tileID.canonical,this.tileTransform)),Xt.push(Jr)):Jn.populate(Oi,dt,this.tileID.canonical,this.tileTransform)}}const Ut=()=>{let zr,jr,Dr,hn,Ai,Wi;Tt.trim();const Oi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ji=()=>{if(zr)return this.status="done",je(zr);if(this.extraShadowCaster)this.status="done",je(null,{buckets:Object.values(Xe).filter(mn=>!mn.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:dt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(jr&&Dr&&hn){const mn=new z(jr),bi=new Map;for(const[Ri,No]of Dr.entries()){const{imagePosition:$o}=i.fu(Ri,No,i.fv);bi.set(Ri,$o)}const Jn={};for(const Ri in Xe){const No=Xe[Ri];No instanceof i.b4&&(ae(No.layers,this.zoom,dt.brightness,ge,this.worldview),Jn[Ri]=i.fw(No,jr,mn.positions,Dr,bi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ai,this.worldview))}const Jr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ie,Dr,Ai,()=>{Jr.iconsPending=!1,xi(Jn,mn,Jr)}),this.rasterizeIfNeeded(Ie,hn,Wi,()=>{Jr.patternsPending=!1,xi(Jn,mn,Jr)})}},xi=(mn,bi,Jn,Jr)=>{if(Jn.iconsPending||Jn.patternsPending)return;const Ri=new i.fx(Dr,hn,this.lut);for(const No in Xe){const $o=Xe[No];if(No in mn)i.fy($o,mn[No],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Dr,Ri);else if($o.hasPattern&&($o instanceof i.ba||$o instanceof i.bb||$o instanceof i.ea)){ae($o.layers,this.zoom,dt.brightness,ge,this.worldview);const Ts=Object.fromEntries(Ri.patternPositions);$o.addFeatures(dt,this.tileID.canonical,Ts,ge,this.tileTransform,this.brightness)}}this.status="done",je(null,{buckets:Object.values(Xe).filter(No=>!No.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,lineAtlas:Tt,imageAtlas:Ri,brightness:dt.brightness})};if(!this.extraShadowCaster){const mn=i.fs(dt.glyphDependencies,Jr=>Object.keys(Jr).map(Number));Object.keys(mn).length?Ie.send("getGlyphs",{uid:this.uid,stacks:mn},(Jr,Ri)=>{zr||(zr=Jr,jr=Ri,Ji())},void 0,!1,Oi):jr={};const bi=Array.from(dt.iconDependencies.keys()).map(Jr=>i.I.parse(Jr));bi.length?Ie.send("getImages",{images:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Jr,Ri)=>{zr||(zr=Jr,Dr=new Map,Ai=this.updateImageMapAndGetImageTaskQueue(Dr,Ri,dt.iconDependencies),Ji())},void 0,!1,Oi):(Dr=new Map,Ai=new Map);const Jn=Array.from(dt.patternDependencies.keys()).map(Jr=>i.I.parse(Jr));Jn.length?Ie.send("getImages",{images:Jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Jr,Ri)=>{zr||(zr=Jr,hn=new Map,Wi=this.updateImageMapAndGetImageTaskQueue(hn,Ri,dt.patternDependencies),Ji())},void 0,!1,Oi):(hn=new Map,Wi=new Map)}if(dt.elevationFeatures&&dt.elevationFeatures.length>0){const mn=[];for(const Jn of Object.values(Xe))if(Jn instanceof i.bb){const Jr=Jn.getUnevaluatedPortalGraph();Jr&&mn.push(Jr)}const bi=i.ft.evaluate(mn);for(const Jn of Object.values(Xe))if(Jn instanceof i.bb){const Jr=ne.layers[Ye.decode(Jn.sourceLayerIndex)];Jn.setEvaluatedPortalGraph(bi,Jr,this.tileID.canonical,dt.availableImages,dt.brightness)}}Ji()};Xt.length>0?Promise.allSettled(Xt).then(Ut).catch(je):Ut()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,ce,ge,Oe){Array.from(ce.values()).some(Ie=>Ie.usvg)?this.rasterize(ne,ce,ge,Oe):Oe()}updateImageMapAndGetImageTaskQueue(ne,ce,ge){const Oe=new Map;for(const Ie of ce.keys()){const je=ge.get(Ie)||[];for(const Ye of je){const ze=Ye.toString(),Xe=ce.get(Ye.id.toString());Xe.usvg?Oe.has(ze)||(Oe.set(ze,Ye),ne.set(ze,Object.assign({},Xe))):ne.set(ze,Xe)}}return Oe}rasterize(ne,ce,ge,Oe){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ge},(Ie,je)=>{if(!Ie)for(const[Ye,ze]of je.entries()){const Xe=Object.assign(ce.get(Ye),{data:ze});ce.set(Ye,Xe)}Oe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ae(Ue,ne,ce,ge,Oe){const Ie=new i.ac(ne,{brightness:ce,worldview:Oe});for(const je of Ue)je.recalculate(Ie,ge)}class pe extends i.E{constructor(ne,ce,ge,Oe,Ie,je,Ye){super(),this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.availableModels=Oe,this.loadVectorData=je||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ne.scheduler),this.isSpriteLoaded=Ie,this.scheduler=ne.scheduler,this.brightness=Ye}loadTile(ne,ce){const ge=ne.uid,Oe=ne&&ne.request,Ie=Oe&&Oe.collectResourceTiming,je=this.loading[ge]=new Q(ne);je.abort=this.loadVectorData(ne,(Ye,ze)=>{const Xe=!this.loading[ge];if(delete this.loading[ge],je.cancelRasterize(),Xe||Ye||!ze)return je.status="done",Xe||(this.loaded[ge]=je),ce(Ye);const Tt=ze.rawData,dt={},Xt=i.aM(ze.responseHeaders);Xt&&Xt.expires&&(dt.expires=Xt.expires),Xt&&Xt.cacheControl&&(dt.cacheControl=Xt.cacheControl),je.vectorTile=ze.vectorTile||new i.fz(new i.bt(Tt));const hr=()=>{je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ut,zr)=>{if(Ut||!zr)return ce(Ut);const jr={};if(Ie){const Dr=S(Oe);Dr.length>0&&(jr.resourceTiming=JSON.parse(JSON.stringify(Dr)))}ce(null,Object.assign({rawTileData:Tt.slice(0),responseHeaders:ze.responseHeaders},zr,dt,jr))})};this.isSpriteLoaded?hr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(hr,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):hr()}),this.loaded=this.loaded||{},this.loaded[ge]=je})}reloadTile(ne,ce){const ge=this.loaded,Oe=ne.uid;if(ge&&ge[Oe]){const Ie=ge[Oe];Ie.updateParameters(ne);const je=(Ye,ze)=>{const Xe=Ie.reloadCallback;Xe&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),ce(Ye,ze)};Ie.status==="parsing"?Ie.reloadCallback=je:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,je):je())}else ce(null,void 0)}abortTile(ne,ce){const ge=ne.uid,Oe=this.loading[ge];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[ge]),ce()}removeTile(ne,ce){const ge=this.loaded,Oe=ne.uid;ge&&ge[Oe]&&delete ge[Oe],ce()}}class Pe{loadTile(ne,ce){const{uid:ge,encoding:Oe,rawImageData:Ie,padding:je}=ne,Ye=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,je):Ie;ce(null,new i.fA(ge,Ye,Oe,je<1))}reloadTile(ne,ce){ce(null,null)}abortTile(ne,ce){ce()}removeTile(ne,ce){ce()}getImageData(ne,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ge=this.offscreenCanvasContext.getImageData(-ce,-ce,ne.width+2*ce,ne.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}i.bs.setPbf(i.bt);class Fe{constructor(ne){this._mrt=new i.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ce){const ge=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ge.parseHeader(ne),this._isHeaderLoaded=!0;const Oe=[];for(const Ie in ge.layers){const je=ge.getLayer(Ie),Ye=je.getDataRange(je.getBandList()),ze=ge.createDecodingTask(Ye),Xe=ne.slice(Ye.firstByte,Ye.lastByte+1),Tt=i.bs.performDecoding(Xe,ze).then(dt=>ze.complete(null,dt)).catch(dt=>ze.complete(dt,null));Oe.push(Tt)}Promise.allSettled(Oe).then(()=>ce(null,ge)).catch(Ie=>ce(Ie))}catch(Oe){ce(Oe)}}}class tt{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ce){const ge=ne.uid,Oe=ne.request,Ie=this.loading[ge]=new Fe(ne),{cancel:je}=i.bu(Oe,(Ye,ze,Xe)=>{const Tt=!this.loading[ge];if(delete this.loading[ge],Tt||Ye||!ze)return Ie.status="done",Tt||(this.loaded[ge]=Ie),ce(Ye);Ie.parse(ze,(dt,Xt)=>{if(dt||!Xt)return ce(dt);ce(null,Xt,Xe)}),this.loaded[ge]=Ie});Ie.abort=je}reloadTile(ne,ce){ce(null,void 0)}abortTile(ne,ce){const ge=ne.uid,Oe=this.loading[ge];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[ge]),ce()}removeTile(ne,ce){const ge=ne.uid;this.loaded[ge]&&delete this.loaded[ge],ce()}decodeRasterArray(ne,ce){i.bs.performDecoding(ne.buffer,ne.task).then(ge=>ce(null,ge)).catch(ge=>ce(ge))}}const Be=i.fB.prototype.toGeoJSON;class Ge{constructor(ne){this._feature=ne,this.extent=i.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ce of this._feature.geometry)ne.push([new i.P(ce[0],ce[1])]);return ne}{const ne=[];for(const ce of this._feature.geometry){const ge=[];for(const Oe of ce)ge.push(new i.P(Oe[0],Oe[1]));ne.push(ge)}return ne}}toGeoJSON(ne,ce,ge){return Be.call(this,ne,ce,ge)}}class Qe{constructor(ne,ce){this.name=ne,this.extent=i.al,this.length=ce.length,this._jsonFeatures=ce}feature(ne){return new Ge(this._jsonFeatures[ne])}}class Ke{constructor(ne){this.layers={},this.extent=i.al;for(const ce of Object.keys(ne))this.layers[ce]=new Qe(ce,ne[ce])}}const ct=64/4096,He=128;class qe{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ce){for(const ge of ne){const Oe=ge.id;if(Oe==null)continue;let Ie=this.features.get(Oe);Ie&&this.updateCache(Ie,ce),ge.geometry?(Ie=nt(ge),this.updateCache(Ie,ce),this.features.set(Oe,Ie)):this.features.delete(Oe),this.updateCache(Ie,ce)}}updateCache(ne,ce){for(const{canonical:ge,uid:Oe}of Object.values(ce)){const{z:Ie,x:je,y:Ye}=ge;ut(ne,Math.pow(2,Ie),je,Ye)&&delete ce[Oe]}}getTile(ne,ce,ge){const Oe=Math.pow(2,ne),Ie=[];for(const je of this.features.values())ut(je,Oe,ce,ge)&&Ie.push(Vt(je,Oe,ce,ge));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function ut({minX:Ue,minY:ne,maxX:ce,maxY:ge},Oe,Ie,je){return Ue<(Ie+1+ct)/Oe&&ne<(je+1+ct)/Oe&&ce>(Ie-ct)/Oe&&ge>(je-ct)/Oe}function nt(Ue){const{id:ne,geometry:ce,properties:ge}=Ue;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:Ie}=ce,je={id:ne,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=je.geometry;if(Oe==="Point")Kt(Ie,Ye,je);else if(Oe==="MultiPoint")for(const ze of Ie)Kt(ze,Ye,je);else if(Oe==="LineString")je.type=2,cr(Ie,Ye,je);else if(Oe==="MultiLineString")je.type=2,Bt(Ie,Ye,je);else if(Oe==="Polygon")je.type=3,Bt(Ie,Ye,je,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");je.type=3;for(const ze of Ie)Bt(ze,Ye,je,!0)}return je}function Kt([Ue,ne],ce,ge){const Oe=i.aF(Ue);let Ie=i.aJ(ne);Ie=Ie<0?0:Ie>1?1:Ie,ce.push(Oe,Ie),ge.minX=Math.min(ge.minX,Oe),ge.minY=Math.min(ge.minY,Ie),ge.maxX=Math.max(ge.maxX,Oe),ge.maxY=Math.max(ge.maxY,Ie)}function cr(Ue,ne,ce,ge=!1,Oe=!1){const Ie=[];for(const je of Ue)Kt(je,Ie,ce);ne.push(Ie),ge&&function(je,Ye){let ze=0;for(let Xe=0,Tt=je.length,dt=Tt-2;Xe<Tt;dt=Xe,Xe+=2)ze+=(je[Xe]-je[dt])*(je[Xe+1]+je[dt+1]);if(ze>0===Ye)for(let Xe=0,Tt=je.length;Xe<Tt/2;Xe+=2){const dt=je[Xe],Xt=je[Xe+1];je[Xe]=je[Tt-2-Xe],je[Xe+1]=je[Tt-1-Xe],je[Tt-2-Xe]=dt,je[Tt-1-Xe]=Xt}}(Ie,Oe)}function Bt(Ue,ne,ce,ge=!1){for(let Oe=0;Oe<Ue.length;Oe++)cr(Ue[Oe],ne,ce,ge,Oe===0)}function Vt(Ue,ne,ce,ge){const{id:Oe,type:Ie,geometry:je,tags:Ye}=Ue,ze=[];if(Ie===1)(function(Xe,Tt,dt,Xt,hr){for(let Ut=0;Ut<Xe.length;Ut+=2){const zr=Math.round(i.al*(Xe[Ut+0]*Tt-dt)),jr=Math.round(i.al*(Xe[Ut+1]*Tt-Xt));hr.push([zr,jr])}})(je,ne,ce,ge,ze);else if(Ie===2)for(const Xe of je)xr(Xe,ne,ce,ge,ze);else if(Ie===3)for(const Xe of je)nn(Xe,ne,ce,ge,ze);return{id:Oe,type:Ie,geometry:ze,tags:Ye}}function xr(Ue,ne,ce,ge,Oe){const Ie=-He,je=i.al+He;let Ye;for(let ze=0;ze<Ue.length-2;ze+=2){let Xe=Math.round(i.al*(Ue[ze+0]*ne-ce)),Tt=Math.round(i.al*(Ue[ze+1]*ne-ge)),dt=Math.round(i.al*(Ue[ze+2]*ne-ce)),Xt=Math.round(i.al*(Ue[ze+3]*ne-ge));const hr=dt-Xe,Ut=Xt-Tt;Xe<Ie&&dt<Ie||(Xe<Ie?(Tt+=Math.round(Ut*((Ie-Xe)/hr)),Xe=Ie):dt<Ie&&(Xt=Tt+Math.round(Ut*((Ie-Xe)/hr)),dt=Ie),Tt<Ie&&Xt<Ie||(Tt<Ie?(Xe+=Math.round(hr*((Ie-Tt)/Ut)),Tt=Ie):Xt<Ie&&(dt=Xe+Math.round(hr*((Ie-Tt)/Ut)),Xt=Ie),Xe>=je&&dt>=je||(Xe>=je?(Tt+=Math.round(Ut*((je-Xe)/hr)),Xe=je):dt>=je&&(Xt=Tt+Math.round(Ut*((je-Xe)/hr)),dt=je),Tt>=je&&Xt>=je||(Tt>=je?(Xe+=Math.round(hr*((je-Tt)/Ut)),Tt=je):Xt>=je&&(dt=Xe+Math.round(hr*((je-Tt)/Ut)),Xt=je),Ye&&Xe===Ye[Ye.length-1][0]&&Tt===Ye[Ye.length-1][1]||(Ye=[[Xe,Tt]],Oe.push(Ye)),Ye.push([dt,Xt])))))}}function nn(Ue,ne,ce,ge,Oe){const Ie=(ce-ct)/ne,je=(ge-ct)/ne,Ye=(ce+1+ct)/ne,ze=(ge+1+ct)/ne;function Xe(Xt,hr){let Ut=0;return Xt<Ie?Ut|=1:Xt>Ye&&(Ut|=2),hr<je?Ut|=4:hr>ze&&(Ut|=8),Ut}let Tt=[];for(let Xt=1;Xt<=8;Xt*=2){let hr=Ue[Ue.length-2],Ut=Ue[Ue.length-1],zr=!(Xe(hr,Ut)&Xt);for(let jr=0;jr<Ue.length;jr+=2){const Dr=Ue[jr],hn=Ue[jr+1],Ai=!(Xe(Dr,hn)&Xt);Ai!==zr&&(8&Xt?Tt.push(hr+(Dr-hr)*(ze-Ut)/(hn-Ut),ze):4&Xt?Tt.push(hr+(Dr-hr)*(je-Ut)/(hn-Ut),je):2&Xt?Tt.push(Ye,Ut+(hn-Ut)*(Ye-hr)/(Dr-hr)):1&Xt&&Tt.push(Ie,Ut+(hn-Ut)*(Ie-hr)/(Dr-hr))),Ai&&Tt.push(Dr,hn),hr=Dr,Ut=hn,zr=Ai}if(!(Ue=Tt).length||Xt===8)break;Tt=[]}const dt=[];for(let Xt=0;Xt<Tt.length;Xt+=2)dt.push([Math.round(i.al*(Tt[Xt]*ne-ce)),Math.round(i.al*(Tt[Xt+1]*ne-ge))]);Oe.push(dt)}function Hn({name:Ue,features:ne},ce){ce.writeStringField(1,Ue),ce.writeVarintField(5,i.al);const ge=new Map,Oe=new Map,Ie={keys:ge,values:Oe,feature:null};for(const je of ne)Ie.feature=je,ce.writeMessage(2,lr,Ie);for(const je of ge.keys())ce.writeStringField(3,je);for(const je of Oe.keys())ce.writeMessage(4,Nt,je)}function lr(Ue,ne){const ce=Ue.feature;ce.id!==void 0&&Number.isSafeInteger(+ce.id)&&ne.writeVarintField(1,+ce.id),ce.tags&&ne.writeMessage(2,an,Ue),ne.writeVarintField(3,ce.type),ne.writeMessage(4,pr,ce)}function an({keys:Ue,values:ne,feature:ce},ge){for(const Oe of Object.keys(ce.tags)){let Ie=ce.tags[Oe];if(Ie===null)continue;let je=Ue.get(Oe);je===void 0&&(je=Ue.size,Ue.set(Oe,je)),ge.writeVarint(je);const Ye=typeof Ie;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Ie=JSON.stringify(Ie));let ze=ne.get(Ie);ze===void 0&&(ze=ne.size,ne.set(Ie,ze)),ge.writeVarint(ze)}}function Lt(Ue,ne){return(ne<<3)+(7&Ue)}function nr(Ue){return Ue<<1^Ue>>31}function pr(Ue,ne){const{geometry:ce,type:ge}=Ue;let Oe=0,Ie=0;if(ge===1){ne.writeVarint(Lt(1,ce.length));for(const je of ce){const Ye=je[0]-Oe,ze=je[1]-Ie;ne.writeVarint(nr(Ye)),ne.writeVarint(nr(ze)),Oe+=Ye,Ie+=ze}}else for(const je of ce){ne.writeVarint(Lt(1,1));const Ye=je.length-(ge===3?1:0);for(let ze=0;ze<Ye;ze++){ze===1&&ne.writeVarint(Lt(2,Ye-1));const Xe=je[ze][0]-Oe,Tt=je[ze][1]-Ie;ne.writeVarint(nr(Xe)),ne.writeVarint(nr(Tt)),Oe+=Xe,Ie+=Tt}ge===3&&ne.writeVarint(Lt(7,1))}}function Nt(Ue,ne){const ce=typeof Ue;ce==="string"?ne.writeStringField(1,Ue):ce==="boolean"?ne.writeBooleanField(7,Ue):ce==="number"&&(Ue%1!=0?ne.writeDoubleField(3,Ue):Ue<0?ne.writeSVarintField(6,Ue):ne.writeVarintField(5,Ue))}const Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},un=Math.fround||(ci=new Float32Array(1),Ue=>(ci[0]=+Ue,ci[0]));var ci;const Un=3,zn=5,Kn=6;class ks{constructor(ne){this.options=Object.assign(Object.create(Nr),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ge,maxZoom:Oe}=this.options;ce&&console.time("total time");const Ie=`prepare ${ne.length} points`;ce&&console.time(Ie),this.points=ne;const je=[];for(let ze=0;ze<ne.length;ze++){const Xe=ne[ze];if(!Xe.geometry)continue;const[Tt,dt]=Xe.geometry.coordinates,Xt=un(bo(Tt)),hr=un(mo(dt));je.push(Xt,hr,1/0,ze,-1,1),this.options.reduce&&je.push(0)}let Ye=this.trees[Oe+1]=this._createTree(je);ce&&console.timeEnd(Ie);for(let ze=Oe;ze>=ge;ze--){const Xe=+Date.now();Ye=this.trees[ze]=this._createTree(this._cluster(Ye,ze)),ce&&console.log("z%d: %d clusters in %dms",ze,Ye.numItems,+Date.now()-Xe)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ge=((ne[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ne[1]));let Ie=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Ie=180;else if(ge>Ie){const dt=this.getClusters([ge,Oe,180,je],ce),Xt=this.getClusters([-180,Oe,Ie,je],ce);return dt.concat(Xt)}const Ye=this.trees[this._limitZoom(ce)],ze=Ye.range(bo(ge),mo(je),bo(Ie),mo(Oe)),Xe=Ye.data,Tt=[];for(const dt of ze){const Xt=this.stride*dt;Tt.push(Xe[Xt+zn]>1?ds(Xe,Xt,this.clusterProps):this.points[Xe[Xt+Un]])}return Tt}getChildren(ne){const ce=this._getOriginId(ne),ge=this._getOriginZoom(ne),Oe="No cluster with the specified id.",Ie=this.trees[ge];if(!Ie)throw new Error(Oe);const je=Ie.data;if(ce*this.stride>=je.length)throw new Error(Oe);const Ye=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Ie.within(je[ce*this.stride],je[ce*this.stride+1],Ye),Xe=[];for(const Tt of ze){const dt=Tt*this.stride;je[dt+4]===ne&&Xe.push(je[dt+zn]>1?ds(je,dt,this.clusterProps):this.points[je[dt+Un]])}if(Xe.length===0)throw new Error(Oe);return Xe}getLeaves(ne,ce,ge){const Oe=[];return this._appendLeaves(Oe,ne,ce=ce||10,ge=ge||0,0),Oe}getTile(ne,ce,ge){const Oe=this.trees[this._limitZoom(ne)],Ie=Math.pow(2,ne),{extent:je,radius:Ye}=this.options,ze=Ye/je,Xe=(ge-ze)/Ie,Tt=(ge+1+ze)/Ie,dt={features:[]};return this._addTileFeatures(Oe.range((ce-ze)/Ie,Xe,(ce+1+ze)/Ie,Tt),Oe.data,ce,ge,Ie,dt),ce===0&&this._addTileFeatures(Oe.range(1-ze/Ie,Xe,1,Tt),Oe.data,Ie,ge,Ie,dt),ce===Ie-1&&this._addTileFeatures(Oe.range(0,Xe,ze/Ie,Tt),Oe.data,-1,ge,Ie,dt),dt.features.length?dt:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(ne);if(ce++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ge,Oe,Ie){const je=this.getChildren(ce);for(const Ye of je){const ze=Ye.properties;if(ze&&ze.cluster?Ie+ze.point_count<=Oe?Ie+=ze.point_count:Ie=this._appendLeaves(ne,ze.cluster_id,ge,Oe,Ie):Ie<Oe?Ie++:ne.push(Ye),ne.length===ge)break}return Ie}_createTree(ne){const ce=new i.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)ce.add(ne[ge],ne[ge+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ge,Oe,Ie,je){for(const Ye of ne){const ze=Ye*this.stride,Xe=ce[ze+zn]>1;let Tt,dt,Xt;if(Xe)Tt=ao(ce,ze,this.clusterProps),dt=ce[ze],Xt=ce[ze+1];else{const zr=this.points[ce[ze+Un]];Tt=zr.properties;const[jr,Dr]=zr.geometry.coordinates;dt=bo(jr),Xt=mo(Dr)}const hr={type:1,geometry:[[Math.round(this.options.extent*(dt*Ie-ge)),Math.round(this.options.extent*(Xt*Ie-Oe))]],tags:Tt};let Ut;Ut=Xe||this.options.generateId?ce[ze+Un]:this.points[ce[ze+Un]].id,Ut!==void 0&&(hr.id=Ut),je.features.push(hr)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ge,extent:Oe,reduce:Ie,minPoints:je}=this.options,Ye=ge/(Oe*Math.pow(2,ce)),ze=ne.data,Xe=[],Tt=this.stride;for(let dt=0;dt<ze.length;dt+=Tt){if(ze[dt+2]<=ce)continue;ze[dt+2]=ce;const Xt=ze[dt],hr=ze[dt+1],Ut=ne.within(ze[dt],ze[dt+1],Ye),zr=ze[dt+zn];let jr=zr;for(const Dr of Ut){const hn=Dr*Tt;ze[hn+2]>ce&&(jr+=ze[hn+zn])}if(jr>zr&&jr>=je){let Dr,hn=Xt*zr,Ai=hr*zr,Wi=-1;const Oi=(dt/Tt<<5)+(ce+1)+this.points.length;for(const Ji of Ut){const xi=Ji*Tt;if(ze[xi+2]<=ce)continue;ze[xi+2]=ce;const mn=ze[xi+zn];hn+=ze[xi]*mn,Ai+=ze[xi+1]*mn,ze[xi+4]=Oi,Ie&&(Dr||(Dr=this._map(ze,dt,!0),Wi=this.clusterProps.length,this.clusterProps.push(Dr)),Ie(Dr,this._map(ze,xi)))}ze[dt+4]=Oi,Xe.push(hn/jr,Ai/jr,1/0,Oi,-1,jr),Ie&&Xe.push(Wi)}else{for(let Dr=0;Dr<Tt;Dr++)Xe.push(ze[dt+Dr]);if(jr>1)for(const Dr of Ut){const hn=Dr*Tt;if(!(ze[hn+2]<=ce)){ze[hn+2]=ce;for(let Ai=0;Ai<Tt;Ai++)Xe.push(ze[hn+Ai])}}}}return Xe}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ge){if(ne[ce+zn]>1){const je=this.clusterProps[ne[ce+Kn]];return ge?Object.assign({},je):je}const Oe=this.points[ne[ce+Un]].properties,Ie=this.options.map(Oe);return ge&&Ie===Oe?Object.assign({},Ie):Ie}}function ds(Ue,ne,ce){return{type:"Feature",id:Ue[ne+Un],properties:ao(Ue,ne,ce),geometry:{type:"Point",coordinates:[(ge=Ue[ne],360*(ge-.5)),Hi(Ue[ne+1])]}};var ge}function ao(Ue,ne,ce){const ge=Ue[ne+zn],Oe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ie=Ue[ne+Kn],je=Ie===-1?{}:Object.assign({},ce[Ie]);return Object.assign(je,{cluster:!0,cluster_id:Ue[ne+Un],point_count:ge,point_count_abbreviated:Oe})}function bo(Ue){return Ue/360+.5}function mo(Ue){const ne=Math.sin(Ue*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Hi(Ue){const ne=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Yo(Ue,ne,ce,ge){let Oe=ge;const Ie=ne+(ce-ne>>1);let je,Ye=ce-ne;const ze=Ue[ne],Xe=Ue[ne+1],Tt=Ue[ce],dt=Ue[ce+1];for(let Xt=ne+3;Xt<ce;Xt+=3){const hr=wo(Ue[Xt],Ue[Xt+1],ze,Xe,Tt,dt);if(hr>Oe)je=Xt,Oe=hr;else if(hr===Oe){const Ut=Math.abs(Xt-Ie);Ut<Ye&&(je=Xt,Ye=Ut)}}Oe>ge&&(je-ne>3&&Yo(Ue,ne,je,ge),Ue[je+2]=Oe,ce-je>3&&Yo(Ue,je,ce,ge))}function wo(Ue,ne,ce,ge,Oe,Ie){let je=Oe-ce,Ye=Ie-ge;if(je!==0||Ye!==0){const ze=((Ue-ce)*je+(ne-ge)*Ye)/(je*je+Ye*Ye);ze>1?(ce=Oe,ge=Ie):ze>0&&(ce+=je*ze,ge+=Ye*ze)}return je=Ue-ce,Ye=ne-ge,je*je+Ye*Ye}function Po(Ue,ne,ce,ge){const Oe={id:Ue??null,type:ne,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Gs(Oe,ce);else if(ne==="Polygon")Gs(Oe,ce[0]);else if(ne==="MultiLineString")for(const Ie of ce)Gs(Oe,Ie);else if(ne==="MultiPolygon")for(const Ie of ce)Gs(Oe,Ie[0]);return Oe}function Gs(Ue,ne){for(let ce=0;ce<ne.length;ce+=3)Ue.minX=Math.min(Ue.minX,ne[ce]),Ue.minY=Math.min(Ue.minY,ne[ce+1]),Ue.maxX=Math.max(Ue.maxX,ne[ce]),Ue.maxY=Math.max(Ue.maxY,ne[ce+1])}function Co(Ue,ne,ce,ge){if(!ne.geometry)return;const Oe=ne.geometry.coordinates;if(Oe&&Oe.length===0)return;const Ie=ne.geometry.type,je=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let Ye=[],ze=ne.id;if(ce.promoteId?ze=ne.properties[ce.promoteId]:ce.generateId&&(ze=ge||0),Ie==="Point")js(Oe,Ye);else if(Ie==="MultiPoint")for(const Xe of Oe)js(Xe,Ye);else if(Ie==="LineString")ba(Oe,Ye,je,!1);else if(Ie==="MultiLineString"){if(ce.lineMetrics){for(const Xe of Oe)Ye=[],ba(Xe,Ye,je,!1),Ue.push(Po(ze,"LineString",Ye,ne.properties));return}Zt(Oe,Ye,je,!1)}else if(Ie==="Polygon")Zt(Oe,Ye,je,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const Xe of ne.geometry.geometries)Co(Ue,{id:ze,geometry:Xe,properties:ne.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Oe){const Tt=[];Zt(Xe,Tt,je,!0),Ye.push(Tt)}}Ue.push(Po(ze,Ie,Ye,ne.properties))}function js(Ue,ne){ne.push(qt(Ue[0]),fr(Ue[1]),0)}function ba(Ue,ne,ce,ge){let Oe,Ie,je=0;for(let ze=0;ze<Ue.length;ze++){const Xe=qt(Ue[ze][0]),Tt=fr(Ue[ze][1]);ne.push(Xe,Tt,0),ze>0&&(je+=ge?(Oe*Tt-Xe*Ie)/2:Math.sqrt(Math.pow(Xe-Oe,2)+Math.pow(Tt-Ie,2))),Oe=Xe,Ie=Tt}const Ye=ne.length-3;ne[2]=1,Yo(ne,0,Ye,ce),ne[Ye+2]=1,ne.size=Math.abs(je),ne.start=0,ne.end=ne.size}function Zt(Ue,ne,ce,ge){for(let Oe=0;Oe<Ue.length;Oe++){const Ie=[];ba(Ue[Oe],Ie,ce,ge),ne.push(Ie)}}function qt(Ue){return Ue/360+.5}function fr(Ue){const ne=Math.sin(Ue*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Ir(Ue,ne,ce,ge,Oe,Ie,je,Ye){if(ge/=ne,Ie>=(ce/=ne)&&je<ge)return Ue;if(je<ce||Ie>=ge)return null;const ze=[];for(const Xe of Ue){const Tt=Xe.geometry;let dt=Xe.type;const Xt=Oe===0?Xe.minX:Xe.minY,hr=Oe===0?Xe.maxX:Xe.maxY;if(Xt>=ce&&hr<ge){ze.push(Xe);continue}if(hr<ce||Xt>=ge)continue;let Ut=[];if(dt==="Point"||dt==="MultiPoint")On(Tt,Ut,ce,ge,Oe);else if(dt==="LineString")Ii(Tt,Ut,ce,ge,Oe,!1,Ye.lineMetrics);else if(dt==="MultiLineString")ko(Tt,Ut,ce,ge,Oe,!1);else if(dt==="Polygon")ko(Tt,Ut,ce,ge,Oe,!0);else if(dt==="MultiPolygon")for(const zr of Tt){const jr=[];ko(zr,jr,ce,ge,Oe,!0),jr.length&&Ut.push(jr)}if(Ut.length){if(Ye.lineMetrics&&dt==="LineString"){for(const zr of Ut)ze.push(Po(Xe.id,dt,zr,Xe.tags));continue}dt!=="LineString"&&dt!=="MultiLineString"||(Ut.length===1?(dt="LineString",Ut=Ut[0]):dt="MultiLineString"),dt!=="Point"&&dt!=="MultiPoint"||(dt=Ut.length===3?"Point":"MultiPoint"),ze.push(Po(Xe.id,dt,Ut,Xe.tags))}}return ze.length?ze:null}function On(Ue,ne,ce,ge,Oe){for(let Ie=0;Ie<Ue.length;Ie+=3){const je=Ue[Ie+Oe];je>=ce&&je<=ge&&Io(ne,Ue[Ie],Ue[Ie+1],Ue[Ie+2])}}function Ii(Ue,ne,ce,ge,Oe,Ie,je){let Ye=eo(Ue);const ze=Oe===0?wa:Mi;let Xe,Tt,dt=Ue.start;for(let jr=0;jr<Ue.length-3;jr+=3){const Dr=Ue[jr],hn=Ue[jr+1],Ai=Ue[jr+2],Wi=Ue[jr+3],Oi=Ue[jr+4],Ji=Oe===0?Dr:hn,xi=Oe===0?Wi:Oi;let mn=!1;je&&(Xe=Math.sqrt(Math.pow(Dr-Wi,2)+Math.pow(hn-Oi,2))),Ji<ce?xi>ce&&(Tt=ze(Ye,Dr,hn,Wi,Oi,ce),je&&(Ye.start=dt+Xe*Tt)):Ji>ge?xi<ge&&(Tt=ze(Ye,Dr,hn,Wi,Oi,ge),je&&(Ye.start=dt+Xe*Tt)):Io(Ye,Dr,hn,Ai),xi<ce&&Ji>=ce&&(Tt=ze(Ye,Dr,hn,Wi,Oi,ce),mn=!0),xi>ge&&Ji<=ge&&(Tt=ze(Ye,Dr,hn,Wi,Oi,ge),mn=!0),!Ie&&mn&&(je&&(Ye.end=dt+Xe*Tt),ne.push(Ye),Ye=eo(Ue)),je&&(dt+=Xe)}let Xt=Ue.length-3;const hr=Ue[Xt],Ut=Ue[Xt+1],zr=Oe===0?hr:Ut;zr>=ce&&zr<=ge&&Io(Ye,hr,Ut,Ue[Xt+2]),Xt=Ye.length-3,Ie&&Xt>=3&&(Ye[Xt]!==Ye[0]||Ye[Xt+1]!==Ye[1])&&Io(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&ne.push(Ye)}function eo(Ue){const ne=[];return ne.size=Ue.size,ne.start=Ue.start,ne.end=Ue.end,ne}function ko(Ue,ne,ce,ge,Oe,Ie){for(const je of Ue)Ii(je,ne,ce,ge,Oe,Ie,!1)}function Io(Ue,ne,ce,ge){Ue.push(ne,ce,ge)}function wa(Ue,ne,ce,ge,Oe,Ie){const je=(Ie-ne)/(ge-ne);return Io(Ue,Ie,ce+(Oe-ce)*je,1),je}function Mi(Ue,ne,ce,ge,Oe,Ie){const je=(Ie-ce)/(Oe-ce);return Io(Ue,ne+(ge-ne)*je,Ie,1),je}function ln(Ue,ne){const ce=[];for(let ge=0;ge<Ue.length;ge++){const Oe=Ue[ge],Ie=Oe.type;let je;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")je=si(Oe.geometry,ne);else if(Ie==="MultiLineString"||Ie==="Polygon"){je=[];for(const Ye of Oe.geometry)je.push(si(Ye,ne))}else if(Ie==="MultiPolygon"){je=[];for(const Ye of Oe.geometry){const ze=[];for(const Xe of Ye)ze.push(si(Xe,ne));je.push(ze)}}ce.push(Po(Oe.id,Ie,je,Oe.tags))}return ce}function si(Ue,ne){const ce=[];ce.size=Ue.size,Ue.start!==void 0&&(ce.start=Ue.start,ce.end=Ue.end);for(let ge=0;ge<Ue.length;ge+=3)ce.push(Ue[ge]+ne,Ue[ge+1],Ue[ge+2]);return ce}function on(Ue,ne){if(Ue.transformed)return Ue;const ce=1<<Ue.z,ge=Ue.x,Oe=Ue.y;for(const Ie of Ue.features){const je=Ie.geometry,Ye=Ie.type;if(Ie.geometry=[],Ye===1)for(let ze=0;ze<je.length;ze+=2)Ie.geometry.push(Wn(je[ze],je[ze+1],ne,ce,ge,Oe));else for(let ze=0;ze<je.length;ze++){const Xe=[];for(let Tt=0;Tt<je[ze].length;Tt+=2)Xe.push(Wn(je[ze][Tt],je[ze][Tt+1],ne,ce,ge,Oe));Ie.geometry.push(Xe)}}return Ue.transformed=!0,Ue}function Wn(Ue,ne,ce,ge,Oe,Ie){return[Math.round(ce*(Ue*ge-Oe)),Math.round(ce*(ne*ge-Ie))]}function Yn(Ue,ne,ce,ge,Oe){const Ie=ne===Oe.maxZoom?0:Oe.tolerance/((1<<ne)*Oe.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Ue.length,source:null,x:ce,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Ue)jo(je,Ye,Ie,Oe);return je}function jo(Ue,ne,ce,ge){const Oe=ne.geometry,Ie=ne.type,je=[];if(Ue.minX=Math.min(Ue.minX,ne.minX),Ue.minY=Math.min(Ue.minY,ne.minY),Ue.maxX=Math.max(Ue.maxX,ne.maxX),Ue.maxY=Math.max(Ue.maxY,ne.maxY),Ie==="Point"||Ie==="MultiPoint")for(let Ye=0;Ye<Oe.length;Ye+=3)je.push(Oe[Ye],Oe[Ye+1]),Ue.numPoints++,Ue.numSimplified++;else if(Ie==="LineString")mt(je,Oe,Ue,ce,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let Ye=0;Ye<Oe.length;Ye++)mt(je,Oe[Ye],Ue,ce,Ie==="Polygon",Ye===0);else if(Ie==="MultiPolygon")for(let Ye=0;Ye<Oe.length;Ye++){const ze=Oe[Ye];for(let Xe=0;Xe<ze.length;Xe++)mt(je,ze[Xe],Ue,ce,!0,Xe===0)}if(je.length){let Ye=ne.tags||null;if(Ie==="LineString"&&ge.lineMetrics){Ye={};for(const Xe in ne.tags)Ye[Xe]=ne.tags[Xe];Ye.mapbox_clip_start=Oe.start/Oe.size,Ye.mapbox_clip_end=Oe.end/Oe.size}const ze={geometry:je,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:Ye};ne.id!==null&&(ze.id=ne.id),Ue.features.push(ze)}}function mt(Ue,ne,ce,ge,Oe,Ie){const je=ge*ge;if(ge>0&&ne.size<(Oe?je:ge))return void(ce.numPoints+=ne.length/3);const Ye=[];for(let ze=0;ze<ne.length;ze+=3)(ge===0||ne[ze+2]>je)&&(ce.numSimplified++,Ye.push(ne[ze],ne[ze+1])),ce.numPoints++;Oe&&function(ze,Xe){let Tt=0;for(let dt=0,Xt=ze.length,hr=Xt-2;dt<Xt;hr=dt,dt+=2)Tt+=(ze[dt]-ze[hr])*(ze[dt+1]+ze[hr+1]);if(Tt>0===Xe)for(let dt=0,Xt=ze.length;dt<Xt/2;dt+=2){const hr=ze[dt],Ut=ze[dt+1];ze[dt]=ze[Xt-2-dt],ze[dt+1]=ze[Xt-1-dt],ze[Xt-2-dt]=hr,ze[Xt-1-dt]=Ut}}(Ye,Ie),Ue.push(Ye)}const Vo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ta{constructor(ne,ce){const ge=(ce=this.options=function(Ie,je){for(const Ye in je)Ie[Ye]=je[Ye];return Ie}(Object.create(Vo),ce)).debug;if(ge&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(Ie,je){const Ye=[];if(Ie.type==="FeatureCollection")for(let ze=0;ze<Ie.features.length;ze++)Co(Ye,Ie.features[ze],je,ze);else Co(Ye,Ie.type==="Feature"?Ie:{geometry:Ie},je);return Ye}(ne,ce);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(Ie,je){const Ye=je.buffer/je.extent;let ze=Ie;const Xe=Ir(Ie,1,-1-Ye,Ye,0,-1,2,je),Tt=Ir(Ie,1,1-Ye,2+Ye,0,-1,2,je);return(Xe||Tt)&&(ze=Ir(Ie,1,-Ye,1+Ye,0,-1,2,je)||[],Xe&&(ze=ln(Xe,1).concat(ze)),Tt&&(ze=ze.concat(ln(Tt,-1)))),ze}(Oe,ce),Oe.length&&this.splitTile(Oe,0,0,0),ge&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ce,ge,Oe,Ie,je,Ye){const ze=[ne,ce,ge,Oe],Xe=this.options,Tt=Xe.debug;for(;ze.length;){Oe=ze.pop(),ge=ze.pop(),ce=ze.pop(),ne=ze.pop();const dt=1<<ce,Xt=Lo(ce,ge,Oe);let hr=this.tiles[Xt];if(!hr&&(Tt>1&&console.time("creation"),hr=this.tiles[Xt]=Yn(ne,ce,ge,Oe,Xe),this.tileCoords.push({z:ce,x:ge,y:Oe}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ge,Oe,hr.numFeatures,hr.numPoints,hr.numSimplified),console.timeEnd("creation"));const mn=`z${ce}`;this.stats[mn]=(this.stats[mn]||0)+1,this.total++}if(hr.source=ne,Ie==null){if(ce===Xe.indexMaxZoom||hr.numPoints<=Xe.indexMaxPoints)continue}else{if(ce===Xe.maxZoom||ce===Ie)continue;if(Ie!=null){const mn=Ie-ce;if(ge!==je>>mn||Oe!==Ye>>mn)continue}}if(hr.source=null,ne.length===0)continue;Tt>1&&console.time("clipping");const Ut=.5*Xe.buffer/Xe.extent,zr=.5-Ut,jr=.5+Ut,Dr=1+Ut;let hn=null,Ai=null,Wi=null,Oi=null,Ji=Ir(ne,dt,ge-Ut,ge+jr,0,hr.minX,hr.maxX,Xe),xi=Ir(ne,dt,ge+zr,ge+Dr,0,hr.minX,hr.maxX,Xe);ne=null,Ji&&(hn=Ir(Ji,dt,Oe-Ut,Oe+jr,1,hr.minY,hr.maxY,Xe),Ai=Ir(Ji,dt,Oe+zr,Oe+Dr,1,hr.minY,hr.maxY,Xe),Ji=null),xi&&(Wi=Ir(xi,dt,Oe-Ut,Oe+jr,1,hr.minY,hr.maxY,Xe),Oi=Ir(xi,dt,Oe+zr,Oe+Dr,1,hr.minY,hr.maxY,Xe),xi=null),Tt>1&&console.timeEnd("clipping"),ze.push(hn||[],ce+1,2*ge,2*Oe),ze.push(Ai||[],ce+1,2*ge,2*Oe+1),ze.push(Wi||[],ce+1,2*ge+1,2*Oe),ze.push(Oi||[],ce+1,2*ge+1,2*Oe+1)}}getTile(ne,ce,ge){ne=+ne,ce=+ce,ge=+ge;const Oe=this.options,{extent:Ie,debug:je}=Oe;if(ne<0||ne>24)return null;const Ye=1<<ne,ze=Lo(ne,ce=ce+Ye&Ye-1,ge);if(this.tiles[ze])return on(this.tiles[ze],Ie);je>1&&console.log("drilling down to z%d-%d-%d",ne,ce,ge);let Xe,Tt=ne,dt=ce,Xt=ge;for(;!Xe&&Tt>0;)Tt--,dt>>=1,Xt>>=1,Xe=this.tiles[Lo(Tt,dt,Xt)];return Xe&&Xe.source?(je>1&&(console.log("found parent tile z%d-%d-%d",Tt,dt,Xt),console.time("drilling down")),this.splitTile(Xe.source,Tt,dt,Xt,ne,ce,ge),je>1&&console.timeEnd("drilling down"),this.tiles[ze]?on(this.tiles[ze],Ie):null):null}}function Lo(Ue,ne,ce){return 32*((1<<Ue)*ce+ne)+Ue}function qr(Ue,ne){const ce=Ue.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ge=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ge)return void ne(null,null);const Oe=Xe=>Xe.tags&&"3d_elevation_id"in Xe.tags&&"source"in Xe.tags&&Xe.tags.source==="elevation",Ie=ge.features.filter(Xe=>Oe(Xe));let je={_geojsonTileLayer:ge.features};Ie.length>0&&(je={_geojsonTileLayer:ge.features.filter(Xe=>!Oe(Xe)),hd_road_elevation:Ie});const Ye=new Ke(je),ze=function(Xe){const Tt=new i.bt;for(const dt of Object.keys(Xe))Tt.writeMessage(3,Hn,{name:dt,features:Xe[dt]});return Tt.finish()}(je).buffer;ne(null,{vectorTile:Ye,rawData:ze})}class Jo extends pe{constructor(ne,ce,ge,Oe,Ie,je,Ye){super(ne,ce,ge,Oe,Ie,qr,Ye),je&&(this.loadGeoJSON=je),this._dynamicIndex=new qe}loadData(ne,ce){const ge=ne&&ne.request,Oe=ge&&ge.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(Ie,je)=>{if(Ie||!je)return ce(Ie);if(typeof je!="object")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const ze=i.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));je.features=je.features.filter(Xe=>ze.value.evaluate({zoom:0},Xe))}ne.dynamic?(je.type==="Feature"&&(je={type:"FeatureCollection",features:[je]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(je.features,this.loaded),ne.cluster&&(je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new ks(function({superclusterOptions:ze,clusterProperties:Xe}){if(!Xe||!ze)return ze;const Tt={},dt={},Xt={accumulated:null,zoom:0},hr={properties:null},Ut=Object.keys(Xe);for(const zr of Ut){const[jr,Dr]=Xe[zr],hn=i.U(Dr),Ai=i.U(typeof jr=="string"?[jr,["accumulated"],["get",zr]]:jr);Tt[zr]=hn.value,dt[zr]=Ai.value}return ze.map=zr=>{hr.properties=zr;const jr={};for(const Dr of Ut)jr[Dr]=Tt[Dr].evaluate(Xt,hr);return jr},ze.reduce=(zr,jr)=>{hr.properties=jr;for(const Dr of Ut)Xt.accumulated=zr[Dr],zr[Dr]=dt[Dr].evaluate(Xt,hr)},ze}(ne)).load(je.features):ne.dynamic?this._dynamicIndex:function(ze,Xe){return new Ta(ze,Xe)}(je,ne.geojsonVtOptions)}catch(ze){return ce(ze)}const Ye={};if(Oe){const ze=S(ge);ze&&(Ye.resourceTiming={},Ye.resourceTiming[ne.source]=JSON.parse(JSON.stringify(ze)))}ce(null,Ye)}})}reloadTile(ne,ce){const ge=this.loaded;return ge&&ge[ne.uid]?ne.partial?ce(null,void 0):super.reloadTile(ne,ce):this.loadTile(ne,ce)}loadGeoJSON(ne,ce){if(ne.request)i.m(ne.request,ce);else{if(typeof ne.data!="string")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(ne.data))}catch{return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ge){ce(ge)}}getClusterChildren(ne,ce){try{ce(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ge){ce(ge)}}getClusterLeaves(ne,ce){try{ce(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ge){ce(ge)}}}class ly{constructor(ne,ce,ge){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ce,this.worldview=ge}parse(ne,ce,ge,Oe){this.status="parsing";const Ie=new i.aQ(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),je=[],Ye=ce.familiesBySource[ge.source],ze=new i.fn(Ie,ge.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,i.fC(ne).then(Xe=>{if(!Xe)return Oe(new Error("Could not parse tile"));const Tt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,dt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),Xt=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const hr in Ye)for(const Ut of Ye[hr]){const zr=Ut[0];ze.bucketLayerIDs.push(Ut.map(hn=>i.B(hn.id,hn.scope))),zr.recalculate(Xt,[]);const jr=i.fD(Xe,1/i.d7(ge.tileID.canonical)),Dr=new i.fE(Ut,jr,Ie,Tt,dt,this.brightness,ze,this.worldview);Tt||(Dr.needsUpload=!0),je.push(Dr),Dr.evaluate(zr)}this.status="done",Oe(null,{buckets:je,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Oe(new Error(Xe.message)))}}class eu{constructor(ne,ce,ge,Oe,Ie,je,Ye,ze){this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.availableModels=Oe,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=ze}loadTile(ne,ce){const ge=ne.uid,Oe=this.loading[ge]=new ly(ne,this.brightness,this.worldview);i.bu(ne.request,(Ie,je)=>{const Ye=!this.loading[ge];return delete this.loading[ge],Ye||Ie?(Oe.status="done",Ye||(this.loaded[ge]=Oe),ce(Ie)):je&&je.byteLength!==0?void Oe.parse(je,this.layerIndex,ne,(ze,Xe)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Oe,ze||!Xe?ce(ze):ce(null,Xe)}):(Oe.status="done",this.loaded[ge]=Oe,ce())})}reloadTile(ne,ce){const ge=this.loaded,Oe=ne.uid;if(ge&&ge[Oe]){const Ie=ge[Oe];Ie.projection=ne.projection,Ie.brightness=ne.brightness;const je=(Ye,ze)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ne,ce)),ce(Ye,ze)};Ie.status==="parsing"?Ie.reloadCallback=je:Ie.status==="done"&&this.loadTile(ne,ce)}}abortTile(ne,ce){const ge=ne.uid;this.loading[ge]&&delete this.loading[ge],ce()}removeTile(ne,ce){const ge=this.loaded,Oe=ne.uid;ge&&ge[Oe]&&delete ge[Oe],ce()}}class ad{constructor(ne){this.self=ne,this.actor=new i.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:pe,geojson:Jo,"raster-dem":Pe,"raster-array":tt,"batched-model":eu},this.workerSources={},this.self.registerWorkerSource=(ce,ge)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ge},this.self.registerRTLTextPlugin=ce=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=ce.applyArabicShaping,i.fH.processBidirectionalText=ce.processBidirectionalText,i.fH.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ge of this.rtlPluginParsingListeners)ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ce,ge){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ge()}checkIfReady(ne,ce,ge){ge()}setReferrer(ne,ce){this.referrer=ce}spriteLoaded(ne,ce){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ge,isLoaded:Oe}=ce;if(this.isSpriteLoaded[ne][ge]=Oe,this.workerSources[ne]&&this.workerSources[ne][ge])for(const Ie in this.workerSources[ne][ge]){const je=this.workerSources[ne][ge][Ie];for(const Ye in je){const ze=je[Ye];ze instanceof pe&&(ze.isSpriteLoaded=Oe,ze.fire(new i.z("isSpriteLoaded")))}}}setImages(ne,ce,ge){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Oe,images:Ie}=ce;if(this.availableImages[ne][Oe]=Ie,this.workerSources[ne]&&this.workerSources[ne][Oe]){for(const je in this.workerSources[ne][Oe]){const Ye=this.workerSources[ne][Oe][je];for(const ze in Ye)Ye[ze].availableImages=Ie}ge()}else ge()}setModels(ne,{scope:ce,models:ge},Oe){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ce]=ge,this.workerSources[ne]&&this.workerSources[ne][ce]){for(const Ie in this.workerSources[ne][ce]){const je=this.workerSources[ne][ce][Ie];for(const Ye in je)je[Ye].availableModels=ge}Oe()}else Oe()}setProjection(ne,ce){this.projections[ne]=i.cm(ce)}setBrightness(ne,ce,ge){this.brightness=ce,ge()}setWorldview(ne,ce,ge){this.worldview=ce,ge()}setLayers(ne,ce,ge){this.getLayerIndex(ne,ce.scope).replace(ce.layers,ce.options),ge()}updateLayers(ne,ce,ge){this.getLayerIndex(ne,ce.scope).update(ce.layers,ce.removedIds,ce.options),ge()}loadTile(ne,ce,ge){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).loadTile(ce,ge)}decodeRasterArray(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ge)}reloadTile(ne,ce,ge){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).reloadTile(ce,ge)}abortTile(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).abortTile(ce,ge)}removeTile(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).removeTile(ce,ge)}removeSource(ne,ce,ge){if(!(this.workerSources[ne]&&this.workerSources[ne][ce.scope]&&this.workerSources[ne][ce.scope][ce.type]&&this.workerSources[ne][ce.scope][ce.type][ce.source]))return;const Oe=this.workerSources[ne][ce.scope][ce.type][ce.source];delete this.workerSources[ne][ce.scope][ce.type][ce.source],Oe.removeSource!==void 0?Oe.removeSource(ce,ge):ge()}loadWorkerSource(ne,ce,ge){try{this.self.importScripts(ce.url),ge()}catch(Oe){ge(Oe)}}syncRTLPluginState(ne,ce,ge){if(i.fH.isParsed())ge(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(ge);else try{i.fH.setState(ce);const Oe=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||Oe==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(Oe),i.fH.isParsed()?ge(null,!0):this.rtlPluginParsingListeners.push(ge))}catch(Oe){ge(Oe)}}setDracoUrl(ne,ce){this.dracoUrl=ce}getAvailableImages(ne,ce){this.availableImages[ne]||(this.availableImages[ne]={});let ge=this.availableImages[ne][ce];return ge||(ge=[]),ge}getAvailableModels(ne,ce){this.availableModels[ne]||(this.availableModels[ne]={});let ge=this.availableModels[ne][ce];return ge||(ge={}),ge}getLayerIndex(ne,ce){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ge=this.layerIndexes[ne][ce];return ge||(ge=this.layerIndexes[ne][ce]=new M,ge.scope=ce),ge}getWorkerSource(ne,ce,ge,Oe){const Ie=this.workerSources;return Ie[ne]||(Ie[ne]={}),Ie[ne][Oe]||(Ie[ne][Oe]={}),Ie[ne][Oe][ce]||(Ie[ne][Oe][ce]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),Ie[ne][Oe][ce][ge]||(Ie[ne][Oe][ce][ge]=new this.workerSourceTypes[ce]({send:(je,Ye,ze,Xe,Tt,dt)=>this.actor.send(je,Ye,ze,ne,Tt,dt),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Oe),this.getAvailableImages(ne,Oe),this.getAvailableModels(ne,Oe),this.isSpriteLoaded[ne][Oe],void 0,this.brightness,this.worldview)),Ie[ne][Oe][ce][ge]}rasterizeImagesWorker(ne,ce,ge){const Oe=new Map;for(const[Ie,{image:je,imageVariant:Ye}]of ce.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ye,je,ce.scope,ne);Oe.set(Ie,ze)}ge(void 0,Oe)}removeRasterizedImages(ne,ce,ge){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,ne),ge()}enforceCacheSizeLimit(ne,ce){i.fJ(ce)}getWorkerPerformanceMetrics(ne,ce,ge){ge(void 0,void 0)}}return i.fF(self)&&(self.worker=new ad(self)),ad}),m(["./shared"],function(i){var S="3.17.0";const A={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(f){performance.mark(f)},measure(f,o,c){performance.measure(f,o,c)}};function M(f){const o=f.name.split("?")[0];return i.a(o)&&o.includes("mapbox-gl.js")?"javascript":i.a(o)&&o.includes("mapbox-gl.css")?"css":i.b(o)?"fontRange":i.c(o)?"sprite":i.i(o)?"style":i.d(o)?"tilejson":"other"}var L,z={},G=function(){if(L)return z;function f(p){return!o(p)}function o(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,T,P=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(P);try{T=new Worker(O),w=!0}catch{w=!1}return T&&T.terminate(),URL.revokeObjectURL(O),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var T=w.getContext("2d");if(!T)return!1;var P=T.getImageData(0,0,1,1);return P&&P.width===w.width}()?(c[v=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[v]=function(w){var T,P=function(O){var k=document.createElement("canvas"),N=Object.create(f.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=O,k.getContext("webgl2",N)}(w);if(!P)return!1;try{T=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!T||P.isContextLost())&&(P.shaderSource(T,"void main() {}"),P.compileShader(T),P.getShaderParameter(T,P.COMPILE_STATUS)===!0)}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}L=1,z.supported=f,z.notSupportedReason=o;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},z}();function F(f,o,c){const p=document.createElement(f);return o!=null&&(p.className=o),c&&c.appendChild(p),p}function U(f,o,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(o))p.setAttributeNS(null,v,String(o[v]));return c&&c.appendChild(p),p}const K=typeof document<"u"?document.documentElement&&document.documentElement.style:null,J=K&&K.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function ie(){K&&J&&(X=K[J],K[J]="none")}function Q(){K&&J&&(K[J]=X)}function ae(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",ae,!0)}function pe(){window.addEventListener("click",ae,!0),window.setTimeout(()=>{window.removeEventListener("click",ae,!0)},0)}function Pe(f,o){const c=f.getBoundingClientRect();return Be(f,c,o)}function Fe(f,o){const c=f.getBoundingClientRect(),p=[];for(let v=0;v<o.length;v++)p.push(Be(f,c,o[v]));return p}function tt(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function Be(f,o,c){const p=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new i.P((c.clientX-o.left)*p,(c.clientY-o.top)*p)}const Ge="01",Qe="NO_ACCESS_TOKEN";class Ke{constructor(o,c,p){this._transformRequestFn=o,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const o=function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ge,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeStyleURL(o,c){if(!i.h(o))return o;const p=He(o);return p.params.push(`sdk=js-${S}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(o,c){if(!i.h(o))return o;const p=He(o);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(o,c){if(!i.h(o))return o;const p=He(o);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(o,c,p,v){if(!i.h(o))return o;const w=He(o);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),p&&w.params.push(`language=${p}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeIconsetURL(o,c){const p=He(o);return i.h(o)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):qe(p)}normalizeSpriteURL(o,c,p,v){const w=He(o);return i.h(o)?(w.path=`/styles/v1${w.path}/sprite${c}${p}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${c}${p}`,qe(w))}normalizeTileURL(o,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!i.h(o))return o;const v=He(o);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&v.authority!=="raster"&&p===512?"@2x":""}${i.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${i.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${i.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${i.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(T){for(const P of T){const O=P.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(v.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(o,c){const p=He(o);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return o;let v="mapbox://";p.path.match(/^\/raster\/v1\//)?v+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let w=p.params;return c&&(w=w.filter(T=>!T.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(o,c){const p=!!c&&i.h(c),v=[];for(const w of o.tiles||[])i.j(w)?v.push(this.canonicalizeTileURL(w,p)):v.push(w);return v}_makeAPIURL(o,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=He(i.e.API_URL);if(o.protocol=v.protocol,o.authority=v.authority,o.protocol==="http"){const w=o.params.indexOf("secure");w>=0&&o.params.splice(w,1)}if(v.path!=="/"&&(o.path=`${v.path}${o.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return qe(o);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return o.params=o.params.filter(w=>w.indexOf("access_token")===-1),o.params.push(`access_token=${c||""}`),qe(o)}}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function He(f){const o=f.match(ct);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function qe(f){const o=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${o}`}const ut="mapbox.eventData";function nt(f){if(!f)return null;const o=f.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(i.l(o[1]))}catch{return null}}class Kt{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const c=nt(i.e.ACCESS_TOKEN);let p="";return p=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",o?`${ut}.${o}:${p}`:`${ut}:${p}`}fetchEventData(){const o=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(o)try{const w=localStorage.getItem(c);w&&(this.eventData=JSON.parse(w));const T=localStorage.getItem(p);T&&(this.anonId=T);const P=localStorage.getItem(v);P&&(this.anonIdTimestamp=Number(P));const O=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<O)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),w=this.anonId,T=this.anonIdTimestamp;if(o&&w)try{localStorage.setItem(p,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),T&&localStorage.setItem(v,T.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,c,p,v){if(!i.e.EVENTS_URL)return;const w=He(i.e.EVENTS_URL);w.params.push(`access_token=${v||i.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(o).toISOString()},P=c?Object.assign(T,c):T,O={url:qe(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=i.p(O,k=>{this.pendingRequest=null,p(k),this.saveEventData(),this.processRequests(v)})}queueRequest(o,c){this.queue.push(o),this.processRequests(c)}}class cr extends Kt{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!i.e.EVENTS_URL||!o&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:p}=this.queue.shift();this.postEvent(c,p,()=>{},o)}}const Bt=new class extends Kt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,o){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>i.h(c)||i.j(c))&&this.queueRequest(Date.now(),o)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=nt(i.e.ACCESS_TOKEN),c=o?o.u:i.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),p=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),T=new Date(v),P=(v-this.eventData.lastSuccess)/864e5;p=p||P>=1||P<-1||w.getDate()!==T.getDate()}else p=!0;p?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Ge,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},f):this.processRequests()}},Vt=Bt.postTurnstileEvent.bind(Bt),xr=new class extends Kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,o,c,p){this.skuToken=o,this.errorCb=p,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Qe)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Ge,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):o&&(this.success[o]=!0)},f))}remove(){this.errorCb=null}},nn=xr.postMapLoadEvent.bind(xr),Hn=new class extends Kt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let o=this.mapInstanceIdMap.get(f);return o||(o=i.u(),this.mapInstanceIdMap.set(f,o)),o}getEventId(f){const o=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,o+1),o}postStyleLoadEvent(f,o){const{map:c,style:p,importedStyles:v}=o;if(!i.e.EVENTS_URL||!f&&!i.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),T={mapInstanceId:w,eventId:this.getEventId(w),style:p};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:c}=this.queue.shift();this.postEvent(o,c,()=>{},f)}},lr=Hn.postStyleLoadEvent.bind(Hn),an=new cr({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Lt=an.postMetricsEvent.bind(an),nr=new cr({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),pr=nr.postMetricsEvent.bind(nr),Nt=new class extends Kt{constructor(){super("gljs.performance")}postPerformanceEvent(f,o){i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:c}=this.queue.shift(),p=function(v){const w=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),P=function(q){const ee={};if(q){for(const Y in q)if(Y!=="other")for(const se of q[Y]){const oe=`${Y}ResolveRangeMin`,he=`${Y}ResolveRangeMax`,me=`${Y}RequestCount`,de=`${Y}RequestCachedCount`;ee[oe]=Math.min(ee[oe]||1/0,se.startTime),ee[he]=Math.max(ee[he]||-1/0,se.responseEnd);const Ae=be=>{ee[be]===void 0&&(ee[be]=0),++ee[be]};se.transferSize!==void 0&&se.transferSize===0&&Ae(de),Ae(me)}}return ee}(function(q,ee){const Y={};if(q)for(const se of q){const oe=ee(se);Y[oe]===void 0&&(Y[oe]=[]),Y[oe].push(se)}return Y}(w,M)),O=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,N=k?k.effectiveType:void 0,W={counters:[],metadata:[],attributes:[]},H=(q,ee,Y)=>{Y!=null&&q.push({name:ee,value:Y.toString()})};for(const q in P)H(W.counters,q,P[q]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(H(W.counters,"interactionRangeMin",v.interactionRange[0]),H(W.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const q of Object.values(A)){const ee=T.find(Y=>Y.name===q);ee&&H(W.counters,q,ee.startTime)}return H(W.counters,"visibilityHidden",v.visibilityHidden),H(W.attributes,"style",function(q){if(q)for(const ee of q){const Y=ee.name.split("?")[0];if(i.i(Y)){const se=Y.split("/").slice(-2);if(se.length===2)return`mapbox://styles/${se[0]}/${se[1]}`}}}(w)),H(W.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),H(W.attributes,"fogEnabled",v.fogEnabled?"true":"false"),H(W.attributes,"projection",v.projection),H(W.attributes,"zoom",v.zoom),H(W.metadata,"devicePixelRatio",O),H(W.metadata,"connectionEffectiveType",N),H(W.metadata,"navigatorUserAgent",navigator.userAgent),H(W.metadata,"screenWidth",window.screen.width),H(W.metadata,"screenHeight",window.screen.height),H(W.metadata,"windowWidth",window.innerWidth),H(W.metadata,"windowHeight",window.innerHeight),H(W.metadata,"mapWidth",v.width/O),H(W.metadata,"mapHeight",v.height/O),H(W.metadata,"webglRenderer",v.renderer),H(W.metadata,"webglVendor",v.vendor),H(W.metadata,"sdkVersion",S),H(W.metadata,"sdkIdentifier","mapbox-gl-js"),W}(c);for(const v of p.metadata);for(const v of p.counters);for(const v of p.attributes);this.postEvent(o,p,()=>{},f)}},Nr=Nt.postPerformanceEvent.bind(Nt),un=new class extends Kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,o,c,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const v=He(i.e.API_URL+i.e.SESSION_PATH);v.params.push(`sku=${o||""}`),v.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const w={url:qe(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(w,T=>{this.pendingRequest=null,c(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,o,c,p){this.skuToken=o,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Qe)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:c}=this.queue.shift();o&&this.success[o]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):o&&(this.success[o]=!0)},f)}remove(){this.errorCb=null}},ci=un.getSessionAPI.bind(un),Un=new Set;function zn(f,o){o?Un.add(f):Un.delete(f)}class Kn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,c){this._updatedSourceCaches[o]=c,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const c=o.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(o.id),this.setDirty()}removeLayer(o){const c=o.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][o.id]=o,this._updatedLayers[c].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const c in this._updatedLayers)o[c]=o[c]||{},o[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)o[c]=o[c]||{},o[c].removedIds=Object.keys(this._removedLayers[c]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ks(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class ds extends i.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new i.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const c=this.atlasTexture.get(o);c&&(c.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(o.id,o)}removeImageProvider(o,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(o)}getPendingImageProviders(){const o=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&o.push(p);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,c){if(this.loaded.get(c)!==o&&(this.loaded.set(c,o),o)){for(const{ids:p,callback:v}of this.requestors)this._notify(p,c,v);this.requestors=[]}}hasImage(o,c){return!!this.getImage(o,c)}getImage(o,c){return this.images.get(c).get(o.toString())}addImage(o,c,p){this._validate(o,p)&&this.images.get(c).set(o.toString(),p)}_validate(o,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new i.y(new Error(`Image "${o.name}" has invalid "content" value`))),p=!1),p}_validateStretch(o,c){if(!o)return!0;let p=0;for(const v of o){if(v[0]<p||v[1]<v[0]||c<v[1])return!1;p=v[1]}return!0}_validateContent(o,c){return o?o.length!==4||!c.usvg&&(o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,c,p){const v=this.images.get(c).get(o.toString());p.version=v.version+1,this.images.get(c).set(o.toString(),p),this.updatedImages.get(c).add(o),this.removeFromImageRasterizerCache(o,c)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,c){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([o],c))}removeImage(o,c){const p=this.images.get(c),v=p.get(o.toString());p.delete(o.toString()),this.patterns.get(c).delete(o.toString()),this.removeFromImageRasterizerCache(o,c),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(c=>i.I.from(c))}getImages(o,c,p){const v=[],w=[],T=this.imageProviders.get(c);for(const N of o){if(!N.iconsetId){v.push(N);continue}const W=T.get(N.iconsetId);W&&(this.getImage(N,c)?w.push(N):W.addPendingRequest(N))}if(v.length===0)return void this._notify(w,c,p);let P=!0;const O=!!this.loaded.get(c),k=this.images.get(c);if(!O)for(const N of v)k.has(N.toString())||(P=!1);O||P?this._notify(v,c,p):this.requestors.push({ids:v,scope:c,callback:p})}rasterizeImages(o,c){const p=new Map,{tasks:v,scope:w}=o;for(const[T,P]of v.entries()){const O=this.getImage(P.id,w);O&&p.set(T,{image:O,imageVariant:P})}this._rasterizeImages(w,p,c)}_rasterizeImages(o,c,p){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:o},p);else{const v=new Map;for(const[w,{image:T,imageVariant:P}]of c.entries())v.set(w,this.imageRasterizer.rasterize(P,T,o,0));p(void 0,v)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,c,p){const v=this.images.get(c),w=new Map;for(const T of o){if(!v.get(T.toString())){if(T.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:T.name}))}const P=v.get(T.toString());if(!P){i.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(O,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),w.set(i.I.toString(T),O)}p(null,w)}getPixelSize(o){const{width:c,height:p}=this.atlasImage.get(o);return{width:c,height:p}}getPattern(o,c,p){const v=o.toString(),w=this.patterns.get(c),T=w.get(v),P=this.getImage(o,c);if(!P)return null;if(T){if(T.position.version===P.version)return T.position;T.position.version=P.version}else{if(P.usvg&&!P.data){const O=this.getPatternInFlightId(v,c);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const k=new i.A(o).scaleSelf(i.o.devicePixelRatio),N=new Map([[k.toString(),{image:P,imageVariant:k}]]);return this._rasterizeImages(c,N,(W,H)=>this.storePatternImage(k,c,P,p,H)),null}this.storePattern(o,c,P)}return this._updatePatternAtlas(c,p),w.get(v).position}getPatternInFlightId(o,c){return i.B(o,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,c,p,v,w){const T=o.toString(),P=w?w.get(T):void 0;P&&(p.data=P,this.storePattern(o.id,c,p),this._updatePatternAtlas(c,v),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),c)))}storePattern(o,c,p){const v={w:p.data.width+2*i.C,h:p.data.height+2*i.C,x:0,y:0},w=new i.F(v,p,i.C);this.patterns.get(c).set(o.toString(),{bin:v,position:w})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,c){const p=o.gl;let v=this.atlasTexture.get(c);v?this.dirty&&(v.update(this.atlasImage.get(c)),this.dirty=!1):(v=new i.T(o,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,v)),v.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(o,c){const p=this.patterns.get(o),v=Array.from(p.values()).map(({bin:k})=>k),{w,h:T}=i.G(v),P=this.atlasImage.get(o);P.resize({width:w||1,height:T||1});const O=this.images.get(o);for(const[k,{bin:N,position:W}]of p.entries()){let H=W.padding;const q=N.x+H,ee=N.y+H,Y=O.get(k).data,se=Y.width,oe=Y.height;H=H>1?H-1:H,i.q.copy(Y,P,{x:0,y:0},{x:q,y:ee},{width:se,height:oe},c),i.q.copy(Y,P,{x:0,y:oe-H},{x:q,y:ee-H},{width:se,height:H},c),i.q.copy(Y,P,{x:0,y:0},{x:q,y:ee+oe},{width:se,height:H},c),i.q.copy(Y,P,{x:se-H,y:0},{x:q-H,y:ee},{width:H,height:oe},c),i.q.copy(Y,P,{x:0,y:0},{x:q+se,y:ee},{width:H,height:oe},c),i.q.copy(Y,P,{x:se-H,y:oe-H},{x:q-H,y:ee-H},{width:H,height:H},c),i.q.copy(Y,P,{x:0,y:oe-H},{x:q+se,y:ee-H},{width:H,height:H},c),i.q.copy(Y,P,{x:0,y:0},{x:q+se,y:ee+oe},{width:H,height:H},c),i.q.copy(Y,P,{x:se-H,y:0},{x:q-H,y:ee+oe},{width:H,height:H},c)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,c){const p=this.images.get(c);for(const v of o){if(this.callbackDispatchedThisFrame.get(c).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(v.toString());const w=p.get(v.toString());ks(w)&&this.updateImage(v,c,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ao(f){const o=f.value,c=f.valueSpec,p=f.style,v=f.styleSpec,w=f.key,T=f.arrayElementValidator||ln;if(!Array.isArray(o))return[new i.V(w,o,`array expected, ${i.K(o)} found`)];if(c.length&&o.length!==c.length)return[new i.V(w,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new i.V(w,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let P={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(P.function=c.function),i.H(c.value)&&(P=c.value);let O=[];for(let k=0;k<o.length;k++)O=O.concat(T({array:o,arrayIndex:k,value:o[k],valueSpec:P,style:p,styleSpec:v,key:`${w}[${k}]`},!0));return O}function bo(f){const o=f.key,c=f.value,p=f.valueSpec;if(!i.L(c))return[new i.V(o,c,`number expected, ${i.K(c)} found`)];if(c!=c)return[new i.V(o,c,"number expected, NaN found")];if("minimum"in p){let v=p.minimum;if(Array.isArray(p.minimum)&&(v=p.minimum[f.arrayIndex]),c<v)return[new i.V(o,c,`${c} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(Array.isArray(p.maximum)&&(v=p.maximum[f.arrayIndex]),c>v)return[new i.V(o,c,`${c} is greater than the maximum value ${v}`)]}return[]}function mo(f){const o=f.key,c=f.value;if(!i.H(c))return[new i.V(o,c,`object expected, ${i.K(c)} found`)];const p=f.valueSpec,v=i.J(c.type);let w,T,P,O={};const k=v!=="categorical"&&c.property===void 0,N=!k,W=function(Y){const se=Y.stops;return Array.isArray(se)&&Array.isArray(se[0])&&i.H(se[0][0])}(c),H=si({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Y){if(v==="identity")return[new i.V(Y.key,Y.value,'identity function may not have a "stops" property')];let se=[];const oe=Y.value;return se=se.concat(ao({key:Y.key,value:oe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:q})),Array.isArray(oe)&&oe.length===0&&se.push(new i.V(Y.key,oe,"array must have at least one stop")),se},default:function(Y){return ln({key:Y.key,value:Y.value,valueSpec:p,style:Y.style,styleSpec:Y.styleSpec})}}});return v==="identity"&&k&&H.push(new i.V(f.key,f.value,'missing required property "property"')),v==="identity"||c.stops||H.push(new i.V(f.key,f.value,'missing required property "stops"')),v==="exponential"&&p.expression&&!i.M(p)&&H.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(N&&!i.N(p)?H.push(new i.V(f.key,f.value,"property functions not supported")):k&&!i.O(p)&&H.push(new i.V(f.key,f.value,"zoom functions not supported"))),v!=="categorical"&&!W||c.property!==void 0||H.push(new i.V(f.key,f.value,'"property" property is required')),H;function q(Y){let se=[];const oe=Y.value,he=Y.key;if(!Array.isArray(oe))return[new i.V(he,oe,`array expected, ${i.K(oe)} found`)];if(oe.length!==2)return[new i.V(he,oe,`array length 2 expected, length ${oe.length} found`)];if(W){if(!i.H(oe[0]))return[new i.V(he,oe,`object expected, ${i.K(oe[0])} found`)];const me=oe[0];if(me.zoom===void 0)return[new i.V(he,oe,"object stop key must have zoom")];if(me.value===void 0)return[new i.V(he,oe,"object stop key must have value")];const de=i.J(me.zoom);if(typeof de!="number")return[new i.V(he,me.zoom,"stop zoom values must be numbers")];if(P&&P>de)return[new i.V(he,me.zoom,"stop zoom values must appear in ascending order")];de!==P&&(P=de,T=void 0,O={}),se=se.concat(si({key:`${he}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:bo,value:ee}}))}else se=se.concat(ee({key:`${he}[0]`,value:oe[0],style:Y.style,styleSpec:Y.styleSpec},oe));return i.Q(i.S(oe[1]))?se.concat([new i.V(`${he}[1]`,oe[1],"expressions are not allowed in function stops.")]):se.concat(ln({key:`${he}[1]`,value:oe[1],valueSpec:p,style:Y.style,styleSpec:Y.styleSpec}))}function ee(Y,se){const oe=i.K(Y.value),he=i.J(Y.value),me=Y.value!==null?Y.value:se;if(w){if(oe!==w)return[new i.V(Y.key,me,`${oe} stop domain type must match previous stop domain type ${w}`)]}else w=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof he!="number"&&typeof he!="string"&&typeof he!="boolean")return[new i.V(Y.key,me,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&v!=="categorical"){let de=`number expected, ${oe} found`;return i.N(p)&&v===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Y.key,me,de)]}return v!=="categorical"||oe!=="number"||typeof he=="number"&&isFinite(he)&&Math.floor(he)===he?v!=="categorical"&&oe==="number"&&typeof he=="number"&&typeof T=="number"&&T!==void 0&&he<T?[new i.V(Y.key,me,"stop domain values must appear in ascending order")]:(T=he,v==="categorical"&&he in O?[new i.V(Y.key,me,"stop domain values must be unique")]:(O[he]=!0,[])):[new i.V(Y.key,me,`integer expected, found ${String(he)}`)]}}function Hi(f){const o=(f.expressionContext==="property"?i.W:i.U)(i.S(f.value),f.valueSpec);if(o.result==="error")return o.value.map(p=>new i.V(`${f.key}${p.key}`,f.value,p.message));const c=o.value.expression||o.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.Z(c))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Yo(c,f);if(f.expressionContext==="appearance")return wo(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.X(c,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i.Y(c))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yo(f,o){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const v of o.valueSpec.expression.parameters)c.delete(v);if(c.size===0)return[];const p=[];return f instanceof i._&&c.has(f.name)?[new i.V(o.key,o.value,`["${f.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(f.eachChild(v=>{p.push(...Yo(v,o))}),p)}function wo(f,o){const c=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const v of o.valueSpec.expression.parameters)c.add(v);if(c.size===0)return[];const p=[];return f instanceof i._&&!c.has(f.name)?[new i.V(o.key,o.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(v=>{p.push(...wo(v,o))}),p)}function Po(f){const o=f.key,c=f.value,p=f.valueSpec,v=[];return Array.isArray(p.values)?p.values.indexOf(i.J(c))===-1&&v.push(new i.V(o,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(i.J(c))===-1&&v.push(new i.V(o,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function Gs(f){return i.a2(i.S(f.value))?Hi(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Co(f)}function Co(f){const o=f.value,c=f.key;if(!Array.isArray(o))return[new i.V(c,o,`array expected, ${i.K(o)} found`)];if(o.length<1)return[new i.V(c,o,"filter array must have at least 1 element")];const p=f.styleSpec;let v=Po({key:`${c}[0]`,value:o[0],valueSpec:p.filter_operator});const w=()=>{o.length>=2&&(i.a0(o[1])||v.push(new i.V(`${c}[1]`,o[1],`string expected, ${i.K(o[1])} found`)));for(let T=2;T<o.length;T++)i.J(o[1])==="$type"?v=v.concat(Po({key:`${c}[${T}]`,value:o[T],valueSpec:p.geometry_type})):i.a0(o[T])||i.L(o[T])||i.$(o[T])||v.push(new i.V(`${c}[${T}]`,o[T],`string, number, or boolean expected, ${i.K(o[T])} found.`))};switch(i.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&i.J(o[1])==="$type"&&v.push(new i.V(c,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&v.push(new i.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),w();break;case"==":case"!=":o.length!==3&&v.push(new i.V(c,o,`filter array for operator "${o[0]}" must have 3 elements`)),w();break;case"in":case"!in":w();break;case"any":case"all":case"none":for(let T=1;T<o.length;T++)v=v.concat(Co({key:`${c}[${T}]`,value:o[T],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":o.length!==2?v.push(new i.V(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):i.a0(o[1])||v.push(new i.V(`${c}[1]`,o[1],`string expected, ${i.K(o[1])} found`))}return v}function js(f,o){const c=f.key,p=f.style,v=f.layer,w=f.styleSpec,T=f.value,P=f.objectKey,O=w[`${o}_${f.layerType}`];if(!O)return[];const k=P.match(/^(.*)-use-theme$/);if(k&&O[k[1]])return i.Q(i.S(T))?[].concat(ln({key:c,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:P})):ln({key:c,value:T,valueSpec:{type:"string"},style:p,styleSpec:w});const N=P.match(/^(.*)-transition$/);if(o==="paint"&&N&&O[N[1]]&&O[N[1]].transition)return ln({key:c,value:T,valueSpec:w.transition,style:p,styleSpec:w});const W=f.valueSpec||O[P];if(!W)return[new i.a3(c,T,`unknown property "${P}"`)];let H;if(i.a0(T)&&i.N(W)&&!W.tokens&&(H=/^{([^}]+)}$/.exec(T))){const ee=`\`{ "type": "identity", "property": ${H?JSON.stringify(H[1]):'"_"'} }\``;return[new i.V(c,T,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${ee}.`)]}const q=[];if(f.layerType==="symbol")P!=="text-field"||!p||p.glyphs||p.imports||q.push(new i.V(c,T,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&i.a4(i.S(T))&&i.J(T.type)==="identity"&&q.push(new i.V(c,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&o==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.N(W)&&(i.a5(W)||i.O(W))){const ee=i.W(i.S(T),W).value,Y="expression"in ee&&ee.expression||"_styleExpression"in ee&&ee._styleExpression&&ee._styleExpression.expression;Y&&!i.X(Y,["measure-light"])&&(P==="model-emissive-strength"&&i.Y(Y)&&i.Z(Y)||q.push(new i.V(c,T,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(ln({key:f.key,value:T,valueSpec:W,style:p,styleSpec:w,expressionContext:"property",propertyType:o,propertyKey:P}))}function ba(f){return js(f,"paint")}function Zt(f){return js(f,"layout")}function qt(f){let o=[];const c=f.value,p=f.key,v=f.style,w=f.styleSpec;if(!i.H(c))return[new i.V(p,c,"object expected")];c.type||c.ref||o.push(new i.V(p,c,'either "type" or "ref" is required'));let T=i.J(c.type);const P=i.J(c.ref);if(c.id){const O=i.J(c.id);for(let k=0;k<f.arrayIndex;k++){const N=v.layers[k];i.J(N.id)===O&&o.push(new i.V(p,c.id,`duplicate layer id "${O}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach(k=>{k in c&&o.push(new i.V(p,c[k],`"${k}" is prohibited for ref layers`))}),v.layers.forEach(k=>{i.J(k.id)===P&&(O=k)}),O?O.ref?o.push(new i.V(p,c.ref,"ref cannot reference another ref layer")):T=i.J(O.type):typeof P=="string"&&o.push(new i.V(p,c.ref,`ref layer "${P}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(c.source)if(i.a0(c.source)){const O=v.sources&&v.sources[c.source],k=O&&i.J(O.type);O?k==="vector"&&T==="raster"?o.push(new i.V(p,c.source,`layer "${c.id}" requires a raster source`)):k==="raster"&&T!=="raster"?o.push(new i.V(p,c.source,`layer "${c.id}" requires a vector source`)):k!=="vector"||c["source-layer"]?k==="raster-dem"&&T!=="hillshade"?o.push(new i.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&k==="geojson"&&!O.lineMetrics?o.push(new i.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&k!=="raster-array"&&o.push(new i.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):o.push(new i.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new i.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new i.V(p,c.source,`source "${c.source}" not found`))}else o.push(new i.V(`${p}.source`,c.source,'"source" must be a string'));else o.push(new i.V(p,c,'missing required property "source"'));return o=o.concat(si({key:p,value:c,valueSpec:w.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ln({key:`${p}.type`,value:c.type,valueSpec:w.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:O=>Gs(Object.assign({layerType:T},O)),layout:O=>si({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":k=>Zt(Object.assign({layerType:T},k))}}),paint:O=>si({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":k=>ba(Object.assign({layerType:T,layer:c},k))}}),appearances(O){const k=ao({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:H=>function(q){const{key:ee,layer:Y,layerType:se}=q,oe=i.J(q.value),he=i.J(oe.name),me=i.J(oe.condition),de=si({key:ee,value:oe,valueSpec:q.styleSpec.appearance,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{condition:Ae=>function(be){const Se=[];return Se.push(...Hi({key:be.key,value:be.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Se}(Object.assign({layer:Y,layerType:se},Ae)),properties:Ae=>function(be){const Se=[],{styleSpec:xe,layer:ye,layerType:Ce}=be,Le=xe[`paint_${Ce}`],ke=xe[`layout_${Ce}`],Je=be.object[be.objectKey];for(const et in Je){const ht=et in Le?"paint":et in ke?"layout":void 0;if(!ht){Se.push(new i.V(be.key,et,`unknown property "${et}" for layer type "${Ce}"`));continue}const St=Object.assign({},be,{key:`${be.key}.${et}`,object:Je,objectKey:et,layer:ye,layerType:Ce,value:Je[et],valueSpec:ht==="paint"?Le[et]:ke[et]});Se.push(...js(St,ht))}return Se}(Object.assign({layer:Y,layerType:se},Ae))}});return he!=="hidden"&&me===void 0&&de.push(new i.V(q.key,"name",'Appearance with name different than "hidden" must have a condition')),de}(Object.assign({layerType:T,layer:c},H))}),N=Array.isArray(O.value)?O.value:[],W=new Set;return N.forEach((H,q)=>{const ee=i.J(H.name);if(ee)if(W.has(ee)){const Y=i.J(c.id);k.push(new i.V(O.key,ee,`Duplicated appearance name "${ee}" for layer "${Y}"`))}else W.add(ee)}),k}}})),o}function fr({key:f,value:o}){return i.a0(o)?[]:[new i.V(f,o,`string expected, ${i.K(o)} found`)]}const Ir={promoteId:function f({key:o,value:c}){if(i.a0(c))return fr({key:o,value:c});if(Array.isArray(c)){const v=[],w=i.S(c),T=i.U(w);return T.result==="error"&&T.value.forEach(P=>{v.push(new i.V(`${o}${P.key}`,null,`${P.message}`))}),i.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new i.V(`${o}`,null,"promoteId expression should be only feature dependent")),v}if(!i.H(c))return[new i.V(o,c,`string, expression or object expected, "${i.K(c)}" found`)];const p=[];for(const v in c)p.push(...f({key:`${o}.${v}`,value:c[v]}));return p}};function On(f){const o=f.value,c=f.key,p=f.styleSpec,v=f.style;if(!i.H(o))return[new i.V(c,o,`object expected, ${i.K(o)} found`)];if(!("type"in o))return[new i.V(c,o,'"type" is required')];const w=i.J(o.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in o||"tiles"in o||T.push(new i.a3(c,o,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(si({key:c,value:o,valueSpec:p[`source_${w.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Ir})),T;case"geojson":if(T=si({key:c,value:o,valueSpec:p.source_geojson,style:v,styleSpec:p,objectElementValidators:Ir}),"cluster"in o&&"clusterProperties"in o){if(!i.H(o.clusterProperties))return[new i.V(`${c}.clusterProperties`,o,`object expected, ${i.K(o)} found`)];for(const P in o.clusterProperties){const O=o.clusterProperties[P];if(!Array.isArray(O))return[new i.V(`${c}.clusterProperties.${P}`,O,"array expected")];const[k,N]=O,W=typeof k=="string"?[k,["accumulated"],["get",P]]:k;T.push(...Hi({key:`${c}.${P}.map`,value:N,expressionContext:"cluster-map"})),T.push(...Hi({key:`${c}.${P}.reduce`,value:W,expressionContext:"cluster-reduce"}))}}return T;case"video":return si({key:c,value:o,valueSpec:p.source_video,style:v,styleSpec:p});case"image":return si({key:c,value:o,valueSpec:p.source_image,style:v,styleSpec:p});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Po({key:`${c}.type`,value:o.type,valueSpec:{values:Ii(p)}})}}function Ii(f){return f.source.reduce((o,c)=>{const p=f[c];return p.type.type==="enum"&&(o=o.concat(Object.keys(p.type.values||{}))),o},[])}function eo(f){const o=f.value,c=f.styleSpec,p=c.light,v=f.style;if(o===void 0)return[];if(!i.H(o))return[new i.V("light",o,`object expected, ${i.K(o)} found`)];let w=[];for(const T in o){const P=T.match(/^(.*)-transition$/),O=T.match(/^(.*)-use-theme$/);w=w.concat(O&&p[O[1]]?ln({key:T,value:o[T],valueSpec:{type:"string"},style:v,styleSpec:c}):P&&p[P[1]]&&p[P[1]].transition?ln({key:T,value:o[T],valueSpec:c.transition,style:v,styleSpec:c}):p[T]?ln({key:T,value:o[T],valueSpec:p[T],style:v,styleSpec:c}):[new i.V(T,o[T],`unknown property "${T}"`)])}return w}function ko(f){const o=f.value;if(!o)return[];const c=f.key;if(!i.H(o))return[new i.V(c,o,`object expected, ${i.K(o)} found`)];let p=[];const v=f.styleSpec,w=v["light-3d"],T=f.style,P=f.style.lights;for(const N of["type","id"])if(!(N in o))return p=p.concat([new i.V(c,o,`missing property "${N}"`)]),p;if(!i.a0(o.type))return p=p.concat([new i.V(`${c}.type`,o.type,"string expected")]),p;if(P)for(let N=0;N<f.arrayIndex;N++){const W=i.J(o.type),H=P[N];i.J(H.type)===W&&p.push(new i.V(c,o.id,`duplicate light type "${o.type}", previously defined at line ${H.id.__line__}`))}const O=`properties_light_${o.type}`;if(!(O in v))return p=p.concat([new i.V(`${c}.type`,o,`Invalid light type ${o.type}`)]),p;const k=v[O];for(const N in o)if(N==="properties"){const W=o[N];if(!i.H(W))return p=p.concat([new i.V("properties",W,`object expected, ${i.K(W)} found`)]),p;for(const H in W){const q=H.match(/^(.*)-transition$/),ee=H.match(/^(.*)-use-theme$/);p=p.concat(ee&&k[ee[1]]?ln({key:N,value:W[H],valueSpec:{type:"string"},style:T,styleSpec:v}):q&&k[q[1]]&&k[q[1]].transition?ln({key:N,value:o[N],valueSpec:v.transition,style:T,styleSpec:v}):k[H]?ln({key:H,value:W[H],valueSpec:k[H],style:T,styleSpec:v}):[new i.a3(f.key,W[H],`unknown property "${H}"`)])}}else p=p.concat(w[N]?ln({key:N,value:o[N],valueSpec:w[N],style:T,styleSpec:v}):[new i.a3(N,o[N],`unknown property "${N}"`)]);return p}function Io(f){const o=f.value,c=f.key,p=f.style,v=f.styleSpec,w=v.terrain;if(o==null)return[];if(!i.H(o))return[new i.V("terrain",o,`object expected, ${i.K(o)} found`)];let T=[];for(const P in o){const O=P.match(/^(.*)-transition$/),k=P.match(/^(.*)-use-theme$/);T=T.concat(k&&w[k[1]]?ln({key:P,value:o[P],valueSpec:{type:"string"},style:p,styleSpec:v}):O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:o[P],valueSpec:v.transition,style:p,styleSpec:v}):w[P]?ln({key:P,value:o[P],valueSpec:w[P],style:p,styleSpec:v}):[new i.a3(P,o[P],`unknown property "${P}"`)])}if(o.source)if(i.a0(o.source)){const P=p.sources&&p.sources[o.source],O=P&&i.J(P.type);P?O!=="raster-dem"&&T.push(new i.V(`${c}.source`,o.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):T.push(new i.V(`${c}.source`,o.source,`source "${o.source}" not found`))}else T.push(new i.V(`${c}.source`,o.source,"source must be a string"));else T.push(new i.V(c,o,'terrain is missing required property "source"'));return T}function wa(f){const o=f.value,c=f.style,p=f.styleSpec,v=p.fog;if(o===void 0)return[];if(!i.H(o))return[new i.V("fog",o,`object expected, ${i.K(o)} found`)];let w=[];for(const T in o){const P=T.match(/^(.*)-transition$/),O=T.match(/^(.*)-use-theme$/);w=w.concat(O&&v[O[1]]?ln({key:T,value:o[T],valueSpec:{type:"string"},style:c,styleSpec:p}):P&&v[P[1]]&&v[P[1]].transition?ln({key:T,value:o[T],valueSpec:p.transition,style:c,styleSpec:p}):v[T]?ln({key:T,value:o[T],valueSpec:v[T],style:c,styleSpec:p}):[new i.a3(T,o[T],`unknown property "${T}"`)])}return w}const Mi={"*":()=>[],array:ao,boolean:function(f){const o=f.value,c=f.key;return i.$(o)?[]:[new i.V(c,o,`boolean expected, ${i.K(o)} found`)]},number:bo,color:function({key:f,value:o}){return i.a0(o)?i.a1.parseCSSColor(o)===null?[new i.V(f,o,`color expected, "${o}" found`)]:[]:[new i.V(f,o,`color expected, ${i.K(o)} found`)]},enum:Po,filter:Gs,function:mo,layer:qt,object:si,source:On,model:i.a7,light:eo,"light-3d":ko,terrain:Io,fog:wa,string:fr,formatted:function(f){return fr(f).length===0?[]:Hi(f)},resolvedImage:function(f){return fr(f).length===0?[]:Hi(f)},projection:function(f){const o=f.value,c=f.styleSpec,p=c.projection,v=f.style;if(i.H(o)){let w=[];for(const T in o)w=w.concat(ln({key:T,value:o[T],valueSpec:p[T],style:v,styleSpec:c}));return w}return i.a0(o)?[]:[new i.V("projection",o,`object or string expected, ${i.K(o)} found`)]},import:function(f){const o=f.key,{value:c,styleSpec:p}=f;if(!i.H(c))return[new i.V(o,c,"import must be an object")];const{data:v,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let T=si(Object.assign({},f,{value:w,valueSpec:p.import}));return i.J(w.id)===""&&T.push(new i.V(`${f.key}.id`,w,"import id can't be an empty string")),v&&(T=T.concat(Wn(v,p,{key:`${f.key}.data`}))),T},iconset:function(f){const o=f.value,c=f.key,p=f.styleSpec,v=f.style;if(!i.H(o))return[new i.V(c,o,"object expected")];if(!o.type)return[new i.V(c,o,'"type" is required')];const w=i.J(o.type);let T=[];if(T=T.concat(si({key:c,value:o,valueSpec:p[`iconset_${w}`],style:v,styleSpec:p})),function(P,O){return!(P!=="source"||!O.source)}(w,o)){const P=v.sources&&v.sources[o.source],O=P&&i.J(P.type);P?O!=="raster-array"&&T.push(new i.V(c,o.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):T.push(new i.V(c,o.source,`source "${o.source}" not found`))}return T}};function ln(f,o=!1){const c=f.value,p=f.valueSpec,v=f.styleSpec;if(p.expression){if(i.a4(i.J(c)))return mo(f);if(i.Q(i.S(c)))return Hi(f)}if(p.type&&Mi[p.type]){const w=Mi[p.type](f);return o===!0&&w.length>0&&Array.isArray(f.value)?Hi(f):w}return si(Object.assign({},f,{valueSpec:p.type?v[p.type]:p}))}function si(f){const o=f.key,c=f.value,p=f.valueSpec||{},v=f.objectElementValidators||{},w=f.style,T=f.styleSpec;if(!i.H(c))return[new i.V(o,c,`object expected, ${i.K(c)} found`)];let P=[];for(const O in c){const k=O.split(".")[0];let N;v[k]?N=v[k]:p[k]?N=ln:v["*"]?N=v["*"]:p["*"]&&(N=ln),N?P=P.concat(N({key:(o&&`${o}.`)+O,value:c[O],valueSpec:p[k]||p["*"],style:w,styleSpec:T,object:c,objectKey:O},c)):P.push(new i.a3(o,c[O],`unknown property "${O}"`))}for(const O in p){if(v[O])continue;const k=p[O];k.required&&k.default===void 0&&c[O]===void 0&&P.push(new i.V(o,c,`missing required property "${O}"`))}return P}function on({key:f,value:o}){const c=fr({key:f,value:o});if(c.length)return c;const p=o;return p.indexOf("{fontstack}")===-1&&c.push(new i.V(f,o,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new i.V(f,o,'"glyphs" url must include a "{range}" token')),c}function Wn(f,o=i.a6,c={}){return si({key:c.key||"",value:f,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:f,objectElementValidators:{glyphs:on}})}function Yn(f,o=i.a6){return ce(Wn(f,o))}const jo=f=>ce(On(f)),mt=f=>ce(eo(f)),Vo=f=>ce(ko(f)),Ta=f=>ce(Io(f)),Lo=f=>ce(wa(f)),qr=f=>ce(function(o){const c=o.value,p=o.style,v=o.styleSpec,w=v.snow;if(c===void 0)return[];if(!i.H(c))return[new i.V("snow",c,`object expected, ${i.K(c)} found`)];let T=[];for(const P in c){const O=P.match(/^(.*)-transition$/);T=T.concat(O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:c[P],valueSpec:v.transition,style:p,styleSpec:v}):w[P]?ln({key:P,value:c[P],valueSpec:w[P],style:p,styleSpec:v}):[new i.a3(P,c[P],`unknown property "${P}"`)])}return T}(f)),Jo=f=>ce(function(o){const c=o.value,p=o.style,v=o.styleSpec,w=v.rain;if(c===void 0)return[];if(!i.H(c))return[new i.V("rain",c,`object expected, ${i.K(c)} found`)];let T=[];for(const P in c){const O=P.match(/^(.*)-transition$/);T=T.concat(O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:c[P],valueSpec:v.transition,style:p,styleSpec:v}):w[P]?ln({key:P,value:c[P],valueSpec:w[P],style:p,styleSpec:v}):[new i.a3(P,c[P],`unknown property "${P}"`)])}return T}(f)),ly=f=>ce(qt(f)),eu=f=>ce(Gs(f)),ad=f=>ce(ba(f)),Ue=f=>ce(Zt(f)),ne=f=>ce(i.a7(f));function ce(f){return f.slice().sort((o,c)=>o.line&&c.line?o.line-c.line:0)}function ge(f,o){let c=!1;if(o&&o.length)for(const p of o)p instanceof i.a3?i.w(p.message):(f.fire(new i.y(new Error(p.message))),c=!0);return c}const Oe=i.a6.light;let Ie;class je extends i.E{constructor(o,c="flat"){super(),this._transitionable=new i.a8(Ie||(Ie=new i.a9({anchor:new i.aa(Oe.anchor),position:new i.ab(Oe.position),color:new i.aa(Oe.color),intensity:new i.aa(Oe.intensity)}))),this.setLight(o,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c,p={}){this._validate(mt,o,p)||(this._transitionable.setTransitionOrValue(o),this.id=c)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,p){return(!p||p.validate!==!1)&&ge(this,o.call(Yn,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Ye=i.a6.terrain;let ze=class extends i.E{constructor(f,o,c,p,v){super(),this.scope=c,this._transitionable=new i.a8(new i.a9({source:new i.aa(Ye.source),exaggeration:new i.aa(Ye.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=v}get(){return this._transitionable.serialize()}set(f,o){this._transitionable.setTransitionOrValue(f,o)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const o=f.value.expression;if(!o)return null;let c=-1,p=-1,v=1;for(const w of o.zoomStops)v=o.evaluate(new i.ac(w,{worldview:this.worldview})),v>.01?(c=w,p=-1):p=w;return v<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.ad}};const Xe=45,Tt=65,dt=.05;function Xt(f,o,c,p){const v=i.ah(Xe,Tt,c),[w,T]=hr(f,p);let P=1-Math.min(1,Math.exp((o-w)/(T-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*v*f.alpha}function hr(f,o){const c=.5/Math.tan(.5*o);return[f.range[0]+c,f.range[1]+c]}function Ut(f,o,c,p,v){const w=i.af([],[o,c,p],v.mercatorFogMatrix);return Xt(f,i.ag(w),v.pitch,v._fov)}function zr(f,o,c,p,v,w,T){const P=[[c,p,0],[v,p,0],[v,w,0],[c,w,0]];let O=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const N of P){const W=i.af([],N,o),H=i.ag(W);O=Math.min(O,H),k=Math.max(k,H)}return[Xt(f,O,T.pitch,T._fov),Xt(f,k,T.pitch,T._fov)]}const jr=i.a6.fog;class Dr extends i.E{constructor(o,c,p,v){super();const w=new i.a9({range:new i.aa(jr.range),color:new i.aa(jr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(jr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(jr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(jr["horizon-blend"]),"star-intensity":new i.aa(jr["star-intensity"]),"vertical-range":new i.aa(jr["vertical-range"])});this._transitionable=new i.a8(w,p,new Map(v)),this.set(o,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ai(w),this.scope=p}get state(){const o=this._transform,c=o.projection.name==="globe",p=i.aj(o.zoom),v=this.properties.get("range"),w=[.5,3];return{range:c?[i.ak(w[0],v[0],p),i.ak(w[1],v[1],p)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c,p={}){if(this._validate(Lo,o,p))return;const v=Object.assign({},o);for(const w of Object.keys(jr))v[w]===void 0&&(v[w]=jr[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(Xe,Tt,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(p,v,w){const T=i.ae.fromLngLat(v),P=w.elevation?w.elevation.getAtPointOrZero(T):0;return Ut(p,T.x,T.y,P,w)}(this.state,o,c):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(o.toUnwrapped());return zr(this.state,c,0,0,i.al,i.al,this._transform)}getOpacityForBounds(o,c,p,v,w){return this._transform.projection.supportsFog?zr(this.state,o,c,p,v,w,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?hr(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const v=o.points[p];let w;if(v[2]>=0)w=v;else{const T=o.points[p-4];w=i.am(T,v,T[2]/(T[2]-v[2]))}if(Ut(this.state,w[0],w[1],0,this._transform)>=dt)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,p){return(!p||p.validate!==!1)&&ge(this,o.call(Yn,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let hn,Ai,Wi,Oi,Ji=class extends i.E{constructor(f,o,c,p){super();const v=hn||(hn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(v,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=c}get state(){const f=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),p=i.an(c[0]),v=-Math.max(i.an(c[1]),.01),w=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*f),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(f,o,c={}){if(this._validate(qr,f,c))return;const p=Object.assign({},f),v=i.a6.snow;for(const w of Object.keys(v))p[w]===void 0&&(p[w]=v[w].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,o,c){return(!c||c.validate!==!1)&&ge(this,f.call(Yn,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},xi=class extends i.E{constructor(f,o,c,p){super();const v=Ai||(Ai=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(v,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=c}get state(){const f=this.properties.get("opacity"),o=this.properties.get("color"),c=this.properties.get("direction"),p=i.an(c[0]),v=-Math.max(i.an(c[1]),.01),w=[Math.cos(p)*Math.cos(v),Math.sin(p)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(o.r,o.g,o.b,o.a*f),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,o,c={}){if(this._validate(Jo,f,c))return;const p=Object.assign({},f),v=i.a6.rain;for(const w of Object.keys(v))p[w]===void 0&&(p[w]=v[w].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,o,c){return(!c||c.validate!==!1)&&ge(this,f.call(Yn,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class mn extends i.E{constructor(o,c,p,v){super(),this.scope=p,this._options=o,this.properties=new i.ai(c),this._transitionable=new i.a8(c,p,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,c){this._options=o,this._transitionable.setTransitionOrValue(o.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bi{constructor(o,c,p){this.screenBounds=o,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(o,c){let p,v;if(o instanceof i.P||typeof o[0]=="number"){const w=i.P.convert(o);p=[w],v=c.isPointAboveHorizon(w)}else{const w=i.P.convert(o[0]),T=i.P.convert(o[1]),P=w.add(T)._div(2);p=[w,T],v=i.aq(w,T).every(O=>c.isPointAboveHorizon(O))&&c.isPointAboveHorizon(P)}return new bi(p,v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),i.ar(v,o)}bufferedCameraGeometryGlobe(o){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(c,p,o),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>p.y))+((w.x>c.x)+(w.x>p.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(o,c,p,v=0){const w=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let P=o.tileID.wrap+(T.unwrapped?v:0);const O=T.polygon.map(se=>i.as(o.tileTransform,se,P));if(!i.at(O,0,0,i.al,i.al))return;P=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const k=this.screenGeometryMercator.polygon.map(se=>i.au(o.tileTransform,se,P)),N=k.map(se=>new i.P(se[0],se[1])),W=c.getFreeCameraOptions().position||new i.ae(0,0,0),H=i.au(o.tileTransform,W,P),q=k.map(se=>{const oe=i.av(se,se,H);return i.aw(oe,oe),new i.ax(H,oe)}),ee=i.ay(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:q,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(Y=i.az(O),Y.min.x=i.aA(Y.min.x,0,i.al),Y.min.y=i.aA(Y.min.y,0,i.al),Y.max.x=i.aA(Y.max.x,0,i.al),Y.max.y=i.aA(Y.max.y,0,i.al),Y),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(o,c){const p=Ri(o);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[p]=v,v}}_bufferedCameraMercator(o,c){const p=Ri(o);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[p]=v,v}}_projectAndResample(o,c){const p=function(w,T){const P=i.aB([],T.pixelMatrix,T.globeMatrix),O=[0,-i.aD,0,1],k=[0,i.aD,0,1],N=[0,0,0,1];i.aC(O,O,P),i.aC(k,k,P),i.aC(N,N,P);const W=new i.P(O[0]/O[3],O[1]/O[3]),H=new i.P(k[0]/k[3],k[1]/k[3]),q=i.aE(w,W)&&O[3]<N[3],ee=i.aE(w,H)&&k[3]<N[3];if(!q&&!ee)return null;const Y=function(Se,xe,ye){for(let Ce=1;Ce<Se.length;Ce++){const Le=Jr(xe.pointCoordinate3D(Se[Ce-1]).x),ke=Jr(xe.pointCoordinate3D(Se[Ce]).x);if(ye<0){if(Le<ke)return{idx:Ce,t:-Le/(ke-1-Le)}}else if(ke<Le)return{idx:Ce,t:(1-Le)/(ke+1-Le)}}return null}(w,T,q?-1:1);if(!Y)return null;const{idx:se,t:oe}=Y;let he=se>1?Jn(w.slice(0,se),T):[],me=se<w.length?Jn(w.slice(se),T):[];he=he.map(Se=>new i.P(Jr(Se.x),Se.y)),me=me.map(Se=>new i.P(Jr(Se.x),Se.y));const de=[...he];de.length===0&&de.push(me[me.length-1]);const Ae=i.ak(de[de.length-1].y,(me.length===0?he[0]:me[0]).y,oe);let be;return be=q?[new i.P(0,Ae),new i.P(0,0),new i.P(1,0),new i.P(1,Ae)]:[new i.P(1,Ae),new i.P(1,1),new i.P(0,1),new i.P(0,Ae)],de.push(...be),me.length===0?de.push(he[0]):de.push(...me),{polygon:de.map(Se=>new i.ae(Se.x,Se.y)),unwrapped:!1}}(o,c);if(p)return p;const v=function(w,T){let P=!1,O=-1/0,k=0;for(let W=0;W<w.length-1;W++)w[W].x>O&&(O=w[W].x,k=W);for(let W=0;W<w.length-1;W++){const H=(k+W)%(w.length-1),q=w[H],ee=w[H+1];Math.abs(q.x-ee.x)>.5&&(q.x<ee.x?(q.x+=1,H===0&&(w[w.length-1].x+=1)):(ee.x+=1,H+1===w.length-1&&(w[0].x+=1)),P=!0)}const N=i.aF(T.center.lng);return P&&N<Math.abs(N-1)&&w.forEach(W=>{W.x-=1}),{polygon:w,unwrapped:P}}(Jn(o,c).map(w=>new i.P(Jr(w.x),w.y)),c);return{polygon:v.polygon.map(w=>new i.ae(w.x,w.y)),unwrapped:v.unwrapped}}}function Jn(f,o){return i.aG(f,c=>{const p=o.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Jr(f){return f<0?1+f%1:f%1}function Ri(f){return 100*f|0}function No(f,o,c,p,v){const w=function(P,O){if(P)return v(P);if(O){if(f.url&&O.tiles&&f.tiles&&delete f.tiles,O.variants){if(!Array.isArray(O.variants))return v(new Error("variants must be an array"));for(const N of O.variants){if(N==null||typeof N!="object"||N.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(N.capabilities))return v(new Error("capabilities must be an array"));if(N.capabilities.length===1&&N.capabilities[0]==="meshopt"){O=Object.assign(O,N);break}}}const k=i.aH(Object.assign({},O,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=o.canonicalizeTileset(k,f.url),v(null,k)}},T=function(P,O,k){if(!P)return null;if(!O&&!k)return P;k=k||P.worldview_default;const N=Object.values(P.language||{});if(N.length===0)return null;const W=Object.values(P.worldview||{});if(W.length===0)return null;const H=N.every(ee=>ee===O),q=W.every(ee=>ee===k);return H&&q?P:O in(P.language_options||{})||k in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(f.data,c,p);return T?i.o.frame(()=>w(null,T)):f.url?i.m(o.transformRequest(o.normalizeSourceURL(f.url,null,c,p),i.R.Source),w):i.o.frame(()=>{const{data:P,...O}=f;w(null,O)})}function $o(f,o){const c=Math.pow(2,o.z),p=Math.floor(i.aF(f.getWest())*c),v=Math.floor(i.aJ(f.getNorth())*c),w=Math.ceil(i.aF(f.getEast())*c),T=Math.ceil(i.aJ(f.getSouth())*c);return o.x>=p&&o.x<w&&o.y>=v&&o.y<T}class Ts{constructor(o,c,p){this.bounds=o?i.aI.convert(this.validateBounds(o)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const c of o)this.extraBounds.push(i.aI.convert(this.validateBounds(c)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!$o(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if($o(c,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const c=new Ts(o.bounds,o.minzoom,o.maxzoom);return c.addExtraBounds(o.extra_bounds),c}}class tu extends i.E{constructor(o,c,p,v){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.aK}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,c,p,(v,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.y(v));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of w.vector_layers)this.vectorLayerIds.push(T.id),w.worldview&&w.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Ts.fromTileJSON(w),Vt(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,c){const p=o.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(p),w=this.map._requestManager.transformRequest(v,i.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,P=T?{image:T.image.clone()}:null,O={request:w,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(p)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",O,k.bind(this));else if(o.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",O,k.bind(this),void 0,!0);else{const N=i.aL.call({deduped:this._deduped},O,(W,H)=>{if(W||!H)k.call(this,W);else{const q=i.aM(H.responseHeaders);O.data={rawData:H.rawData.slice(0),expires:q.expires,cacheControl:q.cacheControl},o.actor&&o.actor.send("loadTile",O,k.bind(this),void 0,!0)}},!0);o.request={cancel:N}}function k(N,W){return delete o.request,o.aborted?c(null):N&&N instanceof i.aN&&N.status!==404?c(N):(W&&W.resourceTiming&&(o.resourceTiming=W.resourceTiming),this.map._refreshExpiredTiles&&W&&o.setExpiryData(W),o.loadVectorData(W,this.map.painter),i.aO(this.dispatcher),c(null,W),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class To extends i.E{constructor(o,c,p,v){super(),this.id=o,this.dispatcher=p,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,i.aH(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,null,c,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new i.y(p)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=Ts.fromTileJSON(v),Vt(v.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(p)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const p=i.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);o.request=i.n(this.map._requestManager.transformRequest(v,i.R.Tile),(w,T,P)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(w)return o.state="errored",c(w);if(!T)return c(null);const O=i.aM(P);this.map._refreshExpiredTiles&&o.setExpiryData(O),o.setTexture(T,this.map.painter),o.state="loaded",i.aO(this.dispatcher),c(null)})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c&&c()}unloadTile(o,c){o.texture&&o.texture instanceof i.T?(o.destroy(!1),o.texture&&o.texture instanceof i.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Hs([f,o],c,p,{scaled:v=!0}={}){const{tileSize:w,buffer:T}=p,{x:P,y:O,z:k}=c;if(!isFinite(P)||!isFinite(O)||!isFinite(k))throw new Error("Invalid MRT header");const N=2**k,W=N*i.aF(f),H=N*i.aJ(o);return function([q,ee],Y,{scaled:se=!0}={}){if(!Y)throw new Error("bandView is undefined");const{data:oe,tileSize:he,buffer:me,offset:de,scale:Ae,dimension:be}=Y;if(q<-me||q>he+me||ee<-me||ee>he+me)throw new Error(`Point (${q}, ${ee}) out of bounds for tileSize=${he}, buffer=${me}`);const Se=(ee+me)*(he+2*me)+(q+me);if(new Uint32Array(oe.buffer)[Se]===4294967295)return null;let xe=[];xe=se?[]:new Y.data.constructor(be);for(let ye=0;ye<be;ye++)xe[ye]=Math.round(1e12*(oe[be*Se+ye]*Ae+de))/1e12;return xe}([Math.min(Math.max(-T,Math.floor((W-P)*w)),w-1+T),Math.min(Math.max(-T,Math.floor((H-O)*w)),w-1+T)],p,{scaled:v})}class Qo extends To{constructor(o,c,p,v){super(o,c,p,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(o){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,o.tileID),this.map.triggerRepaint()}loadTile(o,c){const p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(p,i.R.Tile),w={request:v,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=v,o.actor||(o.actor=this.dispatcher.getActor());const T=(P,O,k)=>{if(delete o.request,o.aborted)return o.state="unloaded",c(null);if(P)return P.name==="AbortError"?void 0:(o.state="errored",c(P));if(this.map._refreshExpiredTiles&&O){const N=i.aM(k);o.setExpiryData(N)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!O)return c(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=O}c(null)};o.request=this.partial?o.fetchHeader(void 0,T.bind(this)):o.actor.send("loadTile",w,T.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,c){const p=o.texturePerLayer;if(o.flushAllQueues(),p.size){o.destroy(!1);for(const v of p.values())this.map.painter.saveTileTexture(v)}else o.destroy()}prepareTile(o,c,p,v){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(c,p,v,(w,T)=>{if(w)return o.state="errored",this.fire(new i.y(w)),void this.triggerRepaint(o);T&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(p,T,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===o),p=c&&c.fields,v=p&&p.bands&&p.bands;return v?v[0]:0}getTextureDescriptor(o,c,p){if(!o)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;c instanceof i.aR?w=c.paint.get("raster-array-band"):c instanceof i.aS&&(w=c.paint.get("raster-particle-array-band"));const T=w||this.getInitialBand(v);if(T==null)return;if(!o.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(o,v,c.id,T);if(o.updateNeeded(c.id,T)&&!p)return;const P=o.textureDescriptorPerLayer.get(c.id);return Object.assign({},P,{texture:o.texturePerLayer.get(c.id)})}getImages(o,c){const p=new Map;for(const v of o)for(const w of c){const[T,P]=w.split("/"),O=v.getLayer(T);if(!O||!O.hasBand(P)||!O.hasDataForBand(P))continue;const{bytes:k,tileSize:N,buffer:W}=O.getBandView(P),H=N+2*W,q={data:new i.q({width:H,height:H},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(w,q)}return p}queryRasterArrayValueByBandId(o,c,p){const v=c._mrt;return new Promise(w=>{const T={},P=new Set;for(const[O,k]of Object.entries(v.layers)){if(p.layerName&&O!==p.layerName)continue;const N={};T[O]=N;for(const{bands:W}of k.dataIndex)for(const H of W)p.bands&&!p.bands.includes(H)||(P.add(i.B(O,H)),c.fetchBand(O,null,H,q=>{i.o.frame(()=>{N[H]=q?null:Hs([o.lng,o.lat],v,k.getBandView(H)),P.delete(i.B(O,H)),P.size===0&&w(T)})},!1))}P.size===0&&w(T)})}_loadTileForQuery(o,c){if(this._loadTileLoaded[o.uid])return void c(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(c);this._loadTilePending[o.uid]=[c];const p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(p,i.R.Tile);o.actor.send("loadTile",{request:v,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(w,T,P)=>{if(w)return this._loadTilePending[o.uid].forEach(O=>O(w,null)),void delete this._loadTilePending[o.uid];if(!T)return this._loadTilePending[o.uid].forEach(O=>O(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&T){const O=i.aM(P);o.setExpiryData(O)}o._mrt=T,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(O=>O(null,T)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,c,p){return new Promise((v,w)=>{this._loadTileForQuery(c,(T,P)=>{T?w(T):v(P?this.queryRasterArrayValueByBandId(o,c,p):null)})})}queryRasterArrayValue(o,c){const p=i.aT.convert(o),v=this.findLoadedParent(p);return v&&v._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,v,c):this.queryRasterArrayValueByAllBands(p,v,c):Promise.resolve(null)}findLoadedParent(o){const c=i.ae.fromLngLat(o,this.map.transform.tileSize),p=this.maxzoom+1,v=1<<p,w=Math.floor(c.x),T=Math.floor((c.x-w)*v),P=Math.floor(c.y*v),O=this.map.style.getSourceCache(this.id),k=new i.aQ(p,w,p,T,P);return O.findLoadedParent(k,this.minzoom)}}const $a={vector:tu,raster:To,"raster-dem":class extends To{constructor(f,o,c,p){super(f,o,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(v,w){v&&(f.state="errored",o(v)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=i.n(this.map._requestManager.transformRequest(c,i.R.Tile),function(v,w,T){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(v)f.state="errored",o(v);else if(w){const P=i.aM(T);this.map._refreshExpiredTiles&&f.setExpiryData(P);const O=ImageBitmap&&w instanceof ImageBitmap&&i.r(),k=1-(w.width-i.aP(w.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const N=O?w:i.o.getImageData(w,k),W={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",W,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const o=f.canonical,c=Math.pow(2,o.z),p=(o.x-1+c)%c,v=o.x===0?f.wrap-1:f.wrap,w=(o.x+1+c)%c,T=o.x+1===c?f.wrap+1:f.wrap,P={};return P[new i.aQ(f.overscaledZ,v,o.z,p,o.y).key]={backfilled:!1},P[new i.aQ(f.overscaledZ,T,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(P[new i.aQ(f.overscaledZ,v,o.z,p,o.y-1).key]={backfilled:!1},P[new i.aQ(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},P[new i.aQ(f.overscaledZ,T,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<c&&(P[new i.aQ(f.overscaledZ,v,o.z,p,o.y+1).key]={backfilled:!1},P[new i.aQ(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},P[new i.aQ(f.overscaledZ,T,o.z,w,o.y+1).key]={backfilled:!1}),P}},"raster-array":Qo,geojson:class extends i.E{constructor(f,o,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:i.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:i.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const c of this._data.features)o.set(c.id,c);for(const c of f.features)o.set(c.id,c);this._data.features=[...o.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterLeaves(f,o,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:o,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:f},this.workerOptions);o.scope=this.scope;const c=this._data;typeof c=="string"?(o.request=this.map._requestManager.transformRequest(i.o.resolveURL(c),i.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(p,v)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.y(p));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=i.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,o){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,v=p?{image:p.image.clone()}:null,w=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(c,T,(P,O)=>w&&!O?(f.state="loaded",o(null)):(delete f.request,f.destroy(!1),f.aborted?o(null):P?o(P):(f.loadVectorData(O,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,o){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(f,o,c,p){super(f,o,c,p),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,i.R.Source).url);i.aV(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new i.y(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(f,o,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,o,c,(p,v)=>{this._tileJSONRequest=null,this._loaded=!0,p?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.y(p))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new Ts(v.bounds,this.minzoom,this.maxzoom)),Vt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=o;else{if(f.buckets){const w=Object.values(f.buckets);for(const T of w)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,v.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,v.bind(this),void 0,!0);function v(w,T){return f.aborted?o(null):w&&w.status!==404?o(w):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(f,o,c,p){super(f,o,c,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new i.y(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,o,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ts(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:o,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:o,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){const{x:c,y:p,z:v}=f.tileID.canonical,w=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:v},{signal:w.signal})).then(function(T){return delete f.request,f.aborted?(f.state="unloaded",o(null)):T===void 0?(f.state="errored",o(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.name!=="AbortError"&&(f.state="errored",o(T))}),f.request.cancel=()=>w.abort()}loadTileData(f,o){f.setTexture(o,this.map.painter)}unloadTile(f,o){if(f.texture&&f.texture instanceof i.T?(f.destroy(!1),f.texture&&f.texture instanceof i.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:v})}o&&o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=i.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},go=function(f,o,c,p){const v=new $a[o.type](f,o,c,p);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return i.aY(["load","abort","unload","serialize","prepare"],v),v};function ru(f,o,c=""){return`${c}:${o.id||""}:${o.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:v,importId:w}=p;return`featureset:${v}${w?`:import:${w}`:""}`}}(f.target)}`}function Yu(f,o,c,p=""){if(f.uniqueFeatureID){const v=ru(f,o,p);if(c.has(v))return!0;c.add(v)}return!1}function Gf(f,o,c,p,v=!1){const w=o.sourceCache.transform,T=o.sourceCache.tilesIn(f,o.has3DLayers,v);T.sort(ld);const P=[];for(const O of T){const k=O.tile.queryRenderedFeatures(o,O,c,p,w,v);Object.keys(k).length&&P.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:k})}for(const O in o.layers){const k=o.layers[O];if(k.styleLayer){const N=k.styleLayer.queryRenderedFeatures(f,o.sourceCache,p);Object.keys(N).length&&P.push({wrappedTileID:0,queryResults:N})}}return P.length===0?{}:function(O){const k={},N={};for(const W of O){const H=W.queryResults,q=W.wrappedTileID,ee=N[q]=N[q]||{};for(const Y in H){const se=H[Y],oe=ee[Y]=ee[Y]||{},he=k[Y]=k[Y]||[];for(const me of se)oe[me.featureIndex]||(oe[me.featureIndex]=!0,he.push(me))}}return k}(P)}function Hf(f,o,c,p,v,w){const T={},P=p.queryRenderedSymbols(f),O=[];for(const k of Object.keys(P).map(Number))O.push(v[k]);O.sort(ld);for(const k of O){const N=k.featureIndex.lookupSymbolFeatures(P[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,o,c,w);for(const W in N){const H=T[W]=T[W]||[],q=N[W];q.sort((ee,Y)=>{const se=k.featureSortOrder;if(se){const oe=se.indexOf(ee.featureIndex);return se.indexOf(Y.featureIndex)-oe}return Y.featureIndex-ee.featureIndex});for(const ee of q)H.push(ee)}}return T}function Wf(f,o){const c=f.getRenderableIds().map(w=>f.getTileByID(w)),p=[],v={};for(let w=0;w<c.length;w++){const T=c[w],P=T.tileID.canonical.key;v[P]||(v[P]=!0,T.querySourceFeatures(p,o))}return p}function ld(f,o){const c=f.tileID,p=o.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Ua(f,o){const c={};if(!o)return c;for(const p of f){const v=p.layerIds.map(w=>o.getLayer(w)).filter(Boolean);if(v.length!==0){p.layers=v,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(w=>v.filter(T=>T.id===w)[0]));for(const w of v)c[w.fqid]=p}}return c}const Ss=32,Sa=33,Ea=new Uint16Array(8184);for(let f=0;f<2046;f++){let o=f+2,c=0,p=0,v=0,w=0,T=0,P=0;for(1&o?v=w=T=Ss:c=p=P=Ss;(o>>=1)>1;){const k=c+v>>1,N=p+w>>1;1&o?(v=c,w=p,c=T,p=P):(c=v,p=w,v=T,w=P),T=k,P=N}const O=4*f;Ea[O+0]=c,Ea[O+1]=p,Ea[O+2]=v,Ea[O+3]=w}const na=new Uint16Array(2178),Ga=new Uint8Array(1089),pc=new Uint16Array(1089);function nu(f){return f===0?-.03125:f===32?.03125:0}const qf={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class iu{constructor(o,c,p,v,w,T){this.tileID=o,this.uid=i.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(o){const c=o+this.timeAdded;c<i.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,c,p){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Ua(o.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof i.b4){if(this.hasSymbolBuckets=!0,!p)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof i.b4&&w.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],T=c.style.getOwnLayer(v);if(!T)continue;const P=T.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,P)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,c,p){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Ua(o.buckets,c.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,c){for(const w in this.buckets){const T=this.buckets[w];if(T.uploadPending()){let P={},O=[],k={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){O=c.style.listImages();const N=T.layers[0],W=N.sourceLayer||"_geojsonTileLayer",H=c.style.getLayerSourceCache(N);H&&(P=H._state.getState(W,void 0))}k={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}T.upload(o,this.tileID.canonical,P,O,k)}}const p=o.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new i.T(o,v.image,p.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(o,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(o,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(o,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const c in this.buckets){const p=this.buckets[c];p.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,p.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,c,p,v,w,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=this.evaluateQueryRenderedFeaturePadding(),O=function(k,N){const W=i.bq([],[.5*k.width,.5*-k.height,1]);return i.br(W,W,[1,-1,0]),i.aB(W,W,k.calculateProjMatrix(N.toUnwrapped())),Float32Array.from(W)}(w,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:c,pixelPosMatrix:O,transform:v,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:P})}querySourceFeatures(o,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const v=p.loadVTLayers(),w=c?c.sourceLayer:"",T=v._geojsonTileLayer||v[w];if(!T)return;const P=i.b6(c&&c.filter),{z:O,x:k,y:N}=this.tileID.canonical,W={z:O,x:k,y:N};for(let H=0;H<T.length;H++){const q=T.feature(H);if(P.needGeometry){const se=i.b7(q,!0);if(!P.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),se,this.tileID.canonical))continue}else if(!P.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const ee=p.getId(q,w),Y=new i.b8(q,O,k,N,ee);Y.tile=W,o.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const c=this.expirationTime;if(o.cacheControl){const p=i.b9(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let v=!1;if(this.expirationTime>p)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const w=this.expirationTime-c;w?this.expirationTime=p+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const c in this.buckets)if(o.style.hasLayer(c)&&this.buckets[c].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(o,c){if(!this.latestFeatureIndex||!o.style)return;const p=o.style.listImages(),v=o.style.getBrightness();for(const w in this.buckets){if(!o.style.hasLayer(w))continue;const T=this.buckets[w],P=T.layers[0],O=P.sourceLayer||"_geojsonTileLayer",k=o.style.getLayerSourceCache(P);let N={};k&&(N=k._state.getState(O,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},H=Object.keys(N).length>0&&!c;T.hasAppearances=T.layers.some(Y=>Y.appearances&&Y.appearances.length>0);const q=H?T.stateDependentLayers:T.layers;if(H&&T.stateDependentLayers.length!==0||c){const Y=this.latestFeatureIndex.loadVTLayers();T.update(N,Y[O],p,W,q,c,v)}if(H&&T.stateDependentLayers.length!==0||c||T.hasAppearances){const Y={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};T.updateAppearances(this.tileID.canonical,N,p,Y)}(T instanceof i.ba||T instanceof i.bb)&&o._terrain&&o._terrain.enabled&&k&&T.uploadPending()&&o._terrain._clearRenderCacheForTile(k.id,this.tileID);const ee=o&&o.style&&o.style.getOwnLayer(w);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=i.o.now()+o}setTexture(o,c){const p=c.context,v=p.gl;this.texture=this.texture||c.getTileTexture(o.width),this.texture&&this.texture instanceof i.T?this.texture.update(o):(this.texture=new i.T(p,o,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(o,c){const p={};for(const v of c)p[v]=!0;this.dependencies[o]=p}hasDependency(o,c){for(const p of o){const v=this.dependencies[p];if(v){for(const w of c)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=i.bc(qf,this.tileID.canonical,this.tileTransform)[0],v=new i.bd,w=new i.be;for(let T=0;T<p.length;T++){const{x:P,y:O}=p[T];v.emplaceBack(P,O),w.emplaceBack(T)}w.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(w),this._tileDebugBuffer=o.createVertexBuffer(v,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(o,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=i.bc(qf,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const T=function(P,O){const k=i.aZ(P,O),N=Math.pow(2,P.z);for(let se=0;se<Sa;se++)for(let oe=0;oe<Sa;oe++){const he=i.a_((P.x+(oe+nu(oe))/Ss)/N),me=i.a$((P.y+(se+nu(se))/Ss)/N),de=O.project(he,me),Ae=se*Sa+oe;na[2*Ae+0]=Math.round((de.x*k.scale-k.x)*i.al),na[2*Ae+1]=Math.round((de.y*k.scale-k.y)*i.al)}Ga.fill(0),pc.fill(0);for(let se=2045;se>=0;se--){const oe=4*se,he=Ea[oe+0],me=Ea[oe+1],de=Ea[oe+2],Ae=Ea[oe+3],be=he+de>>1,Se=me+Ae>>1,xe=be+Se-me,ye=Se+he-be,Ce=me*Sa+he,Le=Ae*Sa+de,ke=Se*Sa+be,Je=Math.hypot((na[2*Ce+0]+na[2*Le+0])/2-na[2*ke+0],(na[2*Ce+1]+na[2*Le+1])/2-na[2*ke+1])>=16;Ga[ke]=Ga[ke]||(Je?1:0),se<1022&&(Ga[ke]=Ga[ke]||Ga[(me+ye>>1)*Sa+(he+xe>>1)]||Ga[(Ae+ye>>1)*Sa+(de+xe>>1)])}const W=new i.b1,H=new i.b0;let q=0;function ee(se,oe){const he=oe*Sa+se;return pc[he]===0&&(W.emplaceBack(na[2*he+0],na[2*he+1],se*i.al/Ss,oe*i.al/Ss),pc[he]=++q),pc[he]-1}function Y(se,oe,he,me,de,Ae){const be=se+he>>1,Se=oe+me>>1;if(Math.abs(se-de)+Math.abs(oe-Ae)>1&&Ga[Se*Sa+be])Y(de,Ae,se,oe,be,Se),Y(he,me,de,Ae,be,Se);else{const xe=ee(se,oe),ye=ee(he,me),Ce=ee(de,Ae);H.emplaceBack(xe,ye,Ce)}}return Y(0,0,Ss,Ss,Ss,0),Y(Ss,Ss,0,0,0,Ss),{vertices:W,indices:H}}(this.tileID.canonical,c);v=T.vertices,w=T.indices}else{v=new i.b1,w=new i.b0;for(const{x:P,y:O}of p)v.emplaceBack(P,O,0,0);const T=i.bh(v.int16.subarray(0,4*v.length),void 0,4);for(let P=0;P<T.length;P+=3)w.emplaceBack(T[P],T[P+1],T[P+2])}this._tileBoundsBuffer=o.createVertexBuffer(v,i.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(w),this._tileBoundsSegments=i.bg.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(o,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const v=this.tileID.canonical,w=i.bj(v,c),T=i.bk(w),P=i.aj(c.zoom);let O;P>0&&(O=i.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,v,c,T,O,P),this._makeGlobeTileDebugTextBuffer(o,v,c,T,O,P)}_globePoint(o,c,p,v,w,T,P){let O=i.bm(o,c,p);if(T){const k=1<<p.z,N=i.aF(v.center.lng),W=i.aJ(v.center.lat),H=(p.x+.5)/k-N;let q=0;H>.5?q=-1:H<-.5&&(q=1);let ee=(o/i.al+p.x)/k+q,Y=(c/i.al+p.y)/k;ee=(ee-N)*v._pixelsPerMercatorPixel+N,Y=(Y-W)*v._pixelsPerMercatorPixel+W;const se=[ee*v.worldSize,Y*v.worldSize,0];i.af(se,se,T),O=i.bn(O,se,P)}return i.af(O,O,w)}_makeGlobeTileDebugBorderBuffer(o,c,p,v,w,T){const P=new i.bd,O=new i.be,k=new i.bo,N=(H,q,ee,Y,se)=>{const oe=(ee-H)/(se-1),he=(Y-q)/(se-1),me=P.length;for(let de=0;de<se;de++){const Ae=H+de*oe,be=q+de*he;P.emplaceBack(Ae,be);const Se=this._globePoint(Ae,be,c,p,v,w,T);k.emplaceBack(Se[0],Se[1],Se[2]),O.emplaceBack(me+de)}},W=i.al;N(0,0,W,0,16),N(W,0,W,W,16),N(W,W,0,W,16),N(0,W,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(O),this._tileDebugBuffer=o.createVertexBuffer(P,i.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(k,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,P.length,O.length)}_makeGlobeTileDebugTextBuffer(o,c,p,v,w,T){const P=i.al/4,O=new i.bd,k=new i.b0,N=new i.bo,W=25;k.reserve(32),O.reserve(W),N.reserve(W);const H=(q,ee)=>W*q+ee;for(let q=0;q<W;q++){const ee=q*P;for(let Y=0;Y<W;Y++){const se=Y*P;O.emplaceBack(se,ee);const oe=this._globePoint(se,ee,c,p,v,w,T);N.emplaceBack(oe[0],oe[1],oe[2])}}for(let q=0;q<4;q++)for(let ee=0;ee<4;ee++){const Y=H(q,ee),se=H(q,ee+1),oe=H(q+1,ee),he=H(q+1,ee+1);k.emplaceBack(Y,se,oe),k.emplaceBack(oe,se,he)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(k),this._tileDebugTextBuffer=o.createVertexBuffer(O,i.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(N,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,W,32)}destroy(o=!0){for(const c in this.buckets)this.buckets[c].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class Zf extends iu{constructor(o,c,p,v,w){super(o,c,p,v,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,c,p){const v=p.context,w=v.gl;let T=this.texturePerLayer.get(o)||p.getTileTexture(c.width);T&&T instanceof i.T?T.update(c,{premultiply:!1}):T=new i.T(v,c,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,T)}flushQueues(o){const c=this._workQueuePerLayer.get(o)||[],p=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(o)||[];for(;c.length;)c.pop()()}}fetchHeader(o=16384,c){const p=this._mrt=new i.bs(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=i.bu(v,(w,T,P)=>{if(w)c(w);else try{const O=p.getHeaderLength(T);if(O>o)return void(this.request=this.fetchHeader(O,c));p.parseHeader(T),this._isHeaderLoaded=!0;let k=0;for(const N of Object.values(p.layers))k=Math.max(k,N.dataIndex[N.dataIndex.length-1].lastByte);T.byteLength>=k&&(this.entireBuffer=T),c(null,this.entireBuffer||T,P)}catch(O){c(O)}}),this.request}fetchBandForRender(o,c,p,v){this.fetchBand(o,c,p,w=>{if(w)return void v(w);this.updateTextureDescriptor(o,c,p);const T=this.textureDescriptorPerLayer.get(c);v(null,T?T.img:null)})}fetchBand(o,c,p,v,w=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void v(new Error("Tile header is not ready"));const P=this.actor;if(!P)return void v(new Error("Can't fetch tile band without an actor"));let O;const k=i.B(String(p),i.B(this.tileID.key,o));let N=this._taskQueue.get(k);N?N.add(v):(N=new Set,N.add(v),this._taskQueue.set(k,N));const W=(Y,se)=>{O.complete(Y,se),Y?v(Y):(N.forEach(oe=>oe(null,se)),this._taskQueue.delete(k))},H=(Y,se)=>{if(Y)return v(Y);const oe=P.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:se,task:O},W,void 0,!0);if(c!==null){const he=this._workQueuePerLayer.get(c)||[];he.push(()=>{oe&&oe.cancel(),O.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,he)}};let q;try{q=T.getLayer(o)}catch(Y){if(this.state==="reloading")return;throw Y}if(!q)return void v(new Error(`Unknown sourceLayer "${o}"`));if(q.hasDataForBand(p))return N.forEach(Y=>Y(null,null)),void this._taskQueue.delete(k);const ee=q.getDataRange([p]);if(O=T.createDecodingTask(ee),!O||O.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)H(null,this.entireBuffer.slice(ee.firstByte,ee.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ee.firstByte}-${ee.lastByte}`}}),se=i.bu(Y,H);if(c!==null){const oe=this._fetchQueuePerLayer.get(c)||[];oe.push(()=>{se.cancel(),O.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,oe)}}}updateNeeded(o,c){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,c,p){if(!this._mrt)return;const v=this._mrt.getLayer(o);if(!v||!v.hasBand(p)||!v.hasDataForBand(p))return;const{bytes:w,tileSize:T,buffer:P,offset:O,scale:k}=v.getBandView(p),N=T+2*P,W=new i.q({width:N,height:N},w),H=this.texturePerLayer.get(c);H&&H instanceof i.T&&H.update(W,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:o,band:p,img:W,buffer:P,offset:O,tileSize:T,format:v.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const c of this.texturePerLayer.values())c&&c instanceof i.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ix{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(const o in this.data)for(const c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,p){const v=o.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:c,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(()=>{this.remove(o,w)},p)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){const c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;const p=o.wrapped().key,v=c===void 0?0:this.data[p].indexOf(c),w=this.data[p][v];return this.data[p].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(w.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){const c=[];for(const p in this.data)for(const v of this.data[p])o(v.value)||c.push(v);for(const p of c)this.remove(p.value.tileID,p)}}class cd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,p){const v=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][v]=this.stateChanges[o][v]||{},Object.assign(this.stateChanges[o][v],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const w in this.state[o])w!==v&&(this.deletedStates[o][w]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][v]===null){this.deletedStates[o][v]={};for(const w in this.state[o][v])p[w]||(this.deletedStates[o][v][w]=null)}else for(const w in p)this.deletedStates[o]&&this.deletedStates[o][v]&&this.deletedStates[o][v][w]===null&&delete this.deletedStates[o][v][w]}removeFeatureState(o,c,p){if(this.deletedStates[o]===null)return;const v=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&c!==void 0)this.deletedStates[o][v]!==null&&(this.deletedStates[o][v]=this.deletedStates[o][v]||{},this.deletedStates[o][v][p]=null);else if(c!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][v])for(p in this.deletedStates[o][v]={},this.stateChanges[o][v])this.deletedStates[o][v][p]=null;else this.deletedStates[o][v]=null;else this.deletedStates[o]=null}getState(o,c){const p=this.state[o]||{},v=this.stateChanges[o]||{},w=this.deletedStates[o];if(w===null)return{};if(c!==void 0){const P=String(c),O=Object.assign({},p[P],v[P]);if(w){const k=w[c];if(k===null)return{};for(const N in k)delete O[N]}return O}const T=Object.assign({},p,v);if(w)for(const P in w)delete T[P];return T}initializeTileState(o,c){o.refreshFeatureState(c)}coalesceChanges(o,c){const p={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),Object.assign(this.state[v][T],this.stateChanges[v][T]),w[T]=this.state[v][T];p[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const T in this.state[v])w[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const P of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][P];w[T]=this.state[v][T]}p[v]=p[v]||{},Object.assign(p[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const v in o)o[v].refreshFeatureState(c)}}class Ls extends i.E{constructor(o,c,p){super(),this.id=o,this._onlySymbols=p,c.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new ix(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new cd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,c){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(o,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Xf).map(o=>o.key)}getRenderableIds(o,c){const p=[];for(const v in this._tiles)this._isIdRenderable(+v,o,c)&&p.push(this._tiles[v]);return o?p.sort((v,w)=>{const T=v.tileID,P=w.tileID,O=new i.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),k=new i.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||k.y-O.y||k.x-O.x}).map(v=>v.tileID.key):p.map(v=>v.tileID).sort(Xf).map(v=>v.key)}hasRenderableParent(o){const c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c,p){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())&&(p||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,c){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,o,c)))}_tileLoaded(o,c,p,v,w){if(v){if(o.state="errored",v.status!==404)this._source.fire(new i.y(v,{tile:o}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const P=this.map.painter.terrain;this.update(this.transform,P.getScaledDemTileSize(),!0),P.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=i.o.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let T=new Map;w&&w.responseHeaders&&(T=w.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(o){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const w=c[v];if(o.neighboringTiles&&o.neighboringTiles[w]){const T=this.getTileByID(w);p(o,T),p(T,o)}}function p(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=w.tileID.canonical.x-v.tileID.canonical.x;const P=w.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),k=w.tileID.key;T===0&&P===0||Math.abs(P)>1||(Math.abs(T)>1&&(Math.abs(T+O)===1?T+=O:Math.abs(T-O)===1&&(T-=O)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,T,P),v.neighboringTiles&&v.neighboringTiles[k]&&(v.neighboringTiles[k].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,p,v){for(const w in this._tiles){let T=this._tiles[w];if(v[w]||!T.hasData()||T.tileID.overscaledZ<=c||T.tileID.overscaledZ>p)continue;let P=T.tileID;for(;T&&T.tileID.overscaledZ>c+1;){const k=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[k.key],T&&T.hasData()&&(P=k)}let O=P;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),o[O.key]){v[P.key]=P;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=o.overscaledZ-1;p>=c;p--){const v=o.scaledTo(p),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(o){const c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,c){c=c||this._source.tileSize;const p=Math.ceil(o.width/c)+1,v=Math.ceil(o.height/c)+1,w=Math.floor(p*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(P)}handleWrapJump(o){const c=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,c){const p={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),p[w.tileID.key]=w}this._tiles=p;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(o,c,p,v,w){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(o,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let P,O=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const H=k.attenuationRange()[0],q=Math.floor(H)-Math.log2(k.getDemUpscale());O>q&&(O=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new i.aQ(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y));else if(this.tileCoverLift!==0){const H=o.clone();H.tileCoverLift=this.tileCoverLift,P=H.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&o.projection.name==="globe"&&(P.push(new i.aQ(1,0,1,0,0)),P.push(new i.aQ(1,0,1,1,0)),P.push(new i.aQ(1,0,1,0,1)),P.push(new i.aQ(1,0,1,1,1)))}else if(P=o.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const H=this._source.hasTile.bind(this._source);P=P.filter(q=>H(q))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ou(this._source.type)){const H=o.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),q=Math.min(H,this._source.maxzoom);if(T){const ee=o.extendTileCover(P,q);for(const Y of ee)P.push(Y)}else if(w){const ee=o.extendTileCoverToNearPlane(P,this.transform.getFrustum(q),q);for(const Y of ee)P.push(Y)}else if(this.castsShadows&&v){const ee=o.extendTileCover(P,q,v,16);for(const Y of ee)this._shadowCasterTiles[Y.key]=!0,P.push(Y)}}const N=this._updateRetainedTiles(P);if(ou(this._source.type)&&P.length!==0){const H={},q={},ee=Object.keys(N);for(const se of ee){const oe=N[se],he=this._tiles[se];if(!he||he.fadeEndTime&&he.fadeEndTime<=i.o.now())continue;const me=this.findLoadedParent(oe,Math.max(oe.overscaledZ-Ls.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),H[me.tileID.key]=me.tileID),q[se]=oe}const Y=P[P.length-1].overscaledZ;for(const se in this._tiles){const oe=this._tiles[se];if(N[se]||!oe.hasData())continue;let he=oe.tileID;for(;he.overscaledZ>Y;){he=he.scaledTo(he.overscaledZ-1);const me=this._tiles[he.key];if(me&&me.hasData()&&q[he.key]){N[se]=oe.tileID;break}}}for(const se in H)N[se]||(this._coveredTiles[se]=!0,N[se]=H[se])}for(const H in N)this._tiles[H].clearFadeHold();const W=i.bv(this._tiles,N);for(const H of W){const q=this._tiles[H];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+H)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const c={};if(o.length===0)return c;const p={},v=o.reduce((k,N)=>Math.min(k,N.overscaledZ),1/0),w=o[0].overscaledZ,T=Math.max(w-Ls.maxOverzooming,this._source.minzoom),P=Math.max(w+Ls.maxUnderzooming,this._source.minzoom),O={};for(const k of o){const N=this._addTile(k);c[k.key]=k,N.hasData()||v<this._source.maxzoom&&(O[k.key]=k)}this._retainLoadedChildren(O,v,P,c);for(const k of o){let N=this._tiles[k.key];if(N.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const H=k.children(this._source.maxzoom)[0],q=this.getTile(H);if(q&&q.hasData()){c[H.key]=H;continue}}else{const H=k.children(this._source.maxzoom);if(c[H[0].key]&&c[H[1].key]&&c[H[2].key]&&c[H[3].key])continue}let W=N.wasRequested();for(let H=k.overscaledZ-1;H>=T;--H){const q=k.scaledTo(H);if(p[q.key]||(p[q.key]=!0,N=this.getTile(q),!N&&W&&(N=this._addTile(q)),N&&(c[q.key]=q,W=N.wasRequested(),N.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const c=[];let p,v=this._tiles[o].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){p=this._loadedParentTiles[v.key];break}c.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(p=this._getLoadedTile(w),p)break;v=w}for(const w of c)this._loadedParentTiles[w]=p}}_addTile(o){let c=this._tiles[o.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));const p=!!c;if(!p){const v=this.map?this.map.painter:null,w=this._source.tileSize*o.overscaleFactor();c=this._source.type==="raster-array"?new Zf(o,w,this.transform.tileZoom,v,this._isRaster):new iu(o,w,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))}return c.uses++,this._tiles[o.key]=c,p||this._source.fire(new i.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=c.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,c,p){const v=[],w=this.transform;if(!w)return v;const T=w.projection.name==="globe",P=i.aF(w.center.lng);for(const O in this._tiles){const k=this._tiles[O];if(p&&k.clearQueryDebugViz(),k.holdingForFade())continue;let N;if(T){const W=k.tileID.canonical;if(W.z===0){const H=[Math.abs(i.aA(P,...wl(W,-1))-P),Math.abs(i.aA(P,...wl(W,1))-P)];N=[0,2*H.indexOf(Math.min(...H))-1]}else{const H=[Math.abs(i.aA(P,...wl(W,-1))-P),Math.abs(i.aA(P,...wl(W,0))-P),Math.abs(i.aA(P,...wl(W,1))-P)];N=[H.indexOf(Math.min(...H))-1]}}else N=[0];for(const W of N){const H=o.containsTile(k,w,c,W);H&&v.push(H)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,c){const p=this.getRenderableIds(o,c).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of p)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return p}sortCoordinatesByDistance(o){const c=o.slice(),p=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const T of c){const P=1/(1<<T.canonical.z);w[T.key]=((T.canonical.x+.5)*P+T.wrap-p[0])*v[0]+((T.canonical.y+.5)*P-p[1])*v[1]-p[2]*v[2]}return c.sort((T,P)=>w[T.key]-w[P.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(ou(this._source.type))for(const o in this._tiles){const c=this._tiles[o];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(o,c,p){this._state.updateState(o=o||"_geojsonTileLayer",c,p)}removeFeatureState(o,c,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,p)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,p){const v=this._tiles[o];v&&v.setDependencies(c,p)}reloadTilesForDependencies(o,c){for(const p in this._tiles)this._tiles[p].hasDependency(o,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(o,c))}_preloadTiles(o,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(o,c))};return void this._source.on("data",O)}const p=new Map,v=Array.isArray(o)?o:[o],w=this.map.painter.terrain,T=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const O of v){const k=O.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of k)p.set(N.key,N);this.usedForTerrain&&O.updateElevation(!1)}const P=Array.from(p.values());i.bw(P,(O,k)=>{const N=new iu(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(N,W=>{this._source.type==="raster-dem"&&N.dem&&this._backfillDEM(N),k(W,N)})},c)}}function Xf(f,o){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return f.overscaledZ-o.overscaledZ||p-c||o.canonical.y-f.canonical.y||o.canonical.x-f.canonical.x}function ou(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function wl(f,o){const c=1<<f.z;return[f.x/c+o,(f.x+1)/c+o]}Ls.maxOverzooming=10,Ls.maxUnderzooming=3;class HS{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,c=!1;for(const p in this.style._mergedLayers){const v=this.style._mergedLayers[p];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:o,visibilityChanged:c});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:o,visibilityChanged:c})}}}onNewFrame(o){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let v=!1;p.type==="fill-extrusion"?v=!p.isHidden(o)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?v=!p.isHidden(o)&&p.paint.get("building-opacity")>0:p.type==="model"&&(v=!p.isHidden(o)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(o,c){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,T=this.style.getLayerSourceCache(w);let P=1;w.type==="fill-extrusion"?P=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(P=v.visible?w.paint.get("building-vertical-scale"):0);let O=T?T.getTile(c):null;if(!O&&T)for(const k in T._tiles){const N=T._tiles[k];if(c.canonical.isChildOf(N.tileID.canonical)){O=N;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:P})}o.hasAnyZOffset=!1;let p=!1;for(let v=0;v<o.symbolInstances.length;v++){const w=o.symbolInstances.get(v),T=w.zOffset,P=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=P!==Number.NEGATIVE_INFINITY?P:T,p||T===w.zOffset||(p=!0),o.hasAnyZOffset||w.zOffset===0||(o.hasAnyZOffset=!0)}p&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,c,p,v){let w=c,T=p;if(o.canonical.z!==v.canonical.z){const P=v.canonical,O=1/(1<<o.canonical.z-P.z);w=(c+o.canonical.x*i.al)*O-P.x*i.al|0,T=(p+o.canonical.y*i.al)*O-P.y*i.al|0}return{tileX:w,tileY:T}}_getHeightAtTileOffset(o,c,p){let v,w;for(let T=0;T<this.layers.length;++T){const P=this.layers[T].layer;if(P.type!=="fill-extrusion"&&P.type!=="building")continue;const{bucket:O,tileID:k,verticalScale:N}=this.currentBuildingBuckets[T];if(!O)continue;const{tileX:W,tileY:H}=this._mapCoordToOverlappingTile(o,c,p,k),q=O.getHeightAtTileCoord(W,H);q&&q.height!==void 0&&(q.hidden?v=q.height:w=Math.max(q.height*N,w||0))}if(w!==void 0)return w;for(let T=0;T<this.layers.length;++T){const P=this.layers[T];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:O,tileID:k}=this.currentBuildingBuckets[T];if(!O)continue;const{tileX:N,tileY:W}=this._mapCoordToOverlappingTile(o,c,p,k),H=O.getHeightAtTileCoord(N,W);if(H&&!H.hidden)return H.height===void 0&&v!==void 0?Math.min(H.maxHeight,v)*H.verticalScale:H.height?H.height*H.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ox(f,o){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return i.bx.forEach(p=>{p in o&&(c[p]=o[p])}),c}function ud(f){f=f.slice();const o=Object.create(null);for(let c=0;c<f.length;c++)o[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=ox(f[c],o[f[c].ref]));return f}const gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Kf(f,o,c){c.push({command:gn.addSource,args:[f,o[f]]})}function cy(f,o,c){o.push({command:gn.removeSource,args:[f]}),c[f]=!0}function sx(f,o,c,p){cy(f,c,p),Kf(f,o,c)}function ax(f,o,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!i.by(f[c][p],o[c][p]))return!1;for(p in o[c])if(o[c].hasOwnProperty(p)&&p!=="data"&&!i.by(f[c][p],o[c][p]))return!1;return!0}function mc(f,o,c,p,v,w){let T;for(T in o=o||{},f=f||{})f.hasOwnProperty(T)&&(i.by(f[T],o[T])||c.push({command:w,args:[p,T,o[T],v]}));for(T in o)o.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(i.by(f[T],o[T])||c.push({command:w,args:[p,T,o[T],v]}))}function hd(f){return f.id}function dd(f,o){return f[o.id]=o,f}function uy(f,o,c){const p=o.createTileMatrix(f,f.worldSize,c.toUnwrapped());return i.aB(new Float32Array(16),f.projMatrix,p)}function Yf(f,o,c){if(o.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(o.projection),uy(p,o.getProjection(),f)}function Ha(f,o,c){return o.name===c.projection.name?f.projMatrix:uy(c,o,f)}class fd{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=i.aA(o,0,1);let c=1,p=this._distances[c];const v=o*this.paddedLength+this.padding;for(;p<v&&c<this._distances.length;)p=this._distances[++c];const w=c-1,T=this._distances[w],P=p-T,O=P>0?(v-T)/P:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class hy{constructor(o,c,p){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(c/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,p,v,w){this._forEachCell(c,p,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(o,c,p,v){this._forEachCell(c-v,p-v,c+v,p+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(p),this.circles.push(v)}_insertBoxCell(o,c,p,v,w,T){this.boxCells[w].push(T)}_insertCircleCell(o,c,p,v,w,T){this.circleCells[w].push(T)}_query(o,c,p,v,w,T){if(p<0||o>this.width||v<0||c>this.height)return!w&&[];const P=[];if(o<=0&&c<=0&&this.width<=p&&this.height<=v){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const k=this.circles[3*O],N=this.circles[3*O+1],W=this.circles[3*O+2];P.push({key:this.circleKeys[O],x1:k-W,y1:N-W,x2:k+W,y2:N+W})}return T?P.filter(T):P}return this._forEachCell(o,c,p,v,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?P.length>0:P}_queryCircle(o,c,p,v,w){const T=o-p,P=o+p,O=c-p,k=c+p;if(P<0||T>this.width||k<0||O>this.height)return!v&&[];const N=[];return this._forEachCell(T,O,P,k,this._queryCellCircle,N,{hitTest:v,circle:{x:o,y:c,radius:p},seenUids:{box:{},circle:{}}},w),v?N.length>0:N}query(o,c,p,v,w){return this._query(o,c,p,v,!1,w)}hitTest(o,c,p,v,w){return this._query(o,c,p,v,!0,w)}hitTestCircle(o,c,p,v){return this._queryCircle(o,c,p,!0,v)}_queryCell(o,c,p,v,w,T,P,O){const k=P.seenUids,N=this.boxCells[w];if(N!==null){const H=this.bboxes;for(const q of N)if(!k.box[q]){k.box[q]=!0;const ee=4*q;if(o<=H[ee+2]&&c<=H[ee+3]&&p>=H[ee+0]&&v>=H[ee+1]&&(!O||O(this.boxKeys[q]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[q],x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]})}}}const W=this.circleCells[w];if(W!==null){const H=this.circles;for(const q of W)if(!k.circle[q]){k.circle[q]=!0;const ee=3*q;if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],o,c,p,v)&&(!O||O(this.circleKeys[q]))){if(P.hitTest)return T.push(!0),!0;{const Y=H[ee],se=H[ee+1],oe=H[ee+2];T.push({key:this.circleKeys[q],x1:Y-oe,y1:se-oe,x2:Y+oe,y2:se+oe})}}}}}_queryCellCircle(o,c,p,v,w,T,P,O){const k=P.circle,N=P.seenUids,W=this.boxCells[w];if(W!==null){const q=this.bboxes;for(const ee of W)if(!N.box[ee]){N.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(k.x,k.y,k.radius,q[Y+0],q[Y+1],q[Y+2],q[Y+3])&&(!O||O(this.boxKeys[ee])))return T.push(!0),!0}}const H=this.circleCells[w];if(H!==null){const q=this.circles;for(const ee of H)if(!N.circle[ee]){N.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(q[Y],q[Y+1],q[Y+2],k.x,k.y,k.radius)&&(!O||O(this.circleKeys[ee])))return T.push(!0),!0}}}_forEachCell(o,c,p,v,w,T,P,O){const k=this._convertToXCellCoord(o),N=this._convertToYCellCoord(c),W=this._convertToXCellCoord(p),H=this._convertToYCellCoord(v);for(let q=k;q<=W;q++)for(let ee=N;ee<=H;ee++)if(w.call(this,o,c,p,v,this.xCellCount*ee+q,T,P,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,p,v,w,T){const P=v-o,O=w-c,k=p+T;return k*k>P*P+O*O}_circleAndRectCollide(o,c,p,v,w,T,P){const O=(T-v)/2,k=Math.abs(o-(v+O));if(k>O+p)return!1;const N=(P-w)/2,W=Math.abs(c-(w+N));if(W>N+p)return!1;if(k<=O||W<=N)return!0;const H=k-O,q=W-N;return H*H+q*q<=p*p}}const gc={unknown:0,flipRequired:1,flipNotRequired:2},su=Math.tan(85*Math.PI/180);function es(f,o,c,p,v,w,T){const P=i.bC();if(c)if(w.name==="globe"){const O=i.bD(v,o);i.aB(P,P,O)}else{const O=i.bE([],T);P[0]=O[0],P[1]=O[1],P[4]=O[2],P[5]=O[3],p||i.bB(P,P,v.angle)}else i.aB(P,v.labelPlaneMatrix,f);return P}function Jf(f,o,c,p,v,w,T){const P=es(f,o,c,p,v,w,T);return w.name==="globe"&&c||(P[2]=P[6]=P[10]=P[14]=0),P}function pd(f,o,c,p,v,w,T){if(c){if(w.name==="globe"){const P=es(f,o,c,p,v,w,T);return i.bl(P,P),i.aB(P,f,P),P}{const P=i.bz(f),O=i.bA([]);return O[0]=T[0],O[1]=T[1],O[4]=T[2],O[5]=T[3],i.aB(P,P,O),p||i.bB(P,P,-v.angle),P}}return v.glCoordMatrix}function ia(f,o,c,p){const v=[f,o,c,1];c?i.aC(v,v,p):ar(v,v,p);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function Dn(f,o){return Math.min(.5+f/o*.5,1.5)}function lx(f,o){const c=f[0]/f[3],p=f[1]/f[3];return c>=-o[0]&&c<=o[0]&&p>=-o[1]&&p<=o[1]}function cx(f,o,c,p,v,w,T,P,O,k,N=1){const W=c.transform,H=p?f.textSizeData:f.iconSizeData,q=i.bK(H,c.transform.zoom,N),ee=W.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],se=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;se.clear();let oe=null;ee&&(oe=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const he=f.lineVertexArray,me=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,de=c.transform.width/c.transform.height;let Ae,be=!1;for(let Se=0;Se<me.length;Se++){const xe=me.get(Se),{numGlyphs:ye,writingMode:Ce}=xe;if(Ce!==i.bL.vertical||be||Ae===i.bL.horizontal||(be=!0),Ae=Ce,(xe.hidden||Ce===i.bL.vertical)&&!be){Aa(ye,se);continue}be=!1;const Le=new i.P(xe.tileAnchorX,xe.tileAnchorY),ke=f.elevationType==="road",Je=!!W.elevation||ke;let{x:et,y:ht,z:St}=W.projection.projectTilePoint(Le.x,Le.y,k.canonical),We=null;if(Je){const Gt=ke?f.getElevationFeatureForText(Se):null;We={getElevation:O,elevation:W.elevation,elevationFeature:Gt};const[dr,Or,Qr]=O(Le,W.elevation,Gt);et+=dr,ht+=Or,St+=Qr}const Re=[et,ht,St,1];if(i.aC(Re,Re,o),!lx(Re,Y)){Aa(ye,se);continue}const ot=Re[3],Ze=Dn(c.transform.getCameraToCenterDistance(W.projection),ot),gt=i.bM(H,q,xe),Rt=T?gt/Ze:gt*Ze,$t=ia(et,ht,St,v);if($t[3]<=0){Aa(ye,se);continue}let It={};const Et=i.an(f.layers[0].layout.get("text-max-angle")),tr=Math.cos(Et),Jt=T?null:We,zt=dy(xe,Rt,!1,P,o,v,w,f.glyphOffsetArray,he,se,oe,$t,Le,It,de,Jt,W.projection,k,T,tr);be=zt.useVertical,Jt&&zt.needsFlipping&&(It={}),(zt.notEnoughRoom||be||zt.needsFlipping&&dy(xe,Rt,!0,P,o,v,w,f.glyphOffsetArray,he,se,oe,$t,Le,It,de,Jt,W.projection,k,T,tr).notEnoughRoom)&&Aa(ye,se)}p?(f.text.dynamicLayoutVertexBuffer.updateData(se),oe&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(oe)):(f.icon.dynamicLayoutVertexBuffer.updateData(se),oe&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(oe))}function ux(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se){const{lineStartIndex:oe,glyphStartIndex:he,segment:me}=P,de=he+P.numGlyphs,Ae=oe+P.lineLength,be=o.getoffsetX(he),Se=o.getoffsetX(de-1),xe=Ju(f*be,c,p,v,w,T,me,oe,Ae,O,k,N,W,H,!0,q,ee,Y,se);if(!xe)return null;const ye=Ju(f*Se,c,p,v,w,T,me,oe,Ae,O,k,N,W,H,!0,q,ee,Y,se);return ye?{first:xe,last:ye}:null}function vr(f,o,c,p){return f===i.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===i.bL.vertical?p>0?{needsFlipping:!0}:null:o!==gc.unknown&&function(v,w){return v===0||Math.abs(w/v)>su}(c,p)?o===gc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function dy(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he,me){const de=o/24,Ae=f.lineOffsetX*de,be=f.lineOffsetY*de,{lineStartIndex:Se,glyphStartIndex:xe,numGlyphs:ye,segment:Ce,writingMode:Le,flipState:ke}=f,Je=Se+f.lineLength,et=ht=>{if(N){const[ot,Ze,gt]=ht.up,Rt=k.length;i.bN(N,Rt+0,ot,Ze,gt),i.bN(N,Rt+1,ot,Ze,gt),i.bN(N,Rt+2,ot,Ze,gt),i.bN(N,Rt+3,ot,Ze,gt)}const[St,We,Re]=ht.point;i.bO(k,St,We,Re,ht.angle)};if(ye>1){const ht=ux(de,P,Ae,be,c,W,H,f,O,w,q,Y,!1,se,oe,he,me);if(!ht)return{notEnoughRoom:!0};if(p&&!c){let[St,We,Re]=ht.first.point,[ot,Ze,gt]=ht.last.point;[St,We]=ia(St,We,Re,T),[ot,Ze]=ia(ot,Ze,gt,T);const Rt=vr(Le,ke,(ot-St)*ee,Ze-We);if(f.flipState=Rt&&Rt.needsFlipping?gc.flipRequired:gc.flipNotRequired,Rt)return Rt}et(ht.first);for(let St=xe+1;St<xe+ye-1;St++){const We=Ju(de*P.getoffsetX(St),Ae,be,c,W,H,Ce,Se,Je,O,w,q,Y,!1,!1,se,oe,he,me);if(!We)return k.length-=4*(St-xe),{notEnoughRoom:!0};et(We)}et(ht.last)}else{if(p&&!c){const St=ia(H.x,H.y,0,v),We=Se+Ce+1,Re=new i.P(O.getx(We),O.gety(We)),ot=ia(Re.x,Re.y,0,v),Ze=ot[3]>0?ot:oa(H,Re,St,1,v,void 0,se,oe.canonical),gt=vr(Le,ke,(Ze[0]-St[0])*ee,Ze[1]-St[1]);if(f.flipState=gt&&gt.needsFlipping?gc.flipRequired:gc.flipNotRequired,gt)return gt}const ht=Ju(de*P.getoffsetX(xe),Ae,be,c,W,H,Ce,Se,Je,O,w,q,Y,!1,!1,se,oe,he,me);if(!ht)return{notEnoughRoom:!0};et(ht)}return{}}function md(f,o,c,p,v){const{x:w,y:T,z:P}=p.projectTilePoint(f.x,f.y,o);if(!v)return ia(w,T,P,c);const[O,k,N]=v.getElevation(f,v.elevation,v.elevationFeature);return ia(w+O,T+k,P+N,c)}function oa(f,o,c,p,v,w,T,P){const O=md(f.sub(o)._unit()._add(f),P,v,T,w);return i.av(O,c,O),i.aw(O,O),i.bH(O,c,O,p)}function Ju(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he){const me=p?f-o:f+o;let de=me>0?1:-1,Ae=0;p&&(de*=-1,Ae=Math.PI),de<0&&(Ae+=Math.PI);let be=P+T+(de>0?0:1)|0,Se=v,xe=v,ye=0,Ce=0;const Le=Math.abs(me),ke=[],Je=[];let et=w,ht=et,St=i.bF([]);const We=()=>oa(ht,et,xe,Le-ye+1,N,H,Y,se.canonical);for(;ye+Ce<=Le;){if(be+=de,be<P||be>=O)return null;if(xe=Se,ht=et,ke.push(xe),q&&Je.push(ht),et=new i.P(k.getx(be),k.gety(be)),Se=W[be],!Se){const Jt=md(et,se.canonical,N,Y,H);Se=Jt[3]>0?W[be]=Jt:We()}ye+=Ce;const Et=i.av([],Se,xe),tr=i.bG(xe,Se);if(c&&tr>0&&Ce>0&&i.bJ(St,Et)/(Ce*tr)<he)return null;Ce=tr,St=Et}ee&&H&&(W[be]&&(Se=We(),Ce=i.bG(xe,Se),St=i.av([],Se,xe)),W[be]=Se);const Re=(Le-ye)/Ce,ot=et.sub(ht)._mult(Re)._add(ht),Ze=i.bH([],xe,St,Re);let gt=[0,0,1],Rt=St[0],$t=St[1];if(oe&&(gt=Y.upVector(se.canonical,ot.x,ot.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const Et=[gt[2],0,-gt[0]],tr=i.bI([],gt,Et);i.aw(Et,Et),i.aw(tr,tr),Rt=i.bJ(St,Et),$t=i.bJ(St,tr)}if(c){const Et=i.bI([],gt,St);i.aw(Et,Et),i.bH(Ze,Ze,Et,c*de)}const It=Ae+Math.atan2($t,Rt);return ke.push(Ze),q&&Je.push(ot),{point:Ze,angle:It,path:ke,tilePath:Je,up:gt}}function Aa(f,o){const c=o.length,p=c+4*f;o.resize(p),o.float32.fill(-1/0,4*c,4*p)}function ar(f,o,c){const p=o[0],v=o[1];return f[0]=c[0]*p+c[4]*v+c[12],f[1]=c[1]*p+c[5]*v+c[13],f[3]=c[3]*p+c[7]*v+c[15],f}const cn=100;class Fn{constructor(o,c,p=new hy(o.width+200,o.height+200,25),v=new hy(o.width+200,o.height+200,25)){this.transform=o,this.grid=p,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+cn,this.screenBottomBoundary=o.height+cn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,p,v,w,T,P,O,k,N,W){let H=p.projectedAnchorX,q=p.projectedAnchorY,ee=p.projectedAnchorZ;const Y=p.tileAnchorX,se=p.tileAnchorY,oe=p.elevation,he=p.tileID,me=o.getProjection();if(oe&&he){const[Je,et,ht]=me.upVector(he.canonical,p.tileAnchorX,p.tileAnchorY),St=me.upVectorScale(he.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=Je*oe*St,q+=et*oe*St,ee+=ht*oe*St}const de=o.projection.name==="globe",Ae=o.projection.name==="globe"?i.aj(this.transform.zoom):0;if(he&&de&&Ae<1&&!T){const Je=1<<he.canonical.z,et=i.bP(Y,se);i.bQ(et,et,1/i.al),i.bR(et,et,i.bP(he.canonical.x,he.canonical.y)),i.bQ(et,et,1/Je),i.bS(et,et,i.bP(v[0],v[1])),et[0]=i.bT(et[0],-.5,.5),i.bQ(et,et,i.al);const ht=i.bU(et[0],et[1],i.al/(2*Math.PI),1);i.aC(ht,ht,w),H=i.ak(H,ht[0],Ae),q=i.ak(q,ht[1],Ae),ee=i.ak(ee,ht[2],Ae)}const be=this.projectAndGetPerspectiveRatio(N,H,q,ee,p.tileID,me.name==="globe"||!!oe||this.transform.pitch>0,me),Se=k*be.perspectiveRatio,xe=(p.x1*c+P.x-p.padding)*Se+be.point.x,ye=(p.y1*c+P.y-p.padding)*Se+be.point.y,Ce=(p.x2*c+P.x+p.padding)*Se+be.point.x,Le=(p.y2*c+P.y+p.padding)*Se+be.point.y,ke=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(xe,ye,Ce,Le)||!O&&this.grid.hitTest(xe,ye,Ce,Le,W)||ke?{box:[],offscreen:!1,occluded:be.occluded}:{box:[xe,ye,Ce,Le],offscreen:this.isOffscreen(xe,ye,Ce,Le),occluded:!1}}placeCollisionCircles(o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se){const oe=[],he=this.transform.elevation,me=o.getProjection(),de=o.elevationType==="road",Ae=!!he||de,be=i.bV.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,me),Se=new i.P(p.tileAnchorX,p.tileAnchorY),xe=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:ye,y:Ce,z:Le}=me.projectTilePoint(xe.x,xe.y,se.canonical),ke=null;if(Ae){const tr=de?o.getElevationFeatureForText(v):null;ke={getElevation:be,elevation:he,elevationFeature:tr};const[Jt,zt,Gt]=be(Se,he,tr);ye+=Jt,Ce+=zt,Le+=Gt}const Je=me.name==="globe",et=this.projectAndGetPerspectiveRatio(O,ye,Ce,Le,se,Je||!!he||this.transform.pitch>0,me),{perspectiveRatio:ht}=et,St=(H?P/ht:P*ht)/i.bY,We=ia(ye,Ce,Le,k),Re=p.lineOffsetX*St,ot=p.lineOffsetY*St,Ze=i.an(o.layers[0].layout.get("text-max-angle")),gt=Math.cos(Ze),Rt=et.signedDistanceFromCamera>0?ux(St,T,Re,ot,de&&p.flipState===1,We,xe,p,w,k,{},Ae&&!H?ke:null,H&&Ae,me,se,H,gt):null;let $t=!1,It=!1,Et=!0;if(Rt&&!et.occluded){const tr=.5*ee*ht+Y,Jt=new i.P(-100,-100),zt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Gt=new fd,{first:dr,last:Or}=Rt,Qr=dr.path.length;let wn=[];for(let Mr=Qr-1;Mr>=1;Mr--)wn.push(dr.path[Mr]);for(let Mr=1;Mr<Or.path.length;Mr++)wn.push(Or.path[Mr]);const rr=2.5*tr;N&&(wn=wn.map(([Mr,An,Bn],kn)=>(Ae&&!Je&&(Bn=be(kn<Qr-1?dr.tilePath[Qr-1-kn]:Or.tilePath[kn-Qr+2],he,ke.elevationFeature)[2]),ia(Mr,An,Bn,N))),wn.some(Mr=>Mr[3]<=0)&&(wn=[]));let vn=[];if(wn.length>0){let Mr=1/0,An=-1/0,Bn=1/0,kn=-1/0;for(const yn of wn)Mr=Math.min(Mr,yn[0]),Bn=Math.min(Bn,yn[1]),An=Math.max(An,yn[0]),kn=Math.max(kn,yn[1]);An>=Jt.x&&Mr<=zt.x&&kn>=Jt.y&&Bn<=zt.y&&(vn=[wn.map(yn=>new i.P(yn[0],yn[1]))],(Mr<Jt.x||An>zt.x||Bn<Jt.y||kn>zt.y)&&(vn=i.bW(vn,Jt.x,Jt.y,zt.x,zt.y)))}for(const Mr of vn){Gt.reset(Mr,.25*tr);let An=0;An=Gt.length<=.5*tr?1:Math.ceil(Gt.paddedLength/rr)+1;for(let Bn=0;Bn<An;Bn++){const kn=Bn/Math.max(An-1,1),yn=Gt.lerp(kn),Fr=yn.x+cn,Sn=yn.y+cn;oe.push(Fr,Sn,tr,0);const wi=Fr-tr,hi=Sn-tr,Pn=Fr+tr,fn=Sn+tr;if(Et=Et&&this.isOffscreen(wi,hi,Pn,fn),It=It||this.isInsideGrid(wi,hi,Pn,fn),!c&&this.grid.hitTestCircle(Fr,Sn,tr,q)&&($t=!0,!W))return{circles:[],offscreen:!1,collisionDetected:$t,occluded:!1}}}}return{circles:!W&&$t||!It?[]:oe,offscreen:Et,collisionDetected:$t,occluded:et.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const N of o){const W=new i.P(N.x+cn,N.y+cn);p=Math.min(p,W.x),v=Math.min(v,W.y),w=Math.max(w,W.x),T=Math.max(T,W.y),c.push(W)}const P=this.grid.query(p,v,w,T).concat(this.ignoredGrid.query(p,v,w,T)),O={},k={};for(const N of P){const W=N.key;if(O[W.bucketInstanceId]===void 0&&(O[W.bucketInstanceId]={}),O[W.bucketInstanceId][W.featureIndex])continue;const H=[new i.P(N.x1,N.y1),new i.P(N.x2,N.y1),new i.P(N.x2,N.y2),new i.P(N.x1,N.y2)];i.bX(c,H)&&(O[W.bucketInstanceId][W.featureIndex]=!0,k[W.bucketInstanceId]===void 0&&(k[W.bucketInstanceId]=[]),k[W.bucketInstanceId].push(W.featureIndex))}return k}insertCollisionBox(o,c,p,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:v,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,p,v,w){const T=c?this.ignoredGrid:this.grid,P={bucketInstanceId:p,featureIndex:v,collisionGroupID:w};for(let O=0;O<o.length;O+=4)T.insertCircle(P,o[O],o[O+1],o[O+2])}projectAndGetPerspectiveRatio(o,c,p,v,w,T,P){const O=[c,p,v,1];let k=!1;v||this.transform.pitch>0?(i.aC(O,O,o),this.fogState&&w&&P.name!=="globe"&&(k=function(H,q,ee,Y,se,oe){const he=oe.calculateFogTileMatrix(se),me=[q,ee,Y];return i.af(me,me,he),Xt(H,i.ag(me),oe.pitch,oe._fov)}(this.fogState,c,p,v,w.toUnwrapped(),this.transform)>.9)):ar(O,O,o);const N=O[3];return{point:new i.P((O[0]/N+1)/2*this.transform.width+cn,(-O[1]/N+1)/2*this.transform.height+cn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/N*.5,1.5),signedDistanceFromCamera:N,occluded:T&&O[2]>N||k}}isOffscreen(o,c,p,v){return p<cn||o>=this.screenRightBoundary||v<cn||c>this.screenBottomBoundary}isInsideGrid(o,c,p,v){return p>=0&&o<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=i.bA([]);return i.br(o,o,[-100,-100,0]),o}}class Es{constructor(o,c,p,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):v&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Wa{constructor(o,c,p,v,w,T=!1){this.text=new Es(o?o.text:null,c,p,w),this.icon=new Es(o?o.icon:null,c,v,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rn{constructor(o,c,p,v=!1){this.text=o,this.icon=c,this.skipFade=p,this.clipped=v}}class Qf{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class gd{constructor(o,c,p,v,w){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=v,this.tileID=w}}class yd{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[o]}}function Uo(f,o,c,p,v){const{horizontalAlign:w,verticalAlign:T}=i.c1(f),P=-(w-.5)*o,O=-(T-.5)*c,k=i.c2(f,p);return new i.P(P+k[0]*v,O+k[1]*v)}function qi(f,o,c,p,v){const w=new i.P(f,o);return c&&w._rotate(p?v:-v),w}class WS{constructor(o,c,p,v,w,T){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Fn(this.transform,w),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new yd(p),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,c,p,v,w=1){const T=p.getBucket(c),P=p.latestFeatureIndex;if(!T||!P||c.fqid!==T.layerIds[0])return;const O=T.layers[0].layout,k=T.layers[0].paint,N=p.collisionBoxArray,W=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),H=p.tileSize/i.al,q=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ee=(Y=p.tileID,se=T.getProjection(),oe=this.transform,se.name===this.projection?oe.calculateProjMatrix(Y.toUnwrapped()):uy(oe,se,Y));var Y,se,oe;const he=O.get("text-pitch-alignment")==="map",me=O.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const de=c.dynamicFilter(),Ae=c.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(p),Se=Jf(ee,p.tileID.canonical,he,me,this.transform,T.getProjection(),be);let xe=null;const ye=T.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(he){const Re=pd(ee,p.tileID.canonical,he,me,this.transform,T.getProjection(),be);xe=i.aB([],this.transform.labelPlaneMatrix,Re)}let Ce=null;de&&p.latestFeatureIndex&&(Ce={unwrappedTileID:q,dynamicFilter:de,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[T.bucketInstanceId]=new gd(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,p.tileID);const[Le,ke]=T.layers[0].layout.get("text-size-scale-range"),Je=i.aA(w,Le,ke),[et,ht]=O.get("icon-size-scale-range"),St=i.aA(w,et,ht),We={bucket:T,layout:O,paint:k,posMatrix:ee,invMatrix:ye,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Se,labelToScreenMatrix:xe,clippingData:Ce,scale:W,textPixelRatio:H,holdingForFade:p.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:i.bK(T.textSizeData,this.transform.zoom,Je),partiallyEvaluatedIconSize:i.bK(T.iconSizeData,this.transform.zoom,St),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(v)for(const Re of T.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:Ze,symbolInstanceEnd:gt}=Re;o.push({sortKey:ot,symbolInstanceStart:Ze,symbolInstanceEnd:gt,parameters:We})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:We})}attemptAnchorPlacement(o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he,me,de,Ae){const{textOffset0:be,textOffset1:Se,crossTileID:xe}=Y,ye=[be,Se],Ce=Uo(o,T,P,ye,O),Le=this.collisionIndex.placeCollisionBox(oe,O,c,p,v,w,qi(Ce.x,Ce.y,k,N,this.transform.angle),ee,W,H,q.predicate);if(me){const ke=oe.getSymbolInstanceIconSize(Ae,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(oe,ke,me,p,v,w,qi(Ce.x,Ce.y,k,N,this.transform.angle),ee,W,H,q.predicate).box.length===0)return}if(Le.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(ke=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ye,width:T,height:P,anchor:o,textScale:O,prevAnchor:ke},this.markUsedJustification(oe,o,Y,he),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,he,Y),this.placedOrientations[xe]=he),{shift:Ce,placedGlyphBoxes:Le}}}placeLayerBucketPart(o,c,p,v,w=1){const{bucket:T,layout:P,paint:O,posMatrix:k,textLabelPlaneMatrix:N,labelToScreenMatrix:W,clippingData:H,textPixelRatio:q,mercatorCenter:ee,invMatrix:Y,holdingForFade:se,collisionBoxArray:oe,partiallyEvaluatedTextSize:he,partiallyEvaluatedIconSize:me,collisionGroup:de,latestFeatureIndex:Ae}=o.parameters,be=P.get("text-optional"),Se=P.get("icon-optional"),xe=P.get("text-allow-overlap"),ye=P.get("icon-allow-overlap"),Ce=P.get("text-rotation-alignment")==="map",Le=P.get("icon-rotation-alignment")==="map",ke=P.get("text-pitch-alignment")==="map",Je=O.get("symbol-z-offset"),et=P.get("symbol-elevation-reference")==="sea",ht=P.get("symbol-placement"),[St,We]=P.get("text-size-scale-range"),[Re,ot]=P.get("icon-size-scale-range"),Ze=i.aA(w,St,We),gt=i.aA(w,Re,ot),Rt=P.get("text-variable-anchor"),$t=Ce&&ht!=="point",It=Le&&ht!=="point",Et=Rt&&T.hasTextData(),tr=T.hasIconTextFit()&&Et&&T.hasIconData();this.transform.setProjection(T.projection);const Jt=Et||$t,zt=It||tr;let Gt=xe&&(ye||!T.hasIconData()||Se),dr=ye&&(xe||!T.hasTextData()||be);const Or=!Je.isConstant();!T.collisionArrays&&oe&&T.deserializeCollisionBoxes(oe),p&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,oe,Ze,gt);const Qr=(rr,vn,Mr)=>{const{crossTileID:An,numVerticalGlyphVertices:Bn}=rr;let kn=null;if(H&&H.dynamicFilterNeedsFeature||Or){const Ci=this.retainedQueryData[T.bucketInstanceId];kn=Ae.loadFeature({featureIndex:rr.featureIndex,bucketIndex:Ci.bucketIndex,sourceLayerIndex:Ci.sourceLayerIndex,layoutVertexArrayOffset:0});const Li=kn.properties?kn.properties.worldview:null;if(T.localizable&&T.worldview&&typeof Li=="string")if(Li==="all")kn.properties.$localized=!0;else{if(!Li.split(",").includes(T.worldview))return;kn.properties.$localized=!0,kn.properties.worldview=T.worldview}}if(H&&!(0,H.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},kn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new i.P(rr.tileAnchorX,rr.tileAnchorY),this.transform.calculateDistanceTileData(H.unwrappedTileID)))return this.placements[An]=new Rn(!1,!1,!1,!0),void c.add(An);const yn=Je.evaluate(kn,{});if(c.has(An))return;if(se)return void(this.placements[An]=new Rn(!1,!1,!1));let Fr=!1,Sn=!1,wi=!0,hi=!1,Pn=!1,fn=null,Br={box:null,offscreen:null,occluded:null},oi={box:null},Di=null,yi=null,qn=null,_s=0,zo=0,no=0;Mr.textFeatureIndex?_s=Mr.textFeatureIndex:rr.useRuntimeCollisionCircles&&(_s=rr.featureIndex),Mr.verticalTextFeatureIndex&&(zo=Mr.verticalTextFeatureIndex);const Ho=T.elevationFeatures?T.elevationFeatures[rr.elevationFeatureIndex]:void 0,Wo=Ci=>{Ci.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Li=this.transform.elevation;Ci.elevation=et?yn:yn+i.bV.getAtTileOffset(Ci.tileID,new i.P(Ci.tileAnchorX,Ci.tileAnchorY),Li,Ho),Ci.elevation+=rr.zOffset},Mo=Mr.textBox;if(Mo){Wo(Mo);const Ci=Zn=>{let Vi=i.bL.horizontal;if(T.allowVerticalPlacement&&!Zn&&this.prevPlacement){const Ti=this.prevPlacement.placedOrientations[An];Ti&&(this.placedOrientations[An]=Ti,Vi=Ti,this.markUsedOrientation(T,Vi,rr))}return Vi},Li=(Zn,Vi)=>{if(T.allowVerticalPlacement&&Bn>0&&Mr.verticalTextBox){for(const Ti of T.writingModes)if(Ti===i.bL.vertical?(Br=Vi(),oi=Br):Br=Zn(),Br&&Br.box&&Br.box.length)break}else Br=Zn()};if(Rt){let Zn=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[An]){const _i=this.prevPlacement.variableOffsets[An];Zn.indexOf(_i.anchor)>0&&(Zn=Zn.filter(fa=>fa!==_i.anchor),Zn.unshift(_i.anchor))}const Vi=(_i,fa,Hd)=>{const Ra=T.getSymbolInstanceTextSize(he,rr,this.transform.zoom,vn),Wd=(_i.x2-_i.x1)*Ra+2*_i.padding,wh=(_i.y2-_i.y1)*Ra+2*_i.padding,tl=rr.hasIconTextFit&&!ye?fa:null;tl&&Wo(tl);let Ll={box:[],offscreen:!1,occluded:!1};const Th=xe?2*Zn.length:Zn.length;for(let Rc=0;Rc<Th;++Rc){const Nl=this.attemptAnchorPlacement(Zn[Rc%Zn.length],_i,ee,Y,Jt,Wd,wh,Ra,Ce,ke,q,k,de,Rc>=Zn.length,rr,vn,T,Hd,tl,he,me);if(Nl&&(Ll=Nl.placedGlyphBoxes,Ll&&Ll.box&&Ll.box.length)){Fr=!0,fn=Nl.shift;break}}return Ll};Li(()=>Vi(Mo,Mr.iconBox,i.bL.horizontal),()=>{const _i=Mr.verticalTextBox;return _i&&Wo(_i),T.allowVerticalPlacement&&!(Br&&Br.box&&Br.box.length)&&Bn>0&&_i?Vi(_i,Mr.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}}),Br&&(Fr=Br.box,wi=Br.offscreen,hi=Br.occluded);const Ti=Ci(!(!Br||!Br.box));if(!Fr&&this.prevPlacement){const _i=this.prevPlacement.variableOffsets[An];_i&&(this.variableOffsets[An]=_i,this.markUsedJustification(T,_i.anchor,rr,Ti))}}else{const Zn=(Vi,Ti)=>{const _i=T.getSymbolInstanceTextSize(he,rr,this.transform.zoom,vn),fa=this.collisionIndex.placeCollisionBox(T,_i,Vi,ee,Y,Jt,new i.P(0,0),xe,q,k,de.predicate);return fa&&fa.box&&fa.box.length&&(this.markUsedOrientation(T,Ti,rr),this.placedOrientations[An]=Ti),fa};Li(()=>Zn(Mo,i.bL.horizontal),()=>{const Vi=Mr.verticalTextBox;return T.allowVerticalPlacement&&Bn>0&&Vi?(Wo(Vi),Zn(Vi,i.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Ci(!!(Br&&Br.box&&Br.box.length))}}if(Di=Br,Fr=Di&&Di.box&&Di.box.length>0,wi=Di&&Di.offscreen,hi=Di&&Di.occluded,rr.useRuntimeCollisionCircles){const Ci=rr.centerJustifiedTextSymbolIndex>=0?rr.centerJustifiedTextSymbolIndex:rr.verticalPlacedTextSymbolIndex,Li=T.text.placedSymbolArray.get(Ci),Zn=i.bM(T.textSizeData,he,Li),Vi=P.get("text-padding");yi=this.collisionIndex.placeCollisionCircles(T,xe,Li,Ci,T.lineVertexArray,T.glyphOffsetArray,Zn,k,N,W,p,ke,de.predicate,rr.collisionCircleDiameter*Zn/i.bY,Vi,this.retainedQueryData[T.bucketInstanceId].tileID),Fr=xe||yi.circles.length>0&&!yi.collisionDetected,wi=wi&&yi.offscreen,hi=yi.occluded}if(Mr.iconFeatureIndex&&(no=Mr.iconFeatureIndex),Mr.iconBox){const Ci=Li=>{Wo(Li);const Zn=rr.hasIconTextFit&&fn?qi(fn.x,fn.y,Ce,ke,this.transform.angle):new i.P(0,0),Vi=T.getSymbolInstanceIconSize(me,this.transform.zoom,rr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Vi,Li,ee,Y,zt,Zn,ye,q,k,de.predicate)};oi&&oi.box&&oi.box.length&&Mr.verticalIconBox?(qn=Ci(Mr.verticalIconBox),Sn=qn.box.length>0):(qn=Ci(Mr.iconBox),Sn=qn.box.length>0),wi=wi&&qn.offscreen,Pn=qn.occluded}const Ks=be||rr.numHorizontalGlyphVertices===0&&Bn===0,da=Se||rr.numIconVertices===0;if(Ks||da?da?Ks||(Sn=Sn&&Fr):Fr=Sn&&Fr:Sn=Fr=Sn&&Fr,Fr&&Di&&Di.box&&this.collisionIndex.insertCollisionBox(Di.box,P.get("text-ignore-placement"),T.bucketInstanceId,oi&&oi.box&&zo?zo:_s,de.ID),Sn&&qn&&this.collisionIndex.insertCollisionBox(qn.box,P.get("icon-ignore-placement"),T.bucketInstanceId,no,de.ID),yi&&(Fr&&this.collisionIndex.insertCollisionCircles(yi.circles,P.get("text-ignore-placement"),T.bucketInstanceId,_s,de.ID),p)){const Ci=T.bucketInstanceId;let Li=this.collisionCircleArrays[Ci];Li===void 0&&(Li=this.collisionCircleArrays[Ci]=new Qf);for(let Zn=0;Zn<yi.circles.length;Zn+=4)Li.circles.push(yi.circles[Zn+0]),Li.circles.push(yi.circles[Zn+1]),Li.circles.push(yi.circles[Zn+2]),Li.circles.push(yi.collisionDetected?1:0)}const Cs=T.projection.name!=="globe";Gt=Gt&&(Cs||!hi),dr=dr&&(Cs||!Pn),this.placements[An]=new Rn(Fr||Gt,Sn||dr,wi||T.justReloaded),c.add(An)},wn=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,wn),T.elevationType==="road"&&T.updateRoadElevation(wn.canonical),T.updateZOffset(),T.sortFeaturesByY){const rr=T.getSortedSymbolIndexes(this.transform.angle);for(let vn=rr.length-1;vn>=0;--vn){const Mr=rr[vn];Qr(T.symbolInstances.get(Mr),Mr,T.collisionArrays[Mr])}T.hasAnyZOffset&&i.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const rr=T.getSortedIndexesByZOffset();for(let vn=0;vn<rr.length;++vn){const Mr=rr[vn];Qr(T.symbolInstances.get(Mr),Mr,T.collisionArrays[Mr])}}else for(let rr=o.symbolInstanceStart;rr<o.symbolInstanceEnd;rr++)Qr(T.symbolInstances.get(rr),rr,T.collisionArrays[rr]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const rr=this.collisionCircleArrays[T.bucketInstanceId];i.bl(rr.invProjMatrix,k),rr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(o,c,p,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O,crossTileID:k}=p,N=i.c3(c),W=v===i.bL.vertical?O:N==="left"?w:N==="center"?T:N==="right"?P:-1;w>=0&&(o.text.placedSymbolArray.get(w).crossTileID=W>=0&&w!==W?0:k),T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=W>=0&&T!==W?0:k),P>=0&&(o.text.placedSymbolArray.get(P).crossTileID=W>=0&&P!==W?0:k),O>=0&&(o.text.placedSymbolArray.get(O).crossTileID=W>=0&&O!==W?0:k)}markUsedOrientation(o,c,p){const v=c===i.bL.horizontal||c===i.bL.horizontalOnly?c:0,w=c===i.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:k}=p,N=o.text.placedSymbolArray;T>=0&&(N.get(T).placedOrientation=v),P>=0&&(N.get(P).placedOrientation=v),O>=0&&(N.get(O).placedOrientation=v),k>=0&&(N.get(k).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(o):1,w=c?c.opacities:{},T=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const O in this.placements){const k=this.placements[O],N=w[O];N?(this.opacities[O]=new Wa(N,v,k.text,k.icon,null,k.clipped),p=p||k.text!==N.text.placed||k.icon!==N.icon.placed):(this.opacities[O]=new Wa(null,v,k.text,k.icon,k.skipFade,k.clipped),p=p||k.text||k.icon)}for(const O in w){const k=w[O];if(!this.opacities[O]){const N=new Wa(k,v,!1,!1);N.isHidden()||(this.opacities[O]=N,p=p||k.text.placed||k.icon.placed)}}for(const O in T)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=T[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c,p,v){v&&(this.lastReplacementSourceUpdateTime=v.updateTime);const w=new Set;for(const T of c){const P=T.getBucket(o);P&&T.latestFeatureIndex&&o.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,w,T,T.collisionBoxArray,p,v,T.tileID,o.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,T.tileID),P.elevationType==="road"&&P.updateRoadElevation(T.tileID.canonical),P.updateZOffset())}}updateBucketOpacities(o,c,p,v,w,T,P,O){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const k=o.layers[0].layout,N=o.layers[0].paint,W=!!o.layers[0].dynamicFilter(),H=new Wa(null,0,!1,!1,!0),q=k.get("text-allow-overlap"),ee=k.get("icon-allow-overlap"),Y=k.get("text-variable-anchor"),se=k.get("text-rotation-alignment")==="map",oe=k.get("text-pitch-alignment")==="map",he=N.get("symbol-z-offset"),me=k.get("symbol-elevation-reference")==="sea",de=!he.isConstant(),Ae=new Wa(null,0,q&&(ee||!o.hasIconData()||k.get("icon-optional")),ee&&(q||!o.hasTextData()||k.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);const be=(xe,ye,Ce)=>{for(let Le=0;Le<ye/4;Le++)xe.opacityVertexArray.emplaceBack(Ce)};let Se=0;T&&o.updateReplacement(P,T);for(let xe=0;xe<o.symbolInstances.length;xe++){const ye=o.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:Le,crossTileID:ke,numIconVertices:Je,tileAnchorX:et,tileAnchorY:ht}=ye;let St=null;const We=this.retainedQueryData[o.bucketInstanceId];de&&ye&&We&&(St=p.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=he.evaluate(St,{}),ot=c.has(ke);let Ze=this.opacities[ke];ot?Ze=H:Ze||(Ze=Ae,this.opacities[ke]=Ze),c.add(ke);const gt=Ce>0||Le>0,Rt=Je>0,$t=this.placedOrientations[ke],It=$t===i.bL.vertical,Et=$t===i.bL.horizontal||$t===i.bL.horizontalOnly;!gt&&!Rt||Ze.isHidden()||Se++;let tr=!1;if((gt||Rt)&&T)for(const Jt of o.activeReplacements){if(i.bZ(Jt,w,i.b_.Symbol,O)||Jt.min.x>et||et>Jt.max.x||Jt.min.y>ht||ht>Jt.max.y)continue;const zt=i.b$(et,ht,P.canonical,Jt.footprintTileId.canonical);if(tr=i.c0(zt,Jt.footprint),tr)break}if(gt){const Jt=tr?au:ps(Ze.text);be(o.text,Ce,It?au:Jt),be(o.text,Le,Et?au:Jt);const zt=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:Gt,centerJustifiedTextSymbolIndex:dr,rightJustifiedTextSymbolIndex:Or,verticalPlacedTextSymbolIndex:Qr}=ye,wn=o.text.placedSymbolArray,rr=zt||It?1:0;Gt>=0&&(wn.get(Gt).hidden=rr),dr>=0&&(wn.get(dr).hidden=rr),Or>=0&&(wn.get(Or).hidden=rr),Qr>=0&&(wn.get(Qr).hidden=zt||Et?1:0);const vn=this.variableOffsets[ke];vn&&this.markUsedJustification(o,vn.anchor,ye,$t);const Mr=this.placedOrientations[ke];Mr&&(this.markUsedJustification(o,"left",ye,Mr),this.markUsedOrientation(o,Mr,ye))}if(Rt){const Jt=tr?au:ps(Ze.icon),{placedIconSymbolIndex:zt,verticalPlacedIconSymbolIndex:Gt}=ye,dr=o.icon.placedSymbolArray,Or=Ze.icon.isHidden()?1:0;zt>=0&&(be(o.icon,Je,It?au:Jt),dr.get(zt).hidden=Or),Gt>=0&&(be(o.icon,ye.numVerticalIconVertices,Et?au:Jt),dr.get(Gt).hidden=Or)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Jt=o.collisionArrays[xe];if(Jt){let zt=new i.P(0,0),Gt=!0;if(Jt.textBox||Jt.verticalTextBox){if(Y){const Or=this.variableOffsets[ke];Or?(zt=Uo(Or.anchor,Or.width,Or.height,Or.textOffset,Or.textScale),se&&zt._rotate(oe?this.transform.angle:-this.transform.angle)):Gt=!1}W&&(Gt=!Ze.clipped),Jt.textBox&&yc(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!Gt||It,Re,me,zt.x,zt.y),Jt.verticalTextBox&&yc(o.textCollisionBox.collisionVertexArray,Ze.text.placed,!Gt||Et,Re,me,zt.x,zt.y)}const dr=Gt&&!!(!Et&&Jt.verticalIconBox);Jt.iconBox&&yc(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,dr,Re,me,ye.hasIconTextFit?zt.x:0,ye.hasIconTextFit?zt.y:0),Jt.verticalIconBox&&yc(o.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!dr,Re,me,ye.hasIconTextFit?zt.x:0,ye.hasIconTextFit?zt.y:0)}}}if(o.fullyClipped=Se===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=xe.invProjMatrix,o.placementViewportMatrix=xe.viewportMatrix,o.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>o}isStale(){return this.stale}setStale(){this.stale=!0}}function yc(f,o,c,p,v,w,T){f.emplaceBack(o?1:0,c?1:0,w||0,T||0,p,v?1:0),f.emplaceBack(o?1:0,c?1:0,w||0,T||0,p,v?1:0),f.emplaceBack(o?1:0,c?1:0,w||0,T||0,p,v?1:0),f.emplaceBack(o?1:0,c?1:0,w||0,T||0,p,v?1:0)}const fy=Math.pow(2,25),_d=Math.pow(2,24),ep=Math.pow(2,17),py=Math.pow(2,16),tp=Math.pow(2,9),fs=Math.pow(2,8),Tl=Math.pow(2,1);function ps(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const o=f.placed?1:0,c=Math.floor(127*f.opacity);return c*fy+o*_d+c*ep+o*py+c*tp+o*fs+c*Tl+o}const au=0;class Qu{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,p,v,w,T){const P=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(P,v,o[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,k)=>O.sortKey-k.sortKey));this._currentPartIndex<P.length;){const O=P[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,p,O.symbolInstanceStart===0,T),this._currentPartIndex++,w())return!0}return!1}}class yo{constructor(o,c,p,v,w,T,P,O,k){this.placement=new WS(o,w,T,P,O,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,c,p,v,w){const T=i.o.now(),P=()=>{const O=i.o.now()-T;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[o[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&O.visibility!=="none"&&(!O.minzoom||O.minzoom<=k)&&(!O.maxzoom||O.maxzoom>k)){const N=O,W=N.layout.get("symbol-z-elevate"),H=N.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=N.layout.get("symbol-z-order"),ee=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&H),Y=N.layout.get("text-allow-overlap")||N.layout.get("icon-allow-overlap")||N.layout.get("text-ignore-placement")||N.layout.get("icon-ignore-placement"),se=ee&&Y,oe=this._inProgressLayer=this._inProgressLayer||new Qu(N),he=i.B(O.source,O.scope);if(oe.continuePlacement(W||se?v[he]:p[he],this.placement,this._showCollisionBoxes,O,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const sa=512/i.al/2;class Sl{constructor(o,c,p){this.tileID=o,this.bucketInstanceId=p,this.index=new i.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=o.canonical.x*i.al,w=o.canonical.y*i.al;for(let T=0;T<c.length;T++){const{key:P,crossTileID:O,tileAnchorX:k,tileAnchorY:N}=c.get(T),W=Math.floor((v+k)*sa),H=Math.floor((w+N)*sa);this.index.add(W,H),this.keys.push(P),this.crossTileIDs.push(O)}this.index.finish()}findMatches(o,c,p){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=sa/Math.pow(2,c.canonical.z-this.tileID.canonical.z),T=c.canonical.x*i.al,P=c.canonical.y*i.al;for(let O=0;O<o.length;O++){const k=o.get(O);if(k.crossTileID)continue;const{key:N,tileAnchorX:W,tileAnchorY:H}=k,q=Math.floor((T+W)*w),ee=Math.floor((P+H)*w),Y=this.index.range(q-v,ee-v,q+v,ee+v).sort((se,oe)=>se-oe);for(const se of Y){const oe=this.crossTileIDs[se];if(this.keys[se]===N&&!p.has(oe)){p.add(oe),k.crossTileID=oe;break}}}}}class lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class my{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(c!==0)for(const p in this.indexes){const v=this.indexes[p],w={};for(const T in v){const P=v[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),w[P.tileID.key]=P}this.indexes[p]=w}this.lng=o}addBucket(o,c,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const v=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>o.overscaledZ)for(const P in T){const O=T[P];O.tileID.isChildOf(o)&&O.findMatches(c.symbolInstances,o,v)}else{const P=T[o.scaledTo(Number(w)).key];P&&P.findMatches(c.symbolInstances,o,v)}}for(let w=0;w<c.symbolInstances.length;w++){const T=c.symbolInstances.get(w);T.crossTileID||(T.crossTileID=p.generate(),v.add(T.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Sl(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[o].delete(p)}removeStaleBuckets(o){let c=!1;for(const p in this.indexes){const v=this.indexes[p];for(const w in v)o[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,v[w]),delete v[w],c=!0)}return c}}class Pa{constructor(){this.layerIndexes={},this.crossTileIDs=new lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,p,v){let w=this.layerIndexes[o.fqid];w===void 0&&(w=this.layerIndexes[o.fqid]=new my);let T=!1;const P={};v.name!=="globe"&&w.handleWrapJump(p);for(const O of c){const k=O.getBucket(o);k&&o.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,k,this.crossTileIDs)&&(T=!0),P[k.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(T=!0),T}pruneUnusedLayers(o){const c={};o.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const qa=771;class Lr{constructor(o,c,p,v){this.blendFunction=o,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=v}}Lr.Replace=[1,0,1,0],Lr.disabled=new Lr(Lr.Replace,i.ao.transparent,[!1,!1,!1,!1]),Lr.unblended=new Lr(Lr.Replace,i.ao.transparent,[!0,!0,!0,!0]),Lr.alphaBlended=new Lr([1,qa,1,qa],i.ao.transparent,[!0,!0,!0,!0]),Lr.alphaBlendedNonPremultiplied=new Lr([770,qa,770,qa],i.ao.transparent,[!0,!0,!0,!0]),Lr.multiply=new Lr([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),Lr.additive=new Lr([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class ir{constructor(o,c,p){this.func=o,this.mask=c,this.range=p}}ir.ReadOnly=!1,ir.ReadWrite=!0,ir.disabled=new ir(519,ir.ReadOnly,[0,1]);const rp=7680;class Tr{constructor(o,c,p,v,w,T){this.test=o,this.ref=c,this.mask=p,this.fail=v,this.depthFail=w,this.pass=T}}Tr.disabled=new Tr({func:519,mask:0},0,0,rp,rp,rp);const eh=1029,np=2305;class br{constructor(o,c,p){this.enable=o,this.mode=c,this.frontFace=p}}function Za(f,o){const c=i.ca(f,3);i.cc(f,o),i.cg(f,3,c)}function gy(f,o){const c=i.c7([]);return i.c8(c,c,-o),i.c9(c,c,-f),c}function ip(f,o){const c=[f[0],f[1],0],p=[o[0],o[1],0];if(i.ag(c)>=1e-15){const T=i.aw([],c);i.c5(p,T,i.bJ(p,T)),o[0]=p[0],o[1]=p[1]}const v=i.bI([],o,f);if(i.c6(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return gy(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}br.disabled=new br(!1,eh,np),br.backCCW=new br(!0,eh,np),br.backCW=new br(!0,eh,2304),br.frontCW=new br(!0,1028,2304),br.frontCCW=new br(!0,1028,np);class ms{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){const c=o instanceof i.ae?o:new i.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=i.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c,p){if(this.orientation=null,!this.position)return;const v=this.position,w=p||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(o)):0),T=i.ae.fromLngLat(o,w),P=[T.x-v.x,T.y-v.y,T.z-v.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ip(P,c)}setPitchBearing(o,c){this.orientation=gy(i.an(o),i.an(-c))}}class op{constructor(o,c){this._transform=i.bA([]),this.orientation=c,this.position=o}get mercatorPosition(){const o=this.position;return new i.ae(o[0],o[1],o[2])}get position(){const o=i.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&i.cg(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||i.c7([]),o&&Za(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=gy(o,c),Za(this._transform,this._orientation)}forward(){const o=i.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=i.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=i.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const p=new Float64Array(16);return i.bl(p,this.getWorldToCamera(o,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,c,p){const v=this.position;i.c5(v,v,-o);const w=new Float64Array(16);return i.bq(w,[p,p,p]),i.br(w,w,v),w[10]*=c,w}getWorldToCamera(o,c){const p=new Float64Array(16),v=new Float64Array(4),w=this.position;return i.cb(v,this._orientation),i.c5(w,w,-o),i.cc(p,v),i.br(p,p,w),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(o,c,p,v){const w=new Float64Array(16);return i.cd(w,o,c,p,v),w}getCameraToClipOrthographic(o,c,p,v,w,T){const P=new Float64Array(16);return i.ce(P,o,c,p,v,w,T),P}getDistanceToElevation(o,c=!1){const p=o===0?0:i.cf(o,c?i.a$(this.position[1]):this.position[1]),v=this.forward();return(p-this.position[2])/v[2]}clone(){return new op([...this.position],[...this.orientation])}}const So={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class sp{constructor(o=0,c=0,p=0,v=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=p,this.right=v}interpolate(o,c,p){return c.top!=null&&o.top!=null&&(this.top=i.ak(o.top,c.top,p)),c.bottom!=null&&o.bottom!=null&&(this.bottom=i.ak(o.bottom,c.bottom,p)),c.left!=null&&o.left!=null&&(this.left=i.ak(o.left,c.left,p)),c.right!=null&&o.right!=null&&(this.right=i.ak(o.right,c.right,p)),this}getCenter(o,c){const p=i.aA((this.left+o-this.right)/2,0,o),v=i.aA((this.top+c-this.bottom)/2,0,c);return new i.P(p,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new sp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ca=15;class yy{constructor(o,c,p,v,w,T,P){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new op,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new yy(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ca}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(o||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);const p=this.getProjection(),v=!i.by(c,p);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});const c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=i.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=i.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let v=0,w=0;for(let T=0;T<c.length;T++){const P=new i.P(c[T][0]*this.width,p+c[T][1]*(this.height-p)),O=o.pointCoordinate(P);if(!O)continue;const k=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);v+=O[3]*k,w+=k}return w===0?NaN:v/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-p,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){const c=this.elevation,p=o.elevation,v=c!=null!=(p!=null)||c&&p&&c.exaggeration()!==p.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!v}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let p;p=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const v=i.ag(i.av([],this._camera.position,p));return i.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!i.cp(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const p=[o.position.x,o.position.y,o.position.z];i.cq(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new ms;return c.position=new i.ae(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!i.cr(o))return!1;i.cs(o,o);const c=i.ct([],[0,0,-1],o),p=i.ct([],[0,-1,0],o);if(p[2]<0)return!1;const v=ip(c,p);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=i.aA(o[2],v/p,v/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,p){this._unmodified=!1,this._edgeInsets.interpolate(o,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new i.cu(0,o)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),w=this.pointCoordinate(new i.P(this.width,this.height)),T=this.pointCoordinate(new i.P(0,this.height)),P=Math.floor(Math.min(p.x,v.x,w.x,T.x)),O=Math.floor(Math.max(p.x,v.x,w.x,T.x)),k=1;for(let N=P-k;N<=O+k;N++)N!==0&&c.push(new i.cu(N,o))}return c}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,c,p,v){let w=[];const T=p!=null,P=!T;if(P&&this.zoom<c||T&&p[0]===0&&p[1]===0)return w;const O=new Set,k=(W,H,q,ee,Y)=>{const se=i.cY(H,W,q,ee,Y);O.has(se)||(w.push(new i.aQ(W,H,q,ee,Y)),O.add(se))};for(let W=0;W<o.length;W++){const H=o[W];if(P&&H.canonical.z!==c||T&&v!==void 0&&v>H.canonical.z)continue;const q=H.canonical,ee=H.overscaledZ,Y=H.wrap,se=1<<q.z,oe=q.x+1<se,he=q.x>0,me=q.y+1<se,de=q.y>0,Ae=H.wrap-(he?0:1),be=H.wrap+(oe?0:1),Se=he?q.x-1:se-1,xe=oe?q.x+1:0;if(T)p[0]<0?(k(ee,be,q.z,xe,q.y),p[1]<0&&me&&(k(ee,Y,q.z,q.x,q.y+1),k(ee,be,q.z,xe,q.y+1)),p[1]>0&&de&&(k(ee,Y,q.z,q.x,q.y-1),k(ee,be,q.z,xe,q.y-1))):p[0]>0?(k(ee,Ae,q.z,Se,q.y),p[1]<0&&me&&(k(ee,Y,q.z,q.x,q.y+1),k(ee,Ae,q.z,Se,q.y+1)),p[1]>0&&de&&(k(ee,Y,q.z,q.x,q.y-1),k(ee,Ae,q.z,Se,q.y-1))):p[1]<0&&me?k(ee,Y,q.z,q.x,q.y+1):de&&k(ee,Y,q.z,q.x,q.y-1);else{const ye=H.visibleQuadrants;1&ye&&(k(ee,Ae,q.z,Se,q.y),de&&(k(ee,Y,q.z,q.x,q.y-1),k(ee,Ae,q.z,Se,q.y-1))),2&ye&&(k(ee,be,q.z,xe,q.y),de&&(k(ee,Y,q.z,q.x,q.y-1),k(ee,be,q.z,xe,q.y-1))),4&ye&&(k(ee,Ae,q.z,Se,q.y),me&&(k(ee,Y,q.z,q.x,q.y+1),k(ee,Ae,q.z,Se,q.y+1))),8&ye&&(k(ee,be,q.z,xe,q.y),me&&(k(ee,Y,q.z,q.x,q.y+1),k(ee,be,q.z,xe,q.y+1)))}}const N=[];for(const W of w)w.some(H=>W.isChildOf(H))||N.push(W);if(w=N.filter(W=>!o.some(H=>!!(W.overscaledZ<c&&H.isChildOf(W))||W.equals(H)||W.isChildOf(H))),P){const W=1<<c,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[W*H.x,W*H.y],ee=4,Y=ee*ee;w=w.filter(se=>{const oe=se.canonical.x+.5-q[0],he=se.canonical.y+.5-q[1];return oe*oe+he*he<Y})}return w}extendTileCoverToNearPlane(o,c,p){const v=[],w=new Set;for(const he of o)w.add(he.key);const T=(he,me,de,Ae,be)=>{const Se=i.cY(me,he,de,Ae,be);w.has(Se)||(v.push(new i.aQ(he,me,de,Ae,be)),w.add(Se))},P=o.reduce((he,me)=>Math.max(he,me.overscaledZ),p),O=1<<p,k=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],N=new i.P(0,0),W=new i.P(0,0),H=(he,me)=>{const de=Math.floor(he[0]),Ae=Math.floor(he[1]),be=(he[0]-de)*i.al,Se=(he[1]-Ae)*i.al,xe=Math.floor(me[0]),ye=Math.floor(me[1]),Ce=(me[0]-xe)*i.al,Le=(me[1]-ye)*i.al;for(let ke=-1;ke<=1;ke++){const Je=de+ke;if(!(Je<0||Je>=O)){N.x=be-ke*i.al,W.x=Ce-(Je-xe)*i.al;for(let et=-1;et<=1;et++){const ht=Ae+et;N.y=Se-et*i.al,W.y=Le-(ht-ye)*i.al,i.cZ(N,W,k)&&T(P,0,p,Je,ht)}}}},q=c.points,ee=q[i.cv],Y=q[i.cw],se=this._projectToGround(ee,q[i.cx]),oe=this._projectToGround(Y,q[i.cy]);return H(ee,se),H(Y,oe),v}_projectToGround(o,c){return i.cz(i.cA(),o,c,o[2]/(o[2]-c[2]))}coveringTiles(o){let c=this.coveringZoomLevel(o);const p=c,v=this.elevation&&this.elevation.exaggeration(),w=v&&!o.isTerrainDEM,T=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);const P=this.locationCoordinate(this.center),O=this.center.lat,k=1<<c,N=[k*P.x,k*P.y,0],W=this.projection.name==="globe",H=!W,q=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,H),ee=W?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=k*i.cf(1,this.center.lat),se=this._camera.position[2]/i.cf(1,this.center.lat),oe=[k*ee.x,k*ee.y,se*(H?1:Y)],he=W||v,me=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),de=this.isLODDisabled(!0)?c:0;let Ae;if(this._elevation&&o.isTerrainDEM)Ae=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Ae=Re?Re.max:this._centerAltitude}else Ae=this._centerAltitude;const be=o.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?i.cC(this):1,xe=Re=>{const Ze=new i.ae(Re.x+25e-6,Re.y,Re.z),gt=new i.ae(Re.x,Re.y+25e-6,Re.z),Rt=Re.toLngLat(),$t=Ze.toLngLat(),It=gt.toLngLat(),Et=this.locationCoordinate(Rt),tr=this.locationCoordinate($t),Jt=this.locationCoordinate(It),zt=Math.hypot(tr.x-Et.x,tr.y-Et.y),Gt=Math.hypot(Jt.x-Et.x,Jt.y-Et.y);return Math.sqrt(zt*Gt)*Se/25e-6},ye=Re=>{const ot=Ae,Ze=be;return{aabb:i.cF(this,k,0,0,0,Re,Ze,ot,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:ot,wrap:Re,fullyVisible:!1}},Ce=[];let Le=[];const ke=c,Je=o.reparseOverscaled?p:c,et=(se-this._centerAltitude)*Y,ht=Re=>{if(!this._elevation||!Re.tileID||!T)return;const ot=this._elevation.getMinMaxForTile(Re.tileID),Ze=Re.aabb;ot?(Ze.min[2]=ot.min,Ze.max[2]=ot.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Re.shouldSplit=We(Re),Re.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},St=(Re,ot)=>{if(.707*ot<Re)return 1;const Ze=ot/Re;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},We=Re=>{if(Re.zoom<de)return!0;if(Re.zoom===ke)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const ot=Re.aabb.distanceX(oe),Ze=Re.aabb.distanceY(oe);let gt=et,Rt=1;if(W){gt=Re.aabb.distanceZ(oe);const Gt=Math.pow(2,Re.zoom),dr=i.a$((Re.y+1)/Gt),Or=i.a$(Re.y/Gt),Qr=Math.min(Math.max(O,dr),Or),wn=i.d1(Qr)/i.d1(O);if(Rt=Qr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wn/this._mercatorScaleRatio),this.zoom<=i.c_&&Re.zoom===ke-1&&wn>=.9)return!0}else if(w&&(gt=Re.aabb.distanceZ(oe)*Y),this.projection.isReprojectedInTileSpace&&p<=5){const Gt=Math.pow(2,Re.zoom),dr=xe(new i.ae((Re.x+.5)/Gt,(Re.y+.5)/Gt));Rt=dr>.85?1:dr}if(!T&&!W){const Gt=Math.sqrt(ot*ot+Ze*Ze+gt*gt);let dr=(1<<ke-Re.zoom)*me*Rt;return dr*=St(Math.max(gt,et),Gt),Gt<dr}let $t=Number.MAX_VALUE,It=0;const Et=Re.aabb.getCorners(),tr=[];for(const Gt of Et){i.av(tr,Gt,oe),W||(w?tr[2]*=Y:tr[2]=et);const dr=i.bJ(tr,this._camera.forward());dr<$t&&($t=dr,It=Math.abs(tr[2]))}let Jt=(1<<ke-Re.zoom)*me*Rt;if(Jt*=St(Math.max(It,et),$t),$t<Jt)return!0;const zt=Re.aabb.closestPoint(N);return zt[0]===N[0]&&zt[1]===N[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ce.push(ye(-Re)),Ce.push(ye(Re));for(Ce.push(ye(0));Ce.length>0;){const Re=Ce.pop(),ot=Re.x,Ze=Re.y;let gt=Re.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!gt){let $t=he?Re.aabb.intersects(q):Re.aabb.intersectsFlat(q);if($t===0&&Rt()){const It=new i.cD(Re.zoom,ot,Ze);$t=i.cE(this,k,It,!0).intersects(q)}if($t===0)continue;gt=$t===2}if(Re.zoom!==ke&&We(Re))for(let $t=0;$t<4;$t++){const It=(ot<<1)+$t%2,Et=(Ze<<1)+($t>>1),tr={aabb:T?Re.aabb.quadrant($t):i.cF(this,k,Re.zoom+1,It,Et,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:It,y:Et,wrap:Re.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};w&&!W&&(tr.tileID=new i.aQ(Re.zoom+1===ke?Je:Re.zoom+1,Re.wrap,Re.zoom+1,It,Et),ht(tr)),Ce.push(tr)}else{const $t=Re.zoom===ke?Je:Re.zoom;if(o.minzoom&&o.minzoom>$t)continue;let It=0;if(!gt){let zt=he?Re.aabb.intersectsPrecise(q):Re.aabb.intersectsPreciseFlat(q);if(zt===0&&Rt()){const Gt=new i.cD(Re.zoom,ot,Ze);zt=i.cE(this,k,Gt,!0).intersectsPrecise(q)}if(zt===0)continue;if(o.calculateQuadrantVisibility)if(q.containsPoint(Re.aabb.center))It=15;else for(let Gt=0;Gt<4;Gt++)Re.aabb.quadrant(Gt).intersects(q)!==0&&(It|=1<<Gt)}const Et=N[0]-(.5+ot+(Re.wrap<<Re.zoom))*(1<<c-Re.zoom),tr=N[1]-.5-Ze,Jt=Re.tileID?Re.tileID:new i.aQ($t,Re.wrap,Re.zoom,ot,Ze);o.calculateQuadrantVisibility&&(Jt.visibleQuadrants=It),Le.push({tileID:Jt,distanceSq:Et*Et+tr*tr})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,ot=this.horizonLineFromTop();Le=Le.filter(Ze=>{const gt=[0,0,0,1],Rt=[i.al,i.al,0,1],$t=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());i.aC(gt,gt,$t),i.aC(Rt,Rt,$t);const It=i.cG([],gt,Rt),Et=i.cH([],gt,Rt),tr=i.c$(It,Et);if(tr===0)return!0;let Jt=!1;const zt=this._elevation;if(zt&&tr>Re&&ot!==0){const Gt=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let dr;o.isTerrainDEM||(dr=zt.getMinMaxForTile(Ze.tileID)),dr||(dr={min:be,max:Ae});const Or=i.cI(this.rotation),Qr=[Or[0]*i.al,Or[1]*i.al,dr.max];i.af(Qr,Qr,Gt),Jt=(1-Qr[1])*this.height*.5<ot}return tr<Re||Jt})}return Le.sort((Re,ot)=>Re.distanceSq-ot.distanceSq).map(Re=>Re.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const c=i.aA(o.lat,-i.cJ,i.cJ),p=this.projection.project(o.lng,c);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let p,v;const w=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;p=(c.x-w.x)/P,v=(c.y-w.y)/P}else{const P=this.pointCoordinate(c),O=this.pointCoordinate(w);p=P.x-O.x,v=P.y-O.y}const T=this.locationCoordinate(o);this.setLocation(new i.ae(T.x-p,T.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,c){return this.projection.locationPoint(this,o,c)}locationPoint3D(o,c){return this.projection.locationPoint(this,o,c,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,c){return this.coordinateLocation(this.pointCoordinate3D(o,c))}locationCoordinate(o,c){const p=c?i.cf(c,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new i.ae(v.x,v.y,p)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const p=c??this._centerAltitude,v=[o.x,o.y,0,1],w=[o.x,o.y,1,1];i.aC(v,v,this.pixelMatrixInverse),i.aC(w,w,this.pixelMatrixInverse);const T=w[3];i.cK(v,v,1/v[3]),i.cK(w,w,1/T);const P=v[2],O=w[2];return{p0:v,p1:w,t:P===O?0:(p-P)/(O-P)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],p=[o.x,o.y,1,1];return i.aC(c,c,this.pixelMatrixInverse),i.aC(p,p,this.pixelMatrixInverse),i.cK(c,c,1/c[3]),i.cK(p,p,1/p[3]),c[2]=i.cf(c[2],this._center.lat)*this.worldSize,p[2]=i.cf(p[2],this._center.lat)*this.worldSize,i.cK(c,c,1/this.worldSize),i.cK(p,p,1/this.worldSize),new i.ax([c[0],c[1],c[2]],i.aw([],i.av([],p,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:p,t:v}=o,w=i.cf(c[2],this._center.lat),T=i.cf(p[2],this._center.lat);return new i.ae(i.ak(c[0],p[0],v)/this.worldSize,i.ak(c[1],p[1],v)/this.worldSize,i.ak(w,T,v))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o,c){if(!this.elevation)return this.pointCoordinate(o,c);let p=this.projection.pointCoordinate3D(this,o.x,o.y);if(p)return new i.ae(p[0],p[1],p[2]);let v=0,w=this.horizonLineFromTop();if(o.y>w)return this.pointCoordinate(o,c);const T=.02*w,P=o.clone();for(let O=0;O<10&&w-v>T;O++){P.y=i.ak(v,w,.66);const k=this.projection.pointCoordinate3D(this,P.x,P.y);k?(w=P.y,p=k):v=P.y}return p?new i.ae(p[0],p[1],p[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(o);const c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,p+o.toAltitude(),1];return i.aC(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new i.P(c,o)),T=this.pointLocation3D(new i.P(v,o)),P=this.pointLocation3D(new i.P(v,p)),O=this.pointLocation3D(new i.P(c,p));let k=Math.min(w.lng,T.lng,P.lng,O.lng),N=Math.max(w.lng,T.lng,P.lng,O.lng),W=Math.min(w.lat,T.lat,P.lat,O.lat),H=Math.max(w.lat,T.lat,P.lat,O.lat);const q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Y=(se,oe,he,me,de)=>{const Ae=(se+he)/2,be=(oe+me)/2,Se=new i.P(Ae,be),{lng:xe,lat:ye}=this.pointLocation3D(Se),Ce=Math.max(0,k-xe,W-ye,xe-N,ye-H);k=Math.min(k,xe),N=Math.max(N,xe),W=Math.min(W,ye),H=Math.max(H,ye),(de<ee||Ce>q)&&(Y(se,oe,Ae,be,de+1),Y(Ae,be,he,me,de+1))};if(Y(c,o,v,o,1),Y(v,o,v,p,1),Y(v,p,c,p,1),Y(c,p,c,o,1),this.projection.name==="globe"){const[se,oe]=i.cM(this);se?(H=90,N=180,k=-180):oe&&(W=-90,N=180,k=-180)}return new i.aI(new i.aT(k,W),new i.aT(N,H))}_getBoundsRectangular(o,c){const{top:p,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,P=new i.P(v,p),O=new i.P(T,p),k=new i.P(T,w),N=new i.P(v,w);let W=this.pointCoordinate(P,o),H=this.pointCoordinate(O,o);const q=this.pointCoordinate(k,c),ee=this.pointCoordinate(N,c),Y=(se,oe)=>(oe.y-se.y)/(oe.x-se.x);return W.y>1&&H.y>=0?W=new i.ae((1-ee.y)/Y(ee,W)+ee.x,1):W.y<0&&H.y<=1&&(W=new i.ae(-ee.y/Y(ee,W)+ee.x,0)),H.y>1&&W.y>=0?H=new i.ae((1-q.y)/Y(q,H)+q.x,1):H.y<0&&W.y<=1&&(H=new i.ae(-q.y/Y(q,H)+q.x,0)),new i.aI().extend(this.coordinateLocation(W)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=o.visibleDemTiles.reduce((p,v)=>{if(v.dem){const w=v.dem.tree;p.min=Math.min(p.min,w.minimums[0]),p.max=Math.max(p.max,w.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){const c=o.key,p=this._distanceTileDataCache;if(p[c])return p[c];const v=o.canonical,w=1/this.height,T=this.cameraWorldSize,P=T/this.zoomScale(v.z),O=(v.x+Math.pow(2,v.z)*o.wrap)*P,k=v.y*P,N=this.point;N.x*=T/this.worldSize,N.y*=T/this.worldSize;const W=this.angle,H=Math.sin(-W),q=-Math.cos(-W);return p[c]={bearing:[H,q],center:[(N.x-O)*w,(N.y-k)*w],scale:P/i.al*w},p[c]}calculateFogTileMatrix(o){const c=o.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return i.aB(v,this.worldToFogMatrix,v),p[c]=new Float32Array(v),p[c]}calculateProjMatrix(o,c=!1,p=!1){const v=o.key;let w;if(w=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const T=this.calculatePosMatrix(o,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.aB(T,P,T),w[v]=new Float32Array(T),w[v]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const v=i.cN(o,this);return p[c]=v,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,c=i.bq([],[o,o,o]);return i.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const c=i.cf(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),v=this._camera.forward(),w=i.cf(1,this._center.lat);p[2]/=w,v[2]/=w,i.aw(v,v);const T=o.raycast(p,v,o.exaggeration());if(T){const P=i.bH([],p,v,T),O=new i.ae(P[0],P[1],i.cf(P[2],i.a$(P[1]))),k=(O.z+i.ag([O.x-p[0],O.y-p[1],O.z-p[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const c=this._elevation,p=i.cf(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(p),w=c.getAtPointOrZero(new i.ae(...v)),T=this.pixelsPerMeter/this.worldSize*w,P=this._minimumHeightOverTerrain(),O=v[2]-T;if(O<=P)if(O<0||o){const k=this.locationCoordinate(this._center,this._centerAltitude),N=[v[0],v[1],k.z-v[2]],W=i.ag(N);N[2]-=(P-O)/this._pixelsPerMercatorPixel;const H=i.ag(N);if(H===0)return;i.c5(N,N,W/H*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],k.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const H=this.center;return H.lat=i.aA(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(H.lng=i.aA(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:v}=this.point;let w=0,T=p,P=v;const O=this.width/2,k=this.height/2,N=this.worldMinY*this.scale,W=this.worldMaxY*this.scale;if(v-k<N&&(P=N+k),v+k>W&&(P=W-k),W-N<this.height&&(w=Math.max(w,this.height/(W-N)),P=(W+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,ee=this.worldSize/2-(H+q)/2;T=(p+ee+this.worldSize)%this.worldSize-ee,T-O<H&&(T=H+O),T+O>q&&(T=q-O),q-H<this.width&&(w=Math.max(w,this.width/(q-H)),T=(q+H)/2)}T===p&&P===v||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(T,P))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));const v=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,w);let P;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-o.x/this.width,O[9]=2*o.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=ye*this.aspect,Le=-Ce,ke=-ye;Ce-=o.x,Le-=o.x,ye+=o.y,ke+=o.y,P=this._camera.getCameraToClipOrthographic(Le,Ce,ke,ye,this._nearZ,this._farZ),((Je,et,ht,St)=>{for(let We=0;We<16;We++)Je[We]=i.ak(et[We],ht[We],St)})(P,P,O,i.d0(this.pitch>=Ca?1:this.pitch/Ca))}else P=O;const k=i.cP([],O,T);let N=i.cP([],P,T);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),Ce=i.bA([]);i.br(Ce,Ce,[ye.x*this.worldSize,ye.y*this.worldSize,0]),i.aB(Ce,Ce,i.cQ(this)),i.br(Ce,Ce,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),i.aB(N,N,Ce),i.aB(k,k,Ce),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],N,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=N,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),c){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-o.x/this.width,ye[9]=2*o.y/this.height,this.expandedFarZProjMatrix=i.cP([],ye,T)}else this.expandedFarZProjMatrix=this.projMatrix;const W=i.bl([],P);this.frustumCorners=i.cT.fromInvProjectionMatrix(W,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const H=new Float32Array(16);i.bA(H),i.cS(H,H,[1,-1,1]),i.cU(H,H,this._pitch),i.bB(H,H,this.angle);const q=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(q);const ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-o.x/this.width,q[9]=2*(o.y+ee)/this.height,this.skyboxMatrix=i.aB(H,q,H);const Y=this.point,se=Y.x,oe=Y.y,he=this.width%2/2,me=this.height%2/2,de=Math.cos(this.angle),Ae=Math.sin(this.angle),be=se-Math.round(se)+de*he+Ae*me,Se=oe-Math.round(oe)+de*me+Ae*he,xe=new Float64Array(N);if(i.br(xe,xe,[be>.5?be-1:be,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=xe,N=i.bC(),i.cS(N,N,[this.width/2,-this.height/2,1]),i.br(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=i.bC(),i.cS(N,N,[1,-1,1]),i.br(N,N,[-1,-1,0]),i.cS(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},N=i.bl(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(ye,ye,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[o,o,c];i.c5(w,w,v),i.c5(p,p,-1),i.cW(p,p,w);const T=i.bC();i.br(T,T,p),i.cS(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,v)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-p[0]*w,v.y/this.worldSize-p[1]*w,o/this.worldSize*this._centerAltitude-p[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],v=o[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((c-p)/v,1)),this._camera.position=i.bH([],this._camera.position,o,w),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:v}=this._camera.getPitchBearing(),w=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),P=Math.max((o[2]-w)/Math.cos(p),T),O=this._zoomFromMercatorZ(P);i.bH(o,o,c,P),this._pitch=i.aA(p,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(v,-Math.PI,Math.PI),this._setZoom(i.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,p=i.cL,v=0,w=1/0;for(;p-c>1e-6&&p>c;){const T=c+.5*(p-c),P=this.tileSize*Math.pow(2,T),O=this.getCameraToCenterDistance(this.projection,T,P),k=this.scaleZoom(O/(Math.max(0,o)*this.tileSize)),N=Math.abs(T-k);N<w&&(w=N,v=T),T<k?c=T:p=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){const p=Math.min(o.x,c.x),v=Math.max(o.x,c.x),w=Math.min(o.y,c.y),T=Math.max(o.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new i.P(p,w),new i.P(v,T),new i.P(p,T),new i.P(v,w)],O=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const N of P){const W=this.pointRayIntersection(N);if(W.t<0)return!0;const H=this.rayIntersectionCoordinate(W);if(H.x<O||H.y<0||H.x>k||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(o,c){const p=i.ag(i.av([],this._camera.position,o)),v=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([c,p,v],w){const T=[c,p,v,1];i.aC(T,T,w);const P=T[3]=Math.max(T[3],1e-6);return T[0]/=P,T[1]/=P,T[2]/=P,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,o))}}getCameraToCenterDistance(o,c=this.zoom,p=this.worldSize){const v=i.cO(o,c,this.width,this.height,1024),w=o.pixelSpaceConversion(this.center.lat,p,v);let T=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(T=i.ak(1,T,i.d0(this.pitch>=Ca?1:this.pitch/Ca))),T}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(o,o,this.globeMatrix),o}getFrustum(o){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const _c=(f,o)=>{if(o>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),o<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?i.ah(60,45,c.pitch):i.ah(30,15,c.pitch),w=c._farZ-c._nearZ,T=o*c.height,P=((1-(O=v))*c.cameraToCenterDistance+O*(c._farZ+T))*p;var O;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(P-c._nearZ)/w,(P-T-c._nearZ)/w]}}},aa=2048;class vd{constructor(o,c){this.aabb=o,this.lastCascade=c}}class qS{add(o,c){const p=this.receivers[o.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[o.key]=new vd(c,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,c,p){const v=i.d9.fromPoints(o.points);let w=0;for(const T in this.receivers){const P=this.receivers[T];if(!P||!v.intersectsAabb(P.aabb))continue;P.aabb.min=v.closestPoint(P.aabb.min),P.aabb.max=v.closestPoint(P.aabb.max);const O=P.aabb.getCorners();for(let k=0;k<p.length;k++){let N=!0;for(const W of O){const H=[W[0]*c,W[1]*c,W[2]];if(i.af(H,H,p[k].matrix),H[0]<-1||H[0]>1||H[1]<-1||H[1]>1){N=!1;break}}if(P.lastCascade=k,w=Math.max(w,k),N)break}}return w+1}}class th{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new qS,this._depthMode=new ir(o.context.gl.LEQUAL,ir.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=p.style.order.reduce((ee,Y)=>{const se=p.style._mergedLayers[Y];return ee+(se.hasShadowPass()&&!se.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=p.context,T=aa,P=aa;if(this._cascades.length===0||aa!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<2;++ee){const Y=p._shadowMapDebug,se=w.gl,oe=w.createFramebuffer(T,P,Y?1:0,"texture"),he=new i.T(w,{width:T,height:P,data:null},se.DEPTH_COMPONENT16);if(oe.depthAttachment.set(he.texture),Y){const me=new i.T(w,{width:T,height:P,data:null},se.RGBA8);oe.colorAttachment0.set(me.texture)}this._cascades.push({framebuffer:oe,texture:he,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=bd(c);let O=0;if(o.elevation){const ee=o.elevation,Y=[1e4,-1e4];ee.visibleDemTiles.filter(se=>se.dem).forEach(se=>{const oe=se.dem.tree;Y[0]=Math.min(Y[0],oe.minimums[0]),Y[1]=Math.max(Y[1],oe.maximums[0])}),Y[0]!==1e4&&(O=(Y[1]-Y[0])*ee.exaggeration())}const k=1.5*o.cameraToCenterDistance,N=3*k,W=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){const Y=this._cascades[ee];let se=o.height/50,oe=1;ee===0?oe=k:(se=k,oe=N);const[he,me]=vc(o,this.shadowDirection,se,oe,aa,O);Y.scale=o.scale,Y.matrix=he,Y.boundingSphereRadius=me,i.bl(W,Y.matrix),Y.frustum=i.cB.fromInvProjectionMatrix(W,1,0,!0),Y.far=oe}const H=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[H].far,this._cascades[H].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=aa,this._uniformValues.u_shadowmap_0=So.ShadowMap0,this._uniformValues.u_shadowmap_1=So.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const ee of this._groundShadowTiles){let Y={min:0,max:0};if(q){const se=q.getMinMaxForTile(ee);se&&(Y=se)}this.addShadowReceiver(ee.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,c){if(!this.enabled)return;const p=this.painter,v=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),v.viewport.set([0,0,aa,aa]);for(let w=0;w<this._numCascadesToRender;++w){p.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:i.ao.white,depth:1});for(const T of o.order){const P=o._mergedLayers[T];if(!P.hasShadowPass()||P.isHidden(p.transform.zoom))continue;const O=o.getLayerSourceCache(P),k=O?c[O.id]:void 0;(P.type==="model"||k&&k.length)&&p.renderLayer(p,O,P,k)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,c=o.style,p=o.context,v=p.gl,w=c.directionalLight,T=c.ambientLight;if(!w||!T)return;const P=[],O=_c(o,o.longestCutoffRange);O.shouldRenderCutoff&&P.push("RENDER_CUTOFF"),P.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&P.push("NORMAL_OFFSET");const k=El(c,w,T),N=new ir(v.LEQUAL,ir.ReadOnly,o.depthRangeFor3D),W=new Tr({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const H of this._groundShadowTiles){const q=H.toUnwrapped(),ee=o.isTileAffectedByFog(H),Y=o.getOrCreateProgram("groundShadow",{defines:P,overrideFog:ee});this.setupShadows(q,Y),o.uploadCommonUniforms(p,Y,q,null,O);const se={u_matrix:o.transform.calculateProjMatrix(q),u_ground_shadow_factor:k};Y.draw(o,v.TRIANGLES,N,W,Lr.multiply,br.disabled,se,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Lr.unblended:Lr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const c=this.painter.transform,p=c.calculatePosMatrix(o,c.worldSize);return i.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(o){const c=i.bz(o);return i.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,o),c}setupShadows(o,c,p){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,T=w.gl,P=this._uniformValues,O=new Float64Array(16),k=v.calculatePosMatrix(o,v.worldSize);for(let N=0;N<this._cascades.length;N++)i.aB(O,this._cascades[N].matrix,k),P[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),w.activeTexture.set(T.TEXTURE0+So.ShadowMap0+N),this._cascades[N].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const N=i.d7(o.canonical),W=2/v.tileSize*i.al/aa,H=W*this._cascades[0].boundingSphereRadius,q=W*this._cascades[this._cascades.length-1].boundingSphereRadius,ee=(p==="vector-tile"?1:3)*function(Y,se,oe,he,me){const de=i.aA((Y-22)/-22,0,1);return .125*(1-de)+4*de}(v.zoom);P.u_shadow_normal_offset=[N,H*ee,q*ee],P.u_shadow_bias=[1e-4,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,P)}setupShadowsFromMatrix(o,c,p=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,T=this._uniformValues,P=new Float64Array(16);for(let O=0;O<2;O++)i.aB(P,this._cascades[O].matrix,o),T[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),v.activeTexture.set(w.TEXTURE0+So.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);this.useNormalOffset=p,p?(T.u_shadow_normal_offset=[1,3,3],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,c,p,v){if(v[2]>=0)return{};const w=function(O,k,N){const W=N/(1<<O.canonical.z);return new i.d9([O.canonical.x*W+O.wrap*N,O.canonical.y*W+O.wrap*N,0],[(O.canonical.x+1)*W+O.wrap*N,(O.canonical.y+1)*W+O.wrap*N,k])}(o,c,p).getCorners(),T=c/-v[2];v[0]<0?(i.d8(w[0],w[0],[v[0]*T,0,0]),i.d8(w[3],w[3],[v[0]*T,0,0])):v[0]>0&&(i.d8(w[1],w[1],[v[0]*T,0,0]),i.d8(w[2],w[2],[v[0]*T,0,0])),v[1]<0?(i.d8(w[0],w[0],[0,v[1]*T,0]),i.d8(w[1],w[1],[0,v[1]*T,0])):v[1]>0&&(i.d8(w[2],w[2],[0,v[1]*T,0]),i.d8(w[3],w[3],[0,v[1]*T,0]));const P={};return P.vertices=w,P.planes=[xd(w[1],w[0],w[4]),xd(w[2],w[1],w[5]),xd(w[3],w[2],w[6]),xd(w[0],w[3],w[7])],P}addShadowReceiver(o,c,p){this._receivers.add(o,i.d9.fromTileIdAndHeight(o,c,p))}getMaxCascadeForTile(o){const c=this._receivers.get(o);return c&&c.lastCascade?c.lastCascade:0}}function xd(f,o,c){const p=i.av([],c,o),v=i.av([],f,o),w=i.bI([],p,v),T=i.ag(w);return T===0?[0,0,1,0]:(i.c5(w,w,1/T),[w[0],w[1],w[2],-i.bJ(w,o)])}function bd(f){const o=f.properties.get("direction"),c=i.d4(o.x,o.y,o.z);c[2]=i.aA(c[2],0,75);const p=i.d6([c[0],c[1],c[2]]);return i.d5(p.x,p.y,p.z)}function El(f,o,c){const p=o.properties.get("color-use-theme")==="none",v=o.properties.get("color"),w=o.properties.get("intensity"),T=o.properties.get("direction"),P=[T.x,T.y,T.z],O=c.properties.get("color-use-theme")==="none",k=c.properties.get("color"),N=c.properties.get("intensity"),W=Math.max(i.bJ([0,0,1],P),0),H=[0,0,0];i.c5(H,k.toPremultipliedRenderColor(O?null:f.getLut(o.scope)).toArray01Linear().slice(0,3),N);const q=[0,0,0];return i.c5(q,v.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),W*w),i.db([H[0]>0?H[0]/(H[0]+q[0]):0,H[1]>0?H[1]/(H[1]+q[1]):0,H[2]>0?H[2]/(H[2]+q[2]):0])}function vc(f,o,c,p,v,w){const T=f.zoom,P=f.scale,O=f.worldSize,k=1/O,N=f.aspect,W=Math.sqrt(1+N*N)*Math.tan(.5*f.fovX),H=W*W,q=p-c,ee=p+c;let Y,se;H>q/ee?(Y=p,se=p*W):(Y=.5*ee*(1+H),se=.5*Math.sqrt(q*q+2*(p*p+c*c)*H+ee*ee*H*H));const oe=f.projection.pixelsPerMeter(f.center.lat,O),he=f._camera.getCameraToWorldMercator(),me=[0,0,-Y*k];i.af(me,me,he);let de=se*k;const Ae=f._edgeInsets;if(!(Ae.left===0&&Ae.top===0&&Ae.right===0&&Ae.bottom===0||Ae.left===Ae.right&&Ae.top===Ae.bottom)){const gt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?oe:1),Rt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);Rt[8]=2*-f.centerOffset.x/f.width,Rt[9]=2*f.centerOffset.y/f.height;const $t=new Float64Array(16);i.cP($t,Rt,gt);const It=new Float64Array(16);i.bl(It,$t);const Et=i.cB.fromInvProjectionMatrix(It,O,T,!0);for(const tr of Et.points){const Jt=((be=tr)[0]/=P,be[1]/=P,be[2]=i.cf(be[2],f._center.lat),be);de=Math.max(de,i.c6(i.da([],me,Jt)))}}var be;de*=v/(v-1);const Se=Math.acos(o[2]),xe=Math.atan2(-o[0],-o[1]),ye=new op;ye.position=me,ye.setPitchBearing(Se,xe);const Ce=ye.getWorldToCamera(O,oe),Le=de*O,ke=Math.min(f._mercatorZfromZoom(17)*O*-2,-2*Le),Je=ye.getCameraToClipOrthographic(-Le,Le,-Le,Le,ke,(Le+w*oe)/o[2]),et=new Float64Array(16);i.aB(et,Je,Ce);const ht=i.d5(Math.floor(1e6*me[0])/1e6*O,Math.floor(1e6*me[1])/1e6*O,0),St=.5*v,We=[0,0,0];i.af(We,ht,et),i.c5(We,We,St);const Re=[Math.floor(We[0]),Math.floor(We[1]),Math.floor(We[2])],ot=[0,0,0];i.av(ot,We,Re),i.c5(ot,ot,-1/St);const Ze=new Float64Array(16);return i.bA(Ze),i.br(Ze,Ze,ot),i.aB(et,Ze,et),[et,Le]}class ZS extends i.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,c){return i.dc(this.requestManager.transformRequest(c,i.R.Model).url).then(p=>{if(!p)return;const v=i.dd(p),w=new i.de(o,c,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(p=>{if(p&&p.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${o} from ${c}: ${p.message}`)))})}load(o,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const v=Object.keys(o),w=[],T=[];for(const P of v){const O=o[P];this.hasURLBeenRequested(O)&&!p.forceReload||(this.modelByURL[O]={modelId:P,scope:c},w.push(this.loadModel(P,O)),T.push(P)),this.models[c][P]||(this.models[c][P]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+T.length,Promise.allSettled(w).then(P=>{for(let O=0;O<P.length;O++){const{status:k}=P[O];if(k==="rejected")continue;const{value:N}=P[O];this.models[c][T[O]]||(this.models[c][T[O]]={model:null,numReferences:1}),this.models[c][T[O]].model=N}this.numModelsLoading[c]-=T.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(P=>{this.fire(new i.y(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(o,c):this.getModelByURL(this.modelUris[c][o]))}getModel(o,c){return this.models[c]||(this.models[c]={}),this.models[c][o]?this.models[c][o].model:void 0}getModelByURL(o){if(!o)return null;const c=this.modelByURL[o];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(o,c){return this.models[c]&&this.models[c][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const v=this.requestManager.normalizeModelURL(c);if((this.hasModel(o,p,{exactIdMatch:!0})||this.hasModelBeenAdded(o,p))&&this.modelUris[p][o]===v)this.models[p][o].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:w,modelId:T}=this.modelByURL[v];this.models[w][T].numReferences++}else this.modelUris[p][o]=v,this.load({[o]:this.modelUris[p][o]},p)}addModelURLs(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const v in o)p[v]=this.requestManager.normalizeModelURL(o[v])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const v of o)this.hasModel(v,c,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[c][v].numReferences++:this.modelUris[c][v]&&!this.hasURLBeenRequested(v)?p[v]=this.modelUris[c][v]:!this.hasURLBeenRequested(v)&&i.df(v,!1)&&(this.modelUris[c][v]=this.requestManager.normalizeModelURL(v),p[v]=this.modelUris[c][v]);this.load(p,c)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,c,p=!1,v=!1){if(this.models[c]&&this.models[c][o]&&(this.models[c][o].numReferences--,this.models[c][o].numReferences===0||v)){const w=this.modelUris[c][o];p||delete this.modelUris[c][o],delete this.modelByURL[w];const T=this.models[c][o].model;if(!T)return;delete this.models[c][o],T.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const c of Object.keys(this.models[o])){const p=this.models[o][c].model;delete this.models[o][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(o.context)}}const _y=i.a6.colorTheme,XS=new i.a9({data:new i.aa(_y.data)});function hx(f){if(!f.metadata||!f.metadata.content_area)return;const o=i.o.devicePixelRatio,{left:c,top:p,width:v,height:w}=f.metadata.content_area,T=c*o,P=p*o;return[T,P,T+v*o,P+w*o]}function dx(f){if(f)return f.map(([o,c])=>[o*i.o.devicePixelRatio,c*i.o.devicePixelRatio])}class vy{constructor(o,c,p){this.id=o,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return o;const p=this.sourceCache.getSource();if(!(p instanceof Qo))return o;const v=c.map(T=>this.sourceCache.getTile(T)),w=p.getImages(v,Array.from(this.pendingRequests));for(const[T,P]of w)o.set(i.I.from({name:T,iconsetId:this.id}),P),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),o}}const xc=(f,o)=>ge(f,o&&o.filter(c=>c.identifier!=="source.canvas")),fx=i.aH(gn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),px=i.aH(gn,["setCenter","setZoom","setBearing","setPitch"]),ap=new Set(["background","sky","slot","custom"]),bc={version:8,layers:[],sources:{}},wd={duration:300,delay:0};class la extends i.E{constructor(o,c={}){super(),this.map=o,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},wd),this._buildingIndex=new HS(this),this.crossTileSymbolIndex=new Pa,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Kn,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new ds(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.di(o._requestManager,c.localFontFamily?i.dj.all:c.localIdeographFontFamily?i.dj.ideographs:i.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new ZS(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());const p=this;this._rtlTextPluginCallback=la.registerForPluginStateChange(v=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,T)=>{if(i.dl(w),T&&T.every(P=>P))for(const P in p._sourceCaches){const O=p._sourceCaches[P],k=O.getSource().type;k!=="vector"&&k!=="geojson"||O.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===w.id&&this._validateLayer(P)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(i.h(o))return o;const c=i.dm(o);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.dn(JSON.stringify(o))}`}_diffStyle(o,c,p){this.globalId=this._getGlobalId(o);const v=(w,T)=>{try{T(null,this.setState(w,p))}catch(P){T(P,!1)}};if(typeof o=="string"){const w=this.map._requestManager.normalizeStyleURL(o),T=this.map._requestManager.transformRequest(w,i.R.Style);i.m(T,(P,O)=>{P?this.fire(new i.y(P)):O&&v(O,c)})}else typeof o=="object"&&v(o,c)}loadURL(o,c={}){this.fire(new i.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!i.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,c.accessToken),this.resolvedImports.add(o);const v=this.importsCache.get(o);if(v)return this._load(v,p);const w=this.map._requestManager.transformRequest(o,i.R.Style);this._request=i.m(w,(T,P)=>{if(this._request=null,T)this.fire(new i.y(T));else if(P)return this.importsCache.set(o,P),this._load(P,p)})}loadJSON(o,c={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=i.o.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(bc,!1)}_loadImports(o,c,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of o){const T=this._createFragmentStyle(w),P=new Promise(N=>{T.once("style.import.load",N),T.once("error",N)}).then(()=>this.mergeAll());if(v.push(P),this.resolvedImports.has(w.url)){T.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(T.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(T.globalId=null)):w.url?T.loadURL(w.url,{validate:c}):T.loadEmpty();const k={style:T,id:w.id,config:w.config};if(p){const N=this.fragments.findIndex(({id:W})=>W===p);this.fragments=this.fragments.slice(0,N).concat(k).concat(this.fragments.slice(N))}else this.fragments.push(k)}return Promise.allSettled(v)}getImportGlobalIds(o=this,c=new Set){for(const p of o.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(o){const c=this.scope?i.B(o.id,this.scope):o.id;let p;const v=this._initialConfig&&this._initialConfig[c];(o.config||v)&&(p=Object.assign({},o.config,v));const w=new la(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,c){if(this._isInternalStyle(o)){const w=Object.assign({},bc,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(w,c)}if(this.updateConfig(this._config,o.schema),c&&xc(this,Yn(o)))return;this._loaded=!0,this.stylesheet=i.dp(o);const p=()=>{for(const O in o.sources)this.addSource(O,o.sources[O],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const O in o.iconsets)this.addIconset(O,o.iconsets[O]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const w=ud(this.stylesheet.layers);if(this._order=w.map(O=>O.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new je(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new je(this.stylesheet.light)),this._layers={};for(const O of w){const k=i.du(O,this.scope,this._styleColorTheme.lut,this.options);k.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(k.fqid),this._hasAppearances=this._hasAppearances||k.getAppearances().length!==0,k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const N=this.getOwnLayerSourceCache(k),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&k.canCastShadows()&&W&&(N.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const P=this.isRootStyle();o.imports?this._loadImports(o.imports,c).then(()=>{this._reloadImports(),this.fire(new i.z(P?"style.load":"style.import.load"))}).catch(O=>{this.fire(new i.y(new Error("Failed to load imports",O))),this.fire(new i.z(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{p()}).catch(T=>{i.w(`Couldn't load color theme from the stylesheet: ${T}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,c,p,v,w,T,P,O,k,N;const W={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(H=>{if(H.stylesheet){if(H.light!=null&&(o=H.light),H.stylesheet.lights)for(const q of H.stylesheet.lights)q.type==="ambient"&&H.ambientLight!=null&&(c=H.ambientLight),q.type==="directional"&&H.directionalLight!=null&&(p=H.directionalLight);v=this._prioritizeTerrain(v,H.terrain,H.stylesheet.terrain),H.stylesheet.fog&&H.fog!=null&&(w=H.fog),H.stylesheet.snow&&H.snow!=null&&(T=H.snow),H.stylesheet.rain&&H.rain!=null&&(P=H.rain),H.stylesheet.camera!=null&&(N=H.stylesheet.camera),H.stylesheet.projection!=null&&(O=H.stylesheet.projection),H.stylesheet.transition!=null&&(k=H.stylesheet.transition),W[H.scope]=H._styleColorTheme}}),this.light=o,this.ambientLight=c,this.directionalLight=p,this.fog=w,this.snow=T,this.rain=P,this._styleColorThemeForScope=W,v===null?delete this.terrain:this.terrain=v,this.camera=N||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},wd,k),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const c=p=>{for(const v of p.fragments)c(v.style);o(p)};c(this)}_prioritizeTerrain(o,c,p){const v=o&&o.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:v?o:null:c!=null&&(!o||v||c&&c.drapeRenderMode===1)?c:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(o=c.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},c={},p={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const T=i.B(w,v.scope);o[T]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const T=i.B(w,v.scope);c[T]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const T=i.B(w,v.scope);p[T]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const c of Object.values(o.stylesheet.indoor)){const p=c,v=i.B(p.sourceId,o.scope);this._mergedIndoor[v]=new Set(p.sourceLayers||[])}})}mergeLayers(){const o={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const P of T._order){const O=T._layers[P];if(O.type==="slot"){const k=i.dq(P);if(o[k])continue;o[k]=[]}O.slot&&o[O.slot]?o[O.slot].push(O):c.push(O)}}),this._mergedOrder=[];let v=-1;const w=(T=[])=>{for(const P of T)if(P.type==="slot"){const O=i.dq(P.id);o[O]&&w(o[O]),this._mergedSlots.push(O)}else{const O=i.B(P.id,P.scope);this._mergedOrder.push(O),p[O]=P,P.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),P.type==="circle"&&(this._hasCircleLayers=!0),P.type==="symbol"&&(this._hasSymbolLayers=!0),P.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(c),this._has3DLayers){const T={};for(let P=0;P<this._mergedOrder.length;++P){const O=this._mergedOrder[P];T[O]=P===v?1:P<v?p[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((P,O)=>T[P]-T[O])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(c,p,v,w){const T=Object.assign({},p);for(const O of Object.keys(_y))T[O]===void 0&&(T[O]=_y[O].default);const P=new i.a8(XS,c,new Map(v));return P.setTransitionOrValue(T,v),P.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,v)=>{const w="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=o;T.startsWith(w)||(T=w+T);const P=i.I.from("mapbox-reserved-lut"),O=new Image;O.src=T,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:k,height:N,data:W}=i.o.getImageData(O);if(N>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==N*N)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new i.q({width:k,height:N},W),pixelRatio:1,sdf:!1,usvg:!1,version:0});const H=this.imageManager.getImage(P,this.scope);H?(this._styleColorTheme.lut={image:H.data,data:o},p()):v(new Error("Missing LUT image."))}})}getLut(o){const c=this._styleColorThemeForScope[o];return c?c.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(c,p,v){let w,T,P;const O=i.o.devicePixelRatio>1?"@2x":"";let k=i.m(p.transformRequest(p.normalizeSpriteURL(c,O,".json"),i.R.SpriteJSON),(H,q)=>{k=null,P||(P=H,w=q,W())}),N=i.n(p.transformRequest(p.normalizeSpriteURL(c,O,".png"),i.R.SpriteImage),(H,q)=>{N=null,P||(P=H,T=q,W())});function W(){if(P)v(P);else if(w&&T){const H=i.o.getImageData(T),q={};for(const ee in w){const{width:Y,height:se,x:oe,y:he,sdf:me,pixelRatio:de,stretchX:Ae,stretchY:be,content:Se}=w[ee],xe=new i.q({width:Y,height:se});i.q.copy(H,xe,{x:oe,y:he},{x:0,y:0},{width:Y,height:se},null),q[ee]={data:xe,pixelRatio:de!==void 0?de:1,sdf:me!==void 0&&me,stretchX:Ae,stretchY:be,content:Se,usvg:!1,version:0}}v(null,q)}}return{cancel(){k&&(k.cancel(),k=null),N&&(N.cancel(),N=null)}}}(o,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new i.y(c));else if(p){const v=new Map;for(const w in p)v.set(i.I.from(w),p[w]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(o,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const v=p.getSource();if(v.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const w=new vy(o,this.scope,p);this.imageManager.addImageProvider(w,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!i.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const c=this.map._spriteFormat==="auto";var p,v;this._spriteRequest=(v=(w,T)=>{if(this._spriteRequest=null,w)c?this._loadSprite(o):this.fire(new i.y(w));else if(T){const P=new Map;for(const O in T)P.set(i.I.from(O),T[O]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(o),i.R.Iconset),(w,T)=>{if(w)return void v(w);const P={},O=i.dg(new i.bt(T));for(const k of O.icons){const N={version:1,pixelRatio:i.o.devicePixelRatio,content:hx(k),stretchX:k.metadata?dx(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?dx(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};P[k.name]=N}v(null,P)}))}_validateLayer(o){const c=this.getOwnSource(o.source);if(!c)return;const p=o.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,c)=>{const p=this.fragments[c];return p&&p.style&&(o.data=p.style.serialize()),o})}_serializeSources(){const o={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();o[p.id]||(o[p.id]=p.serialize())}return o}_serializeLayers(o){const c=[];for(const p of o){const v=this._layers[p];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const o in this._mergedLayers){const c=this._mergedLayers[o];if(c._transitionablePaint&&c._transitionablePaint._values){const p=c._transitionablePaint._values["line-emissive-strength"];if(p&&p.value&&p.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const c=this.getOwnLayer(o);if(c)return c;this.fire(new i.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const c=this.getOwnSource(o);if(c)return c;this.fire(new i.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,c){const p=this.map.painter;if(p)for(let v=o.minzoom||0;v<(o.maxzoom||25.5);v++){const w=o.getProgramIds();if(w)for(const T of w){const P=o.getDefaultProgramParams(T,c.zoom,this._styleColorTheme.lut);P&&(p.style=this,this.fog&&(p._fogVisible=!0,P.overrideFog=!0,p.getOrCreateProgram(T,P)),p._fogVisible=!1,P.overrideFog=!1,p.getOrCreateProgram(T,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,p.getOrCreateProgram(T,P)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const c=this.calculateLightsBrightness();o.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const O in P){const{updatedIds:k,removedIds:N}=P[O];(k||N)&&(this._updateWorkerLayers(O,k,N),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const w={};for(const P in this._mergedSourceCaches){const O=this._mergedSourceCaches[P];w[P]=O.used,O.used=!1,O.tileCoverLift=0}for(const P of this._mergedOrder){const O=this._mergedLayers[P];if(O.visibility!=="none"&&O.recalculate(o,this._availableImages),!O.isHidden(o.zoom)){const k=this.getLayerSourceCache(O);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,o)}):this.precompilePrograms(O,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const P of T)P.sourceCache.used=!0;for(const P in w){const O=this._mergedSourceCaches[P];w[P]!==O.used&&O.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const c of o){const p=c.resolvePendingRequests(),v=this.getFragmentStyle(c.scope);v&&v.addImages(p)}}_updateTilesForChangedImages(){const o={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;o[p]=o[p]||this._changes.getUpdatedImages(p),o[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o[p])}for(const c in o)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(o,c,p){const v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:o,removedIds:p||[],options:v.options})}setState(o,c){if(this._checkLoaded(),xc(this,Yn(o)))return!1;(o=i.dp(o)).layers=ud(o.layers);const p=function(T,P){if(!T)return[{command:gn.setStyle,args:[P]}];let O=[];try{if(!i.by(T.version,P.version))return[{command:gn.setStyle,args:[P]}];if(i.by(T.center,P.center)||O.push({command:gn.setCenter,args:[P.center]}),i.by(T.zoom,P.zoom)||O.push({command:gn.setZoom,args:[P.zoom]}),i.by(T.bearing,P.bearing)||O.push({command:gn.setBearing,args:[P.bearing]}),i.by(T.pitch,P.pitch)||O.push({command:gn.setPitch,args:[P.pitch]}),i.by(T.sprite,P.sprite)||O.push({command:gn.setSprite,args:[P.sprite]}),i.by(T.glyphs,P.glyphs)||O.push({command:gn.setGlyphs,args:[P.glyphs]}),i.by(T.imports,P.imports)||function(q=[],ee=[],Y){ee=ee||[];const se=(q=q||[]).map(hd),oe=ee.map(hd),he=q.reduce(dd,{}),me=ee.reduce(dd,{}),de=se.slice();let Ae,be,Se,xe;for(Ae=0,be=0;Ae<se.length;Ae++)Se=se[Ae],me.hasOwnProperty(Se)?be++:(Y.push({command:gn.removeImport,args:[Se]}),de.splice(de.indexOf(Se,be),1));for(Ae=0,be=0;Ae<oe.length;Ae++)Se=oe[oe.length-1-Ae],de[de.length-1-Ae]!==Se&&(he.hasOwnProperty(Se)?(Y.push({command:gn.removeImport,args:[Se]}),de.splice(de.lastIndexOf(Se,de.length-be),1)):be++,xe=de[de.length-Ae],Y.push({command:gn.addImport,args:[me[Se],xe]}),de.splice(de.length-Ae,0,Se));for(const ye of ee){const Ce=he[ye.id];Ce&&(delete Ce.data,i.by(Ce,ye)||Y.push({command:gn.updateImport,args:[ye.id,ye]}))}}(T.imports,P.imports,O),i.by(T.transition,P.transition)||O.push({command:gn.setTransition,args:[P.transition]}),i.by(T.light,P.light)||O.push({command:gn.setLight,args:[P.light]}),i.by(T.fog,P.fog)||O.push({command:gn.setFog,args:[P.fog]}),i.by(T.snow,P.snow)||O.push({command:gn.setSnow,args:[P.snow]}),i.by(T.rain,P.rain)||O.push({command:gn.setRain,args:[P.rain]}),i.by(T.projection,P.projection)||O.push({command:gn.setProjection,args:[P.projection]}),i.by(T.lights,P.lights)||O.push({command:gn.setLights,args:[P.lights]}),i.by(T.camera,P.camera)||O.push({command:gn.setCamera,args:[P.camera]}),i.by(T.iconsets,P.iconsets)||function(q,ee,Y){let se;for(se in ee=ee||{},q=q||{})q.hasOwnProperty(se)&&(ee.hasOwnProperty(se)||Y.push({command:gn.removeIconset,args:[se]}));for(se in ee){if(!ee.hasOwnProperty(se))continue;const oe=ee[se];q.hasOwnProperty(se)?i.by(q[se],oe)||(Y.push({command:gn.removeIconset,args:[se]}),Y.push({command:gn.addIconset,args:[se,oe]})):Y.push({command:gn.addIconset,args:[se,oe]})}}(T.iconsets,P.iconsets,O),!i.by(T["color-theme"],P["color-theme"]))return[{command:gn.setStyle,args:[P]}];const k={},N=[];(function(q,ee,Y,se){let oe;for(oe in ee=ee||{},q=q||{})q.hasOwnProperty(oe)&&(ee.hasOwnProperty(oe)||cy(oe,Y,se));for(oe in ee){if(!ee.hasOwnProperty(oe))continue;const he=ee[oe];q.hasOwnProperty(oe)?i.by(q[oe],he)||(q[oe].type==="geojson"&&he.type==="geojson"&&ax(q,ee,oe)?Y.push({command:gn.setGeoJSONSourceData,args:[oe,he.data]}):sx(oe,ee,Y,se)):Kf(oe,ee,Y)}})(T.sources,P.sources,N,k);const W=[];T.layers&&T.layers.forEach(q=>{q.source&&k[q.source]?O.push({command:gn.removeLayer,args:[q.id]}):W.push(q)});let H=T.terrain;H&&k[H.source]&&(O.push({command:gn.setTerrain,args:[void 0]}),H=void 0),O=O.concat(N),i.by(H,P.terrain)||O.push({command:gn.setTerrain,args:[P.terrain]}),function(q,ee,Y){ee=ee||[];const se=(q=q||[]).map(hd),oe=ee.map(hd),he=q.reduce(dd,{}),me=ee.reduce(dd,{}),de=se.slice(),Ae=Object.create(null);let be,Se,xe,ye,Ce,Le,ke;for(be=0,Se=0;be<se.length;be++)xe=se[be],me.hasOwnProperty(xe)?Se++:(Y.push({command:gn.removeLayer,args:[xe]}),de.splice(de.indexOf(xe,Se),1));for(be=0,Se=0;be<oe.length;be++)xe=oe[oe.length-1-be],de[de.length-1-be]!==xe&&(he.hasOwnProperty(xe)?(Y.push({command:gn.removeLayer,args:[xe]}),de.splice(de.lastIndexOf(xe,de.length-Se),1)):Se++,Le=de[de.length-be],Y.push({command:gn.addLayer,args:[me[xe],Le]}),de.splice(de.length-be,0,xe),Ae[xe]=!0);for(be=0;be<oe.length;be++)if(xe=oe[be],ye=he[xe],Ce=me[xe],!Ae[xe]&&!i.by(ye,Ce))if(i.by(ye.source,Ce.source)&&i.by(ye["source-layer"],Ce["source-layer"])&&i.by(ye.type,Ce.type)){for(ke in mc(ye.layout,Ce.layout,Y,xe,null,gn.setLayoutProperty),mc(ye.paint,Ce.paint,Y,xe,null,gn.setPaintProperty),i.by(ye.slot,Ce.slot)||Y.push({command:gn.setSlot,args:[xe,Ce.slot]}),i.by(ye.filter,Ce.filter)||Y.push({command:gn.setFilter,args:[xe,Ce.filter]}),i.by(ye.minzoom,Ce.minzoom)&&i.by(ye.maxzoom,Ce.maxzoom)||Y.push({command:gn.setLayerZoomRange,args:[xe,Ce.minzoom,Ce.maxzoom]}),ye)ye.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?mc(ye[ke],Ce[ke],Y,xe,ke.slice(6),gn.setPaintProperty):i.by(ye[ke],Ce[ke])||Y.push({command:gn.setLayerProperty,args:[xe,ke,Ce[ke]]}));for(ke in Ce)Ce.hasOwnProperty(ke)&&!ye.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?mc(ye[ke],Ce[ke],Y,xe,ke.slice(6),gn.setPaintProperty):i.by(ye[ke],Ce[ke])||Y.push({command:gn.setLayerProperty,args:[xe,ke,Ce[ke]]}))}else Y.push({command:gn.removeLayer,args:[xe]}),Le=de[de.lastIndexOf(xe)+1],Y.push({command:gn.addLayer,args:[Ce,Le]})}(W,P.layers,O)}catch(k){console.warn("Unable to compute style diff:",k),O=[{command:gn.setStyle,args:[P]}]}return O}(this.serialize(),o).filter(T=>!(T.command in px));if(p.length===0)return!1;const v=p.filter(T=>!(T.command in fx));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const w=[];return p.forEach(T=>{w.push(this[T.command](...T.args))}),c&&Promise.all(w).then(c).catch(c),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[c,p]of o.entries()){if(this.getImage(c))return this.fire(new i.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(o,c){return this.getImage(o)?this.fire(new i.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,c),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(o,c,p=!1){this.imageManager.updateImage(o,this.scope,c),p&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(o,c,p={}){return this._checkLoaded(),this._validate(ne,`models.${o}`,c,null,p)||(this.modelManager.addModel(o,c,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,c,p={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(jo,`sources.${o}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=go(o,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=T=>{const P=(T?"symbol:":"other:")+v.id,O=i.B(P,this.scope),k=this._sourceCaches[P]=new Ls(O,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=k,k.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const c=this.getOwnSource(o);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([w,T])=>T.type==="source"&&T.source===o);if(v)return this.fire(new i.y(new Error(`Source "${o}" cannot be removed while iconset "${v[0]}" is using it.`)))}const p=this.getOwnSourceCaches(o);for(const v of p){const w=i.dq(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getOwnSource(o).setData(c),this._changes.setDirty()}getOwnSource(o){const c=this.getOwnSourceCache(o);return c&&c.getSource()}getOwnSources(){const o=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&o.push(p.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const c in o){const p=o[c]._tiles;for(const v in p){const w=p[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const w of o){if(this._validate(Vo,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(w),T.updateTransitions(c)}else this.ambientLight=new mn(w,Wi||(Wi=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(w),T.updateTransitions(c)}else this.directionalLight=new mn(w,Oi||(Oi=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),v=new i.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,c=this.ambientLight;if(!o||!c)return;const p=H=>.2126*(H[0]<=.03928?H[0]/12.92:Math.pow((H[0]+.055)/1.055,2.4))+.7152*(H[1]<=.03928?H[1]/12.92:Math.pow((H[1]+.055)/1.055,2.4))+.0722*(H[2]<=.03928?H[2]/12.92:Math.pow((H[2]+.055)/1.055,2.4)),v=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=o.properties.get("intensity"),T=o.properties.get("direction"),P=1-i.d4(T.x,T.y,T.z)[2]/90,O=p(v)*w*P,k=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),N=c.properties.get("intensity"),W=p(k)*N;return Number(((O+W)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(i.dr(o)){const c=i.ds(o),p=this.fragments.find(({id:w})=>w===c);if(!p)return;const v=i.dq(o);return p.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:p})=>p===o);return c?c.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const c={},p=(v,w="")=>`${v}::${w}`;this._featuresetSelectors={};for(const v in o){const w=this._featuresetSelectors[v]=[];for(const T of o[v].selectors){if(T.featureNamespace){const O=this.getOwnLayer(T.layer);if(!O){i.w(`Layer is undefined for selector: ${T.layer}`);continue}const k=p(O.source,O.sourceLayer);if(k in c&&c[k]!==T.featureNamespace){i.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}c[k]=T.featureNamespace}let P;if(T.properties)for(const O in T.properties){const k=i.U(T.properties[O]);k.result==="success"&&(P=P||{},P[O]=k.value)}w.push({layerId:T.layer,namespace:T.featureNamespace,properties:P,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const c=this.getFragmentStyle(o);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const v in c.stylesheet.featuresets)p.push({featuresetId:v,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(o,c){const p=this.getFragmentStyle(c),v=p.stylesheet.featuresets;if(!v||!v[o])return this.fire(new i.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const T of v[o].selectors){const P=p.getOwnLayer(T.layer);P&&w.push(P)}return w}getConfigProperty(o,c){const p=this.getFragmentStyle(o);if(!p)return null;const v=i.B(c,p.scope),w=p.options.get(v),T=w?w.value||w.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,c){const p=i.B(o,c);return this._mergedIndoor[p]}setIndoorData(o,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,c,p){const v=this.getFragmentStyle(o);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[c])return;const T=i.U(p);if(T.result!=="success")return void xc(this,T.value);const P=T.value.expression,O=i.B(c,v.scope),k=v.options.get(O);if(!k)return;let N;const{minValue:W,maxValue:H,stepValue:q,type:ee,values:Y}=w[c],se=i.U(w[c].default);se.result==="success"&&(N=se.value.expression),N?(this.options.set(O,Object.assign({},k,{value:P,default:N,minValue:W,maxValue:H,stepValue:q,type:ee,values:Y})),this.updateConfigDependencies(c)):this.fire(new i.y(new Error(`No schema defined for the config option "${c}" in the "${o}" fragment.`)))}getConfig(o){const c=this.getFragmentStyle(o);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const v={};for(const w in p){const T=i.B(w,c.scope),P=c.options.get(T),O=P?P.value||P.default:null;v[w]=O?O.serialize():null}return v}setConfig(o,c){const p=this.getFragmentStyle(o);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const c=this.getFragmentStyle(o);return c?c.stylesheet.schema:null}setSchema(o,c){const p=this.getFragmentStyle(o);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(o,c){if(this._config=o,o||c)if(c)for(const p in c){let v,w;const T=i.U(c[p].default);if(T.result==="success"&&(v=T.value.expression),o&&o[p]!==void 0){const H=i.U(o[p]);H.result==="success"&&(w=H.value.expression)}const{minValue:P,maxValue:O,stepValue:k,type:N,values:W}=c[p];if(v){const H=i.B(p,this.scope);this.options.set(H,{default:v,value:w,minValue:P,maxValue:O,stepValue:k,type:N,values:W})}else this.fire(new i.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,c=()=>!0){for(const p of o){const v=this.getLayer(p);v&&c(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,c=>!o||c.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const v=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&v!==""||c._styleColorTheme.lut&&v!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(o,c,p={}){this._checkLoaded();const v=o.id;if(this._layers[v])return void this.fire(new i.y(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(o.type==="custom"){if(xc(this,i.dt(o)))return;w=i.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=i.dp(o),o=Object.assign(o,{source:v})),this._validate(ly,`layers.${v}`,o,{arrayIndex:-1},p))return;w=i.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}const T=i.B(w.source,w.scope);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let P=this._order.length;if(c){const W=this._order.indexOf(c);if(W===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?P=W:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const O=this.getOwnLayerSourceCache(w),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&w.canCastShadows()&&k&&(O.castsShadows=!0);const N=this._changes.getRemovedLayer(w);if(N&&w.source&&O&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const W=i.B(w.source,w.scope);N.type!==w.type?this._changes.updateSourceCache(W,"clear"):(this._changes.updateSourceCache(W,"reload"),O.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(o,c){this._checkLoaded();const p=this._checkLayer(o);if(!p||o===c)return;const v=this._order.indexOf(o);this._order.splice(v,1);let w=this._order.length;if(c){const T=this._order.indexOf(c);if(T===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?w=T:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const c=this._checkLayer(o);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let w=!1;for(const T in this._layers)if(this._layers[T].source===c.source&&this._layers[T].canCastShadows()){w=!0;break}v.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,p){this._checkLoaded();const v=this._checkLayer(o);v&&(v.minzoom===c&&v.maxzoom===p||(c!=null&&(v.minzoom=c),p!=null&&(v.maxzoom=p),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,c){this._checkLoaded();const p=this._checkLayer(o);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(o,c,p={}){this._checkLoaded();const v=this._checkLayer(o);if(v&&!i.by(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(eu,`layers.${v.id}.filter`,c,{layerType:v.type},p)||(v.filter=i.dp(c),this._updateLayer(v)))}getFilter(o){const c=this._checkLayer(o);if(c)return i.dp(c.filter)}setLayoutProperty(o,c,p,v={}){this._checkLoaded();const w=this._checkLayer(o);if(w&&!i.by(w.getLayoutProperty(c),p)){if(p!=null&&(!v||v.validate!==!1)&&xc(w,Ue.call(Yn,{key:`layers.${o}.layout.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,p),w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),this._updateLayer(w)}}setLayerProperty(o,c,p,v={}){this._checkLoaded();const w=this._checkLayer(o);w&&(c==="appearances"?(w.setAppearances(p),this._changes.setDirty()):w.isPaintProperty(c)?this.setPaintProperty(o,c,p,v):this.setLayoutProperty(o,c,p,v))}getLayoutProperty(o,c){const p=this._checkLayer(o);if(p)return p.getLayoutProperty(c)}setPaintProperty(o,c,p,v={}){this._checkLoaded();const w=this._checkLayer(o);if(!w||i.by(w.getPaintProperty(c),p)||p!=null&&(!v||v.validate!==!1)&&xc(w,ad.call(Yn,{key:`layers.${o}.paint.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:i.a6})))return;const T=w.setPaintProperty(c,p);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),T&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(o,c){const p=this._checkLayer(o);if(p)return p.getPaintProperty(c)}setFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:O,importId:k}=o.target,N=this.getFragmentStyle(k),W=N.getFeaturesetLayers(O);for(const{source:H,sourceLayer:q}of W)N.setFeatureState({id:o.id,source:H,sourceLayer:q},c)}else if("layerId"in o.target){const{layerId:O}=o.target,k=this.getLayer(O);this.setFeatureState({id:o.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const p=o.source,v=o.sourceLayer,w=this._checkSource(p);if(!w)return;const T=w.type;if(T==="geojson"&&v)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(p);for(const O of P)O.setFeatureState(v,o.id,c)}removeFeatureState(o,c){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:O,importId:k}=o.target,N=this.getFragmentStyle(k),W=N.getFeaturesetLayers(O);for(const{source:H,sourceLayer:q}of W)N.removeFeatureState({id:o.id,source:H,sourceLayer:q},c)}else if("layerId"in o.target){const{layerId:O}=o.target,k=this.getLayer(O);this.removeFeatureState({id:o.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const p=o.source,v=this._checkSource(p);if(!v)return;const w=v.type,T=w==="vector"?o.sourceLayer:void 0;if(w==="vector"&&!T)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(p);for(const O of P)O.removeFeatureState(T,o.id,c)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let w;if("featuresetId"in o.target){const{featuresetId:T,importId:P}=o.target,O=this.getFragmentStyle(P),k=O.getFeaturesetLayers(T);for(const{source:N,sourceLayer:W}of k){const H=O.getFeatureState({id:o.id,source:N,sourceLayer:W});if(H&&!w)w=H;else if(!i.by(w,H))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:T}=o.target,P=this.getLayer(T);w=this.getFeatureState({id:o.id,source:P.source,sourceLayer:P.sourceLayer})}return w}const c=o.source,p=o.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||p)return o.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,o.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),c=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(o){for(const c of Object.values(this._mergedLayers))o(c)&&this._updateLayer(c)}_updateLayer(o){this._changes.updateLayer(o);const c=this.getLayerSourceCache(o),p=i.B(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=P=>this._mergedLayers[P].is3D(!!this.terrain),p=this.order,v={},w=[];for(let P=p.length-1;P>=0;P--){const O=p[P];if(c(O)){v[O]=P;for(const k of o){const N=k[O];if(N)for(const W of N)w.push(W)}}}w.sort((P,O)=>O.intersectionZ-P.intersectionZ);const T=[];for(let P=p.length-1;P>=0;P--){const O=p[P];if(c(O))for(let k=w.length-1;k>=0;k--){const N=w[k].feature;if(N.layer&&v[N.layer.id]<P)break;T.push(N),w.pop()}else for(const k of o){const N=k[O];if(N)for(const W of N)T.push(W.feature)}}return T}queryRasterValue(o,c,p){const v=this.getOwnSource(o);return v?v.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(c,p):(this.fire(new i.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,c,p){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(eu,"queryRenderedFeatures.filter",c.filter,null,c),v=i.b6(c.filter));const w={},T=N=>{if(ap.has(N.type))return;const W=this.getOwnLayerSourceCache(N),H=w[W.id]=w[W.id]||{sourceCache:W,layers:{},has3DLayers:!1};N.is3D(!!this.terrain)&&(H.has3DLayers=!0),H.layers[N.fqid]=H.layers[N.fqid]||{styleLayer:N,targets:[]},H.layers[N.fqid].targets.push({filter:v})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const N of c.layers){const W=this._layers[N];if(!W)return this.fire(new i.y(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];T(W)}}else for(const N in this._layers)T(this._layers[N]);const P=this._queryRenderedFeatures(o,w,p),O=this._flattenAndSortRenderedFeatures(P),k=[];for(const N of O)i.dw(N.layer.id)===this.scope&&k.push(N);return k}queryRenderedFeatureset(o,c,p){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(eu,"queryRenderedFeatures.filter",c.filter,null,c),v=i.b6(c.filter));const w="mock",T=[];if(c&&c.target)T.push(Object.assign({},c,{targetId:w,filter:v}));else{const N=this.getFeaturesetDescriptors();for(const W of N)T.push({targetId:w,filter:v,target:W});for(const{style:W}of this.fragments){const H=W.getFeaturesetDescriptors();for(const q of H)T.push({targetId:w,filter:v,target:q})}}const P=this.queryRenderedTargets(o,T,p),O=[],k=new Set;for(const N of P)for(const W of N.variants[w])Yu(W,N,k)||O.push(new i.dx(N,W));return O}queryRenderedTargets(o,c,p){const v={},w=(P,O,k,N)=>{const W=v[O.id]=v[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(W.layers[P.fqid]=W.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(W.has3DLayers=!0),!N)return k.uniqueFeatureID=!1,void W.layers[P.fqid].targets.push(k);W.layers[P.fqid].targets.push(Object.assign({},k,{namespace:N.namespace,properties:N.properties,uniqueFeatureID:N.uniqueFeatureID}))};for(const P of c)if("featuresetId"in P.target){const{featuresetId:O,importId:k}=P.target,N=this.getFragmentStyle(k);if(!N||!N._featuresetSelectors)continue;const W=N._featuresetSelectors[O];if(!W){this.fire(new i.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const H of W){const q=N.getOwnLayer(H.layerId);q&&!ap.has(q.type)&&w(q,N.getOwnLayerSourceCache(q),P,H)}}else if("layerId"in P.target){const{layerId:O}=P.target,k=this.getLayer(O);if(!k||ap.has(k.type))continue;w(k,this.getLayerSourceCache(k),P)}const T=this._queryRenderedFeatures(o,v,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(o,c,p){const v=[],w=!!this.map._showQueryGeometry,T=bi.createFromScreenPoints(o,p);for(const P in c){const O=Gf(T,c[P],this._availableImages,p,w);Object.keys(O).length&&v.push(O)}if(this.placement)for(const P in c){if(!c[P].sourceCache._onlySymbols)continue;const O=Hf(T.screenGeometry,c[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&v.push(O)}return v}querySourceFeatures(o,c){const p=c&&c.filter;p&&this._validate(eu,"querySourceFeatures.filter",p,null,c);let v=[];const w=this.getOwnSourceCaches(o);for(const T of w)v=v.concat(Wf(T,c));return v}addSourceType(o,c,p){return la.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(la.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,c,p={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const P in o)if(!i.by(o[P],v[P])){w=!0;break}if(!w)return;const T=this._getTransitionParameters();this.light.setLight(o,c,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,c=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=o;const v=!("source"in o)||o.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in p&&typeof p.source=="object"){const P="terrain-dem-src";this.addSource(P,p.source),p=i.dp(p),p=Object.assign(p,{source:P})}const w=Object.assign({},p),T={};if(this.terrain&&v){w.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(T.style=P.serialize())}if(this._validate(Ta,"terrain",w,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new i.z("data",{dataType:"style"}))}else{const w=this.terrain,T=w.get();for(const P of Object.keys(i.a6.terrain))!p.hasOwnProperty(P)&&i.a6.terrain[P].default&&(p[P]=i.a6.terrain[P].default);for(const P in o)if(!i.by(o[P],T[P])){w.set(o,this.options),this.stylesheet.terrain=o;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new Dr(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(o){const c=this.snow=new Ji(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(o){const c=this.rain=new xi(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.by(c.get(),o)){c.set(o,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void o();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new i.z("colorthemeset")),o()}).catch(v=>{i.w(`Couldn't set color theme: ${v}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,c){const p=this.getFragmentStyle(o);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(o){return{now:i.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?o.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const p=this.terrain=new ze(o,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});p.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,p,v,w={}){if(w&&w.validate===!1)return!1;const T=Object.assign({},this.serialize());return xc(this,o.call(Yn,Object.assign({key:c,style:T,value:p,styleSpec:i.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const c=this.getSourceCaches(o);for(const p of c)p.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const c=this._mergedLayers[o];c._clear&&c._clear()}}reloadSource(o){const c=this.getSourceCaches(o);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let c;this.directionalLight&&(c=bd(this.directionalLight));const p=new Set,v=new Set;for(const w in this._mergedLayers){const T=this._mergedLayers[w];T.type==="building"&&p.add(T.source),T.hasElevation()&&!v.has(T.source)&&v.add(T.source)}for(const w in this._mergedSourceCaches){const T=this._mergedSourceCaches[w],P=v.has(T._source.id);p.has(T._source.id)&&(T._source.reparseOverscaled=!1),T.update(o,void 0,void 0,c,P)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,p,v,w,T,P=!1){let O=!1,k=!1;const N={},W={};for(const Y of this._mergedOrder){const se=this._mergedLayers[Y];if(se.type!=="symbol")continue;const oe=i.B(se.source,se.scope);let he=N[oe];if(!he){const de=this.getLayerSourceCache(se);if(!de)continue;const Ae=de.getRenderableIds(!0).map(be=>de.getTileByID(be));W[oe]=Ae.slice(),he=N[oe]=Ae.sort((be,Se)=>Se.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(Se.tileID)?-1:1))}const me=this.crossTileSymbolIndex.addLayer(se,he,c.center.lng,c.projection);O=O||me}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));const H=!!(this.placement&&!c.equals(this.placement.transform)),q=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!T||this.placement.lastReplacementSourceUpdateTime!==T.updateTime)),ee=(H||q||O||this.placement&&this.placement.isStale())&&v===0;if((P||!this.pauseablePlacement||ee||v!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),c.zoom))&&(this.pauseablePlacement=new yo(c,this._mergedOrder,P||v===0,p,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,N,W,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),k=!0),O&&this.pauseablePlacement.placement.setStale()),k||O){this._buildingIndex.onNewFrame(c.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const se=this._mergedLayers[this._mergedOrder[Y]];if(se.type!=="symbol"||se.visibility==="none")continue;const oe=this.isLayerClipped(se);this.placement.updateLayerOpacities(se,N[i.B(se.source,se.scope)],Y,oe?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:w})=>w===o.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!c)return p.push(o),this._loadImports([o],!0);const v=p.findIndex(({id:w})=>w===c);return v===-1&&this.fire(new i.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,v).concat(o).concat(p.slice(v)),this._loadImports([o],!0,c)}updateImport(o,c){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(o);return v===-1?this:typeof c=="string"?(this.setImportUrl(o,c),this):(c.url&&c.url!==p[v].url&&this.setImportUrl(o,c.url),i.by(c.config,p[v].config)||this.setImportConfig(o,c.config,c.data.schema),i.by(c.data,p[v].data)||this.setImportData(o,c.data),this)}moveImport(o,c){this._checkLoaded();let p=this.stylesheet.imports||[];const v=this.getImportIndex(o);if(v===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const T=p[v],P=this.fragments[v];return p=p.filter(({id:O})=>O!==o),this.fragments=this.fragments.filter(({id:O})=>O!==o),this.stylesheet.imports=p.slice(0,w).concat(T).concat(p.slice(w)),this.fragments=this.fragments.slice(0,w).concat(P).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(o,c){this._checkLoaded();const p=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;p[v].url=c;const w=this.fragments[v];return w.style=this._createFragmentStyle(p[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(o,c){this._checkLoaded();const p=this.getImportIndex(o),v=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete v[p].data,this.setImportUrl(o,v[p].url))}setImportConfig(o,c,p){this._checkLoaded();const v=this.getImportIndex(o),w=this.stylesheet.imports||[];if(v===-1)return this;c?w[v].config=c:delete w[v].config;const T=this.fragments[v];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const P=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=c,T.style.updateConfig(c,P),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(o);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(o){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===o);return c===-1&&this.fire(new i.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),c}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&o.push(p.getSource())}return o}getSource(o,c){const p=this.getSourceCache(o,c);return p&&p.getSource()}getLayerSource(o){const c=this.getLayerSourceCache(o);return c&&c.getSource()}getSourceCache(o,c){const p=i.B(o,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(o){const c=i.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[o]&&c.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&c.push(this._mergedSymbolSourceCaches[o]),c}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const c in o){const p=o[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(o){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const v=this.getLayer(p);v&&v.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const v=T=>{if(T){const P=c.images.map(O=>i.I.toString(O));T.setDependencies(c.tileID.key,c.type,P)}},w=i.B(c.source,c.scope);v(this._mergedOtherSourceCaches[w]),v(this._mergedSymbolSourceCaches[w]),c.images.some(T=>T.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(o,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(o,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(o,c,p){return i.dz(c,p)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){const c=this.getOwnSourceCaches(o);return c.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${o}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,c){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const p=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),v=o.type==="building";if(o.is3D(!!this.terrain)){if(p||v||c&&c.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}la.getSourceType=function(f){return $a[f]},la.setSourceType=function(f,o){$a[f]=o},la.registerForPluginStateChange=i.dA;class mx extends i.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[c,p]of Object.entries(o.buildings))if(this._buildings[c])for(const v of p.floorIds)this._buildings[c].floors[v]||(this._buildings[c].floors[v]=p.floors[v]);else this._buildings[c]=p;for(const c of o.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(o,c){const p=this._style.getIndoorSourceLayers(o,c);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(o,c,p){const v=function(w,T,P,O){let k=null,N=Number.MAX_SAFE_INTEGER;if(O<16)return null;for(const[W,H]of Object.entries(w)){const q=H.center;if(q){const ee=T.distanceTo(i.aT.convert(q));ee<N&&P.contains(q)&&(N=ee,k=W)}}return k}(this._buildings,c,p,o);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,c=this._closestBuildingId,p=c&&o?o[c]:void 0;if(!p)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const T of p.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){v=T;break}const w=Array.from(p.floorIds).map(T=>({id:T,name:p.floors[T].name,zIndex:p.floors[T].zIndex})).sort((T,P)=>P.zIndex-T.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:w}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var rh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,nh=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,xy=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,lp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ws=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,cp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Mt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,by=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,up=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,hp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,wy=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Td=/#include\s+"([^"]+)"/g,Xa=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Ty=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,lu=new Set(["ifdef","ifndef","elif","if","defined"]),cu=new Set;Tc(rh,cu),Tc(xy,cu),Tc(nh,cu);const wc={"_prelude_fog.vertex.glsl":cp,"_prelude_terrain.vertex.glsl":Ws,"_prelude_shadow.vertex.glsl":hp,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Mt,"_prelude_shadow.fragment.glsl":wy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":by,"_prelude_raster_particle.glsl":up},dp={};dn("",Ws),dn(Mt,cp),dn(wy,hp),dn(by,""),dn(up,"");const gx=dn(nh,xy),fp=rh,KS=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",fp,gx.fragmentSource].join(`
`),yx=["precision highp float;",fp,gx.vertexSource].join(`
`);var Sy={background:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:dn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:dn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:dn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:dn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:dn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:dn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:dn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:dn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lp),skyboxGradient:dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,lp),skyboxCapture:dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:dn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:dn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:dn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:dn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Tc(f,o){const c=f.split(`
`);for(let p of c){if(p=p.trimStart(),p[0]!=="#"||!p.includes("if")||p.startsWith("#endif"))continue;const v=p.match(Ty);if(v)for(const w of v)lu.has(w)||o.add(w)}}function dn(f,o){const c=new Set,p=[],v=[];f=f.replace(Td,(T,P)=>(v.push(P),"")),o=o.replace(Td,(T,P)=>(p.push(P),""));let w=new Set(cu);Tc(f,w),Tc(o,w);for(const T of[...p,...v])dp[T]||(dp[T]=new Set,Tc(wc[T],dp[T])),w=new Set([...w,...dp[T]]);return{fragmentSource:f=f.replace(Xa,(T,P,O,k,N)=>(c.add(N),P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${O} ${k} ${N};
#else
uniform ${O} ${k} u_${N};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${O} ${k} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${k} ${N};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(Xa,(T,P,O,k,N)=>{const W=`MATERIAL_ATTRIBUTE_OFFSET_${N}`,H=k==="float"?"vec2":k,q=`GET_ATTRIBUTE_${H}(a_${N}, materialInfo, ${W})`,ee=N.match(/color/)?"color":H;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${O} ${k} a_${N};
#endif
`:c.has(N)?P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
    #if !defined(${W})
        in ${O} ${H} a_${N};
    #endif
out ${O} ${k} ${N};
#else
uniform ${O} ${k} u_${N};
#endif
`:P==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${O} ${k} ${N} = u_${N};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${N})
    #ifdef ${W}
        ${N} = unpack_mix_${ee}(${q}, u_${N}_t);
    #else
        ${N} = unpack_mix_${ee}(a_${N}, u_${N}_t);
    #endif
#else
    ${O} ${k} ${N} = u_${N};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${k} a_${N};
    out ${O} ${k} ${N};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
    #if !defined(${W})
        in ${O} ${H} a_${N};
    #endif
#else
uniform ${O} ${k} u_${N};
#endif
`:P==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${O} ${k} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${H} a_${N};
#else
uniform ${O} ${k} u_${N};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${O} ${k} ${N} = a_${N};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    #ifdef ${W}
        ${O} ${k} ${N} = ${q};
    #else
        ${O} ${k} ${N} = a_${N};
    #endif
#else
    ${O} ${k} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    #ifdef ${W}
        ${O} ${k} ${N} = unpack_mix_${ee}(${q}, u_${N}_t);
    #else
        ${O} ${k} ${N} = unpack_mix_${ee}(a_${N}, u_${N}_t);
    #endif
#else
    ${O} ${k} ${N} = u_${N};
#endif
`}),usedDefines:w,vertexIncludes:p,fragmentIncludes:v}}class YS{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,p,v,w,T,P,O){this.context=o;let k=this.boundPaintVertexBuffers.length!==v.length;for(let W=0;!k&&W<v.length;W++)this.boundPaintVertexBuffers[W]!==v[W]&&(k=!0);let N=this.boundDynamicVertexBuffers.length!==P.length;for(let W=0;!N&&W<P.length;W++)this.boundDynamicVertexBuffers[W]!==P[W]&&(N=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||k||N||this.boundIndexBuffer!==w||this.boundVertexOffset!==T)this.freshBind(c,p,v,w,T,P,O);else{o.bindVertexArrayOES.set(this.vao);for(const W of P)W&&(W.bind(),O&&W.instanceCount&&W.setVertexAttribDivisor(o.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(o,c,p,v,w,T,P){const O=this.context,k=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=T,c.enableAttributes(k,o),c.bind(),c.setVertexAttribPointers(k,o,w);for(const N of p)N.enableAttributes(k,o),N.bind(),N.setVertexAttribPointers(k,o,w);for(const N of T)N&&(N.enableAttributes(k,o),N.bind(),N.setVertexAttribPointers(k,o,w),P&&N.instanceCount&&N.setVertexAttribDivisor(k,o,P));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function JS(f,o){const c=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new i.ae(0,p/c).toLngLat().lat,new i.ae(0,(p+1)/c).toLngLat().lat]}function QS(f,o,c,p,v,w,T){const P=f.context,O=P.gl,k=c.hillshadeFBO;if(!k)return;f.prepareDrawTile();const N=f.isTileAffectedByFog(o),W=[];f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1");const H=f.getOrCreateProgram("hillshade",{overrideFog:N,defines:W});P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,k.colorAttachment0.get());const q=((oe,he,me,de)=>{const Ae=me.paint.get("hillshade-shadow-color"),be=me.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=me.paint.get("hillshade-highlight-color"),xe=me.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=me.paint.get("hillshade-accent-color"),Ce=me.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Le=me.paint.get("hillshade-emissive-strength");let ke=i.an(me.paint.get("hillshade-illumination-direction"));if(me.paint.get("hillshade-illumination-anchor")==="viewport")ke-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const et=oe.style.directionalLight.properties.get("direction"),ht=i.d4(et.x,et.y,et.z);ke=i.an(ht[1])}const Je=!oe.options.moving;return{u_matrix:de||oe.transform.calculateProjMatrix(he.tileID.toUnwrapped(),Je),u_image:0,u_latrange:JS(0,he.tileID),u_light:[me.paint.get("hillshade-exaggeration"),ke],u_shadow:Ae.toPremultipliedRenderColor(be?null:me.lut),u_highlight:Se.toPremultipliedRenderColor(xe?null:me.lut),u_emissive_strength:Le,u_accent:ye.toPremultipliedRenderColor(Ce?null:me.lut)}})(f,c,p,f.terrain?o.projMatrix:null);f.uploadCommonUniforms(P,H,o.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:Y,tileBoundsSegments:se}=f.getTileBoundsBuffers(c);H.draw(f,O.TRIANGLES,v,w,T,br.disabled,q,p.id,ee,Y,se)}function Ey(f,o,c){if(!o.needsDEMTextureUpload)return;const p=f.context,v=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(c.stride);const w=c.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new i.T(p,w,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function e2(f,o,c){const p=f.context,v=p.gl;if(!o.dem)return;const w=o.dem;if(p.activeTexture.set(v.TEXTURE1),Ey(f,o,w),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=w.dim;p.activeTexture.set(v.TEXTURE0);let P=o.hillshadeFBO;if(!P){const H=new i.T(p,{width:T,height:T,data:null},v.RGBA8);H.bind(v.LINEAR,v.CLAMP_TO_EDGE),P=o.hillshadeFBO=p.createFramebuffer(T,T,1,"renderbuffer"),P.colorAttachment0.set(H.texture)}p.bindFramebuffer.set(P.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:k,tileBoundsSegments:N}=f.getMercatorTileBoundsBuffers(),W=[];f.linearFloatFilteringSupported()&&W.push("TERRAIN_DEM_FLOAT_FORMAT"),f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1"),f.getOrCreateProgram("hillshadePrepare",{defines:W}).draw(f,v.TRIANGLES,ir.disabled,Tr.disabled,Lr.unblended,br.disabled,((H,q)=>{const ee=q.stride,Y=i.bC();return i.ce(Y,0,i.al,-i.al,0,0,1),i.br(Y,Y,[0,-i.al,0]),{u_matrix:Y,u_image:1,u_dimension:[ee,ee],u_zoom:H.overscaledZ}})(o.tileID,w),c.id,O,k,N),o.needsHillshadePrepare=!1}class fi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class t2 extends fi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class _x extends fi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ay extends fi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class pp extends fi{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Py extends fi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class uu extends fi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ih extends fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Sd extends fi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class oh extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class vx extends fi{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Cy extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class xx extends fi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class sh extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class mp extends fi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class gp extends fi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Iy extends fi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class yp extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Ed extends fi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class bx extends fi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let wx=class extends fi{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Tx extends fi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ah extends fi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Sx extends fi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class r2 extends fi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class n2 extends fi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class i2 extends fi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class My extends fi{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Oy extends fi{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Ry extends fi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Dy extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Ex extends fi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class _p extends fi{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class vp extends _p{constructor(o,c,p=0){super(o,c),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+p}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class lh extends _p{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ad extends _p{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ax extends lh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const qs=(f,o,c,p)=>({u_matrix:f,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:c,u_emissive_texture_available:p}),xp=(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_image1:1,u_frustum_tl:T,u_frustum_tr:P,u_frustum_br:O,u_frustum_bl:k,u_globe_pos:N,u_globe_radius:W,u_viewport:H,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:ee,u_emissive_texture_available:Y});function Pd(f,o){return f!=null&&o!=null&&!(!f.hasData()||!o.hasData())&&f.demTexture!=null&&o.demTexture!=null&&f.tileID.key!==o.tileID.key}const Al=new class{constructor(){this.operations={}}newMorphing(f,o,c,p,v){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:v,from:o,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(const o in this.operations){const c=this.operations[o];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},bp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function wp(f,o,c){if(o===0)return 0;const p=o<1&&c===514?.25/o:1;return 6*Math.pow(1.5,22-f)*Math.max(o,1)*p}function ky(f,o){const c=1<<f.z;return!o&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}function ch(f,o){if(!f.style||!f.style.enable3dLights())return;const c=f.context,p=c.gl;c.activeTexture.set(p.TEXTURE1),o?o.bind(p.LINEAR,p.CLAMP_TO_EDGE):f.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}const Cd=f=>({u_matrix:f});function Id(f,o,c,p,v){if(v>0){const w=i.o.now(),T=(w-f.timeAdded)/v,P=o?(w-o.timeAdded)/v:-1,O=c.getSource(),k=p.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),N=!o||Math.abs(o.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),W=N&&f.refreshedUponExpiration?1:i.aA(N?T:1-P,0,1);return o?{opacity:1,mix:1-W,isFading:T<1}:{opacity:W,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Tp extends Ls{constructor(o){const c=go("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class jy extends Ls{constructor(o){const c=go("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,p){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const P=new iu(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);P.state="loaded",this._tiles[T.key]=P}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const c=this.proxyCachedFBO[o];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ly extends i.aQ{constructor(o,c,p){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Ny extends i.bV{constructor(o,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,v,w]=function(O){const k=new i.bd,N=new i.b0,W=131;k.reserve(17161),N.reserve(33800);const H=i.al/128,q=i.al+H/2,ee=q+H;for(let se=-H;se<ee;se+=H)for(let oe=-H;oe<ee;oe+=H){const he=oe<0||oe>q||se<0||se>q?24575:0,me=i.aA(Math.round(oe),0,i.al),de=i.aA(Math.round(se),0,i.al);k.emplaceBack(me+he,de)}const Y=(se,oe)=>{const he=oe*W+se;N.emplaceBack(he+1,he,he+W),N.emplaceBack(he+W,he+W+1,he+1)};for(let se=1;se<129;se++)for(let oe=1;oe<129;oe++)Y(oe,se);return[0,129].forEach(se=>{for(let oe=0;oe<130;oe++)Y(oe,se),Y(se,oe)}),[k,N,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(p,i.bf.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=i.bg.simpleSegment(0,0,p.length,v.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,p.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jy(c.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const P=T.gl;this._overlapStencilMode=new Tr({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Tp(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,p){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const v=o.terrain.properties,w=o.terrain.drapeRenderMode===0,T=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const P=o.terrain&&o.terrain.scope,O=v.get("source"),k=w?this._mockSourceCache:o.getSourceCache(O,P);if(!k)return void i.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=k,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const W=this.getScaledDemTileSize();this.sourceCache.update(c,W,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const c=this._previousCameraAltitude,p=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=p;const v=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=o.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(w);let P=w-this._previousZoom;const O=this._previousUpdateTimestamp;let k=w;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(w-k)>.5&&(P=.5*(w-k+P)),P*v<0&&(k+=P)),this._evaluationZoom=k;const N=T.getExaggeration(k),W=N===T.getExaggeration(Math.max(0,k-.1));if(W&&Math.abs(N-this._exaggeration)<.01)return N;let H=Math.min(.1,.00375*(this._updateTimestamp-O));return(W||N<.1||Math.abs(P)<1e-4)&&(H=Math.min(.2,4*H)),i.ak(this._exaggeration,N,H)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(O=>{const k=c.getTileByID(O).tileID;return k.projMatrix=p.calculateProjMatrix(k.toUnwrapped()),k});(function(O,k){const N=k.transform.pointCoordinate(k.transform.getCameraPoint()),W=new i.P(N.x,N.y);O.sort((H,q)=>{if(q.overscaledZ-H.overscaledZ)return q.overscaledZ-H.overscaledZ;const ee=new i.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Y=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),se=W.mult(1<<H.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ee)-se.distSqr(Y)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const O in T){const k=T[O];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,o[O],w),k.usedForTerrain))continue;const N=o[O];k.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[c.id]=v.map(O=>new Ly(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const k=this.terrainTileForTile[O.key];if(!k)continue;const N=k.tileID.key;N in P||(this._visibleDemTiles.push(k),P[N]=N)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const p in this.terrainTileForTile){const v=this.terrainTileForTile[p],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),Ey(this.painter,v,w))}}_prepareDemTileUniforms(o,c,p,v){if(!c||c.demTexture==null)return!1;const w=o.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-w.z),P=v||"";return p[`u_dem_tl${P}`]=[w.x*T%1,w.y*T%1],p[`u_dem_scale${P}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const c=this._visibleDemTiles.reduce((p,v)=>{if(!v.dem)return p;const w=v.dem.tree.minimums[0];return w>0&&o++,p+w},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),v=new i.dL({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new i.T(o,v,c.R32F,{premultiply:!1}),w}setupElevationDraw(o,c,p){const v=this.painter.context,w=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let P=null,O=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,ee=p.morphing.dstDemTile;k=p.morphing.phase,q&&ee&&(this._prepareDemTileUniforms(o,q,T,"_prev")&&(O=q),this._prepareDemTileUniforms(o,ee,T)&&(P=ee))}const N=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let W=null;var H;if(this.enabled?O&&P?(W=P.demTexture,v.activeTexture.set(w.TEXTURE4),O.demTexture.bind(N(O),w.CLAMP_TO_EDGE),T.u_dem_lerp=k):(P=this.terrainTileForTile[o.tileID.key],W=this._prepareDemTileUniforms(o,P,T)?P.demTexture:this.emptyDEMTexture):W=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),W&&(T.u_dem_size=(H=W).size[0]===1?1:H.size[0]-2,W.bind(N(P),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,T),p&&p.useMeterToDem&&P){const q=(1<<P.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,o.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,q)}}globeUniformValues(o,c,p){const v=o.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,i.al,0),u_tile_br_up:v.upVector(c,i.al,i.al),u_tile_bl_up:v.upVector(c,0,i.al),u_tile_up_scale:p?i.dM(1):v.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const c=this.painter,p=this.painter.context;o.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,T,P,O){if(v.transform.projection.name==="globe")(function(k,N,W,H,q){const ee=k.context,Y=ee.gl;let se,oe;const he=k.transform,me=i.dE(k,ee,he),de=(Je,et)=>{if(oe===et)return;const ht=[bp[et],"PROJECTION_GLOBE_VIEW"];me&&ht.push("CUSTOM_ANTIALIASING");const St=k.isTileAffectedByFog(Je);se=k.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:St}),oe=et},Ae=k.colorModeForRenderPass(),be=new ir(Y.LEQUAL,ir.ReadWrite,k.depthRangeFor3D);Al.update(q);const Se=i.dF(he),xe=[i.aF(he.center.lng),i.aJ(he.center.lat)],ye=k.globeSharedBuffers,Ce=[he.width*i.o.devicePixelRatio,he.height*i.o.devicePixelRatio],Le=Float32Array.from(he.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const Je=k.transform,et=wp(Je.zoom,N.exaggeration(),N.sourceCache._source.tileSize);oe=-1;const ht=Y.TRIANGLES;for(const St of H){const We=W.getTile(St),Re=Tr.disabled,ot=N.prevTerrainTileForTile[St.key],Ze=N.terrainTileForTile[St.key];Pd(ot,Ze)&&Al.newMorphing(St.key,ot,Ze,q,250),ch(k,We.emissiveTexture),ee.activeTexture.set(Y.TEXTURE0),We.texture&&We.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const gt=Al.getMorphValuesForProxy(St.key),Rt=gt?1:0;gt&&Object.assign(ke,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:i.dD(gt.phase)}});const $t=i.dG(St.canonical),It=i.dH($t.getCenter().lat),Et=i.dI(St.canonical,$t,It,Je.worldSize/Je._pixelsPerMercatorPixel),tr=i.bk(i.dJ(St.canonical)),Jt=k.emissiveMode==="mrt-fallback"?1:0,zt=xp(Je.expandedFarZProjMatrix,Le,Se,tr,i.aj(Je.zoom),xe,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Ce,et,Je._farZ,Jt,Et);if(de(St,Rt),se&&(N.setupElevationDraw(We,se,ke),k.uploadCommonUniforms(ee,se,St.toUnwrapped()),ye)){const[Gt,dr,Or]=ye.getGridBuffers(It,et!==0);se.draw(k,ht,be,Re,Ae,br.backCCW,zt,"globe_raster",Gt,dr,Or)}}}if(ye&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&Je.push("CUSTOM_ANTIALIASING"),se=k.getOrCreateProgram("globeRaster",{defines:Je});for(const et of H){const{x:ht,y:St,z:We}=et.canonical,Re=St===0,ot=St===(1<<We)-1,[Ze,gt,Rt,$t]=ye.getPoleBuffers(We,!1);if($t&&(Re||ot)){const It=W.getTile(et);ch(k,It.emissiveTexture),ee.activeTexture.set(Y.TEXTURE0),It.texture&&It.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Et=i.dK(We,ht,he);const tr=i.bk(i.dJ(et.canonical)),Jt=k.emissiveMode==="mrt-fallback"?1:0,zt=(Gt,dr)=>Gt.draw(k,Y.TRIANGLES,be,Tr.disabled,Ae,br.disabled,xp(he.expandedFarZProjMatrix,Et,Et,tr,0,xe,he.frustumCorners.TL,he.frustumCorners.TR,he.frustumCorners.BR,he.frustumCorners.BL,he.globeCenterInViewSpace,he.globeRadius,Ce,0,he._farZ,Jt),"globe_pole_raster",dr,Rt,$t);N.setupElevationDraw(It,se,ke),k.uploadCommonUniforms(ee,se,et.toUnwrapped()),Re&&k.renderDefaultNorthPole&&zt(se,Ze),ot&&k.renderDefaultSouthPole&&(Et=i.cS(i.bC(),Et,[1,-1,1]),zt(se,gt))}}}})(v,w,T,P,O);else{const k=v.context,N=k.gl;let W,H;const q=v.shadowRenderer,ee=_c(v,v.longestCutoffRange),Y=Ae=>{if(H===Ae)return;const be=[];be.push(bp[Ae]),ee.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),q&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&be.push("NORMAL_OFFSET")),W=v.getOrCreateProgram("terrainRaster",{defines:be}),H=Ae},se=v.colorModeForRenderPass(),oe=new ir(N.LEQUAL,ir.ReadWrite,v.depthRangeFor3D);Al.update(O);const he=v.transform,me=wp(he.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let de=[0,0,0];if(q){const Ae=v.style.directionalLight,be=v.style.ambientLight;Ae&&be&&(de=El(v.style,Ae,be))}{H=-1;const Ae=N.TRIANGLES,[be,Se]=[w.gridIndexBuffer,w.gridSegments];for(const xe of P){const ye=T.getTile(xe),Ce=Tr.disabled,Le=w.prevTerrainTileForTile[xe.key],ke=w.terrainTileForTile[xe.key];Pd(Le,ke)&&Al.newMorphing(xe.key,Le,ke,O,250),ch(v,ye.emissiveTexture),k.activeTexture.set(N.TEXTURE0),ye.texture&&ye.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const Je=Al.getMorphValuesForProxy(xe.key),et=Je?1:0;let ht;Je&&(ht={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:i.dD(Je.phase)}});const St=v.emissiveMode==="mrt-fallback"?1:0,We=qs(xe.projMatrix,ky(xe.canonical,he.renderWorldCopies)?me/10:me,de,St);if(Y(et),!W)continue;w.setupElevationDraw(ye,W,ht);const Re=xe.toUnwrapped();q&&q.setupShadows(Re,W),v.uploadCommonUniforms(k,W,Re,null,ee),W.draw(v,Ae,oe,Ce,se,br.backCCW,We,"terrain_raster",w.gridBuffer,be,Se)}}}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),P=c.style.order,O=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let k=0;for(const N of w){const W=v.getTileByID(N.proxyTileKey),H=v.proxyCachedFBO[N.key]?v.proxyCachedFBO[N.key][o]:void 0,q=H!==void 0?v.renderCache[H]:this.pool[k++],ee=H!==void 0;if(W.texture=q.tex,W.emissiveTexture=q.emissiveTex,ee&&!q.dirty){O.push(W.tileID);continue}p.bindFramebuffer.set(q.fb.framebuffer);const Y=p.gl;let se;Y.drawBuffers(c.emissiveMode==="mrt-fallback"?[Y.COLOR_ATTACHMENT0,Y.COLOR_ATTACHMENT1]:[Y.COLOR_ATTACHMENT0]),this.renderedToTile=!1,q.dirty&&(p.clear({color:i.ao.transparent,stencil:0}),q.dirty=!1);for(let oe=T.start;oe<=T.end;++oe){const he=c.style._mergedLayers[P[oe]];if(he.isHidden(c.transform.zoom))continue;const me=c.style.getLayerSourceCache(he),de=me?this.proxyToSource[N.key][me.id]:[N];if(!de)continue;const Ae=de;p.viewport.set([0,0,q.fb.width,q.fb.height]),se!==(me?me.id:null)&&(this._setupStencil(q,de,he,me),se=me?me.id:null),c.renderLayer(c,me,he,Ae)}if(Y.drawBuffers([Y.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const oe of this._pendingGroundEffectLayers){const he=c.style._mergedLayers[P[oe]];if(he.isHidden(c.transform.zoom))continue;const me=c.style.getLayerSourceCache(he),de=me?this.proxyToSource[N.key][me.id]:[N];if(!de)continue;const Ae=de;p.viewport.set([0,0,q.fb.width,q.fb.height]),se!==(me?me.id:null)&&(this._setupStencil(q,de,he,me),se=me?me.id:null),c.renderLayer(c,me,he,Ae)}this.renderedToTile?(q.dirty=!0,O.push(W.tileID)):ee||--k,k===5&&(k=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}isLayerOrderingCorrect(o){const c=o.order.length;let p=-1,v=c;for(let w=0;w<c;++w)this._style.isLayerDraped(o._mergedLayers[o.order[w]])?p=Math.max(p,w):v=Math.min(v,w);return v>p}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,p){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,P=1<<T.overscaledZ,{x:O,y:k}=T.canonical,N=O/P,W=(O+1)/P,H=k/P,q=(k+1)/P;return{minx:N,miny:H,maxx:W,maxy:q,t:w.dem.tree.raycastRoot(N,H,W,q,o,c,p),tile:w}});v.sort((w,T)=>(w.t!==null?w.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,c,p);if(T!=null)return T}return null}_createFBO(){const o=this.painter.context,c=o.gl,p=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const v=new i.T(o,{width:p[0],height:p[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=o.createFramebuffer(p[0],p[1],1,null);let T;return w.colorAttachment0.set(v.texture),this._emissiveTexture&&(T=new i.T(o,{width:p[0],height:p[1],data:null},c.R8),T.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.createColorAttachment(o,1),w.colorAttachment1.set(T.texture)),w.depthAttachment=new Ax(o,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:v,emissiveTex:T,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(const c of this.pool)this._updateFBO(c,o);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,o);this._emissiveTexture=o}}_updateFBO(o,c){const p=o.fb,v=this.painter.context,w=v.gl,T=this.drapeBufferSize;if(c){const P=new i.T(v,{width:T[0],height:T[1],data:null},w.R8);P.bind(w.LINEAR,w.CLAMP_TO_EDGE),o.emissiveTex=P,p.createColorAttachment(v,1),p.colorAttachment1.set(P.texture)}else o.emissiveTex=void 0,p.removeColorAttachment(v,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._mergedLayers[o],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const p of this._style.getSources())if(p instanceof tu){o=!0;break}if(!o)return;const c={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="line")continue;const T=v.widthExpression(),P=v.emissiveStrengthExpression();if(T instanceof i.ad||P instanceof i.ad){c[w.id]=!0;for(const O of this.proxyCoords){const k=this.proxyToSource[O.key][w.id];if(k)for(const N of k)this._clearRenderCacheForTile(w.id,N)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof To){o=!0;break}if(!o)return;const c={};for(let p=0;p<this._style.order.length;++p){const v=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][w.id];if(O)for(const k of O){const N=Id(w.getTile(k),w.findLoadedParent(k,0),w,this.painter.transform,T);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(w.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,c=o.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let v,w=0,T=this._style._mergedLayers[o[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<c;)T=this._style._mergedLayers[o[w]];for(;w<c;++w){const P=this._style._mergedLayers[o[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?v===void 0&&(v=w):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(p.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&p.push({start:v,end:w-1}),p.length!==0){const P=p[p.length-1];this._pendingGroundEffectLayers.every(O=>O>P.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let P=0;P<T.length;++P){const O=Object.values(T[P]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,v=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const P=p[T];if(c.getTileByID(P.key),c.proxyCachedFBO[P.key]!==void 0){const O=o[P.key],k=this.proxyToSource[P.key];let N=0;for(const W in k){const H=k[W],q=O[W];if(!q||q.length!==H.length||H.some((ee,Y)=>ee!==q[Y]||v[W]&&v[W].hasOwnProperty(ee.key))){N=-1;break}++N}for(const W in c.proxyCachedFBO[P.key])c.renderCache[c.proxyCachedFBO[P.key][W]].dirty=N<0||N!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((T,P)=>P.end-P.start-(T.end-T.start));for(const T of w)for(const P of p){if(c.proxyCachedFBO[P.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[P.key]={},c.proxyCachedFBO[P.key][T.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,p,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let P;if(p.isTileClipped())P=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):Tr.disabled}_renderTileClippingMasks(o,c){const p=this.painter,v=this.painter.context,w=v.gl;p._tileClippingMaskIDs={},v.setColorMode(Lr.disabled),v.setDepthMode(ir.disabled);const T=p.getOrCreateProgram("clippingMask");for(const P of o){const O=p._tileClippingMaskIDs[P.key]=--c;T.draw(p,w.TRIANGLES,ir.disabled,new Tr({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),Lr.disabled,br.disabled,Cd(P.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const p=[o.x,o.y,1,1];i.aC(p,p,c.pixelMatrixInverse),i.cK(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const v=c._camera.position,w=i.cf(1,c.center.lat),T=[v[0],v[1],v[2]/w,0],P=i.da([],p.slice(0,3),T);i.aw(P,P);const O=this.raycast(T,P,this._exaggeration);return O!==null&&O?(i.bH(T,T,P,O),T[3]=T[2],T[2]*=w,T):null}_setupProxiedCoordsForOrtho(o,c,p){if(o.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(o,c,p);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const k=w[O],N=this._findTileCoveringTileID(k,o);if(N){const W=this._createProxiedId(k,N,p[k.key]&&p[k.key][o.id]);v.push(W),this.proxyToSource[k.key][o.id]=[W]}}let T=!1;const P=new Set;for(let O=0;O<c.length;O++){const k=o.getTile(c[O]);if(!k||!k.hasData())continue;const N=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==k.tileID.canonical.z){const W=this.proxyToSource[N.tileID.key][o.id],H=this._createProxiedId(N.tileID,k,p[N.tileID.key]&&p[N.tileID.key][o.id]);W?W.splice(W.length-1,0,H):this.proxyToSource[N.tileID.key][o.id]=[H];const q=this.proxyToSource[N.tileID.key][o.id];P.has(q)||P.add(q),v.push(H),T=!0}}if(this._sourceTilesOverlap[o.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const O of P)O.sort((k,N)=>N.overscaledZ-k.overscaledZ)}_setupProxiedCoordsForImageSource(o,c,p){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],w=this.proxyCoords,T=o.getSource(),P=T.tileID;if(!P)return;const O=new i.P(P.x,P.y)._div(1<<P.z),k=T.coordinates.map(i.ae.fromLngLat).reduce((W,H)=>(W.min.x=Math.min(W.min.x,H.x-O.x),W.min.y=Math.min(W.min.y,H.y-O.y),W.max.x=Math.max(W.max.x,H.x-O.x),W.max.y=Math.max(W.max.y,H.y-O.y),W),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(W,H)=>{const q=W.wrap+W.canonical.x/(1<<W.canonical.z),ee=W.canonical.y/(1<<W.canonical.z),Y=i.al/(1<<W.canonical.z),se=H.wrap+H.canonical.x/(1<<H.canonical.z),oe=H.canonical.y/(1<<H.canonical.z);return q+Y<se+k.min.x||q>se+k.max.x||ee+Y<oe+k.min.y||ee>oe+k.max.y};for(let W=0;W<w.length;W++){const H=w[W];for(let q=0;q<c.length;q++){const ee=o.getTile(c[q]);if(!ee||!ee.hasData()||N(H,ee.tileID))continue;const Y=this._createProxiedId(H,ee,p[H.key]&&p[H.key][o.id]),se=this.proxyToSource[H.key][o.id];se?se.push(Y):this.proxyToSource[H.key][o.id]=[Y],v.push(Y)}}}_createProxiedId(o,c,p){let v=this.orthoMatrix;if(p){const w=p.find(T=>T.key===c.tileID.key);if(w)return w}if(c.tileID.key!==o.key){const w=o.canonical.z-c.tileID.canonical.z;let T,P,O;v=i.bC();const k=c.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(T=i.al>>w,P=T*((c.tileID.canonical.x<<w)-o.canonical.x+k),O=T*((c.tileID.canonical.y<<w)-o.canonical.y)):(T=i.al<<-w,P=i.al*(c.tileID.canonical.x-(o.canonical.x+k<<-w)),O=i.al*(c.tileID.canonical.y-(o.canonical.y<<-w))),i.ce(v,0,T,0,T,0,1),i.br(v,v,[P,O,0])}return new Ly(c.tileID,o.key,v)}_findTileCoveringTileID(o,c){let p=c.getTile(o);if(p&&p.hasData())return p;const v=this._findCoveringTileCache[c.id],w=v[o.key];if(p=w?c.getTileByID(w):null,p&&p.hasData()||w===null)return p;let T=p?p.tileID:o,P=T.overscaledZ;const O=c.getSource().minzoom,k=[];if(!w){const W=c.getSource().maxzoom;if(o.canonical.z>=W){const H=o.canonical.z-W;c.getSource().reparseOverscaled?(P=Math.max(o.canonical.z+2,c.transform.tileZoom),T=new i.aQ(P,o.wrap,W,o.canonical.x>>H,o.canonical.y>>H)):H!==0&&(P=W,T=new i.aQ(P,o.wrap,W,o.canonical.x>>H,o.canonical.y>>H))}T.key!==o.key&&(k.push(T.key),p=c.getTile(T))}const N=W=>{k.forEach(H=>{v[H]=W}),k.length=0};for(P-=1;P>=O&&(!p||!p.hasData());P--){p&&N(p.tileID.key);const W=T.calculateScaledKey(P);if(p=c.getTileByID(W),p&&p.hasData())break;const H=v[W];if(H===null)break;H===void 0?k.push(W):p=c.getTileByID(H)}return N(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let p=this._tilesDirty[o];p||(p=this._tilesDirty[o]={}),p[c.key]=!0}}function uh(f,o,c){const p=function(P,O,k){const N=i.bJ(O,P),W=i.bJ(k,[.2126,.7152,.0722]),H=(ee,Y,se)=>(1-se)*ee+se*Y,q=H(1-.3*Math.min(W,1),1,Math.min(N+1,1));return H(.92,1,Math.asin(i.aA(O[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],o),v=[0,0,0];i.c5(v,c.slice(0,3),p);const w=[0,0,0];i.c5(w,o.slice(0,3),f[2]);const T=[0,0,0];return i.d8(T,v,w),i.db(T)}const o2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],s2=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Px{static cacheKey(o,c,p,v){const w=[c];v&&w.push(v.cacheKey);for(const T of p)o.usedDefines.has(T)&&w.push(T);return w.join("/")}constructor(o,c,p,v,w,T){const P=o.gl;this.program=P.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...T];const O=`#version 300 es
${(v?v.defines():[]).concat(T.map(Y=>`#define ${Y}`)).join(`
`)}`,k=[O,KS];for(const Y of p.fragmentIncludes)k.push(wc[Y]);k.push(p.fragmentSource);const N=k.join(`
`),W=[O,yx];for(const Y of p.vertexIncludes)W.push(wc[Y]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&p.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&W.push("uniform int u_instanceID;"),W.push(p.vertexSource);let H=W.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const q=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(q,N),P.compileShader(q),P.attachShader(this.program,q);const ee=P.createShader(P.VERTEX_SHADER);P.isContextLost()?this.failedToCreate=!0:(P.shaderSource(ee,H),P.compileShader(ee),P.attachShader(this.program,ee),this.attributes={},P.linkProgram(this.program),P.deleteShader(ee),P.deleteShader(q),this.fixedUniforms=w(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=v?v.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new i.ch(Y)}))(o)),(T.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(Y=>({u_dem:new i.ch(Y),u_dem_prev:new i.ch(Y),u_dem_tl:new i.ck(Y),u_dem_scale:new i.cj(Y),u_dem_tl_prev:new i.ck(Y),u_dem_scale_prev:new i.cj(Y),u_dem_size:new i.cj(Y),u_dem_lerp:new i.cj(Y),u_exaggeration:new i.cj(Y),u_depth:new i.ch(Y),u_depth_size_inv:new i.ck(Y),u_depth_range_unpack:new i.ck(Y),u_occluder_half_size:new i.cj(Y),u_occlusion_depth_offset:new i.cj(Y),u_meter_to_dem:new i.cj(Y),u_label_plane_matrix_inv:new i.cl(Y)}))(o)),T.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new i.ci(Y),u_tile_tr_up:new i.ci(Y),u_tile_br_up:new i.ci(Y),u_tile_bl_up:new i.ci(Y),u_tile_up_scale:new i.cj(Y)}))(o)),T.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new i.cl(Y),u_fog_range:new i.ck(Y),u_fog_color:new i.d3(Y),u_fog_horizon_blend:new i.cj(Y),u_fog_vertical_limit:new i.ck(Y),u_fog_temporal_offset:new i.cj(Y),u_frustum_tl:new i.ci(Y),u_frustum_tr:new i.ci(Y),u_frustum_br:new i.ci(Y),u_frustum_bl:new i.ci(Y),u_globe_pos:new i.ci(Y),u_globe_radius:new i.cj(Y),u_globe_transition:new i.cj(Y),u_is_globe:new i.ch(Y),u_viewport:new i.ck(Y)}))(o)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new i.d3(Y)}))(o)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new i.ci(Y),u_lighting_directional_dir:new i.ci(Y),u_lighting_directional_color:new i.ci(Y),u_ground_radiance:new i.ci(Y)}))(o)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new i.cl(Y),u_light_matrix_1:new i.cl(Y),u_fade_range:new i.ck(Y),u_shadow_normal_offset:new i.ci(Y),u_shadow_intensity:new i.cj(Y),u_shadow_texel_size:new i.cj(Y),u_shadow_map_resolution:new i.cj(Y),u_shadow_direction:new i.ci(Y),u_shadow_bias:new i.ci(Y),u_shadowmap_0:new i.ch(Y),u_shadowmap_1:new i.ch(Y)}))(o)))}getAttributeLocation(o,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=o.getAttribLocation(this.program,c)),p}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in c)p[v]&&p[v].set(this.program,v,c[v])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in c)p[v]&&p[v].set(this.program,v,c[v])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in c)p[v].set(this.program,v,c[v])}}setCutoffUniformValues(o,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in c)p[v].set(this.program,v,c[v])}}setLightsUniformValues(o,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in c)p[v].set(this.program,v,c[v])}}setShadowUniformValues(o,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;o.program.set(this.program);for(const v in c)p[v].set(this.program,v,c[v])}_drawDebugWireframe(o,c,p,v,w,T,P,O,k,N){const W=o.options.wireframe;if(W.terrain===!1&&W.layers2D===!1&&W.layers3D===!1)return;const H=o.context;if(!(!(!W.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!W.layers2D||o._terrain&&o._terrain.renderingToTexture||!o2.includes(this.name))||!(!W.layers3D||!s2.includes(this.name))))return;const q=H.gl,ee=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,w,H);if(!ee)return;const Y=[...this.fixedDefines,"DEBUG_WIREFRAME"],se=o.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});H.program.set(se.program);const oe=(de,Ae,be)=>{if(Ae[de]&&be[de])for(const Se in Ae[de])be[de][Se]&&be[de][Se].set(be.program,Se,Ae[de][Se].current)};k&&k.setUniforms(se.program,H,se.binderUniforms,P,{zoom:O}),oe("fixedUniforms",this,se),oe("terrainUniforms",this,se),oe("globeUniforms",this,se),oe("fogUniforms",this,se),oe("lightsUniforms",this,se),oe("shadowUniforms",this,se),ee.bind(),H.setColorMode(new Lr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],i.ao.transparent,[!0,!0,!0,!1])),H.setDepthMode(new ir(c.func===q.LESS?q.LEQUAL:c.func,ir.ReadOnly,c.range)),H.setStencilMode(Tr.disabled);const he=3*T.primitiveLength*2,me=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const de=N||1;for(let Ae=0;Ae<de;++Ae)se.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),q.drawElements(q.LINES,he,q.UNSIGNED_SHORT,me)}else N&&N>1?q.drawElementsInstanced(q.LINES,he,q.UNSIGNED_SHORT,me,N):q.drawElements(q.LINES,he,q.UNSIGNED_SHORT,me);w.bind(),H.program.set(this.program),H.setDepthMode(c),H.setStencilMode(p),H.setColorMode(v)}checkUniforms(o,c,p){if(this.fixedDefines.includes(c)){for(const v of Object.keys(p))if(!p[v].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${v} not set but required by ${c} being defined`)}}draw(o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se){const oe=o.context,he=oe.gl;if(this.failedToCreate)return;oe.program.set(this.program),oe.setDepthMode(p),oe.setStencilMode(v),oe.setColorMode(w),oe.setCullFace(T);for(const[xe,ye]of this.fixedUniformsEntries)ye.set(this.program,xe,P[xe]);ee&&ee.setUniforms(this.program,oe,this.binderUniforms,H,{zoom:q});const me={[he.POINTS]:1,[he.LINES]:2,[he.TRIANGLES]:3,[he.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const de=Y||[],Ae=ee?ee.getPaintVertexBuffers():[],be=c===he.TRIANGLES&&N,Se=se&&se>0?1:void 0;for(const xe of W.get()){const ye=xe.vaos||(xe.vaos={});if((ye[O]||(ye[O]=new YS)).bind(oe,this,k,Ae,N,xe.vertexOffset,de,Se),this.forceManualRenderingForInstanceIDShaders){const Ce=se||1;for(let Le=0;Le<Ce;++Le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),N?he.drawElements(c,xe.primitiveLength*me,he.UNSIGNED_SHORT,xe.primitiveOffset*me*2):he.drawArrays(c,xe.vertexOffset,xe.vertexLength)}else se&&se>1?he.drawElementsInstanced(c,xe.primitiveLength*me,he.UNSIGNED_SHORT,xe.primitiveOffset*me*2,se):N?he.drawElements(c,xe.primitiveLength*me,he.UNSIGNED_SHORT,xe.primitiveOffset*me*2):he.drawArrays(c,xe.vertexOffset,xe.vertexLength);be&&this._drawDebugWireframe(o,p,v,w,N,xe,H,q,ee,se)}}}function Cx(f,o,c=0){const p=Math.pow(2,o.tileID.overscaledZ),v=o.tileSize*Math.pow(2,f.transform.tileZoom)/p,w=v*(o.tileID.canonical.x+o.tileID.wrap*p),T=v*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(o,1,f.transform.tileZoom),u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T],u_pattern_transition:c}}const Sp={terrain:0,flat:1},a2=i.bC(),Ep=(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe)=>{const he=o.style.light,me=he.properties.get("position"),de=[me.x,me.y,me.z],Ae=i.dO();he.properties.get("anchor")==="viewport"&&(i.dP(Ae,-o.transform.angle),i.dQ(de,de,Ae));const be=he.properties.get("color").toPremultipliedRenderColor(null),Se=o.transform,xe={u_matrix:f,u_lightpos:de,u_lightintensity:he.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:a2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Sp[k],u_base_type:Sp[N],u_ao:v,u_edge_radius:w,u_width_scale:T,u_flood_light_color:ee,u_vertical_scale:Y,u_flood_light_intensity:se,u_ground_shadow_factor:oe};return Se.projection.name==="globe"&&(xe.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],xe.u_zoom_transition=W,xe.u_inv_rot_matrix=q,xe.u_merc_center=H,xe.u_up_dir=Se.projection.upVector(new i.cD(0,0,0),H[0]*i.al,H[1]*i.al),xe.u_height_lift=O),xe},zy=(f,o,c,p,v,w)=>({u_matrix:f,u_edge_radius:o,u_width_scale:c,u_vertical_scale:p,u_height_type:Sp[v],u_base_type:Sp[w]}),Ix=(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe)=>{const he=Ep(f,o,c,p,v,w,T,P,k,N,W,H,q,ee,Y,se,1,[0,0,0]),me={u_height_factor:-Math.pow(2,P.overscaledZ)/O.tileSize/8};return Object.assign(he,Cx(o,O,oe),me)},hh=(f,o,c,p,v,w,T,P,O,k,N)=>({u_matrix:o,u_opacity:c,u_ao_pass:p?1:0,u_meter_to_tile:v,u_ao:w,u_flood_light_intensity:T,u_flood_light_color:P,u_attenuation:O,u_edge_radius:k,u_fb:0,u_fb_size:N,u_dynamic_offset:1}),Fy=(f,o,c)=>({u_matrix:f,u_emissive_strength:o,u_ground_shadow_factor:c}),By=(f,o,c,p,v,w=0)=>Object.assign(Fy(f,o,v),Cx(c,p,w)),Mx=(f,o,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:o,u_ground_shadow_factor:p}),Vy=(f,o,c,p,v,w,T=0)=>Object.assign(By(f,o,c,p,w,T),{u_world:v}),Sc=(f,o)=>({u_matrix:f,u_ground_shadow_factor:o}),hu=(f,o,c,p,v)=>({u_matrix:f,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:v}),Ap=(f,o,c,p,v,w,T,P,O)=>({u_matrix:f,u_normal_matrix:o,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:v,u_tile_to_meter:w,u_facade_emissive_chance:T,u_flood_light_color:P,u_flood_light_intensity:O}),Ox=f=>({u_matrix:f}),Ec=f=>({u_matrix:f}),$y=(f,o,c,p,v,w,T,P)=>{const O=i.al/w.tileSize;return{u_matrix:f,u_inv_rot_matrix:o,u_camera_to_center_distance:c.getCameraToCenterDistance(P),u_extrude_scale:[c.pixelsToGLUnits[0]/O,c.pixelsToGLUnits[1]/O],u_zoom_transition:p,u_tile_id:T,u_merc_center:v}},Md=(f,o,c=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:c}),Rx=i.bC(),Dx=(f,o,c,p,v,w,T)=>{const P=f.transform,O=P.projection.name==="globe",k=O?i.dR(P.zoom,o.canonical)*P._pixelsPerMercatorPixel:i.ay(c,1,w),N={u_matrix:o.projMatrix,u_extrude_scale:k,u_intensity:T,u_inv_rot_matrix:Rx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){N.u_inv_rot_matrix=p,N.u_merc_center=v,N.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],N.u_zoom_transition=i.aj(P.zoom);const W=v[0]*i.al,H=v[1]*i.al;N.u_up_dir=P.projection.upVector(new i.cD(0,0,0),W,H)}return N};function Pp(f,[o,c,p,v],[w,T]){if(w===T)return[0,0,0,0];const P=255*(f-1)/(f*(T-w));return[o*P,c*P,p*P,v*P]}function Cp(f,o,[c,p]){return c===p?0:.5/f+(o-c)*(f-1)/(f*(p-c))}const kx=(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he,me,de)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:k,u_fade_t:N.mix,u_opacity:N.opacity*W.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:W.paint.get("raster-brightness-min"),u_brightness_high:W.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(W.paint.get("raster-saturation")),u_contrast_factor:i.dS(W.paint.get("raster-contrast")),u_spin_weights:jx(W.paint.get("raster-hue-rotate")),u_perspective_transform:H,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:O,u_colorization_mix:Pp(i.dU,Y,oe),u_colorization_offset:Cp(i.dU,se,oe),u_color_ramp:ee,u_texture_offset:[me/(he+2*me),he/(he+2*me)],u_texture_res:[he+2*me,he+2*me],u_emissive_strength:de});function jx(f){f*=Math.PI/180;const o=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Ka=.05,l2=(f,o,c,p,v,w,T,P,O,k,N,W)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:k,u_fade_t:N.mix,u_opacity:N.opacity,u_image0:0,u_image1:1,u_raster_elevation:W,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:O}),c2=(f,o,c,p,v,w,T,P,O,k)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_tile_offset:c,u_velocity:p,u_color_ramp:w,u_velocity_res:v,u_max_speed:T,u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ka,Ka]}),Lx=(f,o,c,p,v,w,T,P,O,k)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_velocity:c,u_velocity_res:p,u_max_speed:v,u_speed_factor:w,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ka,Ka]}),Nx=i.bC(),Ip=(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he,me,de,Ae,be,Se)=>{const xe=v.transform,ye={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(he),u_rotate_symbol:+c,u_aspect_ratio:xe.width/xe.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+k,u_elevation_from_sea:O?1:0,u_pitch_with_map:+p,u_texsize:N,u_texsize_icon:W,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nx,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nx,u_up_vector:[0,-1,0],u_color_adj_mat:Ae,u_icon_transition:be||0,u_gamma_scale:p?v.transform.getCameraToCenterDistance(he)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Se||1,u_ground_shadow_factor:me,u_inv_matrix:i.bl(i.bC(),T),u_normal_scale:de,u_lutTexture:So.LUT};return he.name==="globe"&&(ye.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ye.u_zoom_transition=ee,ye.u_inv_rot_matrix=se,ye.u_merc_center=Y,ye.u_camera_forward=xe._camera.forward(),ye.u_ecef_origin=i.dV(xe.globeMatrix,q.toUnwrapped()),ye.u_tile_matrix=Float32Array.from(xe.globeMatrix),ye.u_up_vector=oe),ye},Od=(f,o,c,p)=>({u_matrix:f,u_emissive_strength:o,u_opacity:c,u_color:p}),Ac=(f,o,c,p,v,w,T,P,O)=>Object.assign(function(k,N,W,H,q,ee){const{width:Y,height:se}=H.imageManager.getPixelSize(N),oe=Math.pow(2,ee.tileID.overscaledZ),he=ee.tileSize*Math.pow(2,H.transform.tileZoom)/oe,me=he*(ee.tileID.canonical.x+ee.tileID.wrap*oe),de=he*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:W.tl,u_pattern_br:W.br,u_texsize:[Y,se],u_pattern_size:W.displaySize,u_pattern_units_to_pixels:q?[H.transform.width,-1*H.transform.height]:[1/i.ay(ee,1,H.transform.tileZoom),1/i.ay(ee,1,H.transform.tileZoom)],u_pixel_coord_upper:[me>>16,de>>16],u_pixel_coord_lower:[65535&me,65535&de]}}(0,w,T,p,P,O),{u_matrix:f,u_emissive_strength:o,u_opacity:c}),dh=new Float32Array(i.bA([])),du=(f,o,c,p,v,w,T,P,O,k,N,W,H,q=[0,0,0],ee,Y,se)=>{const oe=v.style.light,he=oe.properties.get("position"),me=[-he.x,-he.y,he.z],de=i.dO();oe.properties.get("anchor")==="viewport"&&(i.dP(de,-v.transform.angle),i.dQ(me,me,de));const Ae=N.alphaMode==="MASK",be=oe.properties.get("color").toNonPremultipliedRenderColor(null),Se=H.paint.get("model-ambient-occlusion-intensity"),xe=H.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return xe.a=H.paint.get("model-color-mix-intensity").constantOr(0),se&&(xe.r=se[0],xe.g=se[1],xe.b=se[2],xe.a=se[3]),Y&&(xe.r=Y.color.r,xe.g=Y.color.g,xe.b=Y.color.b,xe.a=Y.colorMix,W=Y.emissionStrength,w*=Y.opacity),{u_matrix:f,u_lighting_matrix:o,u_normal_matrix:c,u_node_matrix:p||dh,u_lightpos:me,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_camera_pos:q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Ae,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:k,u_baseColorTexture:So.BaseColor,u_metallicRoughnessTexture:So.MetallicRoughness,u_normalTexture:So.Normal,u_occlusionTexture:So.Occlusion,u_emissionTexture:So.Emission,u_lutTexture:So.LUT,u_color_mix:xe.toArray01(),u_aoIntensity:Se,u_emissive_strength:W,u_occlusionTextureTransform:ee||[0,0,0,0]}},Uy=(f,o=dh,c=dh)=>({u_matrix:f,u_instance:o,u_node_matrix:c}),Mp={fillExtrusion:f=>({u_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_vertical_gradient:new i.cj(f),u_opacity:new i.cj(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_ao:new i.ck(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_up_dir:new i.ci(f),u_height_lift:new i.cj(f),u_flood_light_color:new i.ci(f),u_vertical_scale:new i.cj(f),u_flood_light_intensity:new i.cj(f),u_ground_shadow_factor:new i.ci(f)}),fillExtrusionDepth:f=>({u_matrix:new i.cl(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_vertical_scale:new i.cj(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f)}),fillExtrusionPattern:f=>({u_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_vertical_gradient:new i.cj(f),u_height_factor:new i.cj(f),u_edge_radius:new i.cj(f),u_width_scale:new i.cj(f),u_ao:new i.ck(f),u_height_type:new i.ch(f),u_base_type:new i.ch(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_up_dir:new i.ci(f),u_height_lift:new i.cj(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_opacity:new i.cj(f),u_pattern_transition:new i.cj(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.cl(f),u_opacity:new i.cj(f),u_ao_pass:new i.cj(f),u_meter_to_tile:new i.cj(f),u_ao:new i.ck(f),u_flood_light_intensity:new i.cj(f),u_flood_light_color:new i.ci(f),u_attenuation:new i.cj(f),u_edge_radius:new i.cj(f),u_fb:new i.ch(f),u_fb_size:new i.cj(f),u_dynamic_offset:new i.cj(f)}),fill:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_ground_shadow_factor:new i.ci(f)}),fillPattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_pattern_transition:new i.cj(f)}),fillOutline:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_world:new i.ck(f),u_ground_shadow_factor:new i.ci(f)}),fillOutlinePattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_world:new i.ck(f),u_image:new i.ch(f),u_texsize:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_tile_units_to_pixels:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_pattern_transition:new i.cj(f)}),building:f=>({u_matrix:new i.cl(f),u_normal_matrix:new i.cl(f),u_opacity:new i.cj(f),u_faux_facade_ao_intensity:new i.cj(f),u_camera_pos:new i.ci(f),u_tile_to_meter:new i.cj(f),u_facade_emissive_chance:new i.cj(f),u_flood_light_color:new i.ci(f),u_flood_light_intensity:new i.cj(f)}),buildingBloom:f=>({u_matrix:new i.cl(f)}),buildingDepth:f=>({u_matrix:new i.cl(f)}),elevatedStructuresDepth:f=>({u_matrix:new i.cl(f),u_depth_bias:new i.cj(f)}),elevatedStructures:f=>({u_matrix:new i.cl(f),u_ground_shadow_factor:new i.ci(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new i.cl(f),u_camera_pos:new i.ci(f),u_depth_bias:new i.cj(f),u_height_scale:new i.cj(f),u_reset_depth:new i.cj(f)}),circle:i.dY,collisionBox:f=>({u_matrix:new i.cl(f),u_inv_rot_matrix:new i.cl(f),u_camera_to_center_distance:new i.cj(f),u_extrude_scale:new i.ck(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_tile_id:new i.ci(f)}),collisionCircle:f=>({u_matrix:new i.cl(f),u_inv_matrix:new i.cl(f),u_camera_to_center_distance:new i.cj(f),u_viewport_size:new i.ck(f)}),debug:f=>({u_color:new i.dB(f),u_matrix:new i.cl(f),u_overlay:new i.ch(f),u_overlay_scale:new i.cj(f)}),clippingMask:f=>({u_matrix:new i.cl(f)}),heatmap:f=>({u_extrude_scale:new i.cj(f),u_intensity:new i.cj(f),u_matrix:new i.cl(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_up_dir:new i.ci(f)}),heatmapTexture:f=>({u_image:new i.ch(f),u_color_ramp:new i.ch(f),u_opacity:new i.cj(f)}),hillshade:f=>({u_matrix:new i.cl(f),u_image:new i.ch(f),u_latrange:new i.ck(f),u_light:new i.ck(f),u_shadow:new i.dB(f),u_highlight:new i.dB(f),u_emissive_strength:new i.cj(f),u_accent:new i.dB(f)}),hillshadePrepare:f=>({u_matrix:new i.cl(f),u_image:new i.ch(f),u_dimension:new i.ck(f),u_zoom:new i.cj(f)}),line:i.dX,linePattern:i.dW,raster:f=>({u_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_grid_matrix:new i.dC(f),u_tl_parent:new i.ck(f),u_scale_parent:new i.cj(f),u_fade_t:new i.cj(f),u_opacity:new i.cj(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_brightness_low:new i.cj(f),u_brightness_high:new i.cj(f),u_saturation_factor:new i.cj(f),u_contrast_factor:new i.cj(f),u_spin_weights:new i.ci(f),u_perspective_transform:new i.ck(f),u_raster_elevation:new i.cj(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_cutoff_params:new i.d3(f),u_colorization_mix:new i.d3(f),u_colorization_offset:new i.cj(f),u_color_ramp:new i.ch(f),u_texture_offset:new i.ck(f),u_texture_res:new i.ck(f),u_emissive_strength:new i.cj(f)}),rasterParticle:f=>({u_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_grid_matrix:new i.dC(f),u_tl_parent:new i.ck(f),u_scale_parent:new i.cj(f),u_fade_t:new i.cj(f),u_opacity:new i.cj(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_raster_elevation:new i.cj(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_cutoff_params:new i.d3(f)}),rasterParticleTexture:f=>({u_texture:new i.ch(f),u_opacity:new i.cj(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.ch(f),u_particle_texture_side_len:new i.cj(f),u_tile_offset:new i.ck(f),u_velocity:new i.ch(f),u_color_ramp:new i.ch(f),u_velocity_res:new i.ck(f),u_max_speed:new i.cj(f),u_uv_offset:new i.ck(f),u_data_scale:new i.ck(f),u_data_offset:new i.cj(f),u_particle_pos_scale:new i.cj(f),u_particle_pos_offset:new i.ck(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.ch(f),u_particle_texture_side_len:new i.cj(f),u_velocity:new i.ch(f),u_velocity_res:new i.ck(f),u_max_speed:new i.cj(f),u_speed_factor:new i.cj(f),u_reset_rate:new i.cj(f),u_rand_seed:new i.cj(f),u_uv_offset:new i.ck(f),u_data_scale:new i.ck(f),u_data_offset:new i.cj(f),u_particle_pos_scale:new i.cj(f),u_particle_pos_offset:new i.ck(f)}),symbol:f=>({u_is_size_zoom_constant:new i.ch(f),u_is_size_feature_constant:new i.ch(f),u_size_t:new i.cj(f),u_size:new i.cj(f),u_camera_to_center_distance:new i.cj(f),u_rotate_symbol:new i.ch(f),u_aspect_ratio:new i.cj(f),u_fade_change:new i.cj(f),u_matrix:new i.cl(f),u_label_plane_matrix:new i.cl(f),u_coord_matrix:new i.cl(f),u_is_text:new i.ch(f),u_elevation_from_sea:new i.ch(f),u_pitch_with_map:new i.ch(f),u_texsize:new i.ck(f),u_texsize_icon:new i.ck(f),u_texture:new i.ch(f),u_texture_icon:new i.ch(f),u_gamma_scale:new i.cj(f),u_device_pixel_ratio:new i.cj(f),u_tile_id:new i.ci(f),u_zoom_transition:new i.cj(f),u_inv_rot_matrix:new i.cl(f),u_merc_center:new i.ck(f),u_camera_forward:new i.ci(f),u_tile_matrix:new i.cl(f),u_up_vector:new i.ci(f),u_ecef_origin:new i.ci(f),u_is_halo:new i.ch(f),u_icon_transition:new i.cj(f),u_color_adj_mat:new i.cl(f),u_scale_factor:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_inv_matrix:new i.cl(f),u_normal_scale:new i.cj(f),u_lutTexture:new i.ch(f)}),background:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_opacity:new i.cj(f),u_color:new i.dB(f)}),backgroundPattern:f=>({u_matrix:new i.cl(f),u_emissive_strength:new i.cj(f),u_opacity:new i.cj(f),u_image:new i.ch(f),u_pattern_tl:new i.ck(f),u_pattern_br:new i.ck(f),u_texsize:new i.ck(f),u_pattern_size:new i.ck(f),u_pixel_coord_upper:new i.ck(f),u_pixel_coord_lower:new i.ck(f),u_pattern_units_to_pixels:new i.ck(f)}),terrainRaster:f=>({u_matrix:new i.cl(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_skirt_height:new i.cj(f),u_ground_shadow_factor:new i.ci(f),u_emissive_texture_available:new i.cj(f)}),skybox:f=>({u_matrix:new i.cl(f),u_sun_direction:new i.ci(f),u_cubemap:new i.ch(f),u_opacity:new i.cj(f),u_temporal_offset:new i.cj(f)}),skyboxGradient:f=>({u_matrix:new i.cl(f),u_color_ramp:new i.ch(f),u_center_direction:new i.ci(f),u_radius:new i.cj(f),u_opacity:new i.cj(f),u_temporal_offset:new i.cj(f)}),skyboxCapture:f=>({u_matrix_3f:new i.dC(f),u_sun_direction:new i.ci(f),u_sun_intensity:new i.cj(f),u_color_tint_r:new i.d3(f),u_color_tint_m:new i.d3(f),u_luminance:new i.cj(f)}),globeRaster:f=>({u_proj_matrix:new i.cl(f),u_globe_matrix:new i.cl(f),u_normalize_matrix:new i.cl(f),u_merc_matrix:new i.cl(f),u_zoom_transition:new i.cj(f),u_merc_center:new i.ck(f),u_image0:new i.ch(f),u_image1:new i.ch(f),u_grid_matrix:new i.dC(f),u_skirt_height:new i.cj(f),u_far_z_cutoff:new i.cj(f),u_frustum_tl:new i.ci(f),u_frustum_tr:new i.ci(f),u_frustum_br:new i.ci(f),u_frustum_bl:new i.ci(f),u_globe_pos:new i.ci(f),u_globe_radius:new i.cj(f),u_viewport:new i.ck(f),u_emissive_texture_available:new i.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.ci(f),u_frustum_tr:new i.ci(f),u_frustum_br:new i.ci(f),u_frustum_bl:new i.ci(f),u_horizon:new i.cj(f),u_transition:new i.cj(f),u_fadeout_range:new i.cj(f),u_atmosphere_fog_color:new i.d3(f),u_high_color:new i.d3(f),u_space_color:new i.d3(f),u_temporal_offset:new i.cj(f),u_horizon_angle:new i.cj(f)}),model:f=>({u_matrix:new i.cl(f),u_lighting_matrix:new i.cl(f),u_normal_matrix:new i.cl(f),u_node_matrix:new i.cl(f),u_lightpos:new i.ci(f),u_lightintensity:new i.cj(f),u_lightcolor:new i.ci(f),u_camera_pos:new i.ci(f),u_opacity:new i.cj(f),u_baseColorFactor:new i.d3(f),u_emissiveFactor:new i.d3(f),u_metallicFactor:new i.cj(f),u_roughnessFactor:new i.cj(f),u_baseTextureIsAlpha:new i.ch(f),u_alphaMask:new i.ch(f),u_alphaCutoff:new i.cj(f),u_baseColorTexture:new i.ch(f),u_metallicRoughnessTexture:new i.ch(f),u_normalTexture:new i.ch(f),u_occlusionTexture:new i.ch(f),u_emissionTexture:new i.ch(f),u_lutTexture:new i.ch(f),u_color_mix:new i.d3(f),u_aoIntensity:new i.cj(f),u_emissive_strength:new i.cj(f),u_occlusionTextureTransform:new i.d3(f)}),modelDepth:f=>({u_matrix:new i.cl(f),u_instance:new i.cl(f),u_node_matrix:new i.cl(f)}),groundShadow:f=>({u_matrix:new i.cl(f),u_ground_shadow_factor:new i.ci(f)}),stars:f=>({u_matrix:new i.cl(f),u_up:new i.ci(f),u_right:new i.ci(f),u_intensity_multiplier:new i.cj(f)}),snowParticle:f=>({u_modelview:new i.cl(f),u_projection:new i.cl(f),u_time:new i.cj(f),u_cam_pos:new i.ci(f),u_velocityConeAperture:new i.cj(f),u_velocity:new i.cj(f),u_horizontalOscillationRadius:new i.cj(f),u_horizontalOscillationRate:new i.cj(f),u_boxSize:new i.cj(f),u_billboardSize:new i.cj(f),u_simpleShapeParameters:new i.ck(f),u_screenSize:new i.ck(f),u_thinningCenterPos:new i.ck(f),u_thinningShape:new i.ci(f),u_thinningAffectedRatio:new i.cj(f),u_thinningParticleOffset:new i.cj(f),u_particleColor:new i.d3(f),u_direction:new i.ci(f)}),rainParticle:f=>({u_modelview:new i.cl(f),u_projection:new i.cl(f),u_time:new i.cj(f),u_cam_pos:new i.ci(f),u_texScreen:new i.ch(f),u_velocityConeAperture:new i.cj(f),u_velocity:new i.cj(f),u_boxSize:new i.cj(f),u_rainDropletSize:new i.ck(f),u_distortionStrength:new i.cj(f),u_rainDirection:new i.ci(f),u_color:new i.d3(f),u_screenSize:new i.ck(f),u_thinningCenterPos:new i.ck(f),u_thinningShape:new i.ci(f),u_thinningAffectedRatio:new i.cj(f),u_thinningParticleOffset:new i.cj(f),u_shapeDirectionalPower:new i.cj(f),u_shapeNormalPower:new i.cj(f),u_mode:new i.cj(f)}),vignette:f=>({u_vignetteShape:new i.ci(f),u_vignetteColor:new i.d3(f)}),occlusion:f=>({u_matrix:new i.cl(f),u_anchorPos:new i.ci(f),u_screenSizePx:new i.ck(f),u_occluderSizePx:new i.ck(f),u_color:new i.d3(f)})};class Ia{constructor(o,c,p,v){this.id=Ia.uniqueIdxCounter,Ia.uniqueIdxCounter++,this.context=o;const w=o.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Ia.uniqueIdxCounter,Ia.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ia.uniqueIdxCounter=0;const Gy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zx{constructor(o,c,p,v,w,T){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=o;const P=o.gl;this.buffer=P.createBuffer(),o.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let p=0;p<this.attributes.length;p++){const v=c.getAttributeLocation(o,this.attributes[p].name);v!==-1&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,c,p){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],T=c.getAttributeLocation(o,w.name);T!==-1&&o.vertexAttribPointer(T,w.components,o[Gy[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(o,c,p){for(let v=0;v<this.attributes.length;v++){const w=c.getAttributeLocation(o,this.attributes[v].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(w,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fx{constructor(o,c,p,v,w){this.context=o,this.width=c,this.height=p;const T=this.framebuffer=o.gl.createFramebuffer();v>0&&(this.colorAttachment0=new vp(o,T,0)),v>1&&(this.colorAttachment1=new vp(o,T,1)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new lh(o,T):new Ad(o,T))}createColorAttachment(o,c){c===0?this.colorAttachment0=new vp(o,this.framebuffer,0):c===1&&(this.colorAttachment1=new vp(o,this.framebuffer,1))}removeColorAttachment(o,c){const p=this.context.gl;let v;c===0?(v=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(v=this.colorAttachment1.get(),this.colorAttachment1=void 0),v&&p.deleteTexture(v)}destroy(){const o=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&o.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&o.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&o.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&o.deleteTexture(c)}o.deleteFramebuffer(this.framebuffer)}}class fh{constructor(o,c){this.gl=o,this.clearColor=new t2(this),this.clearDepth=new _x(this),this.clearStencil=new Ay(this),this.colorMask=new pp(this),this.depthMask=new Py(this),this.stencilMask=new uu(this),this.stencilFunc=new ih(this),this.stencilOp=new Sd(this),this.stencilTest=new oh(this),this.depthRange=new vx(this),this.depthTest=new Cy(this),this.depthFunc=new xx(this),this.blend=new sh(this),this.blendFunc=new mp(this),this.blendColor=new gp(this),this.blendEquation=new Iy(this),this.cullFace=new yp(this),this.cullFaceSide=new Ed(this),this.frontFace=new bx(this),this.program=new wx(this),this.activeTexture=new Tx(this),this.viewport=new ah(this),this.bindFramebuffer=new Sx(this),this.bindRenderbuffer=new r2(this),this.bindTexture=new n2(this),this.bindVertexBuffer=new i2(this),this.bindElementBuffer=new My(this),this.bindVertexArrayOES=new Oy(this),this.pixelStoreUnpack=new Ry(this),this.pixelStoreUnpackPremultiplyAlpha=new Dy(this),this.pixelStoreUnpackFlipY=new Ex(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c,p){return new Ia(this,o,c,p)}createVertexBuffer(o,c,p,v,w){return new zx(this,o,c,p,v,w)}createRenderbuffer(o,c,p){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,o,c,p),this.bindRenderbuffer.set(null),w}createFramebuffer(o,c,p,v){return new Fx(this,o,c,p,v)}clear({color:o,depth:c,stencil:p,colorMask:v}){const w=this.gl;let T=0;o&&(T|=w.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(T|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(T|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),w.clear(T)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){i.by(o.blendFunction,Lr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let fu;function Yt(f,o,c,p,v,w,T){const P=f.context,O=P.gl,k=f.transform,N=[i.aF(k.center.lng),i.aJ(k.center.lat)],W=c.layout.get("symbol-placement"),H=c.layout.get("text-variable-anchor"),q=c.layout.get("icon-rotation-alignment")==="map",ee=c.layout.get("text-rotation-alignment")==="map",Y=W!=="point",se=[];let oe=0,he=0;for(let ye=0;ye<p.length;ye++){const Ce=p[ye],Le=o.getTile(Ce),ke=Le.getBucket(c);if(!ke)continue;const Je=ke.getProjection().createInversionMatrix(k,Ce.canonical),et=[],ht=Yf(Ce,ke,k),St=!T&&q&&Y,We=T&&ee&&Y,Re=H&&ke.hasTextData(),ot=ke.hasIconTextFit()&&Re&&ke.hasIconData(),Ze=St||We||T&&Re||ot,gt=ke.projection.name==="globe",Rt=gt?i.aj(k.zoom):0;gt&&(et.push("PROJECTION_GLOBE_VIEW"),Ze&&et.push("PROJECTED_POS_ON_VIEWPORT"));const $t=f.getOrCreateProgram("collisionBox",{defines:et});let It=ht;v[0]===0&&v[1]===0||(It=f.translatePosMatrix(ht,Le,v,w));const Et=T?ke.textCollisionBox:ke.iconCollisionBox,tr=ke.collisionCircleArray;if(tr.length>0){const zt=i.bC(),Gt=It;i.cP(zt,ke.placementInvProjMatrix,k.glCoordMatrix),i.cP(zt,zt,ke.placementViewportMatrix),se.push({circleArray:tr,circleOffset:he,transform:Gt,invTransform:zt,projection:ke.getProjection()}),oe+=tr.length/4,he=oe}if(!Et)continue;f.terrain&&f.terrain.setupElevationDraw(Le,$t);const Jt=gt?[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z]:[0,0,0];$t.draw(f,O.LINES,ir.disabled,Tr.disabled,f.colorModeForRenderPass(),br.disabled,$y(It,Je,k,Rt,N,Le,Jt,ke.getProjection()),c.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,k.zoom,null,[Et.collisionVertexBuffer,Et.collisionVertexBufferExt])}if(!T||!se.length)return;const me=f.getOrCreateProgram("collisionCircle"),de=new i.dZ;de.resize(4*oe),de._trim();let Ae=0;for(const ye of se)for(let Ce=0;Ce<ye.circleArray.length/4;Ce++){const Le=4*Ce,ke=ye.circleArray[Le+0],Je=ye.circleArray[Le+1],et=ye.circleArray[Le+2],ht=ye.circleArray[Le+3];de.emplace(Ae++,ke,Je,et,ht,0),de.emplace(Ae++,ke,Je,et,ht,1),de.emplace(Ae++,ke,Je,et,ht,2),de.emplace(Ae++,ke,Je,et,ht,3)}(!fu||fu.length<2*oe)&&(fu=function(ye){const Ce=2*ye,Le=new i.b0;Le.resize(Ce),Le._trim();for(let ke=0;ke<Ce;ke++){const Je=6*ke;Le.uint16[Je+0]=4*ke+0,Le.uint16[Je+1]=4*ke+1,Le.uint16[Je+2]=4*ke+2,Le.uint16[Je+3]=4*ke+2,Le.uint16[Je+4]=4*ke+3,Le.uint16[Je+5]=4*ke+0}return Le}(oe));const be=P.createIndexBuffer(fu,!0),Se=P.createVertexBuffer(de,i.d_.members,!0);for(const ye of se){const Ce={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(xe=k).getCameraToCenterDistance(ye.projection),u_viewport_size:[xe.width,xe.height]};me.draw(f,O.TRIANGLES,ir.disabled,Tr.disabled,f.colorModeForRenderPass(),br.disabled,Ce,c.id,Se,be,i.bg.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,k.zoom)}var xe;Se.destroy(),be.destroy()}const Rd=i.bC();function Pl(f){const o=f._camera.getWorldToCamera(f.worldSize,1),c=i.aB([],o,f.globeMatrix);i.bl(c,c);const p=[0,0,0],v=[0,1,0,0];return i.aC(v,v,c),p[0]=v[0],p[1]=v[1],p[2]=v[2],i.aw(p,p),p}function Pc({width:f,height:o,anchor:c,textOffset:p,textScale:v},w){const{horizontalAlign:T,verticalAlign:P}=i.c1(c),O=-(T-.5)*f,k=-(P-.5)*o,N=i.c2(c,p);return new i.P((O/v+N[0])*w,(k/v+N[1])*w)}function mr(f,o,c,p,v,w,T,P,O,k){const N=f.text.placedSymbolArray,W=f.text.dynamicLayoutVertexArray,H=f.icon.dynamicLayoutVertexArray,q={},ee=f.getProjection(),Y=Ha(T,ee,v),se=v.elevation,oe=ee.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;W.clear();for(let he=0;he<N.length;he++){const me=N.get(he),{tileAnchorX:de,tileAnchorY:Ae,numGlyphs:be}=me,Se=me.hidden||!me.crossTileID||f.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Se){let xe=0,ye=0,Ce=0;const Le=f.elevationType==="road";if(se||Le){const Ze=Le?f.getElevationFeatureForText(he):null,gt=i.bV.getAtTileOffset(T,new i.P(de,Ae),se,Ze),[Rt,$t,It]=ee.upVector(T.canonical,de,Ae);xe=gt*Rt*oe,ye=gt*$t*oe,Ce=gt*It*oe}let[ke,Je,et,ht]=ia(me.projectedAnchorX+xe,me.projectedAnchorY+ye,me.projectedAnchorZ+Ce,c?Y:w);const St=Dn(v.getCameraToCenterDistance(ee),ht);let We=i.bM(f.textSizeData,O,me)*St/i.bY;c&&(We*=f.tilePixelRatio/P);const Re=Pc(Se,We);c?({x:ke,y:Je,z:et}=ee.projectTilePoint(de+Re.x,Ae+Re.y,T.canonical),[ke,Je,et]=ia(ke+xe,Je+ye,et+Ce,w)):(o&&Re._rotate(-v.angle),ke+=Re.x,Je+=Re.y,et=0);const ot=f.allowVerticalPlacement&&me.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let Ze=0;Ze<be;Ze++)i.bO(W,ke,Je,et,ot);k&&me.associatedIconIndex>=0&&(q[me.associatedIconIndex]={x:ke,y:Je,z:et,angle:ot})}else Aa(be,W)}if(k){H.clear();const he=f.icon.placedSymbolArray;for(let me=0;me<he.length;me++){const de=he.get(me),{numGlyphs:Ae}=de,be=q[me];if(de.hidden||!be)Aa(Ae,H);else{const{x:Se,y:xe,z:ye,angle:Ce}=be;for(let Le=0;Le<Ae;Le++)i.bO(H,Se,xe,ye,Ce)}}f.icon.dynamicLayoutVertexBuffer.updateData(H)}f.text.dynamicLayoutVertexBuffer.updateData(W)}function Dd(f,o,c,p,v,w,T={}){const P=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),k=c.paint.get("icon-translate-anchor"),N=c.paint.get("text-translate-anchor"),W=c.layout.get("icon-rotation-alignment"),H=c.layout.get("text-rotation-alignment"),q=c.layout.get("icon-pitch-alignment"),ee=c.layout.get("text-pitch-alignment"),Y=c.layout.get("icon-keep-upright"),se=c.layout.get("text-keep-upright"),oe=c.paint.get("icon-color-saturation"),he=c.paint.get("icon-color-contrast"),me=c.paint.get("icon-color-brightness-min"),de=c.paint.get("icon-color-brightness-max"),Ae=c.layout.get("symbol-elevation-reference")==="sea",be=c.layout.get("icon-image-use-theme")==="none",Se=f.context,xe=Se.gl,ye=f.transform,Ce=W==="map",Le=H==="map",ke=q==="map",Je=ee==="map",et=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ht=!1;const St=f.depthModeForSublayer(0,ir.ReadOnly),We=new ir(f.context.gl.LEQUAL,ir.ReadOnly,f.depthRangeFor3D),Re=[i.aF(ye.center.lng),i.aJ(ye.center.lat)],ot=c.layout.get("text-variable-anchor"),Ze=ye.projection.name==="globe",gt=[],Rt=[0,-1,0];for(const $t of p){const It=o.getTile($t),Et=It.getBucket(c);if(!Et||Et.projection.name==="mercator"&&Ze||Et.fullyClipped)continue;const tr=Et.projection.name==="globe",Jt=tr?i.aj(ye.zoom):0,zt=Ha($t,Et.getProjection(),ye),Gt=ye.calculatePixelsToTileUnitsMatrix(It),dr=ot&&Et.hasTextData(),Or=Et.hasIconTextFit()&&dr&&Et.hasIconData(),Qr=Et.getProjection().createInversionMatrix(ye,$t.canonical),wn=(1<<It.tileID.canonical.z)*i.al/f.transform.worldSize,rr=Pn=>{let fn=[0,0,0];if(Pn){const Br=f.style.directionalLight,oi=f.style.ambientLight;Br&&oi&&(fn=El(f.style,Br,oi))}return fn},vn=Pn=>{ye.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||f.terrain)&&(Pn.push("DEPTH_D24"),Pn.push("DEPTH_OCCLUSION"))},Mr=Pn=>{c.lut&&!be&&(c.lut.texture||(c.lut.texture=new i.d$(f.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Se.gl.RGBA8)),Se.activeTexture.set(Se.gl.TEXTURE0+So.LUT),c.lut.texture&&c.lut.texture.bind(Se.gl.LINEAR,Se.gl.CLAMP_TO_EDGE),Pn.push("APPLY_LUT_ON_GPU"))},An=()=>{const Pn=Ce&&c.layout.get("symbol-placement")!=="point",fn=[];vn(fn),Mr(fn);const Br=Pn||Or,oi=Et.elevationType==="road",Di=f.shadowRenderer,yi=oi&&ke&&!!Di&&Di.enabled,qn=rr(yi),_s=oi&&ke&&!f.terrain?We:St,zo=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&ke&&fn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(fn.push("PROJECTION_GLOBE_VIEW"),Br&&fn.push("PROJECTED_POS_ON_VIEWPORT")),zo>0&&Et.hasAnySecondaryIcon&&fn.push("ICON_TRANSITION"),!Et.icon.zOffsetVertexBuffer||oi&&f.terrain||fn.push("Z_OFFSET"),oe===0&&he===0&&me===0&&de===1||fn.push("COLOR_ADJUSTMENT"),Et.sdfIcons&&fn.push("RENDER_SDF"),yi&&fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),oi&&ke&&!f.terrain&&Et.icon.orientationVertexBuffer&&fn.push("ELEVATED_ROADS");const no=Et.icon.programConfigurations.get(c.id),Ho=f.getOrCreateProgram("symbol",{config:no,defines:fn}),Wo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],Mo=Et.iconSizeData,Ks=i.bK(Mo,ye.zoom),da=ke||!ye.isOrthographic,Cs=es(zt,It.tileID.canonical,ke,Ce,ye,Et.getProjection(),Gt),Ci=pd(zt,It.tileID.canonical,ke,Ce,ye,Et.getProjection(),Gt),Li=f.translatePosMatrix(Ci,It,P,k,!0),Zn=f.translatePosMatrix(zt,It,P,k),Vi=Br?Rd:Cs,Ti=Ce&&!ke&&!Pn;let _i=Rt;!Ze&&!ye.mercatorFromTransition||Ce||(_i=Pl(ye));const fa=tr?_i:Rt,Hd=c.getColorAdjustmentMatrix(oe,he,me,de),Ra=Ip(Mo.kind,Ks,Ti,ke,f,Zn,Vi,Li,Ae,!1,Wo,[0,0],0,$t,Jt,Re,Qr,fa,Et.getProjection(),qn,wn,Hd,zo,null),Wd=It.imageAtlasTexture?It.imageAtlasTexture:null,wh=c.layout.get("icon-size").constantOr(0)!==1||Et.iconsNeedLinear,tl=Et.sdfIcons||f.options.rotating||f.options.zooming||wh||da?xe.LINEAR:xe.NEAREST,Ll=Et.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Th=f.terrain&&ke&&Pn?i.bl(i.bC(),Cs):Rd;if(Pn&&Et.icon){const Rc=i.bV.getAtTileOffsetFunc($t,ye.center.lat,ye.worldSize,Et.getProjection()),Nl=Jf(zt,It.tileID.canonical,ke,Ce,ye,Et.getProjection(),Gt),Da=c.layout.get("icon-size-scale-range"),zl=i.aA(f.scaleFactor,Da[0],Da[1]);cx(Et,zt,f,!1,Nl,Ci,ke,Y,Rc,$t,zl)}return{program:Ho,buffers:Et.icon,uniformValues:Ra,atlasTexture:Wd,atlasTextureIcon:null,atlasInterpolation:tl,atlasInterpolationIcon:null,isSDF:Et.sdfIcons,hasHalo:Ll,depthMode:_s,tile:It,renderWithShadows:yi,labelPlaneMatrixInv:Th}},Bn=()=>{const Pn=Le&&c.layout.get("symbol-placement")!=="point",fn=[],Br=Pn||ot||Or,oi=Et.elevationType==="road",Di=f.shadowRenderer,yi=oi&&Je&&!!Di&&Di.enabled,qn=rr(yi),_s=oi&&Je&&!f.terrain?We:St;f.terrainRenderModeElevated()&&Je&&fn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(fn.push("PROJECTION_GLOBE_VIEW"),Br&&fn.push("PROJECTED_POS_ON_VIEWPORT")),!Et.text.zOffsetVertexBuffer||oi&&f.terrain||fn.push("Z_OFFSET"),Et.iconsInText&&fn.push("RENDER_TEXT_AND_SYMBOL"),fn.push("RENDER_SDF"),yi&&fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),oi&&Je&&!f.terrain&&Et.text.orientationVertexBuffer&&fn.push("ELEVATED_ROADS"),vn(fn);const zo=Et.text.programConfigurations.get(c.id),no=f.getOrCreateProgram("symbol",{config:zo,defines:fn});let Ho,Wo=[0,0],Mo=null;const Ks=Et.textSizeData;Et.iconsInText&&(Wo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],Mo=It.imageAtlasTexture?It.imageAtlasTexture:null,Ho=Je||!ye.isOrthographic||f.options.rotating||f.options.zooming||Ks.kind==="composite"||Ks.kind==="camera"?xe.LINEAR:xe.NEAREST);const da=It.glyphAtlasTexture?It.glyphAtlasTexture.size:[0,0],Cs=c.layout.get("text-size-scale-range"),Ci=i.aA(f.scaleFactor,Cs[0],Cs[1]),Li=i.bK(Ks,ye.zoom,Ci),Zn=es(zt,It.tileID.canonical,Je,Le,ye,Et.getProjection(),Gt),Vi=pd(zt,It.tileID.canonical,Je,Le,ye,Et.getProjection(),Gt),Ti=f.translatePosMatrix(Vi,It,O,N,!0),_i=f.translatePosMatrix(zt,It,O,N),fa=Br?Rd:Zn,Hd=Le&&!Je&&!Pn;let Ra=Rt;!Ze&&!ye.mercatorFromTransition||Le||(Ra=Pl(ye));const Wd=Ip(Ks.kind,Li,Hd,Je,f,_i,fa,Ti,Ae,!0,da,Wo,0,$t,Jt,Re,Qr,tr?Ra:Rt,Et.getProjection(),qn,wn,null,null,Ci),wh=It.glyphAtlasTexture?It.glyphAtlasTexture:null,tl=xe.LINEAR,Ll=c.paint.get("text-halo-width").constantOr(1)!==0,Th=f.terrain&&Je&&Pn?i.bl(i.bC(),Zn):Rd;if(Pn&&Et.text){const Rc=i.bV.getAtTileOffsetFunc($t,ye.center.lat,ye.worldSize,Et.getProjection()),Nl=Jf(zt,It.tileID.canonical,Je,Le,ye,Et.getProjection(),Gt);cx(Et,zt,f,!0,Nl,Vi,Je,se,Rc,$t,Ci)}return{program:no,buffers:Et.text,uniformValues:Wd,atlasTexture:wh,atlasTextureIcon:Mo,atlasInterpolation:tl,atlasInterpolationIcon:Ho,isSDF:!0,hasHalo:Ll,depthMode:_s,tile:It,renderWithShadows:yi,labelPlaneMatrixInv:Th}},kn=Et.icon.segments.get().length,yn=Et.text.segments.get().length,Fr=kn&&!T.onlyText?An():null,Sn=yn&&!T.onlyIcons?Bn():null,wi=c.paint.get("icon-opacity").constantOr(1),hi=c.paint.get("text-opacity").constantOr(1);if(et&&Et.canOverlap){ht=!0;const Pn=wi&&!T.onlyText?Et.icon.segments.get():[],fn=hi&&!T.onlyIcons?Et.text.segments.get():[];for(const Br of Pn)gt.push({segments:new i.bg([Br]),sortKey:Br.sortKey,state:Fr});for(const Br of fn)gt.push({segments:new i.bg([Br]),sortKey:Br.sortKey,state:Sn})}else T.onlyText||gt.push({segments:wi?Et.icon.segments:new i.bg([]),sortKey:0,state:Fr}),T.onlyIcons||gt.push({segments:hi?Et.text.segments:new i.bg([]),sortKey:0,state:Sn})}ht&&gt.sort(($t,It)=>$t.sortKey-It.sortKey);for(const $t of gt){const It=$t.state;if(It)if(f.terrain?f.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:It.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,It.program),Se.activeTexture.set(xe.TEXTURE0),It.atlasTexture&&It.atlasTexture.bind(It.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),It.atlasTextureIcon&&(Se.activeTexture.set(xe.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),It.renderWithShadows&&f.shadowRenderer.setupShadows(It.tile.tileID.toUnwrapped(),It.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,It.program),It.hasHalo){const Et=It.uniformValues;Et.u_is_halo=1,Hy(It.buffers,$t.segments,c,f,It.program,It.depthMode,v,w,Et,2),Et.u_is_halo=0}else{if(It.isSDF){const Et=It.uniformValues;It.hasHalo&&(Et.u_is_halo=1,Hy(It.buffers,$t.segments,c,f,It.program,It.depthMode,v,w,Et,1)),Et.u_is_halo=0}Hy(It.buffers,$t.segments,c,f,It.program,It.depthMode,v,w,It.uniformValues,1)}}}function Hy(f,o,c,p,v,w,T,P,O,k){const N=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];v.draw(p,p.context.gl.TRIANGLES,w,T,P,br.disabled,O,c.id,f.layoutVertexBuffer,f.indexBuffer,o,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),N,k)}function Bx(f,o){const c=1<<f.canonical.z,p=(o.x*c-f.canonical.x-f.wrap*c)*i.al,v=(o.y*c-f.canonical.y)*i.al,w=i.e8(o.z,o.y);return i.d5(p,v,w)}function Op(f,o,c,p,v){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const w=f.context.gl,T=new ir(f.context.gl.LEQUAL,ir.ReadWrite,f.depthRangeFor3D),P=new ir(f.context.gl.GREATER,ir.ReadWrite,f.depthRangeFor3D),O=function(q){let ee=.01;return q.isOrthographic&&(ee=i.ak(1e-4,ee,i.d0(q.pitch>=Ca?1:q.pitch/Ca))),2*ee}(f.transform),k=f.transform.getFreeCameraOptions().position,N="elevatedStructuresDepthReconstruct",W=f.getOrCreateProgram(N,{defines:["DEPTH_RECONSTRUCTION"]}),H=f.getOrCreateProgram(N);for(const q of p){const ee=o.getTile(q),Y=ee.getBucket(c);if(!Y)continue;const se=Y.elevatedStructures;if(!se)continue;const oe=Y.elevationBufferData.heightRange,he=Bx(q.toUnwrapped(),k),me=f.translatePosMatrix(q.projMatrix,ee,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let de,Ae,be,Se;if(v==="initialize"){if(!oe||oe.min>=1||se.depthSegments.segments[0].primitiveLength===0)continue;de=hu(me,he,O,1,0),Ae=T,be=se.depthSegments,Se=W}else if(v==="reset"){if(!oe||oe.min>=0||se.maskSegments.segments[0].primitiveLength===0)continue;de=hu(me,he,0,0,1),Ae=P,be=se.maskSegments,Se=W}else if(v==="geometry"){if(se.depthSegments.segments[0].primitiveLength===0)continue;de=hu(me,he,O,1,0),Ae=T,be=se.depthSegments,Se=H}Se.draw(f,w.TRIANGLES,Ae,Tr.disabled,Lr.disabled,br.disabled,de,c.id,se.vertexBuffer,se.indexBuffer,be,c.paint,f.transform.zoom)}}function Rp(f,o,c,p){const{painter:v,sourceCache:w,layer:T,coords:P,colorMode:O,elevationType:k,terrainEnabled:N,pass:W}=f,H=v.context.gl,q=T.paint.get("fill-pattern"),ee=T.paint.get("fill-pattern-cross-fade"),Y=q.constantOr(null);let se=k;k!=="road"||o&&!N||(se="none");const oe=se==="road",he=f.painter.shadowRenderer,me=oe&&!!he&&he.enabled,de=new ir(v.context.gl.LEQUAL,ir.ReadOnly,v.depthRangeFor3D);let Ae=[0,0,0];if(me){const ye=v.style.directionalLight,Ce=v.style.ambientLight;ye&&Ce&&(Ae=El(v.style,ye,Ce))}const be=q&&q.constantOr(1),Se=v.terrain&&v.terrain.renderingToTexture,xe=(ye,Ce)=>{let Le,ke,Je,et,ht;Ce?(Le=be&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Je=H.LINES):(Le=be?"fillPattern":"fill",Je=H.TRIANGLES);for(const St of P){const We=w.getTile(St);if(be&&!We.patternsLoaded())continue;const Re=We.getBucket(T);if(!Re)continue;const ot=o?Re.elevationBufferData:Re.bufferData;if(ot.isEmpty())continue;v.prepareDrawTile();const Ze=ot.programConfigurations.get(T.id),gt=v.isTileAffectedByFog(St),Rt=[],$t=[];oe&&(Rt.push("ELEVATED_ROADS"),$t.push(ot.elevatedLayoutVertexBuffer)),me&&Rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&c&&Rt.push("USE_MRT1"),be&&(v.context.activeTexture.set(H.TEXTURE0),We.imageAtlasTexture&&We.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ze.updatePaintBuffers());let It=!1;if(Y&&We.imageAtlas){const Gt=We.imageAtlas,dr=i.e3.from(Y),Or=dr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Qr=dr.getSecondary(),wn=Gt.patternPositions.get(Or),rr=Qr?Gt.patternPositions.get(Qr.scaleSelf(i.o.devicePixelRatio).toString()):null;It=!!wn&&!!rr,wn&&Ze.setConstantPatternPositions(wn,rr)}ee>0&&(It||Ze.getPatternTransitionVertexBuffer("fill-pattern"))&&Rt.push("FILL_PATTERN_TRANSITION");const Et=v.getOrCreateProgram(Le,{config:Ze,overrideFog:gt,defines:Rt}),tr=v.translatePosMatrix(St.projMatrix,We,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor"));me&&he.setupShadows(We.tileID.toUnwrapped(),Et,"vector-tile");const Jt=T.paint.get("fill-emissive-strength");if(Ce){et=ot.lineIndexBuffer,ht=ot.lineSegments;const Gt=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];ke=Le==="fillOutlinePattern"&&be?Vy(tr,Jt,v,We,Gt,Ae,ee):Mx(tr,Jt,Gt,Ae)}else et=ot.indexBuffer,ht=ot.triangleSegments,ke=be?By(tr,Jt,v,We,Ae,ee):Fy(tr,Jt,Ae);v.uploadCommonUniforms(v.context,Et,St.toUnwrapped());let zt=ye;(k==="road"&&!N||k==="offset")&&(zt=de),Et.draw(v,Je,zt,p||v.stencilModeForClipping(St),O,br.disabled,ke,T.id,ot.layoutVertexBuffer,et,ht,T.paint,v.transform.zoom,Ze,$t)}};v.renderPass===W&&xe(v.depthModeForSublayer(1,v.renderPass==="opaque"?ir.ReadWrite:ir.ReadOnly),!1),se==="none"&&v.renderPass==="translucent"&&T.paint.get("fill-antialias")&&xe(v.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,ir.ReadOnly),!0)}function Dp(f,o,c,p,v,w,T,P){c.resetLayerRenderingStats(f);const O=f.context,k=O.gl,N=f.transform,W=c.paint.get("fill-extrusion-pattern"),H=c.paint.get("fill-extrusion-pattern-cross-fade"),q=W.constantOr(null),ee=W.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),se=f.style.enable3dLights(),oe=c.paint.get(se&&!ee?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),he=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],me=c.layout.get("fill-extrusion-edge-radius"),de=me>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ae=de?0:me,be=N.projection.name==="globe"?i.eb():0,Se=N.projection.name==="globe",xe=Se?i.aj(N.zoom):0,ye=[i.aF(N.center.lng),i.aJ(N.center.lat)],Ce=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Le=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:c.lut).toArray01().slice(0,3),ke=c.paint.get("fill-extrusion-flood-light-intensity"),Je=c.paint.get("fill-extrusion-vertical-scale"),et=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=c.paint.get("fill-extrusion-height-alignment"),St=c.paint.get("fill-extrusion-base-alignment"),We=_c(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let ot;Se&&Re.push("PROJECTION_GLOBE_VIEW"),he[0]>0&&Re.push("FAUX_AO"),de&&Re.push("ZERO_ROOF_RADIUS"),P&&Re.push("HAS_CENTROID"),ke>0&&Re.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),et&&Re.push("RENDER_WALL_MODE");const Ze=f.renderPass==="shadow",gt=f.shadowRenderer,Rt=Ze&&!!gt,$t=Ze?br.disabled:br.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let It=[0,0,0];if(gt){const Jt=f.style.directionalLight,zt=f.style.ambientLight;Jt&&zt&&(It=El(f.style,Jt,zt)),Ze||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&Re.push("NORMAL_OFFSET")),ot=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const Et=Rt?"fillExtrusionDepth":ee?"fillExtrusionPattern":"fillExtrusion",tr=c.getLayerRenderingStats();for(const Jt of p){const zt=o.getTile(Jt),Gt=zt.getBucket(c);if(!Gt||Gt.projection.name!==N.projection.name)continue;let dr=!1;gt&&(dr=gt.getMaxCascadeForTile(Jt.toUnwrapped())===0);const Or=f.isTileAffectedByFog(Jt),Qr=Gt.programConfigurations.get(c.id);let wn=!1;if(q&&zt.imageAtlas){const yn=zt.imageAtlas,Fr=i.e3.from(q),Sn=Fr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),wi=Fr.getSecondary(),hi=yn.patternPositions.get(Sn),Pn=wi?yn.patternPositions.get(wi.scaleSelf(i.o.devicePixelRatio).toString()):null;wn=!!hi&&!!Pn,hi&&Qr.setConstantPatternPositions(hi,Pn)}H>0&&(wn||Qr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const rr=f.getOrCreateProgram(Et,{config:Qr,defines:dr?ot:Re,overrideFog:Or});if(f.terrain&&f.terrain.setupElevationDraw(zt,rr,{useMeterToDem:!0}),!Gt.centroidVertexBuffer){const yn=rr.getAttributeLocation(k,"a_centroid_pos");yn!==-1&&k.vertexAttrib2f(yn,0,0)}!Ze&&gt&&gt.setupShadows(zt.tileID.toUnwrapped(),rr,"vector-tile"),ee&&(f.context.activeTexture.set(k.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Qr.updatePaintBuffers());const vn=c.paint.get("fill-extrusion-vertical-gradient"),Mr=1/Gt.tileToMeter;let An;if(Ze&&gt){if(Il(zt.tileID,Gt.maxHeight,f))continue;const yn=gt.calculateShadowPassMatrixFromTile(zt.tileID.toUnwrapped());An=zy(yn,Ae,Mr,Je,ht,St)}else{const yn=f.translatePosMatrix(Jt.expandedProjMatrix,zt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Fr=N.projection.createInversionMatrix(N,Jt.canonical);An=ee?Ix(yn,f,vn,Y,he,Ae,Mr,Jt,zt,be,ht,St,xe,ye,Fr,Le,Je,H):Ep(yn,f,vn,Y,he,Ae,Mr,Jt,be,ht,St,xe,ye,Fr,Le,Je,ke,It)}f.uploadCommonUniforms(O,rr,Jt.toUnwrapped(),null,We);let Bn=Gt.segments;if(N.projection.name==="mercator"&&!Ze&&(Bn=Gt.getVisibleSegments(zt.tileID,f.terrain,f.transform.getFrustum(0)),!Bn.get().length))continue;if(tr)if(Ze)for(const yn of Bn.get())tr.numRenderedVerticesInShadowPass+=yn.primitiveLength;else for(const yn of Bn.get())tr.numRenderedVerticesInTransparentPass+=yn.primitiveLength;const kn=[];(f.terrain||P)&&kn.push(Gt.centroidVertexBuffer),Se&&kn.push(Gt.layoutVertexExtBuffer),et&&kn.push(Gt.wallVertexBuffer),rr.draw(f,O.gl.TRIANGLES,v,w,T,$t,An,c.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Bn,c.paint,f.transform.zoom,Qr,kn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Wy{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Cl(f,o,c,p,v,w,T,P,O,k,N,W,H,q,ee,Y,se,oe,he,me){const de=o.context,Ae=de.gl,be=o.transform,Se=o.transform.zoom,xe=[],ye=f.translate,Ce=f.translateAnchor,Le=f.edgeRadius,ke=_c(o,f.cutoffFadeRange);N==="clear"?(xe.push("CLEAR_SUBPASS"),me&&(xe.push("CLEAR_FROM_TEXTURE"),de.activeTexture.set(Ae.TEXTURE0),me.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE))):N==="sdf"?xe.push("SDF_SUBPASS"):N==="emissive"&&(xe.push("USE_MRT1"),de.activeTexture.set(Ae.TEXTURE0),me.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)),oe&&xe.push("HAS_CENTROID"),ke.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const Je=(et,ht,St,We,Re)=>{let ot=xe;ht.groundRadiusBuffer!=null&&(ot=xe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ze=ht.programConfigurations.get(p.id),gt=o.isTileAffectedByFog(et),Rt=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ze,defines:ot,overrideFog:gt}),$t=hh(o,We,W,k,Re,[H,q*Re],ee,Y,se,Se>=17?0:Le*Re,me?me.size[0]:0),It=[];oe&&It.push(ht.hiddenByLandmarkVertexBuffer),ht.groundRadiusBuffer!=null&&It.push(ht.groundRadiusBuffer),o.uploadCommonUniforms(de,Rt,et.toUnwrapped(),null,ke),Rt.draw(o,de.gl.TRIANGLES,w,T,P,O,$t,p.id,ht.vertexBuffer,ht.indexBuffer,St,p.paint,Se,Ze,It)};for(const et of v){const ht=c.getTile(et),St=ht.getBucket(p);if(!St||St.projection.name!==be.projection.name||!St.groundEffect||St.groundEffect&&!St.groundEffect.hasData())continue;const We=St.groundEffect,Re=1/St.tileToMeter;{const ot=o.translatePosMatrix(et.projMatrix,ht,ye,Ce),Ze=We.getDefaultSegment();Je(et,We,Ze,ot,Re)}if(he)for(let ot=0;ot<4;ot++){const Ze=i.e9[ot](et),gt=c.getTile(Ze);if(!gt)continue;const Rt=gt.getBucket(p);if(!Rt||Rt.projection.name!==be.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const $t=Rt.groundEffect;let It,Et;ot===0?(It=[-i.al,0,0],Et=1):ot===1?(It=[i.al,0,0],Et=0):ot===2?(It=[0,-i.al,0],Et=3):(It=[0,i.al,0],Et=2);const tr=$t.regionSegments[Et];if(!tr)continue;const Jt=new Float32Array(16);i.br(Jt,et.projMatrix,It),Je(et,$t,tr,o.translatePosMatrix(Jt,ht,ye,Ce),Re)}}}function u2(f,o,c,p,v,w,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const P=w?w.findDEMTileFor(c):null;if(!(P&&P.dem||T))return;w&&P&&P.dem&&p.selfDEMTileTimestamp!==P.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=P.dem._timestamp);const O=oe=>new i.P(Math.ceil((oe+i.ed)*i.ee),0),k=oe=>{const he=o.getSource().minzoom,me=Ae=>{const be=o.getTileByID(Ae);if(be&&be.hasData())return be.getBucket(v)},de=[0,-1,1];for(const Ae of de){if(oe.overscaledZ+Ae<he)continue;const be=me(oe.calculateScaledKey(oe.overscaledZ+Ae));if(be)return be}},N=[0,0,0],W=(oe,he)=>(N[0]=Math.min(oe.min.y,he.min.y),N[1]=Math.max(oe.max.y,he.max.y),N[2]=i.al-he.min.x>oe.max.x?he.min.x-i.al:oe.max.x,N),H=(oe,he)=>(N[0]=Math.min(oe.min.x,he.min.x),N[1]=Math.max(oe.max.x,he.max.x),N[2]=i.al-he.min.y>oe.max.y?he.min.y-i.al:oe.max.y,N),q=[(oe,he)=>W(oe,he),(oe,he)=>W(he,oe),(oe,he)=>H(oe,he),(oe,he)=>H(he,oe)],ee=(oe,he,me,de,Ae,be,Se)=>{if(!w)return 0;const xe=[[be?me:oe,be?oe:me,0],[be?me:he,be?he:me,0]],ye=Se<0?i.al+Se:Se,Ce=[be?ye:(oe+he)/2,be?(oe+he)/2:ye,0];return me===0&&Se<0||me!==0&&Se>0?w.getForTilePoints(Ae,[Ce],!0,de):xe.push(Ce),w.getForTilePoints(c,xe,!0,P),Math.max(xe[0][2],xe[1][2],Ce[2])/w.exaggeration()};for(let oe=0;oe<4;oe++){const he=p.borderFeatureIndices[oe];if(he.length===0)continue;const me=i.e9[oe](c),de=k(me);if(!(de&&de instanceof i.ea))continue;const Ae=w?w.findDEMTileFor(me):null;if(!(Ae&&Ae.dem||T)||(w&&Ae&&Ae.dem&&p.borderDEMTileTimestamp[oe]!==Ae.dem._timestamp&&(p.borderDoneWithNeighborZ[oe]=-1,p.borderDEMTileTimestamp[oe]=Ae.dem._timestamp),p.borderDoneWithNeighborZ[oe]===de.canonical.z))continue;de.centroidVertexArray.length===0&&de.createCentroidsBuffer();const be=(oe<2?1:5)-oe,Se=de.borderDoneWithNeighborZ[be]!==p.canonical.z,xe=de.borderFeatureIndices[be];let ye=0;if(p.canonical.z!==de.canonical.z){for(const Ce of he)p.showCentroid(p.featuresOnBorder[Ce]);if(Se)for(const Ce of xe)de.showCentroid(de.featuresOnBorder[Ce]);p.borderDoneWithNeighborZ[oe]=de.canonical.z,de.borderDoneWithNeighborZ[be]=p.canonical.z}for(const Ce of he){const Le=p.featuresOnBorder[Ce],ke=p.centroidData[Le.centroidDataIndex],Je=Le.borders[oe];let et;for(;ye<xe.length;){et=de.featuresOnBorder[xe[ye]];const ht=et.borders[be];if(ht[1]>Je[0]+3||ht[0]>Je[0]-3)break;de.showCentroid(et),ye++}if(et&&ye<xe.length){const ht=ye;let St=0;for(;!(et.borders[be][0]>Je[1]-3)&&(St++,++ye!==xe.length);)et=de.featuresOnBorder[xe[ye]];et=de.featuresOnBorder[xe[ht]];let We=!1;if(St>=1){const Ze=et.borders[be];Math.abs(Je[0]-Ze[0])<3&&Math.abs(Je[1]-Ze[1])<3&&(St=1,We=!0,ye=ht+1)}else if(St===0){p.showCentroid(Le);continue}const Re=de.centroidData[et.centroidDataIndex];T&&We&&(((Y=ke).flags|(se=Re).flags)&i.ec?(Y.flags|=i.ec,se.flags|=i.ec):(Y.flags&=~i.ec,se.flags&=~i.ec));const ot=Le.intersectsCount()>1||et.intersectsCount()>1;if(St>1)ye=ht,ke.centroidXY=Re.centroidXY=new i.P(0,0);else if(Ae&&Ae.dem&&!ot){const Ze=q[oe](ke,Re),gt=oe%2?i.al-1:0,Rt=ee(Ze[0],Math.min(i.al-1,Ze[1]),gt,Ae,me,oe<2,Ze[2]);ke.centroidXY=Re.centroidXY=O(Rt)}else ot?ke.centroidXY=Re.centroidXY=new i.P(0,0):(ke.centroidXY=p.encodeBorderCentroid(Le),Re.centroidXY=de.encodeBorderCentroid(et));p.writeCentroidToBuffer(ke),de.writeCentroidToBuffer(Re)}else p.showCentroid(Le)}p.borderDoneWithNeighborZ[oe]=de.canonical.z,de.borderDoneWithNeighborZ[be]=p.canonical.z}var Y,se;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Ns=[1,0,0],qy=[0,1,0],gs=[0,0,1];function Il(f,o,c){const p=c.transform,v=c.shadowRenderer;if(!v)return!0;const w=f.toUnwrapped(),T=p.tileSize*v._cascades[c.currentShadowCascade].scale;let P=o;if(p.elevation){const Y=p.elevation.getMinMaxForTile(f);Y&&(P+=Y.max)}const O=[...v.shadowDirection];O[2]=-O[2];const k=v.computeSimplifiedTileShadowVolume(w,P,T,O);if(!k)return!1;const N=[Ns,qy,gs,O,[O[0],0,O[2]],[0,O[1],O[2]]],W=p.projection.name==="globe",H=p.scaleZoom(T),q=i.cB.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,H,!W),ee=v.getCurrentCascadeFrustum();return q.intersectsPrecise(k.vertices,k.planes,N)===0||ee.intersectsPrecise(k.vertices,k.planes,N)===0}function kd(f){const{painter:o,source:c,layer:p,coords:v}=f;let w=f.defines;const T=o.context,P=o.renderPass==="shadow",O=o.renderPass==="light-beam",k=o.shadowRenderer,N=i.ef(o.transform.center.lat,o.transform.zoom),W=_c(o,p.paint.get("building-cutoff-fade-range"));W.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(w=w.concat("FLOOD_LIGHT"));for(const H of v){const q=c.getTile(H),ee=q.getBucket(p);if(!ee)continue;k&&k.getMaxCascadeForTile(H.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const Y=ee.programConfigurations.get(p.id);let se,oe,he,me=o.translatePosMatrix(H.expandedProjMatrix,q,[0,0],"map");if(me=i.cS(i.bC(),me,[1,1,f.verticalScale]),P&&k){if(Il(q.tileID,ee.maxHeight*N,o))continue;let Ae=k.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());Ae=i.cS(i.bC(),Ae,[1,1,f.verticalScale]),he=Ec(Ae),se=oe=o.getOrCreateProgram("buildingDepth",{config:Y,defines:w,overrideFog:!1})}else if(O)se=oe=o.getOrCreateProgram("buildingBloom",{config:Y,defines:w,overrideFog:!1}),he=Ox(me);else{const Ae=o.transform.calculatePosMatrix(H.toUnwrapped(),o.transform.worldSize);i.cS(Ae,Ae,[1,1,f.verticalScale]);const be=i.bC();i.cS(be,Ae,[1,-1,1/N]),i.bl(be,be),i.eg(be,be);const Se=o.transform.getFreeCameraOptions().position,xe=1<<H.canonical.z;if(he=Ap(me,be,f.opacity,f.facadeAOIntensity,[((Se.x-H.wrap)*xe-H.canonical.x)*i.al,(Se.y*xe-H.canonical.y)*i.al,Se.z*xe*i.al],ee.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),oe=o.getOrCreateProgram("building",{config:Y,defines:w,overrideFog:!1}),f.depthOnly===!0)se=oe;else{const ye=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);se=o.getOrCreateProgram("building",{config:Y,defines:ye,overrideFog:!1})}k&&(k.setupShadowsFromMatrix(Ae,oe,!0),se!==oe&&k.setupShadowsFromMatrix(Ae,se,!0))}const de=(Ae,be)=>{if(O){const Se=Ae.entranceBloom;be.draw(o,T.gl.TRIANGLES,f.depthMode,Tr.disabled,f.blendMode,br.disabled,he,p.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segmentsBucket,p.paint,o.transform.zoom,Y,[Se.layoutAttenuationBuffer,Se.layoutColorBuffer])}else{const Se=Ae.segmentsBucket;let xe=[Ae.layoutNormalBuffer,Ae.layoutCentroidBuffer,Ae.layoutColorBuffer,Ae.layoutFloodLightDataBuffer];Ae.layoutFacadePaintBuffer&&(xe=xe.concat([Ae.layoutFacadeDataBuffer,Ae.layoutFacadeVerticalRangeBuffer,Ae.layoutFacadePaintBuffer])),be.draw(o,T.gl.TRIANGLES,f.depthMode,Tr.disabled,f.blendMode,P?br.disabled:br.backCW,he,p.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Se,p.paint,o.transform.zoom,Y,xe)}};o.uploadCommonUniforms(T,oe,H.toUnwrapped(),null,W),ee.buildingWithoutFacade&&de(ee.buildingWithoutFacade,oe),ee.buildingWithFacade&&(se!==oe&&o.uploadCommonUniforms(T,se,H.toUnwrapped(),null,W),de(ee.buildingWithFacade,se))}}function kp(f,o,c,p,v,w,T,P,O,k,N,W,H){const q=f.context.gl,ee=f.depthModeForSublayer(1,ir.ReadOnly,q.LEQUAL,!0),Y=.1*(1-(se=N))+3*se;var se;const oe=f._showOverdrawInspector,he=W,me=new Wy;oe||Cl(me,f,o,c,p,ee,new Tr({func:q.ALWAYS,mask:255},255,255,q.KEEP,q.KEEP,q.REPLACE),new Lr([q.ONE,q.ONE,q.ONE,q.ONE],i.ao.transparent,[!1,!1,!1,!0],q.MIN),br.disabled,v,"sdf",w,T,P,O,k,Y,he,!1);{const de=oe?Tr.disabled:new Tr({func:q.EQUAL,mask:255},255,255,q.KEEP,q.DECR,q.DECR),Ae=oe?f.colorModeForRenderPass():new Lr([q.ONE_MINUS_DST_ALPHA,q.DST_ALPHA,q.ONE,q.ONE],i.ao.transparent,[!0,!0,!0,!0]);Cl(me,f,o,c,p,ee,de,Ae,br.disabled,v,"color",w,T,P,O,k,Y,he,!1)}}function jp(f){return[f[0]*i.eh,f[1]*i.eh,f[2]*i.eh,0]}function jd(f,o,c,p,v,w,T,P,O){const k=p.getSource(),N=c.globeSharedBuffers;if(!N)return;let W,H,q;if(o&&(W=p.getTile(o)),k instanceof i.aU?(H=k.texture,q=i.dK(0,0,c.transform)):W&&o&&(H=W.texture,q=i.dK(o.canonical.z,o.canonical.x,c.transform)),!H||!q)return;f||(q=i.cS(i.bC(),q,[1,-1,1]));const ee=c.context,Y=ee.gl,se=v.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,oe=c.colorModeForDrapableLayerRenderPass(w),he=T.defines;he.push("GLOBE_POLES");const me=new ir(Y.LEQUAL,ir.ReadWrite,c.depthRangeFor3D),de=Float32Array.from(c.transform.expandedFarZProjMatrix),Ae=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ee.activeTexture.set(Y.TEXTURE0),H.bind(se,Y.CLAMP_TO_EDGE),ee.activeTexture.set(Y.TEXTURE1),H.bind(se,Y.CLAMP_TO_EDGE),"useMipmap"in H&&ee.extTextureFilterAnisotropic&&c.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const[be,Se,xe,ye]=o?N.getPoleBuffers(o.canonical.z,!1):N.getPoleBuffers(0,!0),Ce=v.paint.get("raster-elevation");let Le;f?(Le=be,c.renderDefaultNorthPole=Ce!==0):(Le=Se,c.renderDefaultSouthPole=Ce!==0);const ke=jp(T.mix),Je=((ht,St,We,Re,ot,Ze,gt,Rt,$t,It,Et,tr,Jt)=>kx(ht,St,We,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],Rt,2,It,Et,tr,1,0,Jt))(de,Ae,q,i.aj(c.transform.zoom),0,v,0,Ce,0,ke,T.offset,T.range,w),et=c.getOrCreateProgram("raster",{defines:he});c.uploadCommonUniforms(ee,et,null),et.draw(c,Y.TRIANGLES,me,O,oe,P,Je,v.id,Le,xe,ye)}function Vx(f){const o=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-o,v=.2*f.height,w=o+v;return[o,c,(w-v-o)/p,(w-o)/p]}function Ml(f,o,c,p){if(f)return o instanceof Qo&&f instanceof Zf?o.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:jp(p.mix),offset:p.offset,buffer:0,tileSize:1}}var ri=i.ei([{name:"a_index",type:"Int16",components:1}]);class Lp{constructor(o,c,p,v){const w={width:p[0],height:p[1],data:null},T=o.gl;this.targetColorTexture=new i.T(o,w,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(o,w,T.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(o,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,v=c.width*c.height;this.particleTexture0=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const w=new i.ej;w.reserve(v);for(let T=0;T<v;T++)w.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(w,ri.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Zy(f,o,c){if(!f)return null;const p=o.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:v,mix:w,offset:T,tileSize:P,buffer:O,format:k}=p;if(!v||!k)return null;let N=!1;return k==="uint32"&&(N=!0,w[3]=0,w=Pp(i.ek,w,[0,c.paint.get("raster-particle-max-speed")]),T=Cp(i.ek,T,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[O/(P+2*O),P/(P+2*O)],tileSize:P,scalarData:N,scale:w,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function $x(f){const o=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-o,v=.2*f.height,w=o+v;return[o,c,(w-v-o)/p,(w-o)/p]}const Ux=new i.ao(1,0,0,1),Gx=new i.ao(0,1,0,1),Hx=new i.ao(0,0,1,1),pu=new i.ao(1,0,1,1),mu=new i.ao(0,1,1,1);function Ct(f,o,c,p,v,w){for(let T=0;T<c.length;T++)if(v){const k=new i.ao(p.r*.8,p.g*.8,p.b*.8,1);Dt(f,o,c[T],p,-1,-1,w),Dt(f,o,c[T],p,-1,1,w),Dt(f,o,c[T],p,1,1,w),Dt(f,o,c[T],p,1,-1,w),Dt(f,o,c[T],k,0,0,w)}else Dt(f,o,c[T],p,0,0,w)}function Dt(f,o,c,p,v,w,T){const P=f.context,O=f.transform,k=P.gl,N=O.projection.name==="globe",W=N?["PROJECTION_GLOBE_VIEW"]:[];let H=i.bz(c.projMatrix);if(N&&i.aj(O.zoom)>0){const ke=i.bj(c.canonical,O),Je=i.el(ke);H=i.aB(new Float32Array(16),O.globeMatrix,Je),i.aB(H,O.projMatrix,H)}const q=i.bC();q[12]+=2*v/(i.o.devicePixelRatio*O.width),q[13]+=2*w/(i.o.devicePixelRatio*O.height),i.aB(H,q,H);const ee=f.getOrCreateProgram("debug",{defines:W}),Y=o.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(Y,ee);const se=ir.disabled,oe=Tr.disabled,he=f.colorModeForRenderPass(),me="$debug";P.activeTexture.set(k.TEXTURE0),f.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),N?Y._makeGlobeTileDebugBuffers(f.context,O):Y._makeDebugTileBoundsBuffers(f.context,O.projection);const de=Y._tileDebugBuffer||f.debugBuffer,Ae=Y._tileDebugIndexBuffer||f.debugIndexBuffer,be=Y._tileDebugSegments||f.debugSegments;if(ee.draw(f,k.LINE_STRIP,se,oe,he,br.disabled,Md(H,p.toPremultipliedRenderColor(null)),me,de,Ae,be,null,null,null,[Y._globeTileDebugBorderBuffer]),T){const ke=Y.latestRawTileData,Je=Math.floor((ke&&ke.byteLength||0)/1024);let et=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(et+=` => ${c.overscaledZ}`),et+=` ${Y.state}`,et+=` ${Je}kb`,function(ht,St){ht.initDebugOverlayCanvas();const We=ht.debugOverlayCanvas,Re=ht.context.gl,ot=ht.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,We.width,We.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(St,5,5),ot.strokeText(St,5,5),ht.debugOverlayTexture.update(We),ht.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(f,et)}const Se=o.getTile(c).tileSize,xe=512/Math.min(Se,512)*(c.overscaledZ/O.zoom)*.5,ye=Y._tileDebugTextBuffer||f.debugBuffer,Ce=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Le=Y._tileDebugTextSegments||f.debugSegments;ee.draw(f,k.TRIANGLES,se,oe,Lr.alphaBlended,br.disabled,Md(H,i.ao.transparent.toPremultipliedRenderColor(null),xe),me,ye,Ce,Le,null,null,null,[Y._globeTileDebugTextBuffer])}function gu(f,o,c,p){Ve(f,0,o+c/2,f.transform.width,c,p)}function Pi(f,o,c,p){Ve(f,o-c/2,0,c,f.transform.height,p)}function Ve(f,o,c,p,v,w){const T=f.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(o*i.o.devicePixelRatio,c*i.o.devicePixelRatio,p*i.o.devicePixelRatio,v*i.o.devicePixelRatio),T.clear({color:w}),P.disable(P.SCISSOR_TEST)}const Wx=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Np}=Wx;function Ya(f,o,c,p){f.emplaceBack(o,c,p)}class zp{constructor(o){this.vertexArray=new i.em,this.indices=new i.b0,Ya(this.vertexArray,-1,-1,1),Ya(this.vertexArray,1,-1,1),Ya(this.vertexArray,-1,1,1),Ya(this.vertexArray,1,1,1),Ya(this.vertexArray,-1,-1,-1),Ya(this.vertexArray,1,-1,-1),Ya(this.vertexArray,-1,1,-1),Ya(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Np),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function yu(f,o,c,p,v,w){const T=f.context.gl,P=o.paint.get("sky-atmosphere-color"),O=o.paint.get("sky-atmosphere-halo-color"),k=o.paint.get("sky-atmosphere-sun-intensity"),N=((W,H,q,ee,Y)=>({u_matrix_3f:W,u_sun_direction:H,u_sun_intensity:q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(i.eo(i.dO(),p),v,k,P.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),c.draw(f,T.TRIANGLES,ir.disabled,Tr.disabled,Lr.unblended,br.frontCW,N,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const qx=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ph{constructor(o){const c=new i.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new i.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,qx.members),this.indexBuffer=o.createIndexBuffer(p),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const h2=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class d2{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zx{constructor(o){this.colorModeAlphaBlendedWriteRGB=new Lr([1,qa,1,qa],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Lr([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new d2,this.updateNeeded=!0}update(o){const c=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ph(c);const p=this.params.sizeRange,v=this.params.intensityRange,w=function(N){const W=i.eq(30),H=[];for(let q=0;q<N;++q){const ee=2*Math.PI*W(),Y=Math.acos(1-2*W())-.5*Math.PI;H.push(i.d5(Math.cos(Y)*Math.cos(ee),Math.cos(Y)*Math.sin(ee),Math.sin(Y)))}return H}(this.params.starsCount),T=i.eq(300),P=new i.er,O=new i.b0;let k=0;for(let N=0;N<w.length;++N){const W=i.c5([],w[N],200),H=Math.max(0,1+.01*p*(1*T()-.5)),q=Math.max(0,1+.01*v*(1*T()-.5));P.emplaceBack(W[0],W[1],W[2],-1,-1,H,q),P.emplaceBack(W[0],W[1],W[2],1,-1,H,q),P.emplaceBack(W[0],W[1],W[2],1,1,H,q),P.emplaceBack(W[0],W[1],W[2],-1,1,H,q),O.emplaceBack(k+0,k+1,k+2),O.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=c.createVertexBuffer(P,h2.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=i.bg.simpleSegment(0,0,P.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,c){const p=o.context,v=p.gl,w=o.transform,T=new ir(v.LEQUAL,ir.ReadOnly,[0,1]),P=i.aj(w.zoom),O=o.style.getLut(c.scope),k=c.properties.get("color-use-theme")==="none",N=c.properties.get("color").toNonPremultipliedRenderColor(k?null:O),W=c.properties.get("high-color-use-theme")==="none",H=c.properties.get("high-color").toNonPremultipliedRenderColor(W?null:O),q=c.properties.get("space-color-use-theme")==="none",ee=c.properties.get("space-color").toNonPremultipliedRenderColor(q?null:O),Y=5e-4,se=i.es(c.properties.get("horizon-blend"),0,1,Y,.25),oe=i.dE(o,p,w)&&se===Y?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,he=o.frameCounter/1e3%1,me=i.ag(w.globeCenterInViewSpace),de=Math.sqrt(Math.pow(me,2)-Math.pow(oe,2)),Ae=Math.acos(de/me),be=Se=>{const xe=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Se&&xe.push("ALPHA_PASS");const ye=o.getOrCreateProgram("globeAtmosphere",{defines:xe}),Ce=((ke,Je,et,ht,St,We,Re,ot,Ze,gt,Rt,$t)=>({u_frustum_tl:ke,u_frustum_tr:Je,u_frustum_br:et,u_frustum_bl:ht,u_horizon:St,u_transition:We,u_fadeout_range:Re,u_atmosphere_fog_color:ot.toArray01(),u_high_color:Ze.toArray01(),u_space_color:gt.toArray01(),u_temporal_offset:Rt,u_horizon_angle:$t}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,P,se,N,H,ee,he,Ae);o.uploadCommonUniforms(p,ye);const Le=this.atmosphereBuffer;Le&&ye.draw(o,v.TRIANGLES,T,Tr.disabled,Se?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,br.backCW,Ce,Se?"atmosphere_glow_alpha":"atmosphere_glow",Le.vertexBuffer,Le.indexBuffer,Le.segments)};be(!1),be(!0)}drawStars(o,c){const p=i.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const v=o.context,w=v.gl,T=o.transform,P=o.getOrCreateProgram("stars"),O=i.c7([]);i.c9(O,O,-T._pitch),i.c8(O,O,-T.angle),i.c9(O,O,i.an(T._center.lat)),i.et(O,O,-i.an(T._center.lng));const k=i.cc(new Float32Array(16),O),N=i.aB([],T.starsProjMatrix,k),W=i.eo([],k),H=i.eu([],W),q=[0,1,0];i.dQ(q,q,H),i.c5(q,q,this.params.sizeMultiplier);const ee=[1,0,0];i.dQ(ee,ee,H),i.c5(ee,ee,this.params.sizeMultiplier);const Y=(se=q,oe=ee,he=p,{u_matrix:Float32Array.from(N),u_up:se,u_right:oe,u_intensity_multiplier:he});var se,oe,he;o.uploadCommonUniforms(v,P),this.starsVx&&this.starsIdx&&P.draw(o,w.TRIANGLES,ir.disabled,Tr.disabled,this.colorModeAlphaBlendedWriteRGB,br.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Fp{constructor(){this.visibleTiles=[]}updateBorders(o,c){const p=[],v=[],w=o._getRenderableCoordinates(!1,!0);for(const O of w){const k=o.getTile(O);if(!k.hasData())continue;const N=k.getBucket(c);N&&(N.isEmpty()||(p.push(O.key),v.push({bucket:N,tileID:O.canonical})))}let T=p.length!==this.visibleTiles.length;if(!T){p.sort();for(let O=0;O<p.length;O++)if(p[O]!==this.visibleTiles[O]){T=!0;break}}if(!T)return;const P=new Set;this.visibleTiles=p,v.sort((O,k)=>O.tileID.z-k.tileID.z||O.tileID.x-k.tileID.x||O.tileID.y-k.tileID.y);for(const O of v){const k=new Array,N=new Array,W=O.bucket;for(const H of W.featuresOnBorder)P.has(H.featureId)?N.push(H.footprintIndex):(P.add(H.featureId),k.push(H.footprintIndex));W.updateFootprintHiddenFlags(k,i.ev,!1),W.updateFootprintHiddenFlags(N,i.ev,!0)}}}function Bp(f,o){const c=[...f],p=o.cameraWorldSizeForFog/o.worldSize,v=i.bA([]);return i.cS(v,v,[p,p,1]),i.aB(c,v,c),i.aB(c,o.worldToFogMatrix,c),c}function Vp(f,o,c,p,v){const w=c.material,T=p.context,{baseColorTexture:P,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:N,emissionTexture:W}=w;function H(ee,Y,se){if(ee&&(f.push(Y),T.activeTexture.set(T.gl.TEXTURE0+se),ee.gfxTexture)){const{minFilter:oe,magFilter:he,wrapS:me,wrapT:de}=ee.sampler;ee.gfxTexture.bindExtraParam(oe,he,me,de)}}H(P,"HAS_TEXTURE_u_baseColorTexture",So.BaseColor),H(O,"HAS_TEXTURE_u_metallicRoughnessTexture",So.MetallicRoughness),H(k,"HAS_TEXTURE_u_normalTexture",So.Normal),H(N,"HAS_TEXTURE_u_occlusionTexture",So.Occlusion),H(W,"HAS_TEXTURE_u_emissionTexture",So.Emission),v&&(v.texture||(v.texture=new i.d$(p.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+So.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||f.push("DIFFUSE_SHADED");const q=p.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function $p(f,o,c,p,v,w){const T=f.modelOpacity,P=o.context,O=new ir(o.context.gl.LEQUAL,f.isLightMesh?ir.ReadOnly:ir.ReadWrite,o.depthRangeFor3D),k=o.transform,N=f.mesh,W=N.material,H=W.pbrMetallicRoughness,q=o.style.fog;let ee;ee=o.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.aB([],p.zScaleMatrix,f.nodeModelMatrix),i.aB(ee,p.negCameraPosMatrix,ee);const Y=i.bl([],ee);i.eg(Y,Y);const se=c.paint.get("model-color-use-theme").constantOr("default")==="none",oe=c.paint.get("model-emissive-strength").constantOr(0),he=du(new Float32Array(f.worldViewProjection),new Float32Array(ee),new Float32Array(Y),null,o,T,H.baseColorFactor,W.emissiveFactor,H.metallicFactor,H.roughnessFactor,W,oe,c,void 0,void 0,f.materialOverride,f.modelColor),me={defines:[]},de=[],Ae=o.shadowRenderer;Ae&&(Ae.useNormalOffset=!1),Vp(me.defines,de,N,o,se?null:c.lut);let be=null;if(q){const ye=Bp(f.nodeModelMatrix,o.transform);if(be=new Float32Array(ye),k.projection.name!=="globe"){const Ce=N.aabb.min,Le=N.aabb.max,[ke,Je]=q.getOpacityForBounds(ye,Ce[0],Ce[1],Le[0],Le[1]);me.overrideFog=ke>=dt||Je>=dt}}const Se=_c(o,c.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const xe=o.getOrCreateProgram("model",me);o.uploadCommonUniforms(P,xe,null,be,Se),o.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(f.nodeModelMatrix,xe),xe.draw(o,P.gl.TRIANGLES,O,v,w,N.material.doubleSided?br.disabled:br.backCCW,he,c.id,N.vertexBuffer,N.indexBuffer,N.segments,c.paint,o.transform.zoom,void 0,de)}function Ld(f,o){return f.style._importedAsBasemap?"basemap":o.scope}function _u(f,o,c,p,v,w,T,P,O,k){const N=f.transform,W=!!o.isGeometryBloom&&o.isGeometryBloom;if(W&&f.renderPass==="shadow")return;const H=N.projection.name==="globe"?i.eD(c,N):[...c];i.aB(H,H,o.globalMatrix);const q=i.aB([],p,H);if(o.meshes)for(const ee of o.meshes){const Y=P.get(ee.material.name);if(Y&&Y.opacity<=0)continue;if(ee.material.alphaMode!=="BLEND"){T.push({mesh:ee,depth:0,modelIndex:v,worldViewProjection:q,nodeModelMatrix:H,isLightMesh:W,materialOverride:Y,modelOpacity:O,modelColor:k});continue}const se=i.af([],ee.centroid,q);!N.isOrthographic&&se[2]<=0||w.push({mesh:ee,depth:se[2],modelIndex:v,worldViewProjection:q,nodeModelMatrix:H,isLightMesh:W,materialOverride:Y,modelOpacity:O,modelColor:k})}if(o.children)for(const ee of o.children)_u(f,ee,c,p,v,w,T,P,O,k)}function Ma(f,o,c,p){const v=c.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),P=v.calculateShadowPassMatrixFromMatrix(o),O=Uy(P);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,Tr.disabled,T,br.disabled,O,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function Xx(f,o,c,p,v,w){for(const T of v){const P=Object.assign({},p);P.part=T;const O={type:"Unknown",id:o,properties:P},k={orientation:f.paint.get("model-rotation").evaluate(O,c)};w.set(T,k)}}function Kx(f,o,c,p,v,w){for(const T of v){const P=Object.assign({},p);P.part=T;const O={type:"Unknown",id:o,properties:P},k={color:f.paint.get("model-color").evaluate(O,c),colorMix:f.paint.get("model-color-mix-intensity").evaluate(O,c),opacity:f.paint.get("model-opacity").evaluate(O,c),emissionStrength:f.paint.get("model-emissive-strength").evaluate(O,c)};w.set(T,k)}}function Yx(f,o,c,p,v){let w=!1;for(const P of p)P.modelOpacity!==1&&($p(P,f,o,v[P.modelIndex],Tr.disabled,Lr.disabled),w=!0);for(const P of p)$p(P,f,o,v[P.modelIndex],P.modelOpacity!==1?f.stencilModeFor3D():Tr.disabled,f.colorModeForRenderPass());w&&f.resetStencilClippingMasks();const T=Lr.additive;for(const P of c)$p(P,f,o,v[P.modelIndex],Tr.disabled,P.isLightMesh?T:f.colorModeForRenderPass())}function Jx(f,o,c){const p=o.updateZoomBasedPaintProperties(),v=function(w,T,P){let O,k,N,W=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&W>0){const H=w.terrain,q=H.findDEMTileFor(P);q&&q.dem?O=i.eF.create(H,P,q):W=0}if(W===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),W===T.validForExaggeration&&(W===0||O&&O._demTile&&O._demTile.tileID===T.validForDEMTile.id&&O._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const H in T.instancesPerModel){const q=T.instancesPerModel[H];for(let ee=0;ee<q.instancedDataArray.length;++ee){const Y=(O?W*O.getElevationAt(0|q.instancedDataArray.float32[16*ee],0|q.instancedDataArray.float32[16*ee+1],!0,!0):0)+q.instancesEvaluatedElevation[ee];q.instancedDataArray.float32[16*ee+6]=Y,k=k?Math.min(T.terrainElevationMin,Y):Y,N=N?Math.max(T.terrainElevationMax,Y):Y}}return T.terrainElevationMin=k||0,T.terrainElevationMax=N||0,T.validForExaggeration=W,T.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,o,c);(p||v)&&(o.uploaded=!1,o.upload(f.context))}const Ja={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function ys(f,o){const c=1<<f.canonical.z,p=o.getFreeCameraOptions().position,v=o.elevation,w=f.canonical.x/c,T=(f.canonical.x+1)/c,P=f.canonical.y/c,O=(f.canonical.y+1)/c;let k=o._centerAltitude;if(v){const q=v.getMinMaxForTile(f);q&&q.max>k&&(k=q.max)}const N=i.aA(p.x,w,T)-p.x,W=i.aA(p.y,P,O)-p.y,H=i.cf(k,o.center.lat)-p.z;return o._zoomFromMercatorZ(Math.sqrt(N*N+W*W+H*H))}function Qx(f,o,c,p,v,w,T){const P=f.context,O=f.renderPass==="shadow",k=f.shadowRenderer,N=O&&k?k.getShadowPassDepthMode():new ir(P.gl.LEQUAL,ir.ReadWrite,f.depthRangeFor3D),W=f.isTileAffectedByFog(w),H=f.transform.projection.name==="globe";if(c.meshes)for(const q of c.meshes){const ee=H?[]:["MODEL_POSITION_ON_GPU"],Y=[];let se,oe,he;const me=!H&&p.instancedDataArray.length>20;me&&ee.push("INSTANCED_ARRAYS");const de=_c(f,o.paint.get("model-cutoff-fade-range"));if(de.shouldRenderCutoff&&ee.push("RENDER_CUTOFF"),O&&k)se=f.getOrCreateProgram("modelDepth",{defines:ee}),oe=Uy(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(c.globalMatrix)),he=k.getShadowPassColorMode();else{Vp(ee,Y,q,f,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),se=f.getOrCreateProgram("model",{defines:ee,overrideFog:W});const be=q.material,Se=be.pbrMetallicRoughness,xe=o.paint.get("model-opacity").constantOr(1),ye=o.paint.get("model-emissive-strength").constantOr(0);oe=du(w.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,f,xe,Se.baseColorFactor,be.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,be,ye,o,v),k&&(T.shadowUniformsInitialized?se.setShadowUniformValues(P,k.getShadowUniformValues()):(k.setupShadows(w.toUnwrapped(),se,"model-tile"),T.shadowUniformsInitialized=!0)),he=de.shouldRenderCutoff||xe<1||be.alphaMode!=="OPAQUE"?Lr.alphaBlended:Lr.unblended}f.uploadCommonUniforms(P,se,w.toUnwrapped(),null,de);const Ae=q.material.doubleSided?br.disabled:br.backCCW;if(me)Y.push(p.instancedDataBuffer),se.draw(f,P.gl.TRIANGLES,N,Tr.disabled,he,Ae,oe,o.id,q.vertexBuffer,q.indexBuffer,q.segments,o.paint,f.transform.zoom,void 0,Y,p.instancedDataArray.length);else{const be=O?"u_instance":"u_normal_matrix";for(let Se=0;Se<p.instancedDataArray.length;++Se)oe[be]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Se,16),se.draw(f,P.gl.TRIANGLES,N,Tr.disabled,he,Ae,oe,o.id,q.vertexBuffer,q.indexBuffer,q.segments,o.paint,f.transform.zoom,void 0,Y)}}if(c.children)for(const q of c.children)Qx(f,o,q,p,v,w,T)}const Nd=[1,-1,1];function f2(f,o,c,p){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,T=o.aabb;let P=!0,O=f.maxHeight;if(O===0){let N=0;for(const W in f.instancesPerModel){const H=v.getModel(W,p);H?N=Math.max(N,Math.max(Math.max(H.aabb.max[0],H.aabb.max[1]),H.aabb.max[2])):P=!1}O=f.maxScale*N*1.41+f.maxVerticalOffset,P&&(f.maxHeight=O)}T.max[2]=O,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,i.af(T.min,T.min,o.tileMatrix),i.af(T.max,T.max,o.tileMatrix);const k=T.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=k===2),k===0}function ui(f,o){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],v=f.uniformValues.u_cutoff_params[2],w=f.uniformValues.u_cutoff_params[3];return p===c||w===v?1:i.aA(((o-c)/(p-c)-v)/(w-v),0,1)}function Xr(f,o,c,p){if(o.pitch<20)return 1;const v=o.getWorldToCameraMatrix();i.aB(v,v,f);const w=i.bU(c.min[0],c.min[1],c.min[2],1);let T=i.aC(i.eG(),w,v),P=T,O=T;w[1]=c.max[1],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O,w[0]=c.max[0],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O,w[1]=c.min[1],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O;const k=i.aA(p[0],0,1),N=100*o.pixelsPerMeter*i.aA(p[1],0,1),W=i.aA(p[2],0,1),H=i.eH(i.eG(),P,O,k),q=Math.tan(.5*o.fovX),ee=-H[2]*q;if(N===0)return H[1]<-Math.abs(ee)?W:1;const Y=(-Math.abs(ee)-H[1])/N,se=(he,me,de)=>(1-de)*he+de*me,oe=i.aA(se(1,W,Y),W,1);return se(1,oe,i.aA((o.pitch-20)/20,0,1))}class eb{}class Cc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,c,p){{const W=this._storage.get(c.id);if(W)return W.lastUsedFrameIdx=o,W.buf}const v=p.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(w),P=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const O=new i.eJ;for(let W=0;W<w/2;W+=3){const H=P[W],q=P[W+1],ee=P[W+2];O.emplaceBack(H,q),O.emplaceBack(q,ee),O.emplaceBack(ee,H)}const k=p.bindVertexArrayOES.current,N=new eb;return N.buf=new Ia(p,O),N.lastUsedFrameIdx=o,this._storage.set(c.id,N),p.bindVertexArrayOES.set(k),N.buf}update(o){for(const[c,p]of this._storage)o-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[o,c]of this._storage)c.buf.destroy(),this._storage.delete(o)}}class mh{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const gh=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ol{constructor(o){this.revealStart=11,this.revealRange=2}}const Xy=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Ky{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,c){const p=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new i.eK,P=new i.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(T,Xy.members),this.vignetteIdx=o.context.createIndexBuffer(P)}const v=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,p);const T={u_vignetteShape:(w={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};p.draw(o,o.context.gl.TRIANGLES,ir.disabled,Tr.disabled,Lr.alphaBlended,br.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v)}var w}}class Yy{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,c){const p=o.getFreeCameraOptions().position,v=p.toAltitude(),w=p.toLngLat(),T=i.an(w.lng),P=i.an(w.lat),O=o.pixelsPerMeter/c,k=T*i.eM,N=i.eM*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const W=-this._offsetYPrev+N,H=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*O,this._accumulatedOffsetY+=W*O,this._accumulatedElevation+=H*O,this._offsetXPrev=k,this._offsetYPrev=N,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Up(f,o){return[-(f[0]-Math.floor(f[0]/o)*o),-(f[1]-Math.floor(f[1]/o)*o),-(f[2]-Math.floor(f[2]/o)*o)]}function Zs(f){const o=i.eq(1323123451230),c=[];for(let p=0;p<f;++p){const v=2*o()-1,w=2*o()-1,T=2*o()-1;c.push(i.d5(v,w,T))}return c}function As(f,o,c,p,v){const w=i.aA((v-c)/(p-c),0,1);return(1-w)*f+w*o}class vu{constructor(o){this._movement=new Yy,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ky,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,c){const p=o.transform;this._movement.update(p,this._ppmScaleFactor);const v=p.starsProjMatrix,w=i.c7([]);i.c9(w,w,i.an(90)-p._pitch),i.c8(w,w,-p.angle);const T=i.cc(new Float32Array(16),w),P=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=i.eg([],P),k=i.aB([],O,T),N=Date.now()/1e3;return this._accumulatedTimeFromStart+=(N-this._prevTime)*c,this._prevTime=N,{projectionMatrix:v,modelviewMatrix:k}}}class Gp extends vu{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ol("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const c=o.context;if(!this.particlesVx){const p=Zs(this.particlesCount),v=new i.eN,w=new i.b0;let T=0;const P=i.eq(1323123451230);for(let O=0;O<p.length;++O){const k=p[O],N=[2*P()-1,P(),P(),P()];v.emplaceBack(k[0],k[1],k[2],-1,-1,...N),v.emplaceBack(k[0],k[1],k[2],1,-1,...N),v.emplaceBack(k[0],k[1],k[2],1,1,...N),v.emplaceBack(k[0],k[1],k[2],-1,1,...N),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(v,gh.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=o.transform.zoom;if(c.revealStart>p)return;const v=As(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let T=[-w.direction.x,w.direction.y,-100];i.aw(T,T);const P=structuredClone(this._vignetteParams);P.strength*=v,w.overrideStyleParameters||(w.intensity=o.style.rain.state.density,w.timeFactor=o.style.rain.state.intensity,w.color=structuredClone(o.style.rain.state.color),T=structuredClone(o.style.rain.state.direction),w.screenThinning.intensity=o.style.rain.state.centerThinning,w.dropletSizeX=o.style.rain.state.dropletSize[0],w.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],w.distortionStrength=100*o.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(o.style.rain.state.vignetteColor));const O=this.updateOnRender(o,w.timeFactor),k=o.context,N=k.gl,W=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new i.T(k,{width:o.width,height:o.height,data:null},N.RGBA8)),w.distortionStrength>0&&(k.activeTexture.set(N.TEXTURE0),this.screenTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),N.copyTexSubImage2D(N.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const H=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(k,H),k.activeTexture.set(N.TEXTURE0),this.screenTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const q=[w.color.r,w.color.g,w.color.b,w.color.a],ee=(Y,se)=>{const oe=Up(this._movement.getPosition(),Y),he=w.dropletSizeX,me=w.dropletSizeX*w.dropletSizeYScale,de=o.width/2,Ae=o.height/2,be=As(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Se=As(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),xe=As(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),ye=(Ce={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:Y,rainDropletSize:[he,me],distortionStrength:w.distortionStrength,rainDirection:T,color:q,screenSize:[W.width,W.height],thinningCenterPos:[de,Ae],thinningShape:[be,Se,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:xe,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:se?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const Le=Math.round(w.intensity*this.particlesCount),ke=i.bg.simpleSegment(0,0,4*Le,2*Le);H.draw(o,N.TRIANGLES,ir.disabled,Tr.disabled,Lr.alphaBlended,br.disabled,ye,"rain_particles",this.particlesVx,this.particlesIdx,ke)};w.distortionStrength>0&&ee(w.boxSize,!0),ee(w.boxSize,!1),this._vignette.draw(o,P)}}const Jy=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Qy extends vu{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ol("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const c=o.context;if(!this.particlesVx){const p=Zs(this.particlesCount),v=new i.eO,w=new i.b0;let T=0;const P=i.eq(1323123451230);for(let O=0;O<p.length;++O){const k=p[O],N=P(),W=P(),H=P(),q=[O/p.length,N,W,H],ee=[P(),P()];v.emplaceBack(k[0],k[1],k[2],-1,-1,...q,...ee),v.emplaceBack(k[0],k[1],k[2],1,-1,...q,...ee),v.emplaceBack(k[0],k[1],k[2],1,1,...q,...ee),v.emplaceBack(k[0],k[1],k[2],-1,1,...q,...ee),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(v,Jy.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];i.aw(p,p);const v=structuredClone(this._vignetteParams),w=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=o.transform.zoom;if(w.revealStart>T)return;const P=As(0,1,w.revealStart,w.revealStart+w.revealRange,T);v.strength*=P,c.overrideStyleParameters||(c.intensity=o.style.snow.state.density,c.timeFactor=o.style.snow.state.intensity,c.color=structuredClone(o.style.snow.state.color),p=structuredClone(o.style.snow.state.direction),c.screenThinning.intensity=o.style.snow.state.centerThinning,c.billboardSize=2.79*o.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(o.style.snow.state.vignetteColor));const O=this.updateOnRender(o,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=o.context,N=k.gl,W=o.transform,H=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(k,H),((q,ee,Y)=>{const se=Up(this._movement.getPosition(),q),oe=W.width/2,he=W.height/2,me=As(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),de=As(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ae=As(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),be=(Se={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:se,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:q,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[W.width,W.height],thinningCenterPos:[oe,he],thinningShape:[me,de,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ae,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:p},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_horizontalOscillationRadius:Se.horizontalOscillationRadius,u_horizontalOscillationRate:Se.horizontalOscillationRate,u_boxSize:Se.boxSize,u_billboardSize:Se.billboardSize,u_simpleShapeParameters:Se.simpleShapeParameters,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_particleColor:Se.color,u_direction:Se.direction});var Se;const xe=Math.round(Y.intensity*this.particlesCount),ye=i.bg.simpleSegment(0,0,4*xe,2*xe);this.particlesVx&&this.particlesIdx&&H.draw(o,N.TRIANGLES,ir.disabled,Tr.disabled,Lr.alphaBlended,br.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,ye)})(c.boxSize,0,c),this._vignette.draw(o,v)}}const Ic={symbol:function(f,o,c,p,v){if(f.renderPass!=="translucent")return;const w=Tr.disabled,T=f.colorModeForRenderPass(),P=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),k=i.aA(f.scaleFactor,O[0],O[1]);P&&function(H,q,ee,Y,se,oe,he,me){const de=q.transform,Ae=se==="map",be=oe==="map";for(const Se of H){const xe=Y.getTile(Se),ye=xe.getBucket(ee);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const Ce=i.bK(ye.textSizeData,de.zoom,me),Le=Ha(Se,ye.getProjection(),de),ke=de.calculatePixelsToTileUnitsMatrix(xe),Je=es(Le,xe.tileID.canonical,be,Ae,de,ye.getProjection(),ke),et=ye.hasIconTextFit()&&ye.hasIconData();Ce&&mr(ye,Ae,be,he,de,Je,Se,Math.pow(2,de.zoom-xe.tileID.overscaledZ),Ce,et)}}(p,f,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,k);const N=c.paint.get("icon-opacity").constantOr(1)!==0,W=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(N||W)?Dd(f,o,c,p,w,T):(N&&Dd(f,o,c,p,w,T,{onlyIcons:!0}),W&&Dd(f,o,c,p,w,T,{onlyText:!0})),o.map.showCollisionBoxes&&(Yt(f,o,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yt(f,o,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,c,p){if(f.renderPass!=="translucent")return;const v=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),P=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||T.constantOr(1)===0))return;const k=f.context,N=k.gl,W=f.transform,H=!(!f.terrain||!f.terrain.enabled),q=c.layout.get("circle-elevation-reference"),ee=f.depthModeForSublayer(0,ir.ReadOnly),Y=new ir(f.context.gl.LEQUAL,ir.ReadOnly,f.depthRangeFor3D),se=q==="none"||H?ee:Y,oe=Tr.disabled,he=f.colorModeForDrapableLayerRenderPass(O),me=W.projection.name==="globe",de=[i.aF(W.center.lng),i.aJ(W.center.lat)],Ae=[];for(let Se=0;Se<p.length;Se++){const xe=p[Se],ye=o.getTile(xe),Ce=ye.getBucket(c);if(!Ce||Ce.projection.name!==W.projection.name)continue;const Le=Ce.programConfigurations.get(c.id),ke=Ce.layoutVertexBuffer,Je=Ce.globeExtVertexBuffer,et=Ce.indexBuffer,ht=i.e0(c),St=[Je],We=f.isTileAffectedByFog(xe);me&&ht.push("PROJECTION_GLOBE_VIEW"),ht.push("DEPTH_D24"),f.terrain&&W.depthOcclusionForSymbolsAndCircles&&ht.push("DEPTH_OCCLUSION"),Ce.hasElevation&&!f.terrain&&(ht.push("ELEVATED_ROADS"),St.push(Ce.elevatedLayoutVertexBuffer));const Re=f.getOrCreateProgram("circle",{config:Le,defines:ht,overrideFog:We}),ot=W.projection.createInversionMatrix(W,xe.canonical),Ze={programConfiguration:Le,program:Re,layoutVertexBuffer:ke,dynamicBuffers:St,indexBuffer:et,uniformValues:i.e1(f,xe,ye,ot,de,c),tile:ye};if(P){const gt=Ce.segments.get();for(const Rt of gt)Ae.push({segments:new i.bg([Rt]),sortKey:Rt.sortKey,state:Ze})}else Ae.push({segments:Ce.segments,sortKey:0,state:Ze})}P&&Ae.sort((Se,xe)=>Se.sortKey-xe.sortKey);const be={useDepthForOcclusion:W.depthOcclusionForSymbolsAndCircles};for(const Se of Ae){const{programConfiguration:xe,program:ye,layoutVertexBuffer:Ce,dynamicBuffers:Le,indexBuffer:ke,uniformValues:Je,tile:et}=Se.state,ht=Se.segments;f.terrain&&f.terrain.setupElevationDraw(et,ye,be),f.uploadCommonUniforms(k,ye,et.tileID.toUnwrapped()),ye.draw(f,N.TRIANGLES,se,oe,he,br.disabled,Je,c.id,Ce,ke,ht,c.paint,W.zoom,xe,Le)}},heatmap:function(f,o,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const v=f.context,w=v.gl,T=Tr.disabled,P=new Lr([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(q,ee,Y,se){const oe=q.gl,he=ee.width*se,me=ee.height*se;q.activeTexture.set(oe.TEXTURE1),q.viewport.set([0,0,he,me]);let de=Y.heatmapFbo;if(!de||de&&(de.width!==he||de.height!==me)){de&&de.destroy();const Ae=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,Ae),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),de=Y.heatmapFbo=q.createFramebuffer(he,me,1,null),function(be,Se,xe,ye,Ce,Le){const ke=be.gl;ke.texImage2D(ke.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Ce,Le,0,ke.RGBA,be.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),ye.colorAttachment0.set(xe)}(q,0,Ae,de,he,me)}else oe.bindTexture(oe.TEXTURE_2D,de.colorAttachment0.get()),q.bindFramebuffer.set(de.framebuffer)})(v,f,c,f.transform.projection.name==="globe"?.5:.25),v.clear({color:i.ao.transparent});const O=f.transform,k=O.projection.name==="globe",N=k?["PROJECTION_GLOBE_VIEW"]:[],W=k?br.frontCCW:br.disabled,H=[i.aF(O.center.lng),i.aJ(O.center.lat)];for(let q=0;q<p.length;q++){const ee=p[q];if(o.hasRenderableParent(ee))continue;const Y=o.getTile(ee),se=Y.getBucket(c);if(!se||se.projection.name!==O.projection.name)continue;const oe=f.isTileAffectedByFog(ee),he=se.programConfigurations.get(c.id),me=f.getOrCreateProgram("heatmap",{config:he,defines:N,overrideFog:oe}),{zoom:de}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,me),f.uploadCommonUniforms(v,me,ee.toUnwrapped());const Ae=O.projection.createInversionMatrix(O,ee.canonical);me.draw(f,w.TRIANGLES,ir.disabled,T,P,W,Dx(f,ee,Y,Ae,H,de,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,f.transform.zoom,he,k?[se.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,w){const T=v.context,P=T.gl,O=w.heatmapFbo;if(!O)return;T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment0.get()),T.activeTexture.set(P.TEXTURE1);let k=w.colorRampTexture;k||(k=w.colorRampTexture=new i.T(T,w.colorRamp,P.RGBA8)),k.bind(P.LINEAR,P.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,P.TRIANGLES,ir.disabled,Tr.disabled,v.colorModeForRenderPass(),br.disabled,((N,W,H,q)=>({u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(f,c))},line:function(f,o,c,p){if(f.renderPass!=="translucent")return;const v=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const T=c.paint.get("line-emissive-strength").isConstant(),P=c.paint.get("line-emissive-strength").constantOr(0),O=c.paint.get("line-occlusion-opacity"),k=c.layout.get("line-elevation-reference"),N=c.layout.get("line-width-unit")==="meters",W=k==="sea",H=!(!f.terrain||!f.terrain.enabled),q=f.context,ee=q.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Y=c.layout.get("line-cross-slope"),se=Y!==void 0,oe=Y<1,he=f.colorModeForDrapableLayerRenderPass(T?P:null),me=f.terrain&&f.terrain.renderingToTexture,de=me?1:i.o.devicePixelRatio,Ae=c.paint.get("line-dasharray"),be=Ae.constantOr(1),Se=c.layout.get("line-cap"),xe=Ae.constantOr(null),ye=Se.constantOr(null),Ce=c.paint.get("line-pattern"),Le=Ce.constantOr(1),ke=c.paint.get("line-pattern-cross-fade"),Je=Ce.constantOr(null),et=c.paint.get("line-opacity").constantOr(1);let ht=!Le&&et!==1||f.depthOcclusion&&O>0&&O<1;const St=c.paint.get("line-gradient"),We=Le?"linePattern":"line",Re=i.e2(c);let ot;if(me&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ht=!1),O!==0&&f.depthOcclusion){const $t=c.paint._values["line-opacity"];$t&&$t.value&&$t.value.kind==="constant"?ot=$t.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&Re.push("VARIABLE_LINE_WIDTH"),me&&(f.emissiveMode!=="dual-source-blending"||T?f.emissiveMode==="mrt-fallback"&&Re.push("USE_MRT1"):Re.push("DUAL_SOURCE_BLENDING"));const Ze=($t,It,Et,tr,Jt,zt)=>{for(const Gt of $t){const dr=o.getTile(Gt);if(Le&&!dr.patternsLoaded())continue;const Or=dr.getBucket(c);if(!Or||Or.elevationType!=="none"&&!Jt||Or.elevationType==="none"&&Jt)continue;f.prepareDrawTile();const Qr=[...It],wn=f.shadowRenderer,rr=Or.elevationType==="road"&&!!wn&&wn.enabled;let vn=[0,0,0];if(rr){const Br=f.style.directionalLight,oi=f.style.ambientLight;Br&&oi&&(vn=El(f.style,Br,oi)),Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mr=Or.programConfigurations.get(c.id);let An=!1;if(Je&&dr.imageAtlas){const Br=i.e3.from(Je),oi=Br.getPrimary().scaleSelf(de).toString(),Di=dr.imageAtlas.patternPositions.get(oi),yi=Br.getSecondary(),qn=yi?dr.imageAtlas.patternPositions.get(yi.scaleSelf(de).toString()):null;An=!!Di&&!!qn,Di&&Mr.setConstantPatternPositions(Di,qn)}ke>0&&(An||Mr.getPatternTransitionVertexBuffer("line-pattern"))&&Qr.push("LINE_PATTERN_TRANSITION");const Bn=f.isTileAffectedByFog(Gt),kn=f.getOrCreateProgram(We,{config:Mr,defines:Qr,overrideFog:Bn});if(!Le&&xe&&ye&&dr.lineAtlas){const Br=dr.lineAtlas.getDash(xe,ye);Br&&Mr.setConstantPatternPositions(Br)}rr&&wn.setupShadows(dr.tileID.toUnwrapped(),kn,"vector-tile");let[yn,Fr]=c.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&yn!==Fr&&(yn===0&&(yn-=1),Fr===1&&(Fr+=1));const Sn=me?Gt.projMatrix:null,wi=N?1/Or.tileToMeter/i.ay(dr,1,f.transform.zoom):1,hi=N?1/Or.tileToMeter/i.ay(dr,1,Math.floor(f.transform.zoom)):1,Pn=Le?i.e4(f,dr,c,Sn,de,wi,hi,[yn,Fr],vn,ke):i.e5(f,dr,c,Sn,Or.lineClipsArray.length,de,wi,hi,[yn,Fr],vn);if(St){const Br=Or.gradients[c.id];let oi=Br.texture;if(c.gradientVersion!==Br.version){let Di=256;if(c.stepInterpolant){const yi=o.getSource().maxzoom,qn=Gt.canonical.z===yi?Math.ceil(1<<f.transform.maxZoom-Gt.canonical.z):1;Di=i.aA(i.e6(Or.maxLineLength/i.al*1024*qn),256,q.maxTextureSize)}Br.gradient=i.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Di,image:Br.gradient||void 0,clips:Or.lineClipsArray}),Br.texture?Br.texture.update(Br.gradient):Br.texture=new i.T(q,Br.gradient,ee.RGBA8),Br.version=c.gradientVersion,oi=Br.texture}q.activeTexture.set(ee.TEXTURE1),oi.bind(c.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}be&&(q.activeTexture.set(ee.TEXTURE0),dr.lineAtlasTexture&&dr.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),Mr.updatePaintBuffers()),Le&&(q.activeTexture.set(ee.TEXTURE0),dr.imageAtlasTexture&&dr.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Mr.updatePaintBuffers()),Jt&&!W&&f.terrain.setupElevationDraw(dr,kn),f.uploadCommonUniforms(q,kn,Gt.toUnwrapped());const fn=Br=>{ot!=null&&(ot.value=et*O),kn.draw(f,ee.TRIANGLES,Et,Br,he,br.disabled,Pn,c.id,Or.layoutVertexBuffer,Or.indexBuffer,Or.segments,c.paint,f.transform.zoom,Mr,[Or.layoutVertexBuffer2,Or.patternVertexBuffer,Or.zOffsetVertexBuffer]),ot!=null&&(ot.value=et)};if(ht&&!Jt){const Br=f.stencilModeForClipping(Gt).ref;Br===0&&me&&q.clear({stencil:0});const oi={func:ee.EQUAL,mask:255};Pn.u_alpha_discard_threshold=.8,fn(new Tr(oi,Br,255,ee.KEEP,ee.KEEP,ee.INVERT)),Pn.u_alpha_discard_threshold=0,fn(new Tr(oi,Br,255,ee.KEEP,ee.KEEP,ee.KEEP))}else Pn.u_alpha_discard_threshold=ht&&Jt&&zt?.8:0,fn(Jt?tr:f.stencilModeForClipping(Gt))}};let gt=f.depthModeForSublayer(0,ir.ReadOnly);const Rt=new ir(f.depthOcclusion?ee.GREATER:ee.LEQUAL,ir.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const $t=!me&&f.terrain;O!==0&&$t?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):$t?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Ze(p,Re,gt,Tr.disabled,!1,!0)}if(c.hasElevatedBuckets){k==="hd-road-markup"?H||(gt=Rt,Re.push("ELEVATED_ROADS")):(Re.push("ELEVATED"),gt=Rt,se&&Re.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),W&&Re.push("ELEVATION_REFERENCE_SEA"));const $t=ht?f.stencilModeFor3D():Tr.disabled;f.forceTerrainMode=!0,Ze(p,Re,gt,$t,!0,!0),ht&&Ze(p,Re,gt,$t,!0,!1),f.forceTerrainMode=!1}ht&&(f.resetStencilClippingMasks(),me&&q.clear({stencil:0})),O===0||f.depthOcclusion||me||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,o,c,p){const v=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const T=c.paint.get("fill-emissive-strength"),P=f.colorModeForDrapableLayerRenderPass(T),O=c.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!O.constantOr(1)&&v.constantOr(i.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let N="none";c.layout.get("fill-elevation-reference")!=="none"?N="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(N="offset");const W=!(!f.terrain||!f.terrain.enabled),H={painter:f,sourceCache:o,layer:c,coords:p,colorMode:P,elevationType:N,terrainEnabled:W,pass:k};if(f.renderPass==="shadow")return void(f.shadowRenderer&&N==="road"&&!W&&function(ee){const{painter:Y,sourceCache:se,layer:oe,coords:he}=ee,me=Y.context.gl,de=ee.painter.shadowRenderer;for(const Ae of he){const be=se.getTile(Ae),Se=be.getBucket(oe);if(!Se)continue;const xe=Se.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ye=Se.bufferData.programConfigurations.get(oe.id),Ce=Y.isTileAffectedByFog(Ae),Le=Y.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:Ce}),ke=de.calculateShadowPassMatrixFromTile(be.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,Le,Ae.toUnwrapped());const Je={u_matrix:ke,u_depth_bias:0};Le.draw(Y,me.TRIANGLES,de.getShadowPassDepthMode(),Tr.disabled,de.getShadowPassColorMode(),br.disabled,Je,oe.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,oe.paint,Y.transform.zoom,ye)}}(H));const q=f.emissiveMode==="mrt-fallback";if(N!=="offset"){if(Rp(H,!1,q),N==="road"){const ee=!W&&f.renderPass==="translucent";ee&&Op(f,o,c,p,"geometry"),Rp(H,!0,q,Tr.disabled),ee&&function(Y){const{painter:se,sourceCache:oe,layer:he,coords:me,colorMode:de}=Y,Ae=se.context.gl,be=Y.painter.shadowRenderer,Se=!!be&&be.enabled,xe=new ir(se.context.gl.LEQUAL,ir.ReadOnly,se.depthRangeFor3D);let ye=[0,0,0];if(Se){const Le=se.style.directionalLight,ke=se.style.ambientLight;Le&&ke&&(ye=El(se.style,Le,ke))}const Ce=Le=>{for(const ke of me){const Je=oe.getTile(ke),et=Je.getBucket(he);if(!et)continue;const ht=et.elevatedStructures;if(!ht)continue;let St,We;if(Le?(St=ht.renderableBridgeSegments,We=ht.bridgeProgramConfigurations.get(he.id)):(St=ht.renderableTunnelSegments,We=ht.tunnelProgramConfigurations.get(he.id)),!St||St.segments[0].primitiveLength===0)continue;We.updatePaintBuffers(),se.prepareDrawTile();const Re=se.isTileAffectedByFog(ke),ot=[];Se&&ot.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ze=se.getOrCreateProgram("elevatedStructures",{config:We,overrideFog:Re,defines:ot}),gt=se.translatePosMatrix(ke.projMatrix,Je,he.paint.get("fill-translate"),he.paint.get("fill-translate-anchor"));Se&&be.setupShadows(Je.tileID.toUnwrapped(),Ze,"vector-tile");const Rt=Sc(gt,ye);se.uploadCommonUniforms(se.context,Ze,ke.toUnwrapped()),Ze.draw(se,Ae.TRIANGLES,xe,Tr.disabled,de,br.backCCW,Rt,he.id,ht.vertexBuffer,ht.indexBuffer,St,he.paint,se.transform.zoom,We,[ht.vertexBufferNormal])}};Ce(!0),Ce(!1)}(H)}}else Rp(H,!1,q,f.stencilModeFor3D())},"fill-extrusion":function(f,o,c,p){const v=c.paint.get("fill-extrusion-opacity"),w=f.context,T=w.gl,P=f.terrain,O=P&&P.renderingToTexture;if(v===0)return;const k=f.emissiveMode==="mrt-fallback",N=f.conflationActive&&f.style.isLayerClipped(c,o.getSource()),W=f.style.order.indexOf(c.fqid);if(N&&function(H,q,ee,Y,se){for(const oe of Y){const he=q.getTile(oe).getBucket(ee);he&&(he.updateReplacement(oe,H.replacementSource,se),he.uploadCentroid(H.context))}}(f,o,c,p,W),P||N)for(const H of p){const q=o.getTile(H).getBucket(c);q&&u2(f.context,o,H,q,c,P,N)}if(f.renderPass==="shadow"&&f.shadowRenderer){const H=f.shadowRenderer;if(P&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const q=H.getShadowPassDepthMode(),ee=H.getShadowPassColorMode();Dp(f,o,c,p,q,Tr.disabled,ee,N)}else if(f.renderPass==="translucent"){const H=!c.paint.get("fill-extrusion-pattern").constantOr(1),q=c.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!O&&q.a!==0){const ee=new ir(f.context.gl.LEQUAL,ir.ReadWrite,f.depthRangeFor3D);v===1&&H?Dp(f,o,c,p,ee,Tr.disabled,Lr.unblended,N):(Dp(f,o,c,p,ee,Tr.disabled,Lr.disabled,N),Dp(f,o,c,p,ee,f.stencilModeFor3D(),f.colorModeForRenderPass(),N),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&H&&(!P&&f.transform.projection.name!=="globe"||O)){const ee=c.paint.get("fill-extrusion-opacity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),se=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=c.paint.get("fill-extrusion-flood-light-intensity"),he=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",me=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(he?null:c.lut).toArray01().slice(0,3),de=Y>0&&se>0,Ae=oe>0,be=(ye,Ce,Le)=>(1-Le)*ye+Le*Ce,Se=new Wy;Se.translate=c.paint.get("fill-extrusion-translate"),Se.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Se.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Se.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const xe=ye=>{const Ce=f.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!0),Le=c.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=be(.1,3,Le),Je=f._showOverdrawInspector;if(!Je){const et=new Tr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ht=new Lr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);Cl(Se,f,o,c,p,Ce,et,ht,br.disabled,ye,"sdf",ee,Y,se,oe,me,ke,N,!1)}{const et=Je?Tr.disabled:new Tr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ht=Je?f.colorModeForRenderPass():new Lr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);Cl(Se,f,o,c,p,Ce,et,ht,br.disabled,ye,"color",ee,Y,se,oe,me,ke,N,!1)}};if(O){const ye=()=>{const Le=P.drapeBufferSize[0],ke=P.drapeBufferSize[1];let Je=P.framebufferCopyTexture;return Je&&(!Je||Je.size[0]===Le&&Je.size[1]===ke)||(Je&&Je.destroy(),Je=P.framebufferCopyTexture=new i.T(w,new i.q({width:Le,height:ke}),T.RGBA8)),Je.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Le,ke),Je},Ce=(Le,ke,Je)=>{const et=f.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!1),ht=c.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),St=be(.1,3,ht);{const We=new Lr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0]);Cl(Se,f,o,c,p,et,Tr.disabled,We,br.disabled,Le,"clear",ee,Y,se,oe,me,St,N,ke)}{const We=new Tr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Re=new Lr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);Cl(Se,f,o,c,p,et,We,Re,br.disabled,Le,"sdf",ee,Y,se,oe,me,St,N,ke)}k&&!Le&&(Je=ye());{const We=Le?T.ZERO:T.ONE_MINUS_DST_ALPHA,Re=new Tr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ot=new Lr([We,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Cl(Se,f,o,c,p,et,Re,ot,br.disabled,Le,"color",ee,Y,se,oe,me,St,N,ke)}if(!k||Le){const We=new Lr([T.ONE,T.ONE,T.ONE,Le?T.ZERO:T.ONE],i.ao.transparent,[!1,!1,!1,!0],Le?T.FUNC_ADD:T.MAX);Cl(Se,f,o,c,p,et,Tr.disabled,We,br.disabled,Le,"clear",ee,Y,se,oe,me,St,N,ke,Je)}else{T.drawBuffers([T.NONE,T.COLOR_ATTACHMENT1]);const We=new Tr({func:T.EQUAL,mask:255},254,255,T.KEEP,T.DECR,T.DECR),Re=new Lr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!0,!1,!1,!1],T.MAX);Cl(Se,f,o,c,p,et,We,Re,br.disabled,Le,"emissive",ee,Y,se,oe,me,St,N,ke,Je),T.drawBuffers([T.COLOR_ATTACHMENT0])}};if(de||Ae){let Le;f.prepareDrawTile(),k&&!de||(Le=ye()),de&&Ce(!0,!1,Le),Ae&&Ce(!1,!0,Le)}}else de&&xe(!0),Ae&&xe(!1),(de||Ae)&&f.resetStencilClippingMasks()}}},building:function(f,o,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const v=c.paint.get("building-ambient-occlusion-ground-intensity"),w=c.paint.get("building-ambient-occlusion-ground-radius"),T=c.paint.get("building-ambient-occlusion-ground-attenuation"),P=c.paint.get("building-opacity");if(P<=0)return;let O=v>0&&w>0,k=!0;const N=c.paint.get("building-vertical-scale");if(N<=0)return;f.shadowRenderer||(k=!1);const W=f.conflationActive&&f.style.isLayerClipped(c,o.getSource()),H=f.style.order.indexOf(c.fqid);if(function(q,ee,Y,se,oe,he){for(const me of he){const de=ee.getTile(me).getBucket(Y);de&&(oe&&de.updateReplacement(me,q.replacementSource,se),de.uploadUpdatedIndexBuffer(q.context))}}(f,o,c,H,W,p),function(q,ee,Y,se){for(const oe of se){const he=ee.getTile(oe).getBucket(Y);he&&he.needsEvaluation()&&he.uploadUpdatedColorBuffer(q.context)}}(f,o,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const q=f.shadowRenderer,ee=[],Y=q.getShadowPassDepthMode();kd({painter:f,source:o,layer:c,coords:p,defines:ee,blendMode:q.getShadowPassColorMode(),depthMode:Y,opacity:P,verticalScale:N,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];k&&(q=q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&(q=q.concat("NORMAL_OFFSET"));const ee=c.paint.get("building-facade-emissive-chance"),Y=c.paint.get("building-ambient-occlusion-intensity"),se=c.paint.get("building-flood-light-intensity"),oe=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",he=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(oe?null:c.lut).toArray01().slice(0,3),me=c.paint.get("building-flood-light-ground-attenuation"),de=se>0,Ae=new ir(f.context.gl.LEQUAL,ir.ReadWrite,f.depthRangeFor3D);P<1&&kd({painter:f,source:o,layer:c,coords:p,defines:q,blendMode:Lr.disabled,depthMode:Ae,opacity:P,verticalScale:N,facadeEmissiveChance:ee,facadeAOIntensity:Y,floodLightIntensity:se,floodLightColor:he,depthOnly:!0});const be=f.colorModeForRenderPass();kd({painter:f,source:o,layer:c,coords:p,defines:q,blendMode:be,depthMode:Ae,opacity:P,verticalScale:N,facadeEmissiveChance:ee,facadeAOIntensity:Y,floodLightIntensity:se,floodLightColor:he}),O&&kp(f,o,c,p,!0,P,v,w,se,he,T,W),de&&kp(f,o,c,p,!1,P,v,w,se,he,me,W)}else if(f.renderPass==="light-beam"){const q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],ee=new ir(f.context.gl.LEQUAL,ir.ReadOnly,f.depthRangeFor3D);kd({painter:f,source:o,layer:c,coords:p,defines:q,blendMode:Lr.alphaBlended,depthMode:ee,opacity:P,verticalScale:N,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,o,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const v=f.context,w=f.terrain&&f.terrain.renderingToTexture,[T,P]=f.renderPass!=="translucent"||w?[{},p]:f.stencilConfigForOverlap(p);for(const O of P){const k=o.getTile(O);if(k.needsHillshadePrepare&&f.renderPass==="offscreen")e2(f,k,c);else if(f.renderPass==="translucent"){const N=f.depthModeForSublayer(0,ir.ReadOnly),W=c.paint.get("hillshade-emissive-strength"),H=f.colorModeForDrapableLayerRenderPass(W),q=w&&f.terrain?f.terrain.stencilModeForRTTOverlap(O):T[O.overscaledZ];QS(f,O,k,c,N,q,H)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,c,p,v,w){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",P=c.paint.get("raster-elevation")!==0,O=P&&T;if(f.renderElevatedRasterBackface&&!O)return;const k=f.context,N=k.gl,W=o.getSource(),H=function(be,Se,xe,ye,Ce){const Le=Se.paint.get("raster-color"),ke=be.type==="raster-array",Je=[],et=Se.paint.get("raster-resampling"),ht=Se.paint.get("raster-color-mix");let St=Se.paint.get("raster-color-range");const We=[ht[0],ht[1],ht[2],0],Re=ht[3];let ot=et==="nearest"?ye.NEAREST:ye.LINEAR;if(ke&&(Je.push("RASTER_ARRAY"),Le||Je.push("RASTER_COLOR"),et==="linear"&&Je.push("RASTER_ARRAY_LINEAR"),ot=ye.NEAREST,!St&&be.rasterLayers)){const Ze=be.rasterLayers.find(({id:gt})=>gt===Se.sourceLayer);Ze&&Ze.fields&&Ze.fields.range&&(St=Ze.fields.range)}if(St=St||[0,1],Le){Je.push("RASTER_COLOR"),xe.activeTexture.set(ye.TEXTURE2),Se.updateColorRamp(St);let Ze=Se.colorRampTexture;Ze||(Ze=Se.colorRampTexture=new i.T(xe,Se.colorRamp,ye.RGBA8)),Ze.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}return Ce&&Je.push("USE_MRT1"),{mix:We,range:St,offset:Re,defines:Je,resampling:ot}}(W,c,k,N,f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback");if(W instanceof i.aU&&!p.length&&!T)return;const q=c.paint.get("raster-emissive-strength"),ee=f.colorModeForDrapableLayerRenderPass(q),Y=f.terrain&&f.terrain.renderingToTexture,se=!f.options.moving,oe=c.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;if(W instanceof i.aU&&!p.length&&(W.onNorthPole||W.onSouthPole)){const be=P?f.stencilModeFor3D():Tr.disabled;return void jd(!!W.onNorthPole,null,f,o,c,q,H,br.disabled,be)}if(!p.length)return;const[he,me]=W instanceof i.aU||Y?[{},p]:f.stencilConfigForOverlap(p),de=me[me.length-1].overscaledZ;O&&H.defines.push("PROJECTION_GLOBE_VIEW"),P&&H.defines.push("RENDER_CUTOFF");const Ae=(be,Se,xe)=>{for(const ye of be){const Ce=ye.toUnwrapped(),Le=o.getTile(ye);if(Y&&(!Le||!Le.hasData()))continue;k.activeTexture.set(N.TEXTURE0);const ke=Ml(Le,W,c,H);if(!ke||!ke.texture)continue;const{texture:Je,mix:et,offset:ht,tileSize:St,buffer:We}=ke;let Re,ot;Y?(Re=ir.disabled,ot=ye.projMatrix):P?(Re=new ir(N.LEQUAL,ir.ReadWrite,f.depthRangeFor3D),ot=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ce,se)):(Re=f.depthModeForSublayer(ye.overscaledZ-de,c.paint.get("raster-opacity")===1?ir.ReadWrite:ir.ReadOnly,N.LESS),ot=f.transform.calculateProjMatrix(Ce,se));const Ze=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(ye):he[ye.overscaledZ],gt=w?0:c.paint.get("raster-fade-duration");Le.registerFadeDuration(gt);const Rt=o.findLoadedParent(ye,0),$t=Id(Le,Rt,o,f.transform,gt);let It,Et;!$t.isFading&&Le.refreshedUponExpiration&&(Le.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),k.activeTexture.set(N.TEXTURE0),Je.bind(oe,N.CLAMP_TO_EDGE),k.activeTexture.set(N.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(oe,N.CLAMP_TO_EDGE),It=Math.pow(2,Rt.tileID.overscaledZ-Le.tileID.overscaledZ),Et=[Le.tileID.canonical.x*It%1,Le.tileID.canonical.y*It%1]):Je.bind(oe,N.CLAMP_TO_EDGE),"useMipmap"in Je&&k.extTextureFilterAnisotropic&&f.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const tr=f.transform;let Jt;const zt=P?Vx(tr):[0,0,0,0];let Gt,dr,Or,Qr,wn,rr=0;if(O&&W instanceof i.aU&&W.coordinates.length>3)Gt=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),dr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(i.dF(tr)),Qr=[i.aF(tr.center.lng),i.aJ(tr.center.lat)],Jt=W.elevatedGlobePerspectiveTransform,wn=W.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Bn=i.dG(ye.canonical);rr=i.dH(Bn.getCenter().lat),Gt=Float32Array.from(i.bk(i.dJ(ye.canonical))),dr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(i.dF(tr)),Qr=[i.aF(tr.center.lng),i.aJ(tr.center.lat)],Jt=[0,0],wn=Float32Array.from(i.dI(ye.canonical,Bn,rr,tr.worldSize/tr._pixelsPerMercatorPixel))}else Jt=W instanceof i.aU?W.perspectiveTransform:[0,0],Gt=new Float32Array(16),dr=new Float32Array(9),Or=new Float32Array(16),Qr=[0,0],wn=new Float32Array(9);const vn=kx(ot,Gt,dr,Or,wn,Et||[0,0],i.aj(f.transform.zoom),Qr,zt,It||1,$t,c,Jt,P?c.paint.get("raster-elevation"):0,2,et,ht,H.range,St,We,q),Mr=f.isTileAffectedByFog(ye),An=f.getOrCreateProgram("raster",{defines:H.defines,overrideFog:Mr});if(f.uploadCommonUniforms(k,An,Ce),W instanceof i.aU){const Bn=W.elevatedGlobeVertexBuffer,kn=W.elevatedGlobeIndexBuffer;if(Y||!T)W.boundsBuffer&&W.boundsSegments&&An.draw(f,N.TRIANGLES,Re,Tr.disabled,ee,br.disabled,vn,c.id,W.boundsBuffer,f.quadTriangleIndexBuffer,W.boundsSegments);else if(Bn&&kn){const yn=tr.zoom<=i.c_?W.elevatedGlobeSegments:W.getSegmentsForLongitude(tr.center.lng);yn&&An.draw(f,N.TRIANGLES,Re,Tr.disabled,ee,Se,vn,c.id,Bn,kn,yn)}}else if(O){Re=new ir(N.LEQUAL,ir.ReadOnly,f.depthRangeFor3D);const Bn=f.globeSharedBuffers;if(Bn){const[kn,yn,Fr]=Bn.getGridBuffers(rr,!1);An.draw(f,N.TRIANGLES,Re,xe||Ze,f.colorModeForRenderPass(),Se,vn,c.id,kn,yn,Fr)}}else{const{tileBoundsBuffer:Bn,tileBoundsIndexBuffer:kn,tileBoundsSegments:yn}=f.getTileBoundsBuffers(Le);An.draw(f,N.TRIANGLES,Re,Ze,ee,br.disabled,vn,c.id,Bn,kn,yn)}}if(!(W instanceof i.aU)&&O)for(const ye of be){const Ce=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&jd(!0,ye,f,o,c,q,H,Se,xe||Tr.disabled),Ce&&jd(!1,ye,f,o,c,q,H,Se===br.frontCW?br.backCW:br.frontCW,xe||Tr.disabled)}};O?Ae(me,f.renderElevatedRasterBackface?br.backCW:br.frontCW,f.stencilModeFor3D()):Ae(me,br.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,o,c,p,v,w){f.renderPass==="offscreen"&&function(T,P,O,k){if(!k.length)return;const N=T.context,W=N.gl,H=P.getSource();if(!(H instanceof Qo))return;const q=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let ee=O.particlePositionRGBAImage;if(!ee||ee.width!==q){const me=function(de){const Ae=de*de,be=new Uint8Array(4*Ae),Se=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},xe=1/1.1;for(let ye=0;ye<Ae;ye++){const Ce=xe*(Se(2*ye+0)+Ka),Le=xe*(Se(2*ye+1)+Ka),ke=255*Ce%1,Je=255*Le%1,et=ke,ht=Le-Je/255,St=Je;be[4*ye+0]=255*(Ce-ke/255),be[4*ye+1]=255*et,be[4*ye+2]=255*ht,be[4*ye+3]=255*St}return be}(q);ee=O.particlePositionRGBAImage=new i.q({width:q,height:q},me)}let Y=O.particleFramebuffer;Y?Y.width!==q&&(Y.destroy(),Y=O.particleFramebuffer=N.createFramebuffer(q,q,1,null)):Y=O.particleFramebuffer=N.createFramebuffer(q,q,1,null);const se=[];for(const me of k){const de=P.getTile(me);if(!(de instanceof Zf))continue;const Ae=Zy(de,H,O);if(!Ae)continue;const be=[de.tileSize,de.tileSize];let Se=O.tileFramebuffer;Se||(Se=O.tileFramebuffer=N.createFramebuffer(be[0],be[1],1,null));let xe=de.rasterParticleState;xe||(xe=de.rasterParticleState=new Lp(N,me,be,ee));const ye=xe.update(O.lastInvalidatedAt);xe.particleTextureDimension!==q&&xe.updateParticleTexture(me,ee);const Ce=xe.targetColorTexture;xe.targetColorTexture=xe.backgroundColorTexture,xe.backgroundColorTexture=Ce;const Le=xe.particleTexture0;xe.particleTexture0=xe.particleTexture1,xe.particleTexture1=Le,se.push([me,Ae,xe,ye])}if(se.length===0)return;const oe=i.o.now(),he=O.previousDrawTimestamp?.001*(oe-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=oe,O.hasColorMap()){N.activeTexture.set(W.TEXTURE0+2);let me=O.colorRampTexture;me||(me=O.colorRampTexture=new i.T(N,O.colorRamp,W.RGBA8)),me.bind(W.LINEAR,W.CLAMP_TO_EDGE)}N.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(me,de,Ae){const be=me.context,Se=be.gl,xe=de.tileFramebuffer;be.activeTexture.set(Se.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*(Le=de.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},Ce=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const ke of Ae){const[,,Je,et]=ke;xe.colorAttachment0.set(Je.targetColorTexture.texture),be.viewport.set([0,0,xe.width,xe.height]),be.clear({color:i.ao.transparent}),et&&(Je.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),Ce.draw(me,Se.TRIANGLES,ir.disabled,Tr.disabled,Lr.alphaBlended,br.disabled,ye,de.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(T,O,se),function(me,de,Ae,be){const Se=me.context,xe=Se.gl,ye=Ae.tileFramebuffer,Ce=me.transform.projection.name==="globe",Le=Ae.paint.get("raster-particle-max-speed");for(const ke of be){const[Je,et,ht]=ke;Se.activeTexture.set(xe.TEXTURE0+0),et.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),ye.colorAttachment0.set(ht.targetColorTexture.texture);const St=me.getOrCreateProgram("rasterParticleDraw",{defines:et.defines,overrideFog:!1});Se.activeTexture.set(xe.TEXTURE0+1);const We=et.scalarData?[]:[0,1,2,3].map(Ze=>i.e9[Ze](Je));We.push(Je);const Re=Je.canonical.x,ot=Je.canonical.y;for(const Ze of We){const gt=de.getTile(Ce?Ze.wrapped():Ze);if(!gt)continue;const Rt=gt.rasterParticleState;if(!Rt)continue;const $t=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-Je.wrap),It=Ze.canonical.y;Rt.particleTexture0.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const Et=c2(1,Rt.particleTexture0.size[0],[$t-Re,It-ot],0,et.texture.size,2,Le,et.textureOffset,et.scale,et.offset);St.draw(me,xe.POINTS,ir.disabled,Tr.disabled,Lr.alphaBlended,br.disabled,Et,Ae.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(T,P,O,se),N.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(me,de,Ae,be){const Se=me.context,xe=Se.gl,ye=de.paint.get("raster-particle-max-speed"),Ce=be*de.paint.get("raster-particle-speed-factor")*.15,Le=function(Je){return Math.pow(Je,6)}(.01+1*de.paint.get("raster-particle-reset-rate-factor")),ke=de.particleFramebuffer;Se.viewport.set([0,0,ke.width,ke.height]);for(const Je of Ae){const[,et,ht]=Je;Se.activeTexture.set(xe.TEXTURE0+0),et.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Se.activeTexture.set(xe.TEXTURE0+1);const St=ht.particleTexture0;St.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const We=Lx(1,St.size[0],0,et.texture.size,ye,Ce,Le,et.textureOffset,et.scale,et.offset);ke.colorAttachment0.set(ht.particleTexture1.texture),Se.clear({color:i.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:et.defines}).draw(me,xe.TRIANGLES,ir.disabled,Tr.disabled,Lr.unblended,br.disabled,We,de.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(T,O,se,he)}(f,o,c,p),f.renderPass==="translucent"&&(function(T,P,O,k,N){const W=T.context,H=W.gl,q=P.getSource().tileSize,ee=5*(1-i.ah(i.cL,i.cL+1,T.transform.zoom))*q+O.paint.get("raster-particle-elevation"),Y=!T.options.moving,se=T.transform.projection.name==="globe";if(!k.length)return;const[oe,he]=T.stencilConfigForOverlap(k),me=[];se&&me.push("PROJECTION_GLOBE_VIEW");const de=T.stencilModeFor3D();for(const Ae of he){const be=Ae.toUnwrapped(),Se=P.getTile(Ae);if(!Se.rasterParticleState)continue;const xe=Se.rasterParticleState,ye=100;Se.registerFadeDuration(ye);const Ce=P.findLoadedParent(Ae,0),Le=Id(Se,Ce,P,T.transform,ye);let ke,Je;T.terrain&&T.terrain.prepareDrawTile(),W.activeTexture.set(H.TEXTURE0),xe.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),W.activeTexture.set(H.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),ke=Math.pow(2,Ce.tileID.overscaledZ-Se.tileID.overscaledZ),Je=[Se.tileID.canonical.x*ke%1,Se.tileID.canonical.y*ke%1]):xe.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const et=se?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(be,Y),ht=T.transform,St=$x(ht),We=i.dG(Ae.canonical),Re=i.dH(We.getCenter().lat);let ot,Ze,gt,Rt,$t;se?(ot=Float32Array.from(i.bk(i.dJ(Ae.canonical))),Ze=Float32Array.from(ht.globeMatrix),gt=Float32Array.from(i.dF(ht)),Rt=[i.aF(ht.center.lng),i.aJ(ht.center.lat)],$t=Float32Array.from(i.dI(Ae.canonical,We,Re,ht.worldSize/ht._pixelsPerMercatorPixel))):(ot=new Float32Array(16),Ze=new Float32Array(9),gt=new Float32Array(16),Rt=[0,0],$t=new Float32Array(9));const It=l2(et,ot,Ze,gt,$t,Je||[0,0],i.aj(T.transform.zoom),Rt,St,ke||1,Le,ee),Et=T.isTileAffectedByFog(Ae),tr=T.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:Et});if(T.uploadCommonUniforms(W,tr,be),se){const Jt=new ir(H.LEQUAL,ir.ReadOnly,T.depthRangeFor3D),zt=0,Gt=T.globeSharedBuffers;if(Gt){const[dr,Or,Qr]=Gt.getGridBuffers(Re,zt!==0);tr.draw(T,H.TRIANGLES,Jt,de,Lr.alphaBlended,T.renderElevatedRasterBackface?br.frontCCW:br.backCCW,It,O.id,dr,Or,Qr)}}else{const Jt=T.depthModeForSublayer(0,ir.ReadOnly),zt=oe[Ae.overscaledZ],{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:dr,tileBoundsSegments:Or}=T.getTileBoundsBuffers(Se);tr.draw(T,H.TRIANGLES,Jt,zt,Lr.alphaBlended,br.disabled,It,O.id,Gt,dr,Or)}}T.resetStencilClippingMasks()}(f,o,c,p),f.style.map.triggerRepaint())},background:function(f,o,c,p){const v=c.paint.get("background-color"),w=c.paint.get("background-color-use-theme").constantOr("default")==="none",T=c.paint.get("background-opacity"),P=c.paint.get("background-emissive-strength"),O=c.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const k=f.context,N=k.gl,W=f.transform,H=W.tileSize,q=c.paint.get("background-pattern");let ee;if(q!==void 0&&(q===null||(ee=f.imageManager.getPattern(i.I.from(q.toString()),c.scope,f.style.getLut(c.scope)),!ee)))return;const Y=!q&&v.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const se=Tr.disabled,oe=f.depthModeForSublayer(0,Y==="opaque"?ir.ReadWrite:ir.ReadOnly),he=f.colorModeForDrapableLayerRenderPass(P),me=q?"backgroundPattern":"background";let de,Ae=p;Ae||(de=f.getBackgroundTiles(),Ae=Object.values(de).map(Se=>Se.tileID)),q&&(k.activeTexture.set(N.TEXTURE0),f.imageManager.bind(f.context,c.scope));const be=[];if(f.terrain&&f.terrain.renderingToTexture&&f.emissiveMode==="mrt-fallback"&&be.push("USE_MRT1"),O){const Se=f.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0,defines:be}),xe=new Float32Array(i.bA([])),ye=new i.aQ(0,0,0,0,0),Ce=q?Ac(xe,P,T,f,0,c.scope,ee,O,{tileID:ye,tileSize:H}):Od(xe,P,T,v.toPremultipliedRenderColor(w?null:c.lut));Se.draw(f,N.TRIANGLES,oe,se,he,br.disabled,Ce,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Se of Ae){const xe=f.isTileAffectedByFog(Se),ye=f.getOrCreateProgram(me,{overrideFog:xe,defines:be}),Ce=Se.toUnwrapped(),Le=p?Se.projMatrix:f.transform.calculateProjMatrix(Ce);f.prepareDrawTile();const ke=o?o.getTile(Se):de?de[Se.key]:new iu(Se,H,W.zoom,f),Je=q?Ac(Le,P,T,f,0,c.scope,ee,O,{tileID:Se,tileSize:H}):Od(Le,P,T,v.toPremultipliedRenderColor(w?null:c.lut));f.uploadCommonUniforms(k,ye,Ce);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:ht,tileBoundsSegments:St}=f.getTileBoundsBuffers(ke);ye.draw(f,N.TRIANGLES,oe,se,he,br.disabled,Je,c.id,et,ht,St)}},sky:function(f,o,c){const p=f._atmosphere?i.aj(f.transform.zoom):1,v=c.paint.get("sky-opacity")*p;if(v===0)return;const w=f.context,T=c.paint.get("sky-type"),P=new ir(w.gl.LEQUAL,ir.ReadOnly,[0,1]),O=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(k,N,W,H){const q=k.context,ee=q.gl;let Y=N.skyboxFbo;if(!Y){Y=N.skyboxFbo=q.createFramebuffer(32,32,1,null),N.skyboxGeometry=new zp(q),N.skyboxTexture=q.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,N.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let me=0;me<6;++me)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Y.framebuffer),q.viewport.set([0,0,32,32]);const se=N.getCenter(k,!0),oe=k.getOrCreateProgram("skyboxCapture"),he=new Float64Array(16);i.bA(he),i.en(he,he,.5*-Math.PI),yu(k,N,oe,he,se,0),i.bA(he),i.en(he,he,.5*Math.PI),yu(k,N,oe,he,se,1),i.bA(he),i.cU(he,he,.5*-Math.PI),yu(k,N,oe,he,se,2),i.bA(he),i.cU(he,he,.5*Math.PI),yu(k,N,oe,he,se,3),i.bA(he),yu(k,N,oe,he,se,4),i.bA(he),i.en(he,he,Math.PI),yu(k,N,oe,he,se,5),q.viewport.set([0,0,k.width,k.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(k,N,W,H,q){const ee=k.context,Y=ee.gl,se=k.transform,oe=k.getOrCreateProgram("skybox");ee.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,N.skyboxTexture);const he=((me,de,Ae,be,Se)=>({u_matrix:me,u_sun_direction:de,u_cubemap:0,u_opacity:be,u_temporal_offset:Se}))(se.skyboxMatrix,N.getCenter(k,!1),0,H,q);k.uploadCommonUniforms(ee,oe),oe.draw(k,Y.TRIANGLES,W,Tr.disabled,k.colorModeForRenderPass(),br.backCW,he,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(f,c,P,v,O):T==="gradient"&&f.renderPass==="sky"&&function(k,N,W,H,q){const ee=k.context,Y=ee.gl,se=k.transform,oe=k.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new zp(ee)),ee.activeTexture.set(Y.TEXTURE0);let he=N.colorRampTexture;he||(he=N.colorRampTexture=new i.T(ee,N.colorRamp,Y.RGBA8)),he.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const me=((de,Ae,be,Se,xe)=>({u_matrix:de,u_color_ramp:0,u_center_direction:Ae,u_radius:i.an(be),u_opacity:Se,u_temporal_offset:xe}))(se.skyboxMatrix,N.getCenter(k,!1),N.paint.get("sky-gradient-radius"),H,q);k.uploadCommonUniforms(ee,oe),oe.draw(k,Y.TRIANGLES,W,Tr.disabled,k.colorModeForRenderPass(),br.backCW,me,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(f,c,P,v,O)},custom:function(f,o,c,p){const v=f.context,w=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(o)){if(f.renderPass==="offscreen"){const T=w.prerender;if(T){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const P=f.transform.pointMerc;T.call(w,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.aj(f.transform.zoom),[P.x,P.y],f.transform.pixelsPerMeterRatio)}else T.call(w,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const P=w.renderToTile;if(P){const O=p[0].canonical,k={x:O.x+p[0].wrap*(w.wrapTileId?0:1<<O.z),y:O.y,z:O.z};v.setDepthMode(ir.disabled),v.setStencilMode(Tr.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),P.call(w,v.gl,k),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(Tr.disabled);const T=w.renderingMode==="3d"?new ir(f.context.gl.LEQUAL,ir.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,ir.ReadOnly);if(v.setDepthMode(T),f.transform.projection.name==="globe"){const P=f.transform.pointMerc;w.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.aj(f.transform.zoom),[P.x,P.y],f.transform.pixelsPerMeterRatio)}else w.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,o,c,p){if(f.renderPass==="opaque")return;const v=c.paint.get("model-opacity").constantOr(1),w=c.paint.get("model-elevation-reference"),T=w==="ground",P=w==="ground";if(v===0)return;const O=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!O||f.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const k=f.shadowRenderer,N=c.paint.get("model-receive-shadows");k&&(k.useNormalOffset=!0,N||(k.enabled=!1));const W=()=>{k&&(k.useNormalOffset=!0,N||(k.enabled=!0))},H=o.getSource();if(f.renderPass==="light-beam"&&H.type!=="batched-model")return;if(H.type==="vector"||H.type==="geojson")return function(de,Ae,be,Se,xe){const ye=de.transform,Ce=ye.projection.name==="globe",Le=ye.getFreeCameraOptions().position;if(!de.modelManager)return;const ke=de.modelManager;be.modelManager=ke;const Je=de.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const et=be._unevaluatedLayout._values["model-id"],ht=Object.assign({},be.layout.get("model-id").parameters),St=de.style.order.indexOf(be.fqid),We=be.paint.get("model-opacity").constantOr(1);for(const Re of Se){const ot=Ae.getTile(Re).getBucket(be);if(!ot||ot.projection.name!==ye.projection.name)continue;const Ze=ot.getModelUris();if(Ze&&!ot.modelsRequested&&(ke.addModelsFromBucket(Ze,xe),ot.modelsRequested=!0),Ce)ht.zoom=Re.overscaledZ;else{const zt=ys(Re,ye);ht.zoom=zt}const gt=et.possiblyEvaluate(ht);if(Jx(de,ot,Re),Ja.shadowUniformsInitialized=!1,Ja.useSingleShadowCascade=!!Je&&Je.getMaxCascadeForTile(Re.toUnwrapped())===0,de.renderPass==="shadow"&&Je){if(de.currentShadowCascade===1&&ot.isInsideFirstShadowMapFrustum)continue;const zt=ye.calculatePosMatrix(Re.toUnwrapped(),ye.worldSize);if(Ja.tileMatrix.set(zt),Ja.shadowTileMatrix=Float32Array.from(Je.calculateShadowPassMatrixFromMatrix(zt)),Ja.aabb.min=[0,0,0],Ja.aabb.max[0]=Ja.aabb.max[1]=i.al,Ja.aabb.max[2]=0,f2(ot,Ja,de,be.scope))continue}const Rt=1<<Re.canonical.z,$t=[((Le.x-Re.wrap)*Rt-Re.canonical.x)*i.al,(Le.y*Rt-Re.canonical.y)*i.al,Le.z*Rt*i.al];de.conflationActive&&Object.keys(ot.instancesPerModel).length>0&&de.style.isLayerClipped(be,Ae.getSource())&&ot.updateReplacement(Re,de.replacementSource,St,be.scope)&&(ot.uploaded=!1,ot.upload(de.context));let It=0;const Et=new Array,tr=new Array,Jt=new Array;for(let zt in ot.instancesPerModel){const Gt=ot.instancesPerModel[zt];Gt.features.length>0&&!Ce&&(zt=gt.evaluate(Gt.features[0].feature,{}));const dr=ke.getModel(zt,xe);if(dr||ke.hasURLBeenRequested(zt)||ot.modelUris.includes(zt)||(ot.modelUris.push(zt),ot.modelsRequested=!1),dr&&dr.uploaded)if(Ce){const Or=i.c5([],[Le.x,Le.y,Le.z],de.transform.worldSize);i.ew(Or,Or);for(let Qr=0;Qr<Gt.instancedDataArray.length;++Qr){const wn=[0,0,0],rr=[1,1,1],vn=i.ex(),Mr=Gt.tileCoordinatesForInstance(Qr),An=Gt.transformForInstance(Qr);i.ey(rr,An),i.ez(vn,An),i.eA(wn,vn);const Bn=Gt.translationForInstance(Qr),kn=new i.aT(0,0);i.eB(ot.canonical,kn,Mr.x,Mr.y);const yn=i.bC();i.eC(yn,dr,de.transform,kn,wn,rr,Bn,!0,!1,!1);const Fr=Gt.colorForInstance(Qr),Sn=i.bA([]),wi=i.ef(kn.lat,de.transform.zoom),hi=i.bq([],[1,1,1/wi]);i.br(Sn,Sn,Or),Jt.push({zScaleMatrix:hi,negCameraPosMatrix:Sn});for(const Pn of dr.nodes)_u(de,Pn,yn,de.transform.expandedFarZProjMatrix,It,Et,tr,dr.materialOverrides,We,Fr);++It}}else for(const Or of dr.nodes)Qx(de,be,Or,Gt,$t,Re,Ja)}if(Ce)if(de.renderPass==="shadow"){for(const zt of tr)Ma(zt.mesh,zt.nodeModelMatrix,de,be);for(const zt of Et)Ma(zt.mesh,zt.nodeModelMatrix,de,be)}else Yx(de,be,Et,tr,Jt)}}(f,o,c,p,Ld(f,c)),void W();if(!H.loaded())return;if(H.type==="batched-model")return function(de,Ae,be,Se){be.resetLayerRenderingStats(de);const xe=de.context,ye=de.transform,Ce=de.style.fog,Le=de.shadowRenderer;if(ye.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const ke=de.transform.getFreeCameraOptions().position,Je=i.c5([],[ke.x,ke.y,ke.z],de.transform.worldSize),et=i.ew([],Je),ht=i.bA([]),St=i.ef(ye.center.lat,ye.zoom),We=i.bq([],[1,1,1/St]);i.br(ht,ht,et);const Re=be.paint.get("model-opacity").constantOr(1),ot=new ir(xe.gl.LEQUAL,ir.ReadWrite,de.depthRangeFor3D),Ze=new ir(xe.gl.LEQUAL,ir.ReadOnly,de.depthRangeFor3D),gt=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Rt=de.renderPass==="shadow",$t=Rt&&Le?Le.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),It=be.paint.get("model-front-cutoff"),Et=It[2]<1,tr=_c(de,be.paint.get("model-cutoff-fade-range")),Jt=be.getLayerRenderingStats();(function(zt,Gt,dr,Or){const Qr=zt.terrain?zt.terrain.exaggeration():0,wn=zt.transform.zoom;for(const rr of Or){const vn=Gt.getTile(rr).getBucket(dr);vn&&(vn.setFilter(dr.filter),zt.conflationActive&&vn.updateReplacement(rr,zt.replacementSource),vn.evaluateTransform(zt,dr),zt.terrain&&Qr>0&&vn.elevationUpdate(zt.terrain,Qr,rr,dr.source),vn.needsReEvaluation(zt,wn,dr)&&vn.evaluate(dr))}})(de,Ae,be,Se),function(){let zt,Gt,dr;Et?(zt=Se.length-1,Gt=-1,dr=-1):(zt=0,Gt=Se.length,dr=1);const Or=new Float64Array(16),Qr=i.cA(),wn=new i.P(0,0);for(let rr=zt;rr!==Gt;rr+=dr){const vn=Se[rr],Mr=Ae.getTile(vn).getBucket(be);if(!Mr||!Mr.uploaded)continue;let An=!1;Le&&(An=Le.getMaxCascadeForTile(vn.toUnwrapped())===0);const Bn=ye.calculatePosMatrix(vn.toUnwrapped(),ye.worldSize),kn=Mr.modelTraits;!Rt&&Et&&(i.bl(Or,Bn),i.af(Qr,Je,Or),wn.x=Qr[0],wn.y=Qr[1]);const yn=[];Mr.setFilter(be.filter);for(const Fr of Mr.getNodesInfo()){if(Fr.hiddenByReplacement||!Fr.node.meshes)continue;const Sn=Fr.node;let wi=0;de.terrain&&Sn.elevation&&(wi=Sn.elevation*de.terrain.exaggeration());const hi=(()=>{const Ho=Fr.aabb;return gt.min=[...Ho.min],gt.max=[...Ho.max],gt.min[2]+=wi,gt.max[2]+=wi,i.af(gt.min,gt.min,Bn),i.af(gt.max,gt.max,Bn),gt})(),Pn=Fr.evaluatedScale;if(Pn[0]<=1&&Pn[1]<=1&&Pn[2]<=1&&hi.intersects($t)===0)continue;if(!Rt&&Et){const Ho=.16666666666666666;Fr.cameraCollisionOpacity=Je[0]>hi.min[0]&&Je[0]<hi.max[0]&&Je[1]>hi.min[1]&&Je[1]<hi.max[1]&&Je[2]*St<hi.max[2]&&Sn.footprint&&i.c0(wn,Sn.footprint)?Math.max(Fr.cameraCollisionOpacity-Ho,0):Math.min(1,Fr.cameraCollisionOpacity+Ho)}const fn=[...Bn],Br=1/i.d7(vn.canonical),oi=Sn.anchor?Sn.anchor[0]:0,Di=Sn.anchor?Sn.anchor[1]:0;i.br(fn,fn,[oi*(Pn[0]-1)+Fr.evaluatedTranslation[0]*Br,Di*(Pn[1]-1)+Fr.evaluatedTranslation[1]*Br,wi+Fr.evaluatedTranslation[2]]),i.cq(Pn,i.eE)||i.cS(fn,fn,Pn);const yi=i.aB([],fn,Sn.globalMatrix),qn=i.aB([],ye.expandedFarZProjMatrix,yi),_s=i.aB([],ye.expandedFarZProjMatrix,fn),zo=i.aC([],[oi,Di,wi,1],qn)[2];Sn.hidden=!1;let no=Re;Rt||(Et&&(no*=Fr.cameraCollisionOpacity,no*=Xr(fn,ye,Fr.aabb,It)),no*=ui(tr,zo)),no!==0?yn.push({nodeInfo:Fr,depth:zo,opacity:no,wvpForNode:qn,wvpForTile:_s,nodeModelMatrix:yi,tileModelMatrix:fn}):Sn.hidden=!0}Rt||yn.sort((Fr,Sn)=>!Et||Fr.opacity===1&&Sn.opacity===1?Fr.depth<Sn.depth?-1:1:Fr.opacity===1?-1:Sn.opacity===1?1:Fr.depth>Sn.depth?-1:1);for(const Fr of yn){const Sn=Fr.nodeInfo,wi=Sn.node;let hi=i.aB([],We,Fr.tileModelMatrix);i.aB(hi,ht,hi);const Pn=i.bl([],hi);i.eg(Pn,Pn),i.cS(Pn,Pn,Nd),hi=i.aB(hi,hi,wi.globalMatrix);const fn=de.renderPass==="light-beam",Br=be.paint.get("model-color-use-theme").constantOr("default")==="none",oi=kn&i.eI.HasMapboxMeshFeatures,Di=oi?0:Sn.evaluatedRMEA[0][2];for(let yi=0;yi<wi.meshes.length;++yi){const qn=wi.meshes[yi],_s=yi===wi.lightMeshIndex;let zo=Fr.wvpForNode;if(_s){if(!fn&&!de.terrain&&de.shadowRenderer){de.currentLayer<de.firstLightBeamLayer&&(de.firstLightBeamLayer=de.currentLayer);continue}zo=Fr.wvpForTile}else if(fn)continue;const no={defines:[]},Ho=[];if(!Rt&&Le&&(Le.useNormalOffset=!!qn.normalBuffer),Vp(no.defines,Ho,qn,de,Br?null:be.lut),oi||no.defines.push("DIFFUSE_SHADED"),An&&no.defines.push("SHADOWS_SINGLE_CASCADE"),Jt&&(Rt?Jt.numRenderedVerticesInShadowPass+=qn.vertexArray.length:Jt.numRenderedVerticesInTransparentPass+=qn.vertexArray.length),Rt){Ma(qn,Fr.nodeModelMatrix,de,be);continue}let Wo=null;if(Ce){const Li=Bp(Fr.nodeModelMatrix,de.transform);if(Wo=new Float32Array(Li),ye.projection.name!=="globe"){const Zn=qn.aabb.min,Vi=qn.aabb.max,[Ti,_i]=Ce.getOpacityForBounds(Li,Zn[0],Zn[1],Vi[0],Vi[1]);no.overrideFog=Ti>=dt||_i>=dt}}const Mo=qn.material;let Ks;Mo.occlusionTexture&&Mo.occlusionTexture.offsetScale&&(Ks=Mo.occlusionTexture.offsetScale,no.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const da=de.getOrCreateProgram("model",no);!Rt&&Le&&Le.setupShadowsFromMatrix(Fr.tileModelMatrix,da,Le.useNormalOffset),de.uploadCommonUniforms(xe,da,null,Wo);const Cs=Mo.pbrMetallicRoughness;Cs.metallicFactor=.9,Cs.roughnessFactor=.5;const Ci=du(new Float32Array(zo),new Float32Array(hi),new Float32Array(Pn),new Float32Array(wi.globalMatrix),de,Fr.opacity,Cs.baseColorFactor,Mo.emissiveFactor,Cs.metallicFactor,Cs.roughnessFactor,Mo,Di,be,[0,0,0],Ks);!_s&&(Sn.hasTranslucentParts||Fr.opacity<1)&&da.draw(de,xe.gl.TRIANGLES,ot,Tr.disabled,Lr.disabled,br.backCCW,Ci,be.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,be.paint,de.transform.zoom,void 0,Ho),da.draw(de,xe.gl.TRIANGLES,_s?Ze:ot,Tr.disabled,_s||Fr.opacity<1||Sn.hasTranslucentParts?Lr.alphaBlended:Lr.unblended,br.backCCW,Ci,be.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,be.paint,de.transform.zoom,void 0,Ho)}}}}()}(f,o,c,p),void W();if(H.type!=="model")return;const q=H.getModels(),ee=[],Y=f.transform.getFreeCameraOptions().position,se=i.c5([],[Y.x,Y.y,Y.z],f.transform.worldSize);i.ew(se,se);const oe=[],he=[];let me=0;for(const de of q){const Ae=o.getFeatureState("",de.id),be={type:"Unknown",id:de.id,properties:de.featureProperties},Se=c.paint.get("model-rotation").evaluate(be,Ae),xe=c.paint.get("model-scale").evaluate(be,Ae),ye=c.paint.get("model-translation").evaluate(be,Ae),Ce=c.paint.get("model-opacity").evaluate(be,Ae);Xx(c,de.id,Ae,de.featureProperties,de.nodeOverrideNames,de.nodeOverrides),Kx(c,de.id,Ae,de.featureProperties,de.materialOverrideNames,de.materialOverrides),de.nodeOverrides.size>0&&de.computeBoundsAndApplyParent(),de.computeModelMatrix(f,Se,xe,ye,P,T,!1);const Le=i.bA([]),ke=i.ef(de.position.lat,f.transform.zoom),Je=i.bq([],[1,1,1/ke]);i.br(Le,Le,se),ee.push({zScaleMatrix:Je,negCameraPosMatrix:Le});for(const et of de.nodes)_u(f,et,de.matrix,f.transform.expandedFarZProjMatrix,me,oe,he,de.materialOverrides,Ce);me++}if(oe.sort((de,Ae)=>Ae.depth-de.depth),f.renderPass!=="shadow")Yx(f,c,oe,he,ee),W();else{for(const de of he)Ma(de.mesh,de.nodeModelMatrix,f,c);for(const de of oe)Ma(de.mesh,de.nodeModelMatrix,f,c);W()}}},Hp={line:function(f,o,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const p=o.getVisibleCoordinates();for(const v of p){const w=o.getTile(v).getBucket(f);if(w&&(w.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,o,c){const p=o.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Ld(c,f)));if(p.type==="batched-model"||p.type!=="model")return;const v=p.getModels();for(const w of v)w.upload(c.context)},raster:function(f,o,c){const p=o.getSource();if(!(p instanceof Qo&&p.loaded()))return;const v=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const w=f.paint.get("raster-array-band")||p.getInitialBand(v);if(w==null)return;const T=o.getIds().map(P=>o.getTileByID(P));for(const P of T)P.updateNeeded(f.id,w)&&p.prepareTile(P,v,f.id,w)},"raster-particle":function(f,o,c){const p=o.getSource();if(!(p instanceof Qo&&p.loaded()))return;const v=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!v)return;const w=f.paint.get("raster-particle-array-band")||p.getInitialBand(v);if(w==null)return;const T=o.getIds().map(P=>o.getTileByID(P));for(const P of T)P.updateNeeded(f.id,w)&&p.prepareTile(P,v,f.id,w)}},Xs={fill:Op},Wp={fill:function(f,o,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const v=f.context.gl,w=new ir(v.LEQUAL,ir.ReadOnly,f.depthRangeFor3D),T=new Tr({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),P=f.transform.getFreeCameraOptions().position,O=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of p){const N=o.getTile(k),W=N.getBucket(c);if(!W)continue;const H=W.elevatedStructures;if(!H||H.depthSegments.segments[0].primitiveLength===0)continue;const q=Bx(k.toUnwrapped(),P),ee=f.translatePosMatrix(k.projMatrix,N,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Y=hu(ee,q,0,1,0);O.draw(f,v.TRIANGLES,w,T,Lr.disabled,br.disabled,Y,c.id,H.vertexBuffer,H.indexBuffer,H.depthSegments,c.paint,f.transform.zoom)}}};class qp{constructor(o,c,p,v,w){this.context=new fh(o,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of T)this._debugParams.enabledLayers[O]=!0;for(const O of T);this.occlusionParams=new mh,this.setup(),this.numSublayers=Ls.maxUnderzooming+Ls.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new th(this),this._wireframeDebugCache=new Cc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,P,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=w,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,c){const p=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ny(this,o));const v=this._terrain;this.transform.elevation=p?v:null,v.update(o,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){const c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,v]=c.getFovAdjustedRange(this.transform._fov);if(p>v)return void(this.transform.fogCullDistSq=null);const w=p+.78*(v-p);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new Ny(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,c){if(this.width=o*i.o.devicePixelRatio,this.height=c*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const o=this.context,c=new i.bd;c.emplaceBack(0,0),c.emplaceBack(i.al,0),c.emplaceBack(0,i.al),c.emplaceBack(i.al,i.al),this.tileExtentBuffer=o.createVertexBuffer(c,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const p=new i.bd;p.emplaceBack(0,0),p.emplaceBack(i.al,0),p.emplaceBack(0,i.al),p.emplaceBack(i.al,i.al),this.debugBuffer=o.createVertexBuffer(p,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const v=new i.bd;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const w=new i.b1;w.emplaceBack(0,0,0,0),w.emplaceBack(i.al,0,i.al,0),w.emplaceBack(0,i.al,0,i.al),w.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=o.createVertexBuffer(w,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const T=new i.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const P=new i.be;for(const k of[0,1,3,2,0])P.emplaceBack(k);this.debugIndexBuffer=o.createIndexBuffer(P),this.emptyTexture=new i.T(o,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=i.bC();const O=this.context.gl;this.stencilClearMode=new Tr({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,ir.disabled,this.stencilClearMode,Lr.disabled,br.disabled,Cd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,p){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const O of p)if(this._tileClippingMaskIDs[O.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=c.id;const v=this.context,w=v.gl;this.nextStencilID+p.length>256&&this.clearStencil(),v.setColorMode(Lr.disabled),v.setDepthMode(ir.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of p){const O=c.getTile(P),k=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:W,tileBoundsSegments:H}=this.getTileBoundsBuffers(O);T.draw(this,w.TRIANGLES,ir.disabled,new Tr({func:w.ALWAYS,mask:0},k,255,w.KEEP,w.KEEP,w.REPLACE),Lr.disabled,br.disabled,Cd(P.projMatrix),"$clipping",N,W,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new Tr({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new Tr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,p=o.sort((T,P)=>P.overscaledZ-T.overscaledZ),v=p[p.length-1].overscaledZ,w=p[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let P=0;P<w;P++)T[P+v]=new Tr({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[T,p]}return[{[v]:Tr.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Lr([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lr.unblended:Lr.alphaBlended}colorModeForDrapableLayerRenderPass(o){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Lr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Lr([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,c,p,v=!1){if(this.depthOcclusion)return new ir(this.context.gl.GREATER,ir.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return ir.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ir(p||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Fx(this.context,c,p,0,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:p,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),o.bindTexture(o.TEXTURE_2D,w),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,c,p,0,0,c,p,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,c)=>o+c/this._fpsHistory.length,0))}render(o,c){const p=i.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=c;const v=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(w).filter(We=>{const Re=v[We];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let P=T(),O=!1,k=!1,N=null,W=0,H=!1;for(const We of P){const Re=v[We];Re.visibility!=="none"&&(Re.type==="circle"?O=!0:Re.type==="building"?(N=Re,++W):Re.type==="symbol"&&(Re.hasOcclusionOpacityProperties?k=!0:O=!0))}this.updateEmissiveMode();let q=P.map(We=>v[We]);const ee=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(const We in ee){const Re=ee[We];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++W)}let Y=!1;for(const We of q)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(Y=!0),this.prepareLayer(We));const se={},oe={},he={},me={},de={};for(const We in ee){const Re=ee[We];se[We]=Re.getVisibleCoordinates(),oe[We]=se[We].slice().reverse(),he[We]=Re.getVisibleCoordinates(!0).reverse(),me[We]=Re.getShadowCasterCoordinates(),de[We]=Re.sortCoordinatesByDistance(se[We])}const Ae=We=>{const Re=this.style.getLayerSourceCache(We);return Re&&Re.used?Re.getSource():null};if(W||Y||this._clippingActiveLastFrame){const We=[],Re=[];let ot=0;for(const Ze of q)this.isSourceForClippingOrConflation(Ze,Ae(Ze))&&(We.push(Ze),Re.push(ot)),ot++;if(We&&(Y||We.length>1)||this._clippingActiveLastFrame){Y=!1;const Ze=[];for(let gt=0;gt<We.length;gt++){const Rt=We[gt],$t=Re[gt],It=this.style.getLayerSourceCache(Rt);if(!It||!It.used||!It.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let Et=i.eQ,tr=i.b_.None;const Jt=[];let zt=!0;if(Rt.type==="building")Et=i.eS;else if(Rt.type==="clip"){Et=$t;for(const Gt of Rt.layout.get("clip-layer-types"))tr|=Gt==="model"?i.b_.Model:Gt==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(const Gt of Rt.layout.get("clip-layer-scope"))Jt.push(Gt);Rt.isHidden(this.transform.zoom)?zt=!1:Y=!0}zt&&Ze.push({layer:Rt.fqid,cache:It,order:Et,clipMask:tr,clipScope:Jt})}this.replacementSource.setSources(Ze),H=!0}}this._clippingActiveLastFrame=Y,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<q.length;We++){const Re=q[We];if(Re.visibility==="none")continue;const ot=Re.cutoffRange();if(this.longestCutoffRange=Math.max(ot,this.longestCutoffRange),ot>0){const Ze=Ae(Re);Ze&&(this.minCutoffZoom=Math.max(Ze.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(he),this.opaquePassCutoff=0,P=T(),q=P.map(We=>v[We]));const Se=this._shadowRenderer;if(Se){Se.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in ee)for(const Re of se[We]){let ot={min:0,max:0};this.terrain&&(ot=this.terrain.getMinMaxForTile(Re)||ot),Se.addShadowReceiver(Re.toUnwrapped(),ot.min,ot.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zx(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new Qy(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new Gp(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),N){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Fp);const We=this.style.getLayerSourceCache(N);this.buildingTileBorderManager.updateBorders(We,N)}if(!Un.has(this.context.gl))return;this.renderPass="offscreen";for(const We of q){const Re=o.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const ot=Re?oe[Re.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||ot&&ot.length)&&this.renderLayer(this,Re,We,ot)}this.depthRangeFor3D=[0,1-(q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Le=(()=>{if(c.showOverdrawInspector)return i.ao.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const Re=this.style.getLut(We.scope);if(!Ce){const ot=We.properties.get("color-use-theme")==="none",Ze=We.properties.get("color").toNonPremultipliedRenderColor(ot?null:Re).toArray01();return new i.ao(...Ze)}if(Ce){const ot=We.properties.get("space-color-use-theme")==="none",Ze=We.properties.get("space-color").toNonPremultipliedRenderColor(ot?null:Re).toArray01();return new i.ao(...Ze)}}return i.ao.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const We=q[this.currentLayer],Re=o.getLayerSourceCache(We);if(We.isSky())continue;const ot=Re?(We.is3D(w)?de:oe)[Re.id]:void 0;this._renderTileClippingMasks(We,Re,ot),this.renderLayer(this,Re,We,ot)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const We=q[this.currentLayer],Re=o.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,Re,We,Re?oe[Re.id]:void 0)}function ke(We,Re){let ot;return Re&&(ot=(We.type==="symbol"?he:We.is3D(w)?de:oe)[Re.id]),ot}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const We=q[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const Re=o.getLayerSourceCache(We);this.renderLayer(this,Re,We,ke(We,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Je=0;Se&&(Je=Se.getShadowCastingLayerCount());let et=!1,ht=-1;for(let We=0;We<P.length;++We){const Re=q[We];Re.isHidden(this.transform.zoom)||Re.is3D(w)&&(ht=We)}k&&ht===-1&&(O=!0);let St=!1;for(;this.currentLayer<P.length;){const We=q[this.currentLayer],Re=o.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!St&&We.is3D(w)&&!w){const ot=this.currentLayer,Ze=gt=>{for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Rt=q[this.currentLayer];if(Xs[Rt.type]){const $t=this.style.getLayerSourceCache(Rt);Xs[Rt.type](this,$t,Rt,ke(Rt,$t),gt)}}};Ze("initialize"),Ze("reset"),this.currentLayer=ot,St=!0}if(O&&!et&&this.terrain&&!this.transform.isOrthographic&&(et=!0,this.blitDepth()),k&&ht!==-1&&this.currentLayer===ht+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(We,Re,Re?se[Re.id]:void 0),this.renderLayer(this,Re,We,ke(We,Re)),!this.terrain&&Se&&Je>0&&We.hasShadowPass()&&--Je==0){{this.clearStencil(),this.resetStencilClippingMasks();const ot=this.currentLayer;for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Ze=q[this.currentLayer];if(Wp[Ze.type]){const gt=this.style.getLayerSourceCache(Ze);Wp[Ze.type](this,gt,Ze,ke(Ze,gt))}}this.currentLayer=ot}if(Se.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ot=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ot;this.currentLayer++){const Ze=q[this.currentLayer];if(!Ze.hasLightBeamPass())continue;const gt=o.getLayerSourceCache(Ze);this.renderLayer(this,gt,Ze,gt?oe[gt.id]:void 0)}this.currentLayer=ot,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ot=this.currentLayer;this.depthOcclusion=!0;for(const Ze of this.layersWithOcclusionOpacity){this.currentLayer=Ze;const gt=q[this.currentLayer],Rt=o.getLayerSourceCache(gt),$t=Rt?oe[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(gt,Rt,Rt?se[Rt.id]:void 0),this.renderLayer(this,Rt,gt,$t)}this.depthOcclusion=!1,this.currentLayer=ot,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;q.forEach(Re=>{const ot=o.getLayerSourceCache(Re);ot&&!Re.isHidden(this.transform.zoom)&&ot.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<ot.getSource().maxzoom)&&(We=ot)}),We&&this.options.showTileBoundaries&&Ct(this,We,We.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ct(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(We){const Re=We.transform.padding;gu(We,We.transform.height-(Re.top||0),3,Ux),gu(We,Re.bottom||0,3,Gx),Pi(We,Re.left||0,3,Hx),Pi(We,We.transform.width-(Re.right||0),3,pu);const ot=We.transform.centerPoint;(function(Ze,gt,Rt,$t){Ve(Ze,gt-1,Rt-10,2,20,$t),Ve(Ze,gt-10,Rt-1,20,2,$t)})(We,ot.x,We.transform.height-ot.y,mu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(o.type);if(Hp[o.type]&&(p||this.terrain&&o.type==="custom")){const v=this.style.getLayerSourceCache(o);Hp[o.type](o,v,this)}this.gpuTimingEnd()}renderLayer(o,c,p,v){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||v&&v.length)&&(this.id=p.id,this.gpuTimingStart(p),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(p.type)&&(!o.terrain||p.type!=="custom")||p.type==="clip"||Ic[p.type](o,c,p,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:p.createQuery()}),v.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(o.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const c={};for(const p in o){const v=o[p],w=this.context.extTimerQuery,T=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),c[p]=T}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const v of o)p+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return p}translatePosMatrix(o,c,p,v,w){if(!p[0]&&!p[1])return o;const T=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const k=Math.sin(T),N=Math.cos(T);p=[p[0]*N-p[1]*k,p[0]*k+p[1]*N]}const P=[w?p[0]:i.ay(c,p[0],this.transform.zoom),w?p[1]:i.ay(c,p[1],this.transform.zoom),0],O=new Float32Array(16);return i.br(O,o,P),O}saveTileTexture(o){if(o.context!==this.context)return;const c=o.size[0],p=this._tileTextures[c];p?p.push(o):this._tileTextures[c]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,c,p){const v=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,w=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(o,c){this.cache=this.cache||{};const p=c&&c.defines||[],v=c&&c.config,w=this.currentGlobalDefines(o,c&&c.overrideFog,c&&c.overrideRtt).concat(p),T=Px.cacheKey(Sy[o],o,w,v);return this.cache[T]||(this.cache[T]=new Px(this.context,o,Sy[o],v,Mp[o],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,v=this.style.ambientLight;if(p&&v){const w=((T,P,O)=>{const k=T.properties.get("direction"),N=T.properties.get("color-use-theme")==="none",W=T.properties.get("color").toNonPremultipliedRenderColor(N?null:O.getLut(T.scope)).toArray01(),H=T.properties.get("intensity"),q=P.properties.get("color-use-theme")==="none",ee=P.properties.get("color").toNonPremultipliedRenderColor(q?null:O.getLut(P.scope)).toArray01(),Y=P.properties.get("intensity"),se=[k.x,k.y,k.z],oe=i.dN(ee,Y),he=i.dN(W,H);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:se,u_lighting_directional_color:he,u_ground_radiance:uh(se,he,oe)}})(p,v,this.style);c.setLightsUniformValues(o,w)}}}uploadCommonUniforms(o,c,p,v,w){if(this.uploadCommonLightUniforms(o,c),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const P=T.getOpacity(this.transform.pitch),O=((k,N,W,H,q,ee,Y,se,oe,he,me,de)=>{const Ae=k.transform,be=N.properties.get("color-use-theme")==="none",Se=N.properties.get("color").toNonPremultipliedRenderColor(be?null:k.style.getLut(N.scope)).toArray01();Se[3]=H;const xe=k.frameCounter/1e3%1,[ye,Ce]=N.properties.get("vertical-range");return{u_fog_matrix:W?Ae.calculateFogTileMatrix(W):de||k.identityMat,u_fog_range:N.getFovAdjustedRange(Ae._fov),u_fog_color:Se,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,Ce),Ce],u_fog_temporal_offset:xe,u_frustum_tl:q,u_frustum_tr:ee,u_frustum_br:Y,u_frustum_bl:se,u_globe_pos:oe,u_globe_radius:he,u_viewport:me,u_globe_transition:i.aj(Ae.zoom),u_is_globe:+(Ae.projection.name==="globe")}})(this,T,p,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],v);c.setFogUniformValues(o,O)}w&&c.setCutoffUniformValues(o,w.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const v of p)c[v.key]=o[v.key]||new iu(v,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,c){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[o.key];return c||(this._cachedTileFogOpacities[o.key]=c=this.style.fog.getOpacityForTile(o)),c[0]>=dt||c[1]>=dt}setupDepthForOcclusion(o,c,p){const v=this.context,w=v.gl,T=!!p;var P;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),T||c.setTerrainUniformValues(v,p)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Zp(f,o){let c=!1,p=null;const v=()=>{p=null,c&&(f(),p=setTimeout(v,o),c=!1)};return()=>(c=!0,p||v(),p)}class e_{constructor(o){this._hashName=o&&encodeURIComponent(o),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zp(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const c=to(o);if(this._hashName){const p=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(T=>{const P=T.split("=")[0];return P===p?(v=!0,`${P}=${c}`):T}).filter(T=>T);return v||w.push(`${p}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function to(f,o){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,v=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),T=Math.round(c.lng*w)/w,P=Math.round(c.lat*w)/w,O=f.getBearing(),k=f.getPitch();let N=o?`/${T}/${P}/${p}`:`${p}/${P}/${T}`;return(O||k)&&(N+="/"+Math.round(10*O)/10),k&&(N+=`/${Math.round(k)}`),N}const yh={linearity:.3,easing:i.eT(0,0,.3,1)},t_=Object.assign({deceleration:2500,maxSpeed:1400},yh),r_=Object.assign({deceleration:20,maxSpeed:1400},yh),xu=Object.assign({deceleration:1e3,maxSpeed:360},yh),n_=Object.assign({deceleration:1e3,maxSpeed:90},yh);class i_{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=i.o.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const w=Qa(c.pan.mag(),p,Object.assign({},t_,o||{}));v.offset=c.pan.mult(w.amount/c.pan.mag()),v.center=this._map.transform.center,_h(v,w)}if(c.zoom){const w=Qa(c.zoom,p,r_);v.zoom=this._map.transform.zoom+w.amount,_h(v,w)}if(c.bearing){const w=Qa(c.bearing,p,xu);v.bearing=this._map.transform.bearing+i.aA(w.amount,-179,179),_h(v,w)}if(c.pitch){const w=Qa(c.pitch,p,n_);v.pitch=this._map.transform.pitch+w.amount,_h(v,w)}if(v.zoom||v.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function _h(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function Qa(f,o,c){const{maxSpeed:p,linearity:v,deceleration:w}=c,T=i.aA(f*v/(o/1e3),-p,p),P=Math.abs(T)/(w*v);return{easing:c.easing,duration:1e3*P,amount:T*(P/2)}}class Ps extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,p,v={}){const w=Pe(c.getCanvasContainer(),p),T=c.unproject(w);super(o,Object.assign({point:w,lngLat:T,originalEvent:p},v)),this._defaultPrevented=!1,this.target=c}}class Mc extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,p){const v=o==="touchend"?p.changedTouches:p.touches,w=Fe(c.getCanvasContainer(),v),T=w.map(O=>c.unproject(O)),P=w.reduce((O,k,N,W)=>O.add(k.div(W.length)),new i.P(0,0));super(o,{points:w,point:P,lngLats:T,lngLat:c.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class o_ extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Xp{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new o_(this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new Ps(o.type,this._map,o))}mouseup(o){this._map.fire(new Ps(o.type,this._map,o))}preclick(o){const c=new MouseEvent("preclick",o);this._map.fire(new Ps(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Ps(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Ps(o.type,this._map,o))}mouseover(o){this._map.fire(new Ps(o.type,this._map,o))}mouseout(o){this._map.fire(new Ps(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Mc(o.type,this._map,o))}touchmove(o){this._map.fire(new Mc(o.type,this._map,o))}touchend(o){this._map.fire(new Mc(o.type,this._map,o))}touchcancel(o){this._map.fire(new Mc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class s_{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Ps(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ps("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Ps(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kp{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(ie(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const p=c,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(p)||!this._box&&p.dist(v)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(v.x,p.x),P=Math.max(v.x,p.x),O=Math.min(v.y,p.y),k=Math.max(v.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${O}px)`,this._box.style.width=P-T+"px",this._box.style.height=k-O+"px")})}mouseupWindow(o,c){if(!this._active)return;const p=this._startPos,v=c;if(p&&o.button===0){if(this.reset(),pe(),p.x!==v.x||p.y!==v.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(p,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new i.z(o,{originalEvent:c}))}}function Yp(f,o){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=o[p];return c}class tb{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(v){const w=new i.P(0,0);for(const T of v)w._add(T);return w.div(v.length)}(c),this.touches=Yp(p,c)))}touchmove(o,c,p){if(this.aborted||!this.centroid)return;const v=Yp(p,c);for(const w in this.touches){const T=v[w];(!T||T.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(o,c,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Jp{constructor(o){this.singleTap=new tb(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,p){this.singleTap.touchstart(o,c,p)}touchmove(o,c,p){this.singleTap.touchmove(o,c,p)}touchend(o,c,p){const v=this.singleTap.touchend(o,c,p);if(v){const w=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(w&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class rb{constructor(){this._zoomIn=new Jp({numTouches:1,numTaps:2}),this._zoomOut=new Jp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,p){this._zoomIn.touchstart(o,c,p),this._zoomOut.touchstart(o,c,p)}touchmove(o,c,p){this._zoomIn.touchmove(o,c,p),this._zoomOut.touchmove(o,c,p)}touchend(o,c,p){const v=this._zoomIn.touchend(o,c,p),w=this._zoomOut.touchend(o,c,p);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const nb={0:1,2:2},a_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qp{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const p=tt(o);this._correctButton(o,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(o,c){const p=this._lastPoint;if(p){if(o.preventDefault(),this._eventButton!=null&&function(v,w){const T=nb[w];return v.buttons===void 0||(v.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(o){this._lastPoint&&tt(o)===this._eventButton&&(this._moved&&pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ib extends Qp{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class l_ extends Qp{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?a_[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){const p=.8*(c.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class c_ extends Qp{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?a_[o.pitchRotateKey]:void 0}_correctButton(o,c){return this._pitchRotateKey?c===0&&o[this._pitchRotateKey]:c===0&&o.ctrlKey||c===2}_move(o,c){const p=-.5*(c.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class ob{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(o,c,p){return this._calculateTransform(o,c,p)}touchmove(o,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,p)}}touchend(o,c,p){this._calculateTransform(o,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,p){p.length>0&&(this._active=!0);const v=Yp(p,c),w=new i.P(0,0),T=new i.P(0,0);let P=0;for(const k in v){const N=v[k],W=this._touches[k];W&&(w._add(N),T._add(N.sub(W)),P++,v[k]=N)}if(this._touches=v,P<this._minTouches||!T.mag())return;const O=T.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class em{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,p){return{}}touchstart(o,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,p){const v=this._firstTwoTouches;if(!v)return;o.preventDefault();const[w,T]=v,P=zd(p,c,w),O=zd(p,c,T);if(!P||!O)return;const k=this._aroundCenter?null:P.add(O).div(2);return this._move([P,O],k,o)}touchend(o,c,p){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,T=zd(p,c,v),P=zd(p,c,w);T&&P||(this._active&&pe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zd(f,o,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return o[p]}function sb(f,o){return Math.log2(f/o)}class p2 extends em{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(sb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sb(this._distance,p),pinchAround:c}}}function ab(f,o){return 180*f.angleWith(o)/Math.PI}class gi extends em{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const p=this._vector;if(this._vector=o[0].sub(o[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ab(this._vector,p),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const v=ab(o,p);return Math.abs(v)<c}}function tm(f){return Math.abs(f.y)>Math.abs(f.x)}class m2 extends em{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,tm(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,p){const v=this._lastPoints;if(!v)return;const w=o[0].sub(v[0]),T=o[1].sub(v[1]);return this._map._cooperativeGestures&&!i.eU()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(o,c,p){if(this._valid!==void 0)return this._valid;const v=o.mag()>=2,w=c.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=o.y>0==c.y>0;return tm(o)&&tm(c)&&T}}const g2={panStep:100,bearingStep:15,pitchStep:10};class y2{constructor(){const o=g2;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,p=0,v=0,w=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,v=0),{cameraAnimation:P=>{const O=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Fd,zoom:c?Math.round(O)+c*(o.shiftKey?2:1):O,bearing:P.getBearing()+p*this._bearingStep,pitch:P.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:P.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fd(f){return f*(2-f)}const u_=4.000244140625,h_=1/450;class rm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=h_,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=i.o.now(),v=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%u_==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Pe(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>u_?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&N!==0&&(N=1/N);const W=c(),H=Math.pow(2,W),q=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(q*N))),this._type==="wheel"&&(this._startZoom=W,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,w=this._easing;let T,P=!1;if(this._type==="wheel"&&v&&w){const k=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),N=w(k);T=i.ak(v,p,N),k<1?this._frameId||(this._frameId=!0):P=!0}else T=p,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=T-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=i.eV;if(this._prevEase){const p=this._prevEase,v=(i.o.now()-p.start)/p.duration,w=p.easing(v+.01)-p.easing(v),T=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-T*T);c=i.eT(T,P,.25,1)}return this._prevEase={start:i.o.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Rl{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro{constructor(){this._tap=new Jp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,c,p))}touchmove(o,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const v=c[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,c,p)}touchend(o,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,c,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class el{constructor(o,c,p){this._el=o,this._mousePan=c,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bd{constructor(o,c,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class im{constructor(o,c,p,v){this._el=o,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vd=f=>f.zoom||f.drag||f.pitch||f.rotate;class _2 extends i.z{}class $d{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const p=i.av([],c,o);this.radius=i.ag(p[2]<0?i.eX([],p,this.constants):[p[0],p[1],0])}projectRay(o){i.eX(o,o,this.constants),i.aw(o,o),i.eY(o,o,this.constants);const c=i.c5([],o,this.radius);if(c[2]>0){const p=i.c5([],[0,0,1],i.bJ(c,[0,0,1])),v=i.c5([],i.aw([],[c[0],c[1],0]),this.radius),w=i.d8([],c,i.c5([],i.av([],i.d8([],v,p),c),2));c[0]=w[0],c[1]=w[1]}return c}}function om(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class v2{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new i_(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $d,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,T]of this._listeners){const P=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,P,T)}}destroy(){for(const[o,c,p]of this._listeners){const v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(c,v,p)}}_addDefaultHandlers(o){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Xp(c,o));const v=c.boxZoom=new Kp(c,o);this._add("boxZoom",v);const w=new rb,T=new nm;c.doubleClickZoom=new Rl(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const P=new ro;this._add("tapDragZoom",P);const O=c.touchPitch=new m2(c);this._add("touchPitch",O);const k=new l_(o),N=new c_(o);c.dragRotate=new Bd(o,k,N),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const W=new ib(o),H=new ob(c,o);c.dragPan=new el(p,W,H),this._add("mousePan",W),this._add("touchPan",H,["touchZoom","touchRotate"]);const q=new gi,ee=new p2;c.touchZoomRotate=new im(p,ee,q,P),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new s_(c));const Y=c.scrollZoom=new rm(c,this);this._add("scrollZoom",Y,["mousePan"]);const se=c.keyboard=new y2;this._add("keyboard",se);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[oe]&&c[oe].enable(o[oe])}_add(o,c,p){this._handlers.push({handlerName:o,handler:c,allowed:p}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,p){for(const v in o)if(v!==p&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const p of o)this._el.contains(p.target)&&c.push(p);return c}handleEvent(o,c){this._updatingCamera=!0;const p=o.type==="renderFrame",v=p?void 0:o,w={needsRenderFrame:!1},T={},P={},O=o.touches?this._getMapTouches(o.touches):void 0,k=O?Fe(this._el,O):p?void 0:Pe(this._el,o);for(const{handlerName:H,handler:q,allowed:ee}of this._handlers){if(!q.isEnabled())continue;let Y;this._blockedByActive(P,ee,H)?q.reset():q[c||o.type]&&(Y=q[c||o.type](o,k,O),this.mergeHandlerResult(w,T,Y,H,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||q.isActive())&&(P[H]=q)}const N={};for(const H in this._previousActiveHandlers)P[H]||(N[H]=v);this._previousActiveHandlers=P,(Object.keys(N).length||om(w))&&(this._changes.push([w,T,N]),this._triggerRenderFrame()),(Object.keys(P).length||om(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=w;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(o,c,p,v,w){if(!p)return;Object.assign(o,p);const T={handlerName:v,originalEvent:p.originalEvent||w};p.zoomDelta!==void 0&&(c.zoom=T),p.panDelta!==void 0&&(c.drag=T),p.pitchDelta!==void 0&&(c.pitch=T),p.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const o={},c={},p={};for(const[v,w,T]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),Object.assign(c,w),Object.assign(p,T);this._updateMapTransform(o,c,p),this._changes=[]}_updateMapTransform(o,c,p){const v=this._map,w=v.transform,T=he=>[he.x,he.y,he.z];if((he=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!om(o)){const he=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),he!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!om(o))return void this._fireEvents(c,p,!0);let{panDelta:P,zoomDelta:O,bearingDelta:k,pitchDelta:N,around:W,aroundCoord:H,pinchAround:q}=o;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),q!==void 0&&(W=q),(O||(he=>c[he]&&!this._eventsInProgress[he])("drag"))&&W&&(this._dragOrigin=T(w.pointCoordinate3D(W)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),W=W||v.transform.centerPoint,k&&(w.bearing+=k),N&&(w.pitch+=N),w._updateCameraState();const ee=[0,0,0];if(P)if(w.projection.name==="mercator"){const he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(W).dir),me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(W.sub(P)).dir);ee[0]=me[0]-he[0],ee[1]=me[1]-he[1]}else{const he=w.pointCoordinate(W);if(w.projection.name==="globe"){P=P.rotate(-w.angle);const me=w._pixelsPerMercatorPixel/w.worldSize;ee[0]=-P.x*i.eW(i.a$(he.y))*me,ee[1]=-P.y*i.eW(w.center.lat)*me}else{const me=w.pointCoordinate(W.sub(P));he&&me&&(ee[0]=me.x-he.x,ee[1]=me.y-he.y)}}const Y=w.zoom,se=[0,0,0];if(O){const he=T(H||w.pointCoordinate3D(W)),me={dir:i.aw([],i.av([],he,w._camera.position))};if(me.dir[2]<0){const de=w.zoomDeltaToMovement(he,O);i.c5(se,me.dir,de)}}const oe=i.d8(ee,ee,se);w._translateCameraConstrained(oe),O&&Math.abs(w.zoom-Y)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,p,!0)}_fireEvents(o,c,p){const v=Vd(this._eventsInProgress),w=Vd(o),T={};for(const N in o){const{originalEvent:W}=o[N];this._eventsInProgress[N]||(T[`${N}start`]=W),this._eventsInProgress[N]=o[N]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const N in T)this._fireEvent(N,T[N]);w&&this._fireEvent("move",w.originalEvent);for(const N in o){const{originalEvent:W}=o[N];this._fireEvent(N,W)}const P={};let O;for(const N in this._eventsInProgress){const{handlerName:W,originalEvent:H}=this._eventsInProgress[N];this._handlersById[W].isActive()||(delete this._eventsInProgress[N],O=c[W]||H,P[`${N}end`]=O)}for(const N in P)this._fireEvent(N,P[N]);const k=Vd(this._eventsInProgress);if(p&&(v||w)&&!k){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;N?(W(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:O})):(this._map.fire(new i.z("moveend",{originalEvent:O})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new i.z(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new _2("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const sm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class d_ extends i.E{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,p){return o=i.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},c),p)}panTo(o,c,p){return this.easeTo(Object.assign({center:o},c),p)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,p){return this.easeTo(Object.assign({zoom:o},c),p)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,p){return this.easeTo(Object.assign({bearing:o},c),p)}resetNorth(o,c){return this.rotateTo(0,Object.assign({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=i.aI.convert(o);const p=c&&c.bearing||0,v=c&&c.pitch||0,w=o.getNorthWest(),T=o.getSouthEast();return this._cameraForBounds(this.transform,w,T,p,v,c)}_extendPadding(o){const c={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},c,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},c,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,c){const p=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return p/v>o.aspect?p/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,p,v,w,T){const P=o.clone(),O=this._extendCameraOptions(T);P.bearing=v,P.pitch=w;const k=i.aT.convert(c),N=i.aT.convert(p),W=.5*(k.lat+N.lat),H=.5*(k.lng+N.lng),q=i.eZ(W,H),ee=i.aw([],q),Y=i.aw([],i.bI([],ee,[0,1,0])),se=i.bI([],Y,ee),oe=[Y[0],Y[1],Y[2],0,se[0],se[1],se[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],he=[q,i.eZ(k.lat,k.lng),i.eZ(N.lat,k.lng),i.eZ(N.lat,N.lng),i.eZ(k.lat,N.lng),i.eZ(W,k.lng),i.eZ(W,N.lng),i.eZ(k.lat,H),i.eZ(N.lat,H)];let me=i.d9.fromPoints(he.map(Ze=>[i.bJ(Y,Ze),i.bJ(se,Ze),i.bJ(ee,Ze)]));const de=i.af([],me.center,oe);i.e_(de)===0&&i.e$(de,0,0,1),i.aw(de,de),i.c5(de,de,i.aD),P.center=i.f0(de);const Ae=P.getWorldToCameraMatrix(),be=i.bl(new Float64Array(16),Ae);me=i.d9.applyTransform(me,i.aB([],Ae,oe));const Se=this._extendAABB(me,P,O,v);if(!Se)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Se,i.af(de,de,Ae);const xe=.5*(me.max[2]-me.min[2]),ye=this._minimumAABBFrustumDistance(P,me),Ce=i.c5([],[0,0,1],xe),Le=i.d8(Ce,de,Ce),ke=ye+(P.pitch===0?0:i.bG(de,Le)),Je=P.globeCenterInViewSpace,et=i.av([],de,[Je[0],Je[1],Je[2]]);i.aw(et,et),i.c5(et,et,ke);const ht=i.d8([],de,et);i.af(ht,ht,be);const St=i.eM/i.aD,We=i.ag(ht),Re=i.cf(Math.max(We*St-i.eM,Number.EPSILON),0),ot=Math.min(P.zoomFromMercatorZAdjusted(Re),O.maxZoom);return ot>.5*(i.c_+i.cL)?(P.setProjection({name:"mercator"}),P.zoom=ot,this._cameraForBounds(P,c,p,v,w,T)):{center:P.center,zoom:ot,bearing:v,pitch:w}}_extendAABB(o,c,p,v){const w=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),P=T,O=w,k=w,N=T,W=c.width-(O+k),H=c.height-(P+N),q=i.av([],o.max,o.min),ee=Math.min(W/q[0],H/q[1]),Y=Math.min(c.scaleZoom(c.scale*ee),p.maxZoom);if(isNaN(Y))return null;const se=c.scale/c.zoomScale(Y),oe=new i.d9([o.min[0]-O*se,o.min[1]-N*se,o.min[2]],[o.max[0]+k*se,o.max[1]+P*se,o.max[2]]),he=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.an(v));return oe.center[0]-=he.x*se,oe.center[1]+=he.y*se,oe}queryTerrainElevation(o,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(i.ae.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,p,v,w,T){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,p,v,w,T);const P=o.clone(),O=this._extendCameraOptions(T);P.bearing=v,P.pitch=w;const k=i.aT.convert(c),N=i.aT.convert(p),W=new i.aT(k.lng,N.lat),H=new i.aT(N.lng,k.lat),q=P.project(k),ee=P.project(N),Y=this.queryTerrainElevation(k),se=this.queryTerrainElevation(N),oe=this.queryTerrainElevation(W),he=this.queryTerrainElevation(H),me=[[q.x,q.y,Math.min(Y||0,se||0,oe||0,he||0)],[ee.x,ee.y,Math.max(Y||0,se||0,oe||0,he||0)]];let de=i.d9.fromPoints(me);const Ae=P.getWorldToCameraMatrix(),be=i.bl(new Float64Array(16),Ae);de=i.d9.applyTransform(de,Ae);const Se=this._extendAABB(de,P,O,v);if(!Se)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=Se;const xe=.5*i.av([],de.max,de.min)[2],ye=this._minimumAABBFrustumDistance(P,de),Ce=[0,0,1,0];i.aC(Ce,Ce,Ae),i.f1(Ce,Ce);const Le=i.c5([],Ce,ye+xe),ke=i.d8([],de.center,Le);i.af(de.center,de.center,be),i.af(ke,ke,be);const Je=P.unproject(new i.P(de.center[0],de.center[1])),et=i.f2(P.projection,Je),ht=Math.pow(2,et),St=Math.min(P._zoomFromMercatorZ(ke[2]*P.pixelsPerMeter*ht/P.worldSize),O.maxZoom);return P.mercatorFromTransition&&St<.5*(i.c_+i.cL)?(P.setProjection({name:"globe"}),P.zoom=St,this._cameraForBounds(P,c,p,v,w,T)):{center:Je,zoom:St,bearing:v,pitch:w}}fitBounds(o,c,p){const v=this.cameraForBounds(o,c);return this._fitInternal(v,c,p)}fitScreenCoordinates(o,c,p,v,w){const T=i.P.convert(o),P=i.P.convert(c),O=new i.P(Math.min(T.x,P.x),Math.min(T.y,P.y)),k=new i.P(Math.max(T.x,P.x),Math.max(T.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,P))return this;const N=this.transform.pointLocation3D(O),W=this.transform.pointLocation3D(k),H=this.transform.pointLocation3D(new i.P(O.x,k.y)),q=this.transform.pointLocation3D(new i.P(k.x,O.y)),ee=[Math.min(N.lng,W.lng,H.lng,q.lng),Math.min(N.lat,W.lat,H.lat,q.lat)],Y=[Math.max(N.lng,W.lng,H.lng,q.lng),Math.max(N.lat,W.lat,H.lat,q.lat)],se=v&&v.pitch?v.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,ee,Y,p,se,v);return this._fitInternal(oe,v,w)}_fitInternal(o,c,p){return o?(c=Object.assign(o,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(o,c){this.stop();const p=o.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,T=!1;"zoom"in o&&p.zoom!==+o.zoom&&(v=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=i.aT.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(w=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(T=!0,p.pitch=+o.pitch);const P=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!p.isPaddingEqual(P))if(o.retainPadding===!1){const O=p.clone();O.padding=P,p.setLocationAtPoint(p.center,O.centerPoint)}else p.padding=P;return o.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),v&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),w&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),T&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(sm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(sm),this;this.stop();const v=p.zoom,w=p.pitch,T=p.bearing;p.setFreeCameraOptions(o);const P=v!==p.zoom,O=w!==p.pitch,k=T!==p.bearing;return this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),P&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),k&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),O&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:i.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const p=this.transform,v=this.getZoom(),w=this.getBearing(),T=this.getPitch(),P=this.getPadding(),O="zoom"in o?+o.zoom:v,k="bearing"in o?this._normalizeBearing(o.bearing,w):w,N="pitch"in o?+o.pitch:T,W=this._extendPadding(o.padding),H=i.P.convert(o.offset);let q,ee,Y;if(p.projection.name==="globe"){const Ce=i.ae.fromLngLat(p.center),Le=H.rotate(-p.angle);Ce.x+=Le.x/p.worldSize,Ce.y+=Le.y/p.worldSize;const ke=Ce.toLngLat(),Je=i.aT.convert(o.center||ke);this._normalizeCenter(Je),q=p.centerPoint.add(Le),ee=new i.P(Ce.x,Ce.y).mult(p.worldSize),Y=new i.P(i.aF(Je.lng),i.aJ(Je.lat)).mult(p.worldSize).sub(ee)}else{q=p.centerPoint.add(H);const Ce=p.pointLocation(q),Le=i.aT.convert(o.center||Ce);this._normalizeCenter(Le),ee=p.project(Ce),Y=p.project(Le).sub(ee)}const se=p.zoomScale(O-v);let oe,he;o.around&&(oe=i.aT.convert(o.around),he=p.locationPoint(oe));const me=this._zooming||O!==v,de=this._rotating||w!==k,Ae=this._pitching||N!==T,be=!p.isPaddingEqual(W),Se=o.retainPadding===!1?p.clone():p,xe=Ce=>Le=>{if(me&&(Ce.zoom=i.ak(v,O,Le)),de&&(Ce.bearing=i.ak(w,k,Le)),Ae&&(Ce.pitch=i.ak(T,N,Le)),be&&(Se.interpolatePadding(P,W,Le),q=Se.centerPoint.add(H)),oe)Ce.setLocationAtPoint(oe,he);else{const ke=Ce.zoomScale(Ce.zoom-v),Je=O>v?Math.min(2,se):Math.max(.5,se),et=Math.pow(Je,1-Le),ht=Ce.unproject(ee.add(Y.mult(Le*et)).mult(ke));Ce.setLocationAtPoint(Ce.renderWorldCopies?ht.wrap():ht,q)}return o.preloadOnly||this._fireMoveEvents(c),Ce};if(o.preloadOnly){const Ce=this._emulate(xe,o.duration,p);return this._preloadTiles(Ce),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=de,this._pitching=Ae,this._padding=be,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,ye),this._ease(xe(p),Ce=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Ce)},o),this}_prepareEase(o,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new i.z("movestart",o)),this._zooming&&!p.zooming&&this.fire(new i.z("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new i.z("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new i.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new i.z("move",o)),this._zooming&&this.fire(new i.z("zoom",o)),this._rotating&&this.fire(new i.z("rotate",o)),this._pitching&&this.fire(new i.z("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.z("zoomend",o)),v&&this.fire(new i.z("rotateend",o)),w&&this.fire(new i.z("pitchend",o)),this.fire(new i.z("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){const Ze=i.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,c)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},o);const p=this.transform,v=this.getZoom(),w=this.getBearing(),T=this.getPitch(),P=this.getPadding(),O="zoom"in o?i.aA(+o.zoom,p.minZoom,p.maxZoom):v,k="bearing"in o?this._normalizeBearing(o.bearing,w):w,N="pitch"in o?+o.pitch:T,W=this._extendPadding(o.padding),H=p.zoomScale(O-v),q=i.P.convert(o.offset);let ee=p.centerPoint.add(q);const Y=p.pointLocation(ee),se=i.aT.convert(o.center||Y);this._normalizeCenter(se);const oe=p.project(Y),he=p.project(se).sub(oe);let me=o.curve;const de=Math.max(p.width,p.height),Ae=de/H,be=he.mag();if("minZoom"in o){const Ze=i.aA(Math.min(o.minZoom,v,O),p.minZoom,p.maxZoom),gt=de/p.zoomScale(Ze-v);me=Math.sqrt(gt/be*2)}const Se=me*me;function xe(Ze){const gt=(Ae*Ae-de*de+(Ze?-1:1)*Se*Se*be*be)/(2*(Ze?Ae:de)*Se*be);return Math.log(Math.sqrt(gt*gt+1)-gt)}function ye(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ce(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Le=xe(0);let ke=function(Ze){return Ce(Le)/Ce(Le+me*Ze)},Je=function(Ze){return de*((Ce(Le)*(ye(gt=Le+me*Ze)/Ce(gt))-ye(Le))/Se)/be;var gt},et=(xe(1)-Le)/me;if(Math.abs(be)<1e-6||!isFinite(et)){if(Math.abs(de-Ae)<1e-6)return this.easeTo(o,c);const Ze=Ae<de?-1:1;et=Math.abs(Math.log(Ae/de))/me,Je=function(){return 0},ke=function(gt){return Math.exp(Ze*me*gt)}}o.duration="duration"in o?+o.duration:1e3*et/("screenSpeed"in o?+o.screenSpeed/me:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const ht=w!==k,St=N!==T,We=!p.isPaddingEqual(W),Re=o.retainPadding===!1?p.clone():p,ot=Ze=>gt=>{const Rt=gt*et,$t=1/ke(Rt);Ze.zoom=gt===1?O:v+Ze.scaleZoom($t),ht&&(Ze.bearing=i.ak(w,k,gt)),St&&(Ze.pitch=i.ak(T,N,gt)),We&&(Re.interpolatePadding(P,W,gt),ee=Re.centerPoint.add(q));const It=gt===1?se:Ze.unproject(oe.add(he.mult(Je(Rt))).mult($t));return Ze.setLocationAtPoint(Ze.renderWorldCopies?It.wrap():It,ee),Ze._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Ze};if(o.preloadOnly){const Ze=this._emulate(ot,o.duration,p);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=ht,this._pitching=St,this._padding=We,this._prepareEase(c,!1),this._ease(ot(p),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,c,p){p.animate===!1||p.duration===0?(o(1),c()):(this._easeStart=i.o.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=i.bT(o,-180,180);const p=Math.abs(o-c);return Math.abs(o-360-c)<p&&(o-=360),Math.abs(o+360-c)<p&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=o.lng-c.center.lng;o.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,p){const v=Math.ceil(15*c/1e3),w=[],T=o(p.clone());for(let P=0;P<=v;P++){const O=T(P/v);w.push(O.clone())}return w}_preloadTiles(o,c){}}class Ud{constructor(o={}){this.options=o,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact,p=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const v=F("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",p),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(o){const p=c.reduce((v,w,T)=>(w.value&&(v+=`${w.key}=${w.value}${T<c.length-1?"&":""}`),v),"?");o.href=`${i.e.FEEDBACK_URL}/${p}#${to(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const w=c[v];if(w.used){const T=w.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((v,w)=>v.length-w.length),o=o.filter((v,w)=>{for(let T=w+1;T<o.length;T++)if(o[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const p=o.map(v=>function(w){const T=new DOMParser().parseFromString(w,"text/html");return Array.from(T.body.querySelectorAll("*")).forEach(P=>{const O=P.textContent||"";if(P.tagName!=="A")return void P.replaceWith(T.createTextNode(O));const k=P.getAttribute("href");if(!k||!/^(https?:|mailto:)/i.test(k))return void P.replaceWith(T.createTextNode(O));const N=T.createElement("a");N.href=k,N.textContent=O,N.rel="noopener nofollow";const W=P.getAttribute("class");W&&(N.className=W),P.replaceWith(N)}),T.body.innerHTML}(v)).join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gd{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=F("div","mapboxgl-ctrl");const c=F("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const c in o){const p=o[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class vh{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(o,c){const p=F("button",o,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return F("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,c){this._map&&(o.setAttribute("aria-label",c),o.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const c=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(p=>p.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});F("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,c){for(let p=0;p<o.length;p++){const v=o[p],w=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(v.id)});this._setButtonTitle(w,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&c&&w.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(w),p<o.length-1&&this._createSeparator()}}}class Dl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const v of p)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class kl{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=i.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,p){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+p}}const jl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Oc extends i.z{constructor(o,c,p,v){const{point:w,lngLat:T,originalEvent:P,target:O}=o;super(o.type,{point:w,lngLat:T,originalEvent:P,target:O}),this.preventDefault=()=>{o.preventDefault()},this.id=c,this.interaction=p,this.feature=v}}class Oa{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,c){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const p=c.filter;let v=c.type;p&&this.filters.set(o,i.b6(p)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const w=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,c)):w.size===0&&this.map.on(v,this.handleType),w.size===0&&this.interactionsByType.set(v,w),w.set(o,c),this.typeById.set(o,v)}get(o){const c=this.typeById.get(o);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(o):void 0}remove(o){const c=this.typeById.get(o);if(!c)return;this.typeById.delete(o),this.filters.delete(o);const p=this.interactionsByType.get(c);p&&(p.delete(o),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(o,c){const p=[];for(const[v,w]of c)w.target&&p.push({targetId:v,target:w.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(o,p,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());c.length&&(o.type="mouseenter",this.handleType(o,c));const p=new Map;for(const[v,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||p.set(w.id,w);p.size&&(o.type="mouseleave",this.handleType(o,Array.from(p.values())))}handleOut(o){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(o.type="mouseleave",this.handleType(o,c)),this.hoveredFeatures.clear()}handleType(o,c){const p=o.type==="mouseenter";if(p&&!this.interactionsByType.has(o.type))return void i.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(o.type)).reverse(),w=!!c;c=c||this.queryTargets(o.point,v);let T=!1;const P=new Set;for(const O of c){for(const[k,N]of v){if(!N.target)continue;const W=O.variants?O.variants[k]:null;if(W){for(const H of W){if(Yu(H,O,P,k))continue;const q=new i.dx(O,H),ee=ru(H,O,k);w&&q.id!==void 0&&(q.state=this.map.getFeatureState(q));const Y=p?this.prevHoveredFeatures.get(ee):null,se=new Oc(o,k,N,q),oe=Y?Y.stop:N.handler(se);if(p&&this.hoveredFeatures.set(ee,{feature:O,stop:oe}),oe!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[O,k]of v){const{handler:N,target:W}=k;if(!W&&N(new Oc(o,O,k,null))!==!1)break}}}function x2(f,o){if(Array.isArray(f)&&Array.isArray(o)){const c=new Set(f),p=new Set(o);return c.size===p.size&&f.every(v=>p.has(v))}return i.by(f,o)}const b2={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},w2={showCompass:!0,showZoom:!0,visualizePitch:!1};class T2{constructor(o,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new l_({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new c_({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),ie()}move(o,c){const p=this.map,v=this.mouseRotate.mousemoveWindow(o,c),w=v&&v.bearingDelta;if(w&&p.setBearing(p.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,c),P=T&&T.pitchDelta;P&&p.setPitch(p.getPitch()+P)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Pe(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Pe(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Fe(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Fe(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function f_(f,o,c){if(f=new i.aT(f.lng,f.lat),o){const p=new i.aT(f.lng-360,f.lat),v=new i.aT(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),T=c.locationPoint3D(f).distSqr(o),P=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint3D(p).distSqr(o)<T&&(P||Math.abs(p.lng-c.center.lng)<w)?f=p:c.locationPoint3D(v).distSqr(o)<T&&(P||Math.abs(v.lng-c.center.lng)<w)&&(f=v)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},ca={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class am extends i.E{constructor(o,c){super(),(o instanceof HTMLElement||c)&&(o=Object.assign({element:o},c)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:v="#3FB1CE",scale:w=1,draggable:T=!1,clickTolerance:P=0,rotation:O=ca.rotation,rotationAlignment:k=ca.rotationAlignment,pitchAlignment:N=ca.pitchAlignment,occludedOpacity:W=ca.occludedOpacity,altitude:H=ca.altitude}=o||{};this._anchor=p,this._color=v,this._scale=w,this._draggable=T,this._clickTolerance=P,this._rotation=O,this._rotationAlignment=k,this._pitchAlignment=N,this._occludedOpacity=W,this._altitude=H,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=i.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const q=this._element.classList;for(const Y in Go)q.remove(`mapboxgl-marker-anchor-${Y}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ee=o&&o.className?o.className.trim().split(/\s+/):[];q.add(...ee),this._popup=null}_createDefaultMarker(){const o=F("div"),c=U("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const p=U("radialGradient",{id:"shadowGradient"},U("defs",{},c));U("stop",{offset:"10%","stop-opacity":.4},p),U("stop",{offset:"100%","stop-opacity":.05},p),U("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return U("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),U("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),U("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=i.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||ca.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,p=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,c=this._pos;if(!o||!c)return!1;const p=o.unproject(c,this._altitude),v=o.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(p)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();const p=o.unproject(c,this._altitude);let v;o._showingGlobe()&&i.f5(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(p),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Go[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const o=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!o||p!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const v=i.cX(i.f6(c.transform,this._lngLat)),w=o.sub(i.f7(c.transform)),T=Math.abs(w.x)+Math.abs(w.y);if(T===0)return"";const P=v/T;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const o=this._pos,c=this._map;if(!c||!o)return"";let p=0;const v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){const w=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);p=i.cX(Math.atan2(T.y,T.x))-90}else p=-c.getBearing();else if(v==="horizon"){const w=i.ah(4,6,c.getZoom()),T=i.f7(c.transform);T.y+=w*c.transform.height;const P=o.sub(T),O=i.cX(Math.atan2(P.y,P.x));p=(O>90?O-270:O+90)*(1-w)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=f_(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=i.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const c=this._map;if(!c)return;const p=this._pointerdownPos,v=this._positionDelta;if(p&&v){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(o.point.dist(p)<w)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(o){const c=this._map,p=this._pos;c&&p&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(p),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||ca.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||ca.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||ca.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||ca.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const S2={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xh={maxWidth:100,unit:"metric"},p_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ua={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ha=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bu(f=new i.P(0,0),o="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new i.P(0,f);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[o]||[0,0])}return{version:S,supported:G.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends d_{constructor(f){I.mark(A.create);const o=f;if((f=Object.assign({},b2,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.f3(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yy(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Dl,this._domRenderTaskQueue=new Dl,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},jl,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new kl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Ke(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new v2(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new e_(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Ud({customAttribution:f.customAttribution})),this._logoControl=new Gd,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.z(`${c.dataType}dataloading`,c))}),this._interactions=new Oa(this)}_getMapId(){return this._mapId}addControl(f,o){if(o===void 0&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new i.z("movestart",f)).fire(new i.z("move",f)),this.fire(new i.z("resize",f)),o&&this.fire(new i.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(o=>o==="auto"?navigator.language:o):f}setLanguage(f){const o=this._parseLanguage(f);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,o=f.projection.name;let c;o==="globe"&&f.zoom>=i.cL?(f.setMercatorFromTransition(),c=!0):o==="mercator"&&f.zoom<i.cL&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,o){return this._updateProjection(f||o||{name:"mercator"})}_updateProjection(f){let o;const c=this.transform.mercatorFromTransition;o=f.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(o||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,o){return this.transform.locationPoint3D(i.aT.convert(f),o)}unproject(f,o){return this.transform.pointLocation3D(i.P.convert(f),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,o,c){const p=v=>{let w=[];if(Array.isArray(o)){const T=o.filter(P=>this.getLayer(P));w=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else w=this.queryRenderedFeatures(v,{target:o});return w};if(f==="mouseenter"||f==="mouseover"){let v=!1;return{listener:c,targets:o,delegates:{mousemove:T=>{const P=p(T.point);P.length?v||(v=!0,c.call(this,new Ps(f,this,T.originalEvent,{features:P}))):v=!1},mouseout:()=>{v=!1}}}}if(f==="mouseleave"||f==="mouseout"){let v=!1;return{listener:c,targets:o,delegates:{mousemove:P=>{p(P.point).length?v=!0:v&&(v=!1,c.call(this,new Ps(f,this,P.originalEvent)))},mouseout:P=>{v&&(v=!1,c.call(this,new Ps(f,this,P.originalEvent)))}}}}{const v=w=>{const T=p(w.point);T.length&&(w.features=T,c.call(this,w),delete w.features)};return{listener:c,targets:o,delegates:{[f]:v}}}}on(f,o,c){if(typeof o=="function"||c===void 0)return super.on(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const p=this._createDelegatedListener(f,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const v in p.delegates)this.on(v,p.delegates[v]);return this}once(f,o,c){if(typeof o=="function"||c===void 0)return super.once(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const p=this._createDelegatedListener(f,o,c);for(const v in p.delegates)this.once(v,p.delegates[v]);return this}off(f,o,c){if(typeof o=="function"||c===void 0)return super.off(f,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(v=>{for(let w=0;w<v.length;w++){const T=v[w];if(T.listener===c&&x2(T.targets,o)){for(const P in T.delegates)this.off(P,T.delegates[P]);return v.splice(w,1),this}}})(p),this}queryRenderedFeatures(f,o){if(!this.style)return[];if(f===void 0||f instanceof i.P||Array.isArray(f)||o!==void 0||(o=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!o){const w=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return w.concat(T)}let c=!0;if(o.target&&(c=this._isTargetValid(o.target),c&&!o.layers))return this.style.queryRenderedFeatureset(f,o,this.transform);let p=!0;if(o.layers&&Array.isArray(o.layers)){for(const w of o.layers)if(!this._isValidId(w)){p=!1;break}if(p&&!o.target)return this.style.queryRenderedFeatures(f,o,this.transform)}let v=[];return p&&(v=v.concat(this.style.queryRenderedFeatures(f,o,this.transform))),c&&(v=v.concat(this.style.queryRenderedFeatureset(f,o,this.transform))),v}querySourceFeatures(f,o){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,o)}queryRasterValue(f,o,c){return this._isValidId(f)?this.style.queryRasterValue(f,o,c):Promise.resolve(null)}isPointOnSurface(f){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&i.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}addInteraction(f,o){return this._interactions.add(f,o),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&f&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(f,(c,p)=>{if(c){const v=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(f,o)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){const o=this._locale[f];if(o==null)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=Object.assign({},o);o&&o.config&&(c.initialConfig=o.config,delete c.config),this.style=new la(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new la(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(f)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const o of f)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(f)}addSource(f,o){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,o,{pixelRatio:c=1,sdf:p=!1,stretchX:v,stretchY:w,content:T}={}){this._lazyInitEmptyStyle();const P=i.I.from(f);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:O,height:k,data:N}=i.o.getImageData(o);this.style.addImage(P,{data:new i.q({width:O,height:k},N),pixelRatio:c,stretchX:v,stretchY:w,content:T,sdf:p,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:k}=o,N=o;this.style.addImage(P,{data:new i.q({width:O,height:k},new Uint8Array(N.data)),pixelRatio:c,stretchX:v,stretchY:w,content:T,sdf:p,usvg:!1,version:0,userImage:N}),N.onAdd&&N.onAdd(this,f)}}updateImage(f,o){this._lazyInitEmptyStyle();const c=i.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?i.o.getImageData(o):o,{width:w,height:T,data:P}=v;if(w===void 0||T===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${w}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const O=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let k=!1;p.usvg?(p.data=new i.q({width:w,height:T},new Uint8Array(P)),p.usvg=!1,p.icon=void 0,k=!0):p.data.replace(P,O),this.style.updateImage(c,p,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(i.I.from(f)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(i.I.from(f))}loadImage(f,o){i.n(this._requestManager.transformRequest(f,i.R.Image),(c,p)=>{o(c,p instanceof HTMLImageElement?i.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,o){this._lazyInitEmptyStyle(),this.style.addModel(f,o)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,o){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)):this}getSlot(f){const o=this.getLayer(f);return o&&o.slot||null}setSlot(f,o){return this.style.setSlot(f,o),this.style.mergeLayers(),this._update(!0)}addImport(f,o){return this.style.addImport(f,o).catch(c=>this.fire(new i.y(new Error("Failed to add import",c)))),this}updateImport(f,o){return typeof o!="string"&&o.id!==f?(this.removeImport(f),this.addImport(o)):(this.style.updateImport(f,o),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,o){return this.style.moveImport(f,o),this._update(!0)}moveLayer(f,o){return this._isValidId(f)?(this.style.moveLayer(f,o),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const o=this.style.getOwnLayer(f);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,o,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,o,c),this._update(!0)):this}setFilter(f,o,c={}){return this._isValidId(f)?(this.style.setFilter(f,o,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,o,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,o,c,p),this._update(!0)):this}getPaintProperty(f,o){return this._isValidId(f)?this.style.getPaintProperty(f,o):null}setLayoutProperty(f,o,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,o,c,p),this._update(!0)):this}getLayoutProperty(f,o){return this._isValidId(f)?this.style.getLayoutProperty(f,o):null}setLayerProperty(f,o,c,p={}){return this._isValidId(f)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(f,o,c,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,o){return this.style.setSchema(f,o),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,o){return this.style.setConfig(f,o),this._update(!0)}getConfigProperty(f,o){return this.style.getConfigProperty(f,o)}setConfigProperty(f,o,c){return this.style.setConfigProperty(f,o,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const o=f[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,o),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(f),this.transform):0}setFeatureState(f,o){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,o),this._update())}removeFeatureState(f,o){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,o),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new vh),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,p,v,w=this._container;for(;w&&(!p||!v);){const T=window.getComputedStyle(w).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),w=w.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new mx(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=F("div","mapboxgl-canvas-container",f);this._canvas=F("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=F("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{p[v]=F("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){const c=i.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const o=this._markers.indexOf(f);o!==-1&&this._markers.splice(o,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const o=this._popups.indexOf(f);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const f=Object.assign({},G.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",f);o?(zn(o,!0),this.painter=new qp(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(o)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;this.fire(new i.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=i.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,N=this.transform.pitch,W=i.o.now(),H=new i.ac(k,{now:W,fadeDuration:w,pitch:N,transition:this.style.transition,worldview:this._worldview});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(A.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const k=i.o.now()-p;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const N=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new i.z("gpu-timing-frame",{cpuTime:k,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(k);this.fire(new i.z("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(k);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:N}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(O||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,I.mark(A.fullLoad),this._performanceMetricsCollection&&Nr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const o of this._markers)f&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!f||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(f,o=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=f;const T=Math.abs(v-w);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){ci(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Qe||f.status===401)){const o=this.painter.context.gl;zn(o,!1),this._logoControl instanceof Gd&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&lr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Lt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){pr(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function v(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(v(f),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(f,o,c){let p=c[1]-c[0];const v=f.length/4;for(let w=0;w<o.length;w++){const T=o[w];let P=0;for(let O=0;O<T.length;O+=4)T[O]===f[O]&&T[O+1]===f[O+1]&&T[O+2]===f[O+2]&&T[O+3]===f[O+3]&&(P+=1);p+=(c[w+2]-c[w+1])*(1-P/v)}return p}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Un.delete(this.painter.context.gl),un.remove(),xr.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.o.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(f){const o=this.style?this.style.getSourceCaches():[];return i.bw(o,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this.style&&f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,o){i.f4(f,o)}get version(){return S}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},w2,f),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const o=f.getZoom(),c=o===f.getMaxZoom(),p=o===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new T2(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){const c=F("button",f,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(f,o){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(f={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},S2,f),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),c=f.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const o=new i.aT(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),v=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),v,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new i.aT(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,o=i.cf(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new am({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new am({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ud,ScaleControl:class{constructor(f={}){this.options=Object.assign({},xh,f),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,p=o._containerWidth/2-f/2,v=o.unproject([p,c]),w=o.unproject([p+f,c]),T=v.distanceTo(w);if(this.options.unit==="imperial"){const P=3.2808*T;P>5280?this._setScale(f,P/5280,"mile"):this._setScale(f,P,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,o,c){this._map._requestDomTask(()=>{const p=function(w){const T=Math.pow(10,`${Math.floor(w)}`.length-1);let P=w/T;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const k=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*k)/k}(P),T*P}(o),v=p/o;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${p_[c]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:vh,Popup:class extends i.E{constructor(f){super(),this.options=Object.assign(Object.create(ua),f),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.aT.convert(f),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const o=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){const c=this._closeButton=F("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const o=this._map,c=this._container,p=this._pos;if(!o||!c||!p)return"bottom";const v=c.offsetWidth,w=c.offsetHeight,T=p.x<v/2,P=p.x>o.transform.width-v/2;if(p.y+f<w)return T?"top-left":P?"top-right":"top";if(p.y>o.transform.height-w){if(T)return"bottom-left";if(P)return"bottom-right"}return T?"left":P?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){const o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=F("div","mapboxgl-popup",o.getContainer()),this._tip=F("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=f_(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f instanceof i.P?f:o.project(this._lngLat,this._altitude),w=bu(this.options.offset),T=this._anchor=this._getAnchor(w.y),P=bu(this.options.offset,T),O=v.add(P).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Go[T]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&o._showingGlobe()){const v=i.f5(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ha);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:am,Style:la,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:ms,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(f){i.e.ACCESS_TOKEN=f},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(f){i.e.API_URL=f},get workerCount(){return i.fi.workerCount},set workerCount(f){i.fi.workerCount=f},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.fh(f)},get workerUrl(){return i.fg.workerUrl},set workerUrl(f){i.fg.workerUrl=f},get workerClass(){return i.fg.workerClass},set workerClass(f){i.fg.workerClass=f},get workerParams(){return i.fg.workerParams},set workerParams(f){i.fg.workerParams=f},get dracoUrl(){return i.ff()},set dracoUrl(f){i.fe(f)},get meshoptUrl(){return i.fd()},set meshoptUrl(f){i.fc(f)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var _=h;return _})})(RH);var Qke=RH.exports;const M1=Bi(Qke);function pT(e,[t,n]){return Math.min(n,Math.max(t,e))}var eje=B.createContext(void 0);function LS(e){const t=B.useContext(eje);return e||t||"ltr"}function tR(e){const t=B.useRef({value:e,previous:e});return B.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var tje=[" ","Enter","ArrowUp","ArrowDown"],rje=[" ","Enter"],Df="Select",[NS,zS,nje]=O0(Df),[sy,jze]=cc(Df,[nje,$g]),FS=$g(),[ije,od]=sy(Df),[oje,sje]=sy(Df),kH=e=>{const{__scopeSelect:t,children:n,open:s,defaultOpen:h,onOpenChange:m,value:_,defaultValue:i,onValueChange:S,dir:A,name:I,autoComplete:M,disabled:L,required:z,form:G}=e,F=FS(t),[U,K]=B.useState(null),[J,X]=B.useState(null),[ie,Q]=B.useState(!1),ae=LS(A),[pe,Pe]=Wh({prop:s,defaultProp:h??!1,onChange:m,caller:Df}),[Fe,tt]=Wh({prop:_,defaultProp:i,onChange:S,caller:Df}),Be=B.useRef(null),Ge=U?G||!!U.closest("form"):!0,[Qe,Ke]=B.useState(new Set),ct=Array.from(Qe).map(He=>He.props.value).join(";");return b.jsx(rV,{...F,children:b.jsxs(ije,{required:z,scope:t,trigger:U,onTriggerChange:K,valueNode:J,onValueNodeChange:X,valueNodeHasChildren:ie,onValueNodeHasChildrenChange:Q,contentId:Du(),value:Fe,onValueChange:tt,open:pe,onOpenChange:Pe,dir:ae,triggerPointerDownPosRef:Be,disabled:L,children:[b.jsx(NS.Provider,{scope:t,children:b.jsx(oje,{scope:e.__scopeSelect,onNativeOptionAdd:B.useCallback(He=>{Ke(qe=>new Set(qe).add(He))},[]),onNativeOptionRemove:B.useCallback(He=>{Ke(qe=>{const ut=new Set(qe);return ut.delete(He),ut})},[]),children:n})}),Ge?b.jsxs(iW,{"aria-hidden":!0,required:z,tabIndex:-1,name:I,autoComplete:M,value:Fe,onChange:He=>tt(He.target.value),disabled:L,form:G,children:[Fe===void 0?b.jsx("option",{value:""}):null,Array.from(Qe)]},ct):null]})})};kH.displayName=Df;var jH="SelectTrigger",LH=B.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:s=!1,...h}=e,m=FS(n),_=od(jH,n),i=_.disabled||s,S=li(t,_.onTriggerChange),A=zS(n),I=B.useRef("touch"),[M,L,z]=sW(F=>{const U=A().filter(X=>!X.disabled),K=U.find(X=>X.value===_.value),J=aW(U,F,K);J!==void 0&&_.onValueChange(J.value)}),G=F=>{i||(_.onOpenChange(!0),z()),F&&(_.triggerPointerDownPosRef.current={x:Math.round(F.pageX),y:Math.round(F.pageY)})};return b.jsx(JI,{asChild:!0,...m,children:b.jsx(En.button,{type:"button",role:"combobox","aria-controls":_.contentId,"aria-expanded":_.open,"aria-required":_.required,"aria-autocomplete":"none",dir:_.dir,"data-state":_.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":oW(_.value)?"":void 0,...h,ref:S,onClick:Ar(h.onClick,F=>{F.currentTarget.focus(),I.current!=="mouse"&&G(F)}),onPointerDown:Ar(h.onPointerDown,F=>{I.current=F.pointerType;const U=F.target;U.hasPointerCapture(F.pointerId)&&U.releasePointerCapture(F.pointerId),F.button===0&&F.ctrlKey===!1&&F.pointerType==="mouse"&&(G(F),F.preventDefault())}),onKeyDown:Ar(h.onKeyDown,F=>{const U=M.current!=="";!(F.ctrlKey||F.altKey||F.metaKey)&&F.key.length===1&&L(F.key),!(U&&F.key===" ")&&tje.includes(F.key)&&(G(),F.preventDefault())})})})});LH.displayName=jH;var NH="SelectValue",zH=B.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:h,children:m,placeholder:_="",...i}=e,S=od(NH,n),{onValueNodeHasChildrenChange:A}=S,I=m!==void 0,M=li(t,S.onValueNodeChange);return Ds(()=>{A(I)},[A,I]),b.jsx(En.span,{...i,ref:M,style:{pointerEvents:"none"},children:oW(S.value)?b.jsx(b.Fragment,{children:_}):m})});zH.displayName=NH;var aje="SelectIcon",FH=B.forwardRef((e,t)=>{const{__scopeSelect:n,children:s,...h}=e;return b.jsx(En.span,{"aria-hidden":!0,...h,ref:t,children:s||""})});FH.displayName=aje;var lje="SelectPortal",BH=e=>b.jsx(R0,{asChild:!0,...e});BH.displayName=lje;var kf="SelectContent",VH=B.forwardRef((e,t)=>{const n=od(kf,e.__scopeSelect),[s,h]=B.useState();if(Ds(()=>{h(new DocumentFragment)},[]),!n.open){const m=s;return m?Ng.createPortal(b.jsx($H,{scope:e.__scopeSelect,children:b.jsx(NS.Slot,{scope:e.__scopeSelect,children:b.jsx("div",{children:e.children})})}),m):null}return b.jsx(UH,{...e,ref:t})});VH.displayName=kf;var Kl=10,[$H,sd]=sy(kf),cje="SelectContentImpl",uje=wf("SelectContent.RemoveScroll"),UH=B.forwardRef((e,t)=>{const{__scopeSelect:n,position:s="item-aligned",onCloseAutoFocus:h,onEscapeKeyDown:m,onPointerDownOutside:_,side:i,sideOffset:S,align:A,alignOffset:I,arrowPadding:M,collisionBoundary:L,collisionPadding:z,sticky:G,hideWhenDetached:F,avoidCollisions:U,...K}=e,J=od(kf,n),[X,ie]=B.useState(null),[Q,ae]=B.useState(null),pe=li(t,lr=>ie(lr)),[Pe,Fe]=B.useState(null),[tt,Be]=B.useState(null),Ge=zS(n),[Qe,Ke]=B.useState(!1),ct=B.useRef(!1);B.useEffect(()=>{if(X)return UM(X)},[X]),$M();const He=B.useCallback(lr=>{const[an,...Lt]=Ge().map(Nt=>Nt.ref.current),[nr]=Lt.slice(-1),pr=document.activeElement;for(const Nt of lr)if(Nt===pr||(Nt?.scrollIntoView({block:"nearest"}),Nt===an&&Q&&(Q.scrollTop=0),Nt===nr&&Q&&(Q.scrollTop=Q.scrollHeight),Nt?.focus(),document.activeElement!==pr))return},[Ge,Q]),qe=B.useCallback(()=>He([Pe,X]),[He,Pe,X]);B.useEffect(()=>{Qe&&qe()},[Qe,qe]);const{onOpenChange:ut,triggerPointerDownPosRef:nt}=J;B.useEffect(()=>{if(X){let lr={x:0,y:0};const an=nr=>{lr={x:Math.abs(Math.round(nr.pageX)-(nt.current?.x??0)),y:Math.abs(Math.round(nr.pageY)-(nt.current?.y??0))}},Lt=nr=>{lr.x<=10&&lr.y<=10?nr.preventDefault():X.contains(nr.target)||ut(!1),document.removeEventListener("pointermove",an),nt.current=null};return nt.current!==null&&(document.addEventListener("pointermove",an),document.addEventListener("pointerup",Lt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",an),document.removeEventListener("pointerup",Lt,{capture:!0})}}},[X,ut,nt]),B.useEffect(()=>{const lr=()=>ut(!1);return window.addEventListener("blur",lr),window.addEventListener("resize",lr),()=>{window.removeEventListener("blur",lr),window.removeEventListener("resize",lr)}},[ut]);const[Kt,cr]=sW(lr=>{const an=Ge().filter(pr=>!pr.disabled),Lt=an.find(pr=>pr.ref.current===document.activeElement),nr=aW(an,lr,Lt);nr&&setTimeout(()=>nr.ref.current.focus())}),Bt=B.useCallback((lr,an,Lt)=>{const nr=!ct.current&&!Lt;(J.value!==void 0&&J.value===an||nr)&&(Fe(lr),nr&&(ct.current=!0))},[J.value]),Vt=B.useCallback(()=>X?.focus(),[X]),xr=B.useCallback((lr,an,Lt)=>{const nr=!ct.current&&!Lt;(J.value!==void 0&&J.value===an||nr)&&Be(lr)},[J.value]),nn=s==="popper"?SI:GH,Hn=nn===SI?{side:i,sideOffset:S,align:A,alignOffset:I,arrowPadding:M,collisionBoundary:L,collisionPadding:z,sticky:G,hideWhenDetached:F,avoidCollisions:U}:{};return b.jsx($H,{scope:n,content:X,viewport:Q,onViewportChange:ae,itemRefCallback:Bt,selectedItem:Pe,onItemLeave:Vt,itemTextRefCallback:xr,focusSelectedItem:qe,selectedItemText:tt,position:s,isPositioned:Qe,searchRef:Kt,children:b.jsx(UT,{as:uje,allowPinchZoom:!0,children:b.jsx(VT,{asChild:!0,trapped:J.open,onMountAutoFocus:lr=>{lr.preventDefault()},onUnmountAutoFocus:Ar(h,lr=>{J.trigger?.focus({preventScroll:!0}),lr.preventDefault()}),children:b.jsx(zg,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:_,onFocusOutside:lr=>lr.preventDefault(),onDismiss:()=>J.onOpenChange(!1),children:b.jsx(nn,{role:"listbox",id:J.contentId,"data-state":J.open?"open":"closed",dir:J.dir,onContextMenu:lr=>lr.preventDefault(),...K,...Hn,onPlaced:()=>Ke(!0),ref:pe,style:{display:"flex",flexDirection:"column",outline:"none",...K.style},onKeyDown:Ar(K.onKeyDown,lr=>{const an=lr.ctrlKey||lr.altKey||lr.metaKey;if(lr.key==="Tab"&&lr.preventDefault(),!an&&lr.key.length===1&&cr(lr.key),["ArrowUp","ArrowDown","Home","End"].includes(lr.key)){let nr=Ge().filter(pr=>!pr.disabled).map(pr=>pr.ref.current);if(["ArrowUp","End"].includes(lr.key)&&(nr=nr.slice().reverse()),["ArrowUp","ArrowDown"].includes(lr.key)){const pr=lr.target,Nt=nr.indexOf(pr);nr=nr.slice(Nt+1)}setTimeout(()=>He(nr)),lr.preventDefault()}})})})})})})});UH.displayName=cje;var hje="SelectItemAlignedPosition",GH=B.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:s,...h}=e,m=od(kf,n),_=sd(kf,n),[i,S]=B.useState(null),[A,I]=B.useState(null),M=li(t,pe=>I(pe)),L=zS(n),z=B.useRef(!1),G=B.useRef(!0),{viewport:F,selectedItem:U,selectedItemText:K,focusSelectedItem:J}=_,X=B.useCallback(()=>{if(m.trigger&&m.valueNode&&i&&A&&F&&U&&K){const pe=m.trigger.getBoundingClientRect(),Pe=A.getBoundingClientRect(),Fe=m.valueNode.getBoundingClientRect(),tt=K.getBoundingClientRect();if(m.dir!=="rtl"){const pr=tt.left-Pe.left,Nt=Fe.left-pr,Nr=pe.left-Nt,un=pe.width+Nr,ci=Math.max(un,Pe.width),Un=window.innerWidth-Kl,zn=pT(Nt,[Kl,Math.max(Kl,Un-ci)]);i.style.minWidth=un+"px",i.style.left=zn+"px"}else{const pr=Pe.right-tt.right,Nt=window.innerWidth-Fe.right-pr,Nr=window.innerWidth-pe.right-Nt,un=pe.width+Nr,ci=Math.max(un,Pe.width),Un=window.innerWidth-Kl,zn=pT(Nt,[Kl,Math.max(Kl,Un-ci)]);i.style.minWidth=un+"px",i.style.right=zn+"px"}const Be=L(),Ge=window.innerHeight-Kl*2,Qe=F.scrollHeight,Ke=window.getComputedStyle(A),ct=parseInt(Ke.borderTopWidth,10),He=parseInt(Ke.paddingTop,10),qe=parseInt(Ke.borderBottomWidth,10),ut=parseInt(Ke.paddingBottom,10),nt=ct+He+Qe+ut+qe,Kt=Math.min(U.offsetHeight*5,nt),cr=window.getComputedStyle(F),Bt=parseInt(cr.paddingTop,10),Vt=parseInt(cr.paddingBottom,10),xr=pe.top+pe.height/2-Kl,nn=Ge-xr,Hn=U.offsetHeight/2,lr=U.offsetTop+Hn,an=ct+He+lr,Lt=nt-an;if(an<=xr){const pr=Be.length>0&&U===Be[Be.length-1].ref.current;i.style.bottom="0px";const Nt=A.clientHeight-F.offsetTop-F.offsetHeight,Nr=Math.max(nn,Hn+(pr?Vt:0)+Nt+qe),un=an+Nr;i.style.height=un+"px"}else{const pr=Be.length>0&&U===Be[0].ref.current;i.style.top="0px";const Nr=Math.max(xr,ct+F.offsetTop+(pr?Bt:0)+Hn)+Lt;i.style.height=Nr+"px",F.scrollTop=an-xr+F.offsetTop}i.style.margin=`${Kl}px 0`,i.style.minHeight=Kt+"px",i.style.maxHeight=Ge+"px",s?.(),requestAnimationFrame(()=>z.current=!0)}},[L,m.trigger,m.valueNode,i,A,F,U,K,m.dir,s]);Ds(()=>X(),[X]);const[ie,Q]=B.useState();Ds(()=>{A&&Q(window.getComputedStyle(A).zIndex)},[A]);const ae=B.useCallback(pe=>{pe&&G.current===!0&&(X(),J?.(),G.current=!1)},[X,J]);return b.jsx(fje,{scope:n,contentWrapper:i,shouldExpandOnScrollRef:z,onScrollButtonChange:ae,children:b.jsx("div",{ref:S,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ie},children:b.jsx(En.div,{...h,ref:M,style:{boxSizing:"border-box",maxHeight:"100%",...h.style}})})})});GH.displayName=hje;var dje="SelectPopperPosition",SI=B.forwardRef((e,t)=>{const{__scopeSelect:n,align:s="start",collisionPadding:h=Kl,...m}=e,_=FS(n);return b.jsx(QI,{..._,...m,ref:t,align:s,collisionPadding:h,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});SI.displayName=dje;var[fje,rR]=sy(kf,{}),EI="SelectViewport",HH=B.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:s,...h}=e,m=sd(EI,n),_=rR(EI,n),i=li(t,m.onViewportChange),S=B.useRef(0);return b.jsxs(b.Fragment,{children:[b.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),b.jsx(NS.Slot,{scope:n,children:b.jsx(En.div,{"data-radix-select-viewport":"",role:"presentation",...h,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...h.style},onScroll:Ar(h.onScroll,A=>{const I=A.currentTarget,{contentWrapper:M,shouldExpandOnScrollRef:L}=_;if(L?.current&&M){const z=Math.abs(S.current-I.scrollTop);if(z>0){const G=window.innerHeight-Kl*2,F=parseFloat(M.style.minHeight),U=parseFloat(M.style.height),K=Math.max(F,U);if(K<G){const J=K+z,X=Math.min(G,J),ie=J-X;M.style.height=X+"px",M.style.bottom==="0px"&&(I.scrollTop=ie>0?ie:0,M.style.justifyContent="flex-end")}}}S.current=I.scrollTop})})})]})});HH.displayName=EI;var WH="SelectGroup",[pje,mje]=sy(WH),gje=B.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,h=Du();return b.jsx(pje,{scope:n,id:h,children:b.jsx(En.div,{role:"group","aria-labelledby":h,...s,ref:t})})});gje.displayName=WH;var qH="SelectLabel",ZH=B.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,h=mje(qH,n);return b.jsx(En.div,{id:h.id,...s,ref:t})});ZH.displayName=qH;var mT="SelectItem",[yje,XH]=sy(mT),KH=B.forwardRef((e,t)=>{const{__scopeSelect:n,value:s,disabled:h=!1,textValue:m,..._}=e,i=od(mT,n),S=sd(mT,n),A=i.value===s,[I,M]=B.useState(m??""),[L,z]=B.useState(!1),G=li(t,J=>S.itemRefCallback?.(J,s,h)),F=Du(),U=B.useRef("touch"),K=()=>{h||(i.onValueChange(s),i.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return b.jsx(yje,{scope:n,value:s,disabled:h,textId:F,isSelected:A,onItemTextChange:B.useCallback(J=>{M(X=>X||(J?.textContent??"").trim())},[]),children:b.jsx(NS.ItemSlot,{scope:n,value:s,disabled:h,textValue:I,children:b.jsx(En.div,{role:"option","aria-labelledby":F,"data-highlighted":L?"":void 0,"aria-selected":A&&L,"data-state":A?"checked":"unchecked","aria-disabled":h||void 0,"data-disabled":h?"":void 0,tabIndex:h?void 0:-1,..._,ref:G,onFocus:Ar(_.onFocus,()=>z(!0)),onBlur:Ar(_.onBlur,()=>z(!1)),onClick:Ar(_.onClick,()=>{U.current!=="mouse"&&K()}),onPointerUp:Ar(_.onPointerUp,()=>{U.current==="mouse"&&K()}),onPointerDown:Ar(_.onPointerDown,J=>{U.current=J.pointerType}),onPointerMove:Ar(_.onPointerMove,J=>{U.current=J.pointerType,h?S.onItemLeave?.():U.current==="mouse"&&J.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Ar(_.onPointerLeave,J=>{J.currentTarget===document.activeElement&&S.onItemLeave?.()}),onKeyDown:Ar(_.onKeyDown,J=>{S.searchRef?.current!==""&&J.key===" "||(rje.includes(J.key)&&K(),J.key===" "&&J.preventDefault())})})})})});KH.displayName=mT;var Tv="SelectItemText",YH=B.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:h,...m}=e,_=od(Tv,n),i=sd(Tv,n),S=XH(Tv,n),A=sje(Tv,n),[I,M]=B.useState(null),L=li(t,K=>M(K),S.onItemTextChange,K=>i.itemTextRefCallback?.(K,S.value,S.disabled)),z=I?.textContent,G=B.useMemo(()=>b.jsx("option",{value:S.value,disabled:S.disabled,children:z},S.value),[S.disabled,S.value,z]),{onNativeOptionAdd:F,onNativeOptionRemove:U}=A;return Ds(()=>(F(G),()=>U(G)),[F,U,G]),b.jsxs(b.Fragment,{children:[b.jsx(En.span,{id:S.textId,...m,ref:L}),S.isSelected&&_.valueNode&&!_.valueNodeHasChildren?Ng.createPortal(m.children,_.valueNode):null]})});YH.displayName=Tv;var JH="SelectItemIndicator",QH=B.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return XH(JH,n).isSelected?b.jsx(En.span,{"aria-hidden":!0,...s,ref:t}):null});QH.displayName=JH;var AI="SelectScrollUpButton",eW=B.forwardRef((e,t)=>{const n=sd(AI,e.__scopeSelect),s=rR(AI,e.__scopeSelect),[h,m]=B.useState(!1),_=li(t,s.onScrollButtonChange);return Ds(()=>{if(n.viewport&&n.isPositioned){let i=function(){const A=S.scrollTop>0;m(A)};const S=n.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),h?b.jsx(rW,{...e,ref:_,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=n;i&&S&&(i.scrollTop=i.scrollTop-S.offsetHeight)}}):null});eW.displayName=AI;var PI="SelectScrollDownButton",tW=B.forwardRef((e,t)=>{const n=sd(PI,e.__scopeSelect),s=rR(PI,e.__scopeSelect),[h,m]=B.useState(!1),_=li(t,s.onScrollButtonChange);return Ds(()=>{if(n.viewport&&n.isPositioned){let i=function(){const A=S.scrollHeight-S.clientHeight,I=Math.ceil(S.scrollTop)<A;m(I)};const S=n.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),h?b.jsx(rW,{...e,ref:_,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=n;i&&S&&(i.scrollTop=i.scrollTop+S.offsetHeight)}}):null});tW.displayName=PI;var rW=B.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:s,...h}=e,m=sd("SelectScrollButton",n),_=B.useRef(null),i=zS(n),S=B.useCallback(()=>{_.current!==null&&(window.clearInterval(_.current),_.current=null)},[]);return B.useEffect(()=>()=>S(),[S]),Ds(()=>{i().find(I=>I.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),b.jsx(En.div,{"aria-hidden":!0,...h,ref:t,style:{flexShrink:0,...h.style},onPointerDown:Ar(h.onPointerDown,()=>{_.current===null&&(_.current=window.setInterval(s,50))}),onPointerMove:Ar(h.onPointerMove,()=>{m.onItemLeave?.(),_.current===null&&(_.current=window.setInterval(s,50))}),onPointerLeave:Ar(h.onPointerLeave,()=>{S()})})}),_je="SelectSeparator",nW=B.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return b.jsx(En.div,{"aria-hidden":!0,...s,ref:t})});nW.displayName=_je;var CI="SelectArrow",vje=B.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,h=FS(n),m=od(CI,n),_=sd(CI,n);return m.open&&_.position==="popper"?b.jsx(eM,{...h,...s,ref:t}):null});vje.displayName=CI;var xje="SelectBubbleInput",iW=B.forwardRef(({__scopeSelect:e,value:t,...n},s)=>{const h=B.useRef(null),m=li(s,h),_=tR(t);return B.useEffect(()=>{const i=h.current;if(!i)return;const S=window.HTMLSelectElement.prototype,I=Object.getOwnPropertyDescriptor(S,"value").set;if(_!==t&&I){const M=new Event("change",{bubbles:!0});I.call(i,t),i.dispatchEvent(M)}},[_,t]),b.jsx(En.select,{...n,style:{...K5,...n.style},ref:m,defaultValue:t})});iW.displayName=xje;function oW(e){return e===""||e===void 0}function sW(e){const t=va(e),n=B.useRef(""),s=B.useRef(0),h=B.useCallback(_=>{const i=n.current+_;t(i),function S(A){n.current=A,window.clearTimeout(s.current),A!==""&&(s.current=window.setTimeout(()=>S(""),1e3))}(i)},[t]),m=B.useCallback(()=>{n.current="",window.clearTimeout(s.current)},[]);return B.useEffect(()=>()=>window.clearTimeout(s.current),[]),[n,h,m]}function aW(e,t,n){const h=t.length>1&&Array.from(t).every(A=>A===t[0])?t[0]:t,m=n?e.indexOf(n):-1;let _=bje(e,Math.max(m,0));h.length===1&&(_=_.filter(A=>A!==n));const S=_.find(A=>A.textValue.toLowerCase().startsWith(h.toLowerCase()));return S!==n?S:void 0}function bje(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var wje=kH,lW=LH,Tje=zH,Sje=FH,Eje=BH,cW=VH,Aje=HH,uW=ZH,hW=KH,Pje=YH,Cje=QH,dW=eW,fW=tW,pW=nW;const Ou=wje,Ru=Tje,Bc=B.forwardRef(({className:e,children:t,...n},s)=>b.jsxs(lW,{ref:s,className:Wr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,b.jsx(Sje,{asChild:!0,children:b.jsx(v4,{className:"h-4 w-4 opacity-50"})})]}));Bc.displayName=lW.displayName;const mW=B.forwardRef(({className:e,...t},n)=>b.jsx(dW,{ref:n,className:Wr("flex cursor-default items-center justify-center py-1",e),...t,children:b.jsx(x4,{className:"h-4 w-4"})}));mW.displayName=dW.displayName;const gW=B.forwardRef(({className:e,...t},n)=>b.jsx(fW,{ref:n,className:Wr("flex cursor-default items-center justify-center py-1",e),...t,children:b.jsx(v4,{className:"h-4 w-4"})}));gW.displayName=fW.displayName;const Vc=B.forwardRef(({className:e,children:t,position:n="popper",...s},h)=>b.jsx(Eje,{children:b.jsxs(cW,{ref:h,className:Wr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...s,children:[b.jsx(mW,{}),b.jsx(Aje,{className:Wr("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),b.jsx(gW,{})]})}));Vc.displayName=cW.displayName;const Ije=B.forwardRef(({className:e,...t},n)=>b.jsx(uW,{ref:n,className:Wr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Ije.displayName=uW.displayName;const Yi=B.forwardRef(({className:e,children:t,...n},s)=>b.jsxs(hW,{ref:s,className:Wr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(Cje,{children:b.jsx(wT,{className:"h-4 w-4"})})}),b.jsx(Pje,{children:t})]}));Yi.displayName=hW.displayName;const Mje=B.forwardRef(({className:e,...t},n)=>b.jsx(pW,{ref:n,className:Wr("-mx-1 my-1 h-px bg-muted",e),...t}));Mje.displayName=pW.displayName;const Oje=["house","apartment"],Rje=({form:e,setForm:t,locationSearch:n,setLocationSearch:s,searchLocation:h,getCurrentLocation:m,isLocating:_,useUpload:i,setUseUpload:S,existingImages:A,uploadProgress:I,handleImageUpload:M,handleVideoUpload:L,removeImage:z,removeVideo:G})=>{const[F,U]=B.useState(!1),K=Oje.includes(e.property_type),J=async()=>{if(!e.title.trim()){rn({title:"Error",description:"Please enter a property title first",variant:"destructive"});return}U(!0);try{const ie=`Write a compelling property description for a real estate listing in Kenya with these details: ${[e.title,e.location&&`located in ${e.location}`,e.size&&`size: ${e.size}`,e.property_type&&`property type: ${e.property_type}`,e.price&&`price: KES ${Number(e.price).toLocaleString()}`,K&&e.bathrooms&&`${e.bathrooms} bathrooms`].filter(Boolean).join(", ")}. Make it professional, highlight key selling points, and keep it under 200 words.`,ae=await Er.functions.invoke("chat",{body:{messages:[{role:"user",content:ie}],isAdmin:!0,type:"generate_blog"}});if(ae.error)throw ae.error;const pe=ae.data;let Pe="";pe?typeof pe=="string"?Pe=pe:Pe=pe?.response||pe?.reply||pe?.message||JSON.stringify(pe):Pe="",t(Fe=>({...Fe,description:Pe})),rn({title:"Success",description:"Description generated successfully"})}catch(X){console.error("Error generating description:",X),rn({title:"Error",description:"Failed to generate description. Please try again.",variant:"destructive"})}finally{U(!1)}};return b.jsxs("div",{className:"grid gap-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsx(Mn,{placeholder:"Property Title *",value:e.title,onChange:X=>t(ie=>({...ie,title:X.target.value})),className:"col-span-2"}),b.jsx(Mn,{placeholder:"Location *",value:e.location,onChange:X=>t(ie=>({...ie,location:X.target.value}))}),b.jsx(Mn,{placeholder:"Price (KES) *",type:"number",value:e.price,onChange:X=>t(ie=>({...ie,price:X.target.value}))})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs(Ou,{value:e.property_type,onValueChange:X=>t(ie=>({...ie,property_type:X})),children:[b.jsx(Bc,{children:b.jsx(Ru,{placeholder:"Property Type"})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"land",children:"Land"}),b.jsx(Yi,{value:"plot",children:"Plot"}),b.jsx(Yi,{value:"house",children:"House"}),b.jsx(Yi,{value:"apartment",children:"Apartment"}),b.jsx(Yi,{value:"commercial",children:"Commercial"})]})]}),b.jsx(Mn,{placeholder:"Size (e.g., 1/8 Acre, 50x100)",value:e.size,onChange:X=>t(ie=>({...ie,size:X.target.value}))})]}),K&&b.jsx("div",{className:"grid grid-cols-3 gap-4",children:b.jsx(Mn,{placeholder:"Bathrooms",type:"number",value:e.bathrooms,onChange:X=>t(ie=>({...ie,bathrooms:X.target.value}))})}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsx("span",{className:"text-sm font-medium text-foreground",children:"Description"}),b.jsxs(Cr,{type:"button",variant:"ghost",size:"sm",onClick:J,disabled:F,children:[b.jsx(Av,{className:"h-4 w-4 mr-1"}),F?"Generating...":"AI Generate"]})]}),b.jsx(fl,{placeholder:"Property description...",value:e.description,onChange:X=>t(ie=>({...ie,description:X.target.value})),className:"min-h-24"})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsx(Mn,{placeholder:"Seller name",value:e.seller_name,onChange:X=>t(ie=>({...ie,seller_name:X.target.value}))}),b.jsx(Mn,{placeholder:"Seller phone",value:e.seller_phone,onChange:X=>t(ie=>({...ie,seller_phone:X.target.value}))})]}),b.jsxs("div",{className:"border border-border rounded-lg p-4",children:[b.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[b.jsx(qc,{size:20}),"Property Location"]}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Mn,{placeholder:"Search for a location...",value:n,onChange:X=>s(X.target.value),onKeyPress:X=>X.key==="Enter"&&h(),className:"flex-1"}),b.jsx(Cr,{type:"button",onClick:h,variant:"outline",size:"sm",children:"Search"})]}),b.jsx("div",{className:"flex gap-2",children:b.jsxs(Cr,{type:"button",onClick:m,variant:"outline",size:"sm",disabled:_,className:"flex items-center gap-2",children:[b.jsx(cY,{size:16}),_?"Getting Location...":"Use My Location"]})}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsx(Mn,{placeholder:"Latitude",type:"number",step:"any",value:e.latitude,onChange:X=>t(ie=>({...ie,latitude:X.target.value}))}),b.jsx(Mn,{placeholder:"Longitude",type:"number",step:"any",value:e.longitude,onChange:X=>t(ie=>({...ie,longitude:X.target.value}))})]}),e.latitude&&e.longitude&&b.jsxs("div",{className:"text-sm text-muted-foreground",children:["Coordinates: ",parseFloat(e.latitude).toFixed(6),", ",parseFloat(e.longitude).toFixed(6)]}),b.jsx("div",{id:"property-map",className:"w-full h-64 rounded-lg border border-border"})]})]}),b.jsxs("div",{className:"border border-border rounded-lg p-4",children:[b.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[b.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[b.jsx("input",{type:"radio",checked:i,onChange:()=>S(!0),className:"w-4 h-4"}),b.jsx("span",{className:"text-sm font-medium text-foreground",children:"Upload Images"})]}),b.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[b.jsx("input",{type:"radio",checked:!i,onChange:()=>S(!1),className:"w-4 h-4"}),b.jsx("span",{className:"text-sm font-medium text-foreground",children:"Image URLs"})]})]}),A.length>0&&b.jsxs("div",{className:"mb-4",children:[b.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Current Images"}),b.jsx("div",{className:"grid grid-cols-4 gap-2",children:A.map((X,ie)=>b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:X,alt:`Property ${ie+1}`,className:"w-full h-20 object-cover rounded-lg border border-border"}),b.jsx("button",{type:"button",onClick:()=>z(ie),className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx(oc,{size:12})})]},ie))})]}),i?b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[b.jsx(vY,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag and drop images here, or click to select"}),b.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:M,className:"hidden",id:"image-upload"}),b.jsx("label",{htmlFor:"image-upload",children:b.jsx(Cr,{type:"button",variant:"outline",size:"sm",asChild:!0,children:b.jsx("span",{children:"Choose Images"})})})]}),I&&b.jsx("div",{className:"mt-4",children:b.jsx("p",{className:"text-xs text-muted-foreground",children:I})})]}),b.jsx(fl,{placeholder:"Or enter image URLs (one per line)",value:e.images,onChange:X=>t(ie=>({...ie,images:X.target.value})),className:"min-h-20"})]}):b.jsx(fl,{placeholder:"Enter image URLs (one per line)",value:e.images,onChange:X=>t(ie=>({...ie,images:X.target.value})),className:"min-h-20"})]}),b.jsxs("div",{className:"border border-border rounded-lg p-4",children:[b.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[b.jsx(wL,{size:20}),"Property Videos"]}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[b.jsx(wL,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag and drop videos here, or click to select"}),b.jsx("input",{type:"file",multiple:!0,accept:"video/*",onChange:L,className:"hidden",id:"video-upload"}),b.jsx("label",{htmlFor:"video-upload",children:b.jsx(Cr,{type:"button",variant:"outline",size:"sm",asChild:!0,children:b.jsx("span",{children:"Choose Videos"})})})]})]}),b.jsx(fl,{placeholder:"Or enter video URLs (one per line)",value:e.videos,onChange:X=>t(ie=>({...ie,videos:X.target.value})),className:"min-h-20"})]})]})]})},Dje=({selectedProperties:e,openAddDialog:t,bulkUpdateStatus:n,bulkDeleteProperties:s})=>b.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-foreground",children:"Properties"}),b.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage all properties in your portfolio"})]}),b.jsxs("div",{className:"flex flex-wrap gap-3",children:[b.jsxs(Cr,{onClick:t,className:"bg-primary hover:bg-primary/90 inline-flex items-center gap-2",children:[b.jsx($ce,{className:"h-4 w-4 mr-2"}),"Add Property"]}),e.length>0&&b.jsxs("div",{className:"flex gap-2",children:[b.jsx(Cr,{onClick:()=>n("available"),variant:"outline",size:"sm",className:"text-green-600 border-green-600 hover:bg-green-50",children:"Mark Available"}),b.jsx(Cr,{onClick:()=>n("sold"),variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",children:"Mark Sold"}),b.jsx(Cr,{onClick:s,variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",children:"Delete Selected"})]})]})]}),kje=({searchQuery:e,setSearchQuery:t,statusFilter:n,setStatusFilter:s,typeFilter:h,setTypeFilter:m})=>b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[b.jsxs("div",{className:"relative flex-1",children:[b.jsx(ig,{className:"absolute left-3 top-3 text-muted-foreground",size:20}),b.jsx(Mn,{placeholder:"Search properties by title or location...",value:e,onChange:_=>t(_.target.value),className:"pl-10 py-2 h-10"})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsxs(Ou,{value:n,onValueChange:s,children:[b.jsx(Bc,{className:"w-32 h-10",children:b.jsx(Ru,{placeholder:"Status"})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"all",children:"All Status"}),b.jsx(Yi,{value:"available",children:"Available"}),b.jsx(Yi,{value:"pending",children:"Pending"}),b.jsx(Yi,{value:"sold",children:"Sold"})]})]}),b.jsxs(Ou,{value:h,onValueChange:m,children:[b.jsx(Bc,{className:"w-36 h-10",children:b.jsx(Ru,{placeholder:"Type"})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"all",children:"All Types"}),b.jsx(Yi,{value:"house",children:"House"}),b.jsx(Yi,{value:"apartment",children:"Apartment"}),b.jsx(Yi,{value:"land",children:"Land"}),b.jsx(Yi,{value:"plot",children:"Plot"}),b.jsx(Yi,{value:"commercial",children:"Commercial"})]})]})]})]});var tP="rovingFocusGroup.onEntryFocus",jje={bubbles:!1,cancelable:!0},tx="RovingFocusGroup",[II,yW,Lje]=O0(tx),[Nje,_W]=cc(tx,[Lje]),[zje,Fje]=Nje(tx),vW=B.forwardRef((e,t)=>b.jsx(II.Provider,{scope:e.__scopeRovingFocusGroup,children:b.jsx(II.Slot,{scope:e.__scopeRovingFocusGroup,children:b.jsx(Bje,{...e,ref:t})})}));vW.displayName=tx;var Bje=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:h=!1,dir:m,currentTabStopId:_,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:S,onEntryFocus:A,preventScrollOnEntryFocus:I=!1,...M}=e,L=B.useRef(null),z=li(t,L),G=LS(m),[F,U]=Wh({prop:_,defaultProp:i??null,onChange:S,caller:tx}),[K,J]=B.useState(!1),X=va(A),ie=yW(n),Q=B.useRef(!1),[ae,pe]=B.useState(0);return B.useEffect(()=>{const Pe=L.current;if(Pe)return Pe.addEventListener(tP,X),()=>Pe.removeEventListener(tP,X)},[X]),b.jsx(zje,{scope:n,orientation:s,dir:G,loop:h,currentTabStopId:F,onItemFocus:B.useCallback(Pe=>U(Pe),[U]),onItemShiftTab:B.useCallback(()=>J(!0),[]),onFocusableItemAdd:B.useCallback(()=>pe(Pe=>Pe+1),[]),onFocusableItemRemove:B.useCallback(()=>pe(Pe=>Pe-1),[]),children:b.jsx(En.div,{tabIndex:K||ae===0?-1:0,"data-orientation":s,...M,ref:z,style:{outline:"none",...e.style},onMouseDown:Ar(e.onMouseDown,()=>{Q.current=!0}),onFocus:Ar(e.onFocus,Pe=>{const Fe=!Q.current;if(Pe.target===Pe.currentTarget&&Fe&&!K){const tt=new CustomEvent(tP,jje);if(Pe.currentTarget.dispatchEvent(tt),!tt.defaultPrevented){const Be=ie().filter(He=>He.focusable),Ge=Be.find(He=>He.active),Qe=Be.find(He=>He.id===F),ct=[Ge,Qe,...Be].filter(Boolean).map(He=>He.ref.current);wW(ct,I)}}Q.current=!1}),onBlur:Ar(e.onBlur,()=>J(!1))})})}),xW="RovingFocusGroupItem",bW=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:h=!1,tabStopId:m,children:_,...i}=e,S=Du(),A=m||S,I=Fje(xW,n),M=I.currentTabStopId===A,L=yW(n),{onFocusableItemAdd:z,onFocusableItemRemove:G,currentTabStopId:F}=I;return B.useEffect(()=>{if(s)return z(),()=>G()},[s,z,G]),b.jsx(II.ItemSlot,{scope:n,id:A,focusable:s,active:h,children:b.jsx(En.span,{tabIndex:M?0:-1,"data-orientation":I.orientation,...i,ref:t,onMouseDown:Ar(e.onMouseDown,U=>{s?I.onItemFocus(A):U.preventDefault()}),onFocus:Ar(e.onFocus,()=>I.onItemFocus(A)),onKeyDown:Ar(e.onKeyDown,U=>{if(U.key==="Tab"&&U.shiftKey){I.onItemShiftTab();return}if(U.target!==U.currentTarget)return;const K=Uje(U,I.orientation,I.dir);if(K!==void 0){if(U.metaKey||U.ctrlKey||U.altKey||U.shiftKey)return;U.preventDefault();let X=L().filter(ie=>ie.focusable).map(ie=>ie.ref.current);if(K==="last")X.reverse();else if(K==="prev"||K==="next"){K==="prev"&&X.reverse();const ie=X.indexOf(U.currentTarget);X=I.loop?Gje(X,ie+1):X.slice(ie+1)}setTimeout(()=>wW(X))}}),children:typeof _=="function"?_({isCurrentTabStop:M,hasTabStop:F!=null}):_})})});bW.displayName=xW;var Vje={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $je(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Uje(e,t,n){const s=$je(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Vje[s]}function wW(e,t=!1){const n=document.activeElement;for(const s of e)if(s===n||(s.focus({preventScroll:t}),document.activeElement!==n))return}function Gje(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var Hje=vW,Wje=bW,MI=["Enter"," "],qje=["ArrowDown","PageUp","Home"],TW=["ArrowUp","PageDown","End"],Zje=[...qje,...TW],Xje={ltr:[...MI,"ArrowRight"],rtl:[...MI,"ArrowLeft"]},Kje={ltr:["ArrowLeft"],rtl:["ArrowRight"]},rx="Menu",[C0,Yje,Jje]=O0(rx),[$f,SW]=cc(rx,[Jje,$g,_W]),BS=$g(),EW=_W(),[Qje,Uf]=$f(rx),[eLe,nx]=$f(rx),AW=e=>{const{__scopeMenu:t,open:n=!1,children:s,dir:h,onOpenChange:m,modal:_=!0}=e,i=BS(t),[S,A]=B.useState(null),I=B.useRef(!1),M=va(m),L=LS(h);return B.useEffect(()=>{const z=()=>{I.current=!0,document.addEventListener("pointerdown",G,{capture:!0,once:!0}),document.addEventListener("pointermove",G,{capture:!0,once:!0})},G=()=>I.current=!1;return document.addEventListener("keydown",z,{capture:!0}),()=>{document.removeEventListener("keydown",z,{capture:!0}),document.removeEventListener("pointerdown",G,{capture:!0}),document.removeEventListener("pointermove",G,{capture:!0})}},[]),b.jsx(rV,{...i,children:b.jsx(Qje,{scope:t,open:n,onOpenChange:M,content:S,onContentChange:A,children:b.jsx(eLe,{scope:t,onClose:B.useCallback(()=>M(!1),[M]),isUsingKeyboardRef:I,dir:L,modal:_,children:s})})})};AW.displayName=rx;var tLe="MenuAnchor",nR=B.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e,h=BS(n);return b.jsx(JI,{...h,...s,ref:t})});nR.displayName=tLe;var iR="MenuPortal",[rLe,PW]=$f(iR,{forceMount:void 0}),CW=e=>{const{__scopeMenu:t,forceMount:n,children:s,container:h}=e,m=Uf(iR,t);return b.jsx(rLe,{scope:t,forceMount:n,children:b.jsx(uc,{present:n||m.open,children:b.jsx(R0,{asChild:!0,container:h,children:s})})})};CW.displayName=iR;var yl="MenuContent",[nLe,oR]=$f(yl),IW=B.forwardRef((e,t)=>{const n=PW(yl,e.__scopeMenu),{forceMount:s=n.forceMount,...h}=e,m=Uf(yl,e.__scopeMenu),_=nx(yl,e.__scopeMenu);return b.jsx(C0.Provider,{scope:e.__scopeMenu,children:b.jsx(uc,{present:s||m.open,children:b.jsx(C0.Slot,{scope:e.__scopeMenu,children:_.modal?b.jsx(iLe,{...h,ref:t}):b.jsx(oLe,{...h,ref:t})})})})}),iLe=B.forwardRef((e,t)=>{const n=Uf(yl,e.__scopeMenu),s=B.useRef(null),h=li(t,s);return B.useEffect(()=>{const m=s.current;if(m)return UM(m)},[]),b.jsx(sR,{...e,ref:h,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Ar(e.onFocusOutside,m=>m.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),oLe=B.forwardRef((e,t)=>{const n=Uf(yl,e.__scopeMenu);return b.jsx(sR,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),sLe=wf("MenuContent.ScrollLock"),sR=B.forwardRef((e,t)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:h,onOpenAutoFocus:m,onCloseAutoFocus:_,disableOutsidePointerEvents:i,onEntryFocus:S,onEscapeKeyDown:A,onPointerDownOutside:I,onFocusOutside:M,onInteractOutside:L,onDismiss:z,disableOutsideScroll:G,...F}=e,U=Uf(yl,n),K=nx(yl,n),J=BS(n),X=EW(n),ie=Yje(n),[Q,ae]=B.useState(null),pe=B.useRef(null),Pe=li(t,pe,U.onContentChange),Fe=B.useRef(0),tt=B.useRef(""),Be=B.useRef(0),Ge=B.useRef(null),Qe=B.useRef("right"),Ke=B.useRef(0),ct=G?UT:B.Fragment,He=G?{as:sLe,allowPinchZoom:!0}:void 0,qe=nt=>{const Kt=tt.current+nt,cr=ie().filter(lr=>!lr.disabled),Bt=document.activeElement,Vt=cr.find(lr=>lr.ref.current===Bt)?.textValue,xr=cr.map(lr=>lr.textValue),nn=_Le(xr,Kt,Vt),Hn=cr.find(lr=>lr.textValue===nn)?.ref.current;(function lr(an){tt.current=an,window.clearTimeout(Fe.current),an!==""&&(Fe.current=window.setTimeout(()=>lr(""),1e3))})(Kt),Hn&&setTimeout(()=>Hn.focus())};B.useEffect(()=>()=>window.clearTimeout(Fe.current),[]),$M();const ut=B.useCallback(nt=>Qe.current===Ge.current?.side&&xLe(nt,Ge.current?.area),[]);return b.jsx(nLe,{scope:n,searchRef:tt,onItemEnter:B.useCallback(nt=>{ut(nt)&&nt.preventDefault()},[ut]),onItemLeave:B.useCallback(nt=>{ut(nt)||(pe.current?.focus(),ae(null))},[ut]),onTriggerLeave:B.useCallback(nt=>{ut(nt)&&nt.preventDefault()},[ut]),pointerGraceTimerRef:Be,onPointerGraceIntentChange:B.useCallback(nt=>{Ge.current=nt},[]),children:b.jsx(ct,{...He,children:b.jsx(VT,{asChild:!0,trapped:h,onMountAutoFocus:Ar(m,nt=>{nt.preventDefault(),pe.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:_,children:b.jsx(zg,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:A,onPointerDownOutside:I,onFocusOutside:M,onInteractOutside:L,onDismiss:z,children:b.jsx(Hje,{asChild:!0,...X,dir:K.dir,orientation:"vertical",loop:s,currentTabStopId:Q,onCurrentTabStopIdChange:ae,onEntryFocus:Ar(S,nt=>{K.isUsingKeyboardRef.current||nt.preventDefault()}),preventScrollOnEntryFocus:!0,children:b.jsx(QI,{role:"menu","aria-orientation":"vertical","data-state":HW(U.open),"data-radix-menu-content":"",dir:K.dir,...J,...F,ref:Pe,style:{outline:"none",...F.style},onKeyDown:Ar(F.onKeyDown,nt=>{const cr=nt.target.closest("[data-radix-menu-content]")===nt.currentTarget,Bt=nt.ctrlKey||nt.altKey||nt.metaKey,Vt=nt.key.length===1;cr&&(nt.key==="Tab"&&nt.preventDefault(),!Bt&&Vt&&qe(nt.key));const xr=pe.current;if(nt.target!==xr||!Zje.includes(nt.key))return;nt.preventDefault();const Hn=ie().filter(lr=>!lr.disabled).map(lr=>lr.ref.current);TW.includes(nt.key)&&Hn.reverse(),gLe(Hn)}),onBlur:Ar(e.onBlur,nt=>{nt.currentTarget.contains(nt.target)||(window.clearTimeout(Fe.current),tt.current="")}),onPointerMove:Ar(e.onPointerMove,I0(nt=>{const Kt=nt.target,cr=Ke.current!==nt.clientX;if(nt.currentTarget.contains(Kt)&&cr){const Bt=nt.clientX>Ke.current?"right":"left";Qe.current=Bt,Ke.current=nt.clientX}}))})})})})})})});IW.displayName=yl;var aLe="MenuGroup",aR=B.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return b.jsx(En.div,{role:"group",...s,ref:t})});aR.displayName=aLe;var lLe="MenuLabel",MW=B.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return b.jsx(En.div,{...s,ref:t})});MW.displayName=lLe;var gT="MenuItem",C5="menu.itemSelect",VS=B.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:s,...h}=e,m=B.useRef(null),_=nx(gT,e.__scopeMenu),i=oR(gT,e.__scopeMenu),S=li(t,m),A=B.useRef(!1),I=()=>{const M=m.current;if(!n&&M){const L=new CustomEvent(C5,{bubbles:!0,cancelable:!0});M.addEventListener(C5,z=>s?.(z),{once:!0}),jI(M,L),L.defaultPrevented?A.current=!1:_.onClose()}};return b.jsx(OW,{...h,ref:S,disabled:n,onClick:Ar(e.onClick,I),onPointerDown:M=>{e.onPointerDown?.(M),A.current=!0},onPointerUp:Ar(e.onPointerUp,M=>{A.current||M.currentTarget?.click()}),onKeyDown:Ar(e.onKeyDown,M=>{const L=i.searchRef.current!=="";n||L&&M.key===" "||MI.includes(M.key)&&(M.currentTarget.click(),M.preventDefault())})})});VS.displayName=gT;var OW=B.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:s=!1,textValue:h,...m}=e,_=oR(gT,n),i=EW(n),S=B.useRef(null),A=li(t,S),[I,M]=B.useState(!1),[L,z]=B.useState("");return B.useEffect(()=>{const G=S.current;G&&z((G.textContent??"").trim())},[m.children]),b.jsx(C0.ItemSlot,{scope:n,disabled:s,textValue:h??L,children:b.jsx(Wje,{asChild:!0,...i,focusable:!s,children:b.jsx(En.div,{role:"menuitem","data-highlighted":I?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...m,ref:A,onPointerMove:Ar(e.onPointerMove,I0(G=>{s?_.onItemLeave(G):(_.onItemEnter(G),G.defaultPrevented||G.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ar(e.onPointerLeave,I0(G=>_.onItemLeave(G))),onFocus:Ar(e.onFocus,()=>M(!0)),onBlur:Ar(e.onBlur,()=>M(!1))})})})}),cLe="MenuCheckboxItem",RW=B.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:s,...h}=e;return b.jsx(NW,{scope:e.__scopeMenu,checked:n,children:b.jsx(VS,{role:"menuitemcheckbox","aria-checked":yT(n)?"mixed":n,...h,ref:t,"data-state":cR(n),onSelect:Ar(h.onSelect,()=>s?.(yT(n)?!0:!n),{checkForDefaultPrevented:!1})})})});RW.displayName=cLe;var DW="MenuRadioGroup",[uLe,hLe]=$f(DW,{value:void 0,onValueChange:()=>{}}),kW=B.forwardRef((e,t)=>{const{value:n,onValueChange:s,...h}=e,m=va(s);return b.jsx(uLe,{scope:e.__scopeMenu,value:n,onValueChange:m,children:b.jsx(aR,{...h,ref:t})})});kW.displayName=DW;var jW="MenuRadioItem",LW=B.forwardRef((e,t)=>{const{value:n,...s}=e,h=hLe(jW,e.__scopeMenu),m=n===h.value;return b.jsx(NW,{scope:e.__scopeMenu,checked:m,children:b.jsx(VS,{role:"menuitemradio","aria-checked":m,...s,ref:t,"data-state":cR(m),onSelect:Ar(s.onSelect,()=>h.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});LW.displayName=jW;var lR="MenuItemIndicator",[NW,dLe]=$f(lR,{checked:!1}),zW=B.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:s,...h}=e,m=dLe(lR,n);return b.jsx(uc,{present:s||yT(m.checked)||m.checked===!0,children:b.jsx(En.span,{...h,ref:t,"data-state":cR(m.checked)})})});zW.displayName=lR;var fLe="MenuSeparator",FW=B.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e;return b.jsx(En.div,{role:"separator","aria-orientation":"horizontal",...s,ref:t})});FW.displayName=fLe;var pLe="MenuArrow",BW=B.forwardRef((e,t)=>{const{__scopeMenu:n,...s}=e,h=BS(n);return b.jsx(eM,{...h,...s,ref:t})});BW.displayName=pLe;var mLe="MenuSub",[Lze,VW]=$f(mLe),Sv="MenuSubTrigger",$W=B.forwardRef((e,t)=>{const n=Uf(Sv,e.__scopeMenu),s=nx(Sv,e.__scopeMenu),h=VW(Sv,e.__scopeMenu),m=oR(Sv,e.__scopeMenu),_=B.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:S}=m,A={__scopeMenu:e.__scopeMenu},I=B.useCallback(()=>{_.current&&window.clearTimeout(_.current),_.current=null},[]);return B.useEffect(()=>I,[I]),B.useEffect(()=>{const M=i.current;return()=>{window.clearTimeout(M),S(null)}},[i,S]),b.jsx(nR,{asChild:!0,...A,children:b.jsx(OW,{id:h.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":h.contentId,"data-state":HW(n.open),...e,ref:vT(t,h.onTriggerChange),onClick:M=>{e.onClick?.(M),!(e.disabled||M.defaultPrevented)&&(M.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Ar(e.onPointerMove,I0(M=>{m.onItemEnter(M),!M.defaultPrevented&&!e.disabled&&!n.open&&!_.current&&(m.onPointerGraceIntentChange(null),_.current=window.setTimeout(()=>{n.onOpenChange(!0),I()},100))})),onPointerLeave:Ar(e.onPointerLeave,I0(M=>{I();const L=n.content?.getBoundingClientRect();if(L){const z=n.content?.dataset.side,G=z==="right",F=G?-5:5,U=L[G?"left":"right"],K=L[G?"right":"left"];m.onPointerGraceIntentChange({area:[{x:M.clientX+F,y:M.clientY},{x:U,y:L.top},{x:K,y:L.top},{x:K,y:L.bottom},{x:U,y:L.bottom}],side:z}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>m.onPointerGraceIntentChange(null),300)}else{if(m.onTriggerLeave(M),M.defaultPrevented)return;m.onPointerGraceIntentChange(null)}})),onKeyDown:Ar(e.onKeyDown,M=>{const L=m.searchRef.current!=="";e.disabled||L&&M.key===" "||Xje[s.dir].includes(M.key)&&(n.onOpenChange(!0),n.content?.focus(),M.preventDefault())})})})});$W.displayName=Sv;var UW="MenuSubContent",GW=B.forwardRef((e,t)=>{const n=PW(yl,e.__scopeMenu),{forceMount:s=n.forceMount,...h}=e,m=Uf(yl,e.__scopeMenu),_=nx(yl,e.__scopeMenu),i=VW(UW,e.__scopeMenu),S=B.useRef(null),A=li(t,S);return b.jsx(C0.Provider,{scope:e.__scopeMenu,children:b.jsx(uc,{present:s||m.open,children:b.jsx(C0.Slot,{scope:e.__scopeMenu,children:b.jsx(sR,{id:i.contentId,"aria-labelledby":i.triggerId,...h,ref:A,align:"start",side:_.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:I=>{_.isUsingKeyboardRef.current&&S.current?.focus(),I.preventDefault()},onCloseAutoFocus:I=>I.preventDefault(),onFocusOutside:Ar(e.onFocusOutside,I=>{I.target!==i.trigger&&m.onOpenChange(!1)}),onEscapeKeyDown:Ar(e.onEscapeKeyDown,I=>{_.onClose(),I.preventDefault()}),onKeyDown:Ar(e.onKeyDown,I=>{const M=I.currentTarget.contains(I.target),L=Kje[_.dir].includes(I.key);M&&L&&(m.onOpenChange(!1),i.trigger?.focus(),I.preventDefault())})})})})})});GW.displayName=UW;function HW(e){return e?"open":"closed"}function yT(e){return e==="indeterminate"}function cR(e){return yT(e)?"indeterminate":e?"checked":"unchecked"}function gLe(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function yLe(e,t){return e.map((n,s)=>e[(t+s)%e.length])}function _Le(e,t,n){const h=t.length>1&&Array.from(t).every(A=>A===t[0])?t[0]:t,m=n?e.indexOf(n):-1;let _=yLe(e,Math.max(m,0));h.length===1&&(_=_.filter(A=>A!==n));const S=_.find(A=>A.toLowerCase().startsWith(h.toLowerCase()));return S!==n?S:void 0}function vLe(e,t){const{x:n,y:s}=e;let h=!1;for(let m=0,_=t.length-1;m<t.length;_=m++){const i=t[m],S=t[_],A=i.x,I=i.y,M=S.x,L=S.y;I>s!=L>s&&n<(M-A)*(s-I)/(L-I)+A&&(h=!h)}return h}function xLe(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return vLe(n,t)}function I0(e){return t=>t.pointerType==="mouse"?e(t):void 0}var bLe=AW,wLe=nR,TLe=CW,SLe=IW,ELe=aR,ALe=MW,PLe=VS,CLe=RW,ILe=kW,MLe=LW,OLe=zW,RLe=FW,DLe=BW,kLe=$W,jLe=GW,$S="DropdownMenu",[LLe,Nze]=cc($S,[SW]),ra=SW(),[NLe,WW]=LLe($S),qW=e=>{const{__scopeDropdownMenu:t,children:n,dir:s,open:h,defaultOpen:m,onOpenChange:_,modal:i=!0}=e,S=ra(t),A=B.useRef(null),[I,M]=Wh({prop:h,defaultProp:m??!1,onChange:_,caller:$S});return b.jsx(NLe,{scope:t,triggerId:Du(),triggerRef:A,contentId:Du(),open:I,onOpenChange:M,onOpenToggle:B.useCallback(()=>M(L=>!L),[M]),modal:i,children:b.jsx(bLe,{...S,open:I,onOpenChange:M,dir:s,modal:i,children:n})})};qW.displayName=$S;var ZW="DropdownMenuTrigger",XW=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...h}=e,m=WW(ZW,n),_=ra(n);return b.jsx(wLe,{asChild:!0,..._,children:b.jsx(En.button,{type:"button",id:m.triggerId,"aria-haspopup":"menu","aria-expanded":m.open,"aria-controls":m.open?m.contentId:void 0,"data-state":m.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...h,ref:vT(t,m.triggerRef),onPointerDown:Ar(e.onPointerDown,i=>{!s&&i.button===0&&i.ctrlKey===!1&&(m.onOpenToggle(),m.open||i.preventDefault())}),onKeyDown:Ar(e.onKeyDown,i=>{s||(["Enter"," "].includes(i.key)&&m.onOpenToggle(),i.key==="ArrowDown"&&m.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});XW.displayName=ZW;var zLe="DropdownMenuPortal",KW=e=>{const{__scopeDropdownMenu:t,...n}=e,s=ra(t);return b.jsx(TLe,{...s,...n})};KW.displayName=zLe;var YW="DropdownMenuContent",JW=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=WW(YW,n),m=ra(n),_=B.useRef(!1);return b.jsx(SLe,{id:h.contentId,"aria-labelledby":h.triggerId,...m,...s,ref:t,onCloseAutoFocus:Ar(e.onCloseAutoFocus,i=>{_.current||h.triggerRef.current?.focus(),_.current=!1,i.preventDefault()}),onInteractOutside:Ar(e.onInteractOutside,i=>{const S=i.detail.originalEvent,A=S.button===0&&S.ctrlKey===!0,I=S.button===2||A;(!h.modal||I)&&(_.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});JW.displayName=YW;var FLe="DropdownMenuGroup",BLe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(ELe,{...h,...s,ref:t})});BLe.displayName=FLe;var VLe="DropdownMenuLabel",QW=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(ALe,{...h,...s,ref:t})});QW.displayName=VLe;var $Le="DropdownMenuItem",eq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(PLe,{...h,...s,ref:t})});eq.displayName=$Le;var ULe="DropdownMenuCheckboxItem",tq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(CLe,{...h,...s,ref:t})});tq.displayName=ULe;var GLe="DropdownMenuRadioGroup",HLe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(ILe,{...h,...s,ref:t})});HLe.displayName=GLe;var WLe="DropdownMenuRadioItem",rq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(MLe,{...h,...s,ref:t})});rq.displayName=WLe;var qLe="DropdownMenuItemIndicator",nq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(OLe,{...h,...s,ref:t})});nq.displayName=qLe;var ZLe="DropdownMenuSeparator",iq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(RLe,{...h,...s,ref:t})});iq.displayName=ZLe;var XLe="DropdownMenuArrow",KLe=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(DLe,{...h,...s,ref:t})});KLe.displayName=XLe;var YLe="DropdownMenuSubTrigger",oq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(kLe,{...h,...s,ref:t})});oq.displayName=YLe;var JLe="DropdownMenuSubContent",sq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...s}=e,h=ra(n);return b.jsx(jLe,{...h,...s,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});sq.displayName=JLe;var QLe=qW,eNe=XW,tNe=KW,aq=JW,lq=QW,cq=eq,uq=tq,hq=rq,dq=nq,fq=iq,pq=oq,mq=sq;const rNe=QLe,nNe=eNe,iNe=B.forwardRef(({className:e,inset:t,children:n,...s},h)=>b.jsxs(pq,{ref:h,className:Wr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...s,children:[n,b.jsx(BI,{className:"ml-auto h-4 w-4"})]}));iNe.displayName=pq.displayName;const oNe=B.forwardRef(({className:e,...t},n)=>b.jsx(mq,{ref:n,className:Wr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));oNe.displayName=mq.displayName;const gq=B.forwardRef(({className:e,sideOffset:t=4,...n},s)=>b.jsx(tNe,{children:b.jsx(aq,{ref:s,sideOffset:t,className:Wr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));gq.displayName=aq.displayName;const uf=B.forwardRef(({className:e,inset:t,...n},s)=>b.jsx(cq,{ref:s,className:Wr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...n}));uf.displayName=cq.displayName;const sNe=B.forwardRef(({className:e,children:t,checked:n,...s},h)=>b.jsxs(uq,{ref:h,className:Wr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:n,...s,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(dq,{children:b.jsx(wT,{className:"h-4 w-4"})})}),t]}));sNe.displayName=uq.displayName;const aNe=B.forwardRef(({className:e,children:t,...n},s)=>b.jsxs(hq,{ref:s,className:Wr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(dq,{children:b.jsx(KK,{className:"h-2 w-2 fill-current"})})}),t]}));aNe.displayName=hq.displayName;const lNe=B.forwardRef(({className:e,inset:t,...n},s)=>b.jsx(lq,{ref:s,className:Wr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));lNe.displayName=lq.displayName;const cNe=B.forwardRef(({className:e,...t},n)=>b.jsx(fq,{ref:n,className:Wr("-mx-1 my-1 h-px bg-muted",e),...t}));cNe.displayName=fq.displayName;const uNe=({properties:e,loading:t,filteredProperties:n,selectedProperties:s,setSelectedProperties:h,updateStatus:m,openEditDialog:_,deleteProperty:i,shareToFacebook:S,shareToTwitter:A,shareToWhatsApp:I,shareToTelegram:M,shareToInstagram:L,shareToTikTok:z})=>b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:t?b.jsxs("div",{className:"p-8 text-center",children:[b.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-muted border-t-primary rounded-full"}),b.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading properties..."})]}):n.length===0?b.jsx("div",{className:"p-8 text-center",children:b.jsx("p",{className:"text-muted-foreground text-lg",children:"No properties found matching your filters"})}):b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"w-full",children:[b.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:b.jsxs("tr",{children:[b.jsx("th",{className:"px-4 py-4 text-left",children:b.jsx("input",{type:"checkbox",checked:s.length===n.length&&n.length>0,onChange:G=>{G.target.checked?h(n.map(F=>F.id)):h([])},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Property"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden md:table-cell",children:"Location"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden lg:table-cell",children:"Price"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Status"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden sm:table-cell",children:"Type"}),b.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-foreground",children:"Actions"})]})}),b.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:n.map(G=>b.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[b.jsx("td",{className:"px-4 py-4",children:b.jsx("input",{type:"checkbox",checked:s.includes(G.id),onChange:F=>{F.target.checked?h([...s,G.id]):h(s.filter(U=>U!==G.id))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),b.jsx("td",{className:"px-6 py-4",children:b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("div",{className:"relative",children:[G.images?.[0]?b.jsx("img",{src:G.images[0],alt:G.title,className:"w-12 h-12 rounded-lg object-cover"}):b.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:b.jsx(Bce,{className:"h-5 w-5 text-muted-foreground"})}),G.video_url&&b.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full p-1",children:b.jsx(Kce,{className:"h-3 w-3"})})]}),b.jsxs("div",{className:"min-w-0 flex-1",children:[b.jsx("div",{className:"font-medium text-foreground truncate",children:G.title}),b.jsx("div",{className:"text-xs text-muted-foreground md:hidden",children:G.location}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[G.images?.length||0," img",G.video_url?", 1 vid":""]})]})]})}),b.jsx("td",{className:"px-6 py-4 text-muted-foreground hidden md:table-cell",children:G.location||""}),b.jsxs("td",{className:"px-6 py-4 font-medium text-foreground hidden lg:table-cell",children:["KES ",Number(G.price||0).toLocaleString()]}),b.jsx("td",{className:"px-6 py-4",children:b.jsxs(Ou,{value:G.status||"available",onValueChange:F=>m(G.id,F),children:[b.jsx(Bc,{className:"w-24 h-8 text-xs",children:b.jsx(Ru,{})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"available",children:"Available"}),b.jsx(Yi,{value:"sold",children:"Sold"}),b.jsx(Yi,{value:"pending",children:"Pending"})]})]})}),b.jsx("td",{className:"px-6 py-4 hidden sm:table-cell",children:b.jsx(Us,{variant:"outline",className:"capitalize text-xs",children:G.property_type||"land"})}),b.jsx("td",{className:"px-6 py-4",children:b.jsxs("div",{className:"flex items-center justify-center gap-1",children:[b.jsx(Cr,{size:"sm",variant:"ghost",onClick:()=>_(G),className:"h-8 w-8 p-0 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white",children:b.jsx(zce,{className:"h-4 w-4"})}),b.jsxs(rNe,{children:[b.jsx(nNe,{asChild:!0,children:b.jsx(Cr,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-primary hover:text-primary/80 hover:bg-primary/5",children:b.jsx(Gce,{className:"h-4 w-4"})})}),b.jsxs(gq,{align:"end",className:"w-48",children:[b.jsxs(uf,{onClick:()=>S(G),className:"flex items-center gap-2",children:[b.jsx(Dce,{className:"h-4 w-4 text-blue-600"}),"Share on Facebook"]}),b.jsxs(uf,{onClick:()=>A(G),className:"flex items-center gap-2",children:[b.jsx(bce,{className:"h-4 w-4 text-blue-400"}),"Share on X (Twitter)"]}),b.jsxs(uf,{onClick:()=>I(G),className:"flex items-center gap-2",children:[b.jsx(e6,{className:"h-4 w-4 text-green-600"}),"Share on WhatsApp"]}),b.jsxs(uf,{onClick:()=>M(G),className:"flex items-center gap-2",children:[b.jsx(Lce,{className:"h-4 w-4 text-blue-500"}),"Share on Telegram"]}),b.jsxs(uf,{onClick:()=>L(G),className:"flex items-center gap-2",children:[b.jsx(Ece,{className:"h-4 w-4 text-pink-600"}),"Copy for Instagram"]}),b.jsxs(uf,{onClick:()=>z(G),className:"flex items-center gap-2",children:[b.jsx("div",{className:"w-4 h-4 bg-black rounded-sm flex items-center justify-center",children:b.jsx("span",{className:"text-white text-xs font-bold",children:"T"})}),"Copy for TikTok"]})]})]}),b.jsx(Cr,{size:"sm",variant:"ghost",onClick:()=>i(G.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-950",children:b.jsx(T4,{size:16})})]})})]},G.id))})]})})}),rP="https://fakkzdfwpucpgndofgcu.supabase.co",nP={title:"",location:"",price:"",property_type:"land",description:"",seller_name:"",seller_phone:"",size:"",images:"",videos:"",latitude:"",longitude:"",bathrooms:""},hNe=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(!1),[_,i]=B.useState(!1),[S,A]=B.useState(null),[I,M]=B.useState(nP),[L,z]=B.useState(!0);B.useState(!0);const[G,F]=B.useState([]),[U,K]=B.useState([]),[J,X]=B.useState([]),[ie,Q]=B.useState([]),[ae,pe]=B.useState(null),[Pe,Fe]=B.useState(""),[tt,Be]=B.useState("all"),[Ge,Qe]=B.useState("all"),[Ke,ct]=B.useState([]);B.useState(!1);const[He,qe]=B.useState(""),[ut,nt]=B.useState(null),[Kt,cr]=B.useState(null),[Bt,Vt]=B.useState(""),[xr,nn]=B.useState(!1),Hn=e.filter(Zt=>Zt.title.toLowerCase().includes(Pe.toLowerCase())||Zt.location.toLowerCase().includes(Pe.toLowerCase())).filter(Zt=>!(tt!=="all"&&Zt.status!==tt||Ge!=="all"&&Zt.property_type!==Ge));B.useEffect(()=>{lr()},[]),B.useEffect(()=>{(async()=>{try{const qt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",Ir=await(await eJ(`${rP}/functions/v1/get-mapbox-token`,{headers:{"Content-Type":"application/json",apikey:qt,Authorization:`Bearer ${qt}`}},1e4)).json();Ir.token&&qe(Ir.token)}catch(qt){console.error("Failed to fetch Mapbox token:",qt)}})()},[]),B.useEffect(()=>{if(!_||!He)return;const Zt=setTimeout(()=>{const qt=document.getElementById("property-map");if(!qt)return;const fr=I.latitude?parseFloat(I.latitude):-1.2921,Ir=I.longitude?parseFloat(I.longitude):36.8219;M1.accessToken=He;const On=new M1.Map({container:qt,style:"mapbox://styles/mapbox/streets-v12",center:[Ir,fr],zoom:I.latitude&&I.longitude?15:10});On.addControl(new M1.NavigationControl,"top-right");const Ii=new M1.Marker({color:"#2563eb",draggable:!0}).setLngLat([Ir,fr]).addTo(On);return Ii.on("dragend",()=>{const eo=Ii.getLngLat();M(ko=>({...ko,latitude:eo.lat.toString(),longitude:eo.lng.toString()}))}),nt(On),cr(Ii),()=>{On.remove(),nt(null),cr(null)}},100);return()=>clearTimeout(Zt)},[_,He,I.latitude,I.longitude]),B.useEffect(()=>{if(Kt&&I.latitude&&I.longitude){const Zt=parseFloat(I.latitude),qt=parseFloat(I.longitude);Kt.setLngLat([qt,Zt]),ut?.setCenter([qt,Zt])}},[I.latitude,I.longitude,Kt,ut]);const lr=async()=>{s(!0);const{data:Zt,error:qt}=await Er.from("properties").select("*").order("created_at",{ascending:!1});qt&&console.error(qt),t(Zt||[]),s(!1)},an=async(Zt,qt)=>{try{await Er.from("properties").update({status:qt}).eq("id",Zt),t(fr=>fr.map(Ir=>Ir.id===Zt?{...Ir,status:qt}:Ir))}catch(fr){console.error(fr),rn({title:"Error",description:"Failed to update status",variant:"destructive"})}},Lt=Zt=>{const fr=Array.from(Zt.target.files||[]).filter(On=>On.size>5*1024*1024?(rn({title:"File too large",description:`${On.name} exceeds 5MB limit`,variant:"destructive"}),!1):["image/jpeg","image/png","image/webp","image/gif"].includes(On.type)?!0:(rn({title:"Invalid file type",description:`${On.name} is not a supported image format`,variant:"destructive"}),!1));if(U.length+G.length+fr.length>10){rn({title:"Too many images",description:"Maximum 10 images allowed",variant:"destructive"});return}F(On=>[...On,...fr])},nr=Zt=>{const fr=Array.from(Zt.target.files||[]).filter(On=>On.size>50*1024*1024?(rn({title:"File too large",description:`${On.name} exceeds 50MB limit`,variant:"destructive"}),!1):["video/mp4","video/avi","video/mov","video/wmv","video/webm"].includes(On.type)?!0:(rn({title:"Invalid file type",description:`${On.name} is not a supported video format`,variant:"destructive"}),!1));if(ie.length+J.length+fr.length>3){rn({title:"Too many videos",description:"Maximum 3 videos allowed",variant:"destructive"});return}X(On=>[...On,...fr])},pr=Lt,Nt=nr,Nr=Zt=>{K(qt=>qt.filter((fr,Ir)=>Ir!==Zt))},un=Zt=>{Q(qt=>qt.filter((fr,Ir)=>Ir!==Zt))},ci=()=>{if(nn(!0),!navigator.geolocation){rn({title:"Error",description:"Geolocation is not supported by this browser.",variant:"destructive"}),nn(!1);return}navigator.geolocation.getCurrentPosition(Zt=>{const{latitude:qt,longitude:fr}=Zt.coords;M(Ir=>({...Ir,latitude:qt.toString(),longitude:fr.toString()})),rn({title:"Location captured",description:"Your current location has been set."}),nn(!1)},Zt=>{console.error("Geolocation error:",Zt),rn({title:"Location error",description:"Failed to get your location. Please check permissions.",variant:"destructive"}),nn(!1)},{enableHighAccuracy:!0,timeout:1e4})},Un=async()=>{if(!(!Bt.trim()||!He))try{const qt=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Bt)}.json?access_token=${He}&limit=1`)).json();if(qt.features&&qt.features.length>0){const[fr,Ir]=qt.features[0].center;M(On=>({...On,latitude:Ir.toString(),longitude:fr.toString()})),rn({title:"Location found",description:`Coordinates set for: ${qt.features[0].place_name}`})}else rn({title:"Location not found",description:"Please try a different search term.",variant:"destructive"})}catch(Zt){console.error("Geocoding error:",Zt),rn({title:"Search error",description:"Failed to search location.",variant:"destructive"})}},zn=Zt=>{const qt=Zt.title,fr=`KES ${Number(Zt.price||0).toLocaleString()}`,Ir=Zt.location||"Kenya",On=`https://julina.co.ke/properties/${Zt.id}`,Ii=Zt.images?.[0]||"";return{title:qt,price:fr,location:Ir,propertyUrl:On,imageUrl:Ii,description:`${qt} - ${fr} located in ${Ir}. View more details and contact seller.`}},Kn=Zt=>{const qt=zn(Zt),fr=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(qt.propertyUrl)}&quote=${encodeURIComponent(qt.description)}`;window.open(fr,"_blank","width=600,height=400")},ks=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}. ${qt.propertyUrl}`,Ir=`https://twitter.com/intent/tweet?text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank","width=600,height=400")},ds=Zt=>{const qt=zn(Zt),fr=`*${qt.title}*

 Price: ${qt.price}
 Location: ${qt.location}

${qt.description}

View details: ${qt.propertyUrl}`,Ir=`https://wa.me/?text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank")},ao=Zt=>{const qt=zn(Zt),fr=`${qt.title}

 ${qt.price}
 ${qt.location}

${qt.description}

${qt.propertyUrl}`,Ir=`https://t.me/share/url?url=${encodeURIComponent(qt.propertyUrl)}&text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank")},bo=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}

${qt.description}

View: ${qt.propertyUrl}`;navigator.clipboard.writeText(fr).then(()=>{rn({title:"Copied to clipboard",description:"Paste this content into Instagram"})}).catch(()=>{rn({title:"Copy failed",description:"Please copy the content manually",variant:"destructive"})})},mo=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}

${qt.description}

View: ${qt.propertyUrl}`;navigator.clipboard.writeText(fr).then(()=>{rn({title:"Copied to clipboard",description:"Paste this content into TikTok"})}).catch(()=>{rn({title:"Copy failed",description:"Please copy the content manually",variant:"destructive"})})},Hi=async Zt=>{const qt=[];for(let fr=0;fr<J.length;fr++){const Ir=J[fr];pe(`Uploading video ${fr+1}/${J.length}...`);const On=Ir.name.split(".").pop(),Ii=`${Zt}/videos/${Date.now()}-${fr}.${On}`,{error:eo}=await Er.storage.from("property-images").upload(Ii,Ir,{cacheControl:"3600",upsert:!1});if(eo)throw console.error("Video upload error:",eo),new Error(`Failed to upload ${Ir.name}: ${eo.message}`);const ko=`${rP}/storage/v1/object/public/property-images/${Ii}`;qt.push(ko)}return qt},Yo=async Zt=>{const qt=[];for(let fr=0;fr<G.length;fr++){const Ir=G[fr];pe(`Uploading image ${fr+1}/${G.length}...`);const On=Ir.name.split(".").pop(),Ii=`${Zt}/images/${Date.now()}-${fr}.${On}`,{error:eo}=await Er.storage.from("property-images").upload(Ii,Ir,{cacheControl:"3600",upsert:!1});if(eo)throw console.error("Image upload error:",eo),new Error(`Failed to upload ${Ir.name}: ${eo.message}`);const ko=`${rP}/storage/v1/object/public/property-images/${Ii}`;qt.push(ko)}return qt},wo=()=>{A(null),M(nP),F([]),X([]),K([]),Q([]),z(!0),i(!0)},Po=Zt=>{A(Zt.id),M({title:Zt.title||"",location:Zt.location||"",price:Zt.price?.toString()||"",property_type:Zt.property_type||"land",description:Zt.description||"",seller_name:Zt.seller_name||"",seller_phone:Zt.seller_phone||"",size:Zt.size||"",images:"",videos:"",latitude:Zt.latitude?.toString()||"",longitude:Zt.longitude?.toString()||"",bathrooms:Zt.bathrooms?.toString()||""}),K(Zt.images||[]),Q(Zt.video_url?[Zt.video_url]:[]),F([]),X([]),z(!0),i(!0)},Gs=async()=>{m(!0);try{if(!I.title.trim())throw new Error("Title is required");if(!I.location.trim())throw new Error("Location is required");if(!I.price||Number(I.price)<=0)throw new Error("Price must be a positive number");let Zt=[...U],qt=[...ie];const fr=Mi=>Mi?Mi.split(/\s|,|\n/).map(ln=>ln.trim()).filter(Boolean):[],Ir=Mi=>/^(https?:\/\/|data:|\/\/)/i.test(Mi),On=fr(I.images).filter(Ir),Ii=fr(I.videos).filter(Ir);if(Zt=[...Zt,...On],qt=[...qt,...Ii],Zt.length+G.length>10)throw new Error("Maximum 10 images allowed. Please remove some images or URLs.");if(qt.length+J.length>3)throw new Error("Maximum 3 videos allowed. Please remove some videos or URLs.");let Io=I.description.trim();try{if(!Io&&I.title.trim()){const Mi=Er.functions.invoke("chat",{body:{type:"enhance_description",title:I.title.trim(),description:I.description,isAdmin:!0}}),ln=8e3,si=await Promise.race([Mi,new Promise(on=>setTimeout(()=>on({error:"timeout"}),ln))]);try{const on=si;if(!(!on||on.error)){const Wn=on.data;if(typeof Wn=="string")Io=Wn;else if(Wn&&typeof Wn=="object"){const Yn=Wn,jo=Yn.response??Yn.reply??Yn.message??Yn.enhanced;Io=typeof jo=="string"?jo:""}else Io=""}}catch(on){console.warn("AI response parsing failed, continuing without it",on)}}}catch(Mi){console.warn("AI description generation failed, continuing without it",Mi)}const wa={title:I.title.trim(),description:Io||null,property_type:I.property_type,price:Number(I.price),location:I.location.trim(),size:I.size.trim()||null,seller_name:I.seller_name.trim()||null,seller_phone:I.seller_phone.trim()||null,latitude:I.latitude?Number(I.latitude):null,longitude:I.longitude?Number(I.longitude):null,bathrooms:I.bathrooms?Number(I.bathrooms):null,is_admin_property:!0,updated_at:new Date().toISOString()};if(S){if(L&&G.length>0){const ln=await Yo(S);Zt=[...Zt,...ln]}if(L&&J.length>0){const ln=await Hi(S);qt=[...qt,...ln]}const{error:Mi}=await Er.from("properties").update({...wa,images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null}).eq("id",S);if(Mi)throw Mi;t(ln=>ln.map(si=>si.id===S?{...si,...wa,images:Zt,video_url:qt[0]||null}:si)),rn({title:"Success",description:"Property updated successfully."})}else{const{data:Mi,error:ln}=await Er.from("properties").insert({...wa,images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null,status:"available"}).select().single();if(ln)throw ln;if(L&&G.length>0){const si=await Yo(Mi.id);Zt=[...Zt,...si]}if(L&&J.length>0){const si=await Hi(Mi.id);qt=[...qt,...si]}if(L&&G.length>0||L&&J.length>0){const{error:si}=await Er.from("properties").update({images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null}).eq("id",Mi.id);if(si)throw si;Mi.images=Zt,Mi.video_url=qt[0]||null}t(si=>[Mi,...si]),rn({title:"Success",description:"Property created successfully."})}i(!1),M(nP),F([]),K([]),A(null)}catch(Zt){console.error(Zt);const qt=Zt instanceof Error?Zt.message:String(Zt);rn({title:"Error",description:qt||"Failed to save property.",variant:"destructive"})}finally{m(!1),pe("")}},Co=async Zt=>{if(confirm("Are you sure you want to delete this property?"))try{const qt=e.find(Ir=>Ir.id===Zt);if(qt?.images?.length){const Ir=qt.images.map(On=>{const Ii=On.match(/property-images\/(.+)$/);return Ii?Ii[1]:null}).filter(Boolean);Ir.length>0&&await Er.storage.from("property-images").remove(Ir)}const{error:fr}=await Er.from("properties").delete().eq("id",Zt);if(fr)throw fr;t(Ir=>Ir.filter(On=>On.id!==Zt)),rn({title:"Deleted",description:"Property removed successfully."})}catch(qt){console.error(qt);const fr=qt instanceof Error?qt.message:String(qt);rn({title:"Error",description:fr||"Failed to delete property.",variant:"destructive"})}},js=async()=>{if(confirm(`Are you sure you want to delete ${Ke.length} properties?`))try{s(!0);for(const qt of Ke){const fr=e.find(Ir=>Ir.id===qt);if(fr?.images?.length){const Ir=fr.images.map(On=>{const Ii=On.match(/property-images\/(.+)$/);return Ii?Ii[1]:null}).filter(Boolean);Ir.length>0&&await Er.storage.from("property-images").remove(Ir)}}const{error:Zt}=await Er.from("properties").delete().in("id",Ke);if(Zt)throw Zt;t(qt=>qt.filter(fr=>!Ke.includes(fr.id))),ct([]),rn({title:"Deleted",description:`${Ke.length} properties removed successfully.`})}catch(Zt){console.error(Zt);const qt=Zt instanceof Error?Zt.message:String(Zt);rn({title:"Error",description:qt||"Failed to delete properties.",variant:"destructive"})}finally{s(!1)}},ba=async Zt=>{try{s(!0);const{error:qt}=await Er.from("properties").update({status:Zt,updated_at:new Date().toISOString()}).in("id",Ke);if(qt)throw qt;t(fr=>fr.map(Ir=>Ke.includes(Ir.id)?{...Ir,status:Zt}:Ir)),ct([]),rn({title:"Updated",description:`${Ke.length} properties updated to ${Zt}.`})}catch(qt){console.error(qt);const fr=qt instanceof Error?qt.message:String(qt);rn({title:"Error",description:fr||"Failed to update properties.",variant:"destructive"})}finally{s(!1)}};return b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsx(Dje,{selectedProperties:Ke,openAddDialog:wo,bulkUpdateStatus:ba,bulkDeleteProperties:js}),b.jsx(kje,{searchQuery:Pe,setSearchQuery:Fe,statusFilter:tt,setStatusFilter:Be,typeFilter:Ge,setTypeFilter:Qe}),b.jsx(uNe,{properties:e,loading:n,filteredProperties:Hn,selectedProperties:Ke,setSelectedProperties:ct,updateStatus:an,openEditDialog:Po,deleteProperty:Co,shareToFacebook:Kn,shareToTwitter:ks,shareToWhatsApp:ds,shareToTelegram:ao,shareToInstagram:bo,shareToTikTok:mo}),b.jsx(Vu,{open:_,onOpenChange:Zt=>{i(Zt),Zt||(F([]),X([]),pe(""),A(null),Vt(""),nn(!1),ut&&(ut.remove(),nt(null),cr(null)))},children:b.jsxs(Kc,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsxs(Qh,{children:[b.jsx(qu,{className:"text-2xl",children:S?"Edit Property":"Add New Property"}),b.jsx(qM,{children:S?"Update the property details below.":"Fill in the details to add a new property."})]}),b.jsx(Rje,{form:I,setForm:M,locationSearch:Bt,setLocationSearch:Vt,searchLocation:Un,getCurrentLocation:ci,isLocating:xr,useUpload:L,setUseUpload:z,existingImages:U,uploadProgress:ae,handleImageUpload:pr,handleVideoUpload:Nt,removeImage:Nr,removeVideo:un}),b.jsxs(U0,{children:[b.jsx(Cr,{variant:"outline",onClick:()=>i(!1),disabled:h,children:"Cancel"}),b.jsx(Cr,{onClick:Gs,disabled:h,className:"bg-primary hover:bg-primary/90",children:h?ae||"Saving...":S?"Update Property":"Create Property"})]})]})})]})})},uR=B.forwardRef(({className:e,...t},n)=>b.jsx("div",{className:"relative w-full overflow-auto",children:b.jsx("table",{ref:n,className:Wr("w-full caption-bottom text-sm",e),...t})}));uR.displayName="Table";const hR=B.forwardRef(({className:e,...t},n)=>b.jsx("thead",{ref:n,className:Wr("[&_tr]:border-b",e),...t}));hR.displayName="TableHeader";const dR=B.forwardRef(({className:e,...t},n)=>b.jsx("tbody",{ref:n,className:Wr("[&_tr:last-child]:border-0",e),...t}));dR.displayName="TableBody";const dNe=B.forwardRef(({className:e,...t},n)=>b.jsx("tfoot",{ref:n,className:Wr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));dNe.displayName="TableFooter";const M0=B.forwardRef(({className:e,...t},n)=>b.jsx("tr",{ref:n,className:Wr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));M0.displayName="TableRow";const ul=B.forwardRef(({className:e,...t},n)=>b.jsx("th",{ref:n,className:Wr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));ul.displayName="TableHead";const hl=B.forwardRef(({className:e,...t},n)=>b.jsx("td",{ref:n,className:Wr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));hl.displayName="TableCell";const fNe=B.forwardRef(({className:e,...t},n)=>b.jsx("caption",{ref:n,className:Wr("mt-4 text-sm text-muted-foreground",e),...t}));fNe.displayName="TableCaption";var pNe="Label",yq=B.forwardRef((e,t)=>b.jsx(En.label,{...e,ref:t,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(e.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));yq.displayName=pNe;var _q=yq;const mNe=k0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),$i=B.forwardRef(({className:e,...t},n)=>b.jsx(_q,{ref:n,className:Wr(mNe(),e),...t}));$i.displayName=_q.displayName;var US="Checkbox",[gNe,zze]=cc(US),[yNe,fR]=gNe(US);function _Ne(e){const{__scopeCheckbox:t,checked:n,children:s,defaultChecked:h,disabled:m,form:_,name:i,onCheckedChange:S,required:A,value:I="on",internal_do_not_use_render:M}=e,[L,z]=Wh({prop:n,defaultProp:h??!1,onChange:S,caller:US}),[G,F]=B.useState(null),[U,K]=B.useState(null),J=B.useRef(!1),X=G?!!_||!!G.closest("form"):!0,ie={checked:L,disabled:m,setChecked:z,control:G,setControl:F,name:i,form:_,value:I,hasConsumerStoppedPropagationRef:J,required:A,defaultChecked:Hh(h)?!1:h,isFormControl:X,bubbleInput:U,setBubbleInput:K};return b.jsx(yNe,{scope:t,...ie,children:vNe(M)?M(ie):s})}var vq="CheckboxTrigger",xq=B.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...s},h)=>{const{control:m,value:_,disabled:i,checked:S,required:A,setControl:I,setChecked:M,hasConsumerStoppedPropagationRef:L,isFormControl:z,bubbleInput:G}=fR(vq,e),F=li(h,I),U=B.useRef(S);return B.useEffect(()=>{const K=m?.form;if(K){const J=()=>M(U.current);return K.addEventListener("reset",J),()=>K.removeEventListener("reset",J)}},[m,M]),b.jsx(En.button,{type:"button",role:"checkbox","aria-checked":Hh(S)?"mixed":S,"aria-required":A,"data-state":Eq(S),"data-disabled":i?"":void 0,disabled:i,value:_,...s,ref:F,onKeyDown:Ar(t,K=>{K.key==="Enter"&&K.preventDefault()}),onClick:Ar(n,K=>{M(J=>Hh(J)?!0:!J),G&&z&&(L.current=K.isPropagationStopped(),L.current||K.stopPropagation())})})});xq.displayName=vq;var pR=B.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:s,checked:h,defaultChecked:m,required:_,disabled:i,value:S,onCheckedChange:A,form:I,...M}=e;return b.jsx(_Ne,{__scopeCheckbox:n,checked:h,defaultChecked:m,disabled:i,required:_,onCheckedChange:A,name:s,form:I,value:S,internal_do_not_use_render:({isFormControl:L})=>b.jsxs(b.Fragment,{children:[b.jsx(xq,{...M,ref:t,__scopeCheckbox:n}),L&&b.jsx(Sq,{__scopeCheckbox:n})]})})});pR.displayName=US;var bq="CheckboxIndicator",wq=B.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:s,...h}=e,m=fR(bq,n);return b.jsx(uc,{present:s||Hh(m.checked)||m.checked===!0,children:b.jsx(En.span,{"data-state":Eq(m.checked),"data-disabled":m.disabled?"":void 0,...h,ref:t,style:{pointerEvents:"none",...e.style}})})});wq.displayName=bq;var Tq="CheckboxBubbleInput",Sq=B.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:s,hasConsumerStoppedPropagationRef:h,checked:m,defaultChecked:_,required:i,disabled:S,name:A,value:I,form:M,bubbleInput:L,setBubbleInput:z}=fR(Tq,e),G=li(n,z),F=tR(m),U=XI(s);B.useEffect(()=>{const J=L;if(!J)return;const X=window.HTMLInputElement.prototype,Q=Object.getOwnPropertyDescriptor(X,"checked").set,ae=!h.current;if(F!==m&&Q){const pe=new Event("click",{bubbles:ae});J.indeterminate=Hh(m),Q.call(J,Hh(m)?!1:m),J.dispatchEvent(pe)}},[L,F,m,h]);const K=B.useRef(Hh(m)?!1:m);return b.jsx(En.input,{type:"checkbox","aria-hidden":!0,defaultChecked:_??K.current,required:i,disabled:S,name:A,value:I,form:M,...t,tabIndex:-1,ref:G,style:{...t.style,...U,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Sq.displayName=Tq;function vNe(e){return typeof e=="function"}function Hh(e){return e==="indeterminate"}function Eq(e){return Hh(e)?"indeterminate":e?"checked":"unchecked"}const Aq=B.forwardRef(({className:e,...t},n)=>b.jsx(pR,{ref:n,className:Wr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:b.jsx(wq,{className:Wr("flex items-center justify-center text-current"),children:b.jsx(wT,{className:"h-4 w-4"})})}));Aq.displayName=pR.displayName;const xNe=({blog:e,onSave:t,onCancel:n})=>{const[s,h]=B.useState({title:e?.title||"",slug:e?.slug||"",excerpt:e?.excerpt||"",content:e?.content||"",featured_image:e?.featured_image||"",author_name:e?.author_name||"",published:e?.published||!1,tags:e?.tags||[],seo_title:e?.seo_title||"",seo_description:e?.seo_description||"",seo_keywords:e?.seo_keywords||[]}),[m,_]=B.useState(""),[i,S]=B.useState(""),[A,I]=B.useState(!1),M=X=>X.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),L=X=>{h(ie=>({...ie,title:X,slug:M(X),seo_title:ie.seo_title||X}))},z=()=>{m.trim()&&!s.tags.includes(m.trim())&&(h(X=>({...X,tags:[...X.tags,m.trim()]})),_(""))},G=X=>{h(ie=>({...ie,tags:ie.tags.filter(Q=>Q!==X)}))},F=()=>{i.trim()&&!s.seo_keywords.includes(i.trim())&&(h(X=>({...X,seo_keywords:[...X.seo_keywords,i.trim()]})),S(""))},U=X=>{h(ie=>({...ie,seo_keywords:ie.seo_keywords.filter(Q=>Q!==X)}))},K=async X=>{if(!s.title.trim()){ma.error("Please enter a title first");return}I(!0);try{const{data:ie,error:Q}=await Er.functions.invoke("chat",{body:{type:"generate_blog",topic:s.title}});if(Q)throw Q;ie&&(X==="content"&&ie.content?h(ae=>({...ae,content:ie.content})):X==="excerpt"&&ie.excerpt?h(ae=>({...ae,excerpt:ie.excerpt})):X==="seo"&&h(ae=>({...ae,seo_title:ie.seo_title||ae.title,seo_description:ie.seo_description||ae.excerpt})),ma.success("AI content generated!"))}catch(ie){console.error("Error generating with AI:",ie),ma.error("Failed to generate content")}finally{I(!1)}},J=()=>{(async()=>{try{if(!s.title.trim())return ma.error("Title is required");if(!s.slug.trim())return ma.error("Slug is required");const X={title:s.title.trim(),slug:s.slug.trim(),excerpt:s.excerpt||null,content:s.content||null,featured_image:s.featured_image||null,author_name:s.author_name||null,published:!!s.published,tags:s.tags&&s.tags.length?s.tags:null,seo_title:s.seo_title||null,seo_description:s.seo_description||null,seo_keywords:s.seo_keywords&&s.seo_keywords.length?s.seo_keywords:null,updated_at:new Date().toISOString()};if(e&&e.id){const{data:ie,error:Q}=await Er.from("blogs").update(X).eq("id",e.id).select().single();if(Q)throw Q;ma.success("Blog updated"),t&&t(ie)}else{X.created_at=new Date().toISOString(),X.view_count=0,X.published&&(X.published_at=new Date().toISOString());const{data:ie,error:Q}=await Er.from("blogs").insert(X).select().single();if(Q)throw Q;ma.success("Blog created"),t&&t(ie)}}catch(X){console.error("Blog save error:",X);const ie=X instanceof Error?X.message:String(X);ma.error(ie||"Failed to save blog")}})()};return b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex items-center gap-3 p-4 bg-amber-500/10 border border-amber-500/50 rounded-lg",children:[b.jsx(xv,{className:"h-5 w-5 text-amber-500 flex-shrink-0"}),b.jsx("p",{className:"text-sm text-muted-foreground",children:"Blog database not configured. Form is available for preview but saving is disabled."})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx($i,{htmlFor:"title",children:"Title *"}),b.jsx(Mn,{id:"title",value:s.title,onChange:X=>L(X.target.value),placeholder:"Enter blog title"})]}),b.jsxs("div",{children:[b.jsx($i,{htmlFor:"slug",children:"Slug"}),b.jsx(Mn,{id:"slug",value:s.slug,onChange:X=>h(ie=>({...ie,slug:X.target.value})),placeholder:"url-friendly-slug"})]}),b.jsxs("div",{children:[b.jsx($i,{htmlFor:"author",children:"Author Name"}),b.jsx(Mn,{id:"author",value:s.author_name,onChange:X=>h(ie=>({...ie,author_name:X.target.value})),placeholder:"Author name"})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsx($i,{htmlFor:"excerpt",children:"Excerpt"}),b.jsxs(Cr,{type:"button",variant:"ghost",size:"sm",onClick:()=>K("excerpt"),disabled:A,children:[b.jsx(Av,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),b.jsx(fl,{id:"excerpt",value:s.excerpt,onChange:X=>h(ie=>({...ie,excerpt:X.target.value})),placeholder:"Brief description of the blog post",rows:3})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(Aq,{id:"published",checked:s.published,onCheckedChange:X=>h(ie=>({...ie,published:X}))}),b.jsx($i,{htmlFor:"published",children:"Publish immediately"})]})]}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsx($i,{htmlFor:"content",children:"Content *"}),b.jsxs(Cr,{type:"button",variant:"ghost",size:"sm",onClick:()=>K("content"),disabled:A,children:[b.jsx(Av,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),b.jsx(fl,{id:"content",value:s.content,onChange:X=>h(ie=>({...ie,content:X.target.value})),placeholder:"Write your blog content here...",rows:12})]}),b.jsxs("div",{children:[b.jsx($i,{htmlFor:"featured_image",children:"Featured Image URL"}),b.jsx(Mn,{id:"featured_image",value:s.featured_image,onChange:X=>h(ie=>({...ie,featured_image:X.target.value})),placeholder:"https://example.com/image.jpg"})]})]})]}),b.jsxs("div",{children:[b.jsx($i,{children:"Tags"}),b.jsxs("div",{className:"flex gap-2 mt-2",children:[b.jsx(Mn,{value:m,onChange:X=>_(X.target.value),placeholder:"Add a tag",onKeyPress:X=>X.key==="Enter"&&(X.preventDefault(),z())}),b.jsx(Cr,{type:"button",onClick:z,variant:"outline",children:"Add"})]}),b.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.tags.map(X=>b.jsxs(Us,{variant:"secondary",className:"flex items-center gap-1",children:[X,b.jsx(oc,{className:"h-3 w-3 cursor-pointer",onClick:()=>G(X)})]},X))})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsx($i,{htmlFor:"seo_title",children:"SEO Title"}),b.jsxs(Cr,{type:"button",variant:"ghost",size:"sm",onClick:()=>K("seo"),disabled:A,children:[b.jsx(Av,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),b.jsx(Mn,{id:"seo_title",value:s.seo_title,onChange:X=>h(ie=>({...ie,seo_title:X.target.value})),placeholder:"SEO optimized title"})]}),b.jsxs("div",{children:[b.jsx($i,{htmlFor:"seo_description",children:"SEO Description"}),b.jsx(fl,{id:"seo_description",value:s.seo_description,onChange:X=>h(ie=>({...ie,seo_description:X.target.value})),placeholder:"SEO meta description",rows:3})]})]}),b.jsxs("div",{children:[b.jsx($i,{children:"SEO Keywords"}),b.jsxs("div",{className:"flex gap-2 mt-2",children:[b.jsx(Mn,{value:i,onChange:X=>S(X.target.value),placeholder:"Add a keyword",onKeyPress:X=>X.key==="Enter"&&(X.preventDefault(),F())}),b.jsx(Cr,{type:"button",onClick:F,variant:"outline",children:"Add"})]}),b.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.seo_keywords.map(X=>b.jsxs(Us,{variant:"outline",className:"flex items-center gap-1",children:[X,b.jsx(oc,{className:"h-3 w-3 cursor-pointer",onClick:()=>U(X)})]},X))})]}),b.jsxs("div",{className:"flex justify-end gap-4",children:[n&&b.jsx(Cr,{variant:"outline",onClick:n,children:"Cancel"}),b.jsxs(Cr,{onClick:J,disabled:!0,children:[e?"Update":"Create"," Blog (Database Required)"]})]})]})},O1=[{id:"1",title:"Complete Guide to Buying Land in Kenya",slug:"guide-to-buying-land-in-kenya",excerpt:"Everything you need to know about purchasing land in Kenya.",published:!0,published_at:"2024-12-01",author_name:"Julin Real Estate",tags:["Land","Buying Guide"],view_count:156},{id:"2",title:"Top Investment Areas in Nairobi for 2024",slug:"top-investment-areas-nairobi-2024",excerpt:"Discover the most promising neighborhoods for real estate investment.",published:!0,published_at:"2024-11-15",author_name:"Julin Real Estate",tags:["Investment","Nairobi"],view_count:243},{id:"3",title:"Understanding Land Titles in Kenya",slug:"understanding-land-titles-kenya",excerpt:"A comprehensive breakdown of different land title types.",published:!0,published_at:"2024-11-01",author_name:"Julin Real Estate",tags:["Legal","Land Titles"],view_count:189}],bNe=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!1),[h,m]=B.useState([]),[_,i]=B.useState(!1),[S,A]=B.useState(!1),[I,M]=B.useState(null),L=async()=>{s(!0);try{const{data:F,error:U}=await Er.functions.invoke("chat",{body:{type:"blog_suggestion"}});if(U)throw U;F?.suggestions&&(t(F.suggestions),ma.success("Blog suggestions generated!"))}catch(F){console.error("Error generating suggestions:",F),t(["5 Things to Check Before Buying Land in Kenya","How to Verify a Land Title Deed","Best Counties for Real Estate Investment in 2024","Understanding Property Taxes in Kenya","Tips for First-Time Home Buyers"]),ma.success("Sample suggestions loaded")}finally{s(!1)}},z=async()=>{i(!0);try{const{data:F,error:U}=await Er.from("blogs").select("*").order("created_at",{ascending:!1});if(U)throw U;m(F||[])}catch(F){console.error("Failed to load blogs:",F),m(O1)}finally{i(!1)}};B.useEffect(()=>{z()},[]);const G=F=>new Date(F).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Blog Posts"}),b.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your blog content"})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsxs(Cr,{onClick:()=>{M(null),A(!0)},children:[b.jsx(hY,{className:"h-4 w-4 mr-2"}),"New Blog Post"]}),b.jsx(Cr,{onClick:z,variant:"outline",children:"Refresh"})]})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Total Posts"}),b.jsx(FI,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold",children:O1.length}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Sample data"})]})]}),b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Published"}),b.jsx(Nc,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold",children:O1.filter(F=>F.published).length}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Sample data"})]})]}),b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Total Views"}),b.jsx(Nc,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold",children:O1.reduce((F,U)=>F+U.view_count,0)}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Sample data"})]})]})]}),b.jsxs(os,{children:[b.jsx(ss,{children:b.jsxs(as,{className:"flex items-center gap-2",children:[b.jsx(rY,{className:"h-5 w-5 text-primary"}),"AI Blog Suggestions"]})}),b.jsxs(ls,{className:"space-y-4",children:[b.jsxs(Cr,{onClick:L,disabled:n,variant:"outline",children:[b.jsx(Av,{className:"mr-2 h-4 w-4"}),n?"Generating...":"Generate Blog Ideas"]}),e.length>0&&b.jsx("div",{className:"grid gap-2",children:e.map((F,U)=>b.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[b.jsx("span",{className:"text-sm",children:F}),b.jsx(Us,{variant:"outline",children:"Idea"})]},U))})]})]}),b.jsxs(os,{children:[b.jsx(ss,{children:b.jsx(as,{children:"Blog Posts"})}),b.jsx(ls,{children:b.jsxs(uR,{children:[b.jsx(hR,{children:b.jsxs(M0,{children:[b.jsx(ul,{children:"Title"}),b.jsx(ul,{children:"Status"}),b.jsx(ul,{children:"Author"}),b.jsx(ul,{children:"Published"}),b.jsx(ul,{children:"Views"}),b.jsx(ul,{children:"Actions"})]})}),b.jsx(dR,{children:h.map(F=>b.jsxs(M0,{children:[b.jsx(hl,{className:"font-medium max-w-xs",children:b.jsx("div",{className:"truncate",title:F.title,children:F.title})}),b.jsx(hl,{children:b.jsx(Us,{variant:F.published?"default":"secondary",children:F.published?"Published":"Draft"})}),b.jsx(hl,{children:F.author_name||"-"}),b.jsx(hl,{children:F.published_at?G(F.published_at):"-"}),b.jsx(hl,{children:F.view_count??0}),b.jsx(hl,{children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Cr,{variant:"ghost",size:"sm",onClick:async()=>{try{const{data:U,error:K}=await Er.from("blogs").update({published:!F.published,published_at:F.published?null:new Date().toISOString()}).eq("id",F.id).select().single();if(K)throw K;ma.success("Publish status updated"),z()}catch(U){console.error(U),ma.error("Failed to update")}},children:F.published?b.jsx(w4,{className:"h-4 w-4"}):b.jsx(Nc,{className:"h-4 w-4"})}),b.jsx(Cr,{variant:"ghost",size:"sm",onClick:()=>{M(F),A(!0)},children:b.jsx(gY,{className:"h-4 w-4"})}),b.jsx(Cr,{variant:"ghost",size:"sm",onClick:async()=>{if(confirm("Delete this blog post?"))try{const{error:U}=await Er.from("blogs").delete().eq("id",F.id);if(U)throw U;ma.success("Blog deleted"),z()}catch(U){console.error(U),ma.error("Delete failed")}},children:b.jsx(T4,{className:"h-4 w-4"})}),b.jsx(Cr,{variant:"ghost",size:"sm",asChild:!0,children:b.jsx("a",{href:`/blog/${F.slug}`,target:"_blank",rel:"noopener noreferrer",children:b.jsx(Nc,{className:"h-4 w-4"})})})]})})]},F.id))})]})})]}),b.jsx(Vu,{open:S,onOpenChange:F=>A(F),children:b.jsxs(Kc,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Qh,{children:b.jsx(qu,{children:I?"Edit Blog":"New Blog"})}),b.jsx("div",{className:"py-4",children:b.jsx(xNe,{blog:I,onSave:F=>{A(!1),z()},onCancel:()=>A(!1)})})]})})]})})},wNe=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(""),_=e.filter(F=>F.title.toLowerCase().includes(h.toLowerCase())||F.seller_name.toLowerCase().includes(h.toLowerCase()));B.useEffect(()=>{(async()=>{s(!0);const{data:U,error:K}=await Er.from("property_submissions").select("*").order("created_at",{ascending:!1});K&&console.error(K),t(U||[]),s(!1)})()},[]);const i=async F=>{try{await Er.from("property_submissions").update({status:"rejected",reviewed_at:new Date().toISOString()}).eq("id",F.id),t(U=>U.filter(K=>K.id!==F.id)),rn({title:"Rejected",description:"Submission rejected."})}catch(U){console.error(U),rn({title:"Error",description:"Failed to reject submission.",variant:"destructive"})}},[S,A]=B.useState(null),[I,M]=B.useState({title:"",price:"",location:"",description:"",seller_name:"",seller_phone:""}),L=F=>{A(F),M({title:F.title||"",price:String(F.price||""),location:"",description:"",seller_name:F.seller_name||"",seller_phone:F.seller_phone||""})},z=()=>{A(null)},G=async()=>{if(S)try{const F={title:I.title,description:I.description||null,property_type:S.property_type||"land",price:Number(I.price||0),location:I.location||"",images:S.images||null,seller_name:I.seller_name,seller_phone:I.seller_phone,is_admin_property:!1,approved_at:new Date().toISOString()},{data:U,error:K}=await Er.from("properties").insert([F]).select().single();if(K)throw K;await Er.from("property_submissions").update({status:"approved",created_property_id:U.id,reviewed_at:new Date().toISOString()}).eq("id",S.id),t(J=>J.filter(X=>X.id!==S.id)),z()}catch(F){console.error(F);const U=F instanceof Error?F.message:String(F);rn({title:"Error",description:U||"Failed to approve submission.",variant:"destructive"})}};return b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Property Submissions"}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Review and approve seller submissions"})]}),b.jsxs("div",{className:"relative",children:[b.jsx(ig,{className:"absolute left-3 top-3 text-slate-400",size:20}),b.jsx(Mn,{placeholder:"Search by property title or seller name...",value:h,onChange:F=>m(F.target.value),className:"pl-10 py-2 h-10"})]}),n?b.jsx("div",{className:"space-y-3",children:[1,2,3].map(F=>b.jsx("div",{className:"h-24 bg-slate-100 dark:bg-slate-700 rounded-lg animate-pulse"},F))}):_.length===0?b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-8 text-center",children:b.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:h?"No submissions found matching your search":"No pending submissions"})}):b.jsx("div",{className:"grid gap-4",children:_.map(F=>b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[b.jsxs("div",{className:"col-span-2",children:[b.jsxs("div",{className:"flex items-start justify-between mb-3",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:F.title}),b.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Submitted by ",b.jsx("strong",{children:F.seller_name})]})]}),b.jsx(Us,{variant:"secondary",className:"ml-2",children:"Pending"})]}),b.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400",children:[b.jsxs("p",{children:[b.jsx("strong",{children:"Price:"})," KES ",Number(F.price).toLocaleString()]}),b.jsxs("p",{children:[b.jsx("strong",{children:"Seller Phone:"})," ",F.seller_phone]}),F.images&&F.images.length>0&&b.jsxs("p",{children:[b.jsx("strong",{children:"Images:"})," ",F.images.length," file(s)"]})]})]}),b.jsxs("div",{className:"flex flex-col gap-2 md:justify-start",children:[b.jsxs(Cr,{onClick:()=>L(F),className:"bg-blue-600 hover:bg-blue-700 inline-flex items-center justify-center gap-2",children:[b.jsx(Nc,{size:18}),"Review"]}),b.jsxs(Cr,{onClick:()=>i(F),variant:"destructive",className:"inline-flex items-center justify-center gap-2",children:[b.jsx(oc,{size:18}),"Reject"]})]})]})},F.id))}),b.jsx(Vu,{open:!!S,onOpenChange:F=>{F||z()},children:b.jsxs(Kc,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Qh,{children:b.jsx(qu,{className:"text-2xl",children:"Review & Approve Submission"})}),S&&b.jsxs("div",{className:"grid gap-4",children:[b.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg",children:[b.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Original Submission Details"}),b.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[b.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:S.title}),b.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Seller: ",S.seller_name]}),b.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Phone: ",S.seller_phone]}),b.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Price: KES ",Number(S.price).toLocaleString()]})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Property Title"}),b.jsx(Mn,{value:I.title,onChange:F=>M(U=>({...U,title:F.target.value})),className:"h-10"})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Price (KES)"}),b.jsx(Mn,{value:I.price,onChange:F=>M(U=>({...U,price:F.target.value})),type:"number",className:"h-10"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Location"}),b.jsx(Mn,{placeholder:"Location",value:I.location,onChange:F=>M(U=>({...U,location:F.target.value})),className:"h-10"})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Description"}),b.jsx(fl,{placeholder:"Description",value:I.description,onChange:F=>M(U=>({...U,description:F.target.value})),className:"min-h-24"})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Seller Name"}),b.jsx(Mn,{placeholder:"Seller name",value:I.seller_name,onChange:F=>M(U=>({...U,seller_name:F.target.value})),className:"h-10"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Seller Phone"}),b.jsx(Mn,{placeholder:"Seller phone",value:I.seller_phone,onChange:F=>M(U=>({...U,seller_phone:F.target.value})),className:"h-10"})]})]})]}),b.jsxs(U0,{className:"flex gap-2 sm:justify-end",children:[b.jsx(Cr,{variant:"outline",onClick:z,children:"Cancel"}),b.jsxs(Cr,{onClick:G,className:"bg-green-600 hover:bg-green-700 inline-flex items-center gap-2",children:[b.jsx(wT,{size:18}),"Approve & Publish"]})]})]})})]})})},TNe=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(""),_=e.filter(S=>S.buyer_name.toLowerCase().includes(h.toLowerCase())||S.buyer_phone.includes(h)||(S.message||"").toLowerCase().includes(h.toLowerCase()));B.useEffect(()=>{(async()=>{s(!0);const{data:A,error:I}=await Er.from("buyer_inquiries").select("*").order("created_at",{ascending:!1});I&&console.error(I),t(A||[]),s(!1)})()},[]);const i=async(S,A)=>{try{await Er.from("buyer_inquiries").update({lead_status:A}).eq("id",S),t(I=>I.map(M=>M.id===S?{...M,lead_status:A}:M))}catch(I){console.error(I);const M=I instanceof Error?I.message:String(I);rn({title:"Error",description:M||"Failed to update lead status",variant:"destructive"})}};return b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Buyer Inquiries"}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Track and manage buyer leads"})]}),b.jsxs("div",{className:"relative",children:[b.jsx(ig,{className:"absolute left-3 top-3 text-slate-400",size:20}),b.jsx(Mn,{placeholder:"Search by name, phone, or message...",value:h,onChange:S=>m(S.target.value),className:"pl-10 py-2 h-10"})]}),b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:n?b.jsxs("div",{className:"p-8 text-center",children:[b.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-blue-600 rounded-full"}),b.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Loading inquiries..."})]}):_.length===0?b.jsx("div",{className:"p-8 text-center",children:b.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:h?"No inquiries found matching your search":"No inquiries yet"})}):b.jsx("div",{className:"overflow-x-auto",children:b.jsxs("table",{className:"w-full",children:[b.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:b.jsxs("tr",{children:[b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Buyer"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Contact"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Message"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Lead Status"}),b.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Date"})]})}),b.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:_.map(S=>b.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[b.jsx("td",{className:"px-6 py-4",children:b.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:S.buyer_name})}),b.jsx("td",{className:"px-6 py-4",children:b.jsx("div",{className:"flex flex-col gap-2",children:b.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[b.jsx(jf,{size:16}),b.jsx("a",{href:`tel:${S.buyer_phone}`,className:"hover:text-blue-600 dark:hover:text-blue-400",children:S.buyer_phone})]})})}),b.jsx("td",{className:"px-6 py-4",children:b.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 max-w-xs truncate",children:[(S.message||"").slice(0,50),(S.message||"").length>50?"...":""]})}),b.jsx("td",{className:"px-6 py-4",children:b.jsxs(Ou,{value:S.lead_status||"warm",onValueChange:A=>i(S.id,A),children:[b.jsx(Bc,{className:"w-32 h-8 text-xs",children:b.jsx(Ru,{})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"hot",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Hot"]})}),b.jsx(Yi,{value:"warm",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Warm"]})}),b.jsx(Yi,{value:"cold",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Cold"]})})]})]})}),b.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-400",children:S.created_at?new Date(S.created_at).toLocaleDateString():""})]},S.id))})]})})})]})})},I5={positive:{emoji:"",label:"Positive"},neutral:{emoji:"",label:"Neutral"},negative:{emoji:"",label:"Negative"}},SNe=({page:e="chat",accent:t="emerald",onSubmit:n})=>{const[s,h]=B.useState(0),[m,_]=B.useState(0),[i,S]=B.useState(""),[A,I]=B.useState(!1),M=B.useMemo(()=>s>=4?"positive":s===3?"neutral":s>0?"negative":null,[s]),L=B.useMemo(()=>s>=4?"What did you love most?":s===3?"What could we improve?":s>0?"What went wrong?":"How was your experience?",[s]),z=()=>{if(!(!s||!M)){I(!0);try{n?.({rating:s,sentiment:M,feedback:i.trim()||null})}finally{I(!1)}}};return b.jsx("div",{className:"flex h-full items-center justify-center p-4",children:b.jsxs(os,{className:"w-full max-w-md",children:[b.jsxs(ss,{className:"text-center",children:[b.jsx(_n.div,{initial:{scale:0},animate:{scale:1},className:`mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-${t}-100`,children:b.jsx(bT,{className:`h-7 w-7 text-${t}-600`})}),b.jsx(as,{className:"text-xl",children:L}),M&&b.jsxs("p",{className:"mt-1 text-sm text-muted-foreground flex justify-center gap-2",children:[b.jsx("span",{children:I5[M].emoji}),I5[M].label]})]}),b.jsxs(ls,{className:"space-y-6",children:[b.jsx("div",{className:"flex justify-center gap-1",children:[1,2,3,4,5].map(G=>b.jsx(_n.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onMouseEnter:()=>_(G),onMouseLeave:()=>_(0),onClick:()=>h(G),children:b.jsx(yf,{className:`h-8 w-8 transition ${G<=(m||s)?`fill-${t}-400 text-${t}-400`:"text-muted"}`})},G))}),s>0&&b.jsx("textarea",{rows:3,value:i,onChange:G=>S(G.target.value),placeholder:"Tell us more (optional)",className:`w-full resize-none rounded-lg border p-3 focus:ring-2 focus:ring-${t}-500`}),b.jsx(Cr,{disabled:!s||A,onClick:z,className:"w-full",children:A?"Submitting":"Send feedback"})]})]})})},ENe=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(null),[_,i]=B.useState([]),[S,A]=B.useState(!1);B.useEffect(()=>{I()},[]);const I=async()=>{try{s(!0);const{data:Q,error:ae}=await Er.from("chat_conversations").select("*").order("started_at",{ascending:!1}).limit(100);if(ae)throw ae;t(Q||[])}catch(Q){console.error("Error fetching conversations:",Q);const ae=Q instanceof Error?Q.message:String(Q);rn({title:"Error",description:ae||"Failed to load conversations",variant:"destructive"})}finally{s(!1)}},M=async Q=>{try{A(!0);const{data:ae,error:pe}=await Er.from("chat_messages").select("*").eq("session_id",Q).order("created_at",{ascending:!0});if(pe)throw pe;i(ae||[])}catch(ae){console.error("Error fetching messages:",ae);const pe=ae instanceof Error?ae.message:String(ae);rn({title:"Error",description:pe||"Failed to load messages",variant:"destructive"})}finally{A(!1)}},L=Q=>{m(Q),M(Q.id)},z=Q=>Q?new Date(Q).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",G=Q=>{if(Q.summary)try{return JSON.parse(Q.summary).rating||null}catch{return null}return null},F=Q=>{if(Q.summary)try{return JSON.parse(Q.summary).feedback||null}catch{return null}return null},U=e.length,K=e.filter(Q=>G(Q)!==null),J=K.length>0?(K.reduce((Q,ae)=>Q+(G(ae)||0),0)/K.length).toFixed(1):"-",X=e.filter(Q=>{const ae=G(Q);return ae!==null&&ae<=2}).length,ie=e.filter(Q=>{if(!Q.started_at)return!1;const ae=new Date;return new Date(Q.started_at).toDateString()===ae.toDateString()}).length;return b.jsx(_l,{children:b.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("h1",{className:"text-3xl font-bold",children:"Chat Analytics Dashboard"}),b.jsx(Cr,{onClick:I,variant:"outline",children:"Refresh"})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Total Conversations"}),b.jsx(Nm,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold",children:U}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"All time user chats"})]})]}),b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Average Rating"}),b.jsx(yf,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsxs("div",{className:"text-2xl font-bold",children:[J,"/5"]}),b.jsxs("p",{className:"text-xs text-muted-foreground",children:[K.length," rated conversations"]})]})]}),b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Low Ratings"}),b.jsx(_Y,{className:"h-4 w-4 text-red-500"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold text-red-600",children:X}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Ratings 2 or below"})]})]}),b.jsxs(os,{children:[b.jsxs(ss,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[b.jsx(as,{className:"text-sm font-medium",children:"Active Today"}),b.jsx(S4,{className:"h-4 w-4 text-muted-foreground"})]}),b.jsxs(ls,{children:[b.jsx("div",{className:"text-2xl font-bold",children:ie}),b.jsx("p",{className:"text-xs text-muted-foreground",children:"Conversations today"})]})]})]}),b.jsxs(os,{children:[b.jsx(ss,{children:b.jsxs(as,{className:"flex items-center gap-2",children:[b.jsx(Nm,{className:"h-5 w-5 text-primary"}),"Recent Conversations"]})}),b.jsx(ls,{children:n?b.jsxs("div",{className:"text-center py-8",children:[b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),b.jsx("p",{children:"Loading conversations..."})]}):e.length===0?b.jsxs("div",{className:"text-center py-12",children:[b.jsx(Nm,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),b.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversations yet"}),b.jsx("p",{className:"text-muted-foreground",children:"User conversations will appear here when visitors use the chat feature."})]}):b.jsxs(uR,{children:[b.jsx(hR,{children:b.jsxs(M0,{children:[b.jsx(ul,{children:"User"}),b.jsx(ul,{children:"Started"}),b.jsx(ul,{children:"Last Message"}),b.jsx(ul,{children:"Rating"}),b.jsx(ul,{children:"Actions"})]})}),b.jsx(dR,{children:e.map(Q=>{const ae=G(Q);return b.jsxs(M0,{children:[b.jsx(hl,{className:"font-medium",children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(j0,{className:"h-4 w-4 text-muted-foreground"}),Q.user_display_name||"Anonymous"]})}),b.jsx(hl,{children:b.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[b.jsx(Z1,{className:"h-3 w-3"}),z(Q.started_at)]})}),b.jsx(hl,{className:"max-w-xs",children:b.jsx("div",{className:"truncate text-sm text-muted-foreground",children:Q.last_message||"No messages"})}),b.jsx(hl,{children:ae?b.jsxs(Us,{variant:ae>=4?"default":ae>=3?"secondary":"destructive",children:[b.jsx(yf,{className:"h-3 w-3 mr-1 fill-current"}),ae,"/5"]}):b.jsx("span",{className:"text-muted-foreground text-sm",children:"Not rated"})}),b.jsx(hl,{children:b.jsx(Cr,{variant:"ghost",size:"sm",onClick:()=>L(Q),children:b.jsx(Nc,{className:"h-4 w-4"})})})]},Q.id)})})]})})]}),b.jsx(Vu,{open:!!h,onOpenChange:()=>m(null),children:b.jsxs(Kc,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[b.jsx(Qh,{children:b.jsxs(qu,{className:"flex items-center gap-2",children:[b.jsx(Nm,{className:"h-5 w-5"}),"Conversation with ",h?.user_display_name||"Anonymous"]})}),b.jsxs("div",{className:"space-y-4",children:[h&&b.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Name:"})," ",h.user_display_name||"Anonymous"]}),b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Started:"})," ",z(h.started_at)]}),b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Rating:"})," ",G(h)?`${G(h)}/5`:"Not rated"]})]}),F(h)&&b.jsxs("div",{className:"mt-2",children:[b.jsx("span",{className:"font-medium",children:"Feedback:"})," ",F(h)]})]}),h&&!G(h)&&b.jsxs("div",{children:[b.jsx("h3",{className:"text-sm font-medium mb-2",children:"Add rating / feedback"}),b.jsx(SNe,{page:"admin",onSubmit:async({rating:Q,sentiment:ae,feedback:pe})=>{try{const Pe={rating:Q,rating_feedback:pe};try{const Ge=h.summary?JSON.parse(h.summary):{};Pe.summary=JSON.stringify({...Ge,rating:Q,feedback:pe})}catch{Pe.summary=JSON.stringify({rating:Q,feedback:pe})}const{data:Fe,error:tt}=await Er.from("chat_conversations").update(Pe).eq("id",h.id).select().maybeSingle?.();if(tt)throw tt;await I();const Be=await Er.from("chat_conversations").select("*").eq("id",h.id).maybeSingle();m(Ge=>({...Ge,...Be?.data||{}})),rn({title:"Saved",description:"Rating saved."})}catch(Pe){console.error("Failed to save rating",Pe),rn({title:"Error",description:"Failed to save rating",variant:"destructive"})}}})]}),b.jsx("div",{className:"space-y-3",children:S?b.jsx("div",{className:"text-center py-8",children:b.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"})}):_.length===0?b.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No messages found"}):_.map(Q=>b.jsx("div",{className:"space-y-2",children:b.jsxs("div",{className:`p-3 rounded-lg ${Q.role==="user"?"bg-primary/10 ml-8":"bg-muted mr-8"}`,children:[b.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[b.jsx(Us,{variant:Q.role==="user"?"default":"secondary",className:"text-xs",children:Q.role==="user"?"User":"AI Assistant"}),b.jsx("span",{className:"text-xs text-muted-foreground",children:z(Q.created_at)})]}),b.jsx("p",{className:"text-sm whitespace-pre-wrap",children:Q.content})]})},Q.id))})]})]})})]})})};var ANe="Separator",M5="horizontal",PNe=["horizontal","vertical"],Pq=B.forwardRef((e,t)=>{const{decorative:n,orientation:s=M5,...h}=e,m=CNe(s)?s:M5,i=n?{role:"none"}:{"aria-orientation":m==="vertical"?m:void 0,role:"separator"};return b.jsx(En.div,{"data-orientation":m,...i,...h,ref:t})});Pq.displayName=ANe;function CNe(e){return PNe.includes(e)}var Cq=Pq;const Iq=B.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...s},h)=>b.jsx(Cq,{ref:h,decorative:n,orientation:t,className:Wr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...s}));Iq.displayName=Cq.displayName;const INe=()=>{const[e,t]=B.useState(!0),[n,s]=B.useState(!1),[h,m]=B.useState(!1),[_,i]=B.useState(null),[S,A]=B.useState({full_name:"",phone:"",avatar_url:"",bio:"",website:"",twitter:"",linkedin:""}),[I,M]=B.useState(null),[L,z]=B.useState({current:"",new:"",confirm:""});B.useEffect(()=>{G()},[]);const G=async()=>{t(!0);try{const{data:{user:K}}=await Er.auth.getUser();if(!K)return;i(K);const{data:J}=await Er.from("profiles").select("*").eq("user_id",K.id).maybeSingle();J&&A({full_name:J.full_name||"",phone:J.phone||"",avatar_url:J.avatar_url||"",bio:J.bio||"",website:J.website||"",twitter:J.twitter||"",linkedin:J.linkedin||""})}catch(K){console.error("Error loading profile:",K)}finally{t(!1)}},F=async()=>{if(_){s(!0);try{let K=S.avatar_url||null;if(I&&_){const X=I.name.split(".").pop(),ie=`avatars/${_.id}/${Date.now()}.${X}`,{error:Q}=await Er.storage.from("avatars").upload(ie,I,{cacheControl:"3600",upsert:!0});if(Q)throw Q;const{publicUrl:ae}=Er.storage.from("avatars").getPublicUrl(ie);K=ae||K}const{error:J}=await Er.from("profiles").upsert({user_id:_.id,full_name:S.full_name.trim()||null,phone:S.phone.trim()||null,avatar_url:K,bio:S.bio?.trim()||null,website:S.website?.trim()||null,twitter:S.twitter?.trim()||null,linkedin:S.linkedin?.trim()||null,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(J)throw J;rn({title:"Success",description:"Profile updated successfully"})}catch(K){console.error(K);const J=K instanceof Error?K.message:String(K);rn({title:"Error",description:J||"Failed to update profile",variant:"destructive"})}finally{s(!1)}}},U=async()=>{if(!L.new||!L.confirm){rn({title:"Error",description:"Please fill in all password fields",variant:"destructive"});return}if(L.new!==L.confirm){rn({title:"Error",description:"New passwords do not match",variant:"destructive"});return}if(L.new.length<6){rn({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"});return}m(!0);try{const{error:K}=await Er.auth.updateUser({password:L.new});if(K)throw K;z({current:"",new:"",confirm:""}),rn({title:"Success",description:"Password changed successfully"})}catch(K){console.error(K);const J=K instanceof Error?K.message:String(K);rn({title:"Error",description:J||"Failed to change password",variant:"destructive"})}finally{m(!1)}};return e?b.jsx("div",{className:"flex items-center justify-center py-12",children:b.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-slate-300 border-t-blue-600 rounded-full"})}):b.jsx(_l,{children:b.jsxs("div",{className:"space-y-6 max-w-2xl",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Profile Settings"}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage your account settings and preferences"})]}),b.jsxs(os,{children:[b.jsxs(ss,{children:[b.jsxs(as,{className:"flex items-center gap-2",children:[b.jsx(j0,{size:20}),"Profile Information"]}),b.jsx(JP,{children:"Update your personal details"})]}),b.jsxs(ls,{className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{htmlFor:"email",className:"flex items-center gap-2",children:[b.jsx(ST,{size:14}),"Email Address"]}),b.jsx(Mn,{id:"email",value:_?.email||"",disabled:!0,className:"bg-slate-50 dark:bg-slate-800"}),b.jsx("p",{className:"text-xs text-slate-500",children:"Email cannot be changed"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"full_name",children:"Full Name"}),b.jsx(Mn,{id:"full_name",value:S.full_name,onChange:K=>A(J=>({...J,full_name:K.target.value})),placeholder:"Enter your full name"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{className:"flex items-center gap-2",children:"Avatar"}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden bg-slate-100 border border-border",children:S.avatar_url?b.jsx("img",{src:S.avatar_url,alt:"avatar",className:"w-full h-full object-cover"}):b.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-slate-500",children:"No avatar"})}),b.jsxs("div",{children:[b.jsx("input",{id:"avatar",type:"file",accept:"image/*",onChange:K=>M(K.target.files?K.target.files[0]:null)}),b.jsx("p",{className:"text-xs text-slate-500",children:"Max 2MB. JPG/PNG recommended."})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"bio",children:"Bio"}),b.jsx("textarea",{id:"bio",value:S.bio,onChange:K=>A(J=>({...J,bio:K.target.value})),placeholder:"Short bio for your profile",className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",rows:3})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"website",children:"Website"}),b.jsx(Mn,{id:"website",value:S.website,onChange:K=>A(J=>({...J,website:K.target.value})),placeholder:"https://your-site.com"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"twitter",children:"Twitter"}),b.jsx(Mn,{id:"twitter",value:S.twitter,onChange:K=>A(J=>({...J,twitter:K.target.value})),placeholder:"@yourhandle"})]})]}),b.jsx("div",{className:"grid grid-cols-2 gap-4",children:b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"linkedin",children:"LinkedIn"}),b.jsx(Mn,{id:"linkedin",value:S.linkedin,onChange:K=>A(J=>({...J,linkedin:K.target.value})),placeholder:"https://linkedin.com/in/you"})]})}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{htmlFor:"phone",className:"flex items-center gap-2",children:[b.jsx(jf,{size:14}),"Phone Number"]}),b.jsx(Mn,{id:"phone",value:S.phone,onChange:K=>A(J=>({...J,phone:K.target.value})),placeholder:"Enter your phone number"})]}),b.jsxs(Cr,{onClick:F,disabled:n,className:"bg-blue-600 hover:bg-blue-700",children:[b.jsx(dY,{size:16,className:"mr-2"}),n?"Saving...":"Save Changes"]})]})]}),b.jsx(Iq,{}),b.jsxs(os,{children:[b.jsxs(ss,{children:[b.jsxs(as,{className:"flex items-center gap-2",children:[b.jsx(X1,{size:20}),"Change Password"]}),b.jsx(JP,{children:"Update your account password"})]}),b.jsxs(ls,{className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"new_password",children:"New Password"}),b.jsx(Mn,{id:"new_password",type:"password",value:L.new,onChange:K=>z(J=>({...J,new:K.target.value})),placeholder:"Enter new password"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{htmlFor:"confirm_password",children:"Confirm New Password"}),b.jsx(Mn,{id:"confirm_password",type:"password",value:L.confirm,onChange:K=>z(J=>({...J,confirm:K.target.value})),placeholder:"Confirm new password"})]}),b.jsxs(Cr,{onClick:U,disabled:h,variant:"outline",children:[b.jsx(X1,{size:16,className:"mr-2"}),h?"Changing...":"Change Password"]})]})]})]})})};function MNe({text:e,speed:t=40,className:n="",cursor:s=!0}){const[h,m]=B.useState("");return B.useEffect(()=>{let _=0;m("");const i=setInterval(()=>{m(S=>S+e.charAt(_)),_+=1,_>=e.length&&clearInterval(i)},t);return()=>clearInterval(i)},[e,t]),b.jsxs("span",{className:n,"aria-label":e,children:[h,s&&b.jsx("span",{"aria-hidden":"true",className:"inline-block ml-1 w-[0.6ch] align-middle animate-blink",children:"|"})]})}const ONe=qU,RNe=ZU,DNe=XU,Mq=B.forwardRef(({className:e,...t},n)=>b.jsx(HT,{className:Wr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));Mq.displayName=HT.displayName;const kNe=k0("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Oq=B.forwardRef(({side:e="right",className:t,children:n,...s},h)=>b.jsxs(DNe,{children:[b.jsx(Mq,{}),b.jsxs(WT,{ref:h,className:Wr(kNe({side:e}),t),...s,children:[n,b.jsxs(KU,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[b.jsx(oc,{className:"h-4 w-4"}),b.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Oq.displayName=WT.displayName;const Rq=({className:e,...t})=>b.jsx("div",{className:Wr("flex flex-col space-y-2 text-center sm:text-left",e),...t});Rq.displayName="SheetHeader";const Dq=B.forwardRef(({className:e,...t},n)=>b.jsx(qT,{ref:n,className:Wr("text-lg font-semibold text-foreground",e),...t}));Dq.displayName=qT.displayName;const jNe=B.forwardRef(({className:e,...t},n)=>b.jsx(ZT,{ref:n,className:Wr("text-sm text-muted-foreground",e),...t}));jNe.displayName=ZT.displayName;var kq=["PageUp","PageDown"],jq=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Lq={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},ay="Slider",[OI,LNe,NNe]=O0(ay),[Nq,Fze]=cc(ay,[NNe]),[zNe,GS]=Nq(ay),zq=B.forwardRef((e,t)=>{const{name:n,min:s=0,max:h=100,step:m=1,orientation:_="horizontal",disabled:i=!1,minStepsBetweenThumbs:S=0,defaultValue:A=[s],value:I,onValueChange:M=()=>{},onValueCommit:L=()=>{},inverted:z=!1,form:G,...F}=e,U=B.useRef(new Set),K=B.useRef(0),X=_==="horizontal"?FNe:BNe,[ie=[],Q]=Wh({prop:I,defaultProp:A,onChange:Be=>{[...U.current][K.current]?.focus(),M(Be)}}),ae=B.useRef(ie);function pe(Be){const Ge=HNe(ie,Be);tt(Be,Ge)}function Pe(Be){tt(Be,K.current)}function Fe(){const Be=ae.current[K.current];ie[K.current]!==Be&&L(ie)}function tt(Be,Ge,{commit:Qe}={commit:!1}){const Ke=XNe(m),ct=KNe(Math.round((Be-s)/m)*m+s,Ke),He=pT(ct,[s,h]);Q((qe=[])=>{const ut=UNe(qe,He,Ge);if(ZNe(ut,S*m)){K.current=ut.indexOf(He);const nt=String(ut)!==String(qe);return nt&&Qe&&L(ut),nt?ut:qe}else return qe})}return b.jsx(zNe,{scope:e.__scopeSlider,name:n,disabled:i,min:s,max:h,valueIndexToChangeRef:K,thumbs:U.current,values:ie,orientation:_,form:G,children:b.jsx(OI.Provider,{scope:e.__scopeSlider,children:b.jsx(OI.Slot,{scope:e.__scopeSlider,children:b.jsx(X,{"aria-disabled":i,"data-disabled":i?"":void 0,...F,ref:t,onPointerDown:Ar(F.onPointerDown,()=>{i||(ae.current=ie)}),min:s,max:h,inverted:z,onSlideStart:i?void 0:pe,onSlideMove:i?void 0:Pe,onSlideEnd:i?void 0:Fe,onHomeKeyDown:()=>!i&&tt(s,0,{commit:!0}),onEndKeyDown:()=>!i&&tt(h,ie.length-1,{commit:!0}),onStepKeyDown:({event:Be,direction:Ge})=>{if(!i){const ct=kq.includes(Be.key)||Be.shiftKey&&jq.includes(Be.key)?10:1,He=K.current,qe=ie[He],ut=m*ct*Ge;tt(qe+ut,He,{commit:!0})}}})})})})});zq.displayName=ay;var[Fq,Bq]=Nq(ay,{startEdge:"left",endEdge:"right",size:"width",direction:1}),FNe=B.forwardRef((e,t)=>{const{min:n,max:s,dir:h,inverted:m,onSlideStart:_,onSlideMove:i,onSlideEnd:S,onStepKeyDown:A,...I}=e,[M,L]=B.useState(null),z=li(t,X=>L(X)),G=B.useRef(void 0),F=LS(h),U=F==="ltr",K=U&&!m||!U&&m;function J(X){const ie=G.current||M.getBoundingClientRect(),Q=[0,ie.width],pe=mR(Q,K?[n,s]:[s,n]);return G.current=ie,pe(X-ie.left)}return b.jsx(Fq,{scope:e.__scopeSlider,startEdge:K?"left":"right",endEdge:K?"right":"left",direction:K?1:-1,size:"width",children:b.jsx(Vq,{dir:F,"data-orientation":"horizontal",...I,ref:z,style:{...I.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:X=>{const ie=J(X.clientX);_?.(ie)},onSlideMove:X=>{const ie=J(X.clientX);i?.(ie)},onSlideEnd:()=>{G.current=void 0,S?.()},onStepKeyDown:X=>{const Q=Lq[K?"from-left":"from-right"].includes(X.key);A?.({event:X,direction:Q?-1:1})}})})}),BNe=B.forwardRef((e,t)=>{const{min:n,max:s,inverted:h,onSlideStart:m,onSlideMove:_,onSlideEnd:i,onStepKeyDown:S,...A}=e,I=B.useRef(null),M=li(t,I),L=B.useRef(void 0),z=!h;function G(F){const U=L.current||I.current.getBoundingClientRect(),K=[0,U.height],X=mR(K,z?[s,n]:[n,s]);return L.current=U,X(F-U.top)}return b.jsx(Fq,{scope:e.__scopeSlider,startEdge:z?"bottom":"top",endEdge:z?"top":"bottom",size:"height",direction:z?1:-1,children:b.jsx(Vq,{"data-orientation":"vertical",...A,ref:M,style:{...A.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:F=>{const U=G(F.clientY);m?.(U)},onSlideMove:F=>{const U=G(F.clientY);_?.(U)},onSlideEnd:()=>{L.current=void 0,i?.()},onStepKeyDown:F=>{const K=Lq[z?"from-bottom":"from-top"].includes(F.key);S?.({event:F,direction:K?-1:1})}})})}),Vq=B.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:s,onSlideMove:h,onSlideEnd:m,onHomeKeyDown:_,onEndKeyDown:i,onStepKeyDown:S,...A}=e,I=GS(ay,n);return b.jsx(En.span,{...A,ref:t,onKeyDown:Ar(e.onKeyDown,M=>{M.key==="Home"?(_(M),M.preventDefault()):M.key==="End"?(i(M),M.preventDefault()):kq.concat(jq).includes(M.key)&&(S(M),M.preventDefault())}),onPointerDown:Ar(e.onPointerDown,M=>{const L=M.target;L.setPointerCapture(M.pointerId),M.preventDefault(),I.thumbs.has(L)?L.focus():s(M)}),onPointerMove:Ar(e.onPointerMove,M=>{M.target.hasPointerCapture(M.pointerId)&&h(M)}),onPointerUp:Ar(e.onPointerUp,M=>{const L=M.target;L.hasPointerCapture(M.pointerId)&&(L.releasePointerCapture(M.pointerId),m(M))})})}),$q="SliderTrack",Uq=B.forwardRef((e,t)=>{const{__scopeSlider:n,...s}=e,h=GS($q,n);return b.jsx(En.span,{"data-disabled":h.disabled?"":void 0,"data-orientation":h.orientation,...s,ref:t})});Uq.displayName=$q;var RI="SliderRange",Gq=B.forwardRef((e,t)=>{const{__scopeSlider:n,...s}=e,h=GS(RI,n),m=Bq(RI,n),_=B.useRef(null),i=li(t,_),S=h.values.length,A=h.values.map(L=>qq(L,h.min,h.max)),I=S>1?Math.min(...A):0,M=100-Math.max(...A);return b.jsx(En.span,{"data-orientation":h.orientation,"data-disabled":h.disabled?"":void 0,...s,ref:i,style:{...e.style,[m.startEdge]:I+"%",[m.endEdge]:M+"%"}})});Gq.displayName=RI;var DI="SliderThumb",Hq=B.forwardRef((e,t)=>{const n=LNe(e.__scopeSlider),[s,h]=B.useState(null),m=li(t,i=>h(i)),_=B.useMemo(()=>s?n().findIndex(i=>i.ref.current===s):-1,[n,s]);return b.jsx(VNe,{...e,ref:m,index:_})}),VNe=B.forwardRef((e,t)=>{const{__scopeSlider:n,index:s,name:h,...m}=e,_=GS(DI,n),i=Bq(DI,n),[S,A]=B.useState(null),I=li(t,J=>A(J)),M=S?_.form||!!S.closest("form"):!0,L=XI(S),z=_.values[s],G=z===void 0?0:qq(z,_.min,_.max),F=GNe(s,_.values.length),U=L?.[i.size],K=U?WNe(U,G,i.direction):0;return B.useEffect(()=>{if(S)return _.thumbs.add(S),()=>{_.thumbs.delete(S)}},[S,_.thumbs]),b.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${G}% + ${K}px)`},children:[b.jsx(OI.ItemSlot,{scope:e.__scopeSlider,children:b.jsx(En.span,{role:"slider","aria-label":e["aria-label"]||F,"aria-valuemin":_.min,"aria-valuenow":z,"aria-valuemax":_.max,"aria-orientation":_.orientation,"data-orientation":_.orientation,"data-disabled":_.disabled?"":void 0,tabIndex:_.disabled?void 0:0,...m,ref:I,style:z===void 0?{display:"none"}:e.style,onFocus:Ar(e.onFocus,()=>{_.valueIndexToChangeRef.current=s})})}),M&&b.jsx(Wq,{name:h??(_.name?_.name+(_.values.length>1?"[]":""):void 0),form:_.form,value:z},s)]})});Hq.displayName=DI;var $Ne="RadioBubbleInput",Wq=B.forwardRef(({__scopeSlider:e,value:t,...n},s)=>{const h=B.useRef(null),m=li(h,s),_=tR(t);return B.useEffect(()=>{const i=h.current;if(!i)return;const S=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(S,"value").set;if(_!==t&&I){const M=new Event("input",{bubbles:!0});I.call(i,t),i.dispatchEvent(M)}},[_,t]),b.jsx(En.input,{style:{display:"none"},...n,ref:m,defaultValue:t})});Wq.displayName=$Ne;function UNe(e=[],t,n){const s=[...e];return s[n]=t,s.sort((h,m)=>h-m)}function qq(e,t,n){const m=100/(n-t)*(e-t);return pT(m,[0,100])}function GNe(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function HNe(e,t){if(e.length===1)return 0;const n=e.map(h=>Math.abs(h-t)),s=Math.min(...n);return n.indexOf(s)}function WNe(e,t,n){const s=e/2,m=mR([0,50],[0,s]);return(s-m(t)*n)*n}function qNe(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function ZNe(e,t){if(t>0){const n=qNe(e);return Math.min(...n)>=t}return!0}function mR(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(n-e[0])}}function XNe(e){return(String(e).split(".")[1]||"").length}function KNe(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var Zq=zq,YNe=Uq,JNe=Gq,QNe=Hq;const Xq=B.forwardRef(({className:e,...t},n)=>b.jsxs(Zq,{ref:n,className:Wr("relative flex w-full touch-none select-none items-center",e),...t,children:[b.jsx(YNe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:b.jsx(JNe,{className:"absolute h-full bg-primary"})}),b.jsx(QNe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Xq.displayName=Zq.displayName;const O5=[{value:"plot",label:"Plot",icon:qc},{value:"house",label:"House",icon:Lc},{value:"land",label:"Land",icon:qc},{value:"apartment",label:"Apartment",icon:ZK},{value:"commercial",label:"Commercial",icon:QK}],R5=[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"}],D5=({type:e,setType:t,minPrice:n,setMinPrice:s,maxPrice:h,setMaxPrice:m,sortBy:_,setSortBy:i,priceRange:S,setPriceRange:A,clearFilters:I,getActiveFiltersCount:M,isMobile:L=!1})=>L?b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Property Type"}),b.jsxs(Ou,{value:e??"",onValueChange:z=>t(z==="all"?void 0:z),children:[b.jsx(Bc,{children:b.jsx(Ru,{placeholder:"All Types"})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"all",children:"All Types"}),O5.map(z=>b.jsx(Yi,{value:z.value,children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(z.icon,{size:16}),z.label]})},z.value))]})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Sort By"}),b.jsxs(Ou,{value:_,onValueChange:i,children:[b.jsx(Bc,{children:b.jsx(Ru,{})}),b.jsx(Vc,{children:R5.map(z=>b.jsx(Yi,{value:z.value,children:z.label},z.value))})]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Price Range"}),b.jsxs("div",{className:"space-y-4",children:[b.jsx(Xq,{value:S,onValueChange:A,max:1e8,min:0,step:1e5,className:"w-full"}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Mn,{placeholder:"Min Price",type:"number",value:n,onChange:z=>s(z.target.value)}),b.jsx(Mn,{placeholder:"Max Price",type:"number",value:h,onChange:z=>m(z.target.value)})]})]})]}),M()>0&&b.jsx(Cr,{onClick:I,variant:"outline",className:"w-full",children:"Clear All Filters"})]}):b.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[b.jsxs(Ou,{value:e??"",onValueChange:z=>t(z==="all"?void 0:z),children:[b.jsx(Bc,{className:"w-40",children:b.jsx(Ru,{placeholder:"All Types"})}),b.jsxs(Vc,{children:[b.jsx(Yi,{value:"all",children:"All Types"}),O5.map(z=>b.jsx(Yi,{value:z.value,children:b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(z.icon,{size:16}),z.label]})},z.value))]})]}),b.jsxs(Ou,{value:_,onValueChange:i,children:[b.jsx(Bc,{className:"w-44",children:b.jsx(Ru,{})}),b.jsx(Vc,{children:R5.map(z=>b.jsx(Yi,{value:z.value,children:z.label},z.value))})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(Mn,{placeholder:"Min Price",type:"number",value:n,onChange:z=>s(z.target.value),className:"w-28"}),b.jsx("span",{className:"text-muted-foreground",children:"-"}),b.jsx(Mn,{placeholder:"Max Price",type:"number",value:h,onChange:z=>m(z.target.value),className:"w-28"})]}),M()>0&&b.jsxs(Cr,{variant:"ghost",onClick:I,className:"text-muted-foreground hover:text-foreground",children:[b.jsx(oc,{className:"h-4 w-4 mr-2"}),"Clear (",M(),")"]})]}),eze=({query:e,setQuery:t,type:n,setType:s,minPrice:h,setMinPrice:m,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:A,priceRange:I,setPriceRange:M,clearFilters:L,getActiveFiltersCount:z,filtersOpen:G,setFiltersOpen:F})=>b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[b.jsx(ig,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),b.jsx(Mn,{placeholder:"Search properties by title, location, or features...",value:e,onChange:U=>t(U.target.value),className:"pl-12 pr-4 py-3 text-lg"})]}),b.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[b.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:b.jsx(D5,{type:n,setType:s,minPrice:h,setMinPrice:m,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:A,priceRange:I,setPriceRange:M,clearFilters:L,getActiveFiltersCount:z,isMobile:!1})}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs(ONe,{open:G,onOpenChange:F,children:[b.jsx(RNe,{asChild:!0,children:b.jsxs(Cr,{variant:"outline",className:"lg:hidden relative",children:[b.jsx(mY,{className:"h-4 w-4 mr-2"}),"Filters",z()>0&&b.jsx(Us,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center text-xs",children:z()})]})}),b.jsxs(Oq,{side:"right",className:"w-80",children:[b.jsx(Rq,{children:b.jsx(Dq,{children:"Filters"})}),b.jsx("div",{className:"mt-6",children:b.jsx(D5,{type:n,setType:s,minPrice:h,setMinPrice:m,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:A,priceRange:I,setPriceRange:M,clearFilters:L,getActiveFiltersCount:z,isMobile:!0})})]})]}),z()>0&&b.jsxs(Cr,{variant:"ghost",onClick:L,className:"text-muted-foreground hover:text-foreground",children:[b.jsx(oc,{className:"h-4 w-4 mr-2"}),"Clear (",z(),")"]})]})]})]}),tze=({properties:e,loading:t,errorMsg:n,fetchProperties:s,clearFilters:h})=>t?b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((m,_)=>b.jsxs("div",{className:"bg-card rounded-lg border border-border p-4 animate-pulse",children:[b.jsx("div",{className:"h-48 bg-muted rounded-lg mb-4"}),b.jsx("div",{className:"h-4 bg-muted rounded mb-2"}),b.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),b.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]},_))}):n?b.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-xl p-6 text-center",children:[b.jsx("p",{className:"font-semibold mb-2",children:"Unable to load properties"}),b.jsx("p",{className:"text-sm mb-4",children:n}),b.jsx(Cr,{onClick:s,variant:"outline",children:"Try Again"})]}):e.length===0?b.jsxs("div",{className:"text-center py-16",children:[b.jsx("div",{className:"w-24 h-24 bg-muted rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(_4,{className:"h-12 w-12 text-muted-foreground"})}),b.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"No properties found"}),b.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"We couldn't find any properties matching your criteria. Try adjusting your filters or search terms."}),b.jsx(Cr,{onClick:h,children:"Clear All Filters"})]}):b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"flex items-center justify-between mb-6",children:b.jsxs("p",{className:"text-muted-foreground",children:["Showing ",b.jsx("span",{className:"font-semibold text-foreground",children:e.length})," properties"]})}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:e.map((m,_)=>b.jsx(QU,{property:Object.assign(m,{__delay:_*70})},m.id))})]}),rze=()=>{const e=$h(),[t,n]=B.useState(""),[s,h]=B.useState(void 0),[m,_]=B.useState(""),[i,S]=B.useState(""),[A,I]=B.useState("newest"),[M,L]=B.useState([]),[z,G]=B.useState([]),[F,U]=B.useState(!1),[K,J]=B.useState(null),[X,ie]=B.useState(!1),[Q,ae]=B.useState([0,1e8]),pe=async()=>{U(!0),J(null);try{const{data:Be,error:Ge}=await Er.from("properties").select("*").eq("status","available").order("created_at",{ascending:!1});if(Ge)throw Ge;const Qe=Be||[];G(Qe),Pe(Qe)}catch(Be){console.error("Error fetching properties:",Be);const Ge=Be instanceof Error?Be.message:String(Be);J(Ge||"Failed to load properties")}finally{U(!1)}},Pe=Be=>{let Ge=Be;Ge=Ge.filter(Qe=>{if(s&&Qe.property_type!==s||m&&Number(Qe.price)<Number(m)||i&&Number(Qe.price)>Number(i))return!1;if(t){const Ke=t.toLowerCase(),ct=Qe.location?.toLowerCase().includes(Ke),He=Qe.title?.toLowerCase().includes(Ke),qe=Qe.county?.toLowerCase().includes(Ke);if(!ct&&!He&&!qe)return!1}return!0}),Ge.sort((Qe,Ke)=>{switch(A){case"newest":return new Date(Ke.created_at).getTime()-new Date(Qe.created_at).getTime();case"oldest":return new Date(Qe.created_at).getTime()-new Date(Ke.created_at).getTime();case"price-low":return Number(Qe.price)-Number(Ke.price);case"price-high":return Number(Ke.price)-Number(Qe.price);default:return 0}}),L(Ge)};B.useEffect(()=>{pe();const Be=Er.channel("properties-page-realtime").on("postgres_changes",{event:"*",schema:"public",table:"properties"},Ge=>{console.log("Real-time update:",Ge),pe()}).subscribe();return()=>{Er.removeChannel(Be)}},[]),B.useEffect(()=>{Pe(z)},[t,s,m,i,A]);const Fe=()=>{n(""),h(void 0),_(""),S(""),I("newest"),ae([0,1e8])},tt=()=>{let Be=0;return t&&Be++,s&&Be++,m&&Be++,i&&Be++,A!=="newest"&&Be++,Be};return b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"Properties  Julin Real Estate"}),b.jsx("meta",{name:"description",content:"Browse verified properties for sale and rent in Kenya."})]}),b.jsxs("div",{className:"min-h-screen bg-slate-50",children:[b.jsx(Ef,{}),b.jsx("main",{className:"pt-24 pb-20",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs("div",{ref:e.ref,className:`mb-8 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"} text-center`,children:[b.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"Properties"}),b.jsx("div",{className:"mx-auto max-w-2xl",children:b.jsx(MNe,{text:"Discover your perfect property from our curated collection",speed:28,className:"text-lg text-primary/80"})})]}),b.jsx(eze,{query:t,setQuery:n,type:s,setType:h,sortBy:A,setSortBy:I,minPrice:m,setMinPrice:_,maxPrice:i,setMaxPrice:S,priceRange:Q,setPriceRange:ae,filtersOpen:X,setFiltersOpen:ie,clearFilters:Fe,getActiveFiltersCount:tt}),b.jsx(tze,{properties:M,loading:F,errorMsg:K,fetchProperties:pe,clearFilters:Fe})]})}),b.jsx(Pf,{})]})]})};function R1({className:e,...t}){return b.jsx("div",{className:Wr("animate-pulse rounded-md bg-muted",e),...t})}const nze=()=>{const{id:e}=hU(),t=qg(),[n,s]=B.useState(null),[h,m]=B.useState(!0),[_,i]=B.useState(null),[S,A]=B.useState(!1),[I,M]=B.useState(""),[L,z]=B.useState(""),[G,F]=B.useState(""),[U,K]=B.useState(!1);B.useEffect(()=>{(async()=>{if(!e){i("Property not found"),m(!1);return}try{const{data:ae,error:pe}=await Er.from("properties").select("*").eq("id",e).eq("status","available").single();if(pe)throw pe;if(!ae)throw new Error("Property not found");if(ae.id){const{data:Pe}=await Er.storage.from("properties").list(),Fe=new Map(Pe?.map(Be=>[Be.name.split(".")[0],Be.name])||[]),tt=Fe.has(ae.id)?Er.storage.from("properties").getPublicUrl(Fe.get(ae.id)).data.publicUrl:"";s({...ae,image:tt})}}catch(ae){console.error("Error fetching property:",ae),i("Failed to load property details. Please try again.")}finally{m(!1)}})()},[e]);const J=async()=>{if(!(!I||!L||!n)){K(!0);try{const{error:Q}=await Er.from("buyer_inquiries").insert({property_id:n.id,buyer_name:I,buyer_phone:L,message:G,inquiry_source:"property_detail_page"});if(Q)throw Q;const ae=KP(n.seller_phone),pe=`Hi! I'm interested in "${n.title}" listed at KES ${n.price.toLocaleString()}. ${G||"Please provide more details."}`,Pe=pw(ae,pe);window.open(Pe,"_blank"),M(""),z(""),F(""),A(!1)}catch(Q){console.error("Error recording inquiry:",Q),alert("Failed to send inquiry. Please try again.")}finally{K(!1)}}};if(h)return b.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4",children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsx(R1,{className:"h-96 w-full mb-6"}),b.jsx(R1,{className:"h-8 w-2/3 mb-4"}),b.jsx(R1,{className:"h-4 w-1/2 mb-8"}),b.jsx(R1,{className:"h-32 w-full"})]})});if(_||!n)return b.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4 flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("p",{className:"text-xl text-slate-700 mb-4",children:_||"Property not found"}),b.jsx(Cr,{onClick:()=>t("/properties"),children:"Back to Properties"})]})});const X=n.description.substring(0,160)||`${n.title} in ${n.location} at KES ${n.price.toLocaleString()}. Contact ${n.seller_name} for details.`,ie={"@context":"https://schema.org","@type":"RealEstateProperty",name:n.title,description:n.description,image:n.image,price:n.price,priceCurrency:"KES",url:`/julin/#/properties/${n.id}`,address:{"@type":"PostalAddress",addressLocality:n.location,addressCountry:"KE"},seller:{"@type":"Person",name:n.seller_name,telephone:n.seller_phone},datePublished:new Date(n.created_at).toISOString(),dateModified:new Date(n.updated_at).toISOString()};return b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsxs("title",{children:[n.title," - KES ",n.price.toLocaleString()," | Julin Real Estate"]}),b.jsx("meta",{name:"description",content:X}),b.jsx("meta",{name:"keywords",content:`${n.property_type}, ${n.location}, Kenya, real estate, property for sale`}),b.jsx("meta",{property:"og:type",content:"website"}),b.jsx("meta",{property:"og:url",content:`/julin/#/properties/${n.id}`}),b.jsx("meta",{property:"og:title",content:n.title}),b.jsx("meta",{property:"og:description",content:X}),b.jsx("meta",{property:"og:image",content:n.image||""}),b.jsx("meta",{property:"og:site_name",content:"Julin Real Estate"}),b.jsx("meta",{property:"twitter:card",content:"summary_large_image"}),b.jsx("meta",{property:"twitter:url",content:`/julin/#/properties/${n.id}`}),b.jsx("meta",{property:"twitter:title",content:n.title}),b.jsx("meta",{property:"twitter:description",content:X}),b.jsx("meta",{property:"twitter:image",content:n.image||""}),b.jsx("link",{rel:"canonical",href:`/julin/#/properties/${n.id}`}),b.jsx("script",{type:"application/ld+json",children:JSON.stringify(ie)})]}),b.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4",children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsx(Cr,{variant:"outline",onClick:()=>t("/properties"),className:"mb-6",children:" Back to Properties"}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[b.jsxs("div",{className:"lg:col-span-2",children:[b.jsx("div",{className:"bg-white rounded-lg overflow-hidden shadow-md mb-6",children:n.image?b.jsx("img",{src:n.image,alt:n.title,loading:"eager",width:800,height:600,className:"w-full h-auto object-cover"}):b.jsx("div",{className:"w-full h-96 bg-gradient-to-br from-slate-300 to-slate-400 flex items-center justify-center",children:b.jsx("span",{className:"text-slate-600",children:"Image not available"})})}),b.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[b.jsxs("div",{className:"mb-4",children:[b.jsx(Us,{className:"bg-blue-600 hover:bg-blue-700 text-white mb-3",children:n.property_type.charAt(0).toUpperCase()+n.property_type.slice(1)}),b.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:n.title}),b.jsxs("div",{className:"flex items-center text-slate-600 mb-4",children:[b.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:b.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),n.location]})]}),b.jsxs("div",{className:"border-b border-slate-200 pb-4 mb-4",children:[b.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Price"}),b.jsxs("p",{className:"text-4xl font-bold text-green-600",children:["KES ",n.price.toLocaleString()]})]}),b.jsxs("div",{className:"mb-6",children:[b.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-3",children:"Description"}),b.jsx("p",{className:"text-slate-700 leading-relaxed whitespace-pre-wrap",children:n.description})]}),b.jsxs("div",{className:"bg-slate-50 rounded-md p-4",children:[b.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Listed by"}),b.jsx("p",{className:"text-lg font-semibold text-slate-900",children:n.seller_name}),b.jsxs("p",{className:"text-sm text-slate-600",children:["Phone: ",n.seller_phone]})]})]})]}),b.jsx("div",{className:"lg:col-span-1",children:b.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-4",children:[b.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Interested?"}),b.jsxs("p",{className:"text-slate-600 mb-6",children:["Connect with ",n.seller_name," via WhatsApp to discuss this property."]}),b.jsx(Cr,{onClick:()=>A(!0),size:"lg",className:"w-full bg-green-600 hover:bg-green-700 text-white mb-3",children:"Contact via WhatsApp"}),b.jsx(Cr,{variant:"outline",size:"lg",className:"w-full",onClick:()=>{const Q=pw(KP(n.seller_phone),`Hi! I'm interested in "${n.title}". Can you provide more information?`);window.open(Q,"_blank")},children:"Direct WhatsApp"}),b.jsxs("div",{className:"mt-6 space-y-3 pt-6 border-t border-slate-200",children:[b.jsxs("div",{children:[b.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Property Type"}),b.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.property_type.charAt(0).toUpperCase()+n.property_type.slice(1)})]}),b.jsxs("div",{children:[b.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Location"}),b.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.location})]}),b.jsxs("div",{children:[b.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Listed"}),b.jsx("p",{className:"text-sm font-semibold text-slate-900",children:new Date(n.created_at).toLocaleDateString()})]})]})]})})]})]})}),b.jsx(Vu,{open:S,onOpenChange:A,children:b.jsxs(Kc,{className:"sm:max-w-md",children:[b.jsx(Qh,{children:b.jsxs(qu,{children:["Send Inquiry to ",n.seller_name]})}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"bg-slate-100 p-3 rounded-md",children:[b.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.title}),b.jsxs("p",{className:"text-sm text-slate-600",children:["KES ",n.price.toLocaleString(),"  ",n.location]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Your Name"}),b.jsx(Mn,{type:"text",placeholder:"John Doe",value:I,onChange:Q=>M(Q.target.value),disabled:U})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Your Phone (WhatsApp)"}),b.jsx(Mn,{type:"tel",placeholder:"07XXXXXXXX",value:L,onChange:Q=>z(Q.target.value),disabled:U})]}),b.jsxs("div",{children:[b.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Message"}),b.jsx(fl,{placeholder:"Ask about the property...",value:G,onChange:Q=>F(Q.target.value),disabled:U,rows:3})]}),b.jsx(Cr,{onClick:J,disabled:U||!I||!L,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:U?"Sending...":"Send via WhatsApp"})]})]})})]})},ize=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(!0),[h,m]=B.useState(null),_=i=>i?new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"";return B.useEffect(()=>{let i=!0;return(async()=>{s(!0),m(null);try{const{data:A,error:I}=await Er.from("blogs").select("id, slug, title, excerpt, featured_image, author_name, published_at, tags, view_count").eq("published",!0).order("published_at",{ascending:!1}).limit(12);if(I)throw I;if(!i)return;t(A||[])}catch(A){if(console.warn("Failed to fetch blogs:",A),!i)return;t([])}finally{i&&s(!1)}})(),()=>{i=!1}},[]),b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"Blog - Julin Real Estate"}),b.jsx("meta",{name:"description",content:"Read our latest blog posts about real estate, property investment, and market insights in Kenya."})]}),b.jsx(Ef,{}),b.jsxs("main",{className:"min-h-screen bg-background",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground py-20",children:b.jsx("div",{className:"container mx-auto px-4 text-center",children:b.jsxs(_l,{children:[b.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Real Estate Blog"}),b.jsx("p",{className:"text-xl text-primary-foreground/80 max-w-2xl mx-auto",children:"Stay informed with the latest insights, tips, and trends in the Kenyan real estate market"})]})})}),b.jsx("section",{className:"py-20",children:b.jsx("div",{className:"container mx-auto px-4",children:b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:n?b.jsxs("div",{className:"col-span-3 flex flex-col items-center justify-center py-16 space-y-6",role:"status","aria-live":"polite",children:[b.jsx("div",{className:"h-10 w-10 rounded-full border-4 border-gray-200 border-t-primary animate-spin"}),b.jsx("p",{className:"text-sm font-medium text-gray-500 tracking-wide",children:"Fetching latest insights"}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-6xl mt-6",children:Array.from({length:3}).map((i,S)=>b.jsx("div",{className:"h-48 rounded-xl bg-gray-100 animate-pulse"},S))})]}):h?b.jsx("div",{className:"col-span-3 text-center py-12 text-red-500",children:h}):e.length===0?b.jsx("div",{className:"col-span-3 text-center py-16",children:b.jsxs("div",{className:"text-muted-foreground mb-4",children:[b.jsx(Z1,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),b.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Blog Posts Yet"}),b.jsx("p",{children:"Check back soon for the latest real estate insights and tips!"})]})}):e.map((i,S)=>b.jsx(_l,{delay:S*.04,children:b.jsxs(os,{className:"hover:shadow-lg transition-shadow overflow-hidden",children:[b.jsx("div",{className:"aspect-video overflow-hidden",children:b.jsx("img",{src:i.featured_image||"/placeholder.svg",alt:i.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),b.jsxs(ss,{className:"pb-2",children:[b.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(i.tags||[]).slice(0,2).map(A=>b.jsx(Us,{variant:"secondary",className:"text-xs",children:A},A))}),b.jsx(as,{className:"line-clamp-2",children:b.jsx(us,{to:`/blog/${i.slug}`,className:"hover:text-primary transition-colors",children:i.title})})]}),b.jsxs(ls,{children:[b.jsx("p",{className:"text-muted-foreground mb-4 line-clamp-3",children:i.excerpt||""}),b.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(j0,{size:14}),b.jsx("span",{children:i.author_name||"Julin Real Estate"})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(Z1,{size:14}),b.jsx("span",{children:_(i.published_at)})]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[b.jsx(Nc,{size:14}),b.jsxs("span",{children:[i.view_count??0," views"]})]}),b.jsx(us,{to:`/blog/${i.slug}`,children:b.jsx(Cr,{variant:"outline",size:"sm",children:"Read More"})})]})]})]})},i.id))})})})]}),b.jsx(Pf,{})]})},oze={"guide-to-buying-land-in-kenya":{id:"1",title:"Complete Guide to Buying Land in Kenya",excerpt:"Everything you need to know about purchasing land in Kenya, from legal requirements to due diligence steps.",content:`<h2>Introduction</h2>
<p>Buying land in Kenya is one of the most significant investments you can make. Whether you're looking to build your dream home, start a farming venture, or make a strategic investment, understanding the process is crucial.</p>

<h2>Step 1: Conduct a Land Search</h2>
<p>Before purchasing any land, conduct a thorough search at the Ministry of Lands. This will reveal:</p>
<ul>
<li>The registered owner of the land</li>
<li>Any existing encumbrances or charges</li>
<li>The size and boundaries of the property</li>
</ul>

<h2>Step 2: Verify the Title Deed</h2>
<p>Ensure the seller has a valid title deed. In Kenya, there are several types of titles:</p>
<ul>
<li><strong>Freehold:</strong> Absolute ownership with no time limit</li>
<li><strong>Leasehold:</strong> Ownership for a specified period (usually 99 years)</li>
<li><strong>Sectional Titles:</strong> For apartments and units in buildings</li>
</ul>

<h2>Step 3: Physical Verification</h2>
<p>Always visit the land physically to:</p>
<ul>
<li>Confirm the boundaries match the title deed</li>
<li>Check for any disputes or unauthorized occupation</li>
<li>Assess accessibility and infrastructure</li>
</ul>

<h2>Step 4: Engage a Lawyer</h2>
<p>A qualified lawyer will help with:</p>
<ul>
<li>Drafting the sale agreement</li>
<li>Conducting due diligence</li>
<li>Handling the transfer process</li>
</ul>

<h2>Step 5: Pay Stamp Duty and Register</h2>
<p>After completing the sale:</p>
<ul>
<li>Pay stamp duty (4% in urban areas, 2% in rural areas)</li>
<li>Register the transfer at the Lands Registry</li>
</ul>

<h2>Conclusion</h2>
<p>Buying land in Kenya requires careful planning and due diligence. Work with reputable agents like Julin Real Estate to ensure a smooth transaction.</p>`,featured_image:"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=1200",author_name:"Julin Real Estate",published_at:"2024-12-01",tags:["Land","Buying Guide","Kenya"],view_count:156,seo_title:"Complete Guide to Buying Land in Kenya | Julin Real Estate",seo_description:"Learn everything about buying land in Kenya - from legal requirements to due diligence steps. Expert guide from Julin Real Estate."},"top-investment-areas-nairobi-2024":{id:"2",title:"Top Investment Areas in Nairobi for 2024",excerpt:"Discover the most promising neighborhoods for real estate investment in Nairobi this year.",content:`<h2>Introduction</h2>
<p>Nairobi's real estate market continues to evolve, with certain areas showing exceptional growth potential. Here are the top investment areas for 2024.</p>

<h2>1. Ruaka</h2>
<p>Ruaka has transformed from a quiet suburb to a bustling residential area:</p>
<ul>
<li>Close proximity to major shopping centers</li>
<li>Excellent road infrastructure</li>
<li>Growing demand for rental properties</li>
</ul>

<h2>2. Kiambu Road Corridor</h2>
<p>The areas along Kiambu Road offer:</p>
<ul>
<li>Access to quality schools</li>
<li>Serene environment</li>
<li>Appreciating land values</li>
</ul>

<h2>3. Syokimau</h2>
<p>With the SGR terminus nearby:</p>
<ul>
<li>Industrial and commercial growth</li>
<li>Affordable land prices</li>
<li>Infrastructure development</li>
</ul>

<h2>4. Konza Technopolis</h2>
<p>The "Silicon Savannah" is attracting:</p>
<ul>
<li>Tech companies and startups</li>
<li>Long-term investment potential</li>
<li>Government-backed development</li>
</ul>

<h2>Investment Tips</h2>
<ul>
<li>Research thoroughly before investing</li>
<li>Consider infrastructure development plans</li>
<li>Work with reputable real estate agents</li>
</ul>

<h2>Conclusion</h2>
<p>These areas present excellent opportunities for investors looking to capitalize on Nairobi's growth trajectory.</p>`,featured_image:"https://images.unsplash.com/photo-1611348586804-61bf6c080437?w=1200",author_name:"Julin Real Estate",published_at:"2024-11-15",tags:["Investment","Nairobi","Market Analysis"],view_count:243,seo_title:"Top Investment Areas in Nairobi 2024 | Julin Real Estate",seo_description:"Discover the most promising neighborhoods for real estate investment in Nairobi. Expert market analysis from Julin Real Estate."},"understanding-land-titles-kenya":{id:"3",title:"Understanding Land Titles in Kenya",excerpt:"A comprehensive breakdown of different land title types and what they mean for property owners.",content:`<h2>Introduction</h2>
<p>Understanding land titles is essential for any property transaction in Kenya. This guide breaks down the different types of titles you'll encounter.</p>

<h2>Types of Land Tenure</h2>

<h3>1. Freehold</h3>
<ul>
<li>Absolute ownership of land</li>
<li>No time restrictions</li>
<li>Can be passed on through inheritance</li>
<li>Highest form of land ownership</li>
</ul>

<h3>2. Leasehold</h3>
<ul>
<li>Ownership for a specific period (usually 99 years)</li>
<li>Land reverts to government after lease expires</li>
<li>Can be renewed upon expiration</li>
<li>Common in urban areas</li>
</ul>

<h3>3. Community Land</h3>
<ul>
<li>Held collectively by a community</li>
<li>Registered under community name</li>
<li>Protected under Community Land Act 2016</li>
</ul>

<h2>Title Deed Components</h2>
<p>A valid title deed contains:</p>
<ul>
<li>Land reference number</li>
<li>Registered owner's details</li>
<li>Size of the property</li>
<li>Any encumbrances or charges</li>
</ul>

<h2>Common Issues to Watch</h2>
<ul>
<li>Forged title deeds</li>
<li>Double allocations</li>
<li>Disputed boundaries</li>
<li>Unpaid land rates</li>
</ul>

<h2>How to Verify a Title</h2>
<ol>
<li>Conduct official search at Lands Registry</li>
<li>Visit the physical location</li>
<li>Engage a qualified lawyer</li>
<li>Check for any caveats or charges</li>
</ol>

<h2>Conclusion</h2>
<p>Always verify the authenticity of any title deed before proceeding with a purchase. Julin Real Estate can assist with proper due diligence.</p>`,featured_image:"https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=1200",author_name:"Julin Real Estate",published_at:"2024-11-01",tags:["Legal","Land Titles","Documentation"],view_count:189,seo_title:"Understanding Land Titles in Kenya | Julin Real Estate",seo_description:"Complete guide to land title types in Kenya - freehold, leasehold, and community land. Learn what each means for property owners."},"benefits-of-owning-property-kenya":{id:"4",title:"Benefits of Owning Property in Kenya",excerpt:"Why investing in Kenyan real estate is a smart financial decision for your future.",content:`<h2>Introduction</h2>
<p>Owning property in Kenya offers numerous benefits beyond just having a place to call home. Here's why real estate investment makes sense.</p>

<h2>Financial Benefits</h2>

<h3>1. Appreciation</h3>
<ul>
<li>Land values consistently increase over time</li>
<li>Urban areas see particularly high appreciation</li>
<li>Protection against inflation</li>
</ul>

<h3>2. Rental Income</h3>
<ul>
<li>Generate passive income from tenants</li>
<li>Consistent cash flow</li>
<li>Helps pay off mortgages</li>
</ul>

<h3>3. Tax Benefits</h3>
<ul>
<li>Mortgage interest deductions</li>
<li>Depreciation benefits</li>
<li>Capital gains advantages</li>
</ul>

<h2>Personal Benefits</h2>

<h3>Security</h3>
<ul>
<li>Stable housing for your family</li>
<li>Asset to pass to future generations</li>
<li>Collateral for loans</li>
</ul>

<h3>Freedom</h3>
<ul>
<li>Customize your property</li>
<li>No landlord restrictions</li>
<li>Build equity over time</li>
</ul>

<h2>Why Kenya?</h2>
<ul>
<li>Growing economy</li>
<li>Increasing urbanization</li>
<li>Strong demand for housing</li>
<li>Government support for homeownership</li>
</ul>

<h2>Getting Started</h2>
<ol>
<li>Assess your budget</li>
<li>Choose the right location</li>
<li>Work with trusted agents</li>
<li>Conduct proper due diligence</li>
</ol>

<h2>Conclusion</h2>
<p>Property ownership in Kenya is a journey worth taking. Contact Julin Real Estate to start your investment journey today.</p>`,featured_image:"https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1200",author_name:"Julin Real Estate",published_at:"2024-10-20",tags:["Investment","Benefits","Property"],view_count:98,seo_title:"Benefits of Owning Property in Kenya | Julin Real Estate",seo_description:"Discover why investing in Kenyan real estate is a smart financial decision. Learn about appreciation, rental income, and more."}},sze=()=>{const{slug:e}=hU(),t=e?oze[e]:null,[n,s]=B.useState(null);B.useEffect(()=>{let _=!0;if(t){if(typeof window>"u"){s(t.content);return}return VM(()=>import("./purify.es-C_uT9hQ1.js"),[]).then(i=>{if(!_)return;const S=i,A=S.default??S;s(A.sanitize(t.content))}).catch(()=>{s(t.content)}),()=>{_=!1}}},[t]);const h=_=>new Date(_).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),m=async()=>{if(navigator.share&&t)try{await navigator.share({title:t.title,text:t.excerpt,url:window.location.href})}catch(_){console.log("Error sharing:",_)}else navigator.clipboard.writeText(window.location.href)};return t?b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:t.seo_title}),b.jsx("meta",{name:"description",content:t.seo_description})]}),b.jsx(Ef,{}),b.jsxs("main",{className:"min-h-screen bg-background",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground py-16",children:b.jsx("div",{className:"container mx-auto px-4",children:b.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[b.jsxs(us,{to:"/blog",className:"inline-flex items-center text-primary-foreground/80 hover:text-primary-foreground mb-6",children:[b.jsx(lP,{className:"mr-2",size:16}),"Back to Blogs"]}),b.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:t.title}),b.jsx("p",{className:"text-xl text-primary-foreground/80 max-w-2xl mx-auto",children:t.excerpt})]})})}),b.jsx("section",{className:"py-16",children:b.jsx("div",{className:"container mx-auto px-4",children:b.jsxs("article",{className:"max-w-4xl mx-auto",children:[b.jsx("div",{className:"aspect-video rounded-lg overflow-hidden mb-8",children:b.jsx("img",{src:t.featured_image,alt:t.title,className:"w-full h-full object-cover"})}),b.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-8 p-4 bg-muted rounded-lg border",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(j0,{size:14}),b.jsx("span",{children:t.author_name})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(Z1,{size:14}),b.jsx("span",{children:h(t.published_at)})]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(Nc,{size:14}),b.jsxs("span",{children:[t.view_count," views"]})]}),b.jsxs(Cr,{variant:"ghost",size:"sm",onClick:m,className:"ml-auto",children:[b.jsx(fY,{size:14,className:"mr-1"}),"Share"]})]}),b.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:t.tags.map(_=>b.jsx(Us,{variant:"secondary",children:_},_))}),b.jsx("div",{className:"prose prose-lg max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:n??t.content}}),b.jsxs("div",{className:"mt-12 p-6 bg-muted rounded-lg",children:[b.jsx("h3",{className:"text-xl font-bold mb-2",children:"Need Help with Your Property Search?"}),b.jsx("p",{className:"text-muted-foreground mb-4",children:"Julin Real Estate is here to help you find the perfect property. Contact us today for expert guidance."}),b.jsx(us,{to:"/contact",children:b.jsx(Cr,{children:"Contact Us"})})]})]})})})]}),b.jsx(Pf,{})]}):b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"Blog Not Found - Julin Real Estate"}),b.jsx("meta",{name:"description",content:"The blog post you're looking for could not be found."})]}),b.jsx(Ef,{}),b.jsx("main",{className:"min-h-screen bg-background",children:b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container mx-auto px-4 max-w-4xl text-center",children:[b.jsx("div",{className:"mx-auto h-20 w-20 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:b.jsx(FI,{className:"h-10 w-10 text-destructive"})}),b.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Blog Post Not Found"}),b.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"The blog post you're looking for doesn't exist or has been removed."}),b.jsx(us,{to:"/blog",children:b.jsxs(Cr,{children:[b.jsx(lP,{className:"mr-2",size:16}),"Back to Blogs"]})})]})})}),b.jsx(Pf,{})]})},aze=()=>{const e=$h(),t=$h(),n=$h(),s=[{title:"Verified property listings in Kenya",icon:ZE,description:"Every property undergoes rigorous verification for authenticity and legal compliance."},{title:"Professional property photography",icon:qE,description:"High-quality visuals that showcase properties in their best light."},{title:"Transparent pricing with market rates",icon:TT,description:"Real-time market analysis ensures fair and competitive pricing."},{title:"Local market expertise",icon:qc,description:"Deep understanding of Kenya's 47 counties and property markets."},{title:"Secure transaction support",icon:ZE,description:"Bank-grade security for all your real estate transactions."},{title:"Legal documentation assistance",icon:yf,description:"Expert guidance through Kenya's property registration process."},{title:"Property valuation services",icon:Lc,description:"Accurate valuation using latest market data and trends."}];return b.jsx("section",{id:"about",className:"py-20 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('https://images.unsplash.com/photo-1501183638710-841dd1904471?auto=format&fit=crop&w=1600&q=80')"},children:b.jsx("div",{className:"backdrop-blur-sm bg-white/70 py-10",children:b.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-20",children:[b.jsxs("div",{ref:e.ref,className:`text-center max-w-3xl mx-auto mb-16 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full\r
              bg-gradient-to-r from-primary/15 to-primary/5\r
             text-primary font-semibold text-sm uppercase tracking-wide\r
             border border-primary/20 shadow-sm mb-6`,children:[b.jsx(qE,{className:"h-4 w-4 text-primary"}),"Trusted Since 2022"]}),b.jsxs("h1",{className:"font-display text-4xl md:text-5xl lg:text-6xl font-bold text-foreground leading-[1.15] mb-6",children:["Your Trusted Partner in",b.jsx("span",{className:"block text-primary font-serif tracking-tight",children:"Kenyan Real Estate"})]}),b.jsx("p",{className:"text-lg md:text-xl text-muted-foreground leading-relaxed",children:"Transforming property transactions across Kenya with transparency, expertise, and commitment to excellence."})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16 items-start",children:[b.jsxs("div",{ref:t.ref,className:`space-y-12 transition-all duration-700 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("div",{className:"w-3 h-12 bg-primary rounded-full"}),b.jsxs("div",{children:[b.jsx("h2",{className:"font-display text-2xl md:text-3xl font-bold text-foreground",children:"About Julin Real Estate"}),b.jsx("p",{className:"text-muted-foreground mt-2",children:"Pioneering excellence in Kenya since 2022"})]})]}),b.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"At Julin Real Estate, weve redefined property transactions in Kenya by combining local market expertise with modern technology."}),b.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"From Nairobis urban spaces to serene countryside locations, thousands trust us to guide them through Kenyas property market."})]}),b.jsxs("div",{className:"space-y-8",children:[b.jsxs("h3",{className:"font-display text-2xl font-bold text-foreground flex items-center gap-3",children:[b.jsx("div",{className:"w-8 h-1 bg-primary"})," Our Core Values"]}),b.jsx("div",{className:"grid gap-6",children:[{title:"Transparency & Honesty",desc:"Clear communication, no hidden costs  full trust from start to finish.",icon:Nc,bg:"bg-primary/10",hover:"group-hover:bg-primary/20",border:"hover:border-primary/20"},{title:"Client-Centric Approach",desc:"Your goals shape our service. We provide tailored realestate guidance.",icon:yY,bg:"bg-accent/10",hover:"group-hover:bg-accent/20",border:"hover:border-accent/20"},{title:"Integrity & Security",desc:"Ethical, legally sound transactions backed by secure processes.",icon:ZE,bg:"bg-green-100",hover:"group-hover:bg-green-200",border:"hover:border-green-500/20"}].map((h,m)=>b.jsx("div",{style:{transitionDelay:`${m*80}ms`},className:`group p-6 bg-card rounded-2xl border border-gray-200 ${h.border} hover:shadow-lg transition-all duration-500 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:b.jsxs("div",{className:"flex gap-4 items-start",children:[b.jsx("div",{className:`w-14 h-14 ${h.bg} rounded-xl flex items-center justify-center ${h.hover} transition-colors`,children:b.jsx(h.icon,{className:"h-7 w-7 text-primary"})}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-display text-xl font-semibold mb-2",children:h.title}),b.jsx("p",{className:"text-muted-foreground",children:h.desc})]})]})},m))})]}),b.jsx("div",{className:"pt-6",children:b.jsx(us,{to:"/contact",children:b.jsxs(Cr,{className:"h-14 px-8 rounded-xl bg-primary hover:bg-primary/90 shadow-lg hover:shadow-xl transition-all duration-300 group",children:["Start Your Property Journey",b.jsx(BI,{className:"h-5 w-5 ml-2 group-hover:translate-x-1 transition-transform"})]})})})]}),b.jsxs("div",{ref:n.ref,className:`space-y-10 transition-all duration-700 ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsxs("div",{className:"bg-card rounded-3xl p-8 shadow-xl border border-gray-100",children:[b.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[b.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center shadow-lg",children:b.jsx(qE,{className:"h-6 w-6 text-white"})}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-display text-2xl font-bold",children:"Why Choose Julin?"}),b.jsx("p",{className:"text-muted-foreground text-sm",children:"Experience real estate done right."})]})]}),b.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:s.map((h,m)=>b.jsx("div",{style:{transitionDelay:`${m*65}ms`},className:`group p-5 bg-gradient-to-b from-white to-gray-50 rounded-xl border border-gray-100 hover:border-primary/30 hover:shadow-md transition-all duration-500 cursor-pointer ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-3"}`,children:b.jsxs("div",{className:"flex items-start gap-4",children:[b.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:b.jsx(h.icon,{className:"h-5 w-5 text-primary"})}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold group-hover:text-primary transition-colors",children:h.title}),b.jsx("p",{className:"text-sm text-muted-foreground",children:h.description})]})]})},m))})]}),b.jsxs("div",{className:"relative rounded-3xl overflow-hidden shadow-2xl group",children:[b.jsxs("div",{className:"aspect-video relative",children:[b.jsx("img",{src:"https://images.unsplash.com/photo-1502005097973-6a7082348e28?auto=format&fit=crop&w=1600&q=80",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700",loading:"lazy",alt:"Luxury property Kenya"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"})]}),b.jsxs("div",{className:"absolute bottom-10 left-8",children:[b.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-md rounded-full text-white text-sm mb-3",children:[b.jsx(qc,{className:"h-4 w-4"})," Featured  Nairobi"]}),b.jsx("h3",{className:"text-white text-2xl font-bold mb-2",children:"Luxury Living in Kenya"}),b.jsx("p",{className:"text-white/90 max-w-sm",children:"Premium properties blending elegance with modern comfort."})]}),b.jsx("div",{className:"absolute bottom-6 left-0 w-full px-8",children:b.jsx(us,{to:"/properties",children:b.jsx(Cr,{className:"w-full h-14 bg-white text-foreground rounded-xl hover:bg-white/95 shadow-xl",children:"Explore Premium Properties"})})})]})]})]})]})})})},lze=()=>b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"About  Julin Real Estate"}),b.jsx("meta",{name:"description",content:"About Julin Real Estate  trusted property listings and verified sellers in Kenya."}),b.jsx("meta",{name:"robots",content:"index, follow"}),b.jsx("link",{rel:"canonical",href:"/julin/about"}),b.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),b.jsx("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),b.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Great+Vibes&display=swap",rel:"stylesheet"})]}),b.jsxs("div",{className:"flex flex-col min-h-screen font-sans text-gray-900 bg-gray-50",children:[b.jsx(Ef,{}),b.jsx("main",{className:"flex-grow pt-28 px-4 sm:px-6 lg:px-20",children:b.jsx(aze,{})}),b.jsx(Pf,{})]})]}),cze=()=>{const e=$h(),t=$h(),n=$h(),s=[{icon:jf,label:"Phone",value:"+254725671504",href:"tel:+254725671504",description:"Call us anytime"},{icon:ST,label:"Email",value:"juliusmurigi90@gmail.com",href:"mailto:juliusmurigi90@gmail.com",description:"Response within 24 hours"},{icon:qc,label:"Office Location",value:"Nairobi, Kenya",href:"https://maps.google.com/?q=Nairobi+Kenya",description:"Visit our headquarters"},{icon:b4,label:"Working Hours",value:"Mon - Sat: 8AM - 6PM",href:"#",description:"Sunday: 10AM - 4PM"}];return b.jsx("section",{id:"contact",className:"py-12 md:py-20 lg:py-24 bg-gradient-to-b from-slate-50 via-white to-slate-50 scroll-mt-16",children:b.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[b.jsxs("div",{ref:e.ref,className:`text-center max-w-3xl mx-auto mb-12 md:mb-20 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsx("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary/10 rounded-full text-primary font-semibold text-sm uppercase tracking-wider mb-6",children:"Get in Touch"}),b.jsx("h2",{className:"font-display text-3xl md:text-4xl lg:text-5xl font-bold mb-4 text-foreground",children:"Contact Us Today"}),b.jsx("p",{className:"text-muted-foreground text-base md:text-lg leading-relaxed",children:"Have questions about properties or need real estate support? Reach out to our expert team. We're here to help with any inquiry."})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 lg:gap-10",children:[b.jsxs("div",{ref:t.ref,className:`lg:col-span-1 space-y-6 transition-all duration-700 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[s.map((h,m)=>b.jsxs("a",{href:h.href,"aria-label":`${h.label}: ${h.value}`,target:h.href.startsWith("http")?"_blank":void 0,rel:h.href.startsWith("http")?"noopener noreferrer":void 0,style:{transitionDelay:`${m*80}ms`},className:Wr("flex items-start gap-4 p-5 sm:p-6 bg-white rounded-2xl border border-slate-200","hover:border-primary/30 hover:shadow-lg hover:bg-slate-50 transition-all duration-500",t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-3"),children:[b.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-primary/80 rounded-xl flex items-center justify-center flex-shrink-0",children:b.jsx(h.icon,{className:"h-6 w-6 text-white"})}),b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:h.label}),b.jsx("p",{className:"font-semibold text-slate-900 text-sm md:text-base mt-1",children:h.value}),h.description&&b.jsx("p",{className:"text-xs text-slate-600 mt-1",children:h.description})]})]},m)),b.jsxs("div",{className:"p-5 sm:p-6 bg-gradient-to-br from-primary/5 to-accent/5 rounded-2xl border border-primary/10 mt-8",children:[b.jsxs("h3",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[b.jsx(TT,{className:"h-5 w-5 text-primary"}),"Why Choose Us"]}),b.jsxs("ul",{className:"space-y-3",children:[b.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[b.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),b.jsx("span",{children:"24/7 Real Estate Support"})]}),b.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[b.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),b.jsx("span",{children:"Property Valuation"})]}),b.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[b.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),b.jsx("span",{children:"Verified Listings"})]})]})]})]}),b.jsx("div",{className:"lg:col-span-2",children:b.jsxs("div",{ref:n.ref,className:`bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-slate-100 transition-all duration-700 ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[b.jsx("h3",{className:"font-display text-2xl md:text-3xl font-bold text-slate-900 mb-2",children:"Send Us a Message"}),b.jsx("p",{className:"text-slate-600 mb-8 text-sm md:text-base",children:"Fill in your details below. We'll save your inquiry and you'll be redirected to WhatsApp to continue the conversation."}),b.jsx(uze,{})]})})]})]})})},uze=()=>{const{toast:e}=G5(),[t,n]=B.useState({name:"",phone:"",email:"",message:"",inquiryType:"general"}),[s,h]=B.useState({}),[m,_]=B.useState(!1),[i,S]=B.useState(!1),A="+254725671504",I=()=>{const z={};return t.name.trim()?t.name.trim().length<2&&(z.name="Name must be at least 2 characters"):z.name="Name is required",t.phone.trim()?/^(\+254|0)[0-9]{9}$/.test(t.phone.replace(/\s+/g,""))||(z.phone="Invalid Kenyan phone number"):z.phone="Phone number is required",t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(z.email="Invalid email address"):z.email="Email is required",t.message.trim()?t.message.trim().length<10&&(z.message="Message must be at least 10 characters"):z.message="Message is required",h(z),Object.keys(z).length===0},M=(z,G)=>{n(F=>({...F,[z]:G})),s[z]&&h(F=>({...F,[z]:void 0}))},L=async z=>{if(z.preventDefault(),!I()){e({title:"Validation Error",description:"Please check all fields and try again.",variant:"destructive"});return}_(!0);try{const G=await fetch("https://fakkzdfwpucpgndofgcu.supabase.co/rest/v1/contact_submissions",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk"},body:JSON.stringify({name:t.name.trim(),phone:t.phone.trim(),email:t.email.trim(),message:t.message.trim(),subject:t.subject||"General Inquiry",inquiry_type:t.inquiryType||"general",status:"new"})});if(!G.ok){const K=await G.json();throw console.error("Supabase error:",K),new Error("Failed to save message")}e({title:"Success!",description:"Your message has been saved. Redirecting to WhatsApp...",variant:"default"}),S(!0);const F=`Hi! I'm reaching out about: ${t.message.substring(0,100)}${t.message.length>100?"...":""}%0A%0AYou can reach me at: ${t.phone}`,U=pw(A,F);setTimeout(()=>{window.open(U,"_blank"),n({name:"",phone:"",email:"",message:"",inquiryType:"general"}),S(!1)},1e3)}catch(G){console.error("Form submission error:",G),e({title:"Error",description:"Failed to save your message. Please try again.",variant:"destructive"}),S(!1)}finally{_(!1)}};return b.jsxs("form",{onSubmit:L,className:"space-y-5 md:space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{className:"text-sm font-semibold text-slate-700",children:["Full Name ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx(Mn,{value:t.name,onChange:z=>M("name",z.target.value),placeholder:"John Doe",className:Wr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",s.name&&"border-red-500 focus:border-red-500"),disabled:m}),s.name&&b.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[b.jsx(xv,{className:"h-3 w-3"})," ",s.name]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx($i,{className:"text-sm font-semibold text-slate-700",children:"Inquiry Type"}),b.jsxs("select",{value:t.inquiryType,onChange:z=>M("inquiryType",z.target.value),className:Wr("h-11 px-4 rounded-xl border border-slate-200 bg-white text-slate-900","focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all","text-sm font-medium disabled:bg-slate-50 disabled:text-slate-500"),disabled:m,children:[b.jsx("option",{value:"general",children:"General Inquiry"}),b.jsx("option",{value:"property_inquiry",children:"Property Inquiry"}),b.jsx("option",{value:"support",children:"Support"}),b.jsx("option",{value:"partnership",children:"Partnership"})]})]})]}),b.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{className:"text-sm font-semibold text-slate-700",children:["Phone Number ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx(Mn,{value:t.phone,onChange:z=>M("phone",z.target.value),placeholder:"+254 712 345 678",className:Wr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",s.phone&&"border-red-500 focus:border-red-500"),disabled:m}),s.phone&&b.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[b.jsx(xv,{className:"h-3 w-3"})," ",s.phone]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{className:"text-sm font-semibold text-slate-700",children:["Email Address ",b.jsx("span",{className:"text-red-500",children:"*"})]}),b.jsx(Mn,{type:"email",value:t.email,onChange:z=>M("email",z.target.value),placeholder:"you@example.com",className:Wr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",s.email&&"border-red-500 focus:border-red-500"),disabled:m}),s.email&&b.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[b.jsx(xv,{className:"h-3 w-3"})," ",s.email]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{className:"text-sm font-semibold text-slate-700",children:["Message ",b.jsx("span",{className:"text-red-500",children:"*"}),b.jsxs("span",{className:"text-xs text-slate-500 font-normal ml-2",children:["(",t.message.length,"/500)"]})]}),b.jsx(fl,{value:t.message,onChange:z=>{z.target.value.length<=500&&M("message",z.target.value)},placeholder:"Tell us what you need assistance with...",className:Wr("rounded-xl border-slate-200 focus:border-primary focus:ring-primary min-h-28 resize-none",s.message&&"border-red-500 focus:border-red-500"),maxLength:500,disabled:m}),s.message&&b.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[b.jsx(xv,{className:"h-3 w-3"})," ",s.message]}),b.jsx("p",{className:"text-xs text-slate-500",children:"Keep your message brief. You'll continue on WhatsApp after submission."})]}),b.jsx(Cr,{type:"submit",disabled:m||i,className:Wr("w-full h-12 text-base font-semibold rounded-xl transition-all duration-300","flex items-center justify-center gap-2",i&&"bg-green-600 hover:bg-green-600"),children:m?b.jsxs(b.Fragment,{children:[b.jsx(iY,{className:"h-5 w-5 animate-spin"}),b.jsx("span",{children:"Saving and redirecting..."})]}):i?b.jsxs(b.Fragment,{children:[b.jsx(TT,{className:"h-5 w-5"}),b.jsx("span",{children:"Redirecting to WhatsApp..."})]}):b.jsxs(b.Fragment,{children:[b.jsx(Nm,{className:"h-5 w-5"}),b.jsx("span",{children:"Send and WhatsApp"})]})}),b.jsx("p",{className:"text-xs text-slate-600 text-center",children:"Your message will be saved in our system and you'll continue the conversation on WhatsApp."})]})},hze=()=>b.jsxs(b.Fragment,{children:[b.jsxs(Kh,{children:[b.jsx("title",{children:"Contact  Julin Real Estate"}),b.jsx("meta",{name:"description",content:"Contact Julin Real Estate for inquiries, listings, and support."})]}),b.jsxs("div",{className:"min-h-screen",children:[b.jsx(Ef,{}),b.jsx("main",{children:b.jsx(cze,{})}),b.jsx(Pf,{})]})]}),Kq=({userRole:e,userInfo:t})=>b.jsxs("div",{className:"mb-4",children:[b.jsxs("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[b.jsx(bT,{className:"h-6 w-6 text-blue-600"}),"AI Property Assistant"]}),b.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:e==="admin"?`Welcome back, ${t?.name}! You have admin access to enhanced features.`:`Hi ${t?.name||""}! How can I help you find your perfect property today?`})]}),Yq=({messages:e,messagesEndRef:t})=>b.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm mb-4 flex-1 overflow-y-auto max-h-[50vh]",children:b.jsxs("div",{className:"p-4 space-y-4",children:[e.map((n,s)=>b.jsx("div",{className:`flex ${n.role==="user"?"justify-end":"justify-start"}`,children:b.jsx("div",{className:`max-w-[80%] p-3 rounded-2xl ${n.role==="user"?"bg-blue-600 text-white rounded-br-md":"bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white rounded-bl-md"}`,children:b.jsx("div",{className:"text-sm whitespace-pre-wrap",children:n.content})})},s)),b.jsx("div",{ref:t})]})}),Jq=({input:e,setInput:t,sendMessage:n,loading:s})=>b.jsxs("div",{className:"flex gap-2",children:[b.jsx("input",{value:e,onChange:h=>t(h.target.value),onKeyDown:h=>{h.key==="Enter"&&n()},placeholder:"Ask about properties, e.g. 'Show me houses in Nairobi'",className:"flex-1 rounded-lg border border-border p-2"}),b.jsx("button",{onClick:n,disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-60",children:s?"Sending...":"Send"})]}),Qq=({onSubmit:e,onCancel:t})=>{const[n,s]=B.useState({name:"",phone:""}),[h,m]=B.useState({}),_=(A,I)=>{s(M=>({...M,[A]:I})),m(M=>({...M,[A]:void 0}))},i=()=>{const A={},I=n.phone.replace(/\s/g,"");return n.name.trim()||(A.name="Full name is required"),I?/^(\+254|0)[17]\d{8}$/.test(I)||(A.phone="Enter a valid Kenyan phone number"):A.phone="Phone number is required",m(A),Object.keys(A).length===0},S=A=>{if(A.preventDefault(),console.log("[PreChatForm] submit",{name:n.name,phone:n.phone}),!i()){console.log("[PreChatForm] validation failed",{errors:h});return}console.log("[PreChatForm] calling onSubmit with",{name:n.name.trim(),phone:n.phone.trim()}),e({name:n.name.trim(),phone:n.phone.trim()})};return b.jsx("div",{className:"flex h-full items-center justify-center p-4",children:b.jsxs(os,{className:"w-full max-w-md",children:[b.jsxs(ss,{className:"text-center",children:[b.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:b.jsx(bT,{className:"h-6 w-6 text-primary"})}),b.jsx(as,{className:"text-xl",children:"Mary  Virtual Assistant"}),b.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Share your contact details so I can assist you better and follow up on your property inquiries."})]}),b.jsxs(ls,{children:[b.jsxs("form",{onSubmit:S,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{htmlFor:"name",className:"flex items-center gap-2",children:[b.jsx(j0,{className:"h-4 w-4"}),"Full Name"]}),b.jsx(Mn,{id:"name",value:n.name,placeholder:"Enter your full name",onChange:A=>_("name",A.target.value),"aria-invalid":!!h.name,"aria-describedby":h.name?"name-error":void 0,className:h.name?"border-destructive":""}),h.name&&b.jsx("p",{id:"name-error",className:"text-sm text-destructive",children:h.name})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs($i,{htmlFor:"phone",className:"flex items-center gap-2",children:[b.jsx(jf,{className:"h-4 w-4"}),"Phone Number"]}),b.jsx(Mn,{id:"phone",type:"tel",value:n.phone,placeholder:"+254 712 345 678 or 0712 345 678",onChange:A=>_("phone",A.target.value),"aria-invalid":!!h.phone,"aria-describedby":h.phone?"phone-error":void 0,className:h.phone?"border-destructive":""}),h.phone&&b.jsx("p",{id:"phone-error",className:"text-sm text-destructive",children:h.phone})]}),b.jsxs("div",{className:"flex gap-3 pt-4",children:[b.jsx(Cr,{type:"button",variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),b.jsx(Cr,{type:"submit",className:"flex-1",children:"Start Chat"})]})]}),b.jsx("p",{className:"mt-4 text-center text-xs text-muted-foreground",children:"Your information is used strictly for follow-up and handled confidentially."})]})]})})},dze="https://fakkzdfwpucpgndofgcu.supabase.co",k5="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",Lg="".replace(/\/$/,"");async function fze(e){const t={...e},n=()=>{const h=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID().slice(0,10):Math.random().toString(36).slice(2,12);return`conv_${Date.now()}_${h}`};return t.id||(t.id=n()),t.conversation_id||(t.conversation_id=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`cid_${Date.now()}_${Math.random().toString(36).slice(2,8)}`),K1(Lg?async()=>{const m=await fetch(`${Lg}/api/chat/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!m.ok)throw new Error(`proxy upsert failed: ${m.status}`);return m.json().catch(()=>null)}:async()=>{const{data:h,error:m}=await Er.from("chat_conversations").upsert([t],{onConflict:"conversation_id"}).select();if(m)throw m;return h},3,200)}async function e9(e){return K1(Lg?async()=>{const s=await fetch(`${Lg}/api/chat/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error(`proxy insert failed: ${s.status}`);return s.json().catch(()=>null)}:async()=>{const{data:n,error:s}=await Er.from("chat_messages").insert(e);if(s)throw s;return n},3,200)}async function t9(e,t){if(Lg){const h=await fetch(`${Lg}/api/chat/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,...t})});if(!h.ok)throw new Error(`proxy patch failed: ${h.status}`);return h.json().catch(()=>null)}const{data:n,error:s}=await Er.from("chat_conversations").update(t).eq("conversation_id",e).select();if(s)throw s;return n}async function r9(e,t=15e3){const n=`${dze}/functions/v1/chat`;console.debug("[chatService] fetchReply called",{url:n,payload:e});const s=new AbortController,h=setTimeout(()=>s.abort(),t);try{const m=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",apikey:k5,Authorization:`Bearer ${k5}`},body:JSON.stringify(e),signal:s.signal});if(clearTimeout(h),!m.ok){const i=await m.text().catch(()=>"");throw console.error("[chatService] edge function responded with error",{status:m.status,body:i}),new Error(`edge function error ${m.status}: ${i}`)}const _=await m.json().catch(()=>null);return console.debug("[chatService] fetchReply response",_),_}finally{clearTimeout(h)}}const pze=()=>{G0();const[e,t]=B.useState([]),[n,s]=B.useState(""),[h,m]=B.useState(!1),[_,i]=B.useState("chat"),[S]=B.useState(()=>`conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),A=B.useRef(""),I=B.useRef(null);B.useEffect(()=>{let z=uP("chat_session_id");z||(z=`s_${Date.now()}`,tJ("chat_session_id",z)),A.current=z,uP(`chat:${z}`)||t([{role:"assistant",content:"Hello Admin! I'm your AI property assistant with enhanced capabilities."}])},[]),B.useEffect(()=>I.current?.scrollIntoView({behavior:"smooth"}),[e]);const M=async(z,G)=>{await e9({conversation_id:S,session_id:A.current,role:z,content:G}),await t9(S,{last_message:G.substring(0,100)})},L=async()=>{const z=n.trim();if(!z)return;s("");const G={role:"user",content:z};t(F=>[...F,G]),m(!0),await M("user",z);try{const F={message:z,session_id:A.current,conversation_id:S,user_role:"admin"},U=await r9(F);U?.reply&&(await M("assistant",U.reply),t(K=>[...K,{role:"assistant",content:U.reply}]))}catch{t(U=>[...U,{role:"assistant",content:"Failed to get reply."}])}finally{m(!1)}};return _==="form"?b.jsx(Qq,{onSubmit:()=>i("chat"),onCancel:()=>{}}):b.jsx("div",{className:"h-full flex flex-col",children:b.jsxs("div",{className:"flex-1 p-4 overflow-hidden",children:[b.jsx(Kq,{userRole:"admin",userInfo:null}),b.jsx(Yq,{messages:e,messagesEndRef:I}),b.jsx(Jq,{input:n,setInput:s,sendMessage:L,loading:h})]})})},mze=()=>{const[e,t]=B.useState([]),[n,s]=B.useState(""),[h,m]=B.useState(!1),[_,i]=B.useState("form"),[S]=B.useState(()=>`conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),A=B.useRef(""),I=B.useRef(null);B.useEffect(()=>{let G=uP("chat_session_id");G||(G=`s_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),A.current=G},[]),B.useEffect(()=>I.current?.scrollIntoView({behavior:"smooth"}),[e]);const M=async(G,F)=>{const U="https://fakkzdfwpucpgndofgcu.supabase.co",K="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",J="".replace(/\/$/,"");if(!J&&!K){const X="Chat not configured: missing Supabase URL or publishable key in site build.";throw console.error("[CustomerChat] createConversation aborted",{SUPABASE_URL:U,SUPABASE_PUBLISHABLE_KEY:K,SERVER_API:J}),new Error(X)}await fze({conversation_id:S,user_display_name:G,started_at:new Date().toISOString(),summary:JSON.stringify({phone:F})})},L=async(G,F)=>{await e9({conversation_id:S,session_id:A.current,role:G,content:F}),await t9(S,{last_message:F.substring(0,100)})},z=async()=>{const G=n.trim();if(!G)return;s("");const F={role:"user",content:G};t(U=>[...U,F]),m(!0),await L("user",G);try{const U={message:G,session_id:A.current,conversation_id:S,user_role:"user"},K=await r9(U);K?.reply&&(await L("assistant",K.reply),t(J=>[...J,{role:"assistant",content:K.reply}]))}catch{t(K=>[...K,{role:"assistant",content:"Unable to reach chat service."}])}finally{m(!1)}};return _==="form"?b.jsx(Qq,{onSubmit:async G=>{try{await M(G.name,G.phone),i("chat")}catch(F){console.error("[CustomerChat] createConversation failed",F),alert("Failed to start chat. Check the browser console for details.")}},onCancel:()=>{window.history.back()}}):b.jsx("div",{className:"h-full flex flex-col",children:b.jsxs("div",{className:"flex-1 p-4 overflow-hidden",children:[b.jsx(Kq,{userRole:"user",userInfo:null}),b.jsx(Yq,{messages:e,messagesEndRef:I}),b.jsx(Jq,{input:n,setInput:s,sendMessage:z,loading:h})]})})},gze=()=>{const{isAdmin:e}=G0();return e?b.jsx(pze,{}):b.jsx(mze,{})},n9=()=>b.jsx(gze,{}),yze=Object.freeze(Object.defineProperty({__proto__:null,default:n9},Symbol.toStringTag,{value:"Module"})),_ze=B.lazy(()=>VM(()=>Promise.resolve().then(()=>yze),void 0)),j5="chat_session_id",L5="chat_unread",N5="chat_sound_enabled",z5="chat_first_visit_done",Dh={get(e){try{if(typeof window>"u")return null;if(typeof window.sessionStorage<"u"){const t=sessionStorage.getItem(e);if(t!==null)return t}return typeof window.localStorage<"u"?localStorage.getItem(e):null}catch{return null}},set(e,t){try{if(typeof window>"u")return;try{if(typeof window.sessionStorage<"u"){sessionStorage.setItem(e,t);return}}catch{}typeof window.localStorage<"u"&&localStorage.setItem(e,t)}catch{}}},vze=()=>{const[e,t]=B.useState(!1),[n,s]=B.useState(!1),[h,m]=B.useState(()=>Dh.get(N5)!=="0"),_=B.useRef(null);B.useRef(null);const{isAdmin:i}=G0();B.useEffect(()=>{let M=null;i&&(M=Dh.get(j5)),M||(M=`s_${Date.now()}`,i&&Dh.set(j5,M)),Dh.get(z5)||(t(!0),Dh.set(z5,"1")),s(Dh.get(L5)==="1")},[i]);const S=B.useCallback(()=>{if(h)try{_.current||(_.current=new AudioContext);const M=_.current,L=M.createOscillator(),z=M.createGain();L.frequency.value=680,z.gain.value=.03,L.connect(z),z.connect(M.destination),L.start(),setTimeout(()=>L.stop(),120)}catch{}},[h]),A=()=>{m(M=>(Dh.set(N5,M?"0":"1"),!M))},I=B.useCallback(()=>{s(!1),Dh.set(L5,"0")},[]);return B.useEffect(()=>{e&&I()},[e,I]),B.useEffect(()=>{},[e,S,I]),b.jsxs(b.Fragment,{children:[b.jsx(ng,{children:b.jsx("div",{"aria-live":"polite",children:n?"New message received":""})}),b.jsx("div",{className:"fixed bottom-24 right-6 z-50",children:b.jsx(Cr,{size:"icon",variant:"ghost",onClick:A,"aria-label":h?"Disable chat sound":"Enable chat sound",title:h?"Mute notifications (Ctrl+.)":"Enable notifications (Ctrl+.)",className:"h-9 w-9 rounded-full bg-white shadow-md flex items-center justify-center focus-visible:ring-2",children:h?b.jsx(xY,{className:"h-4 w-4 text-slate-700"}):b.jsx(bY,{className:"h-4 w-4 text-slate-700"})})}),b.jsxs(Vu,{open:e,onOpenChange:t,children:[b.jsx(YU,{asChild:!0,children:b.jsx(Cr,{size:"icon","aria-label":"Open AI property assistant",className:"group fixed bottom-6 right-6 z-50 h-16 w-16 rounded-full bg-blue-600 shadow-xl hover:bg-blue-700 focus-visible:ring-2",children:b.jsxs("div",{className:"relative",children:[b.jsx(bT,{className:"h-7 w-7 text-white"}),b.jsx(cg,{children:n&&b.jsxs(_n.span,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute -top-1 -right-1 h-5 w-5",children:[b.jsx("span",{className:"absolute inset-0 rounded-full bg-red-400 opacity-60 animate-ping"}),b.jsx("span",{className:"absolute inset-[6px] rounded-full bg-red-500"})]})})]})})}),b.jsxs(Kc,{className:"m-4 h-[90vh] max-w-6xl p-0",children:[b.jsxs(ng,{children:[b.jsx(qu,{children:"chat Assistant"}),b.jsx(qM,{children:"Chat with the AI assistant about properties, pricing, and listings."})]}),b.jsx("div",{className:"h-full overflow-hidden",children:b.jsx(B.Suspense,{fallback:b.jsx("div",{className:"p-4",children:"Loading chat"}),children:b.jsx(_ze,{})})})]})]})]})},xze=()=>{const{user:e,isAdmin:t}=G0(),n=qg(),s=hc(),h=B.useRef(null);return B.useEffect(()=>{!h.current&&e&&t&&!s.pathname.startsWith("/admin")&&n("/admin",{replace:!0}),h.current=e},[e,t,n,s.pathname]),null},bze=new nse,wze=()=>b.jsx(bU,{children:b.jsx(ose,{client:bze,children:b.jsxs(bee,{children:[b.jsx(Tee,{}),b.jsx(oJ,{}),b.jsx(NJ,{}),b.jsxs(sae,{children:[b.jsx(yce,{}),b.jsx(xze,{}),b.jsxs(Jse,{children:[b.jsx(rs,{path:"/",element:b.jsx(dce,{})}),b.jsx(rs,{path:"/properties",element:b.jsx(rze,{})}),b.jsx(rs,{path:"/property/:id",element:b.jsx(nze,{})}),b.jsx(rs,{path:"/blogs",element:b.jsx(ize,{})}),b.jsx(rs,{path:"/blog/:slug",element:b.jsx(sze,{})}),b.jsx(rs,{path:"/about",element:b.jsx(lze,{})}),b.jsx(rs,{path:"/contact",element:b.jsx(hze,{})}),b.jsx(rs,{path:"/chat",element:b.jsx(n9,{})}),b.jsx(rs,{path:"/admin/login",element:b.jsx(tue,{})}),b.jsxs(rs,{path:"/admin",element:b.jsx(eue,{}),children:[b.jsx(rs,{index:!0,element:b.jsx(Jke,{})}),b.jsx(rs,{path:"properties",element:b.jsx(hNe,{})}),b.jsx(rs,{path:"blogs",element:b.jsx(bNe,{})}),b.jsx(rs,{path:"submissions",element:b.jsx(wNe,{})}),b.jsx(rs,{path:"inquiries",element:b.jsx(TNe,{})}),b.jsx(rs,{path:"chats",element:b.jsx(ENe,{})}),b.jsx(rs,{path:"profile",element:b.jsx(INe,{})})]}),b.jsx(rs,{path:"*",element:b.jsx(gce,{})})]}),b.jsx(vze,{})]}),b.jsx(Doe,{})]})})}),Tze=({children:e})=>{const[t,n]=B.useState(null),[s,h]=B.useState(null),[m,_]=B.useState(!1),[i,S]=B.useState(!0),A=async L=>{try{const{data:z}=await Er.from("user_roles").select("role").eq("user_id",L).eq("role","admin").maybeSingle();_(!!z)}catch(z){console.error("Failed to check user role",z),_(!1)}};B.useEffect(()=>{let L=!0;const{data:{subscription:z}}=Er.auth.onAuthStateChange((G,F)=>{L&&(h(F),n(F?.user??null),F?.user?setTimeout(()=>{L&&A(F.user.id)},0):_(!1),S(!1))});return Er.auth.getSession().then(({data:{session:G}})=>{L&&(h(G),n(G?.user??null),G?.user&&A(G.user.id),S(!1))}),()=>{L=!1,z.unsubscribe()}},[]);const I=async(L,z)=>{if(z){const{error:G}=await Er.auth.signInWithPassword({email:L,password:z});if(G)throw G}else{const{error:G}=await Er.auth.signInWithOtp({email:L});if(G)throw G}},M=async()=>{await Er.auth.signOut(),n(null),h(null),_(!1)};return b.jsx(r6.Provider,{value:{user:t,isAdmin:m,loading:i,signInWithEmail:I,signOut:M},children:e})};U5(document.getElementById("root")).render(b.jsx(Tze,{children:b.jsx(wze,{})}));typeof navigator<"u"&&"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/julin/sw.js").then(t=>{console.log("Service worker registered:",t.scope)}).catch(t=>{console.warn("Service worker registration failed:",t)})});
