import{r as B,b as ey,R as Le,d as M4,e as gM,a as Ni,c as zv}from"./react-2v7z3eUw.js";import{_ as Gd,a as O4,b as qX,c as ZX}from"./vendor-v1RthXxQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const f of d)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function n(d){const f={};return d.integrity&&(f.integrity=d.integrity),d.referrerPolicy&&(f.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?f.credentials="include":d.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function o(d){if(d.ep)return;d.ep=!0;const f=n(d);fetch(d.href,f)}})();var R4={exports:{}},zS={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KX=B,XX=Symbol.for("react.element"),YX=Symbol.for("react.fragment"),JX=Object.prototype.hasOwnProperty,QX=KX.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eY={key:!0,ref:!0,__self:!0,__source:!0};function k4(e,t,n){var o,d={},f=null,_=null;n!==void 0&&(f=""+n),t.key!==void 0&&(f=""+t.key),t.ref!==void 0&&(_=t.ref);for(o in t)JX.call(t,o)&&!eY.hasOwnProperty(o)&&(d[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)d[o]===void 0&&(d[o]=t[o]);return{$$typeof:XX,type:e,key:f,ref:_,props:d,_owner:QX.current}}zS.Fragment=YX;zS.jsx=k4;zS.jsxs=k4;R4.exports=zS;var x=R4.exports,j4,qL=ey;j4=qL.createRoot,qL.hydrateRoot;const tY=1,rY=1e6;let yE=0;function nY(){return yE=(yE+1)%Number.MAX_SAFE_INTEGER,yE.toString()}const _E=new Map,ZL=e=>{if(_E.has(e))return;const t=setTimeout(()=>{_E.delete(e),Uv({type:"REMOVE_TOAST",toastId:e})},rY);_E.set(e,t)},iY=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,tY)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(n=>n.id===t.toast.id?{...n,...t.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?ZL(n):e.toasts.forEach(o=>{ZL(o.id)}),{...e,toasts:e.toasts.map(o=>o.id===n||n===void 0?{...o,open:!1}:o)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(n=>n.id!==t.toastId)}}},X1=[];let Y1={toasts:[]};function Uv(e){Y1=iY(Y1,e),X1.forEach(t=>{t(Y1)})}function rn({...e}){const t=nY(),n=d=>Uv({type:"UPDATE_TOAST",toast:{...d,id:t}}),o=()=>Uv({type:"DISMISS_TOAST",toastId:t});return Uv({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:d=>{d||o()}}}),{id:t,dismiss:o,update:n}}function D4(){const[e,t]=B.useState(Y1);return B.useEffect(()=>(X1.push(t),()=>{const n=X1.indexOf(t);n>-1&&X1.splice(n,1)}),[e]),{...e,toast:rn,dismiss:n=>Uv({type:"DISMISS_TOAST",toastId:n})}}function Pr(e,t,{checkForDefaultPrevented:n=!0}={}){return function(d){if(e?.(d),n===!1||!d.defaultPrevented)return t?.(d)}}function KL(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function FS(...e){return t=>{let n=!1;const o=e.map(d=>{const f=KL(d,t);return!n&&typeof f=="function"&&(n=!0),f});if(n)return()=>{for(let d=0;d<o.length;d++){const f=o[d];typeof f=="function"?f():KL(e[d],null)}}}}function di(...e){return B.useCallback(FS(...e),e)}function oY(e,t){const n=B.createContext(t),o=f=>{const{children:_,...i}=f,S=B.useMemo(()=>i,Object.values(i));return x.jsx(n.Provider,{value:S,children:_})};o.displayName=e+"Provider";function d(f){const _=B.useContext(n);if(_)return _;if(t!==void 0)return t;throw new Error(`\`${f}\` must be used within \`${e}\``)}return[o,d]}function fc(e,t=[]){let n=[];function o(f,_){const i=B.createContext(_),S=n.length;n=[...n,_];const E=M=>{const{scope:j,children:N,...G}=M,z=j?.[e]?.[S]||i,V=B.useMemo(()=>G,Object.values(G));return x.jsx(z.Provider,{value:V,children:N})};E.displayName=f+"Provider";function I(M,j){const N=j?.[e]?.[S]||i,G=B.useContext(N);if(G)return G;if(_!==void 0)return _;throw new Error(`\`${M}\` must be used within \`${f}\``)}return[E,I]}const d=()=>{const f=n.map(_=>B.createContext(_));return function(i){const S=i?.[e]||f;return B.useMemo(()=>({[`__scope${e}`]:{...i,[e]:S}}),[i,S])}};return d.scopeName=e,[o,sY(d,...t)]}function sY(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const o=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(f){const _=o.reduce((i,{useScope:S,scopeName:E})=>{const M=S(f)[`__scope${E}`];return{...i,...M}},{});return B.useMemo(()=>({[`__scope${t.scopeName}`]:_}),[_])}};return n.scopeName=t.scopeName,n}function Rf(e){const t=aY(e),n=B.forwardRef((o,d)=>{const{children:f,..._}=o,i=B.Children.toArray(f),S=i.find(cY);if(S){const E=S.props.children,I=i.map(M=>M===S?B.Children.count(E)>1?B.Children.only(null):B.isValidElement(E)?E.props.children:null:M);return x.jsx(t,{..._,ref:d,children:B.isValidElement(E)?B.cloneElement(E,void 0,I):null})}return x.jsx(t,{..._,ref:d,children:f})});return n.displayName=`${e}.Slot`,n}var L4=Rf("Slot");function aY(e){const t=B.forwardRef((n,o)=>{const{children:d,...f}=n;if(B.isValidElement(d)){const _=dY(d),i=uY(f,d.props);return d.type!==B.Fragment&&(i.ref=o?FS(o,_):_),B.cloneElement(d,i)}return B.Children.count(d)>1?B.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var N4=Symbol("radix.slottable");function lY(e){const t=({children:n})=>x.jsx(x.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=N4,t}function cY(e){return B.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===N4}function uY(e,t){const n={...t};for(const o in t){const d=e[o],f=t[o];/^on[A-Z]/.test(o)?d&&f?n[o]=(...i)=>{const S=f(...i);return d(...i),S}:d&&(n[o]=d):o==="style"?n[o]={...d,...f}:o==="className"&&(n[o]=[d,f].filter(Boolean).join(" "))}return{...e,...n}}function dY(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function X0(e){const t=e+"CollectionProvider",[n,o]=fc(t),[d,f]=n(t,{collectionRef:{current:null},itemMap:new Map}),_=z=>{const{scope:V,children:K}=z,Q=Le.useRef(null),X=Le.useRef(new Map).current;return x.jsx(d,{scope:V,itemMap:X,collectionRef:Q,children:K})};_.displayName=t;const i=e+"CollectionSlot",S=Rf(i),E=Le.forwardRef((z,V)=>{const{scope:K,children:Q}=z,X=f(i,K),ie=di(V,X.collectionRef);return x.jsx(S,{ref:ie,children:Q})});E.displayName=i;const I=e+"CollectionItemSlot",M="data-radix-collection-item",j=Rf(I),N=Le.forwardRef((z,V)=>{const{scope:K,children:Q,...X}=z,ie=Le.useRef(null),J=di(V,ie),se=f(I,K);return Le.useEffect(()=>(se.itemMap.set(ie,{ref:ie,...X}),()=>void se.itemMap.delete(ie))),x.jsx(j,{[M]:"",ref:J,children:Q})});N.displayName=I;function G(z){const V=f(e+"CollectionConsumer",z);return Le.useCallback(()=>{const Q=V.collectionRef.current;if(!Q)return[];const X=Array.from(Q.querySelectorAll(`[${M}]`));return Array.from(V.itemMap.values()).sort((se,he)=>X.indexOf(se.ref.current)-X.indexOf(he.ref.current))},[V.collectionRef,V.itemMap])}return[{Provider:_,Slot:E,ItemSlot:N},G,o]}var hY=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],En=hY.reduce((e,t)=>{const n=Rf(`Primitive.${t}`),o=B.forwardRef((d,f)=>{const{asChild:_,...i}=d,S=_?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),x.jsx(S,{...i,ref:f})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{});function yM(e,t){e&&ey.flushSync(()=>e.dispatchEvent(t))}function Aa(e){const t=B.useRef(e);return B.useEffect(()=>{t.current=e}),B.useMemo(()=>(...n)=>t.current?.(...n),[])}function fY(e,t=globalThis?.document){const n=Aa(e);B.useEffect(()=>{const o=d=>{d.key==="Escape"&&n(d)};return t.addEventListener("keydown",o,{capture:!0}),()=>t.removeEventListener("keydown",o,{capture:!0})},[n,t])}var pY="DismissableLayer",RP="dismissableLayer.update",mY="dismissableLayer.pointerDownOutside",gY="dismissableLayer.focusOutside",XL,z4=B.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),ty=B.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:o,onPointerDownOutside:d,onFocusOutside:f,onInteractOutside:_,onDismiss:i,...S}=e,E=B.useContext(z4),[I,M]=B.useState(null),j=I?.ownerDocument??globalThis?.document,[,N]=B.useState({}),G=di(t,he=>M(he)),z=Array.from(E.layers),[V]=[...E.layersWithOutsidePointerEventsDisabled].slice(-1),K=z.indexOf(V),Q=I?z.indexOf(I):-1,X=E.layersWithOutsidePointerEventsDisabled.size>0,ie=Q>=K,J=_Y(he=>{const we=he.target,ze=[...E.branches].some(je=>je.contains(we));!ie||ze||(d?.(he),_?.(he),he.defaultPrevented||i?.())},j),se=vY(he=>{const we=he.target;[...E.branches].some(je=>je.contains(we))||(f?.(he),_?.(he),he.defaultPrevented||i?.())},j);return fY(he=>{Q===E.layers.size-1&&(o?.(he),!he.defaultPrevented&&i&&(he.preventDefault(),i()))},j),B.useEffect(()=>{if(I)return n&&(E.layersWithOutsidePointerEventsDisabled.size===0&&(XL=j.body.style.pointerEvents,j.body.style.pointerEvents="none"),E.layersWithOutsidePointerEventsDisabled.add(I)),E.layers.add(I),YL(),()=>{n&&E.layersWithOutsidePointerEventsDisabled.size===1&&(j.body.style.pointerEvents=XL)}},[I,j,n,E]),B.useEffect(()=>()=>{I&&(E.layers.delete(I),E.layersWithOutsidePointerEventsDisabled.delete(I),YL())},[I,E]),B.useEffect(()=>{const he=()=>N({});return document.addEventListener(RP,he),()=>document.removeEventListener(RP,he)},[]),x.jsx(En.div,{...S,ref:G,style:{pointerEvents:X?ie?"auto":"none":void 0,...e.style},onFocusCapture:Pr(e.onFocusCapture,se.onFocusCapture),onBlurCapture:Pr(e.onBlurCapture,se.onBlurCapture),onPointerDownCapture:Pr(e.onPointerDownCapture,J.onPointerDownCapture)})});ty.displayName=pY;var yY="DismissableLayerBranch",F4=B.forwardRef((e,t)=>{const n=B.useContext(z4),o=B.useRef(null),d=di(t,o);return B.useEffect(()=>{const f=o.current;if(f)return n.branches.add(f),()=>{n.branches.delete(f)}},[n.branches]),x.jsx(En.div,{...e,ref:d})});F4.displayName=yY;function _Y(e,t=globalThis?.document){const n=Aa(e),o=B.useRef(!1),d=B.useRef(()=>{});return B.useEffect(()=>{const f=i=>{if(i.target&&!o.current){let S=function(){B4(mY,n,E,{discrete:!0})};const E={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",d.current),d.current=S,t.addEventListener("click",d.current,{once:!0})):S()}else t.removeEventListener("click",d.current);o.current=!1},_=window.setTimeout(()=>{t.addEventListener("pointerdown",f)},0);return()=>{window.clearTimeout(_),t.removeEventListener("pointerdown",f),t.removeEventListener("click",d.current)}},[t,n]),{onPointerDownCapture:()=>o.current=!0}}function vY(e,t=globalThis?.document){const n=Aa(e),o=B.useRef(!1);return B.useEffect(()=>{const d=f=>{f.target&&!o.current&&B4(gY,n,{originalEvent:f},{discrete:!1})};return t.addEventListener("focusin",d),()=>t.removeEventListener("focusin",d)},[t,n]),{onFocusCapture:()=>o.current=!0,onBlurCapture:()=>o.current=!1}}function YL(){const e=new CustomEvent(RP);document.dispatchEvent(e)}function B4(e,t,n,{discrete:o}){const d=n.originalEvent.target,f=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&d.addEventListener(e,t,{once:!0}),o?yM(d,f):d.dispatchEvent(f)}var xY=ty,bY=F4,Ns=globalThis?.document?B.useLayoutEffect:()=>{},wY="Portal",Y0=B.forwardRef((e,t)=>{const{container:n,...o}=e,[d,f]=B.useState(!1);Ns(()=>f(!0),[]);const _=n||d&&globalThis?.document?.body;return _?M4.createPortal(x.jsx(En.div,{...o,ref:t}),_):null});Y0.displayName=wY;function SY(e,t){return B.useReducer((n,o)=>t[n][o]??n,e)}var pc=e=>{const{present:t,children:n}=e,o=TY(t),d=typeof n=="function"?n({present:o.isPresent}):B.Children.only(n),f=di(o.ref,AY(d));return typeof n=="function"||o.isPresent?B.cloneElement(d,{ref:f}):null};pc.displayName="Presence";function TY(e){const[t,n]=B.useState(),o=B.useRef(null),d=B.useRef(e),f=B.useRef("none"),_=e?"mounted":"unmounted",[i,S]=SY(_,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return B.useEffect(()=>{const E=_1(o.current);f.current=i==="mounted"?E:"none"},[i]),Ns(()=>{const E=o.current,I=d.current;if(I!==e){const j=f.current,N=_1(E);e?S("MOUNT"):N==="none"||E?.display==="none"?S("UNMOUNT"):S(I&&j!==N?"ANIMATION_OUT":"UNMOUNT"),d.current=e}},[e,S]),Ns(()=>{if(t){let E;const I=t.ownerDocument.defaultView??window,M=N=>{const z=_1(o.current).includes(N.animationName);if(N.target===t&&z&&(S("ANIMATION_END"),!d.current)){const V=t.style.animationFillMode;t.style.animationFillMode="forwards",E=I.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=V)})}},j=N=>{N.target===t&&(f.current=_1(o.current))};return t.addEventListener("animationstart",j),t.addEventListener("animationcancel",M),t.addEventListener("animationend",M),()=>{I.clearTimeout(E),t.removeEventListener("animationstart",j),t.removeEventListener("animationcancel",M),t.removeEventListener("animationend",M)}}else S("ANIMATION_END")},[t,S]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:B.useCallback(E=>{o.current=E?getComputedStyle(E):null,n(E)},[])}}function _1(e){return e?.animationName||"none"}function AY(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var EY=gM[" useInsertionEffect ".trim().toString()]||Ns;function Qd({prop:e,defaultProp:t,onChange:n=()=>{},caller:o}){const[d,f,_]=PY({defaultProp:t,onChange:n}),i=e!==void 0,S=i?e:d;{const I=B.useRef(e!==void 0);B.useEffect(()=>{const M=I.current;M!==i&&console.warn(`${o} is changing from ${M?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),I.current=i},[i,o])}const E=B.useCallback(I=>{if(i){const M=CY(I)?I(e):I;M!==e&&_.current?.(M)}else f(I)},[i,e,f,_]);return[S,E]}function PY({defaultProp:e,onChange:t}){const[n,o]=B.useState(e),d=B.useRef(n),f=B.useRef(t);return EY(()=>{f.current=t},[t]),B.useEffect(()=>{d.current!==n&&(f.current?.(n),d.current=n)},[n,d]),[n,o,f]}function CY(e){return typeof e=="function"}var $4=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),IY="VisuallyHidden",bg=B.forwardRef((e,t)=>x.jsx(En.span,{...e,ref:t,style:{...$4,...e.style}}));bg.displayName=IY;var MY=bg,_M="ToastProvider",[vM,OY,RY]=X0("Toast"),[V4,kFe]=fc("Toast",[RY]),[kY,BS]=V4(_M),U4=e=>{const{__scopeToast:t,label:n="Notification",duration:o=5e3,swipeDirection:d="right",swipeThreshold:f=50,children:_}=e,[i,S]=B.useState(null),[E,I]=B.useState(0),M=B.useRef(!1),j=B.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${_M}\`. Expected non-empty \`string\`.`),x.jsx(vM.Provider,{scope:t,children:x.jsx(kY,{scope:t,label:n,duration:o,swipeDirection:d,swipeThreshold:f,toastCount:E,viewport:i,onViewportChange:S,onToastAdd:B.useCallback(()=>I(N=>N+1),[]),onToastRemove:B.useCallback(()=>I(N=>N-1),[]),isFocusedToastEscapeKeyDownRef:M,isClosePausedRef:j,children:_})})};U4.displayName=_M;var G4="ToastViewport",jY=["F8"],kP="toast.viewportPause",jP="toast.viewportResume",H4=B.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:o=jY,label:d="Notifications ({hotkey})",...f}=e,_=BS(G4,n),i=OY(n),S=B.useRef(null),E=B.useRef(null),I=B.useRef(null),M=B.useRef(null),j=di(t,M,_.onViewportChange),N=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),G=_.toastCount>0;B.useEffect(()=>{const V=K=>{o.length!==0&&o.every(X=>K[X]||K.code===X)&&M.current?.focus()};return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[o]),B.useEffect(()=>{const V=S.current,K=M.current;if(G&&V&&K){const Q=()=>{if(!_.isClosePausedRef.current){const se=new CustomEvent(kP);K.dispatchEvent(se),_.isClosePausedRef.current=!0}},X=()=>{if(_.isClosePausedRef.current){const se=new CustomEvent(jP);K.dispatchEvent(se),_.isClosePausedRef.current=!1}},ie=se=>{!V.contains(se.relatedTarget)&&X()},J=()=>{V.contains(document.activeElement)||X()};return V.addEventListener("focusin",Q),V.addEventListener("focusout",ie),V.addEventListener("pointermove",Q),V.addEventListener("pointerleave",J),window.addEventListener("blur",Q),window.addEventListener("focus",X),()=>{V.removeEventListener("focusin",Q),V.removeEventListener("focusout",ie),V.removeEventListener("pointermove",Q),V.removeEventListener("pointerleave",J),window.removeEventListener("blur",Q),window.removeEventListener("focus",X)}}},[G,_.isClosePausedRef]);const z=B.useCallback(({tabbingDirection:V})=>{const Q=i().map(X=>{const ie=X.ref.current,J=[ie,...qY(ie)];return V==="forwards"?J:J.reverse()});return(V==="forwards"?Q.reverse():Q).flat()},[i]);return B.useEffect(()=>{const V=M.current;if(V){const K=Q=>{const X=Q.altKey||Q.ctrlKey||Q.metaKey;if(Q.key==="Tab"&&!X){const J=document.activeElement,se=Q.shiftKey;if(Q.target===V&&se){E.current?.focus();return}const ze=z({tabbingDirection:se?"backwards":"forwards"}),je=ze.findIndex(Oe=>Oe===J);vE(ze.slice(je+1))?Q.preventDefault():se?E.current?.focus():I.current?.focus()}};return V.addEventListener("keydown",K),()=>V.removeEventListener("keydown",K)}},[i,z]),x.jsxs(bY,{ref:S,role:"region","aria-label":d.replace("{hotkey}",N),tabIndex:-1,style:{pointerEvents:G?void 0:"none"},children:[G&&x.jsx(DP,{ref:E,onFocusFromOutsideViewport:()=>{const V=z({tabbingDirection:"forwards"});vE(V)}}),x.jsx(vM.Slot,{scope:n,children:x.jsx(En.ol,{tabIndex:-1,...f,ref:j})}),G&&x.jsx(DP,{ref:I,onFocusFromOutsideViewport:()=>{const V=z({tabbingDirection:"backwards"});vE(V)}})]})});H4.displayName=G4;var W4="ToastFocusProxy",DP=B.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:o,...d}=e,f=BS(W4,n);return x.jsx(bg,{"aria-hidden":!0,tabIndex:0,...d,ref:t,style:{position:"fixed"},onFocus:_=>{const i=_.relatedTarget;!f.viewport?.contains(i)&&o()}})});DP.displayName=W4;var J0="Toast",DY="toast.swipeStart",LY="toast.swipeMove",NY="toast.swipeCancel",zY="toast.swipeEnd",q4=B.forwardRef((e,t)=>{const{forceMount:n,open:o,defaultOpen:d,onOpenChange:f,..._}=e,[i,S]=Qd({prop:o,defaultProp:d??!0,onChange:f,caller:J0});return x.jsx(pc,{present:n||i,children:x.jsx($Y,{open:i,..._,ref:t,onClose:()=>S(!1),onPause:Aa(e.onPause),onResume:Aa(e.onResume),onSwipeStart:Pr(e.onSwipeStart,E=>{E.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Pr(e.onSwipeMove,E=>{const{x:I,y:M}=E.detail.delta;E.currentTarget.setAttribute("data-swipe","move"),E.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${I}px`),E.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${M}px`)}),onSwipeCancel:Pr(e.onSwipeCancel,E=>{E.currentTarget.setAttribute("data-swipe","cancel"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),E.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Pr(e.onSwipeEnd,E=>{const{x:I,y:M}=E.detail.delta;E.currentTarget.setAttribute("data-swipe","end"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),E.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),E.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${I}px`),E.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${M}px`),S(!1)})})})});q4.displayName=J0;var[FY,BY]=V4(J0,{onClose(){}}),$Y=B.forwardRef((e,t)=>{const{__scopeToast:n,type:o="foreground",duration:d,open:f,onClose:_,onEscapeKeyDown:i,onPause:S,onResume:E,onSwipeStart:I,onSwipeMove:M,onSwipeCancel:j,onSwipeEnd:N,...G}=e,z=BS(J0,n),[V,K]=B.useState(null),Q=di(t,Xe=>K(Xe)),X=B.useRef(null),ie=B.useRef(null),J=d||z.duration,se=B.useRef(0),he=B.useRef(J),we=B.useRef(0),{onToastAdd:ze,onToastRemove:je}=z,Oe=Aa(()=>{V?.contains(document.activeElement)&&z.viewport?.focus(),_()}),Be=B.useCallback(Xe=>{!Xe||Xe===1/0||(window.clearTimeout(we.current),se.current=new Date().getTime(),we.current=window.setTimeout(Oe,Xe))},[Oe]);B.useEffect(()=>{const Xe=z.viewport;if(Xe){const it=()=>{Be(he.current),E?.()},Ge=()=>{const Ke=new Date().getTime()-se.current;he.current=he.current-Ke,window.clearTimeout(we.current),S?.()};return Xe.addEventListener(kP,Ge),Xe.addEventListener(jP,it),()=>{Xe.removeEventListener(kP,Ge),Xe.removeEventListener(jP,it)}}},[z.viewport,J,S,E,Be]),B.useEffect(()=>{f&&!z.isClosePausedRef.current&&Be(J)},[f,J,z.isClosePausedRef,Be]),B.useEffect(()=>(ze(),()=>je()),[ze,je]);const qe=B.useMemo(()=>V?e$(V):null,[V]);return z.viewport?x.jsxs(x.Fragment,{children:[qe&&x.jsx(VY,{__scopeToast:n,role:"status","aria-live":o==="foreground"?"assertive":"polite","aria-atomic":!0,children:qe}),x.jsx(FY,{scope:n,onClose:Oe,children:ey.createPortal(x.jsx(vM.ItemSlot,{scope:n,children:x.jsx(xY,{asChild:!0,onEscapeKeyDown:Pr(i,()=>{z.isFocusedToastEscapeKeyDownRef.current||Oe(),z.isFocusedToastEscapeKeyDownRef.current=!1}),children:x.jsx(En.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":f?"open":"closed","data-swipe-direction":z.swipeDirection,...G,ref:Q,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Pr(e.onKeyDown,Xe=>{Xe.key==="Escape"&&(i?.(Xe.nativeEvent),Xe.nativeEvent.defaultPrevented||(z.isFocusedToastEscapeKeyDownRef.current=!0,Oe()))}),onPointerDown:Pr(e.onPointerDown,Xe=>{Xe.button===0&&(X.current={x:Xe.clientX,y:Xe.clientY})}),onPointerMove:Pr(e.onPointerMove,Xe=>{if(!X.current)return;const it=Xe.clientX-X.current.x,Ge=Xe.clientY-X.current.y,Ke=!!ie.current,ut=["left","right"].includes(z.swipeDirection),rt=["left","up"].includes(z.swipeDirection)?Math.min:Math.max,Xt=ut?rt(0,it):0,cr=ut?0:rt(0,Ge),Bt=Xe.pointerType==="touch"?10:2,$t={x:Xt,y:cr},br={originalEvent:Xe,delta:$t};Ke?(ie.current=$t,v1(LY,M,br,{discrete:!1})):JL($t,z.swipeDirection,Bt)?(ie.current=$t,v1(DY,I,br,{discrete:!1}),Xe.target.setPointerCapture(Xe.pointerId)):(Math.abs(it)>Bt||Math.abs(Ge)>Bt)&&(X.current=null)}),onPointerUp:Pr(e.onPointerUp,Xe=>{const it=ie.current,Ge=Xe.target;if(Ge.hasPointerCapture(Xe.pointerId)&&Ge.releasePointerCapture(Xe.pointerId),ie.current=null,X.current=null,it){const Ke=Xe.currentTarget,ut={originalEvent:Xe,delta:it};JL(it,z.swipeDirection,z.swipeThreshold)?v1(zY,N,ut,{discrete:!0}):v1(NY,j,ut,{discrete:!0}),Ke.addEventListener("click",rt=>rt.preventDefault(),{once:!0})}})})})}),z.viewport)})]}):null}),VY=e=>{const{__scopeToast:t,children:n,...o}=e,d=BS(J0,t),[f,_]=B.useState(!1),[i,S]=B.useState(!1);return HY(()=>_(!0)),B.useEffect(()=>{const E=window.setTimeout(()=>S(!0),1e3);return()=>window.clearTimeout(E)},[]),i?null:x.jsx(Y0,{asChild:!0,children:x.jsx(bg,{...o,children:f&&x.jsxs(x.Fragment,{children:[d.label," ",n]})})})},UY="ToastTitle",Z4=B.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e;return x.jsx(En.div,{...o,ref:t})});Z4.displayName=UY;var GY="ToastDescription",K4=B.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e;return x.jsx(En.div,{...o,ref:t})});K4.displayName=GY;var X4="ToastAction",Y4=B.forwardRef((e,t)=>{const{altText:n,...o}=e;return n.trim()?x.jsx(Q4,{altText:n,asChild:!0,children:x.jsx(xM,{...o,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${X4}\`. Expected non-empty \`string\`.`),null)});Y4.displayName=X4;var J4="ToastClose",xM=B.forwardRef((e,t)=>{const{__scopeToast:n,...o}=e,d=BY(J4,n);return x.jsx(Q4,{asChild:!0,children:x.jsx(En.button,{type:"button",...o,ref:t,onClick:Pr(e.onClick,d.onClose)})})});xM.displayName=J4;var Q4=B.forwardRef((e,t)=>{const{__scopeToast:n,altText:o,...d}=e;return x.jsx(En.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":o||void 0,...d,ref:t})});function e$(e){const t=[];return Array.from(e.childNodes).forEach(o=>{if(o.nodeType===o.TEXT_NODE&&o.textContent&&t.push(o.textContent),WY(o)){const d=o.ariaHidden||o.hidden||o.style.display==="none",f=o.dataset.radixToastAnnounceExclude==="";if(!d)if(f){const _=o.dataset.radixToastAnnounceAlt;_&&t.push(_)}else t.push(...e$(o))}}),t}function v1(e,t,n,{discrete:o}){const d=n.originalEvent.currentTarget,f=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&d.addEventListener(e,t,{once:!0}),o?yM(d,f):d.dispatchEvent(f)}var JL=(e,t,n=0)=>{const o=Math.abs(e.x),d=Math.abs(e.y),f=o>d;return t==="left"||t==="right"?f&&o>n:!f&&d>n};function HY(e=()=>{}){const t=Aa(e);Ns(()=>{let n=0,o=0;return n=window.requestAnimationFrame(()=>o=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(o)}},[t])}function WY(e){return e.nodeType===e.ELEMENT_NODE}function qY(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const d=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||d?NodeFilter.FILTER_SKIP:o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function vE(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var ZY=U4,t$=H4,r$=q4,n$=Z4,i$=K4,o$=Y4,s$=xM;function a$(e){var t,n,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(t=0;t<d;t++)e[t]&&(n=a$(e[t]))&&(o&&(o+=" "),o+=n)}else for(n in e)e[n]&&(o&&(o+=" "),o+=n);return o}function ni(){for(var e,t,n=0,o="",d=arguments.length;n<d;n++)(e=arguments[n])&&(t=a$(e))&&(o&&(o+=" "),o+=t);return o}const QL=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,eN=ni,Q0=(e,t)=>n=>{var o;if(t?.variants==null)return eN(e,n?.class,n?.className);const{variants:d,defaultVariants:f}=t,_=Object.keys(d).map(E=>{const I=n?.[E],M=f?.[E];if(I===null)return null;const j=QL(I)||QL(M);return d[E][j]}),i=n&&Object.entries(n).reduce((E,I)=>{let[M,j]=I;return j===void 0||(E[M]=j),E},{}),S=t==null||(o=t.compoundVariants)===null||o===void 0?void 0:o.reduce((E,I)=>{let{class:M,className:j,...N}=I;return Object.entries(N).every(G=>{let[z,V]=G;return Array.isArray(V)?V.includes({...f,...i}[z]):{...f,...i}[z]===V})?[...E,M,j]:E},[]);return eN(e,_,S,n?.class,n?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KY=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l$=(...e)=>e.filter((t,n,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var XY={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YY=B.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:d="",children:f,iconNode:_,...i},S)=>B.createElement("svg",{ref:S,...XY,width:t,height:t,stroke:e,strokeWidth:o?Number(n)*24/Number(t):n,className:l$("lucide",d),...i},[..._.map(([E,I])=>B.createElement(E,I)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=(e,t)=>{const n=B.forwardRef(({className:o,...d},f)=>B.createElement(YY,{ref:f,iconNode:t,className:l$(`lucide-${KY(e)}`,o),...d}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LP=qr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=qr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JY=qr("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xE=qr("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bM=qr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0=qr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c$=qr("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QY=qr("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=qr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $S=qr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u$=qr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eJ=qr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wM=qr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d$=qr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x1=qr("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VS=qr("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tJ=qr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h$=qr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rJ=qr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f$=qr("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $c=qr("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nJ=qr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iJ=qr("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tN=qr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=qr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=qr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oJ=qr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sJ=qr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aJ=qr("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lJ=qr("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cJ=qr("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uJ=qr("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fw=qr("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const US=qr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=qr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dJ=qr("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hJ=qr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xf=qr("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fJ=qr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pJ=qr("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mJ=qr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jf=qr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gJ=qr("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=qr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=qr("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kf=qr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vJ=qr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=qr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bJ=qr("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bE=qr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wJ=qr("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=qr("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SJ=qr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pf=qr("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TJ=qr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p$=qr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m$=qr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AJ=qr("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EJ=qr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jf=qr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=qr("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PJ=qr("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CJ=qr("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=qr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),SM="-",IJ=e=>{const t=OJ(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:o}=e;return{getClassGroupId:_=>{const i=_.split(SM);return i[0]===""&&i.length!==1&&i.shift(),g$(i,t)||MJ(_)},getConflictingClassGroupIds:(_,i)=>{const S=n[_]||[];return i&&o[_]?[...S,...o[_]]:S}}},g$=(e,t)=>{if(e.length===0)return t.classGroupId;const n=e[0],o=t.nextPart.get(n),d=o?g$(e.slice(1),o):void 0;if(d)return d;if(t.validators.length===0)return;const f=e.join(SM);return t.validators.find(({validator:_})=>_(f))?.classGroupId},iN=/^\[(.+)\]$/,MJ=e=>{if(iN.test(e)){const t=iN.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},OJ=e=>{const{theme:t,prefix:n}=e,o={nextPart:new Map,validators:[]};return kJ(Object.entries(e.classGroups),n).forEach(([f,_])=>{NP(_,o,f,t)}),o},NP=(e,t,n,o)=>{e.forEach(d=>{if(typeof d=="string"){const f=d===""?t:oN(t,d);f.classGroupId=n;return}if(typeof d=="function"){if(RJ(d)){NP(d(o),t,n,o);return}t.validators.push({validator:d,classGroupId:n});return}Object.entries(d).forEach(([f,_])=>{NP(_,oN(t,f),n,o)})})},oN=(e,t)=>{let n=e;return t.split(SM).forEach(o=>{n.nextPart.has(o)||n.nextPart.set(o,{nextPart:new Map,validators:[]}),n=n.nextPart.get(o)}),n},RJ=e=>e.isThemeGetter,kJ=(e,t)=>t?e.map(([n,o])=>{const d=o.map(f=>typeof f=="string"?t+f:typeof f=="object"?Object.fromEntries(Object.entries(f).map(([_,i])=>[t+_,i])):f);return[n,d]}):e,jJ=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,o=new Map;const d=(f,_)=>{n.set(f,_),t++,t>e&&(t=0,o=n,n=new Map)};return{get(f){let _=n.get(f);if(_!==void 0)return _;if((_=o.get(f))!==void 0)return d(f,_),_},set(f,_){n.has(f)?n.set(f,_):d(f,_)}}},y$="!",DJ=e=>{const{separator:t,experimentalParseClassName:n}=e,o=t.length===1,d=t[0],f=t.length,_=i=>{const S=[];let E=0,I=0,M;for(let V=0;V<i.length;V++){let K=i[V];if(E===0){if(K===d&&(o||i.slice(V,V+f)===t)){S.push(i.slice(I,V)),I=V+f;continue}if(K==="/"){M=V;continue}}K==="["?E++:K==="]"&&E--}const j=S.length===0?i:i.substring(I),N=j.startsWith(y$),G=N?j.substring(1):j,z=M&&M>I?M-I:void 0;return{modifiers:S,hasImportantModifier:N,baseClassName:G,maybePostfixModifierPosition:z}};return n?i=>n({className:i,parseClassName:_}):_},LJ=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(o=>{o[0]==="["?(t.push(...n.sort(),o),n=[]):n.push(o)}),t.push(...n.sort()),t},NJ=e=>({cache:jJ(e.cacheSize),parseClassName:DJ(e),...IJ(e)}),zJ=/\s+/,FJ=(e,t)=>{const{parseClassName:n,getClassGroupId:o,getConflictingClassGroupIds:d}=t,f=[],_=e.trim().split(zJ);let i="";for(let S=_.length-1;S>=0;S-=1){const E=_[S],{modifiers:I,hasImportantModifier:M,baseClassName:j,maybePostfixModifierPosition:N}=n(E);let G=!!N,z=o(G?j.substring(0,N):j);if(!z){if(!G){i=E+(i.length>0?" "+i:i);continue}if(z=o(j),!z){i=E+(i.length>0?" "+i:i);continue}G=!1}const V=LJ(I).join(":"),K=M?V+y$:V,Q=K+z;if(f.includes(Q))continue;f.push(Q);const X=d(z,G);for(let ie=0;ie<X.length;++ie){const J=X[ie];f.push(K+J)}i=E+(i.length>0?" "+i:i)}return i};function BJ(){let e=0,t,n,o="";for(;e<arguments.length;)(t=arguments[e++])&&(n=_$(t))&&(o&&(o+=" "),o+=n);return o}const _$=e=>{if(typeof e=="string")return e;let t,n="";for(let o=0;o<e.length;o++)e[o]&&(t=_$(e[o]))&&(n&&(n+=" "),n+=t);return n};function $J(e,...t){let n,o,d,f=_;function _(S){const E=t.reduce((I,M)=>M(I),e());return n=NJ(E),o=n.cache.get,d=n.cache.set,f=i,i(S)}function i(S){const E=o(S);if(E)return E;const I=FJ(S,n);return d(S,I),I}return function(){return f(BJ.apply(null,arguments))}}const po=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},v$=/^\[(?:([a-z-]+):)?(.+)\]$/i,VJ=/^\d+\/\d+$/,UJ=new Set(["px","full","screen"]),GJ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HJ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WJ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,qJ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,ZJ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ku=e=>hg(e)||UJ.has(e)||VJ.test(e),zd=e=>ry(e,"length",rQ),hg=e=>!!e&&!Number.isNaN(Number(e)),wE=e=>ry(e,"number",hg),wv=e=>!!e&&Number.isInteger(Number(e)),KJ=e=>e.endsWith("%")&&hg(e.slice(0,-1)),li=e=>v$.test(e),Fd=e=>GJ.test(e),XJ=new Set(["length","size","percentage"]),YJ=e=>ry(e,XJ,x$),JJ=e=>ry(e,"position",x$),QJ=new Set(["image","url"]),eQ=e=>ry(e,QJ,iQ),tQ=e=>ry(e,"",nQ),Sv=()=>!0,ry=(e,t,n)=>{const o=v$.exec(e);return o?o[1]?typeof t=="string"?o[1]===t:t.has(o[1]):n(o[2]):!1},rQ=e=>HJ.test(e)&&!WJ.test(e),x$=()=>!1,nQ=e=>qJ.test(e),iQ=e=>ZJ.test(e),oQ=()=>{const e=po("colors"),t=po("spacing"),n=po("blur"),o=po("brightness"),d=po("borderColor"),f=po("borderRadius"),_=po("borderSpacing"),i=po("borderWidth"),S=po("contrast"),E=po("grayscale"),I=po("hueRotate"),M=po("invert"),j=po("gap"),N=po("gradientColorStops"),G=po("gradientColorStopPositions"),z=po("inset"),V=po("margin"),K=po("opacity"),Q=po("padding"),X=po("saturate"),ie=po("scale"),J=po("sepia"),se=po("skew"),he=po("space"),we=po("translate"),ze=()=>["auto","contain","none"],je=()=>["auto","hidden","clip","visible","scroll"],Oe=()=>["auto",li,t],Be=()=>[li,t],qe=()=>["",ku,zd],Xe=()=>["auto",hg,li],it=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ge=()=>["solid","dashed","dotted","double","none"],Ke=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ut=()=>["start","end","center","between","around","evenly","stretch"],rt=()=>["","0",li],Xt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],cr=()=>[hg,li];return{cacheSize:500,separator:":",theme:{colors:[Sv],spacing:[ku,zd],blur:["none","",Fd,li],brightness:cr(),borderColor:[e],borderRadius:["none","","full",Fd,li],borderSpacing:Be(),borderWidth:qe(),contrast:cr(),grayscale:rt(),hueRotate:cr(),invert:rt(),gap:Be(),gradientColorStops:[e],gradientColorStopPositions:[KJ,zd],inset:Oe(),margin:Oe(),opacity:cr(),padding:Be(),saturate:cr(),scale:cr(),sepia:rt(),skew:cr(),space:Be(),translate:Be()},classGroups:{aspect:[{aspect:["auto","square","video",li]}],container:["container"],columns:[{columns:[Fd]}],"break-after":[{"break-after":Xt()}],"break-before":[{"break-before":Xt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...it(),li]}],overflow:[{overflow:je()}],"overflow-x":[{"overflow-x":je()}],"overflow-y":[{"overflow-y":je()}],overscroll:[{overscroll:ze()}],"overscroll-x":[{"overscroll-x":ze()}],"overscroll-y":[{"overscroll-y":ze()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[z]}],"inset-x":[{"inset-x":[z]}],"inset-y":[{"inset-y":[z]}],start:[{start:[z]}],end:[{end:[z]}],top:[{top:[z]}],right:[{right:[z]}],bottom:[{bottom:[z]}],left:[{left:[z]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",wv,li]}],basis:[{basis:Oe()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",li]}],grow:[{grow:rt()}],shrink:[{shrink:rt()}],order:[{order:["first","last","none",wv,li]}],"grid-cols":[{"grid-cols":[Sv]}],"col-start-end":[{col:["auto",{span:["full",wv,li]},li]}],"col-start":[{"col-start":Xe()}],"col-end":[{"col-end":Xe()}],"grid-rows":[{"grid-rows":[Sv]}],"row-start-end":[{row:["auto",{span:[wv,li]},li]}],"row-start":[{"row-start":Xe()}],"row-end":[{"row-end":Xe()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",li]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",li]}],gap:[{gap:[j]}],"gap-x":[{"gap-x":[j]}],"gap-y":[{"gap-y":[j]}],"justify-content":[{justify:["normal",...ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Q]}],px:[{px:[Q]}],py:[{py:[Q]}],ps:[{ps:[Q]}],pe:[{pe:[Q]}],pt:[{pt:[Q]}],pr:[{pr:[Q]}],pb:[{pb:[Q]}],pl:[{pl:[Q]}],m:[{m:[V]}],mx:[{mx:[V]}],my:[{my:[V]}],ms:[{ms:[V]}],me:[{me:[V]}],mt:[{mt:[V]}],mr:[{mr:[V]}],mb:[{mb:[V]}],ml:[{ml:[V]}],"space-x":[{"space-x":[he]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[he]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",li,t]}],"min-w":[{"min-w":[li,t,"min","max","fit"]}],"max-w":[{"max-w":[li,t,"none","full","min","max","fit","prose",{screen:[Fd]},Fd]}],h:[{h:[li,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[li,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[li,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[li,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Fd,zd]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",wE]}],"font-family":[{font:[Sv]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",li]}],"line-clamp":[{"line-clamp":["none",hg,wE]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ku,li]}],"list-image":[{"list-image":["none",li]}],"list-style-type":[{list:["none","disc","decimal",li]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[K]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[K]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ge(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ku,zd]}],"underline-offset":[{"underline-offset":["auto",ku,li]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Be()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",li]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",li]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[K]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...it(),JJ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",YJ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},eQ]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[N]}],"gradient-via":[{via:[N]}],"gradient-to":[{to:[N]}],rounded:[{rounded:[f]}],"rounded-s":[{"rounded-s":[f]}],"rounded-e":[{"rounded-e":[f]}],"rounded-t":[{"rounded-t":[f]}],"rounded-r":[{"rounded-r":[f]}],"rounded-b":[{"rounded-b":[f]}],"rounded-l":[{"rounded-l":[f]}],"rounded-ss":[{"rounded-ss":[f]}],"rounded-se":[{"rounded-se":[f]}],"rounded-ee":[{"rounded-ee":[f]}],"rounded-es":[{"rounded-es":[f]}],"rounded-tl":[{"rounded-tl":[f]}],"rounded-tr":[{"rounded-tr":[f]}],"rounded-br":[{"rounded-br":[f]}],"rounded-bl":[{"rounded-bl":[f]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[K]}],"border-style":[{border:[...Ge(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[K]}],"divide-style":[{divide:Ge()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...Ge()]}],"outline-offset":[{"outline-offset":[ku,li]}],"outline-w":[{outline:[ku,zd]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:qe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[K]}],"ring-offset-w":[{"ring-offset":[ku,zd]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Fd,tQ]}],"shadow-color":[{shadow:[Sv]}],opacity:[{opacity:[K]}],"mix-blend":[{"mix-blend":[...Ke(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Ke()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[o]}],contrast:[{contrast:[S]}],"drop-shadow":[{"drop-shadow":["","none",Fd,li]}],grayscale:[{grayscale:[E]}],"hue-rotate":[{"hue-rotate":[I]}],invert:[{invert:[M]}],saturate:[{saturate:[X]}],sepia:[{sepia:[J]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[o]}],"backdrop-contrast":[{"backdrop-contrast":[S]}],"backdrop-grayscale":[{"backdrop-grayscale":[E]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[I]}],"backdrop-invert":[{"backdrop-invert":[M]}],"backdrop-opacity":[{"backdrop-opacity":[K]}],"backdrop-saturate":[{"backdrop-saturate":[X]}],"backdrop-sepia":[{"backdrop-sepia":[J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[_]}],"border-spacing-x":[{"border-spacing-x":[_]}],"border-spacing-y":[{"border-spacing-y":[_]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",li]}],duration:[{duration:cr()}],ease:[{ease:["linear","in","out","in-out",li]}],delay:[{delay:cr()}],animate:[{animate:["none","spin","ping","pulse","bounce",li]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ie]}],"scale-x":[{"scale-x":[ie]}],"scale-y":[{"scale-y":[ie]}],rotate:[{rotate:[wv,li]}],"translate-x":[{"translate-x":[we]}],"translate-y":[{"translate-y":[we]}],"skew-x":[{"skew-x":[se]}],"skew-y":[{"skew-y":[se]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",li]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",li]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Be()}],"scroll-mx":[{"scroll-mx":Be()}],"scroll-my":[{"scroll-my":Be()}],"scroll-ms":[{"scroll-ms":Be()}],"scroll-me":[{"scroll-me":Be()}],"scroll-mt":[{"scroll-mt":Be()}],"scroll-mr":[{"scroll-mr":Be()}],"scroll-mb":[{"scroll-mb":Be()}],"scroll-ml":[{"scroll-ml":Be()}],"scroll-p":[{"scroll-p":Be()}],"scroll-px":[{"scroll-px":Be()}],"scroll-py":[{"scroll-py":Be()}],"scroll-ps":[{"scroll-ps":Be()}],"scroll-pe":[{"scroll-pe":Be()}],"scroll-pt":[{"scroll-pt":Be()}],"scroll-pr":[{"scroll-pr":Be()}],"scroll-pb":[{"scroll-pb":Be()}],"scroll-pl":[{"scroll-pl":Be()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",li]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[ku,zd,wE]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},sQ=$J(oQ);function kr(...e){return sQ(ni(e))}async function aQ(e,t={},n=1e4){const o=new AbortController,d=setTimeout(()=>o.abort(),n);try{return await fetch(e,{...t,signal:o.signal})}finally{clearTimeout(d)}}function lQ(e,t){try{if(typeof window>"u"||typeof window.sessionStorage>"u")return;sessionStorage.setItem(e,JSON.stringify(t))}catch(n){console.warn("safeSessionSet failed",n)}}function zP(e){try{if(typeof window>"u"||typeof window.sessionStorage>"u")return null;const t=sessionStorage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}catch(t){return console.warn("safeSessionGet failed",t),null}}async function pw(e,t=3,n=300){let o;for(let d=0;d<t;d++)try{return await e()}catch(f){o=f;const _=n*Math.pow(2,d);await new Promise(i=>setTimeout(i,_))}throw o}const cQ=ZY,b$=B.forwardRef(({className:e,...t},n)=>x.jsx(t$,{ref:n,className:kr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));b$.displayName=t$.displayName;const uQ=Q0("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),w$=B.forwardRef(({className:e,variant:t,...n},o)=>x.jsx(r$,{ref:o,className:kr(uQ({variant:t}),e),...n}));w$.displayName=r$.displayName;const dQ=B.forwardRef(({className:e,...t},n)=>x.jsx(o$,{ref:n,className:kr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));dQ.displayName=o$.displayName;const S$=B.forwardRef(({className:e,...t},n)=>x.jsx(s$,{ref:n,className:kr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:x.jsx(Tl,{className:"h-4 w-4"})}));S$.displayName=s$.displayName;const T$=B.forwardRef(({className:e,...t},n)=>x.jsx(n$,{ref:n,className:kr("text-sm font-semibold",e),...t}));T$.displayName=n$.displayName;const A$=B.forwardRef(({className:e,...t},n)=>x.jsx(i$,{ref:n,className:kr("text-sm opacity-90",e),...t}));A$.displayName=i$.displayName;function hQ(){const{toasts:e}=D4();return x.jsxs(cQ,{children:[e.map(function({id:t,title:n,description:o,action:d,...f}){return x.jsxs(w$,{...f,children:[x.jsxs("div",{className:"grid gap-1",children:[n&&x.jsx(T$,{children:n}),o&&x.jsx(A$,{children:o})]}),d,x.jsx(S$,{})]},t)}),x.jsx(b$,{})]})}var sN=["light","dark"],fQ="(prefers-color-scheme: dark)",pQ=B.createContext(void 0),mQ={setTheme:e=>{},themes:[]},gQ=()=>{var e;return(e=B.useContext(pQ))!=null?e:mQ};B.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:o,enableColorScheme:d,defaultTheme:f,value:_,attrs:i,nonce:S})=>{let E=f==="system",I=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(G=>`'${G}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,M=d?sN.includes(f)&&f?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${f}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",j=(G,z=!1,V=!0)=>{let K=_?_[G]:G,Q=z?G+"|| ''":`'${K}'`,X="";return d&&V&&!z&&sN.includes(G)&&(X+=`d.style.colorScheme = '${G}';`),n==="class"?z||K?X+=`c.add(${Q})`:X+="null":K&&(X+=`d[s](n,${Q})`),X},N=e?`!function(){${I}${j(e)}}()`:o?`!function(){try{${I}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${E})){var t='${fQ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${j("dark")}}else{${j("light")}}}else if(e){${_?`var x=${JSON.stringify(_)};`:""}${j(_?"x[e]":"e",!0)}}${E?"":"else{"+j(f,!1,!1)+"}"}${M}}catch(e){}}()`:`!function(){try{${I}var e=localStorage.getItem('${t}');if(e){${_?`var x=${JSON.stringify(_)};`:""}${j(_?"x[e]":"e",!0)}}else{${j(f,!1,!1)};}${M}}catch(t){}}();`;return B.createElement("script",{nonce:S,dangerouslySetInnerHTML:{__html:N}})});var yQ=e=>{switch(e){case"success":return xQ;case"info":return wQ;case"warning":return bQ;case"error":return SQ;default:return null}},_Q=Array(12).fill(0),vQ=({visible:e,className:t})=>Le.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Le.createElement("div",{className:"sonner-spinner"},_Q.map((n,o)=>Le.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${o}`})))),xQ=Le.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Le.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),bQ=Le.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Le.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),wQ=Le.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Le.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),SQ=Le.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Le.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),TQ=Le.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Le.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Le.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),AQ=()=>{let[e,t]=Le.useState(document.hidden);return Le.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},FP=1,EQ=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:n,...o}=e,d=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:FP++,f=this.toasts.find(i=>i.id===d),_=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(d)&&this.dismissedToasts.delete(d),f?this.toasts=this.toasts.map(i=>i.id===d?(this.publish({...i,...e,id:d,title:n}),{...i,...e,id:d,dismissible:_,title:n}):i):this.addToast({title:n,...o,dismissible:_,id:d}),d},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let o=e instanceof Promise?e:e(),d=n!==void 0,f,_=o.then(async S=>{if(f=["resolve",S],Le.isValidElement(S))d=!1,this.create({id:n,type:"default",message:S});else if(CQ(S)&&!S.ok){d=!1;let E=typeof t.error=="function"?await t.error(`HTTP error! status: ${S.status}`):t.error,I=typeof t.description=="function"?await t.description(`HTTP error! status: ${S.status}`):t.description;this.create({id:n,type:"error",message:E,description:I})}else if(t.success!==void 0){d=!1;let E=typeof t.success=="function"?await t.success(S):t.success,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:n,type:"success",message:E,description:I})}}).catch(async S=>{if(f=["reject",S],t.error!==void 0){d=!1;let E=typeof t.error=="function"?await t.error(S):t.error,I=typeof t.description=="function"?await t.description(S):t.description;this.create({id:n,type:"error",message:E,description:I})}}).finally(()=>{var S;d&&(this.dismiss(n),n=void 0),(S=t.finally)==null||S.call(t)}),i=()=>new Promise((S,E)=>_.then(()=>f[0]==="reject"?E(f[1]):S(f[1])).catch(E));return typeof n!="string"&&typeof n!="number"?{unwrap:i}:Object.assign(n,{unwrap:i})},this.custom=(e,t)=>{let n=t?.id||FP++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},va=new EQ,PQ=(e,t)=>{let n=t?.id||FP++;return va.addToast({title:e,...t,id:n}),n},CQ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",IQ=PQ,MQ=()=>va.toasts,OQ=()=>va.getActiveToasts(),ds=Object.assign(IQ,{success:va.success,info:va.info,warning:va.warning,error:va.error,custom:va.custom,message:va.message,promise:va.promise,dismiss:va.dismiss,loading:va.loading},{getHistory:MQ,getToasts:OQ});function RQ(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",t==="top"&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}RQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function b1(e){return e.label!==void 0}var kQ=3,jQ="32px",DQ="16px",aN=4e3,LQ=356,NQ=14,zQ=20,FQ=200;function Jl(...e){return e.filter(Boolean).join(" ")}function BQ(e){let[t,n]=e.split("-"),o=[];return t&&o.push(t),n&&o.push(n),o}var $Q=e=>{var t,n,o,d,f,_,i,S,E,I,M;let{invert:j,toast:N,unstyled:G,interacting:z,setHeights:V,visibleToasts:K,heights:Q,index:X,toasts:ie,expanded:J,removeToast:se,defaultRichColors:he,closeButton:we,style:ze,cancelButtonStyle:je,actionButtonStyle:Oe,className:Be="",descriptionClassName:qe="",duration:Xe,position:it,gap:Ge,loadingIcon:Ke,expandByDefault:ut,classNames:rt,icons:Xt,closeButtonAriaLabel:cr="Close toast",pauseWhenPageIsHidden:Bt}=e,[$t,br]=Le.useState(null),[nn,qn]=Le.useState(null),[lr,an]=Le.useState(!1),[Lt,nr]=Le.useState(!1),[pr,Nt]=Le.useState(!1),[zr,un]=Le.useState(!1),[hi,Hn]=Le.useState(!1),[zn,Qn]=Le.useState(0),[zs,gs]=Le.useState(0),co=Le.useRef(N.duration||Xe||aN),Co=Le.useRef(null),wo=Le.useRef(null),Hi=X===0,is=X+1<=K,Io=N.type,jo=N.dismissible!==!1,qs=N.className||"",Do=N.descriptionClassName||"",Fs=Le.useMemo(()=>Q.findIndex(on=>on.toastId===N.id)||0,[Q,N.id]),Pa=Le.useMemo(()=>{var on;return(on=N.closeButton)!=null?on:we},[N.closeButton,we]),Zt=Le.useMemo(()=>N.duration||Xe||aN,[N.duration,Xe]),qt=Le.useRef(0),fr=Le.useRef(0),Ir=Le.useRef(0),On=Le.useRef(null),[Ii,eo]=it.split("-"),$o=Le.useMemo(()=>Q.reduce((on,Zn,ei)=>ei>=Fs?on:on+Zn.height,0),[Q,Fs]),Lo=AQ(),Ca=N.invert||j,Mi=Io==="loading";fr.current=Le.useMemo(()=>Fs*Ge+$o,[Fs,$o]),Le.useEffect(()=>{co.current=Zt},[Zt]),Le.useEffect(()=>{an(!0)},[]),Le.useEffect(()=>{let on=wo.current;if(on){let Zn=on.getBoundingClientRect().height;return gs(Zn),V(ei=>[{toastId:N.id,height:Zn,position:N.position},...ei]),()=>V(ei=>ei.filter(Vo=>Vo.toastId!==N.id))}},[V,N.id]),Le.useLayoutEffect(()=>{if(!lr)return;let on=wo.current,Zn=on.style.height;on.style.height="auto";let ei=on.getBoundingClientRect().height;on.style.height=Zn,gs(ei),V(Vo=>Vo.find(mt=>mt.toastId===N.id)?Vo.map(mt=>mt.toastId===N.id?{...mt,height:ei}:mt):[{toastId:N.id,height:ei,position:N.position},...Vo])},[lr,N.title,N.description,V,N.id]);let ln=Le.useCallback(()=>{nr(!0),Qn(fr.current),V(on=>on.filter(Zn=>Zn.toastId!==N.id)),setTimeout(()=>{se(N)},FQ)},[N,se,V,fr]);Le.useEffect(()=>{if(N.promise&&Io==="loading"||N.duration===1/0||N.type==="loading")return;let on;return J||z||Bt&&Lo?(()=>{if(Ir.current<qt.current){let Zn=new Date().getTime()-qt.current;co.current=co.current-Zn}Ir.current=new Date().getTime()})():co.current!==1/0&&(qt.current=new Date().getTime(),on=setTimeout(()=>{var Zn;(Zn=N.onAutoClose)==null||Zn.call(N,N),ln()},co.current)),()=>clearTimeout(on)},[J,z,N,Io,Bt,Lo,ln]),Le.useEffect(()=>{N.delete&&ln()},[ln,N.delete]);function ui(){var on,Zn,ei;return Xt!=null&&Xt.loading?Le.createElement("div",{className:Jl(rt?.loader,(on=N?.classNames)==null?void 0:on.loader,"sonner-loader"),"data-visible":Io==="loading"},Xt.loading):Ke?Le.createElement("div",{className:Jl(rt?.loader,(Zn=N?.classNames)==null?void 0:Zn.loader,"sonner-loader"),"data-visible":Io==="loading"},Ke):Le.createElement(vQ,{className:Jl(rt?.loader,(ei=N?.classNames)==null?void 0:ei.loader),visible:Io==="loading"})}return Le.createElement("li",{tabIndex:0,ref:wo,className:Jl(Be,qs,rt?.toast,(t=N?.classNames)==null?void 0:t.toast,rt?.default,rt?.[Io],(n=N?.classNames)==null?void 0:n[Io]),"data-sonner-toast":"","data-rich-colors":(o=N.richColors)!=null?o:he,"data-styled":!(N.jsx||N.unstyled||G),"data-mounted":lr,"data-promise":!!N.promise,"data-swiped":hi,"data-removed":Lt,"data-visible":is,"data-y-position":Ii,"data-x-position":eo,"data-index":X,"data-front":Hi,"data-swiping":pr,"data-dismissible":jo,"data-type":Io,"data-invert":Ca,"data-swipe-out":zr,"data-swipe-direction":nn,"data-expanded":!!(J||ut&&lr),style:{"--index":X,"--toasts-before":X,"--z-index":ie.length-X,"--offset":`${Lt?zn:fr.current}px`,"--initial-height":ut?"auto":`${zs}px`,...ze,...N.style},onDragEnd:()=>{Nt(!1),br(null),On.current=null},onPointerDown:on=>{Mi||!jo||(Co.current=new Date,Qn(fr.current),on.target.setPointerCapture(on.pointerId),on.target.tagName!=="BUTTON"&&(Nt(!0),On.current={x:on.clientX,y:on.clientY}))},onPointerUp:()=>{var on,Zn,ei,Vo;if(zr||!jo)return;On.current=null;let mt=Number(((on=wo.current)==null?void 0:on.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),qo=Number(((Zn=wo.current)==null?void 0:Zn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ia=new Date().getTime()-((ei=Co.current)==null?void 0:ei.getTime()),Uo=$t==="x"?mt:qo,Zr=Math.abs(Uo)/Ia;if(Math.abs(Uo)>=zQ||Zr>.11){Qn(fr.current),(Vo=N.onDismiss)==null||Vo.call(N,N),qn($t==="x"?mt>0?"right":"left":qo>0?"down":"up"),ln(),un(!0),Hn(!1);return}Nt(!1),br(null)},onPointerMove:on=>{var Zn,ei,Vo,mt;if(!On.current||!jo||((Zn=window.getSelection())==null?void 0:Zn.toString().length)>0)return;let qo=on.clientY-On.current.y,Ia=on.clientX-On.current.x,Uo=(ei=e.swipeDirections)!=null?ei:BQ(it);!$t&&(Math.abs(Ia)>1||Math.abs(qo)>1)&&br(Math.abs(Ia)>Math.abs(qo)?"x":"y");let Zr={x:0,y:0};$t==="y"?(Uo.includes("top")||Uo.includes("bottom"))&&(Uo.includes("top")&&qo<0||Uo.includes("bottom")&&qo>0)&&(Zr.y=qo):$t==="x"&&(Uo.includes("left")||Uo.includes("right"))&&(Uo.includes("left")&&Ia<0||Uo.includes("right")&&Ia>0)&&(Zr.x=Ia),(Math.abs(Zr.x)>0||Math.abs(Zr.y)>0)&&Hn(!0),(Vo=wo.current)==null||Vo.style.setProperty("--swipe-amount-x",`${Zr.x}px`),(mt=wo.current)==null||mt.style.setProperty("--swipe-amount-y",`${Zr.y}px`)}},Pa&&!N.jsx?Le.createElement("button",{"aria-label":cr,"data-disabled":Mi,"data-close-button":!0,onClick:Mi||!jo?()=>{}:()=>{var on;ln(),(on=N.onDismiss)==null||on.call(N,N)},className:Jl(rt?.closeButton,(d=N?.classNames)==null?void 0:d.closeButton)},(f=Xt?.close)!=null?f:TQ):null,N.jsx||B.isValidElement(N.title)?N.jsx?N.jsx:typeof N.title=="function"?N.title():N.title:Le.createElement(Le.Fragment,null,Io||N.icon||N.promise?Le.createElement("div",{"data-icon":"",className:Jl(rt?.icon,(_=N?.classNames)==null?void 0:_.icon)},N.promise||N.type==="loading"&&!N.icon?N.icon||ui():null,N.type!=="loading"?N.icon||Xt?.[Io]||yQ(Io):null):null,Le.createElement("div",{"data-content":"",className:Jl(rt?.content,(i=N?.classNames)==null?void 0:i.content)},Le.createElement("div",{"data-title":"",className:Jl(rt?.title,(S=N?.classNames)==null?void 0:S.title)},typeof N.title=="function"?N.title():N.title),N.description?Le.createElement("div",{"data-description":"",className:Jl(qe,Do,rt?.description,(E=N?.classNames)==null?void 0:E.description)},typeof N.description=="function"?N.description():N.description):null),B.isValidElement(N.cancel)?N.cancel:N.cancel&&b1(N.cancel)?Le.createElement("button",{"data-button":!0,"data-cancel":!0,style:N.cancelButtonStyle||je,onClick:on=>{var Zn,ei;b1(N.cancel)&&jo&&((ei=(Zn=N.cancel).onClick)==null||ei.call(Zn,on),ln())},className:Jl(rt?.cancelButton,(I=N?.classNames)==null?void 0:I.cancelButton)},N.cancel.label):null,B.isValidElement(N.action)?N.action:N.action&&b1(N.action)?Le.createElement("button",{"data-button":!0,"data-action":!0,style:N.actionButtonStyle||Oe,onClick:on=>{var Zn,ei;b1(N.action)&&((ei=(Zn=N.action).onClick)==null||ei.call(Zn,on),!on.defaultPrevented&&ln())},className:Jl(rt?.actionButton,(M=N?.classNames)==null?void 0:M.actionButton)},N.action.label):null))};function lN(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function VQ(e,t){let n={};return[e,t].forEach((o,d)=>{let f=d===1,_=f?"--mobile-offset":"--offset",i=f?DQ:jQ;function S(E){["top","right","bottom","left"].forEach(I=>{n[`${_}-${I}`]=typeof E=="number"?`${E}px`:E})}typeof o=="number"||typeof o=="string"?S(o):typeof o=="object"?["top","right","bottom","left"].forEach(E=>{o[E]===void 0?n[`${_}-${E}`]=i:n[`${_}-${E}`]=typeof o[E]=="number"?`${o[E]}px`:o[E]}):S(i)}),n}var UQ=B.forwardRef(function(e,t){let{invert:n,position:o="bottom-right",hotkey:d=["altKey","KeyT"],expand:f,closeButton:_,className:i,offset:S,mobileOffset:E,theme:I="light",richColors:M,duration:j,style:N,visibleToasts:G=kQ,toastOptions:z,dir:V=lN(),gap:K=NQ,loadingIcon:Q,icons:X,containerAriaLabel:ie="Notifications",pauseWhenPageIsHidden:J}=e,[se,he]=Le.useState([]),we=Le.useMemo(()=>Array.from(new Set([o].concat(se.filter(Bt=>Bt.position).map(Bt=>Bt.position)))),[se,o]),[ze,je]=Le.useState([]),[Oe,Be]=Le.useState(!1),[qe,Xe]=Le.useState(!1),[it,Ge]=Le.useState(I!=="system"?I:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Ke=Le.useRef(null),ut=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),rt=Le.useRef(null),Xt=Le.useRef(!1),cr=Le.useCallback(Bt=>{he($t=>{var br;return(br=$t.find(nn=>nn.id===Bt.id))!=null&&br.delete||va.dismiss(Bt.id),$t.filter(({id:nn})=>nn!==Bt.id)})},[]);return Le.useEffect(()=>va.subscribe(Bt=>{if(Bt.dismiss){he($t=>$t.map(br=>br.id===Bt.id?{...br,delete:!0}:br));return}setTimeout(()=>{M4.flushSync(()=>{he($t=>{let br=$t.findIndex(nn=>nn.id===Bt.id);return br!==-1?[...$t.slice(0,br),{...$t[br],...Bt},...$t.slice(br+1)]:[Bt,...$t]})})})}),[]),Le.useEffect(()=>{if(I!=="system"){Ge(I);return}if(I==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Ge("dark"):Ge("light")),typeof window>"u")return;let Bt=window.matchMedia("(prefers-color-scheme: dark)");try{Bt.addEventListener("change",({matches:$t})=>{Ge($t?"dark":"light")})}catch{Bt.addListener(({matches:br})=>{try{Ge(br?"dark":"light")}catch(nn){console.error(nn)}})}},[I]),Le.useEffect(()=>{se.length<=1&&Be(!1)},[se]),Le.useEffect(()=>{let Bt=$t=>{var br,nn;d.every(qn=>$t[qn]||$t.code===qn)&&(Be(!0),(br=Ke.current)==null||br.focus()),$t.code==="Escape"&&(document.activeElement===Ke.current||(nn=Ke.current)!=null&&nn.contains(document.activeElement))&&Be(!1)};return document.addEventListener("keydown",Bt),()=>document.removeEventListener("keydown",Bt)},[d]),Le.useEffect(()=>{if(Ke.current)return()=>{rt.current&&(rt.current.focus({preventScroll:!0}),rt.current=null,Xt.current=!1)}},[Ke.current]),Le.createElement("section",{ref:t,"aria-label":`${ie} ${ut}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},we.map((Bt,$t)=>{var br;let[nn,qn]=Bt.split("-");return se.length?Le.createElement("ol",{key:Bt,dir:V==="auto"?lN():V,tabIndex:-1,ref:Ke,className:i,"data-sonner-toaster":!0,"data-theme":it,"data-y-position":nn,"data-lifted":Oe&&se.length>1&&!f,"data-x-position":qn,style:{"--front-toast-height":`${((br=ze[0])==null?void 0:br.height)||0}px`,"--width":`${LQ}px`,"--gap":`${K}px`,...N,...VQ(S,E)},onBlur:lr=>{Xt.current&&!lr.currentTarget.contains(lr.relatedTarget)&&(Xt.current=!1,rt.current&&(rt.current.focus({preventScroll:!0}),rt.current=null))},onFocus:lr=>{lr.target instanceof HTMLElement&&lr.target.dataset.dismissible==="false"||Xt.current||(Xt.current=!0,rt.current=lr.relatedTarget)},onMouseEnter:()=>Be(!0),onMouseMove:()=>Be(!0),onMouseLeave:()=>{qe||Be(!1)},onDragEnd:()=>Be(!1),onPointerDown:lr=>{lr.target instanceof HTMLElement&&lr.target.dataset.dismissible==="false"||Xe(!0)},onPointerUp:()=>Xe(!1)},se.filter(lr=>!lr.position&&$t===0||lr.position===Bt).map((lr,an)=>{var Lt,nr;return Le.createElement($Q,{key:lr.id,icons:X,index:an,toast:lr,defaultRichColors:M,duration:(Lt=z?.duration)!=null?Lt:j,className:z?.className,descriptionClassName:z?.descriptionClassName,invert:n,visibleToasts:G,closeButton:(nr=z?.closeButton)!=null?nr:_,interacting:qe,position:Bt,style:z?.style,unstyled:z?.unstyled,classNames:z?.classNames,cancelButtonStyle:z?.cancelButtonStyle,actionButtonStyle:z?.actionButtonStyle,removeToast:cr,toasts:se.filter(pr=>pr.position==lr.position),heights:ze.filter(pr=>pr.position==lr.position),setHeights:je,expandByDefault:f,gap:K,loadingIcon:Q,expanded:Oe,pauseWhenPageIsHidden:J,swipeDirections:e.swipeDirections})})):null}))});const GQ=({...e})=>{const{theme:t="system"}=gQ();return x.jsx(UQ,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var HQ=gM[" useId ".trim().toString()]||(()=>{}),WQ=0;function $u(e){const[t,n]=B.useState(HQ());return Ns(()=>{n(o=>o??String(WQ++))},[e]),t?`radix-${t}`:""}const qQ=["top","right","bottom","left"],eh=Math.min,Ha=Math.max,mw=Math.round,w1=Math.floor,Wc=e=>({x:e,y:e}),ZQ={left:"right",right:"left",bottom:"top",top:"bottom"},KQ={start:"end",end:"start"};function BP(e,t,n){return Ha(e,eh(t,n))}function Hu(e,t){return typeof e=="function"?e(t):e}function Wu(e){return e.split("-")[0]}function ny(e){return e.split("-")[1]}function TM(e){return e==="x"?"y":"x"}function AM(e){return e==="y"?"height":"width"}const XQ=new Set(["top","bottom"]);function Vc(e){return XQ.has(Wu(e))?"y":"x"}function EM(e){return TM(Vc(e))}function YQ(e,t,n){n===void 0&&(n=!1);const o=ny(e),d=EM(e),f=AM(d);let _=d==="x"?o===(n?"end":"start")?"right":"left":o==="start"?"bottom":"top";return t.reference[f]>t.floating[f]&&(_=gw(_)),[_,gw(_)]}function JQ(e){const t=gw(e);return[$P(e),t,$P(t)]}function $P(e){return e.replace(/start|end/g,t=>KQ[t])}const cN=["left","right"],uN=["right","left"],QQ=["top","bottom"],eee=["bottom","top"];function tee(e,t,n){switch(e){case"top":case"bottom":return n?t?uN:cN:t?cN:uN;case"left":case"right":return t?QQ:eee;default:return[]}}function ree(e,t,n,o){const d=ny(e);let f=tee(Wu(e),n==="start",o);return d&&(f=f.map(_=>_+"-"+d),t&&(f=f.concat(f.map($P)))),f}function gw(e){return e.replace(/left|right|bottom|top/g,t=>ZQ[t])}function nee(e){return{top:0,right:0,bottom:0,left:0,...e}}function E$(e){return typeof e!="number"?nee(e):{top:e,right:e,bottom:e,left:e}}function yw(e){const{x:t,y:n,width:o,height:d}=e;return{width:o,height:d,top:n,left:t,right:t+o,bottom:n+d,x:t,y:n}}function dN(e,t,n){let{reference:o,floating:d}=e;const f=Vc(t),_=EM(t),i=AM(_),S=Wu(t),E=f==="y",I=o.x+o.width/2-d.width/2,M=o.y+o.height/2-d.height/2,j=o[i]/2-d[i]/2;let N;switch(S){case"top":N={x:I,y:o.y-d.height};break;case"bottom":N={x:I,y:o.y+o.height};break;case"right":N={x:o.x+o.width,y:M};break;case"left":N={x:o.x-d.width,y:M};break;default:N={x:o.x,y:o.y}}switch(ny(t)){case"start":N[_]-=j*(n&&E?-1:1);break;case"end":N[_]+=j*(n&&E?-1:1);break}return N}const iee=async(e,t,n)=>{const{placement:o="bottom",strategy:d="absolute",middleware:f=[],platform:_}=n,i=f.filter(Boolean),S=await(_.isRTL==null?void 0:_.isRTL(t));let E=await _.getElementRects({reference:e,floating:t,strategy:d}),{x:I,y:M}=dN(E,o,S),j=o,N={},G=0;for(let z=0;z<i.length;z++){const{name:V,fn:K}=i[z],{x:Q,y:X,data:ie,reset:J}=await K({x:I,y:M,initialPlacement:o,placement:j,strategy:d,middlewareData:N,rects:E,platform:_,elements:{reference:e,floating:t}});I=Q??I,M=X??M,N={...N,[V]:{...N[V],...ie}},J&&G<=50&&(G++,typeof J=="object"&&(J.placement&&(j=J.placement),J.rects&&(E=J.rects===!0?await _.getElementRects({reference:e,floating:t,strategy:d}):J.rects),{x:I,y:M}=dN(E,j,S)),z=-1)}return{x:I,y:M,placement:j,strategy:d,middlewareData:N}};async function n0(e,t){var n;t===void 0&&(t={});const{x:o,y:d,platform:f,rects:_,elements:i,strategy:S}=e,{boundary:E="clippingAncestors",rootBoundary:I="viewport",elementContext:M="floating",altBoundary:j=!1,padding:N=0}=Hu(t,e),G=E$(N),V=i[j?M==="floating"?"reference":"floating":M],K=yw(await f.getClippingRect({element:(n=await(f.isElement==null?void 0:f.isElement(V)))==null||n?V:V.contextElement||await(f.getDocumentElement==null?void 0:f.getDocumentElement(i.floating)),boundary:E,rootBoundary:I,strategy:S})),Q=M==="floating"?{x:o,y:d,width:_.floating.width,height:_.floating.height}:_.reference,X=await(f.getOffsetParent==null?void 0:f.getOffsetParent(i.floating)),ie=await(f.isElement==null?void 0:f.isElement(X))?await(f.getScale==null?void 0:f.getScale(X))||{x:1,y:1}:{x:1,y:1},J=yw(f.convertOffsetParentRelativeRectToViewportRelativeRect?await f.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:Q,offsetParent:X,strategy:S}):Q);return{top:(K.top-J.top+G.top)/ie.y,bottom:(J.bottom-K.bottom+G.bottom)/ie.y,left:(K.left-J.left+G.left)/ie.x,right:(J.right-K.right+G.right)/ie.x}}const oee=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:o,placement:d,rects:f,platform:_,elements:i,middlewareData:S}=t,{element:E,padding:I=0}=Hu(e,t)||{};if(E==null)return{};const M=E$(I),j={x:n,y:o},N=EM(d),G=AM(N),z=await _.getDimensions(E),V=N==="y",K=V?"top":"left",Q=V?"bottom":"right",X=V?"clientHeight":"clientWidth",ie=f.reference[G]+f.reference[N]-j[N]-f.floating[G],J=j[N]-f.reference[N],se=await(_.getOffsetParent==null?void 0:_.getOffsetParent(E));let he=se?se[X]:0;(!he||!await(_.isElement==null?void 0:_.isElement(se)))&&(he=i.floating[X]||f.floating[G]);const we=ie/2-J/2,ze=he/2-z[G]/2-1,je=eh(M[K],ze),Oe=eh(M[Q],ze),Be=je,qe=he-z[G]-Oe,Xe=he/2-z[G]/2+we,it=BP(Be,Xe,qe),Ge=!S.arrow&&ny(d)!=null&&Xe!==it&&f.reference[G]/2-(Xe<Be?je:Oe)-z[G]/2<0,Ke=Ge?Xe<Be?Xe-Be:Xe-qe:0;return{[N]:j[N]+Ke,data:{[N]:it,centerOffset:Xe-it-Ke,...Ge&&{alignmentOffset:Ke}},reset:Ge}}}),see=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,o;const{placement:d,middlewareData:f,rects:_,initialPlacement:i,platform:S,elements:E}=t,{mainAxis:I=!0,crossAxis:M=!0,fallbackPlacements:j,fallbackStrategy:N="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:z=!0,...V}=Hu(e,t);if((n=f.arrow)!=null&&n.alignmentOffset)return{};const K=Wu(d),Q=Vc(i),X=Wu(i)===i,ie=await(S.isRTL==null?void 0:S.isRTL(E.floating)),J=j||(X||!z?[gw(i)]:JQ(i)),se=G!=="none";!j&&se&&J.push(...ree(i,z,G,ie));const he=[i,...J],we=await n0(t,V),ze=[];let je=((o=f.flip)==null?void 0:o.overflows)||[];if(I&&ze.push(we[K]),M){const Xe=YQ(d,_,ie);ze.push(we[Xe[0]],we[Xe[1]])}if(je=[...je,{placement:d,overflows:ze}],!ze.every(Xe=>Xe<=0)){var Oe,Be;const Xe=(((Oe=f.flip)==null?void 0:Oe.index)||0)+1,it=he[Xe];if(it&&(!(M==="alignment"?Q!==Vc(it):!1)||je.every(ut=>ut.overflows[0]>0&&Vc(ut.placement)===Q)))return{data:{index:Xe,overflows:je},reset:{placement:it}};let Ge=(Be=je.filter(Ke=>Ke.overflows[0]<=0).sort((Ke,ut)=>Ke.overflows[1]-ut.overflows[1])[0])==null?void 0:Be.placement;if(!Ge)switch(N){case"bestFit":{var qe;const Ke=(qe=je.filter(ut=>{if(se){const rt=Vc(ut.placement);return rt===Q||rt==="y"}return!0}).map(ut=>[ut.placement,ut.overflows.filter(rt=>rt>0).reduce((rt,Xt)=>rt+Xt,0)]).sort((ut,rt)=>ut[1]-rt[1])[0])==null?void 0:qe[0];Ke&&(Ge=Ke);break}case"initialPlacement":Ge=i;break}if(d!==Ge)return{reset:{placement:Ge}}}return{}}}};function hN(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function fN(e){return qQ.some(t=>e[t]>=0)}const aee=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:o="referenceHidden",...d}=Hu(e,t);switch(o){case"referenceHidden":{const f=await n0(t,{...d,elementContext:"reference"}),_=hN(f,n.reference);return{data:{referenceHiddenOffsets:_,referenceHidden:fN(_)}}}case"escaped":{const f=await n0(t,{...d,altBoundary:!0}),_=hN(f,n.floating);return{data:{escapedOffsets:_,escaped:fN(_)}}}default:return{}}}}},P$=new Set(["left","top"]);async function lee(e,t){const{placement:n,platform:o,elements:d}=e,f=await(o.isRTL==null?void 0:o.isRTL(d.floating)),_=Wu(n),i=ny(n),S=Vc(n)==="y",E=P$.has(_)?-1:1,I=f&&S?-1:1,M=Hu(t,e);let{mainAxis:j,crossAxis:N,alignmentAxis:G}=typeof M=="number"?{mainAxis:M,crossAxis:0,alignmentAxis:null}:{mainAxis:M.mainAxis||0,crossAxis:M.crossAxis||0,alignmentAxis:M.alignmentAxis};return i&&typeof G=="number"&&(N=i==="end"?G*-1:G),S?{x:N*I,y:j*E}:{x:j*E,y:N*I}}const cee=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,o;const{x:d,y:f,placement:_,middlewareData:i}=t,S=await lee(t,e);return _===((n=i.offset)==null?void 0:n.placement)&&(o=i.arrow)!=null&&o.alignmentOffset?{}:{x:d+S.x,y:f+S.y,data:{...S,placement:_}}}}},uee=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:o,placement:d}=t,{mainAxis:f=!0,crossAxis:_=!1,limiter:i={fn:V=>{let{x:K,y:Q}=V;return{x:K,y:Q}}},...S}=Hu(e,t),E={x:n,y:o},I=await n0(t,S),M=Vc(Wu(d)),j=TM(M);let N=E[j],G=E[M];if(f){const V=j==="y"?"top":"left",K=j==="y"?"bottom":"right",Q=N+I[V],X=N-I[K];N=BP(Q,N,X)}if(_){const V=M==="y"?"top":"left",K=M==="y"?"bottom":"right",Q=G+I[V],X=G-I[K];G=BP(Q,G,X)}const z=i.fn({...t,[j]:N,[M]:G});return{...z,data:{x:z.x-n,y:z.y-o,enabled:{[j]:f,[M]:_}}}}}},dee=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:o,placement:d,rects:f,middlewareData:_}=t,{offset:i=0,mainAxis:S=!0,crossAxis:E=!0}=Hu(e,t),I={x:n,y:o},M=Vc(d),j=TM(M);let N=I[j],G=I[M];const z=Hu(i,t),V=typeof z=="number"?{mainAxis:z,crossAxis:0}:{mainAxis:0,crossAxis:0,...z};if(S){const X=j==="y"?"height":"width",ie=f.reference[j]-f.floating[X]+V.mainAxis,J=f.reference[j]+f.reference[X]-V.mainAxis;N<ie?N=ie:N>J&&(N=J)}if(E){var K,Q;const X=j==="y"?"width":"height",ie=P$.has(Wu(d)),J=f.reference[M]-f.floating[X]+(ie&&((K=_.offset)==null?void 0:K[M])||0)+(ie?0:V.crossAxis),se=f.reference[M]+f.reference[X]+(ie?0:((Q=_.offset)==null?void 0:Q[M])||0)-(ie?V.crossAxis:0);G<J?G=J:G>se&&(G=se)}return{[j]:N,[M]:G}}}},hee=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,o;const{placement:d,rects:f,platform:_,elements:i}=t,{apply:S=()=>{},...E}=Hu(e,t),I=await n0(t,E),M=Wu(d),j=ny(d),N=Vc(d)==="y",{width:G,height:z}=f.floating;let V,K;M==="top"||M==="bottom"?(V=M,K=j===(await(_.isRTL==null?void 0:_.isRTL(i.floating))?"start":"end")?"left":"right"):(K=M,V=j==="end"?"top":"bottom");const Q=z-I.top-I.bottom,X=G-I.left-I.right,ie=eh(z-I[V],Q),J=eh(G-I[K],X),se=!t.middlewareData.shift;let he=ie,we=J;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(we=X),(o=t.middlewareData.shift)!=null&&o.enabled.y&&(he=Q),se&&!j){const je=Ha(I.left,0),Oe=Ha(I.right,0),Be=Ha(I.top,0),qe=Ha(I.bottom,0);N?we=G-2*(je!==0||Oe!==0?je+Oe:Ha(I.left,I.right)):he=z-2*(Be!==0||qe!==0?Be+qe:Ha(I.top,I.bottom))}await S({...t,availableWidth:we,availableHeight:he});const ze=await _.getDimensions(i.floating);return G!==ze.width||z!==ze.height?{reset:{rects:!0}}:{}}}};function GS(){return typeof window<"u"}function iy(e){return C$(e)?(e.nodeName||"").toLowerCase():"#document"}function Za(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function iu(e){var t;return(t=(C$(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function C$(e){return GS()?e instanceof Node||e instanceof Za(e).Node:!1}function cc(e){return GS()?e instanceof Element||e instanceof Za(e).Element:!1}function Qc(e){return GS()?e instanceof HTMLElement||e instanceof Za(e).HTMLElement:!1}function pN(e){return!GS()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Za(e).ShadowRoot}const fee=new Set(["inline","contents"]);function ex(e){const{overflow:t,overflowX:n,overflowY:o,display:d}=uc(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+n)&&!fee.has(d)}const pee=new Set(["table","td","th"]);function mee(e){return pee.has(iy(e))}const gee=[":popover-open",":modal"];function HS(e){return gee.some(t=>{try{return e.matches(t)}catch{return!1}})}const yee=["transform","translate","scale","rotate","perspective"],_ee=["transform","translate","scale","rotate","perspective","filter"],vee=["paint","layout","strict","content"];function PM(e){const t=CM(),n=cc(e)?uc(e):e;return yee.some(o=>n[o]?n[o]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||_ee.some(o=>(n.willChange||"").includes(o))||vee.some(o=>(n.contain||"").includes(o))}function xee(e){let t=th(e);for(;Qc(t)&&!wg(t);){if(PM(t))return t;if(HS(t))return null;t=th(t)}return null}function CM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const bee=new Set(["html","body","#document"]);function wg(e){return bee.has(iy(e))}function uc(e){return Za(e).getComputedStyle(e)}function WS(e){return cc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function th(e){if(iy(e)==="html")return e;const t=e.assignedSlot||e.parentNode||pN(e)&&e.host||iu(e);return pN(t)?t.host:t}function I$(e){const t=th(e);return wg(t)?e.ownerDocument?e.ownerDocument.body:e.body:Qc(t)&&ex(t)?t:I$(t)}function i0(e,t,n){var o;t===void 0&&(t=[]),n===void 0&&(n=!0);const d=I$(e),f=d===((o=e.ownerDocument)==null?void 0:o.body),_=Za(d);if(f){const i=VP(_);return t.concat(_,_.visualViewport||[],ex(d)?d:[],i&&n?i0(i):[])}return t.concat(d,i0(d,[],n))}function VP(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function M$(e){const t=uc(e);let n=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const d=Qc(e),f=d?e.offsetWidth:n,_=d?e.offsetHeight:o,i=mw(n)!==f||mw(o)!==_;return i&&(n=f,o=_),{width:n,height:o,$:i}}function IM(e){return cc(e)?e:e.contextElement}function fg(e){const t=IM(e);if(!Qc(t))return Wc(1);const n=t.getBoundingClientRect(),{width:o,height:d,$:f}=M$(t);let _=(f?mw(n.width):n.width)/o,i=(f?mw(n.height):n.height)/d;return(!_||!Number.isFinite(_))&&(_=1),(!i||!Number.isFinite(i))&&(i=1),{x:_,y:i}}const wee=Wc(0);function O$(e){const t=Za(e);return!CM()||!t.visualViewport?wee:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function See(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Za(e)?!1:t}function Df(e,t,n,o){t===void 0&&(t=!1),n===void 0&&(n=!1);const d=e.getBoundingClientRect(),f=IM(e);let _=Wc(1);t&&(o?cc(o)&&(_=fg(o)):_=fg(e));const i=See(f,n,o)?O$(f):Wc(0);let S=(d.left+i.x)/_.x,E=(d.top+i.y)/_.y,I=d.width/_.x,M=d.height/_.y;if(f){const j=Za(f),N=o&&cc(o)?Za(o):o;let G=j,z=VP(G);for(;z&&o&&N!==G;){const V=fg(z),K=z.getBoundingClientRect(),Q=uc(z),X=K.left+(z.clientLeft+parseFloat(Q.paddingLeft))*V.x,ie=K.top+(z.clientTop+parseFloat(Q.paddingTop))*V.y;S*=V.x,E*=V.y,I*=V.x,M*=V.y,S+=X,E+=ie,G=Za(z),z=VP(G)}}return yw({width:I,height:M,x:S,y:E})}function MM(e,t){const n=WS(e).scrollLeft;return t?t.left+n:Df(iu(e)).left+n}function R$(e,t,n){n===void 0&&(n=!1);const o=e.getBoundingClientRect(),d=o.left+t.scrollLeft-(n?0:MM(e,o)),f=o.top+t.scrollTop;return{x:d,y:f}}function Tee(e){let{elements:t,rect:n,offsetParent:o,strategy:d}=e;const f=d==="fixed",_=iu(o),i=t?HS(t.floating):!1;if(o===_||i&&f)return n;let S={scrollLeft:0,scrollTop:0},E=Wc(1);const I=Wc(0),M=Qc(o);if((M||!M&&!f)&&((iy(o)!=="body"||ex(_))&&(S=WS(o)),Qc(o))){const N=Df(o);E=fg(o),I.x=N.x+o.clientLeft,I.y=N.y+o.clientTop}const j=_&&!M&&!f?R$(_,S,!0):Wc(0);return{width:n.width*E.x,height:n.height*E.y,x:n.x*E.x-S.scrollLeft*E.x+I.x+j.x,y:n.y*E.y-S.scrollTop*E.y+I.y+j.y}}function Aee(e){return Array.from(e.getClientRects())}function Eee(e){const t=iu(e),n=WS(e),o=e.ownerDocument.body,d=Ha(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),f=Ha(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let _=-n.scrollLeft+MM(e);const i=-n.scrollTop;return uc(o).direction==="rtl"&&(_+=Ha(t.clientWidth,o.clientWidth)-d),{width:d,height:f,x:_,y:i}}function Pee(e,t){const n=Za(e),o=iu(e),d=n.visualViewport;let f=o.clientWidth,_=o.clientHeight,i=0,S=0;if(d){f=d.width,_=d.height;const E=CM();(!E||E&&t==="fixed")&&(i=d.offsetLeft,S=d.offsetTop)}return{width:f,height:_,x:i,y:S}}const Cee=new Set(["absolute","fixed"]);function Iee(e,t){const n=Df(e,!0,t==="fixed"),o=n.top+e.clientTop,d=n.left+e.clientLeft,f=Qc(e)?fg(e):Wc(1),_=e.clientWidth*f.x,i=e.clientHeight*f.y,S=d*f.x,E=o*f.y;return{width:_,height:i,x:S,y:E}}function mN(e,t,n){let o;if(t==="viewport")o=Pee(e,n);else if(t==="document")o=Eee(iu(e));else if(cc(t))o=Iee(t,n);else{const d=O$(e);o={x:t.x-d.x,y:t.y-d.y,width:t.width,height:t.height}}return yw(o)}function k$(e,t){const n=th(e);return n===t||!cc(n)||wg(n)?!1:uc(n).position==="fixed"||k$(n,t)}function Mee(e,t){const n=t.get(e);if(n)return n;let o=i0(e,[],!1).filter(i=>cc(i)&&iy(i)!=="body"),d=null;const f=uc(e).position==="fixed";let _=f?th(e):e;for(;cc(_)&&!wg(_);){const i=uc(_),S=PM(_);!S&&i.position==="fixed"&&(d=null),(f?!S&&!d:!S&&i.position==="static"&&!!d&&Cee.has(d.position)||ex(_)&&!S&&k$(e,_))?o=o.filter(I=>I!==_):d=i,_=th(_)}return t.set(e,o),o}function Oee(e){let{element:t,boundary:n,rootBoundary:o,strategy:d}=e;const _=[...n==="clippingAncestors"?HS(t)?[]:Mee(t,this._c):[].concat(n),o],i=_[0],S=_.reduce((E,I)=>{const M=mN(t,I,d);return E.top=Ha(M.top,E.top),E.right=eh(M.right,E.right),E.bottom=eh(M.bottom,E.bottom),E.left=Ha(M.left,E.left),E},mN(t,i,d));return{width:S.right-S.left,height:S.bottom-S.top,x:S.left,y:S.top}}function Ree(e){const{width:t,height:n}=M$(e);return{width:t,height:n}}function kee(e,t,n){const o=Qc(t),d=iu(t),f=n==="fixed",_=Df(e,!0,f,t);let i={scrollLeft:0,scrollTop:0};const S=Wc(0);function E(){S.x=MM(d)}if(o||!o&&!f)if((iy(t)!=="body"||ex(d))&&(i=WS(t)),o){const N=Df(t,!0,f,t);S.x=N.x+t.clientLeft,S.y=N.y+t.clientTop}else d&&E();f&&!o&&d&&E();const I=d&&!o&&!f?R$(d,i):Wc(0),M=_.left+i.scrollLeft-S.x-I.x,j=_.top+i.scrollTop-S.y-I.y;return{x:M,y:j,width:_.width,height:_.height}}function SE(e){return uc(e).position==="static"}function gN(e,t){if(!Qc(e)||uc(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return iu(e)===n&&(n=n.ownerDocument.body),n}function j$(e,t){const n=Za(e);if(HS(e))return n;if(!Qc(e)){let d=th(e);for(;d&&!wg(d);){if(cc(d)&&!SE(d))return d;d=th(d)}return n}let o=gN(e,t);for(;o&&mee(o)&&SE(o);)o=gN(o,t);return o&&wg(o)&&SE(o)&&!PM(o)?n:o||xee(e)||n}const jee=async function(e){const t=this.getOffsetParent||j$,n=this.getDimensions,o=await n(e.floating);return{reference:kee(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}};function Dee(e){return uc(e).direction==="rtl"}const Lee={convertOffsetParentRelativeRectToViewportRelativeRect:Tee,getDocumentElement:iu,getClippingRect:Oee,getOffsetParent:j$,getElementRects:jee,getClientRects:Aee,getDimensions:Ree,getScale:fg,isElement:cc,isRTL:Dee};function D$(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Nee(e,t){let n=null,o;const d=iu(e);function f(){var i;clearTimeout(o),(i=n)==null||i.disconnect(),n=null}function _(i,S){i===void 0&&(i=!1),S===void 0&&(S=1),f();const E=e.getBoundingClientRect(),{left:I,top:M,width:j,height:N}=E;if(i||t(),!j||!N)return;const G=w1(M),z=w1(d.clientWidth-(I+j)),V=w1(d.clientHeight-(M+N)),K=w1(I),X={rootMargin:-G+"px "+-z+"px "+-V+"px "+-K+"px",threshold:Ha(0,eh(1,S))||1};let ie=!0;function J(se){const he=se[0].intersectionRatio;if(he!==S){if(!ie)return _();he?_(!1,he):o=setTimeout(()=>{_(!1,1e-7)},1e3)}he===1&&!D$(E,e.getBoundingClientRect())&&_(),ie=!1}try{n=new IntersectionObserver(J,{...X,root:d.ownerDocument})}catch{n=new IntersectionObserver(J,X)}n.observe(e)}return _(!0),f}function zee(e,t,n,o){o===void 0&&(o={});const{ancestorScroll:d=!0,ancestorResize:f=!0,elementResize:_=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:S=!1}=o,E=IM(e),I=d||f?[...E?i0(E):[],...i0(t)]:[];I.forEach(K=>{d&&K.addEventListener("scroll",n,{passive:!0}),f&&K.addEventListener("resize",n)});const M=E&&i?Nee(E,n):null;let j=-1,N=null;_&&(N=new ResizeObserver(K=>{let[Q]=K;Q&&Q.target===E&&N&&(N.unobserve(t),cancelAnimationFrame(j),j=requestAnimationFrame(()=>{var X;(X=N)==null||X.observe(t)})),n()}),E&&!S&&N.observe(E),N.observe(t));let G,z=S?Df(e):null;S&&V();function V(){const K=Df(e);z&&!D$(z,K)&&n(),z=K,G=requestAnimationFrame(V)}return n(),()=>{var K;I.forEach(Q=>{d&&Q.removeEventListener("scroll",n),f&&Q.removeEventListener("resize",n)}),M?.(),(K=N)==null||K.disconnect(),N=null,S&&cancelAnimationFrame(G)}}const Fee=cee,Bee=uee,$ee=see,Vee=hee,Uee=aee,yN=oee,Gee=dee,Hee=(e,t,n)=>{const o=new Map,d={platform:Lee,...n},f={...d.platform,_c:o};return iee(e,t,{...d,platform:f})};var Wee=typeof document<"u",qee=function(){},J1=Wee?B.useLayoutEffect:qee;function _w(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,o,d;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(o=n;o--!==0;)if(!_w(e[o],t[o]))return!1;return!0}if(d=Object.keys(e),n=d.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!{}.hasOwnProperty.call(t,d[o]))return!1;for(o=n;o--!==0;){const f=d[o];if(!(f==="_owner"&&e.$$typeof)&&!_w(e[f],t[f]))return!1}return!0}return e!==e&&t!==t}function L$(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function _N(e,t){const n=L$(e);return Math.round(t*n)/n}function TE(e){const t=B.useRef(e);return J1(()=>{t.current=e}),t}function Zee(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:o=[],platform:d,elements:{reference:f,floating:_}={},transform:i=!0,whileElementsMounted:S,open:E}=e,[I,M]=B.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[j,N]=B.useState(o);_w(j,o)||N(o);const[G,z]=B.useState(null),[V,K]=B.useState(null),Q=B.useCallback(ut=>{ut!==se.current&&(se.current=ut,z(ut))},[]),X=B.useCallback(ut=>{ut!==he.current&&(he.current=ut,K(ut))},[]),ie=f||G,J=_||V,se=B.useRef(null),he=B.useRef(null),we=B.useRef(I),ze=S!=null,je=TE(S),Oe=TE(d),Be=TE(E),qe=B.useCallback(()=>{if(!se.current||!he.current)return;const ut={placement:t,strategy:n,middleware:j};Oe.current&&(ut.platform=Oe.current),Hee(se.current,he.current,ut).then(rt=>{const Xt={...rt,isPositioned:Be.current!==!1};Xe.current&&!_w(we.current,Xt)&&(we.current=Xt,ey.flushSync(()=>{M(Xt)}))})},[j,t,n,Oe,Be]);J1(()=>{E===!1&&we.current.isPositioned&&(we.current.isPositioned=!1,M(ut=>({...ut,isPositioned:!1})))},[E]);const Xe=B.useRef(!1);J1(()=>(Xe.current=!0,()=>{Xe.current=!1}),[]),J1(()=>{if(ie&&(se.current=ie),J&&(he.current=J),ie&&J){if(je.current)return je.current(ie,J,qe);qe()}},[ie,J,qe,je,ze]);const it=B.useMemo(()=>({reference:se,floating:he,setReference:Q,setFloating:X}),[Q,X]),Ge=B.useMemo(()=>({reference:ie,floating:J}),[ie,J]),Ke=B.useMemo(()=>{const ut={position:n,left:0,top:0};if(!Ge.floating)return ut;const rt=_N(Ge.floating,I.x),Xt=_N(Ge.floating,I.y);return i?{...ut,transform:"translate("+rt+"px, "+Xt+"px)",...L$(Ge.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:rt,top:Xt}},[n,i,Ge.floating,I.x,I.y]);return B.useMemo(()=>({...I,update:qe,refs:it,elements:Ge,floatingStyles:Ke}),[I,qe,it,Ge,Ke])}const Kee=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:o,padding:d}=typeof e=="function"?e(n):e;return o&&t(o)?o.current!=null?yN({element:o.current,padding:d}).fn(n):{}:o?yN({element:o,padding:d}).fn(n):{}}}},Xee=(e,t)=>({...Fee(e),options:[e,t]}),Yee=(e,t)=>({...Bee(e),options:[e,t]}),Jee=(e,t)=>({...Gee(e),options:[e,t]}),Qee=(e,t)=>({...$ee(e),options:[e,t]}),ete=(e,t)=>({...Vee(e),options:[e,t]}),tte=(e,t)=>({...Uee(e),options:[e,t]}),rte=(e,t)=>({...Kee(e),options:[e,t]});var nte="Arrow",N$=B.forwardRef((e,t)=>{const{children:n,width:o=10,height:d=5,...f}=e;return x.jsx(En.svg,{...f,ref:t,width:o,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:x.jsx("polygon",{points:"0,0 30,0 15,10"})})});N$.displayName=nte;var ite=N$;function OM(e){const[t,n]=B.useState(void 0);return Ns(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const f=d[0];let _,i;if("borderBoxSize"in f){const S=f.borderBoxSize,E=Array.isArray(S)?S[0]:S;_=E.inlineSize,i=E.blockSize}else _=e.offsetWidth,i=e.offsetHeight;n({width:_,height:i})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else n(void 0)},[e]),t}var RM="Popper",[z$,oy]=fc(RM),[ote,F$]=z$(RM),B$=e=>{const{__scopePopper:t,children:n}=e,[o,d]=B.useState(null);return x.jsx(ote,{scope:t,anchor:o,onAnchorChange:d,children:n})};B$.displayName=RM;var $$="PopperAnchor",V$=B.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:o,...d}=e,f=F$($$,n),_=B.useRef(null),i=di(t,_);return B.useEffect(()=>{f.onAnchorChange(o?.current||_.current)}),o?null:x.jsx(En.div,{...d,ref:i})});V$.displayName=$$;var kM="PopperContent",[ste,ate]=z$(kM),U$=B.forwardRef((e,t)=>{const{__scopePopper:n,side:o="bottom",sideOffset:d=0,align:f="center",alignOffset:_=0,arrowPadding:i=0,avoidCollisions:S=!0,collisionBoundary:E=[],collisionPadding:I=0,sticky:M="partial",hideWhenDetached:j=!1,updatePositionStrategy:N="optimized",onPlaced:G,...z}=e,V=F$(kM,n),[K,Q]=B.useState(null),X=di(t,lr=>Q(lr)),[ie,J]=B.useState(null),se=OM(ie),he=se?.width??0,we=se?.height??0,ze=o+(f!=="center"?"-"+f:""),je=typeof I=="number"?I:{top:0,right:0,bottom:0,left:0,...I},Oe=Array.isArray(E)?E:[E],Be=Oe.length>0,qe={padding:je,boundary:Oe.filter(cte),altBoundary:Be},{refs:Xe,floatingStyles:it,placement:Ge,isPositioned:Ke,middlewareData:ut}=Zee({strategy:"fixed",placement:ze,whileElementsMounted:(...lr)=>zee(...lr,{animationFrame:N==="always"}),elements:{reference:V.anchor},middleware:[Xee({mainAxis:d+we,alignmentAxis:_}),S&&Yee({mainAxis:!0,crossAxis:!1,limiter:M==="partial"?Jee():void 0,...qe}),S&&Qee({...qe}),ete({...qe,apply:({elements:lr,rects:an,availableWidth:Lt,availableHeight:nr})=>{const{width:pr,height:Nt}=an.reference,zr=lr.floating.style;zr.setProperty("--radix-popper-available-width",`${Lt}px`),zr.setProperty("--radix-popper-available-height",`${nr}px`),zr.setProperty("--radix-popper-anchor-width",`${pr}px`),zr.setProperty("--radix-popper-anchor-height",`${Nt}px`)}}),ie&&rte({element:ie,padding:i}),ute({arrowWidth:he,arrowHeight:we}),j&&tte({strategy:"referenceHidden",...qe})]}),[rt,Xt]=W$(Ge),cr=Aa(G);Ns(()=>{Ke&&cr?.()},[Ke,cr]);const Bt=ut.arrow?.x,$t=ut.arrow?.y,br=ut.arrow?.centerOffset!==0,[nn,qn]=B.useState();return Ns(()=>{K&&qn(window.getComputedStyle(K).zIndex)},[K]),x.jsx("div",{ref:Xe.setFloating,"data-radix-popper-content-wrapper":"",style:{...it,transform:Ke?it.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:nn,"--radix-popper-transform-origin":[ut.transformOrigin?.x,ut.transformOrigin?.y].join(" "),...ut.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:x.jsx(ste,{scope:n,placedSide:rt,onArrowChange:J,arrowX:Bt,arrowY:$t,shouldHideArrow:br,children:x.jsx(En.div,{"data-side":rt,"data-align":Xt,...z,ref:X,style:{...z.style,animation:Ke?void 0:"none"}})})})});U$.displayName=kM;var G$="PopperArrow",lte={top:"bottom",right:"left",bottom:"top",left:"right"},H$=B.forwardRef(function(t,n){const{__scopePopper:o,...d}=t,f=ate(G$,o),_=lte[f.placedSide];return x.jsx("span",{ref:f.onArrowChange,style:{position:"absolute",left:f.arrowX,top:f.arrowY,[_]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[f.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[f.placedSide],visibility:f.shouldHideArrow?"hidden":void 0},children:x.jsx(ite,{...d,ref:n,style:{...d.style,display:"block"}})})});H$.displayName=G$;function cte(e){return e!==null}var ute=e=>({name:"transformOrigin",options:e,fn(t){const{placement:n,rects:o,middlewareData:d}=t,_=d.arrow?.centerOffset!==0,i=_?0:e.arrowWidth,S=_?0:e.arrowHeight,[E,I]=W$(n),M={start:"0%",center:"50%",end:"100%"}[I],j=(d.arrow?.x??0)+i/2,N=(d.arrow?.y??0)+S/2;let G="",z="";return E==="bottom"?(G=_?M:`${j}px`,z=`${-S}px`):E==="top"?(G=_?M:`${j}px`,z=`${o.floating.height+S}px`):E==="right"?(G=`${-S}px`,z=_?M:`${N}px`):E==="left"&&(G=`${o.floating.width+S}px`,z=_?M:`${N}px`),{data:{x:G,y:z}}}});function W$(e){const[t,n="center"]=e.split("-");return[t,n]}var q$=B$,jM=V$,DM=U$,LM=H$,[qS,jFe]=fc("Tooltip",[oy]),NM=oy(),Z$="TooltipProvider",dte=700,vN="tooltip.open",[hte,K$]=qS(Z$),X$=e=>{const{__scopeTooltip:t,delayDuration:n=dte,skipDelayDuration:o=300,disableHoverableContent:d=!1,children:f}=e,_=B.useRef(!0),i=B.useRef(!1),S=B.useRef(0);return B.useEffect(()=>{const E=S.current;return()=>window.clearTimeout(E)},[]),x.jsx(hte,{scope:t,isOpenDelayedRef:_,delayDuration:n,onOpen:B.useCallback(()=>{window.clearTimeout(S.current),_.current=!1},[]),onClose:B.useCallback(()=>{window.clearTimeout(S.current),S.current=window.setTimeout(()=>_.current=!0,o)},[o]),isPointerInTransitRef:i,onPointerInTransitChange:B.useCallback(E=>{i.current=E},[]),disableHoverableContent:d,children:f})};X$.displayName=Z$;var Y$="Tooltip",[DFe,ZS]=qS(Y$),UP="TooltipTrigger",fte=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...o}=e,d=ZS(UP,n),f=K$(UP,n),_=NM(n),i=B.useRef(null),S=di(t,i,d.onTriggerChange),E=B.useRef(!1),I=B.useRef(!1),M=B.useCallback(()=>E.current=!1,[]);return B.useEffect(()=>()=>document.removeEventListener("pointerup",M),[M]),x.jsx(jM,{asChild:!0,..._,children:x.jsx(En.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...o,ref:S,onPointerMove:Pr(e.onPointerMove,j=>{j.pointerType!=="touch"&&!I.current&&!f.isPointerInTransitRef.current&&(d.onTriggerEnter(),I.current=!0)}),onPointerLeave:Pr(e.onPointerLeave,()=>{d.onTriggerLeave(),I.current=!1}),onPointerDown:Pr(e.onPointerDown,()=>{d.open&&d.onClose(),E.current=!0,document.addEventListener("pointerup",M,{once:!0})}),onFocus:Pr(e.onFocus,()=>{E.current||d.onOpen()}),onBlur:Pr(e.onBlur,d.onClose),onClick:Pr(e.onClick,d.onClose)})})});fte.displayName=UP;var pte="TooltipPortal",[LFe,mte]=qS(pte,{forceMount:void 0}),Sg="TooltipContent",J$=B.forwardRef((e,t)=>{const n=mte(Sg,e.__scopeTooltip),{forceMount:o=n.forceMount,side:d="top",...f}=e,_=ZS(Sg,e.__scopeTooltip);return x.jsx(pc,{present:o||_.open,children:_.disableHoverableContent?x.jsx(Q$,{side:d,...f,ref:t}):x.jsx(gte,{side:d,...f,ref:t})})}),gte=B.forwardRef((e,t)=>{const n=ZS(Sg,e.__scopeTooltip),o=K$(Sg,e.__scopeTooltip),d=B.useRef(null),f=di(t,d),[_,i]=B.useState(null),{trigger:S,onClose:E}=n,I=d.current,{onPointerInTransitChange:M}=o,j=B.useCallback(()=>{i(null),M(!1)},[M]),N=B.useCallback((G,z)=>{const V=G.currentTarget,K={x:G.clientX,y:G.clientY},Q=bte(K,V.getBoundingClientRect()),X=wte(K,Q),ie=Ste(z.getBoundingClientRect()),J=Ate([...X,...ie]);i(J),M(!0)},[M]);return B.useEffect(()=>()=>j(),[j]),B.useEffect(()=>{if(S&&I){const G=V=>N(V,I),z=V=>N(V,S);return S.addEventListener("pointerleave",G),I.addEventListener("pointerleave",z),()=>{S.removeEventListener("pointerleave",G),I.removeEventListener("pointerleave",z)}}},[S,I,N,j]),B.useEffect(()=>{if(_){const G=z=>{const V=z.target,K={x:z.clientX,y:z.clientY},Q=S?.contains(V)||I?.contains(V),X=!Tte(K,_);Q?j():X&&(j(),E())};return document.addEventListener("pointermove",G),()=>document.removeEventListener("pointermove",G)}},[S,I,_,E,j]),x.jsx(Q$,{...e,ref:f})}),[yte,_te]=qS(Y$,{isInside:!1}),vte=lY("TooltipContent"),Q$=B.forwardRef((e,t)=>{const{__scopeTooltip:n,children:o,"aria-label":d,onEscapeKeyDown:f,onPointerDownOutside:_,...i}=e,S=ZS(Sg,n),E=NM(n),{onClose:I}=S;return B.useEffect(()=>(document.addEventListener(vN,I),()=>document.removeEventListener(vN,I)),[I]),B.useEffect(()=>{if(S.trigger){const M=j=>{j.target?.contains(S.trigger)&&I()};return window.addEventListener("scroll",M,{capture:!0}),()=>window.removeEventListener("scroll",M,{capture:!0})}},[S.trigger,I]),x.jsx(ty,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:M=>M.preventDefault(),onDismiss:I,children:x.jsxs(DM,{"data-state":S.stateAttribute,...E,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[x.jsx(vte,{children:o}),x.jsx(yte,{scope:n,isInside:!0,children:x.jsx(MY,{id:S.contentId,role:"tooltip",children:d||o})})]})})});J$.displayName=Sg;var eV="TooltipArrow",xte=B.forwardRef((e,t)=>{const{__scopeTooltip:n,...o}=e,d=NM(n);return _te(eV,n).isInside?null:x.jsx(LM,{...d,...o,ref:t})});xte.displayName=eV;function bte(e,t){const n=Math.abs(t.top-e.y),o=Math.abs(t.bottom-e.y),d=Math.abs(t.right-e.x),f=Math.abs(t.left-e.x);switch(Math.min(n,o,d,f)){case f:return"left";case d:return"right";case n:return"top";case o:return"bottom";default:throw new Error("unreachable")}}function wte(e,t,n=5){const o=[];switch(t){case"top":o.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":o.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":o.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":o.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return o}function Ste(e){const{top:t,right:n,bottom:o,left:d}=e;return[{x:d,y:t},{x:n,y:t},{x:n,y:o},{x:d,y:o}]}function Tte(e,t){const{x:n,y:o}=e;let d=!1;for(let f=0,_=t.length-1;f<t.length;_=f++){const i=t[f],S=t[_],E=i.x,I=i.y,M=S.x,j=S.y;I>o!=j>o&&n<(M-E)*(o-I)/(j-I)+E&&(d=!d)}return d}function Ate(e){const t=e.slice();return t.sort((n,o)=>n.x<o.x?-1:n.x>o.x?1:n.y<o.y?-1:n.y>o.y?1:0),Ete(t)}function Ete(e){if(e.length<=1)return e.slice();const t=[];for(let o=0;o<e.length;o++){const d=e[o];for(;t.length>=2;){const f=t[t.length-1],_=t[t.length-2];if((f.x-_.x)*(d.y-_.y)>=(f.y-_.y)*(d.x-_.x))t.pop();else break}t.push(d)}t.pop();const n=[];for(let o=e.length-1;o>=0;o--){const d=e[o];for(;n.length>=2;){const f=n[n.length-1],_=n[n.length-2];if((f.x-_.x)*(d.y-_.y)>=(f.y-_.y)*(d.x-_.x))n.pop();else break}n.push(d)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var Pte=X$,tV=J$;const Cte=Pte,Ite=B.forwardRef(({className:e,sideOffset:t=4,...n},o)=>x.jsx(tV,{ref:o,sideOffset:t,className:kr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));Ite.displayName=tV.displayName;function Mte(){const[e,t]=B.useState(0);return B.useEffect(()=>{const n=()=>{const o=window.scrollY||document.documentElement.scrollTop,d=document.documentElement.scrollHeight-document.documentElement.clientHeight,f=d>0?Math.min(100,o/d*100):0;t(f)};return window.addEventListener("scroll",n,{passive:!0}),n(),()=>window.removeEventListener("scroll",n)},[]),x.jsx("div",{"aria-hidden":!0,className:"fixed inset-x-0 top-0 z-[60] h-0 pointer-events-none",children:x.jsx("div",{className:"h-0.5 bg-gradient-to-r from-primary to-secondary origin-left transition-width duration-150",style:{width:`${e}%`}})})}const zM=B.createContext({});function sy(e){const t=B.useRef(null);return t.current===null&&(t.current=e()),t.current}const FM=typeof window<"u",KS=FM?B.useLayoutEffect:B.useEffect,XS=B.createContext(null);function BM(e,t){e.indexOf(t)===-1&&e.push(t)}function $M(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const eu=(e,t,n)=>n>t?t:n<e?e:n;let Tg=()=>{};const qu={},rV=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function nV(e){return typeof e=="object"&&e!==null}const iV=e=>/^0[^.\s]+$/u.test(e);function VM(e){let t;return()=>(t===void 0&&(t=e()),t)}const Ta=e=>e,Ote=(e,t)=>n=>t(e(n)),tx=(...e)=>e.reduce(Ote),Ag=(e,t,n)=>{const o=t-e;return o===0?1:(n-e)/o};class UM{constructor(){this.subscriptions=[]}add(t){return BM(this.subscriptions,t),()=>$M(this.subscriptions,t)}notify(t,n,o){const d=this.subscriptions.length;if(d)if(d===1)this.subscriptions[0](t,n,o);else for(let f=0;f<d;f++){const _=this.subscriptions[f];_&&_(t,n,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const qc=e=>e*1e3,xl=e=>e/1e3;function GM(e,t){return t?e*(1e3/t):0}const oV=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Rte=1e-7,kte=12;function jte(e,t,n,o,d){let f,_,i=0;do _=t+(n-t)/2,f=oV(_,o,d)-e,f>0?n=_:t=_;while(Math.abs(f)>Rte&&++i<kte);return _}function rx(e,t,n,o){if(e===t&&n===o)return Ta;const d=f=>jte(f,0,1,e,n);return f=>f===0||f===1?f:oV(d(f),t,o)}const sV=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,aV=e=>t=>1-e(1-t),lV=rx(.33,1.53,.69,.99),HM=aV(lV),cV=sV(HM),uV=e=>(e*=2)<1?.5*HM(e):.5*(2-Math.pow(2,-10*(e-1))),WM=e=>1-Math.sin(Math.acos(e)),dV=aV(WM),hV=sV(WM),Dte=rx(.42,0,1,1),Lte=rx(0,0,.58,1),fV=rx(.42,0,.58,1),Nte=e=>Array.isArray(e)&&typeof e[0]!="number",pV=e=>Array.isArray(e)&&typeof e[0]=="number",xN={linear:Ta,easeIn:Dte,easeInOut:fV,easeOut:Lte,circIn:WM,circInOut:hV,circOut:dV,backIn:HM,backInOut:cV,backOut:lV,anticipate:uV},zte=e=>typeof e=="string",bN=e=>{if(pV(e)){Tg(e.length===4);const[t,n,o,d]=e;return rx(t,n,o,d)}else if(zte(e))return Tg(xN[e]!==void 0),xN[e];return e},S1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],wN={value:null,addProjectionMetrics:null};function Fte(e,t){let n=new Set,o=new Set,d=!1,f=!1;const _=new WeakSet;let i={delta:0,timestamp:0,isProcessing:!1},S=0;function E(M){_.has(M)&&(I.schedule(M),e()),S++,M(i)}const I={schedule:(M,j=!1,N=!1)=>{const z=N&&d?n:o;return j&&_.add(M),z.has(M)||z.add(M),M},cancel:M=>{o.delete(M),_.delete(M)},process:M=>{if(i=M,d){f=!0;return}d=!0,[n,o]=[o,n],n.forEach(E),t&&wN.value&&wN.value.frameloop[t].push(S),S=0,n.clear(),d=!1,f&&(f=!1,I.process(M))}};return I}const Bte=40;function mV(e,t){let n=!1,o=!0;const d={delta:0,timestamp:0,isProcessing:!1},f=()=>n=!0,_=S1.reduce((X,ie)=>(X[ie]=Fte(f,t?ie:void 0),X),{}),{setup:i,read:S,resolveKeyframes:E,preUpdate:I,update:M,preRender:j,render:N,postRender:G}=_,z=()=>{const X=qu.useManualTiming?d.timestamp:performance.now();n=!1,qu.useManualTiming||(d.delta=o?1e3/60:Math.max(Math.min(X-d.timestamp,Bte),1)),d.timestamp=X,d.isProcessing=!0,i.process(d),S.process(d),E.process(d),I.process(d),M.process(d),j.process(d),N.process(d),G.process(d),d.isProcessing=!1,n&&t&&(o=!1,e(z))},V=()=>{n=!0,o=!0,d.isProcessing||e(z)};return{schedule:S1.reduce((X,ie)=>{const J=_[ie];return X[ie]=(se,he=!1,we=!1)=>(n||V(),J.schedule(se,he,we)),X},{}),cancel:X=>{for(let ie=0;ie<S1.length;ie++)_[S1[ie]].cancel(X)},state:d,steps:_}}const{schedule:Ui,cancel:dc,state:Ts,steps:AE}=mV(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ta,!0);let Q1;function $te(){Q1=void 0}const wa={now:()=>(Q1===void 0&&wa.set(Ts.isProcessing||qu.useManualTiming?Ts.timestamp:performance.now()),Q1),set:e=>{Q1=e,queueMicrotask($te)}},gV=e=>t=>typeof t=="string"&&t.startsWith(e),yV=gV("--"),Vte=gV("var(--"),qM=e=>Vte(e)?Ute.test(e.split("/*")[0].trim()):!1,Ute=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ay={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},o0={...ay,transform:e=>eu(0,1,e)},T1={...ay,default:1},Gv=e=>Math.round(e*1e5)/1e5,ZM=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Gte(e){return e==null}const Hte=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,KM=(e,t)=>n=>!!(typeof n=="string"&&Hte.test(n)&&n.startsWith(e)||t&&!Gte(n)&&Object.prototype.hasOwnProperty.call(n,t)),_V=(e,t,n)=>o=>{if(typeof o!="string")return o;const[d,f,_,i]=o.match(ZM);return{[e]:parseFloat(d),[t]:parseFloat(f),[n]:parseFloat(_),alpha:i!==void 0?parseFloat(i):1}},Wte=e=>eu(0,255,e),EE={...ay,transform:e=>Math.round(Wte(e))},bf={test:KM("rgb","red"),parse:_V("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:o=1})=>"rgba("+EE.transform(e)+", "+EE.transform(t)+", "+EE.transform(n)+", "+Gv(o0.transform(o))+")"};function qte(e){let t="",n="",o="",d="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),o=e.substring(5,7),d=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),o=e.substring(3,4),d=e.substring(4,5),t+=t,n+=n,o+=o,d+=d),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(o,16),alpha:d?parseInt(d,16)/255:1}}const GP={test:KM("#"),parse:qte,transform:bf.transform},nx=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),$d=nx("deg"),Zc=nx("%"),Nn=nx("px"),Zte=nx("vh"),Kte=nx("vw"),SN={...Zc,parse:e=>Zc.parse(e)/100,transform:e=>Zc.transform(e*100)},eg={test:KM("hsl","hue"),parse:_V("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:o=1})=>"hsla("+Math.round(e)+", "+Zc.transform(Gv(t))+", "+Zc.transform(Gv(n))+", "+Gv(o0.transform(o))+")"},rs={test:e=>bf.test(e)||GP.test(e)||eg.test(e),parse:e=>bf.test(e)?bf.parse(e):eg.test(e)?eg.parse(e):GP.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?bf.transform(e):eg.transform(e),getAnimatableNone:e=>{const t=rs.parse(e);return t.alpha=0,rs.transform(t)}},Xte=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Yte(e){return isNaN(e)&&typeof e=="string"&&(e.match(ZM)?.length||0)+(e.match(Xte)?.length||0)>0}const vV="number",xV="color",Jte="var",Qte="var(",TN="${}",ere=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function s0(e){const t=e.toString(),n=[],o={color:[],number:[],var:[]},d=[];let f=0;const i=t.replace(ere,S=>(rs.test(S)?(o.color.push(f),d.push(xV),n.push(rs.parse(S))):S.startsWith(Qte)?(o.var.push(f),d.push(Jte),n.push(S)):(o.number.push(f),d.push(vV),n.push(parseFloat(S))),++f,TN)).split(TN);return{values:n,split:i,indexes:o,types:d}}function bV(e){return s0(e).values}function wV(e){const{split:t,types:n}=s0(e),o=t.length;return d=>{let f="";for(let _=0;_<o;_++)if(f+=t[_],d[_]!==void 0){const i=n[_];i===vV?f+=Gv(d[_]):i===xV?f+=rs.transform(d[_]):f+=d[_]}return f}}const tre=e=>typeof e=="number"?0:rs.test(e)?rs.getAnimatableNone(e):e;function rre(e){const t=bV(e);return wV(e)(t.map(tre))}const rh={test:Yte,parse:bV,createTransformer:wV,getAnimatableNone:rre};function PE(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function nre({hue:e,saturation:t,lightness:n,alpha:o}){e/=360,t/=100,n/=100;let d=0,f=0,_=0;if(!t)d=f=_=n;else{const i=n<.5?n*(1+t):n+t-n*t,S=2*n-i;d=PE(S,i,e+1/3),f=PE(S,i,e),_=PE(S,i,e-1/3)}return{red:Math.round(d*255),green:Math.round(f*255),blue:Math.round(_*255),alpha:o}}function vw(e,t){return n=>n>0?t:e}const ko=(e,t,n)=>e+(t-e)*n,CE=(e,t,n)=>{const o=e*e,d=n*(t*t-o)+o;return d<0?0:Math.sqrt(d)},ire=[GP,bf,eg],ore=e=>ire.find(t=>t.test(e));function AN(e){const t=ore(e);if(!t)return!1;let n=t.parse(e);return t===eg&&(n=nre(n)),n}const EN=(e,t)=>{const n=AN(e),o=AN(t);if(!n||!o)return vw(e,t);const d={...n};return f=>(d.red=CE(n.red,o.red,f),d.green=CE(n.green,o.green,f),d.blue=CE(n.blue,o.blue,f),d.alpha=ko(n.alpha,o.alpha,f),bf.transform(d))},HP=new Set(["none","hidden"]);function sre(e,t){return HP.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function are(e,t){return n=>ko(e,t,n)}function XM(e){return typeof e=="number"?are:typeof e=="string"?qM(e)?vw:rs.test(e)?EN:ure:Array.isArray(e)?SV:typeof e=="object"?rs.test(e)?EN:lre:vw}function SV(e,t){const n=[...e],o=n.length,d=e.map((f,_)=>XM(f)(f,t[_]));return f=>{for(let _=0;_<o;_++)n[_]=d[_](f);return n}}function lre(e,t){const n={...e,...t},o={};for(const d in n)e[d]!==void 0&&t[d]!==void 0&&(o[d]=XM(e[d])(e[d],t[d]));return d=>{for(const f in o)n[f]=o[f](d);return n}}function cre(e,t){const n=[],o={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],_=e.indexes[f][o[f]],i=e.values[_]??0;n[d]=i,o[f]++}return n}const ure=(e,t)=>{const n=rh.createTransformer(t),o=s0(e),d=s0(t);return o.indexes.var.length===d.indexes.var.length&&o.indexes.color.length===d.indexes.color.length&&o.indexes.number.length>=d.indexes.number.length?HP.has(e)&&!d.values.length||HP.has(t)&&!o.values.length?sre(e,t):tx(SV(cre(o,d),d.values),n):vw(e,t)};function TV(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?ko(e,t,n):XM(e)(e,t)}const dre=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>Ui.update(t,n),stop:()=>dc(t),now:()=>Ts.isProcessing?Ts.timestamp:wa.now()}},AV=(e,t,n=10)=>{let o="";const d=Math.max(Math.round(t/n),2);for(let f=0;f<d;f++)o+=Math.round(e(f/(d-1))*1e4)/1e4+", ";return`linear(${o.substring(0,o.length-2)})`},xw=2e4;function YM(e){let t=0;const n=50;let o=e.next(t);for(;!o.done&&t<xw;)t+=n,o=e.next(t);return t>=xw?1/0:t}function hre(e,t=100,n){const o=n({...e,keyframes:[0,t]}),d=Math.min(YM(o),xw);return{type:"keyframes",ease:f=>o.next(d*f).value/t,duration:xl(d)}}const fre=5;function EV(e,t,n){const o=Math.max(t-fre,0);return GM(n-e(o),t-o)}const zo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},IE=.001;function pre({duration:e=zo.duration,bounce:t=zo.bounce,velocity:n=zo.velocity,mass:o=zo.mass}){let d,f,_=1-t;_=eu(zo.minDamping,zo.maxDamping,_),e=eu(zo.minDuration,zo.maxDuration,xl(e)),_<1?(d=E=>{const I=E*_,M=I*e,j=I-n,N=WP(E,_),G=Math.exp(-M);return IE-j/N*G},f=E=>{const M=E*_*e,j=M*n+n,N=Math.pow(_,2)*Math.pow(E,2)*e,G=Math.exp(-M),z=WP(Math.pow(E,2),_);return(-d(E)+IE>0?-1:1)*((j-N)*G)/z}):(d=E=>{const I=Math.exp(-E*e),M=(E-n)*e+1;return-IE+I*M},f=E=>{const I=Math.exp(-E*e),M=(n-E)*(e*e);return I*M});const i=5/e,S=gre(d,f,i);if(e=qc(e),isNaN(S))return{stiffness:zo.stiffness,damping:zo.damping,duration:e};{const E=Math.pow(S,2)*o;return{stiffness:E,damping:_*2*Math.sqrt(o*E),duration:e}}}const mre=12;function gre(e,t,n){let o=n;for(let d=1;d<mre;d++)o=o-e(o)/t(o);return o}function WP(e,t){return e*Math.sqrt(1-t*t)}const yre=["duration","bounce"],_re=["stiffness","damping","mass"];function PN(e,t){return t.some(n=>e[n]!==void 0)}function vre(e){let t={velocity:zo.velocity,stiffness:zo.stiffness,damping:zo.damping,mass:zo.mass,isResolvedFromDuration:!1,...e};if(!PN(e,_re)&&PN(e,yre))if(e.visualDuration){const n=e.visualDuration,o=2*Math.PI/(n*1.2),d=o*o,f=2*eu(.05,1,1-(e.bounce||0))*Math.sqrt(d);t={...t,mass:zo.mass,stiffness:d,damping:f}}else{const n=pre(e);t={...t,...n,mass:zo.mass},t.isResolvedFromDuration=!0}return t}function bw(e=zo.visualDuration,t=zo.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:o,restDelta:d}=n;const f=n.keyframes[0],_=n.keyframes[n.keyframes.length-1],i={done:!1,value:f},{stiffness:S,damping:E,mass:I,duration:M,velocity:j,isResolvedFromDuration:N}=vre({...n,velocity:-xl(n.velocity||0)}),G=j||0,z=E/(2*Math.sqrt(S*I)),V=_-f,K=xl(Math.sqrt(S/I)),Q=Math.abs(V)<5;o||(o=Q?zo.restSpeed.granular:zo.restSpeed.default),d||(d=Q?zo.restDelta.granular:zo.restDelta.default);let X;if(z<1){const J=WP(K,z);X=se=>{const he=Math.exp(-z*K*se);return _-he*((G+z*K*V)/J*Math.sin(J*se)+V*Math.cos(J*se))}}else if(z===1)X=J=>_-Math.exp(-K*J)*(V+(G+K*V)*J);else{const J=K*Math.sqrt(z*z-1);X=se=>{const he=Math.exp(-z*K*se),we=Math.min(J*se,300);return _-he*((G+z*K*V)*Math.sinh(we)+J*V*Math.cosh(we))/J}}const ie={calculatedDuration:N&&M||null,next:J=>{const se=X(J);if(N)i.done=J>=M;else{let he=J===0?G:0;z<1&&(he=J===0?qc(G):EV(X,J,se));const we=Math.abs(he)<=o,ze=Math.abs(_-se)<=d;i.done=we&&ze}return i.value=i.done?_:se,i},toString:()=>{const J=Math.min(YM(ie),xw),se=AV(he=>ie.next(J*he).value,J,30);return J+"ms "+se},toTransition:()=>{}};return ie}bw.applyToOptions=e=>{const t=hre(e,100,bw);return e.ease=t.ease,e.duration=qc(t.duration),e.type="keyframes",e};function qP({keyframes:e,velocity:t=0,power:n=.8,timeConstant:o=325,bounceDamping:d=10,bounceStiffness:f=500,modifyTarget:_,min:i,max:S,restDelta:E=.5,restSpeed:I}){const M=e[0],j={done:!1,value:M},N=we=>i!==void 0&&we<i||S!==void 0&&we>S,G=we=>i===void 0?S:S===void 0||Math.abs(i-we)<Math.abs(S-we)?i:S;let z=n*t;const V=M+z,K=_===void 0?V:_(V);K!==V&&(z=K-M);const Q=we=>-z*Math.exp(-we/o),X=we=>K+Q(we),ie=we=>{const ze=Q(we),je=X(we);j.done=Math.abs(ze)<=E,j.value=j.done?K:je};let J,se;const he=we=>{N(j.value)&&(J=we,se=bw({keyframes:[j.value,G(j.value)],velocity:EV(X,we,j.value),damping:d,stiffness:f,restDelta:E,restSpeed:I}))};return he(0),{calculatedDuration:null,next:we=>{let ze=!1;return!se&&J===void 0&&(ze=!0,ie(we),he(we)),J!==void 0&&we>=J?se.next(we-J):(!ze&&ie(we),j)}}}function xre(e,t,n){const o=[],d=n||qu.mix||TV,f=e.length-1;for(let _=0;_<f;_++){let i=d(e[_],e[_+1]);if(t){const S=Array.isArray(t)?t[_]||Ta:t;i=tx(S,i)}o.push(i)}return o}function JM(e,t,{clamp:n=!0,ease:o,mixer:d}={}){const f=e.length;if(Tg(f===t.length),f===1)return()=>t[0];if(f===2&&t[0]===t[1])return()=>t[1];const _=e[0]===e[1];e[0]>e[f-1]&&(e=[...e].reverse(),t=[...t].reverse());const i=xre(t,o,d),S=i.length,E=I=>{if(_&&I<e[0])return t[0];let M=0;if(S>1)for(;M<e.length-2&&!(I<e[M+1]);M++);const j=Ag(e[M],e[M+1],I);return i[M](j)};return n?I=>E(eu(e[0],e[f-1],I)):E}function bre(e,t){const n=e[e.length-1];for(let o=1;o<=t;o++){const d=Ag(0,t,o);e.push(ko(n,1,d))}}function PV(e){const t=[0];return bre(t,e.length-1),t}function wre(e,t){return e.map(n=>n*t)}function Sre(e,t){return e.map(()=>t||fV).splice(0,e.length-1)}function Hv({duration:e=300,keyframes:t,times:n,ease:o="easeInOut"}){const d=Nte(o)?o.map(bN):bN(o),f={done:!1,value:t[0]},_=wre(n&&n.length===t.length?n:PV(t),e),i=JM(_,t,{ease:Array.isArray(d)?d:Sre(t,d)});return{calculatedDuration:e,next:S=>(f.value=i(S),f.done=S>=e,f)}}const Tre=e=>e!==null;function QM(e,{repeat:t,repeatType:n="loop"},o,d=1){const f=e.filter(Tre),i=d<0||t&&n!=="loop"&&t%2===1?0:f.length-1;return!i||o===void 0?f[i]:o}const Are={decay:qP,inertia:qP,tween:Hv,keyframes:Hv,spring:bw};function CV(e){typeof e.type=="string"&&(e.type=Are[e.type])}class eO{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const Ere=e=>e/100;class tO extends eO{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:n}=this.options;n&&n.updatedAt!==wa.now()&&this.tick(wa.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;CV(t);const{type:n=Hv,repeat:o=0,repeatDelay:d=0,repeatType:f,velocity:_=0}=t;let{keyframes:i}=t;const S=n||Hv;S!==Hv&&typeof i[0]!="number"&&(this.mixKeyframes=tx(Ere,TV(i[0],i[1])),i=[0,100]);const E=S({...t,keyframes:i});f==="mirror"&&(this.mirroredGenerator=S({...t,keyframes:[...i].reverse(),velocity:-_})),E.calculatedDuration===null&&(E.calculatedDuration=YM(E));const{calculatedDuration:I}=E;this.calculatedDuration=I,this.resolvedDuration=I+d,this.totalDuration=this.resolvedDuration*(o+1)-d,this.generator=E}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:o,totalDuration:d,mixKeyframes:f,mirroredGenerator:_,resolvedDuration:i,calculatedDuration:S}=this;if(this.startTime===null)return o.next(0);const{delay:E=0,keyframes:I,repeat:M,repeatType:j,repeatDelay:N,type:G,onUpdate:z,finalKeyframe:V}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-d/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const K=this.currentTime-E*(this.playbackSpeed>=0?1:-1),Q=this.playbackSpeed>=0?K<0:K>d;this.currentTime=Math.max(K,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=d);let X=this.currentTime,ie=o;if(M){const we=Math.min(this.currentTime,d)/i;let ze=Math.floor(we),je=we%1;!je&&we>=1&&(je=1),je===1&&ze--,ze=Math.min(ze,M+1),!!(ze%2)&&(j==="reverse"?(je=1-je,N&&(je-=N/i)):j==="mirror"&&(ie=_)),X=eu(0,1,je)*i}const J=Q?{done:!1,value:I[0]}:ie.next(X);f&&(J.value=f(J.value));let{done:se}=J;!Q&&S!==null&&(se=this.playbackSpeed>=0?this.currentTime>=d:this.currentTime<=0);const he=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&se);return he&&G!==qP&&(J.value=QM(I,this.options,V,this.speed)),z&&z(J.value),he&&this.finish(),J}then(t,n){return this.finished.then(t,n)}get duration(){return xl(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+xl(t)}get time(){return xl(this.currentTime)}set time(t){t=qc(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(wa.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=xl(this.currentTime))}play(){if(this.isStopped)return;const{driver:t=dre,startTime:n}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),this.options.onPlay?.();const o=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=o):this.holdTime!==null?this.startTime=o-this.holdTime:this.startTime||(this.startTime=n??o),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(wa.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),t.observe(this)}}function Pre(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const wf=e=>e*180/Math.PI,ZP=e=>{const t=wf(Math.atan2(e[1],e[0]));return KP(t)},Cre={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:ZP,rotateZ:ZP,skewX:e=>wf(Math.atan(e[1])),skewY:e=>wf(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},KP=e=>(e=e%360,e<0&&(e+=360),e),CN=ZP,IN=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),MN=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Ire={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:IN,scaleY:MN,scale:e=>(IN(e)+MN(e))/2,rotateX:e=>KP(wf(Math.atan2(e[6],e[5]))),rotateY:e=>KP(wf(Math.atan2(-e[2],e[0]))),rotateZ:CN,rotate:CN,skewX:e=>wf(Math.atan(e[4])),skewY:e=>wf(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function XP(e){return e.includes("scale")?1:0}function YP(e,t){if(!e||e==="none")return XP(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let o,d;if(n)o=Ire,d=n;else{const i=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);o=Cre,d=i}if(!d)return XP(t);const f=o[t],_=d[1].split(",").map(Ore);return typeof f=="function"?f(_):_[f]}const Mre=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return YP(n,t)};function Ore(e){return parseFloat(e.trim())}const ly=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],cy=new Set(ly),ON=e=>e===ay||e===Nn,Rre=new Set(["x","y","z"]),kre=ly.filter(e=>!Rre.has(e));function jre(e){const t=[];return kre.forEach(n=>{const o=e.getValue(n);o!==void 0&&(t.push([n,o.get()]),o.set(n.startsWith("scale")?1:0))}),t}const Cf={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>YP(t,"x"),y:(e,{transform:t})=>YP(t,"y")};Cf.translateX=Cf.x;Cf.translateY=Cf.y;const If=new Set;let JP=!1,QP=!1,eC=!1;function IV(){if(QP){const e=Array.from(If).filter(o=>o.needsMeasurement),t=new Set(e.map(o=>o.element)),n=new Map;t.forEach(o=>{const d=jre(o);d.length&&(n.set(o,d),o.render())}),e.forEach(o=>o.measureInitialState()),t.forEach(o=>{o.render();const d=n.get(o);d&&d.forEach(([f,_])=>{o.getValue(f)?.set(_)})}),e.forEach(o=>o.measureEndState()),e.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}QP=!1,JP=!1,If.forEach(e=>e.complete(eC)),If.clear()}function MV(){If.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(QP=!0)})}function Dre(){eC=!0,MV(),IV(),eC=!1}class rO{constructor(t,n,o,d,f,_=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=o,this.motionValue=d,this.element=f,this.isAsync=_}scheduleResolve(){this.state="scheduled",this.isAsync?(If.add(this),JP||(JP=!0,Ui.read(MV),Ui.resolveKeyframes(IV))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:o,motionValue:d}=this;if(t[0]===null){const f=d?.get(),_=t[t.length-1];if(f!==void 0)t[0]=f;else if(o&&n){const i=o.readValue(n,_);i!=null&&(t[0]=i)}t[0]===void 0&&(t[0]=_),d&&f===void 0&&d.set(t[0])}Pre(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),If.delete(this)}cancel(){this.state==="scheduled"&&(If.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Lre=e=>e.startsWith("--");function Nre(e,t,n){Lre(t)?e.style.setProperty(t,n):e.style[t]=n}const OV=VM(()=>window.ScrollTimeline!==void 0),zre={};function Fre(e,t){const n=VM(e);return()=>zre[t]??n()}const RV=Fre(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Fv=([e,t,n,o])=>`cubic-bezier(${e}, ${t}, ${n}, ${o})`,RN={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Fv([0,.65,.55,1]),circOut:Fv([.55,0,1,.45]),backIn:Fv([.31,.01,.66,-.59]),backOut:Fv([.33,1.53,.69,.99])};function kV(e,t){if(e)return typeof e=="function"?RV()?AV(e,t):"ease-out":pV(e)?Fv(e):Array.isArray(e)?e.map(n=>kV(n,t)||RN.easeOut):RN[e]}function Bre(e,t,n,{delay:o=0,duration:d=300,repeat:f=0,repeatType:_="loop",ease:i="easeOut",times:S}={},E=void 0){const I={[t]:n};S&&(I.offset=S);const M=kV(i,d);Array.isArray(M)&&(I.easing=M);const j={delay:o,duration:d,easing:Array.isArray(M)?"linear":M,fill:"both",iterations:f+1,direction:_==="reverse"?"alternate":"normal"};return E&&(j.pseudoElement=E),e.animate(I,j)}function jV(e){return typeof e=="function"&&"applyToOptions"in e}function $re({type:e,...t}){return jV(e)&&RV()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Vre extends eO{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:n,name:o,keyframes:d,pseudoElement:f,allowFlatten:_=!1,finalKeyframe:i,onComplete:S}=t;this.isPseudoElement=!!f,this.allowFlatten=_,this.options=t,Tg(typeof t.type!="string");const E=$re(t);this.animation=Bre(n,o,d,E,f),E.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!f){const I=QM(d,this.options,i,this.speed);this.updateMotionValue?this.updateMotionValue(I):Nre(n,o,I),this.animation.cancel()}S?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const t=this.animation.effect?.getComputedTiming?.().duration||0;return xl(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+xl(t)}get time(){return xl(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=qc(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,t&&OV()?(this.animation.timeline=t,Ta):n(this)}}const DV={anticipate:uV,backInOut:cV,circInOut:hV};function Ure(e){return e in DV}function Gre(e){typeof e.ease=="string"&&Ure(e.ease)&&(e.ease=DV[e.ease])}const kN=10;class Hre extends Vre{constructor(t){Gre(t),CV(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:o,onComplete:d,element:f,..._}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const i=new tO({..._,autoplay:!1}),S=qc(this.finishedTime??this.time);n.setWithVelocity(i.sample(S-kN).value,i.sample(S).value,kN),i.stop()}}const jN=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(rh.test(e)||e==="0")&&!e.startsWith("url("));function Wre(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function qre(e,t,n,o){const d=e[0];if(d===null)return!1;if(t==="display"||t==="visibility")return!0;const f=e[e.length-1],_=jN(d,t),i=jN(f,t);return!_||!i?!1:Wre(e)||(n==="spring"||jV(n))&&o}function tC(e){e.duration=0,e.type="keyframes"}const Zre=new Set(["opacity","clipPath","filter","transform"]),Kre=VM(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Xre(e){const{motionValue:t,name:n,repeatDelay:o,repeatType:d,damping:f,type:_}=e;if(!(t?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:S,transformTemplate:E}=t.owner.getProps();return Kre()&&n&&Zre.has(n)&&(n!=="transform"||!E)&&!S&&!o&&d!=="mirror"&&f!==0&&_!=="inertia"}const Yre=40;class Jre extends eO{constructor({autoplay:t=!0,delay:n=0,type:o="keyframes",repeat:d=0,repeatDelay:f=0,repeatType:_="loop",keyframes:i,name:S,motionValue:E,element:I,...M}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=wa.now();const j={autoplay:t,delay:n,type:o,repeat:d,repeatDelay:f,repeatType:_,name:S,motionValue:E,element:I,...M},N=I?.KeyframeResolver||rO;this.keyframeResolver=new N(i,(G,z,V)=>this.onKeyframesResolved(G,z,j,!V),S,E,I),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(t,n,o,d){this.keyframeResolver=void 0;const{name:f,type:_,velocity:i,delay:S,isHandoff:E,onUpdate:I}=o;this.resolvedAt=wa.now(),qre(t,f,_,i)||((qu.instantAnimations||!S)&&I?.(QM(t,o,n)),t[0]=t[t.length-1],tC(o),o.repeat=0);const j={startTime:d?this.resolvedAt?this.resolvedAt-this.createdAt>Yre?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...o,keyframes:t},N=!E&&Xre(j)?new Hre({...j,element:j.motionValue.owner.current}):new tO(j);N.finished.then(()=>this.notifyFinished()).catch(Ta),this.pendingTimeline&&(this.stopTimeline=N.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=N}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Dre()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const Qre=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ene(e){const t=Qre.exec(e);if(!t)return[,];const[,n,o,d]=t;return[`--${n??o}`,d]}function LV(e,t,n=1){const[o,d]=ene(e);if(!o)return;const f=window.getComputedStyle(t).getPropertyValue(o);if(f){const _=f.trim();return rV(_)?parseFloat(_):_}return qM(d)?LV(d,t,n+1):d}function nO(e,t){return e?.[t]??e?.default??e}const NV=new Set(["width","height","top","left","right","bottom",...ly]),tne={test:e=>e==="auto",parse:e=>e},zV=e=>t=>t.test(e),FV=[ay,Nn,Zc,$d,Kte,Zte,tne],DN=e=>FV.find(zV(e));function rne(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||iV(e):!0}const nne=new Set(["brightness","contrast","saturate","opacity"]);function ine(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[o]=n.match(ZM)||[];if(!o)return e;const d=n.replace(o,"");let f=nne.has(t)?1:0;return o!==n&&(f*=100),t+"("+f+d+")"}const one=/\b([a-z-]*)\(.*?\)/gu,rC={...rh,getAnimatableNone:e=>{const t=e.match(one);return t?t.map(ine).join(" "):e}},LN={...ay,transform:Math.round},sne={rotate:$d,rotateX:$d,rotateY:$d,rotateZ:$d,scale:T1,scaleX:T1,scaleY:T1,scaleZ:T1,skew:$d,skewX:$d,skewY:$d,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:o0,originX:SN,originY:SN,originZ:Nn},iO={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn,...sne,zIndex:LN,fillOpacity:o0,strokeOpacity:o0,numOctaves:LN},ane={...iO,color:rs,backgroundColor:rs,outlineColor:rs,fill:rs,stroke:rs,borderColor:rs,borderTopColor:rs,borderRightColor:rs,borderBottomColor:rs,borderLeftColor:rs,filter:rC,WebkitFilter:rC},BV=e=>ane[e];function $V(e,t){let n=BV(e);return n!==rC&&(n=rh),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const lne=new Set(["auto","none","0"]);function cne(e,t,n){let o=0,d;for(;o<e.length&&!d;){const f=e[o];typeof f=="string"&&!lne.has(f)&&s0(f).values.length&&(d=e[o]),o++}if(d&&n)for(const f of t)e[f]=$V(n,d)}class une extends rO{constructor(t,n,o,d,f){super(t,n,o,d,f,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:o}=this;if(!n||!n.current)return;super.readKeyframes();for(let S=0;S<t.length;S++){let E=t[S];if(typeof E=="string"&&(E=E.trim(),qM(E))){const I=LV(E,n.current);I!==void 0&&(t[S]=I),S===t.length-1&&(this.finalKeyframe=E)}}if(this.resolveNoneKeyframes(),!NV.has(o)||t.length!==2)return;const[d,f]=t,_=DN(d),i=DN(f);if(_!==i)if(ON(_)&&ON(i))for(let S=0;S<t.length;S++){const E=t[S];typeof E=="string"&&(t[S]=parseFloat(E))}else Cf[o]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,o=[];for(let d=0;d<t.length;d++)(t[d]===null||rne(t[d]))&&o.push(d);o.length&&cne(t,o,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:o}=this;if(!t||!t.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Cf[o](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const d=n[n.length-1];d!==void 0&&t.getValue(o,d).jump(d,!1)}measureEndState(){const{element:t,name:n,unresolvedKeyframes:o}=this;if(!t||!t.current)return;const d=t.getValue(n);d&&d.jump(this.measuredOrigin,!1);const f=o.length-1,_=o[f];o[f]=Cf[n](t.measureViewportBox(),window.getComputedStyle(t.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),this.removedTransforms?.length&&this.removedTransforms.forEach(([i,S])=>{t.getValue(i).set(S)}),this.resolveNoneKeyframes()}}function oO(e,t,n){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const d=document.querySelectorAll(e);return d?Array.from(d):[]}return Array.from(e)}const VV=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function sO(e){return nV(e)&&"offsetHeight"in e}const NN=30,dne=e=>!isNaN(parseFloat(e)),Wv={current:void 0};class hne{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=o=>{const d=wa.now();if(this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const f of this.dependents)f.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=wa.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=dne(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new UM);const o=this.events[t].add(n);return t==="change"?()=>{o(),Ui.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,o){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-o}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return Wv.current&&Wv.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const t=wa.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>NN)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,NN);return GM(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function sc(e,t){return new hne(e,t)}const{schedule:aO,cancel:NFe}=mV(queueMicrotask,!1),tc={x:!1,y:!1};function UV(){return tc.x||tc.y}function fne(e){return e==="x"||e==="y"?tc[e]?null:(tc[e]=!0,()=>{tc[e]=!1}):tc.x||tc.y?null:(tc.x=tc.y=!0,()=>{tc.x=tc.y=!1})}function GV(e,t){const n=oO(e),o=new AbortController,d={passive:!0,...t,signal:o.signal};return[n,d,()=>o.abort()]}function zN(e){return!(e.pointerType==="touch"||UV())}function pne(e,t,n={}){const[o,d,f]=GV(e,n),_=i=>{if(!zN(i))return;const{target:S}=i,E=t(S,i);if(typeof E!="function"||!S)return;const I=M=>{zN(M)&&(E(M),S.removeEventListener("pointerleave",I))};S.addEventListener("pointerleave",I,d)};return o.forEach(i=>{i.addEventListener("pointerenter",_,d)}),f}const HV=(e,t)=>t?e===t?!0:HV(e,t.parentElement):!1,lO=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,mne=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function gne(e){return mne.has(e.tagName)||e.tabIndex!==-1}const ew=new WeakSet;function FN(e){return t=>{t.key==="Enter"&&e(t)}}function ME(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const yne=(e,t)=>{const n=e.currentTarget;if(!n)return;const o=FN(()=>{if(ew.has(n))return;ME(n,"down");const d=FN(()=>{ME(n,"up")}),f=()=>ME(n,"cancel");n.addEventListener("keyup",d,t),n.addEventListener("blur",f,t)});n.addEventListener("keydown",o,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",o),t)};function BN(e){return lO(e)&&!UV()}function _ne(e,t,n={}){const[o,d,f]=GV(e,n),_=i=>{const S=i.currentTarget;if(!BN(i))return;ew.add(S);const E=t(S,i),I=(N,G)=>{window.removeEventListener("pointerup",M),window.removeEventListener("pointercancel",j),ew.has(S)&&ew.delete(S),BN(N)&&typeof E=="function"&&E(N,{success:G})},M=N=>{I(N,S===window||S===document||n.useGlobalTarget||HV(S,N.target))},j=N=>{I(N,!1)};window.addEventListener("pointerup",M,d),window.addEventListener("pointercancel",j,d)};return o.forEach(i=>{(n.useGlobalTarget?window:i).addEventListener("pointerdown",_,d),sO(i)&&(i.addEventListener("focus",E=>yne(E,d)),!gne(i)&&!i.hasAttribute("tabindex")&&(i.tabIndex=0))}),f}function cO(e){return nV(e)&&"ownerSVGElement"in e}const tw=new WeakMap;let rw;const WV=(e,t,n)=>(o,d)=>d&&d[0]?d[0][e+"Size"]:cO(o)&&"getBBox"in o?o.getBBox()[t]:o[n],vne=WV("inline","width","offsetWidth"),xne=WV("block","height","offsetHeight");function bne({target:e,borderBoxSize:t}){tw.get(e)?.forEach(n=>{n(e,{get width(){return vne(e,t)},get height(){return xne(e,t)}})})}function wne(e){e.forEach(bne)}function Sne(){typeof ResizeObserver>"u"||(rw=new ResizeObserver(wne))}function Tne(e,t){rw||Sne();const n=oO(e);return n.forEach(o=>{let d=tw.get(o);d||(d=new Set,tw.set(o,d)),d.add(t),rw?.observe(o)}),()=>{n.forEach(o=>{const d=tw.get(o);d?.delete(t),d?.size||rw?.unobserve(o)})}}const nw=new Set;let tg;function Ane(){tg=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};nw.forEach(t=>t(e))},window.addEventListener("resize",tg)}function Ene(e){return nw.add(e),tg||Ane(),()=>{nw.delete(e),!nw.size&&typeof tg=="function"&&(window.removeEventListener("resize",tg),tg=void 0)}}function Pne(e,t){return typeof e=="function"?Ene(e):Tne(e,t)}function qV(e,t){let n;const o=()=>{const{currentTime:d}=t,_=(d===null?0:d.value)/100;n!==_&&e(_),n=_};return Ui.preUpdate(o,!0),()=>dc(o)}function Cne(e){return cO(e)&&e.tagName==="svg"}function Ine(...e){const t=!Array.isArray(e[0]),n=t?0:-1,o=e[0+n],d=e[1+n],f=e[2+n],_=e[3+n],i=JM(d,f,_);return t?i(o):i}const Hs=e=>!!(e&&e.getVelocity),Mne=[...FV,rs,rh],One=e=>Mne.find(zV(e)),YS=B.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function $N(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Rne(...e){return t=>{let n=!1;const o=e.map(d=>{const f=$N(d,t);return!n&&typeof f=="function"&&(n=!0),f});if(n)return()=>{for(let d=0;d<o.length;d++){const f=o[d];typeof f=="function"?f():$N(e[d],null)}}}}function kne(...e){return B.useCallback(Rne(...e),e)}class jne extends B.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const o=n.offsetParent,d=sO(o)&&o.offsetWidth||0,f=this.props.sizeRef.current;f.height=n.offsetHeight||0,f.width=n.offsetWidth||0,f.top=n.offsetTop,f.left=n.offsetLeft,f.right=d-f.width-f.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Dne({children:e,isPresent:t,anchorX:n,root:o}){const d=B.useId(),f=B.useRef(null),_=B.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:i}=B.useContext(YS),S=kne(f,e?.ref);return B.useInsertionEffect(()=>{const{width:E,height:I,top:M,left:j,right:N}=_.current;if(t||!f.current||!E||!I)return;const G=n==="left"?`left: ${j}`:`right: ${N}`;f.current.dataset.motionPopId=d;const z=document.createElement("style");i&&(z.nonce=i);const V=o??document.head;return V.appendChild(z),z.sheet&&z.sheet.insertRule(`
          [data-motion-pop-id="${d}"] {
            position: absolute !important;
            width: ${E}px !important;
            height: ${I}px !important;
            ${G}px !important;
            top: ${M}px !important;
          }
        `),()=>{V.contains(z)&&V.removeChild(z)}},[t]),x.jsx(jne,{isPresent:t,childRef:f,sizeRef:_,children:B.cloneElement(e,{ref:S})})}const Lne=({children:e,initial:t,isPresent:n,onExitComplete:o,custom:d,presenceAffectsLayout:f,mode:_,anchorX:i,root:S})=>{const E=sy(Nne),I=B.useId();let M=!0,j=B.useMemo(()=>(M=!1,{id:I,initial:t,isPresent:n,custom:d,onExitComplete:N=>{E.set(N,!0);for(const G of E.values())if(!G)return;o&&o()},register:N=>(E.set(N,!1),()=>E.delete(N))}),[n,E,o]);return f&&M&&(j={...j}),B.useMemo(()=>{E.forEach((N,G)=>E.set(G,!1))},[n]),B.useEffect(()=>{!n&&!E.size&&o&&o()},[n]),_==="popLayout"&&(e=x.jsx(Dne,{isPresent:n,anchorX:i,root:S,children:e})),x.jsx(XS.Provider,{value:j,children:e})};function Nne(){return new Map}function ZV(e=!0){const t=B.useContext(XS);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:o,register:d}=t,f=B.useId();B.useEffect(()=>{if(e)return d(f)},[e]);const _=B.useCallback(()=>e&&o&&o(f),[f,o,e]);return!n&&o?[!1,_]:[!0]}const A1=e=>e.key||"";function VN(e){const t=[];return B.Children.forEach(e,n=>{B.isValidElement(n)&&t.push(n)}),t}const Lf=({children:e,custom:t,initial:n=!0,onExitComplete:o,presenceAffectsLayout:d=!0,mode:f="sync",propagate:_=!1,anchorX:i="left",root:S})=>{const[E,I]=ZV(_),M=B.useMemo(()=>VN(e),[e]),j=_&&!E?[]:M.map(A1),N=B.useRef(!0),G=B.useRef(M),z=sy(()=>new Map),[V,K]=B.useState(M),[Q,X]=B.useState(M);KS(()=>{N.current=!1,G.current=M;for(let se=0;se<Q.length;se++){const he=A1(Q[se]);j.includes(he)?z.delete(he):z.get(he)!==!0&&z.set(he,!1)}},[Q,j.length,j.join("-")]);const ie=[];if(M!==V){let se=[...M];for(let he=0;he<Q.length;he++){const we=Q[he],ze=A1(we);j.includes(ze)||(se.splice(he,0,we),ie.push(we))}return f==="wait"&&ie.length&&(se=ie),X(VN(se)),K(M),null}const{forceRender:J}=B.useContext(zM);return x.jsx(x.Fragment,{children:Q.map(se=>{const he=A1(se),we=_&&!E?!1:M===Q||j.includes(he),ze=()=>{if(z.has(he))z.set(he,!0);else return;let je=!0;z.forEach(Oe=>{Oe||(je=!1)}),je&&(J?.(),X(G.current),_&&I?.(),o&&o())};return x.jsx(Lne,{isPresent:we,initial:!N.current||n?void 0:!1,custom:t,presenceAffectsLayout:d,mode:f,root:S,onExitComplete:we?void 0:ze,anchorX:i,children:se},he)})})},KV=B.createContext({strict:!1}),UN={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Eg={};for(const e in UN)Eg[e]={isEnabled:t=>UN[e].some(n=>!!t[n])};function zne(e){for(const t in e)Eg[t]={...Eg[t],...e[t]}}const Fne=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ww(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Fne.has(e)}let XV=e=>!ww(e);function Bne(e){typeof e=="function"&&(XV=t=>t.startsWith("on")?!ww(t):e(t))}try{Bne(require("@emotion/is-prop-valid").default)}catch{}function $ne(e,t,n){const o={};for(const d in e)d==="values"&&typeof e.values=="object"||(XV(d)||n===!0&&ww(d)||!t&&!ww(d)||e.draggable&&d.startsWith("onDrag"))&&(o[d]=e[d]);return o}const JS=B.createContext({});function QS(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function a0(e){return typeof e=="string"||Array.isArray(e)}const uO=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],dO=["initial",...uO];function eT(e){return QS(e.animate)||dO.some(t=>a0(e[t]))}function YV(e){return!!(eT(e)||e.variants)}function Vne(e,t){if(eT(e)){const{initial:n,animate:o}=e;return{initial:n===!1||a0(n)?n:void 0,animate:a0(o)?o:void 0}}return e.inherit!==!1?t:{}}function Une(e){const{initial:t,animate:n}=Vne(e,B.useContext(JS));return B.useMemo(()=>({initial:t,animate:n}),[GN(t),GN(n)])}function GN(e){return Array.isArray(e)?e.join(" "):e}function HN(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Tv={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Nn.test(e))e=parseFloat(e);else return e;const n=HN(e,t.target.x),o=HN(e,t.target.y);return`${n}% ${o}%`}},Gne={correct:(e,{treeScale:t,projectionDelta:n})=>{const o=e,d=rh.parse(e);if(d.length>5)return o;const f=rh.createTransformer(e),_=typeof d[0]!="number"?1:0,i=n.x.scale*t.x,S=n.y.scale*t.y;d[0+_]/=i,d[1+_]/=S;const E=ko(i,S,.5);return typeof d[2+_]=="number"&&(d[2+_]/=E),typeof d[3+_]=="number"&&(d[3+_]/=E),f(d)}},nC={borderRadius:{...Tv,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Tv,borderTopRightRadius:Tv,borderBottomLeftRadius:Tv,borderBottomRightRadius:Tv,boxShadow:Gne};function JV(e,{layout:t,layoutId:n}){return cy.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!nC[e]||e==="opacity")}const Hne={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Wne=ly.length;function qne(e,t,n){let o="",d=!0;for(let f=0;f<Wne;f++){const _=ly[f],i=e[_];if(i===void 0)continue;let S=!0;if(typeof i=="number"?S=i===(_.startsWith("scale")?1:0):S=parseFloat(i)===0,!S||n){const E=VV(i,iO[_]);if(!S){d=!1;const I=Hne[_]||_;o+=`${I}(${E}) `}n&&(t[_]=E)}}return o=o.trim(),n?o=n(t,d?"":o):d&&(o="none"),o}function hO(e,t,n){const{style:o,vars:d,transformOrigin:f}=e;let _=!1,i=!1;for(const S in t){const E=t[S];if(cy.has(S)){_=!0;continue}else if(yV(S)){d[S]=E;continue}else{const I=VV(E,iO[S]);S.startsWith("origin")?(i=!0,f[S]=I):o[S]=I}}if(t.transform||(_||n?o.transform=qne(t,e.transform,n):o.transform&&(o.transform="none")),i){const{originX:S="50%",originY:E="50%",originZ:I=0}=f;o.transformOrigin=`${S} ${E} ${I}`}}const fO=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function QV(e,t,n){for(const o in t)!Hs(t[o])&&!JV(o,n)&&(e[o]=t[o])}function Zne({transformTemplate:e},t){return B.useMemo(()=>{const n=fO();return hO(n,t,e),Object.assign({},n.vars,n.style)},[t])}function Kne(e,t){const n=e.style||{},o={};return QV(o,n,e),Object.assign(o,Zne(e,t)),o}function Xne(e,t){const n={},o=Kne(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=o,n}const Yne={offset:"stroke-dashoffset",array:"stroke-dasharray"},Jne={offset:"strokeDashoffset",array:"strokeDasharray"};function Qne(e,t,n=1,o=0,d=!0){e.pathLength=1;const f=d?Yne:Jne;e[f.offset]=Nn.transform(-o);const _=Nn.transform(t),i=Nn.transform(n);e[f.array]=`${_} ${i}`}function eU(e,{attrX:t,attrY:n,attrScale:o,pathLength:d,pathSpacing:f=1,pathOffset:_=0,...i},S,E,I){if(hO(e,i,E),S){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:M,style:j}=e;M.transform&&(j.transform=M.transform,delete M.transform),(j.transform||M.transformOrigin)&&(j.transformOrigin=M.transformOrigin??"50% 50%",delete M.transformOrigin),j.transform&&(j.transformBox=I?.transformBox??"fill-box",delete M.transformBox),t!==void 0&&(M.x=t),n!==void 0&&(M.y=n),o!==void 0&&(M.scale=o),d!==void 0&&Qne(M,d,f,_,!1)}const tU=()=>({...fO(),attrs:{}}),rU=e=>typeof e=="string"&&e.toLowerCase()==="svg";function eie(e,t,n,o){const d=B.useMemo(()=>{const f=tU();return eU(f,t,rU(o),e.transformTemplate,e.style),{...f.attrs,style:{...f.style}}},[t]);if(e.style){const f={};QV(f,e.style,e),d.style={...f,...d.style}}return d}const tie=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function pO(e){return typeof e!="string"||e.includes("-")?!1:!!(tie.indexOf(e)>-1||/[A-Z]/u.test(e))}function rie(e,t,n,{latestValues:o},d,f=!1){const i=(pO(e)?eie:Xne)(t,o,d,e),S=$ne(t,typeof e=="string",f),E=e!==B.Fragment?{...S,...i,ref:n}:{},{children:I}=t,M=B.useMemo(()=>Hs(I)?I.get():I,[I]);return B.createElement(e,{...E,children:M})}function WN(e){const t=[{},{}];return e?.values.forEach((n,o)=>{t[0][o]=n.get(),t[1][o]=n.getVelocity()}),t}function mO(e,t,n,o){if(typeof t=="function"){const[d,f]=WN(o);t=t(n!==void 0?n:e.custom,d,f)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[d,f]=WN(o);t=t(n!==void 0?n:e.custom,d,f)}return t}function iw(e){return Hs(e)?e.get():e}function nie({scrapeMotionValuesFromProps:e,createRenderState:t},n,o,d){return{latestValues:iie(n,o,d,e),renderState:t()}}function iie(e,t,n,o){const d={},f=o(e,{});for(const j in f)d[j]=iw(f[j]);let{initial:_,animate:i}=e;const S=eT(e),E=YV(e);t&&E&&!S&&e.inherit!==!1&&(_===void 0&&(_=t.initial),i===void 0&&(i=t.animate));let I=n?n.initial===!1:!1;I=I||_===!1;const M=I?i:_;if(M&&typeof M!="boolean"&&!QS(M)){const j=Array.isArray(M)?M:[M];for(let N=0;N<j.length;N++){const G=mO(e,j[N]);if(G){const{transitionEnd:z,transition:V,...K}=G;for(const Q in K){let X=K[Q];if(Array.isArray(X)){const ie=I?X.length-1:0;X=X[ie]}X!==null&&(d[Q]=X)}for(const Q in z)d[Q]=z[Q]}}}return d}const nU=e=>(t,n)=>{const o=B.useContext(JS),d=B.useContext(XS),f=()=>nie(e,t,o,d);return n?f():sy(f)};function gO(e,t,n){const{style:o}=e,d={};for(const f in o)(Hs(o[f])||t.style&&Hs(t.style[f])||JV(f,e)||n?.getValue(f)?.liveStyle!==void 0)&&(d[f]=o[f]);return d}const oie=nU({scrapeMotionValuesFromProps:gO,createRenderState:fO});function iU(e,t,n){const o=gO(e,t,n);for(const d in e)if(Hs(e[d])||Hs(t[d])){const f=ly.indexOf(d)!==-1?"attr"+d.charAt(0).toUpperCase()+d.substring(1):d;o[f]=e[d]}return o}const sie=nU({scrapeMotionValuesFromProps:iU,createRenderState:tU}),aie=Symbol.for("motionComponentSymbol");function rg(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function lie(e,t,n){return B.useCallback(o=>{o&&e.onMount&&e.onMount(o),t&&(o?t.mount(o):t.unmount()),n&&(typeof n=="function"?n(o):rg(n)&&(n.current=o))},[t])}const yO=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),cie="framerAppearId",oU="data-"+yO(cie),sU=B.createContext({});function uie(e,t,n,o,d){const{visualElement:f}=B.useContext(JS),_=B.useContext(KV),i=B.useContext(XS),S=B.useContext(YS).reducedMotion,E=B.useRef(null);o=o||_.renderer,!E.current&&o&&(E.current=o(e,{visualState:t,parent:f,props:n,presenceContext:i,blockInitialAnimation:i?i.initial===!1:!1,reducedMotionConfig:S}));const I=E.current,M=B.useContext(sU);I&&!I.projection&&d&&(I.type==="html"||I.type==="svg")&&die(E.current,n,d,M);const j=B.useRef(!1);B.useInsertionEffect(()=>{I&&j.current&&I.update(n,i)});const N=n[oU],G=B.useRef(!!N&&!window.MotionHandoffIsComplete?.(N)&&window.MotionHasOptimisedAnimation?.(N));return KS(()=>{I&&(j.current=!0,window.MotionIsMounted=!0,I.updateFeatures(),I.scheduleRenderMicrotask(),G.current&&I.animationState&&I.animationState.animateChanges())}),B.useEffect(()=>{I&&(!G.current&&I.animationState&&I.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(N)}),G.current=!1),I.enteringChildren=void 0)}),I}function die(e,t,n,o){const{layoutId:d,layout:f,drag:_,dragConstraints:i,layoutScroll:S,layoutRoot:E,layoutCrossfade:I}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:aU(e.parent)),e.projection.setOptions({layoutId:d,layout:f,alwaysMeasureLayout:!!_||i&&rg(i),visualElement:e,animationType:typeof f=="string"?f:"both",initialPromotionConfig:o,crossfade:I,layoutScroll:S,layoutRoot:E})}function aU(e){if(e)return e.options.allowProjection!==!1?e.projection:aU(e.parent)}function OE(e,{forwardMotionProps:t=!1}={},n,o){n&&zne(n);const d=pO(e)?sie:oie;function f(i,S){let E;const I={...B.useContext(YS),...i,layoutId:hie(i)},{isStatic:M}=I,j=Une(i),N=d(i,M);if(!M&&FM){fie();const G=pie(I);E=G.MeasureLayout,j.visualElement=uie(e,N,I,o,G.ProjectionNode)}return x.jsxs(JS.Provider,{value:j,children:[E&&j.visualElement?x.jsx(E,{visualElement:j.visualElement,...I}):null,rie(e,i,lie(N,j.visualElement,S),N,M,t)]})}f.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const _=B.forwardRef(f);return _[aie]=e,_}function hie({layoutId:e}){const t=B.useContext(zM).id;return t&&e!==void 0?t+"-"+e:e}function fie(e,t){B.useContext(KV).strict}function pie(e){const{drag:t,layout:n}=Eg;if(!t&&!n)return{};const o={...t,...n};return{MeasureLayout:t?.isEnabled(e)||n?.isEnabled(e)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}function mie(e,t){if(typeof Proxy>"u")return OE;const n=new Map,o=(f,_)=>OE(f,_,e,t),d=(f,_)=>o(f,_);return new Proxy(d,{get:(f,_)=>_==="create"?o:(n.has(_)||n.set(_,OE(_,void 0,e,t)),n.get(_))})}function lU({top:e,left:t,right:n,bottom:o}){return{x:{min:t,max:n},y:{min:e,max:o}}}function gie({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function yie(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),o=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:o.y,right:o.x}}function RE(e){return e===void 0||e===1}function iC({scale:e,scaleX:t,scaleY:n}){return!RE(e)||!RE(t)||!RE(n)}function pf(e){return iC(e)||cU(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function cU(e){return qN(e.x)||qN(e.y)}function qN(e){return e&&e!=="0%"}function Sw(e,t,n){const o=e-n,d=t*o;return n+d}function ZN(e,t,n,o,d){return d!==void 0&&(e=Sw(e,d,o)),Sw(e,n,o)+t}function oC(e,t=0,n=1,o,d){e.min=ZN(e.min,t,n,o,d),e.max=ZN(e.max,t,n,o,d)}function uU(e,{x:t,y:n}){oC(e.x,t.translate,t.scale,t.originPoint),oC(e.y,n.translate,n.scale,n.originPoint)}const KN=.999999999999,XN=1.0000000000001;function _ie(e,t,n,o=!1){const d=n.length;if(!d)return;t.x=t.y=1;let f,_;for(let i=0;i<d;i++){f=n[i],_=f.projectionDelta;const{visualElement:S}=f.options;S&&S.props.style&&S.props.style.display==="contents"||(o&&f.options.layoutScroll&&f.scroll&&f!==f.root&&ig(e,{x:-f.scroll.offset.x,y:-f.scroll.offset.y}),_&&(t.x*=_.x.scale,t.y*=_.y.scale,uU(e,_)),o&&pf(f.latestValues)&&ig(e,f.latestValues))}t.x<XN&&t.x>KN&&(t.x=1),t.y<XN&&t.y>KN&&(t.y=1)}function ng(e,t){e.min=e.min+t,e.max=e.max+t}function YN(e,t,n,o,d=.5){const f=ko(e.min,e.max,d);oC(e,t,n,f,o)}function ig(e,t){YN(e.x,t.x,t.scaleX,t.scale,t.originX),YN(e.y,t.y,t.scaleY,t.scale,t.originY)}function dU(e,t){return lU(yie(e.getBoundingClientRect(),t))}function vie(e,t,n){const o=dU(e,n),{scroll:d}=t;return d&&(ng(o.x,d.offset.x),ng(o.y,d.offset.y)),o}const JN=()=>({translate:0,scale:1,origin:0,originPoint:0}),og=()=>({x:JN(),y:JN()}),QN=()=>({min:0,max:0}),us=()=>({x:QN(),y:QN()}),sC={current:null},hU={current:!1};function xie(){if(hU.current=!0,!!FM)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>sC.current=e.matches;e.addEventListener("change",t),t()}else sC.current=!1}const bie=new WeakMap;function wie(e,t,n){for(const o in t){const d=t[o],f=n[o];if(Hs(d))e.addValue(o,d);else if(Hs(f))e.addValue(o,sc(d,{owner:e}));else if(f!==d)if(e.hasValue(o)){const _=e.getValue(o);_.liveStyle===!0?_.jump(d):_.hasAnimated||_.set(d)}else{const _=e.getStaticValue(o);e.addValue(o,sc(_!==void 0?_:d,{owner:e}))}}for(const o in n)t[o]===void 0&&e.removeValue(o);return t}const e3=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Sie{scrapeMotionValuesFromProps(t,n,o){return{}}constructor({parent:t,props:n,presenceContext:o,reducedMotionConfig:d,blockInitialAnimation:f,visualState:_},i={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=rO,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const j=wa.now();this.renderScheduledAt<j&&(this.renderScheduledAt=j,Ui.render(this.render,!1,!0))};const{latestValues:S,renderState:E}=_;this.latestValues=S,this.baseTarget={...S},this.initialValues=n.initial?{...S}:{},this.renderState=E,this.parent=t,this.props=n,this.presenceContext=o,this.depth=t?t.depth+1:0,this.reducedMotionConfig=d,this.options=i,this.blockInitialAnimation=!!f,this.isControllingVariants=eT(n),this.isVariantNode=YV(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...M}=this.scrapeMotionValuesFromProps(n,{},this);for(const j in M){const N=M[j];S[j]!==void 0&&Hs(N)&&N.set(S[j])}}mount(t){this.current=t,bie.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,o)=>this.bindToMotionValue(o,n)),hU.current||xie(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:sC.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),dc(this.notifyUpdate),dc(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const o=cy.has(t);o&&this.onBindTransform&&this.onBindTransform();const d=n.on("change",_=>{this.latestValues[t]=_,this.props.onUpdate&&Ui.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{d(),f&&f(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Eg){const n=Eg[t];if(!n)continue;const{isEnabled:o,Feature:d}=n;if(!this.features[t]&&d&&o(this.props)&&(this.features[t]=new d(this)),this.features[t]){const f=this.features[t];f.isMounted?f.update():(f.mount(),f.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):us()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let o=0;o<e3.length;o++){const d=e3[o];this.propEventSubscriptions[d]&&(this.propEventSubscriptions[d](),delete this.propEventSubscriptions[d]);const f="on"+d,_=t[f];_&&(this.propEventSubscriptions[d]=this.on(d,_))}this.prevMotionValues=wie(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const o=this.values.get(t);n!==o&&(o&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let o=this.values.get(t);return o===void 0&&n!==void 0&&(o=sc(n===null?void 0:n,{owner:this}),this.addValue(t,o)),o}readValue(t,n){let o=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return o!=null&&(typeof o=="string"&&(rV(o)||iV(o))?o=parseFloat(o):!One(o)&&rh.test(n)&&(o=$V(t,n)),this.setBaseTarget(t,Hs(o)?o.get():o)),Hs(o)?o.get():o}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){const{initial:n}=this.props;let o;if(typeof n=="string"||typeof n=="object"){const f=mO(this.props,n,this.presenceContext?.custom);f&&(o=f[t])}if(n&&o!==void 0)return o;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Hs(d)?d:this.initialValues[t]!==void 0&&o===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new UM),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){aO.render(this.render)}}class fU extends Sie{constructor(){super(...arguments),this.KeyframeResolver=une}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:o}){delete n[t],delete o[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Hs(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function pU(e,{style:t,vars:n},o,d){const f=e.style;let _;for(_ in t)f[_]=t[_];d?.applyProjectionStyles(f,o);for(_ in n)f.setProperty(_,n[_])}function Tie(e){return window.getComputedStyle(e)}class Aie extends fU{constructor(){super(...arguments),this.type="html",this.renderInstance=pU}readValueFromInstance(t,n){if(cy.has(n))return this.projection?.isProjecting?XP(n):Mre(t,n);{const o=Tie(t),d=(yV(n)?o.getPropertyValue(n):o[n])||0;return typeof d=="string"?d.trim():d}}measureInstanceViewportBox(t,{transformPagePoint:n}){return dU(t,n)}build(t,n,o){hO(t,n,o.transformTemplate)}scrapeMotionValuesFromProps(t,n,o){return gO(t,n,o)}}const mU=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Eie(e,t,n,o){pU(e,t,void 0,o);for(const d in t.attrs)e.setAttribute(mU.has(d)?d:yO(d),t.attrs[d])}class Pie extends fU{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=us}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(cy.has(n)){const o=BV(n);return o&&o.default||0}return n=mU.has(n)?n:yO(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,o){return iU(t,n,o)}build(t,n,o){eU(t,n,this.isSVGTag,o.transformTemplate,o.style)}renderInstance(t,n,o,d){Eie(t,n,o,d)}mount(t){this.isSVGTag=rU(t.tagName),super.mount(t)}}const Cie=(e,t)=>pO(e)?new Pie(t):new Aie(t,{allowProjection:e!==B.Fragment});function pg(e,t,n){const o=e.getProps();return mO(o,t,n!==void 0?n:o.custom,e)}const aC=e=>Array.isArray(e);function Iie(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,sc(n))}function Mie(e){return aC(e)?e[e.length-1]||0:e}function Oie(e,t){const n=pg(e,t);let{transitionEnd:o={},transition:d={},...f}=n||{};f={...f,...o};for(const _ in f){const i=Mie(f[_]);Iie(e,_,i)}}function Rie(e){return!!(Hs(e)&&e.add)}function lC(e,t){const n=e.getValue("willChange");if(Rie(n))return n.add(t);if(!n&&qu.WillChange){const o=new qu.WillChange("auto");e.addValue("willChange",o),o.add(t)}}function gU(e){return e.props[oU]}const kie=e=>e!==null;function jie(e,{repeat:t,repeatType:n="loop"},o){const d=e.filter(kie),f=t&&n!=="loop"&&t%2===1?0:d.length-1;return!f||o===void 0?d[f]:o}const Die={type:"spring",stiffness:500,damping:25,restSpeed:10},Lie=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Nie={type:"keyframes",duration:.8},zie={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Fie=(e,{keyframes:t})=>t.length>2?Nie:cy.has(e)?e.startsWith("scale")?Lie(t[1]):Die:zie;function Bie({when:e,delay:t,delayChildren:n,staggerChildren:o,staggerDirection:d,repeat:f,repeatType:_,repeatDelay:i,from:S,elapsed:E,...I}){return!!Object.keys(I).length}const _O=(e,t,n,o={},d,f)=>_=>{const i=nO(o,e)||{},S=i.delay||o.delay||0;let{elapsed:E=0}=o;E=E-qc(S);const I={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...i,delay:-E,onUpdate:j=>{t.set(j),i.onUpdate&&i.onUpdate(j)},onComplete:()=>{_(),i.onComplete&&i.onComplete()},name:e,motionValue:t,element:f?void 0:d};Bie(i)||Object.assign(I,Fie(e,I)),I.duration&&(I.duration=qc(I.duration)),I.repeatDelay&&(I.repeatDelay=qc(I.repeatDelay)),I.from!==void 0&&(I.keyframes[0]=I.from);let M=!1;if((I.type===!1||I.duration===0&&!I.repeatDelay)&&(tC(I),I.delay===0&&(M=!0)),(qu.instantAnimations||qu.skipAnimations)&&(M=!0,tC(I),I.delay=0),I.allowFlatten=!i.type&&!i.ease,M&&!f&&t.get()!==void 0){const j=jie(I.keyframes,i);if(j!==void 0){Ui.update(()=>{I.onUpdate(j),I.onComplete()});return}}return i.isSync?new tO(I):new Jre(I)};function $ie({protectedKeys:e,needsAnimating:t},n){const o=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,o}function yU(e,t,{delay:n=0,transitionOverride:o,type:d}={}){let{transition:f=e.getDefaultTransition(),transitionEnd:_,...i}=t;o&&(f=o);const S=[],E=d&&e.animationState&&e.animationState.getState()[d];for(const I in i){const M=e.getValue(I,e.latestValues[I]??null),j=i[I];if(j===void 0||E&&$ie(E,I))continue;const N={delay:n,...nO(f||{},I)},G=M.get();if(G!==void 0&&!M.isAnimating&&!Array.isArray(j)&&j===G&&!N.velocity)continue;let z=!1;if(window.MotionHandoffAnimation){const K=gU(e);if(K){const Q=window.MotionHandoffAnimation(K,I,Ui);Q!==null&&(N.startTime=Q,z=!0)}}lC(e,I),M.start(_O(I,M,j,e.shouldReduceMotion&&NV.has(I)?{type:!1}:N,e,z));const V=M.animation;V&&S.push(V)}return _&&Promise.all(S).then(()=>{Ui.update(()=>{_&&Oie(e,_)})}),S}function _U(e,t,n,o=0,d=1){const f=Array.from(e).sort((E,I)=>E.sortNodePosition(I)).indexOf(t),_=e.size,i=(_-1)*o;return typeof n=="function"?n(f,_):d===1?f*o:i-f*o}function cC(e,t,n={}){const o=pg(e,t,n.type==="exit"?e.presenceContext?.custom:void 0);let{transition:d=e.getDefaultTransition()||{}}=o||{};n.transitionOverride&&(d=n.transitionOverride);const f=o?()=>Promise.all(yU(e,o,n)):()=>Promise.resolve(),_=e.variantChildren&&e.variantChildren.size?(S=0)=>{const{delayChildren:E=0,staggerChildren:I,staggerDirection:M}=d;return Vie(e,t,S,E,I,M,n)}:()=>Promise.resolve(),{when:i}=d;if(i){const[S,E]=i==="beforeChildren"?[f,_]:[_,f];return S().then(()=>E())}else return Promise.all([f(),_(n.delay)])}function Vie(e,t,n=0,o=0,d=0,f=1,_){const i=[];for(const S of e.variantChildren)S.notify("AnimationStart",t),i.push(cC(S,t,{..._,delay:n+(typeof o=="function"?0:o)+_U(e.variantChildren,S,o,d,f)}).then(()=>S.notify("AnimationComplete",t)));return Promise.all(i)}function Uie(e,t,n={}){e.notify("AnimationStart",t);let o;if(Array.isArray(t)){const d=t.map(f=>cC(e,f,n));o=Promise.all(d)}else if(typeof t=="string")o=cC(e,t,n);else{const d=typeof t=="function"?pg(e,t,n.custom):t;o=Promise.all(yU(e,d,n))}return o.then(()=>{e.notify("AnimationComplete",t)})}function vU(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let o=0;o<n;o++)if(t[o]!==e[o])return!1;return!0}const Gie=dO.length;function xU(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?xU(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<Gie;n++){const o=dO[n],d=e.props[o];(a0(d)||d===!1)&&(t[o]=d)}return t}const Hie=[...uO].reverse(),Wie=uO.length;function qie(e){return t=>Promise.all(t.map(({animation:n,options:o})=>Uie(e,n,o)))}function Zie(e){let t=qie(e),n=t3(),o=!0;const d=S=>(E,I)=>{const M=pg(e,I,S==="exit"?e.presenceContext?.custom:void 0);if(M){const{transition:j,transitionEnd:N,...G}=M;E={...E,...G,...N}}return E};function f(S){t=S(e)}function _(S){const{props:E}=e,I=xU(e.parent)||{},M=[],j=new Set;let N={},G=1/0;for(let V=0;V<Wie;V++){const K=Hie[V],Q=n[K],X=E[K]!==void 0?E[K]:I[K],ie=a0(X),J=K===S?Q.isActive:null;J===!1&&(G=V);let se=X===I[K]&&X!==E[K]&&ie;if(se&&o&&e.manuallyAnimateOnMount&&(se=!1),Q.protectedKeys={...N},!Q.isActive&&J===null||!X&&!Q.prevProp||QS(X)||typeof X=="boolean")continue;const he=Kie(Q.prevProp,X);let we=he||K===S&&Q.isActive&&!se&&ie||V>G&&ie,ze=!1;const je=Array.isArray(X)?X:[X];let Oe=je.reduce(d(K),{});J===!1&&(Oe={});const{prevResolvedValues:Be={}}=Q,qe={...Be,...Oe},Xe=Ke=>{we=!0,j.has(Ke)&&(ze=!0,j.delete(Ke)),Q.needsAnimating[Ke]=!0;const ut=e.getValue(Ke);ut&&(ut.liveStyle=!1)};for(const Ke in qe){const ut=Oe[Ke],rt=Be[Ke];if(N.hasOwnProperty(Ke))continue;let Xt=!1;aC(ut)&&aC(rt)?Xt=!vU(ut,rt):Xt=ut!==rt,Xt?ut!=null?Xe(Ke):j.add(Ke):ut!==void 0&&j.has(Ke)?Xe(Ke):Q.protectedKeys[Ke]=!0}Q.prevProp=X,Q.prevResolvedValues=Oe,Q.isActive&&(N={...N,...Oe}),o&&e.blockInitialAnimation&&(we=!1);const it=se&&he;we&&(!it||ze)&&M.push(...je.map(Ke=>{const ut={type:K};if(typeof Ke=="string"&&o&&!it&&e.manuallyAnimateOnMount&&e.parent){const{parent:rt}=e,Xt=pg(rt,Ke);if(rt.enteringChildren&&Xt){const{delayChildren:cr}=Xt.transition||{};ut.delay=_U(rt.enteringChildren,e,cr)}}return{animation:Ke,options:ut}}))}if(j.size){const V={};if(typeof E.initial!="boolean"){const K=pg(e,Array.isArray(E.initial)?E.initial[0]:E.initial);K&&K.transition&&(V.transition=K.transition)}j.forEach(K=>{const Q=e.getBaseTarget(K),X=e.getValue(K);X&&(X.liveStyle=!0),V[K]=Q??null}),M.push({animation:V})}let z=!!M.length;return o&&(E.initial===!1||E.initial===E.animate)&&!e.manuallyAnimateOnMount&&(z=!1),o=!1,z?t(M):Promise.resolve()}function i(S,E){if(n[S].isActive===E)return Promise.resolve();e.variantChildren?.forEach(M=>M.animationState?.setActive(S,E)),n[S].isActive=E;const I=_(S);for(const M in n)n[M].protectedKeys={};return I}return{animateChanges:_,setActive:i,setAnimateFunction:f,getState:()=>n,reset:()=>{n=t3()}}}function Kie(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!vU(t,e):!1}function cf(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function t3(){return{animate:cf(!0),whileInView:cf(),whileHover:cf(),whileTap:cf(),whileDrag:cf(),whileFocus:cf(),exit:cf()}}class ih{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Xie extends ih{constructor(t){super(t),t.animationState||(t.animationState=Zie(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();QS(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Yie=0;class Jie extends ih{constructor(){super(...arguments),this.id=Yie++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===o)return;const d=this.node.animationState.setActive("exit",!t);n&&!t&&d.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Qie={animation:{Feature:Xie},exit:{Feature:Jie}};function l0(e,t,n,o={passive:!0}){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n)}function ix(e){return{point:{x:e.pageX,y:e.pageY}}}const eoe=e=>t=>lO(t)&&e(t,ix(t));function qv(e,t,n,o){return l0(e,t,eoe(n),o)}const bU=1e-4,toe=1-bU,roe=1+bU,wU=.01,noe=0-wU,ioe=0+wU;function na(e){return e.max-e.min}function ooe(e,t,n){return Math.abs(e-t)<=n}function r3(e,t,n,o=.5){e.origin=o,e.originPoint=ko(t.min,t.max,e.origin),e.scale=na(n)/na(t),e.translate=ko(n.min,n.max,e.origin)-e.originPoint,(e.scale>=toe&&e.scale<=roe||isNaN(e.scale))&&(e.scale=1),(e.translate>=noe&&e.translate<=ioe||isNaN(e.translate))&&(e.translate=0)}function Zv(e,t,n,o){r3(e.x,t.x,n.x,o?o.originX:void 0),r3(e.y,t.y,n.y,o?o.originY:void 0)}function n3(e,t,n){e.min=n.min+t.min,e.max=e.min+na(t)}function soe(e,t,n){n3(e.x,t.x,n.x),n3(e.y,t.y,n.y)}function i3(e,t,n){e.min=t.min-n.min,e.max=e.min+na(t)}function Tw(e,t,n){i3(e.x,t.x,n.x),i3(e.y,t.y,n.y)}function gl(e){return[e("x"),e("y")]}const SU=({current:e})=>e?e.ownerDocument.defaultView:null,o3=(e,t)=>Math.abs(e-t);function aoe(e,t){const n=o3(e.x,t.x),o=o3(e.y,t.y);return Math.sqrt(n**2+o**2)}class TU{constructor(t,n,{transformPagePoint:o,contextWindow:d=window,dragSnapToOrigin:f=!1,distanceThreshold:_=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=jE(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,G=aoe(j.offset,{x:0,y:0})>=this.distanceThreshold;if(!N&&!G)return;const{point:z}=j,{timestamp:V}=Ts;this.history.push({...z,timestamp:V});const{onStart:K,onMove:Q}=this.handlers;N||(K&&K(this.lastMoveEvent,j),this.startEvent=this.lastMoveEvent),Q&&Q(this.lastMoveEvent,j)},this.handlePointerMove=(j,N)=>{this.lastMoveEvent=j,this.lastMoveEventInfo=kE(N,this.transformPagePoint),Ui.update(this.updatePoint,!0)},this.handlePointerUp=(j,N)=>{this.end();const{onEnd:G,onSessionEnd:z,resumeAnimation:V}=this.handlers;if(this.dragSnapToOrigin&&V&&V(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const K=jE(j.type==="pointercancel"?this.lastMoveEventInfo:kE(N,this.transformPagePoint),this.history);this.startEvent&&G&&G(j,K),z&&z(j,K)},!lO(t))return;this.dragSnapToOrigin=f,this.handlers=n,this.transformPagePoint=o,this.distanceThreshold=_,this.contextWindow=d||window;const i=ix(t),S=kE(i,this.transformPagePoint),{point:E}=S,{timestamp:I}=Ts;this.history=[{...E,timestamp:I}];const{onSessionStart:M}=n;M&&M(t,jE(S,this.history)),this.removeListeners=tx(qv(this.contextWindow,"pointermove",this.handlePointerMove),qv(this.contextWindow,"pointerup",this.handlePointerUp),qv(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),dc(this.updatePoint)}}function kE(e,t){return t?{point:t(e.point)}:e}function s3(e,t){return{x:e.x-t.x,y:e.y-t.y}}function jE({point:e},t){return{point:e,delta:s3(e,AU(t)),offset:s3(e,loe(t)),velocity:coe(t,.1)}}function loe(e){return e[0]}function AU(e){return e[e.length-1]}function coe(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,o=null;const d=AU(e);for(;n>=0&&(o=e[n],!(d.timestamp-o.timestamp>qc(t)));)n--;if(!o)return{x:0,y:0};const f=xl(d.timestamp-o.timestamp);if(f===0)return{x:0,y:0};const _={x:(d.x-o.x)/f,y:(d.y-o.y)/f};return _.x===1/0&&(_.x=0),_.y===1/0&&(_.y=0),_}function uoe(e,{min:t,max:n},o){return t!==void 0&&e<t?e=o?ko(t,e,o.min):Math.max(e,t):n!==void 0&&e>n&&(e=o?ko(n,e,o.max):Math.min(e,n)),e}function a3(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function doe(e,{top:t,left:n,bottom:o,right:d}){return{x:a3(e.x,n,d),y:a3(e.y,t,o)}}function l3(e,t){let n=t.min-e.min,o=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,o]=[o,n]),{min:n,max:o}}function hoe(e,t){return{x:l3(e.x,t.x),y:l3(e.y,t.y)}}function foe(e,t){let n=.5;const o=na(e),d=na(t);return d>o?n=Ag(t.min,t.max-o,e.min):o>d&&(n=Ag(e.min,e.max-d,t.min)),eu(0,1,n)}function poe(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const uC=.35;function moe(e=uC){return e===!1?e=0:e===!0&&(e=uC),{x:c3(e,"left","right"),y:c3(e,"top","bottom")}}function c3(e,t,n){return{min:u3(e,t),max:u3(e,n)}}function u3(e,t){return typeof e=="number"?e:e[t]||0}const goe=new WeakMap;class yoe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=us(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:o}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const f=M=>{const{dragSnapToOrigin:j}=this.getProps();j?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(ix(M).point)},_=(M,j)=>{const{drag:N,dragPropagation:G,onDragStart:z}=this.getProps();if(N&&!G&&(this.openDragLock&&this.openDragLock(),this.openDragLock=fne(N),!this.openDragLock))return;this.latestPointerEvent=M,this.latestPanInfo=j,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),gl(K=>{let Q=this.getAxisMotionValue(K).get()||0;if(Zc.test(Q)){const{projection:X}=this.visualElement;if(X&&X.layout){const ie=X.layout.layoutBox[K];ie&&(Q=na(ie)*(parseFloat(Q)/100))}}this.originPoint[K]=Q}),z&&Ui.postRender(()=>z(M,j)),lC(this.visualElement,"transform");const{animationState:V}=this.visualElement;V&&V.setActive("whileDrag",!0)},i=(M,j)=>{this.latestPointerEvent=M,this.latestPanInfo=j;const{dragPropagation:N,dragDirectionLock:G,onDirectionLock:z,onDrag:V}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:K}=j;if(G&&this.currentDirection===null){this.currentDirection=_oe(K),this.currentDirection!==null&&z&&z(this.currentDirection);return}this.updateAxis("x",j.point,K),this.updateAxis("y",j.point,K),this.visualElement.render(),V&&V(M,j)},S=(M,j)=>{this.latestPointerEvent=M,this.latestPanInfo=j,this.stop(M,j),this.latestPointerEvent=null,this.latestPanInfo=null},E=()=>gl(M=>this.getAnimationState(M)==="paused"&&this.getAxisMotionValue(M).animation?.play()),{dragSnapToOrigin:I}=this.getProps();this.panSession=new TU(t,{onSessionStart:f,onStart:_,onMove:i,onSessionEnd:S,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:I,distanceThreshold:o,contextWindow:SU(this.visualElement)})}stop(t,n){const o=t||this.latestPointerEvent,d=n||this.latestPanInfo,f=this.isDragging;if(this.cancel(),!f||!d||!o)return;const{velocity:_}=d;this.startAnimation(_);const{onDragEnd:i}=this.getProps();i&&Ui.postRender(()=>i(o,d))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,o){const{drag:d}=this.getProps();if(!o||!E1(t,d,this.currentDirection))return;const f=this.getAxisMotionValue(t);let _=this.originPoint[t]+o[t];this.constraints&&this.constraints[t]&&(_=uoe(_,this.constraints[t],this.elastic[t])),f.set(_)}resolveConstraints(){const{dragConstraints:t,dragElastic:n}=this.getProps(),o=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,d=this.constraints;t&&rg(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&o?this.constraints=doe(o.layoutBox,t):this.constraints=!1,this.elastic=moe(n),d!==this.constraints&&o&&this.constraints&&!this.hasMutatedConstraints&&gl(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=poe(o.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!rg(t))return!1;const o=t.current,{projection:d}=this.visualElement;if(!d||!d.layout)return!1;const f=vie(o,d.root,this.visualElement.getTransformPagePoint());let _=hoe(d.layout.layoutBox,f);if(n){const i=n(gie(_));this.hasMutatedConstraints=!!i,i&&(_=lU(i))}return _}startAnimation(t){const{drag:n,dragMomentum:o,dragElastic:d,dragTransition:f,dragSnapToOrigin:_,onDragTransitionEnd:i}=this.getProps(),S=this.constraints||{},E=gl(I=>{if(!E1(I,n,this.currentDirection))return;let M=S&&S[I]||{};_&&(M={min:0,max:0});const j=d?200:1e6,N=d?40:1e7,G={type:"inertia",velocity:o?t[I]:0,bounceStiffness:j,bounceDamping:N,timeConstant:750,restDelta:1,restSpeed:10,...f,...M};return this.startAxisValueAnimation(I,G)});return Promise.all(E).then(i)}startAxisValueAnimation(t,n){const o=this.getAxisMotionValue(t);return lC(this.visualElement,t),o.start(_O(t,o,0,n,this.visualElement,!1))}stopAnimation(){gl(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){gl(t=>this.getAxisMotionValue(t).animation?.pause())}getAnimationState(t){return this.getAxisMotionValue(t).animation?.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,o=this.visualElement.getProps(),d=o[n];return d||this.visualElement.getValue(t,(o.initial?o.initial[t]:void 0)||0)}snapToCursor(t){gl(n=>{const{drag:o}=this.getProps();if(!E1(n,o,this.currentDirection))return;const{projection:d}=this.visualElement,f=this.getAxisMotionValue(n);if(d&&d.layout){const{min:_,max:i}=d.layout.layoutBox[n];f.set(t[n]-ko(_,i,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:o}=this.visualElement;if(!rg(n)||!o||!this.constraints)return;this.stopAnimation();const d={x:0,y:0};gl(_=>{const i=this.getAxisMotionValue(_);if(i&&this.constraints!==!1){const S=i.get();d[_]=foe({min:S,max:S},this.constraints[_])}});const{transformTemplate:f}=this.visualElement.getProps();this.visualElement.current.style.transform=f?f({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),gl(_=>{if(!E1(_,t,null))return;const i=this.getAxisMotionValue(_),{min:S,max:E}=this.constraints[_];i.set(ko(S,E,d[_]))})}addListeners(){if(!this.visualElement.current)return;goe.set(this.visualElement,this);const t=this.visualElement.current,n=qv(t,"pointerdown",S=>{const{drag:E,dragListener:I=!0}=this.getProps();E&&I&&this.start(S)}),o=()=>{const{dragConstraints:S}=this.getProps();rg(S)&&S.current&&(this.constraints=this.resolveRefConstraints())},{projection:d}=this.visualElement,f=d.addEventListener("measure",o);d&&!d.layout&&(d.root&&d.root.updateScroll(),d.updateLayout()),Ui.read(o);const _=l0(window,"resize",()=>this.scalePositionWithinConstraints()),i=d.addEventListener("didUpdate",({delta:S,hasLayoutChanged:E})=>{this.isDragging&&E&&(gl(I=>{const M=this.getAxisMotionValue(I);M&&(this.originPoint[I]+=S[I].translate,M.set(M.get()+S[I].translate))}),this.visualElement.render())});return()=>{_(),n(),f(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:o=!1,dragPropagation:d=!1,dragConstraints:f=!1,dragElastic:_=uC,dragMomentum:i=!0}=t;return{...t,drag:n,dragDirectionLock:o,dragPropagation:d,dragConstraints:f,dragElastic:_,dragMomentum:i}}}function E1(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function _oe(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class voe extends ih{constructor(t){super(t),this.removeGroupControls=Ta,this.removeListeners=Ta,this.controls=new yoe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ta}unmount(){this.removeGroupControls(),this.removeListeners()}}const d3=e=>(t,n)=>{e&&Ui.postRender(()=>e(t,n))};class xoe extends ih{constructor(){super(...arguments),this.removePointerDownListener=Ta}onPointerDown(t){this.session=new TU(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:SU(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:o,onPanEnd:d}=this.node.getProps();return{onSessionStart:d3(t),onStart:d3(n),onMove:o,onEnd:(f,_)=>{delete this.session,d&&Ui.postRender(()=>d(f,_))}}}mount(){this.removePointerDownListener=qv(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ow={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let DE=!1;class boe extends B.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:o,layoutId:d}=this.props,{projection:f}=t;f&&(n.group&&n.group.add(f),o&&o.register&&d&&o.register(f),DE&&f.root.didUpdate(),f.addEventListener("animationComplete",()=>{this.safeToRemove()}),f.setOptions({...f.options,onExitComplete:()=>this.safeToRemove()})),ow.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:o,drag:d,isPresent:f}=this.props,{projection:_}=o;return _&&(_.isPresent=f,DE=!0,d||t.layoutDependency!==n||n===void 0||t.isPresent!==f?_.willUpdate():this.safeToRemove(),t.isPresent!==f&&(f?_.promote():_.relegate()||Ui.postRender(()=>{const i=_.getStack();(!i||!i.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),aO.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:o}=this.props,{projection:d}=t;DE=!0,d&&(d.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(d),o&&o.deregister&&o.deregister(d))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function EU(e){const[t,n]=ZV(),o=B.useContext(zM);return x.jsx(boe,{...e,layoutGroup:o,switchLayoutGroup:B.useContext(sU),isPresent:t,safeToRemove:n})}function woe(e,t,n){const o=Hs(e)?e:sc(e);return o.start(_O("",o,t,n)),o.animation}const Soe=(e,t)=>e.depth-t.depth;class Toe{constructor(){this.children=[],this.isDirty=!1}add(t){BM(this.children,t),this.isDirty=!0}remove(t){$M(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Soe),this.isDirty=!1,this.children.forEach(t)}}function Aoe(e,t){const n=wa.now(),o=({timestamp:d})=>{const f=d-n;f>=t&&(dc(o),e(f-t))};return Ui.setup(o,!0),()=>dc(o)}const PU=["TopLeft","TopRight","BottomLeft","BottomRight"],Eoe=PU.length,h3=e=>typeof e=="string"?parseFloat(e):e,f3=e=>typeof e=="number"||Nn.test(e);function Poe(e,t,n,o,d,f){d?(e.opacity=ko(0,n.opacity??1,Coe(o)),e.opacityExit=ko(t.opacity??1,0,Ioe(o))):f&&(e.opacity=ko(t.opacity??1,n.opacity??1,o));for(let _=0;_<Eoe;_++){const i=`border${PU[_]}Radius`;let S=p3(t,i),E=p3(n,i);if(S===void 0&&E===void 0)continue;S||(S=0),E||(E=0),S===0||E===0||f3(S)===f3(E)?(e[i]=Math.max(ko(h3(S),h3(E),o),0),(Zc.test(E)||Zc.test(S))&&(e[i]+="%")):e[i]=E}(t.rotate||n.rotate)&&(e.rotate=ko(t.rotate||0,n.rotate||0,o))}function p3(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Coe=CU(0,.5,dV),Ioe=CU(.5,.95,Ta);function CU(e,t,n){return o=>o<e?0:o>t?1:n(Ag(e,t,o))}function m3(e,t){e.min=t.min,e.max=t.max}function Ql(e,t){m3(e.x,t.x),m3(e.y,t.y)}function g3(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function y3(e,t,n,o,d){return e-=t,e=Sw(e,1/n,o),d!==void 0&&(e=Sw(e,1/d,o)),e}function Moe(e,t=0,n=1,o=.5,d,f=e,_=e){if(Zc.test(t)&&(t=parseFloat(t),t=ko(_.min,_.max,t/100)-_.min),typeof t!="number")return;let i=ko(f.min,f.max,o);e===f&&(i-=t),e.min=y3(e.min,t,n,i,d),e.max=y3(e.max,t,n,i,d)}function _3(e,t,[n,o,d],f,_){Moe(e,t[n],t[o],t[d],t.scale,f,_)}const Ooe=["x","scaleX","originX"],Roe=["y","scaleY","originY"];function v3(e,t,n,o){_3(e.x,t,Ooe,n?n.x:void 0,o?o.x:void 0),_3(e.y,t,Roe,n?n.y:void 0,o?o.y:void 0)}function x3(e){return e.translate===0&&e.scale===1}function IU(e){return x3(e.x)&&x3(e.y)}function b3(e,t){return e.min===t.min&&e.max===t.max}function koe(e,t){return b3(e.x,t.x)&&b3(e.y,t.y)}function w3(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function MU(e,t){return w3(e.x,t.x)&&w3(e.y,t.y)}function S3(e){return na(e.x)/na(e.y)}function T3(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class joe{constructor(){this.members=[]}add(t){BM(this.members,t),t.scheduleRender()}remove(t){if($M(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(d=>t===d);if(n===0)return!1;let o;for(let d=n;d>=0;d--){const f=this.members[d];if(f.isPresent!==!1){o=f;break}}return o?(this.promote(o),!0):!1}promote(t,n){const o=this.lead;if(t!==o&&(this.prevLead=o,this.lead=t,t.show(),o)){o.instance&&o.scheduleRender(),t.scheduleRender(),t.resumeFrom=o,n&&(t.resumeFrom.preserveOpacity=!0),o.snapshot&&(t.snapshot=o.snapshot,t.snapshot.latestValues=o.animationValues||o.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:d}=t.options;d===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:o}=t;n.onExitComplete&&n.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Doe(e,t,n){let o="";const d=e.x.translate/t.x,f=e.y.translate/t.y,_=n?.z||0;if((d||f||_)&&(o=`translate3d(${d}px, ${f}px, ${_}px) `),(t.x!==1||t.y!==1)&&(o+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:E,rotate:I,rotateX:M,rotateY:j,skewX:N,skewY:G}=n;E&&(o=`perspective(${E}px) ${o}`),I&&(o+=`rotate(${I}deg) `),M&&(o+=`rotateX(${M}deg) `),j&&(o+=`rotateY(${j}deg) `),N&&(o+=`skewX(${N}deg) `),G&&(o+=`skewY(${G}deg) `)}const i=e.x.scale*t.x,S=e.y.scale*t.y;return(i!==1||S!==1)&&(o+=`scale(${i}, ${S})`),o||"none"}const LE=["","X","Y","Z"],Loe=1e3;let Noe=0;function NE(e,t,n,o){const{latestValues:d}=t;d[e]&&(n[e]=d[e],t.setStaticValue(e,0),o&&(o[e]=0))}function OU(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=gU(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:d,layoutId:f}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Ui,!(d||f))}const{parent:o}=e;o&&!o.hasCheckedOptimisedAppear&&OU(o)}function RU({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:o,resetTransform:d}){return class{constructor(_={},i=t?.()){this.id=Noe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Boe),this.nodes.forEach(Goe),this.nodes.forEach(Hoe),this.nodes.forEach($oe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=_,this.root=i?i.root||i:this,this.path=i?[...i.path,i]:[],this.parent=i,this.depth=i?i.depth+1:0;for(let S=0;S<this.path.length;S++)this.path[S].shouldResetTransform=!0;this.root===this&&(this.nodes=new Toe)}addEventListener(_,i){return this.eventHandlers.has(_)||this.eventHandlers.set(_,new UM),this.eventHandlers.get(_).add(i)}notifyListeners(_,...i){const S=this.eventHandlers.get(_);S&&S.notify(...i)}hasListeners(_){return this.eventHandlers.has(_)}mount(_){if(this.instance)return;this.isSVG=cO(_)&&!Cne(_),this.instance=_;const{layoutId:i,layout:S,visualElement:E}=this.options;if(E&&!E.current&&E.mount(_),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(S||i)&&(this.isLayoutDirty=!0),e){let I,M=0;const j=()=>this.root.updateBlockedByResize=!1;Ui.read(()=>{M=window.innerWidth}),e(_,()=>{const N=window.innerWidth;N!==M&&(M=N,this.root.updateBlockedByResize=!0,I&&I(),I=Aoe(j,250),ow.hasAnimatedSinceResize&&(ow.hasAnimatedSinceResize=!1,this.nodes.forEach(P3)))})}i&&this.root.registerSharedNode(i,this),this.options.animate!==!1&&E&&(i||S)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:M,hasRelativeLayoutChanged:j,layout:N})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||E.getDefaultTransition()||Xoe,{onLayoutAnimationStart:z,onLayoutAnimationComplete:V}=E.getProps(),K=!this.targetLayout||!MU(this.targetLayout,N),Q=!M&&j;if(this.options.layoutRoot||this.resumeFrom||Q||M&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const X={...nO(G,"layout"),onPlay:z,onComplete:V};(E.shouldReduceMotion||this.options.layoutRoot)&&(X.delay=0,X.type=!1),this.startAnimation(X),this.setAnimationOrigin(I,Q)}else M||P3(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=N})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const _=this.getStack();_&&_.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),dc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Woe),this.animationId++)}getTransformTemplate(){const{visualElement:_}=this.options;return _&&_.getProps().transformTemplate}willUpdate(_=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&OU(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let I=0;I<this.path.length;I++){const M=this.path[I];M.shouldResetTransform=!0,M.updateScroll("snapshot"),M.options.layoutRoot&&M.willUpdate(!1)}const{layoutId:i,layout:S}=this.options;if(i===void 0&&!S)return;const E=this.getTransformTemplate();this.prevTransformTemplateValue=E?E(this.latestValues,""):void 0,this.updateSnapshot(),_&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(A3);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(E3);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Uoe),this.nodes.forEach(zoe),this.nodes.forEach(Foe)):this.nodes.forEach(E3),this.clearAllSnapshots();const i=wa.now();Ts.delta=eu(0,1e3/60,i-Ts.timestamp),Ts.timestamp=i,Ts.isProcessing=!0,AE.update.process(Ts),AE.preRender.process(Ts),AE.render.process(Ts),Ts.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,aO.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Voe),this.sharedNodes.forEach(qoe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ui.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ui.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!na(this.snapshot.measuredBox.x)&&!na(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let S=0;S<this.path.length;S++)this.path[S].updateScroll();const _=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=us(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:i}=this.options;i&&i.notify("LayoutMeasure",this.layout.layoutBox,_?_.layoutBox:void 0)}updateScroll(_="measure"){let i=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===_&&(i=!1),i&&this.instance){const S=o(this.instance);this.scroll={animationId:this.root.animationId,phase:_,isRoot:S,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:S}}}resetTransform(){if(!d)return;const _=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,i=this.projectionDelta&&!IU(this.projectionDelta),S=this.getTransformTemplate(),E=S?S(this.latestValues,""):void 0,I=E!==this.prevTransformTemplateValue;_&&this.instance&&(i||pf(this.latestValues)||I)&&(d(this.instance,E),this.shouldResetTransform=!1,this.scheduleRender())}measure(_=!0){const i=this.measurePageBox();let S=this.removeElementScroll(i);return _&&(S=this.removeTransform(S)),Yoe(S),{animationId:this.root.animationId,measuredBox:i,layoutBox:S,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:_}=this.options;if(!_)return us();const i=_.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(Joe))){const{scroll:E}=this.root;E&&(ng(i.x,E.offset.x),ng(i.y,E.offset.y))}return i}removeElementScroll(_){const i=us();if(Ql(i,_),this.scroll?.wasRoot)return i;for(let S=0;S<this.path.length;S++){const E=this.path[S],{scroll:I,options:M}=E;E!==this.root&&I&&M.layoutScroll&&(I.wasRoot&&Ql(i,_),ng(i.x,I.offset.x),ng(i.y,I.offset.y))}return i}applyTransform(_,i=!1){const S=us();Ql(S,_);for(let E=0;E<this.path.length;E++){const I=this.path[E];!i&&I.options.layoutScroll&&I.scroll&&I!==I.root&&ig(S,{x:-I.scroll.offset.x,y:-I.scroll.offset.y}),pf(I.latestValues)&&ig(S,I.latestValues)}return pf(this.latestValues)&&ig(S,this.latestValues),S}removeTransform(_){const i=us();Ql(i,_);for(let S=0;S<this.path.length;S++){const E=this.path[S];if(!E.instance||!pf(E.latestValues))continue;iC(E.latestValues)&&E.updateSnapshot();const I=us(),M=E.measurePageBox();Ql(I,M),v3(i,E.latestValues,E.snapshot?E.snapshot.layoutBox:void 0,I)}return pf(this.latestValues)&&v3(i,this.latestValues),i}setTargetDelta(_){this.targetDelta=_,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(_){this.options={...this.options,..._,crossfade:_.crossfade!==void 0?_.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ts.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(_=!1){const i=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=i.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=i.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=i.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==i;if(!(_||S&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:M}=this.options;if(!this.layout||!(I||M))return;this.resolvedRelativeTargetAt=Ts.timestamp;const j=this.getClosestProjectingParent();j&&this.linkedParentVersion!==j.layoutVersion&&!j.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(j&&j.layout?this.createRelativeTarget(j,this.layout.layoutBox,j.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=us(),this.targetWithTransforms=us()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),soe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ql(this.target,this.layout.layoutBox),uU(this.target,this.targetDelta)):Ql(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,j&&!!j.resumingFrom==!!this.resumingFrom&&!j.options.layoutScroll&&j.target&&this.animationProgress!==1?this.createRelativeTarget(j,this.target,j.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||iC(this.parent.latestValues)||cU(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(_,i,S){this.relativeParent=_,this.linkedParentVersion=_.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=us(),this.relativeTargetOrigin=us(),Tw(this.relativeTargetOrigin,i,S),Ql(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const _=this.getLead(),i=!!this.resumingFrom||this!==_;let S=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(S=!1),i&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===Ts.timestamp&&(S=!1),S)return;const{layout:E,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(E||I))return;Ql(this.layoutCorrected,this.layout.layoutBox);const M=this.treeScale.x,j=this.treeScale.y;_ie(this.layoutCorrected,this.treeScale,this.path,i),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=us());const{target:N}=_;if(!N){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(g3(this.prevProjectionDelta.x,this.projectionDelta.x),g3(this.prevProjectionDelta.y,this.projectionDelta.y)),Zv(this.projectionDelta,this.layoutCorrected,N,this.latestValues),(this.treeScale.x!==M||this.treeScale.y!==j||!T3(this.projectionDelta.x,this.prevProjectionDelta.x)||!T3(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",N))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(_=!0){if(this.options.visualElement?.scheduleRender(),_){const i=this.getStack();i&&i.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=og(),this.projectionDelta=og(),this.projectionDeltaWithTransform=og()}setAnimationOrigin(_,i=!1){const S=this.snapshot,E=S?S.latestValues:{},I={...this.latestValues},M=og();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!i;const j=us(),N=S?S.source:void 0,G=this.layout?this.layout.source:void 0,z=N!==G,V=this.getStack(),K=!V||V.members.length<=1,Q=!!(z&&!K&&this.options.crossfade===!0&&!this.path.some(Koe));this.animationProgress=0;let X;this.mixTargetDelta=ie=>{const J=ie/1e3;C3(M.x,_.x,J),C3(M.y,_.y,J),this.setTargetDelta(M),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Tw(j,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Zoe(this.relativeTarget,this.relativeTargetOrigin,j,J),X&&koe(this.relativeTarget,X)&&(this.isProjectionDirty=!1),X||(X=us()),Ql(X,this.relativeTarget)),z&&(this.animationValues=I,Poe(I,E,this.latestValues,J,Q,K)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=J},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(_){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(dc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ui.update(()=>{ow.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=sc(0)),this.currentAnimation=woe(this.motionValue,[0,1e3],{..._,velocity:0,isSync:!0,onUpdate:i=>{this.mixTargetDelta(i),_.onUpdate&&_.onUpdate(i)},onStop:()=>{},onComplete:()=>{_.onComplete&&_.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const _=this.getStack();_&&_.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Loe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const _=this.getLead();let{targetWithTransforms:i,target:S,layout:E,latestValues:I}=_;if(!(!i||!S||!E)){if(this!==_&&this.layout&&E&&kU(this.options.animationType,this.layout.layoutBox,E.layoutBox)){S=this.target||us();const M=na(this.layout.layoutBox.x);S.x.min=_.target.x.min,S.x.max=S.x.min+M;const j=na(this.layout.layoutBox.y);S.y.min=_.target.y.min,S.y.max=S.y.min+j}Ql(i,S),ig(i,I),Zv(this.projectionDeltaWithTransform,this.layoutCorrected,i,I)}}registerSharedNode(_,i){this.sharedNodes.has(_)||this.sharedNodes.set(_,new joe),this.sharedNodes.get(_).add(i);const E=i.options.initialPromotionConfig;i.promote({transition:E?E.transition:void 0,preserveFollowOpacity:E&&E.shouldPreserveFollowOpacity?E.shouldPreserveFollowOpacity(i):void 0})}isLead(){const _=this.getStack();return _?_.lead===this:!0}getLead(){const{layoutId:_}=this.options;return _?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:_}=this.options;return _?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:_}=this.options;if(_)return this.root.sharedNodes.get(_)}promote({needsReset:_,transition:i,preserveFollowOpacity:S}={}){const E=this.getStack();E&&E.promote(this,S),_&&(this.projectionDelta=void 0,this.needsReset=!0),i&&this.setOptions({transition:i})}relegate(){const _=this.getStack();return _?_.relegate(this):!1}resetSkewAndRotation(){const{visualElement:_}=this.options;if(!_)return;let i=!1;const{latestValues:S}=_;if((S.z||S.rotate||S.rotateX||S.rotateY||S.rotateZ||S.skewX||S.skewY)&&(i=!0),!i)return;const E={};S.z&&NE("z",_,E,this.animationValues);for(let I=0;I<LE.length;I++)NE(`rotate${LE[I]}`,_,E,this.animationValues),NE(`skew${LE[I]}`,_,E,this.animationValues);_.render();for(const I in E)_.setStaticValue(I,E[I]),this.animationValues&&(this.animationValues[I]=E[I]);_.scheduleRender()}applyProjectionStyles(_,i){if(!this.instance||this.isSVG)return;if(!this.isVisible){_.visibility="hidden";return}const S=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,_.visibility="",_.opacity="",_.pointerEvents=iw(i?.pointerEvents)||"",_.transform=S?S(this.latestValues,""):"none";return}const E=this.getLead();if(!this.projectionDelta||!this.layout||!E.target){this.options.layoutId&&(_.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,_.pointerEvents=iw(i?.pointerEvents)||""),this.hasProjected&&!pf(this.latestValues)&&(_.transform=S?S({},""):"none",this.hasProjected=!1);return}_.visibility="";const I=E.animationValues||E.latestValues;this.applyTransformsToTarget();let M=Doe(this.projectionDeltaWithTransform,this.treeScale,I);S&&(M=S(I,M)),_.transform=M;const{x:j,y:N}=this.projectionDelta;_.transformOrigin=`${j.origin*100}% ${N.origin*100}% 0`,E.animationValues?_.opacity=E===this?I.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:I.opacityExit:_.opacity=E===this?I.opacity!==void 0?I.opacity:"":I.opacityExit!==void 0?I.opacityExit:0;for(const G in nC){if(I[G]===void 0)continue;const{correct:z,applyTo:V,isCSSVariable:K}=nC[G],Q=M==="none"?I[G]:z(I[G],E);if(V){const X=V.length;for(let ie=0;ie<X;ie++)_[V[ie]]=Q}else K?this.options.visualElement.renderState.vars[G]=Q:_[G]=Q}this.options.layoutId&&(_.pointerEvents=E===this?iw(i?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(_=>_.currentAnimation?.stop()),this.root.nodes.forEach(A3),this.root.sharedNodes.clear()}}}function zoe(e){e.updateLayout()}function Foe(e){const t=e.resumeFrom?.snapshot||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:o}=e.layout,{animationType:d}=e.options,f=t.source!==e.layout.source;d==="size"?gl(I=>{const M=f?t.measuredBox[I]:t.layoutBox[I],j=na(M);M.min=n[I].min,M.max=M.min+j}):kU(d,t.layoutBox,n)&&gl(I=>{const M=f?t.measuredBox[I]:t.layoutBox[I],j=na(n[I]);M.max=M.min+j,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[I].max=e.relativeTarget[I].min+j)});const _=og();Zv(_,n,t.layoutBox);const i=og();f?Zv(i,e.applyTransform(o,!0),t.measuredBox):Zv(i,n,t.layoutBox);const S=!IU(_);let E=!1;if(!e.resumeFrom){const I=e.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:M,layout:j}=I;if(M&&j){const N=us();Tw(N,t.layoutBox,M.layoutBox);const G=us();Tw(G,n,j.layoutBox),MU(N,G)||(E=!0),I.options.layoutRoot&&(e.relativeTarget=G,e.relativeTargetOrigin=N,e.relativeParent=I)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:i,layoutDelta:_,hasLayoutChanged:S,hasRelativeLayoutChanged:E})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function Boe(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function $oe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Voe(e){e.clearSnapshot()}function A3(e){e.clearMeasurements()}function E3(e){e.isLayoutDirty=!1}function Uoe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function P3(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Goe(e){e.resolveTargetDelta()}function Hoe(e){e.calcProjection()}function Woe(e){e.resetSkewAndRotation()}function qoe(e){e.removeLeadSnapshot()}function C3(e,t,n){e.translate=ko(t.translate,0,n),e.scale=ko(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function I3(e,t,n,o){e.min=ko(t.min,n.min,o),e.max=ko(t.max,n.max,o)}function Zoe(e,t,n,o){I3(e.x,t.x,n.x,o),I3(e.y,t.y,n.y,o)}function Koe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Xoe={duration:.45,ease:[.4,0,.1,1]},M3=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),O3=M3("applewebkit/")&&!M3("chrome/")?Math.round:Ta;function R3(e){e.min=O3(e.min),e.max=O3(e.max)}function Yoe(e){R3(e.x),R3(e.y)}function kU(e,t,n){return e==="position"||e==="preserve-aspect"&&!ooe(S3(t),S3(n),.2)}function Joe(e){return e!==e.root&&e.scroll?.wasRoot}const Qoe=RU({attachResizeListener:(e,t)=>l0(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),zE={current:void 0},jU=RU({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!zE.current){const e=new Qoe({});e.mount(window),e.setOptions({layoutScroll:!0}),zE.current=e}return zE.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),ese={pan:{Feature:xoe},drag:{Feature:voe,ProjectionNode:jU,MeasureLayout:EU}};function k3(e,t,n){const{props:o}=e;e.animationState&&o.whileHover&&e.animationState.setActive("whileHover",n==="Start");const d="onHover"+n,f=o[d];f&&Ui.postRender(()=>f(t,ix(t)))}class tse extends ih{mount(){const{current:t}=this.node;t&&(this.unmount=pne(t,(n,o)=>(k3(this.node,o,"Start"),d=>k3(this.node,d,"End"))))}unmount(){}}class rse extends ih{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=tx(l0(this.node.current,"focus",()=>this.onFocus()),l0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function j3(e,t,n){const{props:o}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&o.whileTap&&e.animationState.setActive("whileTap",n==="Start");const d="onTap"+(n==="End"?"":n),f=o[d];f&&Ui.postRender(()=>f(t,ix(t)))}class nse extends ih{mount(){const{current:t}=this.node;t&&(this.unmount=_ne(t,(n,o)=>(j3(this.node,o,"Start"),(d,{success:f})=>j3(this.node,d,f?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const dC=new WeakMap,FE=new WeakMap,ise=e=>{const t=dC.get(e.target);t&&t(e)},ose=e=>{e.forEach(ise)};function sse({root:e,...t}){const n=e||document;FE.has(n)||FE.set(n,{});const o=FE.get(n),d=JSON.stringify(t);return o[d]||(o[d]=new IntersectionObserver(ose,{root:e,...t})),o[d]}function ase(e,t,n){const o=sse(t);return dC.set(e,n),o.observe(e),()=>{dC.delete(e),o.unobserve(e)}}const lse={some:0,all:1};class cse extends ih{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:o,amount:d="some",once:f}=t,_={root:n?n.current:void 0,rootMargin:o,threshold:typeof d=="number"?d:lse[d]},i=S=>{const{isIntersecting:E}=S;if(this.isInView===E||(this.isInView=E,f&&!E&&this.hasEnteredView))return;E&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",E);const{onViewportEnter:I,onViewportLeave:M}=this.node.getProps(),j=E?I:M;j&&j(S)};return ase(this.node.current,_,i)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(use(t,n))&&this.startObserver()}unmount(){}}function use({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const dse={inView:{Feature:cse},tap:{Feature:nse},focus:{Feature:rse},hover:{Feature:tse}},hse={layout:{ProjectionNode:jU,MeasureLayout:EU}},fse={...Qie,...dse,...ese,...hse},mn=mie(fse,Cie),pse=50,D3=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),mse=()=>({time:0,x:D3(),y:D3()}),gse={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function L3(e,t,n,o){const d=n[t],{length:f,position:_}=gse[t],i=d.current,S=n.time;d.current=e[`scroll${_}`],d.scrollLength=e[`scroll${f}`]-e[`client${f}`],d.offset.length=0,d.offset[0]=0,d.offset[1]=d.scrollLength,d.progress=Ag(0,d.scrollLength,d.current);const E=o-S;d.velocity=E>pse?0:GM(d.current-i,E)}function yse(e,t,n){L3(e,"x",t,n),L3(e,"y",t,n),t.time=n}function _se(e,t){const n={x:0,y:0};let o=e;for(;o&&o!==t;)if(sO(o))n.x+=o.offsetLeft,n.y+=o.offsetTop,o=o.offsetParent;else if(o.tagName==="svg"){const d=o.getBoundingClientRect();o=o.parentElement;const f=o.getBoundingClientRect();n.x+=d.left-f.left,n.y+=d.top-f.top}else if(o instanceof SVGGraphicsElement){const{x:d,y:f}=o.getBBox();n.x+=d,n.y+=f;let _=null,i=o.parentNode;for(;!_;)i.tagName==="svg"&&(_=i),i=o.parentNode;o=_}else break;return n}const hC={start:0,center:.5,end:1};function N3(e,t,n=0){let o=0;if(e in hC&&(e=hC[e]),typeof e=="string"){const d=parseFloat(e);e.endsWith("px")?o=d:e.endsWith("%")?e=d/100:e.endsWith("vw")?o=d/100*document.documentElement.clientWidth:e.endsWith("vh")?o=d/100*document.documentElement.clientHeight:e=d}return typeof e=="number"&&(o=t*e),n+o}const vse=[0,0];function xse(e,t,n,o){let d=Array.isArray(e)?e:vse,f=0,_=0;return typeof e=="number"?d=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?d=e.split(" "):d=[e,hC[e]?e:"0"]),f=N3(d[0],n,o),_=N3(d[1],t),f-_}const bse={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},wse={x:0,y:0};function Sse(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Tse(e,t,n){const{offset:o=bse.All}=n,{target:d=e,axis:f="y"}=n,_=f==="y"?"height":"width",i=d!==e?_se(d,e):wse,S=d===e?{width:e.scrollWidth,height:e.scrollHeight}:Sse(d),E={width:e.clientWidth,height:e.clientHeight};t[f].offset.length=0;let I=!t[f].interpolate;const M=o.length;for(let j=0;j<M;j++){const N=xse(o[j],E[_],S[_],i[f]);!I&&N!==t[f].interpolatorOffsets[j]&&(I=!0),t[f].offset[j]=N}I&&(t[f].interpolate=JM(t[f].offset,PV(o),{clamp:!1}),t[f].interpolatorOffsets=[...t[f].offset]),t[f].progress=eu(0,1,t[f].interpolate(t[f].current))}function Ase(e,t=e,n){if(n.x.targetOffset=0,n.y.targetOffset=0,t!==e){let o=t;for(;o&&o!==e;)n.x.targetOffset+=o.offsetLeft,n.y.targetOffset+=o.offsetTop,o=o.offsetParent}n.x.targetLength=t===e?t.scrollWidth:t.clientWidth,n.y.targetLength=t===e?t.scrollHeight:t.clientHeight,n.x.containerLength=e.clientWidth,n.y.containerLength=e.clientHeight}function Ese(e,t,n,o={}){return{measure:d=>{Ase(e,o.target,n),yse(e,n,d),(o.offset||o.target)&&Tse(e,n,o)},notify:()=>t(n)}}const Av=new WeakMap,z3=new WeakMap,BE=new WeakMap,F3=e=>e===document.scrollingElement?window:e;function DU(e,{container:t=document.scrollingElement,...n}={}){if(!t)return Ta;let o=BE.get(t);o||(o=new Set,BE.set(t,o));const d=mse(),f=Ese(t,e,d,n);if(o.add(f),!Av.has(t)){const i=()=>{for(const M of o)M.measure(Ts.timestamp);Ui.preUpdate(S)},S=()=>{for(const M of o)M.notify()},E=()=>Ui.read(i);Av.set(t,E);const I=F3(t);window.addEventListener("resize",E,{passive:!0}),t!==document.documentElement&&z3.set(t,Pne(t,E)),I.addEventListener("scroll",E,{passive:!0}),E()}const _=Av.get(t);return Ui.read(_,!1,!0),()=>{dc(_);const i=BE.get(t);if(!i||(i.delete(f),i.size))return;const S=Av.get(t);Av.delete(t),S&&(F3(t).removeEventListener("scroll",S),z3.get(t)?.(),window.removeEventListener("resize",S))}}const B3=new Map;function Pse(e){const t={value:0},n=DU(o=>{t.value=o[e.axis].progress*100},e);return{currentTime:t,cancel:n}}function LU({source:e,container:t,...n}){const{axis:o}=n;e&&(t=e);const d=B3.get(t)??new Map;B3.set(t,d);const f=n.target??"self",_=d.get(f)??{},i=o+(n.offset??[]).join(",");return _[i]||(_[i]=!n.target&&OV()?new ScrollTimeline({source:t,axis:o}):Pse({container:t,...n})),_[i]}function Cse(e,t){const n=LU(t);return e.attachTimeline({timeline:t.target?void 0:n,observe:o=>(o.pause(),qV(d=>{o.time=o.iterationDuration*d},n))})}function Ise(e){return e.length===2}function Mse(e,t){return Ise(e)?DU(n=>{e(n[t.axis].progress,n)},t):qV(e,LU(t))}function Ose(e,{axis:t="y",container:n=document.scrollingElement,...o}={}){if(!n)return Ta;const d={axis:t,container:n,...o};return typeof e=="function"?Mse(e,d):Cse(e,d)}const Rse=()=>({scrollX:sc(0),scrollY:sc(0),scrollXProgress:sc(0),scrollYProgress:sc(0)}),P1=e=>e?!e.current:!1;function kse({container:e,target:t,...n}={}){const o=sy(Rse),d=B.useRef(null),f=B.useRef(!1),_=B.useCallback(()=>(d.current=Ose((i,{x:S,y:E})=>{o.scrollX.set(S.current),o.scrollXProgress.set(S.progress),o.scrollY.set(E.current),o.scrollYProgress.set(E.progress)},{...n,container:e?.current||void 0,target:t?.current||void 0}),()=>{d.current?.()}),[e,t,JSON.stringify(n.offset)]);return KS(()=>{if(f.current=!1,P1(e)||P1(t)){f.current=!0;return}else return _()},[_]),B.useEffect(()=>{if(f.current)return Tg(!P1(e)),Tg(!P1(t)),_()},[_]),o}function jse(e){const t=sy(()=>sc(e)),{isStatic:n}=B.useContext(YS);if(n){const[,o]=B.useState(e);B.useEffect(()=>t.on("change",o),[])}return t}function NU(e,t){const n=jse(t()),o=()=>n.set(t());return o(),KS(()=>{const d=()=>Ui.preRender(o,!1,!0),f=e.map(_=>_.on("change",d));return()=>{f.forEach(_=>_()),dc(o)}}),n}function Dse(e){Wv.current=[],e();const t=NU(Wv.current,e);return Wv.current=void 0,t}function Lse(e,t,n,o){if(typeof e=="function")return Dse(e);const d=typeof t=="function"?t:Ine(t,n,o);return Array.isArray(e)?$3(e,d):$3([e],([f])=>d(f))}function $3(e,t){const n=sy(()=>[]);return NU(e,()=>{n.length=0;const o=e.length;for(let d=0;d<o;d++)n[d]=e[d].get();return t(n)})}const Nse={some:0,all:1};function zse(e,t,{root:n,margin:o,amount:d="some"}={}){const f=oO(e),_=new WeakMap,i=E=>{E.forEach(I=>{const M=_.get(I.target);if(I.isIntersecting!==!!M)if(I.isIntersecting){const j=t(I.target,I);typeof j=="function"?_.set(I.target,j):S.unobserve(I.target)}else typeof M=="function"&&(M(I),_.delete(I.target))})},S=new IntersectionObserver(i,{root:n,rootMargin:o,threshold:typeof d=="number"?d:Nse[d]});return f.forEach(E=>S.observe(E)),()=>S.disconnect()}function Fse(e,{root:t,margin:n,amount:o,once:d=!1,initial:f=!1}={}){const[_,i]=B.useState(f);return B.useEffect(()=>{if(!e.current||d&&_)return;const S=()=>(i(!0),d?void 0:()=>i(!1)),E={root:t&&t.current||void 0,margin:n,amount:o};return zse(e.current,S,E)},[t,e,n,d,o]),_}function Bse(){const[e,t]=B.useState(!1);B.useEffect(()=>{const o=()=>t(window.scrollY>360);return window.addEventListener("scroll",o,{passive:!0}),o(),()=>window.removeEventListener("scroll",o)},[]);const n=()=>window.scrollTo({top:0,behavior:"smooth"});return x.jsx(Lf,{children:e&&x.jsx(mn.button,{initial:{opacity:0,y:16,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:12},onClick:n,"aria-label":"Back to top",className:"fixed right-6 bottom-6 z-50 rounded-full bg-primary text-primary-foreground shadow-lg p-3 hover:scale-105 focus:outline-none",children:x.jsx(JY,{className:"h-4 w-4"})})})}var ox=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},tT=typeof window>"u"||"Deno"in globalThis;function _l(){}function $se(e,t){return typeof e=="function"?e(t):e}function Vse(e){return typeof e=="number"&&e>=0&&e!==1/0}function Use(e,t){return Math.max(e+(t||0)-Date.now(),0)}function fC(e,t){return typeof e=="function"?e(t):e}function Gse(e,t){return typeof e=="function"?e(t):e}function V3(e,t){const{type:n="all",exact:o,fetchStatus:d,predicate:f,queryKey:_,stale:i}=e;if(_){if(o){if(t.queryHash!==vO(_,t.options))return!1}else if(!c0(t.queryKey,_))return!1}if(n!=="all"){const S=t.isActive();if(n==="active"&&!S||n==="inactive"&&S)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||d&&d!==t.state.fetchStatus||f&&!f(t))}function U3(e,t){const{exact:n,status:o,predicate:d,mutationKey:f}=e;if(f){if(!t.options.mutationKey)return!1;if(n){if(Nf(t.options.mutationKey)!==Nf(f))return!1}else if(!c0(t.options.mutationKey,f))return!1}return!(o&&t.state.status!==o||d&&!d(t))}function vO(e,t){return(t?.queryKeyHashFn||Nf)(e)}function Nf(e){return JSON.stringify(e,(t,n)=>pC(n)?Object.keys(n).sort().reduce((o,d)=>(o[d]=n[d],o),{}):n)}function c0(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>c0(e[n],t[n])):!1}function zU(e,t){if(e===t)return e;const n=G3(e)&&G3(t);if(n||pC(e)&&pC(t)){const o=n?e:Object.keys(e),d=o.length,f=n?t:Object.keys(t),_=f.length,i=n?[]:{},S=new Set(o);let E=0;for(let I=0;I<_;I++){const M=n?I:f[I];(!n&&S.has(M)||n)&&e[M]===void 0&&t[M]===void 0?(i[M]=void 0,E++):(i[M]=zU(e[M],t[M]),i[M]===e[M]&&e[M]!==void 0&&E++)}return d===_&&E===d?e:i}return t}function Hse(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function G3(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function pC(e){if(!H3(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!H3(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function H3(e){return Object.prototype.toString.call(e)==="[object Object]"}function Wse(e){return new Promise(t=>{setTimeout(t,e)})}function qse(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?zU(e,t):t}function Zse(e,t,n=0){const o=[...e,t];return n&&o.length>n?o.slice(1):o}function Kse(e,t,n=0){const o=[t,...e];return n&&o.length>n?o.slice(0,-1):o}var xO=Symbol();function FU(e,t){return!e.queryFn&&t?.initialPromise?()=>t.initialPromise:!e.queryFn||e.queryFn===xO?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function Xse(e,t){return typeof e=="function"?e(...t):!!e}var Yse=class extends ox{#e;#t;#r;constructor(){super(),this.#r=e=>{if(!tT&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(e){this.#e!==e&&(this.#e=e,this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},BU=new Yse,Jse=class extends ox{#e=!0;#t;#r;constructor(){super(),this.#r=e=>{if(!tT&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(e){this.#r=e,this.#t?.(),this.#t=e(this.setOnline.bind(this))}setOnline(e){this.#e!==e&&(this.#e=e,this.listeners.forEach(n=>{n(e)}))}isOnline(){return this.#e}},Aw=new Jse;function Qse(){let e,t;const n=new Promise((d,f)=>{e=d,t=f});n.status="pending",n.catch(()=>{});function o(d){Object.assign(n,d),delete n.resolve,delete n.reject}return n.resolve=d=>{o({status:"fulfilled",value:d}),e(d)},n.reject=d=>{o({status:"rejected",reason:d}),t(d)},n}function eae(e){return Math.min(1e3*2**e,3e4)}function $U(e){return(e??"online")==="online"?Aw.isOnline():!0}var VU=class extends Error{constructor(e){super("CancelledError"),this.revert=e?.revert,this.silent=e?.silent}};function $E(e){return e instanceof VU}function UU(e){let t=!1,n=0,o=!1,d;const f=Qse(),_=z=>{o||(j(new VU(z)),e.abort?.())},i=()=>{t=!0},S=()=>{t=!1},E=()=>BU.isFocused()&&(e.networkMode==="always"||Aw.isOnline())&&e.canRun(),I=()=>$U(e.networkMode)&&e.canRun(),M=z=>{o||(o=!0,e.onSuccess?.(z),d?.(),f.resolve(z))},j=z=>{o||(o=!0,e.onError?.(z),d?.(),f.reject(z))},N=()=>new Promise(z=>{d=V=>{(o||E())&&z(V)},e.onPause?.()}).then(()=>{d=void 0,o||e.onContinue?.()}),G=()=>{if(o)return;let z;const V=n===0?e.initialPromise:void 0;try{z=V??e.fn()}catch(K){z=Promise.reject(K)}Promise.resolve(z).then(M).catch(K=>{if(o)return;const Q=e.retry??(tT?0:3),X=e.retryDelay??eae,ie=typeof X=="function"?X(n,K):X,J=Q===!0||typeof Q=="number"&&n<Q||typeof Q=="function"&&Q(n,K);if(t||!J){j(K);return}n++,e.onFail?.(n,K),Wse(ie).then(()=>E()?void 0:N()).then(()=>{t?j(K):G()})})};return{promise:f,cancel:_,continue:()=>(d?.(),f),cancelRetry:i,continueRetry:S,canStart:I,start:()=>(I()?G():N().then(G),f)}}var tae=e=>setTimeout(e,0);function rae(){let e=[],t=0,n=i=>{i()},o=i=>{i()},d=tae;const f=i=>{t?e.push(i):d(()=>{n(i)})},_=()=>{const i=e;e=[],i.length&&d(()=>{o(()=>{i.forEach(S=>{n(S)})})})};return{batch:i=>{let S;t++;try{S=i()}finally{t--,t||_()}return S},batchCalls:i=>(...S)=>{f(()=>{i(...S)})},schedule:f,setNotifyFunction:i=>{n=i},setBatchNotifyFunction:i=>{o=i},setScheduler:i=>{d=i}}}var Ls=rae(),GU=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Vse(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(tT?1/0:5*60*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},nae=class extends GU{#e;#t;#r;#n;#i;#s;#a;constructor(e){super(),this.#a=!1,this.#s=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#n=e.client,this.#r=this.#n.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=oae(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(e){this.options={...this.#s,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(e,t){const n=qse(this.state.data,e,this.options);return this.#o({data:n,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),n}setState(e,t){this.#o({type:"setState",state:e,setStateOptions:t})}cancel(e){const t=this.#i?.promise;return this.#i?.cancel(e),t?t.then(_l).catch(_l):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Gse(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===xO||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>fC(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!Use(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#i&&(this.#a?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}fetch(e,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(e&&this.setOptions(e),!this.options.queryFn){const S=this.observers.find(E=>E.options.queryFn);S&&this.setOptions(S.options)}const n=new AbortController,o=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},d=()=>{const S=FU(this.options,t),I=(()=>{const M={client:this.#n,queryKey:this.queryKey,meta:this.meta};return o(M),M})();return this.#a=!1,this.options.persister?this.options.persister(S,I,this):S(I)},_=(()=>{const S={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:d};return o(S),S})();this.options.behavior?.onFetch(_,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==_.fetchOptions?.meta)&&this.#o({type:"fetch",meta:_.fetchOptions?.meta});const i=S=>{$E(S)&&S.silent||this.#o({type:"error",error:S}),$E(S)||(this.#r.config.onError?.(S,this),this.#r.config.onSettled?.(this.state.data,S,this)),this.scheduleGc()};return this.#i=UU({initialPromise:t?.initialPromise,fn:_.fetchFn,abort:n.abort.bind(n),onSuccess:S=>{if(S===void 0){i(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(S)}catch(E){i(E);return}this.#r.config.onSuccess?.(S,this),this.#r.config.onSettled?.(S,this.state.error,this),this.scheduleGc()},onError:i,onFail:(S,E)=>{this.#o({type:"failed",failureCount:S,error:E})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:_.options.retry,retryDelay:_.options.retryDelay,networkMode:_.options.networkMode,canRun:()=>!0}),this.#i.start()}#o(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...iae(n.data,this.options),fetchMeta:e.meta??null};case"success":return this.#t=void 0,{...n,data:e.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=e.error;return $E(o)&&o.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...n,error:o,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),Ls.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:e})})}};function iae(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:$U(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function oae(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,o=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?o??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var sae=class extends ox{constructor(e={}){super(),this.config=e,this.#e=new Map}#e;build(e,t,n){const o=t.queryKey,d=t.queryHash??vO(o,t);let f=this.get(d);return f||(f=new nae({client:e,queryKey:o,queryHash:d,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(o)}),this.add(f)),f}add(e){this.#e.has(e.queryHash)||(this.#e.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=this.#e.get(e.queryHash);t&&(e.destroy(),t===e&&this.#e.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ls.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#e.get(e)}getAll(){return[...this.#e.values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>V3(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>V3(e,n)):t}notify(e){Ls.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ls.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ls.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},aae=class extends GU{#e;#t;#r;constructor(e){super(),this.mutationId=e.mutationId,this.#t=e.mutationCache,this.#e=[],this.state=e.state||HU(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#e.includes(e)||(this.#e.push(e),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#e=this.#e.filter(t=>t!==e),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(e){const t=()=>{this.#n({type:"continue"})};this.#r=UU({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(d,f)=>{this.#n({type:"failed",failureCount:d,error:f})},onPause:()=>{this.#n({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const n=this.state.status==="pending",o=!this.#r.canStart();try{if(n)t();else{this.#n({type:"pending",variables:e,isPaused:o}),await this.#t.config.onMutate?.(e,this);const f=await this.options.onMutate?.(e);f!==this.state.context&&this.#n({type:"pending",context:f,variables:e,isPaused:o})}const d=await this.#r.start();return await this.#t.config.onSuccess?.(d,e,this.state.context,this),await this.options.onSuccess?.(d,e,this.state.context),await this.#t.config.onSettled?.(d,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(d,null,e,this.state.context),this.#n({type:"success",data:d}),d}catch(d){try{throw await this.#t.config.onError?.(d,e,this.state.context,this),await this.options.onError?.(d,e,this.state.context),await this.#t.config.onSettled?.(void 0,d,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,d,e,this.state.context),d}finally{this.#n({type:"error",error:d})}}finally{this.#t.runNext(this)}}#n(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Ls.batch(()=>{this.#e.forEach(n=>{n.onMutationUpdate(e)}),this.#t.notify({mutation:this,type:"updated",action:e})})}};function HU(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var lae=class extends ox{constructor(e={}){super(),this.config=e,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(e,t,n){const o=new aae({mutationCache:this,mutationId:++this.#r,options:e.defaultMutationOptions(t),state:n});return this.add(o),o}add(e){this.#e.add(e);const t=C1(e);if(typeof t=="string"){const n=this.#t.get(t);n?n.push(e):this.#t.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#e.delete(e)){const t=C1(e);if(typeof t=="string"){const n=this.#t.get(t);if(n)if(n.length>1){const o=n.indexOf(e);o!==-1&&n.splice(o,1)}else n[0]===e&&this.#t.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=C1(e);if(typeof t=="string"){const o=this.#t.get(t)?.find(d=>d.state.status==="pending");return!o||o===e}else return!0}runNext(e){const t=C1(e);return typeof t=="string"?this.#t.get(t)?.find(o=>o!==e&&o.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Ls.batch(()=>{this.#e.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(e){const t={exact:!0,...e};return this.getAll().find(n=>U3(t,n))}findAll(e={}){return this.getAll().filter(t=>U3(e,t))}notify(e){Ls.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Ls.batch(()=>Promise.all(e.map(t=>t.continue().catch(_l))))}};function C1(e){return e.options.scope?.id}function W3(e){return{onFetch:(t,n)=>{const o=t.options,d=t.fetchOptions?.meta?.fetchMore?.direction,f=t.state.data?.pages||[],_=t.state.data?.pageParams||[];let i={pages:[],pageParams:[]},S=0;const E=async()=>{let I=!1;const M=G=>{Object.defineProperty(G,"signal",{enumerable:!0,get:()=>(t.signal.aborted?I=!0:t.signal.addEventListener("abort",()=>{I=!0}),t.signal)})},j=FU(t.options,t.fetchOptions),N=async(G,z,V)=>{if(I)return Promise.reject();if(z==null&&G.pages.length)return Promise.resolve(G);const Q=(()=>{const se={client:t.client,queryKey:t.queryKey,pageParam:z,direction:V?"backward":"forward",meta:t.options.meta};return M(se),se})(),X=await j(Q),{maxPages:ie}=t.options,J=V?Kse:Zse;return{pages:J(G.pages,X,ie),pageParams:J(G.pageParams,z,ie)}};if(d&&f.length){const G=d==="backward",z=G?cae:q3,V={pages:f,pageParams:_},K=z(o,V);i=await N(V,K,G)}else{const G=e??f.length;do{const z=S===0?_[0]??o.initialPageParam:q3(o,i);if(S>0&&z==null)break;i=await N(i,z),S++}while(S<G)}return i};t.options.persister?t.fetchFn=()=>t.options.persister?.(E,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n):t.fetchFn=E}}}function q3(e,{pages:t,pageParams:n}){const o=t.length-1;return t.length>0?e.getNextPageParam(t[o],t,n[o],n):void 0}function cae(e,{pages:t,pageParams:n}){return t.length>0?e.getPreviousPageParam?.(t[0],t,n[0],n):void 0}var uae=class{#e;#t;#r;#n;#i;#s;#a;#o;constructor(e={}){this.#e=e.queryCache||new sae,this.#t=e.mutationCache||new lae,this.#r=e.defaultOptions||{},this.#n=new Map,this.#i=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#a=BU.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=Aw.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#a?.(),this.#a=void 0,this.#o?.(),this.#o=void 0)}isFetching(e){return this.#e.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#t.findAll({...e,status:"pending"}).length}getQueryData(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=this.#e.build(this,t),o=n.state.data;return o===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(fC(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(o))}getQueriesData(e){return this.#e.findAll(e).map(({queryKey:t,state:n})=>{const o=n.data;return[t,o]})}setQueryData(e,t,n){const o=this.defaultQueryOptions({queryKey:e}),f=this.#e.get(o.queryHash)?.state.data,_=$se(t,f);if(_!==void 0)return this.#e.build(this,o).setData(_,{...n,manual:!0})}setQueriesData(e,t,n){return Ls.batch(()=>this.#e.findAll(e).map(({queryKey:o})=>[o,this.setQueryData(o,t,n)]))}getQueryState(e){const t=this.defaultQueryOptions({queryKey:e});return this.#e.get(t.queryHash)?.state}removeQueries(e){const t=this.#e;Ls.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=this.#e;return Ls.batch(()=>(n.findAll(e).forEach(o=>{o.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},o=Ls.batch(()=>this.#e.findAll(e).map(d=>d.cancel(n)));return Promise.all(o).then(_l).catch(_l)}invalidateQueries(e,t={}){return Ls.batch(()=>(this.#e.findAll(e).forEach(n=>{n.invalidate()}),e?.refetchType==="none"?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},o=Ls.batch(()=>this.#e.findAll(e).filter(d=>!d.isDisabled()&&!d.isStatic()).map(d=>{let f=d.fetch(void 0,n);return n.throwOnError||(f=f.catch(_l)),d.state.fetchStatus==="paused"?Promise.resolve():f}));return Promise.all(o).then(_l)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=this.#e.build(this,t);return n.isStaleByTime(fC(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(_l).catch(_l)}fetchInfiniteQuery(e){return e.behavior=W3(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(_l).catch(_l)}ensureInfiniteQueryData(e){return e.behavior=W3(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Aw.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(e){this.#r=e}setQueryDefaults(e,t){this.#n.set(Nf(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...this.#n.values()],n={};return t.forEach(o=>{c0(e,o.queryKey)&&Object.assign(n,o.defaultOptions)}),n}setMutationDefaults(e,t){this.#i.set(Nf(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...this.#i.values()],n={};return t.forEach(o=>{c0(e,o.mutationKey)&&Object.assign(n,o.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...this.#r.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=vO(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===xO&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#r.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},dae=class extends ox{#e;#t=void 0;#r;#n;constructor(t,n){super(),this.#e=t,this.setOptions(n),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const n=this.options;this.options=this.#e.defaultMutationOptions(t),Hse(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&Nf(n.mutationKey)!==Nf(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#s(t)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#s()}mutate(t,n){return this.#n=n,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(t)}#i(){const t=this.#r?.state??HU();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#s(t){Ls.batch(()=>{if(this.#n&&this.hasListeners()){const n=this.#t.variables,o=this.#t.context;t?.type==="success"?(this.#n.onSuccess?.(t.data,n,o),this.#n.onSettled?.(t.data,null,n,o)):t?.type==="error"&&(this.#n.onError?.(t.error,n,o),this.#n.onSettled?.(void 0,t.error,n,o))}this.listeners.forEach(n=>{n(this.#t)})})}},WU=B.createContext(void 0),qU=e=>{const t=B.useContext(WU);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},hae=({client:e,children:t})=>(B.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),x.jsx(WU.Provider,{value:e,children:t}));function fae(e,t){const n=qU(),[o]=B.useState(()=>new dae(n,e));B.useEffect(()=>{o.setOptions(e)},[o,e]);const d=B.useSyncExternalStore(B.useCallback(_=>o.subscribe(Ls.batchCalls(_)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),f=B.useCallback((_,i)=>{o.mutate(_,i).catch(_l)},[o]);if(d.error&&Xse(o.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:f,mutateAsync:d.mutate}}/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function u0(){return u0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u0.apply(this,arguments)}var Wd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Wd||(Wd={}));const Z3="popstate";function pae(e){e===void 0&&(e={});function t(d,f){let{pathname:_="/",search:i="",hash:S=""}=Qf(d.location.hash.substr(1));return!_.startsWith("/")&&!_.startsWith(".")&&(_="/"+_),mC("",{pathname:_,search:i,hash:S},f.state&&f.state.usr||null,f.state&&f.state.key||"default")}function n(d,f){let _=d.document.querySelector("base"),i="";if(_&&_.getAttribute("href")){let S=d.location.href,E=S.indexOf("#");i=E===-1?S:S.slice(0,E)}return i+"#"+(typeof f=="string"?f:Ew(f))}function o(d,f){rT(d.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(f)+")")}return gae(t,n,o,e)}function Bo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function rT(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function mae(){return Math.random().toString(36).substr(2,8)}function K3(e,t){return{usr:e.state,key:e.key,idx:t}}function mC(e,t,n,o){return n===void 0&&(n=null),u0({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Qf(t):t,{state:n,key:t&&t.key||o||mae()})}function Ew(e){let{pathname:t="/",search:n="",hash:o=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),o&&o!=="#"&&(t+=o.charAt(0)==="#"?o:"#"+o),t}function Qf(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}function gae(e,t,n,o){o===void 0&&(o={});let{window:d=document.defaultView,v5Compat:f=!1}=o,_=d.history,i=Wd.Pop,S=null,E=I();E==null&&(E=0,_.replaceState(u0({},_.state,{idx:E}),""));function I(){return(_.state||{idx:null}).idx}function M(){i=Wd.Pop;let V=I(),K=V==null?null:V-E;E=V,S&&S({action:i,location:z.location,delta:K})}function j(V,K){i=Wd.Push;let Q=mC(z.location,V,K);n&&n(Q,V),E=I()+1;let X=K3(Q,E),ie=z.createHref(Q);try{_.pushState(X,"",ie)}catch(J){if(J instanceof DOMException&&J.name==="DataCloneError")throw J;d.location.assign(ie)}f&&S&&S({action:i,location:z.location,delta:1})}function N(V,K){i=Wd.Replace;let Q=mC(z.location,V,K);n&&n(Q,V),E=I();let X=K3(Q,E),ie=z.createHref(Q);_.replaceState(X,"",ie),f&&S&&S({action:i,location:z.location,delta:0})}function G(V){let K=d.location.origin!=="null"?d.location.origin:d.location.href,Q=typeof V=="string"?V:Ew(V);return Q=Q.replace(/ $/,"%20"),Bo(K,"No window.location.(origin|href) available to create URL for href: "+Q),new URL(Q,K)}let z={get action(){return i},get location(){return e(d,_)},listen(V){if(S)throw new Error("A history only accepts one active listener");return d.addEventListener(Z3,M),S=V,()=>{d.removeEventListener(Z3,M),S=null}},createHref(V){return t(d,V)},createURL:G,encodeLocation(V){let K=G(V);return{pathname:K.pathname,search:K.search,hash:K.hash}},push:j,replace:N,go(V){return _.go(V)}};return z}var X3;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(X3||(X3={}));function yae(e,t,n){return n===void 0&&(n="/"),_ae(e,t,n,!1)}function _ae(e,t,n,o){let d=typeof t=="string"?Qf(t):t,f=Pg(d.pathname||"/",n);if(f==null)return null;let _=ZU(e);vae(_);let i=null;for(let S=0;i==null&&S<_.length;++S){let E=Mae(f);i=Cae(_[S],E,o)}return i}function ZU(e,t,n,o){t===void 0&&(t=[]),n===void 0&&(n=[]),o===void 0&&(o="");let d=(f,_,i)=>{let S={relativePath:i===void 0?f.path||"":i,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};S.relativePath.startsWith("/")&&(Bo(S.relativePath.startsWith(o),'Absolute route path "'+S.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),S.relativePath=S.relativePath.slice(o.length));let E=Zd([o,S.relativePath]),I=n.concat(S);f.children&&f.children.length>0&&(Bo(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+E+'".')),ZU(f.children,t,I,E)),!(f.path==null&&!f.index)&&t.push({path:E,score:Eae(E,f.index),routesMeta:I})};return e.forEach((f,_)=>{var i;if(f.path===""||!((i=f.path)!=null&&i.includes("?")))d(f,_);else for(let S of KU(f.path))d(f,_,S)}),t}function KU(e){let t=e.split("/");if(t.length===0)return[];let[n,...o]=t,d=n.endsWith("?"),f=n.replace(/\?$/,"");if(o.length===0)return d?[f,""]:[f];let _=KU(o.join("/")),i=[];return i.push(..._.map(S=>S===""?f:[f,S].join("/"))),d&&i.push(..._),i.map(S=>e.startsWith("/")&&S===""?"/":S)}function vae(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:Pae(t.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}const xae=/^:[\w-]+$/,bae=3,wae=2,Sae=1,Tae=10,Aae=-2,Y3=e=>e==="*";function Eae(e,t){let n=e.split("/"),o=n.length;return n.some(Y3)&&(o+=Aae),t&&(o+=wae),n.filter(d=>!Y3(d)).reduce((d,f)=>d+(xae.test(f)?bae:f===""?Sae:Tae),o)}function Pae(e,t){return e.length===t.length&&e.slice(0,-1).every((o,d)=>o===t[d])?e[e.length-1]-t[t.length-1]:0}function Cae(e,t,n){let{routesMeta:o}=e,d={},f="/",_=[];for(let i=0;i<o.length;++i){let S=o[i],E=i===o.length-1,I=f==="/"?t:t.slice(f.length)||"/",M=Pw({path:S.relativePath,caseSensitive:S.caseSensitive,end:E},I),j=S.route;if(!M&&E&&n&&!o[o.length-1].route.index&&(M=Pw({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},I)),!M)return null;Object.assign(d,M.params),_.push({params:d,pathname:Zd([f,M.pathname]),pathnameBase:Dae(Zd([f,M.pathnameBase])),route:j}),M.pathnameBase!=="/"&&(f=Zd([f,M.pathnameBase]))}return _}function Pw(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,o]=Iae(e.path,e.caseSensitive,e.end),d=t.match(n);if(!d)return null;let f=d[0],_=f.replace(/(.)\/+$/,"$1"),i=d.slice(1);return{params:o.reduce((E,I,M)=>{let{paramName:j,isOptional:N}=I;if(j==="*"){let z=i[M]||"";_=f.slice(0,f.length-z.length).replace(/(.)\/+$/,"$1")}const G=i[M];return N&&!G?E[j]=void 0:E[j]=(G||"").replace(/%2F/g,"/"),E},{}),pathname:f,pathnameBase:_,pattern:e}}function Iae(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),rT(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let o=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,i,S)=>(o.push({paramName:i,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(o.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,t?void 0:"i"),o]}function Mae(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return rT(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Pg(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,o=e.charAt(n);return o&&o!=="/"?null:e.slice(n)||"/"}const Oae=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rae=e=>Oae.test(e);function kae(e,t){t===void 0&&(t="/");let{pathname:n,search:o="",hash:d=""}=typeof e=="string"?Qf(e):e,f;if(n)if(Rae(n))f=n;else{if(n.includes("//")){let _=n;n=n.replace(/\/\/+/g,"/"),rT(!1,"Pathnames cannot have embedded double slashes - normalizing "+(_+" -> "+n))}n.startsWith("/")?f=J3(n.substring(1),"/"):f=J3(n,t)}else f=t;return{pathname:f,search:Lae(o),hash:Nae(d)}}function J3(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?n.length>1&&n.pop():d!=="."&&n.push(d)}),n.length>1?n.join("/"):"/"}function VE(e,t,n,o){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jae(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function XU(e,t){let n=jae(e);return t?n.map((o,d)=>d===n.length-1?o.pathname:o.pathnameBase):n.map(o=>o.pathnameBase)}function YU(e,t,n,o){o===void 0&&(o=!1);let d;typeof e=="string"?d=Qf(e):(d=u0({},e),Bo(!d.pathname||!d.pathname.includes("?"),VE("?","pathname","search",d)),Bo(!d.pathname||!d.pathname.includes("#"),VE("#","pathname","hash",d)),Bo(!d.search||!d.search.includes("#"),VE("#","search","hash",d)));let f=e===""||d.pathname==="",_=f?"/":d.pathname,i;if(_==null)i=n;else{let M=t.length-1;if(!o&&_.startsWith("..")){let j=_.split("/");for(;j[0]==="..";)j.shift(),M-=1;d.pathname=j.join("/")}i=M>=0?t[M]:"/"}let S=kae(d,i),E=_&&_!=="/"&&_.endsWith("/"),I=(f||_===".")&&n.endsWith("/");return!S.pathname.endsWith("/")&&(E||I)&&(S.pathname+="/"),S}const Zd=e=>e.join("/").replace(/\/\/+/g,"/"),Dae=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Lae=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Nae=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function zae(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const JU=["post","put","patch","delete"];new Set(JU);const Fae=["get",...JU];new Set(Fae);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function d0(){return d0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},d0.apply(this,arguments)}const nT=B.createContext(null),QU=B.createContext(null),oh=B.createContext(null),iT=B.createContext(null),Ju=B.createContext({outlet:null,matches:[],isDataRoute:!1}),e6=B.createContext(null);function Bae(e,t){let{relative:n}=t===void 0?{}:t;sx()||Bo(!1);let{basename:o,navigator:d}=B.useContext(oh),{hash:f,pathname:_,search:i}=oT(e,{relative:n}),S=_;return o!=="/"&&(S=_==="/"?o:Zd([o,_])),d.createHref({pathname:S,search:i,hash:f})}function sx(){return B.useContext(iT)!=null}function mc(){return sx()||Bo(!1),B.useContext(iT).location}function t6(e){B.useContext(oh).static||B.useLayoutEffect(e)}function uy(){let{isDataRoute:e}=B.useContext(Ju);return e?tle():$ae()}function $ae(){sx()||Bo(!1);let e=B.useContext(nT),{basename:t,future:n,navigator:o}=B.useContext(oh),{matches:d}=B.useContext(Ju),{pathname:f}=mc(),_=JSON.stringify(XU(d,n.v7_relativeSplatPath)),i=B.useRef(!1);return t6(()=>{i.current=!0}),B.useCallback(function(E,I){if(I===void 0&&(I={}),!i.current)return;if(typeof E=="number"){o.go(E);return}let M=YU(E,JSON.parse(_),f,I.relative==="path");e==null&&t!=="/"&&(M.pathname=M.pathname==="/"?t:Zd([t,M.pathname])),(I.replace?o.replace:o.push)(M,I.state,I)},[t,o,_,f,e])}const Vae=B.createContext(null);function Uae(e){let t=B.useContext(Ju).outlet;return t&&B.createElement(Vae.Provider,{value:e},t)}function r6(){let{matches:e}=B.useContext(Ju),t=e[e.length-1];return t?t.params:{}}function oT(e,t){let{relative:n}=t===void 0?{}:t,{future:o}=B.useContext(oh),{matches:d}=B.useContext(Ju),{pathname:f}=mc(),_=JSON.stringify(XU(d,o.v7_relativeSplatPath));return B.useMemo(()=>YU(e,JSON.parse(_),f,n==="path"),[e,_,f,n])}function Gae(e,t){return Hae(e,t)}function Hae(e,t,n,o){sx()||Bo(!1);let{navigator:d}=B.useContext(oh),{matches:f}=B.useContext(Ju),_=f[f.length-1],i=_?_.params:{};_&&_.pathname;let S=_?_.pathnameBase:"/";_&&_.route;let E=mc(),I;if(t){var M;let V=typeof t=="string"?Qf(t):t;S==="/"||(M=V.pathname)!=null&&M.startsWith(S)||Bo(!1),I=V}else I=E;let j=I.pathname||"/",N=j;if(S!=="/"){let V=S.replace(/^\//,"").split("/");N="/"+j.replace(/^\//,"").split("/").slice(V.length).join("/")}let G=yae(e,{pathname:N}),z=Xae(G&&G.map(V=>Object.assign({},V,{params:Object.assign({},i,V.params),pathname:Zd([S,d.encodeLocation?d.encodeLocation(V.pathname).pathname:V.pathname]),pathnameBase:V.pathnameBase==="/"?S:Zd([S,d.encodeLocation?d.encodeLocation(V.pathnameBase).pathname:V.pathnameBase])})),f,n,o);return t&&z?B.createElement(iT.Provider,{value:{location:d0({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:Wd.Pop}},z):z}function Wae(){let e=ele(),t=zae(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},t),n?B.createElement("pre",{style:d},n):null,null)}const qae=B.createElement(Wae,null);class Zae extends B.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?B.createElement(Ju.Provider,{value:this.props.routeContext},B.createElement(e6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Kae(e){let{routeContext:t,match:n,children:o}=e,d=B.useContext(nT);return d&&d.static&&d.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=n.route.id),B.createElement(Ju.Provider,{value:t},o)}function Xae(e,t,n,o){var d;if(t===void 0&&(t=[]),n===void 0&&(n=null),o===void 0&&(o=null),e==null){var f;if(!n)return null;if(n.errors)e=n.matches;else if((f=o)!=null&&f.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let _=e,i=(d=n)==null?void 0:d.errors;if(i!=null){let I=_.findIndex(M=>M.route.id&&i?.[M.route.id]!==void 0);I>=0||Bo(!1),_=_.slice(0,Math.min(_.length,I+1))}let S=!1,E=-1;if(n&&o&&o.v7_partialHydration)for(let I=0;I<_.length;I++){let M=_[I];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(E=I),M.route.id){let{loaderData:j,errors:N}=n,G=M.route.loader&&j[M.route.id]===void 0&&(!N||N[M.route.id]===void 0);if(M.route.lazy||G){S=!0,E>=0?_=_.slice(0,E+1):_=[_[0]];break}}}return _.reduceRight((I,M,j)=>{let N,G=!1,z=null,V=null;n&&(N=i&&M.route.id?i[M.route.id]:void 0,z=M.route.errorElement||qae,S&&(E<0&&j===0?(G=!0,V=null):E===j&&(G=!0,V=M.route.hydrateFallbackElement||null)));let K=t.concat(_.slice(0,j+1)),Q=()=>{let X;return N?X=z:G?X=V:M.route.Component?X=B.createElement(M.route.Component,null):M.route.element?X=M.route.element:X=I,B.createElement(Kae,{match:M,routeContext:{outlet:I,matches:K,isDataRoute:n!=null},children:X})};return n&&(M.route.ErrorBoundary||M.route.errorElement||j===0)?B.createElement(Zae,{location:n.location,revalidation:n.revalidation,component:z,error:N,children:Q(),routeContext:{outlet:null,matches:K,isDataRoute:!0}}):Q()},null)}var n6=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(n6||{}),Cw=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Cw||{});function Yae(e){let t=B.useContext(nT);return t||Bo(!1),t}function Jae(e){let t=B.useContext(QU);return t||Bo(!1),t}function Qae(e){let t=B.useContext(Ju);return t||Bo(!1),t}function i6(e){let t=Qae(),n=t.matches[t.matches.length-1];return n.route.id||Bo(!1),n.route.id}function ele(){var e;let t=B.useContext(e6),n=Jae(Cw.UseRouteError),o=i6(Cw.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[o]}function tle(){let{router:e}=Yae(n6.UseNavigateStable),t=i6(Cw.UseNavigateStable),n=B.useRef(!1);return t6(()=>{n.current=!0}),B.useCallback(function(d,f){f===void 0&&(f={}),n.current&&(typeof d=="number"?e.navigate(d):e.navigate(d,d0({fromRouteId:t},f)))},[e,t])}function rle(e,t){e?.v7_startTransition,e?.v7_relativeSplatPath}function nle(e){return Uae(e.context)}function es(e){Bo(!1)}function ile(e){let{basename:t="/",children:n=null,location:o,navigationType:d=Wd.Pop,navigator:f,static:_=!1,future:i}=e;sx()&&Bo(!1);let S=t.replace(/^\/*/,"/"),E=B.useMemo(()=>({basename:S,navigator:f,static:_,future:d0({v7_relativeSplatPath:!1},i)}),[S,i,f,_]);typeof o=="string"&&(o=Qf(o));let{pathname:I="/",search:M="",hash:j="",state:N=null,key:G="default"}=o,z=B.useMemo(()=>{let V=Pg(I,S);return V==null?null:{location:{pathname:V,search:M,hash:j,state:N,key:G},navigationType:d}},[S,I,M,j,N,G,d]);return z==null?null:B.createElement(oh.Provider,{value:E},B.createElement(iT.Provider,{children:n,value:z}))}function ole(e){let{children:t,location:n}=e;return Gae(gC(t),n)}new Promise(()=>{});function gC(e,t){t===void 0&&(t=[]);let n=[];return B.Children.forEach(e,(o,d)=>{if(!B.isValidElement(o))return;let f=[...t,d];if(o.type===B.Fragment){n.push.apply(n,gC(o.props.children,f));return}o.type!==es&&Bo(!1),!o.props.index||!o.props.children||Bo(!1);let _={id:o.props.id||f.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(_.children=gC(o.props.children,f)),n.push(_)}),n}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Iw(){return Iw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Iw.apply(this,arguments)}function o6(e,t){if(e==null)return{};var n={},o=Object.keys(e),d,f;for(f=0;f<o.length;f++)d=o[f],!(t.indexOf(d)>=0)&&(n[d]=e[d]);return n}function sle(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function ale(e,t){return e.button===0&&(!t||t==="_self")&&!sle(e)}const lle=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],cle=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],ule="6";try{window.__reactRouterVersion=ule}catch{}const dle=B.createContext({isTransitioning:!1}),hle="startTransition",Q3=gM[hle];function fle(e){let{basename:t,children:n,future:o,window:d}=e,f=B.useRef();f.current==null&&(f.current=pae({window:d,v5Compat:!0}));let _=f.current,[i,S]=B.useState({action:_.action,location:_.location}),{v7_startTransition:E}=o||{},I=B.useCallback(M=>{E&&Q3?Q3(()=>S(M)):S(M)},[S,E]);return B.useLayoutEffect(()=>_.listen(I),[_,I]),B.useEffect(()=>rle(o),[o]),B.createElement(ile,{basename:t,children:n,location:i.location,navigationType:i.action,navigator:_,future:o})}const ple=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",mle=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ps=B.forwardRef(function(t,n){let{onClick:o,relative:d,reloadDocument:f,replace:_,state:i,target:S,to:E,preventScrollReset:I,viewTransition:M}=t,j=o6(t,lle),{basename:N}=B.useContext(oh),G,z=!1;if(typeof E=="string"&&mle.test(E)&&(G=E,ple))try{let X=new URL(window.location.href),ie=E.startsWith("//")?new URL(X.protocol+E):new URL(E),J=Pg(ie.pathname,N);ie.origin===X.origin&&J!=null?E=J+ie.search+ie.hash:z=!0}catch{}let V=Bae(E,{relative:d}),K=yle(E,{replace:_,state:i,target:S,preventScrollReset:I,relative:d,viewTransition:M});function Q(X){o&&o(X),X.defaultPrevented||K(X)}return B.createElement("a",Iw({},j,{href:G||V,onClick:z||f?o:Q,ref:n,target:S}))}),bO=B.forwardRef(function(t,n){let{"aria-current":o="page",caseSensitive:d=!1,className:f="",end:_=!1,style:i,to:S,viewTransition:E,children:I}=t,M=o6(t,cle),j=oT(S,{relative:M.relative}),N=mc(),G=B.useContext(QU),{navigator:z,basename:V}=B.useContext(oh),K=G!=null&&_le(j)&&E===!0,Q=z.encodeLocation?z.encodeLocation(j).pathname:j.pathname,X=N.pathname,ie=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;d||(X=X.toLowerCase(),ie=ie?ie.toLowerCase():null,Q=Q.toLowerCase()),ie&&V&&(ie=Pg(ie,V)||ie);const J=Q!=="/"&&Q.endsWith("/")?Q.length-1:Q.length;let se=X===Q||!_&&X.startsWith(Q)&&X.charAt(J)==="/",he=ie!=null&&(ie===Q||!_&&ie.startsWith(Q)&&ie.charAt(Q.length)==="/"),we={isActive:se,isPending:he,isTransitioning:K},ze=se?o:void 0,je;typeof f=="function"?je=f(we):je=[f,se?"active":null,he?"pending":null,K?"transitioning":null].filter(Boolean).join(" ");let Oe=typeof i=="function"?i(we):i;return B.createElement(ps,Iw({},M,{"aria-current":ze,className:je,ref:n,style:Oe,to:S,viewTransition:E}),typeof I=="function"?I(we):I)});var yC;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(yC||(yC={}));var ez;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(ez||(ez={}));function gle(e){let t=B.useContext(nT);return t||Bo(!1),t}function yle(e,t){let{target:n,replace:o,state:d,preventScrollReset:f,relative:_,viewTransition:i}=t===void 0?{}:t,S=uy(),E=mc(),I=oT(e,{relative:_});return B.useCallback(M=>{if(ale(M,n)){M.preventDefault();let j=o!==void 0?o:Ew(E)===Ew(I);S(e,{replace:j,state:d,preventScrollReset:f,relative:_,viewTransition:i})}},[E,S,I,o,d,n,e,f,_,i])}function _le(e,t){t===void 0&&(t={});let n=B.useContext(dle);n==null&&Bo(!1);let{basename:o}=gle(yC.useViewTransitionState),d=oT(e,{relative:t.relative});if(!n.isTransitioning)return!1;let f=Pg(n.currentLocation.pathname,o)||n.currentLocation.pathname,_=Pg(n.nextLocation.pathname,o)||n.nextLocation.pathname;return Pw(d.pathname,_)!=null||Pw(d.pathname,f)!=null}var vle=typeof Element<"u",xle=typeof Map=="function",ble=typeof Set=="function",wle=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function sw(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,o,d;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(o=n;o--!==0;)if(!sw(e[o],t[o]))return!1;return!0}var f;if(xle&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(f=e.entries();!(o=f.next()).done;)if(!t.has(o.value[0]))return!1;for(f=e.entries();!(o=f.next()).done;)if(!sw(o.value[1],t.get(o.value[0])))return!1;return!0}if(ble&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(f=e.entries();!(o=f.next()).done;)if(!t.has(o.value[0]))return!1;return!0}if(wle&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(o=n;o--!==0;)if(e[o]!==t[o])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(d=Object.keys(e),n=d.length,n!==Object.keys(t).length)return!1;for(o=n;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,d[o]))return!1;if(vle&&e instanceof Element)return!1;for(o=n;o--!==0;)if(!((d[o]==="_owner"||d[o]==="__v"||d[o]==="__o")&&e.$$typeof)&&!sw(e[d[o]],t[d[o]]))return!1;return!0}return e!==e&&t!==t}var Sle=function(t,n){try{return sw(t,n)}catch(o){if((o.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw o}};const Tle=Ni(Sle);var Ale=function(e,t,n,o,d,f,_,i){if(!e){var S;if(t===void 0)S=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var E=[n,o,d,f,_,i],I=0;S=new Error(t.replace(/%s/g,function(){return E[I++]})),S.name="Invariant Violation"}throw S.framesToPop=1,S}},Ele=Ale;const tz=Ni(Ele);var Ple=function(t,n,o,d){var f=o?o.call(d,t,n):void 0;if(f!==void 0)return!!f;if(t===n)return!0;if(typeof t!="object"||!t||typeof n!="object"||!n)return!1;var _=Object.keys(t),i=Object.keys(n);if(_.length!==i.length)return!1;for(var S=Object.prototype.hasOwnProperty.bind(n),E=0;E<_.length;E++){var I=_[E];if(!S(I))return!1;var M=t[I],j=n[I];if(f=o?o.call(d,M,j,I):void 0,f===!1||f===void 0&&M!==j)return!1}return!0};const Cle=Ni(Ple);var s6=(e=>(e.BASE="base",e.BODY="body",e.HEAD="head",e.HTML="html",e.LINK="link",e.META="meta",e.NOSCRIPT="noscript",e.SCRIPT="script",e.STYLE="style",e.TITLE="title",e.FRAGMENT="Symbol(react.fragment)",e))(s6||{}),UE={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},rz=Object.values(s6),wO={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},Ile=Object.entries(wO).reduce((e,[t,n])=>(e[n]=t,e),{}),ac="data-rh",mg={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},gg=(e,t)=>{for(let n=e.length-1;n>=0;n-=1){const o=e[n];if(Object.prototype.hasOwnProperty.call(o,t))return o[t]}return null},Mle=e=>{let t=gg(e,"title");const n=gg(e,mg.TITLE_TEMPLATE);if(Array.isArray(t)&&(t=t.join("")),n&&t)return n.replace(/%s/g,()=>t);const o=gg(e,mg.DEFAULT_TITLE);return t||o||void 0},Ole=e=>gg(e,mg.ON_CHANGE_CLIENT_STATE)||(()=>{}),GE=(e,t)=>t.filter(n=>typeof n[e]<"u").map(n=>n[e]).reduce((n,o)=>({...n,...o}),{}),Rle=(e,t)=>t.filter(n=>typeof n.base<"u").map(n=>n.base).reverse().reduce((n,o)=>{if(!n.length){const d=Object.keys(o);for(let f=0;f<d.length;f+=1){const i=d[f].toLowerCase();if(e.indexOf(i)!==-1&&o[i])return n.concat(o)}}return n},[]),kle=e=>console&&typeof console.warn=="function"&&console.warn(e),Ev=(e,t,n)=>{const o={};return n.filter(d=>Array.isArray(d[e])?!0:(typeof d[e]<"u"&&kle(`Helmet: ${e} should be of type "Array". Instead found type "${typeof d[e]}"`),!1)).map(d=>d[e]).reverse().reduce((d,f)=>{const _={};f.filter(S=>{let E;const I=Object.keys(S);for(let j=0;j<I.length;j+=1){const N=I[j],G=N.toLowerCase();t.indexOf(G)!==-1&&!(E==="rel"&&S[E].toLowerCase()==="canonical")&&!(G==="rel"&&S[G].toLowerCase()==="stylesheet")&&(E=G),t.indexOf(N)!==-1&&(N==="innerHTML"||N==="cssText"||N==="itemprop")&&(E=N)}if(!E||!S[E])return!1;const M=S[E].toLowerCase();return o[E]||(o[E]={}),_[E]||(_[E]={}),o[E][M]?!1:(_[E][M]=!0,!0)}).reverse().forEach(S=>d.push(S));const i=Object.keys(_);for(let S=0;S<i.length;S+=1){const E=i[S],I={...o[E],..._[E]};o[E]=I}return d},[]).reverse()},jle=(e,t)=>{if(Array.isArray(e)&&e.length){for(let n=0;n<e.length;n+=1)if(e[n][t])return!0}return!1},Dle=e=>({baseTag:Rle(["href"],e),bodyAttributes:GE("bodyAttributes",e),defer:gg(e,mg.DEFER),encode:gg(e,mg.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:GE("htmlAttributes",e),linkTags:Ev("link",["rel","href"],e),metaTags:Ev("meta",["name","charset","http-equiv","property","itemprop"],e),noscriptTags:Ev("noscript",["innerHTML"],e),onChangeClientState:Ole(e),scriptTags:Ev("script",["src","innerHTML"],e),styleTags:Ev("style",["cssText"],e),title:Mle(e),titleAttributes:GE("titleAttributes",e),prioritizeSeoTags:jle(e,mg.PRIORITIZE_SEO_TAGS)}),a6=e=>Array.isArray(e)?e.join(""):e,Lle=(e,t)=>{const n=Object.keys(e);for(let o=0;o<n.length;o+=1)if(t[n[o]]&&t[n[o]].includes(e[n[o]]))return!0;return!1},HE=(e,t)=>Array.isArray(e)?e.reduce((n,o)=>(Lle(o,t)?n.priority.push(o):n.default.push(o),n),{priority:[],default:[]}):{default:e,priority:[]},nz=(e,t)=>({...e,[t]:void 0}),Nle=["noscript","script","style"],_C=(e,t=!0)=>t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),l6=e=>Object.keys(e).reduce((t,n)=>{const o=typeof e[n]<"u"?`${n}="${e[n]}"`:`${n}`;return t?`${t} ${o}`:o},""),zle=(e,t,n,o)=>{const d=l6(n),f=a6(t);return d?`<${e} ${ac}="true" ${d}>${_C(f,o)}</${e}>`:`<${e} ${ac}="true">${_C(f,o)}</${e}>`},Fle=(e,t,n=!0)=>t.reduce((o,d)=>{const f=d,_=Object.keys(f).filter(E=>!(E==="innerHTML"||E==="cssText")).reduce((E,I)=>{const M=typeof f[I]>"u"?I:`${I}="${_C(f[I],n)}"`;return E?`${E} ${M}`:M},""),i=f.innerHTML||f.cssText||"",S=Nle.indexOf(e)===-1;return`${o}<${e} ${ac}="true" ${_}${S?"/>":`>${i}</${e}>`}`},""),c6=(e,t={})=>Object.keys(e).reduce((n,o)=>{const d=wO[o];return n[d||o]=e[o],n},t),Ble=(e,t,n)=>{const o={key:t,[ac]:!0},d=c6(n,o);return[Le.createElement("title",d,t)]},aw=(e,t)=>t.map((n,o)=>{const d={key:o,[ac]:!0};return Object.keys(n).forEach(f=>{const i=wO[f]||f;if(i==="innerHTML"||i==="cssText"){const S=n.innerHTML||n.cssText;d.dangerouslySetInnerHTML={__html:S}}else d[i]=n[f]}),Le.createElement(e,d)}),yl=(e,t,n=!0)=>{switch(e){case"title":return{toComponent:()=>Ble(e,t.title,t.titleAttributes),toString:()=>zle(e,t.title,t.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>c6(t),toString:()=>l6(t)};default:return{toComponent:()=>aw(e,t),toString:()=>Fle(e,t,n)}}},$le=({metaTags:e,linkTags:t,scriptTags:n,encode:o})=>{const d=HE(e,UE.meta),f=HE(t,UE.link),_=HE(n,UE.script);return{priorityMethods:{toComponent:()=>[...aw("meta",d.priority),...aw("link",f.priority),...aw("script",_.priority)],toString:()=>`${yl("meta",d.priority,o)} ${yl("link",f.priority,o)} ${yl("script",_.priority,o)}`},metaTags:d.default,linkTags:f.default,scriptTags:_.default}},Vle=e=>{const{baseTag:t,bodyAttributes:n,encode:o=!0,htmlAttributes:d,noscriptTags:f,styleTags:_,title:i="",titleAttributes:S,prioritizeSeoTags:E}=e;let{linkTags:I,metaTags:M,scriptTags:j}=e,N={toComponent:()=>{},toString:()=>""};return E&&({priorityMethods:N,linkTags:I,metaTags:M,scriptTags:j}=$le(e)),{priority:N,base:yl("base",t,o),bodyAttributes:yl("bodyAttributes",n,o),htmlAttributes:yl("htmlAttributes",d,o),link:yl("link",I,o),meta:yl("meta",M,o),noscript:yl("noscript",f,o),script:yl("script",j,o),style:yl("style",_,o),title:yl("title",{title:i,titleAttributes:S},o)}},vC=Vle,I1=[],u6=!!(typeof window<"u"&&window.document&&window.document.createElement),xC=class{instances=[];canUseDOM=u6;context;value={setHelmet:e=>{this.context.helmet=e},helmetInstances:{get:()=>this.canUseDOM?I1:this.instances,add:e=>{(this.canUseDOM?I1:this.instances).push(e)},remove:e=>{const t=(this.canUseDOM?I1:this.instances).indexOf(e);(this.canUseDOM?I1:this.instances).splice(t,1)}}};constructor(e,t){this.context=e,this.canUseDOM=t||!1,t||(e.helmet=vC({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},Ule={},d6=Le.createContext(Ule),h6=class f6 extends B.Component{static canUseDOM=u6;helmetData;constructor(t){super(t),this.helmetData=new xC(this.props.context||{},f6.canUseDOM)}render(){return Le.createElement(d6.Provider,{value:this.helmetData.value},this.props.children)}},Wm=(e,t)=>{const n=document.head||document.querySelector("head"),o=n.querySelectorAll(`${e}[${ac}]`),d=[].slice.call(o),f=[];let _;return t&&t.length&&t.forEach(i=>{const S=document.createElement(e);for(const E in i)if(Object.prototype.hasOwnProperty.call(i,E))if(E==="innerHTML")S.innerHTML=i.innerHTML;else if(E==="cssText")S.styleSheet?S.styleSheet.cssText=i.cssText:S.appendChild(document.createTextNode(i.cssText));else{const I=E,M=typeof i[I]>"u"?"":i[I];S.setAttribute(E,M)}S.setAttribute(ac,"true"),d.some((E,I)=>(_=I,S.isEqualNode(E)))?d.splice(_,1):f.push(S)}),d.forEach(i=>i.parentNode?.removeChild(i)),f.forEach(i=>n.appendChild(i)),{oldTags:d,newTags:f}},bC=(e,t)=>{const n=document.getElementsByTagName(e)[0];if(!n)return;const o=n.getAttribute(ac),d=o?o.split(","):[],f=[...d],_=Object.keys(t);for(const i of _){const S=t[i]||"";n.getAttribute(i)!==S&&n.setAttribute(i,S),d.indexOf(i)===-1&&d.push(i);const E=f.indexOf(i);E!==-1&&f.splice(E,1)}for(let i=f.length-1;i>=0;i-=1)n.removeAttribute(f[i]);d.length===f.length?n.removeAttribute(ac):n.getAttribute(ac)!==_.join(",")&&n.setAttribute(ac,_.join(","))},Gle=(e,t)=>{typeof e<"u"&&document.title!==e&&(document.title=a6(e)),bC("title",t)},iz=(e,t)=>{const{baseTag:n,bodyAttributes:o,htmlAttributes:d,linkTags:f,metaTags:_,noscriptTags:i,onChangeClientState:S,scriptTags:E,styleTags:I,title:M,titleAttributes:j}=e;bC("body",o),bC("html",d),Gle(M,j);const N={baseTag:Wm("base",n),linkTags:Wm("link",f),metaTags:Wm("meta",_),noscriptTags:Wm("noscript",i),scriptTags:Wm("script",E),styleTags:Wm("style",I)},G={},z={};Object.keys(N).forEach(V=>{const{newTags:K,oldTags:Q}=N[V];K.length&&(G[V]=K),Q.length&&(z[V]=N[V].oldTags)}),t&&t(),S(e,G,z)},Pv=null,Hle=e=>{Pv&&cancelAnimationFrame(Pv),e.defer?Pv=requestAnimationFrame(()=>{iz(e,()=>{Pv=null})}):(iz(e),Pv=null)},Wle=Hle,oz=class extends B.Component{rendered=!1;shouldComponentUpdate(e){return!Cle(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:t}=this.props.context;let n=null;const o=Dle(e.get().map(d=>{const f={...d.props};return delete f.context,f}));h6.canUseDOM?Wle(o):vC&&(n=vC(o)),t(n)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},nh=class extends B.Component{static defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1};shouldComponentUpdate(e){return!Tle(nz(this.props,"helmetData"),nz(e,"helmetData"))}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case"script":case"noscript":return{innerHTML:t};case"style":return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,t,n,o){return{...t,[e.type]:[...t[e.type]||[],{...n,...this.mapNestedChildrenToProps(e,o)}]}}mapObjectTypeChildren(e,t,n,o){switch(e.type){case"title":return{...t,[e.type]:o,titleAttributes:{...n}};case"body":return{...t,bodyAttributes:{...n}};case"html":return{...t,htmlAttributes:{...n}};default:return{...t,[e.type]:{...n}}}}mapArrayTypeChildrenToProps(e,t){let n={...t};return Object.keys(e).forEach(o=>{n={...n,[o]:e[o]}}),n}warnOnInvalidChildren(e,t){return tz(rz.some(n=>e.type===n),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${rz.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),tz(!t||typeof t=="string"||Array.isArray(t)&&!t.some(n=>typeof n!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,t){let n={};return Le.Children.forEach(e,o=>{if(!o||!o.props)return;const{children:d,...f}=o.props,_=Object.keys(f).reduce((S,E)=>(S[Ile[E]||E]=f[E],S),{});let{type:i}=o;switch(typeof i=="symbol"?i=i.toString():this.warnOnInvalidChildren(o,d),i){case"Symbol(react.fragment)":t=this.mapChildrenToProps(d,t);break;case"link":case"meta":case"noscript":case"script":case"style":n=this.flattenArrayTypeChildren(o,n,_,d);break;default:t=this.mapObjectTypeChildren(o,t,_,d);break}}),this.mapArrayTypeChildrenToProps(n,t)}render(){const{children:e,...t}=this.props;let n={...t},{helmetData:o}=t;if(e&&(n=this.mapChildrenToProps(e,n)),o&&!(o instanceof xC)){const d=o;o=new xC(d.context,!0),delete n.helmetData}return o?Le.createElement(oz,{...n,context:o.value}):Le.createElement(d6.Consumer,null,d=>Le.createElement(oz,{...n,context:d}))}};const qle=20,Zle=768,Kle=200,Mw=[{label:"Home",to:"/",icon:Bc,ariaLabel:"Go to homepage"},{label:"Properties",to:"/properties",icon:c$,ariaLabel:"Browse properties",sectionId:"featured-properties"},{label:"Blog",to:"/blogs",icon:bM,ariaLabel:"Read our blog",sectionId:"latest-posts"},{label:"About",to:"/about",icon:oJ,ariaLabel:"Learn about us",sectionId:"our-story"},{label:"Contact",to:"/contact",icon:Jf,ariaLabel:"Contact us",sectionId:"contact-form"}],Xle=e=>{const[t,n]=B.useState(!1),o=B.useRef(null),d=B.useRef(0);return B.useEffect(()=>{let f=!0;const _=()=>{f&&(n(d.current>e),o.current=null)},i=()=>{d.current=window.scrollY,o.current==null&&(o.current=window.requestAnimationFrame(_))};return window.addEventListener("scroll",i,{passive:!0}),d.current=window.scrollY,n(window.scrollY>e),()=>{f=!1,window.removeEventListener("scroll",i),o.current!=null&&window.cancelAnimationFrame(o.current)}},[e]),t},Yle=e=>{const[t,n]=B.useState(()=>typeof window<"u"?window.innerWidth<e:!1);return B.useEffect(()=>{const o=()=>{n(window.innerWidth<e)};o();let d;const f=()=>{clearTimeout(d),d=setTimeout(o,150)};return window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f),clearTimeout(d)}},[e]),t},Jle=e=>{const t=B.useRef(null),n=B.useRef(0);B.useEffect(()=>{if(!(typeof window>"u")&&e){n.current=window.scrollY;const o=document.body.style,d=window.getComputedStyle(document.body);t.current={top:o.top||"",position:o.position||"",overflow:o.overflow||d.overflow||"",width:o.width||"",height:o.height||""},o.overflow="hidden",o.position="fixed",o.top=`-${n.current}px`,o.width="100%",o.height="100vh";const f=document.querySelector("main");return f&&f.setAttribute("aria-hidden","true"),()=>{const _=t.current;_&&(o.overflow=_.overflow,o.position=_.position,o.top=_.top,o.width=_.width,o.height=_.height),f&&f.removeAttribute("aria-hidden"),window.scrollTo(0,n.current),t.current=null}}},[e])},Qle=(e,t)=>{B.useEffect(()=>{if(!t)return;const n=o=>{(o.key==="Escape"||o.key==="Esc")&&e()};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e,t])},ece=()=>{const{scrollYProgress:e}=kse(),[t,n]=B.useState(0),[o,d]=B.useState(0),f=Lse(e,[0,1],[0,100]);return B.useEffect(()=>{const _=f.on("change",i=>{d(i)});return()=>_()},[f]),B.useEffect(()=>{const _=()=>{const E=document.querySelector("article, main, .content, .prose");if(E){const M=(E.textContent||"").trim().split(/\s+/).filter(N=>N.length>0).length,j=Math.max(1,Math.ceil(M/Kle));n(j)}else n(0)},i=new MutationObserver(_);i.observe(document.body,{childList:!0,subtree:!0,characterData:!0});const S=setTimeout(_,1e3);return()=>{clearTimeout(S),i.disconnect()}},[]),{scrollProgress:o,progressRounded:Math.round(o),estimatedReadingTime:t,scrollYProgress:e}},tce=({isActive:e})=>x.jsx("nav",{className:"hidden md:block","aria-label":"Main desktop navigation",role:"navigation",children:x.jsx("div",{className:"relative",children:x.jsx("div",{className:"relative flex items-center justify-center gap-1 bg-background/70 backdrop-blur-sm rounded-lg px-2 py-1 shadow-sm ring-1 ring-border/30",children:x.jsx("ul",{className:"relative flex items-center list-none m-0 p-0",children:Mw.map(({label:t,to:n,ariaLabel:o,sectionId:d},f)=>{const _=e(n),i=f===Mw.length-1;return x.jsxs(mn.li,{className:"relative m-0 p-0",initial:!1,whileHover:{y:-2},whileTap:{y:0},transition:{duration:.2},children:[x.jsxs(bO,{to:n,"aria-label":o||`Navigate to ${t}`,"aria-current":_?"page":void 0,className:({isActive:S})=>{const E=`
                        relative z-10 block px-5 py-2 text-sm font-medium 
                        transition-all duration-200 rounded-lg
                        focus-visible:outline-none focus-visible:ring-2 
                        focus-visible:ring-primary/50 focus-visible:ring-offset-2 
                        focus-visible:ring-offset-background
                        focus-visible:z-20
                        select-none
                      `;return S?`${E} text-primary font-semibold`:`
                        ${E} 
                        text-muted-foreground 
                        hover:text-primary 
                        hover:bg-primary/5 
                        active:bg-primary/10
                      `},onClick:S=>{if(d&&window.location.pathname===n){S.preventDefault();const E=document.getElementById(d);if(E){const j=E.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:j,behavior:"smooth"});const N=`${n}#${d}`;window.location.href!==N&&window.history.pushState(null,"",N)}}},end:!0,children:[_&&x.jsx(mn.div,{layoutId:"desktop-nav-background",className:"absolute inset-0 bg-gradient-to-r from-primary/10 via-primary/15 to-primary/10 rounded-2xl border border-primary/20",transition:{type:"spring",stiffness:300,damping:25},"aria-hidden":"true"}),x.jsx("span",{className:"relative z-10 whitespace-nowrap",children:t}),_&&x.jsx(mn.div,{layoutId:"desktop-nav-underline",className:"absolute bottom-2 left-4 right-4 h-[3px] rounded-full bg-gradient-to-r from-primary via-primary/80 to-primary",transition:{type:"spring",stiffness:380,damping:28,mass:.8},"aria-hidden":"true"})]}),!i&&x.jsx("div",{className:`absolute top-1/2 right-0 w-px h-4 -translate-y-1/2 \r
                               bg-gradient-to-b from-transparent via-border/30 to-transparent`,"aria-hidden":"true"})]},`desktop-nav-${n}-${f}`)})})})})}),rce=({progress:e,readingTime:t})=>{const[n,o]=B.useState(!1),d=B.useRef(null),_=typeof window<"u"?document.documentElement.scrollHeight>window.innerHeight*1.2:!1,i=Math.max(0,Math.min(100,Number(e||0))),S=20,E=2*Math.PI*S,I=E*(1-i/100),M=_&&i>3&&i<99,j=B.useCallback(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]),N=B.useMemo(()=>{if(!t||t<=0)return null;const z=t*60*((100-e)/100),V=Math.floor(z/60),K=Math.floor(z%60);return V>0?`${V}m ${K}s`:`${K}s`},[e,t]);return B.useEffect(()=>{const G=z=>{d.current&&!d.current.contains(z.target)&&o(!1)};return document.addEventListener("mousedown",G),()=>document.removeEventListener("mousedown",G)},[]),x.jsxs(mn.div,{ref:d,initial:{opacity:0,scale:.9,x:20},animate:{opacity:M?1:0,scale:M?1:.9,x:M?0:20},transition:{duration:.3,ease:"easeOut"},className:"fixed right-4 top-1/2 -translate-y-1/2 z-40 hidden lg:flex flex-col items-center gap-3",role:"progressbar","aria-valuenow":Math.round(i),"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Scroll progress","aria-valuetext":t&&t>0?`${Math.round(i)}%  ${N??""} remaining`:`${Math.round(i)}%`,children:[x.jsxs("div",{className:"relative w-12 h-12 cursor-pointer group",onClick:j,onMouseEnter:()=>o(!0),onFocus:()=>o(!0),onBlur:()=>o(!1),role:"button",tabIndex:0,"aria-label":`Back to top. Scroll progress: ${e}%`,onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),j())},children:[x.jsx("div",{className:"absolute inset-0 rounded-full bg-background/80 backdrop-blur-sm border border-border/50 shadow-lg"}),x.jsxs("svg",{className:"w-12 h-12 transform -rotate-90",viewBox:"0 0 48 48","aria-hidden":"true",children:[x.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"none",stroke:"currentColor",className:"text-border",strokeWidth:"2",strokeLinecap:"round"}),x.jsx(mn.circle,{cx:"24",cy:"24",r:S,fill:"none",stroke:"currentColor",className:"text-primary",strokeWidth:"2",strokeLinecap:"round",strokeDasharray:String(E),strokeDashoffset:I,initial:!1,transition:{duration:.25}})]}),x.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x.jsxs("span",{className:"text-xs font-semibold text-foreground",children:[Math.round(i),"%"]})}),x.jsx(Lf,{children:n&&x.jsx(mn.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},className:"absolute right-full top-1/2 -translate-y-1/2 mr-3 whitespace-nowrap pointer-events-none",children:x.jsxs("div",{className:"relative bg-background border border-border rounded-lg px-3 py-2 shadow-lg",children:[x.jsxs("div",{className:"text-sm font-medium text-foreground",children:[Math.round(i),"% scrolled"]}),N&&x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"h-px bg-border my-1"}),x.jsxs("div",{className:"text-xs text-muted-foreground",children:["~",N," remaining"]})]}),x.jsx("div",{className:"absolute top-1/2 -right-2 -translate-y-1/2 w-0 h-0 border-t-4 border-b-4 border-l-4 border-t-transparent border-b-transparent border-l-background"})]})})})]}),e<10&&x.jsx(mn.div,{animate:{y:[0,5,0]},transition:{repeat:1/0,duration:2},className:"text-muted-foreground","aria-hidden":"true",children:x.jsx(d$,{className:"h-4 w-4 rotate-180"})})]})},nce=({progress:e})=>{const t=e>5&&e<95,n=()=>{const d=document.querySelectorAll("section[id], article, main, [class*='content']");let f=null;for(const _ of d){const i=_.getBoundingClientRect();if(i.top<=window.innerHeight*.3&&i.bottom>=window.innerHeight*.3){f=_;break}}if(f){const _=f.nextElementSibling;if(_&&_ instanceof HTMLElement){const E=_.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:E,behavior:"smooth"})}}else window.scrollTo({top:0,behavior:"smooth"})},o=e;return x.jsx(mn.div,{initial:{y:100},animate:{y:t?0:100},transition:{type:"spring",stiffness:200,damping:25},className:"fixed bottom-20 left-4 right-4 z-30 md:hidden",role:"progressbar","aria-valuenow":Math.round(o),"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Scroll progress: ${o}%`,children:x.jsxs("div",{className:"relative h-3 bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-lg overflow-hidden cursor-pointer active:scale-95 transition-transform",onClick:n,role:"button",tabIndex:0,"aria-label":`Jump to next section. Progress: ${o}%`,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),n())},children:[x.jsx("div",{className:"absolute inset-0 bg-muted/30"}),x.jsx(mn.div,{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-primary via-primary/80 to-primary",style:{width:`${o}%`},initial:!1,transition:{duration:.2}}),x.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:x.jsxs("span",{className:"text-[10px] font-semibold text-primary-foreground mix-blend-difference select-none",children:[Math.round(o),"%"]})}),x.jsx("div",{className:"absolute inset-y-0 left-0 right-0 flex justify-between px-2",children:[0,25,50,75,100].map(d=>x.jsx("div",{className:"w-px h-full bg-border/50",style:{marginLeft:`calc(${d}% - 1px)`,transform:d===50?"scaleY(1.5)":"scaleY(1)"},"aria-hidden":"true"},d))})]})})},ice=({isOpen:e,onClose:t,isActive:n,scrollProgress:o})=>{const d=mc(),f=B.useRef(null);B.useEffect(()=>{t()},[d.pathname,t]),Jle(e),Qle(t,e);const _=B.useRef(null);return B.useEffect(()=>{e&&_.current&&setTimeout(()=>{_.current?.focus()},100)},[e]),B.useEffect(()=>{if(!e||!f.current)return;const i=f.current,E=Array.from(i.querySelectorAll('a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])')).filter(M=>!M.hasAttribute("disabled"));if(E.length===0)return;const I=M=>{if(M.key!=="Tab")return;const j=E[0],N=E[E.length-1];M.shiftKey?document.activeElement===j&&(M.preventDefault(),N.focus()):document.activeElement===N&&(M.preventDefault(),j.focus())};return document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)},[e]),x.jsx(Lf,{children:e&&x.jsxs(x.Fragment,{children:[x.jsx(mn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-background/90 backdrop-blur-xl z-40 md:hidden","aria-hidden":"true"}),x.jsxs(mn.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"100%"},transition:{type:"spring",damping:25,stiffness:200},ref:i=>{f.current=i},className:"md:hidden fixed top-0 right-0 bottom-0 w-80 max-w-full z-50 flex flex-col bg-card border-l shadow-2xl",role:"dialog","aria-modal":"true","aria-label":"Mobile navigation menu",children:[x.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[x.jsxs("div",{children:[x.jsx("h2",{className:"text-xl font-bold",children:"Navigation"}),x.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Scroll progress: ",o,"%"]})]}),x.jsx("button",{onClick:t,"aria-label":"Close menu",className:"p-2 rounded-lg hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring transition-colors",children:x.jsx(Tl,{className:"h-6 w-6"})})]}),x.jsx("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:Mw.map(({label:i,to:S,icon:E,ariaLabel:I},M)=>{const j=n(S);return x.jsxs(bO,{ref:M===0?_:void 0,to:S,"aria-label":I,"aria-current":j?"page":void 0,className:({isActive:N})=>`flex items-center gap-3 rounded-lg px-4 py-4 text-base font-medium transition-all
                       focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2
                       ${N?"bg-primary/10 text-primary shadow-sm":"hover:bg-muted hover:translate-x-1"}`,onClick:t,children:[x.jsx(E,{className:"h-5 w-5 flex-shrink-0"}),x.jsx("span",{className:"flex-1",children:i}),j&&x.jsx(mn.div,{layoutId:"mobile-active",className:"h-2 w-2 rounded-full bg-primary flex-shrink-0","aria-hidden":"true"})]},`mobile-${S}-${M}`)})}),x.jsxs("div",{className:"p-4 border-t",children:[x.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:"Current scroll"}),x.jsx("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:x.jsx(mn.div,{className:"h-full bg-primary",initial:!1,style:{width:`${o}%`},transition:{duration:.3}})})]})]})]})})},oce=({isActive:e,scrollProgress:t})=>{const n=t>3,o=t;return x.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-40 md:hidden","aria-label":"Bottom navigation",children:x.jsx("div",{className:"container mx-auto px-4 pb-4",children:x.jsxs(mn.div,{initial:{y:100},animate:{y:0},transition:{type:"spring",stiffness:200,damping:25},className:"mx-auto max-w-md rounded-2xl bg-background/95 backdrop-blur-xl border shadow-xl overflow-hidden",children:[n&&x.jsx(mn.div,{initial:{height:0,opacity:0},animate:{height:3,opacity:1},exit:{height:0,opacity:0},className:"rounded-t-2xl overflow-hidden",role:"progressbar","aria-valuenow":o,children:x.jsx("div",{className:"h-full bg-gradient-to-r from-primary via-primary/80 to-primary transition-all duration-200",style:{width:`${o}%`}})}),x.jsx("div",{className:"flex justify-between items-center px-4 py-2",children:Mw.map(({to:d,icon:f,ariaLabel:_})=>{const i=e(d);return x.jsxs(bO,{to:d,"aria-label":_,"aria-current":i?"page":void 0,className:`relative flex flex-col items-center p-2 rounded-lg focus-visible:outline-none \r
                           focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,children:[x.jsx(mn.div,{whileTap:{scale:.9},className:`p-2 rounded-full transition-all duration-200 ${i?"bg-primary/15 text-primary shadow-sm":"text-muted-foreground hover:text-primary hover:bg-muted/50"}`,children:x.jsx(f,{className:"h-5 w-5"})}),i&&x.jsxs(x.Fragment,{children:[x.jsx(mn.span,{layoutId:"bottom-indicator",className:"absolute -bottom-1 h-1 w-6 rounded-full bg-primary","aria-hidden":"true"}),o>0&&o<100&&x.jsx(mn.div,{animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:2},className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary/80","aria-hidden":"true"})]})]},`bottom-${d}`)})})]})})})};function zf(){const[e,t]=B.useState(!1),n=Yle(Zle),o=Xle(qle),d=mc(),{scrollProgress:f,estimatedReadingTime:_}=ece(),i=B.useCallback(j=>j==="/"?d.pathname==="/":d.pathname.startsWith(j),[d.pathname]),S=B.useCallback(()=>{t(j=>!j)},[]),E=B.useCallback(()=>{t(!1)},[]),I=o?"h-16":"h-20",M=o?"h-12 sm:h-14 md:h-16 lg:h-20":"h-16 sm:h-20 md:h-24 lg:h-28";return B.useLayoutEffect(()=>{e?document.body.classList.add("overflow-hidden"):document.body.classList.remove("overflow-hidden")},[e]),x.jsxs(x.Fragment,{children:[x.jsx(mn.header,{initial:{y:-80},animate:{y:0},transition:{duration:.6,ease:"easeOut"},className:"fixed inset-x-0 top-0 z-50",role:"banner",children:x.jsx(mn.div,{animate:{backdropFilter:o?"blur(20px)":"blur(10px)",backgroundColor:o?"rgba(var(--background-rgb), 0.85)":"rgba(var(--background-rgb), 0.7)",boxShadow:o?"0 10px 30px rgba(0,0,0,0.15), 0 0 0 1px rgba(var(--border-rgb), 0.1)":"0 4px 12px rgba(0,0,0,0.05)"},className:`relative border-b border-border/40 transition-all duration-300 ${I}`,children:x.jsx("div",{className:"container mx-auto px-4 sm:px-6 h-full",children:x.jsxs("div",{className:"flex items-center justify-between h-full",children:[x.jsx("div",{className:"flex-shrink-0",children:x.jsx(ps,{to:"/","aria-label":"Julin Real Estate - Home",className:`focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring \r
                           focus-visible:ring-offset-2 rounded-lg inline-block bg-transparent`,children:x.jsx(mn.img,{src:"/julin/logo.png",alt:"Julin Real Estate Logo",className:`${M} w-auto object-contain transition-all duration-300`,width:160,height:64,whileHover:{scale:1.05},whileTap:{scale:.95},loading:"eager",onError:j=>{const N=j.target;N.style.display="none",console.error("Failed to load logo image")}})})}),x.jsx(tce,{isActive:i}),x.jsx("div",{className:"md:hidden flex-shrink-0",children:x.jsx(mn.button,{"aria-label":e?"Close menu":"Open menu","aria-expanded":e,"aria-controls":"mobile-menu",onClick:S,whileTap:{scale:.95},className:`h-10 w-10 rounded-full border bg-background/80 backdrop-blur \r
                           flex items-center justify-center hover:bg-muted transition-colors\r
                           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\r
                           relative`,children:e?x.jsx(Tl,{className:"h-5 w-5"}):x.jsxs(x.Fragment,{children:[x.jsx(hJ,{className:"h-5 w-5"}),f>0&&x.jsx(mn.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 h-2 w-2 rounded-full bg-primary","aria-hidden":"true"})]})})})]})})})}),x.jsx(rce,{progress:f,readingTime:_}),n&&x.jsx(nce,{progress:f}),x.jsx(ice,{isOpen:e,onClose:E,isActive:i,scrollProgress:f}),n&&x.jsx(oce,{isActive:i,scrollProgress:f})]})}const sce="modulepreload",ace=function(e){return"/julin/"+e},sz={},SO=function(t,n,o){let d=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const _=document.querySelector("meta[property=csp-nonce]"),i=_?.nonce||_?.getAttribute("nonce");d=Promise.allSettled(n.map(S=>{if(S=ace(S),S in sz)return;sz[S]=!0;const E=S.endsWith(".css"),I=E?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${I}`))return;const M=document.createElement("link");if(M.rel=E?"stylesheet":sce,E||(M.as="script"),M.crossOrigin="",M.href=S,i&&M.setAttribute("nonce",i),document.head.appendChild(M),E)return new Promise((j,N)=>{M.addEventListener("load",j),M.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${S}`)))})}))}function f(_){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=_,window.dispatchEvent(i),!i.defaultPrevented)throw _}return d.then(_=>{for(const i of _||[])i.status==="rejected"&&f(i.reason);return t().catch(f)})},lce=Q0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg hover:shadow-xl hover:scale-105 font-semibold",heroOutline:"border-2 border-primary-foreground/30 bg-primary-foreground/10 text-primary-foreground hover:bg-primary-foreground/20 backdrop-blur-sm font-semibold",accent:"bg-accent text-accent-foreground hover:bg-accent/90 shadow-md hover:shadow-lg"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-lg px-8 text-base",xl:"h-14 rounded-lg px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Tr=B.forwardRef(({className:e,variant:t,size:n,asChild:o=!1,...d},f)=>{const _=o?L4:"button";return x.jsx(_,{className:kr(lce({variant:t,size:n,className:e})),ref:f,...d})});Tr.displayName="Button";const cce="/julin/assets/hero-property-DHUdNZVA.jpg",uce="/julin/assets/kenya-real-estate-hero--SBKbFpu.jpg";function dce(e){const[t,n]=B.useState(!1);return B.useEffect(()=>{const o=window.matchMedia(e);o.matches!==t&&n(o.matches);const d=()=>n(o.matches);return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[t,e]),t}const uf=({icon:e,label:t,children:n,isActive:o=!1})=>x.jsx(mn.div,{className:`
      flex flex-col sm:flex-row items-start sm:items-center gap-3 p-4 
      bg-white/10 backdrop-blur-sm rounded-xl w-full border-2 transition-all duration-300
      hover:bg-white/15 hover:border-accent/50 hover:shadow-lg
      ${o?"border-accent bg-white/15 shadow-lg":"border-transparent"}
      dark:bg-gray-900/20 dark:hover:bg-gray-900/30
    `,whileHover:{scale:1.02},whileTap:{scale:.98},children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"p-2 bg-accent/10 rounded-lg",children:x.jsx(e,{className:"h-5 w-5 text-accent flex-shrink-0"})}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("label",{className:"text-xs font-medium text-primary-foreground/70 uppercase tracking-wider block mb-1",children:t}),x.jsx("div",{className:"text-foreground font-medium",children:n})]})]})}),hce=()=>{const[e,t]=B.useState(""),[n,o]=B.useState(!1),[d,f]=B.useState([]),[_,i]=B.useState(0),[S,E]=B.useState(!1),[I,M]=B.useState(0),[j,N]=B.useState(""),G=dce("(max-width: 640px)"),z=[cce,uce],V=()=>{if(d.length>0&&!S){const X=d[_%d.length];return X?.images?.[0]||X?.image_url||z[0]}return z[_%z.length]};B.useEffect(()=>{(async()=>{try{const{supabase:ie}=await SO(async()=>{const{supabase:ze}=await Promise.resolve().then(()=>yue);return{supabase:ze}},void 0),{data:J,error:se}=await ie.from("properties").select("id, title, location, price, property_type, images").eq("status","available").order("created_at",{ascending:!1}).limit(20);if(se){console.warn("Failed to fetch properties for hero:",se);return}const he=J||[];M(he.length);const we=he.filter(ze=>ze.images&&ze.images.length>0);we.length>0&&f(we)}catch(ie){console.warn("Failed to fetch properties for hero:",ie)}})()},[]),B.useEffect(()=>{const X=setInterval(()=>{i(ie=>ie+1),E(!1)},8e3);return()=>clearInterval(X)},[d.length]),B.useEffect(()=>{const X="Discover verified properties across Kenya.";let ie=0;N("");const J=setInterval(()=>{ie+=1,N(X.slice(0,ie)),ie>=X.length&&clearInterval(J)},28);return()=>clearInterval(J)},[]);const K=X=>{X.preventDefault()},Q=()=>{document.getElementById("search-section")?.scrollIntoView({behavior:"smooth",block:"center"})};return x.jsxs("section",{id:"home",className:"relative min-h-[70vh] md:min-h-screen flex items-center justify-center pt-16 md:pt-32 overflow-hidden","aria-label":"Hero section",children:[x.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[x.jsx(Lf,{mode:"wait",children:x.jsx(mn.img,{src:V(),alt:"Real estate property in Kenya",className:"w-full h-full object-cover object-center",style:{filter:"brightness(0.72) saturate(1.02)"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:1.2,ease:"easeOut"},loading:"eager",fetchPriority:"high",onError:()=>E(!0)},_)}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-navy/40 via-navy/28 to-navy/20"}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-navy/10 via-transparent to-transparent opacity-30"}),x.jsx(mn.div,{className:"absolute top-20 right-20 w-72 h-72 bg-accent/10 rounded-full blur-3xl",animate:{scale:[1,1.2,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),x.jsx(mn.div,{className:"absolute bottom-20 left-20 w-96 h-96 bg-blue-500/5 rounded-full blur-3xl",animate:{scale:[1.2,1,1.2],opacity:[.2,.4,.2]},transition:{duration:10,repeat:1/0,ease:"easeInOut",delay:1}})]}),d.length>0&&x.jsxs(mn.div,{className:"absolute bottom-6 left-6 z-20 hidden md:flex flex-col gap-2 bg-white/10 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20 max-w-xs",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:1},children:[x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Jc,{className:"h-4 w-4 text-accent"}),x.jsx("span",{className:"text-sm font-medium text-primary-foreground/90",children:d[_%d.length]?.location||"Featured Property"})]}),x.jsx("div",{className:"text-xs text-primary-foreground/70",children:d[_%d.length]?.title||"Premium Real Estate"}),x.jsx("div",{className:"flex items-center gap-1 mt-1",children:d.map((X,ie)=>x.jsx("button",{onClick:()=>i(ie),className:`w-2 h-2 rounded-full transition-all ${ie===_%d.length?"bg-accent scale-125":"bg-white/40 hover:bg-white/60"}`},ie))})]},_),I>=300&&x.jsxs("div",{className:"absolute top-6 right-6 z-20 hidden md:flex flex-col gap-2",children:[x.jsxs(mn.div,{className:"flex items-center gap-2 bg-white/10 backdrop-blur-md rounded-full px-4 py-2 border border-white/20",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},children:[x.jsx(bJ,{className:"h-4 w-4 text-green-400"}),x.jsxs("span",{className:"text-xs font-medium text-primary-foreground/90",children:[I>=1e3?`${Math.floor(I/100)*100}+`:I.toLocaleString()," Verified Properties"]})]}),x.jsxs(mn.div,{className:"flex items-center gap-2 bg-white/10 backdrop-blur-md rounded-full px-4 py-2 border border-white/20",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7},children:[x.jsx(m$,{className:"h-4 w-4 text-yellow-400"}),x.jsx("span",{className:"text-xs font-medium text-primary-foreground/90",children:"98% Client Satisfaction"})]})]}),x.jsxs("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 xl:px-20",children:[x.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[x.jsxs(mn.div,{className:"text-center lg:text-left",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:[x.jsxs(mn.span,{className:"inline-flex items-center gap-2 text-accent font-semibold text-sm tracking-widest uppercase mb-3 px-3 py-1 bg-accent/10 rounded-full",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[x.jsx("div",{className:"w-2 h-2 bg-accent rounded-full animate-pulse"}),"Julin Real Estate"]}),x.jsx(mn.h1,{className:"font-serif text-3xl sm:text-4xl lg:text-5xl font-bold text-primary-foreground mb-3 leading-tight",initial:{opacity:0,y:18},animate:{opacity:1,y:0},transition:{delay:.25},children:"Find verified properties in Kenya"}),x.jsxs(mn.p,{className:"text-sm sm:text-base text-primary-foreground/90 mb-6 max-w-md lg:max-w-xl leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[j,x.jsx("span",{className:"ml-1 inline-block text-accent","aria-hidden":!0,children:x.jsx("span",{className:"animate-pulse",children:""})})]}),I>=300&&x.jsxs(mn.div,{className:"flex flex-wrap justify-center lg:justify-start gap-6 mb-10",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[x.jsxs("div",{className:"text-center lg:text-left",children:[x.jsx("div",{className:"text-3xl font-bold text-accent",children:I>=1e3?`${Math.floor(I/100)*100}+`:I.toLocaleString()}),x.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Properties Listed"})]}),x.jsxs("div",{className:"text-center lg:text-left",children:[x.jsx("div",{className:"text-3xl font-bold text-accent",children:"98%"}),x.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Client Satisfaction"})]}),x.jsxs("div",{className:"text-center lg:text-left",children:[x.jsx("div",{className:"text-3xl font-bold text-accent",children:"24/7"}),x.jsx("div",{className:"text-sm text-primary-foreground/70",children:"Support Available"})]})]}),x.jsxs(mn.div,{className:"flex flex-col sm:flex-row gap-3 justify-center lg:justify-start mb-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[x.jsx(ps,{to:"/properties",className:"flex-1 sm:flex-initial",children:x.jsxs(Tr,{variant:"hero",size:G?"default":"lg",className:"w-full sm:w-auto group",children:[x.jsx(kf,{className:"h-5 w-5 mr-2 group-hover:rotate-12 transition-transform"}),"Browse Properties",x.jsx(dw,{className:"h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"})]})}),x.jsxs(Tr,{variant:"heroOutline",size:G?"default":"lg",className:"group",onClick:Q,children:[x.jsx(tN,{className:"h-4 w-4 mr-2"}),"Advanced Search"]})]})]}),x.jsxs(mn.div,{id:"search-section",className:"bg-white/10 backdrop-blur-xl rounded-2xl p-6 lg:p-8 shadow-2xl border border-white/20",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.7},whileHover:{y:-5},children:[x.jsxs("div",{className:"mb-8",children:[x.jsx("h2",{className:"text-2xl font-bold text-primary-foreground mb-2",children:"Find Your Dream Property"}),x.jsx("p",{className:"text-primary-foreground/70",children:"Search through our verified listings with advanced filters"})]}),x.jsxs("form",{onSubmit:K,className:"space-y-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx(uf,{icon:Jc,label:"Location",isActive:e==="location",children:x.jsx("input",{type:"text",placeholder:"Nairobi, Mombasa, Kisumu...",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50",onFocus:()=>t("location"),onBlur:()=>t("")})}),x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[x.jsx(uf,{icon:Bc,label:"Property Type",isActive:e==="type",children:x.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",onFocus:()=>t("type"),onBlur:()=>t(""),children:[x.jsx("option",{value:"",children:"Any Type"}),x.jsx("option",{value:"house",children:"House"}),x.jsx("option",{value:"apartment",children:"Apartment"}),x.jsx("option",{value:"land",children:"Land"}),x.jsx("option",{value:"commercial",children:"Commercial"}),x.jsx("option",{value:"villa",children:"Villa"})]})}),x.jsx(uf,{icon:rJ,label:"Price Range",isActive:e==="price",children:x.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",onFocus:()=>t("price"),onBlur:()=>t(""),children:[x.jsx("option",{value:"",children:"Any Price"}),x.jsx("option",{value:"0-5",children:"Under KES 5M"}),x.jsx("option",{value:"5-10",children:"KES 5M - 10M"}),x.jsx("option",{value:"10-20",children:"KES 10M - 20M"}),x.jsx("option",{value:"20-50",children:"KES 20M - 50M"}),x.jsx("option",{value:"50+",children:"Above KES 50M"})]})})]})]}),x.jsxs("button",{type:"button",className:"flex items-center gap-2 text-sm text-primary-foreground/70 hover:text-accent transition-colors",onClick:()=>o(!n),children:[x.jsx(tN,{className:"h-4 w-4"}),n?"Hide":"Show"," Advanced Filters"]}),x.jsx(Lf,{children:n&&x.jsxs(mn.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-4 overflow-hidden",children:[x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[x.jsx(uf,{icon:Bc,label:"Bedrooms",children:x.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",children:[x.jsx("option",{children:"Any"}),x.jsx("option",{children:"1+"}),x.jsx("option",{children:"2+"}),x.jsx("option",{children:"3+"}),x.jsx("option",{children:"4+"}),x.jsx("option",{children:"5+"})]})}),x.jsx(uf,{icon:Bc,label:"Bathrooms",children:x.jsxs("select",{className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1",children:[x.jsx("option",{children:"Any"}),x.jsx("option",{children:"1+"}),x.jsx("option",{children:"2+"}),x.jsx("option",{children:"3+"}),x.jsx("option",{children:"4+"})]})})]}),x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[x.jsx(uf,{icon:Bc,label:"Square Feet",children:x.jsx("input",{type:"text",placeholder:"Min sq ft",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50"})}),x.jsx(uf,{icon:Bc,label:"Year Built",children:x.jsx("input",{type:"text",placeholder:"After year",className:"bg-transparent text-foreground font-medium focus:outline-none w-full py-1 placeholder:text-foreground/50"})})]})]})}),x.jsx(mn.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:x.jsxs(Tr,{type:"submit",variant:"default",size:"lg",className:"w-full h-14 text-lg font-semibold bg-gradient-to-r from-accent to-blue-600 hover:from-accent/90 hover:to-blue-600/90",children:[x.jsx(kf,{className:"h-5 w-5 mr-2"}),"Search Properties",x.jsx("span",{className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]})}),x.jsxs("div",{className:"pt-4 border-t border-white/10",children:[x.jsx("p",{className:"text-sm text-primary-foreground/70 mb-3",children:"Popular Searches:"}),x.jsx("div",{className:"flex flex-wrap gap-2",children:["Nairobi Apartments","Mombasa Beach House","Kisumu Land","Nakuru Commercial"].map(X=>x.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm bg-white/5 hover:bg-accent/20 rounded-full border border-white/10 hover:border-accent/30 transition-colors",children:X},X))})]})]})]})]}),x.jsx(mn.div,{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 hidden md:block",animate:{y:[0,10,0]},transition:{duration:2,repeat:1/0},children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"text-xs text-primary-foreground/60 mb-2",children:"Scroll to explore"}),x.jsx("div",{className:"w-6 h-10 border-2 border-primary-foreground/30 rounded-full flex justify-center",children:x.jsx("div",{className:"w-1 h-3 bg-primary-foreground/50 rounded-full mt-2"})})]})})]})]})},fce=Q0("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold",{variants:{variant:{default:"bg-muted text-muted-foreground",secondary:"bg-secondary text-secondary-foreground",destructive:"bg-destructive text-destructive-foreground",outline:"border border-input bg-background"}},defaultVariants:{variant:"default"}}),Ws=B.forwardRef(({className:e,variant:t,asChild:n=!1,...o},d)=>{const f=n?L4:"span";return x.jsx(f,{ref:d,className:kr(fce({variant:t}),e),...o})});Ws.displayName="Badge";var WE="focusScope.autoFocusOnMount",qE="focusScope.autoFocusOnUnmount",az={bubbles:!1,cancelable:!0},pce="FocusScope",sT=B.forwardRef((e,t)=>{const{loop:n=!1,trapped:o=!1,onMountAutoFocus:d,onUnmountAutoFocus:f,..._}=e,[i,S]=B.useState(null),E=Aa(d),I=Aa(f),M=B.useRef(null),j=di(t,z=>S(z)),N=B.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;B.useEffect(()=>{if(o){let z=function(X){if(N.paused||!i)return;const ie=X.target;i.contains(ie)?M.current=ie:Vd(M.current,{select:!0})},V=function(X){if(N.paused||!i)return;const ie=X.relatedTarget;ie!==null&&(i.contains(ie)||Vd(M.current,{select:!0}))},K=function(X){if(document.activeElement===document.body)for(const J of X)J.removedNodes.length>0&&Vd(i)};document.addEventListener("focusin",z),document.addEventListener("focusout",V);const Q=new MutationObserver(K);return i&&Q.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",z),document.removeEventListener("focusout",V),Q.disconnect()}}},[o,i,N.paused]),B.useEffect(()=>{if(i){cz.add(N);const z=document.activeElement;if(!i.contains(z)){const K=new CustomEvent(WE,az);i.addEventListener(WE,E),i.dispatchEvent(K),K.defaultPrevented||(mce(xce(p6(i)),{select:!0}),document.activeElement===z&&Vd(i))}return()=>{i.removeEventListener(WE,E),setTimeout(()=>{const K=new CustomEvent(qE,az);i.addEventListener(qE,I),i.dispatchEvent(K),K.defaultPrevented||Vd(z??document.body,{select:!0}),i.removeEventListener(qE,I),cz.remove(N)},0)}}},[i,E,I,N]);const G=B.useCallback(z=>{if(!n&&!o||N.paused)return;const V=z.key==="Tab"&&!z.altKey&&!z.ctrlKey&&!z.metaKey,K=document.activeElement;if(V&&K){const Q=z.currentTarget,[X,ie]=gce(Q);X&&ie?!z.shiftKey&&K===ie?(z.preventDefault(),n&&Vd(X,{select:!0})):z.shiftKey&&K===X&&(z.preventDefault(),n&&Vd(ie,{select:!0})):K===Q&&z.preventDefault()}},[n,o,N.paused]);return x.jsx(En.div,{tabIndex:-1,..._,ref:j,onKeyDown:G})});sT.displayName=pce;function mce(e,{select:t=!1}={}){const n=document.activeElement;for(const o of e)if(Vd(o,{select:t}),document.activeElement!==n)return}function gce(e){const t=p6(e),n=lz(t,e),o=lz(t.reverse(),e);return[n,o]}function p6(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const d=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||d?NodeFilter.FILTER_SKIP:o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function lz(e,t){for(const n of e)if(!yce(n,{upTo:t}))return n}function yce(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function _ce(e){return e instanceof HTMLInputElement&&"select"in e}function Vd(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&_ce(e)&&t&&e.select()}}var cz=vce();function vce(){let e=[];return{add(t){const n=e[0];t!==n&&n?.pause(),e=uz(e,t),e.unshift(t)},remove(t){e=uz(e,t),e[0]?.resume()}}}function uz(e,t){const n=[...e],o=n.indexOf(t);return o!==-1&&n.splice(o,1),n}function xce(e){return e.filter(t=>t.tagName!=="A")}var ZE=0;function TO(){B.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??dz()),document.body.insertAdjacentElement("beforeend",e[1]??dz()),ZE++,()=>{ZE===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),ZE--}},[])}function dz(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var lw="right-scroll-bar-position",cw="width-before-scroll-bar",bce="with-scroll-bars-hidden",wce="--removed-body-scroll-bar-size";function KE(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Sce(e,t){var n=B.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(o){var d=n.value;d!==o&&(n.value=o,n.callback(o,d))}}}})[0];return n.callback=t,n.facade}var Tce=typeof window<"u"?B.useLayoutEffect:B.useEffect,hz=new WeakMap;function Ace(e,t){var n=Sce(null,function(o){return e.forEach(function(d){return KE(d,o)})});return Tce(function(){var o=hz.get(n);if(o){var d=new Set(o),f=new Set(e),_=n.current;d.forEach(function(i){f.has(i)||KE(i,null)}),f.forEach(function(i){d.has(i)||KE(i,_)})}hz.set(n,e)},[e]),n}function Ece(e){return e}function Pce(e,t){t===void 0&&(t=Ece);var n=[],o=!1,d={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(f){var _=t(f,o);return n.push(_),function(){n=n.filter(function(i){return i!==_})}},assignSyncMedium:function(f){for(o=!0;n.length;){var _=n;n=[],_.forEach(f)}n={push:function(i){return f(i)},filter:function(){return n}}},assignMedium:function(f){o=!0;var _=[];if(n.length){var i=n;n=[],i.forEach(f),_=n}var S=function(){var I=_;_=[],I.forEach(f)},E=function(){return Promise.resolve().then(S)};E(),n={push:function(I){_.push(I),E()},filter:function(I){return _=_.filter(I),n}}}};return d}function Cce(e){e===void 0&&(e={});var t=Pce(null);return t.options=Gd({async:!0,ssr:!1},e),t}var m6=function(e){var t=e.sideCar,n=O4(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=t.read();if(!o)throw new Error("Sidecar medium not found");return B.createElement(o,Gd({},n))};m6.isSideCarExport=!0;function Ice(e,t){return e.useMedium(t),m6}var g6=Cce(),XE=function(){},aT=B.forwardRef(function(e,t){var n=B.useRef(null),o=B.useState({onScrollCapture:XE,onWheelCapture:XE,onTouchMoveCapture:XE}),d=o[0],f=o[1],_=e.forwardProps,i=e.children,S=e.className,E=e.removeScrollBar,I=e.enabled,M=e.shards,j=e.sideCar,N=e.noRelative,G=e.noIsolation,z=e.inert,V=e.allowPinchZoom,K=e.as,Q=K===void 0?"div":K,X=e.gapMode,ie=O4(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),J=j,se=Ace([n,t]),he=Gd(Gd({},ie),d);return B.createElement(B.Fragment,null,I&&B.createElement(J,{sideCar:g6,removeScrollBar:E,shards:M,noRelative:N,noIsolation:G,inert:z,setCallbacks:f,allowPinchZoom:!!V,lockRef:n,gapMode:X}),_?B.cloneElement(B.Children.only(i),Gd(Gd({},he),{ref:se})):B.createElement(Q,Gd({},he,{className:S,ref:se}),i))});aT.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};aT.classNames={fullWidth:cw,zeroRight:lw};var Mce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Oce(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Mce();return t&&e.setAttribute("nonce",t),e}function Rce(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function kce(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var jce=function(){var e=0,t=null;return{add:function(n){e==0&&(t=Oce())&&(Rce(t,n),kce(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Dce=function(){var e=jce();return function(t,n){B.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},y6=function(){var e=Dce(),t=function(n){var o=n.styles,d=n.dynamic;return e(o,d),null};return t},Lce={left:0,top:0,right:0,gap:0},YE=function(e){return parseInt(e||"",10)||0},Nce=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],o=t[e==="padding"?"paddingTop":"marginTop"],d=t[e==="padding"?"paddingRight":"marginRight"];return[YE(n),YE(o),YE(d)]},zce=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Lce;var t=Nce(e),n=document.documentElement.clientWidth,o=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,o-n+t[2]-t[0])}},Fce=y6(),yg="data-scroll-locked",Bce=function(e,t,n,o){var d=e.left,f=e.top,_=e.right,i=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(bce,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(i,"px ").concat(o,`;
  }
  body[`).concat(yg,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(o,";"),n==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(f,`px;
    padding-right: `).concat(_,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(o,`;
    `),n==="padding"&&"padding-right: ".concat(i,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(lw,` {
    right: `).concat(i,"px ").concat(o,`;
  }
  
  .`).concat(cw,` {
    margin-right: `).concat(i,"px ").concat(o,`;
  }
  
  .`).concat(lw," .").concat(lw,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(cw," .").concat(cw,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(yg,`] {
    `).concat(wce,": ").concat(i,`px;
  }
`)},fz=function(){var e=parseInt(document.body.getAttribute(yg)||"0",10);return isFinite(e)?e:0},$ce=function(){B.useEffect(function(){return document.body.setAttribute(yg,(fz()+1).toString()),function(){var e=fz()-1;e<=0?document.body.removeAttribute(yg):document.body.setAttribute(yg,e.toString())}},[])},Vce=function(e){var t=e.noRelative,n=e.noImportant,o=e.gapMode,d=o===void 0?"margin":o;$ce();var f=B.useMemo(function(){return zce(d)},[d]);return B.createElement(Fce,{styles:Bce(f,!t,d,n?"":"!important")})},wC=!1;if(typeof window<"u")try{var M1=Object.defineProperty({},"passive",{get:function(){return wC=!0,!0}});window.addEventListener("test",M1,M1),window.removeEventListener("test",M1,M1)}catch{wC=!1}var qm=wC?{passive:!1}:!1,Uce=function(e){return e.tagName==="TEXTAREA"},_6=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!Uce(e)&&n[t]==="visible")},Gce=function(e){return _6(e,"overflowY")},Hce=function(e){return _6(e,"overflowX")},pz=function(e,t){var n=t.ownerDocument,o=t;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var d=v6(e,o);if(d){var f=x6(e,o),_=f[1],i=f[2];if(_>i)return!0}o=o.parentNode}while(o&&o!==n.body);return!1},Wce=function(e){var t=e.scrollTop,n=e.scrollHeight,o=e.clientHeight;return[t,n,o]},qce=function(e){var t=e.scrollLeft,n=e.scrollWidth,o=e.clientWidth;return[t,n,o]},v6=function(e,t){return e==="v"?Gce(t):Hce(t)},x6=function(e,t){return e==="v"?Wce(t):qce(t)},Zce=function(e,t){return e==="h"&&t==="rtl"?-1:1},Kce=function(e,t,n,o,d){var f=Zce(e,window.getComputedStyle(t).direction),_=f*o,i=n.target,S=t.contains(i),E=!1,I=_>0,M=0,j=0;do{if(!i)break;var N=x6(e,i),G=N[0],z=N[1],V=N[2],K=z-V-f*G;(G||K)&&v6(e,i)&&(M+=K,j+=G);var Q=i.parentNode;i=Q&&Q.nodeType===Node.DOCUMENT_FRAGMENT_NODE?Q.host:Q}while(!S&&i!==document.body||S&&(t.contains(i)||t===i));return(I&&(Math.abs(M)<1||!d)||!I&&(Math.abs(j)<1||!d))&&(E=!0),E},O1=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},mz=function(e){return[e.deltaX,e.deltaY]},gz=function(e){return e&&"current"in e?e.current:e},Xce=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Yce=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},Jce=0,Zm=[];function Qce(e){var t=B.useRef([]),n=B.useRef([0,0]),o=B.useRef(),d=B.useState(Jce++)[0],f=B.useState(y6)[0],_=B.useRef(e);B.useEffect(function(){_.current=e},[e]),B.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(d));var z=qX([e.lockRef.current],(e.shards||[]).map(gz),!0).filter(Boolean);return z.forEach(function(V){return V.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),z.forEach(function(V){return V.classList.remove("allow-interactivity-".concat(d))})}}},[e.inert,e.lockRef.current,e.shards]);var i=B.useCallback(function(z,V){if("touches"in z&&z.touches.length===2||z.type==="wheel"&&z.ctrlKey)return!_.current.allowPinchZoom;var K=O1(z),Q=n.current,X="deltaX"in z?z.deltaX:Q[0]-K[0],ie="deltaY"in z?z.deltaY:Q[1]-K[1],J,se=z.target,he=Math.abs(X)>Math.abs(ie)?"h":"v";if("touches"in z&&he==="h"&&se.type==="range")return!1;var we=pz(he,se);if(!we)return!0;if(we?J=he:(J=he==="v"?"h":"v",we=pz(he,se)),!we)return!1;if(!o.current&&"changedTouches"in z&&(X||ie)&&(o.current=J),!J)return!0;var ze=o.current||J;return Kce(ze,V,z,ze==="h"?X:ie,!0)},[]),S=B.useCallback(function(z){var V=z;if(!(!Zm.length||Zm[Zm.length-1]!==f)){var K="deltaY"in V?mz(V):O1(V),Q=t.current.filter(function(J){return J.name===V.type&&(J.target===V.target||V.target===J.shadowParent)&&Xce(J.delta,K)})[0];if(Q&&Q.should){V.cancelable&&V.preventDefault();return}if(!Q){var X=(_.current.shards||[]).map(gz).filter(Boolean).filter(function(J){return J.contains(V.target)}),ie=X.length>0?i(V,X[0]):!_.current.noIsolation;ie&&V.cancelable&&V.preventDefault()}}},[]),E=B.useCallback(function(z,V,K,Q){var X={name:z,delta:V,target:K,should:Q,shadowParent:eue(K)};t.current.push(X),setTimeout(function(){t.current=t.current.filter(function(ie){return ie!==X})},1)},[]),I=B.useCallback(function(z){n.current=O1(z),o.current=void 0},[]),M=B.useCallback(function(z){E(z.type,mz(z),z.target,i(z,e.lockRef.current))},[]),j=B.useCallback(function(z){E(z.type,O1(z),z.target,i(z,e.lockRef.current))},[]);B.useEffect(function(){return Zm.push(f),e.setCallbacks({onScrollCapture:M,onWheelCapture:M,onTouchMoveCapture:j}),document.addEventListener("wheel",S,qm),document.addEventListener("touchmove",S,qm),document.addEventListener("touchstart",I,qm),function(){Zm=Zm.filter(function(z){return z!==f}),document.removeEventListener("wheel",S,qm),document.removeEventListener("touchmove",S,qm),document.removeEventListener("touchstart",I,qm)}},[]);var N=e.removeScrollBar,G=e.inert;return B.createElement(B.Fragment,null,G?B.createElement(f,{styles:Yce(d)}):null,N?B.createElement(Vce,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function eue(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const tue=Ice(g6,Qce);var lT=B.forwardRef(function(e,t){return B.createElement(aT,Gd({},e,{ref:t,sideCar:tue}))});lT.classNames=aT.classNames;var rue=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Km=new WeakMap,R1=new WeakMap,k1={},JE=0,b6=function(e){return e&&(e.host||b6(e.parentNode))},nue=function(e,t){return t.map(function(n){if(e.contains(n))return n;var o=b6(n);return o&&e.contains(o)?o:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},iue=function(e,t,n,o){var d=nue(t,Array.isArray(e)?e:[e]);k1[n]||(k1[n]=new WeakMap);var f=k1[n],_=[],i=new Set,S=new Set(d),E=function(M){!M||i.has(M)||(i.add(M),E(M.parentNode))};d.forEach(E);var I=function(M){!M||S.has(M)||Array.prototype.forEach.call(M.children,function(j){if(i.has(j))I(j);else try{var N=j.getAttribute(o),G=N!==null&&N!=="false",z=(Km.get(j)||0)+1,V=(f.get(j)||0)+1;Km.set(j,z),f.set(j,V),_.push(j),z===1&&G&&R1.set(j,!0),V===1&&j.setAttribute(n,"true"),G||j.setAttribute(o,"true")}catch(K){console.error("aria-hidden: cannot operate on ",j,K)}})};return I(t),i.clear(),JE++,function(){_.forEach(function(M){var j=Km.get(M)-1,N=f.get(M)-1;Km.set(M,j),f.set(M,N),j||(R1.has(M)||M.removeAttribute(o),R1.delete(M)),N||M.removeAttribute(n)}),JE--,JE||(Km=new WeakMap,Km=new WeakMap,R1=new WeakMap,k1={})}},AO=function(e,t,n){n===void 0&&(n="data-aria-hidden");var o=Array.from(Array.isArray(e)?e:[e]),d=rue(e);return d?(o.push.apply(o,Array.from(d.querySelectorAll("[aria-live]"))),iue(o,d,n,"aria-hidden")):function(){return null}},cT="Dialog",[w6,BFe]=fc(cT),[oue,gc]=w6(cT),S6=e=>{const{__scopeDialog:t,children:n,open:o,defaultOpen:d,onOpenChange:f,modal:_=!0}=e,i=B.useRef(null),S=B.useRef(null),[E,I]=Qd({prop:o,defaultProp:d??!1,onChange:f,caller:cT});return x.jsx(oue,{scope:t,triggerRef:i,contentRef:S,contentId:$u(),titleId:$u(),descriptionId:$u(),open:E,onOpenChange:I,onOpenToggle:B.useCallback(()=>I(M=>!M),[I]),modal:_,children:n})};S6.displayName=cT;var T6="DialogTrigger",A6=B.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,d=gc(T6,n),f=di(t,d.triggerRef);return x.jsx(En.button,{type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":CO(d.open),...o,ref:f,onClick:Pr(e.onClick,d.onOpenToggle)})});A6.displayName=T6;var EO="DialogPortal",[sue,E6]=w6(EO,{forceMount:void 0}),P6=e=>{const{__scopeDialog:t,forceMount:n,children:o,container:d}=e,f=gc(EO,t);return x.jsx(sue,{scope:t,forceMount:n,children:B.Children.map(o,_=>x.jsx(pc,{present:n||f.open,children:x.jsx(Y0,{asChild:!0,container:d,children:_})}))})};P6.displayName=EO;var Ow="DialogOverlay",C6=B.forwardRef((e,t)=>{const n=E6(Ow,e.__scopeDialog),{forceMount:o=n.forceMount,...d}=e,f=gc(Ow,e.__scopeDialog);return f.modal?x.jsx(pc,{present:o||f.open,children:x.jsx(lue,{...d,ref:t})}):null});C6.displayName=Ow;var aue=Rf("DialogOverlay.RemoveScroll"),lue=B.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,d=gc(Ow,n);return x.jsx(lT,{as:aue,allowPinchZoom:!0,shards:[d.contentRef],children:x.jsx(En.div,{"data-state":CO(d.open),...o,ref:t,style:{pointerEvents:"auto",...o.style}})})}),Ff="DialogContent",I6=B.forwardRef((e,t)=>{const n=E6(Ff,e.__scopeDialog),{forceMount:o=n.forceMount,...d}=e,f=gc(Ff,e.__scopeDialog);return x.jsx(pc,{present:o||f.open,children:f.modal?x.jsx(cue,{...d,ref:t}):x.jsx(uue,{...d,ref:t})})});I6.displayName=Ff;var cue=B.forwardRef((e,t)=>{const n=gc(Ff,e.__scopeDialog),o=B.useRef(null),d=di(t,n.contentRef,o);return B.useEffect(()=>{const f=o.current;if(f)return AO(f)},[]),x.jsx(M6,{...e,ref:d,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Pr(e.onCloseAutoFocus,f=>{f.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Pr(e.onPointerDownOutside,f=>{const _=f.detail.originalEvent,i=_.button===0&&_.ctrlKey===!0;(_.button===2||i)&&f.preventDefault()}),onFocusOutside:Pr(e.onFocusOutside,f=>f.preventDefault())})}),uue=B.forwardRef((e,t)=>{const n=gc(Ff,e.__scopeDialog),o=B.useRef(!1),d=B.useRef(!1);return x.jsx(M6,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:f=>{e.onCloseAutoFocus?.(f),f.defaultPrevented||(o.current||n.triggerRef.current?.focus(),f.preventDefault()),o.current=!1,d.current=!1},onInteractOutside:f=>{e.onInteractOutside?.(f),f.defaultPrevented||(o.current=!0,f.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const _=f.target;n.triggerRef.current?.contains(_)&&f.preventDefault(),f.detail.originalEvent.type==="focusin"&&d.current&&f.preventDefault()}})}),M6=B.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:o,onOpenAutoFocus:d,onCloseAutoFocus:f,..._}=e,i=gc(Ff,n),S=B.useRef(null),E=di(t,S);return TO(),x.jsxs(x.Fragment,{children:[x.jsx(sT,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:d,onUnmountAutoFocus:f,children:x.jsx(ty,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":CO(i.open),..._,ref:E,onDismiss:()=>i.onOpenChange(!1)})}),x.jsxs(x.Fragment,{children:[x.jsx(due,{titleId:i.titleId}),x.jsx(fue,{contentRef:S,descriptionId:i.descriptionId})]})]})}),PO="DialogTitle",O6=B.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,d=gc(PO,n);return x.jsx(En.h2,{id:d.titleId,...o,ref:t})});O6.displayName=PO;var R6="DialogDescription",k6=B.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,d=gc(R6,n);return x.jsx(En.p,{id:d.descriptionId,...o,ref:t})});k6.displayName=R6;var j6="DialogClose",D6=B.forwardRef((e,t)=>{const{__scopeDialog:n,...o}=e,d=gc(j6,n);return x.jsx(En.button,{type:"button",...o,ref:t,onClick:Pr(e.onClick,()=>d.onOpenChange(!1))})});D6.displayName=j6;function CO(e){return e?"open":"closed"}var L6="DialogTitleWarning",[$Fe,N6]=oY(L6,{contentName:Ff,titleName:PO,docsSlug:"dialog"}),due=({titleId:e})=>{const t=N6(L6),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return B.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},hue="DialogDescriptionWarning",fue=({contentRef:e,descriptionId:t})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${N6(hue).contentName}}.`;return B.useEffect(()=>{const d=e.current?.getAttribute("aria-describedby");t&&d&&(document.getElementById(t)||console.warn(o))},[o,e,t]),null},z6=S6,F6=A6,B6=P6,uT=C6,dT=I6,hT=O6,fT=k6,$6=D6;const Zu=z6,V6=F6,pue=B6,U6=B.forwardRef(({className:e,...t},n)=>x.jsx(uT,{ref:n,className:kr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));U6.displayName=uT.displayName;const tu=B.forwardRef(({className:e,children:t,...n},o)=>x.jsxs(pue,{children:[x.jsx(U6,{}),x.jsxs(dT,{ref:o,className:kr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...n,children:[t,x.jsxs($6,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[x.jsx(Tl,{className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));tu.displayName=dT.displayName;const sh=({className:e,...t})=>x.jsx("div",{className:kr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});sh.displayName="DialogHeader";const ax=({className:e,...t})=>x.jsx("div",{className:kr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});ax.displayName="DialogFooter";const Qu=B.forwardRef(({className:e,...t},n)=>x.jsx(hT,{ref:n,className:kr("text-lg font-semibold leading-none tracking-tight",e),...t}));Qu.displayName=hT.displayName;const IO=B.forwardRef(({className:e,...t},n)=>x.jsx(fT,{ref:n,className:kr("text-sm text-muted-foreground",e),...t}));IO.displayName=fT.displayName;const $n=B.forwardRef(({className:e,type:t,...n},o)=>x.jsx("input",{type:t,className:kr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:o,...n}));$n.displayName="Input";const bl=B.forwardRef(({className:e,...t},n)=>x.jsx("textarea",{className:kr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));bl.displayName="Textarea";const mue="https://fakkzdfwpucpgndofgcu.supabase.co",SC="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",gue=typeof window<"u"&&typeof window.localStorage<"u"?window.localStorage:void 0,Sr=ZX(mue,SC,{auth:{storage:gue,persistSession:!0,autoRefreshToken:!0}});try{if(typeof window<"u"&&typeof window.fetch=="function"){const e=window,t=e.fetch.bind(e);e.fetch=async(n,o)=>{try{const d=typeof n=="string"?n:n.url;if(typeof window.localStorage<"u"&&window.localStorage.getItem("debug_supabase")==="1"&&typeof d=="string"&&d.includes(".supabase.co")){const _=SC?`${String(SC).slice(0,6)}...`:"not-set";if(console.groupCollapsed("[supabase-debug] outgoing request to Supabase"),console.log("URL:",d),console.log("Masked publishable key:",_),o?.headers){const i=o.headers instanceof Headers?Object.fromEntries(o.headers.entries()):o.headers;console.log("Request headers:",i),console.log("Authorization:",(i&&(i.Authorization||i.authorization))??null),console.log("apikey:",i?i.apikey??null:null)}console.groupEnd()}}catch{}return t(n,o)}}}catch{}const yue=Object.freeze(Object.defineProperty({__proto__:null,supabase:Sr},Symbol.toStringTag,{value:"Module"}));function TC(e,t="254"){if(!e)return null;let n=e.trim().replace(/[^\d+]/g,"");return n.startsWith("+")&&(n=n.slice(1)),/^0\d{9}$/.test(n)&&(n=`${t}${n.slice(1)}`),new RegExp(`^${t}\\d{9}$`).test(n)?n:null}function Rw(e,t=""){const n=TC(e),o=encodeURIComponent(t.trim());return n?o?`https://wa.me/${n}?text=${o}`:`https://wa.me/${n}`:o?`https://wa.me/?text=${o}`:"https://wa.me/"}function Kd(e){const t=B.useRef(null),[n,o]=B.useState(!1);return B.useEffect(()=>{if(!t.current)return;const d=t.current,f=new IntersectionObserver(_=>{_.forEach(i=>{if(i.isIntersecting){o(!0);try{f.unobserve(i.target)}catch{}}})},{threshold:.15});return f.observe(d),()=>f.disconnect()},[t,e]),{ref:t,inView:n}}const G6=({property:e})=>{const t=Kd(),{id:n,title:o,location:d,price:f,size:_,description:i,seller_phone:S,images:E=[],video_url:I,status:M}=e,j=qU(),[N,G]=B.useState(!1),[z,V]=B.useState(""),[K,Q]=B.useState(""),[X,ie]=B.useState(`I'm interested in ${o}. Kindly share more details.`),J=fae({mutationFn:async Ge=>{const{error:Ke}=await Sr.from("buyer_inquiries").insert([Ge]);if(Ke)throw Ke;return Ge},onSuccess:Ge=>{const Ke=Rw(S||"",Ge.message);G(!1),j.invalidateQueries({queryKey:["properties"]}),window.open(Ke,"_blank")},onError:Ge=>{console.error(Ge),rn({title:"Error",description:Ge?.message||"Failed to record inquiry.",variant:"destructive"})}}),se=Ge=>{if(Ge?.preventDefault(),Ge?.stopPropagation(),!z||!K){rn({title:"Missing info",description:"Please provide your name and phone number.",variant:"destructive"});return}J.mutate({property_id:n,buyer_name:z,buyer_phone:K,message:X})},he=E||[],[we,ze]=B.useState(!1),[je,Oe]=B.useState(0),Be=B.useCallback((Ge,Ke)=>{Ke?.preventDefault(),Ke?.stopPropagation(),Oe(Ge),ze(!0)},[]),qe=B.useCallback(Ge=>{Ge?.stopPropagation(),Oe(Ke=>(Ke-1+he.length)%Math.max(1,he.length))},[he.length]),Xe=B.useCallback(Ge=>{Ge?.stopPropagation(),Oe(Ke=>(Ke+1)%Math.max(1,he.length))},[he.length]);B.useEffect(()=>{if(!we)return;const Ge=Ke=>{Ke.key==="ArrowLeft"&&qe(),Ke.key==="ArrowRight"&&Xe(),Ke.key==="Escape"&&ze(!1)};return window.addEventListener("keydown",Ge),()=>window.removeEventListener("keydown",Ge)},[we,he.length,qe,Xe]);const it=M==="available"?"For Sale":M==="sold"?"Sold":M==="pending"?"Pending":String(M);return x.jsxs(ps,{to:`/property/${n}`,className:"block","aria-label":`View details for ${o}`,children:[x.jsxs("article",{ref:t.ref,style:{transitionDelay:`${e.__delay??0}ms`},className:`group bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-card-hover transition-all duration-300 hover:-translate-y-1 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsxs("div",{className:"relative h-64 overflow-hidden",children:[x.jsxs("button",{onClick:Ge=>Be(0,Ge),className:"block w-full h-full p-0 border-0 bg-transparent cursor-zoom-in","aria-label":`Open gallery for ${o}`,title:"Open gallery",children:[x.jsx("img",{src:he[0]||"/placeholder.svg",alt:o,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-navy/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),x.jsx(Ws,{className:`absolute top-4 left-4 ${it==="For Sale"?"bg-primary text-primary-foreground":it==="Sold"?"bg-destructive text-destructive-foreground":"bg-muted text-muted-foreground"}`,"aria-hidden":!0,children:it}),x.jsxs("div",{className:"absolute bottom-4 left-4 flex gap-2",children:[x.jsxs("span",{className:"flex items-center gap-1 bg-navy/80 text-primary-foreground text-xs px-2 py-1 rounded",children:[x.jsx(rN,{className:"h-3 w-3"}),he.length]}),I&&x.jsxs("span",{className:"flex items-center gap-1 bg-accent/90 text-accent-foreground text-xs px-2 py-1 rounded",children:[x.jsx(gJ,{className:"h-3 w-3"}),"Video"]})]})]}),x.jsxs("div",{className:"p-6",children:[x.jsx("h3",{className:"font-display text-xl font-semibold text-foreground mb-2 line-clamp-1",children:o}),x.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-4",children:[x.jsx(Jc,{className:"h-4 w-4 text-primary"}),x.jsx("span",{className:"text-sm",children:d})]}),x.jsx("div",{className:"flex items-center gap-4 mb-4",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(dJ,{className:"h-4 w-4 text-primary"}),x.jsx("span",{className:"text-sm text-muted-foreground",children:_})]})}),x.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:i}),x.jsx("div",{className:"border-t border-border pt-4",children:x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),x.jsx("p",{className:"font-display text-2xl font-bold text-primary",children:`KES ${Number(f).toLocaleString()}`})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Tr,{variant:"ghost",size:"sm",asChild:!0,children:x.jsxs("a",{href:`tel:${S}`,className:"flex items-center gap-2",onClick:Ge=>Ge.stopPropagation(),"aria-label":`Call seller of ${o}`,children:[x.jsx(Jf,{className:"h-4 w-4"}),"Call"]})}),x.jsxs(Zu,{open:N,onOpenChange:G,children:[x.jsx(V6,{asChild:!0,children:x.jsx(Tr,{size:"sm",onClick:Ge=>(Ge.stopPropagation(),G(!0)),children:"Inquire"})}),x.jsxs(tu,{onClick:Ge=>Ge.stopPropagation(),children:[x.jsx(sh,{children:x.jsx(Qu,{children:"Contact Seller"})}),x.jsxs("div",{className:"grid gap-2",children:[x.jsx($n,{placeholder:"Your name",value:z,onChange:Ge=>V(Ge.target.value)}),x.jsx($n,{placeholder:"Your phone (e.g. 07xxxxxxxx)",value:K,onChange:Ge=>Q(Ge.target.value)}),x.jsx(bl,{value:X,onChange:Ge=>ie(Ge.target.value)})]}),x.jsx(ax,{children:x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Tr,{variant:"outline",onClick:Ge=>{Ge.stopPropagation(),G(!1)},children:"Cancel"}),x.jsx(Tr,{onClick:se,disabled:J.isPending,children:J.isPending?"Sending":"Send & WhatsApp"})]})})]})]})]})]})})]})]}),x.jsx(Zu,{open:we,onOpenChange:ze,children:x.jsx(tu,{onClick:Ge=>Ge.stopPropagation(),children:x.jsxs("div",{className:"flex flex-col items-center gap-4",children:[x.jsx("div",{className:"relative w-full max-w-3xl",children:he.length>0?x.jsxs(x.Fragment,{children:[x.jsx("img",{src:he[je],alt:`${o} (${je+1}/${he.length})`,className:"w-full h-[480px] object-cover rounded"}),x.jsx("button",{"aria-label":"Previous image",className:"absolute left-2 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded",onClick:qe,children:x.jsx(eJ,{className:"h-5 w-5 text-white"})}),x.jsx("button",{"aria-label":"Next image",className:"absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-black/40 rounded",onClick:Xe,children:x.jsx(wM,{className:"h-5 w-5 text-white"})})]}):x.jsx("div",{className:"w-full h-64 bg-muted rounded flex items-center justify-center",children:x.jsx(rN,{})})}),he.length>1&&x.jsx("div",{className:"flex gap-2 overflow-x-auto mt-2",children:he.map((Ge,Ke)=>x.jsx("button",{onClick:ut=>{ut.stopPropagation(),Oe(Ke)},className:`w-20 h-12 rounded overflow-hidden border ${Ke===je?"ring-2 ring-primary":"border-border"}`,"aria-label":`Show image ${Ke+1}`,children:x.jsx("img",{src:Ge,alt:`thumb-${Ke}`,className:"w-full h-full object-cover"})},Ge+Ke))})]})})})]})},_ue=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(null),_=async()=>{o(!0),f(null);try{const{data:i,error:S}=await Sr.from("properties").select("*").eq("status","available").order("created_at",{ascending:!1}).limit(6);if(S)throw S;const I=(i||[]).map(M=>{const N=(M.images||[])[0]||void 0;return{...M,_firstImage:N}});t(I)}catch(i){console.error(i);const S=i instanceof Error?i.message:String(i);f(S||"Failed to load properties")}finally{o(!1)}};return B.useEffect(()=>{_();const i=Sr.channel("properties-realtime").on("postgres_changes",{event:"*",schema:"public",table:"properties"},S=>{console.log("Real-time update:",S),_()}).subscribe();return()=>{Sr.removeChannel(i)}},[]),x.jsx("section",{id:"properties",className:"py-20 bg-secondary",children:x.jsxs("div",{className:"container mx-auto px-4",children:[x.jsxs("div",{className:"text-center mb-12",children:[x.jsx("span",{className:"inline-block text-primary font-semibold text-sm uppercase tracking-widest mb-4",children:"Featured Listings"}),x.jsx("h2",{className:"font-display text-3xl md:text-4xl font-bold text-foreground mb-4",children:"Discover Our Properties"}),x.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Explore verified properties. Click on a property to view details or contact the seller directly."})]}),n?x.jsx("div",{className:"flex justify-center py-12",children:x.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-primary border-t-transparent rounded-full"})}):d?x.jsx("p",{className:"text-center text-red-500",children:d}):e.length===0?x.jsx("p",{className:"text-center text-muted-foreground",children:"No properties available right now."}):x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((i,S)=>x.jsx("div",{className:"animate-slide-up",style:{animationDelay:`${S*.05}s`},children:x.jsx(G6,{property:i})},i.id))}),x.jsx("div",{className:"text-center mt-12",children:x.jsx(Tr,{asChild:!0,size:"lg",children:x.jsxs(ps,{to:"/properties",className:"inline-flex items-center gap-2",children:["View All Properties",x.jsx(dw,{size:18})]})})})]})]})})},Bf=()=>{const e=new Date().getFullYear();return x.jsx("footer",{className:"bg-slate-50 text-slate-700 mt-20 border-t",children:x.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-20 py-12",children:[x.jsxs("div",{className:"grid grid-cols-1 gap-10 md:grid-cols-3",children:[x.jsxs("div",{className:"text-center md:text-left",children:[x.jsx("div",{className:"flex justify-center md:justify-start items-center gap-3 mb-4",children:x.jsx("img",{src:"/julin/logo.png",alt:"Julin Real Estate logo",className:"h-16 md:h-20 lg:h-24 w-auto object-contain"})}),x.jsx("p",{className:"text-sm leading-relaxed text-slate-600 max-w-sm mx-auto md:mx-0",children:"Premium real estate services. Connecting buyers and sellers across Kenya with trust, transparency, and excellence."}),x.jsxs("div",{className:"flex justify-center md:justify-start gap-4 mt-5",children:[x.jsx("a",{href:"#","aria-label":"Facebook",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:x.jsx(nJ,{className:"h-4 w-4"})}),x.jsx("a",{href:"#","aria-label":"Instagram",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:x.jsx(sJ,{className:"h-4 w-4"})}),x.jsx("a",{href:"#","aria-label":"LinkedIn",className:"p-2 rounded-full bg-white shadow hover:text-accent transition",children:x.jsx(lJ,{className:"h-4 w-4"})})]})]}),x.jsxs("div",{className:"text-center md:text-left",children:[x.jsx("h4",{className:"font-semibold text-base mb-4",children:"Quick Links"}),x.jsx("ul",{className:"space-y-2 text-sm",children:[{name:"Home",href:"/"},{name:"Properties",href:"/properties"},{name:"About Us",href:"/about"},{name:"Contact",href:"/contact"}].map(t=>x.jsx("li",{children:x.jsx(ps,{to:t.href,className:"hover:text-accent transition-colors",children:t.name})},t.name))})]}),x.jsxs("div",{className:"text-center md:text-left",children:[x.jsx("h4",{className:"font-semibold text-base mb-4",children:"Contact"}),x.jsxs("ul",{className:"space-y-3 text-sm",children:[x.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[x.jsx(Jf,{className:"h-4 w-4 text-accent"}),x.jsx("a",{href:"tel:+254725671504",className:"hover:text-accent",children:"+254 725 671 504"})]}),x.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[x.jsx(xf,{className:"h-4 w-4 text-accent"}),x.jsx("a",{href:"https://wa.me/254725671504",target:"_blank",rel:"noopener noreferrer",className:"hover:text-accent",children:"WhatsApp"})]}),x.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[x.jsx(US,{className:"h-4 w-4 text-accent"}),x.jsx("a",{href:"mailto:juliusmurigi90@gmail.com",className:"hover:text-accent break-all",children:"juliusmurigi90@gmail.com"})]}),x.jsxs("li",{className:"flex justify-center md:justify-start items-center gap-3",children:[x.jsx(Jc,{className:"h-4 w-4 text-accent"}),x.jsx("span",{children:"Nairobi, Kenya"})]})]})]})]}),x.jsxs("div",{className:"mt-10 pt-6 border-t text-center text-xs text-slate-500",children:[" ",e," Julin Real Estate. All rights reserved."]})]})})};function hc({children:e,className:t="",delay:n=0}){const o=B.useRef(null),d=Fse(o,{once:!0,margin:"-80px"});return x.jsx(mn.div,{ref:o,initial:{opacity:0,y:18},animate:d?{opacity:1,y:0}:{},transition:{duration:.6,delay:n},className:t,children:e})}const vue=()=>x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"Julin Real Estate | Buy & Sell Properties in Kenya"}),x.jsx("meta",{name:"description",content:"Julin Real Estate connects buyers and sellers of real estate properties in Kenya. Find your dream home or list your property today."})]}),x.jsxs("div",{className:"min-h-screen",children:[x.jsx(zf,{}),x.jsxs("main",{className:"pt-28",children:[x.jsx(hc,{children:x.jsx(hce,{})}),x.jsx("section",{className:"container mx-auto px-4",children:x.jsx(hc,{children:x.jsx(_ue,{})})})]}),x.jsx(Bf,{})]})]}),QE=8,xue={hidden:{opacity:0},visible:{opacity:1},exit:{opacity:0}},bue={initial:{y:-20},animate:{y:[-20,0,-20],transition:{duration:6,repeat:1/0}}},wue={initial:{opacity:.3},animate:{opacity:[.3,.7,.3],transition:{duration:4,repeat:1/0}}},Sue=()=>{const e=mc(),t=uy(),[n,o]=B.useState(QE),d=B.useRef(null),f=B.useRef(null);B.useEffect(()=>(d.current=window.setInterval(()=>{o(i=>i<=1?(f.current&&(clearTimeout(f.current),f.current=null),t("/",{replace:!0}),0):i-1)},1e3),f.current=window.setTimeout(()=>{t("/",{replace:!0}),f.current=null},QE*1e3),()=>{d.current&&(clearInterval(d.current),d.current=null),f.current&&(clearTimeout(f.current),f.current=null)}),[e.pathname,e.search,t]);const _=n/QE*100;return x.jsxs(mn.main,{variants:xue,initial:"hidden",animate:"visible",exit:"exit",className:`relative flex min-h-screen items-center justify-center overflow-hidden\r
                 bg-gradient-to-b from-sky-300 via-sky-150 to-white px-4`,children:[x.jsxs(mn.div,{variants:wue,initial:"initial",animate:"animate",children:[x.jsx(Pf,{className:"absolute top-16 left-10 text-sky-400",size:22}),x.jsx(Pf,{className:"absolute top-44 right-20 text-sky-300",size:18}),x.jsx(Pf,{className:"absolute bottom-36 left-28 text-sky-300",size:20})]}),x.jsxs("section",{className:"relative z-10 w-full max-w-xl text-center",children:[x.jsx(mn.div,{variants:bue,initial:"initial",animate:"animate",className:`mx-auto mb-8 flex h-24 w-24 items-center justify-center\r
                     rounded-full bg-sky-300/40 shadow-xl backdrop-blur`,children:x.jsx(pJ,{size:42,className:"text-sky-800"})}),x.jsx("h1",{className:"text-8xl font-extrabold text-sky-500/30 mb-3",children:"404"}),x.jsx("h2",{className:"text-3xl font-bold text-sky-900 mb-4",children:"Lost in Space"}),x.jsxs("p",{className:"text-lg text-sky-700 mb-6 leading-relaxed",children:["The page youre looking for drifted beyond our radar.",x.jsx("br",{}),"Returning you safely home in"," ",x.jsx("span",{className:"font-semibold",children:n})," seconds."]}),x.jsx("div",{className:"mx-auto mb-8 h-2 w-64 overflow-hidden rounded-full bg-sky-200",children:x.jsx(mn.div,{className:"h-full bg-sky-500",initial:{width:"100%"},animate:{width:`${_}%`},transition:{ease:"linear"}})}),x.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[x.jsx(mn.div,{whileHover:{scale:1.06},whileTap:{scale:.96},children:x.jsxs(ps,{to:"/",className:`inline-flex items-center gap-2 rounded-lg\r
                         bg-sky-600 px-6 py-3 font-medium text-white\r
                         shadow-md transition hover:bg-sky-700`,children:[x.jsx(Bc,{size:18}),"Home"]})}),x.jsx(mn.div,{whileHover:{scale:1.06},whileTap:{scale:.96},children:x.jsxs("button",{onClick:()=>t(-1),className:`inline-flex items-center gap-2 rounded-lg\r
                         border border-sky-300 px-6 py-3 font-medium\r
                         text-sky-700 transition hover:bg-sky-100`,children:[x.jsx(LP,{size:18}),"Back"]})})]})]})]})},Tue=()=>{const{pathname:e}=mc();return B.useEffect(()=>{try{typeof window<"u"&&window.scrollTo&&window.scrollTo({top:0,left:0,behavior:"instant"})}catch{}},[e]),null};function Aue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"}))}const Eue=B.forwardRef(Aue);function Pue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"}))}const Cue=B.forwardRef(Pue);function Iue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const Mue=B.forwardRef(Iue);function Oue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}))}const Rue=B.forwardRef(Oue);function kue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const jue=B.forwardRef(kue);function Due({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}const Lue=B.forwardRef(Due);function Nue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"}))}const H6=B.forwardRef(Nue);function zue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const Fue=B.forwardRef(zue);function Bue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const AC=B.forwardRef(Bue);function $ue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0 1 12 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 0 1 3 12c0-1.605.42-3.113 1.157-4.418"}))}const Vue=B.forwardRef($ue);function Uue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}const W6=B.forwardRef(Uue);function Gue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"}))}const Hue=B.forwardRef(Gue);function Wue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))}const que=B.forwardRef(Wue);function Zue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const Kue=B.forwardRef(Zue);function Xue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Yue=B.forwardRef(Xue);function Jue({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"}))}const Que=B.forwardRef(Jue);function ede({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z"}))}const tde=B.forwardRef(ede);function rde({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))}const nde=B.forwardRef(rde);function ide({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"}))}const ode=B.forwardRef(ide);function sde({title:e,titleId:t,...n},o){return B.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":t},n),e?B.createElement("title",{id:t},e):null,B.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const ade=B.forwardRef(sde);function lde(){const[e,t]=B.useState(0);return B.useEffect(()=>{const n=()=>{const o=window.scrollY||document.documentElement.scrollTop,d=document.documentElement.scrollHeight-document.documentElement.clientHeight,f=d>0?Math.min(100,o/d*100):0;t(f)};return window.addEventListener("scroll",n,{passive:!0}),n(),()=>window.removeEventListener("scroll",n)},[]),x.jsx("div",{className:"absolute left-0 top-0 right-0 h-0 pointer-events-none",children:x.jsx("div",{className:"h-0.5 bg-gradient-to-r from-blue-500 to-cyan-400 transition-width duration-150",style:{width:`${e}%`}})})}const q6=B.createContext({user:null,isAdmin:!1,loading:!0,signInWithEmail:async()=>{},signOut:async()=>{}}),lx=()=>B.useContext(q6),cde=()=>{const[e,t]=B.useState(!0),{user:n,isAdmin:o,loading:d}=lx(),f=mc(),_=uy(),i=[{href:"/admin",label:"Dashboard",icon:tde},{href:"/admin/analytics",label:"Analytics",icon:Rue},{href:"/admin/properties",label:"Properties",icon:W6},{href:"/admin/chats",label:"Chat Analytics",icon:Lue},{href:"/admin/blogs",label:"Blog Posts",icon:AC},{href:"/admin/submissions",label:"Submissions",icon:AC},{href:"/admin/inquiries",label:"Buyer Inquiries",icon:H6},{href:"/admin/profile",label:"Profile",icon:Fue}],S=I=>f.pathname===I;B.useEffect(()=>{!d&&!n&&_("/admin/login")},[n,d,_]),B.useEffect(()=>{const I=M=>{(M.ctrlKey||M.metaKey)&&M.key.toLowerCase()==="b"&&(M.preventDefault(),t(j=>!j))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[]);const E=async()=>{await Sr.auth.signOut(),rn({title:"Logged out",description:"See you next time!"}),_("/admin/login")};return d?x.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900 flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"animate-spin inline-block w-10 h-10 border-4 border-slate-300 border-t-blue-600 rounded-full mb-4"}),x.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Loading..."})]})}):n?x.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900",children:[x.jsxs(mn.aside,{className:"fixed left-0 top-0 h-screen bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-700 z-50",animate:{width:e?256:80},transition:{type:"spring",stiffness:260,damping:30},children:[x.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e&&x.jsx("h1",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"JulinHub"}),x.jsx("button",{onClick:()=>t(!e),className:"ml-auto p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800","aria-label":"Toggle sidebar",children:e?x.jsx(ade,{className:"h-5 w-5"}):x.jsx(Mue,{className:"h-5 w-5"})})]}),x.jsx("nav",{className:"flex-1 p-4 space-y-2",children:i.map(I=>{const M=I.icon;return x.jsxs(ps,{to:I.href,className:`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${S(I.href)?"bg-blue-50 dark:bg-blue-950 text-blue-600 dark:text-blue-400 font-medium":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800"}`,children:[x.jsx(mn.div,{whileHover:{x:-4},className:"flex-shrink-0",children:x.jsx(M,{className:"h-5 w-5"})}),e&&x.jsx("span",{children:I.label})]},I.href)})}),x.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:[e&&n&&x.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[x.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center",children:x.jsx(nde,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white truncate",children:n.email}),x.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Admin"})]})]}),x.jsx("button",{onClick:E,className:`w-full text-left p-2 rounded-md text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-950 ${e?"":"px-3"}`,children:x.jsxs("div",{className:"inline-flex items-center gap-3",children:[x.jsx(Eue,{className:"h-5 w-5 flex-shrink-0 text-red-600 dark:text-red-400"}),e&&x.jsx("span",{className:"ml-1",children:"Logout"})]})})]})]}),x.jsxs(mn.main,{className:"transition-all duration-300 relative",animate:{marginLeft:e?256:80},transition:{type:"spring",stiffness:260,damping:30},children:[x.jsx(lde,{}),x.jsx("div",{className:"p-6 md:p-8",children:x.jsx(nle,{})})]})]}):null},ude=()=>{const[e,t]=B.useState(""),[n,o]=B.useState(""),[d,f]=B.useState(!1),[_,i]=B.useState(!1),S=uy(),E=async I=>{if(I.preventDefault(),console.log("[admin-login] handleAuth start",{email:!!e,passwordSet:!!n}),!e.trim()||!n.trim()){rn({title:"Missing fields",description:"Please enter email and password",variant:"destructive"});return}if(n.length<6){rn({title:"Password too short",description:"Password must be at least 6 characters",variant:"destructive"});return}i(!0);try{const{data:M,error:j}=await Sr.auth.signInWithPassword({email:e.trim(),password:n.trim()});if(console.debug("[admin-login] signInWithPassword response:",{data:M,error:j}),j)throw console.error("[admin-login] sign in error",j),j;const N=`${window.location.origin}/julin/`.replace(/\/$/,""),G=()=>{try{window.location.href=`${N}#/admin`}catch{S("/admin")}};if(M?.session){rn({title:"Welcome back!",description:"Logged in successfully"}),G();return}const z=Date.now();let V=!1;for(;Date.now()-z<3e3;){try{if((await Sr.auth.getSession())?.data?.session){V=!0;break}}catch{}await new Promise(K=>setTimeout(K,250))}if(V||M?.user){rn({title:"Welcome back!",description:"Logged in successfully"}),G();return}rn({title:"Check your email",description:"Sign-in did not create a session. Check your email for a confirmation link or complete any required steps.",variant:"destructive"})}catch(M){console.error("Auth error:",M);const j=M instanceof Error?M.message:String(M);rn({title:"Login failed",description:j||"An error occurred",variant:"destructive"})}finally{i(!1)}};return x.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4",children:x.jsxs("div",{className:"w-full max-w-md",children:[x.jsxs("div",{className:"text-center mb-8",children:[x.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"JulinHub"}),x.jsx("p",{className:"text-slate-400",children:"Admin Portal"})]}),x.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-8",children:[x.jsxs("div",{className:"text-center mb-6",children:[x.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-full mb-4",children:x.jsx(fw,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),x.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Admin Login"}),x.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Sign in to manage properties"})]}),x.jsxs("form",{onSubmit:E,className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Email"}),x.jsxs("div",{className:"relative",children:[x.jsx(US,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),x.jsx($n,{type:"email",placeholder:"admin@example.com",value:e,onChange:I=>t(I.target.value),className:"pl-10",disabled:_,autoComplete:"username"})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Password"}),x.jsxs("div",{className:"relative",children:[x.jsx(fw,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),x.jsx($n,{type:d?"text":"password",placeholder:"",value:n,onChange:I=>o(I.target.value),className:"pl-10 pr-10",disabled:_,autoComplete:"current-password"}),x.jsx("button",{type:"button",onClick:()=>f(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:d?x.jsx(f$,{className:"w-5 h-5"}):x.jsx($c,{className:"w-5 h-5"})})]})]}),x.jsx(Tr,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:_,children:_?"Signing in...":"Sign In"})]}),x.jsx("div",{className:"mt-6 text-center",children:x.jsx("a",{href:"/",className:"text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400",children:" Back to Website"})})]}),x.jsx("p",{className:"text-center text-slate-500 text-sm mt-6",children:"Julin Real Estate Admin Portal"})]})})};function dde(){return x.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Dashboard"}),x.jsx("p",{className:"text-muted-foreground mt-1",children:"Quick overview  manage properties, submissions and leads"})]}),x.jsxs("div",{className:"flex gap-3 flex-wrap",children:[x.jsx(Tr,{asChild:!0,className:"bg-primary hover:bg-primary/90",children:x.jsxs(ps,{to:"/admin/properties",className:"inline-flex items-center gap-2",children:[x.jsx(W6,{className:"h-5 w-5"}),x.jsx("span",{children:"Properties"})]})}),x.jsx(Tr,{variant:"outline",asChild:!0,children:x.jsxs(ps,{to:"/admin/submissions",className:"inline-flex items-center gap-2",children:[x.jsx(AC,{className:"h-5 w-5"}),x.jsx("span",{children:"Submissions"})]})})]})]})}function hde({counts:e}){return x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-400",children:"Total Properties"}),x.jsx("p",{className:"text-3xl font-bold text-slate-900 dark:text-white mt-2",children:e.properties}),x.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-3",children:x.jsxs("span",{className:"inline-block bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-400 px-2 py-1 rounded",children:[e.verified," verified"]})})]}),x.jsx("div",{className:"bg-primary/5 p-3 rounded-lg",children:x.jsx(Bc,{size:24,className:"text-primary"})})]})}),x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Submissions"}),x.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:e.submissions}),x.jsx(Tr,{asChild:!0,size:"sm",variant:"ghost",className:"mt-3 h-auto p-0 text-xs text-primary",children:x.jsxs(ps,{to:"/admin/submissions",className:"inline-flex items-center gap-1",children:["Review submissions ",x.jsx(dw,{size:14})]})})]}),x.jsx("div",{className:"bg-orange-50 dark:bg-orange-950 p-3 rounded-lg",children:x.jsx(h$,{size:24,className:"text-orange-600 dark:text-orange-400"})})]})}),x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Buyer Inquiries"}),x.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:e.inquiries}),x.jsx(Tr,{asChild:!0,size:"sm",variant:"ghost",className:"mt-3 h-auto p-0 text-xs text-primary",children:x.jsxs(ps,{to:"/admin/inquiries",className:"inline-flex items-center gap-1",children:["View leads ",x.jsx(dw,{size:14})]})})]}),x.jsx("div",{className:"bg-purple-50 dark:bg-purple-950 p-3 rounded-lg",children:x.jsx(fJ,{size:24,className:"text-purple-600 dark:text-purple-400"})})]})}),x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:x.jsxs("div",{className:"flex items-start justify-between",children:[x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),x.jsx("p",{className:"text-3xl font-bold text-foreground mt-2",children:"Active"}),x.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"All systems operational"})]}),x.jsx("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-lg",children:x.jsx(VS,{size:24,className:"text-green-600 dark:text-green-400"})})]})})]})}function h0({children:e,stagger:t=.06}){const n=B.Children.toArray(e);return x.jsx(x.Fragment,{children:n.map((o,d)=>x.jsx(hc,{delay:d*t,children:o},d))})}function fde({submissions:e,loading:t,onApprove:n,onReject:o}){return x.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[x.jsx("div",{className:"flex items-center justify-between mb-4",children:x.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Submissions"})}),t?x.jsx("div",{className:"space-y-3",children:[1,2,3].map(d=>x.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},d))}):e.length===0?x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent submissions"}):x.jsx("div",{className:"space-y-3",children:x.jsx(h0,{children:e.map(d=>x.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:[x.jsxs("div",{className:"flex gap-3",children:[d._firstImage?x.jsx("img",{src:d._firstImage,alt:d.title,className:"w-16 h-12 object-cover rounded flex-shrink-0"}):x.jsx("div",{className:"w-16 h-12 bg-slate-300 dark:bg-slate-600 rounded flex-shrink-0"}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:d.title}),x.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 truncate",children:d.seller_name}),x.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["KES ",Number(d.price||0).toLocaleString()]})]})]}),x.jsxs("div",{className:"flex gap-2 mt-2",children:[x.jsx(Tr,{size:"sm",variant:"destructive",className:"flex-1 h-7 text-xs",onClick:()=>o(d),children:"Reject"}),x.jsx(Tr,{size:"sm",className:"flex-1 h-7 text-xs bg-green-600 hover:bg-green-700",onClick:()=>n(d),children:"Approve"})]})]},d.id))})})]})}function pde({inquiries:e,loading:t}){return x.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[x.jsx("div",{className:"flex items-center justify-between mb-4",children:x.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Inquiries"})}),t?x.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>x.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},n))}):e.length===0?x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent inquiries"}):x.jsx("div",{className:"space-y-3",children:x.jsx(h0,{children:e.map(n=>x.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:x.jsxs("div",{className:"flex items-start justify-between gap-2",children:[x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm",children:n.buyer_name}),x.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mt-1",children:[" ",n.buyer_phone]}),x.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2 line-clamp-2",children:[(n.message||"").slice(0,60),(n.message||"").length>60?"...":""]})]}),x.jsx(Ws,{variant:"outline",className:`flex-shrink-0 text-xs ${n.lead_status==="hot"?"bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-400 border-red-200 dark:border-red-700":n.lead_status==="warm"?"bg-orange-50 dark:bg-orange-950 text-orange-700 dark:text-orange-400 border-orange-200 dark:border-orange-700":"bg-primary/5 text-primary border-primary/20"}`,children:n.lead_status||"Warm"})]})},n.id))})})]})}function mde({properties:e,loading:t}){return x.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6",children:[x.jsx("div",{className:"flex items-center justify-between mb-4",children:x.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Recent Properties"})}),t?x.jsx("div",{className:"space-y-3",children:[1,2,3].map(n=>x.jsx("div",{className:"h-20 bg-slate-100 dark:bg-slate-700 rounded animate-pulse"},n))}):e.length===0?x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-6 text-center",children:"No recent properties"}):x.jsx("div",{className:"space-y-3",children:x.jsx(h0,{children:e.map(n=>x.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors",children:x.jsxs("div",{className:"flex gap-3",children:[n._firstImage?x.jsx("img",{src:n._firstImage,alt:n.title,className:"w-16 h-12 object-cover rounded flex-shrink-0"}):x.jsx("div",{className:"w-16 h-12 bg-slate-300 dark:bg-slate-600 rounded flex-shrink-0"}),x.jsxs("div",{className:"flex-1 min-w-0",children:[x.jsx("h3",{className:"font-medium text-slate-900 dark:text-white text-sm truncate",children:n.title}),x.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 truncate",children:n.location}),x.jsxs("div",{className:"flex items-center justify-between mt-1",children:[x.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["KES ",Number(n.price||0).toLocaleString()]}),n.is_verified&&x.jsx(Ws,{variant:"secondary",className:"text-xs h-5",children:" Verified"})]})]})]})},n.id))})})]})}function gde({open:e,action:t,item:n,onClose:o,onConfirm:d}){return x.jsx(Zu,{open:e,onOpenChange:o,children:x.jsxs(tu,{children:[x.jsx(sh,{children:x.jsx(Qu,{className:"text-lg",children:t==="approve"?" Approve Submission":" Reject Submission"})}),x.jsx("div",{className:"py-4",children:t==="approve"?x.jsxs("p",{className:"text-slate-700 dark:text-slate-300",children:["Are you sure you want to approve and publish ",x.jsx("strong",{children:n?.title}),"? It will be visible to buyers immediately."]}):x.jsxs("p",{className:"text-slate-700 dark:text-slate-300",children:["Are you sure you want to reject ",x.jsx("strong",{children:n?.title}),"? The seller will be notified."]})}),x.jsx(ax,{children:x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Tr,{variant:"outline",onClick:o,children:"Cancel"}),x.jsx(Tr,{className:t==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",onClick:d,children:t==="approve"?"Approve":"Reject"})]})})]})})}const _o=B.forwardRef(({className:e,...t},n)=>x.jsx("div",{ref:n,className:kr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));_o.displayName="Card";const vo=B.forwardRef(({className:e,...t},n)=>x.jsx("div",{ref:n,className:kr("flex flex-col space-y-1.5 p-6",e),...t}));vo.displayName="CardHeader";const xo=B.forwardRef(({className:e,...t},n)=>x.jsx("h3",{ref:n,className:kr("text-2xl font-semibold leading-none tracking-tight",e),...t}));xo.displayName="CardTitle";const EC=B.forwardRef(({className:e,...t},n)=>x.jsx("p",{ref:n,className:kr("text-sm text-muted-foreground",e),...t}));EC.displayName="CardDescription";const bo=B.forwardRef(({className:e,...t},n)=>x.jsx("div",{ref:n,className:kr("p-6 pt-0",e),...t}));bo.displayName="CardContent";const yde=B.forwardRef(({className:e,...t},n)=>x.jsx("div",{ref:n,className:kr("flex items-center p-6 pt-0",e),...t}));yde.displayName="CardFooter";var _de=Array.isArray,Ea=_de,vde=typeof zv=="object"&&zv&&zv.Object===Object&&zv,Z6=vde,xde=Z6,bde=typeof self=="object"&&self&&self.Object===Object&&self,wde=xde||bde||Function("return this")(),ou=wde,Sde=ou,Tde=Sde.Symbol,cx=Tde,yz=cx,K6=Object.prototype,Ade=K6.hasOwnProperty,Ede=K6.toString,Cv=yz?yz.toStringTag:void 0;function Pde(e){var t=Ade.call(e,Cv),n=e[Cv];try{e[Cv]=void 0;var o=!0}catch{}var d=Ede.call(e);return o&&(t?e[Cv]=n:delete e[Cv]),d}var Cde=Pde,Ide=Object.prototype,Mde=Ide.toString;function Ode(e){return Mde.call(e)}var Rde=Ode,_z=cx,kde=Cde,jde=Rde,Dde="[object Null]",Lde="[object Undefined]",vz=_z?_z.toStringTag:void 0;function Nde(e){return e==null?e===void 0?Lde:Dde:vz&&vz in Object(e)?kde(e):jde(e)}var ed=Nde;function zde(e){return e!=null&&typeof e=="object"}var td=zde,Fde=ed,Bde=td,$de="[object Symbol]";function Vde(e){return typeof e=="symbol"||Bde(e)&&Fde(e)==$de}var dy=Vde,Ude=Ea,Gde=dy,Hde=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Wde=/^\w*$/;function qde(e,t){if(Ude(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Gde(e)?!0:Wde.test(e)||!Hde.test(e)||t!=null&&e in Object(t)}var MO=qde;function Zde(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var ah=Zde;const hy=Ni(ah);var Kde=ed,Xde=ah,Yde="[object AsyncFunction]",Jde="[object Function]",Qde="[object GeneratorFunction]",ehe="[object Proxy]";function the(e){if(!Xde(e))return!1;var t=Kde(e);return t==Jde||t==Qde||t==Yde||t==ehe}var OO=the;const Vn=Ni(OO);var rhe=ou,nhe=rhe["__core-js_shared__"],ihe=nhe,eP=ihe,xz=function(){var e=/[^.]+$/.exec(eP&&eP.keys&&eP.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function ohe(e){return!!xz&&xz in e}var she=ohe,ahe=Function.prototype,lhe=ahe.toString;function che(e){if(e!=null){try{return lhe.call(e)}catch{}try{return e+""}catch{}}return""}var X6=che,uhe=OO,dhe=she,hhe=ah,fhe=X6,phe=/[\\^$.*+?()[\]{}|]/g,mhe=/^\[object .+?Constructor\]$/,ghe=Function.prototype,yhe=Object.prototype,_he=ghe.toString,vhe=yhe.hasOwnProperty,xhe=RegExp("^"+_he.call(vhe).replace(phe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function bhe(e){if(!hhe(e)||dhe(e))return!1;var t=uhe(e)?xhe:mhe;return t.test(fhe(e))}var whe=bhe;function She(e,t){return e?.[t]}var The=She,Ahe=whe,Ehe=The;function Phe(e,t){var n=Ehe(e,t);return Ahe(n)?n:void 0}var ep=Phe,Che=ep,Ihe=Che(Object,"create"),pT=Ihe,bz=pT;function Mhe(){this.__data__=bz?bz(null):{},this.size=0}var Ohe=Mhe;function Rhe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var khe=Rhe,jhe=pT,Dhe="__lodash_hash_undefined__",Lhe=Object.prototype,Nhe=Lhe.hasOwnProperty;function zhe(e){var t=this.__data__;if(jhe){var n=t[e];return n===Dhe?void 0:n}return Nhe.call(t,e)?t[e]:void 0}var Fhe=zhe,Bhe=pT,$he=Object.prototype,Vhe=$he.hasOwnProperty;function Uhe(e){var t=this.__data__;return Bhe?t[e]!==void 0:Vhe.call(t,e)}var Ghe=Uhe,Hhe=pT,Whe="__lodash_hash_undefined__";function qhe(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Hhe&&t===void 0?Whe:t,this}var Zhe=qhe,Khe=Ohe,Xhe=khe,Yhe=Fhe,Jhe=Ghe,Qhe=Zhe;function fy(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}fy.prototype.clear=Khe;fy.prototype.delete=Xhe;fy.prototype.get=Yhe;fy.prototype.has=Jhe;fy.prototype.set=Qhe;var efe=fy;function tfe(){this.__data__=[],this.size=0}var rfe=tfe;function nfe(e,t){return e===t||e!==e&&t!==t}var RO=nfe,ife=RO;function ofe(e,t){for(var n=e.length;n--;)if(ife(e[n][0],t))return n;return-1}var mT=ofe,sfe=mT,afe=Array.prototype,lfe=afe.splice;function cfe(e){var t=this.__data__,n=sfe(t,e);if(n<0)return!1;var o=t.length-1;return n==o?t.pop():lfe.call(t,n,1),--this.size,!0}var ufe=cfe,dfe=mT;function hfe(e){var t=this.__data__,n=dfe(t,e);return n<0?void 0:t[n][1]}var ffe=hfe,pfe=mT;function mfe(e){return pfe(this.__data__,e)>-1}var gfe=mfe,yfe=mT;function _fe(e,t){var n=this.__data__,o=yfe(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this}var vfe=_fe,xfe=rfe,bfe=ufe,wfe=ffe,Sfe=gfe,Tfe=vfe;function py(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}py.prototype.clear=xfe;py.prototype.delete=bfe;py.prototype.get=wfe;py.prototype.has=Sfe;py.prototype.set=Tfe;var gT=py,Afe=ep,Efe=ou,Pfe=Afe(Efe,"Map"),kO=Pfe,wz=efe,Cfe=gT,Ife=kO;function Mfe(){this.size=0,this.__data__={hash:new wz,map:new(Ife||Cfe),string:new wz}}var Ofe=Mfe;function Rfe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var kfe=Rfe,jfe=kfe;function Dfe(e,t){var n=e.__data__;return jfe(t)?n[typeof t=="string"?"string":"hash"]:n.map}var yT=Dfe,Lfe=yT;function Nfe(e){var t=Lfe(this,e).delete(e);return this.size-=t?1:0,t}var zfe=Nfe,Ffe=yT;function Bfe(e){return Ffe(this,e).get(e)}var $fe=Bfe,Vfe=yT;function Ufe(e){return Vfe(this,e).has(e)}var Gfe=Ufe,Hfe=yT;function Wfe(e,t){var n=Hfe(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this}var qfe=Wfe,Zfe=Ofe,Kfe=zfe,Xfe=$fe,Yfe=Gfe,Jfe=qfe;function my(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}my.prototype.clear=Zfe;my.prototype.delete=Kfe;my.prototype.get=Xfe;my.prototype.has=Yfe;my.prototype.set=Jfe;var jO=my,Y6=jO,Qfe="Expected a function";function DO(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Qfe);var n=function(){var o=arguments,d=t?t.apply(this,o):o[0],f=n.cache;if(f.has(d))return f.get(d);var _=e.apply(this,o);return n.cache=f.set(d,_)||f,_};return n.cache=new(DO.Cache||Y6),n}DO.Cache=Y6;var J6=DO;const epe=Ni(J6);var tpe=J6,rpe=500;function npe(e){var t=tpe(e,function(o){return n.size===rpe&&n.clear(),o}),n=t.cache;return t}var ipe=npe,ope=ipe,spe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ape=/\\(\\)?/g,lpe=ope(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(spe,function(n,o,d,f){t.push(d?f.replace(ape,"$1"):o||n)}),t}),cpe=lpe;function upe(e,t){for(var n=-1,o=e==null?0:e.length,d=Array(o);++n<o;)d[n]=t(e[n],n,e);return d}var LO=upe,Sz=cx,dpe=LO,hpe=Ea,fpe=dy,ppe=1/0,Tz=Sz?Sz.prototype:void 0,Az=Tz?Tz.toString:void 0;function Q6(e){if(typeof e=="string")return e;if(hpe(e))return dpe(e,Q6)+"";if(fpe(e))return Az?Az.call(e):"";var t=e+"";return t=="0"&&1/e==-ppe?"-0":t}var mpe=Q6,gpe=mpe;function ype(e){return e==null?"":gpe(e)}var e8=ype,_pe=Ea,vpe=MO,xpe=cpe,bpe=e8;function wpe(e,t){return _pe(e)?e:vpe(e,t)?[e]:xpe(bpe(e))}var t8=wpe,Spe=dy,Tpe=1/0;function Ape(e){if(typeof e=="string"||Spe(e))return e;var t=e+"";return t=="0"&&1/e==-Tpe?"-0":t}var _T=Ape,Epe=t8,Ppe=_T;function Cpe(e,t){t=Epe(t,e);for(var n=0,o=t.length;e!=null&&n<o;)e=e[Ppe(t[n++])];return n&&n==o?e:void 0}var NO=Cpe,Ipe=NO;function Mpe(e,t,n){var o=e==null?void 0:Ipe(e,t);return o===void 0?n:o}var r8=Mpe;const Ka=Ni(r8);function Ope(e){return e==null}var Rpe=Ope;const Jn=Ni(Rpe);var kpe=ed,jpe=Ea,Dpe=td,Lpe="[object String]";function Npe(e){return typeof e=="string"||!jpe(e)&&Dpe(e)&&kpe(e)==Lpe}var zpe=Npe;const $f=Ni(zpe);var n8={exports:{}},Gi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zO=Symbol.for("react.element"),FO=Symbol.for("react.portal"),vT=Symbol.for("react.fragment"),xT=Symbol.for("react.strict_mode"),bT=Symbol.for("react.profiler"),wT=Symbol.for("react.provider"),ST=Symbol.for("react.context"),Fpe=Symbol.for("react.server_context"),TT=Symbol.for("react.forward_ref"),AT=Symbol.for("react.suspense"),ET=Symbol.for("react.suspense_list"),PT=Symbol.for("react.memo"),CT=Symbol.for("react.lazy"),Bpe=Symbol.for("react.offscreen"),i8;i8=Symbol.for("react.module.reference");function El(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case zO:switch(e=e.type,e){case vT:case bT:case xT:case AT:case ET:return e;default:switch(e=e&&e.$$typeof,e){case Fpe:case ST:case TT:case CT:case PT:case wT:return e;default:return t}}case FO:return t}}}Gi.ContextConsumer=ST;Gi.ContextProvider=wT;Gi.Element=zO;Gi.ForwardRef=TT;Gi.Fragment=vT;Gi.Lazy=CT;Gi.Memo=PT;Gi.Portal=FO;Gi.Profiler=bT;Gi.StrictMode=xT;Gi.Suspense=AT;Gi.SuspenseList=ET;Gi.isAsyncMode=function(){return!1};Gi.isConcurrentMode=function(){return!1};Gi.isContextConsumer=function(e){return El(e)===ST};Gi.isContextProvider=function(e){return El(e)===wT};Gi.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===zO};Gi.isForwardRef=function(e){return El(e)===TT};Gi.isFragment=function(e){return El(e)===vT};Gi.isLazy=function(e){return El(e)===CT};Gi.isMemo=function(e){return El(e)===PT};Gi.isPortal=function(e){return El(e)===FO};Gi.isProfiler=function(e){return El(e)===bT};Gi.isStrictMode=function(e){return El(e)===xT};Gi.isSuspense=function(e){return El(e)===AT};Gi.isSuspenseList=function(e){return El(e)===ET};Gi.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===vT||e===bT||e===xT||e===AT||e===ET||e===Bpe||typeof e=="object"&&e!==null&&(e.$$typeof===CT||e.$$typeof===PT||e.$$typeof===wT||e.$$typeof===ST||e.$$typeof===TT||e.$$typeof===i8||e.getModuleId!==void 0)};Gi.typeOf=El;n8.exports=Gi;var $pe=n8.exports,Vpe=ed,Upe=td,Gpe="[object Number]";function Hpe(e){return typeof e=="number"||Upe(e)&&Vpe(e)==Gpe}var o8=Hpe;const Wpe=Ni(o8);var qpe=o8;function Zpe(e){return qpe(e)&&e!=+e}var Kpe=Zpe;const ux=Ni(Kpe);var ia=function(t){return t===0?0:t>0?1:-1},Sf=function(t){return $f(t)&&t.indexOf("%")===t.length-1},vr=function(t){return Wpe(t)&&!ux(t)},Xpe=function(t){return Jn(t)},fs=function(t){return vr(t)||$f(t)},Ype=0,gy=function(t){var n=++Ype;return"".concat(t||"").concat(n)},oa=function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!vr(t)&&!$f(t))return o;var f;if(Sf(t)){var _=t.indexOf("%");f=n*parseFloat(t.slice(0,_))/100}else f=+t;return ux(f)&&(f=o),d&&f>n&&(f=n),f},Hd=function(t){if(!t)return null;var n=Object.keys(t);return n&&n.length?t[n[0]]:null},Jpe=function(t){if(!Array.isArray(t))return!1;for(var n=t.length,o={},d=0;d<n;d++)if(!o[t[d]])o[t[d]]=!0;else return!0;return!1},Wa=function(t,n){return vr(t)&&vr(n)?function(o){return t+o*(n-t)}:function(){return n}};function kw(e,t,n){return!e||!e.length?null:e.find(function(o){return o&&(typeof t=="function"?t(o):Ka(o,t))===n})}var Qpe=function(t,n){return vr(t)&&vr(n)?t-n:$f(t)&&$f(n)?t.localeCompare(n):t instanceof Date&&n instanceof Date?t.getTime()-n.getTime():String(t).localeCompare(String(n))};function _g(e,t){for(var n in e)if({}.hasOwnProperty.call(e,n)&&(!{}.hasOwnProperty.call(t,n)||e[n]!==t[n]))return!1;for(var o in t)if({}.hasOwnProperty.call(t,o)&&!{}.hasOwnProperty.call(e,o))return!1;return!0}function PC(e){"@babel/helpers - typeof";return PC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},PC(e)}var eme=["viewBox","children"],tme=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],Ez=["points","pathLength"],tP={svg:eme,polygon:Ez,polyline:Ez},BO=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],jw=function(t,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var o=t;if(B.isValidElement(t)&&(o=t.props),!hy(o))return null;var d={};return Object.keys(o).forEach(function(f){BO.includes(f)&&(d[f]=n||function(_){return o[f](o,_)})}),d},rme=function(t,n,o){return function(d){return t(n,o,d),null}},Vf=function(t,n,o){if(!hy(t)||PC(t)!=="object")return null;var d=null;return Object.keys(t).forEach(function(f){var _=t[f];BO.includes(f)&&typeof _=="function"&&(d||(d={}),d[f]=rme(_,n,o))}),d},nme=["children"],ime=["children"];function Pz(e,t){if(e==null)return{};var n=ome(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function ome(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function CC(e){"@babel/helpers - typeof";return CC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},CC(e)}var Cz={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Vu=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},Iz=null,rP=null,$O=function e(t){if(t===Iz&&Array.isArray(rP))return rP;var n=[];return B.Children.forEach(t,function(o){Jn(o)||($pe.isFragment(o)?n=n.concat(e(o.props.children)):n.push(o))}),rP=n,Iz=t,n};function Xa(e,t){var n=[],o=[];return Array.isArray(t)?o=t.map(function(d){return Vu(d)}):o=[Vu(t)],$O(e).forEach(function(d){var f=Ka(d,"type.displayName")||Ka(d,"type.name");o.indexOf(f)!==-1&&n.push(d)}),n}function Ua(e,t){var n=Xa(e,t);return n&&n[0]}var Mz=function(t){if(!t||!t.props)return!1;var n=t.props,o=n.width,d=n.height;return!(!vr(o)||o<=0||!vr(d)||d<=0)},sme=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],ame=function(t){return t&&t.type&&$f(t.type)&&sme.indexOf(t.type)>=0},lme=function(t){return t&&CC(t)==="object"&&"clipDot"in t},cme=function(t,n,o,d){var f,_=(f=tP?.[d])!==null&&f!==void 0?f:[];return n.startsWith("data-")||!Vn(t)&&(d&&_.includes(n)||tme.includes(n))||o&&BO.includes(n)},Tn=function(t,n,o){if(!t||typeof t=="function"||typeof t=="boolean")return null;var d=t;if(B.isValidElement(t)&&(d=t.props),!hy(d))return null;var f={};return Object.keys(d).forEach(function(_){var i;cme((i=d)===null||i===void 0?void 0:i[_],_,n,o)&&(f[_]=d[_])}),f},IC=function e(t,n){if(t===n)return!0;var o=B.Children.count(t);if(o!==B.Children.count(n))return!1;if(o===0)return!0;if(o===1)return Oz(Array.isArray(t)?t[0]:t,Array.isArray(n)?n[0]:n);for(var d=0;d<o;d++){var f=t[d],_=n[d];if(Array.isArray(f)||Array.isArray(_)){if(!e(f,_))return!1}else if(!Oz(f,_))return!1}return!0},Oz=function(t,n){if(Jn(t)&&Jn(n))return!0;if(!Jn(t)&&!Jn(n)){var o=t.props||{},d=o.children,f=Pz(o,nme),_=n.props||{},i=_.children,S=Pz(_,ime);return d&&i?_g(f,S)&&IC(d,i):!d&&!i?_g(f,S):!1}return!1},Rz=function(t,n){var o=[],d={};return $O(t).forEach(function(f,_){if(ame(f))o.push(f);else if(f){var i=Vu(f.type),S=n[i]||{},E=S.handler,I=S.once;if(E&&(!I||!d[i])){var M=E(f,i,_);o.push(M),d[i]=!0}}}),o},ume=function(t){var n=t&&t.type;return n&&Cz[n]?Cz[n]:null},dme=function(t,n){return $O(n).indexOf(t)},hme=["children","width","height","viewBox","className","style","title","desc"];function MC(){return MC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},MC.apply(this,arguments)}function fme(e,t){if(e==null)return{};var n=pme(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function pme(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function OC(e){var t=e.children,n=e.width,o=e.height,d=e.viewBox,f=e.className,_=e.style,i=e.title,S=e.desc,E=fme(e,hme),I=d||{width:n,height:o,x:0,y:0},M=ni("recharts-surface",f);return Le.createElement("svg",MC({},Tn(E,!0,"svg"),{className:M,width:n,height:o,style:_,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height)}),Le.createElement("title",null,i),Le.createElement("desc",null,S),t)}var mme=["children","className"];function RC(){return RC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},RC.apply(this,arguments)}function gme(e,t){if(e==null)return{};var n=yme(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function yme(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}var Di=Le.forwardRef(function(e,t){var n=e.children,o=e.className,d=gme(e,mme),f=ni("recharts-layer",o);return Le.createElement("g",RC({className:f},Tn(d,!0),{ref:t}),n)}),lc=function(t,n){for(var o=arguments.length,d=new Array(o>2?o-2:0),f=2;f<o;f++)d[f-2]=arguments[f]};function _me(e,t,n){var o=-1,d=e.length;t<0&&(t=-t>d?0:d+t),n=n>d?d:n,n<0&&(n+=d),d=t>n?0:n-t>>>0,t>>>=0;for(var f=Array(d);++o<d;)f[o]=e[o+t];return f}var vme=_me,xme=vme;function bme(e,t,n){var o=e.length;return n=n===void 0?o:n,!t&&n>=o?e:xme(e,t,n)}var wme=bme,Sme="\\ud800-\\udfff",Tme="\\u0300-\\u036f",Ame="\\ufe20-\\ufe2f",Eme="\\u20d0-\\u20ff",Pme=Tme+Ame+Eme,Cme="\\ufe0e\\ufe0f",Ime="\\u200d",Mme=RegExp("["+Ime+Sme+Pme+Cme+"]");function Ome(e){return Mme.test(e)}var s8=Ome;function Rme(e){return e.split("")}var kme=Rme,a8="\\ud800-\\udfff",jme="\\u0300-\\u036f",Dme="\\ufe20-\\ufe2f",Lme="\\u20d0-\\u20ff",Nme=jme+Dme+Lme,zme="\\ufe0e\\ufe0f",Fme="["+a8+"]",kC="["+Nme+"]",jC="\\ud83c[\\udffb-\\udfff]",Bme="(?:"+kC+"|"+jC+")",l8="[^"+a8+"]",c8="(?:\\ud83c[\\udde6-\\uddff]){2}",u8="[\\ud800-\\udbff][\\udc00-\\udfff]",$me="\\u200d",d8=Bme+"?",h8="["+zme+"]?",Vme="(?:"+$me+"(?:"+[l8,c8,u8].join("|")+")"+h8+d8+")*",Ume=h8+d8+Vme,Gme="(?:"+[l8+kC+"?",kC,c8,u8,Fme].join("|")+")",Hme=RegExp(jC+"(?="+jC+")|"+Gme+Ume,"g");function Wme(e){return e.match(Hme)||[]}var qme=Wme,Zme=kme,Kme=s8,Xme=qme;function Yme(e){return Kme(e)?Xme(e):Zme(e)}var Jme=Yme,Qme=wme,ege=s8,tge=Jme,rge=e8;function nge(e){return function(t){t=rge(t);var n=ege(t)?tge(t):void 0,o=n?n[0]:t.charAt(0),d=n?Qme(n,1).join(""):t.slice(1);return o[e]()+d}}var ige=nge,oge=ige,sge=oge("toUpperCase"),age=sge;const IT=Ni(age);function ao(e){return function(){return e}}const f8=Math.cos,Dw=Math.sin,yc=Math.sqrt,Lw=Math.PI,MT=2*Lw,DC=Math.PI,LC=2*DC,mf=1e-6,lge=LC-mf;function p8(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function cge(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return p8;const n=10**t;return function(o){this._+=o[0];for(let d=1,f=o.length;d<f;++d)this._+=Math.round(arguments[d]*n)/n+o[d]}}class uge{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?p8:cge(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,o,d){this._append`Q${+t},${+n},${this._x1=+o},${this._y1=+d}`}bezierCurveTo(t,n,o,d,f,_){this._append`C${+t},${+n},${+o},${+d},${this._x1=+f},${this._y1=+_}`}arcTo(t,n,o,d,f){if(t=+t,n=+n,o=+o,d=+d,f=+f,f<0)throw new Error(`negative radius: ${f}`);let _=this._x1,i=this._y1,S=o-t,E=d-n,I=_-t,M=i-n,j=I*I+M*M;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(j>mf)if(!(Math.abs(M*S-E*I)>mf)||!f)this._append`L${this._x1=t},${this._y1=n}`;else{let N=o-_,G=d-i,z=S*S+E*E,V=N*N+G*G,K=Math.sqrt(z),Q=Math.sqrt(j),X=f*Math.tan((DC-Math.acos((z+j-V)/(2*K*Q)))/2),ie=X/Q,J=X/K;Math.abs(ie-1)>mf&&this._append`L${t+ie*I},${n+ie*M}`,this._append`A${f},${f},0,0,${+(M*N>I*G)},${this._x1=t+J*S},${this._y1=n+J*E}`}}arc(t,n,o,d,f,_){if(t=+t,n=+n,o=+o,_=!!_,o<0)throw new Error(`negative radius: ${o}`);let i=o*Math.cos(d),S=o*Math.sin(d),E=t+i,I=n+S,M=1^_,j=_?d-f:f-d;this._x1===null?this._append`M${E},${I}`:(Math.abs(this._x1-E)>mf||Math.abs(this._y1-I)>mf)&&this._append`L${E},${I}`,o&&(j<0&&(j=j%LC+LC),j>lge?this._append`A${o},${o},0,1,${M},${t-i},${n-S}A${o},${o},0,1,${M},${this._x1=E},${this._y1=I}`:j>mf&&this._append`A${o},${o},0,${+(j>=DC)},${M},${this._x1=t+o*Math.cos(f)},${this._y1=n+o*Math.sin(f)}`)}rect(t,n,o,d){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${o=+o}v${+d}h${-o}Z`}toString(){return this._}}function VO(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const o=Math.floor(n);if(!(o>=0))throw new RangeError(`invalid digits: ${n}`);t=o}return e},()=>new uge(t)}function UO(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function m8(e){this._context=e}m8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function OT(e){return new m8(e)}function g8(e){return e[0]}function y8(e){return e[1]}function _8(e,t){var n=ao(!0),o=null,d=OT,f=null,_=VO(i);e=typeof e=="function"?e:e===void 0?g8:ao(e),t=typeof t=="function"?t:t===void 0?y8:ao(t);function i(S){var E,I=(S=UO(S)).length,M,j=!1,N;for(o==null&&(f=d(N=_())),E=0;E<=I;++E)!(E<I&&n(M=S[E],E,S))===j&&((j=!j)?f.lineStart():f.lineEnd()),j&&f.point(+e(M,E,S),+t(M,E,S));if(N)return f=null,N+""||null}return i.x=function(S){return arguments.length?(e=typeof S=="function"?S:ao(+S),i):e},i.y=function(S){return arguments.length?(t=typeof S=="function"?S:ao(+S),i):t},i.defined=function(S){return arguments.length?(n=typeof S=="function"?S:ao(!!S),i):n},i.curve=function(S){return arguments.length?(d=S,o!=null&&(f=d(o)),i):d},i.context=function(S){return arguments.length?(S==null?o=f=null:f=d(o=S),i):o},i}function j1(e,t,n){var o=null,d=ao(!0),f=null,_=OT,i=null,S=VO(E);e=typeof e=="function"?e:e===void 0?g8:ao(+e),t=typeof t=="function"?t:ao(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?y8:ao(+n);function E(M){var j,N,G,z=(M=UO(M)).length,V,K=!1,Q,X=new Array(z),ie=new Array(z);for(f==null&&(i=_(Q=S())),j=0;j<=z;++j){if(!(j<z&&d(V=M[j],j,M))===K)if(K=!K)N=j,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),G=j-1;G>=N;--G)i.point(X[G],ie[G]);i.lineEnd(),i.areaEnd()}K&&(X[j]=+e(V,j,M),ie[j]=+t(V,j,M),i.point(o?+o(V,j,M):X[j],n?+n(V,j,M):ie[j]))}if(Q)return i=null,Q+""||null}function I(){return _8().defined(d).curve(_).context(f)}return E.x=function(M){return arguments.length?(e=typeof M=="function"?M:ao(+M),o=null,E):e},E.x0=function(M){return arguments.length?(e=typeof M=="function"?M:ao(+M),E):e},E.x1=function(M){return arguments.length?(o=M==null?null:typeof M=="function"?M:ao(+M),E):o},E.y=function(M){return arguments.length?(t=typeof M=="function"?M:ao(+M),n=null,E):t},E.y0=function(M){return arguments.length?(t=typeof M=="function"?M:ao(+M),E):t},E.y1=function(M){return arguments.length?(n=M==null?null:typeof M=="function"?M:ao(+M),E):n},E.lineX0=E.lineY0=function(){return I().x(e).y(t)},E.lineY1=function(){return I().x(e).y(n)},E.lineX1=function(){return I().x(o).y(t)},E.defined=function(M){return arguments.length?(d=typeof M=="function"?M:ao(!!M),E):d},E.curve=function(M){return arguments.length?(_=M,f!=null&&(i=_(f)),E):_},E.context=function(M){return arguments.length?(M==null?f=i=null:i=_(f=M),E):f},E}class v8{constructor(t,n){this._context=t,this._x=n}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,n){switch(t=+t,n=+n,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,n,t,n):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+n)/2,t,this._y0,t,n);break}}this._x0=t,this._y0=n}}function dge(e){return new v8(e,!0)}function hge(e){return new v8(e,!1)}const GO={draw(e,t){const n=yc(t/Lw);e.moveTo(n,0),e.arc(0,0,n,0,MT)}},fge={draw(e,t){const n=yc(t/5)/2;e.moveTo(-3*n,-n),e.lineTo(-n,-n),e.lineTo(-n,-3*n),e.lineTo(n,-3*n),e.lineTo(n,-n),e.lineTo(3*n,-n),e.lineTo(3*n,n),e.lineTo(n,n),e.lineTo(n,3*n),e.lineTo(-n,3*n),e.lineTo(-n,n),e.lineTo(-3*n,n),e.closePath()}},x8=yc(1/3),pge=x8*2,mge={draw(e,t){const n=yc(t/pge),o=n*x8;e.moveTo(0,-n),e.lineTo(o,0),e.lineTo(0,n),e.lineTo(-o,0),e.closePath()}},gge={draw(e,t){const n=yc(t),o=-n/2;e.rect(o,o,n,n)}},yge=.8908130915292852,b8=Dw(Lw/10)/Dw(7*Lw/10),_ge=Dw(MT/10)*b8,vge=-f8(MT/10)*b8,xge={draw(e,t){const n=yc(t*yge),o=_ge*n,d=vge*n;e.moveTo(0,-n),e.lineTo(o,d);for(let f=1;f<5;++f){const _=MT*f/5,i=f8(_),S=Dw(_);e.lineTo(S*n,-i*n),e.lineTo(i*o-S*d,S*o+i*d)}e.closePath()}},nP=yc(3),bge={draw(e,t){const n=-yc(t/(nP*3));e.moveTo(0,n*2),e.lineTo(-nP*n,-n),e.lineTo(nP*n,-n),e.closePath()}},fl=-.5,pl=yc(3)/2,NC=1/yc(12),wge=(NC/2+1)*3,Sge={draw(e,t){const n=yc(t/wge),o=n/2,d=n*NC,f=o,_=n*NC+n,i=-f,S=_;e.moveTo(o,d),e.lineTo(f,_),e.lineTo(i,S),e.lineTo(fl*o-pl*d,pl*o+fl*d),e.lineTo(fl*f-pl*_,pl*f+fl*_),e.lineTo(fl*i-pl*S,pl*i+fl*S),e.lineTo(fl*o+pl*d,fl*d-pl*o),e.lineTo(fl*f+pl*_,fl*_-pl*f),e.lineTo(fl*i+pl*S,fl*S-pl*i),e.closePath()}};function Tge(e,t){let n=null,o=VO(d);e=typeof e=="function"?e:ao(e||GO),t=typeof t=="function"?t:ao(t===void 0?64:+t);function d(){let f;if(n||(n=f=o()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),f)return n=null,f+""||null}return d.type=function(f){return arguments.length?(e=typeof f=="function"?f:ao(f),d):e},d.size=function(f){return arguments.length?(t=typeof f=="function"?f:ao(+f),d):t},d.context=function(f){return arguments.length?(n=f??null,d):n},d}function Nw(){}function zw(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function w8(e){this._context=e}w8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:zw(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:zw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Age(e){return new w8(e)}function S8(e){this._context=e}S8.prototype={areaStart:Nw,areaEnd:Nw,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:zw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Ege(e){return new S8(e)}function T8(e){this._context=e}T8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,o=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,o):this._context.moveTo(n,o);break;case 3:this._point=4;default:zw(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Pge(e){return new T8(e)}function A8(e){this._context=e}A8.prototype={areaStart:Nw,areaEnd:Nw,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function Cge(e){return new A8(e)}function kz(e){return e<0?-1:1}function jz(e,t,n){var o=e._x1-e._x0,d=t-e._x1,f=(e._y1-e._y0)/(o||d<0&&-0),_=(n-e._y1)/(d||o<0&&-0),i=(f*d+_*o)/(o+d);return(kz(f)+kz(_))*Math.min(Math.abs(f),Math.abs(_),.5*Math.abs(i))||0}function Dz(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function iP(e,t,n){var o=e._x0,d=e._y0,f=e._x1,_=e._y1,i=(f-o)/3;e._context.bezierCurveTo(o+i,d+i*t,f-i,_-i*n,f,_)}function Fw(e){this._context=e}Fw.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:iP(this,this._t0,Dz(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,iP(this,Dz(this,n=jz(this,e,t)),n);break;default:iP(this,this._t0,n=jz(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function E8(e){this._context=new P8(e)}(E8.prototype=Object.create(Fw.prototype)).point=function(e,t){Fw.prototype.point.call(this,t,e)};function P8(e){this._context=e}P8.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,o,d,f){this._context.bezierCurveTo(t,e,o,n,f,d)}};function Ige(e){return new Fw(e)}function Mge(e){return new E8(e)}function C8(e){this._context=e}C8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var o=Lz(e),d=Lz(t),f=0,_=1;_<n;++f,++_)this._context.bezierCurveTo(o[0][f],d[0][f],o[1][f],d[1][f],e[_],t[_]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function Lz(e){var t,n=e.length-1,o,d=new Array(n),f=new Array(n),_=new Array(n);for(d[0]=0,f[0]=2,_[0]=e[0]+2*e[1],t=1;t<n-1;++t)d[t]=1,f[t]=4,_[t]=4*e[t]+2*e[t+1];for(d[n-1]=2,f[n-1]=7,_[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)o=d[t]/f[t-1],f[t]-=o,_[t]-=o*_[t-1];for(d[n-1]=_[n-1]/f[n-1],t=n-2;t>=0;--t)d[t]=(_[t]-d[t+1])/f[t];for(f[n-1]=(e[n]+d[n-1])/2,t=0;t<n-1;++t)f[t]=2*e[t+1]-d[t+1];return[d,f]}function Oge(e){return new C8(e)}function RT(e,t){this._context=e,this._t=t}RT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Rge(e){return new RT(e,.5)}function kge(e){return new RT(e,0)}function jge(e){return new RT(e,1)}function Cg(e,t){if((_=e.length)>1)for(var n=1,o,d,f=e[t[0]],_,i=f.length;n<_;++n)for(d=f,f=e[t[n]],o=0;o<i;++o)f[o][1]+=f[o][0]=isNaN(d[o][1])?d[o][0]:d[o][1]}function zC(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n}function Dge(e,t){return e[t]}function Lge(e){const t=[];return t.key=e,t}function Nge(){var e=ao([]),t=zC,n=Cg,o=Dge;function d(f){var _=Array.from(e.apply(this,arguments),Lge),i,S=_.length,E=-1,I;for(const M of f)for(i=0,++E;i<S;++i)(_[i][E]=[0,+o(M,_[i].key,E,f)]).data=M;for(i=0,I=UO(t(_));i<S;++i)_[I[i]].index=i;return n(_,I),_}return d.keys=function(f){return arguments.length?(e=typeof f=="function"?f:ao(Array.from(f)),d):e},d.value=function(f){return arguments.length?(o=typeof f=="function"?f:ao(+f),d):o},d.order=function(f){return arguments.length?(t=f==null?zC:typeof f=="function"?f:ao(Array.from(f)),d):t},d.offset=function(f){return arguments.length?(n=f??Cg,d):n},d}function zge(e,t){if((o=e.length)>0){for(var n,o,d=0,f=e[0].length,_;d<f;++d){for(_=n=0;n<o;++n)_+=e[n][d][1]||0;if(_)for(n=0;n<o;++n)e[n][d][1]/=_}Cg(e,t)}}function Fge(e,t){if((d=e.length)>0){for(var n=0,o=e[t[0]],d,f=o.length;n<f;++n){for(var _=0,i=0;_<d;++_)i+=e[_][n][1]||0;o[n][1]+=o[n][0]=-i/2}Cg(e,t)}}function Bge(e,t){if(!(!((_=e.length)>0)||!((f=(d=e[t[0]]).length)>0))){for(var n=0,o=1,d,f,_;o<f;++o){for(var i=0,S=0,E=0;i<_;++i){for(var I=e[t[i]],M=I[o][1]||0,j=I[o-1][1]||0,N=(M-j)/2,G=0;G<i;++G){var z=e[t[G]],V=z[o][1]||0,K=z[o-1][1]||0;N+=V-K}S+=M,E+=N*M}d[o-1][1]+=d[o-1][0]=n,S&&(n-=E/S)}d[o-1][1]+=d[o-1][0]=n,Cg(e,t)}}function f0(e){"@babel/helpers - typeof";return f0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f0(e)}var $ge=["type","size","sizeType"];function FC(){return FC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},FC.apply(this,arguments)}function Nz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function zz(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Nz(Object(n),!0).forEach(function(o){Vge(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Vge(e,t,n){return t=Uge(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Uge(e){var t=Gge(e,"string");return f0(t)=="symbol"?t:t+""}function Gge(e,t){if(f0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(f0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Hge(e,t){if(e==null)return{};var n=Wge(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function Wge(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}var I8={symbolCircle:GO,symbolCross:fge,symbolDiamond:mge,symbolSquare:gge,symbolStar:xge,symbolTriangle:bge,symbolWye:Sge},qge=Math.PI/180,Zge=function(t){var n="symbol".concat(IT(t));return I8[n]||GO},Kge=function(t,n,o){if(n==="area")return t;switch(o){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var d=18*qge;return 1.25*t*t*(Math.tan(d)-Math.tan(d*2)*Math.pow(Math.tan(d),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},Xge=function(t,n){I8["symbol".concat(IT(t))]=n},HO=function(t){var n=t.type,o=n===void 0?"circle":n,d=t.size,f=d===void 0?64:d,_=t.sizeType,i=_===void 0?"area":_,S=Hge(t,$ge),E=zz(zz({},S),{},{type:o,size:f,sizeType:i}),I=function(){var V=Zge(o),K=Tge().type(V).size(Kge(f,i,o));return K()},M=E.className,j=E.cx,N=E.cy,G=Tn(E,!0);return j===+j&&N===+N&&f===+f?Le.createElement("path",FC({},G,{className:ni("recharts-symbols",M),transform:"translate(".concat(j,", ").concat(N,")"),d:I()})):null};HO.registerSymbol=Xge;function Ig(e){"@babel/helpers - typeof";return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ig(e)}function BC(){return BC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},BC.apply(this,arguments)}function Fz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Yge(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Fz(Object(n),!0).forEach(function(o){p0(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fz(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Jge(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qge(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,O8(o.key),o)}}function eye(e,t,n){return t&&Qge(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tye(e,t,n){return t=Bw(t),rye(e,M8()?Reflect.construct(t,n||[],Bw(e).constructor):t.apply(e,n))}function rye(e,t){if(t&&(Ig(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nye(e)}function nye(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(M8=function(){return!!e})()}function Bw(e){return Bw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Bw(e)}function iye(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$C(e,t)}function $C(e,t){return $C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},$C(e,t)}function p0(e,t,n){return t=O8(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O8(e){var t=oye(e,"string");return Ig(t)=="symbol"?t:t+""}function oye(e,t){if(Ig(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Ig(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ml=32,WO=function(e){function t(){return Jge(this,t),tye(this,t,arguments)}return iye(t,e),eye(t,[{key:"renderIcon",value:function(o){var d=this.props.inactiveColor,f=ml/2,_=ml/6,i=ml/3,S=o.inactive?d:o.color;if(o.type==="plainline")return Le.createElement("line",{strokeWidth:4,fill:"none",stroke:S,strokeDasharray:o.payload.strokeDasharray,x1:0,y1:f,x2:ml,y2:f,className:"recharts-legend-icon"});if(o.type==="line")return Le.createElement("path",{strokeWidth:4,fill:"none",stroke:S,d:"M0,".concat(f,"h").concat(i,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(2*i,",").concat(f,`
            H`).concat(ml,"M").concat(2*i,",").concat(f,`
            A`).concat(_,",").concat(_,",0,1,1,").concat(i,",").concat(f),className:"recharts-legend-icon"});if(o.type==="rect")return Le.createElement("path",{stroke:"none",fill:S,d:"M0,".concat(ml/8,"h").concat(ml,"v").concat(ml*3/4,"h").concat(-ml,"z"),className:"recharts-legend-icon"});if(Le.isValidElement(o.legendIcon)){var E=Yge({},o);return delete E.legendIcon,Le.cloneElement(o.legendIcon,E)}return Le.createElement(HO,{fill:S,cx:f,cy:f,size:ml,sizeType:"diameter",type:o.type})}},{key:"renderItems",value:function(){var o=this,d=this.props,f=d.payload,_=d.iconSize,i=d.layout,S=d.formatter,E=d.inactiveColor,I={x:0,y:0,width:ml,height:ml},M={display:i==="horizontal"?"inline-block":"block",marginRight:10},j={display:"inline-block",verticalAlign:"middle",marginRight:4};return f.map(function(N,G){var z=N.formatter||S,V=ni(p0(p0({"recharts-legend-item":!0},"legend-item-".concat(G),!0),"inactive",N.inactive));if(N.type==="none")return null;var K=Vn(N.value)?null:N.value;lc(!Vn(N.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var Q=N.inactive?E:N.color;return Le.createElement("li",BC({className:V,style:M,key:"legend-item-".concat(G)},Vf(o.props,N,G)),Le.createElement(OC,{width:_,height:_,viewBox:I,style:j},o.renderIcon(N)),Le.createElement("span",{className:"recharts-legend-item-text",style:{color:Q}},z?z(K,N,G):K))})}},{key:"render",value:function(){var o=this.props,d=o.payload,f=o.layout,_=o.align;if(!d||!d.length)return null;var i={padding:0,margin:0,textAlign:f==="horizontal"?_:"left"};return Le.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(B.PureComponent);p0(WO,"displayName","Legend");p0(WO,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var sye=gT;function aye(){this.__data__=new sye,this.size=0}var lye=aye;function cye(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var uye=cye;function dye(e){return this.__data__.get(e)}var hye=dye;function fye(e){return this.__data__.has(e)}var pye=fye,mye=gT,gye=kO,yye=jO,_ye=200;function vye(e,t){var n=this.__data__;if(n instanceof mye){var o=n.__data__;if(!gye||o.length<_ye-1)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new yye(o)}return n.set(e,t),this.size=n.size,this}var xye=vye,bye=gT,wye=lye,Sye=uye,Tye=hye,Aye=pye,Eye=xye;function yy(e){var t=this.__data__=new bye(e);this.size=t.size}yy.prototype.clear=wye;yy.prototype.delete=Sye;yy.prototype.get=Tye;yy.prototype.has=Aye;yy.prototype.set=Eye;var R8=yy,Pye="__lodash_hash_undefined__";function Cye(e){return this.__data__.set(e,Pye),this}var Iye=Cye;function Mye(e){return this.__data__.has(e)}var Oye=Mye,Rye=jO,kye=Iye,jye=Oye;function $w(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Rye;++t<n;)this.add(e[t])}$w.prototype.add=$w.prototype.push=kye;$w.prototype.has=jye;var k8=$w;function Dye(e,t){for(var n=-1,o=e==null?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1}var j8=Dye;function Lye(e,t){return e.has(t)}var D8=Lye,Nye=k8,zye=j8,Fye=D8,Bye=1,$ye=2;function Vye(e,t,n,o,d,f){var _=n&Bye,i=e.length,S=t.length;if(i!=S&&!(_&&S>i))return!1;var E=f.get(e),I=f.get(t);if(E&&I)return E==t&&I==e;var M=-1,j=!0,N=n&$ye?new Nye:void 0;for(f.set(e,t),f.set(t,e);++M<i;){var G=e[M],z=t[M];if(o)var V=_?o(z,G,M,t,e,f):o(G,z,M,e,t,f);if(V!==void 0){if(V)continue;j=!1;break}if(N){if(!zye(t,function(K,Q){if(!Fye(N,Q)&&(G===K||d(G,K,n,o,f)))return N.push(Q)})){j=!1;break}}else if(!(G===z||d(G,z,n,o,f))){j=!1;break}}return f.delete(e),f.delete(t),j}var L8=Vye,Uye=ou,Gye=Uye.Uint8Array,Hye=Gye;function Wye(e){var t=-1,n=Array(e.size);return e.forEach(function(o,d){n[++t]=[d,o]}),n}var qye=Wye;function Zye(e){var t=-1,n=Array(e.size);return e.forEach(function(o){n[++t]=o}),n}var qO=Zye,Bz=cx,$z=Hye,Kye=RO,Xye=L8,Yye=qye,Jye=qO,Qye=1,e_e=2,t_e="[object Boolean]",r_e="[object Date]",n_e="[object Error]",i_e="[object Map]",o_e="[object Number]",s_e="[object RegExp]",a_e="[object Set]",l_e="[object String]",c_e="[object Symbol]",u_e="[object ArrayBuffer]",d_e="[object DataView]",Vz=Bz?Bz.prototype:void 0,oP=Vz?Vz.valueOf:void 0;function h_e(e,t,n,o,d,f,_){switch(n){case d_e:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case u_e:return!(e.byteLength!=t.byteLength||!f(new $z(e),new $z(t)));case t_e:case r_e:case o_e:return Kye(+e,+t);case n_e:return e.name==t.name&&e.message==t.message;case s_e:case l_e:return e==t+"";case i_e:var i=Yye;case a_e:var S=o&Qye;if(i||(i=Jye),e.size!=t.size&&!S)return!1;var E=_.get(e);if(E)return E==t;o|=e_e,_.set(e,t);var I=Xye(i(e),i(t),o,d,f,_);return _.delete(e),I;case c_e:if(oP)return oP.call(e)==oP.call(t)}return!1}var f_e=h_e;function p_e(e,t){for(var n=-1,o=t.length,d=e.length;++n<o;)e[d+n]=t[n];return e}var N8=p_e,m_e=N8,g_e=Ea;function y_e(e,t,n){var o=t(e);return g_e(e)?o:m_e(o,n(e))}var __e=y_e;function v_e(e,t){for(var n=-1,o=e==null?0:e.length,d=0,f=[];++n<o;){var _=e[n];t(_,n,e)&&(f[d++]=_)}return f}var x_e=v_e;function b_e(){return[]}var w_e=b_e,S_e=x_e,T_e=w_e,A_e=Object.prototype,E_e=A_e.propertyIsEnumerable,Uz=Object.getOwnPropertySymbols,P_e=Uz?function(e){return e==null?[]:(e=Object(e),S_e(Uz(e),function(t){return E_e.call(e,t)}))}:T_e,C_e=P_e;function I_e(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}var M_e=I_e,O_e=ed,R_e=td,k_e="[object Arguments]";function j_e(e){return R_e(e)&&O_e(e)==k_e}var D_e=j_e,Gz=D_e,L_e=td,z8=Object.prototype,N_e=z8.hasOwnProperty,z_e=z8.propertyIsEnumerable,F_e=Gz(function(){return arguments}())?Gz:function(e){return L_e(e)&&N_e.call(e,"callee")&&!z_e.call(e,"callee")},ZO=F_e,Vw={exports:{}};function B_e(){return!1}var $_e=B_e;Vw.exports;(function(e,t){var n=ou,o=$_e,d=t&&!t.nodeType&&t,f=d&&!0&&e&&!e.nodeType&&e,_=f&&f.exports===d,i=_?n.Buffer:void 0,S=i?i.isBuffer:void 0,E=S||o;e.exports=E})(Vw,Vw.exports);var F8=Vw.exports,V_e=9007199254740991,U_e=/^(?:0|[1-9]\d*)$/;function G_e(e,t){var n=typeof e;return t=t??V_e,!!t&&(n=="number"||n!="symbol"&&U_e.test(e))&&e>-1&&e%1==0&&e<t}var KO=G_e,H_e=9007199254740991;function W_e(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=H_e}var XO=W_e,q_e=ed,Z_e=XO,K_e=td,X_e="[object Arguments]",Y_e="[object Array]",J_e="[object Boolean]",Q_e="[object Date]",eve="[object Error]",tve="[object Function]",rve="[object Map]",nve="[object Number]",ive="[object Object]",ove="[object RegExp]",sve="[object Set]",ave="[object String]",lve="[object WeakMap]",cve="[object ArrayBuffer]",uve="[object DataView]",dve="[object Float32Array]",hve="[object Float64Array]",fve="[object Int8Array]",pve="[object Int16Array]",mve="[object Int32Array]",gve="[object Uint8Array]",yve="[object Uint8ClampedArray]",_ve="[object Uint16Array]",vve="[object Uint32Array]",mo={};mo[dve]=mo[hve]=mo[fve]=mo[pve]=mo[mve]=mo[gve]=mo[yve]=mo[_ve]=mo[vve]=!0;mo[X_e]=mo[Y_e]=mo[cve]=mo[J_e]=mo[uve]=mo[Q_e]=mo[eve]=mo[tve]=mo[rve]=mo[nve]=mo[ive]=mo[ove]=mo[sve]=mo[ave]=mo[lve]=!1;function xve(e){return K_e(e)&&Z_e(e.length)&&!!mo[q_e(e)]}var bve=xve;function wve(e){return function(t){return e(t)}}var B8=wve,Uw={exports:{}};Uw.exports;(function(e,t){var n=Z6,o=t&&!t.nodeType&&t,d=o&&!0&&e&&!e.nodeType&&e,f=d&&d.exports===o,_=f&&n.process,i=function(){try{var S=d&&d.require&&d.require("util").types;return S||_&&_.binding&&_.binding("util")}catch{}}();e.exports=i})(Uw,Uw.exports);var Sve=Uw.exports,Tve=bve,Ave=B8,Hz=Sve,Wz=Hz&&Hz.isTypedArray,Eve=Wz?Ave(Wz):Tve,$8=Eve,Pve=M_e,Cve=ZO,Ive=Ea,Mve=F8,Ove=KO,Rve=$8,kve=Object.prototype,jve=kve.hasOwnProperty;function Dve(e,t){var n=Ive(e),o=!n&&Cve(e),d=!n&&!o&&Mve(e),f=!n&&!o&&!d&&Rve(e),_=n||o||d||f,i=_?Pve(e.length,String):[],S=i.length;for(var E in e)(t||jve.call(e,E))&&!(_&&(E=="length"||d&&(E=="offset"||E=="parent")||f&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||Ove(E,S)))&&i.push(E);return i}var Lve=Dve,Nve=Object.prototype;function zve(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Nve;return e===n}var Fve=zve;function Bve(e,t){return function(n){return e(t(n))}}var V8=Bve,$ve=V8,Vve=$ve(Object.keys,Object),Uve=Vve,Gve=Fve,Hve=Uve,Wve=Object.prototype,qve=Wve.hasOwnProperty;function Zve(e){if(!Gve(e))return Hve(e);var t=[];for(var n in Object(e))qve.call(e,n)&&n!="constructor"&&t.push(n);return t}var Kve=Zve,Xve=OO,Yve=XO;function Jve(e){return e!=null&&Yve(e.length)&&!Xve(e)}var dx=Jve,Qve=Lve,e0e=Kve,t0e=dx;function r0e(e){return t0e(e)?Qve(e):e0e(e)}var kT=r0e,n0e=__e,i0e=C_e,o0e=kT;function s0e(e){return n0e(e,o0e,i0e)}var a0e=s0e,qz=a0e,l0e=1,c0e=Object.prototype,u0e=c0e.hasOwnProperty;function d0e(e,t,n,o,d,f){var _=n&l0e,i=qz(e),S=i.length,E=qz(t),I=E.length;if(S!=I&&!_)return!1;for(var M=S;M--;){var j=i[M];if(!(_?j in t:u0e.call(t,j)))return!1}var N=f.get(e),G=f.get(t);if(N&&G)return N==t&&G==e;var z=!0;f.set(e,t),f.set(t,e);for(var V=_;++M<S;){j=i[M];var K=e[j],Q=t[j];if(o)var X=_?o(Q,K,j,t,e,f):o(K,Q,j,e,t,f);if(!(X===void 0?K===Q||d(K,Q,n,o,f):X)){z=!1;break}V||(V=j=="constructor")}if(z&&!V){var ie=e.constructor,J=t.constructor;ie!=J&&"constructor"in e&&"constructor"in t&&!(typeof ie=="function"&&ie instanceof ie&&typeof J=="function"&&J instanceof J)&&(z=!1)}return f.delete(e),f.delete(t),z}var h0e=d0e,f0e=ep,p0e=ou,m0e=f0e(p0e,"DataView"),g0e=m0e,y0e=ep,_0e=ou,v0e=y0e(_0e,"Promise"),x0e=v0e,b0e=ep,w0e=ou,S0e=b0e(w0e,"Set"),U8=S0e,T0e=ep,A0e=ou,E0e=T0e(A0e,"WeakMap"),P0e=E0e,VC=g0e,UC=kO,GC=x0e,HC=U8,WC=P0e,G8=ed,_y=X6,Zz="[object Map]",C0e="[object Object]",Kz="[object Promise]",Xz="[object Set]",Yz="[object WeakMap]",Jz="[object DataView]",I0e=_y(VC),M0e=_y(UC),O0e=_y(GC),R0e=_y(HC),k0e=_y(WC),gf=G8;(VC&&gf(new VC(new ArrayBuffer(1)))!=Jz||UC&&gf(new UC)!=Zz||GC&&gf(GC.resolve())!=Kz||HC&&gf(new HC)!=Xz||WC&&gf(new WC)!=Yz)&&(gf=function(e){var t=G8(e),n=t==C0e?e.constructor:void 0,o=n?_y(n):"";if(o)switch(o){case I0e:return Jz;case M0e:return Zz;case O0e:return Kz;case R0e:return Xz;case k0e:return Yz}return t});var j0e=gf,sP=R8,D0e=L8,L0e=f_e,N0e=h0e,Qz=j0e,eF=Ea,tF=F8,z0e=$8,F0e=1,rF="[object Arguments]",nF="[object Array]",D1="[object Object]",B0e=Object.prototype,iF=B0e.hasOwnProperty;function $0e(e,t,n,o,d,f){var _=eF(e),i=eF(t),S=_?nF:Qz(e),E=i?nF:Qz(t);S=S==rF?D1:S,E=E==rF?D1:E;var I=S==D1,M=E==D1,j=S==E;if(j&&tF(e)){if(!tF(t))return!1;_=!0,I=!1}if(j&&!I)return f||(f=new sP),_||z0e(e)?D0e(e,t,n,o,d,f):L0e(e,t,S,n,o,d,f);if(!(n&F0e)){var N=I&&iF.call(e,"__wrapped__"),G=M&&iF.call(t,"__wrapped__");if(N||G){var z=N?e.value():e,V=G?t.value():t;return f||(f=new sP),d(z,V,n,o,f)}}return j?(f||(f=new sP),N0e(e,t,n,o,d,f)):!1}var V0e=$0e,U0e=V0e,oF=td;function H8(e,t,n,o,d){return e===t?!0:e==null||t==null||!oF(e)&&!oF(t)?e!==e&&t!==t:U0e(e,t,n,o,H8,d)}var YO=H8,G0e=R8,H0e=YO,W0e=1,q0e=2;function Z0e(e,t,n,o){var d=n.length,f=d,_=!o;if(e==null)return!f;for(e=Object(e);d--;){var i=n[d];if(_&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++d<f;){i=n[d];var S=i[0],E=e[S],I=i[1];if(_&&i[2]){if(E===void 0&&!(S in e))return!1}else{var M=new G0e;if(o)var j=o(E,I,S,e,t,M);if(!(j===void 0?H0e(I,E,W0e|q0e,o,M):j))return!1}}return!0}var K0e=Z0e,X0e=ah;function Y0e(e){return e===e&&!X0e(e)}var W8=Y0e,J0e=W8,Q0e=kT;function exe(e){for(var t=Q0e(e),n=t.length;n--;){var o=t[n],d=e[o];t[n]=[o,d,J0e(d)]}return t}var txe=exe;function rxe(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var q8=rxe,nxe=K0e,ixe=txe,oxe=q8;function sxe(e){var t=ixe(e);return t.length==1&&t[0][2]?oxe(t[0][0],t[0][1]):function(n){return n===e||nxe(n,e,t)}}var axe=sxe;function lxe(e,t){return e!=null&&t in Object(e)}var cxe=lxe,uxe=t8,dxe=ZO,hxe=Ea,fxe=KO,pxe=XO,mxe=_T;function gxe(e,t,n){t=uxe(t,e);for(var o=-1,d=t.length,f=!1;++o<d;){var _=mxe(t[o]);if(!(f=e!=null&&n(e,_)))break;e=e[_]}return f||++o!=d?f:(d=e==null?0:e.length,!!d&&pxe(d)&&fxe(_,d)&&(hxe(e)||dxe(e)))}var yxe=gxe,_xe=cxe,vxe=yxe;function xxe(e,t){return e!=null&&vxe(e,t,_xe)}var bxe=xxe,wxe=YO,Sxe=r8,Txe=bxe,Axe=MO,Exe=W8,Pxe=q8,Cxe=_T,Ixe=1,Mxe=2;function Oxe(e,t){return Axe(e)&&Exe(t)?Pxe(Cxe(e),t):function(n){var o=Sxe(n,e);return o===void 0&&o===t?Txe(n,e):wxe(t,o,Ixe|Mxe)}}var Rxe=Oxe;function kxe(e){return e}var vy=kxe;function jxe(e){return function(t){return t?.[e]}}var Dxe=jxe,Lxe=NO;function Nxe(e){return function(t){return Lxe(t,e)}}var zxe=Nxe,Fxe=Dxe,Bxe=zxe,$xe=MO,Vxe=_T;function Uxe(e){return $xe(e)?Fxe(Vxe(e)):Bxe(e)}var Gxe=Uxe,Hxe=axe,Wxe=Rxe,qxe=vy,Zxe=Ea,Kxe=Gxe;function Xxe(e){return typeof e=="function"?e:e==null?qxe:typeof e=="object"?Zxe(e)?Wxe(e[0],e[1]):Hxe(e):Kxe(e)}var su=Xxe;function Yxe(e,t,n,o){for(var d=e.length,f=n+(o?1:-1);o?f--:++f<d;)if(t(e[f],f,e))return f;return-1}var Z8=Yxe;function Jxe(e){return e!==e}var Qxe=Jxe;function ebe(e,t,n){for(var o=n-1,d=e.length;++o<d;)if(e[o]===t)return o;return-1}var tbe=ebe,rbe=Z8,nbe=Qxe,ibe=tbe;function obe(e,t,n){return t===t?ibe(e,t,n):rbe(e,nbe,n)}var sbe=obe,abe=sbe;function lbe(e,t){var n=e==null?0:e.length;return!!n&&abe(e,t,0)>-1}var cbe=lbe;function ube(e,t,n){for(var o=-1,d=e==null?0:e.length;++o<d;)if(n(t,e[o]))return!0;return!1}var dbe=ube;function hbe(){}var fbe=hbe,aP=U8,pbe=fbe,mbe=qO,gbe=1/0,ybe=aP&&1/mbe(new aP([,-0]))[1]==gbe?function(e){return new aP(e)}:pbe,_be=ybe,vbe=k8,xbe=cbe,bbe=dbe,wbe=D8,Sbe=_be,Tbe=qO,Abe=200;function Ebe(e,t,n){var o=-1,d=xbe,f=e.length,_=!0,i=[],S=i;if(n)_=!1,d=bbe;else if(f>=Abe){var E=t?null:Sbe(e);if(E)return Tbe(E);_=!1,d=wbe,S=new vbe}else S=t?[]:i;e:for(;++o<f;){var I=e[o],M=t?t(I):I;if(I=n||I!==0?I:0,_&&M===M){for(var j=S.length;j--;)if(S[j]===M)continue e;t&&S.push(M),i.push(I)}else d(S,M,n)||(S!==i&&S.push(M),i.push(I))}return i}var Pbe=Ebe,Cbe=su,Ibe=Pbe;function Mbe(e,t){return e&&e.length?Ibe(e,Cbe(t)):[]}var Obe=Mbe;const sF=Ni(Obe);function K8(e,t,n){return t===!0?sF(e,n):Vn(t)?sF(e,t):e}function Mg(e){"@babel/helpers - typeof";return Mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mg(e)}var Rbe=["ref"];function aF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ju(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aF(Object(n),!0).forEach(function(o){jT(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function kbe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lF(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Y8(o.key),o)}}function jbe(e,t,n){return t&&lF(e.prototype,t),n&&lF(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Dbe(e,t,n){return t=Gw(t),Lbe(e,X8()?Reflect.construct(t,n||[],Gw(e).constructor):t.apply(e,n))}function Lbe(e,t){if(t&&(Mg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nbe(e)}function Nbe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X8(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(X8=function(){return!!e})()}function Gw(e){return Gw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Gw(e)}function zbe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qC(e,t)}function qC(e,t){return qC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},qC(e,t)}function jT(e,t,n){return t=Y8(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y8(e){var t=Fbe(e,"string");return Mg(t)=="symbol"?t:t+""}function Fbe(e,t){if(Mg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Mg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Bbe(e,t){if(e==null)return{};var n=$be(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function $be(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function Vbe(e){return e.value}function Ube(e,t){if(Le.isValidElement(e))return Le.cloneElement(e,t);if(typeof e=="function")return Le.createElement(e,t);t.ref;var n=Bbe(t,Rbe);return Le.createElement(WO,n)}var cF=1,Xd=function(e){function t(){var n;kbe(this,t);for(var o=arguments.length,d=new Array(o),f=0;f<o;f++)d[f]=arguments[f];return n=Dbe(this,t,[].concat(d)),jT(n,"lastBoundingBox",{width:-1,height:-1}),n}return zbe(t,e),jbe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();return o.height=this.wrapperNode.offsetHeight,o.width=this.wrapperNode.offsetWidth,o}return null}},{key:"updateBBox",value:function(){var o=this.props.onBBoxUpdate,d=this.getBBox();d?(Math.abs(d.width-this.lastBoundingBox.width)>cF||Math.abs(d.height-this.lastBoundingBox.height)>cF)&&(this.lastBoundingBox.width=d.width,this.lastBoundingBox.height=d.height,o&&o(d)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,o&&o(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?ju({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(o){var d=this.props,f=d.layout,_=d.align,i=d.verticalAlign,S=d.margin,E=d.chartWidth,I=d.chartHeight,M,j;if(!o||(o.left===void 0||o.left===null)&&(o.right===void 0||o.right===null))if(_==="center"&&f==="vertical"){var N=this.getBBoxSnapshot();M={left:((E||0)-N.width)/2}}else M=_==="right"?{right:S&&S.right||0}:{left:S&&S.left||0};if(!o||(o.top===void 0||o.top===null)&&(o.bottom===void 0||o.bottom===null))if(i==="middle"){var G=this.getBBoxSnapshot();j={top:((I||0)-G.height)/2}}else j=i==="bottom"?{bottom:S&&S.bottom||0}:{top:S&&S.top||0};return ju(ju({},M),j)}},{key:"render",value:function(){var o=this,d=this.props,f=d.content,_=d.width,i=d.height,S=d.wrapperStyle,E=d.payloadUniqBy,I=d.payload,M=ju(ju({position:"absolute",width:_||"auto",height:i||"auto"},this.getDefaultPosition(S)),S);return Le.createElement("div",{className:"recharts-legend-wrapper",style:M,ref:function(N){o.wrapperNode=N}},Ube(f,ju(ju({},this.props),{},{payload:K8(I,E,Vbe)})))}}],[{key:"getWithHeight",value:function(o,d){var f=ju(ju({},this.defaultProps),o.props),_=f.layout;return _==="vertical"&&vr(o.props.height)?{height:o.props.height}:_==="horizontal"?{width:o.props.width||d}:null}}])}(B.PureComponent);jT(Xd,"displayName","Legend");jT(Xd,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var uF=cx,Gbe=ZO,Hbe=Ea,dF=uF?uF.isConcatSpreadable:void 0;function Wbe(e){return Hbe(e)||Gbe(e)||!!(dF&&e&&e[dF])}var qbe=Wbe,Zbe=N8,Kbe=qbe;function J8(e,t,n,o,d){var f=-1,_=e.length;for(n||(n=Kbe),d||(d=[]);++f<_;){var i=e[f];t>0&&n(i)?t>1?J8(i,t-1,n,o,d):Zbe(d,i):o||(d[d.length]=i)}return d}var Q8=J8;function Xbe(e){return function(t,n,o){for(var d=-1,f=Object(t),_=o(t),i=_.length;i--;){var S=_[e?i:++d];if(n(f[S],S,f)===!1)break}return t}}var Ybe=Xbe,Jbe=Ybe,Qbe=Jbe(),e1e=Qbe,t1e=e1e,r1e=kT;function n1e(e,t){return e&&t1e(e,t,r1e)}var eG=n1e,i1e=dx;function o1e(e,t){return function(n,o){if(n==null)return n;if(!i1e(n))return e(n,o);for(var d=n.length,f=t?d:-1,_=Object(n);(t?f--:++f<d)&&o(_[f],f,_)!==!1;);return n}}var s1e=o1e,a1e=eG,l1e=s1e,c1e=l1e(a1e),JO=c1e,u1e=JO,d1e=dx;function h1e(e,t){var n=-1,o=d1e(e)?Array(e.length):[];return u1e(e,function(d,f,_){o[++n]=t(d,f,_)}),o}var tG=h1e;function f1e(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}var p1e=f1e,hF=dy;function m1e(e,t){if(e!==t){var n=e!==void 0,o=e===null,d=e===e,f=hF(e),_=t!==void 0,i=t===null,S=t===t,E=hF(t);if(!i&&!E&&!f&&e>t||f&&_&&S&&!i&&!E||o&&_&&S||!n&&S||!d)return 1;if(!o&&!f&&!E&&e<t||E&&n&&d&&!o&&!f||i&&n&&d||!_&&d||!S)return-1}return 0}var g1e=m1e,y1e=g1e;function _1e(e,t,n){for(var o=-1,d=e.criteria,f=t.criteria,_=d.length,i=n.length;++o<_;){var S=y1e(d[o],f[o]);if(S){if(o>=i)return S;var E=n[o];return S*(E=="desc"?-1:1)}}return e.index-t.index}var v1e=_1e,lP=LO,x1e=NO,b1e=su,w1e=tG,S1e=p1e,T1e=B8,A1e=v1e,E1e=vy,P1e=Ea;function C1e(e,t,n){t.length?t=lP(t,function(f){return P1e(f)?function(_){return x1e(_,f.length===1?f[0]:f)}:f}):t=[E1e];var o=-1;t=lP(t,T1e(b1e));var d=w1e(e,function(f,_,i){var S=lP(t,function(E){return E(f)});return{criteria:S,index:++o,value:f}});return S1e(d,function(f,_){return A1e(f,_,n)})}var I1e=C1e;function M1e(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var O1e=M1e,R1e=O1e,fF=Math.max;function k1e(e,t,n){return t=fF(t===void 0?e.length-1:t,0),function(){for(var o=arguments,d=-1,f=fF(o.length-t,0),_=Array(f);++d<f;)_[d]=o[t+d];d=-1;for(var i=Array(t+1);++d<t;)i[d]=o[d];return i[t]=n(_),R1e(e,this,i)}}var j1e=k1e;function D1e(e){return function(){return e}}var L1e=D1e,N1e=ep,z1e=function(){try{var e=N1e(Object,"defineProperty");return e({},"",{}),e}catch{}}(),rG=z1e,F1e=L1e,pF=rG,B1e=vy,$1e=pF?function(e,t){return pF(e,"toString",{configurable:!0,enumerable:!1,value:F1e(t),writable:!0})}:B1e,V1e=$1e,U1e=800,G1e=16,H1e=Date.now;function W1e(e){var t=0,n=0;return function(){var o=H1e(),d=G1e-(o-n);if(n=o,d>0){if(++t>=U1e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var q1e=W1e,Z1e=V1e,K1e=q1e,X1e=K1e(Z1e),Y1e=X1e,J1e=vy,Q1e=j1e,ewe=Y1e;function twe(e,t){return ewe(Q1e(e,t,J1e),e+"")}var rwe=twe,nwe=RO,iwe=dx,owe=KO,swe=ah;function awe(e,t,n){if(!swe(n))return!1;var o=typeof t;return(o=="number"?iwe(n)&&owe(t,n.length):o=="string"&&t in n)?nwe(n[t],e):!1}var DT=awe,lwe=Q8,cwe=I1e,uwe=rwe,mF=DT,dwe=uwe(function(e,t){if(e==null)return[];var n=t.length;return n>1&&mF(e,t[0],t[1])?t=[]:n>2&&mF(t[0],t[1],t[2])&&(t=[t[0]]),cwe(e,lwe(t,1),[])}),hwe=dwe;const QO=Ni(hwe);function m0(e){"@babel/helpers - typeof";return m0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m0(e)}function ZC(){return ZC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ZC.apply(this,arguments)}function fwe(e,t){return ywe(e)||gwe(e,t)||mwe(e,t)||pwe()}function pwe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mwe(e,t){if(e){if(typeof e=="string")return gF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gF(e,t)}}function gF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function gwe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function ywe(e){if(Array.isArray(e))return e}function yF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function cP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yF(Object(n),!0).forEach(function(o){_we(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function _we(e,t,n){return t=vwe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vwe(e){var t=xwe(e,"string");return m0(t)=="symbol"?t:t+""}function xwe(e,t){if(m0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(m0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bwe(e){return Array.isArray(e)&&fs(e[0])&&fs(e[1])?e.join(" ~ "):e}var wwe=function(t){var n=t.separator,o=n===void 0?" : ":n,d=t.contentStyle,f=d===void 0?{}:d,_=t.itemStyle,i=_===void 0?{}:_,S=t.labelStyle,E=S===void 0?{}:S,I=t.payload,M=t.formatter,j=t.itemSorter,N=t.wrapperClassName,G=t.labelClassName,z=t.label,V=t.labelFormatter,K=t.accessibilityLayer,Q=K===void 0?!1:K,X=function(){if(I&&I.length){var Be={padding:0,margin:0},qe=(j?QO(I,j):I).map(function(Xe,it){if(Xe.type==="none")return null;var Ge=cP({display:"block",paddingTop:4,paddingBottom:4,color:Xe.color||"#000"},i),Ke=Xe.formatter||M||bwe,ut=Xe.value,rt=Xe.name,Xt=ut,cr=rt;if(Ke&&Xt!=null&&cr!=null){var Bt=Ke(ut,rt,Xe,it,I);if(Array.isArray(Bt)){var $t=fwe(Bt,2);Xt=$t[0],cr=$t[1]}else Xt=Bt}return Le.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(it),style:Ge},fs(cr)?Le.createElement("span",{className:"recharts-tooltip-item-name"},cr):null,fs(cr)?Le.createElement("span",{className:"recharts-tooltip-item-separator"},o):null,Le.createElement("span",{className:"recharts-tooltip-item-value"},Xt),Le.createElement("span",{className:"recharts-tooltip-item-unit"},Xe.unit||""))});return Le.createElement("ul",{className:"recharts-tooltip-item-list",style:Be},qe)}return null},ie=cP({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},f),J=cP({margin:0},E),se=!Jn(z),he=se?z:"",we=ni("recharts-default-tooltip",N),ze=ni("recharts-tooltip-label",G);se&&V&&I!==void 0&&I!==null&&(he=V(z,I));var je=Q?{role:"status","aria-live":"assertive"}:{};return Le.createElement("div",ZC({className:we,style:ie},je),Le.createElement("p",{className:ze,style:J},Le.isValidElement(he)?he:"".concat(he)),X())};function g0(e){"@babel/helpers - typeof";return g0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g0(e)}function L1(e,t,n){return t=Swe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Swe(e){var t=Twe(e,"string");return g0(t)=="symbol"?t:t+""}function Twe(e,t){if(g0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(g0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Iv="recharts-tooltip-wrapper",Awe={visibility:"hidden"};function Ewe(e){var t=e.coordinate,n=e.translateX,o=e.translateY;return ni(Iv,L1(L1(L1(L1({},"".concat(Iv,"-right"),vr(n)&&t&&vr(t.x)&&n>=t.x),"".concat(Iv,"-left"),vr(n)&&t&&vr(t.x)&&n<t.x),"".concat(Iv,"-bottom"),vr(o)&&t&&vr(t.y)&&o>=t.y),"".concat(Iv,"-top"),vr(o)&&t&&vr(t.y)&&o<t.y))}function _F(e){var t=e.allowEscapeViewBox,n=e.coordinate,o=e.key,d=e.offsetTopLeft,f=e.position,_=e.reverseDirection,i=e.tooltipDimension,S=e.viewBox,E=e.viewBoxDimension;if(f&&vr(f[o]))return f[o];var I=n[o]-i-d,M=n[o]+d;if(t[o])return _[o]?I:M;if(_[o]){var j=I,N=S[o];return j<N?Math.max(M,S[o]):Math.max(I,S[o])}var G=M+i,z=S[o]+E;return G>z?Math.max(I,S[o]):Math.max(M,S[o])}function Pwe(e){var t=e.translateX,n=e.translateY,o=e.useTranslate3d;return{transform:o?"translate3d(".concat(t,"px, ").concat(n,"px, 0)"):"translate(".concat(t,"px, ").concat(n,"px)")}}function Cwe(e){var t=e.allowEscapeViewBox,n=e.coordinate,o=e.offsetTopLeft,d=e.position,f=e.reverseDirection,_=e.tooltipBox,i=e.useTranslate3d,S=e.viewBox,E,I,M;return _.height>0&&_.width>0&&n?(I=_F({allowEscapeViewBox:t,coordinate:n,key:"x",offsetTopLeft:o,position:d,reverseDirection:f,tooltipDimension:_.width,viewBox:S,viewBoxDimension:S.width}),M=_F({allowEscapeViewBox:t,coordinate:n,key:"y",offsetTopLeft:o,position:d,reverseDirection:f,tooltipDimension:_.height,viewBox:S,viewBoxDimension:S.height}),E=Pwe({translateX:I,translateY:M,useTranslate3d:i})):E=Awe,{cssProperties:E,cssClasses:Ewe({translateX:I,translateY:M,coordinate:n})}}function Og(e){"@babel/helpers - typeof";return Og=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Og(e)}function vF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function xF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vF(Object(n),!0).forEach(function(o){XC(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Iwe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mwe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,iG(o.key),o)}}function Owe(e,t,n){return t&&Mwe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rwe(e,t,n){return t=Hw(t),kwe(e,nG()?Reflect.construct(t,n||[],Hw(e).constructor):t.apply(e,n))}function kwe(e,t){if(t&&(Og(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jwe(e)}function jwe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nG=function(){return!!e})()}function Hw(e){return Hw=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Hw(e)}function Dwe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KC(e,t)}function KC(e,t){return KC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KC(e,t)}function XC(e,t,n){return t=iG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iG(e){var t=Lwe(e,"string");return Og(t)=="symbol"?t:t+""}function Lwe(e,t){if(Og(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Og(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bF=1,Nwe=function(e){function t(){var n;Iwe(this,t);for(var o=arguments.length,d=new Array(o),f=0;f<o;f++)d[f]=arguments[f];return n=Rwe(this,t,[].concat(d)),XC(n,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),XC(n,"handleKeyDown",function(_){if(_.key==="Escape"){var i,S,E,I;n.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(S=n.props.coordinate)===null||S===void 0?void 0:S.x)!==null&&i!==void 0?i:0,y:(E=(I=n.props.coordinate)===null||I===void 0?void 0:I.y)!==null&&E!==void 0?E:0}})}}),n}return Dwe(t,e),Owe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var o=this.wrapperNode.getBoundingClientRect();(Math.abs(o.width-this.state.lastBoundingBox.width)>bF||Math.abs(o.height-this.state.lastBoundingBox.height)>bF)&&this.setState({lastBoundingBox:{width:o.width,height:o.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var o,d;this.props.active&&this.updateBBox(),this.state.dismissed&&(((o=this.props.coordinate)===null||o===void 0?void 0:o.x)!==this.state.dismissedAtCoordinate.x||((d=this.props.coordinate)===null||d===void 0?void 0:d.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var o=this,d=this.props,f=d.active,_=d.allowEscapeViewBox,i=d.animationDuration,S=d.animationEasing,E=d.children,I=d.coordinate,M=d.hasPayload,j=d.isAnimationActive,N=d.offset,G=d.position,z=d.reverseDirection,V=d.useTranslate3d,K=d.viewBox,Q=d.wrapperStyle,X=Cwe({allowEscapeViewBox:_,coordinate:I,offsetTopLeft:N,position:G,reverseDirection:z,tooltipBox:this.state.lastBoundingBox,useTranslate3d:V,viewBox:K}),ie=X.cssClasses,J=X.cssProperties,se=xF(xF({transition:j&&f?"transform ".concat(i,"ms ").concat(S):void 0},J),{},{pointerEvents:"none",visibility:!this.state.dismissed&&f&&M?"visible":"hidden",position:"absolute",top:0,left:0},Q);return Le.createElement("div",{tabIndex:-1,className:ie,style:se,ref:function(we){o.wrapperNode=we}},E)}}])}(B.PureComponent),zwe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Kc={isSsr:zwe(),get:function(t){return Kc[t]},set:function(t,n){if(typeof t=="string")Kc[t]=n;else{var o=Object.keys(t);o&&o.length&&o.forEach(function(d){Kc[d]=t[d]})}}};function Rg(e){"@babel/helpers - typeof";return Rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rg(e)}function wF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function SF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wF(Object(n),!0).forEach(function(o){eR(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Fwe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Bwe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,sG(o.key),o)}}function $we(e,t,n){return t&&Bwe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Vwe(e,t,n){return t=Ww(t),Uwe(e,oG()?Reflect.construct(t,n||[],Ww(e).constructor):t.apply(e,n))}function Uwe(e,t){if(t&&(Rg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Gwe(e)}function Gwe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oG(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oG=function(){return!!e})()}function Ww(e){return Ww=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ww(e)}function Hwe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YC(e,t)}function YC(e,t){return YC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},YC(e,t)}function eR(e,t,n){return t=sG(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sG(e){var t=Wwe(e,"string");return Rg(t)=="symbol"?t:t+""}function Wwe(e,t){if(Rg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Rg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qwe(e){return e.dataKey}function Zwe(e,t){return Le.isValidElement(e)?Le.cloneElement(e,t):typeof e=="function"?Le.createElement(e,t):Le.createElement(wwe,t)}var Ga=function(e){function t(){return Fwe(this,t),Vwe(this,t,arguments)}return Hwe(t,e),$we(t,[{key:"render",value:function(){var o=this,d=this.props,f=d.active,_=d.allowEscapeViewBox,i=d.animationDuration,S=d.animationEasing,E=d.content,I=d.coordinate,M=d.filterNull,j=d.isAnimationActive,N=d.offset,G=d.payload,z=d.payloadUniqBy,V=d.position,K=d.reverseDirection,Q=d.useTranslate3d,X=d.viewBox,ie=d.wrapperStyle,J=G??[];M&&J.length&&(J=K8(G.filter(function(he){return he.value!=null&&(he.hide!==!0||o.props.includeHidden)}),z,qwe));var se=J.length>0;return Le.createElement(Nwe,{allowEscapeViewBox:_,animationDuration:i,animationEasing:S,isAnimationActive:j,active:f,coordinate:I,hasPayload:se,offset:N,position:V,reverseDirection:K,useTranslate3d:Q,viewBox:X,wrapperStyle:ie},Zwe(E,SF(SF({},this.props),{},{payload:J})))}}])}(B.PureComponent);eR(Ga,"displayName","Tooltip");eR(Ga,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Kc.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var Kwe=ou,Xwe=function(){return Kwe.Date.now()},Ywe=Xwe,Jwe=/\s/;function Qwe(e){for(var t=e.length;t--&&Jwe.test(e.charAt(t)););return t}var eSe=Qwe,tSe=eSe,rSe=/^\s+/;function nSe(e){return e&&e.slice(0,tSe(e)+1).replace(rSe,"")}var iSe=nSe,oSe=iSe,TF=ah,sSe=dy,AF=NaN,aSe=/^[-+]0x[0-9a-f]+$/i,lSe=/^0b[01]+$/i,cSe=/^0o[0-7]+$/i,uSe=parseInt;function dSe(e){if(typeof e=="number")return e;if(sSe(e))return AF;if(TF(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=TF(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=oSe(e);var n=lSe.test(e);return n||cSe.test(e)?uSe(e.slice(2),n?2:8):aSe.test(e)?AF:+e}var aG=dSe,hSe=ah,uP=Ywe,EF=aG,fSe="Expected a function",pSe=Math.max,mSe=Math.min;function gSe(e,t,n){var o,d,f,_,i,S,E=0,I=!1,M=!1,j=!0;if(typeof e!="function")throw new TypeError(fSe);t=EF(t)||0,hSe(n)&&(I=!!n.leading,M="maxWait"in n,f=M?pSe(EF(n.maxWait)||0,t):f,j="trailing"in n?!!n.trailing:j);function N(se){var he=o,we=d;return o=d=void 0,E=se,_=e.apply(we,he),_}function G(se){return E=se,i=setTimeout(K,t),I?N(se):_}function z(se){var he=se-S,we=se-E,ze=t-he;return M?mSe(ze,f-we):ze}function V(se){var he=se-S,we=se-E;return S===void 0||he>=t||he<0||M&&we>=f}function K(){var se=uP();if(V(se))return Q(se);i=setTimeout(K,z(se))}function Q(se){return i=void 0,j&&o?N(se):(o=d=void 0,_)}function X(){i!==void 0&&clearTimeout(i),E=0,o=S=d=i=void 0}function ie(){return i===void 0?_:Q(uP())}function J(){var se=uP(),he=V(se);if(o=arguments,d=this,S=se,he){if(i===void 0)return G(S);if(M)return clearTimeout(i),i=setTimeout(K,t),N(S)}return i===void 0&&(i=setTimeout(K,t)),_}return J.cancel=X,J.flush=ie,J}var ySe=gSe,_Se=ySe,vSe=ah,xSe="Expected a function";function bSe(e,t,n){var o=!0,d=!0;if(typeof e!="function")throw new TypeError(xSe);return vSe(n)&&(o="leading"in n?!!n.leading:o,d="trailing"in n?!!n.trailing:d),_Se(e,t,{leading:o,maxWait:t,trailing:d})}var wSe=bSe;const lG=Ni(wSe);function y0(e){"@babel/helpers - typeof";return y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y0(e)}function PF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function N1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PF(Object(n),!0).forEach(function(o){SSe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function SSe(e,t,n){return t=TSe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TSe(e){var t=ASe(e,"string");return y0(t)=="symbol"?t:t+""}function ASe(e,t){if(y0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(y0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ESe(e,t){return MSe(e)||ISe(e,t)||CSe(e,t)||PSe()}function PSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CSe(e,t){if(e){if(typeof e=="string")return CF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CF(e,t)}}function CF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ISe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function MSe(e){if(Array.isArray(e))return e}var JC=B.forwardRef(function(e,t){var n=e.aspect,o=e.initialDimension,d=o===void 0?{width:-1,height:-1}:o,f=e.width,_=f===void 0?"100%":f,i=e.height,S=i===void 0?"100%":i,E=e.minWidth,I=E===void 0?0:E,M=e.minHeight,j=e.maxHeight,N=e.children,G=e.debounce,z=G===void 0?0:G,V=e.id,K=e.className,Q=e.onResize,X=e.style,ie=X===void 0?{}:X,J=B.useRef(null),se=B.useRef();se.current=Q,B.useImperativeHandle(t,function(){return Object.defineProperty(J.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),J.current},configurable:!0})});var he=B.useState({containerWidth:d.width,containerHeight:d.height}),we=ESe(he,2),ze=we[0],je=we[1],Oe=B.useCallback(function(qe,Xe){je(function(it){var Ge=Math.round(qe),Ke=Math.round(Xe);return it.containerWidth===Ge&&it.containerHeight===Ke?it:{containerWidth:Ge,containerHeight:Ke}})},[]);B.useEffect(function(){var qe=function(rt){var Xt,cr=rt[0].contentRect,Bt=cr.width,$t=cr.height;Oe(Bt,$t),(Xt=se.current)===null||Xt===void 0||Xt.call(se,Bt,$t)};z>0&&(qe=lG(qe,z,{trailing:!0,leading:!1}));var Xe=new ResizeObserver(qe),it=J.current.getBoundingClientRect(),Ge=it.width,Ke=it.height;return Oe(Ge,Ke),Xe.observe(J.current),function(){Xe.disconnect()}},[Oe,z]);var Be=B.useMemo(function(){var qe=ze.containerWidth,Xe=ze.containerHeight;if(qe<0||Xe<0)return null;lc(Sf(_)||Sf(S),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,_,S),lc(!n||n>0,"The aspect(%s) must be greater than zero.",n);var it=Sf(_)?qe:_,Ge=Sf(S)?Xe:S;n&&n>0&&(it?Ge=it/n:Ge&&(it=Ge*n),j&&Ge>j&&(Ge=j)),lc(it>0||Ge>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,it,Ge,_,S,I,M,n);var Ke=!Array.isArray(N)&&Vu(N.type).endsWith("Chart");return Le.Children.map(N,function(ut){return Le.isValidElement(ut)?B.cloneElement(ut,N1({width:it,height:Ge},Ke?{style:N1({height:"100%",width:"100%",maxHeight:Ge,maxWidth:it},ut.props.style)}:{})):ut})},[n,N,S,j,M,I,ze,_]);return Le.createElement("div",{id:V?"".concat(V):void 0,className:ni("recharts-responsive-container",K),style:N1(N1({},ie),{},{width:_,height:S,minWidth:I,minHeight:M,maxHeight:j}),ref:J},Be)}),tR=function(t){return null};tR.displayName="Cell";function _0(e){"@babel/helpers - typeof";return _0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_0(e)}function IF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function QC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IF(Object(n),!0).forEach(function(o){OSe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IF(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function OSe(e,t,n){return t=RSe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RSe(e){var t=kSe(e,"string");return _0(t)=="symbol"?t:t+""}function kSe(e,t){if(_0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(_0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Xm={widthCache:{},cacheCount:0},jSe=2e3,DSe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},MF="recharts_measurement_span";function LSe(e){var t=QC({},e);return Object.keys(t).forEach(function(n){t[n]||delete t[n]}),t}var Kv=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Kc.isSsr)return{width:0,height:0};var o=LSe(n),d=JSON.stringify({text:t,copyStyle:o});if(Xm.widthCache[d])return Xm.widthCache[d];try{var f=document.getElementById(MF);f||(f=document.createElement("span"),f.setAttribute("id",MF),f.setAttribute("aria-hidden","true"),document.body.appendChild(f));var _=QC(QC({},DSe),o);Object.assign(f.style,_),f.textContent="".concat(t);var i=f.getBoundingClientRect(),S={width:i.width,height:i.height};return Xm.widthCache[d]=S,++Xm.cacheCount>jSe&&(Xm.cacheCount=0,Xm.widthCache={}),S}catch{return{width:0,height:0}}},NSe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function v0(e){"@babel/helpers - typeof";return v0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v0(e)}function qw(e,t){return $Se(e)||BSe(e,t)||FSe(e,t)||zSe()}function zSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FSe(e,t){if(e){if(typeof e=="string")return OF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return OF(e,t)}}function OF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function BSe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;S=!1}else for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function $Se(e){if(Array.isArray(e))return e}function VSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RF(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,GSe(o.key),o)}}function USe(e,t,n){return t&&RF(e.prototype,t),n&&RF(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function GSe(e){var t=HSe(e,"string");return v0(t)=="symbol"?t:t+""}function HSe(e,t){if(v0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(v0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var kF=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,jF=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,WSe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,qSe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,cG={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},ZSe=Object.keys(cG),sg="NaN";function KSe(e,t){return e*cG[t]}var z1=function(){function e(t,n){VSe(this,e),this.num=t,this.unit=n,this.num=t,this.unit=n,Number.isNaN(t)&&(this.unit=""),n!==""&&!WSe.test(n)&&(this.num=NaN,this.unit=""),ZSe.includes(n)&&(this.num=KSe(t,n),this.unit="px")}return USe(e,[{key:"add",value:function(n){return this.unit!==n.unit?new e(NaN,""):new e(this.num+n.num,this.unit)}},{key:"subtract",value:function(n){return this.unit!==n.unit?new e(NaN,""):new e(this.num-n.num,this.unit)}},{key:"multiply",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new e(NaN,""):new e(this.num*n.num,this.unit||n.unit)}},{key:"divide",value:function(n){return this.unit!==""&&n.unit!==""&&this.unit!==n.unit?new e(NaN,""):new e(this.num/n.num,this.unit||n.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(n){var o,d=(o=qSe.exec(n))!==null&&o!==void 0?o:[],f=qw(d,3),_=f[1],i=f[2];return new e(parseFloat(_),i??"")}}])}();function uG(e){if(e.includes(sg))return sg;for(var t=e;t.includes("*")||t.includes("/");){var n,o=(n=kF.exec(t))!==null&&n!==void 0?n:[],d=qw(o,4),f=d[1],_=d[2],i=d[3],S=z1.parse(f??""),E=z1.parse(i??""),I=_==="*"?S.multiply(E):S.divide(E);if(I.isNaN())return sg;t=t.replace(kF,I.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var M,j=(M=jF.exec(t))!==null&&M!==void 0?M:[],N=qw(j,4),G=N[1],z=N[2],V=N[3],K=z1.parse(G??""),Q=z1.parse(V??""),X=z==="+"?K.add(Q):K.subtract(Q);if(X.isNaN())return sg;t=t.replace(jF,X.toString())}return t}var DF=/\(([^()]*)\)/;function XSe(e){for(var t=e;t.includes("(");){var n=DF.exec(t),o=qw(n,2),d=o[1];t=t.replace(DF,uG(d))}return t}function YSe(e){var t=e.replace(/\s+/g,"");return t=XSe(t),t=uG(t),t}function JSe(e){try{return YSe(e)}catch{return sg}}function dP(e){var t=JSe(e.slice(5,-1));return t===sg?"":t}var QSe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],eTe=["dx","dy","angle","className","breakAll"];function eI(){return eI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},eI.apply(this,arguments)}function LF(e,t){if(e==null)return{};var n=tTe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function tTe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function NF(e,t){return oTe(e)||iTe(e,t)||nTe(e,t)||rTe()}function rTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nTe(e,t){if(e){if(typeof e=="string")return zF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zF(e,t)}}function zF(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function iTe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;S=!1}else for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function oTe(e){if(Array.isArray(e))return e}var dG=/[ \f\n\r\t\v\u2028\u2029]+/,hG=function(t){var n=t.children,o=t.breakAll,d=t.style;try{var f=[];Jn(n)||(o?f=n.toString().split(""):f=n.toString().split(dG));var _=f.map(function(S){return{word:S,width:Kv(S,d).width}}),i=o?0:Kv("",d).width;return{wordsWithComputedWidth:_,spaceWidth:i}}catch{return null}},sTe=function(t,n,o,d,f){var _=t.maxLines,i=t.children,S=t.style,E=t.breakAll,I=vr(_),M=i,j=function(){var it=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return it.reduce(function(Ge,Ke){var ut=Ke.word,rt=Ke.width,Xt=Ge[Ge.length-1];if(Xt&&(d==null||f||Xt.width+rt+o<Number(d)))Xt.words.push(ut),Xt.width+=rt+o;else{var cr={words:[ut],width:rt};Ge.push(cr)}return Ge},[])},N=j(n),G=function(it){return it.reduce(function(Ge,Ke){return Ge.width>Ke.width?Ge:Ke})};if(!I)return N;for(var z="",V=function(it){var Ge=M.slice(0,it),Ke=hG({breakAll:E,style:S,children:Ge+z}).wordsWithComputedWidth,ut=j(Ke),rt=ut.length>_||G(ut).width>Number(d);return[rt,ut]},K=0,Q=M.length-1,X=0,ie;K<=Q&&X<=M.length-1;){var J=Math.floor((K+Q)/2),se=J-1,he=V(se),we=NF(he,2),ze=we[0],je=we[1],Oe=V(J),Be=NF(Oe,1),qe=Be[0];if(!ze&&!qe&&(K=J+1),ze&&qe&&(Q=J-1),!ze&&qe){ie=je;break}X++}return ie||N},FF=function(t){var n=Jn(t)?[]:t.toString().split(dG);return[{words:n}]},aTe=function(t){var n=t.width,o=t.scaleToFit,d=t.children,f=t.style,_=t.breakAll,i=t.maxLines;if((n||o)&&!Kc.isSsr){var S,E,I=hG({breakAll:_,children:d,style:f});if(I){var M=I.wordsWithComputedWidth,j=I.spaceWidth;S=M,E=j}else return FF(d);return sTe({breakAll:_,children:d,maxLines:i,style:f},S,E,n,o)}return FF(d)},BF="#808080",Uf=function(t){var n=t.x,o=n===void 0?0:n,d=t.y,f=d===void 0?0:d,_=t.lineHeight,i=_===void 0?"1em":_,S=t.capHeight,E=S===void 0?"0.71em":S,I=t.scaleToFit,M=I===void 0?!1:I,j=t.textAnchor,N=j===void 0?"start":j,G=t.verticalAnchor,z=G===void 0?"end":G,V=t.fill,K=V===void 0?BF:V,Q=LF(t,QSe),X=B.useMemo(function(){return aTe({breakAll:Q.breakAll,children:Q.children,maxLines:Q.maxLines,scaleToFit:M,style:Q.style,width:Q.width})},[Q.breakAll,Q.children,Q.maxLines,M,Q.style,Q.width]),ie=Q.dx,J=Q.dy,se=Q.angle,he=Q.className,we=Q.breakAll,ze=LF(Q,eTe);if(!fs(o)||!fs(f))return null;var je=o+(vr(ie)?ie:0),Oe=f+(vr(J)?J:0),Be;switch(z){case"start":Be=dP("calc(".concat(E,")"));break;case"middle":Be=dP("calc(".concat((X.length-1)/2," * -").concat(i," + (").concat(E," / 2))"));break;default:Be=dP("calc(".concat(X.length-1," * -").concat(i,")"));break}var qe=[];if(M){var Xe=X[0].width,it=Q.width;qe.push("scale(".concat((vr(it)?it/Xe:1)/Xe,")"))}return se&&qe.push("rotate(".concat(se,", ").concat(je,", ").concat(Oe,")")),qe.length&&(ze.transform=qe.join(" ")),Le.createElement("text",eI({},Tn(ze,!0),{x:je,y:Oe,className:ni("recharts-text",he),textAnchor:N,fill:K.includes("url")?BF:K}),X.map(function(Ge,Ke){var ut=Ge.words.join(we?"":" ");return Le.createElement("tspan",{x:je,dy:Ke===0?Be:i,key:"".concat(ut,"-").concat(Ke)},ut)}))};function Yd(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lTe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function rR(e){let t,n,o;e.length!==2?(t=Yd,n=(i,S)=>Yd(e(i),S),o=(i,S)=>e(i)-S):(t=e===Yd||e===lTe?e:cTe,n=e,o=e);function d(i,S,E=0,I=i.length){if(E<I){if(t(S,S)!==0)return I;do{const M=E+I>>>1;n(i[M],S)<0?E=M+1:I=M}while(E<I)}return E}function f(i,S,E=0,I=i.length){if(E<I){if(t(S,S)!==0)return I;do{const M=E+I>>>1;n(i[M],S)<=0?E=M+1:I=M}while(E<I)}return E}function _(i,S,E=0,I=i.length){const M=d(i,S,E,I-1);return M>E&&o(i[M-1],S)>-o(i[M],S)?M-1:M}return{left:d,center:_,right:f}}function cTe(){return 0}function fG(e){return e===null?NaN:+e}function*uTe(e,t){for(let n of e)n!=null&&(n=+n)>=n&&(yield n)}const dTe=rR(Yd),hx=dTe.right;rR(fG).center;class $F extends Map{constructor(t,n=pTe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[o,d]of t)this.set(o,d)}get(t){return super.get(VF(this,t))}has(t){return super.has(VF(this,t))}set(t,n){return super.set(hTe(this,t),n)}delete(t){return super.delete(fTe(this,t))}}function VF({_intern:e,_key:t},n){const o=t(n);return e.has(o)?e.get(o):n}function hTe({_intern:e,_key:t},n){const o=t(n);return e.has(o)?e.get(o):(e.set(o,n),n)}function fTe({_intern:e,_key:t},n){const o=t(n);return e.has(o)&&(n=e.get(o),e.delete(o)),n}function pTe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function mTe(e=Yd){if(e===Yd)return pG;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const o=e(t,n);return o||o===0?o:(e(n,n)===0)-(e(t,t)===0)}}function pG(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const gTe=Math.sqrt(50),yTe=Math.sqrt(10),_Te=Math.sqrt(2);function Zw(e,t,n){const o=(t-e)/Math.max(0,n),d=Math.floor(Math.log10(o)),f=o/Math.pow(10,d),_=f>=gTe?10:f>=yTe?5:f>=_Te?2:1;let i,S,E;return d<0?(E=Math.pow(10,-d)/_,i=Math.round(e*E),S=Math.round(t*E),i/E<e&&++i,S/E>t&&--S,E=-E):(E=Math.pow(10,d)*_,i=Math.round(e/E),S=Math.round(t/E),i*E<e&&++i,S*E>t&&--S),S<i&&.5<=n&&n<2?Zw(e,t,n*2):[i,S,E]}function tI(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const o=t<e,[d,f,_]=o?Zw(t,e,n):Zw(e,t,n);if(!(f>=d))return[];const i=f-d+1,S=new Array(i);if(o)if(_<0)for(let E=0;E<i;++E)S[E]=(f-E)/-_;else for(let E=0;E<i;++E)S[E]=(f-E)*_;else if(_<0)for(let E=0;E<i;++E)S[E]=(d+E)/-_;else for(let E=0;E<i;++E)S[E]=(d+E)*_;return S}function rI(e,t,n){return t=+t,e=+e,n=+n,Zw(e,t,n)[2]}function nI(e,t,n){t=+t,e=+e,n=+n;const o=t<e,d=o?rI(t,e,n):rI(e,t,n);return(o?-1:1)*(d<0?1/-d:d)}function UF(e,t){let n;for(const o of e)o!=null&&(n<o||n===void 0&&o>=o)&&(n=o);return n}function GF(e,t){let n;for(const o of e)o!=null&&(n>o||n===void 0&&o>=o)&&(n=o);return n}function mG(e,t,n=0,o=1/0,d){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),o=Math.floor(Math.min(e.length-1,o)),!(n<=t&&t<=o))return e;for(d=d===void 0?pG:mTe(d);o>n;){if(o-n>600){const S=o-n+1,E=t-n+1,I=Math.log(S),M=.5*Math.exp(2*I/3),j=.5*Math.sqrt(I*M*(S-M)/S)*(E-S/2<0?-1:1),N=Math.max(n,Math.floor(t-E*M/S+j)),G=Math.min(o,Math.floor(t+(S-E)*M/S+j));mG(e,t,N,G,d)}const f=e[t];let _=n,i=o;for(Mv(e,n,t),d(e[o],f)>0&&Mv(e,n,o);_<i;){for(Mv(e,_,i),++_,--i;d(e[_],f)<0;)++_;for(;d(e[i],f)>0;)--i}d(e[n],f)===0?Mv(e,n,i):(++i,Mv(e,i,o)),i<=t&&(n=i+1),t<=i&&(o=i-1)}return e}function Mv(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function vTe(e,t,n){if(e=Float64Array.from(uTe(e)),!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return GF(e);if(t>=1)return UF(e);var o,d=(o-1)*t,f=Math.floor(d),_=UF(mG(e,f).subarray(0,f+1)),i=GF(e.subarray(f+1));return _+(i-_)*(d-f)}}function xTe(e,t,n=fG){if(!(!(o=e.length)||isNaN(t=+t))){if(t<=0||o<2)return+n(e[0],0,e);if(t>=1)return+n(e[o-1],o-1,e);var o,d=(o-1)*t,f=Math.floor(d),_=+n(e[f],f,e),i=+n(e[f+1],f+1,e);return _+(i-_)*(d-f)}}function bTe(e,t,n){e=+e,t=+t,n=(d=arguments.length)<2?(t=e,e=0,1):d<3?1:+n;for(var o=-1,d=Math.max(0,Math.ceil((t-e)/n))|0,f=new Array(d);++o<d;)f[o]=e+o*n;return f}function Pl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function rd(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const iI=Symbol("implicit");function nR(){var e=new $F,t=[],n=[],o=iI;function d(f){let _=e.get(f);if(_===void 0){if(o!==iI)return o;e.set(f,_=t.push(f)-1)}return n[_%n.length]}return d.domain=function(f){if(!arguments.length)return t.slice();t=[],e=new $F;for(const _ of f)e.has(_)||e.set(_,t.push(_)-1);return d},d.range=function(f){return arguments.length?(n=Array.from(f),d):n.slice()},d.unknown=function(f){return arguments.length?(o=f,d):o},d.copy=function(){return nR(t,n).unknown(o)},Pl.apply(d,arguments),d}function x0(){var e=nR().unknown(void 0),t=e.domain,n=e.range,o=0,d=1,f,_,i=!1,S=0,E=0,I=.5;delete e.unknown;function M(){var j=t().length,N=d<o,G=N?d:o,z=N?o:d;f=(z-G)/Math.max(1,j-S+E*2),i&&(f=Math.floor(f)),G+=(z-G-f*(j-S))*I,_=f*(1-S),i&&(G=Math.round(G),_=Math.round(_));var V=bTe(j).map(function(K){return G+f*K});return n(N?V.reverse():V)}return e.domain=function(j){return arguments.length?(t(j),M()):t()},e.range=function(j){return arguments.length?([o,d]=j,o=+o,d=+d,M()):[o,d]},e.rangeRound=function(j){return[o,d]=j,o=+o,d=+d,i=!0,M()},e.bandwidth=function(){return _},e.step=function(){return f},e.round=function(j){return arguments.length?(i=!!j,M()):i},e.padding=function(j){return arguments.length?(S=Math.min(1,E=+j),M()):S},e.paddingInner=function(j){return arguments.length?(S=Math.min(1,j),M()):S},e.paddingOuter=function(j){return arguments.length?(E=+j,M()):E},e.align=function(j){return arguments.length?(I=Math.max(0,Math.min(1,j)),M()):I},e.copy=function(){return x0(t(),[o,d]).round(i).paddingInner(S).paddingOuter(E).align(I)},Pl.apply(M(),arguments)}function gG(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return gG(t())},e}function Xv(){return gG(x0.apply(null,arguments).paddingInner(1))}function iR(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function yG(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function fx(){}var b0=.7,Kw=1/b0,vg="\\s*([+-]?\\d+)\\s*",w0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wTe=/^#([0-9a-f]{3,8})$/,STe=new RegExp(`^rgb\\(${vg},${vg},${vg}\\)$`),TTe=new RegExp(`^rgb\\(${Xc},${Xc},${Xc}\\)$`),ATe=new RegExp(`^rgba\\(${vg},${vg},${vg},${w0}\\)$`),ETe=new RegExp(`^rgba\\(${Xc},${Xc},${Xc},${w0}\\)$`),PTe=new RegExp(`^hsl\\(${w0},${Xc},${Xc}\\)$`),CTe=new RegExp(`^hsla\\(${w0},${Xc},${Xc},${w0}\\)$`),HF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};iR(fx,S0,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:WF,formatHex:WF,formatHex8:ITe,formatHsl:MTe,formatRgb:qF,toString:qF});function WF(){return this.rgb().formatHex()}function ITe(){return this.rgb().formatHex8()}function MTe(){return _G(this).formatHsl()}function qF(){return this.rgb().formatRgb()}function S0(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=wTe.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?ZF(t):n===3?new Sa(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?F1(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?F1(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=STe.exec(e))?new Sa(t[1],t[2],t[3],1):(t=TTe.exec(e))?new Sa(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ATe.exec(e))?F1(t[1],t[2],t[3],t[4]):(t=ETe.exec(e))?F1(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=PTe.exec(e))?YF(t[1],t[2]/100,t[3]/100,1):(t=CTe.exec(e))?YF(t[1],t[2]/100,t[3]/100,t[4]):HF.hasOwnProperty(e)?ZF(HF[e]):e==="transparent"?new Sa(NaN,NaN,NaN,0):null}function ZF(e){return new Sa(e>>16&255,e>>8&255,e&255,1)}function F1(e,t,n,o){return o<=0&&(e=t=n=NaN),new Sa(e,t,n,o)}function OTe(e){return e instanceof fx||(e=S0(e)),e?(e=e.rgb(),new Sa(e.r,e.g,e.b,e.opacity)):new Sa}function oI(e,t,n,o){return arguments.length===1?OTe(e):new Sa(e,t,n,o??1)}function Sa(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}iR(Sa,oI,yG(fx,{brighter(e){return e=e==null?Kw:Math.pow(Kw,e),new Sa(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?b0:Math.pow(b0,e),new Sa(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Sa(Mf(this.r),Mf(this.g),Mf(this.b),Xw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KF,formatHex:KF,formatHex8:RTe,formatRgb:XF,toString:XF}));function KF(){return`#${Tf(this.r)}${Tf(this.g)}${Tf(this.b)}`}function RTe(){return`#${Tf(this.r)}${Tf(this.g)}${Tf(this.b)}${Tf((isNaN(this.opacity)?1:this.opacity)*255)}`}function XF(){const e=Xw(this.opacity);return`${e===1?"rgb(":"rgba("}${Mf(this.r)}, ${Mf(this.g)}, ${Mf(this.b)}${e===1?")":`, ${e})`}`}function Xw(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Mf(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Tf(e){return e=Mf(e),(e<16?"0":"")+e.toString(16)}function YF(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new oc(e,t,n,o)}function _G(e){if(e instanceof oc)return new oc(e.h,e.s,e.l,e.opacity);if(e instanceof fx||(e=S0(e)),!e)return new oc;if(e instanceof oc)return e;e=e.rgb();var t=e.r/255,n=e.g/255,o=e.b/255,d=Math.min(t,n,o),f=Math.max(t,n,o),_=NaN,i=f-d,S=(f+d)/2;return i?(t===f?_=(n-o)/i+(n<o)*6:n===f?_=(o-t)/i+2:_=(t-n)/i+4,i/=S<.5?f+d:2-f-d,_*=60):i=S>0&&S<1?0:_,new oc(_,i,S,e.opacity)}function kTe(e,t,n,o){return arguments.length===1?_G(e):new oc(e,t,n,o??1)}function oc(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}iR(oc,kTe,yG(fx,{brighter(e){return e=e==null?Kw:Math.pow(Kw,e),new oc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?b0:Math.pow(b0,e),new oc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,d=2*n-o;return new Sa(hP(e>=240?e-240:e+120,d,o),hP(e,d,o),hP(e<120?e+240:e-120,d,o),this.opacity)},clamp(){return new oc(JF(this.h),B1(this.s),B1(this.l),Xw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Xw(this.opacity);return`${e===1?"hsl(":"hsla("}${JF(this.h)}, ${B1(this.s)*100}%, ${B1(this.l)*100}%${e===1?")":`, ${e})`}`}}));function JF(e){return e=(e||0)%360,e<0?e+360:e}function B1(e){return Math.max(0,Math.min(1,e||0))}function hP(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const oR=e=>()=>e;function jTe(e,t){return function(n){return e+n*t}}function DTe(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}function LTe(e){return(e=+e)==1?vG:function(t,n){return n-t?DTe(t,n,e):oR(isNaN(t)?n:t)}}function vG(e,t){var n=t-e;return n?jTe(e,n):oR(isNaN(e)?t:e)}const QF=function e(t){var n=LTe(t);function o(d,f){var _=n((d=oI(d)).r,(f=oI(f)).r),i=n(d.g,f.g),S=n(d.b,f.b),E=vG(d.opacity,f.opacity);return function(I){return d.r=_(I),d.g=i(I),d.b=S(I),d.opacity=E(I),d+""}}return o.gamma=e,o}(1);function NTe(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,o=t.slice(),d;return function(f){for(d=0;d<n;++d)o[d]=e[d]*(1-f)+t[d]*f;return o}}function zTe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function FTe(e,t){var n=t?t.length:0,o=e?Math.min(n,e.length):0,d=new Array(o),f=new Array(n),_;for(_=0;_<o;++_)d[_]=xy(e[_],t[_]);for(;_<n;++_)f[_]=t[_];return function(i){for(_=0;_<o;++_)f[_]=d[_](i);return f}}function BTe(e,t){var n=new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function Yw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function $Te(e,t){var n={},o={},d;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(d in t)d in e?n[d]=xy(e[d],t[d]):o[d]=t[d];return function(f){for(d in n)o[d]=n[d](f);return o}}var sI=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fP=new RegExp(sI.source,"g");function VTe(e){return function(){return e}}function UTe(e){return function(t){return e(t)+""}}function GTe(e,t){var n=sI.lastIndex=fP.lastIndex=0,o,d,f,_=-1,i=[],S=[];for(e=e+"",t=t+"";(o=sI.exec(e))&&(d=fP.exec(t));)(f=d.index)>n&&(f=t.slice(n,f),i[_]?i[_]+=f:i[++_]=f),(o=o[0])===(d=d[0])?i[_]?i[_]+=d:i[++_]=d:(i[++_]=null,S.push({i:_,x:Yw(o,d)})),n=fP.lastIndex;return n<t.length&&(f=t.slice(n),i[_]?i[_]+=f:i[++_]=f),i.length<2?S[0]?UTe(S[0].x):VTe(t):(t=S.length,function(E){for(var I=0,M;I<t;++I)i[(M=S[I]).i]=M.x(E);return i.join("")})}function xy(e,t){var n=typeof t,o;return t==null||n==="boolean"?oR(t):(n==="number"?Yw:n==="string"?(o=S0(t))?(t=o,QF):GTe:t instanceof S0?QF:t instanceof Date?BTe:zTe(t)?NTe:Array.isArray(t)?FTe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?$Te:Yw)(e,t)}function sR(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function HTe(e,t){t===void 0&&(t=e,e=xy);for(var n=0,o=t.length-1,d=t[0],f=new Array(o<0?0:o);n<o;)f[n]=e(d,d=t[++n]);return function(_){var i=Math.max(0,Math.min(o-1,Math.floor(_*=o)));return f[i](_-i)}}function WTe(e){return function(){return e}}function Jw(e){return+e}var eB=[0,1];function sa(e){return e}function aI(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:WTe(isNaN(t)?NaN:.5)}function qTe(e,t){var n;return e>t&&(n=e,e=t,t=n),function(o){return Math.max(e,Math.min(t,o))}}function ZTe(e,t,n){var o=e[0],d=e[1],f=t[0],_=t[1];return d<o?(o=aI(d,o),f=n(_,f)):(o=aI(o,d),f=n(f,_)),function(i){return f(o(i))}}function KTe(e,t,n){var o=Math.min(e.length,t.length)-1,d=new Array(o),f=new Array(o),_=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++_<o;)d[_]=aI(e[_],e[_+1]),f[_]=n(t[_],t[_+1]);return function(i){var S=hx(e,i,1,o)-1;return f[S](d[S](i))}}function px(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function LT(){var e=eB,t=eB,n=xy,o,d,f,_=sa,i,S,E;function I(){var j=Math.min(e.length,t.length);return _!==sa&&(_=qTe(e[0],e[j-1])),i=j>2?KTe:ZTe,S=E=null,M}function M(j){return j==null||isNaN(j=+j)?f:(S||(S=i(e.map(o),t,n)))(o(_(j)))}return M.invert=function(j){return _(d((E||(E=i(t,e.map(o),Yw)))(j)))},M.domain=function(j){return arguments.length?(e=Array.from(j,Jw),I()):e.slice()},M.range=function(j){return arguments.length?(t=Array.from(j),I()):t.slice()},M.rangeRound=function(j){return t=Array.from(j),n=sR,I()},M.clamp=function(j){return arguments.length?(_=j?!0:sa,I()):_!==sa},M.interpolate=function(j){return arguments.length?(n=j,I()):n},M.unknown=function(j){return arguments.length?(f=j,M):f},function(j,N){return o=j,d=N,I()}}function aR(){return LT()(sa,sa)}function XTe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Qw(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,o=e.slice(0,n);return[o.length>1?o[0]+o.slice(2):o,+e.slice(n+1)]}function kg(e){return e=Qw(Math.abs(e)),e?e[1]:NaN}function YTe(e,t){return function(n,o){for(var d=n.length,f=[],_=0,i=e[0],S=0;d>0&&i>0&&(S+i+1>o&&(i=Math.max(1,o-S)),f.push(n.substring(d-=i,d+i)),!((S+=i+1)>o));)i=e[_=(_+1)%e.length];return f.reverse().join(t)}}function JTe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var QTe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function T0(e){if(!(t=QTe.exec(e)))throw new Error("invalid format: "+e);var t;return new lR({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}T0.prototype=lR.prototype;function lR(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}lR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function e2e(e){e:for(var t=e.length,n=1,o=-1,d;n<t;++n)switch(e[n]){case".":o=d=n;break;case"0":o===0&&(o=n),d=n;break;default:if(!+e[n])break e;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(d+1):e}var xG;function t2e(e,t){var n=Qw(e,t);if(!n)return e+"";var o=n[0],d=n[1],f=d-(xG=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,_=o.length;return f===_?o:f>_?o+new Array(f-_+1).join("0"):f>0?o.slice(0,f)+"."+o.slice(f):"0."+new Array(1-f).join("0")+Qw(e,Math.max(0,t+f-1))[0]}function tB(e,t){var n=Qw(e,t);if(!n)return e+"";var o=n[0],d=n[1];return d<0?"0."+new Array(-d).join("0")+o:o.length>d+1?o.slice(0,d+1)+"."+o.slice(d+1):o+new Array(d-o.length+2).join("0")}const rB={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:XTe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>tB(e*100,t),r:tB,s:t2e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function nB(e){return e}var iB=Array.prototype.map,oB=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function r2e(e){var t=e.grouping===void 0||e.thousands===void 0?nB:YTe(iB.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",f=e.numerals===void 0?nB:JTe(iB.call(e.numerals,String)),_=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",S=e.nan===void 0?"NaN":e.nan+"";function E(M){M=T0(M);var j=M.fill,N=M.align,G=M.sign,z=M.symbol,V=M.zero,K=M.width,Q=M.comma,X=M.precision,ie=M.trim,J=M.type;J==="n"?(Q=!0,J="g"):rB[J]||(X===void 0&&(X=12),ie=!0,J="g"),(V||j==="0"&&N==="=")&&(V=!0,j="0",N="=");var se=z==="$"?n:z==="#"&&/[boxX]/.test(J)?"0"+J.toLowerCase():"",he=z==="$"?o:/[%p]/.test(J)?_:"",we=rB[J],ze=/[defgprs%]/.test(J);X=X===void 0?6:/[gprs]/.test(J)?Math.max(1,Math.min(21,X)):Math.max(0,Math.min(20,X));function je(Oe){var Be=se,qe=he,Xe,it,Ge;if(J==="c")qe=we(Oe)+qe,Oe="";else{Oe=+Oe;var Ke=Oe<0||1/Oe<0;if(Oe=isNaN(Oe)?S:we(Math.abs(Oe),X),ie&&(Oe=e2e(Oe)),Ke&&+Oe==0&&G!=="+"&&(Ke=!1),Be=(Ke?G==="("?G:i:G==="-"||G==="("?"":G)+Be,qe=(J==="s"?oB[8+xG/3]:"")+qe+(Ke&&G==="("?")":""),ze){for(Xe=-1,it=Oe.length;++Xe<it;)if(Ge=Oe.charCodeAt(Xe),48>Ge||Ge>57){qe=(Ge===46?d+Oe.slice(Xe+1):Oe.slice(Xe))+qe,Oe=Oe.slice(0,Xe);break}}}Q&&!V&&(Oe=t(Oe,1/0));var ut=Be.length+Oe.length+qe.length,rt=ut<K?new Array(K-ut+1).join(j):"";switch(Q&&V&&(Oe=t(rt+Oe,rt.length?K-qe.length:1/0),rt=""),N){case"<":Oe=Be+Oe+qe+rt;break;case"=":Oe=Be+rt+Oe+qe;break;case"^":Oe=rt.slice(0,ut=rt.length>>1)+Be+Oe+qe+rt.slice(ut);break;default:Oe=rt+Be+Oe+qe;break}return f(Oe)}return je.toString=function(){return M+""},je}function I(M,j){var N=E((M=T0(M),M.type="f",M)),G=Math.max(-8,Math.min(8,Math.floor(kg(j)/3)))*3,z=Math.pow(10,-G),V=oB[8+G/3];return function(K){return N(z*K)+V}}return{format:E,formatPrefix:I}}var $1,cR,bG;n2e({thousands:",",grouping:[3],currency:["$",""]});function n2e(e){return $1=r2e(e),cR=$1.format,bG=$1.formatPrefix,$1}function i2e(e){return Math.max(0,-kg(Math.abs(e)))}function o2e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kg(t)/3)))*3-kg(Math.abs(e)))}function s2e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kg(t)-kg(e))+1}function wG(e,t,n,o){var d=nI(e,t,n),f;switch(o=T0(o??",f"),o.type){case"s":{var _=Math.max(Math.abs(e),Math.abs(t));return o.precision==null&&!isNaN(f=o2e(d,_))&&(o.precision=f),bG(o,_)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(f=s2e(d,Math.max(Math.abs(e),Math.abs(t))))&&(o.precision=f-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(f=i2e(d))&&(o.precision=f-(o.type==="%")*2);break}}return cR(o)}function lh(e){var t=e.domain;return e.ticks=function(n){var o=t();return tI(o[0],o[o.length-1],n??10)},e.tickFormat=function(n,o){var d=t();return wG(d[0],d[d.length-1],n??10,o)},e.nice=function(n){n==null&&(n=10);var o=t(),d=0,f=o.length-1,_=o[d],i=o[f],S,E,I=10;for(i<_&&(E=_,_=i,i=E,E=d,d=f,f=E);I-- >0;){if(E=rI(_,i,n),E===S)return o[d]=_,o[f]=i,t(o);if(E>0)_=Math.floor(_/E)*E,i=Math.ceil(i/E)*E;else if(E<0)_=Math.ceil(_*E)/E,i=Math.floor(i*E)/E;else break;S=E}return e},e}function eS(){var e=aR();return e.copy=function(){return px(e,eS())},Pl.apply(e,arguments),lh(e)}function SG(e){var t;function n(o){return o==null||isNaN(o=+o)?t:o}return n.invert=n,n.domain=n.range=function(o){return arguments.length?(e=Array.from(o,Jw),n):e.slice()},n.unknown=function(o){return arguments.length?(t=o,n):t},n.copy=function(){return SG(e).unknown(t)},e=arguments.length?Array.from(e,Jw):[0,1],lh(n)}function TG(e,t){e=e.slice();var n=0,o=e.length-1,d=e[n],f=e[o],_;return f<d&&(_=n,n=o,o=_,_=d,d=f,f=_),e[n]=t.floor(d),e[o]=t.ceil(f),e}function sB(e){return Math.log(e)}function aB(e){return Math.exp(e)}function a2e(e){return-Math.log(-e)}function l2e(e){return-Math.exp(-e)}function c2e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function u2e(e){return e===10?c2e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function d2e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function lB(e){return(t,n)=>-e(-t,n)}function uR(e){const t=e(sB,aB),n=t.domain;let o=10,d,f;function _(){return d=d2e(o),f=u2e(o),n()[0]<0?(d=lB(d),f=lB(f),e(a2e,l2e)):e(sB,aB),t}return t.base=function(i){return arguments.length?(o=+i,_()):o},t.domain=function(i){return arguments.length?(n(i),_()):n()},t.ticks=i=>{const S=n();let E=S[0],I=S[S.length-1];const M=I<E;M&&([E,I]=[I,E]);let j=d(E),N=d(I),G,z;const V=i==null?10:+i;let K=[];if(!(o%1)&&N-j<V){if(j=Math.floor(j),N=Math.ceil(N),E>0){for(;j<=N;++j)for(G=1;G<o;++G)if(z=j<0?G/f(-j):G*f(j),!(z<E)){if(z>I)break;K.push(z)}}else for(;j<=N;++j)for(G=o-1;G>=1;--G)if(z=j>0?G/f(-j):G*f(j),!(z<E)){if(z>I)break;K.push(z)}K.length*2<V&&(K=tI(E,I,V))}else K=tI(j,N,Math.min(N-j,V)).map(f);return M?K.reverse():K},t.tickFormat=(i,S)=>{if(i==null&&(i=10),S==null&&(S=o===10?"s":","),typeof S!="function"&&(!(o%1)&&(S=T0(S)).precision==null&&(S.trim=!0),S=cR(S)),i===1/0)return S;const E=Math.max(1,o*i/t.ticks().length);return I=>{let M=I/f(Math.round(d(I)));return M*o<o-.5&&(M*=o),M<=E?S(I):""}},t.nice=()=>n(TG(n(),{floor:i=>f(Math.floor(d(i))),ceil:i=>f(Math.ceil(d(i)))})),t}function AG(){const e=uR(LT()).domain([1,10]);return e.copy=()=>px(e,AG()).base(e.base()),Pl.apply(e,arguments),e}function cB(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function uB(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function dR(e){var t=1,n=e(cB(t),uB(t));return n.constant=function(o){return arguments.length?e(cB(t=+o),uB(t)):t},lh(n)}function EG(){var e=dR(LT());return e.copy=function(){return px(e,EG()).constant(e.constant())},Pl.apply(e,arguments)}function dB(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function h2e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function f2e(e){return e<0?-e*e:e*e}function hR(e){var t=e(sa,sa),n=1;function o(){return n===1?e(sa,sa):n===.5?e(h2e,f2e):e(dB(n),dB(1/n))}return t.exponent=function(d){return arguments.length?(n=+d,o()):n},lh(t)}function fR(){var e=hR(LT());return e.copy=function(){return px(e,fR()).exponent(e.exponent())},Pl.apply(e,arguments),e}function p2e(){return fR.apply(null,arguments).exponent(.5)}function hB(e){return Math.sign(e)*e*e}function m2e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function PG(){var e=aR(),t=[0,1],n=!1,o;function d(f){var _=m2e(e(f));return isNaN(_)?o:n?Math.round(_):_}return d.invert=function(f){return e.invert(hB(f))},d.domain=function(f){return arguments.length?(e.domain(f),d):e.domain()},d.range=function(f){return arguments.length?(e.range((t=Array.from(f,Jw)).map(hB)),d):t.slice()},d.rangeRound=function(f){return d.range(f).round(!0)},d.round=function(f){return arguments.length?(n=!!f,d):n},d.clamp=function(f){return arguments.length?(e.clamp(f),d):e.clamp()},d.unknown=function(f){return arguments.length?(o=f,d):o},d.copy=function(){return PG(e.domain(),t).round(n).clamp(e.clamp()).unknown(o)},Pl.apply(d,arguments),lh(d)}function CG(){var e=[],t=[],n=[],o;function d(){var _=0,i=Math.max(1,t.length);for(n=new Array(i-1);++_<i;)n[_-1]=xTe(e,_/i);return f}function f(_){return _==null||isNaN(_=+_)?o:t[hx(n,_)]}return f.invertExtent=function(_){var i=t.indexOf(_);return i<0?[NaN,NaN]:[i>0?n[i-1]:e[0],i<n.length?n[i]:e[e.length-1]]},f.domain=function(_){if(!arguments.length)return e.slice();e=[];for(let i of _)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Yd),d()},f.range=function(_){return arguments.length?(t=Array.from(_),d()):t.slice()},f.unknown=function(_){return arguments.length?(o=_,f):o},f.quantiles=function(){return n.slice()},f.copy=function(){return CG().domain(e).range(t).unknown(o)},Pl.apply(f,arguments)}function IG(){var e=0,t=1,n=1,o=[.5],d=[0,1],f;function _(S){return S!=null&&S<=S?d[hx(o,S,0,n)]:f}function i(){var S=-1;for(o=new Array(n);++S<n;)o[S]=((S+1)*t-(S-n)*e)/(n+1);return _}return _.domain=function(S){return arguments.length?([e,t]=S,e=+e,t=+t,i()):[e,t]},_.range=function(S){return arguments.length?(n=(d=Array.from(S)).length-1,i()):d.slice()},_.invertExtent=function(S){var E=d.indexOf(S);return E<0?[NaN,NaN]:E<1?[e,o[0]]:E>=n?[o[n-1],t]:[o[E-1],o[E]]},_.unknown=function(S){return arguments.length&&(f=S),_},_.thresholds=function(){return o.slice()},_.copy=function(){return IG().domain([e,t]).range(d).unknown(f)},Pl.apply(lh(_),arguments)}function MG(){var e=[.5],t=[0,1],n,o=1;function d(f){return f!=null&&f<=f?t[hx(e,f,0,o)]:n}return d.domain=function(f){return arguments.length?(e=Array.from(f),o=Math.min(e.length,t.length-1),d):e.slice()},d.range=function(f){return arguments.length?(t=Array.from(f),o=Math.min(e.length,t.length-1),d):t.slice()},d.invertExtent=function(f){var _=t.indexOf(f);return[e[_-1],e[_]]},d.unknown=function(f){return arguments.length?(n=f,d):n},d.copy=function(){return MG().domain(e).range(t).unknown(n)},Pl.apply(d,arguments)}const pP=new Date,mP=new Date;function ms(e,t,n,o){function d(f){return e(f=arguments.length===0?new Date:new Date(+f)),f}return d.floor=f=>(e(f=new Date(+f)),f),d.ceil=f=>(e(f=new Date(f-1)),t(f,1),e(f),f),d.round=f=>{const _=d(f),i=d.ceil(f);return f-_<i-f?_:i},d.offset=(f,_)=>(t(f=new Date(+f),_==null?1:Math.floor(_)),f),d.range=(f,_,i)=>{const S=[];if(f=d.ceil(f),i=i==null?1:Math.floor(i),!(f<_)||!(i>0))return S;let E;do S.push(E=new Date(+f)),t(f,i),e(f);while(E<f&&f<_);return S},d.filter=f=>ms(_=>{if(_>=_)for(;e(_),!f(_);)_.setTime(_-1)},(_,i)=>{if(_>=_)if(i<0)for(;++i<=0;)for(;t(_,-1),!f(_););else for(;--i>=0;)for(;t(_,1),!f(_););}),n&&(d.count=(f,_)=>(pP.setTime(+f),mP.setTime(+_),e(pP),e(mP),Math.floor(n(pP,mP))),d.every=f=>(f=Math.floor(f),!isFinite(f)||!(f>0)?null:f>1?d.filter(o?_=>o(_)%f===0:_=>d.count(0,_)%f===0):d)),d}const tS=ms(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);tS.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ms(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):tS);tS.range;const Lu=1e3,wl=Lu*60,Nu=wl*60,Ku=Nu*24,pR=Ku*7,fB=Ku*30,gP=Ku*365,Af=ms(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Lu)},(e,t)=>(t-e)/Lu,e=>e.getUTCSeconds());Af.range;const mR=ms(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Lu)},(e,t)=>{e.setTime(+e+t*wl)},(e,t)=>(t-e)/wl,e=>e.getMinutes());mR.range;const gR=ms(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*wl)},(e,t)=>(t-e)/wl,e=>e.getUTCMinutes());gR.range;const yR=ms(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Lu-e.getMinutes()*wl)},(e,t)=>{e.setTime(+e+t*Nu)},(e,t)=>(t-e)/Nu,e=>e.getHours());yR.range;const _R=ms(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Nu)},(e,t)=>(t-e)/Nu,e=>e.getUTCHours());_R.range;const mx=ms(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*wl)/Ku,e=>e.getDate()-1);mx.range;const NT=ms(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ku,e=>e.getUTCDate()-1);NT.range;const OG=ms(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Ku,e=>Math.floor(e/Ku));OG.range;function tp(e){return ms(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*wl)/pR)}const zT=tp(0),rS=tp(1),g2e=tp(2),y2e=tp(3),jg=tp(4),_2e=tp(5),v2e=tp(6);zT.range;rS.range;g2e.range;y2e.range;jg.range;_2e.range;v2e.range;function rp(e){return ms(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/pR)}const FT=rp(0),nS=rp(1),x2e=rp(2),b2e=rp(3),Dg=rp(4),w2e=rp(5),S2e=rp(6);FT.range;nS.range;x2e.range;b2e.range;Dg.range;w2e.range;S2e.range;const vR=ms(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());vR.range;const xR=ms(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());xR.range;const Xu=ms(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Xu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ms(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Xu.range;const Yu=ms(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Yu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ms(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Yu.range;function RG(e,t,n,o,d,f){const _=[[Af,1,Lu],[Af,5,5*Lu],[Af,15,15*Lu],[Af,30,30*Lu],[f,1,wl],[f,5,5*wl],[f,15,15*wl],[f,30,30*wl],[d,1,Nu],[d,3,3*Nu],[d,6,6*Nu],[d,12,12*Nu],[o,1,Ku],[o,2,2*Ku],[n,1,pR],[t,1,fB],[t,3,3*fB],[e,1,gP]];function i(E,I,M){const j=I<E;j&&([E,I]=[I,E]);const N=M&&typeof M.range=="function"?M:S(E,I,M),G=N?N.range(E,+I+1):[];return j?G.reverse():G}function S(E,I,M){const j=Math.abs(I-E)/M,N=rR(([,,V])=>V).right(_,j);if(N===_.length)return e.every(nI(E/gP,I/gP,M));if(N===0)return tS.every(Math.max(nI(E,I,M),1));const[G,z]=_[j/_[N-1][2]<_[N][2]/j?N-1:N];return G.every(z)}return[i,S]}const[T2e,A2e]=RG(Yu,xR,FT,OG,_R,gR),[E2e,P2e]=RG(Xu,vR,zT,mx,yR,mR);function yP(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _P(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ov(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function C2e(e){var t=e.dateTime,n=e.date,o=e.time,d=e.periods,f=e.days,_=e.shortDays,i=e.months,S=e.shortMonths,E=Rv(d),I=kv(d),M=Rv(f),j=kv(f),N=Rv(_),G=kv(_),z=Rv(i),V=kv(i),K=Rv(S),Q=kv(S),X={a:Ke,A:ut,b:rt,B:Xt,c:null,d:vB,e:vB,f:Y2e,g:aAe,G:cAe,H:Z2e,I:K2e,j:X2e,L:kG,m:J2e,M:Q2e,p:cr,q:Bt,Q:wB,s:SB,S:eAe,u:tAe,U:rAe,V:nAe,w:iAe,W:oAe,x:null,X:null,y:sAe,Y:lAe,Z:uAe,"%":bB},ie={a:$t,A:br,b:nn,B:qn,c:null,d:xB,e:xB,f:pAe,g:TAe,G:EAe,H:dAe,I:hAe,j:fAe,L:DG,m:mAe,M:gAe,p:lr,q:an,Q:wB,s:SB,S:yAe,u:_Ae,U:vAe,V:xAe,w:bAe,W:wAe,x:null,X:null,y:SAe,Y:AAe,Z:PAe,"%":bB},J={a:je,A:Oe,b:Be,B:qe,c:Xe,d:yB,e:yB,f:G2e,g:gB,G:mB,H:_B,I:_B,j:B2e,L:U2e,m:F2e,M:$2e,p:ze,q:z2e,Q:W2e,s:q2e,S:V2e,u:k2e,U:j2e,V:D2e,w:R2e,W:L2e,x:it,X:Ge,y:gB,Y:mB,Z:N2e,"%":H2e};X.x=se(n,X),X.X=se(o,X),X.c=se(t,X),ie.x=se(n,ie),ie.X=se(o,ie),ie.c=se(t,ie);function se(Lt,nr){return function(pr){var Nt=[],zr=-1,un=0,hi=Lt.length,Hn,zn,Qn;for(pr instanceof Date||(pr=new Date(+pr));++zr<hi;)Lt.charCodeAt(zr)===37&&(Nt.push(Lt.slice(un,zr)),(zn=pB[Hn=Lt.charAt(++zr)])!=null?Hn=Lt.charAt(++zr):zn=Hn==="e"?" ":"0",(Qn=nr[Hn])&&(Hn=Qn(pr,zn)),Nt.push(Hn),un=zr+1);return Nt.push(Lt.slice(un,zr)),Nt.join("")}}function he(Lt,nr){return function(pr){var Nt=Ov(1900,void 0,1),zr=we(Nt,Lt,pr+="",0),un,hi;if(zr!=pr.length)return null;if("Q"in Nt)return new Date(Nt.Q);if("s"in Nt)return new Date(Nt.s*1e3+("L"in Nt?Nt.L:0));if(nr&&!("Z"in Nt)&&(Nt.Z=0),"p"in Nt&&(Nt.H=Nt.H%12+Nt.p*12),Nt.m===void 0&&(Nt.m="q"in Nt?Nt.q:0),"V"in Nt){if(Nt.V<1||Nt.V>53)return null;"w"in Nt||(Nt.w=1),"Z"in Nt?(un=_P(Ov(Nt.y,0,1)),hi=un.getUTCDay(),un=hi>4||hi===0?nS.ceil(un):nS(un),un=NT.offset(un,(Nt.V-1)*7),Nt.y=un.getUTCFullYear(),Nt.m=un.getUTCMonth(),Nt.d=un.getUTCDate()+(Nt.w+6)%7):(un=yP(Ov(Nt.y,0,1)),hi=un.getDay(),un=hi>4||hi===0?rS.ceil(un):rS(un),un=mx.offset(un,(Nt.V-1)*7),Nt.y=un.getFullYear(),Nt.m=un.getMonth(),Nt.d=un.getDate()+(Nt.w+6)%7)}else("W"in Nt||"U"in Nt)&&("w"in Nt||(Nt.w="u"in Nt?Nt.u%7:"W"in Nt?1:0),hi="Z"in Nt?_P(Ov(Nt.y,0,1)).getUTCDay():yP(Ov(Nt.y,0,1)).getDay(),Nt.m=0,Nt.d="W"in Nt?(Nt.w+6)%7+Nt.W*7-(hi+5)%7:Nt.w+Nt.U*7-(hi+6)%7);return"Z"in Nt?(Nt.H+=Nt.Z/100|0,Nt.M+=Nt.Z%100,_P(Nt)):yP(Nt)}}function we(Lt,nr,pr,Nt){for(var zr=0,un=nr.length,hi=pr.length,Hn,zn;zr<un;){if(Nt>=hi)return-1;if(Hn=nr.charCodeAt(zr++),Hn===37){if(Hn=nr.charAt(zr++),zn=J[Hn in pB?nr.charAt(zr++):Hn],!zn||(Nt=zn(Lt,pr,Nt))<0)return-1}else if(Hn!=pr.charCodeAt(Nt++))return-1}return Nt}function ze(Lt,nr,pr){var Nt=E.exec(nr.slice(pr));return Nt?(Lt.p=I.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function je(Lt,nr,pr){var Nt=N.exec(nr.slice(pr));return Nt?(Lt.w=G.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Oe(Lt,nr,pr){var Nt=M.exec(nr.slice(pr));return Nt?(Lt.w=j.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Be(Lt,nr,pr){var Nt=K.exec(nr.slice(pr));return Nt?(Lt.m=Q.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function qe(Lt,nr,pr){var Nt=z.exec(nr.slice(pr));return Nt?(Lt.m=V.get(Nt[0].toLowerCase()),pr+Nt[0].length):-1}function Xe(Lt,nr,pr){return we(Lt,t,nr,pr)}function it(Lt,nr,pr){return we(Lt,n,nr,pr)}function Ge(Lt,nr,pr){return we(Lt,o,nr,pr)}function Ke(Lt){return _[Lt.getDay()]}function ut(Lt){return f[Lt.getDay()]}function rt(Lt){return S[Lt.getMonth()]}function Xt(Lt){return i[Lt.getMonth()]}function cr(Lt){return d[+(Lt.getHours()>=12)]}function Bt(Lt){return 1+~~(Lt.getMonth()/3)}function $t(Lt){return _[Lt.getUTCDay()]}function br(Lt){return f[Lt.getUTCDay()]}function nn(Lt){return S[Lt.getUTCMonth()]}function qn(Lt){return i[Lt.getUTCMonth()]}function lr(Lt){return d[+(Lt.getUTCHours()>=12)]}function an(Lt){return 1+~~(Lt.getUTCMonth()/3)}return{format:function(Lt){var nr=se(Lt+="",X);return nr.toString=function(){return Lt},nr},parse:function(Lt){var nr=he(Lt+="",!1);return nr.toString=function(){return Lt},nr},utcFormat:function(Lt){var nr=se(Lt+="",ie);return nr.toString=function(){return Lt},nr},utcParse:function(Lt){var nr=he(Lt+="",!0);return nr.toString=function(){return Lt},nr}}}var pB={"-":"",_:" ",0:"0"},Ps=/^\s*\d+/,I2e=/^%/,M2e=/[\\^$*+?|[\]().{}]/g;function Li(e,t,n){var o=e<0?"-":"",d=(o?-e:e)+"",f=d.length;return o+(f<n?new Array(n-f+1).join(t)+d:d)}function O2e(e){return e.replace(M2e,"\\$&")}function Rv(e){return new RegExp("^(?:"+e.map(O2e).join("|")+")","i")}function kv(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function R2e(e,t,n){var o=Ps.exec(t.slice(n,n+1));return o?(e.w=+o[0],n+o[0].length):-1}function k2e(e,t,n){var o=Ps.exec(t.slice(n,n+1));return o?(e.u=+o[0],n+o[0].length):-1}function j2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.U=+o[0],n+o[0].length):-1}function D2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.V=+o[0],n+o[0].length):-1}function L2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.W=+o[0],n+o[0].length):-1}function mB(e,t,n){var o=Ps.exec(t.slice(n,n+4));return o?(e.y=+o[0],n+o[0].length):-1}function gB(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.y=+o[0]+(+o[0]>68?1900:2e3),n+o[0].length):-1}function N2e(e,t,n){var o=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return o?(e.Z=o[1]?0:-(o[2]+(o[3]||"00")),n+o[0].length):-1}function z2e(e,t,n){var o=Ps.exec(t.slice(n,n+1));return o?(e.q=o[0]*3-3,n+o[0].length):-1}function F2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.m=o[0]-1,n+o[0].length):-1}function yB(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.d=+o[0],n+o[0].length):-1}function B2e(e,t,n){var o=Ps.exec(t.slice(n,n+3));return o?(e.m=0,e.d=+o[0],n+o[0].length):-1}function _B(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.H=+o[0],n+o[0].length):-1}function $2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.M=+o[0],n+o[0].length):-1}function V2e(e,t,n){var o=Ps.exec(t.slice(n,n+2));return o?(e.S=+o[0],n+o[0].length):-1}function U2e(e,t,n){var o=Ps.exec(t.slice(n,n+3));return o?(e.L=+o[0],n+o[0].length):-1}function G2e(e,t,n){var o=Ps.exec(t.slice(n,n+6));return o?(e.L=Math.floor(o[0]/1e3),n+o[0].length):-1}function H2e(e,t,n){var o=I2e.exec(t.slice(n,n+1));return o?n+o[0].length:-1}function W2e(e,t,n){var o=Ps.exec(t.slice(n));return o?(e.Q=+o[0],n+o[0].length):-1}function q2e(e,t,n){var o=Ps.exec(t.slice(n));return o?(e.s=+o[0],n+o[0].length):-1}function vB(e,t){return Li(e.getDate(),t,2)}function Z2e(e,t){return Li(e.getHours(),t,2)}function K2e(e,t){return Li(e.getHours()%12||12,t,2)}function X2e(e,t){return Li(1+mx.count(Xu(e),e),t,3)}function kG(e,t){return Li(e.getMilliseconds(),t,3)}function Y2e(e,t){return kG(e,t)+"000"}function J2e(e,t){return Li(e.getMonth()+1,t,2)}function Q2e(e,t){return Li(e.getMinutes(),t,2)}function eAe(e,t){return Li(e.getSeconds(),t,2)}function tAe(e){var t=e.getDay();return t===0?7:t}function rAe(e,t){return Li(zT.count(Xu(e)-1,e),t,2)}function jG(e){var t=e.getDay();return t>=4||t===0?jg(e):jg.ceil(e)}function nAe(e,t){return e=jG(e),Li(jg.count(Xu(e),e)+(Xu(e).getDay()===4),t,2)}function iAe(e){return e.getDay()}function oAe(e,t){return Li(rS.count(Xu(e)-1,e),t,2)}function sAe(e,t){return Li(e.getFullYear()%100,t,2)}function aAe(e,t){return e=jG(e),Li(e.getFullYear()%100,t,2)}function lAe(e,t){return Li(e.getFullYear()%1e4,t,4)}function cAe(e,t){var n=e.getDay();return e=n>=4||n===0?jg(e):jg.ceil(e),Li(e.getFullYear()%1e4,t,4)}function uAe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Li(t/60|0,"0",2)+Li(t%60,"0",2)}function xB(e,t){return Li(e.getUTCDate(),t,2)}function dAe(e,t){return Li(e.getUTCHours(),t,2)}function hAe(e,t){return Li(e.getUTCHours()%12||12,t,2)}function fAe(e,t){return Li(1+NT.count(Yu(e),e),t,3)}function DG(e,t){return Li(e.getUTCMilliseconds(),t,3)}function pAe(e,t){return DG(e,t)+"000"}function mAe(e,t){return Li(e.getUTCMonth()+1,t,2)}function gAe(e,t){return Li(e.getUTCMinutes(),t,2)}function yAe(e,t){return Li(e.getUTCSeconds(),t,2)}function _Ae(e){var t=e.getUTCDay();return t===0?7:t}function vAe(e,t){return Li(FT.count(Yu(e)-1,e),t,2)}function LG(e){var t=e.getUTCDay();return t>=4||t===0?Dg(e):Dg.ceil(e)}function xAe(e,t){return e=LG(e),Li(Dg.count(Yu(e),e)+(Yu(e).getUTCDay()===4),t,2)}function bAe(e){return e.getUTCDay()}function wAe(e,t){return Li(nS.count(Yu(e)-1,e),t,2)}function SAe(e,t){return Li(e.getUTCFullYear()%100,t,2)}function TAe(e,t){return e=LG(e),Li(e.getUTCFullYear()%100,t,2)}function AAe(e,t){return Li(e.getUTCFullYear()%1e4,t,4)}function EAe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Dg(e):Dg.ceil(e),Li(e.getUTCFullYear()%1e4,t,4)}function PAe(){return"+0000"}function bB(){return"%"}function wB(e){return+e}function SB(e){return Math.floor(+e/1e3)}var Ym,NG,zG;CAe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function CAe(e){return Ym=C2e(e),NG=Ym.format,Ym.parse,zG=Ym.utcFormat,Ym.utcParse,Ym}function IAe(e){return new Date(e)}function MAe(e){return e instanceof Date?+e:+new Date(+e)}function bR(e,t,n,o,d,f,_,i,S,E){var I=aR(),M=I.invert,j=I.domain,N=E(".%L"),G=E(":%S"),z=E("%I:%M"),V=E("%I %p"),K=E("%a %d"),Q=E("%b %d"),X=E("%B"),ie=E("%Y");function J(se){return(S(se)<se?N:i(se)<se?G:_(se)<se?z:f(se)<se?V:o(se)<se?d(se)<se?K:Q:n(se)<se?X:ie)(se)}return I.invert=function(se){return new Date(M(se))},I.domain=function(se){return arguments.length?j(Array.from(se,MAe)):j().map(IAe)},I.ticks=function(se){var he=j();return e(he[0],he[he.length-1],se??10)},I.tickFormat=function(se,he){return he==null?J:E(he)},I.nice=function(se){var he=j();return(!se||typeof se.range!="function")&&(se=t(he[0],he[he.length-1],se??10)),se?j(TG(he,se)):I},I.copy=function(){return px(I,bR(e,t,n,o,d,f,_,i,S,E))},I}function OAe(){return Pl.apply(bR(E2e,P2e,Xu,vR,zT,mx,yR,mR,Af,NG).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function RAe(){return Pl.apply(bR(T2e,A2e,Yu,xR,FT,NT,_R,gR,Af,zG).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function BT(){var e=0,t=1,n,o,d,f,_=sa,i=!1,S;function E(M){return M==null||isNaN(M=+M)?S:_(d===0?.5:(M=(f(M)-n)*d,i?Math.max(0,Math.min(1,M)):M))}E.domain=function(M){return arguments.length?([e,t]=M,n=f(e=+e),o=f(t=+t),d=n===o?0:1/(o-n),E):[e,t]},E.clamp=function(M){return arguments.length?(i=!!M,E):i},E.interpolator=function(M){return arguments.length?(_=M,E):_};function I(M){return function(j){var N,G;return arguments.length?([N,G]=j,_=M(N,G),E):[_(0),_(1)]}}return E.range=I(xy),E.rangeRound=I(sR),E.unknown=function(M){return arguments.length?(S=M,E):S},function(M){return f=M,n=M(e),o=M(t),d=n===o?0:1/(o-n),E}}function ch(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function FG(){var e=lh(BT()(sa));return e.copy=function(){return ch(e,FG())},rd.apply(e,arguments)}function BG(){var e=uR(BT()).domain([1,10]);return e.copy=function(){return ch(e,BG()).base(e.base())},rd.apply(e,arguments)}function $G(){var e=dR(BT());return e.copy=function(){return ch(e,$G()).constant(e.constant())},rd.apply(e,arguments)}function wR(){var e=hR(BT());return e.copy=function(){return ch(e,wR()).exponent(e.exponent())},rd.apply(e,arguments)}function kAe(){return wR.apply(null,arguments).exponent(.5)}function VG(){var e=[],t=sa;function n(o){if(o!=null&&!isNaN(o=+o))return t((hx(e,o,1)-1)/(e.length-1))}return n.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let d of o)d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(Yd),n},n.interpolator=function(o){return arguments.length?(t=o,n):t},n.range=function(){return e.map((o,d)=>t(d/(e.length-1)))},n.quantiles=function(o){return Array.from({length:o+1},(d,f)=>vTe(e,f/o))},n.copy=function(){return VG(t).domain(e)},rd.apply(n,arguments)}function $T(){var e=0,t=.5,n=1,o=1,d,f,_,i,S,E=sa,I,M=!1,j;function N(z){return isNaN(z=+z)?j:(z=.5+((z=+I(z))-f)*(o*z<o*f?i:S),E(M?Math.max(0,Math.min(1,z)):z))}N.domain=function(z){return arguments.length?([e,t,n]=z,d=I(e=+e),f=I(t=+t),_=I(n=+n),i=d===f?0:.5/(f-d),S=f===_?0:.5/(_-f),o=f<d?-1:1,N):[e,t,n]},N.clamp=function(z){return arguments.length?(M=!!z,N):M},N.interpolator=function(z){return arguments.length?(E=z,N):E};function G(z){return function(V){var K,Q,X;return arguments.length?([K,Q,X]=V,E=HTe(z,[K,Q,X]),N):[E(0),E(.5),E(1)]}}return N.range=G(xy),N.rangeRound=G(sR),N.unknown=function(z){return arguments.length?(j=z,N):j},function(z){return I=z,d=z(e),f=z(t),_=z(n),i=d===f?0:.5/(f-d),S=f===_?0:.5/(_-f),o=f<d?-1:1,N}}function UG(){var e=lh($T()(sa));return e.copy=function(){return ch(e,UG())},rd.apply(e,arguments)}function GG(){var e=uR($T()).domain([.1,1,10]);return e.copy=function(){return ch(e,GG()).base(e.base())},rd.apply(e,arguments)}function HG(){var e=dR($T());return e.copy=function(){return ch(e,HG()).constant(e.constant())},rd.apply(e,arguments)}function SR(){var e=hR($T());return e.copy=function(){return ch(e,SR()).exponent(e.exponent())},rd.apply(e,arguments)}function jAe(){return SR.apply(null,arguments).exponent(.5)}const TB=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:x0,scaleDiverging:UG,scaleDivergingLog:GG,scaleDivergingPow:SR,scaleDivergingSqrt:jAe,scaleDivergingSymlog:HG,scaleIdentity:SG,scaleImplicit:iI,scaleLinear:eS,scaleLog:AG,scaleOrdinal:nR,scalePoint:Xv,scalePow:fR,scaleQuantile:CG,scaleQuantize:IG,scaleRadial:PG,scaleSequential:FG,scaleSequentialLog:BG,scaleSequentialPow:wR,scaleSequentialQuantile:VG,scaleSequentialSqrt:kAe,scaleSequentialSymlog:$G,scaleSqrt:p2e,scaleSymlog:EG,scaleThreshold:MG,scaleTime:OAe,scaleUtc:RAe,tickFormat:wG},Symbol.toStringTag,{value:"Module"}));var DAe=dy;function LAe(e,t,n){for(var o=-1,d=e.length;++o<d;){var f=e[o],_=t(f);if(_!=null&&(i===void 0?_===_&&!DAe(_):n(_,i)))var i=_,S=f}return S}var VT=LAe;function NAe(e,t){return e>t}var WG=NAe,zAe=VT,FAe=WG,BAe=vy;function $Ae(e){return e&&e.length?zAe(e,BAe,FAe):void 0}var VAe=$Ae;const UT=Ni(VAe);function UAe(e,t){return e<t}var qG=UAe,GAe=VT,HAe=qG,WAe=vy;function qAe(e){return e&&e.length?GAe(e,WAe,HAe):void 0}var ZAe=qAe;const GT=Ni(ZAe);var KAe=LO,XAe=su,YAe=tG,JAe=Ea;function QAe(e,t){var n=JAe(e)?KAe:YAe;return n(e,XAe(t))}var eEe=QAe,tEe=Q8,rEe=eEe;function nEe(e,t){return tEe(rEe(e,t),1)}var iEe=nEe;const oEe=Ni(iEe);var sEe=YO;function aEe(e,t){return sEe(e,t)}var lEe=aEe;const gx=Ni(lEe);var by=1e9,cEe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},AR,Po=!0,Al="[DecimalError] ",Of=Al+"Invalid argument: ",TR=Al+"Exponent out of range: ",wy=Math.floor,yf=Math.pow,uEe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,qa,As=1e7,yo=7,ZG=9007199254740991,iS=wy(ZG/yo),Wr={};Wr.absoluteValue=Wr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Wr.comparedTo=Wr.cmp=function(e){var t,n,o,d,f=this;if(e=new f.constructor(e),f.s!==e.s)return f.s||-e.s;if(f.e!==e.e)return f.e>e.e^f.s<0?1:-1;for(o=f.d.length,d=e.d.length,t=0,n=o<d?o:d;t<n;++t)if(f.d[t]!==e.d[t])return f.d[t]>e.d[t]^f.s<0?1:-1;return o===d?0:o>d^f.s<0?1:-1};Wr.decimalPlaces=Wr.dp=function(){var e=this,t=e.d.length-1,n=(t-e.e)*yo;if(t=e.d[t],t)for(;t%10==0;t/=10)n--;return n<0?0:n};Wr.dividedBy=Wr.div=function(e){return Uu(this,new this.constructor(e))};Wr.dividedToIntegerBy=Wr.idiv=function(e){var t=this,n=t.constructor;return Qi(Uu(t,new n(e),0,1),n.precision)};Wr.equals=Wr.eq=function(e){return!this.cmp(e)};Wr.exponent=function(){return ns(this)};Wr.greaterThan=Wr.gt=function(e){return this.cmp(e)>0};Wr.greaterThanOrEqualTo=Wr.gte=function(e){return this.cmp(e)>=0};Wr.isInteger=Wr.isint=function(){return this.e>this.d.length-2};Wr.isNegative=Wr.isneg=function(){return this.s<0};Wr.isPositive=Wr.ispos=function(){return this.s>0};Wr.isZero=function(){return this.s===0};Wr.lessThan=Wr.lt=function(e){return this.cmp(e)<0};Wr.lessThanOrEqualTo=Wr.lte=function(e){return this.cmp(e)<1};Wr.logarithm=Wr.log=function(e){var t,n=this,o=n.constructor,d=o.precision,f=d+5;if(e===void 0)e=new o(10);else if(e=new o(e),e.s<1||e.eq(qa))throw Error(Al+"NaN");if(n.s<1)throw Error(Al+(n.s?"NaN":"-Infinity"));return n.eq(qa)?new o(0):(Po=!1,t=Uu(A0(n,f),A0(e,f),f),Po=!0,Qi(t,d))};Wr.minus=Wr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?YG(t,e):KG(t,(e.s=-e.s,e))};Wr.modulo=Wr.mod=function(e){var t,n=this,o=n.constructor,d=o.precision;if(e=new o(e),!e.s)throw Error(Al+"NaN");return n.s?(Po=!1,t=Uu(n,e,0,1).times(e),Po=!0,n.minus(t)):Qi(new o(n),d)};Wr.naturalExponential=Wr.exp=function(){return XG(this)};Wr.naturalLogarithm=Wr.ln=function(){return A0(this)};Wr.negated=Wr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Wr.plus=Wr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?KG(t,e):YG(t,(e.s=-e.s,e))};Wr.precision=Wr.sd=function(e){var t,n,o,d=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Of+e);if(t=ns(d)+1,o=d.d.length-1,n=o*yo+1,o=d.d[o],o){for(;o%10==0;o/=10)n--;for(o=d.d[0];o>=10;o/=10)n++}return e&&t>n?t:n};Wr.squareRoot=Wr.sqrt=function(){var e,t,n,o,d,f,_,i=this,S=i.constructor;if(i.s<1){if(!i.s)return new S(0);throw Error(Al+"NaN")}for(e=ns(i),Po=!1,d=Math.sqrt(+i),d==0||d==1/0?(t=Uc(i.d),(t.length+e)%2==0&&(t+="0"),d=Math.sqrt(t),e=wy((e+1)/2)-(e<0||e%2),d==1/0?t="5e"+e:(t=d.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),o=new S(t)):o=new S(d.toString()),n=S.precision,d=_=n+3;;)if(f=o,o=f.plus(Uu(i,f,_+2)).times(.5),Uc(f.d).slice(0,_)===(t=Uc(o.d)).slice(0,_)){if(t=t.slice(_-3,_+1),d==_&&t=="4999"){if(Qi(f,n+1,0),f.times(f).eq(i)){o=f;break}}else if(t!="9999")break;_+=4}return Po=!0,Qi(o,n)};Wr.times=Wr.mul=function(e){var t,n,o,d,f,_,i,S,E,I=this,M=I.constructor,j=I.d,N=(e=new M(e)).d;if(!I.s||!e.s)return new M(0);for(e.s*=I.s,n=I.e+e.e,S=j.length,E=N.length,S<E&&(f=j,j=N,N=f,_=S,S=E,E=_),f=[],_=S+E,o=_;o--;)f.push(0);for(o=E;--o>=0;){for(t=0,d=S+o;d>o;)i=f[d]+N[o]*j[d-o-1]+t,f[d--]=i%As|0,t=i/As|0;f[d]=(f[d]+t)%As|0}for(;!f[--_];)f.pop();return t?++n:f.shift(),e.d=f,e.e=n,Po?Qi(e,M.precision):e};Wr.toDecimalPlaces=Wr.todp=function(e,t){var n=this,o=n.constructor;return n=new o(n),e===void 0?n:(ru(e,0,by),t===void 0?t=o.rounding:ru(t,0,8),Qi(n,e+ns(n)+1,t))};Wr.toExponential=function(e,t){var n,o=this,d=o.constructor;return e===void 0?n=Gf(o,!0):(ru(e,0,by),t===void 0?t=d.rounding:ru(t,0,8),o=Qi(new d(o),e+1,t),n=Gf(o,!0,e+1)),n};Wr.toFixed=function(e,t){var n,o,d=this,f=d.constructor;return e===void 0?Gf(d):(ru(e,0,by),t===void 0?t=f.rounding:ru(t,0,8),o=Qi(new f(d),e+ns(d)+1,t),n=Gf(o.abs(),!1,e+ns(o)+1),d.isneg()&&!d.isZero()?"-"+n:n)};Wr.toInteger=Wr.toint=function(){var e=this,t=e.constructor;return Qi(new t(e),ns(e)+1,t.rounding)};Wr.toNumber=function(){return+this};Wr.toPower=Wr.pow=function(e){var t,n,o,d,f,_,i=this,S=i.constructor,E=12,I=+(e=new S(e));if(!e.s)return new S(qa);if(i=new S(i),!i.s){if(e.s<1)throw Error(Al+"Infinity");return i}if(i.eq(qa))return i;if(o=S.precision,e.eq(qa))return Qi(i,o);if(t=e.e,n=e.d.length-1,_=t>=n,f=i.s,_){if((n=I<0?-I:I)<=ZG){for(d=new S(qa),t=Math.ceil(o/yo+4),Po=!1;n%2&&(d=d.times(i),EB(d.d,t)),n=wy(n/2),n!==0;)i=i.times(i),EB(i.d,t);return Po=!0,e.s<0?new S(qa).div(d):Qi(d,o)}}else if(f<0)throw Error(Al+"NaN");return f=f<0&&e.d[Math.max(t,n)]&1?-1:1,i.s=1,Po=!1,d=e.times(A0(i,o+E)),Po=!0,d=XG(d),d.s=f,d};Wr.toPrecision=function(e,t){var n,o,d=this,f=d.constructor;return e===void 0?(n=ns(d),o=Gf(d,n<=f.toExpNeg||n>=f.toExpPos)):(ru(e,1,by),t===void 0?t=f.rounding:ru(t,0,8),d=Qi(new f(d),e,t),n=ns(d),o=Gf(d,e<=n||n<=f.toExpNeg,e)),o};Wr.toSignificantDigits=Wr.tosd=function(e,t){var n=this,o=n.constructor;return e===void 0?(e=o.precision,t=o.rounding):(ru(e,1,by),t===void 0?t=o.rounding:ru(t,0,8)),Qi(new o(n),e,t)};Wr.toString=Wr.valueOf=Wr.val=Wr.toJSON=Wr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=ns(e),n=e.constructor;return Gf(e,t<=n.toExpNeg||t>=n.toExpPos)};function KG(e,t){var n,o,d,f,_,i,S,E,I=e.constructor,M=I.precision;if(!e.s||!t.s)return t.s||(t=new I(e)),Po?Qi(t,M):t;if(S=e.d,E=t.d,_=e.e,d=t.e,S=S.slice(),f=_-d,f){for(f<0?(o=S,f=-f,i=E.length):(o=E,d=_,i=S.length),_=Math.ceil(M/yo),i=_>i?_+1:i+1,f>i&&(f=i,o.length=1),o.reverse();f--;)o.push(0);o.reverse()}for(i=S.length,f=E.length,i-f<0&&(f=i,o=E,E=S,S=o),n=0;f;)n=(S[--f]=S[f]+E[f]+n)/As|0,S[f]%=As;for(n&&(S.unshift(n),++d),i=S.length;S[--i]==0;)S.pop();return t.d=S,t.e=d,Po?Qi(t,M):t}function ru(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Of+e)}function Uc(e){var t,n,o,d=e.length-1,f="",_=e[0];if(d>0){for(f+=_,t=1;t<d;t++)o=e[t]+"",n=yo-o.length,n&&(f+=Ud(n)),f+=o;_=e[t],o=_+"",n=yo-o.length,n&&(f+=Ud(n))}else if(_===0)return"0";for(;_%10===0;)_/=10;return f+_}var Uu=function(){function e(o,d){var f,_=0,i=o.length;for(o=o.slice();i--;)f=o[i]*d+_,o[i]=f%As|0,_=f/As|0;return _&&o.unshift(_),o}function t(o,d,f,_){var i,S;if(f!=_)S=f>_?1:-1;else for(i=S=0;i<f;i++)if(o[i]!=d[i]){S=o[i]>d[i]?1:-1;break}return S}function n(o,d,f){for(var _=0;f--;)o[f]-=_,_=o[f]<d[f]?1:0,o[f]=_*As+o[f]-d[f];for(;!o[0]&&o.length>1;)o.shift()}return function(o,d,f,_){var i,S,E,I,M,j,N,G,z,V,K,Q,X,ie,J,se,he,we,ze=o.constructor,je=o.s==d.s?1:-1,Oe=o.d,Be=d.d;if(!o.s)return new ze(o);if(!d.s)throw Error(Al+"Division by zero");for(S=o.e-d.e,he=Be.length,J=Oe.length,N=new ze(je),G=N.d=[],E=0;Be[E]==(Oe[E]||0);)++E;if(Be[E]>(Oe[E]||0)&&--S,f==null?Q=f=ze.precision:_?Q=f+(ns(o)-ns(d))+1:Q=f,Q<0)return new ze(0);if(Q=Q/yo+2|0,E=0,he==1)for(I=0,Be=Be[0],Q++;(E<J||I)&&Q--;E++)X=I*As+(Oe[E]||0),G[E]=X/Be|0,I=X%Be|0;else{for(I=As/(Be[0]+1)|0,I>1&&(Be=e(Be,I),Oe=e(Oe,I),he=Be.length,J=Oe.length),ie=he,z=Oe.slice(0,he),V=z.length;V<he;)z[V++]=0;we=Be.slice(),we.unshift(0),se=Be[0],Be[1]>=As/2&&++se;do I=0,i=t(Be,z,he,V),i<0?(K=z[0],he!=V&&(K=K*As+(z[1]||0)),I=K/se|0,I>1?(I>=As&&(I=As-1),M=e(Be,I),j=M.length,V=z.length,i=t(M,z,j,V),i==1&&(I--,n(M,he<j?we:Be,j))):(I==0&&(i=I=1),M=Be.slice()),j=M.length,j<V&&M.unshift(0),n(z,M,V),i==-1&&(V=z.length,i=t(Be,z,he,V),i<1&&(I++,n(z,he<V?we:Be,V))),V=z.length):i===0&&(I++,z=[0]),G[E++]=I,i&&z[0]?z[V++]=Oe[ie]||0:(z=[Oe[ie]],V=1);while((ie++<J||z[0]!==void 0)&&Q--)}return G[0]||G.shift(),N.e=S,Qi(N,_?f+ns(N)+1:f)}}();function XG(e,t){var n,o,d,f,_,i,S=0,E=0,I=e.constructor,M=I.precision;if(ns(e)>16)throw Error(TR+ns(e));if(!e.s)return new I(qa);for(t==null?(Po=!1,i=M):i=t,_=new I(.03125);e.abs().gte(.1);)e=e.times(_),E+=5;for(o=Math.log(yf(2,E))/Math.LN10*2+5|0,i+=o,n=d=f=new I(qa),I.precision=i;;){if(d=Qi(d.times(e),i),n=n.times(++S),_=f.plus(Uu(d,n,i)),Uc(_.d).slice(0,i)===Uc(f.d).slice(0,i)){for(;E--;)f=Qi(f.times(f),i);return I.precision=M,t==null?(Po=!0,Qi(f,M)):f}f=_}}function ns(e){for(var t=e.e*yo,n=e.d[0];n>=10;n/=10)t++;return t}function vP(e,t,n){if(t>e.LN10.sd())throw Po=!0,n&&(e.precision=n),Error(Al+"LN10 precision limit exceeded");return Qi(new e(e.LN10),t)}function Ud(e){for(var t="";e--;)t+="0";return t}function A0(e,t){var n,o,d,f,_,i,S,E,I,M=1,j=10,N=e,G=N.d,z=N.constructor,V=z.precision;if(N.s<1)throw Error(Al+(N.s?"NaN":"-Infinity"));if(N.eq(qa))return new z(0);if(t==null?(Po=!1,E=V):E=t,N.eq(10))return t==null&&(Po=!0),vP(z,E);if(E+=j,z.precision=E,n=Uc(G),o=n.charAt(0),f=ns(N),Math.abs(f)<15e14){for(;o<7&&o!=1||o==1&&n.charAt(1)>3;)N=N.times(e),n=Uc(N.d),o=n.charAt(0),M++;f=ns(N),o>1?(N=new z("0."+n),f++):N=new z(o+"."+n.slice(1))}else return S=vP(z,E+2,V).times(f+""),N=A0(new z(o+"."+n.slice(1)),E-j).plus(S),z.precision=V,t==null?(Po=!0,Qi(N,V)):N;for(i=_=N=Uu(N.minus(qa),N.plus(qa),E),I=Qi(N.times(N),E),d=3;;){if(_=Qi(_.times(I),E),S=i.plus(Uu(_,new z(d),E)),Uc(S.d).slice(0,E)===Uc(i.d).slice(0,E))return i=i.times(2),f!==0&&(i=i.plus(vP(z,E+2,V).times(f+""))),i=Uu(i,new z(M),E),z.precision=V,t==null?(Po=!0,Qi(i,V)):i;i=S,d+=2}}function AB(e,t){var n,o,d;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(o=t.search(/e/i))>0?(n<0&&(n=o),n+=+t.slice(o+1),t=t.substring(0,o)):n<0&&(n=t.length),o=0;t.charCodeAt(o)===48;)++o;for(d=t.length;t.charCodeAt(d-1)===48;)--d;if(t=t.slice(o,d),t){if(d-=o,n=n-o-1,e.e=wy(n/yo),e.d=[],o=(n+1)%yo,n<0&&(o+=yo),o<d){for(o&&e.d.push(+t.slice(0,o)),d-=yo;o<d;)e.d.push(+t.slice(o,o+=yo));t=t.slice(o),o=yo-t.length}else o-=d;for(;o--;)t+="0";if(e.d.push(+t),Po&&(e.e>iS||e.e<-iS))throw Error(TR+n)}else e.s=0,e.e=0,e.d=[0];return e}function Qi(e,t,n){var o,d,f,_,i,S,E,I,M=e.d;for(_=1,f=M[0];f>=10;f/=10)_++;if(o=t-_,o<0)o+=yo,d=t,E=M[I=0];else{if(I=Math.ceil((o+1)/yo),f=M.length,I>=f)return e;for(E=f=M[I],_=1;f>=10;f/=10)_++;o%=yo,d=o-yo+_}if(n!==void 0&&(f=yf(10,_-d-1),i=E/f%10|0,S=t<0||M[I+1]!==void 0||E%f,S=n<4?(i||S)&&(n==0||n==(e.s<0?3:2)):i>5||i==5&&(n==4||S||n==6&&(o>0?d>0?E/yf(10,_-d):0:M[I-1])%10&1||n==(e.s<0?8:7))),t<1||!M[0])return S?(f=ns(e),M.length=1,t=t-f-1,M[0]=yf(10,(yo-t%yo)%yo),e.e=wy(-t/yo)||0):(M.length=1,M[0]=e.e=e.s=0),e;if(o==0?(M.length=I,f=1,I--):(M.length=I+1,f=yf(10,yo-o),M[I]=d>0?(E/yf(10,_-d)%yf(10,d)|0)*f:0),S)for(;;)if(I==0){(M[0]+=f)==As&&(M[0]=1,++e.e);break}else{if(M[I]+=f,M[I]!=As)break;M[I--]=0,f=1}for(o=M.length;M[--o]===0;)M.pop();if(Po&&(e.e>iS||e.e<-iS))throw Error(TR+ns(e));return e}function YG(e,t){var n,o,d,f,_,i,S,E,I,M,j=e.constructor,N=j.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new j(e),Po?Qi(t,N):t;if(S=e.d,M=t.d,o=t.e,E=e.e,S=S.slice(),_=E-o,_){for(I=_<0,I?(n=S,_=-_,i=M.length):(n=M,o=E,i=S.length),d=Math.max(Math.ceil(N/yo),i)+2,_>d&&(_=d,n.length=1),n.reverse(),d=_;d--;)n.push(0);n.reverse()}else{for(d=S.length,i=M.length,I=d<i,I&&(i=d),d=0;d<i;d++)if(S[d]!=M[d]){I=S[d]<M[d];break}_=0}for(I&&(n=S,S=M,M=n,t.s=-t.s),i=S.length,d=M.length-i;d>0;--d)S[i++]=0;for(d=M.length;d>_;){if(S[--d]<M[d]){for(f=d;f&&S[--f]===0;)S[f]=As-1;--S[f],S[d]+=As}S[d]-=M[d]}for(;S[--i]===0;)S.pop();for(;S[0]===0;S.shift())--o;return S[0]?(t.d=S,t.e=o,Po?Qi(t,N):t):new j(0)}function Gf(e,t,n){var o,d=ns(e),f=Uc(e.d),_=f.length;return t?(n&&(o=n-_)>0?f=f.charAt(0)+"."+f.slice(1)+Ud(o):_>1&&(f=f.charAt(0)+"."+f.slice(1)),f=f+(d<0?"e":"e+")+d):d<0?(f="0."+Ud(-d-1)+f,n&&(o=n-_)>0&&(f+=Ud(o))):d>=_?(f+=Ud(d+1-_),n&&(o=n-d-1)>0&&(f=f+"."+Ud(o))):((o=d+1)<_&&(f=f.slice(0,o)+"."+f.slice(o)),n&&(o=n-_)>0&&(d+1===_&&(f+="."),f+=Ud(o))),e.s<0?"-"+f:f}function EB(e,t){if(e.length>t)return e.length=t,!0}function JG(e){var t,n,o;function d(f){var _=this;if(!(_ instanceof d))return new d(f);if(_.constructor=d,f instanceof d){_.s=f.s,_.e=f.e,_.d=(f=f.d)?f.slice():f;return}if(typeof f=="number"){if(f*0!==0)throw Error(Of+f);if(f>0)_.s=1;else if(f<0)f=-f,_.s=-1;else{_.s=0,_.e=0,_.d=[0];return}if(f===~~f&&f<1e7){_.e=0,_.d=[f];return}return AB(_,f.toString())}else if(typeof f!="string")throw Error(Of+f);if(f.charCodeAt(0)===45?(f=f.slice(1),_.s=-1):_.s=1,uEe.test(f))AB(_,f);else throw Error(Of+f)}if(d.prototype=Wr,d.ROUND_UP=0,d.ROUND_DOWN=1,d.ROUND_CEIL=2,d.ROUND_FLOOR=3,d.ROUND_HALF_UP=4,d.ROUND_HALF_DOWN=5,d.ROUND_HALF_EVEN=6,d.ROUND_HALF_CEIL=7,d.ROUND_HALF_FLOOR=8,d.clone=JG,d.config=d.set=dEe,e===void 0&&(e={}),e)for(o=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<o.length;)e.hasOwnProperty(n=o[t++])||(e[n]=this[n]);return d.config(e),d}function dEe(e){if(!e||typeof e!="object")throw Error(Al+"Object expected");var t,n,o,d=["precision",1,by,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<d.length;t+=3)if((o=e[n=d[t]])!==void 0)if(wy(o)===o&&o>=d[t+1]&&o<=d[t+2])this[n]=o;else throw Error(Of+n+": "+o);if((o=e[n="LN10"])!==void 0)if(o==Math.LN10)this[n]=new this(o);else throw Error(Of+n+": "+o);return this}var AR=JG(cEe);qa=new AR(1);const Xi=AR;function hEe(e){return gEe(e)||mEe(e)||pEe(e)||fEe()}function fEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pEe(e,t){if(e){if(typeof e=="string")return lI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lI(e,t)}}function mEe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function gEe(e){if(Array.isArray(e))return lI(e)}function lI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var yEe=function(t){return t},QG={"@@functional/placeholder":!0},eH=function(t){return t===QG},PB=function(t){return function n(){return arguments.length===0||arguments.length===1&&eH(arguments.length<=0?void 0:arguments[0])?n:t.apply(void 0,arguments)}},_Ee=function e(t,n){return t===1?n:PB(function(){for(var o=arguments.length,d=new Array(o),f=0;f<o;f++)d[f]=arguments[f];var _=d.filter(function(i){return i!==QG}).length;return _>=t?n.apply(void 0,d):e(t-_,PB(function(){for(var i=arguments.length,S=new Array(i),E=0;E<i;E++)S[E]=arguments[E];var I=d.map(function(M){return eH(M)?S.shift():M});return n.apply(void 0,hEe(I).concat(S))}))})},HT=function(t){return _Ee(t.length,t)},cI=function(t,n){for(var o=[],d=t;d<n;++d)o[d-t]=d;return o},vEe=HT(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(n){return t[n]}).map(e)}),xEe=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];if(!n.length)return yEe;var d=n.reverse(),f=d[0],_=d.slice(1);return function(){return _.reduce(function(i,S){return S(i)},f.apply(void 0,arguments))}},uI=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},tH=function(t){var n=null,o=null;return function(){for(var d=arguments.length,f=new Array(d),_=0;_<d;_++)f[_]=arguments[_];return n&&f.every(function(i,S){return i===n[S]})||(n=f,o=t.apply(void 0,f)),o}};function bEe(e){var t;return e===0?t=1:t=Math.floor(new Xi(e).abs().log(10).toNumber())+1,t}function wEe(e,t,n){for(var o=new Xi(e),d=0,f=[];o.lt(t)&&d<1e5;)f.push(o.toNumber()),o=o.add(n),d++;return f}var SEe=HT(function(e,t,n){var o=+e,d=+t;return o+n*(d-o)}),TEe=HT(function(e,t,n){var o=t-+e;return o=o||1/0,(n-e)/o}),AEe=HT(function(e,t,n){var o=t-+e;return o=o||1/0,Math.max(0,Math.min(1,(n-e)/o))});const WT={rangeStep:wEe,getDigitCount:bEe,interpolateNumber:SEe,uninterpolateNumber:TEe,uninterpolateTruncation:AEe};function dI(e){return CEe(e)||PEe(e)||rH(e)||EEe()}function EEe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PEe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function CEe(e){if(Array.isArray(e))return hI(e)}function E0(e,t){return OEe(e)||MEe(e,t)||rH(e,t)||IEe()}function IEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rH(e,t){if(e){if(typeof e=="string")return hI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hI(e,t)}}function hI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function MEe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],o=!0,d=!1,f=void 0;try{for(var _=e[Symbol.iterator](),i;!(o=(i=_.next()).done)&&(n.push(i.value),!(t&&n.length===t));o=!0);}catch(S){d=!0,f=S}finally{try{!o&&_.return!=null&&_.return()}finally{if(d)throw f}}return n}}function OEe(e){if(Array.isArray(e))return e}function nH(e){var t=E0(e,2),n=t[0],o=t[1],d=n,f=o;return n>o&&(d=o,f=n),[d,f]}function iH(e,t,n){if(e.lte(0))return new Xi(0);var o=WT.getDigitCount(e.toNumber()),d=new Xi(10).pow(o),f=e.div(d),_=o!==1?.05:.1,i=new Xi(Math.ceil(f.div(_).toNumber())).add(n).mul(_),S=i.mul(d);return t?S:new Xi(Math.ceil(S))}function REe(e,t,n){var o=1,d=new Xi(e);if(!d.isint()&&n){var f=Math.abs(e);f<1?(o=new Xi(10).pow(WT.getDigitCount(e)-1),d=new Xi(Math.floor(d.div(o).toNumber())).mul(o)):f>1&&(d=new Xi(Math.floor(e)))}else e===0?d=new Xi(Math.floor((t-1)/2)):n||(d=new Xi(Math.floor(e)));var _=Math.floor((t-1)/2),i=xEe(vEe(function(S){return d.add(new Xi(S-_).mul(o)).toNumber()}),cI);return i(0,t)}function oH(e,t,n,o){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(n-1)))return{step:new Xi(0),tickMin:new Xi(0),tickMax:new Xi(0)};var f=iH(new Xi(t).sub(e).div(n-1),o,d),_;e<=0&&t>=0?_=new Xi(0):(_=new Xi(e).add(t).div(2),_=_.sub(new Xi(_).mod(f)));var i=Math.ceil(_.sub(e).div(f).toNumber()),S=Math.ceil(new Xi(t).sub(_).div(f).toNumber()),E=i+S+1;return E>n?oH(e,t,n,o,d+1):(E<n&&(S=t>0?S+(n-E):S,i=t>0?i:i+(n-E)),{step:f,tickMin:_.sub(new Xi(i).mul(f)),tickMax:_.add(new Xi(S).mul(f))})}function kEe(e){var t=E0(e,2),n=t[0],o=t[1],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=Math.max(d,2),i=nH([n,o]),S=E0(i,2),E=S[0],I=S[1];if(E===-1/0||I===1/0){var M=I===1/0?[E].concat(dI(cI(0,d-1).map(function(){return 1/0}))):[].concat(dI(cI(0,d-1).map(function(){return-1/0})),[I]);return n>o?uI(M):M}if(E===I)return REe(E,d,f);var j=oH(E,I,_,f),N=j.step,G=j.tickMin,z=j.tickMax,V=WT.rangeStep(G,z.add(new Xi(.1).mul(N)),N);return n>o?uI(V):V}function jEe(e,t){var n=E0(e,2),o=n[0],d=n[1],f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,_=nH([o,d]),i=E0(_,2),S=i[0],E=i[1];if(S===-1/0||E===1/0)return[o,d];if(S===E)return[S];var I=Math.max(t,2),M=iH(new Xi(E).sub(S).div(I-1),f,0),j=[].concat(dI(WT.rangeStep(new Xi(S),new Xi(E).sub(new Xi(.99).mul(M)),M)),[E]);return o>d?uI(j):j}var DEe=tH(kEe),LEe=tH(jEe),NEe="Invariant failed";function Hf(e,t){throw new Error(NEe)}var zEe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Lg(e){"@babel/helpers - typeof";return Lg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lg(e)}function oS(){return oS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},oS.apply(this,arguments)}function FEe(e,t){return UEe(e)||VEe(e,t)||$Ee(e,t)||BEe()}function BEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Ee(e,t){if(e){if(typeof e=="string")return CB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CB(e,t)}}function CB(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function VEe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function UEe(e){if(Array.isArray(e))return e}function GEe(e,t){if(e==null)return{};var n=HEe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function HEe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function WEe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qEe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,lH(o.key),o)}}function ZEe(e,t,n){return t&&qEe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function KEe(e,t,n){return t=sS(t),XEe(e,sH()?Reflect.construct(t,n||[],sS(e).constructor):t.apply(e,n))}function XEe(e,t){if(t&&(Lg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YEe(e)}function YEe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(sH=function(){return!!e})()}function sS(e){return sS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},sS(e)}function JEe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fI(e,t)}function fI(e,t){return fI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},fI(e,t)}function aH(e,t,n){return t=lH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lH(e){var t=QEe(e,"string");return Lg(t)=="symbol"?t:t+""}function QEe(e,t){if(Lg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Lg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yx=function(e){function t(){return WEe(this,t),KEe(this,t,arguments)}return JEe(t,e),ZEe(t,[{key:"render",value:function(){var o=this.props,d=o.offset,f=o.layout,_=o.width,i=o.dataKey,S=o.data,E=o.dataPointFormatter,I=o.xAxis,M=o.yAxis,j=GEe(o,zEe),N=Tn(j,!1);this.props.direction==="x"&&I.type!=="number"&&Hf();var G=S.map(function(z){var V=E(z,i),K=V.x,Q=V.y,X=V.value,ie=V.errorVal;if(!ie)return null;var J=[],se,he;if(Array.isArray(ie)){var we=FEe(ie,2);se=we[0],he=we[1]}else se=he=ie;if(f==="vertical"){var ze=I.scale,je=Q+d,Oe=je+_,Be=je-_,qe=ze(X-se),Xe=ze(X+he);J.push({x1:Xe,y1:Oe,x2:Xe,y2:Be}),J.push({x1:qe,y1:je,x2:Xe,y2:je}),J.push({x1:qe,y1:Oe,x2:qe,y2:Be})}else if(f==="horizontal"){var it=M.scale,Ge=K+d,Ke=Ge-_,ut=Ge+_,rt=it(X-se),Xt=it(X+he);J.push({x1:Ke,y1:Xt,x2:ut,y2:Xt}),J.push({x1:Ge,y1:rt,x2:Ge,y2:Xt}),J.push({x1:Ke,y1:rt,x2:ut,y2:rt})}return Le.createElement(Di,oS({className:"recharts-errorBar",key:"bar-".concat(J.map(function(cr){return"".concat(cr.x1,"-").concat(cr.x2,"-").concat(cr.y1,"-").concat(cr.y2)}))},N),J.map(function(cr){return Le.createElement("line",oS({},cr,{key:"line-".concat(cr.x1,"-").concat(cr.x2,"-").concat(cr.y1,"-").concat(cr.y2)}))}))});return Le.createElement(Di,{className:"recharts-errorBars"},G)}}])}(Le.Component);aH(yx,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});aH(yx,"displayName","ErrorBar");function P0(e){"@babel/helpers - typeof";return P0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P0(e)}function IB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function df(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IB(Object(n),!0).forEach(function(o){ePe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ePe(e,t,n){return t=tPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tPe(e){var t=rPe(e,"string");return P0(t)=="symbol"?t:t+""}function rPe(e,t){if(P0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(P0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var cH=function(t){var n=t.children,o=t.formattedGraphicalItems,d=t.legendWidth,f=t.legendContent,_=Ua(n,Xd);if(!_)return null;var i=Xd.defaultProps,S=i!==void 0?df(df({},i),_.props):{},E;return _.props&&_.props.payload?E=_.props&&_.props.payload:f==="children"?E=(o||[]).reduce(function(I,M){var j=M.item,N=M.props,G=N.sectors||N.data||[];return I.concat(G.map(function(z){return{type:_.props.iconType||j.props.legendType,value:z.name,color:z.fill,payload:z}}))},[]):E=(o||[]).map(function(I){var M=I.item,j=M.type.defaultProps,N=j!==void 0?df(df({},j),M.props):{},G=N.dataKey,z=N.name,V=N.legendType,K=N.hide;return{inactive:K,dataKey:G,type:S.iconType||V||"square",color:ER(M),value:z||G,payload:N}}),df(df(df({},S),Xd.getWithHeight(_,d)),{},{payload:E,item:_})};function C0(e){"@babel/helpers - typeof";return C0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C0(e)}function MB(e){return sPe(e)||oPe(e)||iPe(e)||nPe()}function nPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iPe(e,t){if(e){if(typeof e=="string")return pI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pI(e,t)}}function oPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function sPe(e){if(Array.isArray(e))return pI(e)}function pI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function OB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Fo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OB(Object(n),!0).forEach(function(o){xg(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function xg(e,t,n){return t=aPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aPe(e){var t=lPe(e,"string");return C0(t)=="symbol"?t:t+""}function lPe(e,t){if(C0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(C0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hs(e,t,n){return Jn(e)||Jn(t)?n:fs(t)?Ka(e,t,n):Vn(t)?t(e):n}function Yv(e,t,n,o){var d=oEe(e,function(i){return hs(i,t)});if(n==="number"){var f=d.filter(function(i){return vr(i)||parseFloat(i)});return f.length?[GT(f),UT(f)]:[1/0,-1/0]}var _=o?d.filter(function(i){return!Jn(i)}):d;return _.map(function(i){return fs(i)||i instanceof Date?i:""})}var cPe=function(t){var n,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],d=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,_=-1,i=(n=o?.length)!==null&&n!==void 0?n:0;if(i<=1)return 0;if(f&&f.axisType==="angleAxis"&&Math.abs(Math.abs(f.range[1]-f.range[0])-360)<=1e-6)for(var S=f.range,E=0;E<i;E++){var I=E>0?d[E-1].coordinate:d[i-1].coordinate,M=d[E].coordinate,j=E>=i-1?d[0].coordinate:d[E+1].coordinate,N=void 0;if(ia(M-I)!==ia(j-M)){var G=[];if(ia(j-M)===ia(S[1]-S[0])){N=j;var z=M+S[1]-S[0];G[0]=Math.min(z,(z+I)/2),G[1]=Math.max(z,(z+I)/2)}else{N=I;var V=j+S[1]-S[0];G[0]=Math.min(M,(V+M)/2),G[1]=Math.max(M,(V+M)/2)}var K=[Math.min(M,(N+M)/2),Math.max(M,(N+M)/2)];if(t>K[0]&&t<=K[1]||t>=G[0]&&t<=G[1]){_=d[E].index;break}}else{var Q=Math.min(I,j),X=Math.max(I,j);if(t>(Q+M)/2&&t<=(X+M)/2){_=d[E].index;break}}}else for(var ie=0;ie<i;ie++)if(ie===0&&t<=(o[ie].coordinate+o[ie+1].coordinate)/2||ie>0&&ie<i-1&&t>(o[ie].coordinate+o[ie-1].coordinate)/2&&t<=(o[ie].coordinate+o[ie+1].coordinate)/2||ie===i-1&&t>(o[ie].coordinate+o[ie-1].coordinate)/2){_=o[ie].index;break}return _},ER=function(t){var n,o=t,d=o.type.displayName,f=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Fo(Fo({},t.type.defaultProps),t.props):t.props,_=f.stroke,i=f.fill,S;switch(d){case"Line":S=_;break;case"Area":case"Radar":S=_&&_!=="none"?_:i;break;default:S=i;break}return S},uPe=function(t){var n=t.barSize,o=t.totalSize,d=t.stackGroups,f=d===void 0?{}:d;if(!f)return{};for(var _={},i=Object.keys(f),S=0,E=i.length;S<E;S++)for(var I=f[i[S]].stackGroups,M=Object.keys(I),j=0,N=M.length;j<N;j++){var G=I[M[j]],z=G.items,V=G.cateAxisId,K=z.filter(function(he){return Vu(he.type).indexOf("Bar")>=0});if(K&&K.length){var Q=K[0].type.defaultProps,X=Q!==void 0?Fo(Fo({},Q),K[0].props):K[0].props,ie=X.barSize,J=X[V];_[J]||(_[J]=[]);var se=Jn(ie)?n:ie;_[J].push({item:K[0],stackList:K.slice(1),barSize:Jn(se)?void 0:oa(se,o,0)})}}return _},dPe=function(t){var n=t.barGap,o=t.barCategoryGap,d=t.bandSize,f=t.sizeList,_=f===void 0?[]:f,i=t.maxBarSize,S=_.length;if(S<1)return null;var E=oa(n,d,0,!0),I,M=[];if(_[0].barSize===+_[0].barSize){var j=!1,N=d/S,G=_.reduce(function(ie,J){return ie+J.barSize||0},0);G+=(S-1)*E,G>=d&&(G-=(S-1)*E,E=0),G>=d&&N>0&&(j=!0,N*=.9,G=S*N);var z=(d-G)/2>>0,V={offset:z-E,size:0};I=_.reduce(function(ie,J){var se={item:J.item,position:{offset:V.offset+V.size+E,size:j?N:J.barSize}},he=[].concat(MB(ie),[se]);return V=he[he.length-1].position,J.stackList&&J.stackList.length&&J.stackList.forEach(function(we){he.push({item:we,position:V})}),he},M)}else{var K=oa(o,d,0,!0);d-2*K-(S-1)*E<=0&&(E=0);var Q=(d-2*K-(S-1)*E)/S;Q>1&&(Q>>=0);var X=i===+i?Math.min(Q,i):Q;I=_.reduce(function(ie,J,se){var he=[].concat(MB(ie),[{item:J.item,position:{offset:K+(Q+E)*se+(Q-X)/2,size:X}}]);return J.stackList&&J.stackList.length&&J.stackList.forEach(function(we){he.push({item:we,position:he[he.length-1].position})}),he},M)}return I},hPe=function(t,n,o,d){var f=o.children,_=o.width,i=o.margin,S=_-(i.left||0)-(i.right||0),E=cH({children:f,legendWidth:S});if(E){var I=d||{},M=I.width,j=I.height,N=E.align,G=E.verticalAlign,z=E.layout;if((z==="vertical"||z==="horizontal"&&G==="middle")&&N!=="center"&&vr(t[N]))return Fo(Fo({},t),{},xg({},N,t[N]+(M||0)));if((z==="horizontal"||z==="vertical"&&N==="center")&&G!=="middle"&&vr(t[G]))return Fo(Fo({},t),{},xg({},G,t[G]+(j||0)))}return t},fPe=function(t,n,o){return Jn(n)?!0:t==="horizontal"?n==="yAxis":t==="vertical"||o==="x"?n==="xAxis":o==="y"?n==="yAxis":!0},uH=function(t,n,o,d,f){var _=n.props.children,i=Xa(_,yx).filter(function(E){return fPe(d,f,E.props.direction)});if(i&&i.length){var S=i.map(function(E){return E.props.dataKey});return t.reduce(function(E,I){var M=hs(I,o);if(Jn(M))return E;var j=Array.isArray(M)?[GT(M),UT(M)]:[M,M],N=S.reduce(function(G,z){var V=hs(I,z,0),K=j[0]-Math.abs(Array.isArray(V)?V[0]:V),Q=j[1]+Math.abs(Array.isArray(V)?V[1]:V);return[Math.min(K,G[0]),Math.max(Q,G[1])]},[1/0,-1/0]);return[Math.min(N[0],E[0]),Math.max(N[1],E[1])]},[1/0,-1/0])}return null},pPe=function(t,n,o,d,f){var _=n.map(function(i){return uH(t,i,o,f,d)}).filter(function(i){return!Jn(i)});return _&&_.length?_.reduce(function(i,S){return[Math.min(i[0],S[0]),Math.max(i[1],S[1])]},[1/0,-1/0]):null},dH=function(t,n,o,d,f){var _=n.map(function(S){var E=S.props.dataKey;return o==="number"&&E&&uH(t,S,E,d)||Yv(t,E,o,f)});if(o==="number")return _.reduce(function(S,E){return[Math.min(S[0],E[0]),Math.max(S[1],E[1])]},[1/0,-1/0]);var i={};return _.reduce(function(S,E){for(var I=0,M=E.length;I<M;I++)i[E[I]]||(i[E[I]]=!0,S.push(E[I]));return S},[])},hH=function(t,n){return t==="horizontal"&&n==="xAxis"||t==="vertical"&&n==="yAxis"||t==="centric"&&n==="angleAxis"||t==="radial"&&n==="radiusAxis"},fH=function(t,n,o,d){if(d)return t.map(function(S){return S.coordinate});var f,_,i=t.map(function(S){return S.coordinate===n&&(f=!0),S.coordinate===o&&(_=!0),S.coordinate});return f||i.push(n),_||i.push(o),i},zu=function(t,n,o){if(!t)return null;var d=t.scale,f=t.duplicateDomain,_=t.type,i=t.range,S=t.realScaleType==="scaleBand"?d.bandwidth()/2:2,E=(n||o)&&_==="category"&&d.bandwidth?d.bandwidth()/S:0;if(E=t.axisType==="angleAxis"&&i?.length>=2?ia(i[0]-i[1])*2*E:E,n&&(t.ticks||t.niceTicks)){var I=(t.ticks||t.niceTicks).map(function(M){var j=f?f.indexOf(M):M;return{coordinate:d(j)+E,value:M,offset:E}});return I.filter(function(M){return!ux(M.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(M,j){return{coordinate:d(M)+E,value:M,index:j,offset:E}}):d.ticks&&!o?d.ticks(t.tickCount).map(function(M){return{coordinate:d(M)+E,value:M,offset:E}}):d.domain().map(function(M,j){return{coordinate:d(M)+E,value:f?f[M]:M,index:j,offset:E}})},xP=new WeakMap,V1=function(t,n){if(typeof n!="function")return t;xP.has(t)||xP.set(t,new WeakMap);var o=xP.get(t);if(o.has(n))return o.get(n);var d=function(){t.apply(void 0,arguments),n.apply(void 0,arguments)};return o.set(n,d),d},pH=function(t,n,o){var d=t.scale,f=t.type,_=t.layout,i=t.axisType;if(d==="auto")return _==="radial"&&i==="radiusAxis"?{scale:x0(),realScaleType:"band"}:_==="radial"&&i==="angleAxis"?{scale:eS(),realScaleType:"linear"}:f==="category"&&n&&(n.indexOf("LineChart")>=0||n.indexOf("AreaChart")>=0||n.indexOf("ComposedChart")>=0&&!o)?{scale:Xv(),realScaleType:"point"}:f==="category"?{scale:x0(),realScaleType:"band"}:{scale:eS(),realScaleType:"linear"};if($f(d)){var S="scale".concat(IT(d));return{scale:(TB[S]||Xv)(),realScaleType:TB[S]?S:"point"}}return Vn(d)?{scale:d}:{scale:Xv(),realScaleType:"point"}},RB=1e-4,mH=function(t){var n=t.domain();if(!(!n||n.length<=2)){var o=n.length,d=t.range(),f=Math.min(d[0],d[1])-RB,_=Math.max(d[0],d[1])+RB,i=t(n[0]),S=t(n[o-1]);(i<f||i>_||S<f||S>_)&&t.domain([n[0],n[o-1]])}},mPe=function(t,n){if(!t)return null;for(var o=0,d=t.length;o<d;o++)if(t[o].item===n)return t[o].position;return null},gPe=function(t,n){if(!n||n.length!==2||!vr(n[0])||!vr(n[1]))return t;var o=Math.min(n[0],n[1]),d=Math.max(n[0],n[1]),f=[t[0],t[1]];return(!vr(t[0])||t[0]<o)&&(f[0]=o),(!vr(t[1])||t[1]>d)&&(f[1]=d),f[0]>d&&(f[0]=d),f[1]<o&&(f[1]=o),f},yPe=function(t){var n=t.length;if(!(n<=0))for(var o=0,d=t[0].length;o<d;++o)for(var f=0,_=0,i=0;i<n;++i){var S=ux(t[i][o][1])?t[i][o][0]:t[i][o][1];S>=0?(t[i][o][0]=f,t[i][o][1]=f+S,f=t[i][o][1]):(t[i][o][0]=_,t[i][o][1]=_+S,_=t[i][o][1])}},_Pe=function(t){var n=t.length;if(!(n<=0))for(var o=0,d=t[0].length;o<d;++o)for(var f=0,_=0;_<n;++_){var i=ux(t[_][o][1])?t[_][o][0]:t[_][o][1];i>=0?(t[_][o][0]=f,t[_][o][1]=f+i,f=t[_][o][1]):(t[_][o][0]=0,t[_][o][1]=0)}},vPe={sign:yPe,expand:zge,none:Cg,silhouette:Fge,wiggle:Bge,positive:_Pe},xPe=function(t,n,o){var d=n.map(function(i){return i.props.dataKey}),f=vPe[o],_=Nge().keys(d).value(function(i,S){return+hs(i,S,0)}).order(zC).offset(f);return _(t)},bPe=function(t,n,o,d,f,_){if(!t)return null;var i=_?n.reverse():n,S={},E=i.reduce(function(M,j){var N,G=(N=j.type)!==null&&N!==void 0&&N.defaultProps?Fo(Fo({},j.type.defaultProps),j.props):j.props,z=G.stackId,V=G.hide;if(V)return M;var K=G[o],Q=M[K]||{hasStack:!1,stackGroups:{}};if(fs(z)){var X=Q.stackGroups[z]||{numericAxisId:o,cateAxisId:d,items:[]};X.items.push(j),Q.hasStack=!0,Q.stackGroups[z]=X}else Q.stackGroups[gy("_stackId_")]={numericAxisId:o,cateAxisId:d,items:[j]};return Fo(Fo({},M),{},xg({},K,Q))},S),I={};return Object.keys(E).reduce(function(M,j){var N=E[j];if(N.hasStack){var G={};N.stackGroups=Object.keys(N.stackGroups).reduce(function(z,V){var K=N.stackGroups[V];return Fo(Fo({},z),{},xg({},V,{numericAxisId:o,cateAxisId:d,items:K.items,stackedData:xPe(t,K.items,f)}))},G)}return Fo(Fo({},M),{},xg({},j,N))},I)},gH=function(t,n){var o=n.realScaleType,d=n.type,f=n.tickCount,_=n.originalDomain,i=n.allowDecimals,S=o||n.scale;if(S!=="auto"&&S!=="linear")return null;if(f&&d==="number"&&_&&(_[0]==="auto"||_[1]==="auto")){var E=t.domain();if(!E.length)return null;var I=DEe(E,f,i);return t.domain([GT(I),UT(I)]),{niceTicks:I}}if(f&&d==="number"){var M=t.domain(),j=LEe(M,f,i);return{niceTicks:j}}return null};function kB(e){var t=e.axis,n=e.ticks,o=e.bandSize,d=e.entry,f=e.index,_=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Jn(d[t.dataKey])){var i=kw(n,"value",d[t.dataKey]);if(i)return i.coordinate+o/2}return n[f]?n[f].coordinate+o/2:null}var S=hs(d,Jn(_)?t.dataKey:_);return Jn(S)?null:t.scale(S)}var jB=function(t){var n=t.axis,o=t.ticks,d=t.offset,f=t.bandSize,_=t.entry,i=t.index;if(n.type==="category")return o[i]?o[i].coordinate+d:null;var S=hs(_,n.dataKey,n.domain[i]);return Jn(S)?null:n.scale(S)-f/2+d},wPe=function(t){var n=t.numericAxis,o=n.scale.domain();if(n.type==="number"){var d=Math.min(o[0],o[1]),f=Math.max(o[0],o[1]);return d<=0&&f>=0?0:f<0?f:d}return o[0]},SPe=function(t,n){var o,d=(o=t.type)!==null&&o!==void 0&&o.defaultProps?Fo(Fo({},t.type.defaultProps),t.props):t.props,f=d.stackId;if(fs(f)){var _=n[f];if(_){var i=_.items.indexOf(t);return i>=0?_.stackedData[i]:null}}return null},TPe=function(t){return t.reduce(function(n,o){return[GT(o.concat([n[0]]).filter(vr)),UT(o.concat([n[1]]).filter(vr))]},[1/0,-1/0])},yH=function(t,n,o){return Object.keys(t).reduce(function(d,f){var _=t[f],i=_.stackedData,S=i.reduce(function(E,I){var M=TPe(I.slice(n,o+1));return[Math.min(E[0],M[0]),Math.max(E[1],M[1])]},[1/0,-1/0]);return[Math.min(S[0],d[0]),Math.max(S[1],d[1])]},[1/0,-1/0]).map(function(d){return d===1/0||d===-1/0?0:d})},DB=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,LB=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,mI=function(t,n,o){if(Vn(t))return t(n,o);if(!Array.isArray(t))return n;var d=[];if(vr(t[0]))d[0]=o?t[0]:Math.min(t[0],n[0]);else if(DB.test(t[0])){var f=+DB.exec(t[0])[1];d[0]=n[0]-f}else Vn(t[0])?d[0]=t[0](n[0]):d[0]=n[0];if(vr(t[1]))d[1]=o?t[1]:Math.max(t[1],n[1]);else if(LB.test(t[1])){var _=+LB.exec(t[1])[1];d[1]=n[1]+_}else Vn(t[1])?d[1]=t[1](n[1]):d[1]=n[1];return d},aS=function(t,n,o){if(t&&t.scale&&t.scale.bandwidth){var d=t.scale.bandwidth();if(!o||d>0)return d}if(t&&n&&n.length>=2){for(var f=QO(n,function(M){return M.coordinate}),_=1/0,i=1,S=f.length;i<S;i++){var E=f[i],I=f[i-1];_=Math.min((E.coordinate||0)-(I.coordinate||0),_)}return _===1/0?0:_}return o?void 0:0},NB=function(t,n,o){return!t||!t.length||gx(t,Ka(o,"type.defaultProps.domain"))?n:t},_H=function(t,n){var o=t.type.defaultProps?Fo(Fo({},t.type.defaultProps),t.props):t.props,d=o.dataKey,f=o.name,_=o.unit,i=o.formatter,S=o.tooltipType,E=o.chartType,I=o.hide;return Fo(Fo({},Tn(t,!1)),{},{dataKey:d,unit:_,formatter:i,name:f||d,color:ER(t),value:hs(n,d),type:S,payload:n,chartType:E,hide:I})};function I0(e){"@babel/helpers - typeof";return I0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I0(e)}function zB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Du(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zB(Object(n),!0).forEach(function(o){vH(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function vH(e,t,n){return t=APe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function APe(e){var t=EPe(e,"string");return I0(t)=="symbol"?t:t+""}function EPe(e,t){if(I0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(I0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function PPe(e,t){return OPe(e)||MPe(e,t)||IPe(e,t)||CPe()}function CPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IPe(e,t){if(e){if(typeof e=="string")return FB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return FB(e,t)}}function FB(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function MPe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function OPe(e){if(Array.isArray(e))return e}var lS=Math.PI/180,RPe=function(t){return t*180/Math.PI},lo=function(t,n,o,d){return{x:t+Math.cos(-lS*d)*o,y:n+Math.sin(-lS*d)*o}},xH=function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(o.left||0)-(o.right||0)),Math.abs(n-(o.top||0)-(o.bottom||0)))/2},kPe=function(t,n,o,d,f){var _=t.width,i=t.height,S=t.startAngle,E=t.endAngle,I=oa(t.cx,_,_/2),M=oa(t.cy,i,i/2),j=xH(_,i,o),N=oa(t.innerRadius,j,0),G=oa(t.outerRadius,j,j*.8),z=Object.keys(n);return z.reduce(function(V,K){var Q=n[K],X=Q.domain,ie=Q.reversed,J;if(Jn(Q.range))d==="angleAxis"?J=[S,E]:d==="radiusAxis"&&(J=[N,G]),ie&&(J=[J[1],J[0]]);else{J=Q.range;var se=J,he=PPe(se,2);S=he[0],E=he[1]}var we=pH(Q,f),ze=we.realScaleType,je=we.scale;je.domain(X).range(J),mH(je);var Oe=gH(je,Du(Du({},Q),{},{realScaleType:ze})),Be=Du(Du(Du({},Q),Oe),{},{range:J,radius:G,realScaleType:ze,scale:je,cx:I,cy:M,innerRadius:N,outerRadius:G,startAngle:S,endAngle:E});return Du(Du({},V),{},vH({},K,Be))},{})},jPe=function(t,n){var o=t.x,d=t.y,f=n.x,_=n.y;return Math.sqrt(Math.pow(o-f,2)+Math.pow(d-_,2))},DPe=function(t,n){var o=t.x,d=t.y,f=n.cx,_=n.cy,i=jPe({x:o,y:d},{x:f,y:_});if(i<=0)return{radius:i};var S=(o-f)/i,E=Math.acos(S);return d>_&&(E=2*Math.PI-E),{radius:i,angle:RPe(E),angleInRadian:E}},LPe=function(t){var n=t.startAngle,o=t.endAngle,d=Math.floor(n/360),f=Math.floor(o/360),_=Math.min(d,f);return{startAngle:n-_*360,endAngle:o-_*360}},NPe=function(t,n){var o=n.startAngle,d=n.endAngle,f=Math.floor(o/360),_=Math.floor(d/360),i=Math.min(f,_);return t+i*360},BB=function(t,n){var o=t.x,d=t.y,f=DPe({x:o,y:d},n),_=f.radius,i=f.angle,S=n.innerRadius,E=n.outerRadius;if(_<S||_>E)return!1;if(_===0)return!0;var I=LPe(n),M=I.startAngle,j=I.endAngle,N=i,G;if(M<=j){for(;N>j;)N-=360;for(;N<M;)N+=360;G=N>=M&&N<=j}else{for(;N>M;)N-=360;for(;N<j;)N+=360;G=N>=j&&N<=M}return G?Du(Du({},n),{},{radius:_,angle:NPe(N,n)}):null},bH=function(t){return!B.isValidElement(t)&&!Vn(t)&&typeof t!="boolean"?t.className:""};function M0(e){"@babel/helpers - typeof";return M0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M0(e)}var zPe=["offset"];function FPe(e){return UPe(e)||VPe(e)||$Pe(e)||BPe()}function BPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Pe(e,t){if(e){if(typeof e=="string")return gI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gI(e,t)}}function VPe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function UPe(e){if(Array.isArray(e))return gI(e)}function gI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function GPe(e,t){if(e==null)return{};var n=HPe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function HPe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function $B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function cs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$B(Object(n),!0).forEach(function(o){WPe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$B(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function WPe(e,t,n){return t=qPe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qPe(e){var t=ZPe(e,"string");return M0(t)=="symbol"?t:t+""}function ZPe(e,t){if(M0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(M0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function O0(){return O0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},O0.apply(this,arguments)}var KPe=function(t){var n=t.value,o=t.formatter,d=Jn(t.children)?n:t.children;return Vn(o)?o(d):d},XPe=function(t,n){var o=ia(n-t),d=Math.min(Math.abs(n-t),360);return o*d},YPe=function(t,n,o){var d=t.position,f=t.viewBox,_=t.offset,i=t.className,S=f,E=S.cx,I=S.cy,M=S.innerRadius,j=S.outerRadius,N=S.startAngle,G=S.endAngle,z=S.clockWise,V=(M+j)/2,K=XPe(N,G),Q=K>=0?1:-1,X,ie;d==="insideStart"?(X=N+Q*_,ie=z):d==="insideEnd"?(X=G-Q*_,ie=!z):d==="end"&&(X=G+Q*_,ie=z),ie=K<=0?ie:!ie;var J=lo(E,I,V,X),se=lo(E,I,V,X+(ie?1:-1)*359),he="M".concat(J.x,",").concat(J.y,`
    A`).concat(V,",").concat(V,",0,1,").concat(ie?0:1,`,
    `).concat(se.x,",").concat(se.y),we=Jn(t.id)?gy("recharts-radial-line-"):t.id;return Le.createElement("text",O0({},o,{dominantBaseline:"central",className:ni("recharts-radial-bar-label",i)}),Le.createElement("defs",null,Le.createElement("path",{id:we,d:he})),Le.createElement("textPath",{xlinkHref:"#".concat(we)},n))},JPe=function(t){var n=t.viewBox,o=t.offset,d=t.position,f=n,_=f.cx,i=f.cy,S=f.innerRadius,E=f.outerRadius,I=f.startAngle,M=f.endAngle,j=(I+M)/2;if(d==="outside"){var N=lo(_,i,E+o,j),G=N.x,z=N.y;return{x:G,y:z,textAnchor:G>=_?"start":"end",verticalAnchor:"middle"}}if(d==="center")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(d==="centerTop")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"start"};if(d==="centerBottom")return{x:_,y:i,textAnchor:"middle",verticalAnchor:"end"};var V=(S+E)/2,K=lo(_,i,V,j),Q=K.x,X=K.y;return{x:Q,y:X,textAnchor:"middle",verticalAnchor:"middle"}},QPe=function(t){var n=t.viewBox,o=t.parentViewBox,d=t.offset,f=t.position,_=n,i=_.x,S=_.y,E=_.width,I=_.height,M=I>=0?1:-1,j=M*d,N=M>0?"end":"start",G=M>0?"start":"end",z=E>=0?1:-1,V=z*d,K=z>0?"end":"start",Q=z>0?"start":"end";if(f==="top"){var X={x:i+E/2,y:S-M*d,textAnchor:"middle",verticalAnchor:N};return cs(cs({},X),o?{height:Math.max(S-o.y,0),width:E}:{})}if(f==="bottom"){var ie={x:i+E/2,y:S+I+j,textAnchor:"middle",verticalAnchor:G};return cs(cs({},ie),o?{height:Math.max(o.y+o.height-(S+I),0),width:E}:{})}if(f==="left"){var J={x:i-V,y:S+I/2,textAnchor:K,verticalAnchor:"middle"};return cs(cs({},J),o?{width:Math.max(J.x-o.x,0),height:I}:{})}if(f==="right"){var se={x:i+E+V,y:S+I/2,textAnchor:Q,verticalAnchor:"middle"};return cs(cs({},se),o?{width:Math.max(o.x+o.width-se.x,0),height:I}:{})}var he=o?{width:E,height:I}:{};return f==="insideLeft"?cs({x:i+V,y:S+I/2,textAnchor:Q,verticalAnchor:"middle"},he):f==="insideRight"?cs({x:i+E-V,y:S+I/2,textAnchor:K,verticalAnchor:"middle"},he):f==="insideTop"?cs({x:i+E/2,y:S+j,textAnchor:"middle",verticalAnchor:G},he):f==="insideBottom"?cs({x:i+E/2,y:S+I-j,textAnchor:"middle",verticalAnchor:N},he):f==="insideTopLeft"?cs({x:i+V,y:S+j,textAnchor:Q,verticalAnchor:G},he):f==="insideTopRight"?cs({x:i+E-V,y:S+j,textAnchor:K,verticalAnchor:G},he):f==="insideBottomLeft"?cs({x:i+V,y:S+I-j,textAnchor:Q,verticalAnchor:N},he):f==="insideBottomRight"?cs({x:i+E-V,y:S+I-j,textAnchor:K,verticalAnchor:N},he):hy(f)&&(vr(f.x)||Sf(f.x))&&(vr(f.y)||Sf(f.y))?cs({x:i+oa(f.x,E),y:S+oa(f.y,I),textAnchor:"end",verticalAnchor:"end"},he):cs({x:i+E/2,y:S+I/2,textAnchor:"middle",verticalAnchor:"middle"},he)},eCe=function(t){return"cx"in t&&vr(t.cx)};function Es(e){var t=e.offset,n=t===void 0?5:t,o=GPe(e,zPe),d=cs({offset:n},o),f=d.viewBox,_=d.position,i=d.value,S=d.children,E=d.content,I=d.className,M=I===void 0?"":I,j=d.textBreakAll;if(!f||Jn(i)&&Jn(S)&&!B.isValidElement(E)&&!Vn(E))return null;if(B.isValidElement(E))return B.cloneElement(E,d);var N;if(Vn(E)){if(N=B.createElement(E,d),B.isValidElement(N))return N}else N=KPe(d);var G=eCe(f),z=Tn(d,!0);if(G&&(_==="insideStart"||_==="insideEnd"||_==="end"))return YPe(d,N,z);var V=G?JPe(d):QPe(d);return Le.createElement(Uf,O0({className:ni("recharts-label",M)},z,V,{breakAll:j}),N)}Es.displayName="Label";var wH=function(t){var n=t.cx,o=t.cy,d=t.angle,f=t.startAngle,_=t.endAngle,i=t.r,S=t.radius,E=t.innerRadius,I=t.outerRadius,M=t.x,j=t.y,N=t.top,G=t.left,z=t.width,V=t.height,K=t.clockWise,Q=t.labelViewBox;if(Q)return Q;if(vr(z)&&vr(V)){if(vr(M)&&vr(j))return{x:M,y:j,width:z,height:V};if(vr(N)&&vr(G))return{x:N,y:G,width:z,height:V}}return vr(M)&&vr(j)?{x:M,y:j,width:0,height:0}:vr(n)&&vr(o)?{cx:n,cy:o,startAngle:f||d||0,endAngle:_||d||0,innerRadius:E||0,outerRadius:I||S||i||0,clockWise:K}:t.viewBox?t.viewBox:{}},tCe=function(t,n){return t?t===!0?Le.createElement(Es,{key:"label-implicit",viewBox:n}):fs(t)?Le.createElement(Es,{key:"label-implicit",viewBox:n,value:t}):B.isValidElement(t)?t.type===Es?B.cloneElement(t,{key:"label-implicit",viewBox:n}):Le.createElement(Es,{key:"label-implicit",content:t,viewBox:n}):Vn(t)?Le.createElement(Es,{key:"label-implicit",content:t,viewBox:n}):hy(t)?Le.createElement(Es,O0({viewBox:n},t,{key:"label-implicit"})):null:null},rCe=function(t,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&o&&!t.label)return null;var d=t.children,f=wH(t),_=Xa(d,Es).map(function(S,E){return B.cloneElement(S,{viewBox:n||f,key:"label-".concat(E)})});if(!o)return _;var i=tCe(t.label,n||f);return[i].concat(FPe(_))};Es.parseViewBox=wH;Es.renderCallByParent=rCe;function nCe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var iCe=nCe;const oCe=Ni(iCe);function R0(e){"@babel/helpers - typeof";return R0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R0(e)}var sCe=["valueAccessor"],aCe=["data","dataKey","clockWise","id","textBreakAll"];function lCe(e){return hCe(e)||dCe(e)||uCe(e)||cCe()}function cCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uCe(e,t){if(e){if(typeof e=="string")return yI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yI(e,t)}}function dCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hCe(e){if(Array.isArray(e))return yI(e)}function yI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function cS(){return cS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},cS.apply(this,arguments)}function VB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function UB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VB(Object(n),!0).forEach(function(o){fCe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function fCe(e,t,n){return t=pCe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pCe(e){var t=mCe(e,"string");return R0(t)=="symbol"?t:t+""}function mCe(e,t){if(R0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(R0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function GB(e,t){if(e==null)return{};var n=gCe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function gCe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}var yCe=function(t){return Array.isArray(t.value)?oCe(t.value):t.value};function Gu(e){var t=e.valueAccessor,n=t===void 0?yCe:t,o=GB(e,sCe),d=o.data,f=o.dataKey,_=o.clockWise,i=o.id,S=o.textBreakAll,E=GB(o,aCe);return!d||!d.length?null:Le.createElement(Di,{className:"recharts-label-list"},d.map(function(I,M){var j=Jn(f)?n(I,M):hs(I&&I.payload,f),N=Jn(i)?{}:{id:"".concat(i,"-").concat(M)};return Le.createElement(Es,cS({},Tn(I,!0),E,N,{parentViewBox:I.parentViewBox,value:j,textBreakAll:S,viewBox:Es.parseViewBox(Jn(_)?I:UB(UB({},I),{},{clockWise:_})),key:"label-".concat(M),index:M}))}))}Gu.displayName="LabelList";function _Ce(e,t){return e?e===!0?Le.createElement(Gu,{key:"labelList-implicit",data:t}):Le.isValidElement(e)||Vn(e)?Le.createElement(Gu,{key:"labelList-implicit",data:t,content:e}):hy(e)?Le.createElement(Gu,cS({data:t},e,{key:"labelList-implicit"})):null:null}function vCe(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var o=e.children,d=Xa(o,Gu).map(function(_,i){return B.cloneElement(_,{data:t,key:"labelList-".concat(i)})});if(!n)return d;var f=_Ce(e.label,t);return[f].concat(lCe(d))}Gu.renderCallByParent=vCe;function k0(e){"@babel/helpers - typeof";return k0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k0(e)}function _I(){return _I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_I.apply(this,arguments)}function HB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function WB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?HB(Object(n),!0).forEach(function(o){xCe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):HB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function xCe(e,t,n){return t=bCe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bCe(e){var t=wCe(e,"string");return k0(t)=="symbol"?t:t+""}function wCe(e,t){if(k0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(k0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SCe=function(t,n){var o=ia(n-t),d=Math.min(Math.abs(n-t),359.999);return o*d},U1=function(t){var n=t.cx,o=t.cy,d=t.radius,f=t.angle,_=t.sign,i=t.isExternal,S=t.cornerRadius,E=t.cornerIsExternal,I=S*(i?1:-1)+d,M=Math.asin(S/I)/lS,j=E?f:f+_*M,N=lo(n,o,I,j),G=lo(n,o,d,j),z=E?f-_*M:f,V=lo(n,o,I*Math.cos(M*lS),z);return{center:N,circleTangency:G,lineTangency:V,theta:M}},SH=function(t){var n=t.cx,o=t.cy,d=t.innerRadius,f=t.outerRadius,_=t.startAngle,i=t.endAngle,S=SCe(_,i),E=_+S,I=lo(n,o,f,_),M=lo(n,o,f,E),j="M ".concat(I.x,",").concat(I.y,`
    A `).concat(f,",").concat(f,`,0,
    `).concat(+(Math.abs(S)>180),",").concat(+(_>E),`,
    `).concat(M.x,",").concat(M.y,`
  `);if(d>0){var N=lo(n,o,d,_),G=lo(n,o,d,E);j+="L ".concat(G.x,",").concat(G.y,`
            A `).concat(d,",").concat(d,`,0,
            `).concat(+(Math.abs(S)>180),",").concat(+(_<=E),`,
            `).concat(N.x,",").concat(N.y," Z")}else j+="L ".concat(n,",").concat(o," Z");return j},TCe=function(t){var n=t.cx,o=t.cy,d=t.innerRadius,f=t.outerRadius,_=t.cornerRadius,i=t.forceCornerRadius,S=t.cornerIsExternal,E=t.startAngle,I=t.endAngle,M=ia(I-E),j=U1({cx:n,cy:o,radius:f,angle:E,sign:M,cornerRadius:_,cornerIsExternal:S}),N=j.circleTangency,G=j.lineTangency,z=j.theta,V=U1({cx:n,cy:o,radius:f,angle:I,sign:-M,cornerRadius:_,cornerIsExternal:S}),K=V.circleTangency,Q=V.lineTangency,X=V.theta,ie=S?Math.abs(E-I):Math.abs(E-I)-z-X;if(ie<0)return i?"M ".concat(G.x,",").concat(G.y,`
        a`).concat(_,",").concat(_,",0,0,1,").concat(_*2,`,0
        a`).concat(_,",").concat(_,",0,0,1,").concat(-_*2,`,0
      `):SH({cx:n,cy:o,innerRadius:d,outerRadius:f,startAngle:E,endAngle:I});var J="M ".concat(G.x,",").concat(G.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(N.x,",").concat(N.y,`
    A`).concat(f,",").concat(f,",0,").concat(+(ie>180),",").concat(+(M<0),",").concat(K.x,",").concat(K.y,`
    A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(Q.x,",").concat(Q.y,`
  `);if(d>0){var se=U1({cx:n,cy:o,radius:d,angle:E,sign:M,isExternal:!0,cornerRadius:_,cornerIsExternal:S}),he=se.circleTangency,we=se.lineTangency,ze=se.theta,je=U1({cx:n,cy:o,radius:d,angle:I,sign:-M,isExternal:!0,cornerRadius:_,cornerIsExternal:S}),Oe=je.circleTangency,Be=je.lineTangency,qe=je.theta,Xe=S?Math.abs(E-I):Math.abs(E-I)-ze-qe;if(Xe<0&&_===0)return"".concat(J,"L").concat(n,",").concat(o,"Z");J+="L".concat(Be.x,",").concat(Be.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(Oe.x,",").concat(Oe.y,`
      A`).concat(d,",").concat(d,",0,").concat(+(Xe>180),",").concat(+(M>0),",").concat(he.x,",").concat(he.y,`
      A`).concat(_,",").concat(_,",0,0,").concat(+(M<0),",").concat(we.x,",").concat(we.y,"Z")}else J+="L".concat(n,",").concat(o,"Z");return J},ACe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},TH=function(t){var n=WB(WB({},ACe),t),o=n.cx,d=n.cy,f=n.innerRadius,_=n.outerRadius,i=n.cornerRadius,S=n.forceCornerRadius,E=n.cornerIsExternal,I=n.startAngle,M=n.endAngle,j=n.className;if(_<f||I===M)return null;var N=ni("recharts-sector",j),G=_-f,z=oa(i,G,0,!0),V;return z>0&&Math.abs(I-M)<360?V=TCe({cx:o,cy:d,innerRadius:f,outerRadius:_,cornerRadius:Math.min(z,G/2),forceCornerRadius:S,cornerIsExternal:E,startAngle:I,endAngle:M}):V=SH({cx:o,cy:d,innerRadius:f,outerRadius:_,startAngle:I,endAngle:M}),Le.createElement("path",_I({},Tn(n,!0),{className:N,d:V,role:"img"}))};function j0(e){"@babel/helpers - typeof";return j0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j0(e)}function vI(){return vI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},vI.apply(this,arguments)}function qB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ZB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qB(Object(n),!0).forEach(function(o){ECe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qB(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ECe(e,t,n){return t=PCe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function PCe(e){var t=CCe(e,"string");return j0(t)=="symbol"?t:t+""}function CCe(e,t){if(j0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(j0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KB={curveBasisClosed:Ege,curveBasisOpen:Pge,curveBasis:Age,curveBumpX:dge,curveBumpY:hge,curveLinearClosed:Cge,curveLinear:OT,curveMonotoneX:Ige,curveMonotoneY:Mge,curveNatural:Oge,curveStep:Rge,curveStepAfter:jge,curveStepBefore:kge},G1=function(t){return t.x===+t.x&&t.y===+t.y},jv=function(t){return t.x},Dv=function(t){return t.y},ICe=function(t,n){if(Vn(t))return t;var o="curve".concat(IT(t));return(o==="curveMonotone"||o==="curveBump")&&n?KB["".concat(o).concat(n==="vertical"?"Y":"X")]:KB[o]||OT},MCe=function(t){var n=t.type,o=n===void 0?"linear":n,d=t.points,f=d===void 0?[]:d,_=t.baseLine,i=t.layout,S=t.connectNulls,E=S===void 0?!1:S,I=ICe(o,i),M=E?f.filter(function(z){return G1(z)}):f,j;if(Array.isArray(_)){var N=E?_.filter(function(z){return G1(z)}):_,G=M.map(function(z,V){return ZB(ZB({},z),{},{base:N[V]})});return i==="vertical"?j=j1().y(Dv).x1(jv).x0(function(z){return z.base.x}):j=j1().x(jv).y1(Dv).y0(function(z){return z.base.y}),j.defined(G1).curve(I),j(G)}return i==="vertical"&&vr(_)?j=j1().y(Dv).x1(jv).x0(_):vr(_)?j=j1().x(jv).y1(Dv).y0(_):j=_8().x(jv).y(Dv),j.defined(G1).curve(I),j(M)},uS=function(t){var n=t.className,o=t.points,d=t.path,f=t.pathRef;if((!o||!o.length)&&!d)return null;var _=o&&o.length?MCe(t):d;return B.createElement("path",vI({},Tn(t,!1),jw(t),{className:ni("recharts-curve",n),d:_,ref:f}))},AH={exports:{}},OCe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",RCe=OCe,kCe=RCe;function EH(){}function PH(){}PH.resetWarningCache=EH;var jCe=function(){function e(o,d,f,_,i,S){if(S!==kCe){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:PH,resetWarningCache:EH};return n.PropTypes=n,n};AH.exports=jCe();var DCe=AH.exports;const $i=Ni(DCe);var LCe=Object.getOwnPropertyNames,NCe=Object.getOwnPropertySymbols,zCe=Object.prototype.hasOwnProperty;function XB(e,t){return function(o,d,f){return e(o,d,f)&&t(o,d,f)}}function H1(e){return function(n,o,d){if(!n||!o||typeof n!="object"||typeof o!="object")return e(n,o,d);var f=d.cache,_=f.get(n),i=f.get(o);if(_&&i)return _===o&&i===n;f.set(n,o),f.set(o,n);var S=e(n,o,d);return f.delete(n),f.delete(o),S}}function YB(e){return LCe(e).concat(NCe(e))}var FCe=Object.hasOwn||function(e,t){return zCe.call(e,t)};function np(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var BCe="__v",$Ce="__o",VCe="_owner",JB=Object.getOwnPropertyDescriptor,QB=Object.keys;function UCe(e,t,n){var o=e.length;if(t.length!==o)return!1;for(;o-- >0;)if(!n.equals(e[o],t[o],o,o,e,t,n))return!1;return!0}function GCe(e,t){return np(e.getTime(),t.getTime())}function HCe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function WCe(e,t){return e===t}function e5(e,t,n){var o=e.size;if(o!==t.size)return!1;if(!o)return!0;for(var d=new Array(o),f=e.entries(),_,i,S=0;(_=f.next())&&!_.done;){for(var E=t.entries(),I=!1,M=0;(i=E.next())&&!i.done;){if(d[M]){M++;continue}var j=_.value,N=i.value;if(n.equals(j[0],N[0],S,M,e,t,n)&&n.equals(j[1],N[1],j[0],N[0],e,t,n)){I=d[M]=!0;break}M++}if(!I)return!1;S++}return!0}var qCe=np;function ZCe(e,t,n){var o=QB(e),d=o.length;if(QB(t).length!==d)return!1;for(;d-- >0;)if(!CH(e,t,n,o[d]))return!1;return!0}function Lv(e,t,n){var o=YB(e),d=o.length;if(YB(t).length!==d)return!1;for(var f,_,i;d-- >0;)if(f=o[d],!CH(e,t,n,f)||(_=JB(e,f),i=JB(t,f),(_||i)&&(!_||!i||_.configurable!==i.configurable||_.enumerable!==i.enumerable||_.writable!==i.writable)))return!1;return!0}function KCe(e,t){return np(e.valueOf(),t.valueOf())}function XCe(e,t){return e.source===t.source&&e.flags===t.flags}function t5(e,t,n){var o=e.size;if(o!==t.size)return!1;if(!o)return!0;for(var d=new Array(o),f=e.values(),_,i;(_=f.next())&&!_.done;){for(var S=t.values(),E=!1,I=0;(i=S.next())&&!i.done;){if(!d[I]&&n.equals(_.value,i.value,_.value,i.value,e,t,n)){E=d[I]=!0;break}I++}if(!E)return!1}return!0}function YCe(e,t){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(e[n]!==t[n])return!1;return!0}function JCe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function CH(e,t,n,o){return(o===VCe||o===$Ce||o===BCe)&&(e.$$typeof||t.$$typeof)?!0:FCe(t,o)&&n.equals(e[o],t[o],o,o,e,t,n)}var QCe="[object Arguments]",eIe="[object Boolean]",tIe="[object Date]",rIe="[object Error]",nIe="[object Map]",iIe="[object Number]",oIe="[object Object]",sIe="[object RegExp]",aIe="[object Set]",lIe="[object String]",cIe="[object URL]",uIe=Array.isArray,r5=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,n5=Object.assign,dIe=Object.prototype.toString.call.bind(Object.prototype.toString);function hIe(e){var t=e.areArraysEqual,n=e.areDatesEqual,o=e.areErrorsEqual,d=e.areFunctionsEqual,f=e.areMapsEqual,_=e.areNumbersEqual,i=e.areObjectsEqual,S=e.arePrimitiveWrappersEqual,E=e.areRegExpsEqual,I=e.areSetsEqual,M=e.areTypedArraysEqual,j=e.areUrlsEqual;return function(G,z,V){if(G===z)return!0;if(G==null||z==null)return!1;var K=typeof G;if(K!==typeof z)return!1;if(K!=="object")return K==="number"?_(G,z,V):K==="function"?d(G,z,V):!1;var Q=G.constructor;if(Q!==z.constructor)return!1;if(Q===Object)return i(G,z,V);if(uIe(G))return t(G,z,V);if(r5!=null&&r5(G))return M(G,z,V);if(Q===Date)return n(G,z,V);if(Q===RegExp)return E(G,z,V);if(Q===Map)return f(G,z,V);if(Q===Set)return I(G,z,V);var X=dIe(G);return X===tIe?n(G,z,V):X===sIe?E(G,z,V):X===nIe?f(G,z,V):X===aIe?I(G,z,V):X===oIe?typeof G.then!="function"&&typeof z.then!="function"&&i(G,z,V):X===cIe?j(G,z,V):X===rIe?o(G,z,V):X===QCe?i(G,z,V):X===eIe||X===iIe||X===lIe?S(G,z,V):!1}}function fIe(e){var t=e.circular,n=e.createCustomConfig,o=e.strict,d={areArraysEqual:o?Lv:UCe,areDatesEqual:GCe,areErrorsEqual:HCe,areFunctionsEqual:WCe,areMapsEqual:o?XB(e5,Lv):e5,areNumbersEqual:qCe,areObjectsEqual:o?Lv:ZCe,arePrimitiveWrappersEqual:KCe,areRegExpsEqual:XCe,areSetsEqual:o?XB(t5,Lv):t5,areTypedArraysEqual:o?Lv:YCe,areUrlsEqual:JCe};if(n&&(d=n5({},d,n(d))),t){var f=H1(d.areArraysEqual),_=H1(d.areMapsEqual),i=H1(d.areObjectsEqual),S=H1(d.areSetsEqual);d=n5({},d,{areArraysEqual:f,areMapsEqual:_,areObjectsEqual:i,areSetsEqual:S})}return d}function pIe(e){return function(t,n,o,d,f,_,i){return e(t,n,i)}}function mIe(e){var t=e.circular,n=e.comparator,o=e.createState,d=e.equals,f=e.strict;if(o)return function(S,E){var I=o(),M=I.cache,j=M===void 0?t?new WeakMap:void 0:M,N=I.meta;return n(S,E,{cache:j,equals:d,meta:N,strict:f})};if(t)return function(S,E){return n(S,E,{cache:new WeakMap,equals:d,meta:void 0,strict:f})};var _={cache:void 0,equals:d,meta:void 0,strict:f};return function(S,E){return n(S,E,_)}}var gIe=uh();uh({strict:!0});uh({circular:!0});uh({circular:!0,strict:!0});uh({createInternalComparator:function(){return np}});uh({strict:!0,createInternalComparator:function(){return np}});uh({circular:!0,createInternalComparator:function(){return np}});uh({circular:!0,createInternalComparator:function(){return np},strict:!0});function uh(e){e===void 0&&(e={});var t=e.circular,n=t===void 0?!1:t,o=e.createInternalComparator,d=e.createState,f=e.strict,_=f===void 0?!1:f,i=fIe(e),S=hIe(i),E=o?o(S):pIe(S);return mIe({circular:n,comparator:S,createState:d,equals:E,strict:_})}function yIe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function i5(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=-1,o=function d(f){n<0&&(n=f),f-n>t?(e(f),n=-1):yIe(d)};requestAnimationFrame(o)}function xI(e){"@babel/helpers - typeof";return xI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xI(e)}function _Ie(e){return wIe(e)||bIe(e)||xIe(e)||vIe()}function vIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xIe(e,t){if(e){if(typeof e=="string")return o5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o5(e,t)}}function o5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function bIe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function wIe(e){if(Array.isArray(e))return e}function SIe(){var e={},t=function(){return null},n=!1,o=function d(f){if(!n){if(Array.isArray(f)){if(!f.length)return;var _=f,i=_Ie(_),S=i[0],E=i.slice(1);if(typeof S=="number"){i5(d.bind(null,E),S);return}d(S),i5(d.bind(null,E));return}xI(f)==="object"&&(e=f,t(e)),typeof f=="function"&&f()}};return{stop:function(){n=!0},start:function(f){n=!1,o(f)},subscribe:function(f){return t=f,function(){t=function(){return null}}}}}function D0(e){"@babel/helpers - typeof";return D0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D0(e)}function s5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function a5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?s5(Object(n),!0).forEach(function(o){IH(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function IH(e,t,n){return t=TIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TIe(e){var t=AIe(e,"string");return D0(t)==="symbol"?t:String(t)}function AIe(e,t){if(D0(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(D0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var EIe=function(t,n){return[Object.keys(t),Object.keys(n)].reduce(function(o,d){return o.filter(function(f){return d.includes(f)})})},PIe=function(t){return t},CIe=function(t){return t.replace(/([A-Z])/g,function(n){return"-".concat(n.toLowerCase())})},Jv=function(t,n){return Object.keys(n).reduce(function(o,d){return a5(a5({},o),{},IH({},d,t(d,n[d])))},{})},l5=function(t,n,o){return t.map(function(d){return"".concat(CIe(d)," ").concat(n,"ms ").concat(o)}).join(",")};function IIe(e,t){return RIe(e)||OIe(e,t)||MH(e,t)||MIe()}function MIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OIe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function RIe(e){if(Array.isArray(e))return e}function kIe(e){return LIe(e)||DIe(e)||MH(e)||jIe()}function jIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MH(e,t){if(e){if(typeof e=="string")return bI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bI(e,t)}}function DIe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function LIe(e){if(Array.isArray(e))return bI(e)}function bI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var dS=1e-4,OH=function(t,n){return[0,3*t,3*n-6*t,3*t-3*n+1]},RH=function(t,n){return t.map(function(o,d){return o*Math.pow(n,d)}).reduce(function(o,d){return o+d})},c5=function(t,n){return function(o){var d=OH(t,n);return RH(d,o)}},NIe=function(t,n){return function(o){var d=OH(t,n),f=[].concat(kIe(d.map(function(_,i){return _*i}).slice(1)),[0]);return RH(f,o)}},u5=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var d=n[0],f=n[1],_=n[2],i=n[3];if(n.length===1)switch(n[0]){case"linear":d=0,f=0,_=1,i=1;break;case"ease":d=.25,f=.1,_=.25,i=1;break;case"ease-in":d=.42,f=0,_=1,i=1;break;case"ease-out":d=.42,f=0,_=.58,i=1;break;case"ease-in-out":d=0,f=0,_=.58,i=1;break;default:{var S=n[0].split("(");if(S[0]==="cubic-bezier"&&S[1].split(")")[0].split(",").length===4){var E=S[1].split(")")[0].split(",").map(function(V){return parseFloat(V)}),I=IIe(E,4);d=I[0],f=I[1],_=I[2],i=I[3]}}}var M=c5(d,_),j=c5(f,i),N=NIe(d,_),G=function(K){return K>1?1:K<0?0:K},z=function(K){for(var Q=K>1?1:K,X=Q,ie=0;ie<8;++ie){var J=M(X)-Q,se=N(X);if(Math.abs(J-Q)<dS||se<dS)return j(X);X=G(X-J/se)}return j(X)};return z.isStepper=!1,z},zIe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=t.stiff,o=n===void 0?100:n,d=t.damping,f=d===void 0?8:d,_=t.dt,i=_===void 0?17:_,S=function(I,M,j){var N=-(I-M)*o,G=j*f,z=j+(N-G)*i/1e3,V=j*i/1e3+I;return Math.abs(V-M)<dS&&Math.abs(z)<dS?[M,0]:[V,z]};return S.isStepper=!0,S.dt=i,S},FIe=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var d=n[0];if(typeof d=="string")switch(d){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return u5(d);case"spring":return zIe();default:if(d.split("(")[0]==="cubic-bezier")return u5(d)}return typeof d=="function"?d:null};function L0(e){"@babel/helpers - typeof";return L0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L0(e)}function d5(e){return VIe(e)||$Ie(e)||kH(e)||BIe()}function BIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Ie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function VIe(e){if(Array.isArray(e))return SI(e)}function h5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Ds(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?h5(Object(n),!0).forEach(function(o){wI(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function wI(e,t,n){return t=UIe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function UIe(e){var t=GIe(e,"string");return L0(t)==="symbol"?t:String(t)}function GIe(e,t){if(L0(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(L0(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HIe(e,t){return ZIe(e)||qIe(e,t)||kH(e,t)||WIe()}function WIe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kH(e,t){if(e){if(typeof e=="string")return SI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return SI(e,t)}}function SI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function qIe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function ZIe(e){if(Array.isArray(e))return e}var hS=function(t,n,o){return t+(n-t)*o},TI=function(t){var n=t.from,o=t.to;return n!==o},KIe=function e(t,n,o){var d=Jv(function(f,_){if(TI(_)){var i=t(_.from,_.to,_.velocity),S=HIe(i,2),E=S[0],I=S[1];return Ds(Ds({},_),{},{from:E,velocity:I})}return _},n);return o<1?Jv(function(f,_){return TI(_)?Ds(Ds({},_),{},{velocity:hS(_.velocity,d[f].velocity,o),from:hS(_.from,d[f].from,o)}):_},n):e(t,d,o-1)};const XIe=function(e,t,n,o,d){var f=EIe(e,t),_=f.reduce(function(V,K){return Ds(Ds({},V),{},wI({},K,[e[K],t[K]]))},{}),i=f.reduce(function(V,K){return Ds(Ds({},V),{},wI({},K,{from:e[K],velocity:0,to:t[K]}))},{}),S=-1,E,I,M=function(){return null},j=function(){return Jv(function(K,Q){return Q.from},i)},N=function(){return!Object.values(i).filter(TI).length},G=function(K){E||(E=K);var Q=K-E,X=Q/n.dt;i=KIe(n,i,X),d(Ds(Ds(Ds({},e),t),j())),E=K,N()||(S=requestAnimationFrame(M))},z=function(K){I||(I=K);var Q=(K-I)/o,X=Jv(function(J,se){return hS.apply(void 0,d5(se).concat([n(Q)]))},_);if(d(Ds(Ds(Ds({},e),t),X)),Q<1)S=requestAnimationFrame(M);else{var ie=Jv(function(J,se){return hS.apply(void 0,d5(se).concat([n(1)]))},_);d(Ds(Ds(Ds({},e),t),ie))}};return M=n.isStepper?G:z,function(){return requestAnimationFrame(M),function(){cancelAnimationFrame(S)}}};function Ng(e){"@babel/helpers - typeof";return Ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ng(e)}var YIe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function JIe(e,t){if(e==null)return{};var n=QIe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function QIe(e,t){if(e==null)return{};var n={},o=Object.keys(e),d,f;for(f=0;f<o.length;f++)d=o[f],!(t.indexOf(d)>=0)&&(n[d]=e[d]);return n}function bP(e){return nMe(e)||rMe(e)||tMe(e)||eMe()}function eMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tMe(e,t){if(e){if(typeof e=="string")return AI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return AI(e,t)}}function rMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nMe(e){if(Array.isArray(e))return AI(e)}function AI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ec(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(n),!0).forEach(function(o){Bv(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Bv(e,t,n){return t=jH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iMe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oMe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,jH(o.key),o)}}function sMe(e,t,n){return t&&oMe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jH(e){var t=aMe(e,"string");return Ng(t)==="symbol"?t:String(t)}function aMe(e,t){if(Ng(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Ng(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lMe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&EI(e,t)}function EI(e,t){return EI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},EI(e,t)}function cMe(e){var t=uMe();return function(){var o=fS(e),d;if(t){var f=fS(this).constructor;d=Reflect.construct(o,arguments,f)}else d=o.apply(this,arguments);return PI(this,d)}}function PI(e,t){if(t&&(Ng(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CI(e)}function CI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function fS(e){return fS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fS(e)}var nu=function(e){lMe(n,e);var t=cMe(n);function n(o,d){var f;iMe(this,n),f=t.call(this,o,d);var _=f.props,i=_.isActive,S=_.attributeName,E=_.from,I=_.to,M=_.steps,j=_.children,N=_.duration;if(f.handleStyleChange=f.handleStyleChange.bind(CI(f)),f.changeStyle=f.changeStyle.bind(CI(f)),!i||N<=0)return f.state={style:{}},typeof j=="function"&&(f.state={style:I}),PI(f);if(M&&M.length)f.state={style:M[0].style};else if(E){if(typeof j=="function")return f.state={style:E},PI(f);f.state={style:S?Bv({},S,E):E}}else f.state={style:{}};return f}return sMe(n,[{key:"componentDidMount",value:function(){var d=this.props,f=d.isActive,_=d.canBegin;this.mounted=!0,!(!f||!_)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(d){var f=this.props,_=f.isActive,i=f.canBegin,S=f.attributeName,E=f.shouldReAnimate,I=f.to,M=f.from,j=this.state.style;if(i){if(!_){var N={style:S?Bv({},S,I):I};this.state&&j&&(S&&j[S]!==I||!S&&j!==I)&&this.setState(N);return}if(!(gIe(d.to,I)&&d.canBegin&&d.isActive)){var G=!d.canBegin||!d.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var z=G||E?M:d.to;if(this.state&&j){var V={style:S?Bv({},S,z):z};(S&&j[S]!==z||!S&&j!==z)&&this.setState(V)}this.runAnimation(ec(ec({},this.props),{},{from:z,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var d=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),d&&d()}},{key:"handleStyleChange",value:function(d){this.changeStyle(d)}},{key:"changeStyle",value:function(d){this.mounted&&this.setState({style:d})}},{key:"runJSAnimation",value:function(d){var f=this,_=d.from,i=d.to,S=d.duration,E=d.easing,I=d.begin,M=d.onAnimationEnd,j=d.onAnimationStart,N=XIe(_,i,FIe(E),S,this.changeStyle),G=function(){f.stopJSAnimation=N()};this.manager.start([j,I,G,S,M])}},{key:"runStepAnimation",value:function(d){var f=this,_=d.steps,i=d.begin,S=d.onAnimationStart,E=_[0],I=E.style,M=E.duration,j=M===void 0?0:M,N=function(z,V,K){if(K===0)return z;var Q=V.duration,X=V.easing,ie=X===void 0?"ease":X,J=V.style,se=V.properties,he=V.onAnimationEnd,we=K>0?_[K-1]:V,ze=se||Object.keys(J);if(typeof ie=="function"||ie==="spring")return[].concat(bP(z),[f.runJSAnimation.bind(f,{from:we.style,to:J,duration:Q,easing:ie}),Q]);var je=l5(ze,Q,ie),Oe=ec(ec(ec({},we.style),J),{},{transition:je});return[].concat(bP(z),[Oe,Q,he]).filter(PIe)};return this.manager.start([S].concat(bP(_.reduce(N,[I,Math.max(j,i)])),[d.onAnimationEnd]))}},{key:"runAnimation",value:function(d){this.manager||(this.manager=SIe());var f=d.begin,_=d.duration,i=d.attributeName,S=d.to,E=d.easing,I=d.onAnimationStart,M=d.onAnimationEnd,j=d.steps,N=d.children,G=this.manager;if(this.unSubscribe=G.subscribe(this.handleStyleChange),typeof E=="function"||typeof N=="function"||E==="spring"){this.runJSAnimation(d);return}if(j.length>1){this.runStepAnimation(d);return}var z=i?Bv({},i,S):S,V=l5(Object.keys(z),_,E);G.start([I,f,ec(ec({},z),{},{transition:V}),_,M])}},{key:"render",value:function(){var d=this.props,f=d.children;d.begin;var _=d.duration;d.attributeName,d.easing;var i=d.isActive;d.steps,d.from,d.to,d.canBegin,d.onAnimationEnd,d.shouldReAnimate,d.onAnimationReStart;var S=JIe(d,YIe),E=B.Children.count(f),I=this.state.style;if(typeof f=="function")return f(I);if(!i||E===0||_<=0)return f;var M=function(N){var G=N.props,z=G.style,V=z===void 0?{}:z,K=G.className,Q=B.cloneElement(N,ec(ec({},S),{},{style:ec(ec({},V),I),className:K}));return Q};return E===1?M(B.Children.only(f)):Le.createElement("div",null,B.Children.map(f,function(j){return M(j)}))}}]),n}(B.PureComponent);nu.displayName="Animate";nu.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};nu.propTypes={from:$i.oneOfType([$i.object,$i.string]),to:$i.oneOfType([$i.object,$i.string]),attributeName:$i.string,duration:$i.number,begin:$i.number,easing:$i.oneOfType([$i.string,$i.func]),steps:$i.arrayOf($i.shape({duration:$i.number.isRequired,style:$i.object.isRequired,easing:$i.oneOfType([$i.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),$i.func]),properties:$i.arrayOf("string"),onAnimationEnd:$i.func})),children:$i.oneOfType([$i.node,$i.func]),isActive:$i.bool,canBegin:$i.bool,onAnimationEnd:$i.func,shouldReAnimate:$i.bool,onAnimationStart:$i.func,onAnimationReStart:$i.func};function N0(e){"@babel/helpers - typeof";return N0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N0(e)}function pS(){return pS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},pS.apply(this,arguments)}function dMe(e,t){return mMe(e)||pMe(e,t)||fMe(e,t)||hMe()}function hMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fMe(e,t){if(e){if(typeof e=="string")return p5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p5(e,t)}}function p5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function pMe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function mMe(e){if(Array.isArray(e))return e}function m5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function g5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(n),!0).forEach(function(o){gMe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function gMe(e,t,n){return t=yMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yMe(e){var t=_Me(e,"string");return N0(t)=="symbol"?t:t+""}function _Me(e,t){if(N0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(N0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var y5=function(t,n,o,d,f){var _=Math.min(Math.abs(o)/2,Math.abs(d)/2),i=d>=0?1:-1,S=o>=0?1:-1,E=d>=0&&o>=0||d<0&&o<0?1:0,I;if(_>0&&f instanceof Array){for(var M=[0,0,0,0],j=0,N=4;j<N;j++)M[j]=f[j]>_?_:f[j];I="M".concat(t,",").concat(n+i*M[0]),M[0]>0&&(I+="A ".concat(M[0],",").concat(M[0],",0,0,").concat(E,",").concat(t+S*M[0],",").concat(n)),I+="L ".concat(t+o-S*M[1],",").concat(n),M[1]>0&&(I+="A ".concat(M[1],",").concat(M[1],",0,0,").concat(E,`,
        `).concat(t+o,",").concat(n+i*M[1])),I+="L ".concat(t+o,",").concat(n+d-i*M[2]),M[2]>0&&(I+="A ".concat(M[2],",").concat(M[2],",0,0,").concat(E,`,
        `).concat(t+o-S*M[2],",").concat(n+d)),I+="L ".concat(t+S*M[3],",").concat(n+d),M[3]>0&&(I+="A ".concat(M[3],",").concat(M[3],",0,0,").concat(E,`,
        `).concat(t,",").concat(n+d-i*M[3])),I+="Z"}else if(_>0&&f===+f&&f>0){var G=Math.min(_,f);I="M ".concat(t,",").concat(n+i*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(E,",").concat(t+S*G,",").concat(n,`
            L `).concat(t+o-S*G,",").concat(n,`
            A `).concat(G,",").concat(G,",0,0,").concat(E,",").concat(t+o,",").concat(n+i*G,`
            L `).concat(t+o,",").concat(n+d-i*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(E,",").concat(t+o-S*G,",").concat(n+d,`
            L `).concat(t+S*G,",").concat(n+d,`
            A `).concat(G,",").concat(G,",0,0,").concat(E,",").concat(t,",").concat(n+d-i*G," Z")}else I="M ".concat(t,",").concat(n," h ").concat(o," v ").concat(d," h ").concat(-o," Z");return I},vMe=function(t,n){if(!t||!n)return!1;var o=t.x,d=t.y,f=n.x,_=n.y,i=n.width,S=n.height;if(Math.abs(i)>0&&Math.abs(S)>0){var E=Math.min(f,f+i),I=Math.max(f,f+i),M=Math.min(_,_+S),j=Math.max(_,_+S);return o>=E&&o<=I&&d>=M&&d<=j}return!1},xMe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},PR=function(t){var n=g5(g5({},xMe),t),o=B.useRef(),d=B.useState(-1),f=dMe(d,2),_=f[0],i=f[1];B.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var ie=o.current.getTotalLength();ie&&i(ie)}catch{}},[]);var S=n.x,E=n.y,I=n.width,M=n.height,j=n.radius,N=n.className,G=n.animationEasing,z=n.animationDuration,V=n.animationBegin,K=n.isAnimationActive,Q=n.isUpdateAnimationActive;if(S!==+S||E!==+E||I!==+I||M!==+M||I===0||M===0)return null;var X=ni("recharts-rectangle",N);return Q?Le.createElement(nu,{canBegin:_>0,from:{width:I,height:M,x:S,y:E},to:{width:I,height:M,x:S,y:E},duration:z,animationEasing:G,isActive:Q},function(ie){var J=ie.width,se=ie.height,he=ie.x,we=ie.y;return Le.createElement(nu,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:V,duration:z,isActive:K,easing:G},Le.createElement("path",pS({},Tn(n,!0),{className:X,d:y5(he,we,J,se,j),ref:o})))}):Le.createElement("path",pS({},Tn(n,!0),{className:X,d:y5(S,E,I,M,j)}))},bMe=["points","className","baseLinePoints","connectNulls"];function ag(){return ag=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ag.apply(this,arguments)}function wMe(e,t){if(e==null)return{};var n=SMe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function SMe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function _5(e){return PMe(e)||EMe(e)||AMe(e)||TMe()}function TMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AMe(e,t){if(e){if(typeof e=="string")return II(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return II(e,t)}}function EMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function PMe(e){if(Array.isArray(e))return II(e)}function II(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var v5=function(t){return t&&t.x===+t.x&&t.y===+t.y},CMe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=[[]];return t.forEach(function(o){v5(o)?n[n.length-1].push(o):n[n.length-1].length>0&&n.push([])}),v5(t[0])&&n[n.length-1].push(t[0]),n[n.length-1].length<=0&&(n=n.slice(0,-1)),n},Qv=function(t,n){var o=CMe(t);n&&(o=[o.reduce(function(f,_){return[].concat(_5(f),_5(_))},[])]);var d=o.map(function(f){return f.reduce(function(_,i,S){return"".concat(_).concat(S===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return o.length===1?"".concat(d,"Z"):d},IMe=function(t,n,o){var d=Qv(t,o);return"".concat(d.slice(-1)==="Z"?d.slice(0,-1):d,"L").concat(Qv(n.reverse(),o).slice(1))},MMe=function(t){var n=t.points,o=t.className,d=t.baseLinePoints,f=t.connectNulls,_=wMe(t,bMe);if(!n||!n.length)return null;var i=ni("recharts-polygon",o);if(d&&d.length){var S=_.stroke&&_.stroke!=="none",E=IMe(n,d,f);return Le.createElement("g",{className:i},Le.createElement("path",ag({},Tn(_,!0),{fill:E.slice(-1)==="Z"?_.fill:"none",stroke:"none",d:E})),S?Le.createElement("path",ag({},Tn(_,!0),{fill:"none",d:Qv(n,f)})):null,S?Le.createElement("path",ag({},Tn(_,!0),{fill:"none",d:Qv(d,f)})):null)}var I=Qv(n,f);return Le.createElement("path",ag({},Tn(_,!0),{fill:I.slice(-1)==="Z"?_.fill:"none",className:i,d:I}))};function MI(){return MI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},MI.apply(this,arguments)}var qT=function(t){var n=t.cx,o=t.cy,d=t.r,f=t.className,_=ni("recharts-dot",f);return n===+n&&o===+o&&d===+d?B.createElement("circle",MI({},Tn(t,!1),jw(t),{className:_,cx:n,cy:o,r:d})):null};function z0(e){"@babel/helpers - typeof";return z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z0(e)}var OMe=["x","y","top","left","width","height","className"];function OI(){return OI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},OI.apply(this,arguments)}function x5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function RMe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?x5(Object(n),!0).forEach(function(o){kMe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function kMe(e,t,n){return t=jMe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jMe(e){var t=DMe(e,"string");return z0(t)=="symbol"?t:t+""}function DMe(e,t){if(z0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(z0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LMe(e,t){if(e==null)return{};var n=NMe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function NMe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}var zMe=function(t,n,o,d,f,_){return"M".concat(t,",").concat(f,"v").concat(d,"M").concat(_,",").concat(n,"h").concat(o)},FMe=function(t){var n=t.x,o=n===void 0?0:n,d=t.y,f=d===void 0?0:d,_=t.top,i=_===void 0?0:_,S=t.left,E=S===void 0?0:S,I=t.width,M=I===void 0?0:I,j=t.height,N=j===void 0?0:j,G=t.className,z=LMe(t,OMe),V=RMe({x:o,y:f,top:i,left:E,width:M,height:N},z);return!vr(o)||!vr(f)||!vr(M)||!vr(N)||!vr(i)||!vr(E)?null:Le.createElement("path",OI({},Tn(V,!0),{className:ni("recharts-cross",G),d:zMe(o,f,M,N,i,E)}))},BMe=VT,$Me=WG,VMe=su;function UMe(e,t){return e&&e.length?BMe(e,VMe(t),$Me):void 0}var GMe=UMe;const HMe=Ni(GMe);var WMe=VT,qMe=su,ZMe=qG;function KMe(e,t){return e&&e.length?WMe(e,qMe(t),ZMe):void 0}var XMe=KMe;const YMe=Ni(XMe);var JMe=["cx","cy","angle","ticks","axisLine"],QMe=["ticks","tick","angle","tickFormatter","stroke"];function zg(e){"@babel/helpers - typeof";return zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zg(e)}function e0(){return e0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},e0.apply(this,arguments)}function b5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function hf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?b5(Object(n),!0).forEach(function(o){ZT(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function w5(e,t){if(e==null)return{};var n=eOe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function eOe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function tOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,LH(o.key),o)}}function rOe(e,t,n){return t&&S5(e.prototype,t),n&&S5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function nOe(e,t,n){return t=mS(t),iOe(e,DH()?Reflect.construct(t,n||[],mS(e).constructor):t.apply(e,n))}function iOe(e,t){if(t&&(zg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oOe(e)}function oOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(DH=function(){return!!e})()}function mS(e){return mS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},mS(e)}function sOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&RI(e,t)}function RI(e,t){return RI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},RI(e,t)}function ZT(e,t,n){return t=LH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LH(e){var t=aOe(e,"string");return zg(t)=="symbol"?t:t+""}function aOe(e,t){if(zg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(zg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var KT=function(e){function t(){return tOe(this,t),nOe(this,t,arguments)}return sOe(t,e),rOe(t,[{key:"getTickValueCoord",value:function(o){var d=o.coordinate,f=this.props,_=f.angle,i=f.cx,S=f.cy;return lo(i,S,d,_)}},{key:"getTickTextAnchor",value:function(){var o=this.props.orientation,d;switch(o){case"left":d="end";break;case"right":d="start";break;default:d="middle";break}return d}},{key:"getViewBox",value:function(){var o=this.props,d=o.cx,f=o.cy,_=o.angle,i=o.ticks,S=HMe(i,function(I){return I.coordinate||0}),E=YMe(i,function(I){return I.coordinate||0});return{cx:d,cy:f,startAngle:_,endAngle:_,innerRadius:E.coordinate||0,outerRadius:S.coordinate||0}}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.cx,f=o.cy,_=o.angle,i=o.ticks,S=o.axisLine,E=w5(o,JMe),I=i.reduce(function(G,z){return[Math.min(G[0],z.coordinate),Math.max(G[1],z.coordinate)]},[1/0,-1/0]),M=lo(d,f,I[0],_),j=lo(d,f,I[1],_),N=hf(hf(hf({},Tn(E,!1)),{},{fill:"none"},Tn(S,!1)),{},{x1:M.x,y1:M.y,x2:j.x,y2:j.y});return Le.createElement("line",e0({className:"recharts-polar-radius-axis-line"},N))}},{key:"renderTicks",value:function(){var o=this,d=this.props,f=d.ticks,_=d.tick,i=d.angle,S=d.tickFormatter,E=d.stroke,I=w5(d,QMe),M=this.getTickTextAnchor(),j=Tn(I,!1),N=Tn(_,!1),G=f.map(function(z,V){var K=o.getTickValueCoord(z),Q=hf(hf(hf(hf({textAnchor:M,transform:"rotate(".concat(90-i,", ").concat(K.x,", ").concat(K.y,")")},j),{},{stroke:"none",fill:E},N),{},{index:V},K),{},{payload:z});return Le.createElement(Di,e0({className:ni("recharts-polar-radius-axis-tick",bH(_)),key:"tick-".concat(z.coordinate)},Vf(o.props,z,V)),t.renderTickItem(_,Q,S?S(z.value,V):z.value))});return Le.createElement(Di,{className:"recharts-polar-radius-axis-ticks"},G)}},{key:"render",value:function(){var o=this.props,d=o.ticks,f=o.axisLine,_=o.tick;return!d||!d.length?null:Le.createElement(Di,{className:ni("recharts-polar-radius-axis",this.props.className)},f&&this.renderAxisLine(),_&&this.renderTicks(),Es.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(o,d,f){var _;return Le.isValidElement(o)?_=Le.cloneElement(o,d):Vn(o)?_=o(d):_=Le.createElement(Uf,e0({},d,{className:"recharts-polar-radius-axis-tick-value"}),f),_}}])}(B.PureComponent);ZT(KT,"displayName","PolarRadiusAxis");ZT(KT,"axisType","radiusAxis");ZT(KT,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Fg(e){"@babel/helpers - typeof";return Fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fg(e)}function vf(){return vf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},vf.apply(this,arguments)}function T5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ff(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T5(Object(n),!0).forEach(function(o){XT(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function lOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,zH(o.key),o)}}function cOe(e,t,n){return t&&A5(e.prototype,t),n&&A5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function uOe(e,t,n){return t=gS(t),dOe(e,NH()?Reflect.construct(t,n||[],gS(e).constructor):t.apply(e,n))}function dOe(e,t){if(t&&(Fg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hOe(e)}function hOe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NH=function(){return!!e})()}function gS(e){return gS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},gS(e)}function fOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kI(e,t)}function kI(e,t){return kI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},kI(e,t)}function XT(e,t,n){return t=zH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zH(e){var t=pOe(e,"string");return Fg(t)=="symbol"?t:t+""}function pOe(e,t){if(Fg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Fg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mOe=Math.PI/180,E5=1e-5,YT=function(e){function t(){return lOe(this,t),uOe(this,t,arguments)}return fOe(t,e),cOe(t,[{key:"getTickLineCoord",value:function(o){var d=this.props,f=d.cx,_=d.cy,i=d.radius,S=d.orientation,E=d.tickSize,I=E||8,M=lo(f,_,i,o.coordinate),j=lo(f,_,i+(S==="inner"?-1:1)*I,o.coordinate);return{x1:M.x,y1:M.y,x2:j.x,y2:j.y}}},{key:"getTickTextAnchor",value:function(o){var d=this.props.orientation,f=Math.cos(-o.coordinate*mOe),_;return f>E5?_=d==="outer"?"start":"end":f<-E5?_=d==="outer"?"end":"start":_="middle",_}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.cx,f=o.cy,_=o.radius,i=o.axisLine,S=o.axisLineType,E=ff(ff({},Tn(this.props,!1)),{},{fill:"none"},Tn(i,!1));if(S==="circle")return Le.createElement(qT,vf({className:"recharts-polar-angle-axis-line"},E,{cx:d,cy:f,r:_}));var I=this.props.ticks,M=I.map(function(j){return lo(d,f,_,j.coordinate)});return Le.createElement(MMe,vf({className:"recharts-polar-angle-axis-line"},E,{points:M}))}},{key:"renderTicks",value:function(){var o=this,d=this.props,f=d.ticks,_=d.tick,i=d.tickLine,S=d.tickFormatter,E=d.stroke,I=Tn(this.props,!1),M=Tn(_,!1),j=ff(ff({},I),{},{fill:"none"},Tn(i,!1)),N=f.map(function(G,z){var V=o.getTickLineCoord(G),K=o.getTickTextAnchor(G),Q=ff(ff(ff({textAnchor:K},I),{},{stroke:"none",fill:E},M),{},{index:z,payload:G,x:V.x2,y:V.y2});return Le.createElement(Di,vf({className:ni("recharts-polar-angle-axis-tick",bH(_)),key:"tick-".concat(G.coordinate)},Vf(o.props,G,z)),i&&Le.createElement("line",vf({className:"recharts-polar-angle-axis-tick-line"},j,V)),_&&t.renderTickItem(_,Q,S?S(G.value,z):G.value))});return Le.createElement(Di,{className:"recharts-polar-angle-axis-ticks"},N)}},{key:"render",value:function(){var o=this.props,d=o.ticks,f=o.radius,_=o.axisLine;return f<=0||!d||!d.length?null:Le.createElement(Di,{className:ni("recharts-polar-angle-axis",this.props.className)},_&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(o,d,f){var _;return Le.isValidElement(o)?_=Le.cloneElement(o,d):Vn(o)?_=o(d):_=Le.createElement(Uf,vf({},d,{className:"recharts-polar-angle-axis-tick-value"}),f),_}}])}(B.PureComponent);XT(YT,"displayName","PolarAngleAxis");XT(YT,"axisType","angleAxis");XT(YT,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var gOe=V8,yOe=gOe(Object.getPrototypeOf,Object),_Oe=yOe,vOe=ed,xOe=_Oe,bOe=td,wOe="[object Object]",SOe=Function.prototype,TOe=Object.prototype,FH=SOe.toString,AOe=TOe.hasOwnProperty,EOe=FH.call(Object);function POe(e){if(!bOe(e)||vOe(e)!=wOe)return!1;var t=xOe(e);if(t===null)return!0;var n=AOe.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&FH.call(n)==EOe}var COe=POe;const IOe=Ni(COe);var MOe=ed,OOe=td,ROe="[object Boolean]";function kOe(e){return e===!0||e===!1||OOe(e)&&MOe(e)==ROe}var jOe=kOe;const DOe=Ni(jOe);function F0(e){"@babel/helpers - typeof";return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F0(e)}function yS(){return yS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},yS.apply(this,arguments)}function LOe(e,t){return BOe(e)||FOe(e,t)||zOe(e,t)||NOe()}function NOe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zOe(e,t){if(e){if(typeof e=="string")return P5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P5(e,t)}}function P5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function FOe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function BOe(e){if(Array.isArray(e))return e}function C5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function I5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C5(Object(n),!0).forEach(function(o){$Oe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function $Oe(e,t,n){return t=VOe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function VOe(e){var t=UOe(e,"string");return F0(t)=="symbol"?t:t+""}function UOe(e,t){if(F0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(F0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var M5=function(t,n,o,d,f){var _=o-d,i;return i="M ".concat(t,",").concat(n),i+="L ".concat(t+o,",").concat(n),i+="L ".concat(t+o-_/2,",").concat(n+f),i+="L ".concat(t+o-_/2-d,",").concat(n+f),i+="L ".concat(t,",").concat(n," Z"),i},GOe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},HOe=function(t){var n=I5(I5({},GOe),t),o=B.useRef(),d=B.useState(-1),f=LOe(d,2),_=f[0],i=f[1];B.useEffect(function(){if(o.current&&o.current.getTotalLength)try{var X=o.current.getTotalLength();X&&i(X)}catch{}},[]);var S=n.x,E=n.y,I=n.upperWidth,M=n.lowerWidth,j=n.height,N=n.className,G=n.animationEasing,z=n.animationDuration,V=n.animationBegin,K=n.isUpdateAnimationActive;if(S!==+S||E!==+E||I!==+I||M!==+M||j!==+j||I===0&&M===0||j===0)return null;var Q=ni("recharts-trapezoid",N);return K?Le.createElement(nu,{canBegin:_>0,from:{upperWidth:0,lowerWidth:0,height:j,x:S,y:E},to:{upperWidth:I,lowerWidth:M,height:j,x:S,y:E},duration:z,animationEasing:G,isActive:K},function(X){var ie=X.upperWidth,J=X.lowerWidth,se=X.height,he=X.x,we=X.y;return Le.createElement(nu,{canBegin:_>0,from:"0px ".concat(_===-1?1:_,"px"),to:"".concat(_,"px 0px"),attributeName:"strokeDasharray",begin:V,duration:z,easing:G},Le.createElement("path",yS({},Tn(n,!0),{className:Q,d:M5(he,we,ie,J,se),ref:o})))}):Le.createElement("g",null,Le.createElement("path",yS({},Tn(n,!0),{className:Q,d:M5(S,E,I,M,j)})))},WOe=["option","shapeType","propTransformer","activeClassName","isActive"];function B0(e){"@babel/helpers - typeof";return B0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B0(e)}function qOe(e,t){if(e==null)return{};var n=ZOe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function ZOe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function O5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function _S(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O5(Object(n),!0).forEach(function(o){KOe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function KOe(e,t,n){return t=XOe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XOe(e){var t=YOe(e,"string");return B0(t)=="symbol"?t:t+""}function YOe(e,t){if(B0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(B0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JOe(e,t){return _S(_S({},t),e)}function QOe(e,t){return e==="symbols"}function R5(e){var t=e.shapeType,n=e.elementProps;switch(t){case"rectangle":return Le.createElement(PR,n);case"trapezoid":return Le.createElement(HOe,n);case"sector":return Le.createElement(TH,n);case"symbols":if(QOe(t))return Le.createElement(HO,n);break;default:return null}}function eRe(e){return B.isValidElement(e)?e.props:e}function BH(e){var t=e.option,n=e.shapeType,o=e.propTransformer,d=o===void 0?JOe:o,f=e.activeClassName,_=f===void 0?"recharts-active-shape":f,i=e.isActive,S=qOe(e,WOe),E;if(B.isValidElement(t))E=B.cloneElement(t,_S(_S({},S),eRe(t)));else if(Vn(t))E=t(S);else if(IOe(t)&&!DOe(t)){var I=d(t,S);E=Le.createElement(R5,{shapeType:n,elementProps:I})}else{var M=S;E=Le.createElement(R5,{shapeType:n,elementProps:M})}return i?Le.createElement(Di,{className:_},E):E}function JT(e,t){return t!=null&&"trapezoids"in e.props}function QT(e,t){return t!=null&&"sectors"in e.props}function $0(e,t){return t!=null&&"points"in e.props}function tRe(e,t){var n,o,d=e.x===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.x)||e.x===t.x,f=e.y===(t==null||(o=t.labelViewBox)===null||o===void 0?void 0:o.y)||e.y===t.y;return d&&f}function rRe(e,t){var n=e.endAngle===t.endAngle,o=e.startAngle===t.startAngle;return n&&o}function nRe(e,t){var n=e.x===t.x,o=e.y===t.y,d=e.z===t.z;return n&&o&&d}function iRe(e,t){var n;return JT(e,t)?n=tRe:QT(e,t)?n=rRe:$0(e,t)&&(n=nRe),n}function oRe(e,t){var n;return JT(e,t)?n="trapezoids":QT(e,t)?n="sectors":$0(e,t)&&(n="points"),n}function sRe(e,t){if(JT(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}if(QT(e,t)){var o;return(o=t.tooltipPayload)===null||o===void 0||(o=o[0])===null||o===void 0||(o=o.payload)===null||o===void 0?void 0:o.payload}return $0(e,t)?t.payload:{}}function aRe(e){var t=e.activeTooltipItem,n=e.graphicalItem,o=e.itemData,d=oRe(n,t),f=sRe(n,t),_=o.filter(function(S,E){var I=gx(f,S),M=n.props[d].filter(function(G){var z=iRe(n,t);return z(G,t)}),j=n.props[d].indexOf(M[M.length-1]),N=E===j;return I&&N}),i=o.indexOf(_[_.length-1]);return i}var uw;function Bg(e){"@babel/helpers - typeof";return Bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bg(e)}function lg(){return lg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},lg.apply(this,arguments)}function k5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function so(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k5(Object(n),!0).forEach(function(o){vl(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function lRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,VH(o.key),o)}}function cRe(e,t,n){return t&&j5(e.prototype,t),n&&j5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function uRe(e,t,n){return t=vS(t),dRe(e,$H()?Reflect.construct(t,n||[],vS(e).constructor):t.apply(e,n))}function dRe(e,t){if(t&&(Bg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hRe(e)}function hRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($H=function(){return!!e})()}function vS(e){return vS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},vS(e)}function fRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jI(e,t)}function jI(e,t){return jI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},jI(e,t)}function vl(e,t,n){return t=VH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function VH(e){var t=pRe(e,"string");return Bg(t)=="symbol"?t:t+""}function pRe(e,t){if(Bg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Bg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nd=function(e){function t(n){var o;return lRe(this,t),o=uRe(this,t,[n]),vl(o,"pieRef",null),vl(o,"sectorRefs",[]),vl(o,"id",gy("recharts-pie-")),vl(o,"handleAnimationEnd",function(){var d=o.props.onAnimationEnd;o.setState({isAnimationFinished:!0}),Vn(d)&&d()}),vl(o,"handleAnimationStart",function(){var d=o.props.onAnimationStart;o.setState({isAnimationFinished:!1}),Vn(d)&&d()}),o.state={isAnimationFinished:!n.isAnimationActive,prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,sectorToFocus:0},o}return fRe(t,e),cRe(t,[{key:"isActiveIndex",value:function(o){var d=this.props.activeIndex;return Array.isArray(d)?d.indexOf(o)!==-1:o===d}},{key:"hasActiveIndex",value:function(){var o=this.props.activeIndex;return Array.isArray(o)?o.length!==0:o||o===0}},{key:"renderLabels",value:function(o){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.label,i=f.labelLine,S=f.dataKey,E=f.valueKey,I=Tn(this.props,!1),M=Tn(_,!1),j=Tn(i,!1),N=_&&_.offsetRadius||20,G=o.map(function(z,V){var K=(z.startAngle+z.endAngle)/2,Q=lo(z.cx,z.cy,z.outerRadius+N,K),X=so(so(so(so({},I),z),{},{stroke:"none"},M),{},{index:V,textAnchor:t.getTextAnchor(Q.x,z.cx)},Q),ie=so(so(so(so({},I),z),{},{fill:"none",stroke:z.fill},j),{},{index:V,points:[lo(z.cx,z.cy,z.outerRadius,K),Q]}),J=S;return Jn(S)&&Jn(E)?J="value":Jn(S)&&(J=E),Le.createElement(Di,{key:"label-".concat(z.startAngle,"-").concat(z.endAngle,"-").concat(z.midAngle,"-").concat(V)},i&&t.renderLabelLineItem(i,ie,"line"),t.renderLabelItem(_,X,hs(z,J)))});return Le.createElement(Di,{className:"recharts-pie-labels"},G)}},{key:"renderSectorsStatically",value:function(o){var d=this,f=this.props,_=f.activeShape,i=f.blendStroke,S=f.inactiveShape;return o.map(function(E,I){if(E?.startAngle===0&&E?.endAngle===0&&o.length!==1)return null;var M=d.isActiveIndex(I),j=S&&d.hasActiveIndex()?S:null,N=M?_:j,G=so(so({},E),{},{stroke:i?E.fill:E.stroke,tabIndex:-1});return Le.createElement(Di,lg({ref:function(V){V&&!d.sectorRefs.includes(V)&&d.sectorRefs.push(V)},tabIndex:-1,className:"recharts-pie-sector"},Vf(d.props,E,I),{key:"sector-".concat(E?.startAngle,"-").concat(E?.endAngle,"-").concat(E.midAngle,"-").concat(I)}),Le.createElement(BH,lg({option:N,isActive:M,shapeType:"sector"},G)))})}},{key:"renderSectorsWithAnimation",value:function(){var o=this,d=this.props,f=d.sectors,_=d.isAnimationActive,i=d.animationBegin,S=d.animationDuration,E=d.animationEasing,I=d.animationId,M=this.state,j=M.prevSectors,N=M.prevIsAnimationActive;return Le.createElement(nu,{begin:i,duration:S,isActive:_,easing:E,from:{t:0},to:{t:1},key:"pie-".concat(I,"-").concat(N),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(G){var z=G.t,V=[],K=f&&f[0],Q=K.startAngle;return f.forEach(function(X,ie){var J=j&&j[ie],se=ie>0?Ka(X,"paddingAngle",0):0;if(J){var he=Wa(J.endAngle-J.startAngle,X.endAngle-X.startAngle),we=so(so({},X),{},{startAngle:Q+se,endAngle:Q+he(z)+se});V.push(we),Q=we.endAngle}else{var ze=X.endAngle,je=X.startAngle,Oe=Wa(0,ze-je),Be=Oe(z),qe=so(so({},X),{},{startAngle:Q+se,endAngle:Q+Be+se});V.push(qe),Q=qe.endAngle}}),Le.createElement(Di,null,o.renderSectorsStatically(V))})}},{key:"attachKeyboardHandlers",value:function(o){var d=this;o.onkeydown=function(f){if(!f.altKey)switch(f.key){case"ArrowLeft":{var _=++d.state.sectorToFocus%d.sectorRefs.length;d.sectorRefs[_].focus(),d.setState({sectorToFocus:_});break}case"ArrowRight":{var i=--d.state.sectorToFocus<0?d.sectorRefs.length-1:d.state.sectorToFocus%d.sectorRefs.length;d.sectorRefs[i].focus(),d.setState({sectorToFocus:i});break}case"Escape":{d.sectorRefs[d.state.sectorToFocus].blur(),d.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var o=this.props,d=o.sectors,f=o.isAnimationActive,_=this.state.prevSectors;return f&&d&&d.length&&(!_||!gx(_,d))?this.renderSectorsWithAnimation():this.renderSectorsStatically(d)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var o=this,d=this.props,f=d.hide,_=d.sectors,i=d.className,S=d.label,E=d.cx,I=d.cy,M=d.innerRadius,j=d.outerRadius,N=d.isAnimationActive,G=this.state.isAnimationFinished;if(f||!_||!_.length||!vr(E)||!vr(I)||!vr(M)||!vr(j))return null;var z=ni("recharts-pie",i);return Le.createElement(Di,{tabIndex:this.props.rootTabIndex,className:z,ref:function(K){o.pieRef=K}},this.renderSectors(),S&&this.renderLabels(_),Es.renderCallByParent(this.props,null,!1),(!N||G)&&Gu.renderCallByParent(this.props,_,!1))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return d.prevIsAnimationActive!==o.isAnimationActive?{prevIsAnimationActive:o.isAnimationActive,prevAnimationId:o.animationId,curSectors:o.sectors,prevSectors:[],isAnimationFinished:!0}:o.isAnimationActive&&o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curSectors:o.sectors,prevSectors:d.curSectors,isAnimationFinished:!0}:o.sectors!==d.curSectors?{curSectors:o.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(o,d){return o>d?"start":o<d?"end":"middle"}},{key:"renderLabelLineItem",value:function(o,d,f){if(Le.isValidElement(o))return Le.cloneElement(o,d);if(Vn(o))return o(d);var _=ni("recharts-pie-label-line",typeof o!="boolean"?o.className:"");return Le.createElement(uS,lg({},d,{key:f,type:"linear",className:_}))}},{key:"renderLabelItem",value:function(o,d,f){if(Le.isValidElement(o))return Le.cloneElement(o,d);var _=f;if(Vn(o)&&(_=o(d),Le.isValidElement(_)))return _;var i=ni("recharts-pie-label-text",typeof o!="boolean"&&!Vn(o)?o.className:"");return Le.createElement(Uf,lg({},d,{alignmentBaseline:"middle",className:i}),_)}}])}(B.PureComponent);uw=nd;vl(nd,"displayName","Pie");vl(nd,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Kc.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});vl(nd,"parseDeltaAngle",function(e,t){var n=ia(t-e),o=Math.min(Math.abs(t-e),360);return n*o});vl(nd,"getRealPieData",function(e){var t=e.data,n=e.children,o=Tn(e,!1),d=Xa(n,tR);return t&&t.length?t.map(function(f,_){return so(so(so({payload:f},o),f),d&&d[_]&&d[_].props)}):d&&d.length?d.map(function(f){return so(so({},o),f.props)}):[]});vl(nd,"parseCoordinateOfPie",function(e,t){var n=t.top,o=t.left,d=t.width,f=t.height,_=xH(d,f),i=o+oa(e.cx,d,d/2),S=n+oa(e.cy,f,f/2),E=oa(e.innerRadius,_,0),I=oa(e.outerRadius,_,_*.8),M=e.maxRadius||Math.sqrt(d*d+f*f)/2;return{cx:i,cy:S,innerRadius:E,outerRadius:I,maxRadius:M}});vl(nd,"getComposedData",function(e){var t=e.item,n=e.offset,o=t.type.defaultProps!==void 0?so(so({},t.type.defaultProps),t.props):t.props,d=uw.getRealPieData(o);if(!d||!d.length)return null;var f=o.cornerRadius,_=o.startAngle,i=o.endAngle,S=o.paddingAngle,E=o.dataKey,I=o.nameKey,M=o.valueKey,j=o.tooltipType,N=Math.abs(o.minAngle),G=uw.parseCoordinateOfPie(o,n),z=uw.parseDeltaAngle(_,i),V=Math.abs(z),K=E;Jn(E)&&Jn(M)?(lc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),K="value"):Jn(E)&&(lc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),K=M);var Q=d.filter(function(we){return hs(we,K,0)!==0}).length,X=(V>=360?Q:Q-1)*S,ie=V-Q*N-X,J=d.reduce(function(we,ze){var je=hs(ze,K,0);return we+(vr(je)?je:0)},0),se;if(J>0){var he;se=d.map(function(we,ze){var je=hs(we,K,0),Oe=hs(we,I,ze),Be=(vr(je)?je:0)/J,qe;ze?qe=he.endAngle+ia(z)*S*(je!==0?1:0):qe=_;var Xe=qe+ia(z)*((je!==0?N:0)+Be*ie),it=(qe+Xe)/2,Ge=(G.innerRadius+G.outerRadius)/2,Ke=[{name:Oe,value:je,payload:we,dataKey:K,type:j}],ut=lo(G.cx,G.cy,Ge,it);return he=so(so(so({percent:Be,cornerRadius:f,name:Oe,tooltipPayload:Ke,midAngle:it,middleRadius:Ge,tooltipPosition:ut},we),G),{},{value:hs(we,K),startAngle:qe,endAngle:Xe,payload:we,paddingAngle:ia(z)*S}),he})}return so(so({},G),{},{sectors:se,data:d})});var mRe=Math.ceil,gRe=Math.max;function yRe(e,t,n,o){for(var d=-1,f=gRe(mRe((t-e)/(n||1)),0),_=Array(f);f--;)_[o?f:++d]=e,e+=n;return _}var _Re=yRe,vRe=aG,D5=1/0,xRe=17976931348623157e292;function bRe(e){if(!e)return e===0?e:0;if(e=vRe(e),e===D5||e===-D5){var t=e<0?-1:1;return t*xRe}return e===e?e:0}var UH=bRe,wRe=_Re,SRe=DT,wP=UH;function TRe(e){return function(t,n,o){return o&&typeof o!="number"&&SRe(t,n,o)&&(n=o=void 0),t=wP(t),n===void 0?(n=t,t=0):n=wP(n),o=o===void 0?t<n?1:-1:wP(o),wRe(t,n,o,e)}}var ARe=TRe,ERe=ARe,PRe=ERe(),CRe=PRe;const xS=Ni(CRe);function V0(e){"@babel/helpers - typeof";return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V0(e)}function L5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function N5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?L5(Object(n),!0).forEach(function(o){GH(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function GH(e,t,n){return t=IRe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IRe(e){var t=MRe(e,"string");return V0(t)=="symbol"?t:t+""}function MRe(e,t){if(V0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(V0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ORe=["Webkit","Moz","O","ms"],RRe=function(t,n){var o=t.replace(/(\w)/,function(f){return f.toUpperCase()}),d=ORe.reduce(function(f,_){return N5(N5({},f),{},GH({},_+o,n))},{});return d[t]=n,d};function $g(e){"@babel/helpers - typeof";return $g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$g(e)}function bS(){return bS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},bS.apply(this,arguments)}function z5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function SP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z5(Object(n),!0).forEach(function(o){Va(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function kRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,WH(o.key),o)}}function jRe(e,t,n){return t&&F5(e.prototype,t),n&&F5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function DRe(e,t,n){return t=wS(t),LRe(e,HH()?Reflect.construct(t,n||[],wS(e).constructor):t.apply(e,n))}function LRe(e,t){if(t&&($g(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NRe(e)}function NRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HH=function(){return!!e})()}function wS(e){return wS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},wS(e)}function zRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DI(e,t)}function DI(e,t){return DI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},DI(e,t)}function Va(e,t,n){return t=WH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WH(e){var t=FRe(e,"string");return $g(t)=="symbol"?t:t+""}function FRe(e,t){if($g(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if($g(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var BRe=function(t){var n=t.data,o=t.startIndex,d=t.endIndex,f=t.x,_=t.width,i=t.travellerWidth;if(!n||!n.length)return{};var S=n.length,E=Xv().domain(xS(0,S)).range([f,f+_-i]),I=E.domain().map(function(M){return E(M)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:E(o),endX:E(d),scale:E,scaleValues:I}},B5=function(t){return t.changedTouches&&!!t.changedTouches.length},Vg=function(e){function t(n){var o;return kRe(this,t),o=DRe(this,t,[n]),Va(o,"handleDrag",function(d){o.leaveTimer&&(clearTimeout(o.leaveTimer),o.leaveTimer=null),o.state.isTravellerMoving?o.handleTravellerMove(d):o.state.isSlideMoving&&o.handleSlideDrag(d)}),Va(o,"handleTouchMove",function(d){d.changedTouches!=null&&d.changedTouches.length>0&&o.handleDrag(d.changedTouches[0])}),Va(o,"handleDragEnd",function(){o.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var d=o.props,f=d.endIndex,_=d.onDragEnd,i=d.startIndex;_?.({endIndex:f,startIndex:i})}),o.detachDragEndListener()}),Va(o,"handleLeaveWrapper",function(){(o.state.isTravellerMoving||o.state.isSlideMoving)&&(o.leaveTimer=window.setTimeout(o.handleDragEnd,o.props.leaveTimeOut))}),Va(o,"handleEnterSlideOrTraveller",function(){o.setState({isTextActive:!0})}),Va(o,"handleLeaveSlideOrTraveller",function(){o.setState({isTextActive:!1})}),Va(o,"handleSlideDragStart",function(d){var f=B5(d)?d.changedTouches[0]:d;o.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:f.pageX}),o.attachDragEndListener()}),o.travellerDragStartHandlers={startX:o.handleTravellerDragStart.bind(o,"startX"),endX:o.handleTravellerDragStart.bind(o,"endX")},o.state={},o}return zRe(t,e),jRe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(o){var d=o.startX,f=o.endX,_=this.state.scaleValues,i=this.props,S=i.gap,E=i.data,I=E.length-1,M=Math.min(d,f),j=Math.max(d,f),N=t.getIndexInRange(_,M),G=t.getIndexInRange(_,j);return{startIndex:N-N%S,endIndex:G===I?I:G-G%S}}},{key:"getTextOfTick",value:function(o){var d=this.props,f=d.data,_=d.tickFormatter,i=d.dataKey,S=hs(f[o],i,o);return Vn(_)?_(S,o):S}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(o){var d=this.state,f=d.slideMoveStartX,_=d.startX,i=d.endX,S=this.props,E=S.x,I=S.width,M=S.travellerWidth,j=S.startIndex,N=S.endIndex,G=S.onChange,z=o.pageX-f;z>0?z=Math.min(z,E+I-M-i,E+I-M-_):z<0&&(z=Math.max(z,E-_,E-i));var V=this.getIndex({startX:_+z,endX:i+z});(V.startIndex!==j||V.endIndex!==N)&&G&&G(V),this.setState({startX:_+z,endX:i+z,slideMoveStartX:o.pageX})}},{key:"handleTravellerDragStart",value:function(o,d){var f=B5(d)?d.changedTouches[0]:d;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:o,brushMoveStartX:f.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(o){var d=this.state,f=d.brushMoveStartX,_=d.movingTravellerId,i=d.endX,S=d.startX,E=this.state[_],I=this.props,M=I.x,j=I.width,N=I.travellerWidth,G=I.onChange,z=I.gap,V=I.data,K={startX:this.state.startX,endX:this.state.endX},Q=o.pageX-f;Q>0?Q=Math.min(Q,M+j-N-E):Q<0&&(Q=Math.max(Q,M-E)),K[_]=E+Q;var X=this.getIndex(K),ie=X.startIndex,J=X.endIndex,se=function(){var we=V.length-1;return _==="startX"&&(i>S?ie%z===0:J%z===0)||i<S&&J===we||_==="endX"&&(i>S?J%z===0:ie%z===0)||i>S&&J===we};this.setState(Va(Va({},_,E+Q),"brushMoveStartX",o.pageX),function(){G&&se()&&G(X)})}},{key:"handleTravellerMoveKeyboard",value:function(o,d){var f=this,_=this.state,i=_.scaleValues,S=_.startX,E=_.endX,I=this.state[d],M=i.indexOf(I);if(M!==-1){var j=M+o;if(!(j===-1||j>=i.length)){var N=i[j];d==="startX"&&N>=E||d==="endX"&&N<=S||this.setState(Va({},d,N),function(){f.props.onChange(f.getIndex({startX:f.state.startX,endX:f.state.endX}))})}}}},{key:"renderBackground",value:function(){var o=this.props,d=o.x,f=o.y,_=o.width,i=o.height,S=o.fill,E=o.stroke;return Le.createElement("rect",{stroke:E,fill:S,x:d,y:f,width:_,height:i})}},{key:"renderPanorama",value:function(){var o=this.props,d=o.x,f=o.y,_=o.width,i=o.height,S=o.data,E=o.children,I=o.padding,M=B.Children.only(E);return M?Le.cloneElement(M,{x:d,y:f,width:_,height:i,margin:I,compact:!0,data:S}):null}},{key:"renderTravellerLayer",value:function(o,d){var f,_,i=this,S=this.props,E=S.y,I=S.travellerWidth,M=S.height,j=S.traveller,N=S.ariaLabel,G=S.data,z=S.startIndex,V=S.endIndex,K=Math.max(o,this.props.x),Q=SP(SP({},Tn(this.props,!1)),{},{x:K,y:E,width:I,height:M}),X=N||"Min value: ".concat((f=G[z])===null||f===void 0?void 0:f.name,", Max value: ").concat((_=G[V])===null||_===void 0?void 0:_.name);return Le.createElement(Di,{tabIndex:0,role:"slider","aria-label":X,"aria-valuenow":o,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[d],onTouchStart:this.travellerDragStartHandlers[d],onKeyDown:function(J){["ArrowLeft","ArrowRight"].includes(J.key)&&(J.preventDefault(),J.stopPropagation(),i.handleTravellerMoveKeyboard(J.key==="ArrowRight"?1:-1,d))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(j,Q))}},{key:"renderSlide",value:function(o,d){var f=this.props,_=f.y,i=f.height,S=f.stroke,E=f.travellerWidth,I=Math.min(o,d)+E,M=Math.max(Math.abs(d-o)-E,0);return Le.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:S,fillOpacity:.2,x:I,y:_,width:M,height:i})}},{key:"renderText",value:function(){var o=this.props,d=o.startIndex,f=o.endIndex,_=o.y,i=o.height,S=o.travellerWidth,E=o.stroke,I=this.state,M=I.startX,j=I.endX,N=5,G={pointerEvents:"none",fill:E};return Le.createElement(Di,{className:"recharts-brush-texts"},Le.createElement(Uf,bS({textAnchor:"end",verticalAnchor:"middle",x:Math.min(M,j)-N,y:_+i/2},G),this.getTextOfTick(d)),Le.createElement(Uf,bS({textAnchor:"start",verticalAnchor:"middle",x:Math.max(M,j)+S+N,y:_+i/2},G),this.getTextOfTick(f)))}},{key:"render",value:function(){var o=this.props,d=o.data,f=o.className,_=o.children,i=o.x,S=o.y,E=o.width,I=o.height,M=o.alwaysShowText,j=this.state,N=j.startX,G=j.endX,z=j.isTextActive,V=j.isSlideMoving,K=j.isTravellerMoving,Q=j.isTravellerFocused;if(!d||!d.length||!vr(i)||!vr(S)||!vr(E)||!vr(I)||E<=0||I<=0)return null;var X=ni("recharts-brush",f),ie=Le.Children.count(_)===1,J=RRe("userSelect","none");return Le.createElement(Di,{className:X,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:J},this.renderBackground(),ie&&this.renderPanorama(),this.renderSlide(N,G),this.renderTravellerLayer(N,"startX"),this.renderTravellerLayer(G,"endX"),(z||V||K||Q||M)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(o){var d=o.x,f=o.y,_=o.width,i=o.height,S=o.stroke,E=Math.floor(f+i/2)-1;return Le.createElement(Le.Fragment,null,Le.createElement("rect",{x:d,y:f,width:_,height:i,fill:S,stroke:"none"}),Le.createElement("line",{x1:d+1,y1:E,x2:d+_-1,y2:E,fill:"none",stroke:"#fff"}),Le.createElement("line",{x1:d+1,y1:E+2,x2:d+_-1,y2:E+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(o,d){var f;return Le.isValidElement(o)?f=Le.cloneElement(o,d):Vn(o)?f=o(d):f=t.renderDefaultTraveller(d),f}},{key:"getDerivedStateFromProps",value:function(o,d){var f=o.data,_=o.width,i=o.x,S=o.travellerWidth,E=o.updateId,I=o.startIndex,M=o.endIndex;if(f!==d.prevData||E!==d.prevUpdateId)return SP({prevData:f,prevTravellerWidth:S,prevUpdateId:E,prevX:i,prevWidth:_},f&&f.length?BRe({data:f,width:_,x:i,travellerWidth:S,startIndex:I,endIndex:M}):{scale:null,scaleValues:null});if(d.scale&&(_!==d.prevWidth||i!==d.prevX||S!==d.prevTravellerWidth)){d.scale.range([i,i+_-S]);var j=d.scale.domain().map(function(N){return d.scale(N)});return{prevData:f,prevTravellerWidth:S,prevUpdateId:E,prevX:i,prevWidth:_,startX:d.scale(o.startIndex),endX:d.scale(o.endIndex),scaleValues:j}}return null}},{key:"getIndexInRange",value:function(o,d){for(var f=o.length,_=0,i=f-1;i-_>1;){var S=Math.floor((_+i)/2);o[S]>d?i=S:_=S}return d>=o[i]?i:_}}])}(B.PureComponent);Va(Vg,"displayName","Brush");Va(Vg,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var $Re=JO;function VRe(e,t){var n;return $Re(e,function(o,d,f){return n=t(o,d,f),!n}),!!n}var URe=VRe,GRe=j8,HRe=su,WRe=URe,qRe=Ea,ZRe=DT;function KRe(e,t,n){var o=qRe(e)?GRe:WRe;return n&&ZRe(e,t,n)&&(t=void 0),o(e,HRe(t))}var XRe=KRe;const YRe=Ni(XRe);var Yc=function(t,n){var o=t.alwaysShow,d=t.ifOverflow;return o&&(d="extendDomain"),d===n},$5=rG;function JRe(e,t,n){t=="__proto__"&&$5?$5(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var QRe=JRe,eke=QRe,tke=eG,rke=su;function nke(e,t){var n={};return t=rke(t),tke(e,function(o,d,f){eke(n,d,t(o,d,f))}),n}var ike=nke;const oke=Ni(ike);function ske(e,t){for(var n=-1,o=e==null?0:e.length;++n<o;)if(!t(e[n],n,e))return!1;return!0}var ake=ske,lke=JO;function cke(e,t){var n=!0;return lke(e,function(o,d,f){return n=!!t(o,d,f),n}),n}var uke=cke,dke=ake,hke=uke,fke=su,pke=Ea,mke=DT;function gke(e,t,n){var o=pke(e)?dke:hke;return n&&mke(e,t,n)&&(t=void 0),o(e,fke(t))}var yke=gke;const qH=Ni(yke);var _ke=["x","y"];function U0(e){"@babel/helpers - typeof";return U0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U0(e)}function LI(){return LI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},LI.apply(this,arguments)}function V5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Nv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?V5(Object(n),!0).forEach(function(o){vke(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function vke(e,t,n){return t=xke(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xke(e){var t=bke(e,"string");return U0(t)=="symbol"?t:t+""}function bke(e,t){if(U0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(U0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wke(e,t){if(e==null)return{};var n=Ske(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function Ske(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function Tke(e,t){var n=e.x,o=e.y,d=wke(e,_ke),f="".concat(n),_=parseInt(f,10),i="".concat(o),S=parseInt(i,10),E="".concat(t.height||d.height),I=parseInt(E,10),M="".concat(t.width||d.width),j=parseInt(M,10);return Nv(Nv(Nv(Nv(Nv({},t),d),_?{x:_}:{}),S?{y:S}:{}),{},{height:I,width:j,name:t.name,radius:t.radius})}function U5(e){return Le.createElement(BH,LI({shapeType:"rectangle",propTransformer:Tke,activeClassName:"recharts-active-bar"},e))}var Ake=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(o,d){if(typeof t=="number")return t;var f=vr(o)||Xpe(o);return f?t(o,d):(f||Hf(),n)}},Eke=["value","background"],ZH;function Ug(e){"@babel/helpers - typeof";return Ug=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ug(e)}function Pke(e,t){if(e==null)return{};var n=Cke(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function Cke(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function SS(){return SS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},SS.apply(this,arguments)}function G5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?G5(Object(n),!0).forEach(function(o){qd(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Ike(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,XH(o.key),o)}}function Mke(e,t,n){return t&&H5(e.prototype,t),n&&H5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Oke(e,t,n){return t=TS(t),Rke(e,KH()?Reflect.construct(t,n||[],TS(e).constructor):t.apply(e,n))}function Rke(e,t){if(t&&(Ug(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kke(e)}function kke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function KH(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(KH=function(){return!!e})()}function TS(e){return TS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},TS(e)}function jke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NI(e,t)}function NI(e,t){return NI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},NI(e,t)}function qd(e,t,n){return t=XH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XH(e){var t=Dke(e,"string");return Ug(t)=="symbol"?t:t+""}function Dke(e,t){if(Ug(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Ug(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ip=function(e){function t(){var n;Ike(this,t);for(var o=arguments.length,d=new Array(o),f=0;f<o;f++)d[f]=arguments[f];return n=Oke(this,t,[].concat(d)),qd(n,"state",{isAnimationFinished:!1}),qd(n,"id",gy("recharts-bar-")),qd(n,"handleAnimationEnd",function(){var _=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),_&&_()}),qd(n,"handleAnimationStart",function(){var _=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),_&&_()}),n}return jke(t,e),Mke(t,[{key:"renderRectanglesStatically",value:function(o){var d=this,f=this.props,_=f.shape,i=f.dataKey,S=f.activeIndex,E=f.activeBar,I=Tn(this.props,!1);return o&&o.map(function(M,j){var N=j===S,G=N?E:_,z=ts(ts(ts({},I),M),{},{isActive:N,option:G,index:j,dataKey:i,onAnimationStart:d.handleAnimationStart,onAnimationEnd:d.handleAnimationEnd});return Le.createElement(Di,SS({className:"recharts-bar-rectangle"},Vf(d.props,M,j),{key:"rectangle-".concat(M?.x,"-").concat(M?.y,"-").concat(M?.value,"-").concat(j)}),Le.createElement(U5,z))})}},{key:"renderRectanglesWithAnimation",value:function(){var o=this,d=this.props,f=d.data,_=d.layout,i=d.isAnimationActive,S=d.animationBegin,E=d.animationDuration,I=d.animationEasing,M=d.animationId,j=this.state.prevData;return Le.createElement(nu,{begin:S,duration:E,isActive:i,easing:I,from:{t:0},to:{t:1},key:"bar-".concat(M),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(N){var G=N.t,z=f.map(function(V,K){var Q=j&&j[K];if(Q){var X=Wa(Q.x,V.x),ie=Wa(Q.y,V.y),J=Wa(Q.width,V.width),se=Wa(Q.height,V.height);return ts(ts({},V),{},{x:X(G),y:ie(G),width:J(G),height:se(G)})}if(_==="horizontal"){var he=Wa(0,V.height),we=he(G);return ts(ts({},V),{},{y:V.y+V.height-we,height:we})}var ze=Wa(0,V.width),je=ze(G);return ts(ts({},V),{},{width:je})});return Le.createElement(Di,null,o.renderRectanglesStatically(z))})}},{key:"renderRectangles",value:function(){var o=this.props,d=o.data,f=o.isAnimationActive,_=this.state.prevData;return f&&d&&d.length&&(!_||!gx(_,d))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(d)}},{key:"renderBackground",value:function(){var o=this,d=this.props,f=d.data,_=d.dataKey,i=d.activeIndex,S=Tn(this.props.background,!1);return f.map(function(E,I){E.value;var M=E.background,j=Pke(E,Eke);if(!M)return null;var N=ts(ts(ts(ts(ts({},j),{},{fill:"#eee"},M),S),Vf(o.props,E,I)),{},{onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd,dataKey:_,index:I,className:"recharts-bar-background-rectangle"});return Le.createElement(U5,SS({key:"background-bar-".concat(I),option:o.props.background,isActive:I===i},N))})}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.data,i=f.xAxis,S=f.yAxis,E=f.layout,I=f.children,M=Xa(I,yx);if(!M)return null;var j=E==="vertical"?_[0].height/2:_[0].width/2,N=function(V,K){var Q=Array.isArray(V.value)?V.value[1]:V.value;return{x:V.x,y:V.y,value:Q,errorVal:hs(V,K)}},G={clipPath:o?"url(#clipPath-".concat(d,")"):null};return Le.createElement(Di,G,M.map(function(z){return Le.cloneElement(z,{key:"error-bar-".concat(d,"-").concat(z.props.dataKey),data:_,xAxis:i,yAxis:S,layout:E,offset:j,dataPointFormatter:N})}))}},{key:"render",value:function(){var o=this.props,d=o.hide,f=o.data,_=o.className,i=o.xAxis,S=o.yAxis,E=o.left,I=o.top,M=o.width,j=o.height,N=o.isAnimationActive,G=o.background,z=o.id;if(d||!f||!f.length)return null;var V=this.state.isAnimationFinished,K=ni("recharts-bar",_),Q=i&&i.allowDataOverflow,X=S&&S.allowDataOverflow,ie=Q||X,J=Jn(z)?this.id:z;return Le.createElement(Di,{className:K},Q||X?Le.createElement("defs",null,Le.createElement("clipPath",{id:"clipPath-".concat(J)},Le.createElement("rect",{x:Q?E:E-M/2,y:X?I:I-j/2,width:Q?M:M*2,height:X?j:j*2}))):null,Le.createElement(Di,{className:"recharts-bar-rectangles",clipPath:ie?"url(#clipPath-".concat(J,")"):null},G?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(ie,J),(!N||V)&&Gu.renderCallByParent(this.props,f))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curData:o.data,prevData:d.curData}:o.data!==d.curData?{curData:o.data}:null}}])}(B.PureComponent);ZH=ip;qd(ip,"displayName","Bar");qd(ip,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Kc.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});qd(ip,"getComposedData",function(e){var t=e.props,n=e.item,o=e.barPosition,d=e.bandSize,f=e.xAxis,_=e.yAxis,i=e.xAxisTicks,S=e.yAxisTicks,E=e.stackedData,I=e.dataStartIndex,M=e.displayedData,j=e.offset,N=mPe(o,n);if(!N)return null;var G=t.layout,z=n.type.defaultProps,V=z!==void 0?ts(ts({},z),n.props):n.props,K=V.dataKey,Q=V.children,X=V.minPointSize,ie=G==="horizontal"?_:f,J=E?ie.scale.domain():null,se=wPe({numericAxis:ie}),he=Xa(Q,tR),we=M.map(function(ze,je){var Oe,Be,qe,Xe,it,Ge;E?Oe=gPe(E[I+je],J):(Oe=hs(ze,K),Array.isArray(Oe)||(Oe=[se,Oe]));var Ke=Ake(X,ZH.defaultProps.minPointSize)(Oe[1],je);if(G==="horizontal"){var ut,rt=[_.scale(Oe[0]),_.scale(Oe[1])],Xt=rt[0],cr=rt[1];Be=jB({axis:f,ticks:i,bandSize:d,offset:N.offset,entry:ze,index:je}),qe=(ut=cr??Xt)!==null&&ut!==void 0?ut:void 0,Xe=N.size;var Bt=Xt-cr;if(it=Number.isNaN(Bt)?0:Bt,Ge={x:Be,y:_.y,width:Xe,height:_.height},Math.abs(Ke)>0&&Math.abs(it)<Math.abs(Ke)){var $t=ia(it||Ke)*(Math.abs(Ke)-Math.abs(it));qe-=$t,it+=$t}}else{var br=[f.scale(Oe[0]),f.scale(Oe[1])],nn=br[0],qn=br[1];if(Be=nn,qe=jB({axis:_,ticks:S,bandSize:d,offset:N.offset,entry:ze,index:je}),Xe=qn-nn,it=N.size,Ge={x:f.x,y:qe,width:f.width,height:it},Math.abs(Ke)>0&&Math.abs(Xe)<Math.abs(Ke)){var lr=ia(Xe||Ke)*(Math.abs(Ke)-Math.abs(Xe));Xe+=lr}}return ts(ts(ts({},ze),{},{x:Be,y:qe,width:Xe,height:it,value:E?Oe:Oe[1],payload:ze,background:Ge},he&&he[je]&&he[je].props),{},{tooltipPayload:[_H(n,ze)],tooltipPosition:{x:Be+Xe/2,y:qe+it/2}})});return ts({data:we,layout:G},j)});function G0(e){"@babel/helpers - typeof";return G0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G0(e)}function Lke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W5(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,YH(o.key),o)}}function Nke(e,t,n){return t&&W5(e.prototype,t),n&&W5(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function q5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function nc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q5(Object(n),!0).forEach(function(o){e2(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function e2(e,t,n){return t=YH(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YH(e){var t=zke(e,"string");return G0(t)=="symbol"?t:t+""}function zke(e,t){if(G0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(G0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var JH=function(t,n,o,d,f){var _=t.width,i=t.height,S=t.layout,E=t.children,I=Object.keys(n),M={left:o.left,leftMirror:o.left,right:_-o.right,rightMirror:_-o.right,top:o.top,topMirror:o.top,bottom:i-o.bottom,bottomMirror:i-o.bottom},j=!!Ua(E,ip);return I.reduce(function(N,G){var z=n[G],V=z.orientation,K=z.domain,Q=z.padding,X=Q===void 0?{}:Q,ie=z.mirror,J=z.reversed,se="".concat(V).concat(ie?"Mirror":""),he,we,ze,je,Oe;if(z.type==="number"&&(z.padding==="gap"||z.padding==="no-gap")){var Be=K[1]-K[0],qe=1/0,Xe=z.categoricalDomain.sort(Qpe);if(Xe.forEach(function(br,nn){nn>0&&(qe=Math.min((br||0)-(Xe[nn-1]||0),qe))}),Number.isFinite(qe)){var it=qe/Be,Ge=z.layout==="vertical"?o.height:o.width;if(z.padding==="gap"&&(he=it*Ge/2),z.padding==="no-gap"){var Ke=oa(t.barCategoryGap,it*Ge),ut=it*Ge/2;he=ut-Ke-(ut-Ke)/Ge*Ke}}}d==="xAxis"?we=[o.left+(X.left||0)+(he||0),o.left+o.width-(X.right||0)-(he||0)]:d==="yAxis"?we=S==="horizontal"?[o.top+o.height-(X.bottom||0),o.top+(X.top||0)]:[o.top+(X.top||0)+(he||0),o.top+o.height-(X.bottom||0)-(he||0)]:we=z.range,J&&(we=[we[1],we[0]]);var rt=pH(z,f,j),Xt=rt.scale,cr=rt.realScaleType;Xt.domain(K).range(we),mH(Xt);var Bt=gH(Xt,nc(nc({},z),{},{realScaleType:cr}));d==="xAxis"?(Oe=V==="top"&&!ie||V==="bottom"&&ie,ze=o.left,je=M[se]-Oe*z.height):d==="yAxis"&&(Oe=V==="left"&&!ie||V==="right"&&ie,ze=M[se]-Oe*z.width,je=o.top);var $t=nc(nc(nc({},z),Bt),{},{realScaleType:cr,x:ze,y:je,scale:Xt,width:d==="xAxis"?o.width:z.width,height:d==="yAxis"?o.height:z.height});return $t.bandSize=aS($t,Bt),!z.hide&&d==="xAxis"?M[se]+=(Oe?-1:1)*$t.height:z.hide||(M[se]+=(Oe?-1:1)*$t.width),nc(nc({},N),{},e2({},G,$t))},{})},QH=function(t,n){var o=t.x,d=t.y,f=n.x,_=n.y;return{x:Math.min(o,f),y:Math.min(d,_),width:Math.abs(f-o),height:Math.abs(_-d)}},Fke=function(t){var n=t.x1,o=t.y1,d=t.x2,f=t.y2;return QH({x:n,y:o},{x:d,y:f})},eW=function(){function e(t){Lke(this,e),this.scale=t}return Nke(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=o.bandAware,f=o.position;if(n!==void 0){if(f)switch(f){case"start":return this.scale(n);case"middle":{var _=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+_}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(n)+i}default:return this.scale(n)}if(d){var S=this.bandwidth?this.bandwidth()/2:0;return this.scale(n)+S}return this.scale(n)}}},{key:"isInRange",value:function(n){var o=this.range(),d=o[0],f=o[o.length-1];return d<=f?n>=d&&n<=f:n>=f&&n<=d}}],[{key:"create",value:function(n){return new e(n)}}])}();e2(eW,"EPS",1e-4);var CR=function(t){var n=Object.keys(t).reduce(function(o,d){return nc(nc({},o),{},e2({},d,eW.create(t[d])))},{});return nc(nc({},n),{},{apply:function(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=f.bandAware,i=f.position;return oke(d,function(S,E){return n[E].apply(S,{bandAware:_,position:i})})},isInRange:function(d){return qH(d,function(f,_){return n[_].isInRange(f)})}})};function Bke(e){return(e%180+180)%180}var $ke=function(t){var n=t.width,o=t.height,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f=Bke(d),_=f*Math.PI/180,i=Math.atan(o/n),S=_>i&&_<Math.PI-i?o/Math.sin(_):n/Math.cos(_);return Math.abs(S)},Vke=su,Uke=dx,Gke=kT;function Hke(e){return function(t,n,o){var d=Object(t);if(!Uke(t)){var f=Vke(n);t=Gke(t),n=function(i){return f(d[i],i,d)}}var _=e(t,n,o);return _>-1?d[f?t[_]:_]:void 0}}var Wke=Hke,qke=UH;function Zke(e){var t=qke(e),n=t%1;return t===t?n?t-n:t:0}var Kke=Zke,Xke=Z8,Yke=su,Jke=Kke,Qke=Math.max;function eje(e,t,n){var o=e==null?0:e.length;if(!o)return-1;var d=n==null?0:Jke(n);return d<0&&(d=Qke(o+d,0)),Xke(e,Yke(t),d)}var tje=eje,rje=Wke,nje=tje,ije=rje(nje),oje=ije;const sje=Ni(oje);var aje=epe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),IR=B.createContext(void 0),MR=B.createContext(void 0),tW=B.createContext(void 0),rW=B.createContext({}),nW=B.createContext(void 0),iW=B.createContext(0),oW=B.createContext(0),Z5=function(t){var n=t.state,o=n.xAxisMap,d=n.yAxisMap,f=n.offset,_=t.clipPathId,i=t.children,S=t.width,E=t.height,I=aje(f);return Le.createElement(IR.Provider,{value:o},Le.createElement(MR.Provider,{value:d},Le.createElement(rW.Provider,{value:f},Le.createElement(tW.Provider,{value:I},Le.createElement(nW.Provider,{value:_},Le.createElement(iW.Provider,{value:E},Le.createElement(oW.Provider,{value:S},i)))))))},lje=function(){return B.useContext(nW)},sW=function(t){var n=B.useContext(IR);n==null&&Hf();var o=n[t];return o==null&&Hf(),o},cje=function(){var t=B.useContext(IR);return Hd(t)},uje=function(){var t=B.useContext(MR),n=sje(t,function(o){return qH(o.domain,Number.isFinite)});return n||Hd(t)},aW=function(t){var n=B.useContext(MR);n==null&&Hf();var o=n[t];return o==null&&Hf(),o},dje=function(){var t=B.useContext(tW);return t},hje=function(){return B.useContext(rW)},OR=function(){return B.useContext(oW)},RR=function(){return B.useContext(iW)};function Gg(e){"@babel/helpers - typeof";return Gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gg(e)}function fje(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function pje(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,cW(o.key),o)}}function mje(e,t,n){return t&&pje(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gje(e,t,n){return t=AS(t),yje(e,lW()?Reflect.construct(t,n||[],AS(e).constructor):t.apply(e,n))}function yje(e,t){if(t&&(Gg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _je(e)}function _je(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lW=function(){return!!e})()}function AS(e){return AS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},AS(e)}function vje(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zI(e,t)}function zI(e,t){return zI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},zI(e,t)}function K5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function X5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K5(Object(n),!0).forEach(function(o){kR(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function kR(e,t,n){return t=cW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cW(e){var t=xje(e,"string");return Gg(t)=="symbol"?t:t+""}function xje(e,t){if(Gg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Gg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bje(e,t){return Aje(e)||Tje(e,t)||Sje(e,t)||wje()}function wje(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sje(e,t){if(e){if(typeof e=="string")return Y5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y5(e,t)}}function Y5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Tje(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function Aje(e){if(Array.isArray(e))return e}function FI(){return FI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},FI.apply(this,arguments)}var Eje=function(t,n){var o;return Le.isValidElement(t)?o=Le.cloneElement(t,n):Vn(t)?o=t(n):o=Le.createElement("line",FI({},n,{className:"recharts-reference-line-line"})),o},Pje=function(t,n,o,d,f,_,i,S,E){var I=f.x,M=f.y,j=f.width,N=f.height;if(o){var G=E.y,z=t.y.apply(G,{position:_});if(Yc(E,"discard")&&!t.y.isInRange(z))return null;var V=[{x:I+j,y:z},{x:I,y:z}];return S==="left"?V.reverse():V}if(n){var K=E.x,Q=t.x.apply(K,{position:_});if(Yc(E,"discard")&&!t.x.isInRange(Q))return null;var X=[{x:Q,y:M+N},{x:Q,y:M}];return i==="top"?X.reverse():X}if(d){var ie=E.segment,J=ie.map(function(se){return t.apply(se,{position:_})});return Yc(E,"discard")&&YRe(J,function(se){return!t.isInRange(se)})?null:J}return null};function Cje(e){var t=e.x,n=e.y,o=e.segment,d=e.xAxisId,f=e.yAxisId,_=e.shape,i=e.className,S=e.alwaysShow,E=lje(),I=sW(d),M=aW(f),j=dje();if(!E||!j)return null;lc(S===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var N=CR({x:I.scale,y:M.scale}),G=fs(t),z=fs(n),V=o&&o.length===2,K=Pje(N,G,z,V,j,e.position,I.orientation,M.orientation,e);if(!K)return null;var Q=bje(K,2),X=Q[0],ie=X.x,J=X.y,se=Q[1],he=se.x,we=se.y,ze=Yc(e,"hidden")?"url(#".concat(E,")"):void 0,je=X5(X5({clipPath:ze},Tn(e,!0)),{},{x1:ie,y1:J,x2:he,y2:we});return Le.createElement(Di,{className:ni("recharts-reference-line",i)},Eje(_,je),Es.renderCallByParent(e,Fke({x1:ie,y1:J,x2:he,y2:we})))}var jR=function(e){function t(){return fje(this,t),gje(this,t,arguments)}return vje(t,e),mje(t,[{key:"render",value:function(){return Le.createElement(Cje,this.props)}}])}(Le.Component);kR(jR,"displayName","ReferenceLine");kR(jR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function BI(){return BI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},BI.apply(this,arguments)}function Hg(e){"@babel/helpers - typeof";return Hg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hg(e)}function J5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Q5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J5(Object(n),!0).forEach(function(o){t2(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J5(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Ije(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mje(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,dW(o.key),o)}}function Oje(e,t,n){return t&&Mje(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rje(e,t,n){return t=ES(t),kje(e,uW()?Reflect.construct(t,n||[],ES(e).constructor):t.apply(e,n))}function kje(e,t){if(t&&(Hg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jje(e)}function jje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uW=function(){return!!e})()}function ES(e){return ES=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ES(e)}function Dje(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$I(e,t)}function $I(e,t){return $I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},$I(e,t)}function t2(e,t,n){return t=dW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dW(e){var t=Lje(e,"string");return Hg(t)=="symbol"?t:t+""}function Lje(e,t){if(Hg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Hg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Nje=function(t){var n=t.x,o=t.y,d=t.xAxis,f=t.yAxis,_=CR({x:d.scale,y:f.scale}),i=_.apply({x:n,y:o},{bandAware:!0});return Yc(t,"discard")&&!_.isInRange(i)?null:i},r2=function(e){function t(){return Ije(this,t),Rje(this,t,arguments)}return Dje(t,e),Oje(t,[{key:"render",value:function(){var o=this.props,d=o.x,f=o.y,_=o.r,i=o.alwaysShow,S=o.clipPathId,E=fs(d),I=fs(f);if(lc(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!E||!I)return null;var M=Nje(this.props);if(!M)return null;var j=M.x,N=M.y,G=this.props,z=G.shape,V=G.className,K=Yc(this.props,"hidden")?"url(#".concat(S,")"):void 0,Q=Q5(Q5({clipPath:K},Tn(this.props,!0)),{},{cx:j,cy:N});return Le.createElement(Di,{className:ni("recharts-reference-dot",V)},t.renderDot(z,Q),Es.renderCallByParent(this.props,{x:j-_,y:N-_,width:2*_,height:2*_}))}}])}(Le.Component);t2(r2,"displayName","ReferenceDot");t2(r2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});t2(r2,"renderDot",function(e,t){var n;return Le.isValidElement(e)?n=Le.cloneElement(e,t):Vn(e)?n=e(t):n=Le.createElement(qT,BI({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),n});function VI(){return VI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},VI.apply(this,arguments)}function Wg(e){"@babel/helpers - typeof";return Wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wg(e)}function e4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function t4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?e4(Object(n),!0).forEach(function(o){n2(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function zje(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fje(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,fW(o.key),o)}}function Bje(e,t,n){return t&&Fje(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function $je(e,t,n){return t=PS(t),Vje(e,hW()?Reflect.construct(t,n||[],PS(e).constructor):t.apply(e,n))}function Vje(e,t){if(t&&(Wg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Uje(e)}function Uje(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hW=function(){return!!e})()}function PS(e){return PS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},PS(e)}function Gje(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UI(e,t)}function UI(e,t){return UI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},UI(e,t)}function n2(e,t,n){return t=fW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fW(e){var t=Hje(e,"string");return Wg(t)=="symbol"?t:t+""}function Hje(e,t){if(Wg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Wg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Wje=function(t,n,o,d,f){var _=f.x1,i=f.x2,S=f.y1,E=f.y2,I=f.xAxis,M=f.yAxis;if(!I||!M)return null;var j=CR({x:I.scale,y:M.scale}),N={x:t?j.x.apply(_,{position:"start"}):j.x.rangeMin,y:o?j.y.apply(S,{position:"start"}):j.y.rangeMin},G={x:n?j.x.apply(i,{position:"end"}):j.x.rangeMax,y:d?j.y.apply(E,{position:"end"}):j.y.rangeMax};return Yc(f,"discard")&&(!j.isInRange(N)||!j.isInRange(G))?null:QH(N,G)},i2=function(e){function t(){return zje(this,t),$je(this,t,arguments)}return Gje(t,e),Bje(t,[{key:"render",value:function(){var o=this.props,d=o.x1,f=o.x2,_=o.y1,i=o.y2,S=o.className,E=o.alwaysShow,I=o.clipPathId;lc(E===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var M=fs(d),j=fs(f),N=fs(_),G=fs(i),z=this.props.shape;if(!M&&!j&&!N&&!G&&!z)return null;var V=Wje(M,j,N,G,this.props);if(!V&&!z)return null;var K=Yc(this.props,"hidden")?"url(#".concat(I,")"):void 0;return Le.createElement(Di,{className:ni("recharts-reference-area",S)},t.renderRect(z,t4(t4({clipPath:K},Tn(this.props,!0)),V)),Es.renderCallByParent(this.props,V))}}])}(Le.Component);n2(i2,"displayName","ReferenceArea");n2(i2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});n2(i2,"renderRect",function(e,t){var n;return Le.isValidElement(e)?n=Le.cloneElement(e,t):Vn(e)?n=e(t):n=Le.createElement(PR,VI({},t,{className:"recharts-reference-area-rect"})),n});function pW(e,t,n){if(t<1)return[];if(t===1&&n===void 0)return e;for(var o=[],d=0;d<e.length;d+=t)o.push(e[d]);return o}function qje(e,t,n){var o={width:e.width+t.width,height:e.height+t.height};return $ke(o,n)}function Zje(e,t,n){var o=n==="width",d=e.x,f=e.y,_=e.width,i=e.height;return t===1?{start:o?d:f,end:o?d+_:f+i}:{start:o?d+_:f+i,end:o?d:f}}function CS(e,t,n,o,d){if(e*t<e*o||e*t>e*d)return!1;var f=n();return e*(t-e*f/2-o)>=0&&e*(t+e*f/2-d)<=0}function Kje(e,t){return pW(e,t+1)}function Xje(e,t,n,o,d){for(var f=(o||[]).slice(),_=t.start,i=t.end,S=0,E=1,I=_,M=function(){var G=o?.[S];if(G===void 0)return{v:pW(o,E)};var z=S,V,K=function(){return V===void 0&&(V=n(G,z)),V},Q=G.coordinate,X=S===0||CS(e,Q,K,I,i);X||(S=0,I=_,E+=1),X&&(I=Q+e*(K()/2+d),S+=E)},j;E<=f.length;)if(j=M(),j)return j.v;return[]}function H0(e){"@babel/helpers - typeof";return H0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H0(e)}function r4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Us(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?r4(Object(n),!0).forEach(function(o){Yje(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Yje(e,t,n){return t=Jje(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jje(e){var t=Qje(e,"string");return H0(t)=="symbol"?t:t+""}function Qje(e,t){if(H0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(H0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function eDe(e,t,n,o,d){for(var f=(o||[]).slice(),_=f.length,i=t.start,S=t.end,E=function(j){var N=f[j],G,z=function(){return G===void 0&&(G=n(N,j)),G};if(j===_-1){var V=e*(N.coordinate+e*z()/2-S);f[j]=N=Us(Us({},N),{},{tickCoord:V>0?N.coordinate-V*e:N.coordinate})}else f[j]=N=Us(Us({},N),{},{tickCoord:N.coordinate});var K=CS(e,N.tickCoord,z,i,S);K&&(S=N.tickCoord-e*(z()/2+d),f[j]=Us(Us({},N),{},{isShow:!0}))},I=_-1;I>=0;I--)E(I);return f}function tDe(e,t,n,o,d,f){var _=(o||[]).slice(),i=_.length,S=t.start,E=t.end;if(f){var I=o[i-1],M=n(I,i-1),j=e*(I.coordinate+e*M/2-E);_[i-1]=I=Us(Us({},I),{},{tickCoord:j>0?I.coordinate-j*e:I.coordinate});var N=CS(e,I.tickCoord,function(){return M},S,E);N&&(E=I.tickCoord-e*(M/2+d),_[i-1]=Us(Us({},I),{},{isShow:!0}))}for(var G=f?i-1:i,z=function(Q){var X=_[Q],ie,J=function(){return ie===void 0&&(ie=n(X,Q)),ie};if(Q===0){var se=e*(X.coordinate-e*J()/2-S);_[Q]=X=Us(Us({},X),{},{tickCoord:se<0?X.coordinate-se*e:X.coordinate})}else _[Q]=X=Us(Us({},X),{},{tickCoord:X.coordinate});var he=CS(e,X.tickCoord,J,S,E);he&&(S=X.tickCoord+e*(J()/2+d),_[Q]=Us(Us({},X),{},{isShow:!0}))},V=0;V<G;V++)z(V);return _}function DR(e,t,n){var o=e.tick,d=e.ticks,f=e.viewBox,_=e.minTickGap,i=e.orientation,S=e.interval,E=e.tickFormatter,I=e.unit,M=e.angle;if(!d||!d.length||!o)return[];if(vr(S)||Kc.isSsr)return Kje(d,typeof S=="number"&&vr(S)?S:0);var j=[],N=i==="top"||i==="bottom"?"width":"height",G=I&&N==="width"?Kv(I,{fontSize:t,letterSpacing:n}):{width:0,height:0},z=function(X,ie){var J=Vn(E)?E(X.value,ie):X.value;return N==="width"?qje(Kv(J,{fontSize:t,letterSpacing:n}),G,M):Kv(J,{fontSize:t,letterSpacing:n})[N]},V=d.length>=2?ia(d[1].coordinate-d[0].coordinate):1,K=Zje(f,V,N);return S==="equidistantPreserveStart"?Xje(V,K,z,d,_):(S==="preserveStart"||S==="preserveStartEnd"?j=tDe(V,K,z,d,_,S==="preserveStartEnd"):j=eDe(V,K,z,d,_),j.filter(function(Q){return Q.isShow}))}var rDe=["viewBox"],nDe=["viewBox"],iDe=["ticks"];function qg(e){"@babel/helpers - typeof";return qg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qg(e)}function cg(){return cg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},cg.apply(this,arguments)}function n4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function ls(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?n4(Object(n),!0).forEach(function(o){LR(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):n4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function TP(e,t){if(e==null)return{};var n=oDe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function oDe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function sDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i4(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,gW(o.key),o)}}function aDe(e,t,n){return t&&i4(e.prototype,t),n&&i4(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function lDe(e,t,n){return t=IS(t),cDe(e,mW()?Reflect.construct(t,n||[],IS(e).constructor):t.apply(e,n))}function cDe(e,t){if(t&&(qg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uDe(e)}function uDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mW=function(){return!!e})()}function IS(e){return IS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},IS(e)}function dDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GI(e,t)}function GI(e,t){return GI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},GI(e,t)}function LR(e,t,n){return t=gW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gW(e){var t=hDe(e,"string");return qg(t)=="symbol"?t:t+""}function hDe(e,t){if(qg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(qg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Sy=function(e){function t(n){var o;return sDe(this,t),o=lDe(this,t,[n]),o.state={fontSize:"",letterSpacing:""},o}return dDe(t,e),aDe(t,[{key:"shouldComponentUpdate",value:function(o,d){var f=o.viewBox,_=TP(o,rDe),i=this.props,S=i.viewBox,E=TP(i,nDe);return!_g(f,S)||!_g(_,E)||!_g(d,this.state)}},{key:"componentDidMount",value:function(){var o=this.layerReference;if(o){var d=o.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];d&&this.setState({fontSize:window.getComputedStyle(d).fontSize,letterSpacing:window.getComputedStyle(d).letterSpacing})}}},{key:"getTickLineCoord",value:function(o){var d=this.props,f=d.x,_=d.y,i=d.width,S=d.height,E=d.orientation,I=d.tickSize,M=d.mirror,j=d.tickMargin,N,G,z,V,K,Q,X=M?-1:1,ie=o.tickSize||I,J=vr(o.tickCoord)?o.tickCoord:o.coordinate;switch(E){case"top":N=G=o.coordinate,V=_+ +!M*S,z=V-X*ie,Q=z-X*j,K=J;break;case"left":z=V=o.coordinate,G=f+ +!M*i,N=G-X*ie,K=N-X*j,Q=J;break;case"right":z=V=o.coordinate,G=f+ +M*i,N=G+X*ie,K=N+X*j,Q=J;break;default:N=G=o.coordinate,V=_+ +M*S,z=V+X*ie,Q=z+X*j,K=J;break}return{line:{x1:N,y1:z,x2:G,y2:V},tick:{x:K,y:Q}}}},{key:"getTickTextAnchor",value:function(){var o=this.props,d=o.orientation,f=o.mirror,_;switch(d){case"left":_=f?"start":"end";break;case"right":_=f?"end":"start";break;default:_="middle";break}return _}},{key:"getTickVerticalAnchor",value:function(){var o=this.props,d=o.orientation,f=o.mirror,_="end";switch(d){case"left":case"right":_="middle";break;case"top":_=f?"start":"end";break;default:_=f?"end":"start";break}return _}},{key:"renderAxisLine",value:function(){var o=this.props,d=o.x,f=o.y,_=o.width,i=o.height,S=o.orientation,E=o.mirror,I=o.axisLine,M=ls(ls(ls({},Tn(this.props,!1)),Tn(I,!1)),{},{fill:"none"});if(S==="top"||S==="bottom"){var j=+(S==="top"&&!E||S==="bottom"&&E);M=ls(ls({},M),{},{x1:d,y1:f+j*i,x2:d+_,y2:f+j*i})}else{var N=+(S==="left"&&!E||S==="right"&&E);M=ls(ls({},M),{},{x1:d+N*_,y1:f,x2:d+N*_,y2:f+i})}return Le.createElement("line",cg({},M,{className:ni("recharts-cartesian-axis-line",Ka(I,"className"))}))}},{key:"renderTicks",value:function(o,d,f){var _=this,i=this.props,S=i.tickLine,E=i.stroke,I=i.tick,M=i.tickFormatter,j=i.unit,N=DR(ls(ls({},this.props),{},{ticks:o}),d,f),G=this.getTickTextAnchor(),z=this.getTickVerticalAnchor(),V=Tn(this.props,!1),K=Tn(I,!1),Q=ls(ls({},V),{},{fill:"none"},Tn(S,!1)),X=N.map(function(ie,J){var se=_.getTickLineCoord(ie),he=se.line,we=se.tick,ze=ls(ls(ls(ls({textAnchor:G,verticalAnchor:z},V),{},{stroke:"none",fill:E},K),we),{},{index:J,payload:ie,visibleTicksCount:N.length,tickFormatter:M});return Le.createElement(Di,cg({className:"recharts-cartesian-axis-tick",key:"tick-".concat(ie.value,"-").concat(ie.coordinate,"-").concat(ie.tickCoord)},Vf(_.props,ie,J)),S&&Le.createElement("line",cg({},Q,he,{className:ni("recharts-cartesian-axis-tick-line",Ka(S,"className"))})),I&&t.renderTickItem(I,ze,"".concat(Vn(M)?M(ie.value,J):ie.value).concat(j||"")))});return Le.createElement("g",{className:"recharts-cartesian-axis-ticks"},X)}},{key:"render",value:function(){var o=this,d=this.props,f=d.axisLine,_=d.width,i=d.height,S=d.ticksGenerator,E=d.className,I=d.hide;if(I)return null;var M=this.props,j=M.ticks,N=TP(M,iDe),G=j;return Vn(S)&&(G=j&&j.length>0?S(this.props):S(N)),_<=0||i<=0||!G||!G.length?null:Le.createElement(Di,{className:ni("recharts-cartesian-axis",E),ref:function(V){o.layerReference=V}},f&&this.renderAxisLine(),this.renderTicks(G,this.state.fontSize,this.state.letterSpacing),Es.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(o,d,f){var _,i=ni(d.className,"recharts-cartesian-axis-tick-value");return Le.isValidElement(o)?_=Le.cloneElement(o,ls(ls({},d),{},{className:i})):Vn(o)?_=o(ls(ls({},d),{},{className:i})):_=Le.createElement(Uf,cg({},d,{className:"recharts-cartesian-axis-tick-value"}),f),_}}])}(B.Component);LR(Sy,"displayName","CartesianAxis");LR(Sy,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var fDe=["x1","y1","x2","y2","key"],pDe=["offset"];function Wf(e){"@babel/helpers - typeof";return Wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wf(e)}function o4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Gs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o4(Object(n),!0).forEach(function(o){mDe(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function mDe(e,t,n){return t=gDe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gDe(e){var t=yDe(e,"string");return Wf(t)=="symbol"?t:t+""}function yDe(e,t){if(Wf(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Wf(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ef(){return Ef=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ef.apply(this,arguments)}function s4(e,t){if(e==null)return{};var n=_De(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function _De(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}var vDe=function(t){var n=t.fill;if(!n||n==="none")return null;var o=t.fillOpacity,d=t.x,f=t.y,_=t.width,i=t.height,S=t.ry;return Le.createElement("rect",{x:d,y:f,ry:S,width:_,height:i,stroke:"none",fill:n,fillOpacity:o,className:"recharts-cartesian-grid-bg"})};function yW(e,t){var n;if(Le.isValidElement(e))n=Le.cloneElement(e,t);else if(Vn(e))n=e(t);else{var o=t.x1,d=t.y1,f=t.x2,_=t.y2,i=t.key,S=s4(t,fDe),E=Tn(S,!1);E.offset;var I=s4(E,pDe);n=Le.createElement("line",Ef({},I,{x1:o,y1:d,x2:f,y2:_,fill:"none",key:i}))}return n}function xDe(e){var t=e.x,n=e.width,o=e.horizontal,d=o===void 0?!0:o,f=e.horizontalPoints;if(!d||!f||!f.length)return null;var _=f.map(function(i,S){var E=Gs(Gs({},e),{},{x1:t,y1:i,x2:t+n,y2:i,key:"line-".concat(S),index:S});return yW(d,E)});return Le.createElement("g",{className:"recharts-cartesian-grid-horizontal"},_)}function bDe(e){var t=e.y,n=e.height,o=e.vertical,d=o===void 0?!0:o,f=e.verticalPoints;if(!d||!f||!f.length)return null;var _=f.map(function(i,S){var E=Gs(Gs({},e),{},{x1:i,y1:t,x2:i,y2:t+n,key:"line-".concat(S),index:S});return yW(d,E)});return Le.createElement("g",{className:"recharts-cartesian-grid-vertical"},_)}function wDe(e){var t=e.horizontalFill,n=e.fillOpacity,o=e.x,d=e.y,f=e.width,_=e.height,i=e.horizontalPoints,S=e.horizontal,E=S===void 0?!0:S;if(!E||!t||!t.length)return null;var I=i.map(function(j){return Math.round(j+d-d)}).sort(function(j,N){return j-N});d!==I[0]&&I.unshift(0);var M=I.map(function(j,N){var G=!I[N+1],z=G?d+_-j:I[N+1]-j;if(z<=0)return null;var V=N%t.length;return Le.createElement("rect",{key:"react-".concat(N),y:j,x:o,height:z,width:f,stroke:"none",fill:t[V],fillOpacity:n,className:"recharts-cartesian-grid-bg"})});return Le.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},M)}function SDe(e){var t=e.vertical,n=t===void 0?!0:t,o=e.verticalFill,d=e.fillOpacity,f=e.x,_=e.y,i=e.width,S=e.height,E=e.verticalPoints;if(!n||!o||!o.length)return null;var I=E.map(function(j){return Math.round(j+f-f)}).sort(function(j,N){return j-N});f!==I[0]&&I.unshift(0);var M=I.map(function(j,N){var G=!I[N+1],z=G?f+i-j:I[N+1]-j;if(z<=0)return null;var V=N%o.length;return Le.createElement("rect",{key:"react-".concat(N),x:j,y:_,width:z,height:S,stroke:"none",fill:o[V],fillOpacity:d,className:"recharts-cartesian-grid-bg"})});return Le.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},M)}var TDe=function(t,n){var o=t.xAxis,d=t.width,f=t.height,_=t.offset;return fH(DR(Gs(Gs(Gs({},Sy.defaultProps),o),{},{ticks:zu(o,!0),viewBox:{x:0,y:0,width:d,height:f}})),_.left,_.left+_.width,n)},ADe=function(t,n){var o=t.yAxis,d=t.width,f=t.height,_=t.offset;return fH(DR(Gs(Gs(Gs({},Sy.defaultProps),o),{},{ticks:zu(o,!0),viewBox:{x:0,y:0,width:d,height:f}})),_.top,_.top+_.height,n)},Jm={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function NR(e){var t,n,o,d,f,_,i=OR(),S=RR(),E=hje(),I=Gs(Gs({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Jm.stroke,fill:(n=e.fill)!==null&&n!==void 0?n:Jm.fill,horizontal:(o=e.horizontal)!==null&&o!==void 0?o:Jm.horizontal,horizontalFill:(d=e.horizontalFill)!==null&&d!==void 0?d:Jm.horizontalFill,vertical:(f=e.vertical)!==null&&f!==void 0?f:Jm.vertical,verticalFill:(_=e.verticalFill)!==null&&_!==void 0?_:Jm.verticalFill,x:vr(e.x)?e.x:E.left,y:vr(e.y)?e.y:E.top,width:vr(e.width)?e.width:E.width,height:vr(e.height)?e.height:E.height}),M=I.x,j=I.y,N=I.width,G=I.height,z=I.syncWithTicks,V=I.horizontalValues,K=I.verticalValues,Q=cje(),X=uje();if(!vr(N)||N<=0||!vr(G)||G<=0||!vr(M)||M!==+M||!vr(j)||j!==+j)return null;var ie=I.verticalCoordinatesGenerator||TDe,J=I.horizontalCoordinatesGenerator||ADe,se=I.horizontalPoints,he=I.verticalPoints;if((!se||!se.length)&&Vn(J)){var we=V&&V.length,ze=J({yAxis:X?Gs(Gs({},X),{},{ticks:we?V:X.ticks}):void 0,width:i,height:S,offset:E},we?!0:z);lc(Array.isArray(ze),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Wf(ze),"]")),Array.isArray(ze)&&(se=ze)}if((!he||!he.length)&&Vn(ie)){var je=K&&K.length,Oe=ie({xAxis:Q?Gs(Gs({},Q),{},{ticks:je?K:Q.ticks}):void 0,width:i,height:S,offset:E},je?!0:z);lc(Array.isArray(Oe),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Wf(Oe),"]")),Array.isArray(Oe)&&(he=Oe)}return Le.createElement("g",{className:"recharts-cartesian-grid"},Le.createElement(vDe,{fill:I.fill,fillOpacity:I.fillOpacity,x:I.x,y:I.y,width:I.width,height:I.height,ry:I.ry}),Le.createElement(xDe,Ef({},I,{offset:E,horizontalPoints:se,xAxis:Q,yAxis:X})),Le.createElement(bDe,Ef({},I,{offset:E,verticalPoints:he,xAxis:Q,yAxis:X})),Le.createElement(wDe,Ef({},I,{horizontalPoints:se})),Le.createElement(SDe,Ef({},I,{verticalPoints:he})))}NR.displayName="CartesianGrid";var EDe=["type","layout","connectNulls","ref"],PDe=["key"];function Zg(e){"@babel/helpers - typeof";return Zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zg(e)}function a4(e,t){if(e==null)return{};var n=CDe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function CDe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function t0(){return t0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},t0.apply(this,arguments)}function l4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function $a(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?l4(Object(n),!0).forEach(function(o){ic(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Qm(e){return RDe(e)||ODe(e)||MDe(e)||IDe()}function IDe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MDe(e,t){if(e){if(typeof e=="string")return HI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return HI(e,t)}}function ODe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function RDe(e){if(Array.isArray(e))return HI(e)}function HI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function kDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c4(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,vW(o.key),o)}}function jDe(e,t,n){return t&&c4(e.prototype,t),n&&c4(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function DDe(e,t,n){return t=MS(t),LDe(e,_W()?Reflect.construct(t,n||[],MS(e).constructor):t.apply(e,n))}function LDe(e,t){if(t&&(Zg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NDe(e)}function NDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_W=function(){return!!e})()}function MS(e){return MS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},MS(e)}function zDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WI(e,t)}function WI(e,t){return WI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},WI(e,t)}function ic(e,t,n){return t=vW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vW(e){var t=FDe(e,"string");return Zg(t)=="symbol"?t:t+""}function FDe(e,t){if(Zg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Zg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ty=function(e){function t(){var n;kDe(this,t);for(var o=arguments.length,d=new Array(o),f=0;f<o;f++)d[f]=arguments[f];return n=DDe(this,t,[].concat(d)),ic(n,"state",{isAnimationFinished:!0,totalLength:0}),ic(n,"generateSimpleStrokeDasharray",function(_,i){return"".concat(i,"px ").concat(_-i,"px")}),ic(n,"getStrokeDasharray",function(_,i,S){var E=S.reduce(function(K,Q){return K+Q});if(!E)return n.generateSimpleStrokeDasharray(i,_);for(var I=Math.floor(_/E),M=_%E,j=i-_,N=[],G=0,z=0;G<S.length;z+=S[G],++G)if(z+S[G]>M){N=[].concat(Qm(S.slice(0,G)),[M-z]);break}var V=N.length%2===0?[0,j]:[j];return[].concat(Qm(t.repeat(S,I)),Qm(N),V).map(function(K){return"".concat(K,"px")}).join(", ")}),ic(n,"id",gy("recharts-line-")),ic(n,"pathRef",function(_){n.mainCurve=_}),ic(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),ic(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return zDe(t,e),jDe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();this.setState({totalLength:o})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var o=this.getTotalLength();o!==this.state.totalLength&&this.setState({totalLength:o})}}},{key:"getTotalLength",value:function(){var o=this.mainCurve;try{return o&&o.getTotalLength&&o.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(o,d){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var f=this.props,_=f.points,i=f.xAxis,S=f.yAxis,E=f.layout,I=f.children,M=Xa(I,yx);if(!M)return null;var j=function(z,V){return{x:z.x,y:z.y,value:z.value,errorVal:hs(z.payload,V)}},N={clipPath:o?"url(#clipPath-".concat(d,")"):null};return Le.createElement(Di,N,M.map(function(G){return Le.cloneElement(G,{key:"bar-".concat(G.props.dataKey),data:_,xAxis:i,yAxis:S,layout:E,dataPointFormatter:j})}))}},{key:"renderDots",value:function(o,d,f){var _=this.props.isAnimationActive;if(_&&!this.state.isAnimationFinished)return null;var i=this.props,S=i.dot,E=i.points,I=i.dataKey,M=Tn(this.props,!1),j=Tn(S,!0),N=E.map(function(z,V){var K=$a($a($a({key:"dot-".concat(V),r:3},M),j),{},{index:V,cx:z.x,cy:z.y,value:z.value,dataKey:I,payload:z.payload,points:E});return t.renderDotItem(S,K)}),G={clipPath:o?"url(#clipPath-".concat(d?"":"dots-").concat(f,")"):null};return Le.createElement(Di,t0({className:"recharts-line-dots",key:"dots"},G),N)}},{key:"renderCurveStatically",value:function(o,d,f,_){var i=this.props,S=i.type,E=i.layout,I=i.connectNulls;i.ref;var M=a4(i,EDe),j=$a($a($a({},Tn(M,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:d?"url(#clipPath-".concat(f,")"):null,points:o},_),{},{type:S,layout:E,connectNulls:I});return Le.createElement(uS,t0({},j,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(o,d){var f=this,_=this.props,i=_.points,S=_.strokeDasharray,E=_.isAnimationActive,I=_.animationBegin,M=_.animationDuration,j=_.animationEasing,N=_.animationId,G=_.animateNewValues,z=_.width,V=_.height,K=this.state,Q=K.prevPoints,X=K.totalLength;return Le.createElement(nu,{begin:I,duration:M,isActive:E,easing:j,from:{t:0},to:{t:1},key:"line-".concat(N),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(ie){var J=ie.t;if(Q){var se=Q.length/i.length,he=i.map(function(Be,qe){var Xe=Math.floor(qe*se);if(Q[Xe]){var it=Q[Xe],Ge=Wa(it.x,Be.x),Ke=Wa(it.y,Be.y);return $a($a({},Be),{},{x:Ge(J),y:Ke(J)})}if(G){var ut=Wa(z*2,Be.x),rt=Wa(V/2,Be.y);return $a($a({},Be),{},{x:ut(J),y:rt(J)})}return $a($a({},Be),{},{x:Be.x,y:Be.y})});return f.renderCurveStatically(he,o,d)}var we=Wa(0,X),ze=we(J),je;if(S){var Oe="".concat(S).split(/[,\s]+/gim).map(function(Be){return parseFloat(Be)});je=f.getStrokeDasharray(ze,X,Oe)}else je=f.generateSimpleStrokeDasharray(X,ze);return f.renderCurveStatically(i,o,d,{strokeDasharray:je})})}},{key:"renderCurve",value:function(o,d){var f=this.props,_=f.points,i=f.isAnimationActive,S=this.state,E=S.prevPoints,I=S.totalLength;return i&&_&&_.length&&(!E&&I>0||!gx(E,_))?this.renderCurveWithAnimation(o,d):this.renderCurveStatically(_,o,d)}},{key:"render",value:function(){var o,d=this.props,f=d.hide,_=d.dot,i=d.points,S=d.className,E=d.xAxis,I=d.yAxis,M=d.top,j=d.left,N=d.width,G=d.height,z=d.isAnimationActive,V=d.id;if(f||!i||!i.length)return null;var K=this.state.isAnimationFinished,Q=i.length===1,X=ni("recharts-line",S),ie=E&&E.allowDataOverflow,J=I&&I.allowDataOverflow,se=ie||J,he=Jn(V)?this.id:V,we=(o=Tn(_,!1))!==null&&o!==void 0?o:{r:3,strokeWidth:2},ze=we.r,je=ze===void 0?3:ze,Oe=we.strokeWidth,Be=Oe===void 0?2:Oe,qe=lme(_)?_:{},Xe=qe.clipDot,it=Xe===void 0?!0:Xe,Ge=je*2+Be;return Le.createElement(Di,{className:X},ie||J?Le.createElement("defs",null,Le.createElement("clipPath",{id:"clipPath-".concat(he)},Le.createElement("rect",{x:ie?j:j-N/2,y:J?M:M-G/2,width:ie?N:N*2,height:J?G:G*2})),!it&&Le.createElement("clipPath",{id:"clipPath-dots-".concat(he)},Le.createElement("rect",{x:j-Ge/2,y:M-Ge/2,width:N+Ge,height:G+Ge}))):null,!Q&&this.renderCurve(se,he),this.renderErrorBar(se,he),(Q||_)&&this.renderDots(se,it,he),(!z||K)&&Gu.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(o,d){return o.animationId!==d.prevAnimationId?{prevAnimationId:o.animationId,curPoints:o.points,prevPoints:d.curPoints}:o.points!==d.curPoints?{curPoints:o.points}:null}},{key:"repeat",value:function(o,d){for(var f=o.length%2!==0?[].concat(Qm(o),[0]):o,_=[],i=0;i<d;++i)_=[].concat(Qm(_),Qm(f));return _}},{key:"renderDotItem",value:function(o,d){var f;if(Le.isValidElement(o))f=Le.cloneElement(o,d);else if(Vn(o))f=o(d);else{var _=d.key,i=a4(d,PDe),S=ni("recharts-line-dot",typeof o!="boolean"?o.className:"");f=Le.createElement(qT,t0({key:_},i,{className:S}))}return f}}])}(B.PureComponent);ic(Ty,"displayName","Line");ic(Ty,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Kc.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});ic(Ty,"getComposedData",function(e){var t=e.props,n=e.xAxis,o=e.yAxis,d=e.xAxisTicks,f=e.yAxisTicks,_=e.dataKey,i=e.bandSize,S=e.displayedData,E=e.offset,I=t.layout,M=S.map(function(j,N){var G=hs(j,_);return I==="horizontal"?{x:kB({axis:n,ticks:d,bandSize:i,entry:j,index:N}),y:Jn(G)?null:o.scale(G),value:G,payload:j}:{x:Jn(G)?null:n.scale(G),y:kB({axis:o,ticks:f,bandSize:i,entry:j,index:N}),value:G,payload:j}});return $a({points:M,layout:I},E)});function Kg(e){"@babel/helpers - typeof";return Kg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kg(e)}function BDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $De(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,wW(o.key),o)}}function VDe(e,t,n){return t&&$De(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function UDe(e,t,n){return t=OS(t),GDe(e,xW()?Reflect.construct(t,n||[],OS(e).constructor):t.apply(e,n))}function GDe(e,t){if(t&&(Kg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return HDe(e)}function HDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xW=function(){return!!e})()}function OS(e){return OS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},OS(e)}function WDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&qI(e,t)}function qI(e,t){return qI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},qI(e,t)}function bW(e,t,n){return t=wW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wW(e){var t=qDe(e,"string");return Kg(t)=="symbol"?t:t+""}function qDe(e,t){if(Kg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Kg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZI(){return ZI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ZI.apply(this,arguments)}function ZDe(e){var t=e.xAxisId,n=OR(),o=RR(),d=sW(t);return d==null?null:B.createElement(Sy,ZI({},d,{className:ni("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:n,height:o},ticksGenerator:function(_){return zu(_,!0)}}))}var qf=function(e){function t(){return BDe(this,t),UDe(this,t,arguments)}return WDe(t,e),VDe(t,[{key:"render",value:function(){return B.createElement(ZDe,this.props)}}])}(B.Component);bW(qf,"displayName","XAxis");bW(qf,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Xg(e){"@babel/helpers - typeof";return Xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xg(e)}function KDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XDe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,AW(o.key),o)}}function YDe(e,t,n){return t&&XDe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function JDe(e,t,n){return t=RS(t),QDe(e,SW()?Reflect.construct(t,n||[],RS(e).constructor):t.apply(e,n))}function QDe(e,t){if(t&&(Xg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eLe(e)}function eLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function SW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(SW=function(){return!!e})()}function RS(e){return RS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},RS(e)}function tLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KI(e,t)}function KI(e,t){return KI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},KI(e,t)}function TW(e,t,n){return t=AW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function AW(e){var t=rLe(e,"string");return Xg(t)=="symbol"?t:t+""}function rLe(e,t){if(Xg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Xg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function XI(){return XI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},XI.apply(this,arguments)}var nLe=function(t){var n=t.yAxisId,o=OR(),d=RR(),f=aW(n);return f==null?null:B.createElement(Sy,XI({},f,{className:ni("recharts-".concat(f.axisType," ").concat(f.axisType),f.className),viewBox:{x:0,y:0,width:o,height:d},ticksGenerator:function(i){return zu(i,!0)}}))},Zf=function(e){function t(){return KDe(this,t),JDe(this,t,arguments)}return tLe(t,e),YDe(t,[{key:"render",value:function(){return B.createElement(nLe,this.props)}}])}(B.Component);TW(Zf,"displayName","YAxis");TW(Zf,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function u4(e){return aLe(e)||sLe(e)||oLe(e)||iLe()}function iLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oLe(e,t){if(e){if(typeof e=="string")return YI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return YI(e,t)}}function sLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function aLe(e){if(Array.isArray(e))return YI(e)}function YI(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var JI=function(t,n,o,d,f){var _=Xa(t,jR),i=Xa(t,r2),S=[].concat(u4(_),u4(i)),E=Xa(t,i2),I="".concat(d,"Id"),M=d[0],j=n;if(S.length&&(j=S.reduce(function(z,V){if(V.props[I]===o&&Yc(V.props,"extendDomain")&&vr(V.props[M])){var K=V.props[M];return[Math.min(z[0],K),Math.max(z[1],K)]}return z},j)),E.length){var N="".concat(M,"1"),G="".concat(M,"2");j=E.reduce(function(z,V){if(V.props[I]===o&&Yc(V.props,"extendDomain")&&vr(V.props[N])&&vr(V.props[G])){var K=V.props[N],Q=V.props[G];return[Math.min(z[0],K,Q),Math.max(z[1],K,Q)]}return z},j)}return f&&f.length&&(j=f.reduce(function(z,V){return vr(V)?[Math.min(z[0],V),Math.max(z[1],V)]:z},j)),j},EW={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1));function d(S,E,I){this.fn=S,this.context=E,this.once=I||!1}function f(S,E,I,M,j){if(typeof I!="function")throw new TypeError("The listener must be a function");var N=new d(I,M||S,j),G=n?n+E:E;return S._events[G]?S._events[G].fn?S._events[G]=[S._events[G],N]:S._events[G].push(N):(S._events[G]=N,S._eventsCount++),S}function _(S,E){--S._eventsCount===0?S._events=new o:delete S._events[E]}function i(){this._events=new o,this._eventsCount=0}i.prototype.eventNames=function(){var E=[],I,M;if(this._eventsCount===0)return E;for(M in I=this._events)t.call(I,M)&&E.push(n?M.slice(1):M);return Object.getOwnPropertySymbols?E.concat(Object.getOwnPropertySymbols(I)):E},i.prototype.listeners=function(E){var I=n?n+E:E,M=this._events[I];if(!M)return[];if(M.fn)return[M.fn];for(var j=0,N=M.length,G=new Array(N);j<N;j++)G[j]=M[j].fn;return G},i.prototype.listenerCount=function(E){var I=n?n+E:E,M=this._events[I];return M?M.fn?1:M.length:0},i.prototype.emit=function(E,I,M,j,N,G){var z=n?n+E:E;if(!this._events[z])return!1;var V=this._events[z],K=arguments.length,Q,X;if(V.fn){switch(V.once&&this.removeListener(E,V.fn,void 0,!0),K){case 1:return V.fn.call(V.context),!0;case 2:return V.fn.call(V.context,I),!0;case 3:return V.fn.call(V.context,I,M),!0;case 4:return V.fn.call(V.context,I,M,j),!0;case 5:return V.fn.call(V.context,I,M,j,N),!0;case 6:return V.fn.call(V.context,I,M,j,N,G),!0}for(X=1,Q=new Array(K-1);X<K;X++)Q[X-1]=arguments[X];V.fn.apply(V.context,Q)}else{var ie=V.length,J;for(X=0;X<ie;X++)switch(V[X].once&&this.removeListener(E,V[X].fn,void 0,!0),K){case 1:V[X].fn.call(V[X].context);break;case 2:V[X].fn.call(V[X].context,I);break;case 3:V[X].fn.call(V[X].context,I,M);break;case 4:V[X].fn.call(V[X].context,I,M,j);break;default:if(!Q)for(J=1,Q=new Array(K-1);J<K;J++)Q[J-1]=arguments[J];V[X].fn.apply(V[X].context,Q)}}return!0},i.prototype.on=function(E,I,M){return f(this,E,I,M,!1)},i.prototype.once=function(E,I,M){return f(this,E,I,M,!0)},i.prototype.removeListener=function(E,I,M,j){var N=n?n+E:E;if(!this._events[N])return this;if(!I)return _(this,N),this;var G=this._events[N];if(G.fn)G.fn===I&&(!j||G.once)&&(!M||G.context===M)&&_(this,N);else{for(var z=0,V=[],K=G.length;z<K;z++)(G[z].fn!==I||j&&!G[z].once||M&&G[z].context!==M)&&V.push(G[z]);V.length?this._events[N]=V.length===1?V[0]:V:_(this,N)}return this},i.prototype.removeAllListeners=function(E){var I;return E?(I=n?n+E:E,this._events[I]&&_(this,I)):(this._events=new o,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=n,i.EventEmitter=i,e.exports=i})(EW);var lLe=EW.exports;const cLe=Ni(lLe);var AP=new cLe,EP="recharts.syncMouseEvents";function W0(e){"@babel/helpers - typeof";return W0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W0(e)}function uLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dLe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,PW(o.key),o)}}function hLe(e,t,n){return t&&dLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function PP(e,t,n){return t=PW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function PW(e){var t=fLe(e,"string");return W0(t)=="symbol"?t:t+""}function fLe(e,t){if(W0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(W0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pLe=function(){function e(){uLe(this,e),PP(this,"activeIndex",0),PP(this,"coordinateList",[]),PP(this,"layout","horizontal")}return hLe(e,[{key:"setDetails",value:function(n){var o,d=n.coordinateList,f=d===void 0?null:d,_=n.container,i=_===void 0?null:_,S=n.layout,E=S===void 0?null:S,I=n.offset,M=I===void 0?null:I,j=n.mouseHandlerCallback,N=j===void 0?null:j;this.coordinateList=(o=f??this.coordinateList)!==null&&o!==void 0?o:[],this.container=i??this.container,this.layout=E??this.layout,this.offset=M??this.offset,this.mouseHandlerCallback=N??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(n){if(this.coordinateList.length!==0)switch(n.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(n){this.activeIndex=n}},{key:"spoofMouse",value:function(){var n,o;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var d=this.container.getBoundingClientRect(),f=d.x,_=d.y,i=d.height,S=this.coordinateList[this.activeIndex].coordinate,E=((n=window)===null||n===void 0?void 0:n.scrollX)||0,I=((o=window)===null||o===void 0?void 0:o.scrollY)||0,M=f+S+E,j=_+this.offset.top+i/2+I;this.mouseHandlerCallback({pageX:M,pageY:j})}}}])}();function mLe(e,t,n){if(n==="number"&&t===!0&&Array.isArray(e)){var o=e?.[0],d=e?.[1];if(o&&d&&vr(o)&&vr(d))return!0}return!1}function gLe(e,t,n,o){var d=o/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-d:n.left+.5,y:e==="horizontal"?n.top+.5:t.y-d,width:e==="horizontal"?o:n.width-1,height:e==="horizontal"?n.height-1:o}}function CW(e){var t=e.cx,n=e.cy,o=e.radius,d=e.startAngle,f=e.endAngle,_=lo(t,n,o,d),i=lo(t,n,o,f);return{points:[_,i],cx:t,cy:n,radius:o,startAngle:d,endAngle:f}}function yLe(e,t,n){var o,d,f,_;if(e==="horizontal")o=t.x,f=o,d=n.top,_=n.top+n.height;else if(e==="vertical")d=t.y,_=d,o=n.left,f=n.left+n.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,S=t.cy,E=t.innerRadius,I=t.outerRadius,M=t.angle,j=lo(i,S,E,M),N=lo(i,S,I,M);o=j.x,d=j.y,f=N.x,_=N.y}else return CW(t);return[{x:o,y:d},{x:f,y:_}]}function q0(e){"@babel/helpers - typeof";return q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q0(e)}function d4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function W1(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d4(Object(n),!0).forEach(function(o){_Le(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function _Le(e,t,n){return t=vLe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vLe(e){var t=xLe(e,"string");return q0(t)=="symbol"?t:t+""}function xLe(e,t){if(q0(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(q0(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bLe(e){var t,n,o=e.element,d=e.tooltipEventType,f=e.isActive,_=e.activeCoordinate,i=e.activePayload,S=e.offset,E=e.activeTooltipIndex,I=e.tooltipAxisBandSize,M=e.layout,j=e.chartName,N=(t=o.props.cursor)!==null&&t!==void 0?t:(n=o.type.defaultProps)===null||n===void 0?void 0:n.cursor;if(!o||!N||!f||!_||j!=="ScatterChart"&&d!=="axis")return null;var G,z=uS;if(j==="ScatterChart")G=_,z=FMe;else if(j==="BarChart")G=gLe(M,_,S,I),z=PR;else if(M==="radial"){var V=CW(_),K=V.cx,Q=V.cy,X=V.radius,ie=V.startAngle,J=V.endAngle;G={cx:K,cy:Q,startAngle:ie,endAngle:J,innerRadius:X,outerRadius:X},z=TH}else G={points:yLe(M,_,S)},z=uS;var se=W1(W1(W1(W1({stroke:"#ccc",pointerEvents:"none"},S),G),Tn(N,!1)),{},{payload:i,payloadIndex:E,className:ni("recharts-tooltip-cursor",N.className)});return B.isValidElement(N)?B.cloneElement(N,se):B.createElement(z,se)}var wLe=["item"],SLe=["children","className","width","height","style","compact","title","desc"];function Yg(e){"@babel/helpers - typeof";return Yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yg(e)}function ug(){return ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ug.apply(this,arguments)}function h4(e,t){return ELe(e)||ALe(e,t)||MW(e,t)||TLe()}function TLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ALe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o,d,f,_,i=[],S=!0,E=!1;try{if(f=(n=n.call(e)).next,t!==0)for(;!(S=(o=f.call(n)).done)&&(i.push(o.value),i.length!==t);S=!0);}catch(I){E=!0,d=I}finally{try{if(!S&&n.return!=null&&(_=n.return(),Object(_)!==_))return}finally{if(E)throw d}}return i}}function ELe(e){if(Array.isArray(e))return e}function f4(e,t){if(e==null)return{};var n=PLe(e,t),o,d;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(d=0;d<f.length;d++)o=f[d],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function PLe(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function CLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ILe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,OW(o.key),o)}}function MLe(e,t,n){return t&&ILe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function OLe(e,t,n){return t=kS(t),RLe(e,IW()?Reflect.construct(t,n||[],kS(e).constructor):t.apply(e,n))}function RLe(e,t){if(t&&(Yg(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kLe(e)}function kLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function IW(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(IW=function(){return!!e})()}function kS(e){return kS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},kS(e)}function jLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&QI(e,t)}function QI(e,t){return QI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,d){return o.__proto__=d,o},QI(e,t)}function Jg(e){return NLe(e)||LLe(e)||MW(e)||DLe()}function DLe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MW(e,t){if(e){if(typeof e=="string")return eM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eM(e,t)}}function LLe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NLe(e){if(Array.isArray(e))return eM(e)}function eM(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function p4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(e,d).enumerable})),n.push.apply(n,o)}return n}function Wt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?p4(Object(n),!0).forEach(function(o){Mn(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p4(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function Mn(e,t,n){return t=OW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function OW(e){var t=zLe(e,"string");return Yg(t)=="symbol"?t:t+""}function zLe(e,t){if(Yg(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(Yg(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var FLe={xAxis:["bottom","top"],yAxis:["left","right"]},BLe={width:"100%",height:"100%"},RW={x:0,y:0};function q1(e){return e}var $Le=function(t,n){return n==="horizontal"?t.x:n==="vertical"?t.y:n==="centric"?t.angle:t.radius},VLe=function(t,n,o,d){var f=n.find(function(I){return I&&I.index===o});if(f){if(t==="horizontal")return{x:f.coordinate,y:d.y};if(t==="vertical")return{x:d.x,y:f.coordinate};if(t==="centric"){var _=f.coordinate,i=d.radius;return Wt(Wt(Wt({},d),lo(d.cx,d.cy,i,_)),{},{angle:_,radius:i})}var S=f.coordinate,E=d.angle;return Wt(Wt(Wt({},d),lo(d.cx,d.cy,S,E)),{},{angle:E,radius:S})}return RW},o2=function(t,n){var o=n.graphicalItems,d=n.dataStartIndex,f=n.dataEndIndex,_=(o??[]).reduce(function(i,S){var E=S.props.data;return E&&E.length?[].concat(Jg(i),Jg(E)):i},[]);return _.length>0?_:t&&t.length&&vr(d)&&vr(f)?t.slice(d,f+1):[]};function kW(e){return e==="number"?[0,"auto"]:void 0}var tM=function(t,n,o,d){var f=t.graphicalItems,_=t.tooltipAxis,i=o2(n,t);return o<0||!f||!f.length||o>=i.length?null:f.reduce(function(S,E){var I,M=(I=E.props.data)!==null&&I!==void 0?I:n;M&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=o&&(M=M.slice(t.dataStartIndex,t.dataEndIndex+1));var j;if(_.dataKey&&!_.allowDuplicatedCategory){var N=M===void 0?i:M;j=kw(N,_.dataKey,d)}else j=M&&M[o]||i[o];return j?[].concat(Jg(S),[_H(E,j)]):S},[])},m4=function(t,n,o,d){var f=d||{x:t.chartX,y:t.chartY},_=$Le(f,o),i=t.orderedTooltipTicks,S=t.tooltipAxis,E=t.tooltipTicks,I=cPe(_,i,E,S);if(I>=0&&E){var M=E[I]&&E[I].value,j=tM(t,n,I,M),N=VLe(o,i,I,f);return{activeTooltipIndex:I,activeLabel:M,activePayload:j,activeCoordinate:N}}return null},ULe=function(t,n){var o=n.axes,d=n.graphicalItems,f=n.axisType,_=n.axisIdKey,i=n.stackGroups,S=n.dataStartIndex,E=n.dataEndIndex,I=t.layout,M=t.children,j=t.stackOffset,N=hH(I,f);return o.reduce(function(G,z){var V,K=z.type.defaultProps!==void 0?Wt(Wt({},z.type.defaultProps),z.props):z.props,Q=K.type,X=K.dataKey,ie=K.allowDataOverflow,J=K.allowDuplicatedCategory,se=K.scale,he=K.ticks,we=K.includeHidden,ze=K[_];if(G[ze])return G;var je=o2(t.data,{graphicalItems:d.filter(function(Bt){var $t,br=_ in Bt.props?Bt.props[_]:($t=Bt.type.defaultProps)===null||$t===void 0?void 0:$t[_];return br===ze}),dataStartIndex:S,dataEndIndex:E}),Oe=je.length,Be,qe,Xe;mLe(K.domain,ie,Q)&&(Be=mI(K.domain,null,ie),N&&(Q==="number"||se!=="auto")&&(Xe=Yv(je,X,"category")));var it=kW(Q);if(!Be||Be.length===0){var Ge,Ke=(Ge=K.domain)!==null&&Ge!==void 0?Ge:it;if(X){if(Be=Yv(je,X,Q),Q==="category"&&N){var ut=Jpe(Be);J&&ut?(qe=Be,Be=xS(0,Oe)):J||(Be=NB(Ke,Be,z).reduce(function(Bt,$t){return Bt.indexOf($t)>=0?Bt:[].concat(Jg(Bt),[$t])},[]))}else if(Q==="category")J?Be=Be.filter(function(Bt){return Bt!==""&&!Jn(Bt)}):Be=NB(Ke,Be,z).reduce(function(Bt,$t){return Bt.indexOf($t)>=0||$t===""||Jn($t)?Bt:[].concat(Jg(Bt),[$t])},[]);else if(Q==="number"){var rt=pPe(je,d.filter(function(Bt){var $t,br,nn=_ in Bt.props?Bt.props[_]:($t=Bt.type.defaultProps)===null||$t===void 0?void 0:$t[_],qn="hide"in Bt.props?Bt.props.hide:(br=Bt.type.defaultProps)===null||br===void 0?void 0:br.hide;return nn===ze&&(we||!qn)}),X,f,I);rt&&(Be=rt)}N&&(Q==="number"||se!=="auto")&&(Xe=Yv(je,X,"category"))}else N?Be=xS(0,Oe):i&&i[ze]&&i[ze].hasStack&&Q==="number"?Be=j==="expand"?[0,1]:yH(i[ze].stackGroups,S,E):Be=dH(je,d.filter(function(Bt){var $t=_ in Bt.props?Bt.props[_]:Bt.type.defaultProps[_],br="hide"in Bt.props?Bt.props.hide:Bt.type.defaultProps.hide;return $t===ze&&(we||!br)}),Q,I,!0);if(Q==="number")Be=JI(M,Be,ze,f,he),Ke&&(Be=mI(Ke,Be,ie));else if(Q==="category"&&Ke){var Xt=Ke,cr=Be.every(function(Bt){return Xt.indexOf(Bt)>=0});cr&&(Be=Xt)}}return Wt(Wt({},G),{},Mn({},ze,Wt(Wt({},K),{},{axisType:f,domain:Be,categoricalDomain:Xe,duplicateDomain:qe,originalDomain:(V=K.domain)!==null&&V!==void 0?V:it,isCategorical:N,layout:I})))},{})},GLe=function(t,n){var o=n.graphicalItems,d=n.Axis,f=n.axisType,_=n.axisIdKey,i=n.stackGroups,S=n.dataStartIndex,E=n.dataEndIndex,I=t.layout,M=t.children,j=o2(t.data,{graphicalItems:o,dataStartIndex:S,dataEndIndex:E}),N=j.length,G=hH(I,f),z=-1;return o.reduce(function(V,K){var Q=K.type.defaultProps!==void 0?Wt(Wt({},K.type.defaultProps),K.props):K.props,X=Q[_],ie=kW("number");if(!V[X]){z++;var J;return G?J=xS(0,N):i&&i[X]&&i[X].hasStack?(J=yH(i[X].stackGroups,S,E),J=JI(M,J,X,f)):(J=mI(ie,dH(j,o.filter(function(se){var he,we,ze=_ in se.props?se.props[_]:(he=se.type.defaultProps)===null||he===void 0?void 0:he[_],je="hide"in se.props?se.props.hide:(we=se.type.defaultProps)===null||we===void 0?void 0:we.hide;return ze===X&&!je}),"number",I),d.defaultProps.allowDataOverflow),J=JI(M,J,X,f)),Wt(Wt({},V),{},Mn({},X,Wt(Wt({axisType:f},d.defaultProps),{},{hide:!0,orientation:Ka(FLe,"".concat(f,".").concat(z%2),null),domain:J,originalDomain:ie,isCategorical:G,layout:I})))}return V},{})},HLe=function(t,n){var o=n.axisType,d=o===void 0?"xAxis":o,f=n.AxisComp,_=n.graphicalItems,i=n.stackGroups,S=n.dataStartIndex,E=n.dataEndIndex,I=t.children,M="".concat(d,"Id"),j=Xa(I,f),N={};return j&&j.length?N=ULe(t,{axes:j,graphicalItems:_,axisType:d,axisIdKey:M,stackGroups:i,dataStartIndex:S,dataEndIndex:E}):_&&_.length&&(N=GLe(t,{Axis:f,graphicalItems:_,axisType:d,axisIdKey:M,stackGroups:i,dataStartIndex:S,dataEndIndex:E})),N},WLe=function(t){var n=Hd(t),o=zu(n,!1,!0);return{tooltipTicks:o,orderedTooltipTicks:QO(o,function(d){return d.coordinate}),tooltipAxis:n,tooltipAxisBandSize:aS(n,o)}},g4=function(t){var n=t.children,o=t.defaultShowTooltip,d=Ua(n,Vg),f=0,_=0;return t.data&&t.data.length!==0&&(_=t.data.length-1),d&&d.props&&(d.props.startIndex>=0&&(f=d.props.startIndex),d.props.endIndex>=0&&(_=d.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:f,dataEndIndex:_,activeTooltipIndex:-1,isTooltipActive:!!o}},qLe=function(t){return!t||!t.length?!1:t.some(function(n){var o=Vu(n&&n.type);return o&&o.indexOf("Bar")>=0})},y4=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},ZLe=function(t,n){var o=t.props,d=t.graphicalItems,f=t.xAxisMap,_=f===void 0?{}:f,i=t.yAxisMap,S=i===void 0?{}:i,E=o.width,I=o.height,M=o.children,j=o.margin||{},N=Ua(M,Vg),G=Ua(M,Xd),z=Object.keys(S).reduce(function(J,se){var he=S[se],we=he.orientation;return!he.mirror&&!he.hide?Wt(Wt({},J),{},Mn({},we,J[we]+he.width)):J},{left:j.left||0,right:j.right||0}),V=Object.keys(_).reduce(function(J,se){var he=_[se],we=he.orientation;return!he.mirror&&!he.hide?Wt(Wt({},J),{},Mn({},we,Ka(J,"".concat(we))+he.height)):J},{top:j.top||0,bottom:j.bottom||0}),K=Wt(Wt({},V),z),Q=K.bottom;N&&(K.bottom+=N.props.height||Vg.defaultProps.height),G&&n&&(K=hPe(K,d,o,n));var X=E-K.left-K.right,ie=I-K.top-K.bottom;return Wt(Wt({brushBottom:Q},K),{},{width:Math.max(X,0),height:Math.max(ie,0)})},KLe=function(t,n){if(n==="xAxis")return t[n].width;if(n==="yAxis")return t[n].height},zR=function(t){var n=t.chartName,o=t.GraphicalChild,d=t.defaultTooltipEventType,f=d===void 0?"axis":d,_=t.validateTooltipEventTypes,i=_===void 0?["axis"]:_,S=t.axisComponents,E=t.legendContent,I=t.formatAxisMap,M=t.defaultProps,j=function(K,Q){var X=Q.graphicalItems,ie=Q.stackGroups,J=Q.offset,se=Q.updateId,he=Q.dataStartIndex,we=Q.dataEndIndex,ze=K.barSize,je=K.layout,Oe=K.barGap,Be=K.barCategoryGap,qe=K.maxBarSize,Xe=y4(je),it=Xe.numericAxisName,Ge=Xe.cateAxisName,Ke=qLe(X),ut=[];return X.forEach(function(rt,Xt){var cr=o2(K.data,{graphicalItems:[rt],dataStartIndex:he,dataEndIndex:we}),Bt=rt.type.defaultProps!==void 0?Wt(Wt({},rt.type.defaultProps),rt.props):rt.props,$t=Bt.dataKey,br=Bt.maxBarSize,nn=Bt["".concat(it,"Id")],qn=Bt["".concat(Ge,"Id")],lr={},an=S.reduce(function(co,Co){var wo=Q["".concat(Co.axisType,"Map")],Hi=Bt["".concat(Co.axisType,"Id")];wo&&wo[Hi]||Co.axisType==="zAxis"||Hf();var is=wo[Hi];return Wt(Wt({},co),{},Mn(Mn({},Co.axisType,is),"".concat(Co.axisType,"Ticks"),zu(is)))},lr),Lt=an[Ge],nr=an["".concat(Ge,"Ticks")],pr=ie&&ie[nn]&&ie[nn].hasStack&&SPe(rt,ie[nn].stackGroups),Nt=Vu(rt.type).indexOf("Bar")>=0,zr=aS(Lt,nr),un=[],hi=Ke&&uPe({barSize:ze,stackGroups:ie,totalSize:KLe(an,Ge)});if(Nt){var Hn,zn,Qn=Jn(br)?qe:br,zs=(Hn=(zn=aS(Lt,nr,!0))!==null&&zn!==void 0?zn:Qn)!==null&&Hn!==void 0?Hn:0;un=dPe({barGap:Oe,barCategoryGap:Be,bandSize:zs!==zr?zs:zr,sizeList:hi[qn],maxBarSize:Qn}),zs!==zr&&(un=un.map(function(co){return Wt(Wt({},co),{},{position:Wt(Wt({},co.position),{},{offset:co.position.offset-zs/2})})}))}var gs=rt&&rt.type&&rt.type.getComposedData;gs&&ut.push({props:Wt(Wt({},gs(Wt(Wt({},an),{},{displayedData:cr,props:K,dataKey:$t,item:rt,bandSize:zr,barPosition:un,offset:J,stackedData:pr,layout:je,dataStartIndex:he,dataEndIndex:we}))),{},Mn(Mn(Mn({key:rt.key||"item-".concat(Xt)},it,an[it]),Ge,an[Ge]),"animationId",se)),childIndex:dme(rt,K.children),item:rt})}),ut},N=function(K,Q){var X=K.props,ie=K.dataStartIndex,J=K.dataEndIndex,se=K.updateId;if(!Mz({props:X}))return null;var he=X.children,we=X.layout,ze=X.stackOffset,je=X.data,Oe=X.reverseStackOrder,Be=y4(we),qe=Be.numericAxisName,Xe=Be.cateAxisName,it=Xa(he,o),Ge=bPe(je,it,"".concat(qe,"Id"),"".concat(Xe,"Id"),ze,Oe),Ke=S.reduce(function(Bt,$t){var br="".concat($t.axisType,"Map");return Wt(Wt({},Bt),{},Mn({},br,HLe(X,Wt(Wt({},$t),{},{graphicalItems:it,stackGroups:$t.axisType===qe&&Ge,dataStartIndex:ie,dataEndIndex:J}))))},{}),ut=ZLe(Wt(Wt({},Ke),{},{props:X,graphicalItems:it}),Q?.legendBBox);Object.keys(Ke).forEach(function(Bt){Ke[Bt]=I(X,Ke[Bt],ut,Bt.replace("Map",""),n)});var rt=Ke["".concat(Xe,"Map")],Xt=WLe(rt),cr=j(X,Wt(Wt({},Ke),{},{dataStartIndex:ie,dataEndIndex:J,updateId:se,graphicalItems:it,stackGroups:Ge,offset:ut}));return Wt(Wt({formattedGraphicalItems:cr,graphicalItems:it,offset:ut,stackGroups:Ge},Xt),Ke)},G=function(V){function K(Q){var X,ie,J;return CLe(this,K),J=OLe(this,K,[Q]),Mn(J,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Mn(J,"accessibilityManager",new pLe),Mn(J,"handleLegendBBoxUpdate",function(se){if(se){var he=J.state,we=he.dataStartIndex,ze=he.dataEndIndex,je=he.updateId;J.setState(Wt({legendBBox:se},N({props:J.props,dataStartIndex:we,dataEndIndex:ze,updateId:je},Wt(Wt({},J.state),{},{legendBBox:se}))))}}),Mn(J,"handleReceiveSyncEvent",function(se,he,we){if(J.props.syncId===se){if(we===J.eventEmitterSymbol&&typeof J.props.syncMethod!="function")return;J.applySyncEvent(he)}}),Mn(J,"handleBrushChange",function(se){var he=se.startIndex,we=se.endIndex;if(he!==J.state.dataStartIndex||we!==J.state.dataEndIndex){var ze=J.state.updateId;J.setState(function(){return Wt({dataStartIndex:he,dataEndIndex:we},N({props:J.props,dataStartIndex:he,dataEndIndex:we,updateId:ze},J.state))}),J.triggerSyncEvent({dataStartIndex:he,dataEndIndex:we})}}),Mn(J,"handleMouseEnter",function(se){var he=J.getMouseInfo(se);if(he){var we=Wt(Wt({},he),{},{isTooltipActive:!0});J.setState(we),J.triggerSyncEvent(we);var ze=J.props.onMouseEnter;Vn(ze)&&ze(we,se)}}),Mn(J,"triggeredAfterMouseMove",function(se){var he=J.getMouseInfo(se),we=he?Wt(Wt({},he),{},{isTooltipActive:!0}):{isTooltipActive:!1};J.setState(we),J.triggerSyncEvent(we);var ze=J.props.onMouseMove;Vn(ze)&&ze(we,se)}),Mn(J,"handleItemMouseEnter",function(se){J.setState(function(){return{isTooltipActive:!0,activeItem:se,activePayload:se.tooltipPayload,activeCoordinate:se.tooltipPosition||{x:se.cx,y:se.cy}}})}),Mn(J,"handleItemMouseLeave",function(){J.setState(function(){return{isTooltipActive:!1}})}),Mn(J,"handleMouseMove",function(se){se.persist(),J.throttleTriggeredAfterMouseMove(se)}),Mn(J,"handleMouseLeave",function(se){J.throttleTriggeredAfterMouseMove.cancel();var he={isTooltipActive:!1};J.setState(he),J.triggerSyncEvent(he);var we=J.props.onMouseLeave;Vn(we)&&we(he,se)}),Mn(J,"handleOuterEvent",function(se){var he=ume(se),we=Ka(J.props,"".concat(he));if(he&&Vn(we)){var ze,je;/.*touch.*/i.test(he)?je=J.getMouseInfo(se.changedTouches[0]):je=J.getMouseInfo(se),we((ze=je)!==null&&ze!==void 0?ze:{},se)}}),Mn(J,"handleClick",function(se){var he=J.getMouseInfo(se);if(he){var we=Wt(Wt({},he),{},{isTooltipActive:!0});J.setState(we),J.triggerSyncEvent(we);var ze=J.props.onClick;Vn(ze)&&ze(we,se)}}),Mn(J,"handleMouseDown",function(se){var he=J.props.onMouseDown;if(Vn(he)){var we=J.getMouseInfo(se);he(we,se)}}),Mn(J,"handleMouseUp",function(se){var he=J.props.onMouseUp;if(Vn(he)){var we=J.getMouseInfo(se);he(we,se)}}),Mn(J,"handleTouchMove",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&J.throttleTriggeredAfterMouseMove(se.changedTouches[0])}),Mn(J,"handleTouchStart",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&J.handleMouseDown(se.changedTouches[0])}),Mn(J,"handleTouchEnd",function(se){se.changedTouches!=null&&se.changedTouches.length>0&&J.handleMouseUp(se.changedTouches[0])}),Mn(J,"handleDoubleClick",function(se){var he=J.props.onDoubleClick;if(Vn(he)){var we=J.getMouseInfo(se);he(we,se)}}),Mn(J,"handleContextMenu",function(se){var he=J.props.onContextMenu;if(Vn(he)){var we=J.getMouseInfo(se);he(we,se)}}),Mn(J,"triggerSyncEvent",function(se){J.props.syncId!==void 0&&AP.emit(EP,J.props.syncId,se,J.eventEmitterSymbol)}),Mn(J,"applySyncEvent",function(se){var he=J.props,we=he.layout,ze=he.syncMethod,je=J.state.updateId,Oe=se.dataStartIndex,Be=se.dataEndIndex;if(se.dataStartIndex!==void 0||se.dataEndIndex!==void 0)J.setState(Wt({dataStartIndex:Oe,dataEndIndex:Be},N({props:J.props,dataStartIndex:Oe,dataEndIndex:Be,updateId:je},J.state)));else if(se.activeTooltipIndex!==void 0){var qe=se.chartX,Xe=se.chartY,it=se.activeTooltipIndex,Ge=J.state,Ke=Ge.offset,ut=Ge.tooltipTicks;if(!Ke)return;if(typeof ze=="function")it=ze(ut,se);else if(ze==="value"){it=-1;for(var rt=0;rt<ut.length;rt++)if(ut[rt].value===se.activeLabel){it=rt;break}}var Xt=Wt(Wt({},Ke),{},{x:Ke.left,y:Ke.top}),cr=Math.min(qe,Xt.x+Xt.width),Bt=Math.min(Xe,Xt.y+Xt.height),$t=ut[it]&&ut[it].value,br=tM(J.state,J.props.data,it),nn=ut[it]?{x:we==="horizontal"?ut[it].coordinate:cr,y:we==="horizontal"?Bt:ut[it].coordinate}:RW;J.setState(Wt(Wt({},se),{},{activeLabel:$t,activeCoordinate:nn,activePayload:br,activeTooltipIndex:it}))}else J.setState(se)}),Mn(J,"renderCursor",function(se){var he,we=J.state,ze=we.isTooltipActive,je=we.activeCoordinate,Oe=we.activePayload,Be=we.offset,qe=we.activeTooltipIndex,Xe=we.tooltipAxisBandSize,it=J.getTooltipEventType(),Ge=(he=se.props.active)!==null&&he!==void 0?he:ze,Ke=J.props.layout,ut=se.key||"_recharts-cursor";return Le.createElement(bLe,{key:ut,activeCoordinate:je,activePayload:Oe,activeTooltipIndex:qe,chartName:n,element:se,isActive:Ge,layout:Ke,offset:Be,tooltipAxisBandSize:Xe,tooltipEventType:it})}),Mn(J,"renderPolarAxis",function(se,he,we){var ze=Ka(se,"type.axisType"),je=Ka(J.state,"".concat(ze,"Map")),Oe=se.type.defaultProps,Be=Oe!==void 0?Wt(Wt({},Oe),se.props):se.props,qe=je&&je[Be["".concat(ze,"Id")]];return B.cloneElement(se,Wt(Wt({},qe),{},{className:ni(ze,qe.className),key:se.key||"".concat(he,"-").concat(we),ticks:zu(qe,!0)}))}),Mn(J,"renderPolarGrid",function(se){var he=se.props,we=he.radialLines,ze=he.polarAngles,je=he.polarRadius,Oe=J.state,Be=Oe.radiusAxisMap,qe=Oe.angleAxisMap,Xe=Hd(Be),it=Hd(qe),Ge=it.cx,Ke=it.cy,ut=it.innerRadius,rt=it.outerRadius;return B.cloneElement(se,{polarAngles:Array.isArray(ze)?ze:zu(it,!0).map(function(Xt){return Xt.coordinate}),polarRadius:Array.isArray(je)?je:zu(Xe,!0).map(function(Xt){return Xt.coordinate}),cx:Ge,cy:Ke,innerRadius:ut,outerRadius:rt,key:se.key||"polar-grid",radialLines:we})}),Mn(J,"renderLegend",function(){var se=J.state.formattedGraphicalItems,he=J.props,we=he.children,ze=he.width,je=he.height,Oe=J.props.margin||{},Be=ze-(Oe.left||0)-(Oe.right||0),qe=cH({children:we,formattedGraphicalItems:se,legendWidth:Be,legendContent:E});if(!qe)return null;var Xe=qe.item,it=f4(qe,wLe);return B.cloneElement(Xe,Wt(Wt({},it),{},{chartWidth:ze,chartHeight:je,margin:Oe,onBBoxUpdate:J.handleLegendBBoxUpdate}))}),Mn(J,"renderTooltip",function(){var se,he=J.props,we=he.children,ze=he.accessibilityLayer,je=Ua(we,Ga);if(!je)return null;var Oe=J.state,Be=Oe.isTooltipActive,qe=Oe.activeCoordinate,Xe=Oe.activePayload,it=Oe.activeLabel,Ge=Oe.offset,Ke=(se=je.props.active)!==null&&se!==void 0?se:Be;return B.cloneElement(je,{viewBox:Wt(Wt({},Ge),{},{x:Ge.left,y:Ge.top}),active:Ke,label:it,payload:Ke?Xe:[],coordinate:qe,accessibilityLayer:ze})}),Mn(J,"renderBrush",function(se){var he=J.props,we=he.margin,ze=he.data,je=J.state,Oe=je.offset,Be=je.dataStartIndex,qe=je.dataEndIndex,Xe=je.updateId;return B.cloneElement(se,{key:se.key||"_recharts-brush",onChange:V1(J.handleBrushChange,se.props.onChange),data:ze,x:vr(se.props.x)?se.props.x:Oe.left,y:vr(se.props.y)?se.props.y:Oe.top+Oe.height+Oe.brushBottom-(we.bottom||0),width:vr(se.props.width)?se.props.width:Oe.width,startIndex:Be,endIndex:qe,updateId:"brush-".concat(Xe)})}),Mn(J,"renderReferenceElement",function(se,he,we){if(!se)return null;var ze=J,je=ze.clipPathId,Oe=J.state,Be=Oe.xAxisMap,qe=Oe.yAxisMap,Xe=Oe.offset,it=se.type.defaultProps||{},Ge=se.props,Ke=Ge.xAxisId,ut=Ke===void 0?it.xAxisId:Ke,rt=Ge.yAxisId,Xt=rt===void 0?it.yAxisId:rt;return B.cloneElement(se,{key:se.key||"".concat(he,"-").concat(we),xAxis:Be[ut],yAxis:qe[Xt],viewBox:{x:Xe.left,y:Xe.top,width:Xe.width,height:Xe.height},clipPathId:je})}),Mn(J,"renderActivePoints",function(se){var he=se.item,we=se.activePoint,ze=se.basePoint,je=se.childIndex,Oe=se.isRange,Be=[],qe=he.props.key,Xe=he.item.type.defaultProps!==void 0?Wt(Wt({},he.item.type.defaultProps),he.item.props):he.item.props,it=Xe.activeDot,Ge=Xe.dataKey,Ke=Wt(Wt({index:je,dataKey:Ge,cx:we.x,cy:we.y,r:4,fill:ER(he.item),strokeWidth:2,stroke:"#fff",payload:we.payload,value:we.value},Tn(it,!1)),jw(it));return Be.push(K.renderActiveDot(it,Ke,"".concat(qe,"-activePoint-").concat(je))),ze?Be.push(K.renderActiveDot(it,Wt(Wt({},Ke),{},{cx:ze.x,cy:ze.y}),"".concat(qe,"-basePoint-").concat(je))):Oe&&Be.push(null),Be}),Mn(J,"renderGraphicChild",function(se,he,we){var ze=J.filterFormatItem(se,he,we);if(!ze)return null;var je=J.getTooltipEventType(),Oe=J.state,Be=Oe.isTooltipActive,qe=Oe.tooltipAxis,Xe=Oe.activeTooltipIndex,it=Oe.activeLabel,Ge=J.props.children,Ke=Ua(Ge,Ga),ut=ze.props,rt=ut.points,Xt=ut.isRange,cr=ut.baseLine,Bt=ze.item.type.defaultProps!==void 0?Wt(Wt({},ze.item.type.defaultProps),ze.item.props):ze.item.props,$t=Bt.activeDot,br=Bt.hide,nn=Bt.activeBar,qn=Bt.activeShape,lr=!!(!br&&Be&&Ke&&($t||nn||qn)),an={};je!=="axis"&&Ke&&Ke.props.trigger==="click"?an={onClick:V1(J.handleItemMouseEnter,se.props.onClick)}:je!=="axis"&&(an={onMouseLeave:V1(J.handleItemMouseLeave,se.props.onMouseLeave),onMouseEnter:V1(J.handleItemMouseEnter,se.props.onMouseEnter)});var Lt=B.cloneElement(se,Wt(Wt({},ze.props),an));function nr(Co){return typeof qe.dataKey=="function"?qe.dataKey(Co.payload):null}if(lr)if(Xe>=0){var pr,Nt;if(qe.dataKey&&!qe.allowDuplicatedCategory){var zr=typeof qe.dataKey=="function"?nr:"payload.".concat(qe.dataKey.toString());pr=kw(rt,zr,it),Nt=Xt&&cr&&kw(cr,zr,it)}else pr=rt?.[Xe],Nt=Xt&&cr&&cr[Xe];if(qn||nn){var un=se.props.activeIndex!==void 0?se.props.activeIndex:Xe;return[B.cloneElement(se,Wt(Wt(Wt({},ze.props),an),{},{activeIndex:un})),null,null]}if(!Jn(pr))return[Lt].concat(Jg(J.renderActivePoints({item:ze,activePoint:pr,basePoint:Nt,childIndex:Xe,isRange:Xt})))}else{var hi,Hn=(hi=J.getItemByXY(J.state.activeCoordinate))!==null&&hi!==void 0?hi:{graphicalItem:Lt},zn=Hn.graphicalItem,Qn=zn.item,zs=Qn===void 0?se:Qn,gs=zn.childIndex,co=Wt(Wt(Wt({},ze.props),an),{},{activeIndex:gs});return[B.cloneElement(zs,co),null,null]}return Xt?[Lt,null,null]:[Lt,null]}),Mn(J,"renderCustomized",function(se,he,we){return B.cloneElement(se,Wt(Wt({key:"recharts-customized-".concat(we)},J.props),J.state))}),Mn(J,"renderMap",{CartesianGrid:{handler:q1,once:!0},ReferenceArea:{handler:J.renderReferenceElement},ReferenceLine:{handler:q1},ReferenceDot:{handler:J.renderReferenceElement},XAxis:{handler:q1},YAxis:{handler:q1},Brush:{handler:J.renderBrush,once:!0},Bar:{handler:J.renderGraphicChild},Line:{handler:J.renderGraphicChild},Area:{handler:J.renderGraphicChild},Radar:{handler:J.renderGraphicChild},RadialBar:{handler:J.renderGraphicChild},Scatter:{handler:J.renderGraphicChild},Pie:{handler:J.renderGraphicChild},Funnel:{handler:J.renderGraphicChild},Tooltip:{handler:J.renderCursor,once:!0},PolarGrid:{handler:J.renderPolarGrid,once:!0},PolarAngleAxis:{handler:J.renderPolarAxis},PolarRadiusAxis:{handler:J.renderPolarAxis},Customized:{handler:J.renderCustomized}}),J.clipPathId="".concat((X=Q.id)!==null&&X!==void 0?X:gy("recharts"),"-clip"),J.throttleTriggeredAfterMouseMove=lG(J.triggeredAfterMouseMove,(ie=Q.throttleDelay)!==null&&ie!==void 0?ie:1e3/60),J.state={},J}return jLe(K,V),MLe(K,[{key:"componentDidMount",value:function(){var X,ie;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(X=this.props.margin.left)!==null&&X!==void 0?X:0,top:(ie=this.props.margin.top)!==null&&ie!==void 0?ie:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var X=this.props,ie=X.children,J=X.data,se=X.height,he=X.layout,we=Ua(ie,Ga);if(we){var ze=we.props.defaultIndex;if(!(typeof ze!="number"||ze<0||ze>this.state.tooltipTicks.length-1)){var je=this.state.tooltipTicks[ze]&&this.state.tooltipTicks[ze].value,Oe=tM(this.state,J,ze,je),Be=this.state.tooltipTicks[ze].coordinate,qe=(this.state.offset.top+se)/2,Xe=he==="horizontal",it=Xe?{x:Be,y:qe}:{y:Be,x:qe},Ge=this.state.formattedGraphicalItems.find(function(ut){var rt=ut.item;return rt.type.name==="Scatter"});Ge&&(it=Wt(Wt({},it),Ge.props.points[ze].tooltipPosition),Oe=Ge.props.points[ze].tooltipPayload);var Ke={activeTooltipIndex:ze,isTooltipActive:!0,activeLabel:je,activePayload:Oe,activeCoordinate:it};this.setState(Ke),this.renderCursor(we),this.accessibilityManager.setIndex(ze)}}}},{key:"getSnapshotBeforeUpdate",value:function(X,ie){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ie.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==X.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==X.margin){var J,se;this.accessibilityManager.setDetails({offset:{left:(J=this.props.margin.left)!==null&&J!==void 0?J:0,top:(se=this.props.margin.top)!==null&&se!==void 0?se:0}})}return null}},{key:"componentDidUpdate",value:function(X){IC([Ua(X.children,Ga)],[Ua(this.props.children,Ga)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var X=Ua(this.props.children,Ga);if(X&&typeof X.props.shared=="boolean"){var ie=X.props.shared?"axis":"item";return i.indexOf(ie)>=0?ie:f}return f}},{key:"getMouseInfo",value:function(X){if(!this.container)return null;var ie=this.container,J=ie.getBoundingClientRect(),se=NSe(J),he={chartX:Math.round(X.pageX-se.left),chartY:Math.round(X.pageY-se.top)},we=J.width/ie.offsetWidth||1,ze=this.inRange(he.chartX,he.chartY,we);if(!ze)return null;var je=this.state,Oe=je.xAxisMap,Be=je.yAxisMap,qe=this.getTooltipEventType(),Xe=m4(this.state,this.props.data,this.props.layout,ze);if(qe!=="axis"&&Oe&&Be){var it=Hd(Oe).scale,Ge=Hd(Be).scale,Ke=it&&it.invert?it.invert(he.chartX):null,ut=Ge&&Ge.invert?Ge.invert(he.chartY):null;return Wt(Wt({},he),{},{xValue:Ke,yValue:ut},Xe)}return Xe?Wt(Wt({},he),Xe):null}},{key:"inRange",value:function(X,ie){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,se=this.props.layout,he=X/J,we=ie/J;if(se==="horizontal"||se==="vertical"){var ze=this.state.offset,je=he>=ze.left&&he<=ze.left+ze.width&&we>=ze.top&&we<=ze.top+ze.height;return je?{x:he,y:we}:null}var Oe=this.state,Be=Oe.angleAxisMap,qe=Oe.radiusAxisMap;if(Be&&qe){var Xe=Hd(Be);return BB({x:he,y:we},Xe)}return null}},{key:"parseEventsOfWrapper",value:function(){var X=this.props.children,ie=this.getTooltipEventType(),J=Ua(X,Ga),se={};J&&ie==="axis"&&(J.props.trigger==="click"?se={onClick:this.handleClick}:se={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var he=jw(this.props,this.handleOuterEvent);return Wt(Wt({},he),se)}},{key:"addListener",value:function(){AP.on(EP,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){AP.removeListener(EP,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(X,ie,J){for(var se=this.state.formattedGraphicalItems,he=0,we=se.length;he<we;he++){var ze=se[he];if(ze.item===X||ze.props.key===X.key||ie===Vu(ze.item.type)&&J===ze.childIndex)return ze}return null}},{key:"renderClipPath",value:function(){var X=this.clipPathId,ie=this.state.offset,J=ie.left,se=ie.top,he=ie.height,we=ie.width;return Le.createElement("defs",null,Le.createElement("clipPath",{id:X},Le.createElement("rect",{x:J,y:se,height:he,width:we})))}},{key:"getXScales",value:function(){var X=this.state.xAxisMap;return X?Object.entries(X).reduce(function(ie,J){var se=h4(J,2),he=se[0],we=se[1];return Wt(Wt({},ie),{},Mn({},he,we.scale))},{}):null}},{key:"getYScales",value:function(){var X=this.state.yAxisMap;return X?Object.entries(X).reduce(function(ie,J){var se=h4(J,2),he=se[0],we=se[1];return Wt(Wt({},ie),{},Mn({},he,we.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(X){var ie;return(ie=this.state.xAxisMap)===null||ie===void 0||(ie=ie[X])===null||ie===void 0?void 0:ie.scale}},{key:"getYScaleByAxisId",value:function(X){var ie;return(ie=this.state.yAxisMap)===null||ie===void 0||(ie=ie[X])===null||ie===void 0?void 0:ie.scale}},{key:"getItemByXY",value:function(X){var ie=this.state,J=ie.formattedGraphicalItems,se=ie.activeItem;if(J&&J.length)for(var he=0,we=J.length;he<we;he++){var ze=J[he],je=ze.props,Oe=ze.item,Be=Oe.type.defaultProps!==void 0?Wt(Wt({},Oe.type.defaultProps),Oe.props):Oe.props,qe=Vu(Oe.type);if(qe==="Bar"){var Xe=(je.data||[]).find(function(ut){return vMe(X,ut)});if(Xe)return{graphicalItem:ze,payload:Xe}}else if(qe==="RadialBar"){var it=(je.data||[]).find(function(ut){return BB(X,ut)});if(it)return{graphicalItem:ze,payload:it}}else if(JT(ze,se)||QT(ze,se)||$0(ze,se)){var Ge=aRe({graphicalItem:ze,activeTooltipItem:se,itemData:Be.data}),Ke=Be.activeIndex===void 0?Ge:Be.activeIndex;return{graphicalItem:Wt(Wt({},ze),{},{childIndex:Ke}),payload:$0(ze,se)?Be.data[Ge]:ze.props.data[Ge]}}}return null}},{key:"render",value:function(){var X=this;if(!Mz(this))return null;var ie=this.props,J=ie.children,se=ie.className,he=ie.width,we=ie.height,ze=ie.style,je=ie.compact,Oe=ie.title,Be=ie.desc,qe=f4(ie,SLe),Xe=Tn(qe,!1);if(je)return Le.createElement(Z5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Le.createElement(OC,ug({},Xe,{width:he,height:we,title:Oe,desc:Be}),this.renderClipPath(),Rz(J,this.renderMap)));if(this.props.accessibilityLayer){var it,Ge;Xe.tabIndex=(it=this.props.tabIndex)!==null&&it!==void 0?it:0,Xe.role=(Ge=this.props.role)!==null&&Ge!==void 0?Ge:"application",Xe.onKeyDown=function(ut){X.accessibilityManager.keyboardEvent(ut)},Xe.onFocus=function(){X.accessibilityManager.focus()}}var Ke=this.parseEventsOfWrapper();return Le.createElement(Z5,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},Le.createElement("div",ug({className:ni("recharts-wrapper",se),style:Wt({position:"relative",cursor:"default",width:he,height:we},ze)},Ke,{ref:function(rt){X.container=rt}}),Le.createElement(OC,ug({},Xe,{width:he,height:we,title:Oe,desc:Be,style:BLe}),this.renderClipPath(),Rz(J,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(B.Component);Mn(G,"displayName",n),Mn(G,"defaultProps",Wt({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},M)),Mn(G,"getDerivedStateFromProps",function(V,K){var Q=V.dataKey,X=V.data,ie=V.children,J=V.width,se=V.height,he=V.layout,we=V.stackOffset,ze=V.margin,je=K.dataStartIndex,Oe=K.dataEndIndex;if(K.updateId===void 0){var Be=g4(V);return Wt(Wt(Wt({},Be),{},{updateId:0},N(Wt(Wt({props:V},Be),{},{updateId:0}),K)),{},{prevDataKey:Q,prevData:X,prevWidth:J,prevHeight:se,prevLayout:he,prevStackOffset:we,prevMargin:ze,prevChildren:ie})}if(Q!==K.prevDataKey||X!==K.prevData||J!==K.prevWidth||se!==K.prevHeight||he!==K.prevLayout||we!==K.prevStackOffset||!_g(ze,K.prevMargin)){var qe=g4(V),Xe={chartX:K.chartX,chartY:K.chartY,isTooltipActive:K.isTooltipActive},it=Wt(Wt({},m4(K,X,he)),{},{updateId:K.updateId+1}),Ge=Wt(Wt(Wt({},qe),Xe),it);return Wt(Wt(Wt({},Ge),N(Wt({props:V},Ge),K)),{},{prevDataKey:Q,prevData:X,prevWidth:J,prevHeight:se,prevLayout:he,prevStackOffset:we,prevMargin:ze,prevChildren:ie})}if(!IC(ie,K.prevChildren)){var Ke,ut,rt,Xt,cr=Ua(ie,Vg),Bt=cr&&(Ke=(ut=cr.props)===null||ut===void 0?void 0:ut.startIndex)!==null&&Ke!==void 0?Ke:je,$t=cr&&(rt=(Xt=cr.props)===null||Xt===void 0?void 0:Xt.endIndex)!==null&&rt!==void 0?rt:Oe,br=Bt!==je||$t!==Oe,nn=!Jn(X),qn=nn&&!br?K.updateId:K.updateId+1;return Wt(Wt({updateId:qn},N(Wt(Wt({props:V},K),{},{updateId:qn,dataStartIndex:Bt,dataEndIndex:$t}),K)),{},{prevChildren:ie,dataStartIndex:Bt,dataEndIndex:$t})}return null}),Mn(G,"renderActiveDot",function(V,K,Q){var X;return B.isValidElement(V)?X=B.cloneElement(V,K):Vn(V)?X=V(K):X=Le.createElement(qT,K),Le.createElement(Di,{className:"recharts-active-dot",key:Q},X)});var z=B.forwardRef(function(K,Q){return Le.createElement(G,ug({},K,{ref:Q}))});return z.displayName=G.displayName,z},jW=zR({chartName:"LineChart",GraphicalChild:Ty,axisComponents:[{axisType:"xAxis",AxisComp:qf},{axisType:"yAxis",AxisComp:Zf}],formatAxisMap:JH}),XLe=zR({chartName:"BarChart",GraphicalChild:ip,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:qf},{axisType:"yAxis",AxisComp:Zf}],formatAxisMap:JH}),YLe=zR({chartName:"PieChart",GraphicalChild:nd,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:YT},{axisType:"radiusAxis",AxisComp:KT}],formatAxisMap:kPe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});function JLe(){const[e,t]=B.useState({properties:0,submissions:0,inquiries:0,verified:0}),n=async()=>{try{const[f,_,i,S]=await Promise.all([Sr.from("properties").select("id",{count:"exact"}),Sr.from("property_submissions").select("id",{count:"exact"}),Sr.from("buyer_inquiries").select("id",{count:"exact"}),Sr.from("properties").select("id",{count:"exact"}).eq("is_verified",!0)]);t({properties:f.count??0,submissions:_.count??0,inquiries:i.count??0,verified:S.count??0})}catch(f){console.warn("Failed to fetch realtime counts",f)}};B.useEffect(()=>{n();const f=Sr.channel("realtime-admin-charts").on("postgres_changes",{event:"*",schema:"public",table:"properties"},()=>n()).on("postgres_changes",{event:"*",schema:"public",table:"property_submissions"},()=>n()).on("postgres_changes",{event:"*",schema:"public",table:"buyer_inquiries"},()=>n()).subscribe();return()=>{Sr.removeChannel(f)}},[]);const o=[{name:"Properties",value:e.properties},{name:"Submissions",value:e.submissions},{name:"Inquiries",value:e.inquiries},{name:"Verified",value:e.verified}],d=[{name:"T-3",v:Math.max(0,e.properties-2)},{name:"T-2",v:Math.max(0,e.properties-1)},{name:"Now",v:e.properties}];return x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Live Overview"})}),x.jsx(bo,{children:x.jsx(JC,{width:"100%",height:120,children:x.jsxs(XLe,{data:o,margin:{top:8,right:12,left:0,bottom:8},children:[x.jsx(qf,{dataKey:"name",tick:{fontSize:12}}),x.jsx(Zf,{}),x.jsx(Ga,{}),x.jsx(ip,{dataKey:"value",fill:"#06b6d4",radius:[6,6,0,0]})]})})})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Properties Trend"})}),x.jsx(bo,{children:x.jsx(JC,{width:"100%",height:120,children:x.jsxs(jW,{data:d,margin:{top:8,right:12,left:0,bottom:8},children:[x.jsx(NR,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),x.jsx(qf,{dataKey:"name",tick:{fontSize:12}}),x.jsx(Zf,{}),x.jsx(Ga,{}),x.jsx(Ty,{type:"monotone",dataKey:"v",stroke:"#3b82f6",strokeWidth:2,dot:{r:2}})]})})})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Quick Stats"})}),x.jsx(bo,{children:x.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[x.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Properties",x.jsx("br",{}),x.jsx("strong",{children:e.properties})]}),x.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Verified",x.jsx("br",{}),x.jsx("strong",{children:e.verified})]}),x.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Submissions",x.jsx("br",{}),x.jsx("strong",{children:e.submissions})]}),x.jsxs("div",{className:"p-2 bg-slate-50 rounded",children:["Inquiries",x.jsx("br",{}),x.jsx("strong",{children:e.inquiries})]})]})})]})]})}const QLe=()=>{const[e,t]=B.useState({properties:0,submissions:0,inquiries:0,verified:0}),[n,o]=B.useState([]),[d,f]=B.useState([]),[_,i]=B.useState([]),[S,E]=B.useState(!0),[I,M]=B.useState(!1),[j,N]=B.useState(null),[G,z]=B.useState(null),V=(ie,J)=>{N(ie),z(J),M(!0)},K=async()=>{if(!j||!G)return M(!1);const ie=n;o(J=>J.filter(se=>se.id!==G.id)),t(J=>({...J,submissions:Math.max(0,J.submissions-1)})),M(!1);try{j==="approve"?await Q(G):await X(G)}catch{o(ie),rn({title:"Error",description:"Action failed. Changes rolled back.",variant:"destructive"})}finally{N(null),z(null)}};B.useEffect(()=>{(async()=>{E(!0);try{const[J,se,he,we,ze,je,Oe]=await Promise.all([Sr.from("properties").select("id",{count:"exact"}),Sr.from("property_submissions").select("id",{count:"exact"}),Sr.from("buyer_inquiries").select("id",{count:"exact"}),Sr.from("properties").select("id",{count:"exact"}).eq("is_verified",!0),Sr.from("property_submissions").select("id,title,seller_name,seller_phone,price,status,images").order("created_at",{ascending:!1}).limit(5),Sr.from("buyer_inquiries").select("id,buyer_name,buyer_phone,property_id,message,lead_status,created_at").order("created_at",{ascending:!1}).limit(5),Sr.from("properties").select("id,title,location,price,status,is_verified,images").order("created_at",{ascending:!1}).limit(5)]);t({properties:J.count??0,submissions:se.count??0,inquiries:he.count??0,verified:we.count??0}),o(ze.data.map(Be=>({...Be,_firstImage:Be.images?.[0]?Sr.storage.from("properties").getPublicUrl(Be.images[0]).data?.publicUrl:void 0}))||[]),f(je.data||[]),i(Oe.data.map(Be=>({...Be,_firstImage:Be.images?.[0]?Sr.storage.from("properties").getPublicUrl(Be.images[0]).data?.publicUrl:void 0}))||[])}catch(J){console.error(J)}finally{E(!1)}})()},[]);const Q=async ie=>{try{const{data:J,error:se}=await Sr.from("properties").insert([{title:ie.title,description:ie.description||null,property_type:ie.property_type||"land",price:ie.price||0,location:ie.location||"",images:ie.images||null,seller_name:ie.seller_name||null,seller_phone:ie.seller_phone||null,is_admin_property:!1,approved_at:new Date().toISOString()}]).select().single();if(se)throw se;await Sr.from("property_submissions").update({status:"approved",created_property_id:J.id,reviewed_at:new Date().toISOString()}).eq("id",ie.id),t(he=>({...he,properties:he.properties+1})),rn({title:"Approved",description:"Submission approved and published.",variant:"default"})}catch(J){console.error(J),rn({title:"Error",description:J.message||"Failed to approve submission.",variant:"destructive"})}},X=async ie=>{try{await Sr.from("property_submissions").update({status:"rejected",reviewed_at:new Date().toISOString()}).eq("id",ie.id),rn({title:"Rejected",description:"Submission rejected.",variant:"default"})}catch(J){console.error(J),rn({title:"Error",description:J.message||"Failed to reject submission.",variant:"destructive"})}};return x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6",children:[x.jsx(dde,{}),x.jsxs(h0,{children:[x.jsx(JLe,{}),x.jsx(hde,{counts:e})]}),x.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:x.jsxs(h0,{children:[x.jsx(fde,{submissions:n,loading:S,onApprove:V.bind(null,"approve"),onReject:V.bind(null,"reject")}),x.jsx(pde,{inquiries:d,loading:S}),x.jsx(mde,{properties:_,loading:S})]})}),x.jsx(gde,{open:I,action:j,item:G,onClose:()=>M(!1),onConfirm:K})]})})};var DW={exports:{}};(function(e,t){(function(n,o){e.exports=o()})(zv,function(){var n,o,d;function f(i,S){if(!n)n=S;else if(!o)o=S;else{var E="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",I={};n(I),d=S(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([E],{type:"text/javascript"})))}}f(["exports"],function(i){var S=1e-6,E=typeof Float32Array<"u"?Float32Array:Array;function I(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=a*g-h*u;return y?(l[0]=g*(y=1/y),l[1]=-u*y,l[2]=-h*y,l[3]=a*y,l):null}function M(){var l=new E(9);return E!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function j(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],A=r[6],C=r[7],R=r[8];return l[0]=y*R-b*C,l[1]=h*C-u*R,l[2]=u*b-h*y,l[3]=b*A-g*R,l[4]=a*R-h*A,l[5]=h*g-a*b,l[6]=g*C-y*A,l[7]=u*A-a*C,l[8]=a*y-u*g,l}function N(l,r,a){var u=r[0],h=r[1],g=r[2],y=r[3],b=r[4],A=r[5],C=r[6],R=r[7],k=r[8],L=a[0],$=a[1],U=a[2],Z=a[3],re=a[4],te=a[5],le=a[6],ue=a[7],pe=a[8];return l[0]=L*u+$*y+U*C,l[1]=L*h+$*b+U*R,l[2]=L*g+$*A+U*k,l[3]=Z*u+re*y+te*C,l[4]=Z*h+re*b+te*R,l[5]=Z*g+re*A+te*k,l[6]=le*u+ue*y+pe*C,l[7]=le*h+ue*b+pe*R,l[8]=le*g+ue*A+pe*k,l}function G(){var l=new E(16);return E!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function z(l){var r=new E(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r}function V(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function K(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],A=r[6],C=r[7],R=r[8],k=r[9],L=r[10],$=r[11],U=r[12],Z=r[13],re=r[14],te=r[15],le=a*b-u*y,ue=a*A-h*y,pe=a*C-g*y,Se=u*A-h*b,_e=u*C-g*b,Ee=h*C-g*A,Me=R*Z-k*U,De=R*re-L*U,nt=R*te-$*U,Ve=k*re-L*Z,lt=k*te-$*Z,ft=L*te-$*re,pt=le*ft-ue*lt+pe*Ve+Se*nt-_e*De+Ee*Me;return pt?(l[0]=(b*ft-A*lt+C*Ve)*(pt=1/pt),l[1]=(h*lt-u*ft-g*Ve)*pt,l[2]=(Z*Ee-re*_e+te*Se)*pt,l[3]=(L*_e-k*Ee-$*Se)*pt,l[4]=(A*nt-y*ft-C*De)*pt,l[5]=(a*ft-h*nt+g*De)*pt,l[6]=(re*pe-U*Ee-te*ue)*pt,l[7]=(R*Ee-L*pe+$*ue)*pt,l[8]=(y*lt-b*nt+C*Me)*pt,l[9]=(u*nt-a*lt-g*Me)*pt,l[10]=(U*_e-Z*pe+te*le)*pt,l[11]=(k*pe-R*_e-$*le)*pt,l[12]=(b*De-y*Ve-A*Me)*pt,l[13]=(a*Ve-u*De+h*Me)*pt,l[14]=(Z*ue-U*Se-re*le)*pt,l[15]=(R*Se-k*ue+L*le)*pt,l):null}function Q(l,r,a){var u=r[0],h=r[1],g=r[2],y=r[3],b=r[4],A=r[5],C=r[6],R=r[7],k=r[8],L=r[9],$=r[10],U=r[11],Z=r[12],re=r[13],te=r[14],le=r[15],ue=a[0],pe=a[1],Se=a[2],_e=a[3];return l[0]=ue*u+pe*b+Se*k+_e*Z,l[1]=ue*h+pe*A+Se*L+_e*re,l[2]=ue*g+pe*C+Se*$+_e*te,l[3]=ue*y+pe*R+Se*U+_e*le,l[4]=(ue=a[4])*u+(pe=a[5])*b+(Se=a[6])*k+(_e=a[7])*Z,l[5]=ue*h+pe*A+Se*L+_e*re,l[6]=ue*g+pe*C+Se*$+_e*te,l[7]=ue*y+pe*R+Se*U+_e*le,l[8]=(ue=a[8])*u+(pe=a[9])*b+(Se=a[10])*k+(_e=a[11])*Z,l[9]=ue*h+pe*A+Se*L+_e*re,l[10]=ue*g+pe*C+Se*$+_e*te,l[11]=ue*y+pe*R+Se*U+_e*le,l[12]=(ue=a[12])*u+(pe=a[13])*b+(Se=a[14])*k+(_e=a[15])*Z,l[13]=ue*h+pe*A+Se*L+_e*re,l[14]=ue*g+pe*C+Se*$+_e*te,l[15]=ue*y+pe*R+Se*U+_e*le,l}function X(l,r,a){var u,h,g,y,b,A,C,R,k,L,$,U,Z=a[0],re=a[1],te=a[2];return r===l?(l[12]=r[0]*Z+r[4]*re+r[8]*te+r[12],l[13]=r[1]*Z+r[5]*re+r[9]*te+r[13],l[14]=r[2]*Z+r[6]*re+r[10]*te+r[14],l[15]=r[3]*Z+r[7]*re+r[11]*te+r[15]):(h=r[1],g=r[2],y=r[3],b=r[4],A=r[5],C=r[6],R=r[7],k=r[8],L=r[9],$=r[10],U=r[11],l[0]=u=r[0],l[1]=h,l[2]=g,l[3]=y,l[4]=b,l[5]=A,l[6]=C,l[7]=R,l[8]=k,l[9]=L,l[10]=$,l[11]=U,l[12]=u*Z+b*re+k*te+r[12],l[13]=h*Z+A*re+L*te+r[13],l[14]=g*Z+C*re+$*te+r[14],l[15]=y*Z+R*re+U*te+r[15]),l}function ie(l,r,a){var u=a[0],h=a[1],g=a[2];return l[0]=r[0]*u,l[1]=r[1]*u,l[2]=r[2]*u,l[3]=r[3]*u,l[4]=r[4]*h,l[5]=r[5]*h,l[6]=r[6]*h,l[7]=r[7]*h,l[8]=r[8]*g,l[9]=r[9]*g,l[10]=r[10]*g,l[11]=r[11]*g,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l}function J(l,r,a){var u=Math.sin(a),h=Math.cos(a),g=r[4],y=r[5],b=r[6],A=r[7],C=r[8],R=r[9],k=r[10],L=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=g*h+C*u,l[5]=y*h+R*u,l[6]=b*h+k*u,l[7]=A*h+L*u,l[8]=C*h-g*u,l[9]=R*h-y*u,l[10]=k*h-b*u,l[11]=L*h-A*u,l}function se(l,r,a){var u=Math.sin(a),h=Math.cos(a),g=r[0],y=r[1],b=r[2],A=r[3],C=r[8],R=r[9],k=r[10],L=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=g*h-C*u,l[1]=y*h-R*u,l[2]=b*h-k*u,l[3]=A*h-L*u,l[8]=g*u+C*h,l[9]=y*u+R*h,l[10]=b*u+k*h,l[11]=A*u+L*h,l}function he(l,r,a){var u=Math.sin(a),h=Math.cos(a),g=r[0],y=r[1],b=r[2],A=r[3],C=r[4],R=r[5],k=r[6],L=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=g*h+C*u,l[1]=y*h+R*u,l[2]=b*h+k*u,l[3]=A*h+L*u,l[4]=C*h-g*u,l[5]=R*h-y*u,l[6]=k*h-b*u,l[7]=L*h-A*u,l}function we(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function ze(l,r,a){var u,h,g,y=a[0],b=a[1],A=a[2],C=Math.sqrt(y*y+b*b+A*A);return C<S?null:(y*=C=1/C,b*=C,A*=C,u=Math.sin(r),h=Math.cos(r),l[0]=y*y*(g=1-h)+h,l[1]=b*y*g+A*u,l[2]=A*y*g-b*u,l[3]=0,l[4]=y*b*g-A*u,l[5]=b*b*g+h,l[6]=A*b*g+y*u,l[7]=0,l[8]=y*A*g+b*u,l[9]=b*A*g-y*u,l[10]=A*A*g+h,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function je(l,r){var a=r[0],u=r[1],h=r[2],g=r[4],y=r[5],b=r[6],A=r[8],C=r[9],R=r[10];return l[0]=Math.sqrt(a*a+u*u+h*h),l[1]=Math.sqrt(g*g+y*y+b*b),l[2]=Math.sqrt(A*A+C*C+R*R),l}function Oe(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=a+a,b=u+u,A=h+h,C=a*y,R=u*y,k=u*b,L=h*y,$=h*b,U=h*A,Z=g*y,re=g*b,te=g*A;return l[0]=1-k-U,l[1]=R+te,l[2]=L-re,l[3]=0,l[4]=R-te,l[5]=1-C-U,l[6]=$+Z,l[7]=0,l[8]=L+re,l[9]=$-Z,l[10]=1-C-k,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}var Be=Q;function qe(){var l=new E(3);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Xe(l){var r=new E(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r}function it(l){var r=l[0],a=l[1],u=l[2];return Math.sqrt(r*r+a*a+u*u)}function Ge(l,r,a){var u=new E(3);return u[0]=l,u[1]=r,u[2]=a,u}function Ke(l,r,a,u){return l[0]=r,l[1]=a,l[2]=u,l}function ut(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l[2]=r[2]+a[2],l}function rt(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l[2]=r[2]-a[2],l}function Xt(l,r,a){return l[0]=r[0]*a[0],l[1]=r[1]*a[1],l[2]=r[2]*a[2],l}function cr(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l}function Bt(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l}function $t(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l}function br(l,r,a,u){return l[0]=r[0]+a[0]*u,l[1]=r[1]+a[1]*u,l[2]=r[2]+a[2]*u,l}function nn(l,r){var a=r[0]-l[0],u=r[1]-l[1],h=r[2]-l[2];return Math.sqrt(a*a+u*u+h*h)}function qn(l,r){var a=r[0]-l[0],u=r[1]-l[1],h=r[2]-l[2];return a*a+u*u+h*h}function lr(l){var r=l[0],a=l[1],u=l[2];return r*r+a*a+u*u}function an(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l}function Lt(l,r){var a=r[0],u=r[1],h=r[2],g=a*a+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),l[0]=r[0]*g,l[1]=r[1]*g,l[2]=r[2]*g,l}function nr(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]}function pr(l,r,a){var u=r[0],h=r[1],g=r[2],y=a[0],b=a[1],A=a[2];return l[0]=h*A-g*b,l[1]=g*y-u*A,l[2]=u*b-h*y,l}function Nt(l,r,a,u){var h=r[0],g=r[1],y=r[2];return l[0]=h+u*(a[0]-h),l[1]=g+u*(a[1]-g),l[2]=y+u*(a[2]-y),l}function zr(l,r,a){var u=r[0],h=r[1],g=r[2],y=a[3]*u+a[7]*h+a[11]*g+a[15];return l[0]=(a[0]*u+a[4]*h+a[8]*g+a[12])/(y=y||1),l[1]=(a[1]*u+a[5]*h+a[9]*g+a[13])/y,l[2]=(a[2]*u+a[6]*h+a[10]*g+a[14])/y,l}function un(l,r,a){var u=r[0],h=r[1],g=r[2];return l[0]=u*a[0]+h*a[3]+g*a[6],l[1]=u*a[1]+h*a[4]+g*a[7],l[2]=u*a[2]+h*a[5]+g*a[8],l}function hi(l,r,a){var u=a[0],h=a[1],g=a[2],y=a[3],b=r[0],A=r[1],C=r[2],R=h*C-g*A,k=g*b-u*C,L=u*A-h*b;return l[0]=b+y*(R+=R)+h*(L+=L)-g*(k+=k),l[1]=A+y*k+g*R-u*L,l[2]=C+y*L+u*k-h*R,l}function Hn(l){return l[0]=0,l[1]=0,l[2]=0,l}function zn(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]}var Qn=rt,zs=Xt,gs=it;function co(){var l=new E(4);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Co(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l[3]=r[3]*a,l}function wo(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=a*a+u*u+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),l[0]=a*y,l[1]=u*y,l[2]=h*y,l[3]=g*y,l}function Hi(l,r,a){var u=r[0],h=r[1],g=r[2],y=r[3];return l[0]=a[0]*u+a[4]*h+a[8]*g+a[12]*y,l[1]=a[1]*u+a[5]*h+a[9]*g+a[13]*y,l[2]=a[2]*u+a[6]*h+a[10]*g+a[14]*y,l[3]=a[3]*u+a[7]*h+a[11]*g+a[15]*y,l}function is(){var l=new E(4);return E!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Io(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function jo(l,r,a){a*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(a),A=Math.cos(a);return l[0]=u*A+y*b,l[1]=h*A+g*b,l[2]=g*A-h*b,l[3]=y*A-u*b,l}function qs(l,r,a){a*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(a),A=Math.cos(a);return l[0]=u*A-g*b,l[1]=h*A+y*b,l[2]=g*A+u*b,l[3]=y*A-h*b,l}qe(),co();var Do,Fs,Pa,Zt=wo,qt=(Do=qe(),Fs=Ge(1,0,0),Pa=Ge(0,1,0),function(l,r,a){var u=nr(r,a);return u<-.999999?(pr(Do,Fs,r),gs(Do)<1e-6&&pr(Do,Pa,r),Lt(Do,Do),function(h,g,y){y*=.5;var b=Math.sin(y);h[0]=b*g[0],h[1]=b*g[1],h[2]=b*g[2],h[3]=Math.cos(y)}(l,Do,Math.PI),l):u>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(pr(Do,r,a),l[0]=Do[0],l[1]=Do[1],l[2]=Do[2],l[3]=1+u,Zt(l,l))});function fr(){var l=new E(2);return E!=Float32Array&&(l[0]=0,l[1]=0),l}function Ir(l,r){var a=new E(2);return a[0]=l,a[1]=r,a}function On(l,r,a){return l[0]=r,l[1]=a,l}function Ii(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l}function eo(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l}function $o(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l}function Lo(l){var r=l[0],a=l[1];return Math.sqrt(r*r+a*a)}function Ca(l,r){var a=r[0],u=r[1],h=a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),l[0]=r[0]*h,l[1]=r[1]*h,l}function Mi(l,r){return l[0]*r[0]+l[1]*r[1]}is(),is(),M();var ln,ui,on=eo;function Zn(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}fr();var ei=function(){if(ui)return ln;function l(r,a,u,h){this.cx=3*r,this.bx=3*(u-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=u,this.p2y=h}return ui=1,ln=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(a===void 0&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var u=r,h=0;h<8;h++){var g=this.sampleCurveX(u)-r;if(Math.abs(g)<a)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var b=0,A=1;for(u=r,h=0;h<20&&(g=this.sampleCurveX(u),!(Math.abs(g-r)<a));h++)r>g?b=u:A=u,u=.5*(A-b)+b;return u},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},ln}(),Vo=Zn(ei);function mt(l,r){this.x=l,this.y=r}function qo(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(!qo(l[a],r[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&r!==null){if(typeof r!="object"||Object.keys(l).length!==Object.keys(r).length)return!1;for(const a in l)if(!qo(l[a],r[a]))return!1;return!0}return l===r}mt.prototype={clone(){return new mt(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,a=l.y-this.y;return r*r+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),a=Math.sin(l),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround(l,r){const a=Math.cos(l),u=Math.sin(l),h=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:mt},mt.convert=function(l){if(l instanceof mt)return l;if(Array.isArray(l))return new mt(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new mt(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ia=Math.PI/180,Uo=180/Math.PI;function Zr(l){return l*Ia}function os(l){return l*Uo}const Py=[[0,0],[1,0],[1,1],[0,1]];function au(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,a=r*l;return 4*(l<.5?a:3*(l-r)+a-.75)}function fh(l,r,a,u){const h=new Vo(l,r,a,u);return function(g){return h.solve(g)}}const We=fh(.25,.1,.25,1);function ne(l,r,a){return Math.min(a,Math.max(r,l))}function ce(l,r,a){return(a=ne((a-l)/(r-l),0,1))*a*(3-2*a)}function ge(l,r,a){const u=a-r,h=((l-r)%u+u)%u+r;return h===r?a:h}function Re(l,r,a){if(!l.length)return a(null,[]);let u=l.length;const h=new Array(l.length);let g=null;l.forEach((y,b)=>{r(y,(A,C)=>{A&&(g=A),h[b]=C,--u==0&&a(g,h)})})}let Ie=1;function Fe(){return Ie++}function Qe(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log2(l)))}function Ue(l,r){l.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Je(l,r,a){const u={};for(const h in l)u[h]=r.call(this,l[h],h,l);return u}function St(l,r,a){const u={};for(const h in l)r.call(this,l[h],h,l)&&(u[h]=l[h]);return u}function ht(l){return Array.isArray(l)?l.map(ht):typeof l=="object"&&l?Je(l,ht):l}function Kt(l,r){for(let a=0;a<l.length;a++)if(r.indexOf(l[a])>=0)return!0;return!1}const dr={};function Ut(l){dr[l]||(typeof console<"u"&&console.warn(l),dr[l]=!0)}function Fr(l,r,a){return(a.y-l.y)*(r.x-l.x)>(r.y-l.y)*(a.x-l.x)}function Lr(l){let r=0;for(let a,u,h=0,g=l.length,y=g-1;h<g;y=h++)a=l[h],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}function jr([l,r,a]){const u=Zr(r+90),h=Zr(a);return{x:l*Math.cos(u)*Math.sin(h),y:l*Math.sin(u)*Math.sin(h),z:l*Math.cos(h),azimuthal:r,polar:a}}function dn(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function Ei(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,h,g)=>{const y=h||g;return r[u]=!y||y.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Wi=null;function Oi(l,r){return[l[4*r],l[4*r+1],l[4*r+2],l[4*r+3]]}function Ji(l,r,a,u){for(;r<a;){const h=r+a>>1;l[h]<u?r=h+1:a=h}return r}function wi(l,r,a,u){for(;r<a;){const h=r+a>>1;l[h]<=u?r=h+1:a=h}return r}function gn(l){return l>0?1/(1.001-l):1+l}function Si(l){return l>0?1-1/(1.001-l):-l}function ti(l,r,a){return(l-r.min)*(a.max-a.min)/(r.max-r.min)+a.min}const Jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Jr.API_URL)return null;try{const l=new URL(Jr.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ri(l){return Jr.API_URL_REGEX.test(l)}function Go(l){return Jr.API_SPRITE_REGEX.test(l)}let Zo,Cs,lu,Mo,Zs,ss;function Ya(){return Zo==null&&(Zo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Zo}const So={now:()=>Mo!==void 0?Mo:performance.now(),setNow(l){Mo=l},restoreNow(){Mo=void 0},frame(l){const r=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(l,r=0){const{width:a,height:u}=l;Zs||(Zs=document.createElement("canvas"));const h=Zs.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(a>Zs.width||u>Zs.height)&&(Zs.width=a,Zs.height=u),h.clearRect(-r,-r,a+2*r,u+2*r),h.drawImage(l,0,0,a,u),h.getImageData(-r,-r,a+2*r,u+2*r)},resolveURL:l=>(Cs||(Cs=document.createElement("a")),Cs.href=l,Cs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(lu==null&&(lu=window.matchMedia("(prefers-reduced-motion: reduce)")),lu.matches)},hasCanvasFingerprintNoise(){if(ss!==void 0)return ss;if(!Ya())return ss=!1,!1;const l=new OffscreenCanvas(85,1),r=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let h=0;h<l.width;++h)r.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,r.fillRect(h,0,1,1);const u=r.getImageData(0,0,l.width,l.height);a=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&a++!==u.data[h])return ss=!0,!0;return ss=!1,!1}};function cu(l,r){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(r).toString()}`;const u=new URLSearchParams(l.slice(a));for(const h in r)u.set(h,r[h]);return`${l.slice(0,a)}?${u.toString()}`}function id(l,r={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const u=new URLSearchParams,h=new URLSearchParams(l.slice(a));for(const y of r.persistentParams){const b=h.get(y);b&&u.set(y,b)}const g=u.toString();return`${l.slice(0,a)}${g.length>0?`?${g}`:""}`}const ap="mapbox-tiles";let lp=500,cp=50;const ph=["language","worldview","jobid"];let Ja,Is;function Ma(){try{return caches}catch{}}function Oa(){const l=Ma();l&&Ja==null&&(Ja=l.open(ap))}let la=1/0;const Qa={supported:!1,testSupport:function(l){!up&&uu&&(du?bx(l):_c=l)}};let _c,uu,up=!1,du=!1;const dp=typeof self<"u"?self:{};function bx(l){const r=l.createTexture();l.bindTexture(l.TEXTURE_2D,r);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,uu),l.isContextLost())return;Qa.supported=!0}catch{}l.deleteTexture(r),up=!0}dp.document&&(uu=dp.document.createElement("img"),uu.onload=function(){_c&&bx(_c),_c=null,du=!0},uu.onerror=function(){up=!0,_c=null},uu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(mh);class Bs extends Error{constructor(r,a,u){a===401&&Ri(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const hp=dn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,hu=function(l,r){if(!(/^file:/.test(a=l.url)||/^file:/.test(hp())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:hp(),referrerPolicy:u.referrerPolicy,signal:g.signal});let b=!1,A=!1;const C=(R=y.url).indexOf("sku=")>0&&Ri(R);var R;u.type==="json"&&y.headers.set("Accept","application/json");const k=($,U,Z)=>{if(A)return;if($&&$.message!=="SecurityError"&&Ut($.toString()),U&&Z)return L(U);const re=Date.now();fetch(y).then(te=>{if(te.ok){const le=C?te.clone():null;return L(te,le,re)}return h(new Bs(te.statusText,te.status,u.url))}).catch(te=>{te.name!=="AbortError"&&h(new Error(`${te.message} ${u.url}`))})},L=($,U,Z)=>{(u.type==="arrayBuffer"?$.arrayBuffer():u.type==="json"?$.json():$.text()).then(re=>{A||(U&&Z&&function(te,le,ue){if(Oa(),Ja==null)return;const pe=Ei(le.headers.get("Cache-Control")||"");if(pe["no-store"])return;const Se={status:le.status,statusText:le.statusText,headers:new Headers};le.headers.forEach((Me,De)=>Se.headers.set(De,Me)),pe["max-age"]&&Se.headers.set("Expires",new Date(ue+1e3*pe["max-age"]).toUTCString());const _e=Se.headers.get("Expires");if(!_e||new Date(_e).getTime()-ue<42e4)return;let Ee=id(te.url,{persistentParams:ph});if(le.status===206){const Me=te.headers.get("Range");if(!Me)return;Se.status=200,Ee=cu(Ee,{range:Me})}(function(Me,De){if(Is===void 0)try{new Response(new ReadableStream),Is=!0}catch{Is=!1}Is?De(Me.body):Me.blob().then(De).catch(nt=>Ut(nt.message))})(le,Me=>{const De=new Response((nt=le.status)!==200&&nt!==404&&[101,103,204,205,304].includes(nt)?null:Me,Se);var nt;Oa(),Ja?.then(Ve=>Ve.put(Ee,De)).catch(Ve=>Ut(Ve.message))})}(y,U,Z),b=!0,h(null,re,$.headers))}).catch(re=>{A||h(new Error(re.message))})};return C?function($,U){if(Oa(),Ja==null)return U(null);Ja.then(Z=>{let re=id($.url,{persistentParams:ph});const te=$.headers.get("Range");te&&(re=cu(re,{range:te})),Z.match(re).then(le=>{const ue=function(pe){if(!pe)return!1;const Se=new Date(pe.headers.get("Expires")||0),_e=Ei(pe.headers.get("Cache-Control")||"");return Number(Se)>Date.now()&&!_e["no-cache"]}(le);Z.delete(re).catch(U),ue&&Z.put(re,le.clone()).catch(U),U(null,le,ue)}).catch(U)}).catch(U)}(y,k):k(null,null),{cancel:()=>{A=!0,b||g.abort()}}}(l,r);if(dn(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,r,void 0,!0)}var a;return function(u,h){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(A){return h(A)}const b=new Headers;g.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(A=>{const C=A.split(": "),R=C.shift(),k=C.join(": ");b.append(R,k)}),h(null,y,b)}else h(new Bs(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(l,r)},Cl=function(l,r){return hu(Object.assign(l,{type:"arrayBuffer"}),r)};function _2(l){const r=document.createElement("a");return r.href=l,r.protocol===location.protocol&&r.host===location.host}const wx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gh,yn;gh=[],yn=0;const fp=function(l,r){if(Qa.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),yn>=Jr.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:l,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return gh.push(g),g}yn++;let a=!1;const u=()=>{if(!a)for(a=!0,yn--;gh.length&&yn<Jr.MAX_PARALLEL_IMAGE_REQUESTS;){const g=gh.shift(),{requestParameters:y,callback:b,cancelled:A}=g;A||(g.cancel=fp(y,b).cancel)}},h=Cl(l,(g,y,b)=>{u(),g?r(g):y&&(self.createImageBitmap?function(A,C){const R=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(R).then(k=>{C(null,k)}).catch(k=>{C(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(A,C)=>r(A,C,b)):function(A,C){const R=new Image;R.onload=()=>{C(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=wx})},R.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(A)],{type:"image/png"});R.src=A.byteLength?URL.createObjectURL(k):wx}(y,(A,C)=>r(A,C,b)))});return{cancel:()=>{h.cancel(),u()}}};var Cy,Sx,Tx,vc={exports:{}},yh={exports:{}},_h={exports:{}},Iy=function(){if(Tx)return vc.exports;Tx=1;var l=(Cy||(Cy=1,yh.exports=function(a,u){var h,g,y,b,A,C,R,k;for(g=a.length-(h=3&a.length),y=u,A=3432918353,C=461845907,k=0;k<g;)R=255&a.charCodeAt(k)|(255&a.charCodeAt(++k))<<8|(255&a.charCodeAt(++k))<<16|(255&a.charCodeAt(++k))<<24,++k,y=27492+(65535&(b=5*(65535&(y=(y^=R=(65535&(R=(R=(65535&R)*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(R=0,h){case 3:R^=(255&a.charCodeAt(k+2))<<16;case 2:R^=(255&a.charCodeAt(k+1))<<8;case 1:y^=R=(65535&(R=(R=(65535&(R^=255&a.charCodeAt(k)))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<15|R>>>17))*C+(((R>>>16)*C&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),yh.exports),r=(Sx||(Sx=1,_h.exports=function(a,u){for(var h,g=a.length,y=u^g,b=0;g>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++b;switch(g){case 3:y^=(255&a.charCodeAt(b+2))<<16;case 2:y^=(255&a.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),_h.exports);return vc.exports=l,vc.exports.murmur3=l,vc.exports.murmur2=r,vc.exports}(),pp=Zn(Iy);class el{constructor(r,...a){Object.assign(this,a[0]||{}),this.type=r}}class vh extends el{constructor(r,a={}){super("error",Object.assign({error:r},a))}}function My(l,r,a){a[l]&&a[l].indexOf(r)!==-1||(a[l]=a[l]||[],a[l].push(r))}function xc(l,r,a){if(a&&a[l]){const u=a[l].indexOf(r);u!==-1&&a[l].splice(u,1)}}class fu{on(r,a){return this._listeners=this._listeners||{},My(r,a,this._listeners),this}off(r,a){return xc(r,a,this._listeners),xc(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},My(r,a,this._oneTimeListeners),this):new Promise(u=>{this.once(r,u)})}fire(r,a){const u=typeof r=="string"?new el(r,a):r,h=u.type;if(this.listens(h)){u.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const A of g)A.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const A of y)xc(h,A,this._oneTimeListeners),A.call(this,u);const b=this._eventedParent;if(b){const A=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,A),b.fire(u)}}else u instanceof vh&&console.error(u.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}class as{constructor(r){typeof r=="string"?this.name=r:(this.name=r.name,this.iconsetId=r.iconsetId)}static from(r){return new as(r)}static toString(r){return r.iconsetId?`${r.name}${r.iconsetId}`:r.name}static parse(r){const[a,u]=r.split("");return new as({name:a,iconsetId:u})}static isEqual(r,a){return r.name===a.name&&r.iconsetId===a.iconsetId}toString(){return as.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var mp,xh={},ca=function(){if(mp)return xh;mp=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(g){return(g=Math.round(g))<0?0:g>255?255:g}function a(g){return r(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function h(g,y,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?g+(y-g)*b*6:2*b<1?y:3*b<2?g+(y-g)*(2/3-b)*6:g}try{xh.parseCSSColor=function(g){var y,b=g.replace(/ /g,"").toLowerCase();if(b in l)return l[b].slice();if(b[0]==="#")return b.length===4?(y=parseInt(b.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:b.length===7&&(y=parseInt(b.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var A=b.indexOf("("),C=b.indexOf(")");if(A!==-1&&C+1===b.length){var R=b.substr(0,A),k=b.substr(A+1,C-(A+1)).split(","),L=1;switch(R){case"rgba":if(k.length!==4)return null;L=u(k.pop());case"rgb":return k.length!==3?null:[a(k[0]),a(k[1]),a(k[2]),L];case"hsla":if(k.length!==4)return null;L=u(k.pop());case"hsl":if(k.length!==3)return null;var $=(parseFloat(k[0])%360+360)%360/360,U=u(k[1]),Z=u(k[2]),re=Z<=.5?Z*(U+1):Z+U-Z*U,te=2*Z-re;return[r(255*h(te,re,$+1/3)),r(255*h(te,re,$)),r(255*h(te,re,$-1/3)),L];default:return null}}return null}}catch{}return xh}();class kn{constructor(r,a,u,h=1){this.r=r,this.g=a,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof kn)return r;if(typeof r!="string")return;const a=ca.parseCSSColor(r);return a?new kn(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[r,a,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*r)},${Math.round(255*a)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(r){const{r:a,g:u,b:h,a:g}=this;return new Ex(r,a,u,h,g)}toPremultipliedRenderColor(r){const{r:a,g:u,b:h,a:g}=this;return new Px(r,a*g,u*g,h*g,g)}clone(){return new kn(this.r,this.g,this.b,this.a)}}class Ax{constructor(r,a,u,h,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,r){const b=r.image.height,A=b*b;this.premultiplied?(a=g===0?0:a/g*(b-1),u=g===0?0:u/g*(b-1),h=g===0?0:h/g*(b-1)):(a*=b-1,u*=b-1,h*=b-1);const C=Math.floor(a),R=Math.floor(u),k=Math.floor(h),L=Math.ceil(a),$=Math.ceil(u),U=Math.ceil(h),Z=a-C,re=u-R,te=h-k,le=r.image.data,ue=4*(C+R*A+k*b),pe=4*(C+R*A+U*b),Se=4*(C+$*A+k*b),_e=4*(C+$*A+U*b),Ee=4*(L+R*A+k*b),Me=4*(L+R*A+U*b),De=4*(L+$*A+k*b),nt=4*(L+$*A+U*b);if(ue<0||nt>=le.length)throw new Error("out of range");this.r=xr(xr(xr(le[ue],le[pe],te),xr(le[Se],le[_e],te),re),xr(xr(le[Ee],le[Me],te),xr(le[De],le[nt],te),re),Z)/255*(this.premultiplied?g:1),this.g=xr(xr(xr(le[ue+1],le[pe+1],te),xr(le[Se+1],le[_e+1],te),re),xr(xr(le[Ee+1],le[Me+1],te),xr(le[De+1],le[nt+1],te),re),Z)/255*(this.premultiplied?g:1),this.b=xr(xr(xr(le[ue+2],le[pe+2],te),xr(le[Se+2],le[_e+2],te),re),xr(xr(le[Ee+2],le[Me+2],te),xr(le[De+2],le[nt+2],te),re),Z)/255*(this.premultiplied?g:1),this.a=g}else this.r=a,this.g=u,this.b=h,this.a=g}toArray(){const{r,g:a,b:u,a:h}=this;return[255*r,255*a,255*u,h]}toHslaArray(){let{r,g:a,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const U=1/h;r*=U,a*=U,u*=U}const g=Math.min(Math.max(r,0),1),y=Math.min(Math.max(a,0),1),b=Math.min(Math.max(u,0),1),A=Math.min(g,y,b),C=Math.max(g,y,b),R=C-A,k=.5*(A+C);if(R===0)return[0,0,100*k,h];const L=k>.5?R/(2-C-A):R/(C+A);let $;switch(C){case g:$=60*((y-b)/R+(y<b?6:0));break;case y:$=60*((b-g)/R+2);break;default:$=60*((g-y)/R+4)}return[$,100*L,100*k,h]}toArray01(){const{r,g:a,b:u,a:h}=this;return[r,a,u,h]}toArray01Scaled(r){const{r:a,g:u,b:h}=this;return[a*r,u*r,h*r]}toArray01Linear(){const{r,g:a,b:u,a:h}=this;return[Math.pow(r,2.2),Math.pow(a,2.2),Math.pow(u,2.2),h]}}class Ex extends Ax{constructor(r,a,u,h,g){super(r,a,u,h,g,!1)}}class Px extends Ax{constructor(r,a,u,h,g){super(r,a,u,h,g,!0)}}function xr(l,r,a){return l*(1-a)+r*a}function Oy(l,r,a){return l.map((u,h)=>xr(u,r[h],a))}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1),kn.blue=new kn(0,0,1,1);var bh=Object.freeze({__proto__:null,array:Oy,color:function(l,r,a){return new kn(xr(l.r,r.r,a),xr(l.g,r.g,a),xr(l.b,r.b,a),xr(l.a,r.a,a))},number:xr});class ua extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class od{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[u,h]of a)this.bindings[u]=h}concat(r){return new od(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ra={kind:"null"},ar={kind:"number"},cn={kind:"string"},Fn={kind:"boolean"},Ms={kind:"color"},tl={kind:"object"},Rn={kind:"value"},gp={kind:"collator"},wh={kind:"formatted"},Sh={kind:"resolvedImage"};function Ko(l,r){return{kind:"array",itemType:l,N:r}}function qi(l){if(l.kind==="array"){const r=qi(l.itemType);return typeof l.N=="number"?`array<${r}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${r}>`}return l.kind}const v2=[Ra,ar,cn,Fn,Ms,wh,tl,Ko(Rn),Sh];function bc(l,r){if(r.kind==="error")return null;if(l.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!bc(l.itemType,r.itemType))&&(typeof l.N!="number"||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if(l.kind==="value"){for(const a of v2)if(!bc(a,r))return null}}return`Expected ${qi(l)} but found ${qi(r)} instead.`}function Ry(l,r){return r.some(a=>a.kind===l.kind)}function Th(l,r){return r.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function yp(l,r){return l.kind==="array"&&r.kind==="array"?l.N===r.N&&yp(l.itemType,r.itemType):l.kind===r.kind}class ky{constructor(r,a,u){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _p{constructor(r,a,u,h,g){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=u,this.fontStack=h,this.textColor=g}}class ys{constructor(r){this.sections=r}static fromString(r){return new ys([new _p(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||!!r.image&&r.image.hasPrimary())}static factory(r){return r instanceof ys?r:ys.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){const h=a.image.getPrimary().id.toString();r.push(["image",h]);continue}r.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),r.push(u)}return r}}class Il{constructor(r,a={}){this.id=as.from(r),this.params=a.params,this.sx=a.sx||1,this.sy=a.sy||1}toString(){return JSON.stringify(this)}static parse(r){let a,u,h,g;try{({id:a,params:u,sx:h,sy:g}=JSON.parse(r)||{})}catch{return null}return a?new Il(a,{params:u,sx:h,sy:g}):null}scaleSelf(r,a=r){return this.sx*=r,this.sy*=a,this}}class _s{constructor(r,a,u,h,g=!1){this.primaryId=as.from(r),this.primaryOptions=a,u&&(this.secondaryId=as.from(u)),this.secondaryOptions=h,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Il(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Il(this.secondaryId,this.secondaryOptions):null}static from(r){return typeof r=="string"?_s.build({name:r}):r}static build(r,a,u,h){return!r||typeof r=="object"&&!("name"in r)?null:new _s(r,u,a,h)}}function pu(l,r,a,u){return typeof l=="number"&&l>=0&&l<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,r,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,r,a,u]:[l,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sd(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof kn||l instanceof ky||l instanceof ys||l instanceof _s)return!0;if(Array.isArray(l)){for(const r of l)if(!sd(r))return!1;return!0}if(typeof l=="object"){for(const r in l)if(!sd(l[r]))return!1;return!0}return!1}function To(l){if(l===null)return Ra;if(typeof l=="string")return cn;if(typeof l=="boolean")return Fn;if(typeof l=="number")return ar;if(l instanceof kn)return Ms;if(l instanceof ky)return gp;if(l instanceof ys)return wh;if(l instanceof _s)return Sh;if(Array.isArray(l)){const r=l.length;let a;for(const u of l){const h=To(u);if(a){if(a===h)continue;a=Rn;break}a=h}return Ko(a||Rn,r)}return tl}function da(l){const r=typeof l;return l===null?"":r==="string"||r==="number"||r==="boolean"?String(l):l instanceof ys||l instanceof _s||l instanceof kn?l.toString():JSON.stringify(l)}class Ml{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!sd(r[1]))return a.error("invalid value");const u=r[1];let h=To(u);const g=a.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Ml(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof kn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ys?this.value.serialize():this.value}}class uo{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const jy={string:cn,number:ar,boolean:Fn,object:tl};class ka{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let u,h=1;const g=r[0];if(g==="array"){let b,A;if(r.length>2){const C=r[1];if(typeof C!="string"||!(C in jy)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=jy[C],h++}else b=Rn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);A=r[2],h++}u=Ko(b,A)}else u=jy[g];const y=[];for(;h<r.length;h++){const b=a.parse(r[h],h,Rn);if(!b)return null;y.push(b)}return new ka(u,y)}evaluate(r){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(r);if(!bc(this.type,To(u)))return u;if(a===this.args.length-1)throw new uo(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${qi(To(u))} but was expected to be of type ${qi(this.type)}.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if(r.kind==="array"){const u=r.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const h=r.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(u=>u.serialize()))}}class rl{constructor(r){this.type=wh,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=r.length-1;++y){const b=r[y];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let A=null;if(b["font-scale"]&&(A=a.parseObjectValue(b["font-scale"],y,"font-scale",ar),!A))return null;let C=null;if(b["text-font"]&&(C=a.parseObjectValue(b["text-font"],y,"text-font",Ko(cn)),!C))return null;let R=null;if(b["text-color"]&&(R=a.parseObjectValue(b["text-color"],y,"text-color",Ms),!R))return null;const k=h[h.length-1];k.scale=A,k.font=C,k.textColor=R}else{const A=a.parse(r[y],y,Rn);if(!A)return null;const C=A.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:A,scale:null,font:null,textColor:null})}}return new rl(h)}evaluate(r){return new ys(this.sections.map(a=>{const u=a.content.evaluate(r);return yp(To(u),Sh)?new _p("",u,null,null,null):new _p(da(u),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),r.push(u)}return r}}class Nr{constructor(r,a,u,h){this._imageWarnHistory={},this.type=Sh,this.namePrimary=r,this.nameSecondary=a,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(r,a){if(r.length<2)return a.error("Expected two or more arguments.");let u=1;const h=[];function g(){if(u<r.length){const b=a.parse(r[u],u++,cn);return b?(h.push({image:b,options:{}}),!0):(a.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<r.length){const A=r[u];if((b=A)===null||typeof b!="object"||Array.isArray(b))return!0;const C=A.params,R=A.iconset,k=a.concat(u);if(!C&&!R)return u++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return k.error('Image options "params" should be an object'),!1;const L={},$=k.concat(void 0,"params");for(const U in C){if(!U)return $.error("Image parameter name should be non-empty"),!1;const Z=$.concat(void 0,U).parse(C[U],void 0,Ms,void 0,{typeAnnotation:"coerce"});if(!Z)return!1;L[U]=Z}h[h.length-1].options.params=L}if(R){if(typeof R!="object"||R.constructor!==Object)return k.error('Image options "iconset" should be an object'),!1;if(!R.id)return k.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=R}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!g()||!y())return;return new Nr(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(r,a){const u={};if(a){for(const h in a)if(a[h])try{u[h]=a[h].evaluate(r)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(r){const a={name:this.namePrimary.evaluate(r),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(r),iconsetId:this.iconsetIdSecondary}:void 0,h=_s.build(a,u,this.paramsPrimary?this.evaluateParams(r,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(r,this.paramsSecondary):void 0);if(h&&r.availableImages){const g=h.getPrimary().id;if(h.available=r.availableImages.some(y=>as.isEqual(y,g)),h.available){const y=h.getSecondary()?h.getSecondary().id:null;y&&(h.available=r.availableImages.some(b=>as.isEqual(b,y)))}}return h}eachChild(r){if(r(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&r(this.paramsPrimary[a]);if(this.nameSecondary&&(r(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&r(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(r,a){const u={};if(a&&(u.iconset={id:a}),r){u.params={};for(const h in r)r[h]&&(u.params[h]=r[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const r=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&r.push(a)}if(this.nameSecondary&&(r.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&r.push(a)}return r}}function ir(l){return Ar(l)?"string":ad(l)?"number":xp(l)?"boolean":Array.isArray(l)?"array":l===null?"null":vp(l)?"object":typeof l}function vp(l){return l!=null&&!Array.isArray(l)&&typeof l!="function"&&!(l instanceof String||l instanceof Number||l instanceof Boolean)&&typeof l=="object"}function Ar(l){return typeof l=="string"||l instanceof String}function ad(l){return typeof l=="number"||l instanceof Number}function xp(l){return typeof l=="boolean"||l instanceof Boolean}const wr={"to-boolean":Fn,"to-color":Ms,"to-number":ar,"to-string":cn};class nl{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[0],h=[];let g=Ra;if(u==="to-array"){if(!Array.isArray(r[1]))return null;const y=r[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);g=Ko(a.expectedType.itemType,y)}else{if(!(y>0&&sd(r[1][0])))return null;g=Ko(To(r[1][0]),y)}for(let b=0;b<y;b++){const A=r[1][b];let C;if(Array.isArray(A))C=a.parse(A,void 0,g.itemType);else{const R=ir(A);if(R!==g.itemType.kind)return a.error(`Expected ${g.itemType.kind} but found ${R}.`);C=a.registry.literal.parse(["literal",A===void 0?null:A],a)}if(!C)return null;h.push(C)}}else{if((u==="to-boolean"||u==="to-string")&&r.length!==2)return a.error("Expected one argument.");g=wr[u];for(let y=1;y<r.length;y++){const b=a.parse(r[y],y,Rn);if(!b)return null;h.push(b)}}return new nl(g,h)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let a,u;for(const h of this.args){if(a=h.evaluate(r),u=null,a instanceof kn)return a;if(typeof a=="string"){const g=r.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:pu(a[0],a[1],a[2],a[3]),!u))return new kn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new uo(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(r),a===null)return 0;const h=Number(a);if(!isNaN(h))return h}throw new uo(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?ys.fromString(da(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?_s.build(da(this.args[0].evaluate(r))):this.type.kind==="array"?this.args.map(a=>a.evaluate(r)):da(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new rl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Nr(this.args[0]).serialize();const r=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Dy=["Unknown","Point","LineString","Polygon"];class bp{constructor(r,a,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=a,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-r[0])+this.featureDistanceData.bearing[1]*(h*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=kn.parse(r)),a}getConfig(r){return this.options?this.options.get(r):null}}class vs{constructor(r,a,u,h,g){this.name=r,this.type=a,this._evaluate=u,this.args=h,this._overloadIndex=g}evaluate(r){if(!this._evaluate){const a=vs.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const u=r[0],h=vs.definitions[u];if(!h)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let A=null,C=-1;for(const[R,k]of y){if(Array.isArray(R)&&R.length!==r.length-1)continue;b.push(R),C++,A=new kp(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const L=[];let $=!1;for(let U=1;U<r.length;U++){const Z=r[U],re=Array.isArray(R)?R[U-1]:R.type,te=A.parse(Z,1+L.length,re);if(!te){$=!0;break}L.push(te)}if(!$)if(Array.isArray(R)&&R.length!==L.length)A.error(`Expected ${R.length} arguments, but found ${L.length} instead.`);else{for(let U=0;U<L.length;U++){const Z=Array.isArray(R)?R[U]:R.type,re=L[U];A.concat(U+1).checkSubtype(Z,re.type)}if(A.errors.length===0)return new vs(u,g,k,L,C)}}if(b.length===1)a.errors.push(...A.errors);else{const R=(b.length?b:y.map(([L])=>L)).map(wp).join(" | "),k=[];for(let L=1;L<r.length;L++){const $=a.parse(r[L],1+k.length);if(!$)return null;k.push(qi($.type))}a.error(`Expected arguments of type ${R}, but found (${k.join(", ")}) instead.`)}return null}static register(r,a){vs.definitions=a;for(const u in a)r[u]=vs}}function wp(l){return Array.isArray(l)?`(${l.map(qi).join(", ")})`:`(${qi(l.type)}...)`}class Oo{constructor(r,a,u){this.type=gp,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const u=r[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?a.parse(!1,1,Fn):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Fn);if(!h)return null;const g=u["diacritic-sensitive"]===void 0?a.parse(!1,1,Fn):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Fn);if(!g)return null;let y=null;return u.locale&&(y=a.parseObjectValue(u.locale,1,"locale",cn),!y)?null:new Oo(h,g,y)}evaluate(r){return new ky(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}function Sp(l,r,a=0,u=l.length-1,h=Ly){for(;u>a;){if(u-a>600){const A=u-a+1,C=r-a+1,R=Math.log(A),k=.5*Math.exp(2*R/3),L=.5*Math.sqrt(R*k*(A-k)/A)*(C-A/2<0?-1:1);Sp(l,r,Math.max(a,Math.floor(r-C*k/A+L)),Math.min(u,Math.floor(r+(A-C)*k/A+L)),h)}const g=l[r];let y=a,b=u;for(ja(l,a,r),h(l[u],g)>0&&ja(l,a,u);y<b;){for(ja(l,y,b),y++,b--;h(l[y],g)<0;)y++;for(;h(l[b],g)>0;)b--}h(l[a],g)===0?ja(l,a,b):(b++,ja(l,b,u)),b<=r&&(a=b+1),r<=b&&(u=b-1)}}function ja(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}function Ly(l,r){return l<r?-1:l>r?1:0}function wc(l){let r=0;for(let a,u,h=0,g=l.length,y=g-1;h<g;y=h++)a=l[h],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}function ha(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ah(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function x2(l,r,a){const u=l[0]-r[0],h=l[1]-r[1],g=l[0]-a[0],y=l[1]-a[1];return u*y-g*h==0&&u*g<=0&&h*y<=0}function ld(l,r,a=!1){let u=!1;for(let b=0,A=r.length;b<A;b++){const C=r[b];for(let R=0,k=C.length,L=k-1;R<k;L=R++){const $=C[L],U=C[R];if(x2(l,$,U))return a;(g=$)[1]>(h=l)[1]!=(y=U)[1]>h[1]&&h[0]<(y[0]-g[0])*(h[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var h,g,y;return u}function Eh(l,r,a,u){const h=u[0]-a[0],g=u[1]-a[1],y=(l[0]-a[0])*g-h*(l[1]-a[1]),b=(r[0]-a[0])*g-h*(r[1]-a[1]);return y>0&&b<0||y<0&&b>0}function Ph(l,r,a,u){return(h=[u[0]-a[0],u[1]-a[1]])[0]*(g=[r[0]-l[0],r[1]-l[1]])[1]-h[1]*g[0]!=0&&!(!Eh(l,r,a,u)||!Eh(a,u,l,r));var h,g}function Ol(l){const r=new mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of l[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:r,max:a}}const Sc=8192;function b2(l,r){const a=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*Sc),Math.round(u*h*Sc)]}function Ny(l,r){for(let a=0;a<r.length;a++)if(ld(l,r[a]))return!0;return!1}function w2(l,r,a){for(const u of a)for(let h=0,g=u.length,y=g-1;h<g;y=h++)if(Ph(l,r,u[y],u[h]))return!0;return!1}function Cx(l,r){for(let a=0;a<l.length;++a)if(!ld(l[a],r))return!1;for(let a=0;a<l.length-1;++a)if(w2(l[a],l[a+1],r))return!1;return!0}function Ix(l,r){for(let a=0;a<r.length;a++)if(Cx(l,r[a]))return!0;return!1}function zy(l,r,a){const u=[];for(let h=0;h<l.length;h++){const g=[];for(let y=0;y<l[h].length;y++){const b=b2(l[h][y],a);ha(r,b),g.push(b)}u.push(g)}return u}function Tc(l,r,a){const u=[];for(let h=0;h<l.length;h++){const g=zy(l[h],r,a);u.push(g)}return u}function Mx(l,r,a,u){if(l[0]<a[0]||l[0]>a[2]){const h=.5*u;let g=l[0]-a[0]>h?-u:a[0]-l[0]>h?u:0;g===0&&(g=l[0]-a[2]>h?-u:a[2]-l[0]>h?u:0),l[0]+=g}ha(r,l)}function Ox(l,r,a,u){const h=Math.pow(2,u.z)*Sc,g=[u.x*Sc,u.y*Sc],y=[];if(!l)return y;for(const b of l)for(const A of b){const C=[A.x+g[0],A.y+g[1]];Mx(C,r,a,h),y.push(C)}return y}function Tp(l,r,a,u){const h=Math.pow(2,u.z)*Sc,g=[u.x*Sc,u.y*Sc],y=[];if(!l)return y;for(const A of l){const C=[];for(const R of A){const k=[R.x+g[0],R.y+g[1]];ha(r,k),C.push(k)}y.push(C)}if(r[2]-r[0]<=h/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const A of y)for(const C of A)Mx(C,r,a,h)}var b;return y}class Ac{constructor(r,a){this.type=Fn,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(sd(r[1])){const u=r[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ac(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ac(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Ac(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=zy(u.coordinates,g,y),A=Ox(a.geometry(),h,g,y);if(!Ah(h,g))return!1;for(const C of A)if(!ld(C,b))return!1}if(u.type==="MultiPolygon"){const b=Tc(u.coordinates,g,y),A=Ox(a.geometry(),h,g,y);if(!Ah(h,g))return!1;for(const C of A)if(!Ny(C,b))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const b=zy(u.coordinates,g,y),A=Tp(a.geometry(),h,g,y);if(!Ah(h,g))return!1;for(const C of A)if(!Cx(C,b))return!1}if(u.type==="MultiPolygon"){const b=Tc(u.coordinates,g,y),A=Tp(a.geometry(),h,g,y);if(!Ah(h,g))return!1;for(const C of A)if(!Ix(C,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ch={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},fa=1/298.257223563,Rx=fa*(2-fa),cd=Math.PI/180;class ud{static fromTile(r,a,u){const h=Math.PI*(1-2*(r+.5)/Math.pow(2,a)),g=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/cd;return new ud(g,u)}static get units(){return Ch}constructor(r,a){if(r===void 0)throw new Error("No latitude given.");if(a&&!Ch[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Ch).join(", ")}`);const u=6378.137*cd*(a?Ch[a]:1),h=Math.cos(r*cd),g=1/(1-Rx*(1-h*h)),y=Math.sqrt(g);this.kx=u*y*h,this.ky=u*y*g*(1-Rx)}distance(r,a){const u=Ks(r[0]-a[0])*this.kx,h=(r[1]-a[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(r,a){const u=Ks(a[0]-r[0])*this.kx;return Math.atan2(u,(a[1]-r[1])*this.ky)/cd}destination(r,a,u){const h=u*cd;return this.offset(r,Math.sin(h)*a,Math.cos(h)*a)}offset(r,a,u){return[r[0]+a/this.kx,r[1]+u/this.ky]}lineDistance(r){let a=0;for(let u=0;u<r.length-1;u++)a+=this.distance(r[u],r[u+1]);return a}area(r){let a=0;for(let u=0;u<r.length;u++){const h=r[u];for(let g=0,y=h.length,b=y-1;g<y;b=g++)a+=Ks(h[g][0]-h[b][0])*(h[g][1]+h[b][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(r,a){let u=0;if(a<=0)return r[0];for(let h=0;h<r.length-1;h++){const g=r[h],y=r[h+1],b=this.distance(g,y);if(u+=b,u>a)return Ap(g,y,(a-(u-b))/b)}return r[r.length-1]}pointToSegmentDistance(r,a,u){let[h,g]=a,y=Ks(u[0]-h)*this.kx,b=(u[1]-g)*this.ky;if(y!==0||b!==0){const A=(Ks(r[0]-h)*this.kx*y+(r[1]-g)*this.ky*b)/(y*y+b*b);A>1?(h=u[0],g=u[1]):A>0&&(h+=y/this.kx*A,g+=b/this.ky*A)}return y=Ks(r[0]-h)*this.kx,b=(r[1]-g)*this.ky,Math.sqrt(y*y+b*b)}pointOnLine(r,a){let u=1/0,h=r[0][0],g=r[0][1],y=0,b=0;for(let A=0;A<r.length-1;A++){let C=r[A][0],R=r[A][1],k=Ks(r[A+1][0]-C)*this.kx,L=(r[A+1][1]-R)*this.ky,$=0;k===0&&L===0||($=(Ks(a[0]-C)*this.kx*k+(a[1]-R)*this.ky*L)/(k*k+L*L),$>1?(C=r[A+1][0],R=r[A+1][1]):$>0&&(C+=k/this.kx*$,R+=L/this.ky*$)),k=Ks(a[0]-C)*this.kx,L=(a[1]-R)*this.ky;const U=k*k+L*L;U<u&&(u=U,h=C,g=R,y=A,b=$)}return{point:[h,g],index:y,t:Math.max(0,Math.min(1,b))}}lineSlice(r,a,u){let h=this.pointOnLine(u,r),g=this.pointOnLine(u,a);if(h.index>g.index||h.index===g.index&&h.t>g.t){const C=h;h=g,g=C}const y=[h.point],b=h.index+1,A=g.index;!Fy(u[b],y[0])&&b<=A&&y.push(u[b]);for(let C=b+1;C<=A;C++)y.push(u[C]);return Fy(u[A],g.point)||y.push(g.point),y}lineSliceAlong(r,a,u){let h=0;const g=[];for(let y=0;y<u.length-1;y++){const b=u[y],A=u[y+1],C=this.distance(b,A);if(h+=C,h>r&&g.length===0&&g.push(Ap(b,A,(r-(h-C))/C)),h>=a)return g.push(Ap(b,A,(a-(h-C))/C)),g;h>r&&g.push(A)}return g}bufferPoint(r,a){const u=a/this.ky,h=a/this.kx;return[r[0]-h,r[1]-u,r[0]+h,r[1]+u]}bufferBBox(r,a){const u=a/this.ky,h=a/this.kx;return[r[0]-h,r[1]-u,r[2]+h,r[3]+u]}insideBBox(r,a){return Ks(r[0]-a[0])>=0&&Ks(r[0]-a[2])<=0&&r[1]>=a[1]&&r[1]<=a[3]}}function Fy(l,r){return l[0]===r[0]&&l[1]===r[1]}function Ap(l,r,a){const u=Ks(r[0]-l[0]);return[l[0]+u*a,l[1]+(r[1]-l[1])*a]}function Ks(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Ep{constructor(r=[],a=(u,h)=>u<h?-1:u>h?1:0){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:u}=this,h=a[r];for(;r>0;){const g=r-1>>1,y=a[g];if(u(h,y)>=0)break;a[r]=y,r=g}a[r]=h}_down(r){const{data:a,compare:u}=this,h=this.length>>1,g=a[r];for(;r<h;){let y=1+(r<<1);const b=y+1;if(b<this.length&&u(a[b],a[y])<0&&(y=b),u(a[y],g)>=0)break;a[r]=a[y],r=y}a[r]=g}}var Mt=8192;function By(l,r){return r.dist-l.dist}const Pp=100,Cp=50;function $y(l){const r=[1/0,1/0,-1/0,-1/0];if(r.length!==l.length)return!1;for(let a=0;a<r.length;a++)if(r[a]!==l[a])return!1;return!0}function Ih(l){return l[1]-l[0]+1}function il(l,r){const a=l[1]>=l[0]&&l[1]<r;return a||console.warn("Distance Expression: Index is out of range"),a}function Vy(l,r){if(l[0]>l[1])return[null,null];const a=Ih(l);if(r){if(a===2)return[l,null];const u=Math.floor(a/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(a===1)return[l,null];const u=Math.floor(a/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function mu(l,r){const a=[1/0,1/0,-1/0,-1/0];if(!il(r,l.length))return a;for(let u=r[0];u<=r[1];++u)ha(a,l[u]);return a}function gu(l){const r=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let u=0;u<l[a].length;++u)ha(r,l[a][u]);return r}function Ec(l,r,a){if($y(l)||$y(r))return NaN;let u=0,h=0;return l[2]<r[0]&&(u=r[0]-l[2]),l[0]>r[2]&&(u=l[0]-r[2]),l[1]>r[3]&&(h=l[1]-r[3]),l[3]<r[1]&&(h=r[1]-l[3]),a.distance([0,0],[u,h])}function Ip(l){return 360*l-180}function kx(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Mp(l,r){const a=Math.pow(2,r.z),u=(l.y/Mt+r.y)/a;return[Ip((l.x/Mt+r.x)/a),kx(u)]}function S2(l,r){const a=[];for(let u=0;u<l.length;++u)a.push(Mp(l[u],r));return a}function jx(l,r,a){const u=a.pointOnLine(r,l).point;return a.distance(l,u)}function Uy(l,r,a,u,h){const g=a.slice(u[0],u[1]+1);let y=1/0;for(let b=r[0];b<=r[1];++b)if((y=Math.min(y,jx(l[b],g,h)))===0)return 0;return y}function Pc(l,r,a,u,h){const g=Math.min(h.pointToSegmentDistance(l,a,u),h.pointToSegmentDistance(r,a,u)),y=Math.min(h.pointToSegmentDistance(a,l,r),h.pointToSegmentDistance(u,l,r));return Math.min(g,y)}function hn(l,r,a,u,h){if(!il(r,l.length)||!il(u,a.length))return NaN;let g=1/0;for(let y=r[0];y<r[1];++y)for(let b=u[0];b<u[1];++b){if(Ph(l[y],l[y+1],a[b],a[b+1]))return 0;g=Math.min(g,Pc(l[y],l[y+1],a[b],a[b+1],h))}return g}function T2(l,r,a,u,h){if(!il(r,l.length)||!il(u,a.length))return NaN;let g=1/0;for(let y=r[0];y<=r[1];++y)for(let b=u[0];b<=u[1];++b)if((g=Math.min(g,h.distance(l[y],a[b])))===0)return g;return g}function A2(l,r,a){if(ld(l,r,!0))return 0;let u=1/0;for(const h of r){const g=h.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[g-1]&&(u=Math.min(u,a.pointToSegmentDistance(l,h[g-1],h[0])))===0||(u=Math.min(u,jx(l,h,a)))===0)return u}return u}function E2(l,r,a,u){if(!il(r,l.length))return NaN;for(let g=r[0];g<=r[1];++g)if(ld(l[g],a,!0))return 0;let h=1/0;for(let g=r[0];g<r[1];++g)for(const y of a)for(let b=0,A=y.length,C=A-1;b<A;C=b++){if(Ph(l[g],l[g+1],y[C],y[b]))return 0;h=Math.min(h,Pc(l[g],l[g+1],y[C],y[b],u))}return h}function Gy(l,r){for(const a of l)for(let u=0;u<=a.length-1;++u)if(ld(a[u],r,!0))return!0;return!1}function P2(l,r,a,u=1/0){const h=gu(l),g=gu(r);if(u!==1/0&&Ec(h,g,a)>=u)return u;if(Ah(h,g)){if(Gy(l,r))return 0}else if(Gy(r,l))return 0;let y=u;for(const b of l)for(let A=0,C=b.length,R=C-1;A<C;R=A++)for(const k of r)for(let L=0,$=k.length,U=$-1;L<$;U=L++){if(Ph(b[R],b[A],k[U],k[L]))return 0;y=Math.min(y,Pc(b[R],b[A],k[U],k[L],a))}return y}function gi(l,r,a,u,h,g,y){if(g===null||y===null)return;const b=Ec(mu(u,g),mu(h,y),a);b<r&&l.push({dist:b,range1:g,range2:y})}function C2(l,r,a,u,h=1/0){let g=Math.min(u.distance(l[0],a[0][0]),h);if(g===0)return g;const y=new Ep([{dist:0,range1:[0,l.length-1],range2:[0,0]}],By),b=r?Cp:Pp,A=gu(a);for(;y.length;){const C=y.pop();if(C.dist>=g)continue;const R=C.range1;if(Ih(R)<=b){if(!il(R,l.length))return NaN;if(r){const k=E2(l,R,a,u);if((g=Math.min(g,k))===0)return g}else for(let k=R[0];k<=R[1];++k){const L=A2(l[k],a,u);if((g=Math.min(g,L))===0)return g}}else{const k=Vy(R,r);if(k[0]!==null){const L=Ec(mu(l,k[0]),A,u);L<g&&y.push({dist:L,range1:k[0],range2:[0,0]})}if(k[1]!==null){const L=Ec(mu(l,k[1]),A,u);L<g&&y.push({dist:L,range1:k[1],range2:[0,0]})}}}return g}function Dx(l,r,a,u,h,g=1/0){let y=Math.min(g,h.distance(l[0],a[0]));if(y===0)return y;const b=new Ep([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],By),A=r?Cp:Pp,C=u?Cp:Pp;for(;b.length;){const R=b.pop();if(R.dist>=y)continue;const k=R.range1,L=R.range2;if(Ih(k)<=A&&Ih(L)<=C){if(!il(k,l.length)||!il(L,a.length))return NaN;if(r&&u?y=Math.min(y,hn(l,k,a,L,h)):r||u?r&&!u?y=Math.min(y,Uy(a,L,l,k,h)):!r&&u&&(y=Math.min(y,Uy(l,k,a,L,h))):y=Math.min(y,T2(l,k,a,L,h)),y===0)return y}else{const $=Vy(k,r),U=Vy(L,u);gi(b,y,h,l,a,$[0],U[0]),gi(b,y,h,l,a,$[0],U[1]),gi(b,y,h,l,a,$[1],U[0]),gi(b,y,h,l,a,$[1],U[1])}}return y}function Hy(l,r,a,u,h=1/0){let g=h;const y=mu(l,[0,l.length-1]);for(const b of a)if(!(g!==1/0&&Ec(y,mu(b,[0,b.length-1]),u)>=g)&&(g=Math.min(g,Dx(l,r,b,!0,u,g)),g===0))return g;return g}function Op(l,r,a,u,h=1/0){let g=h;const y=mu(l,[0,l.length-1]);for(const b of a){if(g!==1/0&&Ec(y,gu(b),u)>=g)continue;const A=C2(l,r,b,u,g);if(isNaN(A))return A;if((g=Math.min(g,A))===0)return g}return g}function Wy(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class yu{constructor(r,a){this.type=ar,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${r.length-1} instead.`);if(sd(r[1])){const u=r[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(Wy(u.features[h].geometry.type))return new yu(u,u.features[h].geometry)}else if(u.type==="Feature"){if(Wy(u.geometry.type))return new yu(u,u.geometry)}else if(Wy(u.type))return new yu(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(r){const a=r.geometry(),u=r.canonicalID();if(a!=null&&u!=null){if(r.geometryType()==="Point")return function(h,g,y){const b=[];for(const C of h)for(const R of C)b.push(Mp(R,g));const A=new ud(b[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Dx(b,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",A):y.type==="MultiLineString"?Hy(b,!1,y.coordinates,A):y.type==="Polygon"||y.type==="MultiPolygon"?Op(b,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,A):null}(a,u,this.geometries);if(r.geometryType()==="LineString")return function(h,g,y){const b=[];for(const C of h){const R=[];for(const k of C)R.push(Mp(k,g));b.push(R)}const A=new ud(b[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Hy(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,A);if(y.type==="MultiLineString"){let C=1/0;for(let R=0;R<y.coordinates.length;R++){const k=Hy(y.coordinates[R],!0,b,A,C);if(isNaN(k))return k;if((C=Math.min(C,k))===0)return C}return C}if(y.type==="Polygon"||y.type==="MultiPolygon"){let C=1/0;for(let R=0;R<b.length;R++){const k=Op(b[R],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,A,C);if(isNaN(k))return k;if((C=Math.min(C,k))===0)return C}return C}return null}(a,u,this.geometries);if(r.geometryType()==="Polygon")return function(h,g,y){const b=[];for(const C of function(R,k){const L=R.length;if(L<=1)return[R];const $=[];let U,Z;for(let re=0;re<L;re++){const te=wc(R[re]);te!==0&&(R[re].area=Math.abs(te),Z===void 0&&(Z=te<0),Z===te<0?(U&&$.push(U),U=[R[re]]):U.push(R[re]))}return U&&$.push(U),$}(h)){const R=[];for(let k=0;k<C.length;++k)R.push(S2(C[k],g));b.push(R)}const A=new ud(b[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Op(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,A);if(y.type==="MultiLineString"){let C=1/0;for(let R=0;R<y.coordinates.length;R++){const k=Op(y.coordinates[R],!0,b,A,C);if(isNaN(k))return k;if((C=Math.min(C,k))===0)return C}return C}return y.type==="Polygon"||y.type==="MultiPolygon"?function(C,R,k){let L=1/0;for(const $ of C)for(const U of R){const Z=P2($,U,k,L);if(isNaN(Z))return Z;if((L=Math.min(L,Z))===0)return L}return L}(y.type==="Polygon"?[y.coordinates]:y.coordinates,b,A):null}(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function dd(l){if(l instanceof vs&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ac||l instanceof yu)return!1;if(l instanceof fd)return l.featureConstant;let r=!0;return l.eachChild(a=>{r&&!dd(a)&&(r=!1)}),r}function Mh(l){if(l instanceof vs&&l.name==="feature-state")return!1;let r=!0;return l.eachChild(a=>{r&&!Mh(a)&&(r=!1)}),r}function hd(l,r){if(l instanceof vs&&r.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(u=>{a&&!hd(u,r)&&(a=!1)}),a}function Lx(l,r,a){return[l,r,a].filter(Boolean).join("")}function qy(l,r){switch(l){case"string":return da(r);case"number":return+r;case"boolean":return!!r;case"color":return kn.parse(r);case"formatted":return ys.fromString(da(r));case"resolvedImage":return _s.build(da(r))}return r}function Nx(l,r,a,u){return u!==void 0&&(l=u*Math.round(l/u)),r!==void 0&&l<r&&(l=r),a!==void 0&&l>a&&(l=a),l}class fd{constructor(r,a,u,h=!1){this.type=r,this.key=a,this.scope=u,this.featureConstant=h}static parse(r,a){let u=a.expectedType;if(u==null&&(u=Rn),r.length<2||r.length>3)return a.error("Invalid number of arguments for 'config' expression.");const h=a.parse(r[1],1);if(!(h instanceof Ml))return a.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const b=da(h.value);if(r.length>=3){const A=a.parse(r[2],2);if(!(A instanceof Ml))return a.error("Scope of 'config' expression must be a string literal.");g=da(A.value)}if(a.options){const A=Lx(b,g,a._scope),C=a.options.get(A);C&&(y=dd(C.value||C.default))}return new fd(u,b,g,y)}evaluate(r){const a=Lx(this.key,this.scope,r.scope),u=r.getConfig(a);if(!u)return null;const{type:h,value:g,values:y,minValue:b,maxValue:A,stepValue:C}=u,R=u.default.evaluate(r);let k=R;if(g){const L=r.scope;r.scope=(L||"").split("").slice(1).join(""),k=g.evaluate(r),r.scope=L}return h&&(k=qy(h,k)),k===void 0||b===void 0&&A===void 0&&C===void 0||(typeof k=="number"?k=Nx(k,b,A,C):Array.isArray(k)&&(k=k.map(L=>typeof L=="number"?Nx(L,b,A,C):L))),g!==void 0&&k!==void 0&&y&&!y.includes(k)&&(k=R,h&&(k=qy(h,k))),(h&&h!==this.type||k!==void 0&&!yp(To(k),this.type))&&(k=qy(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const r=["config",this.key];return this.scope&&r.concat(this.scope),r}}class Rp{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=r[1];return a.scope.has(u)?new Rp(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class kp{constructor(r,a=[],u,h=new od,g=[],y,b,A){this.registry=r,this.path=a,this.key=a.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u,this._scope=y,this.options=b,this.iconImageUseTheme=A}parse(r,a,u,h,g={}){return a||u?this.concat(a,null,u,h)._parse(r,g):this._parse(r,g)}parseObjectValue(r,a,u,h,g,y={}){return this.concat(a,u,h,g)._parse(r,y)}_parse(r,a){function u(h,g,y){return y==="assert"?new ka(g,[h]):y==="coerce"?new nl(g,[h]):h}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof r[0]=="string"?this.registry[r[0]]:void 0;if(h){let g=h.parse(r,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,b=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else g=u(g,y,a.typeAnnotation||"coerce");else g=u(g,y,a.typeAnnotation||"assert")}if(!(g instanceof Ml)&&g.type.kind!=="resolvedImage"&&Zy(g)){const y=new bp(this._scope,this.options,this.iconImageUseTheme);try{g=new Ml(g.type,g.evaluate(y))}catch(b){return this.error(b.message),null}}return g}return nl.parse(["to-array",r],this)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,u,h){let g=typeof r=="number"?this.path.concat(r):this.path;g=typeof a=="string"?g.concat(a):g;const y=h?this.scope.concat(h):this.scope;return new kp(this.registry,g,u||null,y,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(r,...a){const u=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new ua(u,r))}checkSubtype(r,a){const u=bc(r,a);return u&&this.error(u),u}}function Zy(l){if(l instanceof Rp)return Zy(l.boundExpression);if(l instanceof vs&&l.name==="error"||l instanceof Oo||l instanceof Ac||l instanceof yu||l instanceof fd)return!1;const r=l instanceof nl||l instanceof ka;let a=!0;return l.eachChild(u=>{a=r?a&&Zy(u):a&&u instanceof Ml}),!!a&&dd(l)&&hd(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function jp(l,r){const a=l.length-1;let u,h,g=0,y=a,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),u=l[b],h=l[b+1],u<=r){if(b===a||r<h)return b;g=b+1}else{if(!(u>r))throw new uo("Input is not a number.");y=b-1}return 0}class Oh{constructor(r,a,u){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(r[1],1,ar);if(!u)return null;const h=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<r.length;y+=2){const b=y===1?-1/0:r[y],A=r[y+1],C=y,R=y+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const k=a.parse(A,R,g);if(!k)return null;g=g||k.type,h.push([b,k])}return new Oh(g,u,h)}evaluate(r){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return u[0].evaluate(r);const g=a.length;return h>=a[g-1]?u[g-1].evaluate(r):u[jp(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}const zx=.95047,Fx=1.08883,Bx=4/29,pd=6/29,$x=3*pd*pd,I2=pd*pd*pd,M2=Math.PI/180,O2=180/Math.PI;function Ky(l){return l>I2?Math.pow(l,1/3):l/$x+Bx}function Xy(l){return l>pd?l*l*l:$x*(l-Bx)}function Yy(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Jy(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Vx(l){const r=Jy(l.r),a=Jy(l.g),u=Jy(l.b),h=Ky((.4124564*r+.3575761*a+.1804375*u)/zx),g=Ky((.2126729*r+.7151522*a+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Ky((.0193339*r+.119192*a+.9503041*u)/Fx)),alpha:l.a}}function Dp(l){let r=(l.l+16)/116,a=isNaN(l.a)?r:r+l.a/500,u=isNaN(l.b)?r:r-l.b/200;return r=1*Xy(r),a=zx*Xy(a),u=Fx*Xy(u),new kn(Yy(3.2404542*a-1.5371385*r-.4985314*u),Yy(-.969266*a+1.8760108*r+.041556*u),Yy(.0556434*a-.2040259*r+1.0572252*u),l.alpha)}function Lp(l,r,a){const u=r-l;return l+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const md={forward:Vx,reverse:Dp,interpolate:function(l,r,a){return{l:xr(l.l,r.l,a),a:xr(l.a,r.a,a),b:xr(l.b,r.b,a),alpha:xr(l.alpha,r.alpha,a)}}},Rh={forward:function(l){const{l:r,a,b:u}=Vx(l),h=Math.atan2(u,a)*O2;return{h:h<0?h+360:h,c:Math.sqrt(a*a+u*u),l:r,alpha:l.a}},reverse:function(l){const r=l.h*M2,a=l.c;return Dp({l:l.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:l.alpha})},interpolate:function(l,r,a){return{h:Lp(l.h,r.h,a),c:xr(l.c,r.c,a),l:xr(l.l,r.l,a),alpha:xr(l.alpha,r.alpha,a)}}};var Ux=Object.freeze({__proto__:null,hcl:Rh,lab:md});class Xs{constructor(r,a,u,h,g){this.type=r,this.operator=a,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(r,a,u,h){let g=0;if(r.name==="exponential")g=Np(a,r.base,u,h);else if(r.name==="linear")g=Np(a,1,u,h);else if(r.name==="cubic-bezier"){const y=r.controlPoints;g=new Vo(y[0],y[1],y[2],y[3]).solve(Np(a,1,u,h))}return g}static parse(r,a){let[u,h,g,...y]=r;if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(R=>typeof R!="number"||R<0||R>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length-1>3&&(r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,ar),!g)return null;const b=[];let A=null;u==="interpolate-hcl"||u==="interpolate-lab"?A=Ms:a.expectedType&&a.expectedType.kind!=="value"&&(A=a.expectedType);for(let C=0;C<y.length;C+=2){const R=y[C],k=y[C+1],L=C+3,$=C+4;if(typeof R!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(b.length&&b[b.length-1][0]>=R)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const U=a.parse(k,$,A);if(!U)return null;A=A||U.type,b.push([R,U])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new Xs(A,u,h,g,b):a.error(`Type ${qi(A)} is not interpolatable.`)}evaluate(r){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return u[0].evaluate(r);const g=a.length;if(h>=a[g-1])return u[g-1].evaluate(r);const y=jp(a,h),b=Xs.interpolationFactor(this.interpolation,h,a[y],a[y+1]),A=u[y].evaluate(r),C=u[y+1].evaluate(r);return this.operator==="interpolate"?bh[this.type.kind.toLowerCase()](A,C,b):this.operator==="interpolate-hcl"?Rh.reverse(Rh.interpolate(Rh.forward(A),Rh.forward(C),b)):md.reverse(md.interpolate(md.forward(A),md.forward(C),b))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Np(l,r,a,u){const h=u-a,g=l-a;return h===0?0:r===1?g/h:(Math.pow(r,g)-1)/(Math.pow(r,h)-1)}class kh{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let u=null;const h=a.expectedType;h&&h.kind!=="value"&&(u=h);const g=[];for(const b of r.slice(1)){const A=a.parse(b,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!A)return null;u=u||A.type,g.push(A)}const y=h&&g.some(b=>bc(h,b.type));return new kh(y?Rn:u,g)}evaluate(r){let a,u=null,h=0;for(const g of this.args){if(h++,u=g.evaluate(r),u&&u instanceof _s&&!u.available&&(a||(a=u),u=null,h===this.args.length))return a;if(u!==null)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class Rl{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=a.parse(r[g+1],g+1);if(!b)return null;u.push([y,b])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,u);return h?new Rl(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,u]of this.bindings)r.push(a,u.serialize());return r.push(this.result.serialize()),r}}class zp{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,ar),h=a.parse(r[2],2,Ko(a.expectedType||Rn));return u&&h?new zp(h.type.itemType,u,h):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new uo("Array index out of bounds: negative index");if(a>=u.length)throw new uo("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new uo("Array index must be an integer. Use at-interpolated for fractional indices");return u[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fp{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,ar),h=a.parse(r[2],2,Ko(a.expectedType||Rn));return u&&h?new Fp(h.type.itemType,u,h):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new uo(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new uo(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const h=Math.floor(a),g=Math.ceil(a),y=u[h],b=u[g];if(typeof y!="number"||typeof b!="number")throw new uo(`Cannot interpolate between non-number values at index ${a}.`);const A=a-h;return y*(1-A)+b*A}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Qy{constructor(r,a){this.type=Fn,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),h=a.parse(r[2],2,Rn);return u&&h?Ry(u.type,[Fn,cn,ar,Ra,Rn])?new Qy(u,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(u.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(u==null)return!1;if(!Th(a,["boolean","string","number","null"]))throw new uo(`Expected first argument to be of type boolean, string, number or null, but found ${qi(To(a))} instead.`);if(!Th(u,["string","array"]))throw new uo(`Expected second argument to be of type array or string, but found ${qi(To(u))} instead.`);return u.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class gd{constructor(r,a,u){this.type=ar,this.needle=r,this.haystack=a,this.fromIndex=u}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),h=a.parse(r[2],2,Rn);if(!u||!h)return null;if(!Ry(u.type,[Fn,cn,ar,Ra,Rn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(u.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,ar);return g?new gd(u,h,g):null}return new gd(u,h)}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!Th(a,["boolean","string","number","null"]))throw new uo(`Expected first argument to be of type boolean, string, number or null, but found ${qi(To(a))} instead.`);if(!Th(u,["string","array"]))throw new uo(`Expected second argument to be of type array or string, but found ${qi(To(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(a,h)}return u.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class jh{constructor(r,a,u,h,g,y){this.inputType=r,this.type=a,this.input=u,this.cases=h,this.outputs=g,this.otherwise=y}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let u,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const g={},y=[];for(let C=2;C<r.length-1;C+=2){let R=r[C];const k=r[C+1];Array.isArray(R)||(R=[R]);const L=a.concat(C);if(R.length===0)return L.error("Expected at least one branch label.");for(const U of R){if(typeof U!="number"&&typeof U!="string")return L.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,To(U)))return null}else u=To(U);if(g[String(U)]!==void 0)return L.error("Branch labels must be unique.");g[String(U)]=y.length}const $=a.parse(k,C,h);if(!$)return null;h=h||$.type,y.push($)}const b=a.parse(r[1],1,Rn);if(!b)return null;const A=a.parse(r[r.length-1],r.length-1,h);return A?b.type.kind!=="value"&&a.concat(1).checkSubtype(u,b.type)?null:new jh(u,h,b,g,y,A):null}evaluate(r){const a=this.input.evaluate(r);return(yp(To(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],h={};for(const y of a){const b=h[this.cases[y]];b===void 0?(h[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[b][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of u)r.push(b.length===1?g(b[0]):b.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class Dh{constructor(r,a,u){this.type=r,this.branches=a,this.otherwise=u}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const h=[];for(let y=1;y<r.length-1;y+=2){const b=a.parse(r[y],y,Fn);if(!b)return null;const A=a.parse(r[y+1],y+1,u);if(!A)return null;h.push([b,A]),u=u||A.type}const g=a.parse(r[r.length-1],r.length-1,u);return g?new Dh(u,h,g):null}evaluate(r){for(const[a,u]of this.branches)if(a.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,u]of this.branches)r(a),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class Bp{constructor(r,a,u,h){this.type=r,this.input=a,this.beginIndex=u,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,Rn),h=a.parse(r[2],2,ar);if(!u||!h)return null;if(!Ry(u.type,[Ko(Rn),cn,Rn]))return a.error(`Expected first argument to be of type array or string, but found ${qi(u.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,ar);return g?new Bp(u.type,u,h,g):null}return new Bp(u.type,u,h)}evaluate(r){const a=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!Th(a,["string","array"]))throw new uo(`Expected first argument to be of type array or string, but found ${qi(To(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(u,h)}return a.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class e_{constructor(r,a){this.type=Ko(cn),this.str=r,this.delimiter=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,cn),h=a.parse(r[2],2,cn);return u&&h?new e_(u,h):void 0}evaluate(r){const a=this.str.evaluate(r),u=this.delimiter.evaluate(r);return a.split(u)}eachChild(r){r(this.str),r(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function t_(l,r){return l==="=="||l==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function r_(l,r,a,u){return u.compare(r,a)===0}function yd(l,r,a){const u=l!=="=="&&l!=="!=";return class LW{constructor(g,y,b){this.type=Fn,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const b=g[0];let A=y.parse(g[1],1,Rn);if(!A)return null;if(!t_(b,A.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${qi(A.type)}'.`);let C=y.parse(g[2],2,Rn);if(!C)return null;if(!t_(b,C.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${qi(C.type)}'.`);if(A.type.kind!==C.type.kind&&A.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${qi(A.type)}' and '${qi(C.type)}'.`);u&&(A.type.kind==="value"&&C.type.kind!=="value"?A=new ka(C.type,[A]):A.type.kind!=="value"&&C.type.kind==="value"&&(C=new ka(A.type,[C])));let R=null;if(g.length===4){if(A.type.kind!=="string"&&C.type.kind!=="string"&&A.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(R=y.parse(g[3],3,gp),!R)return null}return new LW(A,C,R)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const A=To(y),C=To(b);if(A.kind!==C.kind||A.kind!=="string"&&A.kind!=="number")throw new uo(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${C.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const A=To(y),C=To(b);if(A.kind!=="string"||C.kind!=="string")return r(g,y,b)}return this.collator?a(g,y,b,this.collator.evaluate(g)):r(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[l];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const R2=yd("==",function(l,r,a){return r===a},r_),k2=yd("!=",function(l,r,a){return r!==a},function(l,r,a,u){return!r_(0,r,a,u)}),Gx=yd("<",function(l,r,a){return r<a},function(l,r,a,u){return u.compare(r,a)<0}),Hx=yd(">",function(l,r,a){return r>a},function(l,r,a,u){return u.compare(r,a)>0}),$p=yd("<=",function(l,r,a){return r<=a},function(l,r,a,u){return u.compare(r,a)<=0}),j2=yd(">=",function(l,r,a){return r>=a},function(l,r,a,u){return u.compare(r,a)>=0});class Vp{constructor(r,a,u,h,g,y){this.type=cn,this.number=r,this.locale=a,this.currency=u,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const u=a.parse(r[1],1,ar);if(!u)return null;const h=r[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=a.parseObjectValue(h.locale,2,"locale",cn),!g))return null;let y=null;if(h.currency&&(y=a.parseObjectValue(h.currency,2,"currency",cn),!y))return null;let b=null;if(h.unit&&(b=a.parseObjectValue(h.unit,2,"unit",cn),!b))return null;let A=null;if(h["min-fraction-digits"]&&(A=a.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",ar),!A))return null;let C=null;return h["max-fraction-digits"]&&(C=a.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",ar),!C)?null:new Vp(u,g,y,b,A,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class n_{constructor(r){this.type=ar,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=a.parse(r[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${qi(u.type)} instead.`):new n_(u):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string"||Array.isArray(a))return a.length;throw new uo(`Expected value to be of type string or array, but found ${qi(To(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}function Wx(l){return function(){l=1831565813+(l|=0)|0;let r=Math.imul(l^l>>>15,1|l);return r=r+Math.imul(r^r>>>7,61|r)^r,((r^r>>>14)>>>0)/4294967296}}const _d={"==":R2,"!=":k2,">":Hx,"<":Gx,">=":j2,"<=":$p,array:ka,at:zp,"at-interpolated":Fp,boolean:ka,case:Dh,coalesce:kh,collator:Oo,format:rl,image:Nr,in:Qy,"index-of":gd,interpolate:Xs,"interpolate-hcl":Xs,"interpolate-lab":Xs,length:n_,let:Rl,literal:Ml,match:jh,number:ka,"number-format":Vp,object:ka,slice:Bp,step:Oh,string:ka,"to-boolean":nl,"to-color":nl,"to-number":nl,"to-string":nl,var:Rp,within:Ac,distance:yu,config:fd,split:e_};function i_(l,[r,a,u,h]){r=r.evaluate(l),a=a.evaluate(l),u=u.evaluate(l);const g=h?h.evaluate(l):1,y=pu(r,a,u,g);if(y)throw new uo(y);return new kn(r/255,a/255,u/255,g)}function o_(l,[r,a,u,h]){r=r.evaluate(l),a=a.evaluate(l),u=u.evaluate(l);const g=h?h.evaluate(l):1,y=function(C,R,k,L){return typeof C=="number"&&C>=0&&C<=360?typeof R=="number"&&R>=0&&R<=100&&typeof k=="number"&&k>=0&&k<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[C,R,k,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[C,R,k,L]:[C,R,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[C,R,k,L]:[C,R,k]).join(", ")}]: 'h' must be between 0 and 360.`}(r,a,u,g);if(y)throw new uo(y);const b=`hsla(${r}, ${a}%, ${u}%, ${g})`,A=kn.parse(b);if(!A)throw new uo(`Failed to parse HSLA color: ${b}`);return A}function qx(l,r){return l in r}function s_(l,r){const a=r[l];return a===void 0?null:a}function Cc(l){return{type:l}}function _u(l){if(l instanceof fd)return new Set([l.key]);let r=new Set;return l.eachChild(a=>{r=new Set([...r,..._u(a)])}),r}function Up(l){if(l instanceof vs&&l.name==="is-active-floor")return!0;let r=!1;return l.eachChild(a=>{!r&&Up(a)&&(r=!0)}),r}function Zx(l){return{result:"success",value:l}}function Ic(l){return{result:"error",value:l}}function a_(l,r){return!!l&&!!l.parameters&&l.parameters.indexOf(r)>-1}function Lh(l){return l["property-type"]==="data-driven"}function Kx(l){return a_(l.expression,"measure-light")}function Xx(l){return a_(l.expression,"zoom")}function Gp(l){return!!l.expression&&l.expression.interpolated}function Hp(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Yx(l){return l}function Jx(l,r){const a=r.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",h=u||!(u||l.property!==void 0),g=l.type||(Gp(r)?"exponential":"interval");if(a&&((l=Object.assign({},l)).stops&&(l.stops=l.stops.map(C=>[C[0],kn.parse(C[1])])),l.default=kn.parse(l.default?l.default:r.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Ux[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,b,A;if(g==="exponential")y=Qx;else if(g==="interval")y=L2;else if(g==="categorical"){y=D2,b=Object.create(null);for(const C of l.stops)b[C[0]]=C[1];A=typeof l.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=eb}if(u){const C={},R=[];for(let $=0;$<l.stops.length;$++){const U=l.stops[$],Z=U[0].zoom;C[Z]===void 0&&(C[Z]={zoom:Z,type:l.type,property:l.property,default:l.default,stops:[]},R.push(Z)),C[Z].stops.push([U[0].value,U[1]])}const k=[];for(const $ of R)k.push([C[$].zoom,Jx(C[$],r)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Xs.interpolationFactor.bind(void 0,L),zoomStops:k.map($=>$[0]),evaluate:({zoom:$},U)=>Qx({stops:k,base:l.base},r,$).evaluate($,U)}}if(h){const C=g==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Xs.interpolationFactor.bind(void 0,C),zoomStops:l.stops.map(R=>R[0]),evaluate:({zoom:R})=>y(l,r,R,b,A)}}return{kind:"source",evaluate(C,R){const k=R&&R.properties?R.properties[l.property]:void 0;return k===void 0?ol(l.default,r.default):y(l,r,k,b,A)}}}function ol(l,r,a){return l!==void 0?l:r!==void 0?r:a!==void 0?a:void 0}function D2(l,r,a,u,h){return ol(typeof a===h?u[a]:void 0,l.default,r.default)}function L2(l,r,a){if(!ad(a))return ol(l.default,r.default);const u=l.stops.length;if(u===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[u-1][0])return l.stops[u-1][1];const h=jp(l.stops.map(g=>g[0]),a);return l.stops[h][1]}function Qx(l,r,a){const u=l.base!==void 0?l.base:1;if(!ad(a))return ol(l.default,r.default);const h=l.stops.length;if(h===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[h-1][0])return l.stops[h-1][1];const g=jp(l.stops.map(R=>R[0]),a),y=function(R,k,L,$){const U=$-L,Z=R-L;return U===0?0:k===1?Z/U:(Math.pow(k,Z)-1)/(Math.pow(k,U)-1)}(a,u,l.stops[g][0],l.stops[g+1][0]),b=l.stops[g][1],A=l.stops[g+1][1];let C=bh[r.type]||Yx;if(l.colorSpace&&l.colorSpace!=="rgb"){const R=Ux[l.colorSpace];C=(k,L)=>R.reverse(R.interpolate(R.forward(k),R.forward(L),y))}return typeof b.evaluate=="function"?{evaluate(...R){const k=b.evaluate.apply(void 0,R),L=A.evaluate.apply(void 0,R);if(k!==void 0&&L!==void 0)return C(k,L,y)}}:C(b,A,y)}function eb(l,r,a){return r.type==="color"?a=kn.parse(a):r.type==="formatted"?a=ys.fromString(a.toString()):r.type==="resolvedImage"?a=_s.build(a.toString()):ir(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),ol(a,l.default,r.default)}vs.register(_d,{error:[{kind:"error"},[cn],(l,[r])=>{throw new uo(r.evaluate(l))}],typeof:[cn,[Rn],(l,[r])=>qi(To(r.evaluate(l)))],"to-rgba":[Ko(ar,4),[Ms],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ko(ar,4),[Ms],(l,[r])=>r.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ms,[ar,ar,ar],i_],rgba:[Ms,[ar,ar,ar,ar],i_],hsl:[Ms,[ar,ar,ar],o_],hsla:[Ms,[ar,ar,ar,ar],o_],has:{type:Fn,overloads:[[[cn],(l,[r])=>qx(r.evaluate(l),l.properties())],[[cn,tl],(l,[r,a])=>qx(r.evaluate(l),a.evaluate(l))]]},get:{type:Rn,overloads:[[[cn],(l,[r])=>s_(r.evaluate(l),l.properties())],[[cn,tl],(l,[r,a])=>s_(r.evaluate(l),a.evaluate(l))]]},"feature-state":[Rn,[cn],(l,[r])=>s_(r.evaluate(l),l.featureState||{})],properties:[tl,[],l=>l.properties()],"geometry-type":[cn,[],l=>l.geometryType()],worldview:[cn,[],l=>l.globals.worldview||""],"is-active-floor":[Fn,Cc(cn),(l,r)=>{if(!(l.globals.activeFloors&&l.globals.activeFloors.size>0))return!1;const a=l.globals.activeFloors;return r.some(u=>{const h=u.evaluate(l);return a.has(h)})}],id:[Rn,[],l=>l.id()],zoom:[ar,[],l=>l.globals.zoom],pitch:[ar,[],l=>l.globals.pitch||0],"distance-from-center":[ar,[],l=>l.distanceFromCenter()],"measure-light":[ar,[cn],(l,[r])=>l.measureLight(r.evaluate(l))],"heatmap-density":[ar,[],l=>l.globals.heatmapDensity||0],"line-progress":[ar,[],l=>l.globals.lineProgress||0],"raster-value":[ar,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[ar,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[ar,[],l=>l.globals.skyRadialProgress||0],accumulated:[Rn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[ar,Cc(ar),(l,r)=>{let a=0;for(const u of r)a+=u.evaluate(l);return a}],"*":[ar,Cc(ar),(l,r)=>{let a=1;for(const u of r)a*=u.evaluate(l);return a}],"-":{type:ar,overloads:[[[ar,ar],(l,[r,a])=>r.evaluate(l)-a.evaluate(l)],[[ar],(l,[r])=>-r.evaluate(l)]]},"/":[ar,[ar,ar],(l,[r,a])=>r.evaluate(l)/a.evaluate(l)],"%":[ar,[ar,ar],(l,[r,a])=>r.evaluate(l)%a.evaluate(l)],ln2:[ar,[],()=>Math.LN2],pi:[ar,[],()=>Math.PI],e:[ar,[],()=>Math.E],"^":[ar,[ar,ar],(l,[r,a])=>Math.pow(r.evaluate(l),a.evaluate(l))],sqrt:[ar,[ar],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[ar,[ar],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[ar,[ar],(l,[r])=>Math.log(r.evaluate(l))],log2:[ar,[ar],(l,[r])=>Math.log2(r.evaluate(l))],sin:[ar,[ar],(l,[r])=>Math.sin(r.evaluate(l))],cos:[ar,[ar],(l,[r])=>Math.cos(r.evaluate(l))],tan:[ar,[ar],(l,[r])=>Math.tan(r.evaluate(l))],asin:[ar,[ar],(l,[r])=>Math.asin(r.evaluate(l))],acos:[ar,[ar],(l,[r])=>Math.acos(r.evaluate(l))],atan:[ar,[ar],(l,[r])=>Math.atan(r.evaluate(l))],min:[ar,Cc(ar),(l,r)=>Math.min(...r.map(a=>a.evaluate(l)))],max:[ar,Cc(ar),(l,r)=>Math.max(...r.map(a=>a.evaluate(l)))],abs:[ar,[ar],(l,[r])=>Math.abs(r.evaluate(l))],round:[ar,[ar],(l,[r])=>{const a=r.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[ar,[ar],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[ar,[ar],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[Fn,[cn,Rn],(l,[r,a])=>l.properties()[r.value]===a.value],"filter-id-==":[Fn,[Rn],(l,[r])=>l.id()===r.value],"filter-type-==":[Fn,[cn],(l,[r])=>l.geometryType()===r.value],"filter-<":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],h=a.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],h=a.value;return typeof u==typeof h&&u>h}],"filter-id->":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],h=a.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[Fn,[cn,Rn],(l,[r,a])=>{const u=l.properties()[r.value],h=a.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Fn,[Rn],(l,[r])=>{const a=l.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[Fn,[Rn],(l,[r])=>r.value in l.properties()],"filter-has-id":[Fn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Fn,[Ko(cn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[Fn,[Ko(Rn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[Fn,[cn,Ko(Rn)],(l,[r,a])=>a.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[Fn,[cn,Ko(Rn)],(l,[r,a])=>function(u,h,g,y){for(;g<=y;){const b=g+y>>1;if(h[b]===u)return!0;h[b]>u?y=b-1:g=b+1}return!1}(l.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Fn,overloads:[[[Fn,Fn],(l,[r,a])=>r.evaluate(l)&&a.evaluate(l)],[Cc(Fn),(l,r)=>{for(const a of r)if(!a.evaluate(l))return!1;return!0}]]},any:{type:Fn,overloads:[[[Fn,Fn],(l,[r,a])=>r.evaluate(l)||a.evaluate(l)],[Cc(Fn),(l,r)=>{for(const a of r)if(a.evaluate(l))return!0;return!1}]]},"!":[Fn,[Fn],(l,[r])=>!r.evaluate(l)],"is-supported-script":[Fn,[cn],(l,[r])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(r.evaluate(l))}],upcase:[cn,[cn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[cn,[cn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[cn,Cc(Rn),(l,r)=>r.map(a=>da(a.evaluate(l))).join("")],"resolved-locale":[cn,[gp],(l,[r])=>r.evaluate(l).resolvedLocale()],random:[ar,[ar,ar,Rn],(l,r)=>{const[a,u,h]=r.map(y=>y.evaluate(l));if(a>u||a===u)return a;let g;if(typeof h=="string")g=function(y){let b=0;if(y.length===0)return b;for(let A=0;A<y.length;A++)b=(b<<5)-b+y.charCodeAt(A),b|=0;return b}(h);else{if(typeof h!="number")throw new uo(`Invalid seed input: ${h}`);g=h}return a+Wx(g)()*(u-a)}]});class Wp{constructor(r,a,u,h,g){this.expression=r,this._warningHistory={},this._scope=u,this._options=h,this._iconImageUseTheme=g,this._evaluator=new bp(u,h,g),this._defaultValue=a?function(y){return y.type==="color"&&(Hp(y.default)||Array.isArray(y.default))?new kn(0,0,0,0):y.type==="color"?kn.parse(y.default)||null:y.default===void 0?null:y.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=_u(r),this.isIndoorDependent=Up(r)}evaluateWithoutErrorHandling(r,a,u,h,g,y,b,A){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,u,h,g,y,b,A,C){this._evaluator||(this._evaluator=new bp(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=A||null,this._evaluator.iconImageUseTheme=C||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new uo(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){const k=R;return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function Nh(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in _d}function Mc(l,r,a,u,h){const g=new kp(_d,[],r?function(b){const A={color:Ms,string:cn,number:ar,enum:cn,boolean:Fn,formatted:wh,resolvedImage:Sh};return b.type==="array"?Ko(A[b.value]||Rn,b.length):A[b.type]}(r):void 0,void 0,void 0,a,u,h),y=g.parse(l,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return y?Zx(new Wp(y,r,a,u,h)):Ic(g.errors)}class vd{constructor(r,a,u,h){this.kind=r,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=r!=="constant"&&!Mh(a.expression),this.configDependencies=_u(a.expression),this.isIndoorDependent=Up(a.expression)}evaluateWithoutErrorHandling(r,a,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,h,g,y)}evaluate(r,a,u,h,g,y,b){return this._styleExpression.evaluate(r,a,u,h,g,y,void 0,void 0,b)}}class vu{constructor(r,a,u,h,g,y){this.kind=r,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!Mh(a.expression),this.isIndoorDependent=Up(a.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=_u(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,u,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,h,g,y)}evaluate(r,a,u,h,g,y){return this._styleExpression.evaluate(r,a,u,h,g,y)}interpolationFactor(r,a,u){return this.interpolationType?Xs.interpolationFactor(this.interpolationType,r,a,u):0}}function l_(l,r,a,u,h){if((l=Mc(l,r,a,u,h)).result==="error")return l;const g=l.value.expression,y=dd(g);if(!y&&!Lh(r))return Ic([new ua("","data expressions not supported")]);const b=hd(g,["zoom","pitch","distance-from-center"]);if(!b&&!Xx(r))return Ic([new ua("","zoom expressions not supported")]);const A=hd(g,["measure-light"]);if(!A&&!Kx(r))return Ic([new ua("","measure-light expression not supported")]);const C=hd(g,["line-progress"]);if(!C&&!function(L){return a_(L.expression,"line-progress")}(r))return Ic([new ua("","line-progress expression not supported")]);const R=r.expression&&r.expression.relaxZoomRestriction,k=Da(g);return k||b||R?k instanceof ua?Ic([k]):k instanceof Xs&&!Gp(r)?Ic([new ua("",'"interpolate" expressions cannot be used with this property')]):Zx(k?new vu(y&&C?"camera":"composite",l.value,k.labels,k instanceof Xs?k.interpolation:void 0,A,C):new vd(y&&C?"constant":"source",l.value,A,C)):Ic([new ua("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qp{constructor(r,a){this._parameters=r,this._specification=a,Object.assign(this,Jx(this._parameters,this._specification))}static deserialize(r){return new qp(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Da(l){let r=null;if(l instanceof Rl)r=Da(l.result);else if(l instanceof kh){for(const a of l.args)if(r=Da(a),r)break}else(l instanceof Oh||l instanceof Xs)&&l.input instanceof vs&&l.input.name==="zoom"&&(r=l);return r instanceof ua||l.eachChild(a=>{const u=Da(a);u instanceof ua?r=u:r&&u&&r!==u&&(r=new ua("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}var c_,tb,rb=function(){if(tb)return c_;tb=1,c_=r;var l=3;function r(a,u,h){var g=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(u=y[1])+2*(h=y[2]);for(var b=0;b<this.d*this.d;b++){var A=y[l+b],C=y[l+b+1];g.push(A===C?null:y.subarray(A,C))}var R=y[l+g.length+1];this.keys=y.subarray(y[l+g.length],R),this.bboxes=y.subarray(R),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var k=0;k<this.d*this.d;k++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=h,this.scale=u/a,this.uid=0;var L=h/u*a;this.min=-L,this.max=a+L}return r.prototype.insert=function(a,u,h,g,y){this._forEachCell(u,h,g,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y)},r.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},r.prototype._insertCell=function(a,u,h,g,y,b){this.cells[y].push(b)},r.prototype.query=function(a,u,h,g,y){var b=this.min,A=this.max;if(a<=b&&u<=b&&A<=h&&A<=g&&!y)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,u,h,g,this._queryCell,C,{},y),C},r.prototype._queryCell=function(a,u,h,g,y,b,A,C){var R=this.cells[y];if(R!==null)for(var k=this.keys,L=this.bboxes,$=0;$<R.length;$++){var U=R[$];if(A[U]===void 0){var Z=4*U;(C?C(L[Z+0],L[Z+1],L[Z+2],L[Z+3]):a<=L[Z+2]&&u<=L[Z+3]&&h>=L[Z+0]&&g>=L[Z+1])?(A[U]=!0,b.push(k[U])):A[U]=!1}}},r.prototype._forEachCell=function(a,u,h,g,y,b,A,C){for(var R=this._convertToCellCoord(a),k=this._convertToCellCoord(u),L=this._convertToCellCoord(h),$=this._convertToCellCoord(g),U=R;U<=L;U++)for(var Z=k;Z<=$;Z++){var re=this.d*Z+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord(Z),this._convertFromCellCoord(U+1),this._convertFromCellCoord(Z+1)))&&y.call(this,a,u,h,g,re,b,A,C))return}},r.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},r.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},r.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=l+this.cells.length+1+1,h=0,g=0;g<this.cells.length;g++)h+=this.cells[g].length;var y=new Int32Array(u+h+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=u,A=0;A<a.length;A++){var C=a[A];y[l+A]=b,y.set(C,b),b+=C.length}return y[l+a.length]=b,y.set(this.keys,b),y[l+a.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer},c_}(),xd=Zn(rb);const xu={};function Yt(l,r,a={}){Object.defineProperty(l,"_classRegistryKey",{value:r,writable:!1}),xu[r]={klass:l,omit:a.omit||[]}}Yt(Object,"Object"),xd.serialize=function(l,r){const a=l.toArrayBuffer();return r&&r.add(a),{buffer:a}},xd.deserialize=function(l){return new xd(l.buffer)},Object.defineProperty(xd,"name",{value:"Grid"}),Yt(xd,"Grid"),delete mt.prototype.constructor,Yt(kn,"Color"),Yt(Error,"Error"),Yt(ys,"Formatted"),Yt(_p,"FormattedSection"),Yt(Bs,"AJAXError"),Yt(_s,"ResolvedImage"),Yt(qp,"StylePropertyFunction"),Yt(Wp,"StyleExpression",{omit:["_evaluator"]}),Yt(as,"ImageId"),Yt(Il,"ImageVariant"),Yt(vu,"ZoomDependentExpression"),Yt(vd,"ZoomConstantExpression"),Yt(vs,"CompoundExpression",{omit:["_evaluate"]});for(const l in _d)xu[_d[l]._classRegistryKey]||Yt(_d[l],`Expression${l}`);function zh(l){return l&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function kl(l,r){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(zh(l)||l instanceof ImageBitmap)return r&&r.add(l),l;if(ArrayBuffer.isView(l))return r&&r.add(l.buffer),l;if(l instanceof ImageData)return r&&r.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const u of l)a.push(kl(u,r));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[u,h]of l.entries())a.entries.push(kl(u),kl(h,r));return a}if(l instanceof Set){const a={$name:"Set"};let u=0;for(const h of l.values())a[++u]=kl(h);return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const h=a.serialize?a.serialize(l,r):{};if(!a.serialize){for(const g in l)l.hasOwnProperty(g)&&(xu[u].omit.indexOf(g)>=0||(h[g]=kl(l[g],r)));l instanceof Error&&(h.message=l.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof l)}function Oc(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||zh(l)||l instanceof ImageBitmap||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Oc);if(typeof l=="object"){const r=l.$name||"Object";if(r==="Map"){const h=l.entries||[],g=new Map;for(let y=0;y<h.length;y+=2)g.set(Oc(h[y]),Oc(h[y+1]));return g}if(r==="Set"){const h=new Set;for(const g of Object.keys(l))g!=="$name"&&h.add(Oc(l[g]));return h}if(r==="BigInt")return BigInt(l.value);const{klass:a}=xu[r];if(!a)throw new Error(`Can't deserialize unregistered class "${r}".`);if(a.deserialize)return a.deserialize(l);const u=Object.create(a.prototype);for(const h of Object.keys(l))h!=="$name"&&(u[h]=Oc(l[h]));return u}throw new Error("can't deserialize object of type "+typeof l)}const mr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Fh(l){for(const r of l)if(Zp(r.charCodeAt(0)))return!0;return!1}function u_(l){for(const r of l)if(!nb(r.charCodeAt(0)))return!1;return!0}function nb(l){return!(mr.Arabic(l)||mr["Arabic Supplement"](l)||mr["Arabic Extended-A"](l)||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l))}function Zp(l){return!(l!==746&&l!==747&&(l<4352||!(mr["Bopomofo Extended"](l)||mr.Bopomofo(l)||mr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||mr["CJK Compatibility Ideographs"](l)||mr["CJK Compatibility"](l)||mr["CJK Radicals Supplement"](l)||mr["CJK Strokes"](l)||!(!mr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||mr["CJK Unified Ideographs Extension A"](l)||mr["CJK Unified Ideographs"](l)||mr["Enclosed CJK Letters and Months"](l)||mr["Hangul Compatibility Jamo"](l)||mr["Hangul Jamo Extended-A"](l)||mr["Hangul Jamo Extended-B"](l)||mr["Hangul Jamo"](l)||mr["Hangul Syllables"](l)||mr.Hiragana(l)||mr["Ideographic Description Characters"](l)||mr.Kanbun(l)||mr["Kangxi Radicals"](l)||mr["Katakana Phonetic Extensions"](l)||mr.Katakana(l)&&l!==12540||!(!mr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!mr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||mr["Unified Canadian Aboriginal Syllabics"](l)||mr["Unified Canadian Aboriginal Syllabics Extended"](l)||mr["Vertical Forms"](l)||mr["Yijing Hexagram Symbols"](l)||mr["Yi Syllables"](l)||mr["Yi Radicals"](l))))}function Kp(l){return!(Zp(l)||function(r){return!!(mr["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||mr["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||mr["Letterlike Symbols"](r)||mr["Number Forms"](r)||mr["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||mr["Control Pictures"](r)&&r!==9251||mr["Optical Character Recognition"](r)||mr["Enclosed Alphanumerics"](r)||mr["Geometric Shapes"](r)||mr["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||mr["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||mr["CJK Symbols and Punctuation"](r)||mr.Katakana(r)||mr["Private Use Area"](r)||mr["CJK Compatibility Forms"](r)||mr["Small Form Variants"](r)||mr["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(l))}function Xp(l){return mr.Arabic(l)||mr["Arabic Supplement"](l)||mr["Arabic Extended-A"](l)||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l)}function d_(l){return l>=1424&&l<=2303||mr["Arabic Presentation Forms-A"](l)||mr["Arabic Presentation Forms-B"](l)}function jl(l,r){return!(!r&&d_(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||mr.Khmer(l))}function N2(l){for(const r of l)if(d_(r.charCodeAt(0)))return!0;return!1}const $s={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let h_=null,xs=$s.unavailable,Dl=null;const Bh=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(xs=$s.error),h_&&h_(l)};function Yp(){Jp.fire(new el("pluginStateChange",{pluginStatus:xs,pluginURL:Dl}))}const Jp=new fu,$h=function(){return xs},ib=function(){if(xs!==$s.deferred||!Dl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");xs=$s.loading,Yp(),Dl&&Cl({url:Dl},l=>{l?Bh(l):(xs=$s.loaded,Yp())})},Ll={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>xs===$s.loaded||Ll.applyArabicShaping!=null,isLoading:()=>xs===$s.loading,setState(l){xs=l.pluginStatus,Dl=l.pluginURL},isParsing:()=>xs===$s.parsing,isParsed:()=>xs===$s.parsed,getPluginURL:()=>Dl};class si{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(r){return function(a,u){for(const h of a)if(!jl(h.charCodeAt(0),u))return!1;return!0}(r,Ll.isLoaded())}}class Qp{constructor(r,a,u,h,g){this.property=r,this.value=a,this.expression=function(y,b,A,C,R){if(Hp(y))return new qp(y,b);if(Nh(y)||Array.isArray(y)&&y.length>0){const k=l_(y,b,A,C,R);if(k.result==="error")throw new Error(k.value.map(L=>`${L.key}: ${L.message}`).join(", "));return k.value}{let k=y;return typeof y=="string"&&b.type==="color"&&(k=kn.parse(y)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>k}}}(a===void 0?r.specification.default:a,r.specification,u,h,g)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,u,h){return this.property.possiblyEvaluate(this,r,a,u,h)}}class f_{constructor(r,a,u,h){this.property=r,this.value=new Qp(r,void 0,a,u,h)}transitioned(r,a){return new sb(this.property,this.value,a,Object.assign({},r.transition,this.transition),r.now)}untransitioned(){return new sb(this.property,this.value,null,{},0)}}class ob{constructor(r,a,u,h){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return ht(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new f_(this._values[r].property,this._scope,this._options,this._iconImageUseTheme)),this._values[r].value=new Qp(this._values[r].property,a===null?void 0:ht(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].value.isIndoorDependent())}setTransitionOrValue(r,a){a&&(this._options=a);const u=this._properties.properties;if(r)for(const h in r){const g=r[h];if(h.endsWith("-transition")){const y=h.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(h)&&this.setValue(h,g)}}getTransition(r){return ht(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new f_(this._values[r].property)),this._values[r].transition=ht(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(r[a]=u);const h=this.getTransition(a);h!==void 0&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const u=new ab(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,a._values[h]);return u}untransitioned(){const r=new ab(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}isIndoorDependent(){return this._isIndoorDependent}}class sb{constructor(r,a,u,h,g){const y=h.delay||0,b=h.duration||0;g=g||0,this.property=r,this.value=a,this.begin=g+y,this.end=this.begin+b,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,a,u){const h=r.now||0,g=this.value.possiblyEvaluate(r,a,u),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(r,a,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,a,u),g,au(b))}}return g}}class ab{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,u){const h=new wu(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(r,a,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class lb{constructor(r,a,u,h){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(r){return ht(this._values[r].value)}setValue(r,a){this._values[r]=new Qp(this._values[r].property,a===null?void 0:ht(a),this._scope,this._options,this._iconImageUseTheme),this._values[r].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[r].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[r].isIndoorDependent())}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(r[a]=u)}return r}possiblyEvaluate(r,a,u,h){const g=new wu(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,a,u,h);return g}isIndoorDependent(){return this._isIndoorDependent}}class bu{constructor(r,a,u,h){this.property=r,this.value=a,this.parameters=u,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,u,h){return this.property.evaluate(this.value,this.parameters,r,a,u,h,this.iconImageUseTheme)}}class wu{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ct{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,u){const h=bh[this.specification.type];return h?h(r,a,u):r}}class kt{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,u,h,g){return r.expression.kind==="constant"||r.expression.kind==="camera"?new bu(this,{kind:"constant",value:r.expression.evaluate(a,null,{},u,h,void 0,g)},a):new bu(this,r.expression,a,g)}interpolate(r,a,u){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new bu(this,{kind:"constant",value:void 0},r.parameters);const h=bh[this.specification.type];return h?new bu(this,{kind:"constant",value:h(r.value.value,a.value.value,u)},r.parameters):r}evaluate(r,a,u,h,g,y,b){return r.kind==="constant"?r.value:r.evaluate(a,u,h,g,y,void 0,b)}}class Su{constructor(r){this.specification=r}possiblyEvaluate(r,a,u,h){return!!r.expression.evaluate(a,null,{},u,h)}interpolate(){return!1}}class Pi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new si(0,{});for(const u in r){const h=r[u];h.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Qp(h,void 0),y=this.defaultTransitionablePropertyValues[u]=new f_(h);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(a)}}}Yt(kt,"DataDrivenProperty"),Yt(Ct,"DataConstantProperty"),Yt(Su,"ColorRampProperty");var He=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function cb(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function em(l){if(Array.isArray(l))return l.map(em);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const a in l)r[a]=em(l[a]);return r}return cb(l)}function sl(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!sl(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function tm(l,r="",a=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};sl(l)||(l=rm(l));const h=l;let g=!0;try{g=function(R){if(!bd(R))return R;let k=em(R);return ub(k),k=Tu(k),k}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let y=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=He[`filter_${u}`];const R=Mc(g,b,r,a);if(R.result==="error")throw new Error(R.value.map(k=>`${k.key}: ${k.message}`).join(", "));y=(k,L,$)=>R.value.evaluate(k,L,{},$)}let A=null,C=null;if(g!==h){const R=Mc(h,b,r,a);if(R.result==="error")throw new Error(R.value.map(k=>`${k.key}: ${k.message}`).join(", "));A=(k,L,$,U,Z)=>R.value.evaluate(k,L,{},$,void 0,void 0,U,Z),C=!dd(R.value.expression)}return{filter:y,dynamicFilter:A||void 0,needGeometry:db(g),needFeature:!!C}}function Tu(l){if(!Array.isArray(l))return l;const r=function(a){if(z2.has(a[0])){for(let u=1;u<a.length;u++)if(bd(a[u]))return!0}return a}(l);return r===!0?r:r.map(a=>Tu(a))}function ub(l){let r=!1;const a=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)r=r||bd(l[u]),a.push(l[u+1]);a.push(l[l.length-1])}else if(l[0]==="match"){r=r||bd(l[1]);for(let u=2;u<l.length-1;u+=2)a.push(l[u+1]);a.push(l[l.length-1])}else if(l[0]==="step"){r=r||bd(l[1]);for(let u=1;u<l.length-1;u+=2)a.push(l[u+1])}r&&(l.length=0,l.push("any",...a));for(let u=1;u<l.length;u++)ub(l[u])}function bd(l){if(!Array.isArray(l))return!1;if((r=l[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let a=1;a<l.length;a++)if(bd(l[a]))return!0;return!1}const z2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function F2(l,r){return l<r?-1:l>r?1:0}function db(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let r=1;r<l.length;r++)if(db(l[r]))return!0;return!1}function rm(l){if(!l)return!0;const r=l[0];return l.length<=1?r!=="any":r==="=="?nm(l[1],l[2],"=="):r==="!="?Vh(nm(l[1],l[2],"==")):r==="<"||r===">"||r==="<="||r===">="?nm(l[1],l[2],r):r==="any"?(a=l.slice(1),["any"].concat(a.map(rm))):r==="all"?["all"].concat(l.slice(1).map(rm)):r==="none"?["all"].concat(l.slice(1).map(rm).map(Vh)):r==="in"?im(l[1],l.slice(2)):r==="!in"?Vh(im(l[1],l.slice(2))):r==="has"?om(l[1]):r!=="!has"||Vh(om(l[1]));var a}function nm(l,r,a){switch(l){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,l,r]}}function im(l,r){if(r.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",l,["literal",r.sort(F2)]]:["filter-in-small",l,["literal",r]]}}function om(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Vh(l){return["!",l]}const Au="";function La(l,r){return r?`${l}${Au}${r}`:l}let hb;const fb=()=>hb||(hb=new Pi({"icon-size":new kt(He.layout_symbol["icon-size"]),"icon-image":new kt(He.layout_symbol["icon-image"]),"icon-rotate":new kt(He.layout_symbol["icon-rotate"]),"icon-offset":new kt(He.layout_symbol["icon-offset"]),"text-size":new kt(He.layout_symbol["text-size"]),"text-rotate":new kt(He.layout_symbol["text-rotate"]),"text-offset":new kt(He.layout_symbol["text-offset"])}));class pb{constructor(r,a,u,h,g,y){const b=Mc(r,He.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=a,u){this.properties=new wu(fb()),this.unevaluatedLayout=new lb(fb(),h,g,y);for(const A in u)this.unevaluatedLayout.setValue(A,u[A])}}isActive(r){return!(this.condition||!r.isHidden||this.name!=="hidden")||this.condition.evaluate(r.globals,r.feature,r.featureState,r.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(r){return this.properties.get(r)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(r){return this.unevaluatedLayout._values[r]}recalculate(r,a,u){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(r,void 0,a,u))}serialize(){const r={};return r.condition=this.condition.expression.serialize(),this.name&&(r.name=this.name),this.unevaluatedLayout&&(r.properties=this.unevaluatedLayout.serialize()),r}hasIconProperties(){const r=this.hasProperty("icon-image"),a=this.hasProperty("icon-size"),u=this.hasProperty("icon-offset"),h=this.hasProperty("icon-rotate");return r||a||u||h}hasTextProperties(){const r=this.hasProperty("text-size"),a=this.hasProperty("text-offset"),u=this.hasProperty("text-rotate");return r||a||u}hasProperty(r){return this.getUnevaluatedProperty(r).value!==void 0}}const mb="-transition",al=new Set(["fill","line","background","hillshade","raster"]);class bs extends fu{constructor(r,a,u,h,g,y){if(super(),this.id=r.id,this.fqid=La(this.id,u),this.type=r.type,this.scope=u,this.lut=h,this.options=g,this.iconImageUseTheme=y,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},r.type!=="custom"){if(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type&&r.type!=="background"&&r.type!=="sky"&&r.type!=="slot"){this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter;const b=Mc(this.filter,He[`filter_${r.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(r.slot&&(this.slot=r.slot),r.appearances&&this.setAppearances(r.appearances),a.layout&&(this._unevaluatedLayout=new lb(a.layout,this.scope,g,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new ob(a.paint,this.scope,g);for(const b in r.paint)this.setPaintProperty(b,r.paint[b]);for(const b in r.layout)this.setLayoutProperty(b,r.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wu(a.paint)}}}onAdd(r){}onRemove(r){}isDraped(r){return!this.is3D(!0)&&al.has(this.type)}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a){if(this.type==="custom"&&r==="visibility")return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[r]&&(u.setValue(r,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),r==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(r){this.appearances=[],r.forEach(a=>{this.appearances.push(new pb(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(r){return r.endsWith(mb)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}isPaintProperty(r){return!!this._transitionablePaint._properties.properties[r]}setPaintProperty(r,a){const u=this._transitionablePaint,h=u._properties.properties;if(r.endsWith(mb)){const k=r.slice(0,-11);return h[k]&&u.setTransition(k,a||void 0),!1}if(!h[r])return!1;const g=u._values[r],y=g.value.isDataDriven(),b=g.value;u.setValue(r,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...u.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||u.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(r);const A=u._values[r].value,C=A.isDataDriven(),R=r.endsWith("pattern")||r==="line-dasharray";return C||y||R||this._handleOverridablePaintPropertyUpdate(r,b,A)}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getDefaultProgramParams(r,a,u){return null}_handleOverridablePaintPropertyUpdate(r,a,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(r.appearances=this.appearances.map(a=>a.serialize())),St(r,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}is3D(r){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof bu&&Lh(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const r of this.appearances)if(!Mh(r.condition.expression))return!0;return!1}compileFilter(r){this._filterCompiled||(this._featureFilter=tm(this.filter,this.scope,r),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(r){this._stats&&(r.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(r,a,u){return{}}queryRadius(r){}queryIntersectsFeature(r,a,u,h,g,y,b,A,C){}}const gb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Uh{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const B2=new ArrayBuffer(0);class fi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(r,a){return r._trim(),a&&r.arrayBuffer&&a.add(r.arrayBuffer),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,r.arrayBuffer?a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement:(a.capacity=0,a.arrayBuffer=B2),a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this._reallocCount++,this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}reserveForAdditional(r){this.reserve(this.length+r)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...r){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...r){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Kr(l,r=1){let a=0,u=0;return{members:l.map(h=>{const g=gb[h.type].BYTES_PER_ELEMENT,y=a=yb(a,Math.max(r,g)),b=h.components||1;return u=Math.max(u,g),a+=g*b,{name:h.name,type:h.type,components:b,offset:y}}),size:yb(a,Math.max(u,r)),alignment:r}}function yb(l,r){return Math.ceil(l/r)*r}class Rc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=u,r}}Rc.prototype.bytesPerElement=4,Yt(Rc,"StructArrayLayout2i4");class wd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const g=3*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=h,r}}wd.prototype.bytesPerElement=6,Yt(wd,"StructArrayLayout3i6");class Sd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,h)}emplace(r,a,u,h,g){const y=4*r;return this.int16[y+0]=a,this.int16[y+1]=u,this.int16[y+2]=h,this.int16[y+3]=g,r}}Sd.prototype.bytesPerElement=8,Yt(Sd,"StructArrayLayout4i8");class Nl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Nl.prototype.bytesPerElement=4,Yt(Nl,"StructArrayLayout1f4");class p_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const g=4*r,y=2*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.float32[y+1]=h,r}}p_.prototype.bytesPerElement=8,Yt(p_,"StructArrayLayout2i1f8");class m_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const g=4*r;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=h,r}}m_.prototype.bytesPerElement=8,Yt(m_,"StructArrayLayout3i8");class g_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,h,g)}emplace(r,a,u,h,g,y){const b=5*r;return this.int16[b+0]=a,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=y,r}}g_.prototype.bytesPerElement=10,Yt(g_,"StructArrayLayout5i10");class sm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,h,g,y,b)}emplace(r,a,u,h,g,y,b,A){const C=6*r,R=12*r,k=3*r;return this.int16[C+0]=a,this.int16[C+1]=u,this.uint8[R+4]=h,this.uint8[R+5]=g,this.uint8[R+6]=y,this.uint8[R+7]=b,this.float32[k+2]=A,r}}sm.prototype.bytesPerElement=12,Yt(sm,"StructArrayLayout2i4ub1f12");class Ys extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const g=3*r;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=h,r}}Ys.prototype.bytesPerElement=12,Yt(Ys,"StructArrayLayout3f12");class Os extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,h,g)}emplace(r,a,u,h,g,y){const b=6*r,A=3*r;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=g,this.float32[A+2]=y,r}}Os.prototype.bytesPerElement=12,Yt(Os,"StructArrayLayout4ui1f12");class Eu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,h)}emplace(r,a,u,h,g){const y=4*r;return this.uint16[y+0]=a,this.uint16[y+1]=u,this.uint16[y+2]=h,this.uint16[y+3]=g,r}}Eu.prototype.bytesPerElement=8,Yt(Eu,"StructArrayLayout4ui8");class am extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,g,y)}emplace(r,a,u,h,g,y,b){const A=6*r;return this.int16[A+0]=a,this.int16[A+1]=u,this.int16[A+2]=h,this.int16[A+3]=g,this.int16[A+4]=y,this.int16[A+5]=b,r}}am.prototype.bytesPerElement=12,Yt(am,"StructArrayLayout6i12");class y_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k,L){const $=this.length;return this.resize($+1),this.emplace($,r,a,u,h,g,y,b,A,C,R,k,L)}emplace(r,a,u,h,g,y,b,A,C,R,k,L,$){const U=12*r;return this.int16[U+0]=a,this.int16[U+1]=u,this.int16[U+2]=h,this.int16[U+3]=g,this.uint16[U+4]=y,this.uint16[U+5]=b,this.uint16[U+6]=A,this.uint16[U+7]=C,this.int16[U+8]=R,this.int16[U+9]=k,this.int16[U+10]=L,this.int16[U+11]=$,r}}y_.prototype.bytesPerElement=24,Yt(y_,"StructArrayLayout4i4ui4i24");class __ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,g,y)}emplace(r,a,u,h,g,y,b){const A=10*r,C=5*r;return this.int16[A+0]=a,this.int16[A+1]=u,this.int16[A+2]=h,this.float32[C+2]=g,this.float32[C+3]=y,this.float32[C+4]=b,r}}__.prototype.bytesPerElement=20,Yt(__,"StructArrayLayout3i3f20");class kc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,h)}emplace(r,a,u,h,g){const y=4*r;return this.float32[y+0]=a,this.float32[y+1]=u,this.float32[y+2]=h,this.float32[y+3]=g,r}}kc.prototype.bytesPerElement=16,Yt(kc,"StructArrayLayout4f16");class lm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}lm.prototype.bytesPerElement=4,Yt(lm,"StructArrayLayout1ul4");class Js extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=u,r}}Js.prototype.bytesPerElement=4,Yt(Js,"StructArrayLayout2ui4");class cm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k,L,$){const U=this.length;return this.resize(U+1),this.emplace(U,r,a,u,h,g,y,b,A,C,R,k,L,$)}emplace(r,a,u,h,g,y,b,A,C,R,k,L,$,U){const Z=20*r,re=10*r;return this.int16[Z+0]=a,this.int16[Z+1]=u,this.int16[Z+2]=h,this.int16[Z+3]=g,this.int16[Z+4]=y,this.float32[re+3]=b,this.float32[re+4]=A,this.float32[re+5]=C,this.float32[re+6]=R,this.int16[Z+14]=k,this.uint32[re+8]=L,this.uint16[Z+18]=$,this.uint16[Z+19]=U,r}}cm.prototype.bytesPerElement=40,Yt(cm,"StructArrayLayout5i4f1i1ul2ui40");class um extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,h,g,y,b)}emplace(r,a,u,h,g,y,b,A){const C=8*r;return this.int16[C+0]=a,this.int16[C+1]=u,this.int16[C+2]=h,this.int16[C+4]=g,this.int16[C+5]=y,this.int16[C+6]=b,this.int16[C+7]=A,r}}um.prototype.bytesPerElement=16,Yt(um,"StructArrayLayout3i2i2i16");class dm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,h,g)}emplace(r,a,u,h,g,y){const b=4*r,A=8*r;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[A+6]=g,this.int16[A+7]=y,r}}dm.prototype.bytesPerElement=16,Yt(dm,"StructArrayLayout2f1f2i16");class v_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,g,y)}emplace(r,a,u,h,g,y,b){const A=20*r,C=5*r;return this.uint8[A+0]=a,this.uint8[A+1]=u,this.float32[C+1]=h,this.float32[C+2]=g,this.float32[C+3]=y,this.float32[C+4]=b,r}}v_.prototype.bytesPerElement=20,Yt(v_,"StructArrayLayout2ub4f20");class to extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const g=3*r;return this.uint16[g+0]=a,this.uint16[g+1]=u,this.uint16[g+2]=h,r}}to.prototype.bytesPerElement=6,Yt(to,"StructArrayLayout3ui6");class Td extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se){const _e=this.length;return this.resize(_e+1),this.emplace(_e,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se)}emplace(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se,_e){const Ee=30*r,Me=15*r,De=60*r;return this.int16[Ee+0]=a,this.int16[Ee+1]=u,this.int16[Ee+2]=h,this.float32[Me+2]=g,this.float32[Me+3]=y,this.uint16[Ee+8]=b,this.uint16[Ee+9]=A,this.uint32[Me+5]=C,this.uint32[Me+6]=R,this.uint32[Me+7]=k,this.uint16[Ee+16]=L,this.uint16[Ee+17]=$,this.uint16[Ee+18]=U,this.float32[Me+10]=Z,this.float32[Me+11]=re,this.uint8[De+48]=te,this.uint8[De+49]=le,this.uint8[De+50]=ue,this.uint32[Me+13]=pe,this.int16[Ee+28]=Se,this.uint8[De+58]=_e,r}}Td.prototype.bytesPerElement=60,Yt(Td,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class x_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se,_e,Ee,Me,De,nt,Ve,lt,ft,pt,xt,wt,yt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se,_e,Ee,Me,De,nt,Ve,lt,ft,pt,xt,wt,yt)}emplace(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se,_e,Ee,Me,De,nt,Ve,lt,ft,pt,xt,wt,yt,_t){const at=20*r,ot=40*r,vt=80*r;return this.float32[at+0]=a,this.float32[at+1]=u,this.int16[ot+4]=h,this.int16[ot+5]=g,this.int16[ot+6]=y,this.int16[ot+7]=b,this.int16[ot+8]=A,this.int16[ot+9]=C,this.int16[ot+10]=R,this.int16[ot+11]=k,this.int16[ot+12]=L,this.uint16[ot+13]=$,this.uint16[ot+14]=U,this.uint16[ot+15]=Z,this.uint16[ot+16]=re,this.uint16[ot+17]=te,this.uint16[ot+18]=le,this.uint16[ot+19]=ue,this.uint16[ot+20]=pe,this.uint16[ot+21]=Se,this.uint16[ot+22]=_e,this.uint16[ot+23]=Ee,this.uint16[ot+24]=Me,this.uint16[ot+25]=De,this.uint16[ot+26]=nt,this.uint16[ot+27]=Ve,this.uint32[at+14]=lt,this.float32[at+15]=ft,this.float32[at+16]=pt,this.float32[at+17]=xt,this.float32[at+18]=wt,this.uint8[vt+76]=yt,this.uint16[ot+39]=_t,r}}x_.prototype.bytesPerElement=80,Yt(x_,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class b_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,g,y)}emplace(r,a,u,h,g,y,b){const A=6*r;return this.float32[A+0]=a,this.float32[A+1]=u,this.float32[A+2]=h,this.float32[A+3]=g,this.float32[A+4]=y,this.float32[A+5]=b,r}}b_.prototype.bytesPerElement=24,Yt(b_,"StructArrayLayout6f24");class Pu extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,u,h,g)}emplace(r,a,u,h,g,y){const b=5*r;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=g,this.float32[b+4]=y,r}}Pu.prototype.bytesPerElement=20,Yt(Pu,"StructArrayLayout5f20");class w_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,h,g,y,b)}emplace(r,a,u,h,g,y,b,A){const C=7*r;return this.float32[C+0]=a,this.float32[C+1]=u,this.float32[C+2]=h,this.float32[C+3]=g,this.float32[C+4]=y,this.float32[C+5]=b,this.float32[C+6]=A,r}}w_.prototype.bytesPerElement=28,Yt(w_,"StructArrayLayout7f28");class S_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k){const L=this.length;return this.resize(L+1),this.emplace(L,r,a,u,h,g,y,b,A,C,R,k)}emplace(r,a,u,h,g,y,b,A,C,R,k,L){const $=11*r;return this.float32[$+0]=a,this.float32[$+1]=u,this.float32[$+2]=h,this.float32[$+3]=g,this.float32[$+4]=y,this.float32[$+5]=b,this.float32[$+6]=A,this.float32[$+7]=C,this.float32[$+8]=R,this.float32[$+9]=k,this.float32[$+10]=L,r}}S_.prototype.bytesPerElement=44,Yt(S_,"StructArrayLayout11f44");class Ad extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C){const R=this.length;return this.resize(R+1),this.emplace(R,r,a,u,h,g,y,b,A,C)}emplace(r,a,u,h,g,y,b,A,C,R){const k=9*r;return this.float32[k+0]=a,this.float32[k+1]=u,this.float32[k+2]=h,this.float32[k+3]=g,this.float32[k+4]=y,this.float32[k+5]=b,this.float32[k+6]=A,this.float32[k+7]=C,this.float32[k+8]=R,r}}Ad.prototype.bytesPerElement=36,Yt(Ad,"StructArrayLayout9f36");class ll extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=u,r}}ll.prototype.bytesPerElement=8,Yt(ll,"StructArrayLayout2f8");class Rs extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,u,h)}emplace(r,a,u,h,g){const y=6*r;return this.uint32[3*r+0]=a,this.uint16[y+2]=u,this.uint16[y+3]=h,this.uint16[y+4]=g,r}}Rs.prototype.bytesPerElement=12,Yt(Rs,"StructArrayLayout1ul3ui12");class jc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}jc.prototype.bytesPerElement=2,Yt(jc,"StructArrayLayout1ui2");class T_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re){const te=this.length;return this.resize(te+1),this.emplace(te,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re)}emplace(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te){const le=16*r;return this.float32[le+0]=a,this.float32[le+1]=u,this.float32[le+2]=h,this.float32[le+3]=g,this.float32[le+4]=y,this.float32[le+5]=b,this.float32[le+6]=A,this.float32[le+7]=C,this.float32[le+8]=R,this.float32[le+9]=k,this.float32[le+10]=L,this.float32[le+11]=$,this.float32[le+12]=U,this.float32[le+13]=Z,this.float32[le+14]=re,this.float32[le+15]=te,r}}T_.prototype.bytesPerElement=64,Yt(T_,"StructArrayLayout16f64");class hm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,g,y,b){const A=this.length;return this.resize(A+1),this.emplace(A,r,a,u,h,g,y,b)}emplace(r,a,u,h,g,y,b,A){const C=10*r,R=5*r;return this.uint16[C+0]=a,this.uint16[C+1]=u,this.uint16[C+2]=h,this.uint16[C+3]=g,this.float32[R+2]=y,this.float32[R+3]=b,this.float32[R+4]=A,r}}hm.prototype.bytesPerElement=20,Yt(hm,"StructArrayLayout4ui3f20");class A_ extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.int16[1*r+0]=a,r}}A_.prototype.bytesPerElement=2,Yt(A_,"StructArrayLayout1i2");class fm extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint8[1*r+0]=a,r}}fm.prototype.bytesPerElement=1,Yt(fm,"StructArrayLayout1ub1");class pm extends Uh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pm.prototype.size=40;class _b extends cm{get(r){return new pm(this,r)}}Yt(_b,"CollisionBoxArray");class mm extends Uh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}mm.prototype.size=60;class vb extends Td{get(r){return new mm(this,r)}}Yt(vb,"PlacedSymbolArray");class xb extends Uh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(r){this._structArray.uint32[this._pos4+14]=r}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(r){this._structArray.float32[this._pos4+18]=r}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}xb.prototype.size=80;class E_ extends x_{get(r){return new xb(this,r)}}Yt(E_,"SymbolInstanceArray");class gm extends Nl{getoffsetX(r){return this.float32[1*r+0]}}Yt(gm,"GlyphOffsetArray");class bb extends Rc{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Yt(bb,"SymbolLineVertexArray");class P_ extends Uh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}P_.prototype.size=12;class C_ extends Rs{get(r){return new P_(this,r)}}Yt(C_,"FeatureIndexArray");class wb extends Js{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Yt(wb,"FillExtrusionCentroidArray");class ym extends Uh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ym.prototype.size=6;class Gh extends wd{get(r){return new ym(this,r)}}Yt(Gh,"FillExtrusionWallArray");const Sb=Kr([{name:"a_pos",components:2,type:"Int16"}],4),$2=Kr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Tb=Kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _i{constructor(r=[]){this.segments=r}_prepareSegment(r,a,u,h){let g=this.segments[this.segments.length-1];return r>_i.MAX_VERTEX_ARRAY_LENGTH&&Ut(`Max vertices per segment is ${_i.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>_i.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}prepareSegment(r,a,u,h){return this._prepareSegment(r,a.length,u.length,h)}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,u,h){return new _i([{vertexOffset:r,primitiveOffset:a,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function _m(l,r){return 256*(l=ne(Math.floor(l),0,255))+ne(Math.floor(r),0,255)}_i.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt(_i,"SegmentVector");const V2=Kr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),U2=Kr([{name:"a_pattern_b",components:4,type:"Uint16"}]),G2=Kr([{name:"a_dash",components:4,type:"Uint16"}]);class Hh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(r,a,u,h){this.ids.push(I_(r)),this.positions.push(a,u,h)}eachPosition(r,a){const u=I_(r);let h=0,g=this.ids.length-1;for(;h<g;){const y=h+g>>1;this.ids[y]>=u?g=y:h=y+1}for(;this.ids[h]===u;)a(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(r,a){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return M_(u,h,0,u.length-1),a&&(a.add(u.buffer),a.add(h.buffer)),{ids:u,positions:h}}static deserialize(r){const a=new Hh;let u;a.ids=r.ids,a.positions=r.positions;for(const h of a.ids)h!==u&&a.uniqueIds.push(h),u=h;return a.indexed=!0,a}}function I_(l){const r=+l;return Number.isSafeInteger(r)?r:pp(String(l))}function M_(l,r,a,u){for(;a<u;){const h=l[a+u>>1];let g=a-1,y=u+1;for(;;){do g++;while(l[g]<h);do y--;while(l[y]>h);if(g>=y)break;vm(l,g,y),vm(r,3*g,3*y),vm(r,3*g+1,3*y+1),vm(r,3*g+2,3*y+2)}y-a<u-y?(M_(l,r,a,y),a=y+1):(M_(l,r,y+1,u),u=y)}}function vm(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}Yt(Hh,"FeaturePositionMap");class zl{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}set(r,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xm extends zl{constructor(r){super(r),this.current=0}set(r,a,u){this.fetchUniformLocation(r,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ro extends zl{constructor(r){super(r),this.current=0}set(r,a,u){this.fetchUniformLocation(r,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class cl extends zl{constructor(r){super(r),this.current=[0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Wh extends zl{constructor(r){super(r),this.current=[0,0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class bm extends zl{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class qh extends zl{constructor(r){super(r),this.current=kn.transparent.toPremultipliedRenderColor(null)}set(r,a,u){this.fetchUniformLocation(r,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const H2=new Float32Array(16);class Zh extends zl{constructor(r){super(r),this.current=H2}set(r,a,u){if(this.fetchUniformLocation(r,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const wm=new Float32Array(9),W2=new Float32Array(4);class Sm extends zl{constructor(r){super(r),this.current=W2}set(r,a,u){if(this.fetchUniformLocation(r,a)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function O_(l){return[_m(255*l.r,255*l.g),_m(255*l.b,255*l.a)]}function Kh(l,r,a,u,h,g,y,b){return!!l&&(l.kind==="composite"||l.kind==="source"?l.evaluate(new si(0,{brightness:g,worldview:b}),r,a,h,u,y)==="none":l.value==="none")}class Xh{constructor(r,a,u,h){this.value=r,this.uniformNames=a.map(g=>`u_${g}`),this.type=u,this.context=h}setUniform(r,a,u,h,g){const y=h.constantOr(this.value);a.set(r,g,y instanceof kn?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(r,a){return this.type==="color"?new qh(r):new ro(r)}}class Ed{constructor(r,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(r,a){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(r,a,u,h,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&a.set(r,g,y)}getBinding(r,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new bm(r):new ro(r)}}class Fl{constructor(r,a,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,u,h,g,y,b,A){const C=this.paintVertexArray.length,R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new si(0,{brightness:y,worldview:A}),a,{},g,h,b):this.expression.kind==="constant"&&this.expression.value,k=Kh(this.lutExpression,a,{},h,g,y,b,A);this.paintVertexArray.resize(r),this._setPaintValue(C,r,R,k?null:this.context.lut)}updatePaintArray(r,a,u,h,g,y,b,A){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:A},u,h,void 0,g):this.expression.kind==="constant"&&this.expression.value,R=Kh(this.lutExpression,u,h,g,void 0,b,void 0,A);this._setPaintValue(r,a,C,R?null:this.context.lut)}_setPaintValue(r,a,u,h){if(this.type==="color"){const g=O_(u.toPremultipliedRenderColor(h));for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bl{constructor(r,a,u,h,g,y){this.expression=r,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=h,this.context=g,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,a,u,h,g,y,b,A){const C=this.expression.evaluate(new si(this.context.zoom,{brightness:y,worldview:A}),a,{},g,h,b),R=this.expression.evaluate(new si(this.context.zoom+1,{brightness:y,worldview:A}),a,{},g,h,b),k=Kh(this.lutExpression,a,{},h,g,y,b,A),L=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(L,r,C,R,k?null:this.context.lut)}updatePaintArray(r,a,u,h,g,y,b,A){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:A},u,h,void 0,g),R=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:A},u,h,void 0,g),k=Kh(this.lutExpression,u,h,g,void 0,b,void 0,A);this._setPaintValue(r,a,C,R,k?null:this.context.lut)}_setPaintValue(r,a,u,h,g){if(this.type==="color"){const y=O_(u.toPremultipliedRenderColor(g)),b=O_(u.toPremultipliedRenderColor(g));for(let A=r;A<a;A++)this.paintVertexArray.emplace(A,y[0],y[1],b[0],b[1])}else{for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,u,h,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=ne(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(r,g,b)}getBinding(r,a){return new ro(r)}}class $l{constructor(r,a,u,h,g){this.expression=r,this.layerId=g,this.paintVertexAttributes=(u==="array"?G2:V2).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Eu}populatePaintArray(r,a,u,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(g,r,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(r,a,u,h,g,y,b){this._setPaintValues(r,a,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(r,a,u,h){if(!h||!u)return;const g=h[u[0]],y=h[u[1]];if(g){if(g){const{tl:b,br:A,pixelRatio:C}=g;for(let R=r;R<a;R++)this.paintVertexArray.emplace(R,b[0],b[1],A[0],A[1],C)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:A}=y;for(let C=r;C<a;C++)this.paintTransitionVertexArray.emplace(C,b[0],b[1],A[0],A[1])}}}upload(r){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=r.createVertexBuffer(this.paintTransitionVertexArray,U2.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Dc{constructor(r,a,u=()=>!0){this.binders={},this._buffers=[],this.context=a;const h=[];for(const g in r.paint._values){const y=r.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof bu&&Lh(y.property.specification)))continue;const b=Z2(g,r.type),A=y.value,C=y.property.specification.type,R=!!y.property.useIntegerZoom,k=g==="line-dasharray"||g.endsWith("pattern"),L=r.paint.get(`${g}-use-theme`),$=g==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(A.kind!=="constant"||$)if(A.kind==="source"||$||k){const U=R_(g,C,"source");this.binders[g]=k?new $l(A,b,C,U,r.id):new Fl(A,b,C,U),h.push(`/a_${g}`)}else{const U=R_(g,C,"composite");this.binders[g]=new Bl(A,b,C,R,a,U),h.push(`/z_${g}`)}else this.binders[g]=k?new Ed(A.value,b):new Xh(A.value,b,C,a),h.push(`/u_${g}`);L&&(this.binders[g].lutExpression=L.value)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Fl||a instanceof Bl?a.maxValue:0}populatePaintArrays(r,a,u,h,g,y,b,A){for(const C in this.binders){const R=this.binders[C];R.context=this.context,(R instanceof Fl||R instanceof Bl||R instanceof $l)&&R.populatePaintArray(r,a,u,h,g,y,b,A)}}setConstantPatternPositions(r,a){for(const u in this.binders){const h=this.binders[u];h instanceof Ed&&h.setConstantPatternPositions(r,a)}}getPatternTransitionVertexBuffer(r){const a=this.binders[r];return a instanceof $l?a.paintTransitionVertexBuffer:null}updatePaintArrays(r,a,u,h,g,y,b,A,C,R){let k=!1;const L=Object.keys(r),$=L.length!==0&&!A,U=$?L:a.uniqueIds;this.context.lut=g.lut;for(const Z in this.binders){const re=this.binders[Z];if(re.context=this.context,(re instanceof Fl||re instanceof Bl||re instanceof $l)&&re.expression&&re.expression.kind&&re.expression.kind!=="constant"&&(re.expression.isStateDependent===!0||re.expression.isLightConstant===!1)){const te=g.paint.get(Z);re.expression=te.value;for(const le of U){const ue=r[le.toString()];a.eachPosition(le,(pe,Se,_e)=>{const Ee=h.feature(pe);re.updatePaintArray(Se,_e,Ee,ue,y,b,C,R)})}if(!$)for(const le of u.uniqueIds){const ue=r[le.toString()];u.eachPosition(le,(pe,Se,_e)=>{const Ee=h.feature(pe);re.updatePaintArray(Se,_e,Ee,ue,y,b,C,R)})}k=!0}}return k}defines(){const r=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Xh||u instanceof Ed)&&r.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Xh||h instanceof Ed||h instanceof Bl)for(const g of h.uniformNames)a.push({name:g,property:u,binding:h.getBinding(r,g)})}return a}setUniforms(r,a,u,h,g){for(const{name:y,property:b,binding:A}of u)this.binders[b].setUniform(r,A,g,h.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Fl||a instanceof Bl||a instanceof $l)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof $l&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(r){for(const a in this.binders){const u=this.binders[a];(u instanceof Fl||u instanceof Bl||u instanceof $l)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Fl||a instanceof Bl||a instanceof $l)&&a.destroy()}}}class Na{constructor(r,a,u=()=>!0){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new Dc(h,a,u);this.needsUpload=!1,this._featureMap=new Hh,this._featureMapWithoutIds=new Hh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(r,a,u,h,g,y,b,A,C){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(r,a,h,g,y,b,A,C);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,r):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,r),this._idlessCounter+=1),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,u,h,g,y,b,A){for(const C of u)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(r,this._featureMap,this._featureMapWithoutIds,a,C,h,g,y,b||0,A)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const q2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Z2(l,r){return q2[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}const K2={"line-pattern":{source:Os,composite:Os},"fill-pattern":{source:Os,composite:Os},"fill-extrusion-pattern":{source:Os,composite:Os},"line-dasharray":{source:Eu,composite:Eu}},X2={color:{source:ll,composite:kc},number:{source:Nl,composite:ll}};function R_(l,r,a){const u=K2[l];return u&&u[a]||X2[r][a]}Yt(Xh,"ConstantBinder"),Yt(Ed,"PatternConstantBinder"),Yt(Fl,"SourceExpressionBinder"),Yt($l,"PatternCompositeBinder"),Yt(Bl,"CompositeExpressionBinder"),Yt(Dc,"ProgramConfiguration",{omit:["_buffers"]}),Yt(Na,"ProgramConfigurationSet");const Xo=Mt/Math.PI/2,pa=5,Tm=6,Y2=16383,Pd=64,k_=[Pd,32,16],ma=-Xo,ga=Xo;function Cu(l,r,a,u=Xo){return a=Zr(a),[l*Math.sin(a)*u,-r*u,l*Math.cos(a)*u]}function Cd(l,r,a){return Cu(Math.cos(Zr(l)),Math.sin(Zr(l)),r,a)}const p=63710088e-1,s=2*Math.PI*p;class c{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new c(ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,u=this.lat*a,h=r.lat*a,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return p*Math.acos(Math.min(g,1))}toBounds(r=0){const a=360*r/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new m({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(r){return Cd(this.lat,this.lng,Xo+r*Xo/p)}static convert(r){if(r instanceof c)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new c(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new c(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class m{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):Array.isArray(r)&&r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof c?new c(r.lng,r.lat):c.convert(r),this}setSouthWest(r){return this._sw=r instanceof c?new c(r.lng,r.lat):c.convert(r),this}extend(r){const a=this._sw,u=this._ne;let h,g;if(r instanceof c)h=r,g=r;else{if(!(r instanceof m))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(m.convert(r)):this.extend(c.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(c.convert(r)):this;if(h=r._sw,g=r._ne,!h||!g)return this}return a||u?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new c(h.lng,h.lat),this._ne=new c(g.lng,g.lat)),this}getCenter(){return new c((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c(this.getWest(),this.getNorth())}getSouthEast(){return new c(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:u}=c.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){if(r)return r instanceof m?r:new m(r)}}const v=0,w=25.5;function T(l){return s*Math.cos(l*Math.PI/180)}function P(l){return(180+l)/360}function O(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function D(l,r){return l/T(r)}function F(l){return 360*l-180}function W(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function H(l,r){return l*T(W(r))}const q=85.051129;function ee(l){return Math.cos(Zr(ne(l,-q,q)))}function Y(l,r){const a=ne(r,v,w),u=Math.pow(2,a);return ee(l)*s/(512*u)}function ae(l){return 1/Math.cos(l*Math.PI/180)}function oe(l,r=0){const a=Math.exp(Math.PI*(1-(l.y+r/Mt)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Mt/(1<<l.z)}class de{constructor(r,a,u=0){this.x=+r,this.y=+a,this.z=+u}static fromLngLat(r,a=0){const u=c.convert(r);return new de(P(u.lng),O(u.lat),D(a,u.lat))}toLngLat(){return new c(F(this.x),W(this.y))}toAltitude(){return H(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/s*ae(W(this.y))}}function me(l,r,a,u,h,g,y,b,A){const C=(r+u)/2,R=(a+h)/2,k=new mt(C,R);b(k),function(L,$,U,Z,re,te){const le=U-re,ue=Z-te;return Math.abs((Z-$)*le-(U-L)*ue)/Math.hypot(le,ue)}(k.x,k.y,g.x,g.y,y.x,y.y)>=A?(me(l,r,a,C,R,g,k,b,A),me(l,C,R,u,h,k,y,b,A)):l.push(y)}function fe(l,r,a){let u=l[0],h=u.x,g=u.y;r(u);const y=[u];for(let b=1;b<l.length;b++){const A=l[b],{x:C,y:R}=A;r(A),me(y,h,g,C,R,u,A,r,a),h=C,g=R,u=A}return y}function Pe(l,r,a,u){if(u(r,a)){const h=r.add(a)._mult(.5);Pe(l,r,h,u),Pe(l,h,a,u)}else l.push(a)}function be(l,r){let a=l[0];const u=[a];for(let h=1;h<l.length;h++){const g=l[h];Pe(u,a,g,r),a=g}return u}const Ae=Math.pow(2,14)-1,xe=-Ae-1;function ye(l,r){const a=Math.round(l.x*r),u=Math.round(l.y*r);return l.x=ne(a,xe,Ae),l.y=ne(u,xe,Ae),(a<l.x||a>l.x+1||u<l.y||u>l.y+1)&&Ut("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ce(l,r,a){const u=l.loadGeometry(),h=l.extent,g=Mt/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:b,x:A,y:C,projection:R}=a,k=L=>{const $=F((r.x+L.x/h)/y),U=W((r.y+L.y/h)/y),Z=R.project($,U);L.x=(Z.x*b-A)*h,L.y=(Z.y*b-C)*h};for(let L=0;L<u.length;L++)if(l.type!==1)u[L]=fe(u[L],k,1);else{const $=[];for(const U of u[L])U.x<0||U.x>=h||U.y<0||U.y>=h||(k(U),$.push(U));u[L]=$}}for(const y of u)for(const b of y)ye(b,g);return u}function $e(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?Ce(l):[]}}class Ne{constructor(r,a,u,h,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=h,this._values=g,r.readFields(et,this,a)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos,u=[];let h,g=1,y=0,b=0,A=0;for(;r.pos<a;){if(y<=0){const C=r.readVarint();g=7&C,y=C>>3}if(y--,g===1||g===2)b+=r.readSVarint(),A+=r.readSVarint(),g===1&&(h&&u.push(h),h=[]),h&&h.push(new mt(b,A));else{if(g!==7)throw new Error(`unknown command ${g}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos;let u=1,h=0,g=0,y=0,b=1/0,A=-1/0,C=1/0,R=-1/0;for(;r.pos<a;){if(h<=0){const k=r.readVarint();u=7&k,h=k>>3}if(h--,u===1||u===2)g+=r.readSVarint(),y+=r.readSVarint(),g<b&&(b=g),g>A&&(A=g),y<C&&(C=y),y>R&&(R=y);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,C,A,R]}toGeoJSON(r,a,u){const h=this.extent*Math.pow(2,u),g=this.extent*r,y=this.extent*a,b=this.loadGeometry();function A(L){return[360*(L.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+y)/h)*Math.PI))-90]}function C(L){return L.map(A)}let R;if(this.type===1){const L=[];for(const U of b)L.push(U[0]);const $=C(L);R=L.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const L=b.map(C);R=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=function(U){const Z=U.length;if(Z<=1)return[U];const re=[];let te,le;for(let ue=0;ue<Z;ue++){const pe=tt(U[ue]);pe!==0&&(le===void 0&&(le=pe<0),le===pe<0?(te&&re.push(te),te=[U[ue]]):te&&te.push(U[ue]))}return te&&re.push(te),re}(b),$=[];for(const U of L)$.push(U.map(C));R=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const k={type:"Feature",geometry:R,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function et(l,r,a){l===1?r.id=a.readVarint():l===2?function(u,h){const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[y]=b}}(a,r):l===3?r.type=a.readVarint():l===4&&(r._geometry=a.pos)}function tt(l){let r=0;for(let a,u,h=0,g=l.length,y=g-1;h<g;y=h++)a=l[h],u=l[y],r+=(u.x-a.x)*(a.y+u.y);return r}Ne.types=["Unknown","Point","LineString","Polygon"];class dt{constructor(r,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Tt,this,a),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const a=this._pbf.readVarint()+this._pbf.pos;return new Ne(this._pbf,a,this.extent,this._keys,this._values)}}function Tt(l,r,a){l===15?r.version=a.readVarint():l===1?r.name=a.readString():l===5?r.extent=a.readVarint():l===2?r._features.push(a.pos):l===3?r._keys.push(a.readString()):l===4&&r._values.push(function(u){let h=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const y=u.readVarint()>>3;h=y===1?u.readString():y===2?u.readFloat():y===3?u.readDouble():y===4?u.readVarint64():y===5?u.readVarint():y===6?u.readSVarint():y===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(a))}class Ze{constructor(r,a){this.layers=r.readFields(ke,{},a)}}function ke(l,r,a){if(l===3){const u=new dt(a,a.readVarint()+a.pos);u.length&&(r[u.name]=u)}}const st="3d_elevation_id",Ye="level";class gt{constructor(){this._valid=!1}reset(r){return this.feature=r,this._valid=!0,this._geometry=r.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(r,a){return this._valid&&r(a(this._geometry)),this}require(r,a,u){return this.get(r,!0,a,u)}optional(r,a,u){return this.get(r,!1,a,u)}success(){return this._valid}get(r,a,u,h){const g=this.feature.properties.hasOwnProperty(r)?+this.feature.properties[r]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(h?h(g):g):a&&(this._valid=!1),this}}class Rt{constructor(r,a){this.featureFunc=r,this.vertexFunc=a}parseFeature(r,a,u){return this.featureFunc(r,a,u)}parseVertex(r,a,u){return this.vertexFunc(r,a,u)}}const Vt=new Rt((l,r,a)=>l.reset(r).require(st,u=>{a.id=u}).optional("fixed_height_relative",u=>{a.constantHeight=u},At.decodeRelativeHeight).geometry(u=>{a.bounds=u},Ol).success(),(l,r,a)=>l.reset(r).require(st,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height_relative",u=>{a.height=u},At.decodeRelativeHeight).geometry(u=>{a.position=u},At.getPoint).success()),It=new Rt((l,r,a)=>l.reset(r).require(st,u=>{a.id=u}).optional("fixed_height",u=>{a.constantHeight=u},At.decodeMetricHeight).geometry(u=>{a.bounds=u},Ol).success(),(l,r,a)=>l.reset(r).require(st,u=>{a.id=u}).require("elevation_idx",u=>{a.idx=u}).require("extent",u=>{a.extent=u}).require("height",u=>{a.height=u},At.decodeMetricHeight).geometry(u=>{a.position=u},At.getPoint).success());class At{static getPoint(r){return Ir(r[0][0].x,r[0][0].y)}static decodeRelativeHeight(r){return 1e-4*r*5}static decodeMetricHeight(r){return 1e-4*r}static getVersionSchema(r){return r?r==="1.0.1"?It:void 0:Vt}static parse(r){const a=[],u=[],h=r.length,g=new gt;for(let y=0;y<h;y++){const b=r.feature(y),A=b.properties.version,C=At.getVersionSchema(A);if(C===void 0){Ut(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const R=b.properties.type;if(!R)continue;const k=Ne.types[b.type];if(k==="Point"&&R==="curve_point"){const L={};C.parseVertex(g,b,L)&&a.push(L)}else if(k==="Polygon"&&R==="curve_meta"){const L={};C.parseFeature(g,b,L)&&u.push(L)}}return{vertices:a,features:u}}}class tr{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,u){const h=Mi(a,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class Jt{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,u){const h=nr(a,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(r,a,u){if(function($,U){var Z=$[0],re=$[1],te=$[2],le=U[0],ue=U[1],pe=U[2];return Math.abs(Z-le)<=S*Math.max(1,Math.abs(Z),Math.abs(le))&&Math.abs(re-ue)<=S*Math.max(1,Math.abs(re),Math.abs(ue))&&Math.abs(te-pe)<=S*Math.max(1,Math.abs(te),Math.abs(pe))}(this.pos,r)||a===0)return u[0]=u[1]=u[2]=0,!1;const[h,g,y]=this.dir,b=this.pos[0]-r[0],A=this.pos[1]-r[1],C=this.pos[2]-r[2],R=h*h+g*g+y*y,k=2*(b*h+A*g+C*y),L=k*k-4*R*(b*b+A*A+C*C-a*a);if(L<0){const $=Math.max(-k/2,0),U=b+h*$,Z=A+g*$,re=C+y*$,te=Math.hypot(U,Z,re);return u[0]=U*a/te,u[1]=Z*a/te,u[2]=re*a/te,!1}{const $=(-k-Math.sqrt(L))/(2*R);if($<0){const U=Math.hypot(b,A,C);return u[0]=b*a/U,u[1]=A*a/U,u[2]=C*a/U,!1}return u[0]=b+h*$,u[1]=A+g*$,u[2]=C+y*$,!0}}}class zt{constructor(r,a,u,h,g){this.TL=r,this.TR=a,this.BR=u,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(r,a,u){const h=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],A=zr(h,h,r),C=zr(g,g,r),R=zr(y,y,r),k=zr(b,b,r);return new zt(A,C,R,k,a/u)}}function Gt(l,r,a){let u=1/0,h=-1/0;const g=[];for(const y of l){Qn(g,y,r);const b=nr(g,a);u=Math.min(u,b),h=Math.max(h,b)}return[u,h]}function hr(l,r){let a=!0;for(let u=0;u<l.planes.length;u++){const h=l.planes[u];let g=0;for(let y=0;y<r.length;y++)g+=+(nr(h,r[y])+h[3]>=0);if(g===0)return 0;g!==r.length&&(a=!1)}return a?2:1}function Or(l,r){for(const a of l.projections){const u=Gt(r,l.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function Qr(l,r){let a=0;const u=[0,0,0,0];for(let y=0;y<l.length;y++)u[0]=l[y][0],u[1]=l[y][1],u[2]=l[y][2],u[3]=1,(h=u)[0]*(g=r)[0]+h[1]*g[1]+h[2]*g[2]+h[3]*g[3]>=0&&a++;var h,g;return a}class wn{constructor(r,a){this.points=r||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=rr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Qn([],this.points[2],this.points[3]),Qn([],this.points[0],this.points[3]),Qn([],this.points[4],this.points[0]),Qn([],this.points[5],this.points[1]),Qn([],this.points[6],this.points[2]),Qn([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Gt(this.points,this.points[0],h)}),this.projections.push({axis:g,projection:Gt(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(r,a,u,h){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const R=Hi([],C,r),k=1/R[3]/a*g;return(L=R)[0]=($=R)[0]*(U=[k,k,h?1/R[3]:k,k])[0],L[1]=$[1]*U[1],L[2]=$[2]*U[2],L[3]=$[3]*U[3],L;var L,$,U}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const R=Lt([],pr([],Qn([],y[C[0]],y[C[1]]),Qn([],y[C[2]],y[C[1]]))),k=-nr(R,y[C[1]]);return R.concat(k)}),A=[];for(let C=0;C<y.length;C++)A.push([y[C][0],y[C][1],y[C][2]]);return new wn(A,b)}intersectsPrecise(r,a,u){for(let h=0;h<a.length;h++)if(!Qr(r,a[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Qr(r,this.planes[h]))return 0;for(const h of u)for(const g of this.frustumEdges){const y=pr([],h,g),b=it(y);if(b===0)continue;$t(y,y,1/b);const A=Gt(this.points,this.points[0],y),C=Gt(r,this.points[0],y);if(A[0]>C[1]||C[0]>A[1])return 0}return 1}containsPoint(r){for(const a of this.planes){const u=a[3];if(nr([a[0],a[1],a[2]],r)+u<0)return!1}return!0}}class rr{static fromPoints(r){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of r)cr(a,a,h),Bt(u,u,h);return new rr(a,u)}static fromTileIdAndHeight(r,a,u){const h=1<<r.canonical.z,g=r.canonical.x,y=r.canonical.y;return new rr([g/h,y/h,a],[(g+1)/h,(y+1)/h,u])}static applyTransform(r,a){const u=r.getCorners();for(let h=0;h<u.length;++h)zr(u[h],u[h],a);return rr.fromPoints(u)}static applyTransformFast(r,a){const u=[a[12],a[13],a[14]],h=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const b=a[4*y+g],A=b*r.min[y],C=b*r.max[y];u[g]+=Math.min(A,C),h[g]+=Math.max(A,C)}return new rr(u,h)}static projectAabbCorners(r,a){const u=r.getCorners();for(let h=0;h<u.length;++h)zr(u[h],u[h],a);return u}constructor(r,a){this.min=r,this.max=a,this.center=$t([],ut([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],u=Xe(this.min),h=Xe(this.max);for(let g=0;g<a.length;g++)u[g]=a[g]?this.min[g]:this.center[g],h[g]=a[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new rr(u,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){return this.intersectsAabb(r.bounds)?hr(r,this.getCorners()):0}intersectsFlat(r){return this.intersectsAabb(r.bounds)?hr(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(r,a){return a||this.intersects(r)?Or(r,this.getCorners()):0}intersectsPreciseFlat(r,a){return a||this.intersectsFlat(r)?Or(r,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(r){for(let a=0;a<3;++a)if(this.min[a]>r.max[a]||r.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(r){return!(this.min[0]>r.max[0]||r.min[0]>this.max[0]||this.min[1]>r.max[1]||r.min[1]>this.max[1])}encapsulate(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r.min[a]),this.max[a]=Math.max(this.max[a],r.max[a])}encapsulatePoint(r){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],r[a]),this.max[a]=Math.max(this.max[a],r[a])}closestPoint(r){return[Math.max(Math.min(this.max[0],r[0]),this.min[0]),Math.max(Math.min(this.max[1],r[1]),this.min[1]),Math.max(Math.min(this.max[2],r[2]),this.min[2])]}}Yt(rr,"Aabb");class vn{constructor(r,a){this.feature=r,this.metersToTile=a,this.index=0}get(){const r=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,u=a[1],h=-a[0],g=(r.extent+1)*this.metersToTile;return[new mt(Math.trunc(r.position[0]+u*g),Math.trunc(r.position[1]+h*g)),new mt(Math.trunc(r.position[0]-u*g),Math.trunc(r.position[1]-h*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Mr{constructor(r,a,u,h,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[fr(),fr(),fr(),fr(),fr(),fr(),fr()],this.id=r,this.heightRange={min:u,max:u},this.safeArea=a,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=g,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((A=this.vertices[b.a].position)[0]===(C=this.vertices[b.b].position)[0]&&A[1]===C[1]);var A,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:Ir(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const A=this.vertices[b.a].position,C=this.vertices[b.b].position,R=eo(fr(),C,A),k=Lo(R),L=$o(fr(),R,1/k);this.edgeProps.push({vec:R,dir:L,len:k});const $=this.vertexProps[b.a].dir,U=this.vertexProps[b.b].dir;Ii($,$,L),Ii(U,U,L)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||Ca(b.dir,b.dir);this.tessellate(y)}}pointElevation(r){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(r);if(a==null)return 0;const[u,h]=a;return xr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(r,a){const u=this.getClosestEdge(r);if(!u)return Ge(0,0,1);const h=u[0],g=this.edges[h],y=this.edgeProps[h].vec,b=Ge(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*a),A=Ge(b[1],-b[0],0);pr(A,A,b);const C=it(A);return C>0?$t(A,A,1/C):Ke(A,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(r){if(this.edges.length===0)return;let a=0,u=Number.POSITIVE_INFINITY,h=0;const[g,y,b,A,C,R,k]=this._tmpVec2;On(k,r.x,r.y);const L=new tr(k,null);for(let $=0;$<this.edges.length;$++){const U=this.edges[$],Z=this.edgeProps[$].dir;L.dir=Z;const re=this.vertices[U.a].position,te=this.vertices[U.b].position,le=L.intersectsPlane(re,this.vertexProps[U.a].dir,g),ue=L.intersectsPlane(te,this.vertexProps[U.b].dir,y);if(!le||!ue)continue;eo(b,y,g),eo(A,k,g);const pe=Mi(b,b),Se=pe>0?Mi(A,b)/pe:0,_e=ne(Se,0,1),Ee=Math.abs((Se-_e)*this.edgeProps[$].len);eo(C,k,re),On(R,Z[1],-Z[0]);const Me=Ee+Math.abs(Mi(C,R));Me<u&&(a=$,u=Me,h=_e)}return[a,h]}tessellate(r){const a=qe(),u=qe(),h=qe(),g=qe();for(let y=this.edges.length-1;y>=0;--y){const b=this.edges[y].a,A=this.edges[y].b,{position:C,height:R,extent:k}=this.vertices[b],{position:L,height:$,extent:U}=this.vertices[A],Z=this.vertexProps[b].dir,re=this.vertexProps[A].dir;if(Ke(a,C[0]/r,C[1]/r,R),Ke(u,L[0]/r,L[1]/r,$),Ke(h,Z[1],-Z[0],0),$t(h,h,k),Ke(g,re[1],-re[0],0),$t(g,g,U),this.distSqLines(Ge(a[0]+.5*h[0],a[1]+.5*h[1],a[2]+.5*h[2]),Ge(u[0]-.5*g[0],u[1]-.5*g[1],u[2]-.5*g[2]),Ge(a[0]-.5*h[0],a[1]-.5*h[1],a[2]-.5*h[2]),Ge(u[0]+.5*g[0],u[1]+.5*g[1],u[2]+.5*g[2]))<=.0025000000000000005)continue;const te=this.vertices.length,le=Ii(fr(),C,L);this.vertices.push({position:$o(le,le,.5),height:.5*(R+$),extent:.5*(k+U)});const ue=Ii(fr(),Z,re);this.vertexProps.push({dir:Ca(ue,ue)}),this.edges.splice(y,1),this.edgeProps.splice(y,1),this.edges.push({a:b,b:te}),this.edges.push({a:te,b:A});const pe=eo(fr(),this.vertices[te].position,C),Se=Lo(pe),_e={vec:pe,dir:$o(fr(),pe,1/Se),len:Se};this.edgeProps.push(_e),this.edgeProps.push(_e)}}distSqLines(r,a,u,h){const g=rt(qe(),a,r),y=rt(qe(),h,u),b=rt(qe(),r,u),A=nr(g,g),C=nr(g,y),R=nr(g,b),k=nr(y,y),L=nr(y,b),$=A*k-C*C;if($===0)return qn(Nt(g,u,h,nr(b,y)/nr(y,y)),r);const U=(A*L-C*R)/$;return qn(Nt(g,r,a,(C*L-R*k)/$),Nt(y,u,h,U))}}class Pn{static parseFrom(r,a){const u=At.parse(r);if(!u)return[];let{vertices:h,features:g}=u;const y=1/oe(a);g.sort((R,k)=>R.id-k.id),h.sort((R,k)=>R.id-k.id||R.idx-k.idx),h=h.filter((R,k,L)=>k===L.findIndex($=>$.id===R.id&&$.idx===R.idx));const b=new Array;let A=0;const C=h.length;for(const R of g){if(R.constantHeight){b.push(new Mr(R.id,R.bounds,R.constantHeight));continue}for(;A!==C&&h[A].id<R.id;)A++;if(A===C||h[A].id!==R.id)continue;const k=new Array,L=new Array,$=A;for(;A!==C&&h[A].id===R.id;){const U=h[A];if(k.push({position:U.position,height:U.height,extent:U.extent}),A!==$&&h[A-1].idx===U.idx-1){const Z=A-$;L.push({a:Z-1,b:Z})}A++}b.push(new Mr(R.id,R.bounds,void 0,k,L,y))}return b}static getElevationFeature(r,a){if(!a)return;const u=+r.properties[st];return Number.isNaN(u)?void 0:a.find(h=>h.id===u)}}class Bn{constructor(r,a){this.zScale=1,this.xOffset=0,this.yOffset=0,r.equals(a)||(this.zScale=Math.pow(2,a.z-r.z),this.xOffset=(r.x*this.zScale-a.x)*Mt,this.yOffset=(r.y*this.zScale-a.y)*Mt)}constantElevation(r,a){if(r.constantHeight!=null)return this.computeBiasedHeight(r.constantHeight,a)}pointElevation(r,a,u){const h=this.constantElevation(a,u);return h??(r.x=r.x*this.zScale+this.xOffset,r.y=r.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(r),u))}computeBiasedHeight(r,a){return a<=0?r:r+a*ce(0,a,r>=0?r:Math.abs(.5*r))}}Yt(Mr,"ElevationFeature");class jn{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Rc,this.indexArray=new to,this.segments=new _i,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Nl),this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,h){}populate(r,a,u,h){const g=this.layers[0],y=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:C,id:R,index:k,sourceLayerIndex:L}of r){const $=this.layers[0]._featureFilter.needGeometry,U=$e(C,$);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),U,u))continue;const Z=b?b.evaluate(U,{},u):void 0,re={id:R,properties:C.properties,type:C.type,sourceLayerIndex:L,index:k,geometry:$?U.geometry:Ce(C,u,h),patterns:{},sortKey:Z};y.push(re)}b&&y.sort((C,R)=>C.sortKey-R.sortKey);let A=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new am,A=h.projection);for(const C of y){const{geometry:R,index:k,sourceLayerIndex:L}=C,$=r[k].feature;this.addFeature(C,R,k,a.availableImages,u,A,a.brightness,a.elevationFeatures),a.featureIndex.insert($,R,k,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(r,a,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Sb.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Tb.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,$2.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(r,a,u,h,g,y,b,A){let C;this.elevationMode!=="none"&&(C=Pn.getElevationFeature(r,A));for(const R of a)for(const k of R){const L=k.x,$=k.y;if(L<0||L>=Mt||$<0||$>=Mt)continue;if(y){const re=y.projectTilePoint(L,$,g),te=y.upVector(g,L,$);this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te),this.addGlobeExtVertex(re,te)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),Z=U.vertexLength;if(this.addCircleVertex(L,$,-1,-1),this.addCircleVertex(L,$,1,-1),this.addCircleVertex(L,$,1,1),this.addCircleVertex(L,$,-1,1),this.elevationMode!=="none"){const re=C?C.pointElevation(new mt(L,$)):0;this.hasElevation=this.hasElevation||re!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(re)}this.indexArray.emplaceBack(Z,Z+1,Z+2),this.indexArray.emplaceBack(Z,Z+2,Z+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,g,b,void 0,this.worldview)}addCircleVertex(r,a,u,h){this.layoutVertexArray.emplaceBack(2*r+(u+1)/2,2*a+(h+1)/2)}addGlobeExtVertex(r,a){this.globeExtVertexArray.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function _n(l,r){for(let a=0;a<l.length;a++)if(Kn(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(Kn(l,r[a]))return!0;return!!pi(l,r)}function Br(l,r,a){return!!Kn(l,r)||!!ci(r,l,a)}function An(l,r){if(l.length===1)return vi(r,l[0]);for(let a=0;a<r.length;a++){const u=r[a];for(let h=0;h<u.length;h++)if(Kn(l,u[h]))return!0}for(let a=0;a<l.length;a++)if(vi(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(pi(l,r[a]))return!0;return!1}function Ti(l,r,a){if(l.length>1){if(pi(l,r))return!0;for(let u=0;u<r.length;u++)if(ci(r[u],l,a))return!0}for(let u=0;u<l.length;u++)if(ci(l[u],r,a))return!0;return!1}function pi(l,r){if(l.length===0||r.length===0)return!1;for(let a=0;a<l.length-1;a++){const u=l[a],h=l[a+1];for(let g=0;g<r.length-1;g++)if(Cn(u,h,r[g],r[g+1]))return!0}return!1}function Cn(l,r,a,u){return Fr(l,a,u)!==Fr(r,a,u)&&Fr(l,r,a)!==Fr(l,r,u)}function fn(l,r,a){return(l.x-a.x)*(r.y-a.y)-(l.y-a.y)*(r.x-a.x)}function $r(l,r,a,u){const h=fn(l,r,u),g=fn(l,r,a);if(Math.sign(h)===Math.sign(g))return;const y=fn(a,u,l),b=y+g-h;return Math.sign(y)!==Math.sign(b)?[y/(y-b),g/(g-h)]:void 0}function ci(l,r,a){const u=a*a;if(r.length===1)return l.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(ki(l,r[h-1],r[h])<u)return!0;return!1}function ki(l,r,a){const u=r.distSqr(a);if(u===0)return l.distSqr(r);const h=((l.x-r.x)*(a.x-r.x)+(l.y-r.y)*(a.y-r.y))/u;return l.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function vi(l,r){let a,u,h,g=!1;for(let y=0;y<l.length;y++){a=l[y];for(let b=0,A=a.length-1;b<a.length;A=b++)u=a[b],h=a[A],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function Kn(l,r){let a=!1;for(let u=0,h=l.length-1;u<l.length;h=u++){const g=l[u],y=l[h];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function ws(l,r,a,u,h){for(const y of l)if(r<=y.x&&a<=y.y&&u>=y.x&&h>=y.y)return!0;const g=[new mt(r,a),new mt(r,h),new mt(u,h),new mt(u,a)];if(l.length>2){for(const y of g)if(Kn(l,y))return!0}for(let y=0;y<l.length-1;y++)if(Ho(l[y],l[y+1],g))return!0;return!1}function Ho(l,r,a){const u=a[0],h=a[2];if(l.x<u.x&&r.x<u.x||l.x>h.x&&r.x>h.x||l.y<u.y&&r.y<u.y||l.y>h.y&&r.y>h.y)return!1;const g=Fr(l,r,a[0]);return g!==Fr(l,r,a[1])||g!==Fr(l,r,a[2])||g!==Fr(l,r,a[3])}function no(l,r,a,u,h,g){let y=r.y-l.y,b=l.x-r.x;if(g=g||0){const A=y*y+b*b;if(A===0)return!0;const C=Math.sqrt(A);y/=C,b/=C}return!((a.x-l.x)*y+(a.y-l.y)*b-g<0||(u.x-l.x)*y+(u.y-l.y)*b-g<0||(h.x-l.x)*y+(h.y-l.y)*b-g<0)}function Yo(l,r,a,u,h,g,y){return!(no(l,r,u,h,g,y)||no(r,a,u,h,g,y)||no(a,l,u,h,g,y)||no(u,h,l,r,a,y)||no(h,g,l,r,a,y)||no(g,u,l,r,a,y))}function Jo(l,r,a){const u=r.paint.get(l).value;return u.kind==="constant"?u.value:a.programConfigurations.get(r.id).getMaxValue(l)}function No(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Qs(l,r,a,u,h){if(!r[0]&&!r[1])return l;const g=mt.convert(r)._mult(h);a==="viewport"&&g._rotate(-u);const y=[];for(let b=0;b<l.length;b++)y.push(l[b].sub(g));return y}function ya(l,r,a,u){const h=mt.convert(l)._mult(u);return r==="viewport"&&h._rotate(-a),h}let ks,Ci;function zi(l,r,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[l*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}Yt(jn,"CircleBucket",{omit:["layers"]});class Xn{constructor(r,a,u){this.z=r,this.x=a,this.y=u,this.key=xi(0,r,r,a,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}isChildOf(r){const a=this.z-r.z;return r.z===0||r.z<this.z&&r.x===this.x>>a&&r.y===this.y>>a}url(r,a){const u=function(g,y,b){var A=zi(256*g,256*(y=Math.pow(2,b)-y-1),b),C=zi(256*(g+1),256*(y+1),b);return A[0]+","+A[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),h=function(g,y,b){let A,C="";for(let R=g;R>0;R--)A=1<<R-1,C+=(y&A?1:0)+(b&A?2:0);return C}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vi{constructor(r,a){this.wrap=r,this.canonical=a,this.key=xi(r,a.z,a.z,a.x,a.y)}}class Ai{constructor(r,a,u,h,g){this.overscaledZ=r,this.wrap=a,this.canonical=new Xn(u,+h,+g),this.key=a===0&&r===u?this.canonical.key:xi(a,r,u,h,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Ai(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ai(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return xi(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return xi(this.wrap*+a,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.z<this.canonical.z&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ai(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Ai(a,this.wrap,a,u,h),new Ai(a,this.wrap,a,u+1,h),new Ai(a,this.wrap,a,u,h+1),new Ai(a,this.wrap,a,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ai(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ai(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xi(l,r,a,u,h){const g=1<<Math.min(a,22);let y=g*(h%g)+u%g;return l&&a<22&&(y+=g*g*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*y+a)+(r-a)}const _a=[l=>{let r=l.canonical.x-1,a=l.wrap;return r<0&&(r=(1<<l.canonical.z)-1,a--),new Ai(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>{let r=l.canonical.x+1,a=l.wrap;return r===1<<l.canonical.z&&(r=0,a++),new Ai(l.overscaledZ,a,l.canonical.z,r,l.canonical.y)},l=>new Ai(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new Ai(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Yt(Xn,"CanonicalTileID"),Yt(Ai,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Yh=Kr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:za}=Yh,Jh=Kr([{name:"a_pos_3",components:3,type:"Int16"}]);var Id=Kr([{name:"a_pos",type:"Int16",components:2}]);function ul(l){return l*Xo/p}const Vl=[new rr([ma,ma,ma],[ga,ga,ga]),new rr([ma,ma,ma],[0,0,ga]),new rr([0,ma,ma],[ga,0,ga]),new rr([ma,0,ma],[0,ga,ga]),new rr([0,0,ma],[ga,ga,ga])];function Md(l,r,a,u=!0){const h=$t([],l._camera.position,l.worldSize),g=[r,a,1,1];Hi(g,g,l.pixelMatrixInverse),Co(g,g,1/g[3]);const y=Lt([],Qn([],g,h)),b=l.globeMatrix,A=[b[12],b[13],b[14]],C=Qn([],A,h),R=it(C),k=Lt([],C),L=l.worldSize/(2*Math.PI),$=nr(k,y),U=Math.asin(L/R);if(U<Math.acos($)){if(!u)return null;const nt=[],Ve=[];$t(nt,y,R/$),Lt(Ve,Qn(Ve,nt,C)),Lt(y,ut(y,C,$t(y,Ve,Math.tan(U)*R)))}const Z=[];new Jt(h,y).closestPointOnSphere(A,L,Z);const re=Lt([],Oi(b,0)),te=Lt([],Oi(b,1)),le=Lt([],Oi(b,2)),ue=nr(re,Z),pe=nr(te,Z),Se=nr(le,Z),_e=os(Math.asin(-pe/L));let Ee=os(Math.atan2(ue,Se));Ee=l.center.lng+function(nt,Ve){const lt=(Ve-nt+180)%360-180;return lt<-180?lt+360:lt}(l.center.lng,Ee);const Me=P(Ee),De=ne(O(_e),0,1);return new de(Me,De)}class Lc{constructor(r,a,u){this.a=Qn([],r,u),this.b=Qn([],a,u),this.center=u;const h=Lt([],this.a),g=Lt([],this.b);this.angle=Math.acos(nr(h,g))}}function Ul(l,r){if(l.angle===0)return null;let a;return a=l.a[r]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[r]/l.a[r]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:function(u,h,g,y){const b=Math.sin(g);return u*(Math.sin((1-y)*g)/b)+h*(Math.sin(y*g)/b)}(l.a[r],l.b[r],l.angle,ne(a,0,1))+l.center[r]}function Fa(l){if(l.z<=1)return Vl[l.z+2*l.y+l.x];const r=J2(Ab(l));return rr.fromPoints(r)}function Gl(l,r,a){return $t(l,l,1-a),br(l,l,r,a)}function YR(l,r,a){for(const u of l)zr(u,u,r),$t(u,u,a)}function JR(l,r,a,u){const h=r/l.worldSize,g=l.globeMatrix;if(a.z<=1){const De=Fa(a).getCorners();return YR(De,g,h),rr.fromPoints(De)}const y=Ab(a,u),b=J2(y,Xo+ul(l._tileCoverLift));YR(b,g,h);const A=Number.MAX_VALUE,C=[-A,-A,-A],R=[A,A,A];if(y.contains(l.center)){for(const Ve of b)cr(R,R,Ve),Bt(C,C,Ve);C[2]=0;const De=l.point,nt=[De.x*h,De.y*h,0];return cr(R,R,nt),Bt(C,C,nt),new rr(R,C)}if(l._tileCoverLift>0){for(const De of b)cr(R,R,De),Bt(C,C,De);return new rr(R,C)}const k=[g[12]*h,g[13]*h,g[14]*h],L=y.getCenter(),$=ne(l.center.lat,-q,q),U=ne(L.lat,-q,q),Z=P(l.center.lng),re=O($);let te=Z-P(L.lng);const le=re-O(U);te>.5?te-=1:te<-.5&&(te+=1);let ue=0;Math.abs(te)>Math.abs(le)?ue=te>=0?1:3:(ue=le>=0?0:2,br(k,k,[g[4]*h,g[5]*h,g[6]*h],-Math.sin(Zr(le>=0?y.getSouth():y.getNorth()))*Xo));const pe=b[ue],Se=b[(ue+1)%4],_e=new Lc(pe,Se,k),Ee=[Ul(_e,0)||pe[0],Ul(_e,1)||pe[1],Ul(_e,2)||pe[2]],Me=Od(l.zoom);if(Me>0){const De=function({x:Ve,y:lt,z:ft},pt,xt,wt,yt){const _t=1/(1<<ft);let at=Ve*_t,ot=at+_t,vt=lt*_t,Ot=vt+_t,Et=0;const or=(at+ot)/2-wt;return or>.5?Et=-1:or<-.5&&(Et=1),at=((at+Et)*pt-(wt*=pt))*xt+wt,ot=((ot+Et)*pt-wt)*xt+wt,vt=(vt*pt-(yt*=pt))*xt+yt,Ot=(Ot*pt-yt)*xt+yt,[[at,Ot,0],[ot,Ot,0],[ot,vt,0],[at,vt,0]]}(a,r,l._pixelsPerMercatorPixel,Z,re);for(let Ve=0;Ve<b.length;Ve++)Gl(b[Ve],De[Ve],Me);const nt=ut([],De[ue],De[(ue+1)%4]);$t(nt,nt,.5),Gl(Ee,nt,Me)}for(const De of b)cr(R,R,De),Bt(C,C,De);return R[2]=Math.min(pe[2],Se[2]),cr(R,R,Ee),Bt(C,C,Ee),new rr(R,C)}function Ab({x:l,y:r,z:a},u=!1){const h=1/(1<<a),g=new c(F(l*h),r===(1<<a)-1&&u?-90:W((r+1)*h)),y=new c(F((l+1)*h),r===0&&u?90:W(r*h));return new m(g,y)}function J2(l,r=Xo){const a=Zr(l.getNorth()),u=Zr(l.getSouth()),h=Math.cos(a),g=Math.cos(u),y=Math.sin(a),b=Math.sin(u),A=l.getWest(),C=l.getEast();return[Cu(g,b,A,r),Cu(g,b,C,r),Cu(h,y,C,r),Cu(h,y,A,r)]}function j_(l,r,a,u){const h=1<<a.z,g=(l/Mt+a.x)/h;return Cd(W((r/Mt+a.y)/h),F(g),u)}function Eb({min:l,max:r}){return Y2/Math.max(r[0]-l[0],r[1]-l[1],r[2]-l[2])}const QR=new Float64Array(16);function Pb(l){const r=Eb(l),a=we(QR,[r,r,r]);return X(a,a,an([],l.min))}function Q2(l){const r=(u=l.min,(a=QR)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const h=1/Eb(l);return ie(r,r,[h,h,h])}function eA(l){const r=Mt/(2*Math.PI);return l/(2*Math.PI)/r}function ek(l,r){return Mt/(512*Math.pow(2,l))*Eb(Fa(r))}function tk(l,r,a,u,h){const g=eA(a),y=[l,r,-a/(2*Math.PI)],b=V(new Float64Array(16));return X(b,b,y),ie(b,b,[g,g,g]),J(b,b,Zr(-h)),se(b,b,Zr(-u)),b}function Od(l){return ce(pa,Tm,l)}function rk(l,r){const a=Cd(r.lat,r.lng),u=function(U){const Z=Cd(U._center.lat,U._center.lng);let re=pr([],Ge(0,1,0),Z);const te=ze([],-U.angle,Z);re=zr(re,re,te),ze(te,-U._pitch,re);const le=Lt([],Z);return $t(le,le,ul(U.cameraToCenterDistance/U.pixelsPerMeter)),zr(le,le,te),ut([],Z,le)}(l);return y=(h=rt([],u,a))[0],b=h[1],A=h[2],C=(g=a)[0],R=g[1],k=g[2],$=(L=Math.sqrt((y*y+b*b+A*A)*(C*C+R*R+k*k)))&&nr(h,g)/L,Math.acos(Math.min(Math.max($,-1),1));var h,g,y,b,A,C,R,k,L,$}function tA(l,r){return rk(l,r)>Math.PI/2*1.01}const nk=Zr(85),c7=Math.cos(nk),u7=Math.sin(nk),d7=G(),ik=l=>{const r=[];return l.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r};function ok(l,r,a,u,h,g,y,b,A){if(g&&l.queryGeometry.isAboveHorizon)return!1;g&&(A*=l.pixelToTileUnitsFactor);const C=l.tileID.canonical,R=a.projection.upVectorScale(C,a.center.lat,a.worldSize).metersToTile;for(const k of r)for(const L of k){const $=L.add(b),U=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt($.x,$.y,!0):0,Z=a.projection.projectTilePoint($.x,$.y,C);if(U>0){const ue=a.projection.upVector(C,$.x,$.y);Z.x+=ue[0]*R*U,Z.y+=ue[1]*R*U,Z.z+=ue[2]*R*U}const re=g?$:h7(Z.x,Z.y,Z.z,u),te=g?l.tilespaceRays.map(ue=>p7(ue,U)):l.queryGeometry.screenGeometry,le=Hi([],[Z.x,Z.y,Z.z,1],u);if(!y&&g?A*=le[3]/a.cameraToCenterDistance:y&&!g&&(A*=a.cameraToCenterDistance/le[3]),g){const ue=W((L.y/Mt+C.y)/(1<<C.z));A/=a.projection.pixelsPerMeter(ue,1)/D(1,ue)}if(Br(te,re,A))return!0}return!1}function h7(l,r,a,u){const h=Hi([],[l,r,a,1],u);return new mt(h[0]/h[3],h[1]/h[3])}const sk=Ge(0,0,0),f7=Ge(0,0,1);function p7(l,r){const a=qe();return sk[2]=r,l.intersectsPlane(sk,f7,a),new mt(a[0],a[1])}class ak extends jn{}let lk,ck,uk,dk;function hk(l,{width:r,height:a},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*u);return l.width=r,l.height=a,l.data=h,l}function fk(l,r,a){const{width:u,height:h}=r;u===l.width&&h===l.height||(rA(l,r,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,h)},a,null),l.width=u,l.height=h,l.data=r.data)}function rA(l,r,a,u,h,g,y,b){if(h.width===0||h.height===0)return r;if(h.width>l.width||h.height>l.height||a.x>l.width-h.width||a.y>l.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const A=l.data,C=r.data,R=g===4&&b;for(let k=0;k<h.height;k++){const L=((a.y+k)*l.width+a.x)*g,$=((u.y+k)*r.width+u.x)*g;if(R)for(let U=0;U<h.width;U++){const Z=L+U*g+3,re=$+U*g;C[re+0]=255,C[re+1]=255,C[re+2]=255,C[re+3]=A[Z]}else if(y)for(let U=0;U<h.width;U++){const Z=L+U*g,re=$+U*g,te=new kn(A[Z+0]/255,A[Z+1]/255,A[Z+2]/255,A[Z+3]).toNonPremultipliedRenderColor(y).toArray();C[re+0]=te[0],C[re+1]=te[1],C[re+2]=te[2],C[re+3]=te[3]}else for(let U=0;U<h.width*g;U++)C[$+U]=A[L+U]}return r}Yt(ak,"HeatmapBucket",{omit:["layers"]});class Rd{constructor(r,a){hk(this,r,1,a)}resize(r){fk(this,new Rd(r),1)}clone(){return new Rd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,h,g){rA(r,a,u,h,g,1,null)}}class Qo{constructor(r,a){hk(this,r,4,a)}resize(r){fk(this,new Qo(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,h,g,y,b){rA(r,a,u,h,g,4,y,b)}}class pk{constructor(r,a){this.width=r.width,this.height=r.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function D_(l){const r={},a=l.resolution||256,u=l.clips?l.clips.length:1,h=l.image||new Qo({width:a,height:u}),g=(y,b,A)=>{r[l.evaluationKey]=A;const C=l.expression.evaluate(r),R=C?C.toNonPremultipliedRenderColor(null):null;R&&(h.data[y+b+0]=Math.floor(255*R.r),h.data[y+b+1]=Math.floor(255*R.g),h.data[y+b+2]=Math.floor(255*R.b),h.data[y+b+3]=Math.floor(255*R.a))};if(l.clips)for(let y=0,b=0;y<u;++y,b+=4*a)for(let A=0,C=0;A<a;A++,C+=4){const R=A/(a-1),{start:k,end:L}=l.clips[y];g(b,C,k*(1-R)+L*R)}else for(let y=0,b=0;y<a;y++,b+=4)g(0,b,y/(a-1));return h}Yt(Rd,"AlphaImage"),Yt(Qo,"RGBAImage");const m7=Kr([{name:"a_pos",components:2,type:"Int16"}],4),g7=Kr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),y7=Kr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),_7=Kr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Am(l,r,a=2){const u=r&&r.length,h=u?r[0]*a:l.length;let g=mk(l,0,h,a,!0);const y=[];if(!g||g.next===g.prev)return y;let b,A,C;if(u&&(g=function(R,k,L,$){const U=[];for(let Z=0,re=k.length;Z<re;Z++){const te=mk(R,k[Z]*$,Z<re-1?k[Z+1]*$:R.length,$,!1);te===te.next&&(te.steiner=!0),U.push(E7(te))}U.sort(S7);for(let Z=0;Z<U.length;Z++)L=T7(U[Z],L);return L}(l,r,g,a)),l.length>80*a){b=l[0],A=l[1];let R=b,k=A;for(let L=a;L<h;L+=a){const $=l[L],U=l[L+1];$<b&&(b=$),U<A&&(A=U),$>R&&(R=$),U>k&&(k=U)}C=Math.max(R-b,k-A),C=C!==0?32767/C:0}return L_(g,y,a,b,A,C,0),y}function mk(l,r,a,u,h){let g;if(h===function(y,b,A,C){let R=0;for(let k=b,L=A-C;k<A;k+=C)R+=(y[L]-y[k])*(y[k+1]+y[L+1]),L=k;return R}(l,r,a,u)>0)for(let y=r;y<a;y+=u)g=vk(y/u|0,l[y],l[y+1],g);else for(let y=a-u;y>=r;y-=u)g=vk(y/u|0,l[y],l[y+1],g);return g&&Em(g,g.next)&&(F_(g),g=g.next),g}function Qh(l,r){if(!l)return l;r||(r=l);let a,u=l;do if(a=!1,u.steiner||!Em(u,u.next)&&Ro(u.prev,u,u.next)!==0)u=u.next;else{if(F_(u),u=r=u.prev,u===u.next)break;a=!0}while(a||u!==r);return r}function L_(l,r,a,u,h,g,y){if(!l)return;!y&&g&&function(A,C,R,k){let L=A;do L.z===0&&(L.z=nA(L.x,L.y,C,R,k)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==A);L.prevZ.nextZ=null,L.prevZ=null,function($){let U,Z=1;do{let re,te=$;$=null;let le=null;for(U=0;te;){U++;let ue=te,pe=0;for(let _e=0;_e<Z&&(pe++,ue=ue.nextZ,ue);_e++);let Se=Z;for(;pe>0||Se>0&&ue;)pe!==0&&(Se===0||!ue||te.z<=ue.z)?(re=te,te=te.nextZ,pe--):(re=ue,ue=ue.nextZ,Se--),le?le.nextZ=re:$=re,re.prevZ=le,le=re;te=ue}le.nextZ=null,Z*=2}while(U>1)}(L)}(l,u,h,g);let b=l;for(;l.prev!==l.next;){const A=l.prev,C=l.next;if(g?x7(l,u,h,g):v7(l))r.push(A.i,l.i,C.i),F_(l),l=C.next,b=C.next;else if((l=C)===b){y?y===1?L_(l=b7(Qh(l),r),r,a,u,h,g,2):y===2&&w7(l,r,a,u,h,g):L_(Qh(l),r,a,u,h,g,1);break}}}function v7(l){const r=l.prev,a=l,u=l.next;if(Ro(r,a,u)>=0)return!1;const h=r.x,g=a.x,y=u.x,b=r.y,A=a.y,C=u.y,R=Math.min(h,g,y),k=Math.min(b,A,C),L=Math.max(h,g,y),$=Math.max(b,A,C);let U=u.next;for(;U!==r;){if(U.x>=R&&U.x<=L&&U.y>=k&&U.y<=$&&N_(h,b,g,A,y,C,U.x,U.y)&&Ro(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function x7(l,r,a,u){const h=l.prev,g=l,y=l.next;if(Ro(h,g,y)>=0)return!1;const b=h.x,A=g.x,C=y.x,R=h.y,k=g.y,L=y.y,$=Math.min(b,A,C),U=Math.min(R,k,L),Z=Math.max(b,A,C),re=Math.max(R,k,L),te=nA($,U,r,a,u),le=nA(Z,re,r,a,u);let ue=l.prevZ,pe=l.nextZ;for(;ue&&ue.z>=te&&pe&&pe.z<=le;){if(ue.x>=$&&ue.x<=Z&&ue.y>=U&&ue.y<=re&&ue!==h&&ue!==y&&N_(b,R,A,k,C,L,ue.x,ue.y)&&Ro(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,pe.x>=$&&pe.x<=Z&&pe.y>=U&&pe.y<=re&&pe!==h&&pe!==y&&N_(b,R,A,k,C,L,pe.x,pe.y)&&Ro(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ue&&ue.z>=te;){if(ue.x>=$&&ue.x<=Z&&ue.y>=U&&ue.y<=re&&ue!==h&&ue!==y&&N_(b,R,A,k,C,L,ue.x,ue.y)&&Ro(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;pe&&pe.z<=le;){if(pe.x>=$&&pe.x<=Z&&pe.y>=U&&pe.y<=re&&pe!==h&&pe!==y&&N_(b,R,A,k,C,L,pe.x,pe.y)&&Ro(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function b7(l,r){let a=l;do{const u=a.prev,h=a.next.next;!Em(u,h)&&yk(u,a,a.next,h)&&z_(u,h)&&z_(h,u)&&(r.push(u.i,a.i,h.i),F_(a),F_(a.next),a=l=h),a=a.next}while(a!==l);return Qh(a)}function w7(l,r,a,u,h,g){let y=l;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&P7(y,b)){let A=_k(y,b);return y=Qh(y,y.next),A=Qh(A,A.next),L_(y,r,a,u,h,g,0),void L_(A,r,a,u,h,g,0)}b=b.next}y=y.next}while(y!==l)}function S7(l,r){let a=l.x-r.x;return a===0&&(a=l.y-r.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),a}function T7(l,r){const a=function(h,g){let y=g;const b=h.x,A=h.y;let C,R=-1/0;if(Em(h,y))return y;do{if(Em(h,y.next))return y.next;if(A<=y.y&&A>=y.next.y&&y.next.y!==y.y){const Z=y.x+(A-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(Z<=b&&Z>R&&(R=Z,C=y.x<y.next.x?y:y.next,Z===b))return C}y=y.next}while(y!==g);if(!C)return null;const k=C,L=C.x,$=C.y;let U=1/0;y=C;do{if(b>=y.x&&y.x>=L&&b!==y.x&&gk(A<$?b:R,A,L,$,A<$?R:b,A,y.x,y.y)){const Z=Math.abs(A-y.y)/(b-y.x);z_(y,h)&&(Z<U||Z===U&&(y.x>C.x||y.x===C.x&&A7(C,y)))&&(C=y,U=Z)}y=y.next}while(y!==k);return C}(l,r);if(!a)return r;const u=_k(a,l);return Qh(u,u.next),Qh(a,a.next)}function A7(l,r){return Ro(l.prev,l,r.prev)<0&&Ro(r.next,l,l.next)<0}function nA(l,r,a,u,h){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*h|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function E7(l){let r=l,a=l;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==l);return a}function gk(l,r,a,u,h,g,y,b){return(h-y)*(r-b)>=(l-y)*(g-b)&&(l-y)*(u-b)>=(a-y)*(r-b)&&(a-y)*(g-b)>=(h-y)*(u-b)}function N_(l,r,a,u,h,g,y,b){return!(l===y&&r===b)&&gk(l,r,a,u,h,g,y,b)}function P7(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!function(a,u){let h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==u.i&&h.next.i!==u.i&&yk(h,h.next,a,u))return!0;h=h.next}while(h!==a);return!1}(l,r)&&(z_(l,r)&&z_(r,l)&&function(a,u){let h=a,g=!1;const y=(a.x+u.x)/2,b=(a.y+u.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&y<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==a);return g}(l,r)&&(Ro(l.prev,l,r.prev)||Ro(l,r.prev,r))||Em(l,r)&&Ro(l.prev,l,l.next)>0&&Ro(r.prev,r,r.next)>0)}function Ro(l,r,a){return(r.y-l.y)*(a.x-r.x)-(r.x-l.x)*(a.y-r.y)}function Em(l,r){return l.x===r.x&&l.y===r.y}function yk(l,r,a,u){const h=Ib(Ro(l,r,a)),g=Ib(Ro(l,r,u)),y=Ib(Ro(a,u,l)),b=Ib(Ro(a,u,r));return h!==g&&y!==b||!(h!==0||!Cb(l,a,r))||!(g!==0||!Cb(l,u,r))||!(y!==0||!Cb(a,l,u))||!(b!==0||!Cb(a,r,u))}function Cb(l,r,a){return r.x<=Math.max(l.x,a.x)&&r.x>=Math.min(l.x,a.x)&&r.y<=Math.max(l.y,a.y)&&r.y>=Math.min(l.y,a.y)}function Ib(l){return l>0?1:l<0?-1:0}function z_(l,r){return Ro(l.prev,l,l.next)<0?Ro(l,r,l.next)>=0&&Ro(l,l.prev,r)>=0:Ro(l,r,l.prev)<0||Ro(l,l.next,r)<0}function _k(l,r){const a=iA(l.i,l.x,l.y),u=iA(r.i,r.x,r.y),h=l.next,g=r.prev;return l.next=r,r.prev=l,a.next=h,h.prev=a,u.next=a,a.prev=u,g.next=u,u.prev=g,u}function vk(l,r,a,u){const h=iA(l,r,a);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function F_(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function iA(l,r,a){return{i:l,x:r,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function B_(l,r){const a=l.length;if(a<=1)return[l];const u=[];let h,g;for(let y=0;y<a;y++){const b=Lr(l[y]);b!==0&&(l[y].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(h&&u.push(h),h=[l[y]]):h.push(l[y]))}if(h&&u.push(h),r>1)for(let y=0;y<u.length;y++)u[y].length<=r||(Sp(u[y],r,1,u[y].length-1,C7),u[y]=u[y].slice(0,r));return u}function C7(l,r){return r.area-l.area}function xk(l,r,a=1){if(!l)return null;const u=typeof l=="string"?_s.from(l).getPrimary():l.getPrimary(),h=typeof l=="string"?null:l.getSecondary();for(const g of[u,h]){if(!g)continue;const y=g.id.toString();r.has(y)||r.set(y,[]),g.scaleSelf(a),r.get(y).push(g)}return{primary:u.toString(),secondary:h?h.toString():null}}function oA(l,r,a,u){const h=u.patternDependencies;let g=!1;for(const y of r){const b=y.paint.get(`${l}-pattern`);b.isConstant()||(g=!0),xk(b.constantOr(null),h,a)&&(g=!0)}return g}function sA(l,r,a,u,h,g){const y=g.patternDependencies;for(const b of r){const A=b.paint.get(`${l}-pattern`).value;if(A.kind!=="constant"){let C=A.evaluate({zoom:u},a,{},g.availableImages);C=C&&C.name?C.name:C;const R=xk(C,y,h);if(!R)continue;const{primary:k,secondary:L}=R;k&&(a.patterns[b.id]=[k,L].filter(Boolean))}}return a}class bk{constructor(){this.polygons=new Map}add(r,...a){const u=this.polygons.get(r);u?u.push(...a):this.polygons.set(r,a)}merge(r){for(const[a,u]of r.polygons)this.add(a,...u)}}class Iu{constructor(){this.portals=[]}static isOnBorder(r,a){return r<=0&&a<=0||r>=Mt&&a>=Mt}static evaluate(r){if(r.length===0)return new Iu;let a=[];for(const A of r)a.push(...A.portals);if(a.length===0)return new Iu;for(const A of a){const C=A.va,R=A.vb;(Iu.isOnBorder(C.x,R.x)||Iu.isOnBorder(C.y,R.y))&&(A.type="border")}const u=a.filter(A=>A.type!=="unevaluated"),h=a.filter(A=>A.type==="unevaluated");if(h.length===0)return new Iu;h.sort((A,C)=>A.hash===C.hash?A.isTunnel===C.isTunnel?0:A.isTunnel?-1:1:A.hash<C.hash?1:-1),a=u.concat(h);let g=u.length,y=g,b=g;do if(y++,y===a.length||a[g].hash!==a[y].hash){if(y-g==2){b<g&&(a[b]=a[g],a[g]=null);const A=a[b],C=a[y-1];A.type=A.isTunnel!==C.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:C.connection.a},b++}g=y}while(g!==a.length);return a.splice(b),a.sort((A,C)=>A.hash<C.hash?1:-1),{portals:a}}}Yt(Iu,"ElevationPortalGraph"),Yt(bk,"ElevationPolygons");class I7{constructor(r,a,u){this.outPositions=r,this.outNormals=a,this.outIndices=u,this.vertexLookup=new Map}addVertex(r,a,u){let h=r[2];u!=null&&(h*=u);const g=`${r[0]},${r[1]},${r[2]},${a[0]},${a[1]},${a[2]}`,y=this.vertexLookup.get(g);if(y!=null)return y;const b=this.outPositions.length;this.vertexLookup.set(g,b);const A=Math.trunc(16384*a[0]),C=Math.trunc(16384*a[1]),R=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(r[0],r[1],h),this.outNormals.emplaceBack(A,C,R),b}addTriangle(r,a,u){this.outIndices.emplaceBack(r,a,u)}addTriangles(r,a,u){if(r.length===0)return;const h=u.length===1,g=qe(),y=qe();for(let b=0;b<r.length;b+=3){const A=a[r[b+0]],C=a[r[b+1]],R=a[r[b+2]],k=h?u[0]:u[r[b+1]],L=h?u[0]:u[r[b+2]];Ke(g,A.x,A.y,h?u[0]:u[r[b+0]]);const $=this.addVertex(g,y);Ke(g,C.x,C.y,k);const U=this.addVertex(g,y);Ke(g,R.x,R.y,L);const Z=this.addVertex(g,y);this.outIndices.emplaceBack($,U,Z)}}addQuad(r,a,u,h,g,y){const b=this.addVertex(r,g,y),A=this.addVertex(a,g,y),C=this.addVertex(u,g,y),R=this.addVertex(h,g,y);this.addTriangle(b,A,C),this.addTriangle(C,R,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ea{constructor(r,a,u,h){this.unevaluatedPortals=new Iu,this.portalPolygons=new bk,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new p_,this.vertexNormals=new m_,this.indexArray=new to,this.tileToMeters=oe(r),this.bridgeProgramConfigurations=new Na(a,{zoom:u,lut:h},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Na(a,{zoom:u,lut:h},g=>g!=="fill-bridge-guard-rail-color")}addVertices(r,a){const u=this.unevalVertices.length;for(let h=0;h<r.length;h++)this.unevalVertices.push(r[h]),this.unevalHeights.push(a[h]);return u}addTriangles(r,a,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of r)h.push(g+a)}addRenderableRing(r,a,u,h,g,y){const b=[new mt(g.min.x,g.min.y),new mt(g.max.x,g.min.y),new mt(g.max.x,g.max.y),new mt(g.min.x,g.max.y)];for(let A=0;A<u-1;A++){const C=a+A,R=C+1,k=this.unevalVertices[C],L=this.unevalVertices[R];if(!(k.x>=g.min.x&&k.x<=g.max.x&&k.y>=g.min.y&&k.y<=g.max.y||L.x>=g.min.x&&L.x<=g.max.x&&L.y>=g.min.y&&L.y<=g.max.y||Ho(k,L,b))||this.isOnBorder(k.x,L.x)||this.isOnBorder(k.y,L.y))continue;const $=ea.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[R]);let U,Z=this.vertexHashLookup.get(ea.computePosHash(k));Z!=null?U=Z.next:(Z=this.vertexHashLookup.get(ea.computePosHash(L)),U=Z!=null?Z.prev:$),this.unevalEdges.push({polygonIdx:r,a:C,b:R,hash:$,portalHash:U,isTunnel:h,type:"unevaluated",featureInfo:y})}}addPortalCandidates(r,a,u,h,g){if(a.length===0)return;this.portalPolygons.add(r,{geometry:a,zLevel:g});const y=a[0];this.vertexHashLookup.clear();let b=ea.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let A=0;A<y.length-1;A++){const C=y[A+0],R=y[A+1],k=Ir(R.x-C.x,R.y-C.y),L=Lo(k);if(L===0)continue;let $="unevaluated";const U=h.pointElevation(C),Z=h.pointElevation(R);Math.abs(U)<.01&&Math.abs(Z)<.01?$="entrance":(this.isOnBorder(C.x,R.x)||this.isOnBorder(C.y,R.y))&&($="border");const re=ea.computeEdgeHash(C,R);this.unevaluatedPortals.portals.push({connection:{a:r,b:void 0},va:C,vb:R,vab:k,length:L,hash:re,isTunnel:u,type:$});const te=ea.computePosHash(C);this.vertexHashLookup.set(te,{prev:b,next:re}),b=re}}construct(r){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},h=new I7(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(r.portals,this.unevalEdges);const g=a(),y=a(),b=a(),A=(L,$)=>{L.sort((Z,re)=>Z.type===$&&re.type!==$?-1:Z.type!==$&&re.type===$?1:0);const U=L.findIndex(Z=>Z.type!==$);return U>=0?U:L.length};let C=0;this.unevalEdges.length>0&&(C=A(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),u(b);const R=a(),k=a();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(C),$=A(L,"tunnel")+C;this.unevalEdges.push(...L),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:$})}u(R),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(k),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=_i.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.depthSegments=_i.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=_i.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=_i.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.shadowCasterSegments=_i.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(r,a,u,h,g,y,b,A){this.bridgeProgramConfigurations.updatePaintArrays(r,a,g,u,h,y,b,A),this.tunnelProgramConfigurations.updatePaintArrays(r,a,g,u,h,y,b,A)}upload(r){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=r.createVertexBuffer(this.vertexPositions,y7.members),this.vertexBufferNormal=r.createVertexBuffer(this.vertexNormals,_7.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(r),this.tunnelProgramConfigurations.upload(r))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(r,a,u,h,g){const y=(b,A)=>{for(let C=0;C<A.length-1;C++){const R=A[C].featureIndex,k=A[C+1].vertexStart,L=r.feature(R);b.populatePaintArrays(k,L,R,{},u,a,h,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(r,a,u,h,g){const y=new Map;for(let b=h;b<g;b++){const A=u[b],C=A.a,R=A.b,k=ea.computePosHash(r[C]),L=ea.computePosHash(r[R]);let $=y.get(k);$||($={},y.set(k,$));let U=y.get(L);U||(U={},y.set(L,U)),a[C]<=0&&a[R]<=0||($.to=R,U.from=C)}return y}isTerminalVertex(r,a){const u=ea.computePosHash(this.unevalVertices[r]),h=a.get(u);return!h||!h.from||!h.to}constructBridgeStructures(r,a,u,h,g,y){r.clearVertexLookup();const b=this.computeVertexConnections(a,u,h,g.min,g.max),A=1/y,C=.5*A,R=(xt,wt)=>Ke(xt,a[wt].x,a[wt].y,u[wt]*A),k=qe(),L=qe(),$=qe(),U=qe(),Z=qe(),re=(xt,wt)=>{const yt=b.get(ea.computePosHash(a[wt])),_t=yt.from,at=yt.to;if(!_t||!at)return;R(k,_t),R(L,wt),R($,at),Hn(U),zn(k,L)||(Qn(Z,L,k),Lt(U,Z)),zn($,L)||(Qn(Z,$,L),ut(U,U,Lt(Z,Z)));const ot=gs(U);return ot>0?$t(xt,U,1/ot):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(h,g.min,g.max,(xt,wt)=>xt.featureInfo.featureIndex-wt.featureInfo.featureIndex);const le=qe(),ue=qe(),pe=qe(),Se=qe(),_e=qe(),Ee=qe(),Me=qe(),De=qe(),nt=qe(),Ve=[qe(),qe(),qe(),qe()],lt=[qe(),qe(),qe(),qe()],ft=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],pt=(xt,wt)=>xt>wt;for(let xt=g.min;xt<g.max;xt++){const wt=h[xt];if(!wt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ft,a,u,wt,pt))continue;const[yt,_t]=ft;if(Ke(le,yt.coord.x,yt.coord.y,A*yt.height),Ke(ue,_t.coord.x,_t.coord.y,A*_t.height),zn(le,ue))continue;Qn(pe,ue,le),Lt(pe,pe);const at=re(De,wt.a)||pe,ot=re(nt,wt.b)||pe;Ke(Se,at[1],-at[0],0),Lt(Se,Se),Ke(_e,ot[1],-ot[0],0),Lt(_e,_e),pr(De,Se,at),Lt(Ee,De),pr(De,_e,ot),Lt(Me,De),ut(Ve[0],le,$t(De,Qn(De,Se,Ee),C)),ut(Ve[1],le,$t(De,ut(De,Se,Ee),C)),ut(Ve[2],le,$t(De,Ee,C)),Ve[3]=le,ut(lt[0],ue,$t(De,Qn(De,_e,Me),C)),ut(lt[1],ue,$t(De,ut(De,_e,Me),C)),ut(lt[2],ue,$t(De,Me,C)),lt[3]=ue,te=this.addFeatureSection(wt.featureInfo.featureIndex,te,this.bridgeFeatureSections,r);const vt=r.addVertex(Ve[0],Se,y),Ot=r.addVertex(Ve[1],Se,y),Et=r.addVertex(lt[0],_e,y),or=r.addVertex(lt[1],_e,y);r.addTriangle(vt,Ot,Et),r.addTriangle(Ot,or,Et);const Ft=r.addVertex(Ve[1],Ee,y),Ht=r.addVertex(Ve[2],Ee,y),Qt=r.addVertex(lt[1],Me,y),Hr=r.addVertex(lt[2],Me,y);r.addTriangle(Ft,Ht,Qt),r.addTriangle(Ht,Hr,Qt),an(Se,Se),an(_e,_e);const Pt=r.addVertex(Ve[2],Se,y),er=r.addVertex(Ve[3],Se,y),Cr=r.addVertex(lt[2],_e,y),en=r.addVertex(lt[3],_e,y);r.addTriangle(Pt,er,Cr),r.addTriangle(er,en,Cr);const sn=this.isTerminalVertex(wt.a,b),Dr=this.isTerminalVertex(wt.b,b);yt.height<.01&&sn&&r.addQuad(Ve[3],Ve[2],Ve[1],Ve[0],an(at,at),y),_t.height<.01&&Dr&&r.addQuad(lt[0],lt[1],lt[2],lt[3],ot,y)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}constructTunnelStructures(r,a,u,h,g,y){r.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const A=(te,le)=>te.featureInfo.featureIndex-le.featureInfo.featureIndex;this.sortSubarray(h,g.min,g.max,A),this.sortSubarray(h,y.min,y.max,A);const C=te=>Lt(te,te),R=[{coord:new mt(0,0),height:0},{coord:new mt(0,0),height:0}],k=(te,le)=>te<le,L=qe(),$=qe(),U=qe(),Z=qe(),re=qe();for(let te=g.min;te<g.max;te++){if(!this.prepareEdgePoints(R,a,u,h[te],k))continue;const[le,ue]=R,pe=C(Ke(re,-(ue.coord.y-le.coord.y),ue.coord.x-le.coord.x,0));b=this.addFeatureSection(h[te].featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(Ke(L,le.coord.x,le.coord.y,le.height),Ke($,ue.coord.x,ue.coord.y,ue.height),Ke(U,ue.coord.x,ue.coord.y,h[te].isTunnel?-.1:0),Ke(Z,le.coord.x,le.coord.y,h[te].isTunnel?-.1:0),pe)}for(let te=y.min;te<y.max;te++){const le=h[te];le.isTunnel&&([le.a,le.b]=[le.b,le.a]);const ue=a[le.a],pe=a[le.b],Se=C(Ke(re,-(pe.y-ue.y),pe.x-ue.x,0));b=this.addFeatureSection(le.featureInfo.featureIndex,b,this.tunnelFeatureSections,r),r.addQuad(Ke(L,pe.x,pe.y,0),Ke($,ue.x,ue.y,0),Ke(U,ue.x,ue.y,u[le.a]+4),Ke(Z,pe.x,pe.y,u[le.b]+4),Se),r.addQuad(Ke(L,ue.x,ue.y,0),Ke($,pe.x,pe.y,0),Ke(U,pe.x,pe.y,u[le.b]+4),Ke(Z,ue.x,ue.y,u[le.a]+4),Se)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:r.getVertexCount()})}setElevatedPoint(r,a,u,h){r.coord.x=a,r.coord.y=u,r.height=h}prepareEdgePoints(r,a,u,h,g){let y=a[h.a].x,b=a[h.a].y,A=a[h.b].x,C=a[h.b].y,R=u[h.a],k=u[h.b];const L=g(R,0),$=g(k,0);if(L&&$)return this.setElevatedPoint(r[0],y,b,R),this.setElevatedPoint(r[1],A,C,k),!0;if(!L&&!$)return!1;if(L){if(!$){const U=k/(k-R);A=xr(A,y,U),C=xr(C,b,U),k=xr(k,R,U)}}else{const U=R/(R-k);y=xr(y,A,U),b=xr(b,C,U),R=xr(R,k,U)}return this.setElevatedPoint(r[0],y,b,R),this.setElevatedPoint(r[1],A,C,k),!0}prepareEdges(r,a){if(a.length===0)return;a.sort((b,A)=>b.hash===A.hash?A.polygonIdx-b.polygonIdx:A.hash>b.hash?1:-1);let u=0,h=0,g=0,y=a[u].polygonIdx;do h++,(h===a.length||a[u].hash!==a[h].hash)&&((h-u==1||a[h-1].polygonIdx!==y)&&(g<u&&(a[g]=a[u],a[u]=null),a[g].type="none",g++),u=h,u!==a.length&&(y=a[u].polygonIdx));while(u!==a.length);if(a.splice(g),a.length!==0&&r.length!==0){a.sort((C,R)=>C.portalHash<R.portalHash?1:-1);let b=0,A=0;for(;b!==a.length&&A!==r.length;){const C=a[b],R=r[A];C.portalHash>R.hash?b++:R.hash>C.portalHash?A++:(C.type=R.type,b++)}}}isOnBorder(r,a){return r<=0&&a<=0||r>=Mt&&a>=Mt}addFeatureSection(r,a,u,h){return r!==a&&(a=r,u.push({featureIndex:r,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),a}sortSubarray(r,a,u,h){const g=r.slice(a,u);g.sort(h),r.splice(a,g.length,...g)}static computeEdgeHash(r,a){return(r.y===a.y&&r.x>a.x||r.y>a.y)&&([r,a]=[a,r]),BigInt(ea.computePosHash(r))<<32n|BigInt(ea.computePosHash(a))}static computePosHash(r){return((65535&r.x)<<16|65535&r.y)>>>0}}var wk,Sk={exports:{}},Tk=(wk||(wk=1,function(l){function r(ve,Te){return ve>Te?1:ve<Te?-1:0}var a=function(ve,Te){ve===void 0&&(ve=r),Te===void 0&&(Te=!1),this._compare=ve,this._root=null,this._size=0,this._noDuplicates=!!Te},u={size:{configurable:!0}};function h(ve,Te,ct,bt,jt){var Dt=jt-bt;if(Dt>0){var sr=bt+Math.floor(Dt/2),ur={key:Te[sr],data:ct[sr],parent:ve};return ur.left=h(ur,Te,ct,bt,sr),ur.right=h(ur,Te,ct,sr+1,jt),ur}return null}function g(ve,Te,ct,bt,jt){if(!(ct>=bt)){for(var Dt=ve[ct+bt>>1],sr=ct-1,ur=bt+1;;){do sr++;while(jt(ve[sr],Dt)<0);do ur--;while(jt(ve[ur],Dt)>0);if(sr>=ur)break;var Rr=ve[sr];ve[sr]=ve[ur],ve[ur]=Rr,Rr=Te[sr],Te[sr]=Te[ur],Te[ur]=Rr}g(ve,Te,ct,ur,jt),g(ve,Te,ur+1,bt,jt)}}a.prototype.rotateLeft=function(ve){var Te=ve.right;Te&&(ve.right=Te.left,Te.left&&(Te.left.parent=ve),Te.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.left=ve),ve.parent=Te},a.prototype.rotateRight=function(ve){var Te=ve.left;Te&&(ve.left=Te.right,Te.right&&(Te.right.parent=ve),Te.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.right=ve),ve.parent=Te},a.prototype._splay=function(ve){for(;ve.parent;){var Te=ve.parent;Te.parent?Te.left===ve&&Te.parent.left===Te?(this.rotateRight(Te.parent),this.rotateRight(Te)):Te.right===ve&&Te.parent.right===Te?(this.rotateLeft(Te.parent),this.rotateLeft(Te)):Te.left===ve&&Te.parent.right===Te?(this.rotateRight(Te),this.rotateLeft(Te)):(this.rotateLeft(Te),this.rotateRight(Te)):Te.left===ve?this.rotateRight(Te):this.rotateLeft(Te)}},a.prototype.splay=function(ve){for(var Te,ct,bt,jt,Dt;ve.parent;)(ct=(Te=ve.parent).parent)&&ct.parent?((bt=ct.parent).left===ct?bt.left=ve:bt.right=ve,ve.parent=bt):(ve.parent=null,this._root=ve),jt=ve.left,Dt=ve.right,ve===Te.left?(ct&&(ct.left===Te?(Te.right?(ct.left=Te.right,ct.left.parent=ct):ct.left=null,Te.right=ct,ct.parent=Te):(jt?(ct.right=jt,jt.parent=ct):ct.right=null,ve.left=ct,ct.parent=ve)),Dt?(Te.left=Dt,Dt.parent=Te):Te.left=null,ve.right=Te,Te.parent=ve):(ct&&(ct.right===Te?(Te.left?(ct.right=Te.left,ct.right.parent=ct):ct.right=null,Te.left=ct,ct.parent=Te):(Dt?(ct.left=Dt,Dt.parent=ct):ct.left=null,ve.right=ct,ct.parent=ve)),jt?(Te.right=jt,jt.parent=Te):Te.right=null,ve.left=Te,Te.parent=ve)},a.prototype.replace=function(ve,Te){ve.parent?ve===ve.parent.left?ve.parent.left=Te:ve.parent.right=Te:this._root=Te,Te&&(Te.parent=ve.parent)},a.prototype.minNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},a.prototype.maxNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},a.prototype.insert=function(ve,Te){var ct=this._root,bt=null,jt=this._compare;if(this._noDuplicates)for(;ct;){if(bt=ct,jt(ct.key,ve)===0)return;ct=jt(ct.key,ve)<0?ct.right:ct.left}else for(;ct;)bt=ct,ct=jt(ct.key,ve)<0?ct.right:ct.left;return ct={key:ve,data:Te,left:null,right:null,parent:bt},bt?jt(bt.key,ct.key)<0?bt.right=ct:bt.left=ct:this._root=ct,this.splay(ct),this._size++,ct},a.prototype.find=function(ve){for(var Te=this._root,ct=this._compare;Te;){var bt=ct(Te.key,ve);if(bt<0)Te=Te.right;else{if(!(bt>0))return Te;Te=Te.left}}return null},a.prototype.contains=function(ve){for(var Te=this._root,ct=this._compare;Te;){var bt=ct(ve,Te.key);if(bt===0)return!0;Te=bt<0?Te.left:Te.right}return!1},a.prototype.remove=function(ve){var Te=this.find(ve);if(!Te)return!1;if(this.splay(Te),Te.left)if(Te.right){var ct=this.minNode(Te.right);ct.parent!==Te&&(this.replace(ct,ct.right),ct.right=Te.right,ct.right.parent=ct),this.replace(Te,ct),ct.left=Te.left,ct.left.parent=ct}else this.replace(Te,Te.left);else this.replace(Te,Te.right);return this._size--,!0},a.prototype.removeNode=function(ve){if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var Te=this.minNode(ve.right);Te.parent!==ve&&(this.replace(Te,Te.right),Te.right=ve.right,Te.right.parent=Te),this.replace(ve,Te),Te.left=ve.left,Te.left.parent=Te}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},a.prototype.erase=function(ve){var Te=this.find(ve);if(Te){this.splay(Te);var ct=Te.left,bt=Te.right,jt=null;ct&&(ct.parent=null,jt=this.maxNode(ct),this.splay(jt),this._root=jt),bt&&(ct?jt.right=bt:this._root=bt,bt.parent=jt),this._size--}},a.prototype.pop=function(){var ve=this._root,Te=null;if(ve){for(;ve.left;)ve=ve.left;Te={key:ve.key,data:ve.data},this.remove(ve.key)}return Te},a.prototype.next=function(ve){var Te=ve;if(Te)if(Te.right)for(Te=Te.right;Te&&Te.left;)Te=Te.left;else for(Te=ve.parent;Te&&Te.right===ve;)ve=Te,Te=Te.parent;return Te},a.prototype.prev=function(ve){var Te=ve;if(Te)if(Te.left)for(Te=Te.left;Te&&Te.right;)Te=Te.right;else for(Te=ve.parent;Te&&Te.left===ve;)ve=Te,Te=Te.parent;return Te},a.prototype.forEach=function(ve){for(var Te=this._root,ct=[],bt=!1,jt=0;!bt;)Te?(ct.push(Te),Te=Te.left):ct.length>0?(ve(Te=ct.pop(),jt++),Te=Te.right):bt=!0;return this},a.prototype.range=function(ve,Te,ct,bt){for(var jt=[],Dt=this._compare,sr=this._root;jt.length!==0||sr;)if(sr)jt.push(sr),sr=sr.left;else{if(Dt((sr=jt.pop()).key,Te)>0)break;if(Dt(sr.key,ve)>=0&&ct.call(bt,sr))return this;sr=sr.right}return this},a.prototype.keys=function(){for(var ve=this._root,Te=[],ct=[],bt=!1;!bt;)ve?(Te.push(ve),ve=ve.left):Te.length>0?(ve=Te.pop(),ct.push(ve.key),ve=ve.right):bt=!0;return ct},a.prototype.values=function(){for(var ve=this._root,Te=[],ct=[],bt=!1;!bt;)ve?(Te.push(ve),ve=ve.left):Te.length>0?(ve=Te.pop(),ct.push(ve.data),ve=ve.right):bt=!0;return ct},a.prototype.at=function(ve){for(var Te=this._root,ct=[],bt=!1,jt=0;!bt;)if(Te)ct.push(Te),Te=Te.left;else if(ct.length>0){if(Te=ct.pop(),jt===ve)return Te;jt++,Te=Te.right}else bt=!0;return null},a.prototype.load=function(ve,Te,ct){if(ve===void 0&&(ve=[]),Te===void 0&&(Te=[]),ct===void 0&&(ct=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bt=ve.length;return ct&&g(ve,Te,0,bt-1,this._compare),this._root=h(null,ve,Te,0,bt),this._size=bt,this},a.prototype.min=function(){var ve=this.minNode(this._root);return ve?ve.key:null},a.prototype.max=function(){var ve=this.maxNode(this._root);return ve?ve.key:null},a.prototype.isEmpty=function(){return this._root===null},u.size.get=function(){return this._size},a.createTree=function(ve,Te,ct,bt,jt){return new a(ct,jt).load(ve,Te,bt)},Object.defineProperties(a.prototype,u);var y=0,b=1,A=2,C=3,R=0,k=1,L=2,$=3;function U(ve,Te,ct){Te===null?(ve.inOut=!1,ve.otherInOut=!0):(ve.isSubject===Te.isSubject?(ve.inOut=!Te.inOut,ve.otherInOut=Te.otherInOut):(ve.inOut=!Te.otherInOut,ve.otherInOut=Te.isVertical()?!Te.inOut:Te.inOut),Te&&(ve.prevInResult=!Z(Te,ct)||Te.isVertical()?Te.prevInResult:Te));var bt=Z(ve,ct);ve.resultTransition=bt?function(jt,Dt){var sr,ur=!jt.inOut,Rr=!jt.otherInOut;switch(Dt){case R:sr=ur&&Rr;break;case k:sr=ur||Rr;break;case $:sr=ur^Rr;break;case L:sr=jt.isSubject?ur&&!Rr:Rr&&!ur}return sr?1:-1}(ve,ct):0}function Z(ve,Te){switch(ve.type){case y:switch(Te){case R:return!ve.otherInOut;case k:return ve.otherInOut;case L:return ve.isSubject&&ve.otherInOut||!ve.isSubject&&!ve.otherInOut;case $:return!0}break;case A:return Te===R||Te===k;case C:return Te===L;case b:return!1}return!1}var re=function(ve,Te,ct,bt,jt){this.left=Te,this.point=ve,this.otherEvent=ct,this.isSubject=bt,this.type=jt||y,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},te={inResult:{configurable:!0}};function le(ve,Te){return ve[0]===Te[0]&&ve[1]===Te[1]}re.prototype.isBelow=function(ve){var Te=this.point,ct=this.otherEvent.point;return this.left?(Te[0]-ve[0])*(ct[1]-ve[1])-(ct[0]-ve[0])*(Te[1]-ve[1])>0:(ct[0]-ve[0])*(Te[1]-ve[1])-(Te[0]-ve[0])*(ct[1]-ve[1])>0},re.prototype.isAbove=function(ve){return!this.isBelow(ve)},re.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},te.inResult.get=function(){return this.resultTransition!==0},re.prototype.clone=function(){var ve=new re(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ve.contourId=this.contourId,ve.resultTransition=this.resultTransition,ve.prevInResult=this.prevInResult,ve.isExteriorRing=this.isExteriorRing,ve.inOut=this.inOut,ve.otherInOut=this.otherInOut,ve},Object.defineProperties(re.prototype,te);var ue=11102230246251565e-32,pe=134217729,Se=(3+8*ue)*ue;function _e(ve,Te,ct,bt,jt){var Dt,sr,ur,Rr,Vr=Te[0],Gr=bt[0],Xr=0,_r=0;Gr>Vr==Gr>-Vr?(Dt=Vr,Vr=Te[++Xr]):(Dt=Gr,Gr=bt[++_r]);var Er=0;if(Xr<ve&&_r<ct)for(Gr>Vr==Gr>-Vr?(ur=Dt-((sr=Vr+Dt)-Vr),Vr=Te[++Xr]):(ur=Dt-((sr=Gr+Dt)-Gr),Gr=bt[++_r]),Dt=sr,ur!==0&&(jt[Er++]=ur);Xr<ve&&_r<ct;)Gr>Vr==Gr>-Vr?(ur=Dt-((sr=Dt+Vr)-(Rr=sr-Dt))+(Vr-Rr),Vr=Te[++Xr]):(ur=Dt-((sr=Dt+Gr)-(Rr=sr-Dt))+(Gr-Rr),Gr=bt[++_r]),Dt=sr,ur!==0&&(jt[Er++]=ur);for(;Xr<ve;)ur=Dt-((sr=Dt+Vr)-(Rr=sr-Dt))+(Vr-Rr),Vr=Te[++Xr],Dt=sr,ur!==0&&(jt[Er++]=ur);for(;_r<ct;)ur=Dt-((sr=Dt+Gr)-(Rr=sr-Dt))+(Gr-Rr),Gr=bt[++_r],Dt=sr,ur!==0&&(jt[Er++]=ur);return Dt===0&&Er!==0||(jt[Er++]=Dt),Er}function Ee(ve){return new Float64Array(ve)}var Me=33306690738754716e-32,De=22204460492503146e-32,nt=11093356479670487e-47,Ve=Ee(4),lt=Ee(8),ft=Ee(12),pt=Ee(16),xt=Ee(4);function wt(ve,Te,ct){var bt=function(jt,Dt,sr,ur,Rr,Vr){var Gr=(Dt-Vr)*(sr-Rr),Xr=(jt-Rr)*(ur-Vr),_r=Gr-Xr;if(Gr===0||Xr===0||Gr>0!=Xr>0)return _r;var Er=Math.abs(Gr+Xr);return Math.abs(_r)>=Me*Er?_r:-function(pn,xn,bn,Dn,Yn,Gn,Sn){var In,Ur,tn,yi,gr,Yr,Wn,ri,ai,Fi,ii,yr,bi,Ln,mi,io,Eo,Zi,Ki=pn-Yn,fo=bn-Yn,js=xn-Gn,oi=Dn-Gn;Ve[0]=(mi=(ri=Ki-(Wn=(Yr=pe*Ki)-(Yr-Ki)))*(Fi=oi-(ai=(Yr=pe*oi)-(Yr-oi)))-((Ln=Ki*oi)-Wn*ai-ri*ai-Wn*Fi))-((ii=mi-(Eo=(ri=js-(Wn=(Yr=pe*js)-(Yr-js)))*(Fi=fo-(ai=(Yr=pe*fo)-(Yr-fo)))-((io=js*fo)-Wn*ai-ri*ai-Wn*Fi)))+(gr=mi-ii))+(gr-Eo),Ve[1]=(bi=Ln-((yr=Ln+ii)-(gr=yr-Ln))+(ii-gr))-((ii=bi-io)+(gr=bi-ii))+(gr-io),Ve[2]=yr-((Zi=yr+ii)-(gr=Zi-yr))+(ii-gr),Ve[3]=Zi;var ji=function(Fc,Wo){for(var Ss=Wo[0],ra=1;ra<4;ra++)Ss+=Wo[ra];return Ss}(0,Ve),Bi=De*Sn;if(ji>=Bi||-ji>=Bi||(In=pn-(Ki+(gr=pn-Ki))+(gr-Yn),tn=bn-(fo+(gr=bn-fo))+(gr-Yn),Ur=xn-(js+(gr=xn-js))+(gr-Gn),yi=Dn-(oi+(gr=Dn-oi))+(gr-Gn),In===0&&Ur===0&&tn===0&&yi===0)||(Bi=nt*Sn+Se*Math.abs(ji),(ji+=Ki*yi+oi*In-(js*tn+fo*Ur))>=Bi||-ji>=Bi))return ji;xt[0]=(mi=(ri=In-(Wn=(Yr=pe*In)-(Yr-In)))*(Fi=oi-(ai=(Yr=pe*oi)-(Yr-oi)))-((Ln=In*oi)-Wn*ai-ri*ai-Wn*Fi))-((ii=mi-(Eo=(ri=Ur-(Wn=(Yr=pe*Ur)-(Yr-Ur)))*(Fi=fo-(ai=(Yr=pe*fo)-(Yr-fo)))-((io=Ur*fo)-Wn*ai-ri*ai-Wn*Fi)))+(gr=mi-ii))+(gr-Eo),xt[1]=(bi=Ln-((yr=Ln+ii)-(gr=yr-Ln))+(ii-gr))-((ii=bi-io)+(gr=bi-ii))+(gr-io),xt[2]=yr-((Zi=yr+ii)-(gr=Zi-yr))+(ii-gr),xt[3]=Zi;var Vs=_e(4,Ve,4,xt,lt);xt[0]=(mi=(ri=Ki-(Wn=(Yr=pe*Ki)-(Yr-Ki)))*(Fi=yi-(ai=(Yr=pe*yi)-(Yr-yi)))-((Ln=Ki*yi)-Wn*ai-ri*ai-Wn*Fi))-((ii=mi-(Eo=(ri=js-(Wn=(Yr=pe*js)-(Yr-js)))*(Fi=tn-(ai=(Yr=pe*tn)-(Yr-tn)))-((io=js*tn)-Wn*ai-ri*ai-Wn*Fi)))+(gr=mi-ii))+(gr-Eo),xt[1]=(bi=Ln-((yr=Ln+ii)-(gr=yr-Ln))+(ii-gr))-((ii=bi-io)+(gr=bi-ii))+(gr-io),xt[2]=yr-((Zi=yr+ii)-(gr=Zi-yr))+(ii-gr),xt[3]=Zi;var oo=_e(Vs,lt,4,xt,ft);xt[0]=(mi=(ri=In-(Wn=(Yr=pe*In)-(Yr-In)))*(Fi=yi-(ai=(Yr=pe*yi)-(Yr-yi)))-((Ln=In*yi)-Wn*ai-ri*ai-Wn*Fi))-((ii=mi-(Eo=(ri=Ur-(Wn=(Yr=pe*Ur)-(Yr-Ur)))*(Fi=tn-(ai=(Yr=pe*tn)-(Yr-tn)))-((io=Ur*tn)-Wn*ai-ri*ai-Wn*Fi)))+(gr=mi-ii))+(gr-Eo),xt[1]=(bi=Ln-((yr=Ln+ii)-(gr=yr-Ln))+(ii-gr))-((ii=bi-io)+(gr=bi-ii))+(gr-io),xt[2]=yr-((Zi=yr+ii)-(gr=Zi-yr))+(ii-gr),xt[3]=Zi;var hl=_e(oo,ft,4,xt,pt);return pt[hl-1]}(jt,Dt,sr,ur,Rr,Vr,Er)}(ve[0],ve[1],Te[0],Te[1],ct[0],ct[1]);return bt>0?-1:bt<0?1:0}function yt(ve,Te){var ct=ve.point,bt=Te.point;return ct[0]>bt[0]?1:ct[0]<bt[0]?-1:ct[1]!==bt[1]?ct[1]>bt[1]?1:-1:function(jt,Dt,sr,ur){return jt.left!==Dt.left?jt.left?1:-1:wt(sr,jt.otherEvent.point,Dt.otherEvent.point)!==0?jt.isBelow(Dt.otherEvent.point)?-1:1:!jt.isSubject&&Dt.isSubject?1:-1}(ve,Te,ct)}function _t(ve,Te,ct){var bt=new re(Te,!1,ve,ve.isSubject),jt=new re(Te,!0,ve.otherEvent,ve.isSubject);return le(ve.point,ve.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ve),bt.contourId=jt.contourId=ve.contourId,yt(jt,ve.otherEvent)>0&&(ve.otherEvent.left=!0,jt.left=!1),ve.otherEvent.otherEvent=jt,ve.otherEvent=bt,ct.push(jt),ct.push(bt),ct}function at(ve,Te){return ve[0]*Te[1]-ve[1]*Te[0]}function ot(ve,Te){return ve[0]*Te[0]+ve[1]*Te[1]}function vt(ve,Te,ct){var bt=function(Rr,Vr,Gr,Xr,_r){var Er=[Vr[0]-Rr[0],Vr[1]-Rr[1]],pn=[Xr[0]-Gr[0],Xr[1]-Gr[1]];function xn(Yr,Wn,ri){return[Yr[0]+Wn*ri[0],Yr[1]+Wn*ri[1]]}var bn=[Gr[0]-Rr[0],Gr[1]-Rr[1]],Dn=at(Er,pn),Yn=Dn*Dn,Gn=ot(Er,Er);if(Yn>0){var Sn=at(bn,pn)/Dn;if(Sn<0||Sn>1)return null;var In=at(bn,Er)/Dn;return In<0||In>1?null:Sn===0||Sn===1?[xn(Rr,Sn,Er)]:In===0||In===1?[xn(Gr,In,pn)]:[xn(Rr,Sn,Er)]}if((Yn=(Dn=at(bn,Er))*Dn)>0)return null;var Ur=ot(Er,bn)/Gn,tn=Ur+ot(Er,pn)/Gn,yi=Math.min(Ur,tn),gr=Math.max(Ur,tn);return yi<=1&&gr>=0?yi===1?[xn(Rr,yi>0?yi:0,Er)]:gr===0?[xn(Rr,gr<1?gr:1,Er)]:[xn(Rr,yi>0?yi:0,Er),xn(Rr,gr<1?gr:1,Er)]:null}(ve.point,ve.otherEvent.point,Te.point,Te.otherEvent.point),jt=bt?bt.length:0;if(jt===0||jt===1&&(le(ve.point,Te.point)||le(ve.otherEvent.point,Te.otherEvent.point))||jt===2&&ve.isSubject===Te.isSubject)return 0;if(jt===1)return le(ve.point,bt[0])||le(ve.otherEvent.point,bt[0])||_t(ve,bt[0],ct),le(Te.point,bt[0])||le(Te.otherEvent.point,bt[0])||_t(Te,bt[0],ct),1;var Dt=[],sr=!1,ur=!1;return le(ve.point,Te.point)?sr=!0:yt(ve,Te)===1?Dt.push(Te,ve):Dt.push(ve,Te),le(ve.otherEvent.point,Te.otherEvent.point)?ur=!0:yt(ve.otherEvent,Te.otherEvent)===1?Dt.push(Te.otherEvent,ve.otherEvent):Dt.push(ve.otherEvent,Te.otherEvent),sr&&ur||sr?(Te.type=b,ve.type=Te.inOut===ve.inOut?A:C,sr&&!ur&&_t(Dt[1].otherEvent,Dt[0].point,ct),2):ur?(_t(Dt[0],Dt[1].point,ct),3):Dt[0]!==Dt[3].otherEvent?(_t(Dt[0],Dt[1].point,ct),_t(Dt[1],Dt[2].point,ct),3):(_t(Dt[0],Dt[1].point,ct),_t(Dt[3].otherEvent,Dt[2].point,ct),3)}function Ot(ve,Te){if(ve===Te)return 0;if(wt(ve.point,ve.otherEvent.point,Te.point)!==0||wt(ve.point,ve.otherEvent.point,Te.otherEvent.point)!==0)return le(ve.point,Te.point)?ve.isBelow(Te.otherEvent.point)?-1:1:ve.point[0]===Te.point[0]?ve.point[1]<Te.point[1]?-1:1:yt(ve,Te)===1?Te.isAbove(ve.point)?-1:1:ve.isBelow(Te.point)?-1:1;if(ve.isSubject!==Te.isSubject)return ve.isSubject?-1:1;var ct=ve.point,bt=Te.point;return ct[0]===bt[0]&&ct[1]===bt[1]?(ct=ve.otherEvent.point)[0]===(bt=Te.otherEvent.point)[0]&&ct[1]===bt[1]?0:ve.contourId>Te.contourId?1:-1:yt(ve,Te)===1?1:-1}var Et=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function or(ve,Te,ct,bt){var jt,Dt=ve+1,sr=Te[ve].point,ur=Te.length;for(Dt<ur&&(jt=Te[Dt].point);Dt<ur&&jt[0]===sr[0]&&jt[1]===sr[1];){if(!ct[Dt])return Dt;++Dt<ur&&(jt=Te[Dt].point)}for(Dt=ve-1;ct[Dt]&&Dt>bt;)Dt--;return Dt}Et.prototype.isExterior=function(){return this.holeOf==null};var Ft=Qt,Ht=Qt;function Qt(ve,Te){if(!(this instanceof Qt))return new Qt(ve,Te);if(this.data=ve||[],this.length=this.data.length,this.compare=Te||Hr,this.length>0)for(var ct=(this.length>>1)-1;ct>=0;ct--)this._down(ct)}function Hr(ve,Te){return ve<Te?-1:ve>Te?1:0}Qt.prototype={push:function(ve){this.data.push(ve),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ve=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ve}},peek:function(){return this.data[0]},_up:function(ve){for(var Te=this.data,ct=this.compare,bt=Te[ve];ve>0;){var jt=ve-1>>1,Dt=Te[jt];if(ct(bt,Dt)>=0)break;Te[ve]=Dt,ve=jt}Te[ve]=bt},_down:function(ve){for(var Te=this.data,ct=this.compare,bt=this.length>>1,jt=Te[ve];ve<bt;){var Dt=1+(ve<<1),sr=Dt+1,ur=Te[Dt];if(sr<this.length&&ct(Te[sr],ur)<0&&(Dt=sr,ur=Te[sr]),ct(ur,jt)>=0)break;Te[ve]=ur,ve=Dt}Te[ve]=jt}},Ft.default=Ht;var Pt=Math.max,er=Math.min,Cr=0;function en(ve,Te,ct,bt,jt,Dt){var sr,ur,Rr,Vr,Gr,Xr;for(sr=0,ur=ve.length-1;sr<ur;sr++)if(Vr=ve[sr+1],Gr=new re(Rr=ve[sr],!1,void 0,Te),Xr=new re(Vr,!1,Gr,Te),Gr.otherEvent=Xr,Rr[0]!==Vr[0]||Rr[1]!==Vr[1]){Gr.contourId=Xr.contourId=ct,Dt||(Gr.isExteriorRing=!1,Xr.isExteriorRing=!1),yt(Gr,Xr)>0?Xr.left=!0:Gr.left=!0;var _r=Rr[0],Er=Rr[1];jt[0]=er(jt[0],_r),jt[1]=er(jt[1],Er),jt[2]=Pt(jt[2],_r),jt[3]=Pt(jt[3],Er),bt.push(Gr),bt.push(Xr)}}var sn=[];function Dr(ve,Te,ct){typeof ve[0][0][0]=="number"&&(ve=[ve]),typeof Te[0][0][0]=="number"&&(Te=[Te]);var bt=function(Er,pn,xn){var bn=null;return Er.length*pn.length==0&&(xn===R?bn=sn:xn===L?bn=Er:xn!==k&&xn!==$||(bn=Er.length===0?pn:Er)),bn}(ve,Te,ct);if(bt)return bt===sn?null:bt;var jt=[1/0,1/0,-1/0,-1/0],Dt=[1/0,1/0,-1/0,-1/0],sr=function(Er,pn,xn,bn,Dn){var Yn,Gn,Sn,In,Ur,tn,yi=new Ft(null,yt);for(Sn=0,In=Er.length;Sn<In;Sn++)for(Ur=0,tn=(Yn=Er[Sn]).length;Ur<tn;Ur++)(Gn=Ur===0)&&Cr++,en(Yn[Ur],!0,Cr,yi,xn,Gn);for(Sn=0,In=pn.length;Sn<In;Sn++)for(Ur=0,tn=(Yn=pn[Sn]).length;Ur<tn;Ur++)Gn=Ur===0,Dn===L&&(Gn=!1),Gn&&Cr++,en(Yn[Ur],!1,Cr,yi,bn,Gn);return yi}(ve,Te,jt,Dt,ct);if(bt=function(Er,pn,xn,bn,Dn){var Yn=null;return(xn[0]>bn[2]||bn[0]>xn[2]||xn[1]>bn[3]||bn[1]>xn[3])&&(Dn===R?Yn=sn:Dn===L?Yn=Er:Dn!==k&&Dn!==$||(Yn=Er.concat(pn))),Yn}(ve,Te,jt,Dt,ct))return bt===sn?null:bt;for(var ur=function(Er){var pn,xn,bn=function(Sn){var In,Ur,tn,yi,gr=[];for(Ur=0,tn=Sn.length;Ur<tn;Ur++)((In=Sn[Ur]).left&&In.inResult||!In.left&&In.otherEvent.inResult)&&gr.push(In);for(var Yr=!1;!Yr;)for(Yr=!0,Ur=0,tn=gr.length;Ur<tn;Ur++)Ur+1<tn&&yt(gr[Ur],gr[Ur+1])===1&&(yi=gr[Ur],gr[Ur]=gr[Ur+1],gr[Ur+1]=yi,Yr=!1);for(Ur=0,tn=gr.length;Ur<tn;Ur++)(In=gr[Ur]).otherPos=Ur;for(Ur=0,tn=gr.length;Ur<tn;Ur++)(In=gr[Ur]).left||(yi=In.otherPos,In.otherPos=In.otherEvent.otherPos,In.otherEvent.otherPos=yi);return gr}(Er),Dn={},Yn=[],Gn=function(){if(!Dn[pn]){var Sn=Yn.length,In=function(gr,Yr,Wn){var ri=new Et;if(gr.prevInResult!=null){var ai=gr.prevInResult,Fi=ai.outputContourId;if(ai.resultTransition>0){var ii=Yr[Fi];if(ii.holeOf!=null){var yr=ii.holeOf;Yr[yr].holeIds.push(Wn),ri.holeOf=yr,ri.depth=Yr[Fi].depth}else Yr[Fi].holeIds.push(Wn),ri.holeOf=Fi,ri.depth=Yr[Fi].depth+1}else ri.holeOf=null,ri.depth=Yr[Fi].depth}else ri.holeOf=null,ri.depth=0;return ri}(bn[pn],Yn,Sn),Ur=function(gr){Dn[gr]=!0,gr<bn.length&&bn[gr]&&(bn[gr].outputContourId=Sn)},tn=pn,yi=pn;for(In.points.push(bn[pn].point);Ur(tn),Ur(tn=bn[tn].otherPos),In.points.push(bn[tn].point),!((tn=or(tn,bn,Dn,yi))==yi||tn>=bn.length)&&bn[tn];);Yn.push(In)}};for(pn=0,xn=bn.length;pn<xn;pn++)Gn();return Yn}(function(Er,pn,xn,bn,Dn,Yn){for(var Gn,Sn,In,Ur=new a(Ot),tn=[],yi=Math.min(bn[2],Dn[2]);Er.length!==0;){var gr=Er.pop();if(tn.push(gr),Yn===R&&gr.point[0]>yi||Yn===L&&gr.point[0]>bn[2])break;if(gr.left){Sn=Gn=Ur.insert(gr),Gn=Gn!==(In=Ur.minNode())?Ur.prev(Gn):null,Sn=Ur.next(Sn);var Yr=Gn?Gn.key:null;if(U(gr,Yr,Yn),Sn&&vt(gr,Sn.key,Er)===2&&(U(gr,Yr,Yn),U(Sn.key,gr,Yn)),Gn&&vt(Gn.key,gr,Er)===2){var Wn=Gn;U(Yr,(Wn=Wn!==In?Ur.prev(Wn):null)?Wn.key:null,Yn),U(gr,Yr,Yn)}}else Sn=Gn=Ur.find(gr=gr.otherEvent),Gn&&Sn&&(Gn=Gn!==In?Ur.prev(Gn):null,Sn=Ur.next(Sn),Ur.remove(gr),Sn&&Gn&&vt(Gn.key,Sn.key,Er))}return tn}(sr,0,0,jt,Dt,ct)),Rr=[],Vr=0;Vr<ur.length;Vr++){var Gr=ur[Vr];if(Gr.isExterior()){for(var Xr=[Gr.points],_r=0;_r<Gr.holeIds.length;_r++)Xr.push(ur[Gr.holeIds[_r]].points);Rr.push(Xr)}}return Rr}var Un={UNION:k,DIFFERENCE:L,INTERSECTION:R,XOR:$};l.diff=function(ve,Te){return Dr(ve,Te,L)},l.intersection=function(ve,Te){return Dr(ve,Te,R)},l.operations=Un,l.union=function(ve,Te){return Dr(ve,Te,k)},l.xor=function(ve,Te){return Dr(ve,Te,$)},Object.defineProperty(l,"__esModule",{value:!0})}(Sk.exports)),Sk.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Mb(l,r,a,u){const h=[],g=u===0?(y,b,A,C,R,k)=>{y.push(new mt(k,A+(k-b)/(C-b)*(R-A)))}:(y,b,A,C,R,k)=>{y.push(new mt(b+(k-A)/(R-A)*(C-b),k))};for(const y of l){const b=[];for(const A of y){if(A.length<=2)continue;const C=[];for(let L=0;L<A.length-1;L++){const $=A[L].x,U=A[L].y,Z=A[L+1].x,re=A[L+1].y,te=u===0?$:U,le=u===0?Z:re;te<r?le>r&&g(C,$,U,Z,re,r):te>a?le<a&&g(C,$,U,Z,re,a):C.push(A[L]),le<r&&te>=r&&g(C,$,U,Z,re,r),le>a&&te<=a&&g(C,$,U,Z,re,a)}let R=A[A.length-1];const k=u===0?R.x:R.y;k>=r&&k<=a&&C.push(R),C.length&&(R=C[C.length-1],C[0].x===R.x&&C[0].y===R.y||C.push(C[0]),b.push(C))}b.length&&h.push(b)}return h}function M7(l,r){const a=aA(l),u=aA([r]),h=Tk.intersection(a,u);return h==null?[]:Ak(h)}function O7(l,r){let u=aA(l,65536);const h=[];for(;r.valid();r.next()){const[g,y]=r.get(),b=g.x*65536,A=g.y*65536,C=y.x*65536,R=y.y*65536,k=C-b,L=R-A,$=Math.hypot(k,L);if($===0)continue;const U=Math.trunc(L/$*3),Z=-Math.trunc(k/$*3);h.push([[[b,A],[C,R],[C+U,R+Z],[b+U,A+Z],[b,A]]])}return h.length>0&&(u=Tk.diff(u,h)),Ak(u,1/65536)}function aA(l,r=1){return[l.map(a=>a.map(u=>[u.x*r,u.y*r]))]}function Ak(l,r=1){return l.map(a=>a.map((u,h)=>{const g=u.map(y=>new mt(y[0]*r,y[1]*r).round());return h>0&&g.reverse(),g}))}class lA{constructor(r,a){this.layoutVertexArray=new Rc,this.indexArray=new to,this.lineIndexArray=new Js,this.triangleSegments=new _i,this.lineSegments=new _i,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Nl)}update(r,a,u,h,g,y,b,A){this.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,A)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,m7.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.lineIndexBuffer=r.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=r.createVertexBuffer(this.elevatedLayoutVertexArray,g7.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(r,a,u,h,g,y,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,a,u,h,g,y,void 0,b)}}class cA{constructor(r){this.zoom=r.zoom,this.pixelRatio=r.pixelRatio,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=r.lut,this.bufferData=new lA(r,!1),this.elevationBufferData=new lA(r,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=r.sourceLayerIndex,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,h){}populate(r,a,u,h){this.hasPattern=oA("fill",this.layers,this.pixelRatio,a);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:A,index:C,sourceLayerIndex:R}of r){const k=this.layers[0]._featureFilter.needGeometry,L=$e(b,k);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),L,u))continue;const $=g?g.evaluate(L,{},u,a.availableImages):void 0,U={id:A,properties:b.properties,type:b.type,sourceLayerIndex:R,index:C,geometry:k?L.geometry:Ce(b,u,h),patterns:{},sortKey:$};y.push(U)}g&&y.sort((b,A)=>b.sortKey-A.sortKey);for(const b of y){const{geometry:A,index:C,sourceLayerIndex:R}=b;if(this.hasPattern){const k=sA("fill",this.layers,b,this.zoom,this.pixelRatio,a);this.patternFeatures.push(k)}else this.addFeature(b,A,C,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(r[C].feature,A,C,R,this.index)}}update(r,a,u,h,g,y,b){this.bufferData.update(r,a,u,h,g,y,b,this.worldview),this.elevationBufferData.update(r,a,u,h,g,y,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(r,a,u,h,g,y,b,this.worldview)}addFeatures(r,a,u,h,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,h,y,r.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(r){this.bufferData.upload(r),this.elevationBufferData.upload(r),this.elevatedStructures&&this.elevatedStructures.upload(r)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(r,a,u,h,g,y=[],b,A){const C=B_(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(r,C,h,u,A):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(r,u,g,y,h,b,this.worldview),this.elevationBufferData.populatePaintArrays(r,u,g,y,h,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(r,a,u,h,g){this.elevatedStructures&&(this.elevatedStructures.construct(r),this.elevatedStructures.populatePaintArrays(a,u,h,g,this.worldview))}addElevatedRoadFeature(r,a,u,h,g){const y=new Array,b=Pn.getElevationFeature(r,g);if(!b)return void this.addGeometry(a,this.bufferData);{const C=this.clipPolygonsToTile(a,1);C.length>0&&y.push({polygons:C,elevationFeature:b,elevationTileID:u})}const A={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(r,{},u),featureIndex:h};for(const C of y)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ea(C.elevationTileID,this.layers,this.zoom,this.lut));const k=C.elevationFeature.isTunnel();let L=0;r.properties.hasOwnProperty(Ye)&&(L=+r.properties[Ye]);for(const $ of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,$,k,C.elevationFeature,L)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const R=new Bn(u,C.elevationTileID);this.addElevatedGeometry(C.polygons,R,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,A)}}addElevatedGeometry(r,a,u,h,g,y){const b={elevation:u,elevationSampler:a,bias:h,index:g,featureInfo:y},[A,C]=this.addGeometry(r,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:A,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,A),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(r,a,u){let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(h=y,g=y));const b=(A,C,R)=>{if(u!=null)if(C.push(A),y!=null)a.elevatedLayoutVertexArray.emplaceBack(y),R.push(y);else{const k=u.elevationSampler.pointElevation(A,u.elevation,u.bias);a.elevatedLayoutVertexArray.emplaceBack(k),R.push(k),h=Math.min(h,k),g=Math.max(g,k)}};for(const A of r){let C=0;for(const ue of A)C+=ue.length;const R=a.triangleSegments.prepareSegment(C,a.layoutVertexArray,a.indexArray),k=R.vertexLength,L=[],$=[],U=[],Z=[],re=[],te=a.layoutVertexArray.length;for(const ue of A){if(ue.length===0)continue;ue!==A[0]&&$.push(L.length/2);const pe=a.lineSegments.prepareSegment(ue.length,a.layoutVertexArray,a.lineIndexArray),Se=pe.vertexLength;u&&re.push(a.layoutVertexArray.length-te),b(ue[0],U,Z),a.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),a.lineIndexArray.emplaceBack(Se+ue.length-1,Se),L.push(ue[0].x),L.push(ue[0].y);for(let _e=1;_e<ue.length;_e++)b(ue[_e],U,Z),a.layoutVertexArray.emplaceBack(ue[_e].x,ue[_e].y),a.lineIndexArray.emplaceBack(Se+_e-1,Se+_e),L.push(ue[_e].x),L.push(ue[_e].y);pe.vertexLength+=ue.length,pe.primitiveLength+=ue.length}const le=Am(L,$);for(let ue=0;ue<le.length;ue+=3)a.indexArray.emplaceBack(k+le[ue],k+le[ue+1],k+le[ue+2]);if(le.length>0&&u&&this.elevationMode==="hd-road-base"){const ue=u.elevation.isTunnel(),pe=u.elevation.safeArea,Se=this.elevatedStructures.addVertices(U,Z);this.elevatedStructures.addTriangles(le,Se,ue);const _e=re.length;if(_e>0){for(let Ee=0;Ee<_e-1;Ee++)this.elevatedStructures.addRenderableRing(u.index,re[Ee]+Se,re[Ee+1]-re[Ee],ue,pe,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,re[_e-1]+Se,U.length-re[_e-1],ue,pe,u.featureInfo)}}R.vertexLength+=C,R.primitiveLength+=le.length/3}return[h,g]}prepareElevatedPolygons(r,a,u){const h=1/oe(u),g=[];for(const y of r){const b=O7(y,new vn(a,h));g.push(...b)}return g}clipPolygonsToTile(r,a){const u=-a,h=-a,g=Mt+a,y=Mt+a;let b=0;const A=[],C=[];for(;b<r.length;b++){const L=r[b],$=Ol(L);($.min.x>=u&&$.max.x<=g&&$.min.y>=h&&$.max.y<=y?A:C).push(L)}if(A.length===r.length)return r;const R=[new mt(u,h),new mt(g,h),new mt(g,y),new mt(u,y),new mt(u,h)],k=A;for(const L of C)k.push(...M7(L,R));return k}}let Ek,Pk,Ck,Ik;Yt(cA,"FillBucket",{omit:["layers","patternFeatures"]}),Yt(lA,"FillBufferData"),Yt(ea,"ElevatedStructures");class Ob{constructor(r,a,u,h){if(this.triangleCount=a.length/3,this.min=new mt(0,0),this.max=new mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||r.length===0)return;const[g,y]=[r[0].clone(),r[0].clone()];for(let k=1;k<r.length;++k){const L=r[k];g.x=Math.min(g.x,L.x),g.y=Math.min(g.y,L.y),y.x=Math.max(y.x,L.x),y.y=Math.max(y.y,L.y)}if(h){const k=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/h);u=Math.max(u,k)}if(u===0)return;this.min=g,this.max=y;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const A=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/A)),this.cellsY=Math.max(1,Math.ceil(b.y/A)),this.xScale=1/A,this.yScale=1/A;const C=[];for(let k=0;k<this.triangleCount;k++){const L=r[a[3*k+0]].sub(this.min),$=r[a[3*k+1]].sub(this.min),U=r[a[3*k+2]].sub(this.min),Z=Nc(Math.floor(Math.min(L.x,$.x,U.x)),this.xScale,this.cellsX),re=Nc(Math.floor(Math.max(L.x,$.x,U.x)),this.xScale,this.cellsX),te=Nc(Math.floor(Math.min(L.y,$.y,U.y)),this.yScale,this.cellsY),le=Nc(Math.floor(Math.max(L.y,$.y,U.y)),this.yScale,this.cellsY),ue=new mt(0,0),pe=new mt(0,0),Se=new mt(0,0),_e=new mt(0,0);for(let Ee=te;Ee<=le;++Ee){ue.y=pe.y=Ee*A,Se.y=_e.y=(Ee+1)*A;for(let Me=Z;Me<=re;++Me)ue.x=Se.x=Me*A,pe.x=_e.x=(Me+1)*A,(Yo(L,$,U,ue,pe,_e)||Yo(L,$,U,ue,_e,Se))&&C.push({cellIdx:Ee*this.cellsX+Me,triIdx:k})}}if(C.length===0)return;C.sort((k,L)=>k.cellIdx-L.cellIdx||k.triIdx-L.triIdx);let R=0;for(;R<C.length;){const k=C[R].cellIdx,L={start:this.payload.length,len:0};for(;R<C.length&&C[R].cellIdx===k;)++L.len,this.payload.push(C[R++].triIdx);this.cells[k]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(r,a){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>r.x||r.y>this.max.y||this.min.y>r.y)return;const u=Nc(r.x-this.min.x,this.xScale,this.cellsX),h=Nc(r.y-this.min.y,this.yScale,this.cellsY),g=this.cells[h*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const b=this.payload[g.start+y],A=Math.floor(b/8),C=1<<b%8;if(!(this.lookup[A]&C)&&(this.lookup[A]|=C,a.push(b),a.length===this.triangleCount))return}}}query(r,a,u){if(this.triangleCount===0||this.cells.length===0||r.x>this.max.x||this.min.x>a.x||r.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const h=Nc(r.x-this.min.x,this.xScale,this.cellsX),g=Nc(a.x-this.min.x,this.xScale,this.cellsX),y=Nc(r.y-this.min.y,this.yScale,this.cellsY),b=Nc(a.y-this.min.y,this.yScale,this.cellsY);for(let A=y;A<=b;A++)for(let C=h;C<=g;C++){const R=this.cells[A*this.cellsX+C];if(R)for(let k=0;k<R.len;k++){const L=this.payload[R.start+k],$=Math.floor(L/8),U=1<<L%8;if(!(this.lookup[$]&U)&&(this.lookup[$]|=U,u.push(L),u.length===this.triangleCount))return}}}}function Nc(l,r,a){return Math.max(0,Math.min(a-1,Math.floor(l*r)))}Yt(Ob,"TriangleGridIndex");class Mk{constructor(r){this.zoom=r.zoom,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){for(const u of this.footprints)a.push({footprint:u,id:r})}updateAppearances(r,a,u,h){}populate(r,a,u,h){const g=[];for(const{feature:y,id:b,index:A,sourceLayerIndex:C}of r){const R=this.layers[0]._featureFilter.needGeometry,k=$e(y,R);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),k,u))continue;const L={id:b,properties:y.properties,type:y.type,sourceLayerIndex:C,index:A,geometry:R?k.geometry:Ce(y,u,h),patterns:{}};g.push(L)}for(const y of g){const{geometry:b,index:A,sourceLayerIndex:C}=y;this.addFeature(y,b,A,u,{},a.availableImages,a.brightness),a.featureIndex.insert(r[A].feature,b,A,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(r){}update(r,a,u,h,g,y,b){}destroy(){}addFeature(r,a,u,h,g,y=[],b){for(const A of B_(a,2)){const C=[],R=[],k=[],L=new mt(1/0,1/0),$=new mt(-1/0,-1/0);for(const re of A)if(re.length!==0){re!==A[0]&&k.push(R.length/2);for(let te=0;te<re.length;te++)R.push(re[te].x),R.push(re[te].y),C.push(re[te]),L.x=Math.min(L.x,re[te].x),L.y=Math.min(L.y,re[te].y),$.x=Math.max($.x,re[te].x),$.y=Math.max($.y,re[te].y)}const U=Am(R,k),Z=new Ob(C,U,8,256);this.footprints.push({vertices:C,indices:U,grid:Z,min:L,max:$})}}}Yt(Mk,"ClipBucket",{omit:["layers"]});const R7=Kr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),k7=Kr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),j7=Kr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),D7=Kr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),L7=Kr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),N7=Kr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),z7=Kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:F7}=R7,$_=Number.MAX_SAFE_INTEGER,Ok=$_-1;function Rk(l,r,a,u){return l.order<r||l.order===$_||!(l.clipMask&a)||function(h,g){return g.length!==0&&g.find(y=>y===h)===void 0}(u,l.clipScope)}function Rb(l,r){return l.x-r.x||l.y-r.y}function kk(l,r){return Rb(l.min,r.min)===0&&Rb(l.max,r.max)===0}function uA(l,r){return!(l.min.x>r.max.x||l.max.x<r.min.x||l.min.y>r.max.y||l.max.y<r.min.y)}function kb(l,r){if(l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==r[a].sourceId||!kk(l[a],r[a])||l[a].order!==r[a].order||l[a].clipMask!==r[a].clipMask||!qo(l[a].clipScope,r[a].clipScope))return!1;return!0}function jk(l,r,a){const u=1/Mt,h=1/(1<<a.canonical.z),g=(r.x*u+a.canonical.x)*h+a.wrap,y=(r.y*u+a.canonical.y)*h;return{min:new mt((l.x*u+a.canonical.x)*h+a.wrap,(l.y*u+a.canonical.y)*h),max:new mt(g,y)}}function B7(l,r,a){const u=1<<a.canonical.z,h=((r.x-a.wrap)*u-a.canonical.x)*Mt,g=(r.y*u-a.canonical.y)*Mt;return{min:new mt(((l.x-a.wrap)*u-a.canonical.x)*Mt,(l.y*u-a.canonical.y)*Mt),max:new mt(h,g)}}function dA(l,r,a,u,h,g,y){const b=l.indices,A=l.vertices,C=[];for(let R=u;R<u+h;R+=3){const k=r[a[R+0]+g],L=r[a[R+1]+g],$=r[a[R+2]+g],U=Math.min(k.x,L.x,$.x),Z=Math.max(k.x,L.x,$.x),re=Math.min(k.y,L.y,$.y),te=Math.max(k.y,L.y,$.y);C.length=0,l.grid.query(new mt(U,re),new mt(Z,te),C);for(let le=0;le<C.length;le++){const ue=C[le];if(Yo(A[b[3*ue+0]],A[b[3*ue+1]],A[b[3*ue+2]],k,L,$,y))return!0}}return!1}function Dk(l,r,a,u){if(!l||!a)return!1;let h=l.vertices;if(!r.canonical.equals(u.canonical)||r.wrap!==u.wrap){if(a.vertices.length<l.vertices.length)return Dk(a,u,l,r);const g=r.canonical,y=u.canonical,b=Math.pow(2,y.z-g.z);h=l.vertices.map(A=>new mt((A.x+g.x*Mt)*b-y.x*Mt,(A.y+g.y*Mt)*b-y.y*Mt))}return dA(a,h,l.indices,0,l.indices.length,0,0)}function Lk(l,r,a,u){const h=Math.pow(2,u.z-a.z);return new mt((l+a.x*Mt)*h-u.x*Mt,(r+a.y*Mt)*h-u.y*Mt)}function Nk(l,r){const a=[];r.grid.queryPoint(l,a);const u=r.indices,h=r.vertices;for(let g=0;g<a.length;g++){const y=a[g];if(Kn([h[u[3*y+0]],h[u[3*y+1]],h[u[3*y+2]]],l))return!0}return!1}const hA=[new mt(0,0),new mt(Mt,0),new mt(Mt,Mt),new mt(0,Mt)];function zk(l,r){const a=[];let u=[];if(!r||l.length<2)return[l];if(l.length===2)return Ho(l[0],l[1],hA)?[l]:[];for(let h=0;h<l.length+2;h++){const g=l[h%l.length],y=l[(h+1)%l.length],b=Ho(h===0?l[l.length-1]:l[(h-1)%l.length],g,hA),A=Ho(g,y,hA),C=b||A;C&&u.push(g),C&&A||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const fA=Ne.types,$7=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],V7=["fill-extrusion-flood-light-ground-radius"],U7=Math.pow(2,13),G7=Math.pow(2,15)-1,Fk=new mt(0,1),Mu=2147483648,Bk=7,$k=450;function V_(l,r,a,u,h,g,y,b){l.emplaceBack((r<<1)+y,(a<<1)+g,(Math.floor(u*U7)<<1)+h,Math.round(b))}function U_(l,r,a){l.emplaceBack(r.x*Mt,r.y*Mt,a?1:0)}function jb(l,r,a,u,h,g){l.emplaceBack(r.x,r.y,(a.x<<1)+u,(a.y<<1)+h,g)}function G_(l,r,a){l.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Vk{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Uk{constructor(){this.centroidXY=new mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Gk{constructor(){this.acc=new mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(r,a){r.min.x===Number.MAX_VALUE&&(r.min.x=r.max.x=a.x,r.min.y=r.max.y=a.y)}appendEdge(r,a,u){this.accCount++,this.acc._add(a);let h=!!this.borders;a.x<r.min.x?(r.min.x=a.x,h=!0):a.x>r.max.x&&(r.max.x=a.x,h=!0),a.y<r.min.y?(r.min.y=a.y,h=!0):a.y>r.max.y&&(r.max.y=a.y,h=!0),((a.x===0||a.x===Mt)&&a.x===u.x)!=((a.y===0||a.y===Mt)&&a.y===u.y)&&this.processBorderOverlap(a,u),h&&this.checkBorderIntersection(a,u)}checkBorderIntersection(r,a){a.x<0!=r.x<0&&this.addBorderIntersection(0,xr(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Mt!=r.x>Mt&&this.addBorderIntersection(1,xr(a.y,r.y,(Mt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,xr(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Mt!=r.y>Mt&&this.addBorderIntersection(3,xr(a.x,r.x,(Mt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const u=r.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,r.y)}else{const u=r.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,r.x)}}centroid(){return this.accCount===0?new mt(0,0):new mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0):0}}function Hk(l,r){const a=l.add(r)._unit(),u=ne(l.x*a.x+l.y*a.y,-1,1);var h,g,y;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*G7*((g=l).x*(y=r).y-g.y*y.x<0?-1:1)}const H7=[l=>l.x<0,l=>l.x>Mt,l=>l.y<0,l=>l.y>Mt];function W7(l,r,a,u){const h=[4];if(u===0)return h;a._mult(u);const g=l.sub(a),y=r.sub(a),b=[l,r,g,y];for(let A=0;A<4;A++)for(const C of b)if(H7[A](C)){h.push(A);break}return h}class pA{constructor(r){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new g_,this.indexArray=new to,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut},a=>V7.includes(a)),this._segments=new _i,this.hiddenByLandmarkVertexArray=new fm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new _i}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(r,a,u,h=!1){const g=r.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let A;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const C=r[0],R=r[1];A=Hk(C.sub(r[g-1])._perp()._unit(),R.sub(C)._perp()._unit())}for(let C=0;C<g;C++){const R=C===g-1?0:C+1,k=r[C],L=r[R],$=r[R===g-1?0:R+1],U=L.sub(k)._perp()._unit(),Z=Hk(U,$.sub(L)._perp()._unit()),re=A,te=Z;if(mA(k,L,a)||h&&Zk(k,a)&&Zk(L,a)){A=Z;continue}const le=b.vertexLength;jb(this.vertexArray,k,L,1,1,re),jb(this.vertexArray,k,L,1,0,re),jb(this.vertexArray,k,L,0,1,te),jb(this.vertexArray,k,L,0,0,te),b.vertexLength+=4;const ue=W7(k,L,U,u);for(const pe of ue)this._segmentToGroundQuads[y].push({id:le,region:pe}),this._segmentToRegionTriCounts[y][pe]+=2,b.primitiveLength+=2;A=Z}}}prepareBorderSegments(){if(!this.hasData())return;const r=this._segments.get(),a=r.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort((h,g)=>h.region-g.region);for(let u=0;u<a;u++){const h=this._segmentToGroundQuads[u],g=r[u],y=this._segmentToRegionTriCounts[u];y.reduce((A,C)=>A+C,0);let b=0;for(let A=0;A<=4;A++){const C=y[A];if(C!==0){let R=this.regionSegments[A];R||(R=this.regionSegments[A]=new _i);const k={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+b,vertexLength:g.vertexLength,primitiveLength:C};R.get().push(k)}b+=C}for(let A=0;A<h.length;A++){const C=h[A].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(r,a,u,h,g,y,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,r,a,u,h,g,y,void 0,b)}upload(r){this.hasData()&&(this.vertexBuffer=r.createVertexBuffer(this.vertexArray,k7.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=r.createVertexBuffer(this.groundRadiusArray,j7.members)))}uploadPaintProperties(r){this.hasData()&&this.programConfigurations.upload(r)}update(r,a,u,h,g,y,b,A){this.hasData()&&this.programConfigurations.updatePaintArrays(r,a,u,h,g,y,b,A)}updateHiddenByLandmark(r){this.updateHiddenByLandmarkRange(r.groundVertexArrayOffset,r.groundVertexCount,!!(r.flags&Mu))}updateHiddenByLandmarkRange(r,a,u){if(!this.hasData())return;const h=a+r;if(a!==0){for(let g=r;g<h;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(r){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=r.createVertexBuffer(this.hiddenByLandmarkVertexArray,N7.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let r=0;r<=4;r++){const a=this.regionSegments[r];a&&a.destroy()}}}}class Db{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.pixelRatio=r.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new to,this.footprintVertices=new Rc,this.footprintSegments=[],this.layoutVertexArray=new Sd,this.centroidVertexArray=new wb,this.wallVertexArray=new Gh,this.indexArray=new to,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut},a=>$7.includes(a)),this.segments=new _i,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new pA(r),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,h){}populate(r,a,u,h){this.features=[],this.hasPattern=oA("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=oe(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:b,sourceLayerIndex:A}of r){const C=this.layers[0]._featureFilter.needGeometry,R=$e(g,C);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),R,u))continue;const k={id:y,sourceLayerIndex:A,index:b,geometry:C?R.geometry:Ce(g,u,h),properties:g.properties,type:g.type,patterns:{}},L=this.layoutVertexArray.length,$=fA[k.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:sA("fill-extrusion",this.layers,k,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const U of k.geometry)for(const Z of zk(U,$))this.addFeature(g.id,k,[Z],b,u,{},a.availableImages,h,a.brightness);else this.addFeature(g.id,k,k.geometry,b,u,{},a.availableImages,h,a.brightness);a.featureIndex.insert(g,k.geometry,b,A,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(r,a,u,h,g,y){for(const{featureId:b,feature:A}of this.features){const C=fA[A.type]==="Polygon",{geometry:R}=A;if(this.wallMode)for(const k of R)for(const L of zk(k,C))this.addFeature(b,A,[L],A.index,a,u,h,g,y);else this.addFeature(b,A,R,A.index,a,u,h,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(r,a,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,this.worldview),this.groundEffect.update(r,a,g,u,h,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,F7),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.wallVertexBuffer=r.createVertexBuffer(this.wallVertexArray,L7.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,z7.members,!0)),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.groundEffect.uploadHiddenByLandmark(r),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,D7.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,u,h,g,y,b,A,C){const R=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,k=[new mt(0,0),new mt(Mt,Mt)],L=A.projection,$=L.name==="globe",U=this.wallMode||fA[a.type]==="Polygon",Z=new Gk;Z.centroidDataIndex=this.centroidData.length;const re=new Uk;re.buildingId=r,a.properties&&a.properties.hasOwnProperty("building_id")&&(re.buildingId=a.properties.building_id);const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},g)<=0,le=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},g);let ue;if(re.height=le,re.vertexArrayOffset=this.layoutVertexArray.length,re.groundVertexArrayOffset=this.groundEffect.vertexArray.length,$&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new am),this.wallMode){if($)return void Ut("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ue=function(Ve){const lt=Ve[0].x===Ve[Ve.length-1].x&&Ve[0].y===Ve[Ve.length-1].y;(function(Ht){let Qt=0;const Hr=Ht.length;for(let Pt=0;Pt<Hr;Pt++)Qt+=(Ht[(Pt+1)%Hr].x-Ht[Pt].x)*(Ht[(Pt+1)%Hr].y+Ht[Pt].y);return Qt>=0})(Ve)||(Ve=Ve.reverse());const pt={geometry:[],joinNormals:[],indices:[]},xt=[],wt=[],yt=[];let _t=Ve.length;for(;_t>=2&&Ve[_t-1].equals(Ve[_t-2]);)_t--;if(_t<(lt?3:2))return pt;let at,ot,vt,Ot,Et,or=0;for(;or<_t-1&&Ve[or].equals(Ve[or+1]);)or++;lt&&(at=Ve[_t-2],Et=Ve[or].sub(at)._unit()._perp());for(let Ht=or;Ht<_t;Ht++){if(vt=Ht===_t-1?lt?Ve[or+1]:void 0:Ve[Ht+1],vt&&Ve[Ht].equals(vt))continue;Et&&(Ot=Et),at&&(ot=at),at=Ve[Ht],Et=vt?vt.sub(at)._unit()._perp():Ot,Ot=Ot||Et;let Qt=Ot.add(Et);Qt.x===0&&Qt.y===0||Qt._unit();const Hr=Qt.x*Et.x+Qt.y*Et.y,Pt=Hr!==0?1/Hr:1/0,er=Ot.x*Et.y-Ot.y*Et.x>0;let Cr="miter";const en=2;Cr==="miter"&&Pt>en&&(Cr="bevel"),Cr==="bevel"&&(Pt>100&&(Cr="flipbevel"),Pt<en&&(Cr="miter"));const sn=(Dr,Un,ve,Te)=>{const ct=new mt(Dr.x,Dr.y),bt=new mt(Dr.x,Dr.y);ct.x+=Un.x*Te,ct.y+=Un.y*Te,bt.x-=Un.x*Math.max(ve,1),bt.y-=Un.y*Math.max(ve,1),yt.push(Un),xt.push(ct),wt.push(bt)};if(Cr==="miter")Qt._mult(Pt),sn(at,Qt,0,0);else if(Cr==="flipbevel")Qt=Et.mult(-1),sn(at,Qt,0,0),sn(at,Qt.mult(-1),0,0);else{const Dr=-Math.sqrt(Pt*Pt-1),Un=er?Dr:0,ve=er?0:Dr;ot&&sn(at,Ot,Un,ve),vt&&sn(at,Et,Un,ve)}}pt.geometry=[...xt,...wt.reverse(),xt[0]],pt.joinNormals=[...yt,...yt.reverse(),yt[yt.length-1]];const Ft=pt.geometry.length-1;for(let Ht=0;Ht<Ft/2;Ht++)if(Ht+1<Ft/2){let Qt=Ht,Hr=Ht+1,Pt=Ft-1-Ht,er=Ft-2-Ht;Qt=Qt===0?Ft-1:Qt-1,Hr=Hr===0?Ft-1:Hr-1,Pt=Pt===0?Ft-1:Pt-1,er=er===0?Ft-1:er-1,pt.indices.push(Pt),pt.indices.push(Hr),pt.indices.push(Qt),pt.indices.push(Pt),pt.indices.push(er),pt.indices.push(Hr)}return pt}(u[0]),u=[ue.geometry]}const pe=(Ve,lt)=>Ve<(lt.length-1)/2||Ve===lt.length-1,Se=this.wallMode?[u]:B_(u,500);for(let Ve=Se.length-1;Ve>=0;Ve--){const lt=Se[Ve];(lt.length===0||(_e=lt[0]).every(ft=>ft.x<=0)||_e.every(ft=>ft.x>=Mt)||_e.every(ft=>ft.y<=0)||_e.every(ft=>ft.y>=Mt))&&Se.splice(Ve,1)}var _e;let Ee;if($)Ee=Jk(Se,k,g);else{Ee=[];for(const Ve of Se)Ee.push({polygon:Ve,bounds:k})}const Me=U?this.edgeRadius:0,De=Me>0&&this.zoom<17,nt=(Ve,lt)=>{if(Ve.length===0)return!1;const ft=Ve[Ve.length-1];return lt.x===ft.x&&lt.y===ft.y};for(const{polygon:Ve,bounds:lt}of Ee){let ft=0,pt=0;for(const _t of Ve)U&&!_t[0].equals(_t[_t.length-1])&&_t.push(_t[0]),pt+=U?_t.length-1:_t.length;const xt=this.segments.prepareSegment((U?5:4)*pt,this.layoutVertexArray,this.indexArray);re.footprintSegIdx<0&&(re.footprintSegIdx=this.footprintSegments.length),re.polygonSegIdx<0&&(re.polygonSegIdx=this.polygonSegments.length);const wt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},yt=new Vk;if(yt.vertexOffset=this.footprintVertices.length,yt.indexOffset=3*this.footprintIndices.length,yt.ringIndices=[],U){const _t=[],at=[];ft=xt.vertexLength;for(let vt=0;vt<Ve.length;vt++){const Ot=Ve[vt];Ot.length&&vt!==0&&at.push(_t.length/2);const Et=[];let or,Ft;or=Ot[1].sub(Ot[0])._perp()._unit(),yt.ringIndices.push(Ot.length-1);for(let Ht=1;Ht<Ot.length;Ht++){const Qt=Ot[Ht],Hr=Ot[Ht===Ot.length-1?1:Ht+1],Pt=Qt.clone();if(Me){Ft=Hr.sub(Qt)._perp()._unit();const er=or.add(Ft)._unit(),Cr=Me*Math.min(4,1/(or.x*er.x+or.y*er.y));Pt.x+=Cr*er.x,Pt.y+=Cr*er.y,Pt.x=Math.round(Pt.x),Pt.y=Math.round(Pt.y),or=Ft}if(!te||Me!==0&&!De||nt(Et,Pt)||Et.push(Pt),V_(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),this.wallMode){const er=pe(Ht,Ot);U_(this.wallVertexArray,ue.joinNormals[Ht],!er)}xt.vertexLength++,this.footprintVertices.emplaceBack(Qt.x,Qt.y),_t.push(Qt.x,Qt.y),$&&G_(this.layoutVertexExtArray,L.projectTilePoint(Pt.x,Pt.y,g),L.upVector(g,Pt.x,Pt.y))}te&&(Me===0||De)&&(Et.length!==0&&nt(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,lt,R))}const ot=this.wallMode?ue.indices:Am(_t,at);for(let vt=0;vt<ot.length;vt+=3)this.footprintIndices.emplaceBack(yt.vertexOffset+ot[vt+0],yt.vertexOffset+ot[vt+1],yt.vertexOffset+ot[vt+2]),this.indexArray.emplaceBack(ft+ot[vt],ft+ot[vt+2],ft+ot[vt+1]),xt.primitiveLength++;yt.indexCount+=ot.length,yt.vertexCount+=this.footprintVertices.length-yt.vertexOffset}for(let _t=0;_t<Ve.length;_t++){const at=Ve[_t];Z.startRing(re,at[0]);let ot=at.length>4&&Kk(at[at.length-2],at[0],at[1]),vt=Me?q7(at[at.length-2],at[0],at[1],Me):0;const Ot=[];let Et,or,Ft;or=at[1].sub(at[0])._perp()._unit();let Ht=!0;for(let Qt=1,Hr=0;Qt<at.length;Qt++){let Pt=at[Qt-1],er=at[Qt];const Cr=at[Qt===at.length-1?1:Qt+1];if(Z.appendEdge(re,er,Pt),mA(er,Pt,lt)){Me&&(or=Cr.sub(er)._perp()._unit(),Ht=!Ht);continue}const en=er.sub(Pt)._perp(),sn=en.x/(Math.abs(en.x)+Math.abs(en.y)),Dr=en.y>0?1:0,Un=Pt.dist(er);if(Hr+Un>32768&&(Hr=0),Me){Ft=Cr.sub(er)._perp()._unit();let bt=qk(Pt,er,Cr,Wk(or,Ft),Me);isNaN(bt)&&(bt=0);const jt=er.sub(Pt)._unit();Pt=Pt.add(jt.mult(vt))._round(),er=er.add(jt.mult(-bt))._round(),vt=bt,or=Ft,te&&this.zoom>=17&&(nt(Ot,Pt)||Ot.push(Pt),nt(Ot,er)||Ot.push(er))}const ve=xt.vertexLength,Te=at.length>4&&Kk(Pt,er,Cr);let ct=Xk(Hr,ot,Ht);if(V_(this.layoutVertexArray,Pt.x,Pt.y,sn,Dr,0,0,ct),V_(this.layoutVertexArray,Pt.x,Pt.y,sn,Dr,0,1,ct),this.wallMode){const bt=pe(Qt-1,at),jt=ue.joinNormals[Qt-1];U_(this.wallVertexArray,jt,bt),U_(this.wallVertexArray,jt,bt)}if(Hr+=Un,ct=Xk(Hr,Te,!Ht),ot=Te,V_(this.layoutVertexArray,er.x,er.y,sn,Dr,0,0,ct),V_(this.layoutVertexArray,er.x,er.y,sn,Dr,0,1,ct),this.wallMode){const bt=pe(Qt,at),jt=ue.joinNormals[Qt];U_(this.wallVertexArray,jt,bt),U_(this.wallVertexArray,jt,bt)}if(xt.vertexLength+=4,this.indexArray.emplaceBack(ve+0,ve+1,ve+2),this.indexArray.emplaceBack(ve+1,ve+3,ve+2),xt.primitiveLength+=2,Me){const bt=ft+(Qt===1?at.length-2:Qt-2),jt=Qt===1?ft:bt+1;if(this.indexArray.emplaceBack(ve+1,bt,ve+3),this.indexArray.emplaceBack(bt,jt,ve+3),xt.primitiveLength+=2,Et===void 0&&(Et=ve),!mA(Cr,at[Qt],lt)){const Dt=Qt===at.length-1?Et:xt.vertexLength;this.indexArray.emplaceBack(ve+2,ve+3,Dt),this.indexArray.emplaceBack(ve+3,Dt+1,Dt),this.indexArray.emplaceBack(ve+3,jt,Dt+1),xt.primitiveLength+=3}Ht=!Ht}if($){const bt=this.layoutVertexExtArray,jt=L.projectTilePoint(Pt.x,Pt.y,g),Dt=L.projectTilePoint(er.x,er.y,g),sr=L.upVector(g,Pt.x,Pt.y),ur=L.upVector(g,er.x,er.y);G_(bt,jt,sr),G_(bt,jt,sr),G_(bt,Dt,ur),G_(bt,Dt,ur)}}U&&(ft+=at.length-1),te&&Me&&this.zoom>=17&&(Ot.length!==0&&nt(Ot,Ot[0])&&Ot.pop(),this.groundEffect.addData(Ot,lt,R,Me>0))}this.footprintSegments.push(yt),wt.triangleCount=this.indexArray.length-wt.triangleArrayOffset,this.polygonSegments.push(wt),++re.footprintSegLen,++re.polygonSegLen}if(re.vertexCount=this.layoutVertexArray.length-re.vertexArrayOffset,re.groundVertexCount=this.groundEffect.vertexArray.length-re.groundVertexArrayOffset,re.vertexCount!==0){if(re.centroidXY=Z.borders?Fk:this.encodeCentroid(Z,re),this.centroidData.push(re),Z.borders){this.featuresOnBorder.push(Z);const Ve=this.featuresOnBorder.length-1;for(let lt=0;lt<Z.borders.length;lt++)Z.borders[lt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[lt].push(Ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,h,y,b,g,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,h,y,b,g,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,le)}}sortBorders(){for(let r=0;r<this.borderFeatureIndices.length;r++)this.borderFeatureIndices[r].sort((a,u)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}splitToSubtiles(){const r=[];for(let b=0;b<this.centroidData.length;b++){const A=this.centroidData[b],C=+(A.min.y+A.max.y>Mt),R=2*C+(+(A.min.x+A.max.x>Mt)^C);for(let k=0;k<A.polygonSegLen;k++){const L=A.polygonSegIdx+k;r.push({centroidIdx:b,subtile:R,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const a=new to;r.sort((b,A)=>b.triangleSegmentIdx===A.triangleSegmentIdx?b.subtile-A.subtile:b.triangleSegmentIdx-A.triangleSegmentIdx);let u=0,h=0,g=0;for(const b of r){if(b.triangleSegmentIdx!==u)break;g++}const y=r.length;for(;h!==r.length;){u=r[h].triangleSegmentIdx;let b=0,A=h,C=h;for(let R=A;R<g&&r[R].subtile===b;R++)C++;for(;A!==g;){const R=r[A];b=R.subtile;const k=this.centroidData[R.centroidIdx].min.clone(),L=this.centroidData[R.centroidIdx].max.clone(),$={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=A;U<C;U++){const Z=r[U],re=this.polygonSegments[Z.polygonSegmentIdx],te=this.centroidData[Z.centroidIdx].min,le=this.centroidData[Z.centroidIdx].max,ue=this.indexArray.uint16;for(let pe=re.triangleArrayOffset;pe<re.triangleArrayOffset+re.triangleCount;pe++)a.emplaceBack(ue[3*pe],ue[3*pe+1],ue[3*pe+2]);$.primitiveLength+=re.triangleCount,k.x=Math.min(k.x,te.x),k.y=Math.min(k.y,te.y),L.x=Math.max(L.x,le.x),L.y=Math.max(L.y,le.y)}$.primitiveLength>0&&this.triangleSubSegments.push({segment:$,min:k,max:L}),A=C;for(let U=A;U<g&&r[U].subtile===r[A].subtile;U++)C++}h=g;for(let R=h;R<y&&r[R].triangleSegmentIdx===r[h].triangleSegmentIdx;R++)g++}a._trim(),this.indexArray=a}getVisibleSegments(r,a,u){const h=new _i;if(this.wallMode){for(const Z of this.triangleSubSegments)h.segments.push(Z.segment);return h}let g=0,y=0;const b=1<<r.canonical.z;if(a){const Z=a.getMinMaxForTile(r);Z&&(g=Z.min,y=Z.max)}y+=this.maxHeight;const A=r.toUnwrapped();let C;const R=[A.canonical.x/b+A.wrap,A.canonical.y/b],k=[(A.canonical.x+1)/b+A.wrap,(A.canonical.y+1)/b],L=(Z,re,te)=>[Z[0]*(1-te[0])+re[0]*te[0],Z[1]*(1-te[1])+re[1]*te[1]],$=[],U=[];for(const Z of this.triangleSubSegments){$[0]=Z.min.x/Mt,$[1]=Z.min.y/Mt,U[0]=Z.max.x/Mt,U[1]=Z.max.y/Mt;const re=L(R,k,$),te=L(R,k,U);if(new rr([re[0],re[1],g],[te[0],te[1],y]).intersectsPrecise(u)===0){C&&(h.segments.push(C),C=void 0);continue}const le=Z.segment;C&&C.vertexOffset!==le.vertexOffset&&(h.segments.push(C),C=void 0),C?(C.vertexLength+=le.vertexLength,C.primitiveLength+=le.primitiveLength):C={vertexOffset:le.vertexOffset,primitiveLength:le.primitiveLength,vertexLength:le.vertexLength,primitiveOffset:le.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&h.segments.push(C),h}encodeCentroid(r,a){const u=r.centroid(),h=a.span(),g=Math.min(7,Math.round(h.x*this.tileToMeter/10)),y=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new mt(ne(u.x,1,Mt-1)<<3|g,ne(u.y,1,Mt-1)<<3|y)}encodeBorderCentroid(r){if(!r.borders)return new mt(0,0);const a=r.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const h=a[0][0]!==u?0:1;return new mt(6|(a[0][0]!==u?0:65528),(a[h][0]+a[h][1])/2<<3|6)}{const h=a[2][0]!==u?2:3;return new mt((a[h][0]+a[h][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(r){const a=this.centroidData[r.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(r){this.groundEffect.updateHiddenByLandmark(r);const a=r.vertexArrayOffset,u=r.vertexCount+r.vertexArrayOffset,h=r.flags&Mu?Fk:r.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==h.y||g!==h.x){for(let y=a;y<u;++y)this.centroidVertexArray.emplace(y,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const r of this.centroidData)this.writeCentroidToBuffer(r)}updateReplacement(r,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(r.toUnwrapped());if(kb(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));if(y.footprint.buildingIds)for(const A of this.centroidData)A.flags&Mu||y.min.x>A.max.x||A.min.x>y.max.x||y.min.y>A.max.y||A.min.y>y.max.y||y.footprint.buildingIds.has(A.buildingId)&&(A.flags|=Mu);else for(const A of this.centroidData)if(!(A.flags&Mu||y.min.x>A.max.x||A.min.x>y.max.x||y.min.y>A.max.y||A.min.y>y.max.y))for(let C=0;C<A.footprintSegLen;C++){const R=this.footprintSegments[A.footprintSegIdx+C];if(g.length=0,Z7(this.footprintVertices,R.vertexOffset,R.vertexCount,y.footprintTileId.canonical,r.canonical,g),dA(y.footprint,g,this.footprintIndices.uint16,R.indexOffset,R.indexCount,-R.vertexOffset,-b)){A.flags|=Mu;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(r,a,u){let h=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let b=0;for(const A of y.ringIndices){for(let C=b,R=A+b-1;C<A+b;R=C++){const k=this.footprintVertices.int16[2*(C+y.vertexOffset)+0],L=this.footprintVertices.int16[2*(C+y.vertexOffset)+1],$=this.footprintVertices.int16[2*(R+y.vertexOffset)+1];L>a!=$>a&&r<(this.footprintVertices.int16[2*(R+y.vertexOffset)+0]-k)*(a-L)/($-L)+k&&(h=!h)}b=A}}return h}getHeightAtTileCoord(r,a){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(r+Mt)*Mt+(a+Mt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&Mu)}:void 0}for(const y of this.centroidData)r>y.max.x||y.min.x>r||a>y.max.y||y.min.y>a||y.height<=u||this.footprintContainsPoint(r,a,y)&&(u=y.height,this.partLookup[g]=y,h=!!(y.flags&Mu));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[g]=void 0}}function Wk(l,r){const a=l.add(r)._unit();return l.x*a.x+l.y*a.y}function q7(l,r,a,u){const h=r.sub(l)._perp()._unit(),g=a.sub(r)._perp()._unit();return qk(l,r,a,Wk(h,g),u)}function qk(l,r,a,u,h){const g=Math.sqrt(1-u*u);return Math.min(l.dist(r)/3,r.dist(a)/3,h*g/u)}function mA(l,r,a){return l.x<a[0].x&&r.x<a[0].x||l.x>a[1].x&&r.x>a[1].x||l.y<a[0].y&&r.y<a[0].y||l.y>a[1].y&&r.y>a[1].y}function Zk(l,r){return l.x<r[0].x||l.x>r[1].x||l.y<r[0].y||l.y>r[1].y}function Kk(l,r,a){if(l.x<0||l.x>=Mt||r.x<0||r.x>=Mt||a.x<0||a.x>=Mt)return!1;const u=a.sub(r),h=u.perp(),g=l.sub(r);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function Xk(l,r,a){const u=r?2|l:-3&l;return a?1|u:-2&u}function Yk(){const l=Math.PI/32,r=Math.tan(l),a=p;return a*Math.sqrt(1+2*r*r)-a}function Jk(l,r,a){const u=1<<a.z,h=F(a.x/u),g=F((a.x+1)/u),y=W(a.y/u),b=W((a.y+1)/u);return function(A,C,R,k,L=0,$){const U=[];if(!A.length||!R||!k)return U;const Z=(_e,Ee)=>{for(const Me of _e)U.push({polygon:Me,bounds:Ee})},re=Math.ceil(Math.log2(R)),te=Math.ceil(Math.log2(k)),le=re-te,ue=[];for(let _e=0;_e<Math.abs(le);_e++)ue.push(le>0?0:1);for(let _e=0;_e<Math.min(re,te);_e++)ue.push(0),ue.push(1);let pe=A;if(pe=Mb(pe,C[0].y-L,C[1].y+L,1),pe=Mb(pe,C[0].x-L,C[1].x+L,0),!pe.length)return U;const Se=[];for(ue.length?Se.push({polygons:pe,bounds:C,depth:0}):Z(pe,C);Se.length;){const _e=Se.pop(),Ee=_e.depth,Me=ue[Ee],De=_e.bounds[0],nt=_e.bounds[1],Ve=Me===0?De.x:De.y,lt=Me===0?nt.x:nt.y,ft=$?$(Me,Ve,lt):.5*(Ve+lt),pt=Mb(_e.polygons,Ve-L,ft+L,Me),xt=Mb(_e.polygons,ft-L,lt+L,Me);if(pt.length){const wt=[De,new mt(Me===0?ft:nt.x,Me===1?ft:nt.y)];ue.length>Ee+1?Se.push({polygons:pt,bounds:wt,depth:Ee+1}):Z(pt,wt)}if(xt.length){const wt=[new mt(Me===0?ft:De.x,Me===1?ft:De.y),nt];ue.length>Ee+1?Se.push({polygons:xt,bounds:wt,depth:Ee+1}):Z(xt,wt)}}return U}(l,r,Math.ceil((g-h)/11.25),Math.ceil((y-b)/11.25),1,(A,C,R)=>{if(A===0)return .5*(C+R);{const k=W((a.y+C/Mt)/u);return(O(.5*(W((a.y+R/Mt)/u)+k))*u-a.y)*Mt}})}function Z7(l,r,a,u,h,g){const y=Math.pow(2,u.z-h.z);for(let b=0;b<a;b++){let A=l.int16[2*(b+r)+0],C=l.int16[2*(b+r)+1];A=(A+h.x*Mt)*y-u.x*Mt,C=(C+h.y*Mt)*y-u.y*Mt,g.push(new mt(A,C))}}let Qk,ej;Yt(Db,"FillExtrusionBucket",{omit:["layers","features"]}),Yt(Uk,"PartData"),Yt(Vk,"FootprintSegment"),Yt(Gk,"BorderCentroidData"),Yt(pA,"GroundEffect");class ef extends mt{constructor(r,a,u){super(r,a),this.z=u}}class tj extends ef{constructor(r,a,u,h){super(r,a,u),this.w=h}}function rj(l,r,a,u){const h=a==="x"?"y":"x",g=(u-l[a])/(r[a]-l[a]);l[h]=Math.round(l[h]+(r[h]-l[h])*g),l[a]=u,l.hasOwnProperty("z")&&(l.z=xr(l.z,r.z,g)),l.hasOwnProperty("w")&&(l.w=xr(l.w,r.w,g))}function nj(l,r,a,u){const h=a,g=u;for(const y of["x","y"]){let b=l,A=r;b[y]>=A[y]&&(b=r,A=l),b[y]<h&&A[y]>h&&rj(b,A,y,h),b[y]<g&&A[y]>g&&rj(A,b,y,g)}}function Lb(l,r,a,u,h,g){const y=[];for(let b=0;b<l.length;b++){const A=l[b];let C;const R=y.length;let k=0;for(let L=0;L<A.length-1;L++){let $=A[L],U=A[L+1],Z=0;const re=k;let te,le;g&&(Z=Math.hypot(U.x-$.x,U.y-$.y),k+=Z,te=$,le=U),$.x<r&&U.x<r||($.x<r?$=new mt(r,$.y+(r-$.x)/(U.x-$.x)*(U.y-$.y))._round():U.x<r&&(U=new mt(r,$.y+(r-$.x)/(U.x-$.x)*(U.y-$.y))._round()),$.y<a&&U.y<a||($.y<a?$=new mt($.x+(a-$.y)/(U.y-$.y)*(U.x-$.x),a)._round():U.y<a&&(U=new mt($.x+(a-$.y)/(U.y-$.y)*(U.x-$.x),a)._round()),$.x>=u&&U.x>=u||($.x>=u?$=new mt(u,$.y+(u-$.x)/(U.x-$.x)*(U.y-$.y))._round():U.x>=u&&(U=new mt(u,$.y+(u-$.x)/(U.x-$.x)*(U.y-$.y))._round()),$.y>=h&&U.y>=h||($.y>=h?$=new mt($.x+(h-$.y)/(U.y-$.y)*(U.x-$.x),h)._round():U.y>=h&&(U=new mt($.x+(h-$.y)/(U.y-$.y)*(U.x-$.x),h)._round()),C&&$.equals(C[C.length-1])||(C=[$],y.push(C),g&&g.push({progress:{min:re+ij(te,le,$)*Z,max:1},parentIndex:b,prevPoint:te,nextPoint:le})),C.push(U),g&&(g[g.length-1].progress.max=re+ij(te,le,U)*Z,g[g.length-1].nextPoint=le)))))}if(g&&k>0)for(let L=R;L<y.length;L++)g[L].progress.min/=k,g[L].progress.max/=k}return y}function K7(l,r,a,u,h){if(l.length<2)return void u.push(l);const g=[];for(;r.valid();){const[C,R]=r.get();for(let k=0;k<l.length-1;k++){const L=l[k],$=l[k+1],U=$r(L,$,C,R);if(U){const[Z]=U,re=new mt(xr(L.x,$.x,Z),xr(L.y,$.y,Z));g.push({t:k+Z,distance:0,point:re})}}r.next()}if(g.length===0)return void u.push(l);g.sort((C,R)=>C.t-R.t);let y=0,b=0,A=[];for(u.push(A);y!==l.length;){if(b===g.length){for(;y!==l.length;)A.length!==0&&A[A.length-1].equals(l[y])||A.push(l[y]),y++;break}g[b].t<=y?(A.length!==0&&A[A.length-1].equals(g[b].point)||A.push(g[b].point),Math.trunc(g[b].t),b++):(A.length!==0&&A[A.length-1].equals(l[y])||A.push(l[y]),y++)}}function ij(l,r,a){return l.x!==r.x?(a.x-l.x)/(r.x-l.x):l.y!==r.y?(a.y-l.y)/(r.y-l.y):0}function H_(l,r){return l.x*r.x+l.y*r.y}function oj(l,r){if(l.length===1){let a=0;const u=r[a++];let h;for(;!h||u.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const g=r[a],y=l[0],b=h.sub(u),A=g.sub(u),C=y.sub(u),R=H_(b,b),k=H_(b,A),L=H_(A,A),$=H_(C,b),U=H_(C,A),Z=R*L-k*k,re=(L*$-k*U)/Z,te=(R*U-k*$)/Z,le=u.z*(1-re-te)+h.z*re+g.z*te;if(isFinite(le))return le}return 1/0}{let a=1/0;for(const u of r)a=Math.min(a,u.z);return a}}function sj(l,r,a){let u=1/0;An(a,r)&&(u=oj(a,r[0]));for(let h=0;h<r.length;h++){const g=r[h],y=l[h];for(let b=0;b<g.length-1;b++){const A=g[b],C=[A,g[b+1],y[b+1],y[b],A];_n(a,C)&&(u=Math.min(u,oj(a,C)))}}return u!==1/0&&u}function aj(l,r,a,u,h,g,y,b,A,C,R){return l.projection.name==="globe"?function(k,L,$,U,Z,re,te,le,ue,pe,Se){const _e=[],Ee=[],Me=k.projection.upVectorScale(Se,k.center.lat,k.worldSize).metersToTile,De=[0,0,0,1],nt=[0,0,0,1],Ve=(ft,pt,xt,wt)=>{ft[0]=pt,ft[1]=xt,ft[2]=wt,ft[3]=1},lt=Yk();$>0&&($+=lt),U+=lt;for(const ft of L){const pt=[],xt=[];for(const wt of ft){const yt=wt.x+Z.x,_t=wt.y+Z.y,at=k.projection.projectTilePoint(yt,_t,Se),ot=k.projection.upVector(Se,wt.x,wt.y);let vt=$,Ot=U;if(te){const Et=lj(yt,_t,$,U,te,le,ue,pe);vt+=Et.base,Ot+=Et.top}$!==0?Ve(De,at.x+ot[0]*Me*vt,at.y+ot[1]*Me*vt,at.z+ot[2]*Me*vt):Ve(De,at.x,at.y,at.z),Ve(nt,at.x+ot[0]*Me*Ot,at.y+ot[1]*Me*Ot,at.z+ot[2]*Me*Ot),zr(De,De,re),zr(nt,nt,re),pt.push(new ef(De[0],De[1],De[2])),xt.push(new ef(nt[0],nt[1],nt[2]))}_e.push(pt),Ee.push(xt)}return[_e,Ee]}(l,r,a,u,h,g,y,b,A,C,R):y?function(k,L,$,U,Z,re,te,le,ue){const pe=[],Se=[],_e=[0,0,0,1];for(const Ee of k){const Me=[],De=[];for(const nt of Ee){const Ve=nt.x+U.x,lt=nt.y+U.y,ft=lj(Ve,lt,L,$,re,te,le,ue);_e[0]=Ve,_e[1]=lt,_e[2]=ft.base,_e[3]=1,Hi(_e,_e,Z),_e[3]=Math.max(_e[3],1e-5);const pt=new ef(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);_e[0]=Ve,_e[1]=lt,_e[2]=ft.top,_e[3]=1,Hi(_e,_e,Z),_e[3]=Math.max(_e[3],1e-5);const xt=new ef(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);Me.push(pt),De.push(xt)}pe.push(Me),Se.push(De)}return[pe,Se]}(r,a,u,h,g,y,b,A,C):function(k,L,$,U,Z){const re=[],te=[],le=Z[8]*L,ue=Z[9]*L,pe=Z[10]*L,Se=Z[11]*L,_e=Z[8]*$,Ee=Z[9]*$,Me=Z[10]*$,De=Z[11]*$;for(const nt of k){const Ve=[],lt=[];for(const ft of nt){const pt=ft.x+U.x,xt=ft.y+U.y,wt=Z[0]*pt+Z[4]*xt+Z[12],yt=Z[1]*pt+Z[5]*xt+Z[13],_t=Z[2]*pt+Z[6]*xt+Z[14],at=Z[3]*pt+Z[7]*xt+Z[15],ot=wt+le,vt=yt+ue,Ot=_t+pe,Et=Math.max(at+Se,1e-5),or=wt+_e,Ft=yt+Ee,Ht=_t+Me,Qt=Math.max(at+De,1e-5);Ve.push(new ef(ot/Et,vt/Et,Ot/Et)),lt.push(new ef(or/Qt,Ft/Qt,Ht/Qt))}re.push(Ve),te.push(lt)}return[re,te]}(r,a,u,h,g)}function lj(l,r,a,u,h,g,y,b){const A=y*h.getElevationAt(l,r,!0,!0),C=g[0]!==0,R=C?g[1]===0?y*(g[0]/Bk-$k):y*function(k,L,$){const U=Math.floor(L[0]/8),Z=Math.floor(L[1]/8),re=10*(L[0]-8*U),te=10*(L[1]-8*Z),le=k.getElevationAt(U,Z,!0,!0),ue=k.getMeterToDEM($),pe=Math.floor(.5*(re*ue-1)),Se=Math.floor(.5*(te*ue-1)),_e=k.tileCoordToPixel(U,Z),Ee=2*pe+1,Me=2*Se+1,De=function(xt,wt,yt,_t,at){return[xt.getElevationAtPixel(wt,yt,!0),xt.getElevationAtPixel(wt+at,yt,!0),xt.getElevationAtPixel(wt,yt+at,!0),xt.getElevationAtPixel(wt+_t,yt+at,!0)]}(k,_e.x-pe,_e.y-Se,Ee,Me),nt=Math.abs(De[0]-De[1]),Ve=Math.abs(De[2]-De[3]),lt=Math.abs(De[0]-De[2])+Math.abs(De[1]-De[3]),ft=Math.min(.25,.5*ue*(nt+Ve)/Ee),pt=Math.min(.25,.5*ue*lt/Me);return le+Math.max(ft*re,pt*te)}(h,g,b):A;return{base:A+(a===0?-1:a),top:C?Math.max(R+u,A+a+2):A+u}}class X7{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Y7{constructor(){this.tasks={},this.taskQueue=[],Ue(["process"],this),this.invoker=new X7(this.process),this.nextId=0}add(r,a){const u=this.nextId++,h=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-b:g==="maybePrepare"&&y?400-b:500:200-b:100-b}(a);if(h===0){try{r()}finally{}return null}return this.tasks[u]={fn:r,metadata:a,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<a&&(a=g.priority,r=h)}if(r===null)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class cj{constructor(r,a,u){this.target=r,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ue(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Y7}send(r,a,u,h,g=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[b]=u);const A=new Set;return this.target.postMessage({id:b,type:r,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:kl(a,A)},A),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(r){const a=r.data;if(!a)return;const u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(a.mustQueue||dn(self)){const h=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,a),h&&h.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,a)}processTask(r,a){if(delete this.cancelCallbacks[r],a.type==="<response>"){const u=this.callbacks[r];delete this.callbacks[r],u&&(a.error?u(Oc(a.error)):u(null,Oc(a.data)))}else{const u=new Set,h=a.hasCallback?(y,b)=>{this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:y?kl(y):null,data:kl(b,u)},u)}:()=>{},g=Oc(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,g,h);else if(this.parent.getWorkerSource){const y=a.type.split("."),{source:b,scope:A}=g;this.parent.getWorkerSource(a.sourceMapId,y[0],b,A)[y[1]](g,h)}else h(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var W_={workerUrl:"",workerClass:null,workerParams:void 0};const gA="mapboxgl_preloaded_worker_pool";class tf{constructor(r){this.active={},this.name=r}acquire(r,a=tf.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;){const h=(u=`${this.name||""}WorkerPool: ${r}-${this.workers.length}`,W_.workerClass!=null?new W_.workerClass:new self.Worker(W_.workerUrl,Object.assign({name:u},W_.workerParams)));this.workers.push(h)}var u;return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gA]}numActive(){return Object.keys(this.active).length}}tf.workerCount=2;class Pm{constructor(r,a,u="Worker",h=tf.workerCount){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=Fe();const g=this.workerPool.acquire(this.id,h);for(let y=0;y<g.length;y++){const b=new Pm.Actor(g[y],a,this.id);b.name=`${u} ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,a,u){Re(this.actors,(h,g)=>{h.send(r,a,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}let q_,yA;function Nb(){return q_||(q_=new tf),q_}Pm.Actor=cj;const _A=4096;class J7{constructor(r){this.module=r,this.memoryStack=this.module.malloc(_A),this.memoryStackNextFree=this.memoryStack}createIntArray(r){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>_A?-1:(new Int32Array(this.module.heap32.buffer,a,r.length).set(r),a)}createFloatArray(r){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=r.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>_A?-1:(new Float32Array(this.module.heapF32.buffer,a,r.length).set(r),a)}readStringBuffer(r){let a="";for(;this.module.heapU8[r]!==0;)a+=String.fromCharCode(this.module.heapU8[r]),++r;return a}setStyle(r){const a=r.normalScale;this.module.setStyle(a[0],a[1],a[2],r.tileToMeters)}setAOOptions(r,a){this.module.setAOOptions(r?1:0,a)}setMetricOptions(r,a){this.module.setMetricOptions(r?1:0,a)}setStructuralOptions(r){this.module.setStructuralOptions(r?1:0)}setFacadeOptions(r,a){this.module.setFacadeOptions(r,a?1:0)}setFauxFacadeOptions(r,a,u){this.module.setFauxFacadeOptions(r?1:0,a?1:0,u)}setFacadeClassifierOptions(r){this.module.setFacadeClassifierOptions(r)}generateMesh(r,a){this.memoryStackNextFree=this.memoryStack;for(const b of r){const A=this.createIntArray(b.ringIndices),C=this.createFloatArray(b.coordinates);if(A===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,b.roofType,C,A,b.ringIndices.length-1)}for(const b of a){let A;A=b.entrances?JSON.parse(b.entrances):[];const C=this.createFloatArray(A),R=this.createFloatArray(b.coordinates);if(C===-1||R===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,C,A.length,R,b.coordinates.length)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),h=new Array(u);for(let b=0;b<u;b++){const A=this.module.getPositionsPtr(b),C=this.module.getPositionsLength(b),R=new Float32Array(this.module.heapF32.buffer,A,C),k=this.module.getNormalsPtr(b),L=this.module.getNormalsLength(b),$=new Float32Array(this.module.heapF32.buffer,k,L),U=this.module.getAOPtr(b),Z=this.module.getAOLength(b),re=new Float32Array(this.module.heapF32.buffer,U,Z),te=this.module.getUVPtr(b),le=this.module.getUVLength(b),ue=new Float32Array(this.module.heapF32.buffer,te,le),pe=this.module.getFauxFacadePtr(b),Se=this.module.getFauxFacadeLength(b),_e=new Uint8Array(this.module.heapU8.buffer,pe,Se),Ee=this.module.getIndicesPtr(b),Me=this.module.getIndicesLength(b),De=new Int16Array(this.module.heap16.buffer,Ee,Me),nt=this.module.getBuildingPart(b);h[b]={positions:R,normals:$,ao:re,uv:ue,isFauxFacade:_e,indices:De,buildingPart:nt}}const g=this.module.getRingCount(),y=[];for(let b=0;b<g;b++){const A=this.module.getRingPtr(b),C=this.module.getRingLength(b),R=new Float32Array(this.module.heapF32.buffer,A,C);y.push(R)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:y}}}let Z_,vA,Hl,Cm,xA,Im=null,Mm=null,uj=null,zb=null;function dj(){return dn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:vA||Jr.DRACO_URL}function hj(){if(dn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cm)return Cm;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cm=WebAssembly.validate(l)?Jr.MESHOPT_SIMD_URL:Jr.MESHOPT_URL,Cm}function Q7(){return zb}const Fb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},eZ={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},K_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fj(l,r,a){const u=a.json.bufferViews.length,h=a.buffers.length;r.bufferView=u,a.json.bufferViews[u]={buffer:h,byteLength:l.byteLength},a.buffers[h]=l}const bA="KHR_draco_mesh_compression";function tZ(l,r){const a=l.extensions&&l.extensions[bA];if(!a)return;const u=new Hl.Decoder,h=yj(r,a.bufferView),g=new Hl.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=r.json.accessors[l.indices],b=Fb[y.componentType],A=y.count*b.BYTES_PER_ELEMENT,C=Hl._malloc(A);b===Uint16Array?u.GetTrianglesUInt16Array(g,A,C):u.GetTrianglesUInt32Array(g,A,C),fj(Hl.memory.buffer.slice(C,C+A),y,r),Hl._free(C);for(const R of Object.keys(a.attributes)){const k=u.GetAttributeByUniqueId(g,a.attributes[R]),L=r.json.accessors[l.attributes[R]],$=eZ[L.componentType],U=L.count*K_[L.type]*Fb[L.componentType].BYTES_PER_ELEMENT,Z=Hl._malloc(U);u.GetAttributeDataArrayForAllPoints(g,k,Hl[$],U,Z),fj(Hl.memory.buffer.slice(Z,Z+U),L,r),Hl._free(Z)}u.destroy(),g.destroy(),delete l.extensions[bA]}const Bb="EXT_meshopt_compression";function rZ(l,r){if(!l.extensions||!l.extensions[Bb])return;const a=l.extensions[Bb],u=new Uint8Array(r.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),h=new Uint8Array(a.count*a.byteStride);xA.decodeGltfBuffer(h,a.count,a.byteStride,u,a.mode,a.filter),l.buffer=r.buffers.length,l.byteOffset=0,r.buffers[l.buffer]=h.buffer,delete l.extensions[Bb]}const pj=1179937895,mj=new TextDecoder("utf8");function gj(l,r){return new URL(l,r).href}function nZ(l,r,a,u){return fetch(gj(l.uri,u)).then(h=>h.arrayBuffer()).then(h=>{r.buffers[a]=h})}function yj(l,r){const a=l.json.bufferViews[r];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function iZ(l,r,a,u){if(l.uri){const h=gj(l.uri,u);return fetch(h).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{r.images[a]=g})}if(l.bufferView!==void 0){const h=yj(r,l.bufferView),g=new Blob([h],{type:l.mimeType});return createImageBitmap(g).then(y=>{r.images[a]=y})}}function _j(l,r=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(l,r,1)[0]===pj){const R=new Uint32Array(l,r);let k=2;const L=(R[k++]>>2)-3,$=R[k++]>>2;if(k++,u.json=JSON.parse(mj.decode(R.subarray(k,k+$))),k+=$,k<L){const U=R[k++];k++;const Z=r+(k<<2);u.buffers[0]=l.slice(Z,Z+U)}}else u.json=JSON.parse(mj.decode(new Uint8Array(l,r)));const{buffers:h,images:g,meshes:y,extensionsUsed:b,bufferViews:A}=u.json;let C=Promise.resolve();if(h){const R=[];for(let k=0;k<h.length;k++){const L=h[k];L.uri?R.push(nZ(L,u,k,a)):u.buffers[k]||(u.buffers[k]=null)}C=Promise.all(R)}return C.then(()=>{const R=[],k=b&&b.includes(bA),L=b&&b.includes(Bb);if(k&&R.push(function(){if(!Hl)return Z_??(Z_=function($){let U,Z=null;function re(){U=new Uint8Array(Z.buffer)}function te(){throw new Error("Unexpected Draco error.")}const le={a:{a:te,d:function(ue,pe,Se){return U.copyWithin(ue,pe,pe+Se)},c:function(ue){const pe=U.length,Se=Math.max(ue>>>0,Math.ceil(1.2*pe)),_e=Math.ceil((Se-pe)/65536);try{return Z.grow(_e),re(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming($,le):$.then(ue=>ue.arrayBuffer()).then(ue=>WebAssembly.instantiate(ue,le))).then(ue=>{const{Rb:pe,Qb:Se,P:_e,T:Ee,X:Me,Ja:De,La:nt,Qa:Ve,Va:lt,Wa:ft,eb:pt,jb:xt,f:wt,e:yt,yb:_t,zb:at,Ab:ot,Bb:vt,Db:Ot,Gb:Et}=ue.instance.exports;Z=yt;const or=(()=>{let Ft=0,Ht=0,Qt=0,Hr=0;return Pt=>{Qt&&(pe(Hr),pe(Ft),Ht+=Qt,Qt=Ft=0),Ft||(Ht+=128,Ft=Se(Ht));const er=Pt.length+7&-8;let Cr=Ft;er>=Ht&&(Qt=er,Cr=Hr=Se(er));for(let en=0;en<Pt.length;en++)U[Cr+en]=Pt[en];return Cr}})();return re(),wt(),{memory:yt,_free:pe,_malloc:Se,Mesh:class{constructor(){this.ptr=_e()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=De()}destroy(){xt(this.ptr)}DecodeArrayToMesh(Ft,Ht,Qt){const Hr=or(Ft),Pt=nt(this.ptr,Hr,Ht,Qt.ptr);return!!Me(Pt)}GetAttributeByUniqueId(Ft,Ht){return{ptr:Ve(this.ptr,Ft.ptr,Ht)}}GetTrianglesUInt16Array(Ft,Ht,Qt){lt(this.ptr,Ft.ptr,Ht,Qt)}GetTrianglesUInt32Array(Ft,Ht,Qt){ft(this.ptr,Ft.ptr,Ht,Qt)}GetAttributeDataArrayForAllPoints(Ft,Ht,Qt,Hr,Pt){pt(this.ptr,Ft.ptr,Ht.ptr,Qt,Hr,Pt)}},DT_INT8:_t(),DT_UINT8:at(),DT_INT16:ot(),DT_UINT16:vt(),DT_UINT32:Ot(),DT_FLOAT32:Et()}})}(fetch(dj())),Z_.then($=>{Hl=$,Z_=void 0}))}()),L&&R.push(function(){if(xA)return;const $=function(U){let Z;const re=WebAssembly.instantiateStreaming(U,{}).then(ue=>{Z=ue.instance,Z.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},le={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(ue,pe,Se,_e,Ee,Me){(function(De,nt,Ve,lt,ft,pt,xt){const wt=De.exports.sbrk,yt=lt+3&-4,_t=wt(yt*ft),at=wt(pt.length),ot=new Uint8Array(De.exports.memory.buffer);ot.set(pt,at);const vt=nt(_t,lt,ft,at,pt.length);if(vt===0&&xt&&xt(_t,yt,ft),Ve.set(ot.subarray(_t,_t+lt*ft)),wt(_t-wt(0)),vt!==0)throw new Error(`Malformed buffer data: ${vt}`)})(Z,Z.exports[le[Ee]],ue,pe,Se,_e,Z.exports[te[Me]])}}}(fetch(hj()));return $.ready.then(()=>{xA=$})}()),g)for(let $=0;$<g.length;$++)R.push(iZ(g[$],u,$,a));return(R.length?Promise.all(R):Promise.resolve()).then(()=>{if(k&&y)for(const{primitives:$}of y)for(const U of $)tZ(U,u);if(L&&y&&A)for(const $ of A)rZ($,u);return u})})}function vj(l){return fetch(l).then(r=>r.arrayBuffer()).then(r=>_j(r,0,l))}function wA(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function SA(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class TA{constructor(r,a,u,h){this.context=r,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=r.gl.createTexture(),this.update(a,{premultiply:h&&h.premultiply})}update(r,a){const u=r&&r instanceof HTMLVideoElement&&r.width===0?r.videoWidth:r.width,h=r&&r instanceof HTMLVideoElement&&r.height===0?r.videoHeight:r.height,{context:g}=this,{gl:y}=g,{x:b,y:A}=a&&a.position?a.position:{x:0,y:0},C=b+u,R=A+h;!this.size||this.size[0]===C&&this.size[1]===R||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const k=r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ImageBitmap&&r instanceof ImageBitmap;if(!this.size&&C>0&&R>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(C,R)))+1:1;y.texStorage2D(y.TEXTURE_2D,L,this.format,C,R),this.size=[C,R]}this.size&&(k?y.texSubImage2D(y.TEXTURE_2D,0,b,A,wA(this.format),SA(this.format),r):"data"in r&&r.data&&y.texSubImage2D(y.TEXTURE_2D,0,b,A,u,h,wA(this.format),SA(this.format),r.data)),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(r,a,u=!1){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),r!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?r===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),a!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,a),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(r,a,u,h,g){const{context:y}=this,{gl:b}=y;b.bindTexture(b.TEXTURE_2D,this.texture),a!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),this.magFilter=a),r!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?r===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:r),this.minFilter=r),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrapT=h),g!==this.compareMode&&(g?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,g)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=g)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class X_{constructor(r,a){this.context=r,this.texture=a}bind(r,a){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,r),this.minFilter=r),a!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrapS=a)}}const oZ=Kr([{name:"a_pos_3f",components:3,type:"Float32"}]),sZ=Kr([{name:"a_color_3f",components:3,type:"Float32"}]),aZ=Kr([{name:"a_color_4f",components:4,type:"Float32"}]),lZ=Kr([{name:"a_uv_2f",components:2,type:"Float32"}]),cZ=Kr([{name:"a_normal_3f",components:3,type:"Float32"}]),uZ=Kr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),dZ=Kr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function xj(l,r){const a=$b(l.projection,l.zoom,l.width,l.height),u=function(g,y,b,A,C){const R=new c(b.lng-180*kd,b.lat),k=new c(b.lng+180*kd,b.lat),L=g.project(R.lng,R.lat),$=g.project(k.lng,k.lat),U=-Math.atan2($.y-L.y,$.x-L.x),Z=de.fromLngLat(b);Z.y=ne(Z.y,-1+kd,1-kd);const re=Z.toLngLat(),te=g.project(re.lng,re.lat),le=de.fromLngLat(re);le.x+=kd;const ue=le.toLngLat(),pe=g.project(ue.lng,ue.lat),Se=wj(pe.x-te.x,pe.y-te.y,U),_e=de.fromLngLat(re);_e.y+=kd;const Ee=_e.toLngLat(),Me=g.project(Ee.lng,Ee.lat),De=wj(Me.x-te.x,Me.y-te.y,U),nt=Math.abs(Se.x)/Math.abs(De.y),Ve=V([]);he(Ve,Ve,-U*(1-(C?0:A)));const lt=V([]);return ie(lt,lt,[1,1-(1-nt)*A,1]),lt[4]=-De.x/De.y*A,he(lt,lt,U),Q(lt,Ve,lt),lt}(l.projection,0,l.center,a,r),h=bj(l);return ie(u,u,[h,h,1]),u}function bj(l){const r=l.projection,a=$b(l.projection,l.zoom,l.width,l.height),u=AA(r,l.center),h=AA(r,c.convert(r.center));return Math.pow(2,u*a+(1-a)*h)}function $b(l,r,a,u,h=1/0){const g=l.range;if(!g)return 0;const y=Math.min(h,Math.max(a,u)),b=Math.log2(y/1024);return ce(g[0]+b,g[1]+b,r)}const kd=1/4e4;function AA(l,r){const a=ne(r.lat,-q,q),u=new c(r.lng-180*kd,a),h=new c(r.lng+180*kd,a),g=l.project(u.lng,a),y=l.project(h.lng,a),b=de.fromLngLat(u),A=de.fromLngLat(h),C=y.x-g.x,R=y.y-g.y,k=A.x-b.x,L=A.y-b.y,$=Math.sqrt((k*k+L*L)/(C*C+R*R));return Math.log2($)}function wj(l,r,a){const u=Math.cos(a),h=Math.sin(a);return{x:l*u-r*h,y:l*h+r*u}}function Sj(l,r,a){V(l),he(l,l,Zr(r[2])),J(l,l,Zr(r[0])),se(l,l,Zr(r[1])),ie(l,l,a),Q(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Vb(l,r,a,u,h,g,y,b){const A=[a[0]-r[0],a[1]-r[1],0],C=[u[0]-r[0],u[1]-r[1],0];if(it(A)<1e-12||it(C)<1e-12)return Io(l);const R=pr([],A,C);Lt(R,R),rt(C,u,r),A[2]=(g-h)*b,C[2]=(y-h)*b;const k=A;return pr(k,A,C),Lt(k,k),qt(l,R,k)}function Ub(l,r,a=!1){const u=Od(r.zoom),h=function(g,y,b){const A=y.worldSize,C=[g[12],g[13],g[14]],R=W(C[1]/A),k=F(C[0]/A),L=V([]),$=D(1,R)*A,U=D(1,0)*A*Y(R,y.zoom),Z=1/eA(A);let re=U*Z;if(b){const pe=$b(y.projection,y.zoom,y.width,y.height,1024);re=Z*y.projection.pixelSpaceConversion(y.center.lat,A,pe)}const te=Cd(R,k);ut(te,te,$t([],Lt([],te),$*re*C[2]));const le=function(pe){const Se=[pe[0],pe[1],pe[2]];let _e=[0,1,0];const Ee=pr([],_e,Se);return pr(_e,Se,Ee),lr(_e)===0&&(_e=[0,1,0],pr(Ee,Se,_e)),Lt(Ee,Ee),Lt(_e,_e),Lt(Se,Se),[Ee[0],Ee[1],Ee[2],0,_e[0],_e[1],_e[2],0,Se[0],Se[1],Se[2],0,pe[0],pe[1],pe[2],1]}(te);ie(L,L,[re,re,re*$]),X(L,L,[-C[0],-C[1],-C[2]]);const ue=Q([],y.globeMatrix,le);return Q(ue,ue,L),Q(ue,ue,g),ue}(l,r,a);if(u>0){const g=function(y,b){const A=b.worldSize,C=D(1,0)*A*Y(b.center.lat,b.zoom)/eA(A),R=D(1,b.center.lat)*A,k=V([]);se(k,k,Zr(b.center.lng)),J(k,k,Zr(b.center.lat)),X(k,k,[0,0,Xo]),ie(k,k,[C,C,C*R]);const L=b.point;return X(k,k,[-L.x,-L.y,0]),Q(k,k,y),Q(k,b.globeMatrix,k)}(l,r);return function(y,b,A){const C=(U,Z,re)=>{const te=it(U),le=it(Z),ue=Gl(U,Z,re);return $t(ue,ue,1/it(ue)*xr(te,le,re))},R=C([y[0],y[1],y[2]],[b[0],b[1],b[2]],A),k=C([y[4],y[5],y[6]],[b[4],b[5],b[6]],A),L=C([y[8],y[9],y[10]],[b[8],b[9],b[10]],A),$=Gl([y[12],y[13],y[14]],[b[12],b[13],b[14]],A);return[R[0],R[1],R[2],0,k[0],k[1],k[2],0,L[0],L[1],L[2],0,$[0],$[1],$[2],1]}(h,g,u)}return h}function EA(l,r,a,u){const h=rr.projectAabbCorners(u,a);let g=Number.MAX_VALUE;for(let b=0;b<h.length;++b){const A=h[b];A[0]=(.5*A[0]+.5)*r.width,A[1]=(.5-.5*A[1])*r.height,A[2]<g&&(g=A[2])}const y=function(b){const A=[];let C=0;for(let $=1;$<b.length;$++)(b[$][0]<b[C][0]||b[$][0]===b[C][0]&&b[$][1]<b[C][1])&&(C=$);let R,k=C;const L=new Uint8Array(b.length);do{if(L[k])break;A.push(new mt(b[k][0],b[k][1])),L[k]=1,R=(k+1)%b.length;for(let $=0;$<b.length;$++){if(b[$][0]===b[R][0]&&b[$][1]===b[R][1]||b[$][0]===b[k][0]&&b[$][1]===b[k][1])continue;const U=[b[$][0]-b[k][0],b[$][1]-b[k][1]],Z=[b[R][0]-b[k][0],b[R][1]-b[k][1]],re=U[0]*Z[1]-U[1]*Z[0];(re>0||re===0&&U[0]*Z[0]+U[1]*Z[1]>=0&&U[0]*U[0]+U[1]*U[1]>Z[0]*Z[0]+Z[1]*Z[1])&&(R=$)}k=R}while(k!==C);return A.length>0&&A.push(A[0]),A}(h);if(_n(l,y))return g}const rf=64,Om={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Gb(l,r,a,u,h,g,y,b,A,C=!1){const R=a.zoom,k=a.project(u),L=Y(u.lat,R),$=1/L;V(l),X(l,l,[k.x+y[0]*$,k.y+y[1]*$,y[2]]);let U=1,Z=1;const re=a.worldSize;if(C){if(a.projection.name==="mercator"){let pe=0;a.elevation&&(pe=a.elevation.getAtPointOrZero(new de(k.x/re,k.y/re),0));const Se=Hi([],[k.x,k.y,pe,1],a.projMatrix)[3]/a.cameraToCenterDistance;U=Se,Z=Se*Y(a.center.lat,R)}else if(a.projection.name==="globe"){const pe=Ub(l,a),Se=[0,0,0,1];Hi(Se,Se,Q([],a.projMatrix,pe));const _e=Se[3]/a.cameraToCenterDistance,Ee=Od(R),Me=a.projection.pixelsPerMeter(u.lat,re)*Y(u.lat,R),De=a.projection.pixelsPerMeter(a.center.lat,re)*Y(a.center.lat,R);U=_e/xr(Me,ee(a.center.lat),Ee),Z=_e*L/Me,U*=De,Z*=De}}else U=$;ie(l,l,[U,U,Z]);const te=[...l],le=r.orientation,ue=[];if(Sj(ue,[le[0]+(h?h[0]:0),le[1]+(h?h[1]:0),le[2]+(h?h[2]:0)],g),Q(l,te,ue),b&&a.elevation){let pe=0;const Se=[];if(A&&a.elevation){pe=function(Ee,Me,De,nt,Ve){const lt=Me.elevation;if(!lt)return 0;const ft=rr.projectAabbCorners(De,nt),pt=D(1,Ve.lat)*Me.worldSize,xt=function(Ht,Qt){const Hr=[0,0,1],Pt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const er of Pt){const Cr=Ht[er.corners[0]],en=Ht[er.corners[1]],sn=Ht[er.corners[2]],Dr=[en[0]-Cr[0],en[1]-Cr[1],Qt*(en[2]-Cr[2])],Un=pr(Dr,Dr,[sn[0]-Cr[0],sn[1]-Cr[1],Qt*(sn[2]-Cr[2])]);Lt(Un,Un),er.dotProductWithUp=nr(Un,Hr)}return Pt.sort((er,Cr)=>er.dotProductWithUp-Cr.dotProductWithUp),Pt[0].corners}(ft,pt),wt=ft[xt[0]],yt=ft[xt[1]],_t=ft[xt[2]],at=ft[xt[3]],ot=lt.getAtPointOrZero(new de(wt[0]/Me.worldSize,wt[1]/Me.worldSize),0),vt=lt.getAtPointOrZero(new de(yt[0]/Me.worldSize,yt[1]/Me.worldSize),0),Ot=lt.getAtPointOrZero(new de(_t[0]/Me.worldSize,_t[1]/Me.worldSize),0),Et=lt.getAtPointOrZero(new de(at[0]/Me.worldSize,at[1]/Me.worldSize),0),or=(ot+Et)/2,Ft=(vt+Ot)/2;return or>Ft?vt<Ot?Vb(Ee,yt,at,wt,vt,Et,ot,pt):Vb(Ee,_t,wt,at,Ot,ot,Et,pt):ot<Et?Vb(Ee,wt,yt,_t,ot,vt,Ot,pt):Vb(Ee,at,_t,yt,Et,Ot,vt,pt),Math.max(or,Ft)}(Se,a,r.aabb,l,u);const _e=Q([],Oe([],Se),ue);Q(l,te,_e)}else pe=a.elevation.getAtPointOrZero(new de(k.x/re,k.y/re),0);pe!==0&&(l[14]+=pe)}}class Tj{constructor(r,a,u,h,g){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=r,this.uri=a,this.position=u!=null?new c(u[0],u[1]):new c(0,0),this.orientation=h??[0,0,0],this.nodes=g,this.uploaded=!1,this.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,a){Q(r.globalMatrix,a,r.localMatrix);const u=this.nodeOverrides.get(r.name);if(u!==void 0){const y=[];g=u.orientation,V(h=y),se(h,h,Zr(g[1])),he(h,h,Zr(g[2])),J(h,h,Zr(g[0])),Q(r.globalMatrix,r.globalMatrix,y)}var h,g;if(r.meshes)for(const y of r.meshes){const b=rr.applyTransformFast(y.aabb,r.globalMatrix);this.aabb.encapsulate(b)}if(r.children)for(const y of r.children)this._applyTransformations(y,r.globalMatrix)}computeBoundsAndApplyParent(){const r=V([]);this.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,r)}computeModelMatrix(r,a,u,h,g,y,b=!1){Gb(this.matrix,this,r.transform,this.position,a,u,h,g,y,b)}upload(r){if(!this.uploaded){for(const a of this.nodes)PA(a,r);for(const a of this.nodes)Hb(a);this.uploaded=!0}}destroy(){for(const r of this.nodes)CA(r)}}function Y_(l,r,a=!1){l.uploaded||(l.gfxTexture=new TA(r,l.image,a?r.gl.R8:r.gl.RGBA8,{useMipmap:l.sampler.minFilter>=r.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function hZ(l,r,a){l.indexBuffer=r.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=r.createVertexBuffer(l.vertexArray,oZ.members,!1,!0),l.normalArray&&(l.normalBuffer=r.createVertexBuffer(l.normalArray,cZ.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=r.createVertexBuffer(l.texcoordArray,lZ.members,!1,!0)),l.colorArray&&(l.colorBuffer=r.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?sZ:aZ).members,!1,!0)),l.featureArray&&(l.pbrBuffer=r.createVertexBuffer(l.featureArray,dZ.members,!0)),l.segments=_i.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const u=l.material;u.pbrMetallicRoughness.baseColorTexture&&Y_(u.pbrMetallicRoughness.baseColorTexture,r),u.pbrMetallicRoughness.metallicRoughnessTexture&&Y_(u.pbrMetallicRoughness.metallicRoughnessTexture,r),u.normalTexture&&Y_(u.normalTexture,r),u.occlusionTexture&&Y_(u.occlusionTexture,r,a),u.emissionTexture&&Y_(u.emissionTexture,r)}function PA(l,r,a){if(l.meshes)for(const u of l.meshes)hZ(u,r,a);if(l.children)for(const u of l.children)PA(u,r,a)}function Hb(l){if(l.meshes)for(const r of l.meshes)r.indexArray.destroy(),r.vertexArray.destroy(),r.colorArray&&r.colorArray.destroy(),r.normalArray&&r.normalArray.destroy(),r.texcoordArray&&r.texcoordArray.destroy(),r.featureArray&&r.featureArray.destroy();if(l.children)for(const r of l.children)Hb(r)}function CA(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((r=a.material).pbrMetallicRoughness.baseColorTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture&&r.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),r.pbrMetallicRoughness.metallicRoughnessTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&r.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),r.normalTexture&&r.normalTexture.gfxTexture&&r.normalTexture.gfxTexture.destroy(),r.emissionTexture&&r.emissionTexture.gfxTexture&&r.emissionTexture.gfxTexture.destroy(),r.occlusionTexture&&r.occlusionTexture.gfxTexture&&r.occlusionTexture.gfxTexture.destroy()));var r;if(l.children)for(const a of l.children)CA(a)}function nf(l,r){const a=l.json.bufferViews[r.bufferView],u=Fb[r.componentType];return new u(l.buffers[a.buffer],(r.byteOffset||0)+(a.byteOffset||0),r.count*(a.byteStride&&a.byteStride!==K_[r.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:K_[r.type]))}function IA(l,r,a,u){const h=Fb[r.componentType],g=function(R){switch(R){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),y=l.json.bufferViews[r.bufferView],b=y.byteStride?y.byteStride/h.BYTES_PER_ELEMENT:K_[r.type],A=a.float32,C=A.length/a.capacity;for(let R=0,k=0;R<r.count*b;R+=b,k+=C)for(let L=0;L<C;L++)A[k+L]=u[R+L]*g;a._trim()}function fZ(l,r,a){const u=l.indices,h=l.attributes,g={};g.indexArray=new to;const y=r.json.accessors[u],b=y.count/3;g.indexArray.reserve(b);const A=nf(r,y);for(let L=0;L<b;L++)g.indexArray.emplaceBack(A[3*L],A[3*L+1],A[3*L+2]);g.indexArray._trim(),g.vertexArray=new Ys;const C=r.json.accessors[h.POSITION];g.vertexArray.reserve(C.count);const R=nf(r,C);for(let L=0;L<C.count;L++)g.vertexArray.emplaceBack(R[3*L],R[3*L+1],R[3*L+2]);if(g.vertexArray._trim(),g.aabb=new rr(C.min,C.max),g.centroid=function(L,$){const U=[0,0,0],Z=L.length;if(Z>0){for(let re=0;re<Z;re++){const te=3*L[re];U[0]+=$[te],U[1]+=$[te+1],U[2]+=$[te+2]}U[0]/=Z,U[1]/=Z,U[2]/=Z}return U}(A,R),h.COLOR_0!==void 0){const L=r.json.accessors[h.COLOR_0],$=K_[L.type],U=nf(r,L);g.colorArray=$===3?new Ys:new kc,g.colorArray.resize(L.count),IA(r,L,g.colorArray,U)}if(h.NORMAL!==void 0){g.normalArray=new Ys;const L=r.json.accessors[h.NORMAL];g.normalArray.resize(L.count);const $=nf(r,L);IA(r,L,g.normalArray,$)}if(h.TEXCOORD_0!==void 0&&a.length>0){g.texcoordArray=new ll;const L=r.json.accessors[h.TEXCOORD_0];g.texcoordArray.resize(L.count);const $=nf(r,L);IA(r,L,g.texcoordArray,$)}if(h._FEATURE_ID_RGBA4444!==void 0){const L=r.json.accessors[h._FEATURE_ID_RGBA4444];r.json.extensionsUsed&&r.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=nf(r,L))}h._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(nf(r,r.json.accessors[h._FEATURE_RGBA4444]).buffer));const k=l.material;return g.material=function(L,$){const{emissiveFactor:U=[0,0,0],alphaMode:Z="OPAQUE",alphaCutoff:re=.5,normalTexture:te,occlusionTexture:le,emissiveTexture:ue,doubleSided:pe,name:Se}=L,{baseColorFactor:_e=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Me=1,baseColorTexture:De,metallicRoughnessTexture:nt}=L.pbrMetallicRoughness||{},Ve=le?$[le.index]:void 0;if(le&&le.extensions&&le.extensions.KHR_texture_transform&&Ve){const lt=le.extensions.KHR_texture_transform;Ve.offsetScale=[lt.offset[0],lt.offset[1],lt.scale[0],lt.scale[1]]}return{name:Se,pbrMetallicRoughness:{baseColorFactor:new kn(..._e),metallicFactor:Ee,roughnessFactor:Me,baseColorTexture:De?$[De.index]:void 0,metallicRoughnessTexture:nt?$[nt.index]:void 0},doubleSided:pe,emissiveFactor:new kn(...U),alphaMode:Z,alphaCutoff:re,normalTexture:te?$[te.index]:void 0,occlusionTexture:Ve,emissionTexture:ue?$[ue.index]:void 0,defined:L.defined===void 0}}(k!==void 0?r.json.materials[k]:{defined:!1},a),g}function Aj(l,r,a){const{matrix:u,rotation:h,translation:g,scale:y,mesh:b,extras:A,children:C,name:R}=l,k={};if(k.name=R,k.localMatrix=u||function(L,$,U,Z){var re=$[0],te=$[1],le=$[2],ue=$[3],pe=re+re,Se=te+te,_e=le+le,Ee=re*pe,Me=re*Se,De=re*_e,nt=te*Se,Ve=te*_e,lt=le*_e,ft=ue*pe,pt=ue*Se,xt=ue*_e,wt=Z[0],yt=Z[1],_t=Z[2];return L[0]=(1-(nt+lt))*wt,L[1]=(Me+xt)*wt,L[2]=(De-pt)*wt,L[3]=0,L[4]=(Me-xt)*yt,L[5]=(1-(Ee+lt))*yt,L[6]=(Ve+ft)*yt,L[7]=0,L[8]=(De+pt)*_t,L[9]=(Ve-ft)*_t,L[10]=(1-(Ee+nt))*_t,L[11]=0,L[12]=U[0],L[13]=U[1],L[14]=U[2],L[15]=1,L}([],h||[0,0,0,1],g||[0,0,0],y||[1,1,1]),k.globalMatrix=z(k.localMatrix),b!==void 0){k.meshes=a[b];const L=k.anchor=[0,0];for(const $ of k.meshes){const{min:U,max:Z}=$.aabb;L[0]+=U[0]+Z[0],L[1]+=U[1]+Z[1]}L[0]=Math.floor(L[0]/k.meshes.length/2),L[1]=Math.floor(L[1]/k.meshes.length/2)}if(A&&(A.id&&(k.id=A.id),A.lights&&(k.lights=function(L){if(!L.length)return[];const $=function(le){const ue=atob(le),pe=new Uint8Array(ue.length);for(let Se=0;Se<ue.length;Se++)pe[Se]=ue.codePointAt(Se);return pe}(L),U=[],Z=$.length/24,re=new Uint16Array($.buffer),te=new Float32Array($.buffer);for(let le=0;le<Z;le++){const ue=re[2*le*6]/30,pe=re[2*le*6+1]/30,Se=re[2*le*6+10]/100,_e=te[6*le+1],Ee=te[6*le+2],Me=te[6*le+3],De=te[6*le+4],nt=Me-_e,Ve=De-Ee,lt=Math.hypot(nt,Ve);U.push({pos:[_e+.5*nt,Ee+.5*Ve,pe],normal:[Ve/lt,-nt/lt,0],width:lt,height:ue,depth:Se,points:[_e,Ee,Me,De]})}return U}(A.lights)),A.MAPBOX_geometry_bloom&&(k.isGeometryBloom=A.MAPBOX_geometry_bloom)),C){const L=[];for(const $ of C)L.push(Aj(r.json.nodes[$],r,a));k.children=L}return k}function pZ(l){if(l.vertices.length===0||l.indices.length===0)return null;const r=new Ob(l.vertices,l.indices,8,256),[a,u]=[r.min.clone(),r.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:r,min:a,max:u}}function mZ(l){if(!l.extras||!l.extras.ground)return null;const r=l.extras.ground;if(!r||!Array.isArray(r)||r.length===0)return null;const a=r[0];if(!a||!Array.isArray(a)||a.length===0)return null;const u=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const b=y[0],A=y[1];typeof b=="number"&&typeof A=="number"&&u.push(new mt(b,A))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let y=0;y<u.length;y++){const b=u[y],A=u[(y+1)%u.length],C=u[(y+2)%u.length];h+=(b.x-A.x)*(C.y-A.y)-(C.x-A.x)*(b.y-A.y)}h>0&&u.reverse();const g=Am(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function gZ(l,r){const a=[],u=[];let h=0;const g=[];for(const y of l){h=a.length;const b=y.vertexArray.float32,A=y.indexArray.uint16;for(let C=0;C<y.vertexArray.length;C++)g[0]=b[3*C+0],g[1]=b[3*C+1],g[2]=b[3*C+2],zr(g,g,r),a.push(new mt(g[0],g[1]));for(let C=0;C<3*y.indexArray.length;C++)u.push(A[C]+h)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const b=a[u[y+0]],A=a[u[y+1]],C=a[u[y+2]];(b.x-A.x)*(C.y-A.y)-(C.x-A.x)*(b.y-A.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:a,indices:u}}function MA(l){const r=function(A,C){const R=[],k=WebGL2RenderingContext;if(A.json.textures)for(const L of A.json.textures){const $={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};L.sampler!==void 0&&Object.assign($,A.json.samplers[L.sampler]),R.push({image:C[L.source],sampler:$,uploaded:!1})}return R}(l,l.images),a=function(A,C){const R=[];for(const k of A.json.meshes){const L=[];for(const $ of k.primitives)L.push(fZ($,A,C));R.push(L)}return R}(l,r),{scenes:u,scene:h,nodes:g}=l.json,y=u?u[h||0].nodes:[...g.keys()],b=[];for(const A of y)b.push(Aj(g[A],l,a));return function(A,C,R){const k={},L=new Set;for(let $=0;$<A.length;$++){const U=R[C[$]];if(!U.extras)continue;const Z=U.extras["mapbox:footprint:version"],re=U.extras["mapbox:footprint:id"];(Z||re)&&L.add($),Z==="1.0.0"&&re&&(k[re]=$)}for(let $=0;$<A.length;$++){if(L.has($))continue;const U=A[$],Z=R[C[$]];if(!Z.extras)continue;let re=null;U.id in k&&(re=gZ(A[k[U.id]].meshes,U.localMatrix)),re||(re=mZ(Z)),re&&(U.footprint=pZ(re))}if(L.size>0){const $=Array.from(L.values()).sort((U,Z)=>U-Z);for(let U=$.length-1;U>=0;U--)A.splice($[U],1)}}(b,y,l.json.nodes),b}function yZ(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const r=l.vertexArray.float32,a=l.aabb.min[0]-1,u=l.aabb.min[1]-1,h=rf/(l.aabb.max[0]-a+2),g=rf/(l.aabb.max[1]-u+2);for(let y=0;y<r.length;y+=3){const b=r[y+2],A=(r[y+0]-a)*h|0,C=(r[y+1]-u)*g|0;b>l.heightmap[C*rf+A]&&(l.heightmap[C*rf+A]=b)}}function Ej(l,r,a,u,h){a.reserve(a.length+4*l.length),u.reserve(u.length+10*l.length),h.reserve(h.length+10*l.length);let g=u.length;for(const y of l){const b=Math.min(10,Math.max(4,1.3*y.height))*r,A=[-y.normal[1],y.normal[0],0],C=Math.min(.29,.1*y.width/y.depth),R=y.width-2*y.depth*r*(C+.01),k=br([],y.pos,A,R/2),L=br([],y.pos,A,-R/2),$=[k[0],k[1],k[2]+y.height],U=[L[0],L[1],L[2]+y.height],Z=br([],y.normal,A,C);$t(Z,Z,b);const re=br([],y.normal,A,-C);$t(re,re,b),ut(Z,k,Z),ut(re,L,re),k[2]+=.1,L[2]+=.1,u.emplaceBack(Z[0],Z[1],Z[2]),u.emplaceBack(re[0],re[1],re[2]),u.emplaceBack(k[0],k[1],k[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack($[0],$[1],$[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(k[0],k[1],k[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack(Z[0],Z[1],Z[2]),u.emplaceBack(re[0],re[1],re[2]);const te=R/b/2;h.emplaceBack(-te-C,-1,te,.8),h.emplaceBack(te+C,-1,te,.8),h.emplaceBack(-te,0,te,1.3),h.emplaceBack(te,0,te,1.3),h.emplaceBack(te+C,-.8,te,.7),h.emplaceBack(te+C,-.8,te,.7),h.emplaceBack(0,0,te,1.3),h.emplaceBack(0,0,te,1.3),h.emplaceBack(te+C,-1.2,te,.8),h.emplaceBack(te+C,-1.2,te,.8),a.emplaceBack(6+g,4+g,8+g),a.emplaceBack(7+g,9+g,5+g),a.emplaceBack(0+g,1+g,2+g),a.emplaceBack(1+g,3+g,2+g),g+=10}}function _Z(l,r){const a={};a.indexArray=new to,a.vertexArray=new Ys,a.colorArray=new kc,Ej(l,r,a.indexArray,a.vertexArray,a.colorArray);const u={defined:!0};u.emissiveFactor=kn.black;const h={};return h.baseColorFactor=kn.white,u.pbrMetallicRoughness=h,a.material=u,a.aabb=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const Pj=Kr([{name:"a_pos_3f",components:3,type:"Float32"}]),vZ=Kr([{name:"a_normal_3",components:3,type:"Int16"}]),xZ=Kr([{name:"a_centroid_3",components:3,type:"Int16"}]),Cj=Kr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),bZ=Kr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),wZ=Kr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),SZ=Kr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),TZ=Kr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),AZ=Kr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Ij=Ne.types,Wb=32767;function EZ(l,r){const a=Mt+r;for(const u of l)for(const h of u)if(h.x<-r||h.x>a||h.y<-r||h.y>a)return!1;return!0}function PZ(l){switch(l){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${l}`)}}class OA{constructor(){this.layoutVertexArray=new Ys,this.layoutAttenuationArray=new kc,this.layoutColorArray=new Js,this.indexArray=new to,this.indexArrayForConflation=new to,this.segmentsBucket=new _i}}class RA{constructor(r){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new _i,this.entranceBloom=new OA;const a=66560;this.layoutVertexArray=new Ys,this.layoutVertexArray.reserve(a),this.layoutNormalArray=new wd,this.layoutNormalArray.reserve(a),this.layoutCentroidArray=new wd,this.layoutCentroidArray.reserve(a),this.layoutColorArray=new Js,this.layoutColorArray.reserve(a),this.layoutFloodLightDataArray=new jc,this.layoutFloodLightDataArray.reserve(a),this.layoutAOArray=new fm,this.layoutAOArray.reserve(a),this.indexArray=new to,this.indexArray.reserve(66560),this.indexArrayForConflation=new to,this.segmentsBucket=new _i,this.entranceBloom=new OA,r&&(this.layoutFacadePaintArray=new Js,this.layoutFacadeDataArray=new Eu,this.layoutFacadeVerticalRangeArray=new Js)}reserve(r,a,u){this.layoutVertexArray.reserveForAdditional(r),this.layoutCentroidArray.reserveForAdditional(r),this.layoutFloodLightDataArray.reserveForAdditional(r),this.layoutNormalArray.reserveForAdditional(r),this.layoutAOArray.reserveForAdditional(r),this.layoutColorArray.reserveForAdditional(r),this.indexArray.reserveForAdditional(a),u&&(this.layoutFacadePaintArray.reserveForAdditional(r),this.layoutFacadeDataArray.reserveForAdditional(r),this.layoutFacadeVerticalRangeArray.reserveForAdditional(r))}}class Mj{constructor(r){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new ll,this.footprintsIndices=new jc,this.footprintsMin=new mt(1/0,1/0),this.footprintsMax=new mt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new RA(!1),this.buildingWithFacade=new RA(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=r.zoom,this.canonical=r.canonical,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.hasPattern=!1,this.worldview=r.worldview,this.lut=r.lut,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection,this.groundEffect=new pA(r),this.groundEffect.groundRadiusArray=new Nl,this.hasAppearances=null}updateFootprints(r,a){const u=new Ob([],[],1),h={vertices:[],indices:new Uint32Array(0),grid:u,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};a.push({footprint:h,id:r})}updateAppearances(r,a,u,h){}prepare(){return function(){if(zb!=null||uj!=null)return null;if(Mm!=null)return Mm;const r=fetch(Jr.BUILDING_GEN_URL);return Mm=function(a){let u,h,g,y,b;function A(){u=new Uint8Array(b.buffer),h=new Int16Array(b.buffer),g=new Int32Array(b.buffer),y=new Float32Array(b.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const R=()=>{},k={a:{a:C,f:function(L){const $=u.length,U=Math.max(L>>>0,Math.ceil(1.2*$)),Z=Math.ceil((U-$)/65536);try{return b.grow(Z),A(),!0}catch{return!1}},g:C,b:R,c:R,d:R,e:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,k):a.then(L=>L.arrayBuffer()).then(L=>WebAssembly.instantiate(L,k))).then(L=>{const $=L.instance.exports;return(0,$.g)(),b=$.f,A(),new J7({setStyle:$.h,setAOOptions:$.i,setMetricOptions:$.j,setStructuralOptions:$.k,setFacadeOptions:$.l,setFauxFacadeOptions:$.m,setFacadeClassifierOptions:$.n,addFeature:$.o,addFacade:$.p,generateMesh:$.q,getLastError:$.r,getOuterRingLength:$.s,getMeshCount:$.t,getPositionsPtr:$.u,getPositionsLength:$.v,getNormalsPtr:$.w,getNormalsLength:$.x,getAOPtr:$.y,getAOLength:$.z,getUVPtr:$.A,getUVLength:$.B,getFauxFacadePtr:$.C,getFauxFacadeLength:$.D,getIndicesPtr:$.E,getIndicesLength:$.F,getBuildingPart:$.G,getRingCount:$.H,getRingPtr:$.I,getRingLength:$.J,malloc:$.K,free:$.L,heapU8:u,heap16:h,heap32:g,heapF32:y})})}(r).then(a=>(Mm=null,zb=a,zb)).catch(a=>{Ut("Could not load building-gen"),Mm=null,uj=a}),Mm}()}populate(r,a,u,h){const g=Q7();if(!g)return;const y=oe(u);this.tileToMeter=y,this.brightness=a.brightness,g.setStyle({normalScale:[1,-1,y],tileToMeters:y}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeClassifierOptions(3);const b=new Map,A=new Map;let C=0;for(const{feature:te}of r){if(Ij[te.type]!=="LineString"){b.set(te.id,te.properties.source_id);continue}const le=this.layers[0]._featureFilter.needGeometry;if(le&&!this.layers[0]._featureFilter.filter(new si(this.zoom),te,u))continue;const ue=$e(te,le);if(!le&&!this.layers[0]._featureFilter.filter(new si(this.zoom),ue,u))continue;const pe=le?ue.geometry:Ce(te,u,h),Se=[];for(const De of pe)for(const nt of De)Se.push(nt.x),Se.push(nt.y);const _e={coordinates:Se,crossPerc:te.properties.cross_perc,distanceToRoad:te.properties.distance_to_road,entrances:te.properties.entrances,sourceId:0},Ee=te.properties.source_id;let Me=A.get(Ee);Me||(Me=[],A.set(Ee,Me)),Me.push(_e),++C}this.maxHeight=0;const R=new Array,k=new Set,L=te=>{te!=null&&k.add(te)},$=(te,le)=>{te!=null&&R.push({buildingId:te,footprintIndex:le})},U=64*(r.length-C),Z=U/2;this.buildingWithFacade.reserve(U,Z,!0),this.buildingWithoutFacade.reserve(2*U,2*Z,!1),this.footprintsIndices.reserve(16*(r.length-C)),this.footprintsVertices.reserve(8*(r.length-C));for(const{feature:te,id:le,index:ue,sourceLayerIndex:pe}of r){if(Ij[te.type]==="LineString")continue;const Se=this.layers[0]._featureFilter.needGeometry;if(Se&&!this.layers[0]._featureFilter.filter(new si(this.zoom),te,u))continue;let _e=null;if(te.properties&&te.properties.hasOwnProperty("building_id")&&(_e=te.properties.building_id,k.has(_e)))continue;const Ee=$e(te,Se);if(!Se&&!this.layers[0]._featureFilter.filter(new si(this.zoom),Ee,u))continue;const Me=Se?Ee.geometry:Ce(te,u,h),De=B_(Me,500);let nt=!1;for(const yr of De)if(yr.length!==1){nt=!0;break}if(nt){L(_e);continue}if(!EZ(Me,163)){L(_e);continue}const Ve=this.layers[0],lt=PZ(Ve.layout.get("building-roof-shape").evaluate(te,{},u)),ft=Ve.layout.get("building-base").evaluate(te,{},u),pt=Ve.layout.get("building-height").evaluate(te,{},u),xt=Ve.layout.get("building-flood-light-ground-radius").evaluate(te,{},u),wt=Ve.paint.get("building-ambient-occlusion-intensity"),yt=xt/this.tileToMeter;te.properties["building-part"]="roof";const _t=Ve.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),at=Ve.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="wall";const ot=Ve.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=Ve.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="window";const Ot=Ve.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),Et=Ve.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);te.properties["building-part"]="door";const or=Ve.paint.get("building-color").evaluate(te,{},this.canonical).toPremultipliedRenderColor(this.lut),Ft=Ve.paint.get("building-emissive-strength").evaluate(te,{},this.canonical);let Ht=Ve.layout.get("building-flood-light-wall-radius").evaluate(te,{},u);Ht=ne(Ht,0,2048);const Qt=Ht/2048*Wb,Hr=b.get(le),Pt=A.get(Hr)||[],er=Pt.length!==0&&Ve.layout.get("building-facade").evaluate(te,{},u);g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(er,!1,1);let Cr=0,en=0,sn=0,Dr=0,Un=0,ve=0,Te=0,ct=0,bt=0,jt=0,Dt=0;if(er){let yr=Math.round(Ve.layout.get("building-facade-floors").evaluate(te,{},u));if(ft===0){yr=Math.max(1,yr-(Pt.length>0?1:0));let Ln=4;if(pt>100){const mi=[10,13,15];Ln=mi[te.id?te.id%mi.length:0]}else pt<=10&&(Ln=3);g.setFacadeOptions(Ln,!0),Un=(pt<15?1.3:1.61803)*Ln/y}else Un=ft/y;ve=pt/y,Un=Math.min(Un,ve),sn=Ve.layout.get("building-facade-unit-width").evaluate(te,{},u)/y,Dr=(ve-Un)/yr,g.setFauxFacadeOptions(!0,!0,sn);const bi=Ve.layout.get("building-facade-window").evaluate(te,{},u);Cr=bi[0],en=bi[1],Te=Math.floor(65535*Math.min(1,Un/Mt)),ct=Math.floor(65535*Math.min(1,ve/Mt)),bt=Math.floor(255*Cr)<<8|Math.floor(255*en),jt=Math.floor(65535*Math.min(1,sn/Mt)),Dt=Math.floor(65535*Math.min(1,Dr/Mt))}const sr=Array(De.length),ur={x:1/0,y:1/0},Rr={x:-1/0,y:-1/0},Vr={x:0,y:0};let Gr=0;for(let yr=0;yr<De.length;yr++){const bi=De[yr];if(bi.length>0){const Ln=[],mi=Array(bi.length+1);mi[0]=0;for(let io=0;io<bi.length;io++){const Eo=bi[io];for(let Zi=0;Zi<Eo.length;Zi++){const Ki=Eo[Eo.length-Zi-1];ur.x=Math.min(ur.x,Ki.x),ur.y=Math.min(ur.y,Ki.y),Rr.x=Math.max(Rr.x,Ki.x),Rr.y=Math.max(Rr.y,Ki.y),Vr.x+=Ki.x,Vr.y+=Ki.y,Gr++,Ln.push(Ki.x),Ln.push(Ki.y)}mi[io+1]=Ln.length}sr[yr]={id:te.id?te.id:0,height:pt,minHeight:ft,sourceId:0,roofType:lt,coordinates:Ln,ringIndices:mi}}}Vr.x/=Gr||1,Vr.y/=Gr||1;const Xr=g.generateMesh(sr,Pt);if(typeof Xr=="string"){Ut(`Unable to generate building ${te.id}: ${Xr}`),L(_e);continue}if(Xr.meshes.length===0||Xr.modifiedPolygonRings.length===0){L(_e);continue}const _r=er?this.buildingWithFacade:this.buildingWithoutFacade;let Er=0;for(const yr of Xr.meshes)Er+=yr.positions.length/3;const pn=_r.segmentsBucket.prepareSegment(Er,_r.layoutVertexArray,_r.indexArray),xn=[];let bn=null,Dn=0,Yn=-1;const Gn=_r.layoutVertexArray.length,Sn=Gn+Er;_r.layoutVertexArray.resize(Sn),_r.layoutCentroidArray.resize(Sn),_r.layoutNormalArray.resize(Sn),_r.layoutAOArray.resize(Sn),_r.layoutColorArray.resize(Sn),_r.layoutFloodLightDataArray.resize(Sn),er&&(_r.layoutFacadePaintArray.resize(Sn),_r.layoutFacadeDataArray.resize(Sn),_r.layoutFacadeVerticalRangeArray.resize(Sn));const In=_r.indexArray.length;let Ur=0,tn=Gn;for(const yr of Xr.meshes){let bi,Ln;if(yr.buildingPart===1)bi=_t,Ln=at;else if(yr.buildingPart===0)bi=ot,Ln=vt;else if(yr.buildingPart===2)bi=Ot,Ln=Et;else{if(yr.buildingPart!==3)continue;bi=or,Ln=Ft}if(Ln=ne(Ln,0,1),yr.buildingPart===3){const oi=new Array;for(let oo=0;oo<yr.positions.length;oo+=12){const hl=yr.positions[oo+0],Fc=yr.positions[oo+1],Wo=yr.positions[oo+3],Ss=yr.positions[oo+4],ra=yr.positions[oo+2],Nd=yr.positions[oo+8]-ra,Gm=1,Xl=Wo-hl,Yl=Ss-Fc,bv=Math.hypot(Xl,Yl);oi.push({pos:[hl+.5*Xl,Fc+.5*Yl,ra],normal:[Yl/bv,-Xl/bv,0],width:bv,height:Nd,depth:Gm,points:[hl,Fc,Wo,Ss]})}const ji=_r.entranceBloom.segmentsBucket.prepareSegment(10*oi.length,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.indexArray),Bi=_r.entranceBloom.layoutVertexArray.length;Dn=_r.entranceBloom.indexArray.length,Ej(oi,.5/this.tileToMeter,_r.entranceBloom.indexArray,_r.entranceBloom.layoutVertexArray,_r.entranceBloom.layoutAttenuationArray);const Vs=_r.entranceBloom.layoutVertexArray.length-Bi;Yn=_r.entranceBloom.indexArray.length-Dn;for(let oo=0;oo<Vs;oo++)_r.entranceBloom.layoutColorArray.emplaceBack(255*or.r<<8|255*or.g,255*or.b<<8|51*Ft);ji.vertexLength+=Vs,ji.primitiveLength+=Yn,bn={part:yr.buildingPart,vertexOffset:Bi,vertexLength:Vs}}_r.layoutVertexArray.float32.set(yr.positions,3*tn);const mi=yr.positions.length/3;for(let oi=0;oi<mi;++oi){const ji=3*oi;Ur=Math.max(Ur,yr.positions[ji+2]);const Bi=yr.normals[ji+1]*Wb,Vs=yr.normals[ji+2]*Wb,oo=3*(tn+oi);_r.layoutNormalArray.int16[oo]=yr.normals[ji]*Wb,_r.layoutNormalArray.int16[oo+1]=Bi,_r.layoutNormalArray.int16[oo+2]=Vs;const hl=yr.ao[oi];_r.layoutAOArray.uint8[tn+oi]=255*hl;const Fc=1+(hl-1)*wt,Wo=255*bi.b*Fc<<8|255*Ln;_r.layoutColorArray.uint16[2*(tn+oi)]=255*bi.r*Fc<<8|255*bi.g*Fc,_r.layoutColorArray.uint16[2*(tn+oi)+1]=Wo}const io=Math.floor(Vr.x),Eo=Math.floor(Vr.y),Zi=Math.floor(pt);for(let oi=0;oi<mi;++oi){const ji=3*(tn+oi);_r.layoutCentroidArray.int16[ji]=io,_r.layoutCentroidArray.int16[ji+1]=Eo,_r.layoutCentroidArray.int16[ji+2]=Zi}if(_r.layoutFloodLightDataArray.uint16.fill(yr.buildingPart===0?Qt:0,tn,tn+mi),er){const oi=255*Ot.r<<8|255*Ot.g,ji=255*Ot.b<<8|255*Et;for(let Bi=0;Bi<mi;++Bi){const Vs=2*(tn+Bi);_r.layoutFacadePaintArray.uint16[Vs]=oi,_r.layoutFacadePaintArray.uint16[Vs+1]=ji}for(let Bi=0;Bi<mi;++Bi)if(yr.isFauxFacade[Bi]){const Vs=Math.min(65535,Math.floor(yr.uv[2*Bi]*Xr.outerRingLength));_r.layoutFacadeDataArray.emplace(tn+Bi,1|Vs,bt,jt,Dt),_r.layoutFacadeVerticalRangeArray.emplace(tn+Bi,Te,ct)}else _r.layoutFacadeDataArray.emplace(tn+Bi,0,0,0,0),_r.layoutFacadeVerticalRangeArray.emplace(tn+Bi,0,0)}const Ki=pn.vertexLength,fo=yr.indices.length/3,js=_r.indexArray.length;_r.indexArray.resize(js+fo);for(let oi=0;oi<fo;++oi){const ji=3*oi,Bi=3*js+ji;_r.indexArray.uint16[Bi]=Ki+yr.indices[ji],_r.indexArray.uint16[Bi+1]=Ki+yr.indices[ji+1],_r.indexArray.uint16[Bi+2]=Ki+yr.indices[ji+2]}yr.buildingPart!==1&&yr.buildingPart!==0&&yr.buildingPart!==2&&yr.buildingPart!==3||xn.push({part:yr.buildingPart,vertexOffset:tn,vertexLength:yr.positions.length/3}),tn+=mi,pn.vertexLength+=mi,pn.primitiveLength+=yr.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Ur);const yi=_r.indexArray.length-In,gr=this.footprintsIndices.length,Yr=this.footprintsVertices.length,Wn=[],ri=new mt(1/0,1/0),ai=new mt(-1/0,-1/0),Fi=this.groundEffect.vertexArray.length;for(const yr of Xr.modifiedPolygonRings){const bi=[],Ln=new mt(1/0,1/0),mi=new mt(-1/0,-1/0);for(let io=0;io<yr.length;io+=2){const Eo=yr.length-io-2;Ln.x=Math.min(Ln.x,yr[Eo]),Ln.y=Math.min(Ln.y,yr[Eo+1]),mi.x=Math.max(mi.x,yr[Eo]),mi.y=Math.max(mi.y,yr[Eo+1]);const Zi=new mt(yr[Eo],yr[Eo+1]);bi.push(Zi),Wn.push(Zi.x,Zi.y),this.footprintsVertices.emplaceBack(Zi.x,Zi.y)}ri.x=Math.min(ri.x,Ln.x),ri.y=Math.min(ri.y,Ln.y),ai.x=Math.max(ai.x,mi.x),ai.y=Math.max(ai.y,mi.y),this.groundEffect.addData(bi,[Ln,mi],yt)}const ii=this.groundEffect.vertexArray.length-Fi;this.groundEffect.groundRadiusArray.reserveForAdditional(ii);for(let yr=0;yr<ii;yr++)this.groundEffect.groundRadiusArray.emplaceBack(xt);(ur.x<0||Rr.x>Mt||ur.y<0||Rr.y>Mt)&&this.featuresOnBorder.push({featureId:te.id,footprintIndex:this.footprints.length});{const yr=Am(Wn,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+yr.length),this.footprintsIndices.uint16.set(yr,gr),this.buildingIds.add(_e??te.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,ri.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,ri.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ai.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ai.y);const bi={footprintVertexOffset:Yr,footprintVertexLength:this.footprintsVertices.length-Yr,footprintIndexOffset:gr,footprintIndexLength:this.footprintsIndices.length-gr,min:ri,max:ai,hiddenFlags:0,indicesOffset:In,indicesLength:yi,bloomIndicesOffset:Dn,bloomIndicesLength:Yn,groundEffectVertexOffset:Fi,groundEffectVertexLength:ii,hasFauxFacade:er,height:Ur,promoteId:le,feature:Ee,parts:xn,buildingBloom:bn},Ln=this.footprints.length;te.id!==void 0&&this.featureFootprintLookup.set(te.id,Ln),$(_e,Ln),this.footprints.push(bi)}this.programConfigurations.populatePaintArrays(_r.layoutVertexArray.length,te,ue,{},a.availableImages,u,a.brightness),this.groundEffect.addPaintPropertiesData(te,ue,{},a.availableImages,u,a.brightness),a.featureIndex.insert(te,Me,ue,pe,this.index,Gn)}R.forEach(({buildingId:te,footprintIndex:le})=>{k.has(te)&&(this.footprints[le].hiddenFlags|=4)});const re=new Set;this.buildingIds.forEach((te,le,ue)=>{k.has(te)||re.add(te)}),this.buildingIds=re,this.groundEffect.prepareBorderSegments()}update(r,a,u,h,g,y,b){this.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b),this.groundEffect.update(r,a,g,u,h,y,b),this.evaluate(this.layers[0],r),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(r){const a=u=>{u.layoutVertexBuffer=r.createVertexBuffer(u.layoutVertexArray,Pj.members),u.layoutNormalBuffer=r.createVertexBuffer(u.layoutNormalArray,vZ.members),u.layoutCentroidBuffer=r.createVertexBuffer(u.layoutCentroidArray,xZ.members),u.layoutFloodLightDataBuffer=r.createVertexBuffer(u.layoutFloodLightDataArray,AZ.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=r.createVertexBuffer(u.layoutFacadeDataArray,wZ.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=r.createVertexBuffer(u.layoutFacadeVerticalRangeArray,SZ.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=r.createVertexBuffer(u.entranceBloom.layoutVertexArray,Pj.members),u.entranceBloom.layoutAttenuationBuffer=r.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,TZ.members)),this.uploadUpdatedColorBuffer(r),this.uploadUpdatedIndexBuffer(r)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(r)),this.groundEffect.uploadPaintProperties(r),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){const r=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(r,a,u=!0){let h=!1;const g=u?a:0,y=0|(u?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of r){const A=this.footprints[b],C=A.hiddenFlags&y|g;A.hiddenFlags!==C&&(A.hiddenFlags=C,h=!0,this.groundEffect.updateHiddenByLandmarkRange(A.groundEffectVertexOffset,A.groundEffectVertexLength,A.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(r){if(this.groundEffect.uploadHiddenByLandmark(r),this.indexArrayForConflationUploaded)return;const a=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const h of this.footprints){const g=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,y=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let A=h.indicesOffset;A<y;A++)g.indexArrayForConflation.uint16[3*A+0]=0,g.indexArrayForConflation.uint16[3*A+1]=0,g.indexArrayForConflation.uint16[3*A+2]=0;const b=h.bloomIndicesOffset+h.bloomIndicesLength;for(let A=h.bloomIndicesOffset;A<b;A++)g.entranceBloom.indexArrayForConflation.uint16[3*A+0]=0,g.entranceBloom.indexArrayForConflation.uint16[3*A+1]=0,g.entranceBloom.indexArrayForConflation.uint16[3*A+2]=0}}const u=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=r.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=r.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(r){const a=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=r.createVertexBuffer(u.layoutColorArray,Cj.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=r.createVertexBuffer(u.layoutFacadePaintArray,bZ.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=r.createVertexBuffer(u.entranceBloom.layoutColorArray,Cj.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(r,a){const u=r.paint.get("building-ambient-occlusion-intensity");for(const h of this.footprints){if(4&h.hiddenFlags)continue;const g=a[h.promoteId],y=h.feature;y.properties["building-part"]="roof";const b=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),A=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="wall";const C=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),R=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="window";const k=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),L=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical);y.properties["building-part"]="door";const $=r.paint.get("building-color").evaluate(y,g,this.canonical).toPremultipliedRenderColor(this.lut),U=r.paint.get("building-emissive-strength").evaluate(y,g,this.canonical),Z=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const te of h.parts){let le,ue=b;te.part===1?(ue=b,le=A):te.part===0?(ue=C,le=R):te.part===2?(ue=k,le=L):te.part===3&&(ue=$,le=U),le=ne(le,0,1);for(let pe=0;pe<te.vertexLength;pe++){const Se=te.vertexOffset+pe,_e=1+(Z.layoutAOArray.uint8[Se]/255-1)*u;Z.layoutColorArray.emplace(Se,ue.r*_e*255<<8|ue.g*_e*255,ue.b*_e*255<<8|255*le),h.hasFauxFacade&&Z.layoutFacadePaintArray.emplace(Se,255*k.r<<8|255*k.g,255*k.b<<8|255*L)}}const re=h.buildingBloom;if(re)for(let te=0;te<re.vertexLength;te++)Z.entranceBloom.layoutColorArray.emplace(re.vertexOffset+te,255*$.r<<8|255*$.g,255*$.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(r,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(r.toUnwrapped());if(kb(this.activeReplacements,h))return;this.activeReplacements=h;for(const y of this.footprints)y.hiddenFlags&=-2;const g=[];for(const y of this.activeReplacements){if(y.order<=Ok)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-r.canonical.z));for(const A of this.footprints)A.min.x>y.max.x||A.max.x<y.min.x||A.min.y>y.max.y||A.max.y<y.min.y||(g.length=0,IZ(this.footprintsVertices,A.footprintVertexOffset,A.footprintVertexLength,y.footprintTileId.canonical,r.canonical,g),dA(y.footprint,g,this.footprintsIndices.uint16,A.footprintIndexOffset,A.footprintIndexLength,0,-b)&&(A.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(r){if(r.id!==void 0){const a=this.featureFootprintLookup.get(r.id);return this.footprints[a]}return null}getHeightAtTileCoord(r,a){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(r+Mt)*Mt+(a+Mt);if(this.footprintLookup.hasOwnProperty(g)){const b=this.footprintLookup[g];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const y=new mt(r,a);for(const b of this.footprints)r>b.max.x||b.min.x>r||a>b.max.y||b.min.y>a||b.height<=u||CZ(y,this.footprintsVertices.float32.subarray(2*b.footprintVertexOffset,2*(b.footprintVertexOffset+b.footprintVertexLength)),this.footprintsIndices.uint16.subarray(b.footprintIndexOffset,b.footprintIndexOffset+b.footprintIndexLength))&&(u=b.height,this.footprintLookup[g]=b,h=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[g]=void 0}}function CZ(l,r,a){for(let u=0;u<a.length;u+=3){const h=a[u],g=a[u+1],y=a[u+2],b=r[2*h+0],A=r[2*h+1],C=r[2*g+0],R=r[2*g+1],k=r[2*y+0],L=r[2*y+1],$=(b-k)*(l.y-L)-(A-L)*(l.x-k),U=(C-b)*(l.y-A)-(R-A)*(l.x-b);if($<0!=U<0&&$!==0&&U!==0)continue;const Z=(k-C)*(l.y-R)-(L-R)*(l.x-C);if(Z===0||Z<0==$+U<=0)return!0}return!1}function IZ(l,r,a,u,h,g){const y=Math.pow(2,u.z-h.z);for(let b=0;b<a;b++){let A=l.float32[2*(b+r)+0],C=l.float32[2*(b+r)+1];A=(A+h.x*Mt)*y-u.x*Mt,C=(C+h.y*Mt)*y-u.y*Mt,g.push(new mt(A,C))}}let Oj,Rj;Yt(Mj,"BuildingBucket",{omit:["layers"]}),Yt(RA,"BuildingGeometry"),Yt(OA,"BuildingBloomGeometry");const MZ=Kr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),OZ=Kr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:RZ}=MZ,kZ=Kr([{name:"a_packed",components:3,type:"Float32"}]),{members:jZ}=kZ,DZ=Kr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:LZ}=DZ;class kj{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new Rd({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const u=this.getKey(r,a);return this.positions[u]}trim(){const r=this.width,a=this.height=Qe(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,u){const h=[];let g=r.length%2==1?-r[r.length-1]*u:0,y=r[0]*u,b=!0;h.push({left:g,right:y,isDash:b,zeroLength:r[0]===0});let A=r[0];for(let C=1;C<r.length;C++){b=!b;const R=r[C];g=A*u,A+=R,y=A*u,h.push({left:g,right:y,isDash:b,zeroLength:R===0})}return h}addRoundDash(r,a,u){const h=a/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let b=0,A=r[b];for(let C=0;C<this.width;C++){C/A.right>1&&(A=r[++b]);const R=Math.abs(C-A.left),k=Math.abs(C-A.right),L=Math.min(R,k);let $;const U=g/u*(h+1);if(A.isDash){const Z=h-Math.abs(U);$=Math.sqrt(L*L+Z*Z)}else $=h-Math.sqrt(L*L+U*U);this.image.data[y+C]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(r,a){for(let A=r.length-1;A>=0;--A){const C=r[A],R=r[A+1];C.zeroLength?r.splice(A,1):R&&R.isDash===C.isDash&&(R.left=C.left,r.splice(A,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,b=r[y];for(let A=0;A<this.width;A++){A/b.right>1&&(b=r[++y]);const C=Math.abs(A-b.left),R=Math.abs(A-b.right),k=Math.min(C,R);this.image.data[g+A]=Math.max(0,Math.min(255,(b.isDash?k:-k)+a+128))}}addDash(r,a){const u=this.getKey(r,a);if(this.positions[u])return this.positions[u];const h=a==="round",g=h?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Ut("LineAtlas out of space"),null;r.length===0&&r.push(1);let b=0;for(let R=0;R<r.length;R++)r[R]<0&&(Ut("Negative value is found in line dasharray, replacing values with 0"),r[R]=0),b+=r[R];if(b!==0){const R=this.width/b,k=this.getDashRanges(r,this.width,R);h?this.addRoundDash(k,R,g):this.addRegularDash(k,a==="square"?.5*R:0)}const A=this.nextRow+g;this.nextRow+=y;const C={tl:[A,g],br:[b,0]};return this.positions[u]=C,C}}Yt(kj,"LineAtlas");const NZ=Ne.types,zZ=Math.cos(Math.PI/180*37.5),FZ=Math.cos(Math.PI/180*5);class kA{constructor(r){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=r.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=r.overscaling,this.pixelRatio=r.pixelRatio,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new sm,this.layoutVertexArray2=new Ys,this.patternVertexArray=new Ys,this.indexArray=new to,this.programConfigurations=new Na(r.layers,{zoom:r.zoom,lut:r.lut}),this.segments=new _i,this.maxLineLength=0,this.zOffsetVertexArray=new Ys,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=r.tessellationStep?r.tessellationStep:Mt/64,this.worldview=r.worldview,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,h){}populate(r,a,u,h){this.hasPattern=oA("line",this.layers,this.pixelRatio,a);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=oe(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),$=L.isConstant()&&!L.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&$?"none":"offset",this.elevationType==="offset"&&y==="none"&&Ut(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const A=[];for(const{feature:L,id:$,index:U,sourceLayerIndex:Z}of r){const re=this.layers[0]._featureFilter.needGeometry,te=$e(L,re);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),te,u))continue;const le=g?g.evaluate(te,{},u):void 0,ue={id:$,properties:L.properties,type:L.type,sourceLayerIndex:Z,index:U,geometry:re?te.geometry:Ce(L,u,h),patterns:{},sortKey:le};A.push(ue)}g&&A.sort((L,$)=>L.sortKey-$.sortKey);const{lineAtlas:C,featureIndex:R}=a,k=this.addConstantDashes(C);for(const L of A){const{geometry:$,index:U,sourceLayerIndex:Z}=L;if(k&&this.addFeatureDashes(L,C),this.hasPattern){const re=sA("line",this.layers,L,this.zoom,this.pixelRatio,a);this.patternFeatures.push(re)}else this.addFeature(L,$,U,u,C.positions,a.availableImages,a.brightness,a.elevationFeatures);R.insert(r[U].feature,$,U,Z,this.index)}}addConstantDashes(r){let a=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(h.kind!=="constant"||g.kind!=="constant")a=!0;else{const y=g.value,b=h.value;if(!b)continue;r.addDash(b,y)}}return a}addFeatureDashes(r,a){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let b,A;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:u},r);A=y.kind==="constant"?y.value:y.evaluate({zoom:u},r),a.addDash(b,A),r.patterns[h.id]=[a.getKey(b,A)]}}update(r,a,u,h,g,y,b,A){this.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,A)}addFeatures(r,a,u,h,g,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,u,h,y,r.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,jZ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=r.createVertexBuffer(this.patternVertexArray,LZ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,OZ.members,!0)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,RZ),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r,a){let u,h;if(a&&a>0?(u=`mapbox_clip_start_${a}`,h=`mapbox_clip_end_${a}`):(u="mapbox_clip_start",h="mapbox_clip_end"),r.properties&&r.properties.hasOwnProperty(u)&&r.properties.hasOwnProperty(h))return{start:+r.properties[u],end:+r.properties[h]}}addFeature(r,a,u,h,g,y,b,A){const C=this.layers[0].layout,R=C.get("line-join").evaluate(r,{}),k=C.get("line-cap").evaluate(r,{}),L=C.get("line-miter-limit"),$=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(r),this.lineFeature=r;const U=!(!r.properties||!r.properties.hasOwnProperty("mapbox_line_metrics"))&&r.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const Z=this.layers[0].paint.get("line-width").value;if(Z.kind!=="constant"&&Z.isLineProgressConstant===!1&&(this.variableWidthValue=Z),this.elevationType==="road"){const re=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(r,a,h,A,R,k,L,$)){const[te,le]=this.clipRuntimeLinesToTile(a,1);for(let ue=0;ue<te.length;ue++){const pe=te[ue],Se=le[ue],_e={progress:{min:Se.progress.min,max:Se.progress.max},nextDir:this.computeSegNextDir(Se,pe),prevDir:this.computeSegPrevDir(Se,pe)};this.addLine(pe,r,h,R,k,L,$,_e,U&&Se.parentIndex>0?Se.parentIndex:null)}this.fillNonElevatedRoadSegment(re)}}else for(let re=0;re<a.length;re++)this.addLine(a[re],r,h,R,k,L,$,void 0,U&&re>0?re:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,g,y,h,b,void 0,this.worldview)}computeSegNextDir(r,a){return r.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(r,a){return a[1].sub(r.prevPoint).unit()}clipLinesToTile(r,a){return Lb(r,-a,-a,Mt+a,Mt+a)}clipRuntimeLinesToTile(r,a){const u=[];return[Lb(r,-a,-a,Mt+a,Mt+a,u),u]}addElevatedRoadFeature(r,a,u,h,g,y,b,A){const C=[],R=Pn.getElevationFeature(r,h);if(R){const k=this.clipLinesToTile(a,1),L=this.prepareElevatedLines(k,R,u);for(const $ of L)C.push({geometry:$,elevation:R,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const k of C){const L=this.layoutVertexArray.length;this.addLine(k.geometry,r,u,g,y,b,A);const $=new Bn(u,k.elevationTileID);if(k.elevation)for(let U=L;U<this.layoutVertexArray.length;U++){const Z=new mt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),re=$.pointElevation(Z,k.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(r,a,u){if(a.constantHeight!=null)return r;const h=[],g=1/oe(u);for(const y of r)K7(y,new vn(a,g),0,h);return h}fillNonElevatedRoadSegment(r){for(let a=r;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(r){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,r),this.heightRange.max=Math.max(this.heightRange.max,r)):this.heightRange={min:r,max:r}}addLine(r,a,u,h,g,y,b,A,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(a,C):this.lineClips;const R=h==="none";this.patternJoinNone=this.hasPattern&&R,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const k=A&&A.progress.min>0,L=A&&A.progress.max<1;if(this.lineClips){let De={min:this.lineClips.start,max:this.lineClips.end},nt=1;if(A){const ft=this.lineClips.end-this.lineClips.start;De=function(pt,xt,wt){return{min:ti(pt.min,xt,wt),max:ti(pt.max,xt,wt)}}(A.progress,{min:0,max:1},De),ft>0&&(nt=(De.max-De.min)/ft)}const Ve=+a.properties.mapbox_clip_feature_len,lt=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Ve)||Number.isNaN(lt)){for(let pt=0;pt<r.length-1;pt++)this.totalDistance+=r[pt].dist(r[pt+1]);const ft=this.totalDistance/(De.max-De.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ve,this.distance=lt*nt,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const $=NZ[a.type]==="Polygon";let U=r.length;for(;U>=2&&r[U-1].equals(r[U-2]);)U--;let Z=0;for(;Z<U-1&&r[Z].equals(r[Z+1]);)Z++;if(U<($?3:2))return;h==="bevel"&&(y=1.05);const re=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let te,le,ue,pe,Se,_e,Ee,Me;A&&A.prevDir&&(_e=A.prevDir.perp()),A&&A.nextDir&&(Ee=A.nextDir.perp()),this.e1=this.e2=-1,$&&(te=r[U-2],Se=r[Z].sub(te)._unit()._perp());for(let De=Z;De<U;De++){if(ue=De===U-1?$?r[Z+1]:void 0:r[De+1],ue&&r[De].equals(ue))continue;Se&&(pe=Se),te&&(le=te),te=r[De],Me=this.evaluateLineProgressFeatures(le?le.dist(te):0),Se=ue?ue.sub(te)._unit()._perp():pe,pe=pe||Se;const nt=le&&ue;let Ve=nt?h:$||R?"butt":g;const lt=pe.x*Se.x+pe.y*Se.y;if(R){const ot=function(vt){if(vt.patternJoinNone){const Ot=vt.segmentPoints.length/2,Et=vt.lineSoFar-vt.segmentStart;for(let or=0;or<Ot;++or){const Ft=vt.segmentPoints[2*or+1],Ht=Math.round(vt.segmentPoints[2*or])+.5+.25*Ft;vt.patternVertexArray.emplaceBack(Ht,Et,vt.segmentStart),vt.patternVertexArray.emplaceBack(Ht,Et,vt.segmentStart)}vt.segmentPoints.length=0}vt.e1=vt.e2=-1};if(nt&&lt<FZ){this.updateDistance(le,te),this.addCurrentVertex(te,pe,1,1,re,Me),ot(this),this.addCurrentVertex(te,Se,-1,-1,re,Me);continue}if(le){if(!ue){this.updateDistance(le,te),this.addCurrentVertex(te,pe,1,1,re,Me),ot(this);continue}Ve="miter"}}let ft=pe.add(Se);ft.x===0&&ft.y===0||ft._unit();const pt=ft.x*Se.x+ft.y*Se.y,xt=pt!==0?1/pt:1/0,wt=2*Math.sqrt(2-2*pt),yt=pt<zZ&&le&&ue,_t=pe.x*Se.y-pe.y*Se.x>0,at=this.overscaling<=16?15*Mt/(512*this.overscaling):0;if(nt&&Ve==="round"){if(xt<b)Ve="miter";else if(xt<=2){const ot=jA(te,-10,Mt+10);Ve=this.elevationType==="offset"&&(ot||this.hasCrossSlope)?"miter":"fakeround"}}if(Ve==="miter"&&xt>y&&(Ve="bevel"),Ve==="bevel"&&(xt>2&&(Ve="flipbevel"),xt<y&&(Ve="miter")),le&&!(Ve==="miter"&&yt)&&this.updateDistance(le,te),Ve==="miter")if(yt){const ot=te.dist(le);if(ot>2*at){const Ot=te.sub(te.sub(le)._mult(at/ot)._round());this.updateDistance(le,Ot),this.addCurrentVertex(Ot,pe,0,0,re,Me),le=Ot}this.updateDistance(le,te),ft._mult(xt),this.addCurrentVertex(te,ft,0,0,re,Me);const vt=te.dist(ue);if(vt>2*at){const Ot=te.add(ue.sub(te)._mult(at/vt)._round());this.updateDistance(te,Ot),this.addCurrentVertex(Ot,Se,0,0,re,Me),te=Ot}}else ft._mult(xt),this.addCurrentVertex(te,ft,0,0,re,Me);else if(Ve==="flipbevel"){if(xt>100)ft=Se.mult(-1);else{const ot=xt*pe.add(Se).mag()/pe.sub(Se).mag();ft._perp()._mult(ot*(_t?-1:1))}this.addCurrentVertex(te,ft,0,0,re,Me),this.addCurrentVertex(te,ft.mult(-1),0,0,re,Me)}else if(Ve==="bevel"||Ve==="fakeround"){Me!=null&&le&&this.addCurrentVertex(te,Ee||pe,-1,-1,re,Me);const ot=te.dist(le)<=2*at&&Ve!=="bevel",vt=ft.mult(_t?1:-1);vt._mult(xt);const Ot=Se.mult(_t?-1:1),Et=pe.mult(_t?-1:1),or=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(te,vt.x,vt.y,!1,!_t,0,re,or),ot||this.addHalfVertex(te,vt.x+2*Et.x,vt.y+2*Et.y,!1,_t,0,re,or)),Ve==="fakeround"){const Ft=Math.round(180*wt/Math.PI/20);this.addHalfVertex(te,Et.x,Et.y,!1,_t,0,re,or);for(let Ht=0;Ht<Ft;Ht++){let Qt=Ht/Ft;if(Qt!==.5){const Pt=Qt-.5;Qt+=Qt*Pt*(Qt-1)*((1.0904+lt*(lt*(3.55645-1.43519*lt)-3.2452))*Pt*Pt+(.848013+lt*(.215638*lt-1.06021)))}const Hr=Ot.sub(Et)._mult(Qt)._add(Et)._unit();this.addHalfVertex(te,Hr.x,Hr.y,!1,_t,0,re,or)}this.addHalfVertex(te,Ot.x,Ot.y,!1,_t,0,re,or)}ot||Me!=null||this.addHalfVertex(te,vt.x+2*Ot.x,vt.y+2*Ot.y,!1,_t,0,re,or),Me!=null&&ue&&this.addCurrentVertex(te,_e||Se,1,1,re,Me)}else if(Ve==="butt")this.addCurrentVertex(te,ft,0,0,re,Me);else if(Ve==="square"){if(!le){const ot=k?0:-1;this.addCurrentVertex(te,ft,ot,ot,re,Me)}if(this.addCurrentVertex(te,ft,0,0,re,Me),le){const ot=L?0:1;this.addCurrentVertex(te,ft,ot,ot,re,Me)}}else if(Ve==="round"){if(le){const ot=!nt&&Ee?Ee:pe;this.addCurrentVertex(te,ot,0,0,re,Me),!nt&&L||this.addCurrentVertex(te,ot,1,1,re,Me,!0)}if(ue){const ot=!nt&&_e?_e:Se;!nt&&k||this.addCurrentVertex(te,ot,-1,-1,re,Me,!0),this.addCurrentVertex(te,ot,0,0,re,Me)}}}}addVerticesTo(r,a,u,h,g,y,b,A,C,R){const k=(a.w-r.w)/this.tessellationStep|0;let L=0;const $=this.scaledDistance;if(k>1){this.lineSoFar=r.w;const Z=(a.x-r.x)/k,re=(a.y-r.y)/k,te=(a.z-r.z)/k,le=(a.w-r.w)/k;for(let ue=1;ue<k;++ue){r.x+=Z,r.y+=re,r.z+=te,this.lineSoFar+=le,L+=le;const pe=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(r,u,h,R,!1,b,C,pe),this.addHalfVertex(r,g,y,R,!0,-A,C,pe)}}this.lineSoFar=a.w,this.scaledDistance=$;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,h,R,!1,b,C,U),this.addHalfVertex(a,g,y,R,!0,-A,C,U)}evaluateLineProgressFeatures(r){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+r)/this.totalFeatureLength):Ut(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(r,a,u,h,g,y,b=!1){const A=a.x+a.y*u,C=a.y-a.x*u,R=a.y*h-a.x,k=-a.y-a.x*h;if(y!=null){const L=this.elevationType==="offset",$=-10,U=Mt+10,Z=y.zOffset,re=new tj(r.x,r.y,Z,this.lineSoFar),te=!!L&&jA(r,$,U),le=this.lineSoFar,ue=this.distance;if(this.currentVertex)if(te){const pe=this.currentVertexIsOutside,Se=this.currentVertex,_e=new tj(r.x,r.y,Z,this.lineSoFar);if(nj(Se,_e,$,U),!jA(_e,$,U)){if(pe){this.e1=this.e2=-1,this.distance-=Se.dist(re),this.lineSoFar=Se.w;const Ee=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,A,C,b,!1,u,g,Ee),this.addHalfVertex(Se,R,k,b,!0,-h,g,Ee),this.prevDistance=this.distance}this.distance=this.prevDistance+Se.dist(_e),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Se,_e,A,C,R,k,u,h,g,b),this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}}else{const pe=this.currentVertex;if(this.currentVertexIsOutside){nj(pe,re,$,U),this.e1=this.e2=-1,this.distance-=pe.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=pe.w;const Se=this.evaluateLineProgressFeatures(pe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(pe,A,C,b,!1,u,g,Se),this.addHalfVertex(pe,R,k,b,!0,-h,g,Se),this.prevDistance=this.distance,this.distance=ue,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(pe,re,A,C,R,k,u,h,g,b)}else te||(this.addHalfVertex(r,A,C,b,!1,u,g,y),this.addHalfVertex(r,R,k,b,!0,-h,g,y));this.currentVertex=re,this.currentVertexIsOutside=te,this.lineSoFar=le}else this.addHalfVertex(r,A,C,b,!1,u,g,y),this.addHalfVertex(r,R,k,b,!0,-h,g,y)}addHalfVertex({x:r,y:a},u,h,g,y,b,A,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const k=xr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,k)}const R=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),A.primitiveLength++),y?this.e2=R:this.e1=R,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(r,a){this.prevDistance=this.distance,this.distance+=r.dist(a),this.updateScaledDistance()}}function jA(l,r,a){return l.x<r||l.x>a||l.y<r||l.y>a}let jj,Dj;function Lj(l,r,a){return r*(Mt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}Yt(kA,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Nj=(l,r,a)=>(1-a)*l+a*r;function zj(l,r){return 1/Lj(l,1,r.tileZoom)}function Fj(l,r,a,u){return l.translatePosMatrix(u||r.tileID.projMatrix,r,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Bj=l=>{const r=[];$j(l)&&r.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||r.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&r.push("RENDER_LINE_BORDER");const u=l.layout.get("line-join").constantOr("miter")==="none",h=!!l.paint.get("line-pattern").constantOr(1);return u&&h&&r.push("LINE_JOIN_NONE"),r};function $j(l){const r=l.paint.get("line-dasharray").value;return r.kind!=="constant"||r.value}let DA;const Vj=()=>DA||(DA={layout:jj||(jj=new Pi({"line-cap":new kt(He.layout_line["line-cap"]),"line-join":new kt(He.layout_line["line-join"]),"line-miter-limit":new Ct(He.layout_line["line-miter-limit"]),"line-round-limit":new Ct(He.layout_line["line-round-limit"]),"line-sort-key":new kt(He.layout_line["line-sort-key"]),"line-z-offset":new kt(He.layout_line["line-z-offset"]),"line-elevation-reference":new Ct(He.layout_line["line-elevation-reference"]),"line-cross-slope":new Ct(He.layout_line["line-cross-slope"]),visibility:new Ct(He.layout_line.visibility),"line-width-unit":new Ct(He.layout_line["line-width-unit"])})),paint:Dj||(Dj=new Pi({"line-opacity":new kt(He.paint_line["line-opacity"]),"line-color":new kt(He.paint_line["line-color"]),"line-translate":new Ct(He.paint_line["line-translate"]),"line-translate-anchor":new Ct(He.paint_line["line-translate-anchor"]),"line-width":new kt(He.paint_line["line-width"]),"line-gap-width":new kt(He.paint_line["line-gap-width"]),"line-offset":new kt(He.paint_line["line-offset"]),"line-blur":new kt(He.paint_line["line-blur"]),"line-dasharray":new kt(He.paint_line["line-dasharray"]),"line-pattern":new kt(He.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ct(He.paint_line["line-pattern-cross-fade"]),"line-gradient":new Su(He.paint_line["line-gradient"]),"line-trim-offset":new Ct(He.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ct(He.paint_line["line-trim-fade-range"]),"line-trim-color":new Ct(He.paint_line["line-trim-color"]),"line-emissive-strength":new kt(He.paint_line["line-emissive-strength"]),"line-border-width":new kt(He.paint_line["line-border-width"]),"line-border-color":new kt(He.paint_line["line-border-color"]),"line-occlusion-opacity":new Ct(He.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},DA);class BZ extends kt{possiblyEvaluate(r,a){return a=new si(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(r,a)}evaluate(r,a,u,h){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,u,h)}}let J_;function Uj(l,r){return r>0?r+2*l:l}const $Z=Kr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),VZ=Kr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),UZ=Kr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Kr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const GZ=Kr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),HZ=Kr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),WZ=Kr([{name:"a_texb",components:2,type:"Uint16"}]),qZ=Kr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ZZ=Kr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gj=Kr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),KZ=Kr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Kr([{name:"triangle",components:3,type:"Uint16"}]),Kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Kr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Kr([{type:"Float32",name:"offsetX"}]),Kr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ao=24;function XZ(l,r,a){return l.sections.forEach(u=>{u.text=function(h,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),Ll.applyArabicShaping&&(h=Ll.applyArabicShaping(h)),h}(u.text,r,a)}),l}const Q_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function YZ(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function JZ(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}const LA=4294967296,Hj=1/LA,Wj=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let qb=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,r,a=this.length){for(;this.pos<a;){const u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,l(h,r,this),this.pos===g&&this.skip(u)}return r}readMessage(l,r){return this.readFields(l,r,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*LA;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*LA;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const r=this.buf;let a,u;return u=r[this.pos++],a=127&u,u<128?a:(u=r[this.pos++],a|=(127&u)<<7,u<128?a:(u=r[this.pos++],a|=(127&u)<<14,u<128?a:(u=r[this.pos++],a|=(127&u)<<21,u<128?a:(u=r[this.pos],a|=(15&u)<<28,function(h,g,y){const b=y.buf;let A,C;if(C=b[y.pos++],A=(112&C)>>4,C<128||(C=b[y.pos++],A|=(127&C)<<3,C<128)||(C=b[y.pos++],A|=(127&C)<<10,C<128)||(C=b[y.pos++],A|=(127&C)<<17,C<128)||(C=b[y.pos++],A|=(127&C)<<24,C<128)||(C=b[y.pos++],A|=(1&C)<<31,C<128))return Rm(h,A,g);throw new Error("Expected varint not more than 10 bytes")}(a,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,r=this.pos;return this.pos=l,l-r>=12&&Wj?Wj.decode(this.buf.subarray(r,l)):function(a,u,h){let g="",y=u;for(;y<h;){const b=a[y];let A,C,R,k=null,L=b>239?4:b>223?3:b>191?2:1;if(y+L>h)break;L===1?b<128&&(k=b):L===2?(A=a[y+1],(192&A)==128&&(k=(31&b)<<6|63&A,k<=127&&(k=null))):L===3?(A=a[y+1],C=a[y+2],(192&A)==128&&(192&C)==128&&(k=(15&b)<<12|(63&A)<<6|63&C,(k<=2047||k>=55296&&k<=57343)&&(k=null))):L===4&&(A=a[y+1],C=a[y+2],R=a[y+3],(192&A)==128&&(192&C)==128&&(192&R)==128&&(k=(15&b)<<18|(63&A)<<12|(63&C)<<6|63&R,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,L=1):k>65535&&(k-=65536,g+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),g+=String.fromCharCode(k),y+=L}return g}(this.buf,r,l)}readBytes(){const l=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,l);return this.pos=l,r}readPackedVarint(l=[],r){const a=this.readPackedEnd();for(;this.pos<a;)l.push(this.readVarint(r));return l}readPackedSVarint(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const r=this.readPackedEnd();for(;this.pos<r;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const r=7&l;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(l,r){this.writeVarint(l<<3|r)}realloc(l){let r=this.length||16;for(;r<this.pos+l;)r*=2;if(r!==this.length){const a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*Hj),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*Hj),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(r,a){let u,h;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(u=~(-r%4294967296),h=~(-r/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(u,0,a),function(g,y){const b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,a)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const r=this.pos;this.pos=function(u,h,g){for(let y,b,A=0;A<h.length;A++){if(y=h.charCodeAt(A),y>55295&&y<57344){if(!b){y>56319||A+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):b=y;continue}if(y<56320){u[g++]=239,u[g++]=191,u[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(u[g++]=239,u[g++]=191,u[g++]=189,b=null);y<128?u[g++]=y:(y<2048?u[g++]=y>>6|192:(y<65536?u[g++]=y>>12|224:(u[g++]=y>>18|240,u[g++]=y>>12&63|128),u[g++]=y>>6&63|128),u[g++]=63&y|128)}return g}(this.buf,l,this.pos);const a=this.pos-r;a>=128&&qj(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const r=l.length;this.writeVarint(r),this.realloc(r);for(let a=0;a<r;a++)this.buf[this.pos++]=l[a]}writeRawMessage(l,r){this.pos++;const a=this.pos;l(r,this);const u=this.pos-a;u>=128&&qj(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(l,r,a){this.writeTag(l,2),this.writeRawMessage(r,a)}writePackedVarint(l,r){r.length&&this.writeMessage(l,QZ,r)}writePackedSVarint(l,r){r.length&&this.writeMessage(l,eK,r)}writePackedBoolean(l,r){r.length&&this.writeMessage(l,nK,r)}writePackedFloat(l,r){r.length&&this.writeMessage(l,tK,r)}writePackedDouble(l,r){r.length&&this.writeMessage(l,rK,r)}writePackedFixed32(l,r){r.length&&this.writeMessage(l,iK,r)}writePackedSFixed32(l,r){r.length&&this.writeMessage(l,oK,r)}writePackedFixed64(l,r){r.length&&this.writeMessage(l,sK,r)}writePackedSFixed64(l,r){r.length&&this.writeMessage(l,aK,r)}writeBytesField(l,r){this.writeTag(l,2),this.writeBytes(r)}writeFixed32Field(l,r){this.writeTag(l,5),this.writeFixed32(r)}writeSFixed32Field(l,r){this.writeTag(l,5),this.writeSFixed32(r)}writeFixed64Field(l,r){this.writeTag(l,1),this.writeFixed64(r)}writeSFixed64Field(l,r){this.writeTag(l,1),this.writeSFixed64(r)}writeVarintField(l,r){this.writeTag(l,0),this.writeVarint(r)}writeSVarintField(l,r){this.writeTag(l,0),this.writeSVarint(r)}writeStringField(l,r){this.writeTag(l,2),this.writeString(r)}writeFloatField(l,r){this.writeTag(l,5),this.writeFloat(r)}writeDoubleField(l,r){this.writeTag(l,1),this.writeDouble(r)}writeBooleanField(l,r){this.writeVarintField(l,+r)}};function Rm(l,r,a){return a?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}function qj(l,r,a){const u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(u);for(let h=a.pos-1;h>=l;h--)a.buf[h+u]=a.buf[h]}function QZ(l,r){for(let a=0;a<l.length;a++)r.writeVarint(l[a])}function eK(l,r){for(let a=0;a<l.length;a++)r.writeSVarint(l[a])}function tK(l,r){for(let a=0;a<l.length;a++)r.writeFloat(l[a])}function rK(l,r){for(let a=0;a<l.length;a++)r.writeDouble(l[a])}function nK(l,r){for(let a=0;a<l.length;a++)r.writeBoolean(l[a])}function iK(l,r){for(let a=0;a<l.length;a++)r.writeFixed32(l[a])}function oK(l,r){for(let a=0;a<l.length;a++)r.writeSFixed32(l[a])}function sK(l,r){for(let a=0;a<l.length;a++)r.writeFixed64(l[a])}function aK(l,r){for(let a=0;a<l.length;a++)r.writeSFixed64(l[a])}const NA=3;function lK(l,r,a){r.glyphs=[],l===1&&a.readMessage(cK,r)}function cK(l,r,a){if(l===3){const{id:u,bitmap:h,width:g,height:y,left:b,top:A,advance:C}=a.readMessage(uK,{});r.glyphs.push({id:u,bitmap:new Rd({width:g+2*NA,height:y+2*NA},h),metrics:{width:g,height:y,left:b,top:A,advance:C}})}else l===4?r.ascender=a.readSVarint():l===5&&(r.descender=a.readSVarint())}function uK(l,r,a){l===1?r.id=a.readVarint():l===2?r.bitmap=a.readBytes():l===3?r.width=a.readVarint():l===4?r.height=a.readVarint():l===5?r.left=a.readSVarint():l===6?r.top=a.readSVarint():l===7&&(r.advance=a.readVarint())}const Zj=NA,ta={horizontal:1,vertical:2,horizontalOnly:3};class ev{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(r,a){const u=new ev;return u.scale=r||1,u.fontStack=a,u}static forImage(r){const a=new ev;return a.image=r,a}}class km{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a,u){const h=new km;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?h.addImageSection(y,u):h.addTextSection(y,a)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCodePoint(r){return this.text.codePointAt(r)}verticalizePunctuation(r){this.text=function(a,u){let h="";for(let g=0;g<a.length;g++){const y=a.charCodeAt(g+1)||null,b=a.charCodeAt(g-1)||null;h+=!u&&(y&&Kp(y)&&!Q_[a[g+1]]||b&&Kp(b)&&!Q_[a[g-1]])||!Q_[a[g]]?a[g]:Q_[a[g]]}return h}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&Zb[this.text.charCodeAt(u)];u++)r++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&Zb[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const u=new km;return u.text=this.text.substring(r,a),u.sectionIndex=this.sectionIndex.slice(r,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(ev.forText(r.scale,r.fontStack||a));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r,a){const u=r.image?r.image.getPrimary():null;if(!u)return void Ut("Can't add FormattedSection with an empty image.");u.scaleSelf(a);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(ev.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ut("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zA(l,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z=1){const re=km.fromFeature(l,h,Z);k===ta.vertical&&re.verticalizePunctuation(L);let te=[];const le=function(Ee,Me,De,nt,Ve,lt){if(!Ee)return[];const ft=[],pt=function(_t,at,ot,vt,Ot,Et){let or=0;for(let Ft=0;Ft<_t.length();Ft++){const Ht=_t.getSection(Ft);or+=Kj(_t.getCodePoint(Ft),Ht,vt,Ot,at,Et)}return or/Math.max(1,Math.ceil(or/ot))}(Ee,Me,De,nt,Ve,lt),xt=Ee.text.indexOf("")>=0;let wt=0;for(let _t=0;_t<Ee.length();_t++){const at=Ee.getSection(_t),ot=Ee.getCodePoint(_t);if(Zb[ot]||(wt+=Kj(ot,at,nt,Ve,Me,lt)),_t<Ee.length()-1){const vt=!((yt=ot)<11904||!(mr["Bopomofo Extended"](yt)||mr.Bopomofo(yt)||mr["CJK Compatibility Forms"](yt)||mr["CJK Compatibility Ideographs"](yt)||mr["CJK Compatibility"](yt)||mr["CJK Radicals Supplement"](yt)||mr["CJK Strokes"](yt)||mr["CJK Symbols and Punctuation"](yt)||mr["CJK Unified Ideographs Extension A"](yt)||mr["CJK Unified Ideographs"](yt)||mr["Enclosed CJK Letters and Months"](yt)||mr["Halfwidth and Fullwidth Forms"](yt)||mr.Hiragana(yt)||mr["Ideographic Description Characters"](yt)||mr["Kangxi Radicals"](yt)||mr["Katakana Phonetic Extensions"](yt)||mr.Katakana(yt)||mr["Vertical Forms"](yt)||mr["Yi Radicals"](yt)||mr["Yi Syllables"](yt)));(dK[ot]||vt||at.image)&&ft.push(Yj(_t+1,wt,pt,ft,hK(ot,Ee.getCodePoint(_t+1),vt&&xt),!1))}}var yt;return Jj(Yj(Ee.length(),wt,pt,ft,0,!0))}(re,C,g,r,u,$),{processBidirectionalText:ue,processStyledBidirectionalText:pe}=Ll;if(ue&&re.sections.length===1){const Ee=ue(re.toString(),le);for(const Me of Ee){const De=new km;De.text=Me,De.sections=re.sections;for(let nt=0;nt<Me.length;nt++)De.sectionIndex.push(0);te.push(De)}}else if(pe){const Ee=pe(re.text,re.sectionIndex,le);for(const Me of Ee){const De=new km;De.text=Me[0],De.sectionIndex=Me[1],De.sections=re.sections,te.push(De)}}else te=function(Ee,Me){const De=[],nt=Ee.text;let Ve=0;for(const lt of Me)De.push(Ee.substring(Ve,lt)),Ve=lt;return Ve<nt.length&&De.push(Ee.substring(Ve,nt.length)),De}(re,le);const Se=[],_e={positionedLines:Se,text:re.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ee,Me,De,nt,Ve,lt,ft,pt,xt,wt,yt,_t){let at=0,ot=0,vt=0;const Ot=pt==="right"?1:pt==="left"?0:.5;let Et=!1;for(const Pt of Ve){const er=Pt.getSections();for(const Cr of er){if(Cr.image)continue;const en=Me[Cr.fontStack];if(en&&(Et=en.ascender!==void 0&&en.descender!==void 0,!Et))break}if(!Et)break}let or=0;for(const Pt of Ve){Pt.trim();const er=Pt.getMaxScale(),Cr=(er-1)*Ao,en={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[or]=en;const sn=en.positionedGlyphs;let Dr=0;if(!Pt.length()){ot+=lt,++or;continue}let Un=0,ve=0;for(let ct=0;ct<Pt.length();ct++){const bt=Pt.getSection(ct),jt=Pt.getSectionIndex(ct),Dt=Pt.getCodePoint(ct);let sr=bt.scale,ur=null,Rr=null,Vr=null,Gr=Ao,Xr=0,_r=xt;_r===ta.vertical&&((Ft=Dt)===12312||Ft===12313||Ft===12316||Ft===12540||Ft===12448)&&(_r=ta.horizontal);const Er=!(_r===ta.horizontal||!yt&&!Zp(Dt)||yt&&(Zb[Dt]||Xp(Dt)));if(bt.image){const pn=nt.get(bt.image.toString());if(!pn)continue;Vr=bt.image,Ee.iconsInText=Ee.iconsInText||!0,Rr=pn.paddedRect;const xn=pn.displaySize;sr=sr*Ao/_t,ur={width:xn[0],height:xn[1],left:0,top:-Zj,advance:Er?xn[1]:xn[0],localGlyph:!1},Xr=Et?-ur.height*sr:er*Ao-17-xn[1]*sr,Gr=ur.advance;const bn=(Er?xn[0]:xn[1])*sr-Ao*er;bn>0&&bn>Dr&&(Dr=bn)}else{const pn=De[bt.fontStack];if(!pn)continue;pn[Dt]&&(Rr=pn[Dt]);const xn=Me[bt.fontStack];if(!xn)continue;const bn=xn.glyphs[Dt];if(!bn)continue;if(ur=bn.metrics,Gr=Dt!==8203?Ao:0,Et){const Dn=xn.ascender!==void 0?Math.abs(xn.ascender):0,Yn=xn.descender!==void 0?Math.abs(xn.descender):0,Gn=(Dn+Yn)*sr;Un<Gn&&(Un=Gn,ve=(Dn-Yn)/2*sr),Xr=-Dn*sr}else Xr=(er-sr)*Ao-17}Er?(Ee.verticalizable=!0,sn.push({glyph:Dt,image:Vr,x:at,y:ot+Xr,vertical:Er,scale:sr,localGlyph:ur.localGlyph,fontStack:bt.fontStack,sectionIndex:jt,metrics:ur,rect:Rr}),at+=Gr*sr+wt):(sn.push({glyph:Dt,image:Vr,x:at,y:ot+Xr,vertical:Er,scale:sr,localGlyph:ur.localGlyph,fontStack:bt.fontStack,sectionIndex:jt,metrics:ur,rect:Rr}),at+=ur.advance*sr+wt)}sn.length!==0&&(vt=Math.max(at-wt,vt),Et?Qj(sn,Ot,Dr,ve,lt*er/2):Qj(sn,Ot,Dr,0,lt/2)),at=0;const Te=lt*er+Dr;en.lineOffset=Math.max(Dr,Cr),ot+=Te,++or}var Ft;const Ht=ot,{horizontalAlign:Qt,verticalAlign:Hr}=FA(ft);(function(Pt,er,Cr,en,sn,Dr){const Un=(er-Cr)*sn,ve=-Dr*en;for(const Te of Pt)for(const ct of Te.positionedGlyphs)ct.x+=Un,ct.y+=ve})(Ee.positionedLines,Ot,Qt,Hr,vt,Ht),Ee.top+=-Hr*Ht,Ee.bottom=Ee.top+Ht,Ee.left+=-Qt*vt,Ee.right=Ee.left+vt,Ee.hasBaseline=Et}(_e,r,a,u,te,y,b,A,k,C,L,U),!function(Ee){for(const Me of Ee)if(Me.positionedGlyphs.length!==0)return!1;return!0}(Se))return _e}const Zb={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dK={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kj(l,r,a,u,h,g){if(r.image){const y=u.get(r.image.toString());return y?y.displaySize[0]*r.scale*Ao/g+h:0}{const y=a[r.fontStack],b=y&&y.glyphs[l];return b?b.metrics.advance*r.scale+h:0}}function Xj(l,r,a,u){const h=Math.pow(l-r,2);return u?l<r?h/2:2*h:h+Math.abs(a)*a}function hK(l,r,a){let u=0;return l===10&&(u-=1e4),a&&(u+=150),l!==40&&l!==65288||(u+=50),r!==41&&r!==65289||(u+=50),u}function Yj(l,r,a,u,h,g){let y=null,b=Xj(r,a,h,g);for(const A of u){const C=Xj(r-A.x,a,h,g)+A.badness;C<=b&&(y=A,b=C)}return{index:l,x:r,priorBreak:y,badness:b}}function Jj(l){return l?Jj(l.priorBreak).concat(l.index):[]}function FA(l){let r=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Qj(l,r,a,u,h){if(!(r||a||u||h))return;const g=l.length-1,y=l[g],b=(y.x+y.metrics.advance*y.scale)*r;for(let A=0;A<=g;A++)l[A].x-=b,l[A].y+=a+u+h}function BA(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function Kb(l,r,a,u){const{horizontalAlign:h,verticalAlign:g}=FA(u),y=a[0]-l.displaySize[0]*h,b=a[1]-l.displaySize[1]*g;return{imagePrimary:l,imageSecondary:r,top:b,bottom:b+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function $A(l,r,a,u,h,g){const y=l.imagePrimary;let b;if(y.content){const re=y.content,te=y.pixelRatio||1;b=[re[0]/te,re[1]/te,y.displaySize[0]-re[2]/te,y.displaySize[1]-re[3]/te]}const A=r.left*g,C=r.right*g;let R,k,L,$;a==="width"||a==="both"?($=h[0]+A-u[3],k=h[0]+C+u[1]):($=h[0]+(A+C-y.displaySize[0])/2,k=$+y.displaySize[0]);const U=r.top*g,Z=r.bottom*g;return a==="height"||a==="both"?(R=h[1]+U-u[0],L=h[1]+Z+u[2]):(R=h[1]+(U+Z-y.displaySize[1])/2,L=R+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:R,right:k,bottom:L,left:$,collisionPadding:b}}function eD(l){return!l.imagePrimary.stretchX}function tD(l){return!l.imagePrimary.stretchY}function rD(l){return{width:l.right-l.left,height:l.bottom-l.top}}const Wl=128;function jm(l,r,a){const{expression:u}=r;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new si(l+1,{worldview:a}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=u;let y=0;for(;y<h.length&&h[y]<=l;)y++;y=Math.max(0,y-1);let b=y;for(;b<h.length&&h[b]<l+1;)b++;b=Math.min(h.length-1,b);const A=h[y],C=h[b];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:C,minSize:u.evaluate(new si(A,{worldview:a})),maxSize:u.evaluate(new si(C,{worldview:a})),interpolationType:g}}}function VA(l,{uSize:r,uSizeT:a},{lowerSize:u,upperSize:h}){return l.kind==="source"?u/Wl:l.kind==="composite"?xr(u/Wl,h/Wl,a):r}function Dm(l,r,a=1){let u=0,h=0;if(l.kind==="constant")h=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=l,A=g?ne(Xs.interpolationFactor(g,r,y,b),0,1):0;l.kind==="camera"?h=xr(l.minSize,l.maxSize,A)*a:u=A*a}return{uSizeT:u,uSize:h}}class Ou extends mt{constructor(r,a,u,h,g){super(r,a),this.angle=h,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Ou(this.x,this.y,this.z,this.angle,this.segment)}}function nD(l,r,a,u,h){if(r.segment===void 0)return!0;let g=r,y=r.segment+1,b=0;for(;b>-a/2;){if(y--,y<0)return!1;b-=l[y].dist(g),g=l[y]}b+=l[y].dist(l[y+1]),y++;const A=[];let C=0;for(;b<a/2;){const R=l[y],k=l[y+1];if(!k)return!1;let L=l[y-1].angleTo(R)-R.angleTo(k);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:b,angleDelta:L}),C+=L;b-A[0].distance>u;)C-=A.shift().angleDelta;if(C>h)return!1;y++,b+=R.dist(k)}return!0}function iD(l){let r=0;for(let a=0;a<l.length-1;a++)r+=l[a].dist(l[a+1]);return r}function oD(l,r,a){return l?.6*r*a:0}function sD(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function fK(l,r,a,u,h,g){const y=oD(a,h,g),b=sD(a,u)*g;let A=0;const C=iD(l)/2;for(let R=0;R<l.length-1;R++){const k=l[R],L=l[R+1],$=k.dist(L);if(A+$>C){const U=(C-A)/$,Z=xr(k.x,L.x,U),re=xr(k.y,L.y,U),te=new Ou(Z,re,0,L.angleTo(k),R);return!y||nD(l,te,b,y,r)?te:void 0}A+=$}}function pK(l,r,a,u,h,g,y,b,A){const C=oD(u,g,y),R=sD(u,h),k=R*y,L=l[0].x===0||l[0].x===A||l[0].y===0||l[0].y===A;return r-k<r/4&&(r=k+r/4),aD(l,L?r/2*b%r:(R/2+2*g)*y*b%r,r,C,a,k,L,!1,A)}function aD(l,r,a,u,h,g,y,b,A){const C=g/2,R=iD(l);let k=0,L=r-a,$=[];for(let U=0;U<l.length-1;U++){const Z=l[U],re=l[U+1],te=Z.dist(re),le=re.angleTo(Z);for(;L+a<k+te;){L+=a;const ue=(L-k)/te,pe=xr(Z.x,re.x,ue),Se=xr(Z.y,re.y,ue);if(pe>=0&&pe<A&&Se>=0&&Se<A&&L-C>=0&&L+C<=R){const _e=new Ou(pe,Se,0,le,U);u&&!nD(l,_e,g,u,h)||$.push(_e)}}k+=te}return b||$.length||y||($=aD(l,k/2,a,u,h,g,y,!0,A)),$}function lD(l){let r=0,a=0;for(const y of l)r+=y.w*y.h,a=Math.max(a,y.w);l.sort((y,b)=>b.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,g=0;for(const y of l)for(let b=u.length-1;b>=0;b--){const A=u[b];if(!(y.w>A.w||y.h>A.h)){if(y.x=A.x,y.y=A.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===A.w&&y.h===A.h){const C=u.pop();C&&b<u.length&&(u[b]=C)}else y.h===A.h?(A.x+=y.w,A.w-=y.w):y.w===A.w?(A.y+=y.h,A.h-=y.h):(u.push({x:A.x+y.w,y:A.y,w:A.w-y.w,h:y.h}),A.y+=y.h,A.h-=y.h);break}}return{w:h,h:g,fill:r/(h*g)||0}}Yt(Ou,"Anchor");const of=1;class tv{static getImagePositionScale(r,a,u){if(a&&r){const{sx:h,sy:g}=r;return{x:h,y:g}}return{x:u,y:u}}constructor(r,a,u,h){this.paddedRect=r;const{pixelRatio:g,version:y,stretchX:b,stretchY:A,content:C,sdf:R,usvg:k}=a;this.pixelRatio=g,this.stretchX=b,this.stretchY=A,this.content=C,this.version=y,this.padding=u,this.sdf=R,this.usvg=k,this.scale=tv.getImagePositionScale(h,k,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function UA(l,r,a){const u=Il.parse(l),h=function(g,y,b=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*b[0])+2*y,h:(g.data?g.data.height:g.height*b[1])+2*y}}(r,a,[u.sx,u.sy]);return{bin:h,imagePosition:new tv(h,r,a,u),imageVariant:u}}class cD{constructor(r,a,u){const h=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(r,h,of,y),this.addImages(a,g,2,y);const{w:b,h:A}=lD(y),C=new Qo({width:b||1,height:A||1});for(const[R,k]of r.entries()){const L=h.get(R).paddedRect;Qo.copy(k.data,C,{x:0,y:0},{x:L.x+of,y:L.y+of},k.data,null,k.sdf)}for(const[R,k]of a.entries()){const L=g.get(R),$=L.paddedRect;let U=L.padding;const Z=$.x+U,re=$.y+U,te=k.data.width,le=k.data.height;U=U>1?U-1:U,Qo.copy(k.data,C,{x:0,y:0},{x:Z,y:re},k.data,u),Qo.copy(k.data,C,{x:0,y:le-U},{x:Z,y:re-U},{width:te,height:U},u),Qo.copy(k.data,C,{x:0,y:0},{x:Z,y:re+le},{width:te,height:U},u),Qo.copy(k.data,C,{x:te-U,y:0},{x:Z-U,y:re},{width:U,height:le},u),Qo.copy(k.data,C,{x:0,y:0},{x:Z+te,y:re},{width:U,height:le},u),Qo.copy(k.data,C,{x:te-U,y:le-U},{x:Z-U,y:re-U},{width:U,height:U},u),Qo.copy(k.data,C,{x:0,y:le-U},{x:Z+te,y:re-U},{width:U,height:U},u),Qo.copy(k.data,C,{x:0,y:0},{x:Z+te,y:re+le},{width:U,height:U},u),Qo.copy(k.data,C,{x:te-U,y:0},{x:Z-U,y:re+le},{width:U,height:U},u)}this.lut=u,this.image=C,this.iconPositions=h,this.patternPositions=g}addImages(r,a,u,h){for(const[g,y]of r.entries()){const{bin:b,imagePosition:A,imageVariant:C}=UA(g,y,u);a.set(g,A),h.push(b),y.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(r,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>r.hasImage(h,u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of r.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=Il.parse(g);if(as.isEqual(y.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(g),b,a,null)}}for(const g of this.patternPositions.keys()){const y=Il.parse(g);if(as.isEqual(y.id,h)){const b=r.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(g),b,a,this.lut)}}}}patchUpdatedImage(r,a,u,h=null){if(!r||!a||r.version===a.version)return;r.version=a.version;const[g,y]=r.tl,b=r.sdf;if(this.lut||b){const A={width:a.data.width,height:a.data.height},C=new Qo(A);Qo.copy(a.data,C,{x:0,y:0},{x:0,y:0},A,h,b),u.update(C,{position:{x:g,y}})}else u.update(a.data,{position:{x:g,y}})}}Yt(tv,"ImagePosition"),Yt(cD,"ImageAtlas");const rv=1e20;function uD(l,r,a,u,h,g,y,b,A){for(let C=r;C<r+u;C++)dD(l,a*g+C,g,h,y,b,A);for(let C=a;C<a+h;C++)dD(l,C*g+r,1,u,y,b,A)}function dD(l,r,a,u,h,g,y){g[0]=0,y[0]=-rv,y[1]=rv,h[0]=l[r];for(let b=1,A=0,C=0;b<u;b++){h[b]=l[r+b*a];const R=b*b;do{const k=g[A];C=(h[b]-h[k]+R-k*k)/(b-k)/2}while(C<=y[A]&&--A>-1);A++,g[A]=b,y[A]=C,y[A+1]=rv}for(let b=0,A=0;b<u;b++){for(;y[A+1]<b;)A++;const C=g[A],R=b-C;l[r+b*a]=h[C]+R*R}}const ql=2,GA={none:0,ideographs:1,all:2};class Lm{constructor(r,a,u){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const u=[],h=this.url||Jr.GLYPHS_URL;for(const g in r)for(const y of r[g])u.push({stack:g,id:y});Re(u,({stack:g,id:y},b)=>{let A=this.entries[g];A||(A=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=A.glyphs[y];if(C!==void 0)return void b(null,{stack:g,id:y,glyph:C});if(C=this._tinySDF(A,g,y),C)return A.glyphs[y]=C,void b(null,{stack:g,id:y,glyph:C});const R=Math.floor(y/256);if(256*R>65535)return Ut("glyphs > 65535 not supported"),void b(null,{stack:g,id:y,glyph:C});if(A.ranges[R])return void b(null,{stack:g,id:y,glyph:C});let k=A.requests[R];k||(k=A.requests[R]=[],Lm.loadGlyphRange(g,R,h,this.requestManager,(L,$)=>{if($){A.ascender=$.ascender,A.descender=$.descender;for(const U in $.glyphs)this._doesCharSupportLocalGlyph(+U)||(A.glyphs[+U]=$.glyphs[+U]);A.ranges[R]=!0}for(const U of k)U(L,$);delete A.requests[R]})),k.push((L,$)=>{L?b(L):$&&b(null,{stack:g,id:y,glyph:$.glyphs[y]||null})})},(g,y)=>{if(g)a(g);else if(y){const b={};for(const{stack:A,id:C,glyph:R}of y)b[A]===void 0&&(b[A]={}),b[A].glyphs===void 0&&(b[A].glyphs={}),b[A].glyphs[C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},b[A].ascender=this.entries[A].ascender,b[A].descender=this.entries[A].descender;a(null,b)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==GA.none&&(this.localGlyphMode===GA.all?!!this.localFontFamily:!!this.localFontFamily&&(mr["CJK Unified Ideographs"](r)||mr["Hangul Syllables"](r)||mr.Hiragana(r)||mr.Katakana(r)||mr["CJK Symbols and Punctuation"](r)||mr["CJK Unified Ideographs Extension A"](r)||mr["CJK Unified Ideographs Extension B"](r)||mr.Osage(r)))}_tinySDF(r,a,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=r.tinySDF;if(!g){let Z="400";/bold/i.test(a)?Z="900":/medium/i.test(a)?Z="500":/light/i.test(a)&&(Z="200"),g=r.tinySDF=new Lm.TinySDF({fontFamily:h,fontWeight:Z,fontSize:24*ql,buffer:3*ql,radius:8*ql}),g.fontWeight=Z}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:b,width:A,height:C,glyphWidth:R,glyphHeight:k,glyphLeft:L,glyphTop:$,glyphAdvance:U}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Rd({width:A,height:C},b),metrics:{width:R/ql,height:k/ql,left:L/ql,top:$/ql-27,advance:U/ql,localGlyph:!0}}}}Lm.loadGlyphRange=function(l,r,a,u,h){const g=256*r,y=g+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${g}-${y}`),mh.Glyphs);Cl(b,(A,C)=>{if(A)h(A);else if(C){const R={},k=function(L){return new qb(L).readFields(lK,{})}(C);for(const L of k.glyphs)R[L.id]=L;h(null,{glyphs:R,ascender:k.ascender,descender:k.descender})}})},Lm.TinySDF=class{constructor({fontSize:l=24,buffer:r=3,radius:a=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal",lang:b=null}={}){this.buffer=r,this.cutoff=u,this.radius=a,this.lang=b;const A=this.size=l+4*r,C=this._createCanvas(A),R=this.ctx=C.getContext("2d",{willReadFrequently:!0});R.font=`${y} ${g} ${l}px ${h}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(l){const r=document.createElement("canvas");return r.width=r.height=l,r}draw(l){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(l),y=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),A=Math.min(this.size-this.buffer,y+Math.ceil(u)),C=b+2*this.buffer,R=A+2*this.buffer,k=Math.max(C*R,0),L=new Uint8ClampedArray(k),$={data:L,width:C,height:R,glyphWidth:b,glyphHeight:A,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(b===0||A===0)return $;const{ctx:U,buffer:Z,gridInner:re,gridOuter:te}=this;this.lang&&(U.lang=this.lang),U.clearRect(Z,Z,b,A),U.fillText(l,Z,Z+y);const le=U.getImageData(Z,Z,b,A);te.fill(rv,0,k),re.fill(0,0,k);for(let ue=0;ue<A;ue++)for(let pe=0;pe<b;pe++){const Se=le.data[4*(ue*b+pe)+3]/255;if(Se===0)continue;const _e=(ue+Z)*C+pe+Z;if(Se===1)te[_e]=0,re[_e]=rv;else{const Ee=.5-Se;te[_e]=Ee>0?Ee*Ee:0,re[_e]=Ee<0?Ee*Ee:0}}uD(te,0,0,C,R,C,this.f,this.v,this.z),uD(re,Z,Z,b,A,C,this.f,this.v,this.z);for(let ue=0;ue<k;ue++){const pe=Math.sqrt(te[ue])-Math.sqrt(re[ue]);L[ue]=Math.round(255-255*(pe/this.radius+this.cutoff))}return $}};const zc=of;function hD(l,r){return l+r[1]-r[0]}function HA(l,r,a,u,h=1){const g=[],y=l.imagePrimary,b=y.pixelRatio,A=y.paddedRect.w-2*zc,C=y.paddedRect.h-2*zc,R=(l.right-l.left)*h,k=(l.bottom-l.top)*h,L=y.stretchX||[[0,A]],$=y.stretchY||[[0,C]],U=L.reduce(hD,0),Z=$.reduce(hD,0),re=A-U,te=C-Z;let le=0,ue=U,pe=0,Se=Z,_e=0,Ee=re,Me=0,De=te;if(y.content&&u){const Ve=y.content;le=Xb(L,0,Ve[0]),pe=Xb($,0,Ve[1]),ue=Xb(L,Ve[0],Ve[2]),Se=Xb($,Ve[1],Ve[3]),_e=Ve[0]-le,Me=Ve[1]-pe,Ee=Ve[2]-Ve[0]-ue,De=Ve[3]-Ve[1]-Se}const nt=(Ve,lt,ft,pt)=>{const xt=Yb(Ve.stretch-le,ue,R,l.left*h),wt=Jb(Ve.fixed-_e,Ee,Ve.stretch,U),yt=Yb(lt.stretch-pe,Se,k,l.top*h),_t=Jb(lt.fixed-Me,De,lt.stretch,Z),at=Yb(ft.stretch-le,ue,R,l.left*h),ot=Jb(ft.fixed-_e,Ee,ft.stretch,U),vt=Yb(pt.stretch-pe,Se,k,l.top*h),Ot=Jb(pt.fixed-Me,De,pt.stretch,Z),Et=new mt(xt,yt),or=new mt(at,yt),Ft=new mt(at,vt),Ht=new mt(xt,vt),Qt=new mt(wt/b,_t/b),Hr=new mt(ot/b,Ot/b),Pt=r*Math.PI/180;if(Pt){const Un=Math.sin(Pt),ve=Math.cos(Pt),Te=[ve,-Un,Un,ve];Et._matMult(Te),or._matMult(Te),Ht._matMult(Te),Ft._matMult(Te)}const er=Ve.stretch+Ve.fixed,Cr=ft.stretch+ft.fixed,en=lt.stretch+lt.fixed,sn=pt.stretch+pt.fixed,Dr=l.imageSecondary;return{tl:Et,tr:or,bl:Ht,br:Ft,texPrimary:{x:y.paddedRect.x+zc+er,y:y.paddedRect.y+zc+en,w:Cr-er,h:sn-en},texSecondary:Dr?{x:Dr.paddedRect.x+zc+er,y:Dr.paddedRect.y+zc+en,w:Cr-er,h:sn-en}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qt,pixelOffsetBR:Hr,minFontScaleX:Ee/b/R,minFontScaleY:De/b/k,isSDF:a}};if(u&&(y.stretchX||y.stretchY)){const Ve=fD(L,re,U),lt=fD($,te,Z);for(let ft=0;ft<Ve.length-1;ft++){const pt=Ve[ft],xt=Ve[ft+1];for(let wt=0;wt<lt.length-1;wt++)g.push(nt(pt,lt[wt],xt,lt[wt+1]))}}else g.push(nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:C+1}));return g}function mK(l,r){const a=l.stretchY||[[0,l.paddedRect.h-2*zc]];return r&&(l.stretchX||l.stretchY)?pD(l.stretchX||[[0,l.paddedRect.w-2*zc]])*pD(a):1}function Xb(l,r,a){let u=0;for(const h of l)u+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return u}function fD(l,r,a){const u=[{fixed:-zc,stretch:0}];for(const[h,g]of l){const y=u[u.length-1];u.push({fixed:h-y.stretch,stretch:y.stretch}),u.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return u.push({fixed:r+zc,stretch:a}),u}function pD(l){return 2*l.length+1}function Yb(l,r,a,u){return l/r*a+u}function Jb(l,r,a,u){return l-r*a/u}function gK(l,r,a,u){const h=r+l.positionedLines[u].lineOffset;return u===0?a+h/2:a+(h+(r+l.positionedLines[u-1].lineOffset))/2}function yK(l,r=1,a=!1){let u=1/0,h=1/0,g=-1/0,y=-1/0;const b=l[0];for(let $=0;$<b.length;$++){const U=b[$];(!$||U.x<u)&&(u=U.x),(!$||U.y<h)&&(h=U.y),(!$||U.x>g)&&(g=U.x),(!$||U.y>y)&&(y=U.y)}const A=Math.min(g-u,y-h);let C=A/2;const R=new Ep([],_K);if(A===0)return new mt(u,h);for(let $=u;$<g;$+=A)for(let U=h;U<y;U+=A)R.push(new Nm($+C,U+C,C,l));let k=function($){let U=0,Z=0,re=0;const te=$[0];for(let le=0,ue=te.length,pe=ue-1;le<ue;pe=le++){const Se=te[le],_e=te[pe],Ee=Se.x*_e.y-_e.x*Se.y;Z+=(Se.x+_e.x)*Ee,re+=(Se.y+_e.y)*Ee,U+=3*Ee}return new Nm(Z/U,re/U,0,$)}(l),L=R.length;for(;R.length;){const $=R.pop();($.d>k.d||!k.d)&&(k=$,a&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,L)),$.max-k.d<=r||(C=$.h/2,R.push(new Nm($.p.x-C,$.p.y-C,C,l)),R.push(new Nm($.p.x+C,$.p.y-C,C,l)),R.push(new Nm($.p.x-C,$.p.y+C,C,l)),R.push(new Nm($.p.x+C,$.p.y+C,C,l)),L+=4)}return a&&(console.log(`num probes: ${L}`),console.log(`best distance: ${k.d}`)),k.p}function _K(l,r){return r.max-l.max}class Nm{constructor(r,a,u,h){this.p=new mt(r,a),this.h=u,this.d=function(g,y){let b=!1,A=1/0;for(let C=0;C<y.length;C++){const R=y[C];for(let k=0,L=R.length,$=L-1;k<L;$=k++){const U=R[k],Z=R[$];U.y>g.y!=Z.y>g.y&&g.x<(Z.x-U.x)*(g.y-U.y)/(Z.y-U.y)+U.x&&(b=!b),A=Math.min(A,ki(g,U,Z))}}return(b?1:-1)*Math.sqrt(A)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const vK=Object.keys,WA=Number.POSITIVE_INFINITY,xK=Math.sqrt(2);function jd(l,r,a,u,h){const g=BA(l)&&l.collisionPadding?l.collisionPadding:[0,0,0,0],y={top:l.top-g[1],bottom:l.bottom+g[3],left:l.left-g[0],right:l.right+g[2],scaled:!1};return u!==void 0&&function(b,A){b.top*=A,b.bottom*=A,b.left*=A,b.right*=A,b.scaled=!0}(y,u),a&&function(b,A){if(!A)return;const C=Zr(A),R=new mt(b.left,b.top),k=new mt(b.right,b.top),L=new mt(b.left,b.bottom),$=new mt(b.right,b.bottom),U=new mt(0,0);R._rotateAround(C,U),k._rotateAround(C,U),L._rotateAround(C,U),$._rotateAround(C,U),b.left=Math.min(R.x,k.x,L.x,$.x),b.right=Math.max(R.x,k.x,L.x,$.x),b.top=Math.min(R.y,k.y,L.y,$.y),b.bottom=Math.max(R.y,k.y,L.y,$.y)}(y,a),h&&(y.left+=h[0],y.right+=h[0],y.top+=h[1],y.bottom+=h[1]),r?{top:Math.min(r.top,y.top),bottom:Math.max(r.bottom,y.bottom),left:Math.min(r.left,y.left),right:Math.max(r.right,y.right),scaled:r.scaled||y.scaled}:y}function mD(l,[r,a]){let u=0,h=0;if(a===WA){r<0&&(r=0);const g=r/xK;switch(l){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-r;break;case"top":h=r-7}switch(l){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),l){case"top-right":case"top-left":case"top":h=a-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-a}switch(l){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,h]}function bK(l,r,a,u,h,g,y,b,A,C,R,k,L,$){const U=l.layers[0],Z=U.appearances;if(Z.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const re={iconBBox:null,iconVerticalBBox:null},te={textBBox:null,textVerticalBBox:null},{baseIconRotate:le,baseTextRotate:ue,iconScaleFactor:pe}=function(_e,Ee,Me){const De=_e.get("icon-rotate").evaluate(Ee,{},Me),nt=_e.get("text-rotate").evaluate(Ee,{},Me),[Ve,lt]=_e.get("icon-size-scale-range");return{baseIconRotate:De,baseTextRotate:nt,iconScaleFactor:ne(1,Ve,lt)}}(u,h,g);r&&(re.iconBBox=jd(r,re.iconBBox,le,y),a)&&(re.iconVerticalBBox=jd(a,re.iconVerticalBBox,le+90,y));const Se=e1(k.horizontal);Se&&(te.textBBox=jd(Se,te.textBBox,ue,1,$)),k.vertical&&(te.textVerticalBBox=jd(k.vertical,te.textVerticalBBox,ue+90,1,$));for(const _e of Z)_e.hasIconProperties()&&wK(re,l,U,_e,h,g,b,le,y,A,r,C,pe,R),_e.hasTextProperties()&&SK(te,U,_e,h,g,$,ue,L,Se,k.vertical);return{iconBBox:re.iconBBox,iconVerticalBBox:re.iconVerticalBBox,textBBox:te.textBBox,textVerticalBBox:te.textVerticalBBox}}function wK(l,r,a,u,h,g,y,b,A,C,R,k,L,$){const{appearanceIconOffset:U,appearanceIconRotate:Z,appearanceIconSize:re}=function(pe,Se,_e,Ee,Me,De,nt,Ve){const lt=pe.hasProperty("icon-offset")?Se.getAppearanceValueAndResolveTokens(pe,"icon-offset",_e,Ee,[]):null,ft=lt&&Array.isArray(lt)?lt:Me,pt=pe.hasProperty("icon-rotate")?Se.getAppearanceValueAndResolveTokens(pe,"icon-rotate",_e,Ee,[]):null,xt=typeof pt=="number"?pt:De,wt=pe.hasProperty("icon-size")?Se.getAppearanceValueAndResolveTokens(pe,"icon-size",_e,Ee,[]):null;return{appearanceIconOffset:ft,appearanceIconRotate:xt,appearanceIconSize:typeof wt=="number"?wt*Ve.iconScaleFactor:nt}}(u,a,h,g,y,b,A,C);let te=null,le=null,ue=null;u.hasProperty("icon-image")?ue=function(pe,Se,_e,Ee,Me,De,nt){let Ve=null;const lt=Se.getAppearanceValueAndResolveTokens(_e,"icon-image",Ee,Me,[]);if(lt){const ft=pe.getResolvedImageFromTokens(lt),pt=_e.getUnevaluatedProperty("icon-size"),xt=nv(ft,jm(pe.zoom,pt,pe.worldview),pt,Me,pe.zoom,Ee,pe.pixelRatio,nt,pe.worldview);Ve=De.get(xt.iconPrimary.toString())}return Ve}(r,a,u,h,g,k,L):R&&(ue=R.imagePrimary),ue&&(te=Kb(ue,null,U,$),r.allowVerticalPlacement&&(le=Kb(ue,null,U,$))),te&&(l.iconBBox=jd(te,l.iconBBox,Z,re)),le&&(l.iconVerticalBBox=jd(le,l.iconVerticalBBox,Z+90,re))}function SK(l,r,a,u,h,g,y,b,A,C){const{appearanceTextOffset:R,appearanceTextRotate:k,appearanceTextSize:L}=function(U,Z,re,te,le,ue,pe){const Se=U.hasProperty("text-offset")?Z.getAppearanceValueAndResolveTokens(U,"text-offset",re,te,[]):null,_e=Se&&Array.isArray(Se)?[Se[0]*Ao,Se[1]*Ao]:le,Ee=U.hasProperty("text-rotate")?Z.getAppearanceValueAndResolveTokens(U,"text-rotate",re,te,[]):null,Me=typeof Ee=="number"?Ee:ue,De=U.hasProperty("text-size")?Z.getAppearanceValueAndResolveTokens(U,"text-size",re,te,[]):null;return{appearanceTextOffset:_e,appearanceTextRotate:Me,appearanceTextSize:typeof De=="number"?De:pe}}(a,r,u,h,g,y,b),$=L/b;A&&(l.textBBox=jd(A,l.textBBox,k,$,R)),C&&(l.textVerticalBBox=jd(C,l.textVerticalBBox,k+90,$,R))}function Qb(l,r,a,u,h,g,y,b,A){if(!r||!r.usvg)return;const C=rD(u),R=rD(h),k=g!=="both"&&g!=="width"||!eD(u)?1:R.width/C.width,L=g!=="both"&&g!=="height"||!tD(u)?1:R.height/C.height;a.scaleSelf(k,L);const $=a.toString();y.set($,a),b.set($,r);const{imagePosition:U}=UA($,r,of);A.set($,U)}function gD(l,r,a,u,h,g,y,b,A){if(!l)return;const C=function(R,k,L,$,U,Z){if(R.kind==="camera")return R.maxSize;if(R.kind==="composite"){const re=k.possiblyEvaluate(new si(R.maxZoom,{worldview:Z}),L).evaluate(U,{},L),te=k.possiblyEvaluate(new si(R.minZoom,{worldview:Z}),L).evaluate(U,{},L);return Math.max(re,te)}return k.possiblyEvaluate(new si($,{worldview:Z})).evaluate(U,{},L)}(r,a,u,h,g,A);return l.scaleSelf(C*b*y)}function nv(l,r,a,u,h,g,y,b,A){return{iconPrimary:gD(l.getPrimary(),r,a,u,h,g,y,b,A),iconSecondary:gD(l.getSecondary(),r,a,u,h,g,y,b,A)}}function TK(l,r,a){if(!r)return;const u=a.get(l.toString()),h=a.get(r.toString());u&&h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||Ut(`Mismatch in icon variant sizes: ${l.toString()} and ${r.toString()}`),u.usvg!==h.usvg&&Ut(`Mismatch in icon variant image types: ${l.id} and ${r.id}`))}function yD(l,r,a,u){if(!l)return;const h=r.get(a.toString());if(l.imagePrimary=h,u){const g=r.get(u.toString());l.imageSecondary=g}}function AK(l,r){for(const a in l.horizontal)_D(l.horizontal[a],r);_D(l.vertical,r)}function _D(l,r){if(l){for(const a of l.positionedLines)for(const u of a.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=r.get(h).paddedRect}}}function qA(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EK(l,r,a,u,h,g,y,b,A){const C=e1(g.horizontal)||g.vertical,R=a.get("icon-text-fit-padding").evaluate(u,{},h);let k,L=r;return r&&A!=="none"&&(l.allowVerticalPlacement&&g.vertical&&(k=$A(r,g.vertical,A,R,b,y)),C&&(L=$A(r,C,A,R,b,y))),{defaultShapedIcon:L,verticallyShapedIcon:k}}function PK(l,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le,ue,pe,Se,_e,Ee){let Me=y.textMaxSize.evaluate(r,{},L);Me===void 0?Me=b*y.textScaleFactor:Me*=y.textScaleFactor;const De=l.layers[0].layout,nt=Ao,Ve=b*y.textScaleFactor/nt,lt=e1(a.horizontal)||a.vertical;if(re!=="none"&&l.appearanceFeatureData&&r.index<l.appearanceFeatureData.length){const Ft=l.appearanceFeatureData[r.index];Ft&&(Ft.textShaping=lt,Ft.iconTextFitPadding=De.get("icon-text-fit-padding").evaluate(r,{},L),Ft.fontScale=Ve)}const ft=$.name==="globe",pt=l.tilePixelRatio*Me/nt,xt=(vt=l.overscaling,l.zoom>18&&vt>2&&(vt>>=1),Math.max(Mt/(512*vt),1)*De.get("symbol-spacing")),wt=De.get("text-padding")*l.tilePixelRatio,yt=De.get("icon-padding")*l.tilePixelRatio,_t=Zr(De.get("text-max-angle")),at=De.get("icon-rotation-alignment")==="map"&&ue!=="point",ot=xt/2;var vt;l.hasAnyIconTextFit===!1&&re!=="none"&&(l.hasAnyIconTextFit=!0);const Ot=r.properties?+r.properties[st]:null,Et=Ot&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(Ot):65535,or=(Ft,Ht,Qt)=>{if(Ht.x<0||Ht.x>=Mt||Ht.y<0||Ht.y>=Mt)return;let Hr=null;if(ft){const{x:Pt,y:er,z:Cr}=$.projectTilePoint(Ht.x,Ht.y,Qt);Hr={anchor:new Ou(Pt,er,Cr,0,void 0),up:$.upVector(Qt,Ht.x,Ht.y)}}(function(Pt,er,Cr,en,sn,Dr,Un,ve,Te,ct,bt,jt,Dt,sr,ur,Rr,Vr,Gr,Xr,_r,Er,pn,xn,bn,Dn,Yn,Gn,Sn,In,Ur,tn,yi,gr){const Yr=Pt.addToLineVertexArray(er,en);let Wn,ri,ai,Fi,ii,yr,bi,Ln=0,mi=0,io=0,Eo=0,Zi=-1,Ki=-1;const fo={};let js=pp("");const oi=Cr?Cr.anchor:er,ji=Sn!=="none";let Bi=0,Vs=0;if(Te._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Wo=Te.layout.get("text-offset").evaluate(Er,{},Dn);Bi=Wo[0]*Ao,Vs=Wo[1]*Ao}else Bi=Te.layout.get("text-radial-offset").evaluate(Er,{},Dn)*Ao,Vs=WA;if(Pt.allowVerticalPlacement&&sn.vertical){const Wo=sn.vertical;if(ur)yr=ZA(Wo),ve&&(bi=ZA(ve));else{const Ss=Te.layout.get("text-rotate").evaluate(Er,{},Dn)+90;ai=t1(ct,oi,er,bt,jt,Dt,Wo,sr,Ss,Rr,yi),ve&&(Fi=t1(ct,oi,er,bt,jt,Dt,ve,Gr,Ss,null,tn))}}if(Dr){const Wo=Pt.iconSizeData,Ss=Te.layout.get("icon-rotate").evaluate(Er,{},Dn),ra=HA(Dr,Ss,xn,ji,pn.iconScaleFactor),Nd=ve?HA(ve,Ss,xn,ji,pn.iconScaleFactor):void 0;ri=t1(ct,oi,er,bt,jt,Dt,Dr,Gr,Ss,null,Ur);const Gm=function(Yl,bv,NL,FX,zL,FL,BX,$X){const BL=Yl.layers[0],$L=BL.appearances;let Hm=bv.length;if(NL&&(Hm=Math.max(Hm,NL.length)),$L.length===0)return Hm;const[VX,UX]=FX.get("icon-size-scale-range"),GX=ne(1,VX,UX);for(const VL of $L){const UL=VL.getUnevaluatedProperties();if(UL._values["icon-image"].value!==void 0){const GL=BL.getAppearanceValueAndResolveTokens(VL,"icon-image",zL,FL,[]);if(GL){const HL=Yl.getResolvedImageFromTokens(GL);if(HL){const WL=UL._values["icon-size"],HX=nv(HL,jm(Yl.zoom,WL,Yl.worldview),WL,FL,Yl.zoom,zL,Yl.pixelRatio,GX,Yl.worldview),WX=BX.get(HX.iconPrimary.toString());Hm=Math.max(Hm,mK(WX,$X))}}}}return Hm}(Pt,ra,Nd,Te.layout,Er,Dn,Pt.iconAtlasPositions,ji);Ln=4*Gm;let Xl=null;Wo.kind==="source"?(Xl=[Wl*Te.layout.get("icon-size").evaluate(Er,{},Dn)*pn.iconScaleFactor],Xl[0]>Ru&&Ut(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)):Wo.kind==="composite"&&(Xl=[Wl*pn.compositeIconSizes[0].evaluate(Er,{},Dn)*pn.iconScaleFactor,Wl*pn.compositeIconSizes[1].evaluate(Er,{},Dn)*pn.iconScaleFactor],(Xl[0]>Ru||Xl[1]>Ru)&&Ut(`${Pt.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)),Pt.addSymbols(Pt.icon,ra,Xl,_r,Xr,Er,void 0,Cr,er,Yr.lineStartIndex,Yr.lineLength,-1,bn,Dn,Yn,Gn,Pt.symbolInstances.length,Gm),Zi=Pt.icon.placedSymbolArray.length-1,Nd&&(mi=4*Gm,Pt.addSymbols(Pt.icon,Nd,Xl,_r,Xr,Er,ta.vertical,Cr,er,Yr.lineStartIndex,Yr.lineLength,-1,bn,Dn,Yn,Gn,Pt.symbolInstances.length,Gm),Ki=Pt.icon.placedSymbolArray.length-1)}for(const Wo in sn.horizontal){const Ss=Wo,ra=sn.horizontal[Ss];Wn||(js=pp(ra.text),ur?ii=ZA(ra):Wn=t1(ct,oi,er,bt,jt,Dt,ra,sr,Te.layout.get("text-rotate").evaluate(Er,{},Dn),Rr,yi));const Nd=ra.positionedLines.length===1;if(io+=vD(Pt,Cr,er,ra,Un,Te,ur,Er,Rr,Yr,sn.vertical?ta.horizontal:ta.horizontalOnly,Nd?vK(sn.horizontal):[Ss],fo,Zi,pn,bn,Dn,Pt.symbolInstances.length,Yn),Nd)break}sn.vertical&&(Eo+=vD(Pt,Cr,er,sn.vertical,Un,Te,ur,Er,Rr,Yr,ta.vertical,["vertical"],fo,Ki,pn,bn,Dn,Pt.symbolInstances.length,Yn));let oo=-1;const hl=(Wo,Ss)=>Wo?Math.max(Wo,Ss):Ss;oo=hl(ii,oo),oo=hl(yr,oo),oo=hl(bi,oo);const Fc=oo>-1?1:0;Pt.glyphOffsetArray.length>=65535&&Ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Er.sortKey!==void 0&&Pt.addToSortKeyRanges(Pt.symbolInstances.length,Er.sortKey),Pt.symbolInstances.emplaceBack(er.x,er.y,oi.x,oi.y,oi.z,fo.right>=0?fo.right:-1,fo.center>=0?fo.center:-1,fo.left>=0?fo.left:-1,fo.vertical>=0?fo.vertical:-1,Zi,Ki,js,Wn!==void 0?Wn:Pt.collisionBoxArray.length,Wn!==void 0?Wn+1:Pt.collisionBoxArray.length,ai!==void 0?ai:Pt.collisionBoxArray.length,ai!==void 0?ai+1:Pt.collisionBoxArray.length,ri!==void 0?ri:Pt.collisionBoxArray.length,ri!==void 0?ri+1:Pt.collisionBoxArray.length,Fi||Pt.collisionBoxArray.length,Fi?Fi+1:Pt.collisionBoxArray.length,bt,io,Eo,Ln,mi,Fc,0,Bi,Vs,oo,0,ji?1:0,In)})(l,Ht,Hr,Ft,a,u,g,h,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,wt,le,C,0,yt,at,te,r,y,R,k,L,U,Z,re,Et,pe,Se,_e)};if(ue==="line")for(const Ft of Lb(r.geometry,0,0,Mt,Mt)){const Ht=pK(Ft,xt,_t,a.vertical||lt,u,nt,pt,l.overscaling,Mt);for(const Qt of Ht)lt&&CK(l,lt.text,ot,Qt)||or(Ft,Qt,L)}else if(ue==="line-center"){for(const Ft of r.geometry)if(Ft.length>1){const Ht=fK(Ft,_t,a.vertical||lt,u,nt,pt);Ht&&or(Ft,Ht,L)}}else if(r.type==="Polygon")for(const Ft of B_(r.geometry,0)){const Ht=yK(Ft,16);or(Ft[0],new Ou(Ht.x,Ht.y,0,0,void 0),L)}else if(r.type==="LineString")for(const Ft of r.geometry)or(Ft,new Ou(Ft[0].x,Ft[0].y,0,0,void 0),L);else if(r.type==="Point")for(const Ft of r.geometry)for(const Ht of Ft)or([Ht],new Ou(Ht.x,Ht.y,0,0,void 0),L)}const iv=255,Ru=iv*Wl;function vD(l,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le){const ue=function(_e,Ee,Me,De,nt,Ve,lt,ft){const pt=[];if(Ee.positionedLines.length===0)return pt;const xt=De.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,wt=function(vt){const Ot=vt[0],Et=vt[1],or=Ot*Et;return or>0?[Ot,-Et]:or<0?[-Ot,Et]:Ot===0?[Et,Ot]:[Et,-Ot]}(Me);let yt=Math.abs(Ee.top-Ee.bottom);for(const vt of Ee.positionedLines)yt-=vt.lineOffset;const _t=Ee.positionedLines.length,at=yt/_t;let ot=Ee.top-Me[1];for(let vt=0;vt<_t;++vt){const Ot=Ee.positionedLines[vt];ot=gK(Ee,at,ot,vt);for(const Et of Ot.positionedGlyphs){if(!Et.rect)continue;const or=Et.rect||{};let Ft=Zj+1,Ht=!0,Qt=1,Hr=0;if(Et.image){const Vr=lt.get(Et.image.toString());if(!Vr)continue;if(Vr.sdf){Ut("SDF images are not supported in formatted text and will be ignored.");continue}Ht=!1,Qt=Vr.pixelRatio,Ft=of/Qt}const Pt=(nt||ft)&&Et.vertical,er=Et.metrics.advance*Et.scale/2,Cr=Et.metrics,en=Et.rect;if(en===null)continue;ft&&Ee.verticalizable&&(Hr=Et.image?er-Et.metrics.width*Et.scale/2:0);const sn=nt?[Et.x+er,Et.y]:[0,0];let Dr=[0,0],Un=[0,0],ve=!1;nt||(Pt?(Un=[Et.x+er+wt[0],Et.y+wt[1]-Hr],ve=!0):Dr=[Et.x+er+Me[0],Et.y+Me[1]-Hr]);const Te=en.w*Et.scale/(Qt*(Et.localGlyph?ql:1)),ct=en.h*Et.scale/(Qt*(Et.localGlyph?ql:1));let bt,jt,Dt,sr;if(Pt){const Vr=Et.y-ot,Gr=new mt(-er,er-Vr),Xr=-Math.PI/2,_r=new mt(...Un);bt=new mt(-er+Dr[0],Dr[1]),bt._rotateAround(Xr,Gr)._add(_r),bt.x+=-Vr+er,bt.y-=(Cr.left-Ft)*Et.scale;const Er=Et.image?Cr.advance*Et.scale:Ao*Et.scale,pn=String.fromCodePoint(Et.glyph);YZ(pn)?bt.x+=(1-Ft)*Et.scale:JZ(pn)?bt.x+=Er-Cr.height*Et.scale+(-Ft-1)*Et.scale:bt.x+=Et.image||Cr.width+2*Ft===en.w&&Cr.height+2*Ft===en.h?(Er-ct)/2:(Er-(Cr.height+2*Ft)*Et.scale)/2,jt=new mt(bt.x,bt.y-Te),Dt=new mt(bt.x+ct,bt.y),sr=new mt(bt.x+ct,bt.y-Te)}else{const Vr=(Cr.left-Ft)*Et.scale-er+Dr[0],Gr=(-Cr.top-Ft)*Et.scale+Dr[1],Xr=Vr+Te,_r=Gr+ct;bt=new mt(Vr,Gr),jt=new mt(Xr,Gr),Dt=new mt(Vr,_r),sr=new mt(Xr,_r)}if(xt){let Vr;Vr=nt?new mt(0,0):ve?new mt(wt[0],wt[1]):new mt(Me[0],Me[1]),bt._rotateAround(xt,Vr),jt._rotateAround(xt,Vr),Dt._rotateAround(xt,Vr),sr._rotateAround(xt,Vr)}const ur=new mt(0,0),Rr=new mt(0,0);pt.push({tl:bt,tr:jt,bl:Dt,br:sr,texPrimary:or,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:sn,sectionIndex:Et.sectionIndex,isSDF:Ht,pixelOffsetTL:ur,pixelOffsetBR:Rr,minFontScaleX:0,minFontScaleY:0})}}return pt}(0,u,A,g,y,b,h,l.allowVerticalPlacement),pe=l.textSizeData;let Se=null;pe.kind==="source"?(Se=[Wl*g.layout.get("text-size").evaluate(b,{},re)*U.textScaleFactor],Se[0]>Ru&&Ut(`${l.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)):pe.kind==="composite"&&(Se=[Wl*U.compositeTextSizes[0].evaluate(b,{},re)*U.textScaleFactor,Wl*U.compositeTextSizes[1].evaluate(b,{},re)*U.textScaleFactor],(Se[0]>Ru||Se[1]>Ru)&&Ut(`${l.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)),l.addSymbols(l.text,ue,Se,A,y,b,R,r,a,C.lineStartIndex,C.lineLength,$,Z,re,le,!1,te,ue.length);for(const _e of k)L[_e]=l.text.placedSymbolArray.length-1;return 4*ue.length}function e1(l){for(const r in l)return l[r];return null}function t1(l,r,a,u,h,g,y,b,A,C,R){let k,L,$,U;if(k=R?R.top:y.top,L=R?R.bottom:y.bottom,$=R?R.left:y.left,U=R?R.right:y.right,BA(y)&&y.collisionPadding){const Z=y.collisionPadding;$-=Z[0],k-=Z[1],U+=Z[2],L+=Z[3]}if(A){const Z=new mt($,k),re=new mt(U,k),te=new mt($,L),le=new mt(U,L),ue=Zr(A);let pe=new mt(0,0);C&&(pe=new mt(C[0],C[1])),Z._rotateAround(ue,pe),re._rotateAround(ue,pe),te._rotateAround(ue,pe),le._rotateAround(ue,pe),$=Math.min(Z.x,re.x,te.x,le.x),U=Math.max(Z.x,re.x,te.x,le.x),k=Math.min(Z.y,re.y,te.y,le.y),L=Math.max(Z.y,re.y,te.y,le.y)}return l.emplaceBack(r.x,r.y,r.z,a.x,a.y,$,k,U,L,b,u,h,g),l.length-1}function ZA(l){BA(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const r=l.bottom-l.top;return r>0?Math.max(10,r):null}function CK(l,r,a,u){const h=l.compareText;if(r in h){const g=h[r];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<a)return!0}else h[r]=[];return h[r].push(u),!1}function xD(l,r){const a=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*r:0,h=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),g=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let y=Math.sin(l._pitch)*g+h;const b=h*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let A=Math.max(l.zoom-17,0);l.isOrthographic&&(A/=10),y*=1+A}return Math.min(1.01*y,b)}function ov(l,r){if(!r.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:r};const a=Math.pow(2,-l.z),u=l.x*a,h=(l.x+1)*a,g=l.y*a,y=(l.y+1)*a,b=F(u),A=F(h),C=W(g),R=W(y),k=r.project(b,C),L=r.project(A,C),$=r.project(A,R),U=r.project(b,R);let Z=Math.min(k.x,L.x,$.x,U.x),re=Math.min(k.y,L.y,$.y,U.y),te=Math.max(k.x,L.x,$.x,U.x),le=Math.max(k.y,L.y,$.y,U.y);const ue=a/16;function pe(_e,Ee,Me,De,nt,Ve){const lt=(Me+nt)/2,ft=(De+Ve)/2,pt=r.project(F(lt),W(ft)),xt=Math.max(0,Z-pt.x,re-pt.y,pt.x-te,pt.y-le);Z=Math.min(Z,pt.x),te=Math.max(te,pt.x),re=Math.min(re,pt.y),le=Math.max(le,pt.y),xt>ue&&(pe(_e,pt,Me,De,lt,ft),pe(pt,Ee,lt,ft,nt,Ve))}pe(k,L,u,g,h,g),pe(L,$,h,g,h,y),pe($,U,h,y,u,y),pe(U,k,u,y,u,g),Z-=ue,re-=ue,te+=ue,le+=ue;const Se=1/Math.max(te-Z,le-re);return{scale:Se,x:Z*Se,y:re*Se,x2:te*Se,y2:le*Se,projection:r}}function bD(l,{x:r,y:a},u=0){return new mt(((r-u)*l.scale-l.x)*Mt,(a*l.scale-l.y)*Mt)}const IK=V(new Float32Array(16));class Dd{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new c(0,0)}projectTilePoint(r,a,u){return{x:r,y:a,z:0}}locationPoint(r,a,u,h=!0){return r._coordinatePoint(r.locationCoordinate(a,u),h)}pixelsPerMeter(r,a){return D(1,r)*a}pixelSpaceConversion(r,a,u){return 1}farthestPixelDistance(r){return xD(r,r.pixelsPerMeter)}pointCoordinate(r,a,u,h){const g=r.horizonLineFromTop(!1),y=new mt(a,Math.max(g,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,h))}pointCoordinate3D(r,a,u){const h=new mt(a,u);if(r.elevation)return r.elevation.pointCoordinate(h);{const g=this.pointCoordinate(r,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(r,a){if(r.elevation&&r.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(r,a.x,a.y);const u=r.horizonLineFromTop();return a.y<u}createInversionMatrix(r,a){return IK}createTileMatrix(r,a,u){let h,g,y;const b=u.canonical,A=V(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=ov(b,this);h=1,g=C.x+u.wrap*C.scale,y=C.y,ie(A,A,[h/C.scale,h/C.scale,r.pixelsPerMeter/a])}else h=a/r.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*u.wrap)*h,y=b.y*h;return X(A,A,[g,y,0]),ie(A,A,[h/Mt,h/Mt,1]),A}upVector(r,a,u){return[0,0,1]}upVectorScale(r,a,u){return{metersToTile:1}}}class MK extends Dd{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,u]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(Zr(a));this.n=(h+Math.sin(Zr(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:u,c:h,r0:g}=this,y=Zr(r-this.center[0]),b=Zr(a),A=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:A*Math.sin(y*u),y:A*Math.cos(y*u)-g,z:0}}unproject(r,a){const{n:u,c:h,r0:g}=this,y=g+a;let b=Math.atan2(r,Math.abs(y))*Math.sign(y);y*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(y));const A=Zr(this.center[0])*u;b=ge(b,-Math.PI-A,Math.PI-A);const C=ne(os(b/u)+this.center[0],-180,180),R=Math.asin(ne((h-(r*r+y*y)*u*u)/(2*u),-1,1)),k=ne(os(R),-q,q);return new c(C,k)}}const sv=1.340264,av=-.081106,lv=893e-6,cv=.003796,r1=Math.sqrt(3)/2;class OK extends Dd{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(r1*Math.sin(a)),h=u*u,g=h*h*h;return{x:.5*(r*Math.cos(u)/(r1*(sv+3*av*h+g*(7*lv+9*cv*h)))/Math.PI+.5),y:1-.5*(u*(sv+av*h+g*(lv+cv*h))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,h=u*u,g=h*h*h;for(let R,k,L,$=0;$<12&&(k=u*(sv+av*h+g*(lv+cv*h))-a,L=sv+3*av*h+g*(7*lv+9*cv*h),R=k/L,u=ne(u-R,-Math.PI/3,Math.PI/3),h=u*u,g=h*h*h,!(Math.abs(R)<1e-12));++$);const y=r1*r*(sv+3*av*h+g*(7*lv+9*cv*h))/Math.cos(u),b=Math.asin(Math.sin(u)/r1),A=ne(180*y/Math.PI,-180,180),C=ne(180*b/Math.PI,-q,q);return new c(A,C)}}class RK extends Dd{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const u=360*(r-.5),h=ne(360*(.5-a),-q,q);return new c(u,h)}}const zm=Math.PI/2;function n1(l){return Math.tan((zm+l)/2)}class kK extends Dd{constructor(r){super(r),this.center=r.center||[0,30];const[a,u]=this.parallels=r.parallels||[30,30];let h=Zr(a),g=Zr(u);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const y=Math.cos(h),b=n1(h);this.n=h===g?Math.sin(h):Math.log(y/Math.cos(g))/Math.log(n1(g)/b),this.f=y*Math.pow(n1(h),this.n)/this.n}project(r,a){a=Zr(a),this.southernCenter&&(a=-a),r=Zr(r-this.center[0]);const u=1e-6,{n:h,f:g}=this;g>0?a<-zm+u&&(a=-zm+u):a>zm-u&&(a=zm-u);const y=g/Math.pow(n1(a),h);let b=y*Math.sin(h*r),A=g-y*Math.cos(h*r);return b=.5*(b/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:b,y:this.southernCenter?A:1-A,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:h}=this,g=h-a,y=Math.sign(g),b=Math.sign(u)*Math.sqrt(r*r+g*g);let A=Math.atan2(r,Math.abs(g))*y;g*u<0&&(A-=Math.PI*Math.sign(r)*y);const C=ne(os(A/u)+this.center[0],-180,180),R=ne(os(2*Math.atan(Math.pow(h/b,1/u))-zm),-q,q);return new c(C,this.southernCenter?-R:R)}}class wD extends Dd{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:P(r),y:O(a),z:0}}unproject(r,a){const u=F(r),h=W(a);return new c(u,h)}}const SD=Zr(q);class jK extends Dd{project(r,a){const u=(a=Zr(a))*a,h=u*u;return{x:.5*((r=Zr(r))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,h=25,g=0,y=u*u;do{y=u*u;const C=y*y;g=(u*(1.007226+y*(.015085+C*(.028874*y-.044475-.005916*C)))-a)/(1.007226+y*(.045255+C*(.259866*y-.311325-.005916*11*C))),u=ne(u-g,-SD,SD)}while(Math.abs(g)>1e-6&&--h>0);y=u*u;const b=ne(os(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),A=os(u);return new c(b,A)}}const TD=Zr(q);class DK extends Dd{project(r,a){a=Zr(a),r=Zr(r);const u=Math.cos(a),h=2/Math.PI,g=Math.acos(u*Math.cos(r/2)),y=Math.sin(g)/g,b=.5*(r*h+2*u*Math.sin(r/2)/y)||0,A=.5*(a+Math.sin(a)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(r,a){let u=r=(2*r-.5)*Math.PI,h=a=(2*(1-a)-1)*Math.PI,g=25;const y=1e-6;let b=0,A=0;do{const C=Math.cos(h),R=Math.sin(h),k=2*R*C,L=R*R,$=C*C,U=Math.cos(u/2),Z=Math.sin(u/2),re=2*U*Z,te=Z*Z,le=1-$*U*U,ue=le?1/le:0,pe=le?Math.acos(C*U)*Math.sqrt(1/le):0,Se=.5*(2*pe*C*Z+2*u/Math.PI)-r,_e=.5*(pe*R+h)-a,Ee=.5*ue*($*te+pe*C*U*L)+1/Math.PI,Me=ue*(re*k/4-pe*R*Z),De=.125*ue*(k*Z-pe*R*$*re),nt=.5*ue*(L*U+pe*te*C)+.5,Ve=Me*De-nt*Ee;b=(_e*Me-Se*nt)/Ve,A=(Se*De-_e*Ee)/Ve,u=ne(u-b,-Math.PI,Math.PI),h=ne(h-A,-TD,TD)}while((Math.abs(b)>y||Math.abs(A)>y)&&--g>0);return new c(os(u),os(h))}}class AD extends Dd{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Zr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:u,cosPhi:h}=this;return{x:Zr(r)*h*u+.5,y:-Math.sin(Zr(a))/h*u+.5,z:0}}unproject(r,a){const{scale:u,cosPhi:h}=this,g=-(a-.5)/u,y=ne(os((r-.5)/u)/h,-180,180),b=Math.asin(ne(g*h,-1,1)),A=ne(os(b),-q,q);return new c(y,A)}}class LK extends wD{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,u){const h=j_(r,a,u);return zr(h,h,Pb(Fa(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(r,a,u){const h=Cd(a.lat,a.lng),g=Lt([],h),y=u?r._centerAltitude+u:r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;br(h,h,g,D(1,0)*Mt*y);const b=V(new Float64Array(16));return Q(b,r.pixelMatrix,r.globeMatrix),zr(h,h,b),new mt(h[0],h[1])}pixelsPerMeter(r,a){return D(1,0)*a}pixelSpaceConversion(r,a,u){const h=D(1,r)*a,g=xr(D(1,45)*a,h,u);return this.pixelsPerMeter(r,a)/g}createTileMatrix(r,a,u){const h=Q2(Fa(u.canonical));return Q(new Float64Array(16),r.globeMatrix,h)}createInversionMatrix(r,a){const{center:u}=r,h=Pb(Fa(a));return se(h,h,Zr(u.lng)),J(h,h,Zr(u.lat)),ie(h,h,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(r,a,u,h){return Md(r,a,u,!0)||new de(0,0)}pointCoordinate3D(r,a,u){const h=this.pointCoordinate(r,a,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(r,a){return!Md(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(h,g){const y=h.cameraToCenterDistance,b=h._centerAltitude*g,A=h._camera,C=h._camera.forward(),R=ut([],$t([],C,-y),[0,0,b]),k=h.worldSize/(2*Math.PI),L=[0,0,-k],$=h.width/h.height,U=Math.tan(h.fovAboveCenter),Z=$t([],A.up(),U),re=$t([],A.right(),U*$),te=Lt([],ut([],ut([],C,Z),re)),le=[];let ue;if(new Jt(R,te).closestPointOnSphere(L,k,le)){const pe=ut([],le,L),Se=Qn([],pe,R);ue=Math.cos(h.fovAboveCenter)*it(Se)}else{const pe=Qn([],R,L),Se=Qn([],L,R);Lt(Se,Se);const _e=it(pe)-k;ue=Math.sqrt(_e*(_e+2*k));const Ee=Math.acos(ue/(k+_e))-Math.acos(nr(C,Se));ue*=Math.cos(Ee)}return 1.01*ue}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Od(r.zoom);if(u>0){const h=xD(r,D(1,r.center.lat)*r.worldSize),g=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return xr(a,h+g*(1-Math.cos(y)),Math.pow(u,10))}return a}upVector(r,a,u){return j_(a,u,r,1)}upVectorScale(r){return{metersToTile:ul(Eb(Fa(r)))}}}function ED(l){const r=l.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(l.name){case"mercator":return new wD(l);case"equirectangular":return new RK(l);case"naturalEarth":return new jK(l);case"equalEarth":return new OK(l);case"winkelTripel":return new DK(l);case"albers":return a?new AD(l):new MK(l);case"lambertConformalConic":return a?new AD(l):new kK(l);case"globe":return new LK(l)}throw new Error(`Invalid projection name: ${l.name}`)}const NK=Ne.types,zK=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function uv(l,r,a,u,h,g,y,b,A,C,R,k,L){const $=b?Math.min(Ru,Math.round(b[0])):0,U=b?Math.min(Ru,Math.round(b[1])):0;l.emplaceBack(r,a,Math.round(32*u),Math.round(32*h),g,y,($<<1)+(A?1:0),0+(U<<1),16*C,16*R,256*k,256*L)}function dv(l,r,a){l.emplaceBack(r,a)}function hv(l,r,a,u,h,g,y){l.emplaceBack(r,a,u,h,g,y)}const i1=(l,r,a,u)=>{for(let h=0;h<r;h++)l.emplaceBack(a[0],a[1],a[2],u[0],u[1],u[2])};function Fm(l,r,a,u,h){l.emplaceBack(r,a,u,h),l.emplaceBack(r,a,u,h),l.emplaceBack(r,a,u,h),l.emplaceBack(r,a,u,h)}function FK(l){for(const r of l.sections)if(N2(r.text))return!0;return!1}class KA{constructor(r){this.layoutVertexArray=new y_,this.indexArray=new to,this.programConfigurations=r,this.segments=new _i,this.dynamicLayoutVertexArray=new kc,this.opacityVertexArray=new lm,this.placedSymbolArray=new vb,this.iconTransitioningVertexArray=new Js,this.globeExtVertexArray=new __,this.zOffsetVertexArray=new Nl,this.orientationVertexArray=new b_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(r,a){const u=[],h=this.layoutVertexArray.uint16;for(let g=0;g<a;++g){const y=12*(r+g);u.push(...h.slice(y,y+12))}return u}updateIconVertexData(r,a,u,h,g,y,b,A,C,R,k,L,$){const U=this.layoutVertexArray.uint16,Z=12*r;U[Z]=a,U[Z+1]=u,U[Z+2]=h,U[Z+3]=g,U[Z+4]=y,U[Z+5]=b,U[Z+6]=A,U[Z+7]=C,U[Z+8]=R,U[Z+9]=k,U[Z+10]=L,U[Z+11]=$}upload(r,a,u,h,g,y){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,$Z.members,!!y),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,UZ.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,zK,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=r.createVertexBuffer(this.iconTransitioningVertexArray,WZ.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,VZ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=r.createVertexBuffer(this.zOffsetVertexArray,GZ.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=r.createVertexBuffer(this.orientationVertexArray,HZ.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Yt(KA,"SymbolBuffers");class XA{constructor(r,a,u){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new u,this.segments=new _i,this.collisionVertexArray=new v_,this.collisionVertexArrayExt=new kc}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,qZ.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,ZZ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Yt(XA,"CollisionBuffers");class o1{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=V([]),this.placementViewportMatrix=V([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=r.worldview,this.localizable=r.localizable,this.textSizeData=jm(this.zoom,a["text-size"],this.worldview),this.iconSizeData=jm(this.zoom,a["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.lut=r.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>ta[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(r){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some(u=>u.getProperty(r)!=null)}createArrays(){this.text=new KA(new Na(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("text")||r.startsWith("symbol"))),this.icon=new KA(new Na(this.layers,{zoom:this.zoom,lut:this.lut},r=>r.startsWith("icon")||r.startsWith("symbol"))),this.glyphOffsetArray=new gm,this.lineVertexArray=new bb,this.symbolInstances=new E_}calculateGlyphDependencies(r,a,u,h,g){for(const y of r){const b=y.codePointAt(0);if(b===void 0)break;if(a[b]=!0,h&&g&&b<=65535){const A=Q_[y];A&&(a[A.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(r,a,u,h,g,y){let b=1;const A=r.getUnevaluatedProperties()._values["icon-size"],C=jm(this.zoom,A,this.worldview),R=Dm(C,a);if(C.kind!=="constant"&&C.kind!=="camera"||(b=R.uSize),C.kind==="composite"){const{minZoom:k,maxZoom:L}=C,$=A.possiblyEvaluate(new si(k,{worldview:this.worldview}),h),U=A.possiblyEvaluate(new si(L,{worldview:this.worldview}),h),Z=$.evaluate(u,{},h,g);b=Z+(U.evaluate(u,{},h,g)-Z)*R.uSizeT}return C.kind==="source"&&(b=A.possiblyEvaluate(new si(this.zoom,{worldview:this.worldview}),h).evaluate(u,{},h,g)),b*y}updateFootprints(r,a){}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);return!kb(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}getResolvedImageFromTokens(r){return typeof r=="string"?_s.build(r):r}populate(r,a,u,h){const g=this.layers[0],y=g.layout,b=this.projection.name==="globe",A=y.get("text-font"),C=y.get("text-field"),R=y.get("icon-image"),[k,L]=y.get("icon-size-scale-range"),$=ne(a.scaleFactor||1,k,L),U=(C.value.kind!=="constant"||C.value.value instanceof ys&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),Z=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,re=this.hasAnyAppearanceProperty("icon-image"),te=y.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!U&&!Z&&!re)return;const le=a.iconDependencies,ue=a.glyphDependencies,pe=a.availableImages,Se=new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),_e=Ee=>{const Me=Ee.id.toString();le.has(Me)?le.get(Me).push(Ee):le.set(Me,[Ee])};for(const Ee of r){const{feature:Me,id:De,index:nt,sourceLayerIndex:Ve}=Ee,lt=g._featureFilter.needGeometry,ft=$e(Me,lt);if(!g._featureFilter.filter(Se,ft,u))continue;if(lt||(ft.geometry=Ce(Me,u,h)),b&&Me.type!==1&&u.z<=5){const vt=ft.geometry,Ot=.98078528056,Et=(or,Ft)=>nr(j_(or.x,or.y,u,1),j_(Ft.x,Ft.y,u,1))<Ot;for(let or=0;or<vt.length;or++)vt[or]=be(vt[or],Et)}let pt,xt;if(U){const vt=g.getValueAndResolveTokens("text-field",ft,u,pe),Ot=ys.factory(vt);FK(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||$h()==="unavailable"||this.hasRTLText&&Ll.isParsed())&&(pt=XZ(Ot,g,ft))}if(Z){const vt=g.getValueAndResolveTokens("icon-image",ft,u,pe);xt=this.getResolvedImageFromTokens(vt)}const wt=this.layers[0];let yt=!1;if(!xt&&re){const vt=wt.getAppearances();for(const Ot of vt)if(Ot.getProperty("icon-image")){const Et=wt.getAppearanceValueAndResolveTokens(Ot,"icon-image",ft,u,pe);if(Et){xt=this.getResolvedImageFromTokens(Et),yt=!0;break}}}if(!pt&&!xt)continue;const _t=this.sortFeaturesByKey?te.evaluate(ft,{},u):void 0,at={id:De,text:pt,icon:xt,index:nt,sourceLayerIndex:Ve,geometry:ft.geometry,properties:Me.properties,type:NK[Me.type],sortKey:_t};if(this.features.push(at),this.featureToAppearanceIndex[nt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:De,properties:Me.properties,usesAppearanceIconAsPlaceholder:yt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),xt){const vt=wt._unevaluatedLayout._values,{iconPrimary:Ot,iconSecondary:Et}=nv(xt,this.iconSizeData,vt["icon-size"],u,this.zoom,at,this.pixelRatio,$,this.worldview);_e(Ot),Et&&(this.hasAnySecondaryIcon=!0,_e(Et))}const ot=wt.getAppearances();if(ot.length!==0&&ot.forEach(vt=>{if(!vt.getProperty("icon-image"))return;const Ot=this.getCombinedIconPrimary(vt,wt,ft,u,pe,at,$);Ot&&_e(Ot)}),pt){const vt=A.evaluate(ft,{},u).join(","),Ot=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ta.vertical)>=0;for(const Et of pt.sections)if(Et.image){const or=Et.image.getPrimary().scaleSelf(this.pixelRatio),Ft=or.id.toString(),Ht=le.get(Ft)||[];Ht.push(or),le.set(Ft,Ht)}else{const or=Fh(pt.toString()),Ft=Et.fontStack||vt,Ht=ue[Ft]=ue[Ft]||{};this.calculateGlyphDependencies(Et.text,Ht,Ot,this.allowVerticalPlacement,or)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(Ee){const Me={},De={},nt=[];let Ve=0;function lt(wt){nt.push(Ee[wt]),Ve++}function ft(wt,yt,_t){const at=De[wt];return delete De[wt],De[yt]=at,nt[at].geometry[0].pop(),nt[at].geometry[0]=nt[at].geometry[0].concat(_t[0]),at}function pt(wt,yt,_t){const at=Me[yt];return delete Me[yt],Me[wt]=at,nt[at].geometry[0].shift(),nt[at].geometry[0]=_t[0].concat(nt[at].geometry[0]),at}function xt(wt,yt,_t){const at=_t?yt[0][yt[0].length-1]:yt[0][0];return`${wt}:${at.x}:${at.y}`}for(let wt=0;wt<Ee.length;wt++){const yt=Ee[wt],_t=yt.geometry,at=yt.text?yt.text.toString():null;if(!at){lt(wt);continue}const ot=xt(at,_t),vt=xt(at,_t,!0);if(ot in De&&vt in Me&&De[ot]!==Me[vt]){const Ot=pt(ot,vt,_t),Et=ft(ot,vt,nt[Ot].geometry);delete Me[ot],delete De[vt],De[xt(at,nt[Et].geometry,!0)]=Et,nt[Ot].geometry=null}else ot in De?ft(ot,vt,_t):vt in Me?pt(ot,vt,_t):(lt(wt),Me[ot]=Ve-1,De[vt]=Ve-1)}return nt.filter(wt=>wt.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,Me)=>Ee.sortKey-Me.sortKey)}getCombinedIconPrimary(r,a,u,h,g,y,b){let A,C;const R=r.getUnevaluatedProperties();if(R._values["icon-image"].value!==void 0){const k=a.getAppearanceValueAndResolveTokens(r,"icon-image",u,h,g);A=this.getResolvedImageFromTokens(k)}else{const k=a.getValueAndResolveTokens("icon-image",u,h,g);A=this.getResolvedImageFromTokens(k)}if(A){const k=R._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];C=nv(A,jm(this.zoom,k,this.worldview),k,h,this.zoom,y,this.pixelRatio,b,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(r,a,u,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const g=this.layers[0];let y=!1,b=0;const A=g.layout,[C,R]=A.get("icon-size-scale-range"),k=ne(1,C,R);for(let L=0;L<this.symbolInstances.length;L++){const $=this.symbolInstances.get(L),U=this.featureToAppearanceIndex[$.featureIndex],Z=U!==void 0?this.appearanceFeatureData[U]:void 0;if(Z&&$.placedIconSymbolIndex>=0){const re=Z.id,te=a&&re!==void 0?a[String(re)]:void 0,le={type:"Point",id:Z.id,properties:Z.properties,geometry:[]},ue=this.layers[0].appearances&&this.layers[0].appearances.find(pe=>pe.isActive({globals:h,feature:le,canonical:r,featureState:te}));if(Z.activeAppearance===ue){b+=$.numIconVertices;continue}if(ue){Z.activeAppearance=ue;const pe=this.getCombinedIconPrimary(ue,g,le,r,u,{sortKey:void 0,text:void 0,icon:null,index:$.featureIndex,sourceLayerIndex:$.featureIndex,geometry:[],properties:Z.properties,type:"Point",id:Z.id},k);if(!pe)continue;const Se=pe.toString(),_e=this.iconAtlasPositions&&this.iconAtlasPositions.get(Se);if(_e){const Ee=g.getAppearanceValueAndResolveTokens(ue,"icon-offset",le,r,u),Me=Ee&&Array.isArray(Ee)?Ee:[0,0];let De=Kb(_e,void 0,Me,g.layout.get("icon-anchor").evaluate(le,{},r));const nt=g.getAppearanceValueAndResolveTokens(ue,"icon-rotate",le,r,u),Ve=typeof nt=="number"?nt:0,lt=_e.sdf,ft=g.layout.get("icon-text-fit").constantOr("none");ft!=="none"&&Z.textShaping&&Z.iconTextFitPadding&&Z.fontScale&&(De=$A(De,Z.textShaping,ft,Z.iconTextFitPadding,Me,Z.fontScale));const pt=this.calculateEffectiveAppearanceIconSize(ue,h.zoom,le,r,u,k),xt=0,wt=1+(Math.min(Ru,Math.round(pt*Wl))<<1),yt=HA(De,Ve,lt,ft!=="none",k);Z.isUsingAppearanceVertexData||(Z.isUsingAppearanceVertexData=!0,Z.layoutBasedVertexData=this.icon.getIconVertexData(b,$.numIconVertices));for(let at=0;at<yt.length;++at){const ot=yt[at],vt=Z.layoutBasedVertexData[0]||$.tileAnchorX,Ot=Z.layoutBasedVertexData[1]||$.tileAnchorY,Et=16*ot.pixelOffsetTL.x,or=16*ot.pixelOffsetTL.y,Ft=16*ot.pixelOffsetBR.x,Ht=16*ot.pixelOffsetBR.y,Qt=16*ot.minFontScaleX,Hr=16*ot.minFontScaleY;this.icon.updateIconVertexData(b,vt,Ot,Math.round(32*ot.tl.x),Math.round(32*ot.tl.y),ot.texPrimary.x,ot.texPrimary.y,xt,wt,Et,or,Qt,Hr),this.icon.updateIconVertexData(b+1,vt,Ot,Math.round(32*ot.tr.x),Math.round(32*ot.tr.y),ot.texPrimary.x+ot.texPrimary.w,ot.texPrimary.y,xt,wt,Ft,or,Qt,Hr),this.icon.updateIconVertexData(b+2,vt,Ot,Math.round(32*ot.bl.x),Math.round(32*ot.bl.y),ot.texPrimary.x,ot.texPrimary.y+ot.texPrimary.h,xt,wt,Et,Ht,Qt,Hr),this.icon.updateIconVertexData(b+3,vt,Ot,Math.round(32*ot.br.x),Math.round(32*ot.br.y),ot.texPrimary.x+ot.texPrimary.w,ot.texPrimary.y+ot.texPrimary.h,xt,wt,Ft,Ht,Qt,Hr),b+=4}const _t=$.numIconVertices-4*yt.length;for(let at=0;at<_t;++at)this.icon.updateIconVertexData(b+at,0,0,0,0,0,0,0,0,0,0,0,0);y=!0}else b+=$.numIconVertices}else if(Z.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(b,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(b+3,0,0,0,0,0,0,0,0,0,0,0,0),y=!0),b+=$.numIconVertices,Z.activeAppearance=null;else if(Z.isUsingAppearanceVertexData){const Se=Z.layoutBasedVertexData.length/12;for(let _e=0;_e<Se;++_e){const Ee=_e*12;this.icon.updateIconVertexData(b+_e,Z.layoutBasedVertexData[Ee+0],Z.layoutBasedVertexData[Ee+1],Z.layoutBasedVertexData[Ee+2],Z.layoutBasedVertexData[Ee+3],Z.layoutBasedVertexData[Ee+4],Z.layoutBasedVertexData[Ee+5],Z.layoutBasedVertexData[Ee+6],Z.layoutBasedVertexData[Ee+7],Z.layoutBasedVertexData[Ee+8],Z.layoutBasedVertexData[Ee+9],Z.layoutBasedVertexData[Ee+10],Z.layoutBasedVertexData[Ee+11])}b+=Se,Z.isUsingAppearanceVertexData=!1,Z.activeAppearance=null,y=!0}else b+=$.numIconVertices,Z.activeAppearance=null}}return y}update(r,a,u,h,g,y,b){this.text.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(r,a,g,u,h,y,b,this.worldview)}updateRoadElevation(r){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const u=oe(r),h=1/u;let g=!1,y=!1;for(let b=0;b<this.symbolInstances.length;b++){const A=this.symbolInstances.get(b),C=Ge(1,0,0),R=Ge(0,1,0),{numHorizontalGlyphVertices:k,numVerticalGlyphVertices:L,numIconVertices:$,numVerticalIconVertices:U}=A,Z=k>0||L>0,re=$>0,te=this.elevationFeatures[A.elevationFeatureIndex];if(te){const le=new mt(A.tileAnchorX,A.tileAnchorY),ue=.075+te.pointElevation(le);A.zOffset!==ue&&(a=!0,A.zOffset=ue),ue!==0&&(this.hasAnyZOffset=!0);const pe=te.computeSlopeNormal(le,h),Se=qt(is(),Ge(0,0,1),pe);hi(C,C,Se),hi(R,R,Se),C[2]*=u,R[2]*=u,C[0]===1&&C[1]===0&&C[2]===0&&R[0]===0&&R[1]===1&&R[2]===0||(g=g||Z,y=y||re)}if(Z&&(i1(this.text.orientationVertexArray,k,C,R),i1(this.text.orientationVertexArray,L,C,R)),re){const{placedIconSymbolIndex:le,verticalPlacedIconSymbolIndex:ue}=A;le>=0&&i1(this.icon.orientationVertexArray,$,C,R),ue>=0&&i1(this.icon.orientationVertexArray,U,C,R)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const r=(g,y,b)=>{u+=y,u>g.length&&g.resize(u);for(let A=-y;A<0;A++)g.emplace(A+u,b)},a=(g,y,b)=>{h+=y,h>g.length&&g.resize(h);for(let A=-y;A<0;A++)g.emplace(A+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:A,numIconVertices:C}=y,R=y.zOffset,k=C>0;if((b>0||A>0)&&(r(this.text.zOffsetVertexArray,b,R),r(this.text.zOffsetVertexArray,A,R)),k){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:$}=y;L>=0&&a(this.icon.zOffsetVertexArray,C,R),$>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,R)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r,a,u,h,g){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(y=>y.appearances&&y.appearances.length>0)),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(r,a,u,h){return!!(r&&a&&u)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(r,a,u,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ED(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const u=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:h,y:g}of a)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z,re,te,le){const ue=r.indexArray,pe=r.layoutVertexArray,Se=r.globeExtVertexArray,_e=r.segments.prepareSegment(4*le,pe,ue,this.canOverlap?y.sortKey:void 0),Ee=this.glyphOffsetArray.length,Me=_e.vertexLength,De=this.allowVerticalPlacement&&b===ta.vertical?Math.PI/2:0,nt=y.text&&y.text.sections;for(let ft=0;ft<a.length;ft++){const{tl:pt,tr:xt,bl:wt,br:yt,texPrimary:_t,texSecondary:at,pixelOffsetTL:ot,pixelOffsetBR:vt,minFontScaleX:Ot,minFontScaleY:Et,glyphOffset:or,isSDF:Ft,sectionIndex:Ht}=a[ft],Qt=_e.vertexLength,Hr=or[1];if(uv(pe,C.x,C.y,pt.x,Hr+pt.y,_t.x,_t.y,u,Ft,ot.x,ot.y,Ot,Et),uv(pe,C.x,C.y,xt.x,Hr+xt.y,_t.x+_t.w,_t.y,u,Ft,vt.x,ot.y,Ot,Et),uv(pe,C.x,C.y,wt.x,Hr+wt.y,_t.x,_t.y+_t.h,u,Ft,ot.x,vt.y,Ot,Et),uv(pe,C.x,C.y,yt.x,Hr+yt.y,_t.x+_t.w,_t.y+_t.h,u,Ft,vt.x,vt.y,Ot,Et),A){const{x:Pt,y:er,z:Cr}=A.anchor,[en,sn,Dr]=A.up;hv(Se,Pt,er,Cr,en,sn,Dr),hv(Se,Pt,er,Cr,en,sn,Dr),hv(Se,Pt,er,Cr,en,sn,Dr),hv(Se,Pt,er,Cr,en,sn,Dr),Fm(r.dynamicLayoutVertexArray,Pt,er,Cr,De)}else Fm(r.dynamicLayoutVertexArray,C.x,C.y,C.z,De);if(re){const Pt=at||_t;dv(r.iconTransitioningVertexArray,Pt.x,Pt.y),dv(r.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y),dv(r.iconTransitioningVertexArray,Pt.x,Pt.y+Pt.h),dv(r.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y+Pt.h)}ue.emplaceBack(Qt,Qt+1,Qt+2),ue.emplaceBack(Qt+1,Qt+2,Qt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(or[0]),ft!==a.length-1&&Ht===a[ft+1].sectionIndex||r.programConfigurations.populatePaintArrays(pe.length,y,y.index,{},$,U,Z,nt&&nt[Ht],this.worldview)}const Ve=le-a.length;Ve!==0&&this._addNullVertices(Ve,pe,u,A,Se,r,re,_e,ue);const lt=A?A.anchor:C;r.placedSymbolArray.emplaceBack(lt.x,lt.y,lt.z,C.x,C.y,Ee,this.glyphOffsetArray.length-Ee,Me,R,k,C.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,0,0,L,0),r.symbolInstanceIndices.push(te)}_addNullVertices(r,a,u,h,g,y,b,A,C){for(let R=0;R<r;R++){for(let L=0;L<4;L++)uv(a,0,0,0,0,0,0,u,!1,0,0,0,0),h&&hv(g,0,0,0,0,0,0),Fm(y.dynamicLayoutVertexArray,0,0,0,0),b&&dv(y.iconTransitioningVertexArray,0,0);const k=A.vertexLength;C.emplaceBack(k,k+1,k+2),C.emplaceBack(k+1,k+2,k+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(r,a,u,h,g,y,b){r.emplaceBack(a,u,h,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,a,u,h,g,y,b){const A=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),C=A.vertexLength,R=b.tileAnchorX,k=b.tileAnchorY;for(let $=0;$<4;$++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,r.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,R,k,new mt(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,R,k,new mt(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,R,k,new mt(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,y,R,k,new mt(r.x1,r.y2)),A.vertexLength+=4;const L=u.indexArray;L.emplaceBack(C,C+1),L.emplaceBack(C+1,C+2),L.emplaceBack(C+2,C+3),L.emplaceBack(C+3,C),A.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,u,h,g,y){for(let b=h;b<g;b++){const A=u.get(b),C=this.getSymbolInstanceTextSize(r,y,a,b);this._addCollisionDebugVertices(A,C,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,a,u,h,g,y){for(let b=h;b<g;b++){const A=u.get(b),C=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(A,C,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new XA(um,Gj.members,Js),this.iconCollisionBox=new XA(um,Gj.members,Js);const h=Dm(this.iconSizeData,r),g=Dm(this.textSizeData,r,u);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,r,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(g,r,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,r,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(r,a,u,h){const g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),y=VA(this.textSizeData,r,g)/Ao;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,a,u){const h=this.icon.placedSymbolArray.get(u),g=VA(this.iconSizeData,r,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,a,u,h){r.emplaceBack(a,-u,-u,h),r.emplaceBack(a,u,-u,h),r.emplaceBack(a,u,u,h),r.emplaceBack(a,-u,u,h)}_updateTextDebugCollisionBoxes(r,a,u,h,g,y,b){for(let A=h;A<g;A++){const C=u.get(A),R=this.getSymbolInstanceTextSize(r,y,a,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,C.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(r,a,u,h,g,y,b){for(let A=h;A<g;A++){const C=u.get(A),R=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,C.padding,y.zOffset)}}updateCollisionDebugBuffers(r,a,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=Dm(this.iconSizeData,r,h),y=Dm(this.textSizeData,r,u);for(let b=0;b<this.symbolInstances.length;b++){const A=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(y,r,a,A.textBoxStartIndex,A.textBoxEndIndex,A,u),this._updateTextDebugCollisionBoxes(y,r,a,A.verticalTextBoxStartIndex,A.verticalTextBoxEndIndex,A,u),this._updateIconDebugCollisionBoxes(g,r,a,A.iconBoxStartIndex,A.iconBoxEndIndex,A,h),this._updateIconDebugCollisionBoxes(g,r,a,A.verticalIconBoxStartIndex,A.verticalIconBoxEndIndex,A,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,u,h,g,y,b,A,C){const R={};if(a<u){const{x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe,featureIndex:Se}=r.get(a);R.textBox={x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe},R.textFeatureIndex=Se}if(h<g){const{x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe,featureIndex:Se}=r.get(h);R.verticalTextBox={x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe},R.verticalTextFeatureIndex=Se}if(y<b){const{x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe,featureIndex:Se}=r.get(y);R.iconBox={x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe},R.iconFeatureIndex=Se}if(A<C){const{x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe,featureIndex:Se}=r.get(A);R.verticalIconBox={x1:k,y1:L,x2:$,y2:U,padding:Z,projectedAnchorX:re,projectedAnchorY:te,projectedAnchorZ:le,tileAnchorX:ue,tileAnchorY:pe},R.verticalIconFeatureIndex=Se}return R}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(r,a){const u=r.placedSymbolArray.get(a),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),u=Math.cos(r),h=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const A=this.symbolInstances.get(b);h.push(0|Math.round(a*A.tileAnchorX+u*A.tileAnchorY)),g.push(A.featureIndex)}return y.sort((b,A)=>h[b]-h[A]||g[A]-g[b]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let r=0;r<this.symbolInstances.length;++r)this.symbolInstanceIndexesSortedZOffset.push(r)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((r,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(r).zOffset)}addToSortKeyRanges(r,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:C}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==h&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(r){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[r]).elevationFeatureIndex;let u;return this.elevationFeatures&&a<this.elevationFeatures.length&&(u=this.elevationFeatures[a]),u}}function PD(l,r){return r.replace(/{([^{}]+)}/g,(a,u)=>u in l?String(l[u]):"")}let CD,ID,YA;Yt(o1,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),o1.addDynamicAttributes=Fm;class MD{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ra,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt(MD,"FormatSectionOverride",{omit:["defaultValue"]});const JA=()=>YA||(YA={layout:CD||(CD=new Pi({"symbol-placement":new Ct(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(He.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ct(He.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ct(He.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ct(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(He.layout_symbol["icon-size"]),"icon-size-scale-range":new Ct(He.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(He.layout_symbol["icon-image"]),"icon-image-use-theme":new Ct({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new kt(He.layout_symbol["icon-rotate"]),"icon-padding":new Ct(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(He.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(He.layout_symbol["icon-offset"]),"icon-anchor":new kt(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(He.layout_symbol["text-rotation-alignment"]),"text-field":new kt(He.layout_symbol["text-field"]),"text-font":new kt(He.layout_symbol["text-font"]),"text-size":new kt(He.layout_symbol["text-size"]),"text-size-scale-range":new Ct(He.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(He.layout_symbol["text-max-width"]),"text-line-height":new kt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(He.layout_symbol["text-letter-spacing"]),"text-justify":new kt(He.layout_symbol["text-justify"]),"text-radial-offset":new kt(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(He.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(He.layout_symbol["text-anchor"]),"text-max-angle":new Ct(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(He.layout_symbol["text-writing-mode"]),"text-rotate":new kt(He.layout_symbol["text-rotate"]),"text-padding":new Ct(He.layout_symbol["text-padding"]),"text-keep-upright":new Ct(He.layout_symbol["text-keep-upright"]),"text-transform":new kt(He.layout_symbol["text-transform"]),"text-offset":new kt(He.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(He.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(He.layout_symbol["text-optional"]),visibility:new Ct(He.layout_symbol.visibility)})),paint:ID||(ID=new Pi({"icon-opacity":new kt(He.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(He.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(He.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(He.paint_symbol["text-emissive-strength"]),"icon-color":new kt(He.paint_symbol["icon-color"]),"icon-halo-color":new kt(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(He.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ct(He.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(He.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(He.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(He.paint_symbol["text-color"],{runtimeType:Ms,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new kt(He.paint_symbol["text-halo-color"]),"text-halo-width":new kt(He.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(He.paint_symbol["text-halo-blur"]),"text-translate":new Ct(He.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(He.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ct(He.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ct(He.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ct(He.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ct(He.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(He.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},YA);class s1 extends bs{constructor(r,a,u,h){super(r,JA(),a,u,h,r.layout?r.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=V([]),this.hasOcclusionOpacityProperties=r.paint!==void 0&&("icon-occlusion-opacity"in r.paint||"text-occlusion-opacity"in r.paint)}_handleSpecialPaintPropertyUpdate(r){r!=="icon-occlusion-opacity"&&r!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(r,a){super.recalculate(r,a),this.appearances&&this.appearances.forEach(h=>{h.recalculate(r,a,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(r,a,u,h){return this._saturation===r&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(g,y,b,A){g=Si(g),y=gn(y);const C=G(),R=g/3,k=1-2*R,L=[k,R,R,0,R,k,R,0,R,R,k,0,0,0,0,1],$=.5-.5*y,U=A-b;return Q(C,[U,0,0,0,0,U,0,0,0,0,U,0,b,b,b,1],[y,0,0,0,0,y,0,0,0,0,y,0,$,$,$,1]),Q(C,C,L),C}(r,a,u,h),this._saturation=r,this._contrast=a,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(r,a,u,h){const g=this.layout.get(r).evaluate(a,{},u,h),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Nh(y.value)||!g?g:PD(a.properties,g)}getAppearanceValueAndResolveTokens(r,a,u,h,g){const y=r.getProperty(a);if(!y)return;const b=y.evaluate(u,{},h,g),A=r.getUnevaluatedProperties()._values[a];return A.isDataDriven()||Nh(A.value)||!b||typeof b!="string"?b:PD(u.properties,b)}createBucket(r){return new o1(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of JA().paint.overridableProperties){if(!s1.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),u=new MD(a),h=new Wp(u,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new vd("source",h):new vu("composite",h,a.value.zoomStops,a.value.interpolationType),this.paint._values[r]=new bu(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&s1.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const u=r.get("text-field"),h=JA().paint.properties[a];let g=!1;const y=b=>{for(const A of b)if(h.overrides&&h.overrides.hasOverride(A))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ys)y(u.value.value.sections);else if(u.value.kind==="source"){const b=C=>{g||(C instanceof Ml&&To(C.value)===wh?y(C.value.sections):C instanceof rl?y(C.sections):C.eachChild(b))},A=u.value;A._styleExpression&&b(A._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(r,a,u){return{config:new Dc(this,{zoom:a,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let OD,RD,kD,jD;var QA=Kr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function a1(l,r,a,u,h,g,y,b){const A=[l,r,1,a,u,1,h,g,1],C=[y,b,1],R=j([],A),[k,L,$]=un(C,C,R);return N(A,A,[k,0,0,0,L,0,0,0,$])}function DD(l,r,a,u,h,g,y,b){const A=function(C,R,k,L,$,U,Z,re){const te=a1(0,0,1,0,1,1,0,1),le=a1(C,R,k,L,$,U,Z,re);return N(le,le,j([],te))}(l,r,a,u,h,g,y,b);return[A[2]/A[8]/Mt,A[5]/A[8]/Mt]}function l1(l){return[l[0],Math.min(Math.max(l[1],-q),q)]}class LD extends fu{constructor(r,a,u,h){super(),this.id=r,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=a,this._dirty=!1}load(r,a){if(this._loaded=a||!1,this.fire(new el("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return r&&(this.coordinates=r),this._loaded=!0,void this._finishLoading();this._imageRequest=fp(this.map._requestManager.transformRequest(this.url,mh.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new vh(u)):h&&(this.image=h instanceof HTMLImageElement?So.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}setTexture(r){if(!(r.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new X_(this.map.painter.context,r.handle),this.width=r.dimensions[0],this.height=r.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new el("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(r){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof X_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(r){if(this.coordinates=r,this._boundsArray=void 0,this._unsupportedCoords=!1,!r.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=r[0][1],u=r[0][1];for(const g of r)g[1]>u&&(u=g[1]),g[1]<a&&(a=g[1]);const h=(u+a)/2;if(h>q?this.onNorthPole=!0:h<-q&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=r.map(de.fromLngLat);this.tileID=function(y){let b=1/0,A=1/0,C=-1/0,R=-1/0;for(const Z of y)b=Math.min(b,Z.x),A=Math.min(A,Z.y),C=Math.max(C,Z.x),R=Math.max(R,Z.y);const k=Math.max(C-b,R-A),L=Math.max(0,Math.floor(-Math.log2(k))),$=Math.pow(2,L);let U=Math.floor((b+C)/2*$);return U>1&&(U-=1),new Xn(L,U,Math.floor((A+R)/2*$))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new el("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof X_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(r){for(const te in this.tiles){const le=this.tiles[te];le.state!=="loaded"&&(le.state="loaded",le.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=ov(new Xn(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(te){const le=te[1].x-te[0].x,ue=te[1].y-te[0].y,pe=te[2].x-te[1].x,Se=te[2].y-te[1].y,_e=te[3].x-te[2].x,Ee=te[3].y-te[2].y,Me=te[0].x-te[3].x,De=te[0].y-te[3].y,nt=le*Se-pe*ue,Ve=pe*Ee-_e*Se,lt=_e*De-Me*Ee,ft=Me*ue-le*De;return nt>0&&Ve>0&&lt>0&&ft>0||nt<0&&Ve<0&&lt<0&&ft<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=ov(this.tileID,this.map.transform.projection),[g,y,b,A]=this.coordinates.map(te=>{const le=h.projection.project(te[0],te[1]);return bD(h,le)._round()});this.perspectiveTransform=DD(g.x,g.y,y.x,y.y,b.x,b.y,A.x,A.y);const C=this._boundsArray=new Sd;C.emplaceBack(g.x,g.y,0,0),C.emplaceBack(y.x,y.y,Mt,0),C.emplaceBack(A.x,A.y,0,Mt),C.emplaceBack(b.x,b.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=r.createVertexBuffer(C,QA.members),this.boundsSegments=_i.simpleSegment(0,0,4,2);const R=[],k=[l1((L=this.coordinates)[0]),l1(L[1]),l1(L[2]),l1(L[3])];var L;const[$,U,Z,re]=function(te){let le=te[0][0],ue=le,pe=te[0][1],Se=pe;for(let _e=1;_e<te.length;_e++)te[_e][0]<le?le=te[_e][0]:te[_e][0]>ue&&(ue=te[_e][0]),te[_e][1]<pe?pe=te[_e][1]:te[_e][1]>Se&&(Se=te[_e][1]);return[le,pe,ue-le,Se-pe]}(k);{const te=new Sd,[le,ue,pe,Se]=function(yt){let _t=yt[0].x,at=_t,ot=yt[0].y,vt=ot;for(let Ot=1;Ot<yt.length;Ot++)yt[Ot].x<_t?_t=yt[Ot].x:yt[Ot].x>at&&(at=yt[Ot].x),yt[Ot].y<ot?ot=yt[Ot].y:yt[Ot].y>vt&&(vt=yt[Ot].y);return[_t,ot,at-_t,vt-ot]}(u),_e=yt=>[(yt.x-le)/pe,(yt.y-ue)/Se],[Ee,Me,De,nt]=u.map(_e),Ve=function(yt,_t,at,ot,vt,Ot,Et,or){const Ft=a1(0,0,1,0,1,1,0,1);return N(Ft,Ft,j([],a1(yt,_t,at,ot,vt,Ot,Et,or)))}(Ee[0],Ee[1],Me[0],Me[1],De[0],De[1],nt[0],nt[1]);this.elevatedGlobePerspectiveTransform=DD(Ee[0],Ee[1],Me[0],Me[1],De[0],De[1],nt[0],nt[1]);const lt=(yt,_t)=>{R.push(yt.lng);const at=Math.round((yt.lng-$)/Z*Mt),ot=Math.round((yt.lat-U)/re*Mt),vt=_e(_t),Ot=un([],[vt[0],vt[1],1],Ve),Et=Math.round(Ot[0]/Ot[2]*Mt),or=Math.round(Ot[1]/Ot[2]*Mt);te.emplaceBack(at,ot,Et,or)},ft=u[3].x-u[0].x,pt=u[3].y-u[0].y,xt=u[2].x-u[1].x,wt=u[2].y-u[1].y;for(let yt=0;yt<65;yt++){const _t=yt/64,at=[u[0].x+_t*ft,u[0].y+_t*pt],ot=[u[1].x+_t*xt,u[1].y+_t*wt],vt=ot[0]-at[0],Ot=ot[1]-at[1];for(let Et=0;Et<65;Et++){const or=Et/64,Ft={x:at[0]+vt*or,y:at[1]+Ot*or};lt(a.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=r.createVertexBuffer(te,QA.members)}{this.maxLongitudeTriangleSize=0;let te=[],le=new to;const ue=(pe,Se,_e)=>{le.emplaceBack(pe,Se,_e);const Ee=R[pe],Me=R[Se],De=R[_e],nt=Math.min(Math.min(Ee,Me),De),Ve=Math.max(Math.max(Ee,Me),De)-nt;Ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ve),te.push(nt+Ve/2)};for(let pe=0;pe<64;pe++)for(let Se=0;Se<64;Se++){const _e=65*pe+Se,Ee=_e+1,Me=_e+65,De=Me+1;ue(_e,Me,Ee),ue(Ee,Me,De)}[te,le]=function(pe,Se){const _e=Array.from({length:pe.length},(De,nt)=>nt);_e.sort((De,nt)=>pe[De]-pe[nt]);const Ee=[],Me=new to;for(let De=0;De<_e.length;De++){const nt=_e[De];Ee.push(pe[nt]);const Ve=3*nt,lt=Ve+1;Me.emplaceBack(Se.uint16[Ve],Se.uint16[lt],Se.uint16[lt+1])}return[Ee,Me]}(te,le),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=r.createIndexBuffer(le)}this.elevatedGlobeSegments=_i.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Z/Mt,0,re/Mt,0,0,U,$,0])}prepare(){const r=Object.keys(this.tiles).length!==0;if(this.tileID&&!r)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof X_||(this.texture?this.texture.update(this.image):(this.texture=new TA(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),r&&this._prepareData(a)}loadTile(r,a){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},a(null)):(r.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(r){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(g=r+180)+360*Math.round((u[0]-g)/360);var g;const y=new _i,b=(k,L)=>{y.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:a.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=A){const k=wi(u,0,u.length,h+A);return k===u.length||b(k,Ji(u,k+1,u.length,h+360-A)-k),y}h<u[0]&&(h+=360);const C=Ji(u,0,u.length,h-A);if(C===u.length)return b(0,u.length),y;b(0,C-0);const R=wi(u,C+1,u.length,h+A);return R!==u.length&&b(R,u.length-R),y}}const BK=(Math.pow(256,2)-1)/16907520;class ND extends bs{constructor(r,a,u,h){super(r,{layout:kD||(kD=new Pi({visibility:new Ct(He.layout_raster.visibility)})),paint:jD||(jD=new Pi({"raster-opacity":new Ct(He.paint_raster["raster-opacity"]),"raster-color":new Su(He.paint_raster["raster-color"]),"raster-color-mix":new Ct(He.paint_raster["raster-color-mix"]),"raster-color-range":new Ct(He.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ct(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(He.paint_raster["raster-saturation"]),"raster-contrast":new Ct(He.paint_raster["raster-contrast"]),"raster-resampling":new Ct(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(He.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ct(He.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ct(He.paint_raster["raster-array-band"]),"raster-elevation":new Ct(He.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(r){return!(r&&r._source instanceof LD&&(r._source.onNorthPole||r._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(r){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=r||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=D_({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let zD,FD,BD,$D,VD;class UD extends bs{constructor(r,a,u,h){super(r,{layout:zD||(zD=new Pi({visibility:new Ct(He["layout_raster-particle"].visibility)})),paint:FD||(FD=new Pi({"raster-particle-array-band":new Ct(He["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ct(He["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Su(He["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ct(He["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ct(He["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ct(He["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ct(He["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ct(He["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},a,u,h),this._updateColorRamp(),this.lastInvalidatedAt=So.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(r){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(r){return!1}_handleSpecialPaintPropertyUpdate(r){r!=="raster-particle-color"&&r!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),r==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=D_({expression:r,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=So.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class $K extends bs{constructor(r,a){super(r,{},a,null),this.implementation=r,r.slot&&(this.slot=r.slot)}is3D(r){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(r){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}function eE(l,r,a){const u=[0,0,1],h=Io([]);return qs(h,h,a?-Zr(l)+Math.PI:Zr(l)),jo(h,h,-Zr(r)),hi(u,u,h),Lt(u,u)}const GD={None:0,Model:1,Symbol:2,FillExtrusion:4};class c1{constructor(r,a,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)}}function tE(l,r){const a=l.indexOf("://")===-1;try{return new URL(l,a&&r?"http://example.com":void 0),!0}catch{return!1}}class HD{constructor(r,a){this.feature=r,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WD{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new T_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(r){const a=16*r,u=this.instancedDataArray.float32;let h=Math.floor(u[a+2]);const g=1.05*(u[a+2]-h);return h/=100,[u[a]%1*1.05,u[a+1]%1*1.05,g,h]}tileCoordinatesForInstance(r){const a=16*r,u=this.instancedDataArray.float32;let h=u[a+0];return h=h>Mt?h-Mt:h,new mt(Math.trunc(h),Math.trunc(u[a+1]))}translationForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+4],u[a+5],u[a+6]]}rotationScaleForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+10],u[a+11],u[a+12],u[a+13],u[a+14],u[a+15]]}transformForInstance(r){const a=16*r,u=this.instancedDataArray.float32;return[u[a+7],u[a+8],u[a+9],u[a+4],u[a+10],u[a+11],u[a+12],u[a+5],u[a+13],u[a+14],u[a+15],u[a+6],0,0,0,1]}}class rE{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaledZ=this.canonical.z+Math.log2(r.overscaling),this.layers=r.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=r.projection,this.index=r.index,this.worldview=r.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=r.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(r,a){}updateAppearances(r,a,u,h){}populate(r,a,u,h){this.tileToMeter=oe(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:b,index:A,sourceLayerIndex:C}of r){const R=b??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),k=$e(y,g);if(!this.layers[0]._featureFilter.filter(new si(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),k,u))continue;const L={id:R,sourceLayerIndex:C,index:A,geometry:g?k.geometry:Ce(y,u,h),properties:y.properties,type:y.type,patterns:{}},$=this.addFeature(L,L.geometry,k);$&&a.featureIndex.insert(y,L.geometry,A,C,this.index,this.instancesPerModel[$].instancedDataArray.length,Mt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const r=this.layers[0].modelManager,a=this.layers[0].scope;let u=0;for(const h of this.modelUris){const g=r.getModel(h,a);if(!g)continue;const y=this.instancesPerModel[h];if(y){const b=.5*nn(g.aabb.max,g.aabb.min)*y.maxScale+y.maxXYTranslationDistance,A=Math.min(Mt,Math.max(b/this.tileToMeter,Mt/32));u=Math.max(A,u)}}return u}update(r,a,u,h){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const b in r)y.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(y.features[y.idToFeaturesIndex[b]],r[b],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let r=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const h of u.features){const g=this.layers[0],y=h.feature,b=this.canonical,A=g.paint.get("model-rotation").evaluate(y,{},b),C=g.paint.get("model-scale").evaluate(y,{},b),R=g.paint.get("model-translation").evaluate(y,{},b);zn(h.rotation,A)&&zn(h.scale,C)&&zn(h.translation,R)||(this.evaluate(h,h.featureStates,u,!0),r=!0)}}return r}updateReplacement(r,a,u,h){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const g=a.getReplacementRegionsForTile(r.toUnwrapped(),!0);if(kb(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const b in this.instancesPerModel){const A=this.instancesPerModel[b],C=A.instancedDataArray;for(const R of A.features){const k=R.instancedDataOffset,L=R.instancedDataCount;for(let $=0;$<L;$++){const U=16*($+k);let Z=C.float32[U+0];const re=Z>Mt;Z=re?Z-Mt:Z;const te=Math.floor(Z),le=Math.floor(C.float32[U+1]);let ue=!1;for(const pe of this.activeReplacements)if(!Rk(pe,u,GD.Model,h)&&!(pe.min.x>te||te>pe.max.x||pe.min.y>le||le>pe.max.y)&&(ue=Nk(Lk(te,le,r.canonical,pe.footprintTileId.canonical),pe.footprint),ue))break;C.float32[U]=ue?Z+Mt:Z,y=y||ue!==re}}}return y}isEmpty(){for(const r in this.instancesPerModel)if(this.instancesPerModel[r].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(r){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=r.createVertexBuffer(u.instancedDataArray,uZ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(r){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(r&&a&&this.modelUris&&this.modelsRequested)for(const u of this.modelUris)a.removeModel(u,"",!0)}addFeature(r,a,u){const h=this.layers[0],g=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Ut(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),g;(tE(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new WD);const y=this.instancesPerModel[g],b=y.instancedDataArray,A=new HD(u,b.length);for(const C of a)for(const R of C){if(R.x<0||R.x>=Mt||R.y<0||R.y>=Mt)continue;if(this.lookupDim!==0){const L=(this.lookupDim-1)/Mt,$=this.lookupDim*(R.y*L|0)+R.x*L|0;if(this.lookup){if(this.lookup[$]!==0)continue;this.lookup[$]=1}}this.instanceCount++;const k=b.length;b.resize(k+1),y.instancesEvaluatedElevation.push(0),b.float32[16*k]=R.x,b.float32[16*k+1]=R.y}return A.instancedDataCount=y.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(r.id&&(y.idToFeaturesIndex[r.id]=y.features.length),y.features.push(A),this.evaluate(A,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(r,a,u,h){const g=this.layers[0],y=r.feature,b=this.canonical,A=r.rotation=g.paint.get("model-rotation").evaluate(y,a,b),C=r.scale=g.paint.get("model-scale").evaluate(y,a,b),R=r.translation=g.paint.get("model-translation").evaluate(y,a,b),k=Object.assign({},g.paint.get("model-color").evaluate(y,a,b));k.a=g.paint.get("model-color-mix-intensity").evaluate(y,a,b);const L=[];this.maxVerticalOffset<R[2]&&(this.maxVerticalOffset=R[2]);const $=R[0]*R[0]+R[1]*R[1],U=$>0?Math.sqrt($):0;u.maxScale=Math.max(Math.max(u.maxScale,C[0]),Math.max(C[1],C[2])),u.maxXYTranslationDistance=Math.max(u.maxXYTranslationDistance,U),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),Sj(L,A,C);const Z=Math.round(100*k.a)+k.b/1.05;for(let re=0;re<r.instancedDataCount;++re){const te=r.instancedDataOffset+re,le=16*te,ue=u.instancedDataArray.float32;let pe=0;h&&(pe=ue[le+6]-u.instancesEvaluatedElevation[te]);const Se=0|ue[le+1];ue[le]=(0|ue[le])+k.r/1.05,ue[le+1]=Se+k.g/1.05,ue[le+2]=Z,ue[le+3]=1/(b.z>10?this.tileToMeter:oe(b,Se)),ue[le+4]=R[0],ue[le+5]=R[1],ue[le+6]=R[2]+pe,ue[le+7]=L[0],ue[le+8]=L[1],ue[le+9]=L[2],ue[le+10]=L[4],ue[le+11]=L[5],ue[le+12]=L[6],ue[le+13]=L[8],ue[le+14]=L[9],ue[le+15]=L[10],u.instancesEvaluatedElevation[te]=R[2]}}}let qD,ZD;Yt(rE,"ModelBucket",{omit:["layers"]}),Yt(WD,"PerModelAttributes"),Yt(HD,"ModelFeature");class Bm{constructor(r,a,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(r,a,u){const h=u||r.findDEMTileFor(a);if(!h||!h.dem)return;const g=h.dem,y=h.tileID,b=1<<a.canonical.z-y.canonical.z;return new Bm(h,g.dim/Mt/b,[(a.canonical.x/b-y.canonical.x)*g.dim,(a.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(r,a){const u=a*this._scale+this._offset[1];return new mt(Math.floor(r*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(r,a,u,h){const g=r*this._scale+this._offset[0],y=a*this._scale+this._offset[1],b=Math.floor(g),A=Math.floor(y),C=this._dem;return h=!!h,u?xr(xr(C.get(b,A,h),C.get(b,A+1,h),y-A),xr(C.get(b+1,A,h),C.get(b+1,A+1,h),y-A),g-b):C.get(b,A,h)}getElevationAtPixel(r,a,u){return this._dem.get(r,a,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*D(1,r)*this._dem.stride}}const nE=new Float32Array(262144),sf=new Uint8Array(262144);function KD(l){let r=0;if(l.meshes)for(const a of l.meshes)r=Math.max(r,a.aabb.max[2]);if(l.children)for(const a of l.children)r=Math.max(r,KD(a));return r}function XD(l,r,a){if(l.meshes)for(const u of l.meshes){if(u.aabb.min[0]===1/0)continue;const h=rr.applyTransform(u.aabb,l.globalMatrix);a.insert(r,h.min[0],h.min[1],h.max[0],h.max[1])}if(l.children)for(const u of l.children)XD(u,r,a)}const YD=["","wall","door","roof","window","lamp","logo"];class JD{constructor(r){this.node=r,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:r.id,geometry:[],properties:{height:KD(r)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let r=0;const a=new rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==r&&(u.transformedAabb=rr.applyTransformFast(u.aabb,this.node.globalMatrix),a.encapsulate(u.transformedAabb)),r++;this.aabb=a}return this.aabb}}class u1{constructor(r,a,u,h,g,y,b,A){this.id=u,this.layers=r,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=Om.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Om.HasMapboxMeshFeatures),g&&(this.modelTraits|=Om.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=A,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of a)this.nodesInfo.push(new JD(C)),XD(C,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(r,a){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&a.push({footprint:h.footprint,id:r})}}updateAppearances(r,a,u,h){}update(r){const a=Object.keys(r).length!==0;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!qo(r,this.states))for(const h of u)this.evaluate(h,r);this.states=structuredClone(r)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(r){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const h=u.node;this.uploaded?this.updatePbrBuffer(h):PA(h,r,!0)}for(const u of a)Hb(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(r){let a=!1;if(!r.meshes)return a;for(const u of r.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(r,a,u){const h=r.transform.projectionOptions,g=r.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||h.name!==this.projection.name||fv(u.paint.get("model-color").value,y)||fv(u.paint.get("model-color-mix-intensity").value,y)||fv(u.paint.get("model-roughness").value,y)||fv(u.paint.get("model-emissive-strength").value,y)||fv(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=h,this.brightness=g;const b=this.getNodesInfo();for(const A of b)A.state=null;return!0}return!1}evaluateTransform(r,a){if(r.transform.zoom===this.zoom)return;this.zoom=r.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=a.paint.get("model-translation").evaluate(y,{},h),g.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},h)}}evaluate(r,a){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const g=h.feature,y=a&&a[g.id];if(qo(y,h.state))continue;h.state=structuredClone(y);const b=h.node.meshes&&h.node.meshes[0].featureData,A=h.evaluatedColor[2],C=h.evaluatedRMEA[2],R=this.id.canonical;if(h.hasTranslucentParts=!1,b){for(let k=0;k<YD.length;k++){const L=YD[k];L.length&&(g.properties.part=L);const $=r.paint.get("model-color").evaluate(g,y,R).toPremultipliedRenderColor(null),U=r.paint.get("model-color-mix-intensity").evaluate(g,y,R);h.evaluatedColor[k]=[$.r,$.g,$.b,U],h.evaluatedRMEA[k][0]=r.paint.get("model-roughness").evaluate(g,y,R),h.evaluatedRMEA[k][2]=r.paint.get("model-emissive-strength").evaluate(g,y,R),h.evaluatedRMEA[k][3]=$.a,h.emissionHeightBasedParams[k]=r.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,R),!h.hasTranslucentParts&&$.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,UK(h,A!==h.evaluatedColor[2]||C!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=r.paint.get("model-emissive-strength").evaluate(g,y,R);h.evaluatedTranslation=r.paint.get("model-translation").evaluate(g,y,R),h.evaluatedScale=r.paint.get("model-scale").evaluate(g,y,R),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(r,a,u,h){const g=r.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=Bm.create(r,u,g);if(!y)return;this.modelTraits&Om.HasMapboxMeshFeatures&&this.updateDEM(r,y,u,h);for(const b of this.getNodesInfo()){const A=b.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const C=A.footprint.vertices;let R=y.getElevationAt(C[0].x,C[0].y,!0,!0);for(let k=1;k<C.length;k++)R=Math.min(R,y.getElevationAt(C[k].x,C[k].y,!0,!0));A.elevation=R}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=a}}updateDEM(r,a,u,h){let g=a._dem._modifiedForSources[h];if(g===void 0&&(a._dem._modifiedForSources[h]=[],g=a._dem._modifiedForSources[h]),g.includes(u.canonical))return;const y=a._dem.dim;g.push(u.canonical);let b=!1;for(const A of this.getNodesInfo()){const C=A.node;if(!C.footprint||!C.footprint.grid)continue;const R=C.footprint.grid,k=a.tileCoordToPixel(R.min.x,R.min.y),L=a.tileCoordToPixel(R.max.x,R.max.y),$=Math.min(Math.min(y-L.y,k.x),Math.min(k.y,y-L.x));if($<0)continue;const U=ne($,2,5);let Z=Math.max(0,k.x-U),re=Math.max(0,k.y-U),te=Math.min(L.x+U,y-1),le=Math.min(L.y+U,y-1);for(let _e=re;_e<=le;++_e)for(let Ee=Z;Ee<=te;++Ee)sf[_e*y+Ee]=255;let ue=0,pe=0;for(let _e=0;_e<R.cellsY;++_e)for(let Ee=0;Ee<R.cellsX;++Ee){if(!R.cells[_e*R.cellsX+Ee])continue;const Me=a.tileCoordToPixel(R.min.x+Ee/R.xScale,R.min.y+_e/R.yScale),De=a.tileCoordToPixel(R.min.x+(Ee+1)/R.xScale,R.min.y+(_e+1)/R.yScale);for(let nt=Me.y;nt<=Math.min(De.y+1,y-1);++nt)for(let Ve=Me.x;Ve<=Math.min(De.x+1,y-1);++Ve)sf[nt*y+Ve]===255&&(sf[nt*y+Ve]=0,ue+=a.getElevationAtPixel(Ve,nt),pe++)}const Se=ue/pe;Z=Math.max(1,k.x-U),re=Math.max(1,k.y-U),te=Math.min(L.x+U,y-2),le=Math.min(L.y+U,y-2),b=!0;for(let _e=re;_e<=le;++_e)for(let Ee=Z;Ee<=te;++Ee)sf[_e*y+Ee]===0&&(nE[_e*y+Ee]=a._dem.set(Ee,_e,Se));for(let _e=1;_e<U;++_e){Z=Math.max(1,k.x-_e),re=Math.max(1,k.y-_e),te=Math.min(L.x+_e,y-2),le=Math.min(L.y+_e,y-2);for(let Ee=re;Ee<=le;++Ee)for(let Me=Z;Me<=te;++Me){const De=Ee*y+Me;if(sf[De]===255){let nt=0,Ve=0,lt=-1,ft=-1;for(let pt=-1;pt<=1;++pt)for(let xt=-1;xt<=1;++xt){const wt=(Ee+pt)*y+Me+xt;if(sf[wt]>=_e)continue;const yt=nE[wt],_t=Math.abs(yt);_t>Ve&&(nt=yt,Ve=_t,lt=xt,ft=pt)}if(Ve>.1){const pt=1-(_e+.5*Math.abs(lt*ft))/U;let xt=a._dem.get(Me,Ee)+nt*pt;const wt=a._dem.get(Me+lt,Ee+ft),yt=a._dem.get(Me-lt,Ee-ft,!0);(xt-wt)*(xt-yt)>0&&(xt=(wt+yt)/2),nE[De]=a._dem.set(Me,Ee,xt),sf[De]=_e}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=So.now())}setFilter(r){this.filter=r?tm(r):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(r=>this.filter.filter(new si(this.id.overscaledZ,{worldview:this.worldview}),r.feature,this.id.canonical)):this.nodesInfo}destroy(){const r=this.getNodesInfo();for(const a of r)Hb(a.node),CA(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(r,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(r.toUnwrapped());for(const h of this.getNodesInfo()){const g=h.node.footprint;h.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(r,a){const u=[],h=[0,0,0],g=V([]);for(const y of this.getNodesInfo()){const b=y.node.meshes[0],A=b.transformedAabb;if(r<A.min[0]||a<A.min[1]||r>A.max[0]||a>A.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};K(g,y.node.globalMatrix),h[0]=r,h[1]=a,zr(h,h,g);const C=(h[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*rf|0,R=Math.min(63,(h[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*rf|0)*rf+Math.min(63,C),k=b.heightmap[R];if(!(k<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:k,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new mt(r,a),new mt(r,a),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function fv(l,r){return l instanceof vd&&!l.isLightConstant&&r}function VK(l,r,a,u,h,g,y,b){let A=(61440&r|(61440&r)>>4)>>8,C=(3840&r|(3840&r)>>4)>>4,R=240&r|(240&r)>>4;a[3]>0&&(A=xr(A,255*a[0],a[3]),C=xr(C,255*a[1],a[3]),R=xr(R,255*a[2],a[3]));const k=A<<8|C,L=R<<8|Math.floor(255*u[3]),$=function(_e){const Ee=ne(_e,0,2);return Math.min(Math.round(.5*Ee*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],U=ne(h[0],0,1),Z=ne(h[1],0,1),re=ne(h[2],0,1),te=ne(h[3],0,1);let le,ue,pe,Se;if(U!==Z&&y!==g&&Z!==U){const _e=y-g;ue=1/(_e*(Z-U)),pe=-(g+_e*U)/(_e*(Z-U));const Ee=ne(h[4],-1,1);Se=Math.pow(10,Ee),le=255*re<<8|255*te}else le=65535,ue=0,pe=1,Se=1;if(l.emplaceBack(k,L,$,le,ue,pe,Se),b){const _e=b.length;b.clear();for(let Ee=0;Ee<_e;Ee++)b.emplaceBack(k,L,$,le,ue,pe,Se)}}function UK(l,r,a){const u=l.node;let h=0;const g=a&Om.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===h||!y.featureData)continue;y.featureArray=new hm,y.featureArray.reserve(y.featureData.length);let b=r;for(const A of y.featureData){const C=g?65535&A:A>>16&65535,R=g?A>>16&65535:65535&A,k=(15&R)<8?15&R:0,L=l.evaluatedRMEA[k],$=l.evaluatedColor[k],U=l.emissionHeightBasedParams[k];let Z;if(b&&k===2&&u.lights&&(Z=new hm,Z.resize(10*u.lights.length)),VK(y.featureArray,C,$,L,U,y.aabb.min[2],y.aabb.max[2],Z),Z&&b){b=!1;const re=u.meshes[u.lightMeshIndex];re.featureArray=Z,re.featureArray._trim()}}y.featureArray._trim(),h++}}Yt(u1,"Tiled3dModelBucket",{omit:["layers"]}),Yt(JD,"Tiled3dModelFeature");const GK=["id","tile","layer","source","sourceLayer","state"];class af{constructor(r,a,u,h,g){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=u,this._y=h,this.properties=r?r.properties:{},this.id=g}clone(){const r=new af(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(r.state=Object.assign({},this.state)),this.layer&&(r.layer=Object.assign({},this.layer)),this.source&&(r.source=this.source),this.sourceLayer&&(r.sourceLayer=this.sourceLayer),r}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of GK)this[a]!==void 0&&(r[a]=this[a]);return r}}class lf extends fu{constructor(r,a,u,h){super(),this.id=r,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const r=[];for(const a in this._options.models){const u=this._options.models[a],h=this._modelsInfo.get(a);if(h){const g=h.model;g.position=u.position!=null?new c(u.position[0],u.position[1]):new c(0,0),g.orientation=u.orientation!=null?u.orientation:[0,0,0],h.modelSpec=u,lf.applyModelSpecification(g,u),g.computeBoundsAndApplyParent(),this.models.push(g)}else{const g=vj(this.map._requestManager.transformRequest(u.uri,mh.Model).url).then(y=>{if(!y)return;const b=MA(y),A=new Tj(a,u.uri,u.position,u.orientation,b);lf.applyModelSpecification(A,u),A.computeBoundsAndApplyParent(),this.models.push(A),this._modelsInfo.set(a,{modelSpec:u,model:A})}).catch(y=>{this.fire(new vh(new Error(`Could not load model ${a} from ${u.uri}: ${y.message}`)))});r.push(g)}}Promise.allSettled(r).then(()=>{this._loaded=!0,this.fire(new el("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new vh(new Error(`Could not load models: ${a.message}`)))})}static applyModelSpecification(r,a){a.nodeOverrides&&lf.convertNodeOverrides(r,a.nodeOverrides),a.materialOverrides&&lf.convertMaterialOverrides(r,a.materialOverrides),a.nodeOverrideNames&&(r.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(r.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(r.featureProperties=a.featureProperties)}static convertNodeOverrides(r,a){if(Array.isArray(a)&&a.every(u=>typeof u=="string")){r.nodeOverrideNames=[];for(const u of a)r.nodeOverrideNames.push(u)}else Object.entries(a).forEach(([u,h])=>{const g={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){const y=h.orientation;y&&(g.orientation=y)}r.nodeOverrides.set(u,g)})}static convertMaterialOverrides(r,a){if(Array.isArray(a)&&a.every(u=>typeof u=="string")){r.materialOverrideNames=[];for(const u of a)r.materialOverrideNames.push(u)}else Object.entries(a).forEach(([u,h])=>{const g={color:new kn(1,1,1),colorMix:0,emissionStrength:0,opacity:1},y=h["model-color"];y!==void 0&&(g.color.r=y[0],g.color.g=y[1],g.color.b=y[2]);const b=h["model-color-mix-intensity"];b!==void 0&&(g.colorMix=b);const A=h["model-emissive-strength"];A!==void 0&&(g.emissionStrength=A);const C=h["model-opacity"];C!==void 0&&(g.opacity=C),r.materialOverrides.set(u,g)})}onAdd(r){this.map=r,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(r,a){}serialize(){return this._options}setProperty(r,a){return!1}reload(){const r=La(this.id,this.scope);this.map.style.clearSource(r),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(r){this.models=[];const a=new Map;for(const u in r){const h=r[u];if(this._modelsInfo.has(u)){const g=this._modelsInfo.get(u);g&&g.modelSpec.uri===h.uri&&a.set(u,g)}}this._modelsInfo=a,this._options.models=r,this._loaded=!1,this.load()}}function iE(l,r,a,u){const h=1<<l.z;r.lat=W((u/Mt+l.y)/h),r.lng=F((a/Mt+l.x)/h)}function HK(l,r,a,u){const h=l.getNodesInfo()[r];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let g=Number.MAX_VALUE;const y=h.node,b=a.tile,A=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),C=h.evaluatedScale;let R=0;u.elevation&&y.elevation&&(R=y.elevation*u.elevation.exaggeration()),X(A,A,[(y.anchor?y.anchor[0]:0)*(C[0]-1),(y.anchor?y.anchor[1]:0)*(C[1]-1),R]),ie(A,A,C);const k=a.queryGeometry,L=k.isPointQuery()?k.screenBounds:k.screenGeometry,$=function(Z){const re=Q([],A,Z.globalMatrix);Q(re,u.expandedFarZProjMatrix,re);for(let te=0;te<Z.meshes.length;++te){const le=Z.meshes[te];if(te===Z.lightMeshIndex)continue;const ue=EA(L,u,re,le.aabb);ue!=null&&(g=Math.min(ue,g))}if(Z.children)for(const te of Z.children)$(te)};if($(y),g===Number.MAX_VALUE)return;const U=new c(0,0);return iE(b.tileID.canonical,U,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:g,position:U,feature:h.feature}}const WK={circle:class extends bs{constructor(l,r,a,u){super(l,{layout:ks||(ks=new Pi({"circle-sort-key":new kt(He.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ct(He.layout_circle["circle-elevation-reference"]),visibility:new Ct(He.layout_circle.visibility)})),paint:Ci||(Ci=new Pi({"circle-radius":new kt(He.paint_circle["circle-radius"]),"circle-color":new kt(He.paint_circle["circle-color"]),"circle-blur":new kt(He.paint_circle["circle-blur"]),"circle-opacity":new kt(He.paint_circle["circle-opacity"]),"circle-translate":new Ct(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(He.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ct(He.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}createBucket(l){return new jn(l)}queryRadius(l){const r=l;return Jo("circle-radius",this,r)+Jo("circle-stroke-width",this,r)+No(this.paint.get("circle-translate"))}queryIntersectsFeature(l,r,a,u,h,g,y,b){const A=ya(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return ok(l,u,g,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,r,a){const u=ik(this);return{config:new Dc(this,{zoom:r,lut:a}),defines:u,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends bs{createBucket(l){return new ak(l)}constructor(l,r,a,u){super(l,{layout:lk||(lk=new Pi({visibility:new Ct(He.layout_heatmap.visibility)})),paint:ck||(ck=new Pi({"heatmap-radius":new kt(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Su(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(He.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Jo("heatmap-radius",this,l)}queryIntersectsFeature(l,r,a,u,h,g,y,b){const A=this.paint.get("heatmap-radius").evaluate(r,a);return ok(l,u,g,y,b,!0,!0,new mt(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,r,a){return l==="heatmap"?{config:new Dc(this,{zoom:r,lut:a}),overrideFog:!1}:{}}},hillshade:class extends bs{constructor(l,r,a,u){super(l,{layout:uk||(uk=new Pi({visibility:new Ct(He.layout_hillshade.visibility)})),paint:dk||(dk=new Pi({"hillshade-illumination-direction":new Ct(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(He.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ct(He.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}},fill:class extends bs{constructor(l,r,a,u){super(l,{layout:Ek||(Ek=new Pi({"fill-sort-key":new kt(He.layout_fill["fill-sort-key"]),visibility:new Ct(He.layout_fill.visibility),"fill-elevation-reference":new Ct(He.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(He.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Pk||(Pk=new Pi({"fill-antialias":new Ct(He.paint_fill["fill-antialias"]),"fill-opacity":new kt(He.paint_fill["fill-opacity"]),"fill-color":new kt(He.paint_fill["fill-color"]),"fill-outline-color":new kt(He.paint_fill["fill-outline-color"]),"fill-translate":new Ct(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(He.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ct(He.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ct(He.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(He.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(He.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(He.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}getProgramIds(){const l=this.paint.get("fill-pattern"),r=l&&l.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,r,a){return{config:new Dc(this,{zoom:r,lut:a}),overrideFog:!1}}recalculate(l,r){super.recalculate(l,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new cA(l)}queryRadius(){return No(this.paint.get("fill-translate"))}queryIntersectsFeature(l,r,a,u,h,g){return!l.queryGeometry.isAboveHorizon&&An(Qs(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const r=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?r&&!l:r}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends bs{constructor(l,r,a,u){super(l,{layout:Qk||(Qk=new Pi({visibility:new Ct(He["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ct(He["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ej||(ej=new Pi({"fill-extrusion-opacity":new Ct(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ct(He["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new kt(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ct(He["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ct(He["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ct(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ct(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ct(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ct(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ct(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ct(He["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ct(He["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ct(He["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ct(He["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ct(He["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ct(He["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ct(He["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(He["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(He["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ct(He["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Db(l)}queryRadius(){return No(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,r,a,u,h,g,y,b,A){const C=ya(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(r,a),k=this.paint.get("fill-extrusion-base").evaluate(r,a),L=[0,0],$=b&&g.elevation,U=g.elevation?g.elevation.exaggeration():1,Z=l.tile.getBucket(this);if($&&Z instanceof Db){const pe=Z.centroidVertexArray,Se=A+1;Se<pe.length&&(L[0]=pe.geta_centroid_pos0(Se),L[1]=pe.geta_centroid_pos1(Se))}if(L[0]===0&&L[1]===1)return!1;g.projection.name==="globe"&&(u=Jk([u],[new mt(0,0),new mt(Mt,Mt)],l.tileID.canonical).map(pe=>pe.polygon).flat());const re=$?b:null,[te,le]=aj(g,u,k,R,C,y,re,L,U,g.center.lat,l.tileID.canonical),ue=l.queryGeometry;return sj(te,le,ue.isPointQuery()?ue.screenBounds:ue.screenGeometry)}},building:class extends bs{constructor(l,r,a,u){super(l,{layout:Oj||(Oj=new Pi({visibility:new Ct(He.layout_building.visibility),"building-facade":new kt(He.layout_building["building-facade"]),"building-facade-floors":new kt(He.layout_building["building-facade-floors"]),"building-facade-unit-width":new kt(He.layout_building["building-facade-unit-width"]),"building-facade-window":new kt(He.layout_building["building-facade-window"]),"building-roof-shape":new kt(He.layout_building["building-roof-shape"]),"building-height":new kt(He.layout_building["building-height"]),"building-base":new kt(He.layout_building["building-base"]),"building-flood-light-wall-radius":new kt(He.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new kt(He.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new kt(He.layout_building["building-flip-roof-orientation"])})),paint:Rj||(Rj=new Pi({"building-opacity":new Ct(He.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ct(He.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ct(He.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ct(He.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ct(He.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ct(He.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ct(He.paint_building["building-cast-shadows"]),"building-color":new kt(He.paint_building["building-color"]),"building-emissive-strength":new kt(He.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ct(He.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ct(He.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Ct(He.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Ct(He.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Ct(He.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Mj(l)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}queryRadius(l){return 0}queryIntersectsFeature(l,r,a,u,h,g,y,b,A){let C=this.layout.get("building-height").evaluate(r,a);const R=this.layout.get("building-base").evaluate(r,a),k=l.tile.getBucket(this).getFootprint(r);if(k){if(k.hiddenFlags!==0)return!1;C=k.height}const[L,$]=aj(g,u,R,C,new mt(0,0),y,null,[0,0],1,g.center.lat,l.tileID.canonical),U=l.queryGeometry;return sj(L,$,U.isPointQuery()?U.screenBounds:U.screenGeometry)}},line:class extends bs{constructor(l,r,a,u){const h=Vj();super(l,h,r,a,u),h.layout&&(this.layout=new wu(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Oh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(l,r){super.recalculate(l,r),this.paint._values["line-floorwidth"]=(()=>{if(J_)return J_;const a=Vj();return J_=new BZ(a.paint.properties["line-width"].specification),J_.useIntegerZoom=!0,J_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new kA(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,r,a){const u=Bj(this);return{config:new Dc(this,{zoom:r,lut:a}),defines:u,overrideFog:!1}}queryRadius(l){const r=l,a=Uj(Jo("line-width",this,r),Jo("line-gap-width",this,r)),u=Jo("line-offset",this,r);return a/2+Math.abs(u)+No(this.paint.get("line-translate"))}queryIntersectsFeature(l,r,a,u,h,g){if(l.queryGeometry.isAboveHorizon)return!1;const y=Qs(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),b=l.pixelToTileUnitsFactor/2*Uj(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),A=this.paint.get("line-offset").evaluate(r,a);return A&&(u=function(C,R){const k=[],L=new mt(0,0);for(let $=0;$<C.length;$++){const U=C[$],Z=[];for(let re=0;re<U.length;re++){const te=U[re],le=U[re+1],ue=re===0?L:te.sub(U[re-1])._unit()._perp(),pe=re===U.length-1?L:le.sub(te)._unit()._perp(),Se=ue._add(pe)._unit();Se._mult(1/(Se.x*pe.x+Se.y*pe.y)),Z.push(Se._mult(R)._add(te))}k.push(Z)}return k}(u,A*l.pixelToTileUnitsFactor)),function(C,R,k){for(let L=0;L<R.length;L++){const $=R[L];if(C.length>=3){for(let U=0;U<$.length;U++)if(Kn(C,$[U]))return!0}if(Ti(C,$,k))return!0}return!1}(y,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:s1,background:class extends bs{constructor(l,r,a,u){super(l,{layout:OD||(OD=new Pi({visibility:new Ct(He.layout_background.visibility)})),paint:RD||(RD=new Pi({"background-pitch-alignment":new Ct(He.paint_background["background-pitch-alignment"]),"background-color":new Ct(He.paint_background["background-color"]),"background-pattern":new Ct(He.paint_background["background-pattern"]),"background-opacity":new Ct(He.paint_background["background-opacity"]),"background-emissive-strength":new Ct(He.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,r,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:ND,"raster-particle":UD,sky:class extends bs{constructor(l,r,a,u){super(l,{layout:BD||(BD=new Pi({visibility:new Ct(He.layout_sky.visibility)})),paint:$D||($D=new Pi({"sky-type":new Ct(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new Su(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(He.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=D_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(l,r){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=l.style.light,y=g.properties.get("position");return h&&g.properties.get("anchor")==="viewport"&&Ut("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?eE(y.azimuthal,90-y.polar,r):eE(u[0],90-u[1],r)}const a=this.paint.get("sky-gradient-center");return eE(a[0],90-a[1],r)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends bs{constructor(l,r,a,u){super(l,{paint:VD||(VD=new Pi({}))},r,null)}},model:class extends bs{constructor(l,r,a,u){super(l,{layout:qD||(qD=new Pi({visibility:new Ct(He.layout_model.visibility),"model-id":new kt(He.layout_model["model-id"])})),paint:ZD||(ZD=new Pi({"model-opacity":new kt(He.paint_model["model-opacity"]),"model-rotation":new kt(He.paint_model["model-rotation"]),"model-scale":new kt(He.paint_model["model-scale"]),"model-translation":new kt(He.paint_model["model-translation"]),"model-color":new kt(He.paint_model["model-color"]),"model-color-mix-intensity":new kt(He.paint_model["model-color-mix-intensity"]),"model-type":new Ct(He.paint_model["model-type"]),"model-cast-shadows":new Ct(He.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ct(He.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ct(He.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(He.paint_model["model-emissive-strength"]),"model-roughness":new kt(He.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(He.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ct(He.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ct(He.paint_model["model-front-cutoff"]),"model-elevation-reference":new Ct(He.paint_model["model-elevation-reference"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this.layer=l,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new rE(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof u1?Mt-1:0}queryRenderedFeatures(l,r,a){const u=r.getSource();if(!(u&&u instanceof lf))return{};const h=u,g={};g[this.id]=[];const y=g[this.id];let b=0;for(const A of h.models){const C=r.getFeatureState(this.sourceLayer,A.id),R={type:"Unknown",id:A.id,properties:A.featureProperties},k=this.paint.get("model-rotation").evaluate(R,C),L=this.paint.get("model-scale").evaluate(R,C),$=this.paint.get("model-translation").evaluate(R,C),U=this.paint.get("model-elevation-reference");let Z=[];Gb(Z,A,a,A.position,k,L,$,U==="ground",U==="ground",!1),a.projection.name==="globe"&&(Z=Ub(Z,a));const re=Q([],a.projMatrix,Z),te=EA(l.isPointQuery()?l.screenBounds:l.screenGeometry,a,re,A.aabb);if(te!=null){const le=new af(void 0,0,0,0,A.id);le.layer=this.layer,le.properties=structuredClone(A.featureProperties),le.properties.layer=this.id,le.properties.uri=A.uri,le.properties.orientation=A.orientation,le.sourceLayer=this.sourceLayer,le.geometry={type:"Point",coordinates:[A.position.lng,A.position.lat]},le.state=C,le.source=this.source,y.push({featureIndex:b,feature:le,intersectionZ:te})}++b}return g}queryIntersectsFeature(l,r,a,u,h,g){if(!this.modelManager)return!1;const y=this.modelManager,b=l.tile.getBucket(this);if(!(b&&b instanceof rE))return!1;for(const A in b.instancesPerModel){const C=b.instancesPerModel[A],R=r.id!==void 0?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(R)){const k=C.features[C.idToFeaturesIndex[R]],L=y.getModel(A,this.scope);if(!L)return!1;let $=[];const U=new c(0,0),Z=b.canonical;let re=Number.MAX_VALUE;for(let te=0;te<k.instancedDataCount;++te){const le=16*(k.instancedDataOffset+te),ue=C.instancedDataArray.float32,pe=[ue[le+4],ue[le+5],ue[le+6]];iE(Z,U,Math.floor(ue[le]),Math.floor(ue[le+1])),Gb($,L,g,U,k.rotation,k.scale,pe,!1,!1,!1),g.projection.name==="globe"&&($=Ub($,g));const Se=Q([],g.projMatrix,$),_e=l.queryGeometry,Ee=EA(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,g,Se,L.aabb);Ee!=null&&(re=Math.min(Ee,re))}return re!==Number.MAX_VALUE&&re}}return!1}_handleOverridablePaintPropertyUpdate(l,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const r=this._transitionablePaint._values[l];return r!=null&&r.value!=null&&r.value.expression!=null&&r.value.expression instanceof vu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends bs{constructor(l,r,a,u){super(l,{layout:Ck||(Ck=new Pi({"clip-layer-types":new Ct(He.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ct(He.layout_clip["clip-layer-scope"])})),paint:Ik||(Ik=new Pi({}))},r,a,u)}recalculate(l,r){super.recalculate(l,r)}createBucket(l){return new Mk(l)}is3D(l){return!0}}},oE=new kn(0,0,0),sE={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},aE={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},d1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},qK={PAINT_ORDER_FILL_AND_STROKE:1},pv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},QD={MASK_TYPE_LUMINANCE:1};function ZK(l,r,a){l===1&&r.icons.push(function(u,h){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:b}=y;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=g.usvg_tree.width),b.height==null&&(b.height=b.width)}if(y.text_placeholder){const{text_placeholder:b}=y;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return y.stretch_x&&y.stretch_x.length&&eL(y,"x"),y.stretch_y&&y.stretch_y.length&&eL(y,"y"),g}(u.readFields(KK,{name:void 0},h))}(a,a.readVarint()+a.pos))}function eL(l,r){const a=[],u=l[`stretch_${r}`];let h=null;for(let g=0;g<u.length;g++)h===null?h=a.length===0?u[0]:a[a.length-1][1]+u[g]:(a.push([h,h+u[g]]),h=null);l[`stretch_${r}_areas`]=a}function KK(l,r,a){l===1?r.name=a.readString():l===2?r.metadata=function(u,h){return u.readFields(XK,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(a,a.readVarint()+a.pos):l===3&&(r.usvg_tree=function(u,h){return u.readFields(QK,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(a,a.readVarint()+a.pos),r.data="usvg_tree")}function XK(l,r,a){l===1?r.stretch_x=a.readPackedVarint():l===2?r.stretch_y=a.readPackedVarint():l===3?r.content_area=tL(a,a.readVarint()+a.pos):l===4?r.variables.push(function(u,h){return u.readFields(JK,{name:void 0},h)}(a,a.readVarint()+a.pos)):l===5&&(r.text_placeholder=tL(a,a.readVarint()+a.pos))}function tL(l,r){return l.readFields(YK,{},r)}function YK(l,r,a){l===1?r.left=a.readVarint():l===2?r.width=a.readVarint():l===3?r.top=a.readVarint():l===4&&(r.height=a.readVarint())}function JK(l,r,a){l===1?r.name=a.readString():l===2&&(r.rgb_color=p1(a.readVarint()),r.value="rgb_color")}function QK(l,r,a){l===1?r.width=r.height=a.readVarint():l===2?r.height=a.readVarint():l===3?r.children.push(h1(a,a.readVarint()+a.pos)):l===4?r.linear_gradients.push(function(u,h){return u.readFields(sX,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(a,a.readVarint()+a.pos)):l===5?r.radial_gradients.push(function(u,h){return u.readFields(lX,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(a,a.readVarint()+a.pos)):l===7?r.clip_paths.push(function(u,h){return u.readFields(cX,{children:[]},h)}(a,a.readVarint()+a.pos)):l===8&&r.masks.push(function(u,h){const g=u.readFields(uX,{left:0,width:20,mask_type:QD.MASK_TYPE_LUMINANCE,children:[]},h);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(a,a.readVarint()+a.pos))}function h1(l,r){return l.readFields(eX,{},r)}function eX(l,r,a){l===1?(r.group=function(u,h){return u.readFields(tX,{opacity:255,children:[]},h)}(a,a.readVarint()+a.pos),r.node="group"):l===2&&(r.path=function(u,h){return u.readFields(nX,{paint_order:1,commands:[],step:1,diffs:[],rule:sE.PATH_RULE_NON_ZERO},h)}(a,a.readVarint()+a.pos),r.node="path")}function tX(l,r,a){l===1?r.transform=f1(a,a.readVarint()+a.pos):l===2?r.opacity=a.readVarint():l===5?r.clip_path_idx=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(h1(a,a.readVarint()+a.pos))}function f1(l,r){return l.readFields(rX,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},r)}function rX(l,r,a){l===1?r.sx=a.readFloat():l===2?r.ky=a.readFloat():l===3?r.kx=a.readFloat():l===4?r.sy=a.readFloat():l===5?r.tx=a.readFloat():l===6&&(r.ty=a.readFloat())}function nX(l,r,a){l===1?r.fill=function(u,h){return u.readFields(iX,{rgb_color:oE,paint:"rgb_color",opacity:255},h)}(a,a.readVarint()+a.pos):l===2?r.stroke=function(u,h){return u.readFields(oX,{rgb_color:oE,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(a,a.readVarint()+a.pos):l===3?r.paint_order=a.readVarint():l===5?a.readPackedVarint(r.commands):l===6?r.step=a.readFloat():l===7?a.readPackedSVarint(r.diffs):l===8&&(r.rule=a.readVarint())}function iX(l,r,a){l===1?(r.rgb_color=p1(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5&&(r.opacity=a.readVarint())}function p1(l){return new kn((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function oX(l,r,a){l===1?(r.rgb_color=p1(a.readVarint()),r.paint="rgb_color"):l===2?(r.linear_gradient_idx=a.readVarint(),r.paint="linear_gradient_idx"):l===3?(r.radial_gradient_idx=a.readVarint(),r.paint="radial_gradient_idx"):l===5?a.readPackedFloat(r.dasharray):l===6?r.dashoffset=a.readFloat():l===7?r.miterlimit=a.readFloat():l===8?r.opacity=a.readVarint():l===9?r.width=a.readFloat():l===10?r.linecap=a.readVarint():l===11&&(r.linejoin=a.readVarint())}function sX(l,r,a){l===1?r.transform=f1(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(rL(a,a.readVarint()+a.pos)):l===4?r.x1=a.readFloat():l===5?r.y1=a.readFloat():l===6?r.x2=a.readFloat():l===7&&(r.y2=a.readFloat())}function rL(l,r){return l.readFields(aX,{offset:0,opacity:255,rgb_color:oE},r)}function aX(l,r,a){l===1?r.offset=a.readFloat():l===2?r.opacity=a.readVarint():l===3&&(r.rgb_color=p1(a.readVarint()))}function lX(l,r,a){l===1?r.transform=f1(a,a.readVarint()+a.pos):l===2?r.spread_method=a.readVarint():l===3?r.stops.push(rL(a,a.readVarint()+a.pos)):l===4?r.cx=a.readFloat():l===5?r.cy=a.readFloat():l===6?r.r=a.readFloat():l===7?r.fx=a.readFloat():l===8?r.fy=a.readFloat():l===9&&(r.fr=a.readFloat())}function cX(l,r,a){l===1?r.transform=f1(a,a.readVarint()+a.pos):l===2?r.clip_path_idx=a.readVarint():l===3&&r.children.push(h1(a,a.readVarint()+a.pos))}function uX(l,r,a){l===1?r.left=r.top=a.readFloat():l===2?r.width=r.height=a.readFloat():l===3?r.top=a.readFloat():l===4?r.height=a.readFloat():l===5?r.mask_type=a.readVarint():l===6?r.mask_idx=a.readVarint():l===7&&r.children.push(h1(a,a.readVarint()+a.pos))}class dX{static calculate(r={},a=[]){const u=new Map,h=new Map;if(Object.keys(r).length===0)return u;a.forEach(g=>{h.set(g.name,g.rgb_color||new kn(0,0,0))});for(const[g,y]of Object.entries(r))h.has(g)?u.set(h.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function $m(l,r=255,a){const u=r/255,h=l.toString(),g=a.has(h)?a.get(h).clone():l.clone();return g.a*=u,g.toString()}function mv(l,r){if(!Ya()){const a=document.createElement("canvas");return a.width=l,a.height=r,a}return new OffscreenCanvas(l,r)}let lE,gv=null;function cE(l,r,a,u,h){for(const g of u.children)nL(l,r,a,g,h)}function nL(l,r,a,u,h){u.group?(l.save(),function(g,y,b,A,C){const R=A.mask_idx!=null?b.masks[A.mask_idx]:null,k=A.clip_path_idx!=null?b.clip_paths[A.clip_path_idx]:null;if(A.transform&&(y=Vm(A.transform).preMultiplySelf(y)),!function(U,Z,re){return U.opacity!==255||Z||re}(A,k!=null,R!=null))return void cE(g,y,b,A,C);const L=mv(g.canvas.width,g.canvas.height),$=L.getContext("2d");cE($,y,b,A,C),k&&uL($,y,b,k),R&&dL($,y,b,R,C),g.globalAlpha=A.opacity/255,g.drawImage(L,0,0)}(l,r,a,u.group,h),l.restore()):u.path&&(l.save(),function(g,y,b,A,C){g.setTransform(y),A.paint_order===qK.PAINT_ORDER_FILL_AND_STROKE?(iL(g,b,A,C),sL(g,b,A,C)):(sL(g,b,A,C),iL(g,b,A,C))}(l,r,a,u.path,h),l.restore())}function iL(l,r,a,u){const h=a.fill;if(!h)return;const g=h.opacity/255;switch(l.save(),l.beginPath(),hL(a,l),h.paint){case"rgb_color":l.fillStyle=$m(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const y=r.linear_gradients[h.linear_gradient_idx];y.transform&&l.setTransform(Vm(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=aL(l,y,g,u);break}case"radial_gradient_idx":{const y=r.radial_gradients[h.radial_gradient_idx];y.transform&&l.setTransform(Vm(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=lL(l,y,g,u)}}l.fill(oL(a)),l.restore()}function oL(l){return l.rule===sE.PATH_RULE_NON_ZERO?"nonzero":l.rule===sE.PATH_RULE_EVEN_ODD?"evenodd":void 0}function sL(l,r,a,u){const h=a.stroke;if(!h)return;const g=fL(a);l.lineWidth=h.width,l.miterLimit=h.miterlimit,l.setLineDash(h.dasharray),l.lineDashOffset=h.dashoffset;const y=h.opacity/255;switch(h.paint){case"rgb_color":l.strokeStyle=$m(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":l.strokeStyle=aL(l,r.linear_gradients[h.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":l.strokeStyle=lL(l,r.radial_gradients[h.radial_gradient_idx],y,u,!0)}switch(h.linejoin){case d1.LINE_JOIN_MITER_CLIP:case d1.LINE_JOIN_MITER:l.lineJoin="miter";break;case d1.LINE_JOIN_ROUND:l.lineJoin="round";break;case d1.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(h.linecap){case aE.LINE_CAP_BUTT:l.lineCap="butt";break;case aE.LINE_CAP_ROUND:l.lineCap="round";break;case aE.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(g)}function aL(l,r,a,u,h=!1){if(r.stops.length===1){const L=r.stops[0];return $m(L.rgb_color,L.opacity*a,u)}const{x1:g,y1:y,x2:b,y2:A}=r;let C=new DOMPoint(g,y),R=new DOMPoint(b,A);if(h){const L=Vm(r.transform);C=L.transformPoint(C),R=L.transformPoint(R)}const k=l.createLinearGradient(C.x,C.y,R.x,R.y);for(const L of r.stops)k.addColorStop(L.offset,$m(L.rgb_color,L.opacity*a,u));return k}function lL(l,r,a,u,h=!1){if(r.stops.length===1){const te=r.stops[0];return $m(te.rgb_color,te.opacity*a,u)}const g=Vm(r.transform),{fx:y,fy:b,fr:A,cx:C,cy:R,r:k}=r;let L=new DOMPoint(y,b),$=new DOMPoint(C,R),U=A,Z=k;if(h){L=g.transformPoint(L),$=g.transformPoint($);const te=(g.a+g.d)/2;U=A*te,Z=r.r*te}const re=l.createRadialGradient(L.x,L.y,U,$.x,$.y,Z);for(const te of r.stops)re.addColorStop(te.offset,$m(te.rgb_color,te.opacity*a,u));return re}function cL(l,r,a,u){const h=u.transform?Vm(u.transform).preMultiplySelf(r):r,g=mv(l.canvas.width,l.canvas.height),y=g.getContext("2d");for(const A of u.children)if(A.group)cL(y,h,a,A.group);else if(A.path){const C=A.path,R=new Path2D;R.addPath(fL(C),h),y.fill(R,oL(C))}const b=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;b&&uL(y,h,a,b),l.globalCompositeOperation="source-over",l.drawImage(g,0,0)}function uL(l,r,a,u){const h=mv(l.canvas.width,l.canvas.height);cL(h.getContext("2d"),r,a,u),l.globalCompositeOperation="destination-in",l.drawImage(h,0,0)}function dL(l,r,a,u,h){if(u.children.length===0)return;const g=u.mask_idx!=null?a.masks[u.mask_idx]:null;g&&dL(l,r,a,g,h);const y=l.canvas.width,b=l.canvas.height,A=mv(y,b),C=A.getContext("2d"),R=u.width,k=u.height,L=u.left,$=u.top,U=new Path2D,Z=new Path2D;Z.rect(L,$,R,k),U.addPath(Z,r),C.clip(U);for(const le of u.children)nL(C,r,a,le,h);const re=C.getImageData(0,0,y,b),te=re.data;if(u.mask_type===QD.MASK_TYPE_LUMINANCE)for(let le=0;le<te.length;le+=4)te[le+3]=te[le+3]/255*(.2126*te[le]+.7152*te[le+1]+.0722*te[le+2]);C.putImageData(re,0,0),l.globalCompositeOperation="destination-in",l.drawImage(A,0,0)}function Vm(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function hL(l,r){const a=l.step;let u=l.diffs[0]*a,h=l.diffs[1]*a;r.moveTo(u,h);for(let g=0,y=2;g<l.commands.length;g++)switch(l.commands[g]){case pv.PATH_COMMAND_MOVE:u+=l.diffs[y++]*a,h+=l.diffs[y++]*a,r.moveTo(u,h);break;case pv.PATH_COMMAND_LINE:u+=l.diffs[y++]*a,h+=l.diffs[y++]*a,r.lineTo(u,h);break;case pv.PATH_COMMAND_QUAD:{const b=u+l.diffs[y++]*a,A=h+l.diffs[y++]*a;u=b+l.diffs[y++]*a,h=A+l.diffs[y++]*a,r.quadraticCurveTo(b,A,u,h);break}case pv.PATH_COMMAND_CUBIC:{const b=u+l.diffs[y++]*a,A=h+l.diffs[y++]*a,C=b+l.diffs[y++]*a,R=A+l.diffs[y++]*a;u=C+l.diffs[y++]*a,h=R+l.diffs[y++]*a,r.bezierCurveTo(b,A,C,R,u,h);break}case pv.PATH_COMMAND_CLOSE:r.closePath()}return r}function fL(l){return hL(l,new Path2D)}class m1{constructor(r){this.capacity=r,this.cache=new Map}get(r){if(!this.cache.has(r))return;const a=this.cache.get(r);return this.cache.delete(r),this.cache.set(r,a),a}put(r,a){this.cache.has(r)?this.cache.delete(r):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(r,a)}delete(r){this.cache.delete(r)}}Yt(m1,"LRUCache");class uE{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(r){return new Qo(r,r.data)}getFromCache(r,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new m1(150)),this.cacheMap.get(u).get(La(r.toString(),a))}setInCache(r,a,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new m1(150));const g=this.cacheDependenciesMap.get(h),y=La(r.id.toString(),u);g.get(y)||g.set(y,new Set);const b=this.cacheMap.get(h),A=r.toString();g.get(y).add(A),b.put(La(r.toString(),u),a)}removeImagesFromCacheByIds(r,a,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of r){const b=La(y.toString(),a);if(g.has(b)){for(const A of g.get(b))h.delete(A);g.delete(b)}}}rasterize(r,a,u,h){const g=this.getFromCache(r,u,h);if(g)return g.clone();const y=function(A,C){const R=dX.calculate(C.params,A.metadata?A.metadata.variables:[]),k=A.usvg_tree,L=k.width,$=k.height,U=Math.max(1,Math.round(L*C.sx)),Z=Math.max(1,Math.round($*C.sy)),re=new DOMMatrix([U/L,0,0,Z/$,0,0]);return gv===null&&(gv=mv(10,10),lE=gv.getContext("2d",{willReadFrequently:!0})),gv.width=U,gv.height=Z,cE(lE,re,k,k,R),lE.getImageData(0,0,U,Z)}(a.icon,r),b=uE._getImage(y);return this.setInCache(r,b,u,h),b.clone()}}class pL{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const u=this.toIdx(r,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function mL(l,r,a,u){let h=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(a[y]<l[y]||a[y]>r[y])return null}else{const b=1/u[y];let A=(l[y]-a[y])*b,C=(r[y]-a[y])*b;if(A>C){const R=A;A=C,C=R}if(A>h&&(h=A),C<g&&(g=C),h>g)return null}return h}function gL(l,r,a,u,h,g,y,b,A,C,R){const k=u-l,L=h-r,$=g-a,U=y-l,Z=b-r,re=A-a,te=R[1]*re-R[2]*Z,le=R[2]*U-R[0]*re,ue=R[0]*Z-R[1]*U,pe=k*te+L*le+$*ue;if(Math.abs(pe)<1e-15)return null;const Se=1/pe,_e=C[0]-l,Ee=C[1]-r,Me=C[2]-a,De=(_e*te+Ee*le+Me*ue)*Se;if(De<0||De>1)return null;const nt=Ee*$-Me*L,Ve=Me*k-_e*$,lt=_e*L-Ee*k,ft=(R[0]*nt+R[1]*Ve+R[2]*lt)*Se;return ft<0||De+ft>1?null:(U*nt+Z*Ve+re*lt)*Se}function yL(l,r,a){return(l-r)/(a-r)}function _L(l,r,a,u,h,g,y,b,A){const C=1<<a,R=g-u,k=y-h,L=(l+1)/C*R+u,$=(r+0)/C*k+h,U=(r+1)/C*k+h;b[0]=(l+0)/C*R+u,b[1]=$,A[0]=L,A[1]=U}class vL{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let A=Math.ceil(Math.pow(2,y));const C=1/A,R=($,U,Z,re,te)=>{const le=re?1:0,ue=($+1)*Z-le,pe=U*Z,Se=(U+1)*Z-le;te[0]=$*Z,te[1]=pe,te[2]=ue,te[3]=Se};let k=new pL(A);const L=[];for(let $=0;$<A*A;$++){R($%A,Math.floor($/A),C,!1,L);const U=Ld(L[0],L[1],g),Z=Ld(L[2],L[1],g),re=Ld(L[2],L[3],g),te=Ld(L[0],L[3],g);k.minimums.push(Math.min(U,Z,re,te)),k.maximums.push(Math.max(U,Z,re,te)),k.leaves.push(1)}for(b.push(k),A/=2;A>=1;A/=2){const $=b[b.length-1];k=new pL(A);for(let U=0;U<A*A;U++){R(U%A,Math.floor(U/A),2,!0,L);const Z=$.getElevation(L[0],L[1]),re=$.getElevation(L[2],L[1]),te=$.getElevation(L[2],L[3]),le=$.getElevation(L[0],L[3]),ue=$.isLeaf(L[0],L[1]),pe=$.isLeaf(L[2],L[1]),Se=$.isLeaf(L[2],L[3]),_e=$.isLeaf(L[0],L[3]),Ee=Math.min(Z.min,re.min,te.min,le.min),Me=Math.max(Z.max,re.max,te.max,le.max),De=ue&&pe&&Se&&_e;k.maximums.push(Me),k.minimums.push(Ee),k.leaves.push(Me-Ee<=5&&De?1:0)}b.push(k)}return b}(this.dem),u=a.length-1,h=a[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(r,a,u,h,g,y,b=1){return mL([r,a,-100],[u,h,this.maximums[0]*b],g,y)}raycast(r,a,u,h,g,y,b=1){if(!this.nodeCount)return null;const A=this.raycastRoot(r,a,u,h,g,y,b);if(A==null)return null;const C=[],R=[],k=[],L=[],$=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;$.length>0;){const{idx:U,t:Z,nodex:re,nodey:te,depth:le}=$.pop();if(this.leaves[U]){_L(re,te,le,r,a,u,h,k,L);const pe=1<<le,Se=(re+0)/pe,_e=(re+1)/pe,Ee=(te+0)/pe,Me=(te+1)/pe,De=Ld(Se,Ee,this.dem)*b,nt=Ld(_e,Ee,this.dem)*b,Ve=Ld(_e,Me,this.dem)*b,lt=Ld(Se,Me,this.dem)*b,ft=gL(k[0],k[1],De,L[0],k[1],nt,L[0],L[1],Ve,g,y),pt=gL(L[0],L[1],Ve,k[0],L[1],lt,k[0],k[1],De,g,y),xt=Math.min(ft!==null?ft:Number.MAX_VALUE,pt!==null?pt:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const wt=br([],g,y,Z);if(xL(De,nt,lt,Ve,yL(wt[0],k[0],L[0]),yL(wt[1],k[1],L[1]))>=wt[2])return Z}continue}let ue=0;for(let pe=0;pe<this._siblingOffset.length;pe++){_L((re<<1)+this._siblingOffset[pe][0],(te<<1)+this._siblingOffset[pe][1],le+1,r,a,u,h,k,L),k[2]=-100,L[2]=this.maximums[this.childOffsets[U]+pe]*b;const Se=mL(k,L,g,y);if(Se!=null){const _e=Se;C[pe]=_e;let Ee=!1;for(let Me=0;Me<ue&&!Ee;Me++)_e>=C[R[Me]]&&(R.splice(Me,0,pe),Ee=!0);Ee||(R[ue]=pe),ue++}}for(let pe=0;pe<ue;pe++){const Se=R[pe];$.push({idx:this.childOffsets[U]+Se,t:C[Se],nodex:(re<<1)+this._siblingOffset[Se][0],nodey:(te<<1)+this._siblingOffset[Se][1],depth:le+1})}}return null}_addNode(r,a,u){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,u,h,g){if(r[h].isLeaf(a,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=h-1,b=r[y];let A=0,C=0;for(let R=0;R<this._siblingOffset.length;R++){const k=2*a+this._siblingOffset[R][0],L=2*u+this._siblingOffset[R][1],$=b.getElevation(k,L),U=b.isLeaf(k,L),Z=this._addNode($.min,$.max,U);U&&(A|=1<<R),C||(C=Z)}for(let R=0;R<this._siblingOffset.length;R++)A&1<<R||this._construct(r,2*a+this._siblingOffset[R][0],2*u+this._siblingOffset[R][1],y,C+R)}}function xL(l,r,a,u,h,g){return xr(xr(l,a,g),xr(r,u,g),h)}function Ld(l,r,a){const u=a.dim,h=ne(l*u-.5,0,u-1),g=ne(r*u-.5,0,u-1),y=Math.floor(h),b=Math.floor(g),A=Math.min(y+1,u-1),C=Math.min(b+1,u-1);return xL(a.get(y,b),a.get(A,b),a.get(y,C),a.get(A,C),h-y,g-b)}const hX={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function fX(l,r,a){return(256*l*256+256*r+a)/10-1e4}function pX(l,r,a){return 256*l+r+a/256-32768}class g1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,u,h=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Ut(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const g=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let A=0;A<g;A++)y[this._idx(-1,A)]=y[this._idx(0,A)],y[this._idx(g,A)]=y[this._idx(g-1,A)],y[this._idx(A,-1)]=y[this._idx(A,0)],y[this._idx(A,g)]=y[this._idx(A,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const b=u==="terrarium"?pX:fX;for(let A=0;A<y.length;++A){const C=4*A;this.floatView[A]=b(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=So.now()}_buildQuadTree(){this._tree=new vL(this)}get(r,a,u=!1){u&&(r=ne(r,-1,this.dim),a=ne(a,-1,this.dim));const h=this._idx(r,a);return this.floatView[h]}set(r,a,u){const h=this._idx(r,a),g=this.floatView[h];return this.floatView[h]=u,u-g}static getUnpackVector(r){return hX[r]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const u=[0,0,0,0],h=g1.getUnpackVector(a);let g=Math.floor((r+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new pk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,g=a*this.dim+this.dim,y=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:y=b-1;break;case 1:b=y+1}const A=-a*this.dim,C=-u*this.dim;for(let R=y;R<b;R++)for(let k=h;k<g;k++){const L=4*this._idx(k,R),$=4*this._idx(k+A,R+C);this.pixels[L+0]=r.pixels[$+0],this.pixels[L+1]=r.pixels[$+1],this.pixels[L+2]=r.pixels[$+2],this.pixels[L+3]=r.pixels[$+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function mX(l,r,a){l===1?r.headerLength=a.readFixed32():l===2?r.x=a.readVarint():l===3?r.y=a.readVarint():l===4?r.z=a.readVarint():l===5&&r.layers.push(function(u,h){return u.readFields(xX,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(a,a.readVarint()+a.pos))}function gX(l,r,a){l===1?(r.delta_filter=function(u,h){return u.readFields(yX,{blockSize:0},h)}(a,a.readVarint()+a.pos),r.filter="delta_filter"):l===2?(a.readVarint(),r.filter="zigzag_filter"):l===3?(a.readVarint(),r.filter="bitshuffle_filter"):l===4&&(a.readVarint(),r.filter="byteshuffle_filter")}function yX(l,r,a){l===1&&(r.blockSize=a.readVarint())}function _X(l,r,a){l===1?(a.readVarint(),r.codec="gzip_data"):l===2?(a.readVarint(),r.codec="jpeg_image"):l===3?(a.readVarint(),r.codec="webp_image"):l===4&&(a.readVarint(),r.codec="png_image")}function vX(l,r,a){let u=0,h=0;l===1?r.firstByte=a.readFixed64():l===2?r.lastByte=a.readFixed64():l===3?r.filters.push(function(g,y){return g.readFields(gX,{},y)}(a,a.readVarint()+a.pos)):l===4?r.codec=function(g,y){return g.readFields(_X,{},y)}(a,a.readVarint()+a.pos):l===5?h=a.readFloat():l===6?u=a.readFloat():l===7?r.bands.push(a.readString()):l===8?r.offset=a.readDouble():l===9&&(r.scale=a.readDouble()),r.offset===0&&(r.offset=h),r.scale===0&&(r.scale=u)}function xX(l,r,a){l===1?r.version=a.readVarint():l===2?r.name=a.readString():l===3?r.units=a.readString():l===4?r.tileSize=a.readVarint():l===5?r.buffer=a.readVarint():l===6?r.pixelFormat=a.readVarint():l===7&&r.dataIndex.push(function(u,h){return u.readFields(vX,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(a,a.readVarint()+a.pos))}function bX(l,r,a){if(l===2)(function(u,h,g){u.readFields(wX,g,h)})(a,a.readVarint()+a.pos,r);else if(l===3)throw new Error("Not implemented")}function wX(l,r,a){if(l===1){let u=0;const h=a.readVarint()+a.pos;for(;a.pos<h;)r[u++]=a.readVarint()}}function SX(l,r){if(r.length!==4)throw new Error(`Expected data of dimension 4 but got ${r.length}.`);let a=r[3];for(let u=2;u>=1;u--){const h=u===1?1:0,g=u===2?1:0;for(let y=0;y<r[0];y++){const b=r[1]*y;for(let A=h;A<r[1];A++){const C=r[2]*(A+b);for(let R=g;R<r[2];R++){const k=r[3]*(R+C);for(let L=0;L<r[3];L++){const $=k+L;l[$]+=l[$-a]}}}}a*=r[u]}return l}function TX(l){for(let r=0,a=l.length;r<a;r++)l[r]=l[r]>>>1^-(1&l[r]);return l}function AX(l,r){switch(r){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const u=l[a],h=l[a+1];l[a]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,l[a+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const u=l[a],h=l[a+1],g=l[a+2],y=l[a+3];l[a+0]=(192&u)>>6|(192&h)>>4|(192&g)>>2|192&y,l[a+1]=(48&u)>>4|(48&h)>>2|48&g|(48&y)<<2,l[a+2]=(12&u)>>2|12&h|(12&g)<<2|(12&y)<<4,l[a+3]=3&u|(3&h)<<2|(3&g)<<4|(3&y)<<6}return l;default:throw new Error(`Invalid pixel format, "${r}"`)}}Yt(g1,"DEMData"),Yt(vL,"DemMinMaxQuadTree",{omit:["dem"]});var Ba=Uint8Array,yv=Uint16Array,EX=Int32Array,bL=new Ba([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wL=new Ba([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),PX=new Ba([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),SL=function(l,r){for(var a=new yv(31),u=0;u<31;++u)a[u]=r+=1<<l[u-1];var h=new EX(a[30]);for(u=1;u<30;++u)for(var g=a[u];g<a[u+1];++g)h[g]=g-a[u]<<5|u;return{b:a,r:h}},TL=SL(bL,2),AL=TL.b,CX=TL.r;AL[28]=258,CX[258]=28;for(var IX=SL(wL,0).b,EL=new yv(32768),ho=0;ho<32768;++ho){var Um=(43690&ho)>>1|(21845&ho)<<1;EL[ho]=((65280&(Um=(61680&(Um=(52428&Um)>>2|(13107&Um)<<2))>>4|(3855&Um)<<4))>>8|(255&Um)<<8)>>1}var _v=function(l,r,a){for(var u=l.length,h=0,g=new yv(r);h<u;++h)l[h]&&++g[l[h]-1];var y,b=new yv(r);for(h=1;h<r;++h)b[h]=b[h-1]+g[h-1]<<1;y=new yv(1<<r);var A=15-r;for(h=0;h<u;++h)if(l[h])for(var C=h<<4|l[h],R=r-l[h],k=b[l[h]-1]++<<R,L=k|(1<<R)-1;k<=L;++k)y[EL[k]>>A]=C;return y},vv=new Ba(288);for(ho=0;ho<144;++ho)vv[ho]=8;for(ho=144;ho<256;++ho)vv[ho]=9;for(ho=256;ho<280;++ho)vv[ho]=7;for(ho=280;ho<288;++ho)vv[ho]=8;var PL=new Ba(32);for(ho=0;ho<32;++ho)PL[ho]=5;var MX=_v(vv,9),OX=_v(PL,5),dE=function(l){for(var r=l[0],a=1;a<l.length;++a)l[a]>r&&(r=l[a]);return r},Zl=function(l,r,a){var u=r/8|0;return(l[u]|l[u+1]<<8)>>(7&r)&a},hE=function(l,r){var a=r/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&r)},RX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kl=function(l,r,a){var u=new Error(r||RX[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,Kl),!a)throw u;return u},kX=new Ba(0),jX=typeof TextDecoder<"u"&&new TextDecoder;try{jX.decode(kX,{stream:!0})}catch{}const DX={gzip_data:"gzip"};class dl extends Error{constructor(r){super(r),this.name="MRTError"}}const LX={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},CL={uint32:1,uint16:2,uint8:4},NX={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fE;class y1{constructor(r=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=r}getLayer(r){const a=this.layers[r];if(!a)throw new dl(`Layer '${r}' not found`);return a}getHeaderLength(r){const a=new Uint8Array(r),u=new DataView(r);if(a[0]!==13)throw new dl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(r){const a=new Uint8Array(r),u=this.getHeaderLength(r);if(a.length<u)throw new dl(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const h=new fE(a.subarray(0,u)).readFields(mX,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new dl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const g of h.layers)this.layers[g.name]=new IL(g,{cacheSize:this._cacheSize});return this}createDecodingTask(r){const a=[],u=this.getLayer(r.layerName);for(let h of r.blockIndices){const g=u.dataIndex[h],y=g.firstByte-r.firstByte,b=g.lastByte-r.firstByte;if(u._blocksInProgress.has(h))continue;const A={layerName:u.name,firstByte:y,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(C=>C.filter)};u._blocksInProgress.add(h),a.push(A)}return new ML(a,()=>{a.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,g)=>{if(a.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),h)throw h;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class IL{constructor({version:r,name:a,units:u,tileSize:h,pixelFormat:g,buffer:y,dataIndex:b},A){if(this.version=r,this.version!==1)throw new dl(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=a,this.units=u,this.tileSize=h,this.buffer=y,this.pixelFormat=LX[g],this.dataIndex=b,this.bandShape=[h+2*y,h+2*y,CL[this.pixelFormat]],this._decodedBlocks=new m1(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return CL[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:r})=>r).flat()}processDecodedData(r){const a=r.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,r.data)}getBlockForBand(r){let a=0;switch(typeof r){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[g,y]of h.bands.entries())if(y===r)return{bandIndex:a+g,blockIndex:u,blockBandIndex:g};a+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(r>=a&&r<a+h.bands.length)return{bandIndex:r,blockIndex:u,blockBandIndex:r-a};a+=h.bands.length}break;default:throw new dl(`Invalid band \`${JSON.stringify(r)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(r){let a=1/0,u=-1/0;const h=[],g=new Set;for(const y of r){const{blockIndex:b}=this.getBlockForBand(y);if(b<0)throw new dl(`Invalid band: ${JSON.stringify(y)}`);const A=this.dataIndex[b];h.includes(b)||h.push(b),g.add(b),a=Math.min(a,A.firstByte),u=Math.max(u,A.lastByte)}if(g.size>this.cacheSize)throw new dl(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:h}}hasBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0}hasDataForBand(r){const{blockIndex:a}=this.getBlockForBand(r);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(r){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(r);if(a<0)throw new dl(`Band not found: ${JSON.stringify(r)}`);const h=this._decodedBlocks.get(a.toString());if(!h)throw new dl(`Data for band ${JSON.stringify(r)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[a],y=this.bandShape.reduce((C,R)=>C*R,1),b=u*y,A=h.subarray(b,b+y);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}y1.setPbf=function(l){fE=l};class ML{constructor(r,a,u){this.tasks=r,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(r,a){this._finalized||(this._onComplete(r,a),this._finalized=!0)}}y1.performDecoding=function(l,r){const a=new Uint8Array(l);return Promise.all(r.tasks.map(u=>{const{layerName:h,firstByte:g,lastByte:y,pixelFormat:b,blockShape:A,blockIndex:C,filters:R,codec:k}=u,L=a.subarray(g,y+1),$=new Uint32Array(A[0]*A[1]*A[2]);let U;if(k!=="gzip_data")throw new dl(`Unhandled codec: ${k}`);return U=function(Z,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve(((pe=function(Ee){Ee[0]==31&&Ee[1]==139&&Ee[2]==8||Kl(6,"invalid gzip data");var Me=Ee[3],De=10;4&Me&&(De+=2+(Ee[10]|Ee[11]<<8));for(var nt=(Me>>3&1)+(Me>>4&1);nt>0;nt-=!Ee[De++]);return De+(2&Me)}(ue=Z))+8>ue.length&&Kl(6,"invalid gzip data"),function(Ee,Me,De,nt){var Ve=Ee.length;if(!Ve||Me.f&&!Me.l)return De||new Ba(0);var lt=!De,ft=lt||Me.i!=2,pt=Me.i;lt&&(De=new Ba(3*Ve));var xt,wt,yt=function(Gn){var Sn=De.length;if(Gn>Sn){var In=new Ba(Math.max(2*Sn,Gn));In.set(De),De=In}},_t=Me.f||0,at=Me.p||0,ot=Me.b||0,vt=Me.l,Ot=Me.d,Et=Me.m,or=Me.n,Ft=8*Ve;do{if(!vt){_t=Zl(Ee,at,1);var Ht=Zl(Ee,at+1,3);if(at+=3,!Ht){var Qt=Ee[(ct=4+((at+7)/8|0))-4]|Ee[ct-3]<<8,Hr=ct+Qt;if(Hr>Ve){pt&&Kl(0);break}ft&&yt(ot+Qt),De.set(Ee.subarray(ct,Hr),ot),Me.b=ot+=Qt,Me.p=at=8*Hr,Me.f=_t;continue}if(Ht==1)vt=MX,Ot=OX,Et=9,or=5;else if(Ht==2){var Pt=Zl(Ee,at,31)+257,er=Zl(Ee,at+10,15)+4,Cr=Pt+Zl(Ee,at+5,31)+1;at+=14;for(var en=new Ba(Cr),sn=new Ba(19),Dr=0;Dr<er;++Dr)sn[PX[Dr]]=Zl(Ee,at+3*Dr,7);at+=3*er;var Un=dE(sn),ve=(1<<Un)-1,Te=_v(sn,Un);for(Dr=0;Dr<Cr;){var ct,bt=Te[Zl(Ee,at,ve)];if(at+=15&bt,(ct=bt>>4)<16)en[Dr++]=ct;else{var jt=0,Dt=0;for(ct==16?(Dt=3+Zl(Ee,at,3),at+=2,jt=en[Dr-1]):ct==17?(Dt=3+Zl(Ee,at,7),at+=3):ct==18&&(Dt=11+Zl(Ee,at,127),at+=7);Dt--;)en[Dr++]=jt}}var sr=en.subarray(0,Pt),ur=en.subarray(Pt);Et=dE(sr),or=dE(ur),vt=_v(sr,Et),Ot=_v(ur,or)}else Kl(1);if(at>Ft){pt&&Kl(0);break}}ft&&yt(ot+131072);for(var Rr=(1<<Et)-1,Vr=(1<<or)-1,Gr=at;;Gr=at){var Xr=(jt=vt[hE(Ee,at)&Rr])>>4;if((at+=15&jt)>Ft){pt&&Kl(0);break}if(jt||Kl(2),Xr<256)De[ot++]=Xr;else{if(Xr==256){Gr=at,vt=null;break}var _r=Xr-254;Xr>264&&(_r=Zl(Ee,at,(1<<(xn=bL[Dr=Xr-257]))-1)+AL[Dr],at+=xn);var Er=Ot[hE(Ee,at)&Vr],pn=Er>>4;if(Er||Kl(3),at+=15&Er,ur=IX[pn],pn>3){var xn=wL[pn];ur+=hE(Ee,at)&(1<<xn)-1,at+=xn}if(at>Ft){pt&&Kl(0);break}ft&&yt(ot+131072);var bn=ot+_r;if(ot<ur){var Dn=0-ur,Yn=Math.min(ur,bn);for(Dn+ot<0&&Kl(3);ot<Yn;++ot)De[ot]=(void 0)[Dn+ot]}for(;ot<bn;++ot)De[ot]=De[ot-ur]}}Me.l=vt,Me.p=Gr,Me.b=ot,Me.f=_t,vt&&(_t=1,Me.m=Et,Me.d=Ot,Me.n=or)}while(!_t);return ot!=De.length&&lt?(xt=De,((wt=ot)==null||wt>xt.length)&&(wt=xt.length),new Ba(xt.subarray(0,wt))):De.subarray(0,ot)}(ue.subarray(pe,-8),{i:2},new Ba(((te=ue)[(le=te.length)-4]|te[le-3]<<8|te[le-2]<<16|te[le-1]<<24)>>>0))));var te,le,ue,pe;const Se=DX[re];if(!Se)throw new Error(`Unhandled codec: ${re}`);const _e=new globalThis.DecompressionStream(Se);return new Response(new Blob([Z]).stream().pipeThrough(_e)).arrayBuffer().then(Ee=>new Uint8Array(Ee))}(L,k).then(Z=>(function(re,te){re.readFields(bX,te)}(new fE(Z),$),new NX[b]($.buffer))),U.then(Z=>{for(let re=R.length-1;re>=0;re--)switch(R[re]){case"delta_filter":SX(Z,A);break;case"zigzag_filter":TX(Z);break;case"bitshuffle_filter":AX(Z,b);break;default:throw new dl(`Unhandled filter "${R[re]}"`)}return{layerName:h,blockIndex:C,data:Z}}).catch(Z=>{throw Z})}))},Yt(ML,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Yt(y1,"MapboxRasterTile"),Yt(IL,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class OL{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const u=r[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class RL{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new xd(Mt,16,0),this.featureIndexArray=new C_,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(r,a,u,h,g,y=0,b=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,y);const C=this.grid;for(let R=0;R<a.length;R++){const k=a[R],L=[1/0,1/0,-1/0,-1/0];for(let $=0;$<k.length;$++){const U=k[$];L[0]=Math.min(L[0],U.x),L[1]=Math.min(L[1],U.y),L[2]=Math.max(L[2],U.x),L[3]=Math.max(L[3],U.y)}b!==0&&(L[0]-=b,L[1]-=b,L[2]+=b,L[3]+=b),L[0]<Mt&&L[1]<Mt&&L[2]>=0&&L[3]>=0&&C.insert(A,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ze(new qb(this.rawTileData)).layers,this.sourceLayerCoder=new OL(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a){const{tilespaceGeometry:u,transform:h,tileTransform:g,pixelPosMatrix:y,availableImages:b,worldview:A}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const C=a.queryRadius?a.queryRadius:0,R=u.bufferedTilespaceBounds,k=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(Z,re,te,le)=>ws(u.bufferedTilespaceGeometry,Z-C,re-C,te+C,le+C));k.sort(zX);let L=null;h.elevation&&k.length>0&&(L=Bm.create(h.elevation,this.tileID));const $={};let U;for(let Z=0;Z<k.length;Z++){const re=k[Z];if(re===U)continue;U=re;const te=this.featureIndexArray.get(re);let le=null;this.is3DTile?this.loadMatchingModelFeature($,te,r,u,h,A):this.loadMatchingFeature($,te,r,b,A,(ue,pe,Se,_e=0)=>(le||(le=Ce(ue,this.tileID.canonical,g)),pe.queryIntersectsFeature(u,ue,Se,le,this.z,h,y,L,_e)))}return $}loadMatchingFeature(r,a,u,h,g,y){const{featureIndex:b,bucketIndex:A,sourceLayerIndex:C,layoutVertexArrayOffset:R}=a,k=this.bucketLayerIDs[A],L=u.layers,$=Object.keys(L);if($.length&&!Kt($,k))return;const U=u.sourceCache,Z=this.sourceLayerCoder.decode(C),re=this.vtLayers[Z].feature(b),te=this.getId(re,Z);for(let le=0;le<k.length;le++){const ue=k[le];if(!L[ue])continue;const{styleLayer:pe,targets:Se}=L[ue];let _e={};te!==void 0&&(_e=U.getFeatureState(pe.sourceLayer,te));const Ee=!y||y(re,pe,_e,R);if(!Ee)continue;const Me=new af(re,this.z,this.x,this.y,te);Me.tile=this.tileID.canonical,Me.state=_e;let De=this.serializedLayersCache.get(ue);De||(De=pe.serialize(),De.id=ue,this.serializedLayersCache.set(ue,De)),Me.source=De.source,Me.sourceLayer=De["source-layer"],Me.layer=Object.assign({},De),Me.layer.paint=kL(De.paint,pe.paint,re,_e,h),Me.layer.layout=kL(De.layout,pe.layout,re,_e,h);let nt=!1;for(const Ve of Se){this.updateFeatureProperties(Me,Ve);const{filter:lt}=Ve;if(lt){if(re.properties=Me.properties,lt.needGeometry){const ft=$e(re,!0);if(!lt.filter(new si(this.tileID.overscaledZ,{worldview:g}),ft,this.tileID.canonical))continue}else if(!lt.filter(new si(this.tileID.overscaledZ,{worldview:g}),re))continue}nt=!0,Ve.targetId&&this.addFeatureVariant(Me,Ve)}nt&&this.appendToResult(r,ue,b,Me,Ee)}}loadMatchingModelFeature(r,a,u,h,g,y){const{featureIndex:b,bucketIndex:A}=a,C=this.bucketLayerIDs[A],R=u.layers,k=Object.keys(R);if(!k.length||Kt(k,C))for(let L=0;L<C.length;L++){const $=C[L],{styleLayer:U,targets:Z}=R[$];if(U.type!=="model")continue;const re=h.tile,te=re.getBucket(U);if(!(te&&te instanceof u1))continue;const le=HK(te,b,h,g);if(!le)continue;const{z:ue,x:pe,y:Se}=re.tileID.canonical,{feature:_e,intersectionZ:Ee,position:Me}=le;let De={};_e.id!==void 0&&(De=u.sourceCache.getFeatureState(U.sourceLayer,_e.id));const nt=new af({},ue,pe,Se,_e.id);nt.tile=this.tileID.canonical,nt.state=De,nt.properties=_e.properties,nt.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Ve=this.serializedLayersCache.get($);Ve||(Ve=U.serialize(),Ve.id=$,this.serializedLayersCache.set($,Ve)),nt.source=Ve.source,nt.sourceLayer=Ve["source-layer"],nt.layer=Object.assign({},Ve);let lt=!1;for(const ft of Z){this.updateFeatureProperties(nt,ft);const{filter:pt}=ft;if(pt){if(_e.properties=nt.properties,pt.needGeometry){if(!pt.filter(new si(this.tileID.overscaledZ,{worldview:y}),_e,this.tileID.canonical))continue}else if(!pt.filter(new si(this.tileID.overscaledZ,{worldview:y}),_e))continue}lt=!0,ft.targetId&&this.addFeatureVariant(nt,ft)}lt&&this.appendToResult(r,$,b,nt,Ee)}}updateFeatureProperties(r,a,u){if(a.properties){const h={};for(const g in a.properties){const y=a.properties[g].evaluate({zoom:this.z},r._vectorTileFeature,r.state,r.tile,u);y!=null&&(h[g]=y)}r.properties=h}}addFeatureVariant(r,a,u){const h={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(h.properties=r.properties),r.variants=r.variants||{},r.variants[a.targetId]=r.variants[a.targetId]||[],r.variants[a.targetId].push(h)}appendToResult(r,a,u,h,g){let y=r[a];y===void 0&&(y=r[a]=[]),y.push({featureIndex:u,feature:h,intersectionZ:g})}lookupSymbolFeatures(r,a,u,h,g,y){const b={};this.loadVTLayers();for(const A of r)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:u,featureIndex:A,layoutVertexArrayOffset:0},h,g,y);return b}loadFeature(r){const{featureIndex:a,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[a])return g[a];const y=this.vtLayers[h].feature(a);return g[a]=y,y}hasLayer(r){for(const a of this.bucketLayerIDs)for(const u of a)if(r===u)return!0;return!1}getId(r,a){let u=r.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const g=Mc(h);if(g.result!=="success"){const y=g.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Ut(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}u=this.promoteIdExpression.evaluate({zoom:0},r)}else u=r.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function kL(l,r,a,u,h){return Je(l,(g,y)=>{const b=r instanceof wu?r.get(y):null;return b&&b.evaluate?b.evaluate(a,u,void 0,h):b})}function zX(l,r){return r-l}Yt(RL,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const jL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class pE{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=jL[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new pE(b,y,g,r)}constructor(r,a=64,u=Float64Array,h){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const g=jL.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-b%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+A,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+A),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+A,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=a,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return mE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:b}=this,A=[0,g.length-1,0],C=[];for(;A.length;){const R=A.pop()||0,k=A.pop()||0,L=A.pop()||0;if(k-L<=b){for(let re=L;re<=k;re++){const te=y[2*re],le=y[2*re+1];te>=r&&te<=u&&le>=a&&le<=h&&C.push(g[re])}continue}const $=L+k>>1,U=y[2*$],Z=y[2*$+1];U>=r&&U<=u&&Z>=a&&Z<=h&&C.push(g[$]),(R===0?r<=U:a<=Z)&&(A.push(L),A.push($-1),A.push(1-R)),(R===0?u>=U:h>=Z)&&(A.push($+1),A.push(k),A.push(1-R))}return C}within(r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:y}=this,b=[0,h.length-1,0],A=[],C=u*u;for(;b.length;){const R=b.pop()||0,k=b.pop()||0,L=b.pop()||0;if(k-L<=y){for(let re=L;re<=k;re++)LL(g[2*re],g[2*re+1],r,a)<=C&&A.push(h[re]);continue}const $=L+k>>1,U=g[2*$],Z=g[2*$+1];LL(U,Z,r,a)<=C&&A.push(h[$]),(R===0?r-u<=U:a-u<=Z)&&(b.push(L),b.push($-1),b.push(1-R)),(R===0?r+u>=U:a+u>=Z)&&(b.push($+1),b.push(k),b.push(1-R))}return A}}function mE(l,r,a,u,h,g){if(h-u<=a)return;const y=u+h>>1;DL(l,r,y,u,h,g),mE(l,r,a,u,y-1,1-g),mE(l,r,a,y+1,h,1-g)}function DL(l,r,a,u,h,g){for(;h>u;){if(h-u>600){const C=h-u+1,R=a-u+1,k=Math.log(C),L=.5*Math.exp(2*k/3),$=.5*Math.sqrt(k*L*(C-L)/C)*(R-C/2<0?-1:1);DL(l,r,a,Math.max(u,Math.floor(a-R*L/C+$)),Math.min(h,Math.floor(a+(C-R)*L/C+$)),g)}const y=r[2*a+g];let b=u,A=h;for(xv(l,r,u,a),r[2*h+g]>y&&xv(l,r,u,h);b<A;){for(xv(l,r,b,A),b++,A--;r[2*b+g]<y;)b++;for(;r[2*A+g]>y;)A--}r[2*u+g]===y?xv(l,r,u,A):(A++,xv(l,r,A,h)),A<=a&&(u=A+1),a<=A&&(h=A-1)}}function xv(l,r,a,u){gE(l,a,u),gE(r,2*a,2*u),gE(r,2*a+1,2*u+1)}function gE(l,r,a){const u=l[r];l[r]=l[a],l[a]=u}function LL(l,r,a,u){const h=l-a,g=r-u;return h*h+g*g}i.$=xp,i.A=Il,i.B=La,i.C=2,i.D=Pm,i.E=fu,i.F=tv,i.G=lD,i.H=vp,i.I=as,i.J=cb,i.K=ir,i.L=ad,i.M=Gp,i.N=Lh,i.O=Xx,i.P=mt,i.Q=Nh,i.R=mh,i.S=em,i.T=TA,i.U=Mc,i.V=c1,i.W=l_,i.X=hd,i.Y=dd,i.Z=Mh,i._=vs,i.a=function(l){return Jr.API_CDN_URL_REGEX.test(l)},i.a$=W,i.a0=Ar,i.a1=ca,i.a2=sl,i.a3=class extends c1{},i.a4=Hp,i.a5=Kx,i.a6=He,i.a7=function(l){const r=l.value;return r?Ar(r)?tE(r,!0)?[]:[new c1(l.key,r,`invalid url "${r}"`)]:[new c1(l.key,r,`string expected, "${ir(r)}" found`)]:[]},i.a8=ob,i.a9=Pi,i.aA=ne,i.aB=Q,i.aC=Hi,i.aD=Xo,i.aE=Kn,i.aF=P,i.aG=fe,i.aH=function(l,r){const a={};for(let u=0;u<r.length;u++){const h=r[u];h in l&&(a[h]=l[h])}return a},i.aI=m,i.aJ=O,i.aK=class{constructor(l){this.entries={},this.scheduler=l}request(l,r,a,u){const h=this.entries[l]=this.entries[l]||{callbacks:[]};if(h.result){const[g,y]=h.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},r):u(g,y),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=a((g,y)=>{h.result=[g,y];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,y)},r):b(g,y);setTimeout(()=>delete this.entries[l],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(g=>g!==u),h.callbacks.length||(h.cancel(),delete this.entries[l]))}}},i.aL=function(l,r,a){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},h=>{const g=Cl(l.request,(y,b,A)=>{y?h(y):b&&h(null,{rawData:b,vectorTile:a?void 0:new Ze(new qb(b)),responseHeaders:new Map(A.entries())})});return()=>{g.cancel(),h()}},r)},i.aM=function(l){return l?{cacheControl:l.get("Cache-Control"),expires:l.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=Bs,i.aO=function(l){la++,la>cp&&(l.getActor().send("enforceCacheSizeLimit",lp),la=0)},i.aP=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log2(l)))},i.aQ=Ai,i.aR=ND,i.aS=UD,i.aT=c,i.aU=LD,i.aV=function(l,r){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let u=0;u<l.length;u++){const h=document.createElement("source");_2(l[u])||(a.crossOrigin="Anonymous"),h.src=l[u],a.appendChild(h)}return{cancel:()=>{}}},i.aW=X_,i.aX=lf,i.aY=Ue,i.aZ=ov,i.a_=F,i.aa=Ct,i.ab=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return jr(l.expression.evaluate(r))}interpolate(l,r,a){return{x:xr(l.x,r.x,a),y:xr(l.y,r.y,a),z:xr(l.z,r.z,a),azimuthal:xr(l.azimuthal,r.azimuthal,a),polar:xr(l.polar,r.polar,a)}}},i.ac=si,i.ad=vu,i.ae=de,i.af=zr,i.ag=it,i.ah=ce,i.ai=wu,i.aj=Od,i.ak=xr,i.al=Mt,i.am=Oy,i.an=Zr,i.ao=kn,i.ap=class{constructor(l){this.specification=l}possiblyEvaluate(l,r){return function([a,u]){const h=jr([1,a,u]);return{x:h.x,y:h.y,z:h.z}}(l.expression.evaluate(r))}interpolate(l,r,a){return{x:xr(l.x,r.x,a),y:xr(l.y,r.y,a),z:xr(l.z,r.z,a)}}},i.aq=function(l,r,a=0,u=!0){const h=new mt(a,a),g=l.sub(h),y=r.add(h),b=[g,new mt(y.x,g.y),y,new mt(g.x,y.y)];return u&&b.push(g.clone()),b},i.ar=function(l,r){const a=[];for(let u=0;u<l.length;u++){const h=ge(u-1,-1,l.length-1),g=ge(u+1,-1,l.length-1),y=l[u],b=l[g],A=l[h].sub(y).unit(),C=b.sub(y).unit(),R=C.angleWithSep(A.x,A.y),k=A.add(C).unit().mult(-1*r/Math.sin(R/2));a.push(y.add(k))}return a},i.as=bD,i.at=ws,i.au=function(l,r,a=0){return Ge(((r.x-a)*l.scale-l.x)*Mt,(r.y*l.scale-l.y)*Mt,H(r.z,r.y))},i.av=Qn,i.aw=Lt,i.ax=Jt,i.ay=Lj,i.az=function(l){let r=1/0,a=1/0,u=-1/0,h=-1/0;for(const g of l)r=Math.min(r,g.x),a=Math.min(a,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new mt(r,a),max:new mt(u,h)}},i.b=function(l){return Jr.API_FONTS_REGEX.test(l)},i.b$=Lk,i.b0=to,i.b1=Sd,i.b2=Fe,i.b3=_b,i.b4=o1,i.b5=function(){Ll.isLoading()||Ll.isLoaded()||$h()!=="deferred"||ib()},i.b6=tm,i.b7=$e,i.b8=af,i.b9=Ei,i.bA=V,i.bB=he,i.bC=G,i.bD=function(l,r){const{x:a,y:u}=l.point,h=tk(a,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Q(h,h,Q2(Fa(r)))},i.bE=I,i.bF=Hn,i.bG=nn,i.bH=br,i.bI=pr,i.bJ=nr,i.bK=Dm,i.bL=ta,i.bM=VA,i.bN=function(l,r,a,u,h){const g=5*r+2;l.float32[g+0]=a,l.float32[g+1]=u,l.float32[g+2]=h},i.bO=Fm,i.bP=Ir,i.bQ=$o,i.bR=Ii,i.bS=on,i.bT=ge,i.bU=function(l,r,a,u){var h=new E(4);return h[0]=l,h[1]=r,h[2]=a,h[3]=u,h},i.bV=class{isDataAvailableAtPoint(l){const r=this._source();if(this.isUsingMockSource()||!r||l.y<0||l.y>1)return!1;const a=r.getSource().maxzoom,u=1<<a,h=Math.floor(l.x),g=Math.floor((l.x-h)*u),y=Math.floor(l.y*u),b=this.findDEMTileFor(new Ai(a,h,a,g,y));return!(!b||!b.dem)}getAtPointOrZero(l,r=0){return this.getAtPoint(l,r)||0}getAtPoint(l,r,a=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const u=this._source();if(!u||l.y<0||l.y>1)return r;const h=u.getSource().maxzoom,g=1<<h,y=Math.floor(l.x),b=l.x-y,A=new Ai(h,y,h,Math.floor(b*g),Math.floor(l.y*g)),C=this.findDEMTileFor(A);if(!C||!C.dem)return r;const R=C.dem,k=1<<C.tileID.canonical.z,L=(b*k-C.tileID.canonical.x)*R.dim,$=(l.y*k-C.tileID.canonical.y)*R.dim,U=Math.floor(L),Z=Math.floor($);return(a?this.exaggeration():1)*xr(xr(R.get(U,Z),R.get(U,Z+1),$-Z),xr(R.get(U+1,Z),R.get(U+1,Z+1),$-Z),L-U)}static getAtTileOffset(l,r,a,u){const h=1<<l.canonical.z;return u?u.pointElevation(r):a?a.getAtPointOrZero(new de(l.wrap+(l.canonical.x+r.x/Mt)/h,(l.canonical.y+r.y/Mt)/h)):0}static getAtTileOffsetFunc(l,r,a,u){return(h,g,y)=>{const b=this.getAtTileOffset(l,h,g,y),A=u.upVector(l.canonical,h.x,h.y);return $t(A,A,b*u.upVectorScale(l.canonical,r,a).metersToTile),A}}getForTilePoints(l,r,a,u){if(this.isUsingMockSource())return!1;const h=Bm.create(this,l,u);return!!h&&(r.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(l);if(!r||!r.dem)return null;const a=r.dem.tree,u=r.tileID,h=1<<l.canonical.z-u.canonical.z;let g=l.canonical.x/h-u.canonical.x,y=l.canonical.y/h-u.canonical.y,b=0;for(let A=0;A<l.canonical.z-u.canonical.z&&!a.leaves[b];A++){g*=2,y*=2;const C=2*Math.floor(y)+Math.floor(g);b=a.childOffsets[b]+C,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let r=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of l){const g=this.getMinMaxForTile(h.tileID);g&&(a=Math.min(a,g.min),u=Math.max(u,g.max),r=!0)}return r?{min:a,max:u}:null}},i.bW=Lb,i.bX=_n,i.bY=Ao,i.bZ=Rk,i.b_=GD,i.ba=kA,i.bb=cA,i.bc=Ce,i.bd=Rc,i.be=jc,i.bf=Id,i.bg=_i,i.bh=Am,i.bi=QA,i.bj=function(l,r){const a=Od(r.zoom);if(a===0)return Fa(l);const u=Ab(l),h=J2(u),g=P(u.getWest())*r.worldSize,y=P(u.getEast())*r.worldSize,b=O(u.getNorth())*r.worldSize,A=O(u.getSouth())*r.worldSize,C=[g,b,0],R=[y,b,0],k=[g,A,0],L=[y,A,0],$=K([],r.globeMatrix);return zr(C,C,$),zr(R,R,$),zr(k,k,$),zr(L,L,$),h[0]=Gl(h[0],k,a),h[1]=Gl(h[1],L,a),h[2]=Gl(h[2],R,a),h[3]=Gl(h[3],C,a),rr.fromPoints(h)},i.bk=Pb,i.bl=K,i.bm=j_,i.bn=Gl,i.bo=wd,i.bp=Jh,i.bq=we,i.br=X,i.bs=y1,i.bt=qb,i.bu=Cl,i.bv=function(l,r){const a=[];for(const u in l)u in r||a.push(u);return a},i.bw=Re,i.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.by=qo,i.bz=z,i.c=Go,i.c$=function(l,r,a){let u=0;for(let h=0;h<2;++h)l[h]>0&&(u+=(l[h]-0)*(l[h]-0)),r[h]<0&&(u+=(0-r[h])*(0-r[h]));return u},i.c0=Nk,i.c1=FA,i.c2=mD,i.c3=qA,i.c4=pE,i.c5=$t,i.c6=gs,i.c7=Io,i.c8=function(l,r,a){a*=.5;var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(a),A=Math.cos(a);return l[0]=u*A+h*b,l[1]=h*A-u*b,l[2]=g*A+y*b,l[3]=y*A-g*b,l},i.c9=jo,i.cA=qe,i.cB=wn,i.cC=bj,i.cD=Xn,i.cE=JR,i.cF=function(l,r,a,u,h,g,y,b,A){if(A.name==="globe")return JR(l,r,new Xn(a,u,h),!1);const C=ov({z:a,x:u,y:h},A);return new rr([(g+C.x/C.scale)*r,r*(C.y/C.scale),y],[(g+C.x2/C.scale)*r,r*(C.y2/C.scale),b])},i.cG=function(l,r,a){return l[0]=Math.min(r[0],a[0]),l[1]=Math.min(r[1],a[1]),l[2]=Math.min(r[2],a[2]),l[3]=Math.min(r[3],a[3]),l},i.cH=function(l,r,a){return l[0]=Math.max(r[0],a[0]),l[1]=Math.max(r[1],a[1]),l[2]=Math.max(r[2],a[2]),l[3]=Math.max(r[3],a[3]),l},i.cI=function(l){const r=Math.round((l+45+360)%360/90)%4;return Py[r]},i.cJ=q,i.cK=Co,i.cL=Tm,i.cM=function(l){const r=V(new Float64Array(16));Q(r,l.pixelMatrix,l.globeMatrix);const a=[0,ma,0],u=[0,ga,0];return zr(a,a,r),zr(u,u,r),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!tA(l,new c(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!tA(l,new c(l.center.lat,-90))]},i.cN=function(l,r){const{scale:a}=l.tileTransform,u=a*Mt/(l.tileSize*Math.pow(2,r.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(h,g,y){var b=g[1],A=g[2],C=g[3],R=y[0],k=y[1];return h[0]=g[0]*R,h[1]=b*R,h[2]=A*k,h[3]=C*k,h}(new Float32Array(4),r.inverseAdjustmentMatrix,[u,u])},i.cO=$b,i.cP=Be,i.cQ=xj,i.cR=function(l){const r=xj(l,!0);return I([],[r[0],r[1],r[4],r[5]])},i.cS=ie,i.cT=zt,i.cU=J,i.cV=function(l){const{x:r,y:a}=l.point,{lng:u,lat:h}=l._center;return tk(r,a,l.worldSize,u,h)},i.cW=Xt,i.cX=os,i.cY=xi,i.cZ=Ho,i.c_=pa,i.ca=Oi,i.cb=function(l,r){return l[0]=-r[0],l[1]=-r[1],l[2]=-r[2],l[3]=r[3],l},i.cc=Oe,i.cd=function(l,r,a,u,h){var g=1/Math.tan(r/2);if(l[0]=g/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=g,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,h!=null&&h!==1/0){var y=1/(u-h);l[10]=(h+u)*y,l[14]=2*h*u*y}else l[10]=-1,l[14]=-2*u;return l},i.ce=function(l,r,a,u,h,g,y){var b=1/(r-a),A=1/(u-h),C=1/(g-y);return l[0]=-2*b,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*A,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*C,l[11]=0,l[12]=(r+a)*b,l[13]=(h+u)*A,l[14]=(y+g)*C,l[15]=1,l},i.cf=D,i.cg=function(l,r,a){l[4*r+0]=a[0],l[4*r+1]=a[1],l[4*r+2]=a[2],l[4*r+3]=a[3]},i.ch=xm,i.ci=Wh,i.cj=ro,i.ck=cl,i.cl=Zh,i.cm=ED,i.cn=function(){var l=new E(4);return E!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},i.co=function(l,r,a){var u=r[0],h=r[1],g=r[2],y=r[3],b=Math.sin(a),A=Math.cos(a);return l[0]=u*A+g*b,l[1]=h*A+y*b,l[2]=u*-b+g*A,l[3]=h*-b+y*A,l},i.cp=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]},i.cq=zn,i.cr=function(l){var r=l[0],a=l[1],u=l[2],h=l[3];return Math.sqrt(r*r+a*a+u*u+h*h)},i.cs=Zt,i.ct=hi,i.cu=Vi,i.cv=3,i.cw=2,i.cx=7,i.cy=6,i.cz=Nt,i.d=function(l){return Jr.API_TILEJSON_REGEX.test(l)},i.d$=class{constructor(l,r,a,u){this.context=l,this.format=u,this.size=a,this.texture=l.gl.createTexture();const[h,g,y]=this.size,{gl:b}=l;b.bindTexture(b.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in r&&r.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,h,g,y,0,wA(this.format),SA(this.format),r.data)}bind(l,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},i.d0=function(l){return l*l*l*l*l},i.d1=T,i.d2=45,i.d3=bm,i.d4=function(l,r,a){const u=Math.sqrt(l*l+r*r+a*a),h=u>0?Math.acos(a/u)*Uo:0;let g=l!==0||r!==0?Math.atan2(-r,-l)*Uo+90:0;return g<0&&(g+=360),[u,g,h]},i.d5=Ge,i.d6=jr,i.d7=oe,i.d8=ut,i.d9=rr,i.dA=function(l){return l({pluginStatus:xs,pluginURL:Dl}),Jp.on("pluginStateChange",l),l},i.dB=qh,i.dC=class extends zl{constructor(l){super(l),this.current=wm}set(l,r,a){if(this.fetchUniformLocation(l,r)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},i.dD=au,i.dE=function(l,r,a){const u=Od(a.zoom),h=l.style.map._antialias,g=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!h&&!g},i.dF=function(l){const r=l.pixelsPerMeter,a=r/D(1,l.center.lat),u=V(new Float64Array(16));return X(u,u,[l.point.x,l.point.y,0]),ie(u,u,[a,a,r]),Float32Array.from(u)},i.dG=Ab,i.dH=function(l){const r=q-5;l=ne(l,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin(Zr(l))),3);return Math.round(a*(k_.length-1))},i.dI=function(l,r,a,u){const h=r.getNorth(),g=r.getSouth(),y=r.getWest(),b=r.getEast(),A=1<<l.z,C=b-y,R=h-g,k=C/Pd,L=-R/k_[a],$=[0,k,0,L,0,0,h,y,0];if(l.z>0){const U=180/u;N($,$,[U/C+1,0,0,0,U/R+1,0,-.5*U/k,.5*U/L,1])}return $[2]=A,$[5]=l.x,$[8]=l.y,$},i.dJ=Fa,i.dK=function(l,r,a){const u=V(new Float64Array(16)),h=(r/(1<<l)-.5)*Math.PI*2;return se(u,a.globeMatrix,h),Float32Array.from(u)},i.dL=pk,i.dM=ul,i.dN=function(l,r){return[Math.pow(l[0],2.2)*r,Math.pow(l[1],2.2)*r,Math.pow(l[2],2.2)*r]},i.dO=M,i.dP=function(l,r){var a=Math.sin(r),u=Math.cos(r);return l[0]=u,l[1]=a,l[2]=0,l[3]=-a,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},i.dQ=un,i.dR=ek,i.dS=gn,i.dT=Si,i.dU=256,i.dV=function(l,r){const a=[0,0,0];return zr(a,a,Pb(Fa(r.canonical))),zr(a,a,l),a},i.dW=l=>({u_matrix:new Zh(l),u_texsize:new cl(l),u_pixels_to_tile_units:new Sm(l),u_device_pixel_ratio:new ro(l),u_width_scale:new ro(l),u_floor_width_scale:new ro(l),u_image:new xm(l),u_units_to_pixels:new cl(l),u_tile_units_to_pixels:new ro(l),u_alpha_discard_threshold:new ro(l),u_trim_offset:new cl(l),u_trim_fade_range:new cl(l),u_trim_color:new bm(l),u_zbias_factor:new ro(l),u_tile_to_meter:new ro(l),u_ground_shadow_factor:new Wh(l),u_pattern_transition:new ro(l)}),i.dX=l=>({u_matrix:new Zh(l),u_pixels_to_tile_units:new Sm(l),u_device_pixel_ratio:new ro(l),u_width_scale:new ro(l),u_floor_width_scale:new ro(l),u_units_to_pixels:new cl(l),u_dash_image:new xm(l),u_gradient_image:new xm(l),u_image_height:new ro(l),u_texsize:new cl(l),u_tile_units_to_pixels:new ro(l),u_alpha_discard_threshold:new ro(l),u_trim_offset:new cl(l),u_trim_fade_range:new cl(l),u_trim_color:new bm(l),u_zbias_factor:new ro(l),u_tile_to_meter:new ro(l),u_ground_shadow_factor:new Wh(l)}),i.dY=l=>({u_camera_to_center_distance:new ro(l),u_extrude_scale:new Sm(l),u_device_pixel_ratio:new ro(l),u_matrix:new Zh(l),u_inv_rot_matrix:new Zh(l),u_merc_center:new cl(l),u_tile_id:new Wh(l),u_zoom_transition:new ro(l),u_up_dir:new Wh(l),u_emissive_strength:new ro(l)}),i.dZ=dm,i.d_=KZ,i.da=rt,i.db=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},i.dc=vj,i.dd=MA,i.de=Tj,i.df=tE,i.dg=function(l,r){return l.readFields(ZK,{icons:[]},r)},i.dh=Nb,i.di=Lm,i.dj=GA,i.dk=hp,i.dl=Bh,i.dm=id,i.dn=pp,i.dp=ht,i.dq=function(l){const r=l.indexOf(Au);return r>=0?l.slice(0,r):l},i.dr=function(l){return l.indexOf(Au)>=0},i.ds=function(l){const r=l.lastIndexOf(Au);return r>=0?l.slice(r+1):""},i.dt=function(l){const r=[],a=l.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},i.du=function(l,r,a,u){return l.type==="custom"?new $K(l,r):new WK[l.type](l,r,a,u)},i.dv=St,i.dw=function(l){const r=l.indexOf(Au);return r>=0?l.slice(r+1):""},i.dx=class extends af{constructor(l,r){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=r.target,this.namespace=r.namespace,r.properties&&(this.properties=r.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},i.dy=Jp,i.dz=hu,i.e=Jr,i.e$=Ke,i.e0=ik,i.e1=(l,r,a,u,h,g)=>{const y=l.transform,b=y.projection.name==="globe";let A;if(g.paint.get("circle-pitch-alignment")==="map")if(b){const R=ek(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;A=Float32Array.from([R,0,0,R])}else A=y.calculatePixelsToTileUnitsMatrix(a);else A=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(y.projection),u_matrix:l.translatePosMatrix(r.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:So.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:d7,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(b){C.u_inv_rot_matrix=u,C.u_merc_center=h,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=Od(y.zoom);const R=h[0]*Mt,k=h[1]*Mt;C.u_up_dir=y.projection.upVector(new Xn(0,0,0),R,k)}return C},i.e2=Bj,i.e3=_s,i.e4=(l,r,a,u,h,g,y,b,A,C)=>{const R=l.transform,k=R.pitch<15?Nj(.07,.7,ne((14-R.zoom)/5,0,1)):.07,L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Fj(l,r,a,u),u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:R.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:zj(r,R),u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_zbias_factor:k,u_tile_to_meter:oe(r.tileID.canonical,0),u_ground_shadow_factor:A,u_pattern_transition:C}},i.e5=(l,r,a,u,h,g,y,b,A,C)=>{const R=l.transform,k=R.calculatePixelsToTileUnitsMatrix(r),L=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",$=R.pitch<15?Nj(.07,.7,ne((14-R.zoom)/5,0,1)):.07;return{u_matrix:Fj(l,r,a,u),u_pixels_to_tile_units:k,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:b,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:$j(a)&&r.lineAtlasTexture?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zj(r,l.transform),u_alpha_discard_threshold:0,u_trim_offset:A,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:a.lut).toArray01(),u_zbias_factor:$,u_tile_to_meter:oe(r.tileID.canonical,0),u_ground_shadow_factor:C}},i.e6=Qe,i.e7=D_,i.e8=H,i.e9=_a,i.eA=function(l,r){var a=2*Math.acos(r[3]),u=Math.sin(a/2);return u>S?(l[0]=r[0]/u,l[1]=r[1]/u,l[2]=r[2]/u):(l[0]=1,l[1]=0,l[2]=0),a},i.eB=iE,i.eC=Gb,i.eD=Ub,i.eE=[1,1,1],i.eF=Bm,i.eG=co,i.eH=function(l,r,a,u){var h=r[0],g=r[1],y=r[2],b=r[3];return l[0]=h+u*(a[0]-h),l[1]=g+u*(a[1]-g),l[2]=y+u*(a[2]-y),l[3]=b+u*(a[3]-b),l},i.eI=Om,i.eJ=Js,i.eK=ll,i.eL=function(l,r,a,u,h,g,y,b,A,C,R,k,L,$,U,Z){var re=new E(16);return re[0]=l,re[1]=r,re[2]=a,re[3]=u,re[4]=h,re[5]=g,re[6]=y,re[7]=b,re[8]=A,re[9]=C,re[10]=R,re[11]=k,re[12]=L,re[13]=$,re[14]=U,re[15]=Z,re},i.eM=p,i.eN=Ad,i.eO=S_,i.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new mt(1/0,1/0),max:new mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,r=!1){const a=jk(new mt(0,0),new mt(Mt,Mt),l),u=[];if(r&&!uA(a,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!uA(a,h))continue;const g=B7(h.min,h.max,l);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(l){this._setSources(l.map(r=>({getSourceId:()=>r.cache.id,getFootprints:()=>{const a=[];for(const u of r.cache.getVisibleCoordinates()){const h=r.cache.getTile(u).buckets[r.layer];h&&h.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>r.order,getClipMask:()=>r.clipMask,getClipScope:()=>r.clipScope})))}_addSource(l){const r=l.getFootprints();if(r.length===0)return;const a=l.getOrder(),u=l.getClipMask(),h=l.getClipScope();for(const g of r){if(!g.footprint)continue;const y=jk(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:a,clipMask:u,clipScope:h})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((r,a)=>r.priority-a.priority||Rb(r.min,a.min)||Rb(r.max,a.max)||r.order-a.order||r.clipMask-a.clipMask||function(u,h){const g=(y,b)=>y+b;return u.length-h.length||u.reduce(g,"").localeCompare(h.reduce(g,""))}(r.clipScope,a.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let r=0;for(;!l&&r!==this._activeRegions.length;){const a=this._activeRegions[r],u=this._prevRegions[r];l=a.priority!==u.priority||!kk(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!qo(a.clipScope,u.clipScope),this._activeRegions[r].hiddenByOverlap=u.hiddenByOverlap,++r}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==$_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const r=a=>{const u=this._activeRegions;if(a>=u.length)return a;const h=u[a].priority;for(;a<u.length&&u[a].priority===h;)++a;return a};if(this._sourceIds.length>1){let a=0,u=r(a);for(;a!==u;){let h=a;const g=a;for(;h!==u;){const y=this._activeRegions[h];y.hiddenByOverlap=!1;for(let b=0;b<g;b++){const A=this._activeRegions[b];if(!A.hiddenByOverlap&&y.order===$_&&uA(y,A)&&(y.hiddenByOverlap=Dk(y.footprint,y.tileId,A.footprint,A.tileId),y.hiddenByOverlap))break}++h}a=u,u=r(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let r=l.length-1;r>=0;r--)this._addSource(l[r]);this._computeReplacement()}},i.eQ=$_,i.eR=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,r){const a=new Rc,u=new to,h=[],g=l+1+2,y=r[0]+1,b=r[0]+1+(1+r.length),A=(C,R,k)=>{let L=C===g-1?C-2:C===0?C:C-1;return L+=k?24575:0,[L,R]};for(let C=0;C<g;++C)a.emplaceBack(...A(C,0,!0));for(let C=0;C<y;++C)for(let R=0;R<g;++R)a.emplaceBack(...A(R,C,(R===0||R===g-1)&&!0));for(let C=0;C<r.length;++C){const R=r[C];for(let k=0;k<g;++k)a.emplaceBack(...A(k,R,!0))}for(let C=0;C<r.length;++C){const R=u.length,k=r[C]+1+2,L=new to;for(let Z=0;Z<k-1;Z++){const re=Z===k-2,te=re?g*(b-r.length+C-Z):g;for(let le=0;le<g-1;le++){const ue=Z*g+le;Z===0||re||le===0||le===g-2?(L.emplaceBack(ue+1,ue,ue+te),L.emplaceBack(ue+te,ue+te+1,ue+1)):(u.emplaceBack(ue+1,ue,ue+te),u.emplaceBack(ue+te,ue+te+1,ue+1))}}const $=_i.simpleSegment(0,R,a.length,u.length-R);for(let Z=0;Z<L.uint16.length;Z+=3)u.emplaceBack(L.uint16[Z],L.uint16[Z+1],L.uint16[Z+2]);const U=_i.simpleSegment(0,R,a.length,u.length-R);h.push({withoutSkirts:$,withSkirts:U})}return{vertices:a,indices:u,segments:h}}_createGrid(l){const r=this._fillGridMeshWithLods(Pd,k_);this._gridSegments=r.segments,this._gridBuffer=l.createVertexBuffer(r.vertices,Id.members),this._gridIndexBuffer=l.createIndexBuffer(r.indices,!0)}_createPoles(l){const r=new to;for(let y=0;y<=Pd;y++)r.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=l.createIndexBuffer(r,!0);const a=new Pu,u=new Pu,h=new Pu,g=new Pu;this._poleSegments=[];for(let y=0,b=0;y<pa;y++){const A=360/(1<<y);a.emplaceBack(0,-Xo,0,.5,0),u.emplaceBack(0,-Xo,0,.5,1),h.emplaceBack(0,-Xo,0,.5,.5),g.emplaceBack(0,-Xo,0,.5,.5);for(let C=0;C<=Pd;C++){let R=C/Pd,k=0;const L=xr(0,A,R),[$,U,Z]=Cu(c7,u7,L,Xo);a.emplaceBack($,U,Z,R,k),u.emplaceBack($,U,Z,R,1-k);const re=Zr(L);R=.5+.5*Math.sin(re),k=.5+.5*Math.cos(re),h.emplaceBack($,U,Z,R,k),g.emplaceBack($,U,Z,R,1-k)}this._poleSegments.push(_i.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,za,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,za,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(h,za,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(g,za,!1)}getGridBuffers(l,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,r){return[r?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,r?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},i.eS=Ok,i.eT=fh,i.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eV=We,i.eW=ae,i.eX=function(l,r,a){return l[0]=r[0]/a[0],l[1]=r[1]/a[1],l[2]=r[2]/a[2],l},i.eY=zs,i.eZ=Cd,i.e_=lr,i.ea=Db,i.eb=Yk,i.ec=Mu,i.ed=$k,i.ee=Bk,i.ef=Y,i.eg=function(l,r){if(l===r){var a=r[1],u=r[2],h=r[3],g=r[6],y=r[7],b=r[11];l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=a,l[6]=r[9],l[7]=r[13],l[8]=u,l[9]=g,l[11]=r[14],l[12]=h,l[13]=y,l[14]=b}else l[0]=r[0],l[1]=r[4],l[2]=r[8],l[3]=r[12],l[4]=r[1],l[5]=r[5],l[6]=r[9],l[7]=r[13],l[8]=r[2],l[9]=r[6],l[10]=r[10],l[11]=r[14],l[12]=r[3],l[13]=r[7],l[14]=r[11],l[15]=r[15];return l},i.eh=BK,i.ei=Kr,i.ej=A_,i.ek=256,i.el=Q2,i.em=Ys,i.en=se,i.eo=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[4],l[4]=r[5],l[5]=r[6],l[6]=r[8],l[7]=r[9],l[8]=r[10],l},i.ep=Pu,i.eq=Wx,i.er=w_,i.es=function(l,r,a,u,h){return ne((l-r)/(a-r)*(h-u)+u,u,h)},i.et=qs,i.eu=function(l,r){var a=r[0],u=r[1],h=r[2],g=r[3],y=r[4],b=r[5],A=r[6],C=r[7],R=r[8],k=R*y-b*C,L=-R*g+b*A,$=C*g-y*A,U=a*k+u*L+h*$;return U?(l[0]=k*(U=1/U),l[1]=(-R*u+h*C)*U,l[2]=(b*u-h*y)*U,l[3]=L*U,l[4]=(R*a-h*A)*U,l[5]=(-b*a+h*g)*U,l[6]=$*U,l[7]=(-C*a+u*A)*U,l[8]=(y*a-u*g)*U,l):null},i.ev=2,i.ew=an,i.ex=is,i.ey=je,i.ez=function(l,r){var a=new E(3);je(a,r);var u=1/a[0],h=1/a[1],g=1/a[2],y=r[0]*u,b=r[1]*h,A=r[2]*g,C=r[4]*u,R=r[5]*h,k=r[6]*g,L=r[8]*u,$=r[9]*h,U=r[10]*g,Z=y+R+U,re=0;return Z>0?(re=2*Math.sqrt(Z+1),l[3]=.25*re,l[0]=(k-$)/re,l[1]=(L-A)/re,l[2]=(b-C)/re):y>R&&y>U?(re=2*Math.sqrt(1+y-R-U),l[3]=(k-$)/re,l[0]=.25*re,l[1]=(b+C)/re,l[2]=(L+A)/re):R>U?(re=2*Math.sqrt(1+R-y-U),l[3]=(L-A)/re,l[0]=(b+C)/re,l[1]=.25*re,l[2]=(k+$)/re):(re=2*Math.sqrt(1+U-y-R),l[3]=(b-C)/re,l[0]=(L+A)/re,l[1]=(k+$)/re,l[2]=.25*re),l},i.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(r,a)=>String.fromCharCode(+("0x"+a))))},i.f0=function([l,r,a]){const u=Math.hypot(l,r,a),h=Math.atan2(l,a),g=.5*Math.PI-Math.acos(-r/u);return new c(os(h),os(g))},i.f1=wo,i.f2=AA,i.f3=function(l){const r=l.navigator?l.navigator.userAgent:null;return!!function(a){if(Wi==null){const u=a.navigator?a.navigator.userAgent:null;Wi=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Wi}(l)&&!(!r||!(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f4=function(l,r){lp=l,cp=r},i.f5=tA,i.f6=rk,i.f7=function(l){const r=[0,0,0],a=V(new Float64Array(16));return Q(a,l.pixelMatrix,l.globeMatrix),zr(r,r,a),new mt(r[0],r[1])},i.f8=function(){const l=q_;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(gA),q_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f9=function(){Nb().acquire(gA)},i.fA=g1,i.fB=Ne,i.fC=function(l){let r=0;if(new Uint32Array(l,0,1)[0]!==pj){const a=new Uint32Array(l,0,7),[,,u,h,g,y]=a;r=a.byteLength+h+g+y+g,(u!==l.byteLength||r>=l.byteLength)&&Ut("Invalid b3dm header information.")}return _j(l,r)},i.fD=function(l,r){const a=MA(l);for(const u of a){for(const h of u.meshes)yZ(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(_Z(u.lights,r)))}return a},i.fE=u1,i.fF=dn,i.fG=cj,i.fH=Ll,i.fI=$s,i.fJ=function(l){Oa(),Ja?.then(r=>{r.keys().then(a=>{for(let u=0;u<a.length-l;u++)r.delete(a[u]).catch(h=>Ut(h.message))}).catch(a=>Ut(a.message))}).catch(r=>Ut(r.message))},i.fa=$h,i.fb=function(l,r,a=!1){if(xs===$s.deferred||xs===$s.loading||xs===$s.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Dl=So.resolveURL(l),xs=$s.deferred,h_=r,Yp(),a||ib()},i.fc=function(l){Cm=So.resolveURL(l),Im||(Im=new Pm(Nb(),new fu)),Im.broadcast("setMeshoptUrl",Cm)},i.fd=hj,i.fe=function(l){vA=So.resolveURL(l),Im||(Im=new Pm(Nb(),new fu)),Im.broadcast("setDracoUrl",vA)},i.ff=dj,i.fg=W_,i.fh=function(l){const r=Ma();if(!r)return;const a=r.delete(ap);l&&a.then(()=>l()).catch(l)},i.fi=tf,i.fj=Yt,i.fk=Rd,i.fl=ql,i.fm=OL,i.fn=RL,i.fo=kj,i.fp=st,i.fq="hd_road_elevation",i.fr=Pn,i.fs=Je,i.ft=Iu,i.fu=UA,i.fv=of,i.fw=function(l,r,a,u,h,g,y,b=1,A,C,R){l.createArrays(),l.tilePixelRatio=Mt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const k=l.layers[0].layout,L=l.layers[0]._unevaluatedLayout._values,$={};$.scaleFactor=b,$.textSizeScaleRange=k.get("text-size-scale-range"),$.iconSizeScaleRange=k.get("icon-size-scale-range");const[U,Z]=$.textSizeScaleRange,[re,te]=$.iconSizeScaleRange;$.textScaleFactor=ne($.scaleFactor,U,Z),$.iconScaleFactor=ne($.scaleFactor,re,te);const le=L["text-size"],ue=L["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:De,maxZoom:nt}=l.textSizeData;$.compositeTextSizes=[le.possiblyEvaluate(new si(De,{worldview:R}),g),le.possiblyEvaluate(new si(nt,{worldview:R}),g)]}if(l.iconSizeData.kind==="composite"){const{minZoom:De,maxZoom:nt}=l.iconSizeData;$.compositeIconSizes=[ue.possiblyEvaluate(new si(De,{worldview:R}),g),ue.possiblyEvaluate(new si(nt,{worldview:R}),g)]}$.layoutTextSize=le.possiblyEvaluate(new si(y+1,{worldview:R}),g),$.layoutIconSize=ue.possiblyEvaluate(new si(y+1,{worldview:R}),g),$.textMaxSize=le.possiblyEvaluate(new si(18,{worldview:R}),g);const pe=k.get("symbol-placement"),Se=k.get("text-rotation-alignment")==="map"&&pe!=="point",_e=k.get("text-size");let Ee=!1;const Me=[];for(const De of l.features){const nt=k.get("text-font").evaluate(De,{},g).join(","),Ve=_e.evaluate(De,{},g)*$.textScaleFactor,lt=$.layoutTextSize.evaluate(De,{},g)*$.textScaleFactor,ft=$.layoutIconSize.evaluate(De,{},g)*$.iconScaleFactor,pt={horizontal:{},vertical:void 0},xt=De.text;let wt,yt=[0,0];if(xt){const Dr=xt.toString(),Un=k.get("text-letter-spacing").evaluate(De,{},g)*Ao,ve=k.get("text-line-height").evaluate(De,{},g)*Ao,Te=u_(Dr)?Un:0,ct=k.get("text-anchor").evaluate(De,{},g),bt=k.get("text-variable-anchor");if(!bt){const Rr=k.get("text-radial-offset").evaluate(De,{},g);if(Rr)yt=mD(ct,[Rr*Ao,WA]);else{const Vr=k.get("text-offset").evaluate(De,{},g);yt=[Vr[0]*Ao,Vr[1]*Ao]}}let jt=Se?"center":k.get("text-justify").evaluate(De,{},g);const Dt=pe==="point",sr=Dt?k.get("text-max-width").evaluate(De,{},g)*Ao:1/0,ur=Rr=>{l.allowVerticalPlacement&&Fh(Dr)&&(pt.vertical=zA(xt,r,a,h,nt,sr,ve,ct,Rr,Te,yt,ta.vertical,!0,lt,Ve,A))};if(!Se&&bt){const Rr=jt==="auto"?bt.map(Gr=>qA(Gr)):[jt];let Vr=!1;for(let Gr=0;Gr<Rr.length;Gr++){const Xr=Rr[Gr];if(!pt.horizontal[Xr])if(Vr)pt.horizontal[Xr]=pt.horizontal[0];else{const _r=zA(xt,r,a,h,nt,sr,ve,"center",Xr,Te,yt,ta.horizontal,!1,lt,Ve,A);_r&&(pt.horizontal[Xr]=_r,Vr=_r.positionedLines.length===1)}}ur("left")}else{if(jt==="auto"&&(jt=qA(ct)),Dt||k.get("text-writing-mode").indexOf("horizontal")>=0||!Fh(Dr)){const Rr=zA(xt,r,a,h,nt,sr,ve,ct,jt,Te,yt,ta.horizontal,!1,lt,Ve,A);Rr&&(pt.horizontal[jt]=Rr)}ur(Dt?"left":jt)}}let _t,at,ot,vt,Ot,Et,or=!1;const Ft=k.get("icon-text-fit").evaluate(De,{},g);if(De.icon&&De.icon.hasPrimary()){const Dr=nv(De.icon,l.iconSizeData,L["icon-size"],g,l.zoom,De,A,$.iconScaleFactor,R);_t=Dr.iconPrimary,ot=Dr.iconSecondary;const Un=_t.toString();if(at=u.get(Un),at&&(Ot=k.get("icon-offset").evaluate(De,{},g),Et=k.get("icon-anchor").evaluate(De,{},g),wt=Kb(h.get(Un),ot?h.get(ot.toString()):void 0,Ot,Et),or=at.sdf,l.sdfIcons===void 0?l.sdfIcons=at.sdf:l.sdfIcons!==at.sdf&&Ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==l.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),ot){const ve=ot.toString();vt=u.get(ve)}}Ee=Ee||!(!De.icon||!De.icon.hasSecondary());const Ht=e1(pt.horizontal)||pt.vertical;l.iconsInText||(l.iconsInText=!!Ht&&Ht.iconsInText);const Qt=lt*$.textScaleFactor/Ao,{defaultShapedIcon:Hr,verticallyShapedIcon:Pt}=EK(l,wt,k,De,g,pt,Qt,Ot,Ft);Ft!=="none"&&wt&&(eD(wt)||tD(wt))&&(Qb(0,at,_t,wt,Hr,Ft,C,u,h),Qb(0,vt,ot,wt,Hr,Ft,C,u,h),Pt&&(Qb(0,at,_t,wt,Pt,Ft,C,u,h),Qb(0,vt,ot,wt,Pt,Ft,C,u,h))),wt=Hr;const{iconBBox:er,iconVerticalBBox:Cr,textBBox:en,textVerticalBBox:sn}=bK(l,wt,Pt,k,De,g,ft,Ot,$,h,Et,pt,lt,yt);Me.push({feature:De,shapedTextOrientations:pt,shapedText:Ht,shapedIcon:wt,iconPrimary:_t,iconSecondary:ot,iconOffset:Ot,iconAnchor:Et,verticallyShapedIcon:Pt,layoutTextSize:lt,layoutIconSize:ft,textOffset:yt,isSDFIcon:or,iconTextFit:Ft,iconCollisionBounds:er,iconVerticalCollisionBounds:Cr,textCollisionBounds:en,textVerticalCollisionBounds:sn})}return{featureData:Me,sizes:$,hasAnySecondaryIcon:Ee,textAlongLine:Se,symbolPlacement:pe}},i.fx=cD,i.fy=function(l,r,a,u,h,g,y,b,A,C){l.iconAtlasPositions=C.iconPositions;const{featureData:R,hasAnySecondaryIcon:k,sizes:L,textAlongLine:$,symbolPlacement:U}=r;for(const Z of R){const{shapedIcon:re,verticallyShapedIcon:te,feature:le,shapedTextOrientations:ue,shapedText:pe,layoutTextSize:Se,textOffset:_e,isSDFIcon:Ee,iconPrimary:Me,iconSecondary:De,iconTextFit:nt,iconOffset:Ve,iconCollisionBounds:lt,iconVerticalCollisionBounds:ft,textCollisionBounds:pt}=Z;yD(re,C.iconPositions,Me,De),yD(te,C.iconPositions,Me,De),AK(ue,C.iconPositions),TK(Me,De,C.iconPositions),(pe||re)&&PK(l,le,ue,re,te,A,L,Se,0,_e,Ee,u,h,y,b,k,nt,Ve,$,U,lt,ft,pt)}a&&l.generateCollisionDebugBuffers(g,l.collisionBoxArray,L.textScaleFactor)},i.fz=Ze,i.g=function(l,r){return hu(Object.assign(l,{method:"GET"}),r)},i.h=function(l){return l.indexOf("mapbox:")===0},i.i=function(l){return Jr.API_STYLE_REGEX.test(l)&&!Go(l)},i.j=Ri,i.k=Qa,i.l=function(l){return decodeURIComponent(atob(l).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(l,r){return hu(Object.assign(l,{type:"json"}),r)},i.n=fp,i.o=So,i.p=function(l,r){return hu(Object.assign(l,{method:"POST"}),r)},i.q=Qo,i.r=Ya,i.s=function(l){try{const r=self[l];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return yA||(yA=new tf("ImageRasterizer")),yA},i.u=function(){return function l(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},i.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},i.w=Ut,i.x=uE,i.y=vh,i.z=el}),f(["./shared"],function(i){function S(We){const ne=We?We.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function E(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let ce="[";for(const ge of We)ce+=`${E(ge)},`;return`${ce}]`}let ne="{";for(const ce of Object.keys(We).sort())ne+=`${ce}:${E(We[ce])},`;return`${ne}}`}function I(We){let ne="";for(const ce of i.bx)ne+=`/${E(We[ce])}`;return ne}class M{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ce){this._layerConfigs={},this._layers={},this.update(ne,[],ce)}update(ne,ce,ge){this._options=ge;for(const Ie of ne)this._layerConfigs[Ie.id]=Ie,(this._layers[Ie.id]=i.du(Ie,this.scope,null,this._options)).compileFilter(ge),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id];for(const Ie of ce)delete this.keyCache[Ie],delete this._layerConfigs[Ie],delete this._layers[Ie];this.familiesBySource={};const Re=function(Ie,Fe){const Qe={};for(let Je=0;Je<Ie.length;Je++){const St=Ie[Je];let ht=Fe&&Fe[St.id];ht||(St.type==="symbol"?ht=St.id:(ht=I(St),St.type==="line"&&St.paint&&function dr(Ut){return typeof Ut=="string"&&Ut==="line-progress"||(Array.isArray(Ut)?Ut.some(dr):!(!Ut||typeof Ut!="object")&&Object.values(Ut).some(dr))}(St.paint["line-width"])&&(ht+=`/${E(St.paint["line-width"])}`))),Fe&&(Fe[St.id]=ht);let Kt=Qe[ht];Kt||(Kt=Qe[ht]=[]),Kt.push(St)}const Ue=[];for(const Je in Qe)Ue.push(Qe[Je]);return Ue}(Object.values(this._layerConfigs),this.keyCache);for(const Ie of Re){const Fe=Ie.map(Kt=>this._layers[Kt.id]),Qe=Fe[0];if(Qe.visibility==="none")continue;const Ue=Qe.source||"";let Je=this.familiesBySource[Ue];Je||(Je=this.familiesBySource[Ue]={});const St=Qe.sourceLayer||"_geojsonTileLayer";let ht=Je[St];ht||(ht=Je[St]=[]),ht.push(Fe)}}}const j=1*i.fl;class N{constructor(ne){const ce={},ge=[];for(const Qe in ne){const Ue=ne[Qe],Je=ce[Qe]={};for(const St in Ue.glyphs){const ht=Ue.glyphs[+St];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const Kt=ht.metrics.localGlyph?j:1,dr={x:0,y:0,w:ht.bitmap.width+2*Kt,h:ht.bitmap.height+2*Kt};ge.push(dr),Je[St]=dr}}const{w:Re,h:Ie}=i.G(ge),Fe=new i.fk({width:Re||1,height:Ie||1});for(const Qe in ne){const Ue=ne[Qe];for(const Je in Ue.glyphs){const St=Ue.glyphs[+Je];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const ht=ce[Qe][Je],Kt=St.metrics.localGlyph?j:1;i.fk.copy(St.bitmap,Fe,{x:0,y:0},{x:ht.x+Kt,y:ht.y+Kt},St.bitmap)}}this.image=Fe,this.positions=ce}}function G(We,ne,ce){We[ne]?ce&&(We[ne].center=ce):We[ne]={floorIds:new Set,center:ce||[0,0],floors:{}}}function z(We,ne,ce,ge){for(const Re of ne)G(We,Re),We[Re].floors[ce]=ge,We[Re].floorIds.add(ce)}function V(We){return{id:We.properties.id.toString(),center:We.properties.center.toString().split(";").map(Number)}}function K(We){return{id:We.properties.id.toString(),isDefault:!!We.properties.is_default&&We.properties.is_default,connections:We.properties.connected_floor_ids?new Set(We.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:We.properties.conflicted_floor_ids?new Set(We.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:We.properties.building_ids?new Set(We.properties.building_ids.toString().split(";")):new Set,name:We.properties.name.toString(),zIndex:We.properties.z_index}}function Q(We,ne){return ne.every(ce=>We.properties&&We.properties[ce]!=null)}function X(We){return Q(We,["type","id","name"])&&We.properties.type==="building"}function ie(We){return Q(We,["type","id","name","z_index"])&&We.properties.type==="floor"}i.fj(N,"GlyphAtlas");class J{constructor(ne){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview,this.indoor=ne.indoor}parse(ne,ce,ge,Re,Ie,Fe){this.status="parsing",this.data=ne,this.collisionBoxArray=new i.b3;const Qe=new i.fm(Object.keys(ne.layers).sort()),Ue=new i.fn(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Je={},St=new i.fo(256,256),ht={featureIndex:Ue,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:St,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Fr=this.indoor.indoorState.activeFloorsVisible,Lr=function(jr,dn,Ei){const Wi=function(wi,gn){if(!wi)return i.w("No source layers defined in indoor specification"),gn;if(wi.size===0)return gn;const Si=wi.difference(gn);for(const ti of Si)i.w(`Missing source layer required in indoor specification: ${ti}`);return gn.intersection(gn)}(dn.sourceLayers,new Set(Object.keys(jr.layers))),Oi=dn.indoorState,Ji=function(wi,gn,Si,ti){const Jr=new Set,Ri=new Set,Go=new Set,Zo=new Map,Cs={},lu=Mo=>{const Zs=Zo.get(Mo)||new Set;for(const ss of Jr)if((Zo.get(ss)||new Set).has(Mo)||Zs.has(ss))return!0;return!1};for(const Mo of gn){const Zs=wi.layers[Mo];if(Zs)for(let ss=0;ss<Zs.length;ss++){const Ya=Zs.feature(ss);if(X(Ya)){const{id:So,center:cu}=V(Ya);G(Cs,So,cu),Jr.add(So)}else if(ie(Ya)){const{id:So,isDefault:cu,connections:id,conflicts:ap,buildings:lp,name:cp,zIndex:ph}=K(Ya);z(Cs,lp,So,{name:cp,zIndex:ph}),Zo.set(So,ap),(So===ti||id.has(ti))&&Jr.add(So),Ri.add(So),cu&&Go.add(So)}}else i.w(`indoor source layer not found: ${Mo}`)}if(Si)for(const Mo of Si)Ri.has(Mo)&&(lu(Mo)||Jr.add(Mo));for(const Mo of Go)Jr.has(Mo)||lu(Mo)||Jr.add(Mo);return{buildings:Cs,activeFloors:Jr}}(jr,Wi,Oi.lastActiveFloors,Oi.selectedFloorId);return Ei.send("setIndoorData",Ji),Ji}(ne,this.indoor,Ie);ht.activeFloors=Fr?Lr.activeFloors:void 0}const Kt=[],dr=ce.familiesBySource[this.source];for(const Fr in dr){const Lr=ne.layers[Fr];if(!Lr)continue;let jr=!1,dn=!1,Ei=!1;for(const gn of dr[Fr])gn[0].type==="symbol"?jr=!0:dn=!0,gn[0].is3D()&&gn[0].type!=="model"&&(Ei=!0);if(this.extraShadowCaster&&!Ei||this.isSymbolTile===!0&&!jr||this.isSymbolTile===!1&&!dn)continue;Lr.version===1&&i.w(`Vector tile source "${this.source}" layer "${Fr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wi=Qe.encode(Fr),Oi=[],Ji=this.localizableLayerIds&&this.localizableLayerIds.has(Fr);let wi=!1;for(let gn=0,Si=0;gn<Lr.length;gn++){const ti=Lr.feature(gn),Jr=Ue.getId(ti,Fr),Ri=ti.properties?ti.properties.worldview:null;if(Ji&&this.worldview&&typeof Ri=="string")if(Ri==="all")ti.properties.$localized=!0;else{if(!Ri.split(",").includes(this.worldview))continue;ti.properties.$localized=!0,ti.properties.worldview=this.worldview}!wi&&ti.properties&&ti.properties.hasOwnProperty(i.fp)&&(wi=!0),Oi.push({feature:ti,id:Jr,index:Si,sourceLayerIndex:Wi}),Si++}wi&&!ht.elevationFeatures&&ne.layers.hasOwnProperty(i.fq)&&(ht.elevationFeatures=i.fr.parseFrom(ne.layers[i.fq],this.canonical));for(const gn of dr[Fr]){const Si=gn[0];if(this.extraShadowCaster&&(!Si.is3D()||Si.type==="model")||this.isSymbolTile!==void 0&&Si.type==="symbol"!==this.isSymbolTile||Si.minzoom&&this.zoom<Math.floor(Si.minzoom)||Si.maxzoom&&this.zoom>=Si.maxzoom||Si.visibility==="none")continue;se(gn,this.zoom,ht.brightness,ge,this.worldview);const ti=Je[Si.id]=Si.createBucket({index:Ue.bucketLayerIDs.length,layers:gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Re,worldview:this.worldview,localizable:Ji});Ue.bucketLayerIDs.push(gn.map(Ri=>i.B(Ri.id,Ri.scope)));let Jr=ti.prepare?ti.prepare():null;Jr!=null?(Jr=Jr.then(()=>ti.populate(Oi,ht,this.tileID.canonical,this.tileTransform)),Kt.push(Jr)):ti.populate(Oi,ht,this.tileID.canonical,this.tileTransform)}}const Ut=()=>{let Fr,Lr,jr,dn,Ei,Wi;St.trim();const Oi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ji=()=>{if(Fr)return this.status="done",Fe(Fr);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(Je).filter(gn=>!gn.isEmpty()),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ht.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Lr&&jr&&dn){const gn=new N(Lr),Si=new Map;for(const[Ri,Go]of jr.entries()){const{imagePosition:Zo}=i.fu(Ri,Go,i.fv);Si.set(Ri,Zo)}const ti={};for(const Ri in Je){const Go=Je[Ri];Go instanceof i.b4&&(se(Go.layers,this.zoom,ht.brightness,ge,this.worldview),ti[Ri]=i.fw(Go,Lr,gn.positions,jr,Si,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Ei,this.worldview))}const Jr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ie,jr,Ei,()=>{Jr.iconsPending=!1,wi(ti,gn,Jr)}),this.rasterizeIfNeeded(Ie,dn,Wi,()=>{Jr.patternsPending=!1,wi(ti,gn,Jr)})}},wi=(gn,Si,ti,Jr)=>{if(ti.iconsPending||ti.patternsPending)return;const Ri=new i.fx(jr,dn,this.lut);for(const Go in Je){const Zo=Je[Go];if(Go in gn)i.fy(Zo,gn[Go],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,jr,Ri);else if(Zo.hasPattern&&(Zo instanceof i.ba||Zo instanceof i.bb||Zo instanceof i.ea)){se(Zo.layers,this.zoom,ht.brightness,ge,this.worldview);const Cs=Object.fromEntries(Ri.patternPositions);Zo.addFeatures(ht,this.tileID.canonical,Cs,ge,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(Je).filter(Go=>!Go.isEmpty()),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Si.image,lineAtlas:St,imageAtlas:Ri,brightness:ht.brightness})};if(!this.extraShadowCaster){const gn=i.fs(ht.glyphDependencies,Jr=>Object.keys(Jr).map(Number));Object.keys(gn).length?Ie.send("getGlyphs",{uid:this.uid,stacks:gn},(Jr,Ri)=>{Fr||(Fr=Jr,Lr=Ri,Ji())},void 0,!1,Oi):Lr={};const Si=Array.from(ht.iconDependencies.keys()).map(Jr=>i.I.parse(Jr));Si.length?Ie.send("getImages",{images:Si,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Jr,Ri)=>{Fr||(Fr=Jr,jr=new Map,Ei=this.updateImageMapAndGetImageTaskQueue(jr,Ri,ht.iconDependencies),Ji())},void 0,!1,Oi):(jr=new Map,Ei=new Map);const ti=Array.from(ht.patternDependencies.keys()).map(Jr=>i.I.parse(Jr));ti.length?Ie.send("getImages",{images:ti,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Jr,Ri)=>{Fr||(Fr=Jr,dn=new Map,Wi=this.updateImageMapAndGetImageTaskQueue(dn,Ri,ht.patternDependencies),Ji())},void 0,!1,Oi):(dn=new Map,Wi=new Map)}if(ht.elevationFeatures&&ht.elevationFeatures.length>0){const gn=[];for(const ti of Object.values(Je))if(ti instanceof i.bb){const Jr=ti.getUnevaluatedPortalGraph();Jr&&gn.push(Jr)}const Si=i.ft.evaluate(gn);for(const ti of Object.values(Je))if(ti instanceof i.bb){const Jr=ne.layers[Qe.decode(ti.sourceLayerIndex)];ti.setEvaluatedPortalGraph(Si,Jr,this.tileID.canonical,ht.availableImages,ht.brightness)}}Ji()};Kt.length>0?Promise.allSettled(Kt).then(Ut).catch(Fe):Ut()}updateParameters(ne){this.scaleFactor=ne.scaleFactor,this.showCollisionBoxes=ne.showCollisionBoxes,this.projection=ne.projection,this.brightness=ne.brightness,this.tileTransform=i.aZ(ne.tileID.canonical,ne.projection),this.extraShadowCaster=ne.extraShadowCaster,this.lut=ne.lut,this.worldview=ne.worldview,this.indoor=ne.indoor}rasterizeIfNeeded(ne,ce,ge,Re){Array.from(ce.values()).some(Ie=>Ie.usvg)?this.rasterize(ne,ce,ge,Re):Re()}updateImageMapAndGetImageTaskQueue(ne,ce,ge){const Re=new Map;for(const Ie of ce.keys()){const Fe=ge.get(Ie)||[];for(const Qe of Fe){const Ue=Qe.toString(),Je=ce.get(Qe.id.toString());Je.usvg?Re.has(Ue)||(Re.set(Ue,Qe),ne.set(Ue,Object.assign({},Je))):ne.set(Ue,Je)}}return Re}rasterize(ne,ce,ge,Re){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:ge},(Ie,Fe)=>{if(!Ie)for(const[Qe,Ue]of Fe.entries()){const Je=Object.assign(ce.get(Qe),{data:Ue});ce.set(Qe,Je)}Re()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function se(We,ne,ce,ge,Re){const Ie=new i.ac(ne,{brightness:ce,worldview:Re});for(const Fe of We)Fe.recalculate(Ie,ge)}class he extends i.E{constructor(ne,ce,ge,Re,Ie,Fe,Qe){super(),this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.availableModels=Re,this.loadVectorData=Fe||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(ne.scheduler),this.isSpriteLoaded=Ie,this.scheduler=ne.scheduler,this.brightness=Qe}loadTile(ne,ce){const ge=ne.uid,Re=ne&&ne.request,Ie=Re&&Re.collectResourceTiming,Fe=this.loading[ge]=new J(ne);Fe.abort=this.loadVectorData(ne,(Qe,Ue)=>{const Je=!this.loading[ge];if(delete this.loading[ge],Fe.cancelRasterize(),Je||Qe||!Ue)return Fe.status="done",Je||(this.loaded[ge]=Fe),ce(Qe);const St=Ue.rawData,ht={},Kt=i.aM(Ue.responseHeaders);Kt&&Kt.expires&&(ht.expires=Kt.expires),Kt&&Kt.cacheControl&&(ht.cacheControl=Kt.cacheControl),Fe.vectorTile=Ue.vectorTile||new i.fz(new i.bt(St));const dr=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ut,Fr)=>{if(Ut||!Fr)return ce(Ut);const Lr={};if(Ie){const jr=S(Re);jr.length>0&&(Lr.resourceTiming=JSON.parse(JSON.stringify(jr)))}ce(null,Object.assign({rawTileData:St.slice(0),responseHeaders:Ue.responseHeaders},Fr,ht,Lr))})};this.isSpriteLoaded?dr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(dr,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):dr()}),this.loaded=this.loaded||{},this.loaded[ge]=Fe})}reloadTile(ne,ce){const ge=this.loaded,Re=ne.uid;if(ge&&ge[Re]){const Ie=ge[Re];Ie.updateParameters(ne);const Fe=(Qe,Ue)=>{const Je=Ie.reloadCallback;Je&&(delete Ie.reloadCallback,Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Je)),ce(Qe,Ue)};Ie.status==="parsing"?Ie.reloadCallback=Fe:Ie.status==="done"&&(Ie.vectorTile?Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else ce(null,void 0)}abortTile(ne,ce){const ge=ne.uid,Re=this.loading[ge];Re&&(Re.abort&&Re.abort(),delete this.loading[ge]),ce()}removeTile(ne,ce){const ge=this.loaded,Re=ne.uid;ge&&ge[Re]&&delete ge[Re],ce()}}class we{loadTile(ne,ce){const{uid:ge,encoding:Re,rawImageData:Ie,padding:Fe}=ne,Qe=ImageBitmap&&Ie instanceof ImageBitmap?this.getImageData(Ie,Fe):Ie;ce(null,new i.fA(ge,Qe,Re,Fe<1))}reloadTile(ne,ce){ce(null,null)}abortTile(ne,ce){ce()}removeTile(ne,ce){ce()}getImageData(ne,ce){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const ge=this.offscreenCanvasContext.getImageData(-ce,-ce,ne.width+2*ce,ne.height+2*ce);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}i.bs.setPbf(i.bt);class ze{constructor(ne){this._mrt=new i.bs(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ce){const ge=this._mrt;this.status="parsing",this._entireBuffer=ne;try{ge.parseHeader(ne),this._isHeaderLoaded=!0;const Re=[];for(const Ie in ge.layers){const Fe=ge.getLayer(Ie),Qe=Fe.getDataRange(Fe.getBandList()),Ue=ge.createDecodingTask(Qe),Je=ne.slice(Qe.firstByte,Qe.lastByte+1),St=i.bs.performDecoding(Je,Ue).then(ht=>Ue.complete(null,ht)).catch(ht=>Ue.complete(ht,null));Re.push(St)}Promise.allSettled(Re).then(()=>ce(null,ge)).catch(Ie=>ce(Ie))}catch(Re){ce(Re)}}}class je{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ce){const ge=ne.uid,Re=ne.request,Ie=this.loading[ge]=new ze(ne),{cancel:Fe}=i.bu(Re,(Qe,Ue,Je)=>{const St=!this.loading[ge];if(delete this.loading[ge],St||Qe||!Ue)return Ie.status="done",St||(this.loaded[ge]=Ie),ce(Qe);Ie.parse(Ue,(ht,Kt)=>{if(ht||!Kt)return ce(ht);ce(null,Kt,Je)}),this.loaded[ge]=Ie});Ie.abort=Fe}reloadTile(ne,ce){ce(null,void 0)}abortTile(ne,ce){const ge=ne.uid,Re=this.loading[ge];Re&&(Re.abort&&Re.abort(),delete this.loading[ge]),ce()}removeTile(ne,ce){const ge=ne.uid;this.loaded[ge]&&delete this.loaded[ge],ce()}decodeRasterArray(ne,ce){i.bs.performDecoding(ne.buffer,ne.task).then(ge=>ce(null,ge)).catch(ge=>ce(ge))}}const Oe=i.fB.prototype.toGeoJSON;class Be{constructor(ne){this._feature=ne,this.extent=i.al,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ce of this._feature.geometry)ne.push([new i.P(ce[0],ce[1])]);return ne}{const ne=[];for(const ce of this._feature.geometry){const ge=[];for(const Re of ce)ge.push(new i.P(Re[0],Re[1]));ne.push(ge)}return ne}}toGeoJSON(ne,ce,ge){return Oe.call(this,ne,ce,ge)}}class qe{constructor(ne,ce){this.name=ne,this.extent=i.al,this.length=ce.length,this._jsonFeatures=ce}feature(ne){return new Be(this._jsonFeatures[ne])}}class Xe{constructor(ne){this.layers={},this.extent=i.al;for(const ce of Object.keys(ne))this.layers[ce]=new qe(ce,ne[ce])}}const it=64/4096,Ge=128;class Ke{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ce){for(const ge of ne){const Re=ge.id;if(Re==null)continue;let Ie=this.features.get(Re);Ie&&this.updateCache(Ie,ce),ge.geometry?(Ie=rt(ge),this.updateCache(Ie,ce),this.features.set(Re,Ie)):this.features.delete(Re),this.updateCache(Ie,ce)}}updateCache(ne,ce){for(const{canonical:ge,uid:Re}of Object.values(ce)){const{z:Ie,x:Fe,y:Qe}=ge;ut(ne,Math.pow(2,Ie),Fe,Qe)&&delete ce[Re]}}getTile(ne,ce,ge){const Re=Math.pow(2,ne),Ie=[];for(const Fe of this.features.values())ut(Fe,Re,ce,ge)&&Ie.push($t(Fe,Re,ce,ge));return{features:Ie}}getFeatures(){return[...this.features.values()]}}function ut({minX:We,minY:ne,maxX:ce,maxY:ge},Re,Ie,Fe){return We<(Ie+1+it)/Re&&ne<(Fe+1+it)/Re&&ce>(Ie-it)/Re&&ge>(Fe-it)/Re}function rt(We){const{id:ne,geometry:ce,properties:ge}=We;if(!ce)return;if(ce.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Ie}=ce,Fe={id:ne,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Qe=Fe.geometry;if(Re==="Point")Xt(Ie,Qe,Fe);else if(Re==="MultiPoint")for(const Ue of Ie)Xt(Ue,Qe,Fe);else if(Re==="LineString")Fe.type=2,cr(Ie,Qe,Fe);else if(Re==="MultiLineString")Fe.type=2,Bt(Ie,Qe,Fe);else if(Re==="Polygon")Fe.type=3,Bt(Ie,Qe,Fe,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const Ue of Ie)Bt(Ue,Qe,Fe,!0)}return Fe}function Xt([We,ne],ce,ge){const Re=i.aF(We);let Ie=i.aJ(ne);Ie=Ie<0?0:Ie>1?1:Ie,ce.push(Re,Ie),ge.minX=Math.min(ge.minX,Re),ge.minY=Math.min(ge.minY,Ie),ge.maxX=Math.max(ge.maxX,Re),ge.maxY=Math.max(ge.maxY,Ie)}function cr(We,ne,ce,ge=!1,Re=!1){const Ie=[];for(const Fe of We)Xt(Fe,Ie,ce);ne.push(Ie),ge&&function(Fe,Qe){let Ue=0;for(let Je=0,St=Fe.length,ht=St-2;Je<St;ht=Je,Je+=2)Ue+=(Fe[Je]-Fe[ht])*(Fe[Je+1]+Fe[ht+1]);if(Ue>0===Qe)for(let Je=0,St=Fe.length;Je<St/2;Je+=2){const ht=Fe[Je],Kt=Fe[Je+1];Fe[Je]=Fe[St-2-Je],Fe[Je+1]=Fe[St-1-Je],Fe[St-2-Je]=ht,Fe[St-1-Je]=Kt}}(Ie,Re)}function Bt(We,ne,ce,ge=!1){for(let Re=0;Re<We.length;Re++)cr(We[Re],ne,ce,ge,Re===0)}function $t(We,ne,ce,ge){const{id:Re,type:Ie,geometry:Fe,tags:Qe}=We,Ue=[];if(Ie===1)(function(Je,St,ht,Kt,dr){for(let Ut=0;Ut<Je.length;Ut+=2){const Fr=Math.round(i.al*(Je[Ut+0]*St-ht)),Lr=Math.round(i.al*(Je[Ut+1]*St-Kt));dr.push([Fr,Lr])}})(Fe,ne,ce,ge,Ue);else if(Ie===2)for(const Je of Fe)br(Je,ne,ce,ge,Ue);else if(Ie===3)for(const Je of Fe)nn(Je,ne,ce,ge,Ue);return{id:Re,type:Ie,geometry:Ue,tags:Qe}}function br(We,ne,ce,ge,Re){const Ie=-Ge,Fe=i.al+Ge;let Qe;for(let Ue=0;Ue<We.length-2;Ue+=2){let Je=Math.round(i.al*(We[Ue+0]*ne-ce)),St=Math.round(i.al*(We[Ue+1]*ne-ge)),ht=Math.round(i.al*(We[Ue+2]*ne-ce)),Kt=Math.round(i.al*(We[Ue+3]*ne-ge));const dr=ht-Je,Ut=Kt-St;Je<Ie&&ht<Ie||(Je<Ie?(St+=Math.round(Ut*((Ie-Je)/dr)),Je=Ie):ht<Ie&&(Kt=St+Math.round(Ut*((Ie-Je)/dr)),ht=Ie),St<Ie&&Kt<Ie||(St<Ie?(Je+=Math.round(dr*((Ie-St)/Ut)),St=Ie):Kt<Ie&&(ht=Je+Math.round(dr*((Ie-St)/Ut)),Kt=Ie),Je>=Fe&&ht>=Fe||(Je>=Fe?(St+=Math.round(Ut*((Fe-Je)/dr)),Je=Fe):ht>=Fe&&(Kt=St+Math.round(Ut*((Fe-Je)/dr)),ht=Fe),St>=Fe&&Kt>=Fe||(St>=Fe?(Je+=Math.round(dr*((Fe-St)/Ut)),St=Fe):Kt>=Fe&&(ht=Je+Math.round(dr*((Fe-St)/Ut)),Kt=Fe),Qe&&Je===Qe[Qe.length-1][0]&&St===Qe[Qe.length-1][1]||(Qe=[[Je,St]],Re.push(Qe)),Qe.push([ht,Kt])))))}}function nn(We,ne,ce,ge,Re){const Ie=(ce-it)/ne,Fe=(ge-it)/ne,Qe=(ce+1+it)/ne,Ue=(ge+1+it)/ne;function Je(Kt,dr){let Ut=0;return Kt<Ie?Ut|=1:Kt>Qe&&(Ut|=2),dr<Fe?Ut|=4:dr>Ue&&(Ut|=8),Ut}let St=[];for(let Kt=1;Kt<=8;Kt*=2){let dr=We[We.length-2],Ut=We[We.length-1],Fr=!(Je(dr,Ut)&Kt);for(let Lr=0;Lr<We.length;Lr+=2){const jr=We[Lr],dn=We[Lr+1],Ei=!(Je(jr,dn)&Kt);Ei!==Fr&&(8&Kt?St.push(dr+(jr-dr)*(Ue-Ut)/(dn-Ut),Ue):4&Kt?St.push(dr+(jr-dr)*(Fe-Ut)/(dn-Ut),Fe):2&Kt?St.push(Qe,Ut+(dn-Ut)*(Qe-dr)/(jr-dr)):1&Kt&&St.push(Ie,Ut+(dn-Ut)*(Ie-dr)/(jr-dr))),Ei&&St.push(jr,dn),dr=jr,Ut=dn,Fr=Ei}if(!(We=St).length||Kt===8)break;St=[]}const ht=[];for(let Kt=0;Kt<St.length;Kt+=2)ht.push([Math.round(i.al*(St[Kt]*ne-ce)),Math.round(i.al*(St[Kt+1]*ne-ge))]);Re.push(ht)}function qn({name:We,features:ne},ce){ce.writeStringField(1,We),ce.writeVarintField(5,i.al);const ge=new Map,Re=new Map,Ie={keys:ge,values:Re,feature:null};for(const Fe of ne)Ie.feature=Fe,ce.writeMessage(2,lr,Ie);for(const Fe of ge.keys())ce.writeStringField(3,Fe);for(const Fe of Re.keys())ce.writeMessage(4,Nt,Fe)}function lr(We,ne){const ce=We.feature;ce.id!==void 0&&Number.isSafeInteger(+ce.id)&&ne.writeVarintField(1,+ce.id),ce.tags&&ne.writeMessage(2,an,We),ne.writeVarintField(3,ce.type),ne.writeMessage(4,pr,ce)}function an({keys:We,values:ne,feature:ce},ge){for(const Re of Object.keys(ce.tags)){let Ie=ce.tags[Re];if(Ie===null)continue;let Fe=We.get(Re);Fe===void 0&&(Fe=We.size,We.set(Re,Fe)),ge.writeVarint(Fe);const Qe=typeof Ie;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(Ie=JSON.stringify(Ie));let Ue=ne.get(Ie);Ue===void 0&&(Ue=ne.size,ne.set(Ie,Ue)),ge.writeVarint(Ue)}}function Lt(We,ne){return(ne<<3)+(7&We)}function nr(We){return We<<1^We>>31}function pr(We,ne){const{geometry:ce,type:ge}=We;let Re=0,Ie=0;if(ge===1){ne.writeVarint(Lt(1,ce.length));for(const Fe of ce){const Qe=Fe[0]-Re,Ue=Fe[1]-Ie;ne.writeVarint(nr(Qe)),ne.writeVarint(nr(Ue)),Re+=Qe,Ie+=Ue}}else for(const Fe of ce){ne.writeVarint(Lt(1,1));const Qe=Fe.length-(ge===3?1:0);for(let Ue=0;Ue<Qe;Ue++){Ue===1&&ne.writeVarint(Lt(2,Qe-1));const Je=Fe[Ue][0]-Re,St=Fe[Ue][1]-Ie;ne.writeVarint(nr(Je)),ne.writeVarint(nr(St)),Re+=Je,Ie+=St}ge===3&&ne.writeVarint(Lt(7,1))}}function Nt(We,ne){const ce=typeof We;ce==="string"?ne.writeStringField(1,We):ce==="boolean"?ne.writeBooleanField(7,We):ce==="number"&&(We%1!=0?ne.writeDoubleField(3,We):We<0?ne.writeSVarintField(6,We):ne.writeVarintField(5,We))}const zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},un=Math.fround||(hi=new Float32Array(1),We=>(hi[0]=+We,hi[0]));var hi;const Hn=3,zn=5,Qn=6;class zs{constructor(ne){this.options=Object.assign(Object.create(zr),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ge,maxZoom:Re}=this.options;ce&&console.time("total time");const Ie=`prepare ${ne.length} points`;ce&&console.time(Ie),this.points=ne;const Fe=[];for(let Ue=0;Ue<ne.length;Ue++){const Je=ne[Ue];if(!Je.geometry)continue;const[St,ht]=Je.geometry.coordinates,Kt=un(Co(St)),dr=un(wo(ht));Fe.push(Kt,dr,1/0,Ue,-1,1),this.options.reduce&&Fe.push(0)}let Qe=this.trees[Re+1]=this._createTree(Fe);ce&&console.timeEnd(Ie);for(let Ue=Re;Ue>=ge;Ue--){const Je=+Date.now();Qe=this.trees[Ue]=this._createTree(this._cluster(Qe,Ue)),ce&&console.log("z%d: %d clusters in %dms",Ue,Qe.numItems,+Date.now()-Je)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ge=((ne[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,ne[1]));let Ie=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Ie=180;else if(ge>Ie){const ht=this.getClusters([ge,Re,180,Fe],ce),Kt=this.getClusters([-180,Re,Ie,Fe],ce);return ht.concat(Kt)}const Qe=this.trees[this._limitZoom(ce)],Ue=Qe.range(Co(ge),wo(Fe),Co(Ie),wo(Re)),Je=Qe.data,St=[];for(const ht of Ue){const Kt=this.stride*ht;St.push(Je[Kt+zn]>1?gs(Je,Kt,this.clusterProps):this.points[Je[Kt+Hn]])}return St}getChildren(ne){const ce=this._getOriginId(ne),ge=this._getOriginZoom(ne),Re="No cluster with the specified id.",Ie=this.trees[ge];if(!Ie)throw new Error(Re);const Fe=Ie.data;if(ce*this.stride>=Fe.length)throw new Error(Re);const Qe=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Ue=Ie.within(Fe[ce*this.stride],Fe[ce*this.stride+1],Qe),Je=[];for(const St of Ue){const ht=St*this.stride;Fe[ht+4]===ne&&Je.push(Fe[ht+zn]>1?gs(Fe,ht,this.clusterProps):this.points[Fe[ht+Hn]])}if(Je.length===0)throw new Error(Re);return Je}getLeaves(ne,ce,ge){const Re=[];return this._appendLeaves(Re,ne,ce=ce||10,ge=ge||0,0),Re}getTile(ne,ce,ge){const Re=this.trees[this._limitZoom(ne)],Ie=Math.pow(2,ne),{extent:Fe,radius:Qe}=this.options,Ue=Qe/Fe,Je=(ge-Ue)/Ie,St=(ge+1+Ue)/Ie,ht={features:[]};return this._addTileFeatures(Re.range((ce-Ue)/Ie,Je,(ce+1+Ue)/Ie,St),Re.data,ce,ge,Ie,ht),ce===0&&this._addTileFeatures(Re.range(1-Ue/Ie,Je,1,St),Re.data,Ie,ge,Ie,ht),ce===Ie-1&&this._addTileFeatures(Re.range(0,Je,Ue/Ie,St),Re.data,-1,ge,Ie,ht),ht.features.length?ht:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(ne);if(ce++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ge,Re,Ie){const Fe=this.getChildren(ce);for(const Qe of Fe){const Ue=Qe.properties;if(Ue&&Ue.cluster?Ie+Ue.point_count<=Re?Ie+=Ue.point_count:Ie=this._appendLeaves(ne,Ue.cluster_id,ge,Re,Ie):Ie<Re?Ie++:ne.push(Qe),ne.length===ge)break}return Ie}_createTree(ne){const ce=new i.c4(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)ce.add(ne[ge],ne[ge+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ge,Re,Ie,Fe){for(const Qe of ne){const Ue=Qe*this.stride,Je=ce[Ue+zn]>1;let St,ht,Kt;if(Je)St=co(ce,Ue,this.clusterProps),ht=ce[Ue],Kt=ce[Ue+1];else{const Fr=this.points[ce[Ue+Hn]];St=Fr.properties;const[Lr,jr]=Fr.geometry.coordinates;ht=Co(Lr),Kt=wo(jr)}const dr={type:1,geometry:[[Math.round(this.options.extent*(ht*Ie-ge)),Math.round(this.options.extent*(Kt*Ie-Re))]],tags:St};let Ut;Ut=Je||this.options.generateId?ce[Ue+Hn]:this.points[ce[Ue+Hn]].id,Ut!==void 0&&(dr.id=Ut),Fe.features.push(dr)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ge,extent:Re,reduce:Ie,minPoints:Fe}=this.options,Qe=ge/(Re*Math.pow(2,ce)),Ue=ne.data,Je=[],St=this.stride;for(let ht=0;ht<Ue.length;ht+=St){if(Ue[ht+2]<=ce)continue;Ue[ht+2]=ce;const Kt=Ue[ht],dr=Ue[ht+1],Ut=ne.within(Ue[ht],Ue[ht+1],Qe),Fr=Ue[ht+zn];let Lr=Fr;for(const jr of Ut){const dn=jr*St;Ue[dn+2]>ce&&(Lr+=Ue[dn+zn])}if(Lr>Fr&&Lr>=Fe){let jr,dn=Kt*Fr,Ei=dr*Fr,Wi=-1;const Oi=(ht/St<<5)+(ce+1)+this.points.length;for(const Ji of Ut){const wi=Ji*St;if(Ue[wi+2]<=ce)continue;Ue[wi+2]=ce;const gn=Ue[wi+zn];dn+=Ue[wi]*gn,Ei+=Ue[wi+1]*gn,Ue[wi+4]=Oi,Ie&&(jr||(jr=this._map(Ue,ht,!0),Wi=this.clusterProps.length,this.clusterProps.push(jr)),Ie(jr,this._map(Ue,wi)))}Ue[ht+4]=Oi,Je.push(dn/Lr,Ei/Lr,1/0,Oi,-1,Lr),Ie&&Je.push(Wi)}else{for(let jr=0;jr<St;jr++)Je.push(Ue[ht+jr]);if(Lr>1)for(const jr of Ut){const dn=jr*St;if(!(Ue[dn+2]<=ce)){Ue[dn+2]=ce;for(let Ei=0;Ei<St;Ei++)Je.push(Ue[dn+Ei])}}}}return Je}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ge){if(ne[ce+zn]>1){const Fe=this.clusterProps[ne[ce+Qn]];return ge?Object.assign({},Fe):Fe}const Re=this.points[ne[ce+Hn]].properties,Ie=this.options.map(Re);return ge&&Ie===Re?Object.assign({},Ie):Ie}}function gs(We,ne,ce){return{type:"Feature",id:We[ne+Hn],properties:co(We,ne,ce),geometry:{type:"Point",coordinates:[(ge=We[ne],360*(ge-.5)),Hi(We[ne+1])]}};var ge}function co(We,ne,ce){const ge=We[ne+zn],Re=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ie=We[ne+Qn],Fe=Ie===-1?{}:Object.assign({},ce[Ie]);return Object.assign(Fe,{cluster:!0,cluster_id:We[ne+Hn],point_count:ge,point_count_abbreviated:Re})}function Co(We){return We/360+.5}function wo(We){const ne=Math.sin(We*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Hi(We){const ne=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function is(We,ne,ce,ge){let Re=ge;const Ie=ne+(ce-ne>>1);let Fe,Qe=ce-ne;const Ue=We[ne],Je=We[ne+1],St=We[ce],ht=We[ce+1];for(let Kt=ne+3;Kt<ce;Kt+=3){const dr=Io(We[Kt],We[Kt+1],Ue,Je,St,ht);if(dr>Re)Fe=Kt,Re=dr;else if(dr===Re){const Ut=Math.abs(Kt-Ie);Ut<Qe&&(Fe=Kt,Qe=Ut)}}Re>ge&&(Fe-ne>3&&is(We,ne,Fe,ge),We[Fe+2]=Re,ce-Fe>3&&is(We,Fe,ce,ge))}function Io(We,ne,ce,ge,Re,Ie){let Fe=Re-ce,Qe=Ie-ge;if(Fe!==0||Qe!==0){const Ue=((We-ce)*Fe+(ne-ge)*Qe)/(Fe*Fe+Qe*Qe);Ue>1?(ce=Re,ge=Ie):Ue>0&&(ce+=Fe*Ue,ge+=Qe*Ue)}return Fe=We-ce,Qe=ne-ge,Fe*Fe+Qe*Qe}function jo(We,ne,ce,ge){const Re={id:We??null,type:ne,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")qs(Re,ce);else if(ne==="Polygon")qs(Re,ce[0]);else if(ne==="MultiLineString")for(const Ie of ce)qs(Re,Ie);else if(ne==="MultiPolygon")for(const Ie of ce)qs(Re,Ie[0]);return Re}function qs(We,ne){for(let ce=0;ce<ne.length;ce+=3)We.minX=Math.min(We.minX,ne[ce]),We.minY=Math.min(We.minY,ne[ce+1]),We.maxX=Math.max(We.maxX,ne[ce]),We.maxY=Math.max(We.maxY,ne[ce+1])}function Do(We,ne,ce,ge){if(!ne.geometry)return;const Re=ne.geometry.coordinates;if(Re&&Re.length===0)return;const Ie=ne.geometry.type,Fe=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let Qe=[],Ue=ne.id;if(ce.promoteId?Ue=ne.properties[ce.promoteId]:ce.generateId&&(Ue=ge||0),Ie==="Point")Fs(Re,Qe);else if(Ie==="MultiPoint")for(const Je of Re)Fs(Je,Qe);else if(Ie==="LineString")Pa(Re,Qe,Fe,!1);else if(Ie==="MultiLineString"){if(ce.lineMetrics){for(const Je of Re)Qe=[],Pa(Je,Qe,Fe,!1),We.push(jo(Ue,"LineString",Qe,ne.properties));return}Zt(Re,Qe,Fe,!1)}else if(Ie==="Polygon")Zt(Re,Qe,Fe,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(const Je of ne.geometry.geometries)Do(We,{id:Ue,geometry:Je,properties:ne.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of Re){const St=[];Zt(Je,St,Fe,!0),Qe.push(St)}}We.push(jo(Ue,Ie,Qe,ne.properties))}function Fs(We,ne){ne.push(qt(We[0]),fr(We[1]),0)}function Pa(We,ne,ce,ge){let Re,Ie,Fe=0;for(let Ue=0;Ue<We.length;Ue++){const Je=qt(We[Ue][0]),St=fr(We[Ue][1]);ne.push(Je,St,0),Ue>0&&(Fe+=ge?(Re*St-Je*Ie)/2:Math.sqrt(Math.pow(Je-Re,2)+Math.pow(St-Ie,2))),Re=Je,Ie=St}const Qe=ne.length-3;ne[2]=1,is(ne,0,Qe,ce),ne[Qe+2]=1,ne.size=Math.abs(Fe),ne.start=0,ne.end=ne.size}function Zt(We,ne,ce,ge){for(let Re=0;Re<We.length;Re++){const Ie=[];Pa(We[Re],Ie,ce,ge),ne.push(Ie)}}function qt(We){return We/360+.5}function fr(We){const ne=Math.sin(We*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function Ir(We,ne,ce,ge,Re,Ie,Fe,Qe){if(ge/=ne,Ie>=(ce/=ne)&&Fe<ge)return We;if(Fe<ce||Ie>=ge)return null;const Ue=[];for(const Je of We){const St=Je.geometry;let ht=Je.type;const Kt=Re===0?Je.minX:Je.minY,dr=Re===0?Je.maxX:Je.maxY;if(Kt>=ce&&dr<ge){Ue.push(Je);continue}if(dr<ce||Kt>=ge)continue;let Ut=[];if(ht==="Point"||ht==="MultiPoint")On(St,Ut,ce,ge,Re);else if(ht==="LineString")Ii(St,Ut,ce,ge,Re,!1,Qe.lineMetrics);else if(ht==="MultiLineString")$o(St,Ut,ce,ge,Re,!1);else if(ht==="Polygon")$o(St,Ut,ce,ge,Re,!0);else if(ht==="MultiPolygon")for(const Fr of St){const Lr=[];$o(Fr,Lr,ce,ge,Re,!0),Lr.length&&Ut.push(Lr)}if(Ut.length){if(Qe.lineMetrics&&ht==="LineString"){for(const Fr of Ut)Ue.push(jo(Je.id,ht,Fr,Je.tags));continue}ht!=="LineString"&&ht!=="MultiLineString"||(Ut.length===1?(ht="LineString",Ut=Ut[0]):ht="MultiLineString"),ht!=="Point"&&ht!=="MultiPoint"||(ht=Ut.length===3?"Point":"MultiPoint"),Ue.push(jo(Je.id,ht,Ut,Je.tags))}}return Ue.length?Ue:null}function On(We,ne,ce,ge,Re){for(let Ie=0;Ie<We.length;Ie+=3){const Fe=We[Ie+Re];Fe>=ce&&Fe<=ge&&Lo(ne,We[Ie],We[Ie+1],We[Ie+2])}}function Ii(We,ne,ce,ge,Re,Ie,Fe){let Qe=eo(We);const Ue=Re===0?Ca:Mi;let Je,St,ht=We.start;for(let Lr=0;Lr<We.length-3;Lr+=3){const jr=We[Lr],dn=We[Lr+1],Ei=We[Lr+2],Wi=We[Lr+3],Oi=We[Lr+4],Ji=Re===0?jr:dn,wi=Re===0?Wi:Oi;let gn=!1;Fe&&(Je=Math.sqrt(Math.pow(jr-Wi,2)+Math.pow(dn-Oi,2))),Ji<ce?wi>ce&&(St=Ue(Qe,jr,dn,Wi,Oi,ce),Fe&&(Qe.start=ht+Je*St)):Ji>ge?wi<ge&&(St=Ue(Qe,jr,dn,Wi,Oi,ge),Fe&&(Qe.start=ht+Je*St)):Lo(Qe,jr,dn,Ei),wi<ce&&Ji>=ce&&(St=Ue(Qe,jr,dn,Wi,Oi,ce),gn=!0),wi>ge&&Ji<=ge&&(St=Ue(Qe,jr,dn,Wi,Oi,ge),gn=!0),!Ie&&gn&&(Fe&&(Qe.end=ht+Je*St),ne.push(Qe),Qe=eo(We)),Fe&&(ht+=Je)}let Kt=We.length-3;const dr=We[Kt],Ut=We[Kt+1],Fr=Re===0?dr:Ut;Fr>=ce&&Fr<=ge&&Lo(Qe,dr,Ut,We[Kt+2]),Kt=Qe.length-3,Ie&&Kt>=3&&(Qe[Kt]!==Qe[0]||Qe[Kt+1]!==Qe[1])&&Lo(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&ne.push(Qe)}function eo(We){const ne=[];return ne.size=We.size,ne.start=We.start,ne.end=We.end,ne}function $o(We,ne,ce,ge,Re,Ie){for(const Fe of We)Ii(Fe,ne,ce,ge,Re,Ie,!1)}function Lo(We,ne,ce,ge){We.push(ne,ce,ge)}function Ca(We,ne,ce,ge,Re,Ie){const Fe=(Ie-ne)/(ge-ne);return Lo(We,Ie,ce+(Re-ce)*Fe,1),Fe}function Mi(We,ne,ce,ge,Re,Ie){const Fe=(Ie-ce)/(Re-ce);return Lo(We,ne+(ge-ne)*Fe,Ie,1),Fe}function ln(We,ne){const ce=[];for(let ge=0;ge<We.length;ge++){const Re=We[ge],Ie=Re.type;let Fe;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")Fe=ui(Re.geometry,ne);else if(Ie==="MultiLineString"||Ie==="Polygon"){Fe=[];for(const Qe of Re.geometry)Fe.push(ui(Qe,ne))}else if(Ie==="MultiPolygon"){Fe=[];for(const Qe of Re.geometry){const Ue=[];for(const Je of Qe)Ue.push(ui(Je,ne));Fe.push(Ue)}}ce.push(jo(Re.id,Ie,Fe,Re.tags))}return ce}function ui(We,ne){const ce=[];ce.size=We.size,We.start!==void 0&&(ce.start=We.start,ce.end=We.end);for(let ge=0;ge<We.length;ge+=3)ce.push(We[ge]+ne,We[ge+1],We[ge+2]);return ce}function on(We,ne){if(We.transformed)return We;const ce=1<<We.z,ge=We.x,Re=We.y;for(const Ie of We.features){const Fe=Ie.geometry,Qe=Ie.type;if(Ie.geometry=[],Qe===1)for(let Ue=0;Ue<Fe.length;Ue+=2)Ie.geometry.push(Zn(Fe[Ue],Fe[Ue+1],ne,ce,ge,Re));else for(let Ue=0;Ue<Fe.length;Ue++){const Je=[];for(let St=0;St<Fe[Ue].length;St+=2)Je.push(Zn(Fe[Ue][St],Fe[Ue][St+1],ne,ce,ge,Re));Ie.geometry.push(Je)}}return We.transformed=!0,We}function Zn(We,ne,ce,ge,Re,Ie){return[Math.round(ce*(We*ge-Re)),Math.round(ce*(ne*ge-Ie))]}function ei(We,ne,ce,ge,Re){const Ie=ne===Re.maxZoom?0:Re.tolerance/((1<<ne)*Re.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:We.length,source:null,x:ce,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Qe of We)Vo(Fe,Qe,Ie,Re);return Fe}function Vo(We,ne,ce,ge){const Re=ne.geometry,Ie=ne.type,Fe=[];if(We.minX=Math.min(We.minX,ne.minX),We.minY=Math.min(We.minY,ne.minY),We.maxX=Math.max(We.maxX,ne.maxX),We.maxY=Math.max(We.maxY,ne.maxY),Ie==="Point"||Ie==="MultiPoint")for(let Qe=0;Qe<Re.length;Qe+=3)Fe.push(Re[Qe],Re[Qe+1]),We.numPoints++,We.numSimplified++;else if(Ie==="LineString")mt(Fe,Re,We,ce,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(let Qe=0;Qe<Re.length;Qe++)mt(Fe,Re[Qe],We,ce,Ie==="Polygon",Qe===0);else if(Ie==="MultiPolygon")for(let Qe=0;Qe<Re.length;Qe++){const Ue=Re[Qe];for(let Je=0;Je<Ue.length;Je++)mt(Fe,Ue[Je],We,ce,!0,Je===0)}if(Fe.length){let Qe=ne.tags||null;if(Ie==="LineString"&&ge.lineMetrics){Qe={};for(const Je in ne.tags)Qe[Je]=ne.tags[Je];Qe.mapbox_clip_start=Re.start/Re.size,Qe.mapbox_clip_end=Re.end/Re.size}const Ue={geometry:Fe,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:Qe};ne.id!==null&&(Ue.id=ne.id),We.features.push(Ue)}}function mt(We,ne,ce,ge,Re,Ie){const Fe=ge*ge;if(ge>0&&ne.size<(Re?Fe:ge))return void(ce.numPoints+=ne.length/3);const Qe=[];for(let Ue=0;Ue<ne.length;Ue+=3)(ge===0||ne[Ue+2]>Fe)&&(ce.numSimplified++,Qe.push(ne[Ue],ne[Ue+1])),ce.numPoints++;Re&&function(Ue,Je){let St=0;for(let ht=0,Kt=Ue.length,dr=Kt-2;ht<Kt;dr=ht,ht+=2)St+=(Ue[ht]-Ue[dr])*(Ue[ht+1]+Ue[dr+1]);if(St>0===Je)for(let ht=0,Kt=Ue.length;ht<Kt/2;ht+=2){const dr=Ue[ht],Ut=Ue[ht+1];Ue[ht]=Ue[Kt-2-ht],Ue[ht+1]=Ue[Kt-1-ht],Ue[Kt-2-ht]=dr,Ue[Kt-1-ht]=Ut}}(Qe,Ie),We.push(Qe)}const qo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ia{constructor(ne,ce){const ge=(ce=this.options=function(Ie,Fe){for(const Qe in Fe)Ie[Qe]=Fe[Qe];return Ie}(Object.create(qo),ce)).debug;if(ge&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=function(Ie,Fe){const Qe=[];if(Ie.type==="FeatureCollection")for(let Ue=0;Ue<Ie.features.length;Ue++)Do(Qe,Ie.features[Ue],Fe,Ue);else Do(Qe,Ie.type==="Feature"?Ie:{geometry:Ie},Fe);return Qe}(ne,ce);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=function(Ie,Fe){const Qe=Fe.buffer/Fe.extent;let Ue=Ie;const Je=Ir(Ie,1,-1-Qe,Qe,0,-1,2,Fe),St=Ir(Ie,1,1-Qe,2+Qe,0,-1,2,Fe);return(Je||St)&&(Ue=Ir(Ie,1,-Qe,1+Qe,0,-1,2,Fe)||[],Je&&(Ue=ln(Je,1).concat(Ue)),St&&(Ue=Ue.concat(ln(St,-1)))),Ue}(Re,ce),Re.length&&this.splitTile(Re,0,0,0),ge&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ce,ge,Re,Ie,Fe,Qe){const Ue=[ne,ce,ge,Re],Je=this.options,St=Je.debug;for(;Ue.length;){Re=Ue.pop(),ge=Ue.pop(),ce=Ue.pop(),ne=Ue.pop();const ht=1<<ce,Kt=Uo(ce,ge,Re);let dr=this.tiles[Kt];if(!dr&&(St>1&&console.time("creation"),dr=this.tiles[Kt]=ei(ne,ce,ge,Re,Je),this.tileCoords.push({z:ce,x:ge,y:Re}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ge,Re,dr.numFeatures,dr.numPoints,dr.numSimplified),console.timeEnd("creation"));const gn=`z${ce}`;this.stats[gn]=(this.stats[gn]||0)+1,this.total++}if(dr.source=ne,Ie==null){if(ce===Je.indexMaxZoom||dr.numPoints<=Je.indexMaxPoints)continue}else{if(ce===Je.maxZoom||ce===Ie)continue;if(Ie!=null){const gn=Ie-ce;if(ge!==Fe>>gn||Re!==Qe>>gn)continue}}if(dr.source=null,ne.length===0)continue;St>1&&console.time("clipping");const Ut=.5*Je.buffer/Je.extent,Fr=.5-Ut,Lr=.5+Ut,jr=1+Ut;let dn=null,Ei=null,Wi=null,Oi=null,Ji=Ir(ne,ht,ge-Ut,ge+Lr,0,dr.minX,dr.maxX,Je),wi=Ir(ne,ht,ge+Fr,ge+jr,0,dr.minX,dr.maxX,Je);ne=null,Ji&&(dn=Ir(Ji,ht,Re-Ut,Re+Lr,1,dr.minY,dr.maxY,Je),Ei=Ir(Ji,ht,Re+Fr,Re+jr,1,dr.minY,dr.maxY,Je),Ji=null),wi&&(Wi=Ir(wi,ht,Re-Ut,Re+Lr,1,dr.minY,dr.maxY,Je),Oi=Ir(wi,ht,Re+Fr,Re+jr,1,dr.minY,dr.maxY,Je),wi=null),St>1&&console.timeEnd("clipping"),Ue.push(dn||[],ce+1,2*ge,2*Re),Ue.push(Ei||[],ce+1,2*ge,2*Re+1),Ue.push(Wi||[],ce+1,2*ge+1,2*Re),Ue.push(Oi||[],ce+1,2*ge+1,2*Re+1)}}getTile(ne,ce,ge){ne=+ne,ce=+ce,ge=+ge;const Re=this.options,{extent:Ie,debug:Fe}=Re;if(ne<0||ne>24)return null;const Qe=1<<ne,Ue=Uo(ne,ce=ce+Qe&Qe-1,ge);if(this.tiles[Ue])return on(this.tiles[Ue],Ie);Fe>1&&console.log("drilling down to z%d-%d-%d",ne,ce,ge);let Je,St=ne,ht=ce,Kt=ge;for(;!Je&&St>0;)St--,ht>>=1,Kt>>=1,Je=this.tiles[Uo(St,ht,Kt)];return Je&&Je.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",St,ht,Kt),console.time("drilling down")),this.splitTile(Je.source,St,ht,Kt,ne,ce,ge),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?on(this.tiles[Ue],Ie):null):null}}function Uo(We,ne,ce){return 32*((1<<We)*ce+ne)+We}function Zr(We,ne){const ce=We.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const ge=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ge)return void ne(null,null);const Re=Je=>Je.tags&&"3d_elevation_id"in Je.tags&&"source"in Je.tags&&Je.tags.source==="elevation",Ie=ge.features.filter(Je=>Re(Je));let Fe={_geojsonTileLayer:ge.features};Ie.length>0&&(Fe={_geojsonTileLayer:ge.features.filter(Je=>!Re(Je)),hd_road_elevation:Ie});const Qe=new Xe(Fe),Ue=function(Je){const St=new i.bt;for(const ht of Object.keys(Je))St.writeMessage(3,qn,{name:ht,features:Je[ht]});return St.finish()}(Fe).buffer;ne(null,{vectorTile:Qe,rawData:Ue})}class os extends he{constructor(ne,ce,ge,Re,Ie,Fe,Qe){super(ne,ce,ge,Re,Ie,Zr,Qe),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new Ke}loadData(ne,ce){const ge=ne&&ne.request,Re=ge&&ge.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(Ie,Fe)=>{if(Ie||!Fe)return ce(Ie);if(typeof Fe!="object")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const Ue=i.U(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));Fe.features=Fe.features.filter(Je=>Ue.value.evaluate({zoom:0},Je))}ne.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),ne.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new zs(function({superclusterOptions:Ue,clusterProperties:Je}){if(!Je||!Ue)return Ue;const St={},ht={},Kt={accumulated:null,zoom:0},dr={properties:null},Ut=Object.keys(Je);for(const Fr of Ut){const[Lr,jr]=Je[Fr],dn=i.U(jr),Ei=i.U(typeof Lr=="string"?[Lr,["accumulated"],["get",Fr]]:Lr);St[Fr]=dn.value,ht[Fr]=Ei.value}return Ue.map=Fr=>{dr.properties=Fr;const Lr={};for(const jr of Ut)Lr[jr]=St[jr].evaluate(Kt,dr);return Lr},Ue.reduce=(Fr,Lr)=>{dr.properties=Lr;for(const jr of Ut)Kt.accumulated=Fr[jr],Fr[jr]=ht[jr].evaluate(Kt,dr)},Ue}(ne)).load(Fe.features):ne.dynamic?this._dynamicIndex:function(Ue,Je){return new Ia(Ue,Je)}(Fe,ne.geojsonVtOptions)}catch(Ue){return ce(Ue)}const Qe={};if(Re){const Ue=S(ge);Ue&&(Qe.resourceTiming={},Qe.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Ue)))}ce(null,Qe)}})}reloadTile(ne,ce){const ge=this.loaded;return ge&&ge[ne.uid]?ne.partial?ce(null,void 0):super.reloadTile(ne,ce):this.loadTile(ne,ce)}loadGeoJSON(ne,ce){if(ne.request)i.m(ne.request,ce);else{if(typeof ne.data!="string")return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ce(null,JSON.parse(ne.data))}catch{return ce(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,ce){try{ce(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(ge){ce(ge)}}getClusterChildren(ne,ce){try{ce(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(ge){ce(ge)}}getClusterLeaves(ne,ce){try{ce(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(ge){ce(ge)}}}class Py{constructor(ne,ce,ge){this.tileID=new i.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ce,this.worldview=ge}parse(ne,ce,ge,Re){this.status="parsing";const Ie=new i.aQ(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),Fe=[],Qe=ce.familiesBySource[ge.source],Ue=new i.fn(Ie,ge.promoteId);Ue.bucketLayerIDs=[],Ue.is3DTile=!0,i.fC(ne).then(Je=>{if(!Je)return Re(new Error("Could not parse tile"));const St=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,ht=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),Kt=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const dr in Qe)for(const Ut of Qe[dr]){const Fr=Ut[0];Ue.bucketLayerIDs.push(Ut.map(dn=>i.B(dn.id,dn.scope))),Fr.recalculate(Kt,[]);const Lr=i.fD(Je,1/i.d7(ge.tileID.canonical)),jr=new i.fE(Ut,Lr,Ie,St,ht,this.brightness,Ue,this.worldview);St||(jr.needsUpload=!0),Fe.push(jr),jr.evaluate(Fr)}this.status="done",Re(null,{buckets:Fe,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Je=>Re(new Error(Je.message)))}}class au{constructor(ne,ce,ge,Re,Ie,Fe,Qe,Ue){this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.availableModels=Re,this.brightness=Qe,this.loading={},this.loaded={},this.worldview=Ue}loadTile(ne,ce){const ge=ne.uid,Re=this.loading[ge]=new Py(ne,this.brightness,this.worldview);i.bu(ne.request,(Ie,Fe)=>{const Qe=!this.loading[ge];return delete this.loading[ge],Qe||Ie?(Re.status="done",Qe||(this.loaded[ge]=Re),ce(Ie)):Fe&&Fe.byteLength!==0?void Re.parse(Fe,this.layerIndex,ne,(Ue,Je)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Re,Ue||!Je?ce(Ue):ce(null,Je)}):(Re.status="done",this.loaded[ge]=Re,ce())})}reloadTile(ne,ce){const ge=this.loaded,Re=ne.uid;if(ge&&ge[Re]){const Ie=ge[Re];Ie.projection=ne.projection,Ie.brightness=ne.brightness;const Fe=(Qe,Ue)=>{Ie.reloadCallback&&(delete Ie.reloadCallback,this.loadTile(ne,ce)),ce(Qe,Ue)};Ie.status==="parsing"?Ie.reloadCallback=Fe:Ie.status==="done"&&this.loadTile(ne,ce)}}abortTile(ne,ce){const ge=ne.uid;this.loading[ge]&&delete this.loading[ge],ce()}removeTile(ne,ce){const ge=this.loaded,Re=ne.uid;ge&&ge[Re]&&delete ge[Re],ce()}}class fh{constructor(ne){this.self=ne,this.actor=new i.fG(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cm({name:"mercator"}),this.workerSourceTypes={vector:he,geojson:os,"raster-dem":we,"raster-array":je,"batched-model":au},this.workerSources={},this.self.registerWorkerSource=(ce,ge)=>{if(this.workerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.workerSourceTypes[ce]=ge},this.self.registerRTLTextPlugin=ce=>{if(i.fH.isParsed())throw new Error("RTL text plugin already registered.");i.fH.setState({pluginStatus:i.fI.parsed,pluginURL:i.fH.getPluginURL()}),i.fH.applyArabicShaping=ce.applyArabicShaping,i.fH.processBidirectionalText=ce.processBidirectionalText,i.fH.processStyledBidirectionalText=ce.processStyledBidirectionalText;for(const ge of this.rtlPluginParsingListeners)ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ce,ge){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],ge()}checkIfReady(ne,ce,ge){ge()}setReferrer(ne,ce){this.referrer=ce}spriteLoaded(ne,ce){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:ge,isLoaded:Re}=ce;if(this.isSpriteLoaded[ne][ge]=Re,this.workerSources[ne]&&this.workerSources[ne][ge])for(const Ie in this.workerSources[ne][ge]){const Fe=this.workerSources[ne][ge][Ie];for(const Qe in Fe){const Ue=Fe[Qe];Ue instanceof he&&(Ue.isSpriteLoaded=Re,Ue.fire(new i.z("isSpriteLoaded")))}}}setImages(ne,ce,ge){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Re,images:Ie}=ce;if(this.availableImages[ne][Re]=Ie,this.workerSources[ne]&&this.workerSources[ne][Re]){for(const Fe in this.workerSources[ne][Re]){const Qe=this.workerSources[ne][Re][Fe];for(const Ue in Qe)Qe[Ue].availableImages=Ie}ge()}else ge()}setModels(ne,{scope:ce,models:ge},Re){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ce]=ge,this.workerSources[ne]&&this.workerSources[ne][ce]){for(const Ie in this.workerSources[ne][ce]){const Fe=this.workerSources[ne][ce][Ie];for(const Qe in Fe)Fe[Qe].availableModels=ge}Re()}else Re()}setProjection(ne,ce){this.projections[ne]=i.cm(ce)}setBrightness(ne,ce,ge){this.brightness=ce,ge()}setWorldview(ne,ce,ge){this.worldview=ce,ge()}setLayers(ne,ce,ge){this.getLayerIndex(ne,ce.scope).replace(ce.layers,ce.options),ge()}updateLayers(ne,ce,ge){this.getLayerIndex(ne,ce.scope).update(ce.layers,ce.removedIds,ce.options),ge()}loadTile(ne,ce,ge){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).loadTile(ce,ge)}decodeRasterArray(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).decodeRasterArray(ce,ge)}reloadTile(ne,ce,ge){ce.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ce.type,ce.source,ce.scope).reloadTile(ce,ge)}abortTile(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).abortTile(ce,ge)}removeTile(ne,ce,ge){this.getWorkerSource(ne,ce.type,ce.source,ce.scope).removeTile(ce,ge)}removeSource(ne,ce,ge){if(!(this.workerSources[ne]&&this.workerSources[ne][ce.scope]&&this.workerSources[ne][ce.scope][ce.type]&&this.workerSources[ne][ce.scope][ce.type][ce.source]))return;const Re=this.workerSources[ne][ce.scope][ce.type][ce.source];delete this.workerSources[ne][ce.scope][ce.type][ce.source],Re.removeSource!==void 0?Re.removeSource(ce,ge):ge()}loadWorkerSource(ne,ce,ge){try{this.self.importScripts(ce.url),ge()}catch(Re){ge(Re)}}syncRTLPluginState(ne,ce,ge){if(i.fH.isParsed())ge(null,!0);else if(i.fH.isParsing())this.rtlPluginParsingListeners.push(ge);else try{i.fH.setState(ce);const Re=i.fH.getPluginURL();!i.fH.isLoaded()||i.fH.isParsed()||i.fH.isParsing()||Re==null||(i.fH.setState({pluginStatus:i.fI.parsing,pluginURL:i.fH.getPluginURL()}),this.self.importScripts(Re),i.fH.isParsed()?ge(null,!0):this.rtlPluginParsingListeners.push(ge))}catch(Re){ge(Re)}}setDracoUrl(ne,ce){this.dracoUrl=ce}getAvailableImages(ne,ce){this.availableImages[ne]||(this.availableImages[ne]={});let ge=this.availableImages[ne][ce];return ge||(ge=[]),ge}getAvailableModels(ne,ce){this.availableModels[ne]||(this.availableModels[ne]={});let ge=this.availableModels[ne][ce];return ge||(ge={}),ge}getLayerIndex(ne,ce){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let ge=this.layerIndexes[ne][ce];return ge||(ge=this.layerIndexes[ne][ce]=new M,ge.scope=ce),ge}getWorkerSource(ne,ce,ge,Re){const Ie=this.workerSources;return Ie[ne]||(Ie[ne]={}),Ie[ne][Re]||(Ie[ne][Re]={}),Ie[ne][Re][ce]||(Ie[ne][Re][ce]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),Ie[ne][Re][ce][ge]||(Ie[ne][Re][ce][ge]=new this.workerSourceTypes[ce]({send:(Fe,Qe,Ue,Je,St,ht)=>this.actor.send(Fe,Qe,Ue,ne,St,ht),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Re),this.getAvailableImages(ne,Re),this.getAvailableModels(ne,Re),this.isSpriteLoaded[ne][Re],void 0,this.brightness,this.worldview)),Ie[ne][Re][ce][ge]}rasterizeImagesWorker(ne,ce,ge){const Re=new Map;for(const[Ie,{image:Fe,imageVariant:Qe}]of ce.tasks.entries()){const Ue=this.imageRasterizer.rasterize(Qe,Fe,ce.scope,ne);Re.set(Ie,Ue)}ge(void 0,Re)}removeRasterizedImages(ne,ce,ge){this.imageRasterizer.removeImagesFromCacheByIds(ce.imageIds,ce.scope,ne),ge()}enforceCacheSizeLimit(ne,ce){i.fJ(ce)}getWorkerPerformanceMetrics(ne,ce,ge){ge(void 0,void 0)}}return i.fF(self)&&(self.worker=new fh(self)),fh}),f(["./shared"],function(i){var S="3.17.0";const E={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(p){performance.mark(p)},measure(p,s,c){performance.measure(p,s,c)}};function M(p){const s=p.name.split("?")[0];return i.a(s)&&s.includes("mapbox-gl.js")?"javascript":i.a(s)&&s.includes("mapbox-gl.css")?"css":i.b(s)?"fontRange":i.c(s)?"sprite":i.i(s)?"style":i.d(s)?"tilejson":"other"}var j,N={},G=function(){if(j)return N;function p(m){return!s(m)}function s(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,T,P=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(P);try{T=new Worker(O),w=!0}catch{w=!1}return T&&T.terminate(),URL.revokeObjectURL(O),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var T=w.getContext("2d");if(!T)return!1;var P=T.getImageData(0,0,1,1);return P&&P.width===w.width}()?(c[v=m&&m.failIfMajorPerformanceCaveat]===void 0&&(c[v]=function(w){var T,P=function(O){var D=document.createElement("canvas"),F=Object.create(p.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=O,D.getContext("webgl2",F)}(w);if(!P)return!1;try{T=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!T||P.isContextLost())&&(P.shaderSource(T,"void main() {}"),P.compileShader(T),P.getShaderParameter(T,P.COMPILE_STATUS)===!0)}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}j=1,N.supported=p,N.notSupportedReason=s;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},N}();function z(p,s,c){const m=document.createElement(p);return s!=null&&(m.className=s),c&&c.appendChild(m),m}function V(p,s,c){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(s))m.setAttributeNS(null,v,String(s[v]));return c&&c.appendChild(m),m}const K=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Q=K&&K.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function ie(){K&&Q&&(X=K[Q],K[Q]="none")}function J(){K&&Q&&(K[Q]=X)}function se(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",se,!0)}function he(){window.addEventListener("click",se,!0),window.setTimeout(()=>{window.removeEventListener("click",se,!0)},0)}function we(p,s){const c=p.getBoundingClientRect();return Oe(p,c,s)}function ze(p,s){const c=p.getBoundingClientRect(),m=[];for(let v=0;v<s.length;v++)m.push(Oe(p,c,s[v]));return m}function je(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function Oe(p,s,c){const m=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new i.P((c.clientX-s.left)*m,(c.clientY-s.top)*m)}const Be="01",qe="NO_ACCESS_TOKEN";class Xe{constructor(s,c,m){this._transformRequestFn=s,this._customAccessToken=c,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const s=function(){let c="";for(let m=0;m<10;m++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Be,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,c){return this._transformRequestFn&&this._transformRequestFn(s,c)||{url:s}}normalizeStyleURL(s,c){if(!i.h(s))return s;const m=Ge(s);return m.params.push(`sdk=js-${S}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeGlyphsURL(s,c){if(!i.h(s))return s;const m=Ge(s);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeModelURL(s,c){if(!i.h(s))return s;const m=Ge(s);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||c)}normalizeSourceURL(s,c,m,v){if(!i.h(s))return s;const w=Ge(s);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),m&&w.params.push(`language=${m}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeIconsetURL(s,c){const m=Ge(s);return i.h(s)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||c)):Ke(m)}normalizeSpriteURL(s,c,m,v){const w=Ge(s);return i.h(s)?(w.path=`/styles/v1${w.path}/sprite${c}${m}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${c}${m}`,Ke(w))}normalizeTileURL(s,c,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!i.h(s))return s;const v=Ge(s);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||m&&v.authority!=="raster"&&m===512?"@2x":""}${i.k.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${i.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${i.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${i.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(T){for(const P of T){const O=P.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(v.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(s,c){const m=Ge(s);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return s;let v="mapbox://";m.path.match(/^\/raster\/v1\//)?v+=`raster/${m.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${m.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${m.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let w=m.params;return c&&(w=w.filter(T=>!T.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(s,c){const m=!!c&&i.h(c),v=[];for(const w of s.tiles||[])i.j(w)?v.push(this.canonicalizeTileURL(w,m)):v.push(w);return v}_makeAPIURL(s,c){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=Ge(i.e.API_URL);if(s.protocol=v.protocol,s.authority=v.authority,s.protocol==="http"){const w=s.params.indexOf("secure");w>=0&&s.params.splice(w,1)}if(v.path!=="/"&&(s.path=`${v.path}${s.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Ke(s);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return s.params=s.params.filter(w=>w.indexOf("access_token")===-1),s.params.push(`access_token=${c||""}`),Ke(s)}}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ge(p){const s=p.match(it);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ke(p){const s=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${s}`}const ut="mapbox.eventData";function rt(p){if(!p)return null;const s=p.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(i.l(s[1]))}catch{return null}}class Xt{constructor(s){this.type=s,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const c=rt(i.e.ACCESS_TOKEN);let m="";return m=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",s?`${ut}.${s}:${m}`:`${ut}:${m}`}fetchEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp");if(s)try{const w=localStorage.getItem(c);w&&(this.eventData=JSON.parse(w));const T=localStorage.getItem(m);T&&(this.anonId=T);const P=localStorage.getItem(v);P&&(this.anonIdTimestamp=Number(P));const O=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<O)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const s=i.s("localStorage"),c=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.getStorageKey("uuidTimestamp"),w=this.anonId,T=this.anonIdTimestamp;if(s&&w)try{localStorage.setItem(m,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData)),T&&localStorage.setItem(v,T.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,c,m,v){if(!i.e.EVENTS_URL)return;const w=Ge(i.e.EVENTS_URL);w.params.push(`access_token=${v||i.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(s).toISOString()},P=c?Object.assign(T,c):T,O={url:Ke(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=i.p(O,D=>{this.pendingRequest=null,m(D),this.saveEventData(),this.processRequests(v)})}queueRequest(s,c){this.queue.push(s),this.processRequests(c)}}class cr extends Xt{constructor(s){super("metrics"),s&&(this.data=s)}postMetricsEvent(s){if(!i.e.EVENTS_URL||!s&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const c=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:c},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:c,payload:m}=this.queue.shift();this.postEvent(c,m,()=>{},s)}}const Bt=new class extends Xt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,s){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>i.h(c)||i.j(c))&&this.queueRequest(Date.now(),s)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=rt(i.e.ACCESS_TOKEN),c=s?s.u:i.e.ACCESS_TOKEN;let m=c!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),m=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),T=new Date(v),P=(v-this.eventData.lastSuccess)/864e5;m=m||P>=1||P<-1||w.getDate()!==T.getDate()}else m=!0;m?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Be,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},p):this.processRequests()}},$t=Bt.postTurnstileEvent.bind(Bt),br=new class extends Xt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,s,c,m){this.skuToken=s,this.errorCb=m,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(qe)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Be,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):s&&(this.success[s]=!0)},p))}remove(){this.errorCb=null}},nn=br.postMapLoadEvent.bind(br),qn=new class extends Xt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let s=this.mapInstanceIdMap.get(p);return s||(s=i.u(),this.mapInstanceIdMap.set(p,s)),s}getEventId(p){const s=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,s+1),s}postStyleLoadEvent(p,s){const{map:c,style:m,importedStyles:v}=s;if(!i.e.EVENTS_URL||!p&&!i.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),T={mapInstanceId:w,eventId:this.getEventId(w),style:m};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:c}=this.queue.shift();this.postEvent(s,c,()=>{},p)}},lr=qn.postStyleLoadEvent.bind(qn),an=new cr({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Lt=an.postMetricsEvent.bind(an),nr=new cr({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),pr=nr.postMetricsEvent.bind(nr),Nt=new class extends Xt{constructor(){super("gljs.performance")}postPerformanceEvent(p,s){i.e.EVENTS_URL&&(p||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:c}=this.queue.shift(),m=function(v){const w=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),P=function(q){const ee={};if(q){for(const Y in q)if(Y!=="other")for(const ae of q[Y]){const oe=`${Y}ResolveRangeMin`,de=`${Y}ResolveRangeMax`,me=`${Y}RequestCount`,fe=`${Y}RequestCachedCount`;ee[oe]=Math.min(ee[oe]||1/0,ae.startTime),ee[de]=Math.max(ee[de]||-1/0,ae.responseEnd);const Pe=be=>{ee[be]===void 0&&(ee[be]=0),++ee[be]};ae.transferSize!==void 0&&ae.transferSize===0&&Pe(fe),Pe(me)}}return ee}(function(q,ee){const Y={};if(q)for(const ae of q){const oe=ee(ae);Y[oe]===void 0&&(Y[oe]=[]),Y[oe].push(ae)}return Y}(w,M)),O=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=D?D.effectiveType:void 0,W={counters:[],metadata:[],attributes:[]},H=(q,ee,Y)=>{Y!=null&&q.push({name:ee,value:Y.toString()})};for(const q in P)H(W.counters,q,P[q]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(H(W.counters,"interactionRangeMin",v.interactionRange[0]),H(W.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const q of Object.values(E)){const ee=T.find(Y=>Y.name===q);ee&&H(W.counters,q,ee.startTime)}return H(W.counters,"visibilityHidden",v.visibilityHidden),H(W.attributes,"style",function(q){if(q)for(const ee of q){const Y=ee.name.split("?")[0];if(i.i(Y)){const ae=Y.split("/").slice(-2);if(ae.length===2)return`mapbox://styles/${ae[0]}/${ae[1]}`}}}(w)),H(W.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),H(W.attributes,"fogEnabled",v.fogEnabled?"true":"false"),H(W.attributes,"projection",v.projection),H(W.attributes,"zoom",v.zoom),H(W.metadata,"devicePixelRatio",O),H(W.metadata,"connectionEffectiveType",F),H(W.metadata,"navigatorUserAgent",navigator.userAgent),H(W.metadata,"screenWidth",window.screen.width),H(W.metadata,"screenHeight",window.screen.height),H(W.metadata,"windowWidth",window.innerWidth),H(W.metadata,"windowHeight",window.innerHeight),H(W.metadata,"mapWidth",v.width/O),H(W.metadata,"mapHeight",v.height/O),H(W.metadata,"webglRenderer",v.renderer),H(W.metadata,"webglVendor",v.vendor),H(W.metadata,"sdkVersion",S),H(W.metadata,"sdkIdentifier","mapbox-gl-js"),W}(c);for(const v of m.metadata);for(const v of m.counters);for(const v of m.attributes);this.postEvent(s,m,()=>{},p)}},zr=Nt.postPerformanceEvent.bind(Nt),un=new class extends Xt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,s,c,m){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const v=Ge(i.e.API_URL+i.e.SESSION_PATH);v.params.push(`sku=${s||""}`),v.params.push(`access_token=${m||i.e.ACCESS_TOKEN||""}`);const w={url:Ke(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(w,T=>{this.pendingRequest=null,c(T),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,s,c,m){this.skuToken=s,this.errorCb=m,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(qe)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:c}=this.queue.shift();s&&this.success[s]||this.getSession(c,this.skuToken,m=>{m?this.errorCb(m):s&&(this.success[s]=!0)},p)}remove(){this.errorCb=null}},hi=un.getSessionAPI.bind(un),Hn=new Set;function zn(p,s){s?Hn.add(p):Hn.delete(p)}class Qn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function zs(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class gs extends i.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new i.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const c=this.atlasTexture.get(s);c&&(c.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(s.id,s)}removeImageProvider(s,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(s)}getPendingImageProviders(){const s=[];for(const c of this.imageProviders.values())for(const m of c.values())m.hasPendingRequests()&&s.push(m);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,c){if(this.loaded.get(c)!==s&&(this.loaded.set(c,s),s)){for(const{ids:m,callback:v}of this.requestors)this._notify(m,c,v);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images.get(c).get(s.toString())}addImage(s,c,m){this._validate(s,m)&&this.images.get(c).set(s.toString(),m)}_validate(s,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "content" value`))),m=!1),m}_validateStretch(s,c){if(!s)return!0;let m=0;for(const v of s){if(v[0]<m||v[1]<v[0]||c<v[1])return!1;m=v[1]}return!0}_validateContent(s,c){return s?s.length!==4||!c.usvg&&(s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,c,m){const v=this.images.get(c).get(s.toString());m.version=v.version+1,this.images.get(c).set(s.toString(),m),this.updatedImages.get(c).add(s),this.removeFromImageRasterizerCache(s,c)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,c){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([s],c))}removeImage(s,c){const m=this.images.get(c),v=m.get(s.toString());m.delete(s.toString()),this.patterns.get(c).delete(s.toString()),this.removeFromImageRasterizerCache(s,c),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(c=>i.I.from(c))}getImages(s,c,m){const v=[],w=[],T=this.imageProviders.get(c);for(const F of s){if(!F.iconsetId){v.push(F);continue}const W=T.get(F.iconsetId);W&&(this.getImage(F,c)?w.push(F):W.addPendingRequest(F))}if(v.length===0)return void this._notify(w,c,m);let P=!0;const O=!!this.loaded.get(c),D=this.images.get(c);if(!O)for(const F of v)D.has(F.toString())||(P=!1);O||P?this._notify(v,c,m):this.requestors.push({ids:v,scope:c,callback:m})}rasterizeImages(s,c){const m=new Map,{tasks:v,scope:w}=s;for(const[T,P]of v.entries()){const O=this.getImage(P.id,w);O&&m.set(T,{image:O,imageVariant:P})}this._rasterizeImages(w,m,c)}_rasterizeImages(s,c,m){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:s},m);else{const v=new Map;for(const[w,{image:T,imageVariant:P}]of c.entries())v.set(w,this.imageRasterizer.rasterize(P,T,s,0));m(void 0,v)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,c,m){const v=this.images.get(c),w=new Map;for(const T of s){if(!v.get(T.toString())){if(T.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:T.name}))}const P=v.get(T.toString());if(!P){i.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(O,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),w.set(i.I.toString(T),O)}m(null,w)}getPixelSize(s){const{width:c,height:m}=this.atlasImage.get(s);return{width:c,height:m}}getPattern(s,c,m){const v=s.toString(),w=this.patterns.get(c),T=w.get(v),P=this.getImage(s,c);if(!P)return null;if(T){if(T.position.version===P.version)return T.position;T.position.version=P.version}else{if(P.usvg&&!P.data){const O=this.getPatternInFlightId(v,c);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const D=new i.A(s).scaleSelf(i.o.devicePixelRatio),F=new Map([[D.toString(),{image:P,imageVariant:D}]]);return this._rasterizeImages(c,F,(W,H)=>this.storePatternImage(D,c,P,m,H)),null}this.storePattern(s,c,P)}return this._updatePatternAtlas(c,m),w.get(v).position}getPatternInFlightId(s,c){return i.B(s,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,c,m,v,w){const T=s.toString(),P=w?w.get(T):void 0;P&&(m.data=P,this.storePattern(s.id,c,m),this._updatePatternAtlas(c,v),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),c)))}storePattern(s,c,m){const v={w:m.data.width+2*i.C,h:m.data.height+2*i.C,x:0,y:0},w=new i.F(v,m,i.C);this.patterns.get(c).set(s.toString(),{bin:v,position:w})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,c){const m=s.gl;let v=this.atlasTexture.get(c);v?this.dirty&&(v.update(this.atlasImage.get(c)),this.dirty=!1):(v=new i.T(s,this.atlasImage.get(c),m.RGBA8),this.atlasTexture.set(c,v)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(s,c){const m=this.patterns.get(s),v=Array.from(m.values()).map(({bin:D})=>D),{w,h:T}=i.G(v),P=this.atlasImage.get(s);P.resize({width:w||1,height:T||1});const O=this.images.get(s);for(const[D,{bin:F,position:W}]of m.entries()){let H=W.padding;const q=F.x+H,ee=F.y+H,Y=O.get(D).data,ae=Y.width,oe=Y.height;H=H>1?H-1:H,i.q.copy(Y,P,{x:0,y:0},{x:q,y:ee},{width:ae,height:oe},c),i.q.copy(Y,P,{x:0,y:oe-H},{x:q,y:ee-H},{width:ae,height:H},c),i.q.copy(Y,P,{x:0,y:0},{x:q,y:ee+oe},{width:ae,height:H},c),i.q.copy(Y,P,{x:ae-H,y:0},{x:q-H,y:ee},{width:H,height:oe},c),i.q.copy(Y,P,{x:0,y:0},{x:q+ae,y:ee},{width:H,height:oe},c),i.q.copy(Y,P,{x:ae-H,y:oe-H},{x:q-H,y:ee-H},{width:H,height:H},c),i.q.copy(Y,P,{x:0,y:oe-H},{x:q+ae,y:ee-H},{width:H,height:H},c),i.q.copy(Y,P,{x:0,y:0},{x:q+ae,y:ee+oe},{width:H,height:H},c),i.q.copy(Y,P,{x:ae-H,y:0},{x:q-H,y:ee+oe},{width:H,height:H},c)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,c){const m=this.images.get(c);for(const v of s){if(this.callbackDispatchedThisFrame.get(c).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(v.toString());const w=m.get(v.toString());zs(w)&&this.updateImage(v,c,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function co(p){const s=p.value,c=p.valueSpec,m=p.style,v=p.styleSpec,w=p.key,T=p.arrayElementValidator||ln;if(!Array.isArray(s))return[new i.V(w,s,`array expected, ${i.K(s)} found`)];if(c.length&&s.length!==c.length)return[new i.V(w,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new i.V(w,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let P={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(P.function=c.function),i.H(c.value)&&(P=c.value);let O=[];for(let D=0;D<s.length;D++)O=O.concat(T({array:s,arrayIndex:D,value:s[D],valueSpec:P,style:m,styleSpec:v,key:`${w}[${D}]`},!0));return O}function Co(p){const s=p.key,c=p.value,m=p.valueSpec;if(!i.L(c))return[new i.V(s,c,`number expected, ${i.K(c)} found`)];if(c!=c)return[new i.V(s,c,"number expected, NaN found")];if("minimum"in m){let v=m.minimum;if(Array.isArray(m.minimum)&&(v=m.minimum[p.arrayIndex]),c<v)return[new i.V(s,c,`${c} is less than the minimum value ${v}`)]}if("maximum"in m){let v=m.maximum;if(Array.isArray(m.maximum)&&(v=m.maximum[p.arrayIndex]),c>v)return[new i.V(s,c,`${c} is greater than the maximum value ${v}`)]}return[]}function wo(p){const s=p.key,c=p.value;if(!i.H(c))return[new i.V(s,c,`object expected, ${i.K(c)} found`)];const m=p.valueSpec,v=i.J(c.type);let w,T,P,O={};const D=v!=="categorical"&&c.property===void 0,F=!D,W=function(Y){const ae=Y.stops;return Array.isArray(ae)&&Array.isArray(ae[0])&&i.H(ae[0][0])}(c),H=ui({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(Y){if(v==="identity")return[new i.V(Y.key,Y.value,'identity function may not have a "stops" property')];let ae=[];const oe=Y.value;return ae=ae.concat(co({key:Y.key,value:oe,valueSpec:Y.valueSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:q})),Array.isArray(oe)&&oe.length===0&&ae.push(new i.V(Y.key,oe,"array must have at least one stop")),ae},default:function(Y){return ln({key:Y.key,value:Y.value,valueSpec:m,style:Y.style,styleSpec:Y.styleSpec})}}});return v==="identity"&&D&&H.push(new i.V(p.key,p.value,'missing required property "property"')),v==="identity"||c.stops||H.push(new i.V(p.key,p.value,'missing required property "stops"')),v==="exponential"&&m.expression&&!i.M(m)&&H.push(new i.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(F&&!i.N(m)?H.push(new i.V(p.key,p.value,"property functions not supported")):D&&!i.O(m)&&H.push(new i.V(p.key,p.value,"zoom functions not supported"))),v!=="categorical"&&!W||c.property!==void 0||H.push(new i.V(p.key,p.value,'"property" property is required')),H;function q(Y){let ae=[];const oe=Y.value,de=Y.key;if(!Array.isArray(oe))return[new i.V(de,oe,`array expected, ${i.K(oe)} found`)];if(oe.length!==2)return[new i.V(de,oe,`array length 2 expected, length ${oe.length} found`)];if(W){if(!i.H(oe[0]))return[new i.V(de,oe,`object expected, ${i.K(oe[0])} found`)];const me=oe[0];if(me.zoom===void 0)return[new i.V(de,oe,"object stop key must have zoom")];if(me.value===void 0)return[new i.V(de,oe,"object stop key must have value")];const fe=i.J(me.zoom);if(typeof fe!="number")return[new i.V(de,me.zoom,"stop zoom values must be numbers")];if(P&&P>fe)return[new i.V(de,me.zoom,"stop zoom values must appear in ascending order")];fe!==P&&(P=fe,T=void 0,O={}),ae=ae.concat(ui({key:`${de}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Co,value:ee}}))}else ae=ae.concat(ee({key:`${de}[0]`,value:oe[0],style:Y.style,styleSpec:Y.styleSpec},oe));return i.Q(i.S(oe[1]))?ae.concat([new i.V(`${de}[1]`,oe[1],"expressions are not allowed in function stops.")]):ae.concat(ln({key:`${de}[1]`,value:oe[1],valueSpec:m,style:Y.style,styleSpec:Y.styleSpec}))}function ee(Y,ae){const oe=i.K(Y.value),de=i.J(Y.value),me=Y.value!==null?Y.value:ae;if(w){if(oe!==w)return[new i.V(Y.key,me,`${oe} stop domain type must match previous stop domain type ${w}`)]}else w=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof de!="number"&&typeof de!="string"&&typeof de!="boolean")return[new i.V(Y.key,me,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&v!=="categorical"){let fe=`number expected, ${oe} found`;return i.N(m)&&v===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(Y.key,me,fe)]}return v!=="categorical"||oe!=="number"||typeof de=="number"&&isFinite(de)&&Math.floor(de)===de?v!=="categorical"&&oe==="number"&&typeof de=="number"&&typeof T=="number"&&T!==void 0&&de<T?[new i.V(Y.key,me,"stop domain values must appear in ascending order")]:(T=de,v==="categorical"&&de in O?[new i.V(Y.key,me,"stop domain values must be unique")]:(O[de]=!0,[])):[new i.V(Y.key,me,`integer expected, found ${String(de)}`)]}}function Hi(p){const s=(p.expressionContext==="property"?i.W:i.U)(i.S(p.value),p.valueSpec);if(s.result==="error")return s.value.map(m=>new i.V(`${p.key}${m.key}`,p.value,m.message));const c=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!i.Z(c))return[new i.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return is(c,p);if(p.expressionContext==="appearance")return Io(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!i.X(c,["zoom","feature-state"]))return[new i.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!i.Y(c))return[new i.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function is(p,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)c.delete(v);if(c.size===0)return[];const m=[];return p instanceof i._&&c.has(p.name)?[new i.V(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(v=>{m.push(...is(v,s))}),m)}function Io(p,s){const c=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)c.add(v);if(c.size===0)return[];const m=[];return p instanceof i._&&!c.has(p.name)?[new i.V(s.key,s.value,`["${p.name}"] is not an allowed parameter`)]:(p.eachChild(v=>{m.push(...Io(v,s))}),m)}function jo(p){const s=p.key,c=p.value,m=p.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(i.J(c))===-1&&v.push(new i.V(s,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(m.values).indexOf(i.J(c))===-1&&v.push(new i.V(s,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function qs(p){return i.a2(i.S(p.value))?Hi(Object.assign({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Do(p)}function Do(p){const s=p.value,c=p.key;if(!Array.isArray(s))return[new i.V(c,s,`array expected, ${i.K(s)} found`)];if(s.length<1)return[new i.V(c,s,"filter array must have at least 1 element")];const m=p.styleSpec;let v=jo({key:`${c}[0]`,value:s[0],valueSpec:m.filter_operator});const w=()=>{s.length>=2&&(i.a0(s[1])||v.push(new i.V(`${c}[1]`,s[1],`string expected, ${i.K(s[1])} found`)));for(let T=2;T<s.length;T++)i.J(s[1])==="$type"?v=v.concat(jo({key:`${c}[${T}]`,value:s[T],valueSpec:m.geometry_type})):i.a0(s[T])||i.L(s[T])||i.$(s[T])||v.push(new i.V(`${c}[${T}]`,s[T],`string, number, or boolean expected, ${i.K(s[T])} found.`))};switch(i.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.J(s[1])==="$type"&&v.push(new i.V(c,s,`"$type" cannot be use with operator "${s[0]}"`)),s.length!==3&&v.push(new i.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`)),w();break;case"==":case"!=":s.length!==3&&v.push(new i.V(c,s,`filter array for operator "${s[0]}" must have 3 elements`)),w();break;case"in":case"!in":w();break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)v=v.concat(Do({key:`${c}[${T}]`,value:s[T],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":s.length!==2?v.push(new i.V(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):i.a0(s[1])||v.push(new i.V(`${c}[1]`,s[1],`string expected, ${i.K(s[1])} found`))}return v}function Fs(p,s){const c=p.key,m=p.style,v=p.layer,w=p.styleSpec,T=p.value,P=p.objectKey,O=w[`${s}_${p.layerType}`];if(!O)return[];const D=P.match(/^(.*)-use-theme$/);if(D&&O[D[1]])return i.Q(i.S(T))?[].concat(ln({key:c,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:P})):ln({key:c,value:T,valueSpec:{type:"string"},style:m,styleSpec:w});const F=P.match(/^(.*)-transition$/);if(s==="paint"&&F&&O[F[1]]&&O[F[1]].transition)return ln({key:c,value:T,valueSpec:w.transition,style:m,styleSpec:w});const W=p.valueSpec||O[P];if(!W)return[new i.a3(c,T,`unknown property "${P}"`)];let H;if(i.a0(T)&&i.N(W)&&!W.tokens&&(H=/^{([^}]+)}$/.exec(T))){const ee=`\`{ "type": "identity", "property": ${H?JSON.stringify(H[1]):'"_"'} }\``;return[new i.V(c,T,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${ee}.`)]}const q=[];if(p.layerType==="symbol")P!=="text-field"||!m||m.glyphs||m.imports||q.push(new i.V(c,T,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&i.a4(i.S(T))&&i.J(T.type)==="identity"&&q.push(new i.V(c,T,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&i.N(W)&&(i.a5(W)||i.O(W))){const ee=i.W(i.S(T),W).value,Y="expression"in ee&&ee.expression||"_styleExpression"in ee&&ee._styleExpression&&ee._styleExpression.expression;Y&&!i.X(Y,["measure-light"])&&(P==="model-emissive-strength"&&i.Y(Y)&&i.Z(Y)||q.push(new i.V(c,T,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(ln({key:p.key,value:T,valueSpec:W,style:m,styleSpec:w,expressionContext:"property",propertyType:s,propertyKey:P}))}function Pa(p){return Fs(p,"paint")}function Zt(p){return Fs(p,"layout")}function qt(p){let s=[];const c=p.value,m=p.key,v=p.style,w=p.styleSpec;if(!i.H(c))return[new i.V(m,c,"object expected")];c.type||c.ref||s.push(new i.V(m,c,'either "type" or "ref" is required'));let T=i.J(c.type);const P=i.J(c.ref);if(c.id){const O=i.J(c.id);for(let D=0;D<p.arrayIndex;D++){const F=v.layers[D];i.J(F.id)===O&&s.push(new i.V(m,c.id,`duplicate layer id "${O}", previously used at line ${F.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach(D=>{D in c&&s.push(new i.V(m,c[D],`"${D}" is prohibited for ref layers`))}),v.layers.forEach(D=>{i.J(D.id)===P&&(O=D)}),O?O.ref?s.push(new i.V(m,c.ref,"ref cannot reference another ref layer")):T=i.J(O.type):typeof P=="string"&&s.push(new i.V(m,c.ref,`ref layer "${P}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(c.source)if(i.a0(c.source)){const O=v.sources&&v.sources[c.source],D=O&&i.J(O.type);O?D==="vector"&&T==="raster"?s.push(new i.V(m,c.source,`layer "${c.id}" requires a raster source`)):D==="raster"&&T!=="raster"?s.push(new i.V(m,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&T!=="hillshade"?s.push(new i.V(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&D==="geojson"&&!O.lineMetrics?s.push(new i.V(m,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&D!=="raster-array"&&s.push(new i.V(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new i.V(m,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(m,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new i.V(m,c.source,`source "${c.source}" not found`))}else s.push(new i.V(`${m}.source`,c.source,'"source" must be a string'));else s.push(new i.V(m,c,'missing required property "source"'));return s=s.concat(ui({key:m,value:c,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ln({key:`${m}.type`,value:c.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:O=>qs(Object.assign({layerType:T},O)),layout:O=>ui({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":D=>Zt(Object.assign({layerType:T},D))}}),paint:O=>ui({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":D=>Pa(Object.assign({layerType:T,layer:c},D))}}),appearances(O){const D=co({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:H=>function(q){const{key:ee,layer:Y,layerType:ae}=q,oe=i.J(q.value),de=i.J(oe.name),me=i.J(oe.condition),fe=ui({key:ee,value:oe,valueSpec:q.styleSpec.appearance,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{condition:Pe=>function(be){const Ae=[];return Ae.push(...Hi({key:be.key,value:be.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ae}(Object.assign({layer:Y,layerType:ae},Pe)),properties:Pe=>function(be){const Ae=[],{styleSpec:xe,layer:ye,layerType:Ce}=be,$e=xe[`paint_${Ce}`],Ne=xe[`layout_${Ce}`],et=be.object[be.objectKey];for(const tt in et){const dt=tt in $e?"paint":tt in Ne?"layout":void 0;if(!dt){Ae.push(new i.V(be.key,tt,`unknown property "${tt}" for layer type "${Ce}"`));continue}const Tt=Object.assign({},be,{key:`${be.key}.${tt}`,object:et,objectKey:tt,layer:ye,layerType:Ce,value:et[tt],valueSpec:dt==="paint"?$e[tt]:Ne[tt]});Ae.push(...Fs(Tt,dt))}return Ae}(Object.assign({layer:Y,layerType:ae},Pe))}});return de!=="hidden"&&me===void 0&&fe.push(new i.V(q.key,"name",'Appearance with name different than "hidden" must have a condition')),fe}(Object.assign({layerType:T,layer:c},H))}),F=Array.isArray(O.value)?O.value:[],W=new Set;return F.forEach((H,q)=>{const ee=i.J(H.name);if(ee)if(W.has(ee)){const Y=i.J(c.id);D.push(new i.V(O.key,ee,`Duplicated appearance name "${ee}" for layer "${Y}"`))}else W.add(ee)}),D}}})),s}function fr({key:p,value:s}){return i.a0(s)?[]:[new i.V(p,s,`string expected, ${i.K(s)} found`)]}const Ir={promoteId:function p({key:s,value:c}){if(i.a0(c))return fr({key:s,value:c});if(Array.isArray(c)){const v=[],w=i.S(c),T=i.U(w);return T.result==="error"&&T.value.forEach(P=>{v.push(new i.V(`${s}${P.key}`,null,`${P.message}`))}),i.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||v.push(new i.V(`${s}`,null,"promoteId expression should be only feature dependent")),v}if(!i.H(c))return[new i.V(s,c,`string, expression or object expected, "${i.K(c)}" found`)];const m=[];for(const v in c)m.push(...p({key:`${s}.${v}`,value:c[v]}));return m}};function On(p){const s=p.value,c=p.key,m=p.styleSpec,v=p.style;if(!i.H(s))return[new i.V(c,s,`object expected, ${i.K(s)} found`)];if(!("type"in s))return[new i.V(c,s,'"type" is required')];const w=i.J(s.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in s||"tiles"in s||T.push(new i.a3(c,s,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(ui({key:c,value:s,valueSpec:m[`source_${w.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:Ir})),T;case"geojson":if(T=ui({key:c,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:Ir}),"cluster"in s&&"clusterProperties"in s){if(!i.H(s.clusterProperties))return[new i.V(`${c}.clusterProperties`,s,`object expected, ${i.K(s)} found`)];for(const P in s.clusterProperties){const O=s.clusterProperties[P];if(!Array.isArray(O))return[new i.V(`${c}.clusterProperties.${P}`,O,"array expected")];const[D,F]=O,W=typeof D=="string"?[D,["accumulated"],["get",P]]:D;T.push(...Hi({key:`${c}.${P}.map`,value:F,expressionContext:"cluster-map"})),T.push(...Hi({key:`${c}.${P}.reduce`,value:W,expressionContext:"cluster-reduce"}))}}return T;case"video":return ui({key:c,value:s,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return ui({key:c,value:s,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return jo({key:`${c}.type`,value:s.type,valueSpec:{values:Ii(m)}})}}function Ii(p){return p.source.reduce((s,c)=>{const m=p[c];return m.type.type==="enum"&&(s=s.concat(Object.keys(m.type.values||{}))),s},[])}function eo(p){const s=p.value,c=p.styleSpec,m=c.light,v=p.style;if(s===void 0)return[];if(!i.H(s))return[new i.V("light",s,`object expected, ${i.K(s)} found`)];let w=[];for(const T in s){const P=T.match(/^(.*)-transition$/),O=T.match(/^(.*)-use-theme$/);w=w.concat(O&&m[O[1]]?ln({key:T,value:s[T],valueSpec:{type:"string"},style:v,styleSpec:c}):P&&m[P[1]]&&m[P[1]].transition?ln({key:T,value:s[T],valueSpec:c.transition,style:v,styleSpec:c}):m[T]?ln({key:T,value:s[T],valueSpec:m[T],style:v,styleSpec:c}):[new i.V(T,s[T],`unknown property "${T}"`)])}return w}function $o(p){const s=p.value;if(!s)return[];const c=p.key;if(!i.H(s))return[new i.V(c,s,`object expected, ${i.K(s)} found`)];let m=[];const v=p.styleSpec,w=v["light-3d"],T=p.style,P=p.style.lights;for(const F of["type","id"])if(!(F in s))return m=m.concat([new i.V(c,s,`missing property "${F}"`)]),m;if(!i.a0(s.type))return m=m.concat([new i.V(`${c}.type`,s.type,"string expected")]),m;if(P)for(let F=0;F<p.arrayIndex;F++){const W=i.J(s.type),H=P[F];i.J(H.type)===W&&m.push(new i.V(c,s.id,`duplicate light type "${s.type}", previously defined at line ${H.id.__line__}`))}const O=`properties_light_${s.type}`;if(!(O in v))return m=m.concat([new i.V(`${c}.type`,s,`Invalid light type ${s.type}`)]),m;const D=v[O];for(const F in s)if(F==="properties"){const W=s[F];if(!i.H(W))return m=m.concat([new i.V("properties",W,`object expected, ${i.K(W)} found`)]),m;for(const H in W){const q=H.match(/^(.*)-transition$/),ee=H.match(/^(.*)-use-theme$/);m=m.concat(ee&&D[ee[1]]?ln({key:F,value:W[H],valueSpec:{type:"string"},style:T,styleSpec:v}):q&&D[q[1]]&&D[q[1]].transition?ln({key:F,value:s[F],valueSpec:v.transition,style:T,styleSpec:v}):D[H]?ln({key:H,value:W[H],valueSpec:D[H],style:T,styleSpec:v}):[new i.a3(p.key,W[H],`unknown property "${H}"`)])}}else m=m.concat(w[F]?ln({key:F,value:s[F],valueSpec:w[F],style:T,styleSpec:v}):[new i.a3(F,s[F],`unknown property "${F}"`)]);return m}function Lo(p){const s=p.value,c=p.key,m=p.style,v=p.styleSpec,w=v.terrain;if(s==null)return[];if(!i.H(s))return[new i.V("terrain",s,`object expected, ${i.K(s)} found`)];let T=[];for(const P in s){const O=P.match(/^(.*)-transition$/),D=P.match(/^(.*)-use-theme$/);T=T.concat(D&&w[D[1]]?ln({key:P,value:s[P],valueSpec:{type:"string"},style:m,styleSpec:v}):O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:s[P],valueSpec:v.transition,style:m,styleSpec:v}):w[P]?ln({key:P,value:s[P],valueSpec:w[P],style:m,styleSpec:v}):[new i.a3(P,s[P],`unknown property "${P}"`)])}if(s.source)if(i.a0(s.source)){const P=m.sources&&m.sources[s.source],O=P&&i.J(P.type);P?O!=="raster-dem"&&T.push(new i.V(`${c}.source`,s.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):T.push(new i.V(`${c}.source`,s.source,`source "${s.source}" not found`))}else T.push(new i.V(`${c}.source`,s.source,"source must be a string"));else T.push(new i.V(c,s,'terrain is missing required property "source"'));return T}function Ca(p){const s=p.value,c=p.style,m=p.styleSpec,v=m.fog;if(s===void 0)return[];if(!i.H(s))return[new i.V("fog",s,`object expected, ${i.K(s)} found`)];let w=[];for(const T in s){const P=T.match(/^(.*)-transition$/),O=T.match(/^(.*)-use-theme$/);w=w.concat(O&&v[O[1]]?ln({key:T,value:s[T],valueSpec:{type:"string"},style:c,styleSpec:m}):P&&v[P[1]]&&v[P[1]].transition?ln({key:T,value:s[T],valueSpec:m.transition,style:c,styleSpec:m}):v[T]?ln({key:T,value:s[T],valueSpec:v[T],style:c,styleSpec:m}):[new i.a3(T,s[T],`unknown property "${T}"`)])}return w}const Mi={"*":()=>[],array:co,boolean:function(p){const s=p.value,c=p.key;return i.$(s)?[]:[new i.V(c,s,`boolean expected, ${i.K(s)} found`)]},number:Co,color:function({key:p,value:s}){return i.a0(s)?i.a1.parseCSSColor(s)===null?[new i.V(p,s,`color expected, "${s}" found`)]:[]:[new i.V(p,s,`color expected, ${i.K(s)} found`)]},enum:jo,filter:qs,function:wo,layer:qt,object:ui,source:On,model:i.a7,light:eo,"light-3d":$o,terrain:Lo,fog:Ca,string:fr,formatted:function(p){return fr(p).length===0?[]:Hi(p)},resolvedImage:function(p){return fr(p).length===0?[]:Hi(p)},projection:function(p){const s=p.value,c=p.styleSpec,m=c.projection,v=p.style;if(i.H(s)){let w=[];for(const T in s)w=w.concat(ln({key:T,value:s[T],valueSpec:m[T],style:v,styleSpec:c}));return w}return i.a0(s)?[]:[new i.V("projection",s,`object or string expected, ${i.K(s)} found`)]},import:function(p){const s=p.key,{value:c,styleSpec:m}=p;if(!i.H(c))return[new i.V(s,c,"import must be an object")];const{data:v,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let T=ui(Object.assign({},p,{value:w,valueSpec:m.import}));return i.J(w.id)===""&&T.push(new i.V(`${p.key}.id`,w,"import id can't be an empty string")),v&&(T=T.concat(Zn(v,m,{key:`${p.key}.data`}))),T},iconset:function(p){const s=p.value,c=p.key,m=p.styleSpec,v=p.style;if(!i.H(s))return[new i.V(c,s,"object expected")];if(!s.type)return[new i.V(c,s,'"type" is required')];const w=i.J(s.type);let T=[];if(T=T.concat(ui({key:c,value:s,valueSpec:m[`iconset_${w}`],style:v,styleSpec:m})),function(P,O){return!(P!=="source"||!O.source)}(w,s)){const P=v.sources&&v.sources[s.source],O=P&&i.J(P.type);P?O!=="raster-array"&&T.push(new i.V(c,s.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):T.push(new i.V(c,s.source,`source "${s.source}" not found`))}return T}};function ln(p,s=!1){const c=p.value,m=p.valueSpec,v=p.styleSpec;if(m.expression){if(i.a4(i.J(c)))return wo(p);if(i.Q(i.S(c)))return Hi(p)}if(m.type&&Mi[m.type]){const w=Mi[m.type](p);return s===!0&&w.length>0&&Array.isArray(p.value)?Hi(p):w}return ui(Object.assign({},p,{valueSpec:m.type?v[m.type]:m}))}function ui(p){const s=p.key,c=p.value,m=p.valueSpec||{},v=p.objectElementValidators||{},w=p.style,T=p.styleSpec;if(!i.H(c))return[new i.V(s,c,`object expected, ${i.K(c)} found`)];let P=[];for(const O in c){const D=O.split(".")[0];let F;v[D]?F=v[D]:m[D]?F=ln:v["*"]?F=v["*"]:m["*"]&&(F=ln),F?P=P.concat(F({key:(s&&`${s}.`)+O,value:c[O],valueSpec:m[D]||m["*"],style:w,styleSpec:T,object:c,objectKey:O},c)):P.push(new i.a3(s,c[O],`unknown property "${O}"`))}for(const O in m){if(v[O])continue;const D=m[O];D.required&&D.default===void 0&&c[O]===void 0&&P.push(new i.V(s,c,`missing required property "${O}"`))}return P}function on({key:p,value:s}){const c=fr({key:p,value:s});if(c.length)return c;const m=s;return m.indexOf("{fontstack}")===-1&&c.push(new i.V(p,s,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&c.push(new i.V(p,s,'"glyphs" url must include a "{range}" token')),c}function Zn(p,s=i.a6,c={}){return ui({key:c.key||"",value:p,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:p,objectElementValidators:{glyphs:on}})}function ei(p,s=i.a6){return ce(Zn(p,s))}const Vo=p=>ce(On(p)),mt=p=>ce(eo(p)),qo=p=>ce($o(p)),Ia=p=>ce(Lo(p)),Uo=p=>ce(Ca(p)),Zr=p=>ce(function(s){const c=s.value,m=s.style,v=s.styleSpec,w=v.snow;if(c===void 0)return[];if(!i.H(c))return[new i.V("snow",c,`object expected, ${i.K(c)} found`)];let T=[];for(const P in c){const O=P.match(/^(.*)-transition$/);T=T.concat(O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:c[P],valueSpec:v.transition,style:m,styleSpec:v}):w[P]?ln({key:P,value:c[P],valueSpec:w[P],style:m,styleSpec:v}):[new i.a3(P,c[P],`unknown property "${P}"`)])}return T}(p)),os=p=>ce(function(s){const c=s.value,m=s.style,v=s.styleSpec,w=v.rain;if(c===void 0)return[];if(!i.H(c))return[new i.V("rain",c,`object expected, ${i.K(c)} found`)];let T=[];for(const P in c){const O=P.match(/^(.*)-transition$/);T=T.concat(O&&w[O[1]]&&w[O[1]].transition?ln({key:P,value:c[P],valueSpec:v.transition,style:m,styleSpec:v}):w[P]?ln({key:P,value:c[P],valueSpec:w[P],style:m,styleSpec:v}):[new i.a3(P,c[P],`unknown property "${P}"`)])}return T}(p)),Py=p=>ce(qt(p)),au=p=>ce(qs(p)),fh=p=>ce(Pa(p)),We=p=>ce(Zt(p)),ne=p=>ce(i.a7(p));function ce(p){return p.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function ge(p,s){let c=!1;if(s&&s.length)for(const m of s)m instanceof i.a3?i.w(m.message):(p.fire(new i.y(new Error(m.message))),c=!0);return c}const Re=i.a6.light;let Ie;class Fe extends i.E{constructor(s,c="flat"){super(),this._transitionable=new i.a8(Ie||(Ie=new i.a9({anchor:new i.aa(Re.anchor),position:new i.ab(Re.position),color:new i.aa(Re.color),intensity:new i.aa(Re.intensity)}))),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,m={}){this._validate(mt,s,m)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&ge(this,s.call(ei,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Qe=i.a6.terrain;let Ue=class extends i.E{constructor(p,s,c,m,v){super(),this.scope=c,this._transitionable=new i.a8(new i.a9({source:new i.aa(Qe.source),exaggeration:new i.aa(Qe.exaggeration)}),c,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=v}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new i.ac(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const s=p.value.expression;if(!s)return null;let c=-1,m=-1,v=1;for(const w of s.zoomStops)v=s.evaluate(new i.ac(w,{worldview:this.worldview})),v>.01?(c=w,m=-1):m=w;return v<.01&&c>0&&m>c?[c,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof i.ad}};const Je=45,St=65,ht=.05;function Kt(p,s,c,m){const v=i.ah(Je,St,c),[w,T]=dr(p,m);let P=1-Math.min(1,Math.exp((s-w)/(T-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*v*p.alpha}function dr(p,s){const c=.5/Math.tan(.5*s);return[p.range[0]+c,p.range[1]+c]}function Ut(p,s,c,m,v){const w=i.af([],[s,c,m],v.mercatorFogMatrix);return Kt(p,i.ag(w),v.pitch,v._fov)}function Fr(p,s,c,m,v,w,T){const P=[[c,m,0],[v,m,0],[v,w,0],[c,w,0]];let O=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const F of P){const W=i.af([],F,s),H=i.ag(W);O=Math.min(O,H),D=Math.max(D,H)}return[Kt(p,O,T.pitch,T._fov),Kt(p,D,T.pitch,T._fov)]}const Lr=i.a6.fog;class jr extends i.E{constructor(s,c,m,v){super();const w=new i.a9({range:new i.aa(Lr.range),color:new i.aa(Lr.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Lr["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Lr["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Lr["horizon-blend"]),"star-intensity":new i.aa(Lr["star-intensity"]),"vertical-range":new i.aa(Lr["vertical-range"])});this._transitionable=new i.a8(w,m,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ai(w),this.scope=m}get state(){const s=this._transform,c=s.projection.name==="globe",m=i.aj(s.zoom),v=this.properties.get("range"),w=[.5,3];return{range:c?[i.ak(w[0],v[0],m),i.ak(w[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,m={}){if(this._validate(Uo,s,m))return;const v=Object.assign({},s);for(const w of Object.keys(Lr))v[w]===void 0&&(v[w]=Lr[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(Je,St,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(m,v,w){const T=i.ae.fromLngLat(v),P=w.elevation?w.elevation.getAtPointOrZero(T):0;return Ut(m,T.x,T.y,P,w)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Fr(this.state,c,0,0,i.al,i.al,this._transform)}getOpacityForBounds(s,c,m,v,w){return this._transform.projection.supportsFog?Fr(this.state,s,c,m,v,w,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?dr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const m of c){const v=s.points[m];let w;if(v[2]>=0)w=v;else{const T=s.points[m-4];w=i.am(T,v,T[2]/(T[2]-v[2]))}if(Ut(this.state,w[0],w[1],0,this._transform)>=ht)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&ge(this,s.call(ei,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let dn,Ei,Wi,Oi,Ji=class extends i.E{constructor(p,s,c,m){super();const v=dn||(dn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(v,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=c}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),m=i.an(c[0]),v=-Math.max(i.an(c[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(p,s,c={}){if(this._validate(Zr,p,c))return;const m=Object.assign({},p),v=i.a6.snow;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,c){return(!c||c.validate!==!1)&&ge(this,p.call(ei,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},wi=class extends i.E{constructor(p,s,c,m){super();const v=Ei||(Ei=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(v,c,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(v),this.scope=c}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),c=this.properties.get("direction"),m=i.an(c[0]),v=-Math.max(i.an(c[1]),.01),w=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*p),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(p,s,c={}){if(this._validate(os,p,c))return;const m=Object.assign({},p),v=i.a6.rain;for(const w of Object.keys(v))m[w]===void 0&&(m[w]=v[w].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,c){return(!c||c.validate!==!1)&&ge(this,p.call(ei,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class gn extends i.E{constructor(s,c,m,v){super(),this.scope=m,this._options=s,this.properties=new i.ai(c),this._transitionable=new i.a8(c,m,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Si{constructor(s,c,m){this.screenBounds=s,this.cameraPoint=m.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(s,c){let m,v;if(s instanceof i.P||typeof s[0]=="number"){const w=i.P.convert(s);m=[w],v=c.isPointAboveHorizon(w)}else{const w=i.P.convert(s[0]),T=i.P.convert(s[1]),P=w.add(T)._div(2);m=[w,T],v=i.aq(w,T).every(O=>c.isPointAboveHorizon(O))&&c.isPointAboveHorizon(P)}return new Si(m,v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),i.ar(v,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],v=i.aq(c,m,s),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>m.y))+((w.x>c.x)+(w.x>m.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(s,c,m,v=0){const w=Math.max(s.queryPadding,s.evaluateQueryRenderedFeaturePadding())/c._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let P=s.tileID.wrap+(T.unwrapped?v:0);const O=T.polygon.map(ae=>i.as(s.tileTransform,ae,P));if(!i.at(O,0,0,i.al,i.al))return;P=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const D=this.screenGeometryMercator.polygon.map(ae=>i.au(s.tileTransform,ae,P)),F=D.map(ae=>new i.P(ae[0],ae[1])),W=c.getFreeCameraOptions().position||new i.ae(0,0,0),H=i.au(s.tileTransform,W,P),q=D.map(ae=>{const oe=i.av(ae,ae,H);return i.aw(oe,oe),new i.ax(H,oe)}),ee=i.ay(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:q,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(Y=i.az(O),Y.min.x=i.aA(Y.min.x,0,i.al),Y.min.y=i.aA(Y.min.y,0,i.al),Y.max.x=i.aA(Y.max.x,0,i.al),Y.max.y=i.aA(Y.max.y,0,i.al),Y),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:ee};var Y}_bufferedScreenMercator(s,c){const m=Ri(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(s,c){const m=Ri(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(s,c){const m=function(w,T){const P=i.aB([],T.pixelMatrix,T.globeMatrix),O=[0,-i.aD,0,1],D=[0,i.aD,0,1],F=[0,0,0,1];i.aC(O,O,P),i.aC(D,D,P),i.aC(F,F,P);const W=new i.P(O[0]/O[3],O[1]/O[3]),H=new i.P(D[0]/D[3],D[1]/D[3]),q=i.aE(w,W)&&O[3]<F[3],ee=i.aE(w,H)&&D[3]<F[3];if(!q&&!ee)return null;const Y=function(Ae,xe,ye){for(let Ce=1;Ce<Ae.length;Ce++){const $e=Jr(xe.pointCoordinate3D(Ae[Ce-1]).x),Ne=Jr(xe.pointCoordinate3D(Ae[Ce]).x);if(ye<0){if($e<Ne)return{idx:Ce,t:-$e/(Ne-1-$e)}}else if(Ne<$e)return{idx:Ce,t:(1-$e)/(Ne+1-$e)}}return null}(w,T,q?-1:1);if(!Y)return null;const{idx:ae,t:oe}=Y;let de=ae>1?ti(w.slice(0,ae),T):[],me=ae<w.length?ti(w.slice(ae),T):[];de=de.map(Ae=>new i.P(Jr(Ae.x),Ae.y)),me=me.map(Ae=>new i.P(Jr(Ae.x),Ae.y));const fe=[...de];fe.length===0&&fe.push(me[me.length-1]);const Pe=i.ak(fe[fe.length-1].y,(me.length===0?de[0]:me[0]).y,oe);let be;return be=q?[new i.P(0,Pe),new i.P(0,0),new i.P(1,0),new i.P(1,Pe)]:[new i.P(1,Pe),new i.P(1,1),new i.P(0,1),new i.P(0,Pe)],fe.push(...be),me.length===0?fe.push(de[0]):fe.push(...me),{polygon:fe.map(Ae=>new i.ae(Ae.x,Ae.y)),unwrapped:!1}}(s,c);if(m)return m;const v=function(w,T){let P=!1,O=-1/0,D=0;for(let W=0;W<w.length-1;W++)w[W].x>O&&(O=w[W].x,D=W);for(let W=0;W<w.length-1;W++){const H=(D+W)%(w.length-1),q=w[H],ee=w[H+1];Math.abs(q.x-ee.x)>.5&&(q.x<ee.x?(q.x+=1,H===0&&(w[w.length-1].x+=1)):(ee.x+=1,H+1===w.length-1&&(w[0].x+=1)),P=!0)}const F=i.aF(T.center.lng);return P&&F<Math.abs(F-1)&&w.forEach(W=>{W.x-=1}),{polygon:w,unwrapped:P}}(ti(s,c).map(w=>new i.P(Jr(w.x),w.y)),c);return{polygon:v.polygon.map(w=>new i.ae(w.x,w.y)),unwrapped:v.unwrapped}}}function ti(p,s){return i.aG(p,c=>{const m=s.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function Jr(p){return p<0?1+p%1:p%1}function Ri(p){return 100*p|0}function Go(p,s,c,m,v){const w=function(P,O){if(P)return v(P);if(O){if(p.url&&O.tiles&&p.tiles&&delete p.tiles,O.variants){if(!Array.isArray(O.variants))return v(new Error("variants must be an array"));for(const F of O.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return v(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){O=Object.assign(O,F);break}}}const D=i.aH(Object.assign({},O,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=s.canonicalizeTileset(D,p.url),v(null,D)}},T=function(P,O,D){if(!P)return null;if(!O&&!D)return P;D=D||P.worldview_default;const F=Object.values(P.language||{});if(F.length===0)return null;const W=Object.values(P.worldview||{});if(W.length===0)return null;const H=F.every(ee=>ee===O),q=W.every(ee=>ee===D);return H&&q?P:O in(P.language_options||{})||D in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(p.data,c,m);return T?i.o.frame(()=>w(null,T)):p.url?i.m(s.transformRequest(s.normalizeSourceURL(p.url,null,c,m),i.R.Source),w):i.o.frame(()=>{const{data:P,...O}=p;w(null,O)})}function Zo(p,s){const c=Math.pow(2,s.z),m=Math.floor(i.aF(p.getWest())*c),v=Math.floor(i.aJ(p.getNorth())*c),w=Math.ceil(i.aF(p.getEast())*c),T=Math.ceil(i.aJ(p.getSouth())*c);return s.x>=m&&s.x<w&&s.y>=v&&s.y<T}class Cs{constructor(s,c,m){this.bounds=s?i.aI.convert(this.validateBounds(s)):null,this.minzoom=c||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const c of s)this.extraBounds.push(i.aI.convert(this.validateBounds(c)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!Zo(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Zo(c,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const c=new Cs(s.bounds,s.minzoom,s.maxzoom);return c.addExtraBounds(s.extra_bounds),c}}class lu extends i.E{constructor(s,c,m,v){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new i.aK}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=Go(this._options,this.map._requestManager,c,m,(v,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new i.y(v));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of w.vector_layers)this.vectorLayerIds.push(T.id),w.worldview&&w.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Cs.fromTileJSON(w),$t(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,c){const m=s.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(m),w=this.map._requestManager.transformRequest(v,i.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,P=T?{image:T.image.clone()}:null,O={request:w,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(m)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",O,D.bind(this));else if(s.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",O,D.bind(this),void 0,!0);else{const F=i.aL.call({deduped:this._deduped},O,(W,H)=>{if(W||!H)D.call(this,W);else{const q=i.aM(H.responseHeaders);O.data={rawData:H.rawData.slice(0),expires:q.expires,cacheControl:q.cacheControl},s.actor&&s.actor.send("loadTile",O,D.bind(this),void 0,!0)}},!0);s.request={cancel:F}}function D(F,W){return delete s.request,s.aborted?c(null):F&&F instanceof i.aN&&F.status!==404?c(F):(W&&W.resourceTiming&&(s.resourceTiming=W.resourceTiming),this.map._refreshExpiredTiles&&W&&s.setExpiryData(W),s.loadVectorData(W,this.map.painter),i.aO(this.dispatcher),c(null,W),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Mo extends i.E{constructor(s,c,m,v){super(),this.id=s,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,i.aH(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=Go(this._options,this.map._requestManager,null,c,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new i.y(m)):v&&(Object.assign(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),this.tileBounds=Cs.fromTileJSON(v),$t(v.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(m)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const m=i.o.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=i.n(this.map._requestManager.transformRequest(v,i.R.Tile),(w,T,P)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(w)return s.state="errored",c(w);if(!T)return c(null);const O=i.aM(P);this.map._refreshExpiredTiles&&s.setExpiryData(O),s.setTexture(T,this.map.painter),s.state="loaded",i.aO(this.dispatcher),c(null)})}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c&&c()}unloadTile(s,c){s.texture&&s.texture instanceof i.T?(s.destroy(!1),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Zs([p,s],c,m,{scaled:v=!0}={}){const{tileSize:w,buffer:T}=m,{x:P,y:O,z:D}=c;if(!isFinite(P)||!isFinite(O)||!isFinite(D))throw new Error("Invalid MRT header");const F=2**D,W=F*i.aF(p),H=F*i.aJ(s);return function([q,ee],Y,{scaled:ae=!0}={}){if(!Y)throw new Error("bandView is undefined");const{data:oe,tileSize:de,buffer:me,offset:fe,scale:Pe,dimension:be}=Y;if(q<-me||q>de+me||ee<-me||ee>de+me)throw new Error(`Point (${q}, ${ee}) out of bounds for tileSize=${de}, buffer=${me}`);const Ae=(ee+me)*(de+2*me)+(q+me);if(new Uint32Array(oe.buffer)[Ae]===4294967295)return null;let xe=[];xe=ae?[]:new Y.data.constructor(be);for(let ye=0;ye<be;ye++)xe[ye]=Math.round(1e12*(oe[be*Ae+ye]*Pe+fe))/1e12;return xe}([Math.min(Math.max(-T,Math.floor((W-P)*w)),w-1+T),Math.min(Math.max(-T,Math.floor((H-O)*w)),w-1+T)],m,{scaled:v})}class ss extends Mo{constructor(s,c,m,v){super(s,c,m,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,i.R.Tile),w={request:v,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor());const T=(P,O,D)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(P)return P.name==="AbortError"?void 0:(s.state="errored",c(P));if(this.map._refreshExpiredTiles&&O){const F=i.aM(D);s.setExpiryData(F)}if(this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!O)return c(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=O}c(null)};s.request=this.partial?s.fetchHeader(void 0,T.bind(this)):s.actor.send("loadTile",w,T.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,c){const m=s.texturePerLayer;if(s.flushAllQueues(),m.size){s.destroy(!1);for(const v of m.values())this.map.painter.saveTileTexture(v)}else s.destroy()}prepareTile(s,c,m,v){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(c,m,v,(w,T)=>{if(w)return s.state="errored",this.fire(new i.y(w)),void this.triggerRepaint(s);T&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(m,T,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===s),m=c&&c.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(s,c,m){if(!s)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;c instanceof i.aR?w=c.paint.get("raster-array-band"):c instanceof i.aS&&(w=c.paint.get("raster-particle-array-band"));const T=w||this.getInitialBand(v);if(T==null)return;if(!s.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(s,v,c.id,T);if(s.updateNeeded(c.id,T)&&!m)return;const P=s.textureDescriptorPerLayer.get(c.id);return Object.assign({},P,{texture:s.texturePerLayer.get(c.id)})}getImages(s,c){const m=new Map;for(const v of s)for(const w of c){const[T,P]=w.split("/"),O=v.getLayer(T);if(!O||!O.hasBand(P)||!O.hasDataForBand(P))continue;const{bytes:D,tileSize:F,buffer:W}=O.getBandView(P),H=F+2*W,q={data:new i.q({width:H,height:H},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(w,q)}return m}queryRasterArrayValueByBandId(s,c,m){const v=c._mrt;return new Promise(w=>{const T={},P=new Set;for(const[O,D]of Object.entries(v.layers)){if(m.layerName&&O!==m.layerName)continue;const F={};T[O]=F;for(const{bands:W}of D.dataIndex)for(const H of W)m.bands&&!m.bands.includes(H)||(P.add(i.B(O,H)),c.fetchBand(O,null,H,q=>{i.o.frame(()=>{F[H]=q?null:Zs([s.lng,s.lat],v,D.getBandView(H)),P.delete(i.B(O,H)),P.size===0&&w(T)})},!1))}P.size===0&&w(T)})}_loadTileForQuery(s,c){if(this._loadTileLoaded[s.uid])return void c(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(c);this._loadTilePending[s.uid]=[c];const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,i.R.Tile);s.actor.send("loadTile",{request:v,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(w,T,P)=>{if(w)return this._loadTilePending[s.uid].forEach(O=>O(w,null)),void delete this._loadTilePending[s.uid];if(!T)return this._loadTilePending[s.uid].forEach(O=>O(null,null)),void delete this._loadTilePending[s.uid];if(this.map._refreshExpiredTiles&&T){const O=i.aM(P);s.setExpiryData(O)}s._mrt=T,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach(O=>O(null,T)),this._loadTileLoaded[s.uid]=!0,delete this._loadTilePending[s.uid]},void 0,!0)}queryRasterArrayValueByAllBands(s,c,m){return new Promise((v,w)=>{this._loadTileForQuery(c,(T,P)=>{T?w(T):v(P?this.queryRasterArrayValueByBandId(s,c,m):null)})})}queryRasterArrayValue(s,c){const m=i.aT.convert(s),v=this.findLoadedParent(m);return v&&v._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(m,v,c):this.queryRasterArrayValueByAllBands(m,v,c):Promise.resolve(null)}findLoadedParent(s){const c=i.ae.fromLngLat(s,this.map.transform.tileSize),m=this.maxzoom+1,v=1<<m,w=Math.floor(c.x),T=Math.floor((c.x-w)*v),P=Math.floor(c.y*v),O=this.map.style.getSourceCache(this.id),D=new i.aQ(m,w,m,T,P);return O.findLoadedParent(D,this.minzoom)}}const Ya={vector:lu,raster:Mo,"raster-dem":class extends Mo{constructor(p,s,c,m){super(p,s,c,m),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,w){v&&(p.state="errored",s(v)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=i.n(this.map._requestManager.transformRequest(c,i.R.Tile),function(v,w,T){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(v)p.state="errored",s(v);else if(w){const P=i.aM(T);this.map._refreshExpiredTiles&&p.setExpiryData(P);const O=ImageBitmap&&w instanceof ImageBitmap&&i.r(),D=1-(w.width-i.aP(w.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const F=O?w:i.o.getImageData(w,D),W={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:D};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",W,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const s=p.canonical,c=Math.pow(2,s.z),m=(s.x-1+c)%c,v=s.x===0?p.wrap-1:p.wrap,w=(s.x+1+c)%c,T=s.x+1===c?p.wrap+1:p.wrap,P={};return P[new i.aQ(p.overscaledZ,v,s.z,m,s.y).key]={backfilled:!1},P[new i.aQ(p.overscaledZ,T,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(P[new i.aQ(p.overscaledZ,v,s.z,m,s.y-1).key]={backfilled:!1},P[new i.aQ(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new i.aQ(p.overscaledZ,T,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<c&&(P[new i.aQ(p.overscaledZ,v,s.z,m,s.y+1).key]={backfilled:!1},P[new i.aQ(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new i.aQ(p.overscaledZ,T,s.z,w,s.y+1).key]={backfilled:!1}),P}},"raster-array":ss,geojson:class extends i.E{constructor(p,s,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:i.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const c of this._data.features)s.set(c.id,c);for(const c of p.features)s.set(c.id,c);this._data.features=[...s.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:c},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:p},this.workerOptions);s.scope=this.scope;const c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(i.o.resolveURL(c),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new i.y(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new i.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=i.B(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,s){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,v=m?{image:m.image.clone()}:null,w=this._partialReload,T={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};p.request=this.actor.send(c,T,(P,O)=>w&&!O?(p.state="loaded",s(null)):(delete p.request,p.destroy(!1),p.aborted?s(null):P?s(P):(p.loadVectorData(O,this.map.painter,c==="reloadTile"),s(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,s){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aU{constructor(p,s,c,m){super(p,s,c,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.aV(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new i.y(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(p,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aU,model:i.aX,"batched-model":class extends i.E{constructor(p,s,c,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Go(this._options,this.map._requestManager,s,c,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.y(m))):v&&(Object.assign(this,v),v.bounds&&(this.tileBounds=new Cs(v.bounds,this.minzoom,this.maxzoom)),$t(v.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){const w=Object.values(p.buckets);for(const T of w)T.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(w,T){return p.aborted?s(null):w&&w.status!==404?s(w):(this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadModelData(T,this.map.painter),p.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aU{constructor(p,s,c,m){super(p,s,c,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new i.y(new i.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof i.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends i.E{constructor(p,s,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Cs(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:s,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:c,y:m,z:v}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:v},{signal:w.signal})).then(function(T){return delete p.request,p.aborted?(p.state="unloaded",s(null)):T===void 0?(p.state="errored",s(null)):T===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(T)?(this.loadTileData(p,T),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.name!=="AbortError"&&(p.state="errored",s(T))}),p.request.cancel=()=>w.abort()}loadTileData(p,s){p.setTexture(s,this.map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof i.T?(p.destroy(!1),p.texture&&p.texture instanceof i.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:v})}s&&s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=i.B(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},So=function(p,s,c,m){const v=new Ya[s.type](p,s,c,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return i.aY(["load","abort","unload","serialize","prepare"],v),v};function cu(p,s,c=""){return`${c}:${s.id||""}:${s.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:v,importId:w}=m;return`featureset:${v}${w?`:import:${w}`:""}`}}(p.target)}`}function id(p,s,c,m=""){if(p.uniqueFeatureID){const v=cu(p,s,m);if(c.has(v))return!0;c.add(v)}return!1}function ap(p,s,c,m,v=!1){const w=s.sourceCache.transform,T=s.sourceCache.tilesIn(p,s.has3DLayers,v);T.sort(ph);const P=[];for(const O of T){const D=O.tile.queryRenderedFeatures(s,O,c,m,w,v);Object.keys(D).length&&P.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:D})}for(const O in s.layers){const D=s.layers[O];if(D.styleLayer){const F=D.styleLayer.queryRenderedFeatures(p,s.sourceCache,m);Object.keys(F).length&&P.push({wrappedTileID:0,queryResults:F})}}return P.length===0?{}:function(O){const D={},F={};for(const W of O){const H=W.queryResults,q=W.wrappedTileID,ee=F[q]=F[q]||{};for(const Y in H){const ae=H[Y],oe=ee[Y]=ee[Y]||{},de=D[Y]=D[Y]||[];for(const me of ae)oe[me.featureIndex]||(oe[me.featureIndex]=!0,de.push(me))}}return D}(P)}function lp(p,s,c,m,v,w){const T={},P=m.queryRenderedSymbols(p),O=[];for(const D of Object.keys(P).map(Number))O.push(v[D]);O.sort(ph);for(const D of O){const F=D.featureIndex.lookupSymbolFeatures(P[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,s,c,w);for(const W in F){const H=T[W]=T[W]||[],q=F[W];q.sort((ee,Y)=>{const ae=D.featureSortOrder;if(ae){const oe=ae.indexOf(ee.featureIndex);return ae.indexOf(Y.featureIndex)-oe}return Y.featureIndex-ee.featureIndex});for(const ee of q)H.push(ee)}}return T}function cp(p,s){const c=p.getRenderableIds().map(w=>p.getTileByID(w)),m=[],v={};for(let w=0;w<c.length;w++){const T=c[w],P=T.tileID.canonical.key;v[P]||(v[P]=!0,T.querySourceFeatures(m,s))}return m}function ph(p,s){const c=p.tileID,m=s.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Ja(p,s){const c={};if(!s)return c;for(const m of p){const v=m.layerIds.map(w=>s.getLayer(w)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(w=>v.filter(T=>T.id===w)[0]));for(const w of v)c[w.fqid]=m}}return c}const Is=32,Ma=33,Oa=new Uint16Array(8184);for(let p=0;p<2046;p++){let s=p+2,c=0,m=0,v=0,w=0,T=0,P=0;for(1&s?v=w=T=Is:c=m=P=Is;(s>>=1)>1;){const D=c+v>>1,F=m+w>>1;1&s?(v=c,w=m,c=T,m=P):(c=v,m=w,v=T,w=P),T=D,P=F}const O=4*p;Oa[O+0]=c,Oa[O+1]=m,Oa[O+2]=v,Oa[O+3]=w}const la=new Uint16Array(2178),Qa=new Uint8Array(1089),_c=new Uint16Array(1089);function uu(p){return p===0?-.03125:p===32?.03125:0}const up={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class du{constructor(s,c,m,v,w,T){this.tileID=s,this.uid=i.b2(),this.uses=0,this.tileSize=c,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(s){const c=s+this.timeAdded;c<i.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,m){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Ja(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof i.b4){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof i.b4&&w.hasRTLText){this.hasRTLText=!0,i.b5();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],T=c.style.getOwnLayer(v);if(!T)continue;const P=T.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,P)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new i.b3}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,c,m){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,Ja(s.buckets,c.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s,c){for(const w in this.buckets){const T=this.buckets[w];if(T.uploadPending()){let P={},O=[],D={zoom:0,pitch:0,brightness:0,worldview:""};if(c){if(c.style){O=c.style.listImages();const F=T.layers[0],W=F.sourceLayer||"_geojsonTileLayer",H=c.style.getLayerSourceCache(F);H&&(P=H._state.getState(W,void 0))}D={zoom:c.transform.zoom||0,pitch:c.transform.pitch||0,brightness:c.style.getBrightness()||0,worldview:c.worldview||""}}T.upload(s,this.tileID.canonical,P,O,D)}}const m=s.gl,v=this.imageAtlas;v&&!v.uploaded&&(this.imageAtlasTexture=new i.T(s,v.image,m.RGBA8,{useMipmap:!!v.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(s,this.glyphAtlasImage,m.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(s,this.lineAtlas.image,m.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,m),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(c)),(this._lastUpdatedBrightness||v||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}evaluateQueryRenderedFeaturePadding(){let s=0;for(const c in this.buckets){const m=this.buckets[c];m.evaluateQueryRenderedFeaturePadding&&(s=Math.max(s,m.evaluateQueryRenderedFeaturePadding()))}return s}queryRenderedFeatures(s,c,m,v,w,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=this.evaluateQueryRenderedFeaturePadding(),O=function(D,F){const W=i.bq([],[.5*D.width,.5*-D.height,1]);return i.br(W,W,[1,-1,0]),i.aB(W,W,D.calculateProjMatrix(F.toUnwrapped())),Float32Array.from(W)}(w,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:c,pixelPosMatrix:O,transform:v,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:P})}querySourceFeatures(s,c){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),w=c?c.sourceLayer:"",T=v._geojsonTileLayer||v[w];if(!T)return;const P=i.b6(c&&c.filter),{z:O,x:D,y:F}=this.tileID.canonical,W={z:O,x:D,y:F};for(let H=0;H<T.length;H++){const q=T.feature(H);if(P.needGeometry){const ae=i.b7(q,!0);if(!P.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ae,this.tileID.canonical))continue}else if(!P.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const ee=m.getId(q,w),Y=new i.b8(q,O,D,F,ee);Y.tile=W,s.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const m=i.b9(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const w=this.expirationTime-c;w?this.expirationTime=m+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}hasAppearances(s){for(const c in this.buckets)if(s.style.hasLayer(c)&&this.buckets[c].layers.some(m=>m.appearances&&m.appearances.length>0))return!0;return!1}updateBuckets(s,c){if(!this.latestFeatureIndex||!s.style)return;const m=s.style.listImages(),v=s.style.getBrightness();for(const w in this.buckets){if(!s.style.hasLayer(w))continue;const T=this.buckets[w],P=T.layers[0],O=P.sourceLayer||"_geojsonTileLayer",D=s.style.getLayerSourceCache(P);let F={};D&&(F=D._state.getState(O,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},H=Object.keys(F).length>0&&!c;T.hasAppearances=T.layers.some(Y=>Y.appearances&&Y.appearances.length>0);const q=H?T.stateDependentLayers:T.layers;if(H&&T.stateDependentLayers.length!==0||c){const Y=this.latestFeatureIndex.loadVTLayers();T.update(F,Y[O],m,W,q,c,v)}if(H&&T.stateDependentLayers.length!==0||c||T.hasAppearances){const Y={zoom:s.transform.zoom,pitch:s.transform.pitch,brightness:s.style.getBrightness()||0,worldview:s.worldview};T.updateAppearances(this.tileID.canonical,F,m,Y)}(T instanceof i.ba||T instanceof i.bb)&&s._terrain&&s._terrain.enabled&&D&&T.uploadPending()&&s._terrain._clearRenderCacheForTile(D.id,this.tileID);const ee=s&&s.style&&s.style.getOwnLayer(w);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=i.o.now()+s}setTexture(s,c){const m=c.context,v=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s):(this.texture=new i.T(m,s,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(s,c){const m={};for(const v of c)m[v]=!0;this.dependencies[s]=m}hasDependency(s,c){for(const m of s){const v=this.dependencies[m];if(v){for(const w of c)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const m=i.bc(up,this.tileID.canonical,this.tileTransform)[0],v=new i.bd,w=new i.be;for(let T=0;T<m.length;T++){const{x:P,y:O}=m[T];v.emplaceBack(P,O),w.emplaceBack(T)}w.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(w),this._tileDebugBuffer=s.createVertexBuffer(v,i.bf.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const m=i.bc(up,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const T=function(P,O){const D=i.aZ(P,O),F=Math.pow(2,P.z);for(let ae=0;ae<Ma;ae++)for(let oe=0;oe<Ma;oe++){const de=i.a_((P.x+(oe+uu(oe))/Is)/F),me=i.a$((P.y+(ae+uu(ae))/Is)/F),fe=O.project(de,me),Pe=ae*Ma+oe;la[2*Pe+0]=Math.round((fe.x*D.scale-D.x)*i.al),la[2*Pe+1]=Math.round((fe.y*D.scale-D.y)*i.al)}Qa.fill(0),_c.fill(0);for(let ae=2045;ae>=0;ae--){const oe=4*ae,de=Oa[oe+0],me=Oa[oe+1],fe=Oa[oe+2],Pe=Oa[oe+3],be=de+fe>>1,Ae=me+Pe>>1,xe=be+Ae-me,ye=Ae+de-be,Ce=me*Ma+de,$e=Pe*Ma+fe,Ne=Ae*Ma+be,et=Math.hypot((la[2*Ce+0]+la[2*$e+0])/2-la[2*Ne+0],(la[2*Ce+1]+la[2*$e+1])/2-la[2*Ne+1])>=16;Qa[Ne]=Qa[Ne]||(et?1:0),ae<1022&&(Qa[Ne]=Qa[Ne]||Qa[(me+ye>>1)*Ma+(de+xe>>1)]||Qa[(Pe+ye>>1)*Ma+(fe+xe>>1)])}const W=new i.b1,H=new i.b0;let q=0;function ee(ae,oe){const de=oe*Ma+ae;return _c[de]===0&&(W.emplaceBack(la[2*de+0],la[2*de+1],ae*i.al/Is,oe*i.al/Is),_c[de]=++q),_c[de]-1}function Y(ae,oe,de,me,fe,Pe){const be=ae+de>>1,Ae=oe+me>>1;if(Math.abs(ae-fe)+Math.abs(oe-Pe)>1&&Qa[Ae*Ma+be])Y(fe,Pe,ae,oe,be,Ae),Y(de,me,fe,Pe,be,Ae);else{const xe=ee(ae,oe),ye=ee(de,me),Ce=ee(fe,Pe);H.emplaceBack(xe,ye,Ce)}}return Y(0,0,Is,Is,Is,0),Y(Is,Is,0,0,0,Is),{vertices:W,indices:H}}(this.tileID.canonical,c);v=T.vertices,w=T.indices}else{v=new i.b1,w=new i.b0;for(const{x:P,y:O}of m)v.emplaceBack(P,O,0,0);const T=i.bh(v.int16.subarray(0,4*v.length),void 0,4);for(let P=0;P<T.length;P+=3)w.emplaceBack(T[P],T[P+1],T[P+2])}this._tileBoundsBuffer=s.createVertexBuffer(v,i.bi.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(w),this._tileBoundsSegments=i.bg.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(s,c){const m=c.projection;if(!m||m.name!=="globe"||c.freezeTileCoverage)return;const v=this.tileID.canonical,w=i.bj(v,c),T=i.bk(w),P=i.aj(c.zoom);let O;P>0&&(O=i.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,v,c,T,O,P),this._makeGlobeTileDebugTextBuffer(s,v,c,T,O,P)}_globePoint(s,c,m,v,w,T,P){let O=i.bm(s,c,m);if(T){const D=1<<m.z,F=i.aF(v.center.lng),W=i.aJ(v.center.lat),H=(m.x+.5)/D-F;let q=0;H>.5?q=-1:H<-.5&&(q=1);let ee=(s/i.al+m.x)/D+q,Y=(c/i.al+m.y)/D;ee=(ee-F)*v._pixelsPerMercatorPixel+F,Y=(Y-W)*v._pixelsPerMercatorPixel+W;const ae=[ee*v.worldSize,Y*v.worldSize,0];i.af(ae,ae,T),O=i.bn(O,ae,P)}return i.af(O,O,w)}_makeGlobeTileDebugBorderBuffer(s,c,m,v,w,T){const P=new i.bd,O=new i.be,D=new i.bo,F=(H,q,ee,Y,ae)=>{const oe=(ee-H)/(ae-1),de=(Y-q)/(ae-1),me=P.length;for(let fe=0;fe<ae;fe++){const Pe=H+fe*oe,be=q+fe*de;P.emplaceBack(Pe,be);const Ae=this._globePoint(Pe,be,c,m,v,w,T);D.emplaceBack(Ae[0],Ae[1],Ae[2]),O.emplaceBack(me+fe)}},W=i.al;F(0,0,W,0,16),F(W,0,W,W,16),F(W,W,0,W,16),F(0,W,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(O),this._tileDebugBuffer=s.createVertexBuffer(P,i.bf.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(D,i.bp.members),this._tileDebugSegments=i.bg.simpleSegment(0,0,P.length,O.length)}_makeGlobeTileDebugTextBuffer(s,c,m,v,w,T){const P=i.al/4,O=new i.bd,D=new i.b0,F=new i.bo,W=25;D.reserve(32),O.reserve(W),F.reserve(W);const H=(q,ee)=>W*q+ee;for(let q=0;q<W;q++){const ee=q*P;for(let Y=0;Y<W;Y++){const ae=Y*P;O.emplaceBack(ae,ee);const oe=this._globePoint(ae,ee,c,m,v,w,T);F.emplaceBack(oe[0],oe[1],oe[2])}}for(let q=0;q<4;q++)for(let ee=0;ee<4;ee++){const Y=H(q,ee),ae=H(q,ee+1),oe=H(q+1,ee),de=H(q+1,ee+1);D.emplaceBack(Y,ae,oe),D.emplaceBack(oe,ae,de)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(D),this._tileDebugTextBuffer=s.createVertexBuffer(O,i.bf.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(F,i.bp.members),this._tileDebugTextSegments=i.bg.simpleSegment(0,0,W,32)}destroy(s=!0){for(const c in this.buckets)this.buckets[c].destroy(s);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),s&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof i.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bs.setPbf(i.bt);class dp extends du{constructor(s,c,m,v,w){super(s,c,m,v,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,c,m){const v=m.context,w=v.gl;let T=this.texturePerLayer.get(s)||m.getTileTexture(c.width);T&&T instanceof i.T?T.update(c,{premultiply:!1}):T=new i.T(v,c,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,T)}flushQueues(s){const c=this._workQueuePerLayer.get(s)||[],m=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()();for(;m.length;)m.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(s)||[];for(;c.length;)c.pop()()}}fetchHeader(s=16384,c){const m=this._mrt=new i.bs(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=i.bu(v,(w,T,P)=>{if(w)c(w);else try{const O=m.getHeaderLength(T);if(O>s)return void(this.request=this.fetchHeader(O,c));m.parseHeader(T),this._isHeaderLoaded=!0;let D=0;for(const F of Object.values(m.layers))D=Math.max(D,F.dataIndex[F.dataIndex.length-1].lastByte);T.byteLength>=D&&(this.entireBuffer=T),c(null,this.entireBuffer||T,P)}catch(O){c(O)}}),this.request}fetchBandForRender(s,c,m,v){this.fetchBand(s,c,m,w=>{if(w)return void v(w);this.updateTextureDescriptor(s,c,m);const T=this.textureDescriptorPerLayer.get(c);v(null,T?T.img:null)})}fetchBand(s,c,m,v,w=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void v(new Error("Tile header is not ready"));const P=this.actor;if(!P)return void v(new Error("Can't fetch tile band without an actor"));let O;const D=i.B(String(m),i.B(this.tileID.key,s));let F=this._taskQueue.get(D);F?F.add(v):(F=new Set,F.add(v),this._taskQueue.set(D,F));const W=(Y,ae)=>{O.complete(Y,ae),Y?v(Y):(F.forEach(oe=>oe(null,ae)),this._taskQueue.delete(D))},H=(Y,ae)=>{if(Y)return v(Y);const oe=P.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ae,task:O},W,void 0,!0);if(c!==null){const de=this._workQueuePerLayer.get(c)||[];de.push(()=>{oe&&oe.cancel(),O.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,de)}};let q;try{q=T.getLayer(s)}catch(Y){if(this.state==="reloading")return;throw Y}if(!q)return void v(new Error(`Unknown sourceLayer "${s}"`));if(q.hasDataForBand(m))return F.forEach(Y=>Y(null,null)),void this._taskQueue.delete(D);const ee=q.getDataRange([m]);if(O=T.createDecodingTask(ee),!O||O.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)H(null,this.entireBuffer.slice(ee.firstByte,ee.lastByte+1));else{const Y=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ee.firstByte}-${ee.lastByte}`}}),ae=i.bu(Y,H);if(c!==null){const oe=this._fetchQueuePerLayer.get(c)||[];oe.push(()=>{ae.cancel(),O.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,oe)}}}updateNeeded(s,c){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,c,m){if(!this._mrt)return;const v=this._mrt.getLayer(s);if(!v||!v.hasBand(m)||!v.hasDataForBand(m))return;const{bytes:w,tileSize:T,buffer:P,offset:O,scale:D}=v.getBandView(m),F=T+2*P,W=new i.q({width:F,height:F},w),H=this.texturePerLayer.get(c);H&&H instanceof i.T&&H.update(W,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:s,band:m,img:W,buffer:P,offset:O,tileSize:T,format:v.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const c of this.texturePerLayer.values())c&&c instanceof i.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class bx{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,m){const v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:c,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout(()=>{this.remove(s,w)},m)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const m=s.wrapped().key,v=c===void 0?0:this.data[m].indexOf(c),w=this.data[m][v];return this.data[m].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const m in this.data)for(const v of this.data[m])s(v.value)||c.push(v);for(const m of c)this.remove(m.value.tileID,m)}}class mh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,m){const v=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},Object.assign(this.stateChanges[s][v],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const w in this.state[s])w!==v&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(const w in this.state[s][v])m[w]||(this.deletedStates[s][v][w]=null)}else for(const w in m)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][w]===null&&delete this.deletedStates[s][v][w]}removeFeatureState(s,c,m){if(this.deletedStates[s]===null)return;const v=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&c!==void 0)this.deletedStates[s][v]!==null&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][m]=null);else if(c!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][v])for(m in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][m]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,c){const m=this.state[s]||{},v=this.stateChanges[s]||{},w=this.deletedStates[s];if(w===null)return{};if(c!==void 0){const P=String(c),O=Object.assign({},m[P],v[P]);if(w){const D=w[c];if(D===null)return{};for(const F in D)delete O[F]}return O}const T=Object.assign({},m,v);if(w)for(const P in w)delete T[P];return T}initializeTileState(s,c){s.refreshFeatureState(c)}coalesceChanges(s,c){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),Object.assign(this.state[v][T],this.stateChanges[v][T]),w[T]=this.state[v][T];m[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const T in this.state[v])w[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const P of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][P];w[T]=this.state[v][T]}m[v]=m[v]||{},Object.assign(m[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in s)s[v].refreshFeatureState(c)}}class Bs extends i.E{constructor(s,c,m){super(),this.id=s,this._onlySymbols=m,c.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new bx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new mh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const m=this._tiles[c];m.upload(s,this.map?this.map.painter:void 0),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(hp).map(s=>s.key)}getRenderableIds(s,c){const m=[];for(const v in this._tiles)this._isIdRenderable(+v,s,c)&&m.push(this._tiles[v]);return s?m.sort((v,w)=>{const T=v.tileID,P=w.tileID,O=new i.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),D=new i.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-P.overscaledZ||D.y-O.y||D.x-O.x}).map(v=>v.tileID.key):m.map(v=>v.tileID).sort(hp).map(v=>v.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,m){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(m||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=c),this._loadTile(m,this._tileLoaded.bind(this,m,s,c)))}_tileLoaded(s,c,m,v,w){if(v){if(s.state="errored",v.status!==404)this._source.fire(new i.y(v,{tile:s}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const P=this.map.painter.terrain;this.update(this.transform,P.getScaledDemTileSize(),!0),P.resetTileLookupCache(this.id)}else this.update(this.transform)}return}s.timeAdded=i.o.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null);let T=new Map;w&&w.responseHeaders&&(T=w.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(s){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const w=c[v];if(s.neighboringTiles&&s.neighboringTiles[w]){const T=this.getTileByID(w);m(s,T),m(T,s)}}function m(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=w.tileID.canonical.x-v.tileID.canonical.x;const P=w.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),D=w.tileID.key;T===0&&P===0||Math.abs(P)>1||(Math.abs(T)>1&&(Math.abs(T+O)===1?T+=O:Math.abs(T-O)===1&&(T-=O)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,T,P),v.neighboringTiles&&v.neighboringTiles[D]&&(v.neighboringTiles[D].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,m,v){for(const w in this._tiles){let T=this._tiles[w];if(v[w]||!T.hasData()||T.tileID.overscaledZ<=c||T.tileID.overscaledZ>m)continue;let P=T.tileID;for(;T&&T.tileID.overscaledZ>c+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(P=D)}let O=P;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]){v[P.key]=P;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=c?m:null}for(let m=s.overscaledZ-1;m>=c;m--){const v=s.scaledTo(m),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const m=Math.ceil(s.width/c)+1,v=Math.ceil(s.height/c)+1,w=Math.floor(m*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(P)}handleWrapJump(s){const c=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,c){const m={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),m[w.tileID.key]=w}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(s,c,m,v,w){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(s,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let P,O=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const H=D.attenuationRange()[0],q=Math.floor(H)-Math.log2(D.getDemUpscale());O>q&&(O=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new i.aQ(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y));else if(this.tileCoverLift!==0){const H=s.clone();H.tileCoverLift=this.tileCoverLift,P=H.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&s.projection.name==="globe"&&(P.push(new i.aQ(1,0,1,0,0)),P.push(new i.aQ(1,0,1,1,0)),P.push(new i.aQ(1,0,1,0,1)),P.push(new i.aQ(1,0,1,1,1)))}else if(P=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const H=this._source.hasTile.bind(this._source);P=P.filter(q=>H(q))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!hu(this._source.type)){const H=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),q=Math.min(H,this._source.maxzoom);if(T){const ee=s.extendTileCover(P,q);for(const Y of ee)P.push(Y)}else if(w){const ee=s.extendTileCoverToNearPlane(P,this.transform.getFrustum(q),q);for(const Y of ee)P.push(Y)}else if(this.castsShadows&&v){const ee=s.extendTileCover(P,q,v,16);for(const Y of ee)this._shadowCasterTiles[Y.key]=!0,P.push(Y)}}const F=this._updateRetainedTiles(P);if(hu(this._source.type)&&P.length!==0){const H={},q={},ee=Object.keys(F);for(const ae of ee){const oe=F[ae],de=this._tiles[ae];if(!de||de.fadeEndTime&&de.fadeEndTime<=i.o.now())continue;const me=this.findLoadedParent(oe,Math.max(oe.overscaledZ-Bs.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),H[me.tileID.key]=me.tileID),q[ae]=oe}const Y=P[P.length-1].overscaledZ;for(const ae in this._tiles){const oe=this._tiles[ae];if(F[ae]||!oe.hasData())continue;let de=oe.tileID;for(;de.overscaledZ>Y;){de=de.scaledTo(de.overscaledZ-1);const me=this._tiles[de.key];if(me&&me.hasData()&&q[de.key]){F[ae]=oe.tileID;break}}}for(const ae in H)F[ae]||(this._coveredTiles[ae]=!0,F[ae]=H[ae])}for(const H in F)this._tiles[H].clearFadeHold();const W=i.bv(this._tiles,F);for(const H of W){const q=this._tiles[H];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+H)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(s.length===0)return c;const m={},v=s.reduce((D,F)=>Math.min(D,F.overscaledZ),1/0),w=s[0].overscaledZ,T=Math.max(w-Bs.maxOverzooming,this._source.minzoom),P=Math.max(w+Bs.maxUnderzooming,this._source.minzoom),O={};for(const D of s){const F=this._addTile(D);c[D.key]=D,F.hasData()||v<this._source.maxzoom&&(O[D.key]=D)}this._retainLoadedChildren(O,v,P,c);for(const D of s){let F=this._tiles[D.key];if(F.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const H=D.children(this._source.maxzoom)[0],q=this.getTile(H);if(q&&q.hasData()){c[H.key]=H;continue}}else{const H=D.children(this._source.maxzoom);if(c[H[0].key]&&c[H[1].key]&&c[H[2].key]&&c[H[3].key])continue}let W=F.wasRequested();for(let H=D.overscaledZ-1;H>=T;--H){const q=D.scaledTo(H);if(m[q.key]||(m[q.key]=!0,F=this.getTile(q),!F&&W&&(F=this._addTile(q)),F&&(c[q.key]=q,W=F.wasRequested(),F.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let m,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}c.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;v=w}for(const w of c)this._loadedParentTiles[w]=m}}_addTile(s){let c=this._tiles[s.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const m=!!c;if(!m){const v=this.map?this.map.painter:null,w=this._source.tileSize*s.overscaleFactor();c=this._source.type==="raster-array"?new dp(s,w,this.transform.tileZoom,v,this._isRaster):new du(s,w,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c.uses++,this._tiles[s.key]=c,m||this._source.fire(new i.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=c.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,m){const v=[],w=this.transform;if(!w)return v;const T=w.projection.name==="globe",P=i.aF(w.center.lng);for(const O in this._tiles){const D=this._tiles[O];if(m&&D.clearQueryDebugViz(),D.holdingForFade())continue;let F;if(T){const W=D.tileID.canonical;if(W.z===0){const H=[Math.abs(i.aA(P,...Cl(W,-1))-P),Math.abs(i.aA(P,...Cl(W,1))-P)];F=[0,2*H.indexOf(Math.min(...H))-1]}else{const H=[Math.abs(i.aA(P,...Cl(W,-1))-P),Math.abs(i.aA(P,...Cl(W,0))-P),Math.abs(i.aA(P,...Cl(W,1))-P)];F=[H.indexOf(Math.min(...H))-1]}}else F=[0];for(const W of F){const H=s.containsTile(D,w,c,W);H&&v.push(H)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const m=this.getRenderableIds(s,c).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of m)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return m}sortCoordinatesByDistance(s){const c=s.slice(),m=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const T of c){const P=1/(1<<T.canonical.z);w[T.key]=((T.canonical.x+.5)*P+T.wrap-m[0])*v[0]+((T.canonical.y+.5)*P-m[1])*v[1]-m[2]*v[2]}return c.sort((T,P)=>w[T.key]-w[P.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(hu(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(s,c,m){this._state.updateState(s=s||"_geojsonTileLayer",c,m)}removeFeatureState(s,c,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,m)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,m){const v=this._tiles[s];v&&v.setDependencies(c,m)}reloadTilesForDependencies(s,c){for(const m in this._tiles)this._tiles[m].hasDependency(s,c)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(s,c))};return void this._source.on("data",O)}const m=new Map,v=Array.isArray(s)?s:[s],w=this.map.painter.terrain,T=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const O of v){const D=O.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of D)m.set(F.key,F);this.usedForTerrain&&O.updateElevation(!1)}const P=Array.from(m.values());i.bw(P,(O,D)=>{const F=new du(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,W=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),D(W,F)})},c)}}function hp(p,s){const c=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return p.overscaledZ-s.overscaledZ||m-c||s.canonical.y-p.canonical.y||s.canonical.x-p.canonical.x}function hu(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function Cl(p,s){const c=1<<p.z;return[p.x/c+s,(p.x+1)/c+s]}Bs.maxOverzooming=10,Bs.maxUnderzooming=3;class _2{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const m in this.style._mergedLayers){const v=this.style._mergedLayers[m];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:s,visibilityChanged:c});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const m=c.layer;let v=!1;m.type==="fill-extrusion"?v=!m.isHidden(s)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?v=!m.isHidden(s)&&m.paint.get("building-opacity")>0:m.type==="model"&&(v=!m.isHidden(s)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,T=this.style.getLayerSourceCache(w);let P=1;w.type==="fill-extrusion"?P=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(P=v.visible?w.paint.get("building-vertical-scale"):0);let O=T?T.getTile(c):null;if(!O&&T)for(const D in T._tiles){const F=T._tiles[D];if(c.canonical.isChildOf(F.tileID.canonical)){O=F;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:P})}s.hasAnyZOffset=!1;let m=!1;for(let v=0;v<s.symbolInstances.length;v++){const w=s.symbolInstances.get(v),T=w.zOffset,P=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=P!==Number.NEGATIVE_INFINITY?P:T,m||T===w.zOffset||(m=!0),s.hasAnyZOffset||w.zOffset===0||(s.hasAnyZOffset=!0)}m&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,m,v){let w=c,T=m;if(s.canonical.z!==v.canonical.z){const P=v.canonical,O=1/(1<<s.canonical.z-P.z);w=(c+s.canonical.x*i.al)*O-P.x*i.al|0,T=(m+s.canonical.y*i.al)*O-P.y*i.al|0}return{tileX:w,tileY:T}}_getHeightAtTileOffset(s,c,m){let v,w;for(let T=0;T<this.layers.length;++T){const P=this.layers[T].layer;if(P.type!=="fill-extrusion"&&P.type!=="building")continue;const{bucket:O,tileID:D,verticalScale:F}=this.currentBuildingBuckets[T];if(!O)continue;const{tileX:W,tileY:H}=this._mapCoordToOverlappingTile(s,c,m,D),q=O.getHeightAtTileCoord(W,H);q&&q.height!==void 0&&(q.hidden?v=q.height:w=Math.max(q.height*F,w||0))}if(w!==void 0)return w;for(let T=0;T<this.layers.length;++T){const P=this.layers[T];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:O,tileID:D}=this.currentBuildingBuckets[T];if(!O)continue;const{tileX:F,tileY:W}=this._mapCoordToOverlappingTile(s,c,m,D),H=O.getHeightAtTileCoord(F,W);if(H&&!H.hidden)return H.height===void 0&&v!==void 0?Math.min(H.maxHeight,v)*H.verticalScale:H.height?H.height*H.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wx(p,s){const c={};for(const m in p)m!=="ref"&&(c[m]=p[m]);return i.bx.forEach(m=>{m in s&&(c[m]=s[m])}),c}function gh(p){p=p.slice();const s=Object.create(null);for(let c=0;c<p.length;c++)s[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=wx(p[c],s[p[c].ref]));return p}const yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function fp(p,s,c){c.push({command:yn.addSource,args:[p,s[p]]})}function Cy(p,s,c){s.push({command:yn.removeSource,args:[p]}),c[p]=!0}function Sx(p,s,c,m){Cy(p,c,m),fp(p,s,c)}function Tx(p,s,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&m!=="data"&&!i.by(p[c][m],s[c][m]))return!1;for(m in s[c])if(s[c].hasOwnProperty(m)&&m!=="data"&&!i.by(p[c][m],s[c][m]))return!1;return!0}function vc(p,s,c,m,v,w){let T;for(T in s=s||{},p=p||{})p.hasOwnProperty(T)&&(i.by(p[T],s[T])||c.push({command:w,args:[m,T,s[T],v]}));for(T in s)s.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(i.by(p[T],s[T])||c.push({command:w,args:[m,T,s[T],v]}))}function yh(p){return p.id}function _h(p,s){return p[s.id]=s,p}function Iy(p,s,c){const m=s.createTileMatrix(p,p.worldSize,c.toUnwrapped());return i.aB(new Float32Array(16),p.projMatrix,m)}function pp(p,s,c){if(s.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(s.projection),Iy(m,s.getProjection(),p)}function el(p,s,c){return s.name===c.projection.name?p.projMatrix:Iy(c,s,p)}class vh{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.aA(s,0,1);let c=1,m=this._distances[c];const v=s*this.paddedLength+this.padding;for(;m<v&&c<this._distances.length;)m=this._distances[++c];const w=c-1,T=this._distances[w],P=m-T,O=P>0?(v-T)/P:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class My{constructor(s,c,m){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(c/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,m,v,w){this._forEachCell(c,m,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(s,c,m,v){this._forEachCell(c-v,m-v,c+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(m),this.circles.push(v)}_insertBoxCell(s,c,m,v,w,T){this.boxCells[w].push(T)}_insertCircleCell(s,c,m,v,w,T){this.circleCells[w].push(T)}_query(s,c,m,v,w,T){if(m<0||s>this.width||v<0||c>this.height)return!w&&[];const P=[];if(s<=0&&c<=0&&this.width<=m&&this.height<=v){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const D=this.circles[3*O],F=this.circles[3*O+1],W=this.circles[3*O+2];P.push({key:this.circleKeys[O],x1:D-W,y1:F-W,x2:D+W,y2:F+W})}return T?P.filter(T):P}return this._forEachCell(s,c,m,v,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?P.length>0:P}_queryCircle(s,c,m,v,w){const T=s-m,P=s+m,O=c-m,D=c+m;if(P<0||T>this.width||D<0||O>this.height)return!v&&[];const F=[];return this._forEachCell(T,O,P,D,this._queryCellCircle,F,{hitTest:v,circle:{x:s,y:c,radius:m},seenUids:{box:{},circle:{}}},w),v?F.length>0:F}query(s,c,m,v,w){return this._query(s,c,m,v,!1,w)}hitTest(s,c,m,v,w){return this._query(s,c,m,v,!0,w)}hitTestCircle(s,c,m,v){return this._queryCircle(s,c,m,!0,v)}_queryCell(s,c,m,v,w,T,P,O){const D=P.seenUids,F=this.boxCells[w];if(F!==null){const H=this.bboxes;for(const q of F)if(!D.box[q]){D.box[q]=!0;const ee=4*q;if(s<=H[ee+2]&&c<=H[ee+3]&&m>=H[ee+0]&&v>=H[ee+1]&&(!O||O(this.boxKeys[q]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[q],x1:H[ee],y1:H[ee+1],x2:H[ee+2],y2:H[ee+3]})}}}const W=this.circleCells[w];if(W!==null){const H=this.circles;for(const q of W)if(!D.circle[q]){D.circle[q]=!0;const ee=3*q;if(this._circleAndRectCollide(H[ee],H[ee+1],H[ee+2],s,c,m,v)&&(!O||O(this.circleKeys[q]))){if(P.hitTest)return T.push(!0),!0;{const Y=H[ee],ae=H[ee+1],oe=H[ee+2];T.push({key:this.circleKeys[q],x1:Y-oe,y1:ae-oe,x2:Y+oe,y2:ae+oe})}}}}}_queryCellCircle(s,c,m,v,w,T,P,O){const D=P.circle,F=P.seenUids,W=this.boxCells[w];if(W!==null){const q=this.bboxes;for(const ee of W)if(!F.box[ee]){F.box[ee]=!0;const Y=4*ee;if(this._circleAndRectCollide(D.x,D.y,D.radius,q[Y+0],q[Y+1],q[Y+2],q[Y+3])&&(!O||O(this.boxKeys[ee])))return T.push(!0),!0}}const H=this.circleCells[w];if(H!==null){const q=this.circles;for(const ee of H)if(!F.circle[ee]){F.circle[ee]=!0;const Y=3*ee;if(this._circlesCollide(q[Y],q[Y+1],q[Y+2],D.x,D.y,D.radius)&&(!O||O(this.circleKeys[ee])))return T.push(!0),!0}}}_forEachCell(s,c,m,v,w,T,P,O){const D=this._convertToXCellCoord(s),F=this._convertToYCellCoord(c),W=this._convertToXCellCoord(m),H=this._convertToYCellCoord(v);for(let q=D;q<=W;q++)for(let ee=F;ee<=H;ee++)if(w.call(this,s,c,m,v,this.xCellCount*ee+q,T,P,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,m,v,w,T){const P=v-s,O=w-c,D=m+T;return D*D>P*P+O*O}_circleAndRectCollide(s,c,m,v,w,T,P){const O=(T-v)/2,D=Math.abs(s-(v+O));if(D>O+m)return!1;const F=(P-w)/2,W=Math.abs(c-(w+F));if(W>F+m)return!1;if(D<=O||W<=F)return!0;const H=D-O,q=W-F;return H*H+q*q<=m*m}}const xc={unknown:0,flipRequired:1,flipNotRequired:2},fu=Math.tan(85*Math.PI/180);function as(p,s,c,m,v,w,T){const P=i.bC();if(c)if(w.name==="globe"){const O=i.bD(v,s);i.aB(P,P,O)}else{const O=i.bE([],T);P[0]=O[0],P[1]=O[1],P[4]=O[2],P[5]=O[3],m||i.bB(P,P,v.angle)}else i.aB(P,v.labelPlaneMatrix,p);return P}function mp(p,s,c,m,v,w,T){const P=as(p,s,c,m,v,w,T);return w.name==="globe"&&c||(P[2]=P[6]=P[10]=P[14]=0),P}function xh(p,s,c,m,v,w,T){if(c){if(w.name==="globe"){const P=as(p,s,c,m,v,w,T);return i.bl(P,P),i.aB(P,p,P),P}{const P=i.bz(p),O=i.bA([]);return O[0]=T[0],O[1]=T[1],O[4]=T[2],O[5]=T[3],i.aB(P,P,O),m||i.bB(P,P,-v.angle),P}}return v.glCoordMatrix}function ca(p,s,c,m){const v=[p,s,c,1];c?i.aC(v,v,m):ar(v,v,m);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function kn(p,s){return Math.min(.5+p/s*.5,1.5)}function Ax(p,s){const c=p[0]/p[3],m=p[1]/p[3];return c>=-s[0]&&c<=s[0]&&m>=-s[1]&&m<=s[1]}function Ex(p,s,c,m,v,w,T,P,O,D,F=1){const W=c.transform,H=m?p.textSizeData:p.iconSizeData,q=i.bK(H,c.transform.zoom,F),ee=W.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],ae=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ae.clear();let oe=null;ee&&(oe=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const de=p.lineVertexArray,me=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,fe=c.transform.width/c.transform.height;let Pe,be=!1;for(let Ae=0;Ae<me.length;Ae++){const xe=me.get(Ae),{numGlyphs:ye,writingMode:Ce}=xe;if(Ce!==i.bL.vertical||be||Pe===i.bL.horizontal||(be=!0),Pe=Ce,(xe.hidden||Ce===i.bL.vertical)&&!be){Ra(ye,ae);continue}be=!1;const $e=new i.P(xe.tileAnchorX,xe.tileAnchorY),Ne=p.elevationType==="road",et=!!W.elevation||Ne;let{x:tt,y:dt,z:Tt}=W.projection.projectTilePoint($e.x,$e.y,D.canonical),Ze=null;if(et){const Gt=Ne?p.getElevationFeatureForText(Ae):null;Ze={getElevation:O,elevation:W.elevation,elevationFeature:Gt};const[hr,Or,Qr]=O($e,W.elevation,Gt);tt+=hr,dt+=Or,Tt+=Qr}const ke=[tt,dt,Tt,1];if(i.aC(ke,ke,s),!Ax(ke,Y)){Ra(ye,ae);continue}const st=ke[3],Ye=kn(c.transform.getCameraToCenterDistance(W.projection),st),gt=i.bM(H,q,xe),Rt=T?gt/Ye:gt*Ye,Vt=ca(tt,dt,Tt,v);if(Vt[3]<=0){Ra(ye,ae);continue}let It={};const At=i.an(p.layers[0].layout.get("text-max-angle")),tr=Math.cos(At),Jt=T?null:Ze,zt=Oy(xe,Rt,!1,P,s,v,w,p.glyphOffsetArray,de,ae,oe,Vt,$e,It,fe,Jt,W.projection,D,T,tr);be=zt.useVertical,Jt&&zt.needsFlipping&&(It={}),(zt.notEnoughRoom||be||zt.needsFlipping&&Oy(xe,Rt,!0,P,s,v,w,p.glyphOffsetArray,de,ae,oe,Vt,$e,It,fe,Jt,W.projection,D,T,tr).notEnoughRoom)&&Ra(ye,ae)}m?(p.text.dynamicLayoutVertexBuffer.updateData(ae),oe&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(oe)):(p.icon.dynamicLayoutVertexBuffer.updateData(ae),oe&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(oe))}function Px(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae){const{lineStartIndex:oe,glyphStartIndex:de,segment:me}=P,fe=de+P.numGlyphs,Pe=oe+P.lineLength,be=s.getoffsetX(de),Ae=s.getoffsetX(fe-1),xe=od(p*be,c,m,v,w,T,me,oe,Pe,O,D,F,W,H,!0,q,ee,Y,ae);if(!xe)return null;const ye=od(p*Ae,c,m,v,w,T,me,oe,Pe,O,D,F,W,H,!0,q,ee,Y,ae);return ye?{first:xe,last:ye}:null}function xr(p,s,c,m){return p===i.bL.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:p===i.bL.vertical?m>0?{needsFlipping:!0}:null:s!==xc.unknown&&function(v,w){return v===0||Math.abs(w/v)>fu}(c,m)?s===xc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Oy(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de,me){const fe=s/24,Pe=p.lineOffsetX*fe,be=p.lineOffsetY*fe,{lineStartIndex:Ae,glyphStartIndex:xe,numGlyphs:ye,segment:Ce,writingMode:$e,flipState:Ne}=p,et=Ae+p.lineLength,tt=dt=>{if(F){const[st,Ye,gt]=dt.up,Rt=D.length;i.bN(F,Rt+0,st,Ye,gt),i.bN(F,Rt+1,st,Ye,gt),i.bN(F,Rt+2,st,Ye,gt),i.bN(F,Rt+3,st,Ye,gt)}const[Tt,Ze,ke]=dt.point;i.bO(D,Tt,Ze,ke,dt.angle)};if(ye>1){const dt=Px(fe,P,Pe,be,c,W,H,p,O,w,q,Y,!1,ae,oe,de,me);if(!dt)return{notEnoughRoom:!0};if(m&&!c){let[Tt,Ze,ke]=dt.first.point,[st,Ye,gt]=dt.last.point;[Tt,Ze]=ca(Tt,Ze,ke,T),[st,Ye]=ca(st,Ye,gt,T);const Rt=xr($e,Ne,(st-Tt)*ee,Ye-Ze);if(p.flipState=Rt&&Rt.needsFlipping?xc.flipRequired:xc.flipNotRequired,Rt)return Rt}tt(dt.first);for(let Tt=xe+1;Tt<xe+ye-1;Tt++){const Ze=od(fe*P.getoffsetX(Tt),Pe,be,c,W,H,Ce,Ae,et,O,w,q,Y,!1,!1,ae,oe,de,me);if(!Ze)return D.length-=4*(Tt-xe),{notEnoughRoom:!0};tt(Ze)}tt(dt.last)}else{if(m&&!c){const Tt=ca(H.x,H.y,0,v),Ze=Ae+Ce+1,ke=new i.P(O.getx(Ze),O.gety(Ze)),st=ca(ke.x,ke.y,0,v),Ye=st[3]>0?st:ua(H,ke,Tt,1,v,void 0,ae,oe.canonical),gt=xr($e,Ne,(Ye[0]-Tt[0])*ee,Ye[1]-Tt[1]);if(p.flipState=gt&&gt.needsFlipping?xc.flipRequired:xc.flipNotRequired,gt)return gt}const dt=od(fe*P.getoffsetX(xe),Pe,be,c,W,H,Ce,Ae,et,O,w,q,Y,!1,!1,ae,oe,de,me);if(!dt)return{notEnoughRoom:!0};tt(dt)}return{}}function bh(p,s,c,m,v){const{x:w,y:T,z:P}=m.projectTilePoint(p.x,p.y,s);if(!v)return ca(w,T,P,c);const[O,D,F]=v.getElevation(p,v.elevation,v.elevationFeature);return ca(w+O,T+D,P+F,c)}function ua(p,s,c,m,v,w,T,P){const O=bh(p.sub(s)._unit()._add(p),P,v,T,w);return i.av(O,c,O),i.aw(O,O),i.bH(O,c,O,m)}function od(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de){const me=m?p-s:p+s;let fe=me>0?1:-1,Pe=0;m&&(fe*=-1,Pe=Math.PI),fe<0&&(Pe+=Math.PI);let be=P+T+(fe>0?0:1)|0,Ae=v,xe=v,ye=0,Ce=0;const $e=Math.abs(me),Ne=[],et=[];let tt=w,dt=tt,Tt=i.bF([]);const Ze=()=>ua(dt,tt,xe,$e-ye+1,F,H,Y,ae.canonical);for(;ye+Ce<=$e;){if(be+=fe,be<P||be>=O)return null;if(xe=Ae,dt=tt,Ne.push(xe),q&&et.push(dt),tt=new i.P(D.getx(be),D.gety(be)),Ae=W[be],!Ae){const Jt=bh(tt,ae.canonical,F,Y,H);Ae=Jt[3]>0?W[be]=Jt:Ze()}ye+=Ce;const At=i.av([],Ae,xe),tr=i.bG(xe,Ae);if(c&&tr>0&&Ce>0&&i.bJ(Tt,At)/(Ce*tr)<de)return null;Ce=tr,Tt=At}ee&&H&&(W[be]&&(Ae=Ze(),Ce=i.bG(xe,Ae),Tt=i.av([],Ae,xe)),W[be]=Ae);const ke=($e-ye)/Ce,st=tt.sub(dt)._mult(ke)._add(dt),Ye=i.bH([],xe,Tt,ke);let gt=[0,0,1],Rt=Tt[0],Vt=Tt[1];if(oe&&(gt=Y.upVector(ae.canonical,st.x,st.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const At=[gt[2],0,-gt[0]],tr=i.bI([],gt,At);i.aw(At,At),i.aw(tr,tr),Rt=i.bJ(Tt,At),Vt=i.bJ(Tt,tr)}if(c){const At=i.bI([],gt,Tt);i.aw(At,At),i.bH(Ye,Ye,At,c*fe)}const It=Pe+Math.atan2(Vt,Rt);return Ne.push(Ye),q&&et.push(st),{point:Ye,angle:It,path:Ne,tilePath:et,up:gt}}function Ra(p,s){const c=s.length,m=c+4*p;s.resize(m),s.float32.fill(-1/0,4*c,4*m)}function ar(p,s,c){const m=s[0],v=s[1];return p[0]=c[0]*m+c[4]*v+c[12],p[1]=c[1]*m+c[5]*v+c[13],p[3]=c[3]*m+c[7]*v+c[15],p}const cn=100;class Fn{constructor(s,c,m=new My(s.width+200,s.height+200,25),v=new My(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+cn,this.screenBottomBoundary=s.height+cn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,m,v,w,T,P,O,D,F,W){let H=m.projectedAnchorX,q=m.projectedAnchorY,ee=m.projectedAnchorZ;const Y=m.tileAnchorX,ae=m.tileAnchorY,oe=m.elevation,de=m.tileID,me=s.getProjection();if(oe&&de){const[et,tt,dt]=me.upVector(de.canonical,m.tileAnchorX,m.tileAnchorY),Tt=me.upVectorScale(de.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=et*oe*Tt,q+=tt*oe*Tt,ee+=dt*oe*Tt}const fe=s.projection.name==="globe",Pe=s.projection.name==="globe"?i.aj(this.transform.zoom):0;if(de&&fe&&Pe<1&&!T){const et=1<<de.canonical.z,tt=i.bP(Y,ae);i.bQ(tt,tt,1/i.al),i.bR(tt,tt,i.bP(de.canonical.x,de.canonical.y)),i.bQ(tt,tt,1/et),i.bS(tt,tt,i.bP(v[0],v[1])),tt[0]=i.bT(tt[0],-.5,.5),i.bQ(tt,tt,i.al);const dt=i.bU(tt[0],tt[1],i.al/(2*Math.PI),1);i.aC(dt,dt,w),H=i.ak(H,dt[0],Pe),q=i.ak(q,dt[1],Pe),ee=i.ak(ee,dt[2],Pe)}const be=this.projectAndGetPerspectiveRatio(F,H,q,ee,m.tileID,me.name==="globe"||!!oe||this.transform.pitch>0,me),Ae=D*be.perspectiveRatio,xe=(m.x1*c+P.x-m.padding)*Ae+be.point.x,ye=(m.y1*c+P.y-m.padding)*Ae+be.point.y,Ce=(m.x2*c+P.x+m.padding)*Ae+be.point.x,$e=(m.y2*c+P.y+m.padding)*Ae+be.point.y,Ne=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(xe,ye,Ce,$e)||!O&&this.grid.hitTest(xe,ye,Ce,$e,W)||Ne?{box:[],offscreen:!1,occluded:be.occluded}:{box:[xe,ye,Ce,$e],offscreen:this.isOffscreen(xe,ye,Ce,$e),occluded:!1}}placeCollisionCircles(s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae){const oe=[],de=this.transform.elevation,me=s.getProjection(),fe=s.elevationType==="road",Pe=!!de||fe,be=i.bV.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,me),Ae=new i.P(m.tileAnchorX,m.tileAnchorY),xe=new i.P(m.tileAnchorX,m.tileAnchorY);let{x:ye,y:Ce,z:$e}=me.projectTilePoint(xe.x,xe.y,ae.canonical),Ne=null;if(Pe){const tr=fe?s.getElevationFeatureForText(v):null;Ne={getElevation:be,elevation:de,elevationFeature:tr};const[Jt,zt,Gt]=be(Ae,de,tr);ye+=Jt,Ce+=zt,$e+=Gt}const et=me.name==="globe",tt=this.projectAndGetPerspectiveRatio(O,ye,Ce,$e,ae,et||!!de||this.transform.pitch>0,me),{perspectiveRatio:dt}=tt,Tt=(H?P/dt:P*dt)/i.bY,Ze=ca(ye,Ce,$e,D),ke=m.lineOffsetX*Tt,st=m.lineOffsetY*Tt,Ye=i.an(s.layers[0].layout.get("text-max-angle")),gt=Math.cos(Ye),Rt=tt.signedDistanceFromCamera>0?Px(Tt,T,ke,st,fe&&m.flipState===1,Ze,xe,m,w,D,{},Pe&&!H?Ne:null,H&&Pe,me,ae,H,gt):null;let Vt=!1,It=!1,At=!0;if(Rt&&!tt.occluded){const tr=.5*ee*dt+Y,Jt=new i.P(-100,-100),zt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Gt=new vh,{first:hr,last:Or}=Rt,Qr=hr.path.length;let wn=[];for(let Mr=Qr-1;Mr>=1;Mr--)wn.push(hr.path[Mr]);for(let Mr=1;Mr<Or.path.length;Mr++)wn.push(Or.path[Mr]);const rr=2.5*tr;F&&(wn=wn.map(([Mr,Pn,Bn],jn)=>(Pe&&!et&&(Bn=be(jn<Qr-1?hr.tilePath[Qr-1-jn]:Or.tilePath[jn-Qr+2],de,Ne.elevationFeature)[2]),ca(Mr,Pn,Bn,F))),wn.some(Mr=>Mr[3]<=0)&&(wn=[]));let vn=[];if(wn.length>0){let Mr=1/0,Pn=-1/0,Bn=1/0,jn=-1/0;for(const _n of wn)Mr=Math.min(Mr,_n[0]),Bn=Math.min(Bn,_n[1]),Pn=Math.max(Pn,_n[0]),jn=Math.max(jn,_n[1]);Pn>=Jt.x&&Mr<=zt.x&&jn>=Jt.y&&Bn<=zt.y&&(vn=[wn.map(_n=>new i.P(_n[0],_n[1]))],(Mr<Jt.x||Pn>zt.x||Bn<Jt.y||jn>zt.y)&&(vn=i.bW(vn,Jt.x,Jt.y,zt.x,zt.y)))}for(const Mr of vn){Gt.reset(Mr,.25*tr);let Pn=0;Pn=Gt.length<=.5*tr?1:Math.ceil(Gt.paddedLength/rr)+1;for(let Bn=0;Bn<Pn;Bn++){const jn=Bn/Math.max(Pn-1,1),_n=Gt.lerp(jn),Br=_n.x+cn,An=_n.y+cn;oe.push(Br,An,tr,0);const Ti=Br-tr,pi=An-tr,Cn=Br+tr,fn=An+tr;if(At=At&&this.isOffscreen(Ti,pi,Cn,fn),It=It||this.isInsideGrid(Ti,pi,Cn,fn),!c&&this.grid.hitTestCircle(Br,An,tr,q)&&(Vt=!0,!W))return{circles:[],offscreen:!1,collisionDetected:Vt,occluded:!1}}}}return{circles:!W&&Vt||!It?[]:oe,offscreen:At,collisionDetected:Vt,occluded:tt.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,v=1/0,w=-1/0,T=-1/0;for(const F of s){const W=new i.P(F.x+cn,F.y+cn);m=Math.min(m,W.x),v=Math.min(v,W.y),w=Math.max(w,W.x),T=Math.max(T,W.y),c.push(W)}const P=this.grid.query(m,v,w,T).concat(this.ignoredGrid.query(m,v,w,T)),O={},D={};for(const F of P){const W=F.key;if(O[W.bucketInstanceId]===void 0&&(O[W.bucketInstanceId]={}),O[W.bucketInstanceId][W.featureIndex])continue;const H=[new i.P(F.x1,F.y1),new i.P(F.x2,F.y1),new i.P(F.x2,F.y2),new i.P(F.x1,F.y2)];i.bX(c,H)&&(O[W.bucketInstanceId][W.featureIndex]=!0,D[W.bucketInstanceId]===void 0&&(D[W.bucketInstanceId]=[]),D[W.bucketInstanceId].push(W.featureIndex))}return D}insertCollisionBox(s,c,m,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:w},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,m,v,w){const T=c?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:v,collisionGroupID:w};for(let O=0;O<s.length;O+=4)T.insertCircle(P,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,c,m,v,w,T,P){const O=[c,m,v,1];let D=!1;v||this.transform.pitch>0?(i.aC(O,O,s),this.fogState&&w&&P.name!=="globe"&&(D=function(H,q,ee,Y,ae,oe){const de=oe.calculateFogTileMatrix(ae),me=[q,ee,Y];return i.af(me,me,de),Kt(H,i.ag(me),oe.pitch,oe._fov)}(this.fogState,c,m,v,w.toUnwrapped(),this.transform)>.9)):ar(O,O,s);const F=O[3];return{point:new i.P((O[0]/F+1)/2*this.transform.width+cn,(-O[1]/F+1)/2*this.transform.height+cn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&O[2]>F||D}}isOffscreen(s,c,m,v){return m<cn||s>=this.screenRightBoundary||v<cn||c>this.screenBottomBoundary}isInsideGrid(s,c,m,v){return m>=0&&s<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=i.bA([]);return i.br(s,s,[-100,-100,0]),s}}class Ms{constructor(s,c,m,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class tl{constructor(s,c,m,v,w,T=!1){this.text=new Ms(s?s.text:null,c,m,w),this.icon=new Ms(s?s.icon:null,c,v,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rn{constructor(s,c,m,v=!1){this.text=s,this.icon=c,this.skipFade=m,this.clipped=v}}class gp{constructor(){this.invProjMatrix=i.bC(),this.viewportMatrix=i.bC(),this.circles=[]}}class wh{constructor(s,c,m,v,w){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=w}}class Sh{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[s]}}function Ko(p,s,c,m,v){const{horizontalAlign:w,verticalAlign:T}=i.c1(p),P=-(w-.5)*s,O=-(T-.5)*c,D=i.c2(p,m);return new i.P(P+D[0]*v,O+D[1]*v)}function qi(p,s,c,m,v){const w=new i.P(p,s);return c&&w._rotate(m?v:-v),w}class v2{constructor(s,c,m,v,w,T){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Fn(this.transform,w),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Sh(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(s,c,m,v,w=1){const T=m.getBucket(c),P=m.latestFeatureIndex;if(!T||!P||c.fqid!==T.layerIds[0])return;const O=T.layers[0].layout,D=T.layers[0].paint,F=m.collisionBoxArray,W=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),H=m.tileSize/i.al,q=m.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ee=(Y=m.tileID,ae=T.getProjection(),oe=this.transform,ae.name===this.projection?oe.calculateProjMatrix(Y.toUnwrapped()):Iy(oe,ae,Y));var Y,ae,oe;const de=O.get("text-pitch-alignment")==="map",me=O.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const fe=c.dynamicFilter(),Pe=c.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(m),Ae=mp(ee,m.tileID.canonical,de,me,this.transform,T.getProjection(),be);let xe=null;const ye=T.getProjection().createInversionMatrix(this.transform,m.tileID.canonical);if(de){const ke=xh(ee,m.tileID.canonical,de,me,this.transform,T.getProjection(),be);xe=i.aB([],this.transform.labelPlaneMatrix,ke)}let Ce=null;fe&&m.latestFeatureIndex&&(Ce={unwrappedTileID:q,dynamicFilter:fe,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[T.bucketInstanceId]=new wh(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,m.tileID);const[$e,Ne]=T.layers[0].layout.get("text-size-scale-range"),et=i.aA(w,$e,Ne),[tt,dt]=O.get("icon-size-scale-range"),Tt=i.aA(w,tt,dt),Ze={bucket:T,layout:O,paint:D,posMatrix:ee,invMatrix:ye,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ae,labelToScreenMatrix:xe,clippingData:Ce,scale:W,textPixelRatio:H,holdingForFade:m.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:i.bK(T.textSizeData,this.transform.zoom,et),partiallyEvaluatedIconSize:i.bK(T.iconSizeData,this.transform.zoom,Tt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(v)for(const ke of T.sortKeyRanges){const{sortKey:st,symbolInstanceStart:Ye,symbolInstanceEnd:gt}=ke;s.push({sortKey:st,symbolInstanceStart:Ye,symbolInstanceEnd:gt,parameters:Ze})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de,me,fe,Pe){const{textOffset0:be,textOffset1:Ae,crossTileID:xe}=Y,ye=[be,Ae],Ce=Ko(s,T,P,ye,O),$e=this.collisionIndex.placeCollisionBox(oe,O,c,m,v,w,qi(Ce.x,Ce.y,D,F,this.transform.angle),ee,W,H,q.predicate);if(me){const Ne=oe.getSymbolInstanceIconSize(Pe,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(oe,Ne,me,m,v,w,qi(Ce.x,Ce.y,D,F,this.transform.angle),ee,W,H,q.predicate).box.length===0)return}if($e.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Ne=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ye,width:T,height:P,anchor:s,textScale:O,prevAnchor:Ne},this.markUsedJustification(oe,s,Y,de),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,de,Y),this.placedOrientations[xe]=de),{shift:Ce,placedGlyphBoxes:$e}}}placeLayerBucketPart(s,c,m,v,w=1){const{bucket:T,layout:P,paint:O,posMatrix:D,textLabelPlaneMatrix:F,labelToScreenMatrix:W,clippingData:H,textPixelRatio:q,mercatorCenter:ee,invMatrix:Y,holdingForFade:ae,collisionBoxArray:oe,partiallyEvaluatedTextSize:de,partiallyEvaluatedIconSize:me,collisionGroup:fe,latestFeatureIndex:Pe}=s.parameters,be=P.get("text-optional"),Ae=P.get("icon-optional"),xe=P.get("text-allow-overlap"),ye=P.get("icon-allow-overlap"),Ce=P.get("text-rotation-alignment")==="map",$e=P.get("icon-rotation-alignment")==="map",Ne=P.get("text-pitch-alignment")==="map",et=O.get("symbol-z-offset"),tt=P.get("symbol-elevation-reference")==="sea",dt=P.get("symbol-placement"),[Tt,Ze]=P.get("text-size-scale-range"),[ke,st]=P.get("icon-size-scale-range"),Ye=i.aA(w,Tt,Ze),gt=i.aA(w,ke,st),Rt=P.get("text-variable-anchor"),Vt=Ce&&dt!=="point",It=$e&&dt!=="point",At=Rt&&T.hasTextData(),tr=T.hasIconTextFit()&&At&&T.hasIconData();this.transform.setProjection(T.projection);const Jt=At||Vt,zt=It||tr;let Gt=xe&&(ye||!T.hasIconData()||Ae),hr=ye&&(xe||!T.hasTextData()||be);const Or=!et.isConstant();!T.collisionArrays&&oe&&T.deserializeCollisionBoxes(oe),m&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,oe,Ye,gt);const Qr=(rr,vn,Mr)=>{const{crossTileID:Pn,numVerticalGlyphVertices:Bn}=rr;let jn=null;if(H&&H.dynamicFilterNeedsFeature||Or){const Ci=this.retainedQueryData[T.bucketInstanceId];jn=Pe.loadFeature({featureIndex:rr.featureIndex,bucketIndex:Ci.bucketIndex,sourceLayerIndex:Ci.sourceLayerIndex,layoutVertexArrayOffset:0});const zi=jn.properties?jn.properties.worldview:null;if(T.localizable&&T.worldview&&typeof zi=="string")if(zi==="all")jn.properties.$localized=!0;else{if(!zi.split(",").includes(T.worldview))return;jn.properties.$localized=!0,jn.properties.worldview=T.worldview}}if(H&&!(0,H.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},jn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new i.P(rr.tileAnchorX,rr.tileAnchorY),this.transform.calculateDistanceTileData(H.unwrappedTileID)))return this.placements[Pn]=new Rn(!1,!1,!1,!0),void c.add(Pn);const _n=et.evaluate(jn,{});if(c.has(Pn))return;if(ae)return void(this.placements[Pn]=new Rn(!1,!1,!1));let Br=!1,An=!1,Ti=!0,pi=!1,Cn=!1,fn=null,$r={box:null,offscreen:null,occluded:null},ci={box:null},ki=null,vi=null,Kn=null,ws=0,Ho=0,no=0;Mr.textFeatureIndex?ws=Mr.textFeatureIndex:rr.useRuntimeCollisionCircles&&(ws=rr.featureIndex),Mr.verticalTextFeatureIndex&&(Ho=Mr.verticalTextFeatureIndex);const Yo=T.elevationFeatures?T.elevationFeatures[rr.elevationFeatureIndex]:void 0,Jo=Ci=>{Ci.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const zi=this.transform.elevation;Ci.elevation=tt?_n:_n+i.bV.getAtTileOffset(Ci.tileID,new i.P(Ci.tileAnchorX,Ci.tileAnchorY),zi,Yo),Ci.elevation+=rr.zOffset},No=Mr.textBox;if(No){Jo(No);const Ci=Xn=>{let Vi=i.bL.horizontal;if(T.allowVerticalPlacement&&!Xn&&this.prevPlacement){const Ai=this.prevPlacement.placedOrientations[Pn];Ai&&(this.placedOrientations[Pn]=Ai,Vi=Ai,this.markUsedOrientation(T,Vi,rr))}return Vi},zi=(Xn,Vi)=>{if(T.allowVerticalPlacement&&Bn>0&&Mr.verticalTextBox){for(const Ai of T.writingModes)if(Ai===i.bL.vertical?($r=Vi(),ci=$r):$r=Xn(),$r&&$r.box&&$r.box.length)break}else $r=Xn()};if(Rt){let Xn=Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pn]){const xi=this.prevPlacement.variableOffsets[Pn];Xn.indexOf(xi.anchor)>0&&(Xn=Xn.filter(_a=>_a!==xi.anchor),Xn.unshift(xi.anchor))}const Vi=(xi,_a,Yh)=>{const za=T.getSymbolInstanceTextSize(de,rr,this.transform.zoom,vn),Jh=(xi.x2-xi.x1)*za+2*xi.padding,Id=(xi.y2-xi.y1)*za+2*xi.padding,ul=rr.hasIconTextFit&&!ye?_a:null;ul&&Jo(ul);let Vl={box:[],offscreen:!1,occluded:!1};const Md=xe?2*Xn.length:Xn.length;for(let Lc=0;Lc<Md;++Lc){const Ul=this.attemptAnchorPlacement(Xn[Lc%Xn.length],xi,ee,Y,Jt,Jh,Id,za,Ce,Ne,q,D,fe,Lc>=Xn.length,rr,vn,T,Yh,ul,de,me);if(Ul&&(Vl=Ul.placedGlyphBoxes,Vl&&Vl.box&&Vl.box.length)){Br=!0,fn=Ul.shift;break}}return Vl};zi(()=>Vi(No,Mr.iconBox,i.bL.horizontal),()=>{const xi=Mr.verticalTextBox;return xi&&Jo(xi),T.allowVerticalPlacement&&!($r&&$r.box&&$r.box.length)&&Bn>0&&xi?Vi(xi,Mr.verticalIconBox,i.bL.vertical):{box:null,offscreen:null,occluded:null}}),$r&&(Br=$r.box,Ti=$r.offscreen,pi=$r.occluded);const Ai=Ci(!(!$r||!$r.box));if(!Br&&this.prevPlacement){const xi=this.prevPlacement.variableOffsets[Pn];xi&&(this.variableOffsets[Pn]=xi,this.markUsedJustification(T,xi.anchor,rr,Ai))}}else{const Xn=(Vi,Ai)=>{const xi=T.getSymbolInstanceTextSize(de,rr,this.transform.zoom,vn),_a=this.collisionIndex.placeCollisionBox(T,xi,Vi,ee,Y,Jt,new i.P(0,0),xe,q,D,fe.predicate);return _a&&_a.box&&_a.box.length&&(this.markUsedOrientation(T,Ai,rr),this.placedOrientations[Pn]=Ai),_a};zi(()=>Xn(No,i.bL.horizontal),()=>{const Vi=Mr.verticalTextBox;return T.allowVerticalPlacement&&Bn>0&&Vi?(Jo(Vi),Xn(Vi,i.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Ci(!!($r&&$r.box&&$r.box.length))}}if(ki=$r,Br=ki&&ki.box&&ki.box.length>0,Ti=ki&&ki.offscreen,pi=ki&&ki.occluded,rr.useRuntimeCollisionCircles){const Ci=rr.centerJustifiedTextSymbolIndex>=0?rr.centerJustifiedTextSymbolIndex:rr.verticalPlacedTextSymbolIndex,zi=T.text.placedSymbolArray.get(Ci),Xn=i.bM(T.textSizeData,de,zi),Vi=P.get("text-padding");vi=this.collisionIndex.placeCollisionCircles(T,xe,zi,Ci,T.lineVertexArray,T.glyphOffsetArray,Xn,D,F,W,m,Ne,fe.predicate,rr.collisionCircleDiameter*Xn/i.bY,Vi,this.retainedQueryData[T.bucketInstanceId].tileID),Br=xe||vi.circles.length>0&&!vi.collisionDetected,Ti=Ti&&vi.offscreen,pi=vi.occluded}if(Mr.iconFeatureIndex&&(no=Mr.iconFeatureIndex),Mr.iconBox){const Ci=zi=>{Jo(zi);const Xn=rr.hasIconTextFit&&fn?qi(fn.x,fn.y,Ce,Ne,this.transform.angle):new i.P(0,0),Vi=T.getSymbolInstanceIconSize(me,this.transform.zoom,rr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Vi,zi,ee,Y,zt,Xn,ye,q,D,fe.predicate)};ci&&ci.box&&ci.box.length&&Mr.verticalIconBox?(Kn=Ci(Mr.verticalIconBox),An=Kn.box.length>0):(Kn=Ci(Mr.iconBox),An=Kn.box.length>0),Ti=Ti&&Kn.offscreen,Cn=Kn.occluded}const Qs=be||rr.numHorizontalGlyphVertices===0&&Bn===0,ya=Ae||rr.numIconVertices===0;if(Qs||ya?ya?Qs||(An=An&&Br):Br=An&&Br:An=Br=An&&Br,Br&&ki&&ki.box&&this.collisionIndex.insertCollisionBox(ki.box,P.get("text-ignore-placement"),T.bucketInstanceId,ci&&ci.box&&Ho?Ho:ws,fe.ID),An&&Kn&&this.collisionIndex.insertCollisionBox(Kn.box,P.get("icon-ignore-placement"),T.bucketInstanceId,no,fe.ID),vi&&(Br&&this.collisionIndex.insertCollisionCircles(vi.circles,P.get("text-ignore-placement"),T.bucketInstanceId,ws,fe.ID),m)){const Ci=T.bucketInstanceId;let zi=this.collisionCircleArrays[Ci];zi===void 0&&(zi=this.collisionCircleArrays[Ci]=new gp);for(let Xn=0;Xn<vi.circles.length;Xn+=4)zi.circles.push(vi.circles[Xn+0]),zi.circles.push(vi.circles[Xn+1]),zi.circles.push(vi.circles[Xn+2]),zi.circles.push(vi.collisionDetected?1:0)}const ks=T.projection.name!=="globe";Gt=Gt&&(ks||!pi),hr=hr&&(ks||!Cn),this.placements[Pn]=new Rn(Br||Gt,An||hr,Ti||T.justReloaded),c.add(Pn)},wn=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,wn),T.elevationType==="road"&&T.updateRoadElevation(wn.canonical),T.updateZOffset(),T.sortFeaturesByY){const rr=T.getSortedSymbolIndexes(this.transform.angle);for(let vn=rr.length-1;vn>=0;--vn){const Mr=rr[vn];Qr(T.symbolInstances.get(Mr),Mr,T.collisionArrays[Mr])}T.hasAnyZOffset&&i.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const rr=T.getSortedIndexesByZOffset();for(let vn=0;vn<rr.length;++vn){const Mr=rr[vn];Qr(T.symbolInstances.get(Mr),Mr,T.collisionArrays[Mr])}}else for(let rr=s.symbolInstanceStart;rr<s.symbolInstanceEnd;rr++)Qr(T.symbolInstances.get(rr),rr,T.collisionArrays[rr]);if(m&&T.bucketInstanceId in this.collisionCircleArrays){const rr=this.collisionCircleArrays[T.bucketInstanceId];i.bl(rr.invProjMatrix,D),rr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(s,c,m,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O,crossTileID:D}=m,F=i.c3(c),W=v===i.bL.vertical?O:F==="left"?w:F==="center"?T:F==="right"?P:-1;w>=0&&(s.text.placedSymbolArray.get(w).crossTileID=W>=0&&w!==W?0:D),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=W>=0&&T!==W?0:D),P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=W>=0&&P!==W?0:D),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=W>=0&&O!==W?0:D)}markUsedOrientation(s,c,m){const v=c===i.bL.horizontal||c===i.bL.horizontalOnly?c:0,w=c===i.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:D}=m,F=s.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=v),P>=0&&(F.get(P).placedOrientation=v),O>=0&&(F.get(O).placedOrientation=v),D>=0&&(F.get(D).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(s):1,w=c?c.opacities:{},T=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const O in this.placements){const D=this.placements[O],F=w[O];F?(this.opacities[O]=new tl(F,v,D.text,D.icon,null,D.clipped),m=m||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[O]=new tl(null,v,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const O in w){const D=w[O];if(!this.opacities[O]){const F=new tl(D,v,!1,!1);F.isHidden()||(this.opacities[O]=F,m=m||D.text.placed||D.icon.placed)}}for(const O in T)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=T[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c,m,v){v&&(this.lastReplacementSourceUpdateTime=v.updateTime);const w=new Set;for(const T of c){const P=T.getBucket(s);P&&T.latestFeatureIndex&&s.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,w,T,T.collisionBoxArray,m,v,T.tileID,s.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,T.tileID),P.elevationType==="road"&&P.updateRoadElevation(T.tileID.canonical),P.updateZOffset())}}updateBucketOpacities(s,c,m,v,w,T,P,O){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const D=s.layers[0].layout,F=s.layers[0].paint,W=!!s.layers[0].dynamicFilter(),H=new tl(null,0,!1,!1,!0),q=D.get("text-allow-overlap"),ee=D.get("icon-allow-overlap"),Y=D.get("text-variable-anchor"),ae=D.get("text-rotation-alignment")==="map",oe=D.get("text-pitch-alignment")==="map",de=F.get("symbol-z-offset"),me=D.get("symbol-elevation-reference")==="sea",fe=!de.isConstant(),Pe=new tl(null,0,q&&(ee||!s.hasIconData()||D.get("icon-optional")),ee&&(q||!s.hasTextData()||D.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const be=(xe,ye,Ce)=>{for(let $e=0;$e<ye/4;$e++)xe.opacityVertexArray.emplaceBack(Ce)};let Ae=0;T&&s.updateReplacement(P,T);for(let xe=0;xe<s.symbolInstances.length;xe++){const ye=s.symbolInstances.get(xe),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:$e,crossTileID:Ne,numIconVertices:et,tileAnchorX:tt,tileAnchorY:dt}=ye;let Tt=null;const Ze=this.retainedQueryData[s.bucketInstanceId];fe&&ye&&Ze&&(Tt=m.latestFeatureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:Ze.bucketIndex,sourceLayerIndex:Ze.sourceLayerIndex,layoutVertexArrayOffset:0}));const ke=de.evaluate(Tt,{}),st=c.has(Ne);let Ye=this.opacities[Ne];st?Ye=H:Ye||(Ye=Pe,this.opacities[Ne]=Ye),c.add(Ne);const gt=Ce>0||$e>0,Rt=et>0,Vt=this.placedOrientations[Ne],It=Vt===i.bL.vertical,At=Vt===i.bL.horizontal||Vt===i.bL.horizontalOnly;!gt&&!Rt||Ye.isHidden()||Ae++;let tr=!1;if((gt||Rt)&&T)for(const Jt of s.activeReplacements){if(i.bZ(Jt,w,i.b_.Symbol,O)||Jt.min.x>tt||tt>Jt.max.x||Jt.min.y>dt||dt>Jt.max.y)continue;const zt=i.b$(tt,dt,P.canonical,Jt.footprintTileId.canonical);if(tr=i.c0(zt,Jt.footprint),tr)break}if(gt){const Jt=tr?pu:_s(Ye.text);be(s.text,Ce,It?pu:Jt),be(s.text,$e,At?pu:Jt);const zt=Ye.text.isHidden(),{leftJustifiedTextSymbolIndex:Gt,centerJustifiedTextSymbolIndex:hr,rightJustifiedTextSymbolIndex:Or,verticalPlacedTextSymbolIndex:Qr}=ye,wn=s.text.placedSymbolArray,rr=zt||It?1:0;Gt>=0&&(wn.get(Gt).hidden=rr),hr>=0&&(wn.get(hr).hidden=rr),Or>=0&&(wn.get(Or).hidden=rr),Qr>=0&&(wn.get(Qr).hidden=zt||At?1:0);const vn=this.variableOffsets[Ne];vn&&this.markUsedJustification(s,vn.anchor,ye,Vt);const Mr=this.placedOrientations[Ne];Mr&&(this.markUsedJustification(s,"left",ye,Mr),this.markUsedOrientation(s,Mr,ye))}if(Rt){const Jt=tr?pu:_s(Ye.icon),{placedIconSymbolIndex:zt,verticalPlacedIconSymbolIndex:Gt}=ye,hr=s.icon.placedSymbolArray,Or=Ye.icon.isHidden()?1:0;zt>=0&&(be(s.icon,et,It?pu:Jt),hr.get(zt).hidden=Or),Gt>=0&&(be(s.icon,ye.numVerticalIconVertices,At?pu:Jt),hr.get(Gt).hidden=Or)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Jt=s.collisionArrays[xe];if(Jt){let zt=new i.P(0,0),Gt=!0;if(Jt.textBox||Jt.verticalTextBox){if(Y){const Or=this.variableOffsets[Ne];Or?(zt=Ko(Or.anchor,Or.width,Or.height,Or.textOffset,Or.textScale),ae&&zt._rotate(oe?this.transform.angle:-this.transform.angle)):Gt=!1}W&&(Gt=!Ye.clipped),Jt.textBox&&bc(s.textCollisionBox.collisionVertexArray,Ye.text.placed,!Gt||It,ke,me,zt.x,zt.y),Jt.verticalTextBox&&bc(s.textCollisionBox.collisionVertexArray,Ye.text.placed,!Gt||At,ke,me,zt.x,zt.y)}const hr=Gt&&!!(!At&&Jt.verticalIconBox);Jt.iconBox&&bc(s.iconCollisionBox.collisionVertexArray,Ye.icon.placed,hr,ke,me,ye.hasIconTextFit?zt.x:0,ye.hasIconTextFit?zt.y:0),Jt.verticalIconBox&&bc(s.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!hr,ke,me,ye.hasIconTextFit?zt.x:0,ye.hasIconTextFit?zt.y:0)}}}if(s.fullyClipped=Ae===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=xe.invProjMatrix,s.placementViewportMatrix=xe.viewportMatrix,s.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>s}isStale(){return this.stale}setStale(){this.stale=!0}}function bc(p,s,c,m,v,w,T){p.emplaceBack(s?1:0,c?1:0,w||0,T||0,m,v?1:0),p.emplaceBack(s?1:0,c?1:0,w||0,T||0,m,v?1:0),p.emplaceBack(s?1:0,c?1:0,w||0,T||0,m,v?1:0),p.emplaceBack(s?1:0,c?1:0,w||0,T||0,m,v?1:0)}const Ry=Math.pow(2,25),Th=Math.pow(2,24),yp=Math.pow(2,17),ky=Math.pow(2,16),_p=Math.pow(2,9),ys=Math.pow(2,8),Il=Math.pow(2,1);function _s(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Ry+s*Th+c*yp+s*ky+c*_p+s*ys+c*Il+s}const pu=0;class sd{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,m,v,w,T){const P=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(P,v,s[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,D)=>O.sortKey-D.sortKey));this._currentPartIndex<P.length;){const O=P[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,m,O.symbolInstanceStart===0,T),this._currentPartIndex++,w())return!0}return!1}}class To{constructor(s,c,m,v,w,T,P,O,D){this.placement=new v2(s,w,T,P,O,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,c,m,v,w){const T=i.o.now(),P=()=>{const O=i.o.now()-T;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[s[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&O.visibility!=="none"&&(!O.minzoom||O.minzoom<=D)&&(!O.maxzoom||O.maxzoom>D)){const F=O,W=F.layout.get("symbol-z-elevate"),H=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=F.layout.get("symbol-z-order"),ee=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&H),Y=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ae=ee&&Y,oe=this._inProgressLayer=this._inProgressLayer||new sd(F),de=i.B(O.source,O.scope);if(oe.continuePlacement(W||ae?v[de]:m[de],this.placement,this._showCollisionBoxes,O,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const da=512/i.al/2;class Ml{constructor(s,c,m){this.tileID=s,this.bucketInstanceId=m,this.index=new i.c4(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*i.al,w=s.canonical.y*i.al;for(let T=0;T<c.length;T++){const{key:P,crossTileID:O,tileAnchorX:D,tileAnchorY:F}=c.get(T),W=Math.floor((v+D)*da),H=Math.floor((w+F)*da);this.index.add(W,H),this.keys.push(P),this.crossTileIDs.push(O)}this.index.finish()}findMatches(s,c,m){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=da/Math.pow(2,c.canonical.z-this.tileID.canonical.z),T=c.canonical.x*i.al,P=c.canonical.y*i.al;for(let O=0;O<s.length;O++){const D=s.get(O);if(D.crossTileID)continue;const{key:F,tileAnchorX:W,tileAnchorY:H}=D,q=Math.floor((T+W)*w),ee=Math.floor((P+H)*w),Y=this.index.range(q-v,ee-v,q+v,ee+v).sort((ae,oe)=>ae-oe);for(const ae of Y){const oe=this.crossTileIDs[ae];if(this.keys[ae]===F&&!m.has(oe)){m.add(oe),D.crossTileID=oe;break}}}}}class uo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const m in this.indexes){const v=this.indexes[m],w={};for(const T in v){const P=v[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),w[P.tileID.key]=P}this.indexes[m]=w}this.lng=s}addBucket(s,c,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>s.overscaledZ)for(const P in T){const O=T[P];O.tileID.isChildOf(s)&&O.findMatches(c.symbolInstances,s,v)}else{const P=T[s.scaledTo(Number(w)).key];P&&P.findMatches(c.symbolInstances,s,v)}}for(let w=0;w<c.symbolInstances.length;w++){const T=c.symbolInstances.get(w);T.crossTileID||(T.crossTileID=m.generate(),v.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ml(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let c=!1;for(const m in this.indexes){const v=this.indexes[m];for(const w in v)s[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[w]),delete v[w],c=!0)}return c}}class ka{constructor(){this.layerIndexes={},this.crossTileIDs=new uo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,m,v){let w=this.layerIndexes[s.fqid];w===void 0&&(w=this.layerIndexes[s.fqid]=new jy);let T=!1;const P={};v.name!=="globe"&&w.handleWrapJump(m);for(const O of c){const D=O.getBucket(s);D&&s.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,D,this.crossTileIDs)&&(T=!0),P[D.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(T=!0),T}pruneUnusedLayers(s){const c={};s.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const rl=771;class Nr{constructor(s,c,m,v){this.blendFunction=s,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=v}}Nr.Replace=[1,0,1,0],Nr.disabled=new Nr(Nr.Replace,i.ao.transparent,[!1,!1,!1,!1]),Nr.unblended=new Nr(Nr.Replace,i.ao.transparent,[!0,!0,!0,!0]),Nr.alphaBlended=new Nr([1,rl,1,rl],i.ao.transparent,[!0,!0,!0,!0]),Nr.alphaBlendedNonPremultiplied=new Nr([770,rl,770,rl],i.ao.transparent,[!0,!0,!0,!0]),Nr.multiply=new Nr([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),Nr.additive=new Nr([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class ir{constructor(s,c,m){this.func=s,this.mask=c,this.range=m}}ir.ReadOnly=!1,ir.ReadWrite=!0,ir.disabled=new ir(519,ir.ReadOnly,[0,1]);const vp=7680;class Ar{constructor(s,c,m,v,w,T){this.test=s,this.ref=c,this.mask=m,this.fail=v,this.depthFail=w,this.pass=T}}Ar.disabled=new Ar({func:519,mask:0},0,0,vp,vp,vp);const ad=1029,xp=2305;class wr{constructor(s,c,m){this.enable=s,this.mode=c,this.frontFace=m}}function nl(p,s){const c=i.ca(p,3);i.cc(p,s),i.cg(p,3,c)}function Dy(p,s){const c=i.c7([]);return i.c8(c,c,-s),i.c9(c,c,-p),c}function bp(p,s){const c=[p[0],p[1],0],m=[s[0],s[1],0];if(i.ag(c)>=1e-15){const T=i.aw([],c);i.c5(m,T,i.bJ(m,T)),s[0]=m[0],s[1]=m[1]}const v=i.bI([],s,p);if(i.c6(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return Dy(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}wr.disabled=new wr(!1,ad,xp),wr.backCCW=new wr(!0,ad,xp),wr.backCW=new wr(!0,ad,2304),wr.frontCW=new wr(!0,1028,2304),wr.frontCCW=new wr(!0,1028,xp);class vs{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof i.ae?s:new i.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=i.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c,m){if(this.orientation=null,!this.position)return;const v=this.position,w=m||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(s)):0),T=i.ae.fromLngLat(s,w),P=[T.x-v.x,T.y-v.y,T.z-v.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=bp(P,c)}setPitchBearing(s,c){this.orientation=Dy(i.an(s),i.an(-c))}}class wp{constructor(s,c){this._transform=i.bA([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new i.ae(s[0],s[1],s[2])}get position(){const s=i.ca(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&i.cg(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.c7([]),s&&nl(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Dy(s,c),nl(this._transform,this._orientation)}forward(){const s=i.ca(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=i.ca(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=i.ca(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const m=new Float64Array(16);return i.bl(m,this.getWorldToCamera(s,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,m){const v=this.position;i.c5(v,v,-s);const w=new Float64Array(16);return i.bq(w,[m,m,m]),i.br(w,w,v),w[10]*=c,w}getWorldToCamera(s,c){const m=new Float64Array(16),v=new Float64Array(4),w=this.position;return i.cb(v,this._orientation),i.c5(w,w,-s),i.cc(m,v),i.br(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(s,c,m,v){const w=new Float64Array(16);return i.cd(w,s,c,m,v),w}getCameraToClipOrthographic(s,c,m,v,w,T){const P=new Float64Array(16);return i.ce(P,s,c,m,v,w,T),P}getDistanceToElevation(s,c=!1){const m=s===0?0:i.cf(s,c?i.a$(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new wp([...this.position],[...this.orientation])}}const Oo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Sp{constructor(s=0,c=0,m=0,v=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=m,this.right=v}interpolate(s,c,m){return c.top!=null&&s.top!=null&&(this.top=i.ak(s.top,c.top,m)),c.bottom!=null&&s.bottom!=null&&(this.bottom=i.ak(s.bottom,c.bottom,m)),c.left!=null&&s.left!=null&&(this.left=i.ak(s.left,c.left,m)),c.right!=null&&s.right!=null&&(this.right=i.ak(s.right,c.right,m)),this}getCenter(s,c){const m=i.aA((this.left+s-this.right)/2,0,s),v=i.aA((this.top+c-this.bottom)/2,0,c);return new i.P(m,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Sp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ja=15;class Ly{constructor(s,c,m,v,w,T,P){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new i.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Sp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new wp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Ly(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<ja}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.cm(this.projectionOptions);const m=this.getProjection(),v=!i.by(c,m);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cm({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bT(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cn(),i.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=i.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,w=0;for(let T=0;T<c.length;T++){const P=new i.P(c[T][0]*this.width,m+c[T][1]*(this.height-m)),O=s.pointCoordinate(P);if(!O)continue;const D=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);v+=O[3]*D,w+=D}return w===0?NaN:v/w}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(s),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-m,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}equals(s){const c=this.elevation,m=s.elevation,v=c!=null!=(m!=null)||c&&m&&c.exaggeration()!==m.exaggeration();return this.width===s.width&&this.height===s.height&&this.center.lng===s.center.lng&&this.center.lat===s.center.lat&&this.zoom===s.zoom&&this.bearing===s.bearing&&this.pitch===s.pitch&&this.fov===s.fov&&this.projection.name===s.projection.name&&this._edgeInsets.equals(s.padding)&&!v}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const v=i.ag(i.av([],this._camera.position,m));return i.aA(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!i.cp(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];i.cq(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new vs;return c.position=new i.ae(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!i.cr(s))return!1;i.cs(s,s);const c=i.ct([],[0,0,-1],s),m=i.ct([],[0,-1,0],s);if(m[2]<0)return!1;const v=bp(c,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=i.aA(s[2],v/m,v/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,m){this._unmodified=!1,this._edgeInsets.interpolate(s,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new i.cu(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),w=this.pointCoordinate(new i.P(this.width,this.height)),T=this.pointCoordinate(new i.P(0,this.height)),P=Math.floor(Math.min(m.x,v.x,w.x,T.x)),O=Math.floor(Math.max(m.x,v.x,w.x,T.x)),D=1;for(let F=P-D;F<=O+D;F++)F!==0&&c.push(new i.cu(F,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,c,m,v){let w=[];const T=m!=null,P=!T;if(P&&this.zoom<c||T&&m[0]===0&&m[1]===0)return w;const O=new Set,D=(W,H,q,ee,Y)=>{const ae=i.cY(H,W,q,ee,Y);O.has(ae)||(w.push(new i.aQ(W,H,q,ee,Y)),O.add(ae))};for(let W=0;W<s.length;W++){const H=s[W];if(P&&H.canonical.z!==c||T&&v!==void 0&&v>H.canonical.z)continue;const q=H.canonical,ee=H.overscaledZ,Y=H.wrap,ae=1<<q.z,oe=q.x+1<ae,de=q.x>0,me=q.y+1<ae,fe=q.y>0,Pe=H.wrap-(de?0:1),be=H.wrap+(oe?0:1),Ae=de?q.x-1:ae-1,xe=oe?q.x+1:0;if(T)m[0]<0?(D(ee,be,q.z,xe,q.y),m[1]<0&&me&&(D(ee,Y,q.z,q.x,q.y+1),D(ee,be,q.z,xe,q.y+1)),m[1]>0&&fe&&(D(ee,Y,q.z,q.x,q.y-1),D(ee,be,q.z,xe,q.y-1))):m[0]>0?(D(ee,Pe,q.z,Ae,q.y),m[1]<0&&me&&(D(ee,Y,q.z,q.x,q.y+1),D(ee,Pe,q.z,Ae,q.y+1)),m[1]>0&&fe&&(D(ee,Y,q.z,q.x,q.y-1),D(ee,Pe,q.z,Ae,q.y-1))):m[1]<0&&me?D(ee,Y,q.z,q.x,q.y+1):fe&&D(ee,Y,q.z,q.x,q.y-1);else{const ye=H.visibleQuadrants;1&ye&&(D(ee,Pe,q.z,Ae,q.y),fe&&(D(ee,Y,q.z,q.x,q.y-1),D(ee,Pe,q.z,Ae,q.y-1))),2&ye&&(D(ee,be,q.z,xe,q.y),fe&&(D(ee,Y,q.z,q.x,q.y-1),D(ee,be,q.z,xe,q.y-1))),4&ye&&(D(ee,Pe,q.z,Ae,q.y),me&&(D(ee,Y,q.z,q.x,q.y+1),D(ee,Pe,q.z,Ae,q.y+1))),8&ye&&(D(ee,be,q.z,xe,q.y),me&&(D(ee,Y,q.z,q.x,q.y+1),D(ee,be,q.z,xe,q.y+1)))}}const F=[];for(const W of w)w.some(H=>W.isChildOf(H))||F.push(W);if(w=F.filter(W=>!s.some(H=>!!(W.overscaledZ<c&&H.isChildOf(W))||W.equals(H)||W.isChildOf(H))),P){const W=1<<c,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[W*H.x,W*H.y],ee=4,Y=ee*ee;w=w.filter(ae=>{const oe=ae.canonical.x+.5-q[0],de=ae.canonical.y+.5-q[1];return oe*oe+de*de<Y})}return w}extendTileCoverToNearPlane(s,c,m){const v=[],w=new Set;for(const de of s)w.add(de.key);const T=(de,me,fe,Pe,be)=>{const Ae=i.cY(me,de,fe,Pe,be);w.has(Ae)||(v.push(new i.aQ(de,me,fe,Pe,be)),w.add(Ae))},P=s.reduce((de,me)=>Math.max(de,me.overscaledZ),m),O=1<<m,D=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],F=new i.P(0,0),W=new i.P(0,0),H=(de,me)=>{const fe=Math.floor(de[0]),Pe=Math.floor(de[1]),be=(de[0]-fe)*i.al,Ae=(de[1]-Pe)*i.al,xe=Math.floor(me[0]),ye=Math.floor(me[1]),Ce=(me[0]-xe)*i.al,$e=(me[1]-ye)*i.al;for(let Ne=-1;Ne<=1;Ne++){const et=fe+Ne;if(!(et<0||et>=O)){F.x=be-Ne*i.al,W.x=Ce-(et-xe)*i.al;for(let tt=-1;tt<=1;tt++){const dt=Pe+tt;F.y=Ae-tt*i.al,W.y=$e-(dt-ye)*i.al,i.cZ(F,W,D)&&T(P,0,m,et,dt)}}}},q=c.points,ee=q[i.cv],Y=q[i.cw],ae=this._projectToGround(ee,q[i.cx]),oe=this._projectToGround(Y,q[i.cy]);return H(ee,ae),H(Y,oe),v}_projectToGround(s,c){return i.cz(i.cA(),s,c,s[2]/(s[2]-c[2]))}coveringTiles(s){let c=this.coveringZoomLevel(s);const m=c,v=this.elevation&&this.elevation.exaggeration(),w=v&&!s.isTerrainDEM,T=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const P=this.locationCoordinate(this.center),O=this.center.lat,D=1<<c,F=[D*P.x,D*P.y,0],W=this.projection.name==="globe",H=!W,q=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,H),ee=W?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=D*i.cf(1,this.center.lat),ae=this._camera.position[2]/i.cf(1,this.center.lat),oe=[D*ee.x,D*ee.y,ae*(H?1:Y)],de=W||v,me=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),fe=this.isLODDisabled(!0)?c:0;let Pe;if(this._elevation&&s.isTerrainDEM)Pe=1e4*this._elevation.exaggeration();else if(this._elevation){const ke=this._elevation.getMinMaxForVisibleTiles();Pe=ke?ke.max:this._centerAltitude}else Pe=this._centerAltitude;const be=s.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?i.cC(this):1,xe=ke=>{const Ye=new i.ae(ke.x+25e-6,ke.y,ke.z),gt=new i.ae(ke.x,ke.y+25e-6,ke.z),Rt=ke.toLngLat(),Vt=Ye.toLngLat(),It=gt.toLngLat(),At=this.locationCoordinate(Rt),tr=this.locationCoordinate(Vt),Jt=this.locationCoordinate(It),zt=Math.hypot(tr.x-At.x,tr.y-At.y),Gt=Math.hypot(Jt.x-At.x,Jt.y-At.y);return Math.sqrt(zt*Gt)*Ae/25e-6},ye=ke=>{const st=Pe,Ye=be;return{aabb:i.cF(this,D,0,0,0,ke,Ye,st,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:st,wrap:ke,fullyVisible:!1}},Ce=[];let $e=[];const Ne=c,et=s.reparseOverscaled?m:c,tt=(ae-this._centerAltitude)*Y,dt=ke=>{if(!this._elevation||!ke.tileID||!T)return;const st=this._elevation.getMinMaxForTile(ke.tileID),Ye=ke.aabb;st?(Ye.min[2]=st.min,Ye.max[2]=st.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(ke.shouldSplit=Ze(ke),ke.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Tt=(ke,st)=>{if(.707*st<ke)return 1;const Ye=st/ke;return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)},Ze=ke=>{if(ke.zoom<fe)return!0;if(ke.zoom===Ne)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const st=ke.aabb.distanceX(oe),Ye=ke.aabb.distanceY(oe);let gt=tt,Rt=1;if(W){gt=ke.aabb.distanceZ(oe);const Gt=Math.pow(2,ke.zoom),hr=i.a$((ke.y+1)/Gt),Or=i.a$(ke.y/Gt),Qr=Math.min(Math.max(O,hr),Or),wn=i.d1(Qr)/i.d1(O);if(Rt=Qr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wn/this._mercatorScaleRatio),this.zoom<=i.c_&&ke.zoom===Ne-1&&wn>=.9)return!0}else if(w&&(gt=ke.aabb.distanceZ(oe)*Y),this.projection.isReprojectedInTileSpace&&m<=5){const Gt=Math.pow(2,ke.zoom),hr=xe(new i.ae((ke.x+.5)/Gt,(ke.y+.5)/Gt));Rt=hr>.85?1:hr}if(!T&&!W){const Gt=Math.sqrt(st*st+Ye*Ye+gt*gt);let hr=(1<<Ne-ke.zoom)*me*Rt;return hr*=Tt(Math.max(gt,tt),Gt),Gt<hr}let Vt=Number.MAX_VALUE,It=0;const At=ke.aabb.getCorners(),tr=[];for(const Gt of At){i.av(tr,Gt,oe),W||(w?tr[2]*=Y:tr[2]=tt);const hr=i.bJ(tr,this._camera.forward());hr<Vt&&(Vt=hr,It=Math.abs(tr[2]))}let Jt=(1<<Ne-ke.zoom)*me*Rt;if(Jt*=Tt(Math.max(It,tt),Vt),Vt<Jt)return!0;const zt=ke.aabb.closestPoint(F);return zt[0]===F[0]&&zt[1]===F[1]};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Ce.push(ye(-ke)),Ce.push(ye(ke));for(Ce.push(ye(0));Ce.length>0;){const ke=Ce.pop(),st=ke.x,Ye=ke.y;let gt=ke.fullyVisible;const Rt=()=>this.projection.name==="globe"&&(ke.y===0||ke.y===(1<<ke.zoom)-1);if(!gt){let Vt=de?ke.aabb.intersects(q):ke.aabb.intersectsFlat(q);if(Vt===0&&Rt()){const It=new i.cD(ke.zoom,st,Ye);Vt=i.cE(this,D,It,!0).intersects(q)}if(Vt===0)continue;gt=Vt===2}if(ke.zoom!==Ne&&Ze(ke))for(let Vt=0;Vt<4;Vt++){const It=(st<<1)+Vt%2,At=(Ye<<1)+(Vt>>1),tr={aabb:T?ke.aabb.quadrant(Vt):i.cF(this,D,ke.zoom+1,It,At,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:It,y:At,wrap:ke.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};w&&!W&&(tr.tileID=new i.aQ(ke.zoom+1===Ne?et:ke.zoom+1,ke.wrap,ke.zoom+1,It,At),dt(tr)),Ce.push(tr)}else{const Vt=ke.zoom===Ne?et:ke.zoom;if(s.minzoom&&s.minzoom>Vt)continue;let It=0;if(!gt){let zt=de?ke.aabb.intersectsPrecise(q):ke.aabb.intersectsPreciseFlat(q);if(zt===0&&Rt()){const Gt=new i.cD(ke.zoom,st,Ye);zt=i.cE(this,D,Gt,!0).intersectsPrecise(q)}if(zt===0)continue;if(s.calculateQuadrantVisibility)if(q.containsPoint(ke.aabb.center))It=15;else for(let Gt=0;Gt<4;Gt++)ke.aabb.quadrant(Gt).intersects(q)!==0&&(It|=1<<Gt)}const At=F[0]-(.5+st+(ke.wrap<<ke.zoom))*(1<<c-ke.zoom),tr=F[1]-.5-Ye,Jt=ke.tileID?ke.tileID:new i.aQ(Vt,ke.wrap,ke.zoom,st,Ye);s.calculateQuadrantVisibility&&(Jt.visibleQuadrants=It),$e.push({tileID:Jt,distanceSq:At*At+tr*tr})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,st=this.horizonLineFromTop();$e=$e.filter(Ye=>{const gt=[0,0,0,1],Rt=[i.al,i.al,0,1],Vt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.aC(gt,gt,Vt),i.aC(Rt,Rt,Vt);const It=i.cG([],gt,Rt),At=i.cH([],gt,Rt),tr=i.c$(It,At);if(tr===0)return!0;let Jt=!1;const zt=this._elevation;if(zt&&tr>ke&&st!==0){const Gt=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let hr;s.isTerrainDEM||(hr=zt.getMinMaxForTile(Ye.tileID)),hr||(hr={min:be,max:Pe});const Or=i.cI(this.rotation),Qr=[Or[0]*i.al,Or[1]*i.al,hr.max];i.af(Qr,Qr,Gt),Jt=(1-Qr[1])*this.height*.5<st}return tr<ke||Jt})}return $e.sort((ke,st)=>ke.distanceSq-st.distanceSq).map(ke=>ke.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const c=i.aA(s.lat,-i.cJ,i.cJ),m=this.projection.project(s.lng,c);return new i.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let m,v;const w=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;m=(c.x-w.x)/P,v=(c.y-w.y)/P}else{const P=this.pointCoordinate(c),O=this.pointCoordinate(w);m=P.x-O.x,v=P.y-O.y}const T=this.locationCoordinate(s);this.setLocation(new i.ae(T.x-m,T.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,c){return this.projection.locationPoint(this,s,c)}locationPoint3D(s,c){return this.projection.locationPoint(this,s,c,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,c){return this.coordinateLocation(this.pointCoordinate3D(s,c))}locationCoordinate(s,c){const m=c?i.cf(c,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new i.ae(v.x,v.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const m=c??this._centerAltitude,v=[s.x,s.y,0,1],w=[s.x,s.y,1,1];i.aC(v,v,this.pixelMatrixInverse),i.aC(w,w,this.pixelMatrixInverse);const T=w[3];i.cK(v,v,1/v[3]),i.cK(w,w,1/T);const P=v[2],O=w[2];return{p0:v,p1:w,t:P===O?0:(m-P)/(O-P)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return i.aC(c,c,this.pixelMatrixInverse),i.aC(m,m,this.pixelMatrixInverse),i.cK(c,c,1/c[3]),i.cK(m,m,1/m[3]),c[2]=i.cf(c[2],this._center.lat)*this.worldSize,m[2]=i.cf(m[2],this._center.lat)*this.worldSize,i.cK(c,c,1/this.worldSize),i.cK(m,m,1/this.worldSize),new i.ax([c[0],c[1],c[2]],i.aw([],i.av([],m,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:m,t:v}=s,w=i.cf(c[2],this._center.lat),T=i.cf(m[2],this._center.lat);return new i.ae(i.ak(c[0],m[0],v)/this.worldSize,i.ak(c[1],m[1],v)/this.worldSize,i.ak(w,T,v))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s,c){if(!this.elevation)return this.pointCoordinate(s,c);let m=this.projection.pointCoordinate3D(this,s.x,s.y);if(m)return new i.ae(m[0],m[1],m[2]);let v=0,w=this.horizonLineFromTop();if(s.y>w)return this.pointCoordinate(s,c);const T=.02*w,P=s.clone();for(let O=0;O<10&&w-v>T;O++){P.y=i.ak(v,w,.66);const D=this.projection.pointCoordinate3D(this,P.x,P.y);D?(w=P.y,m=D):v=P.y}return m?new i.ae(m[0],m[1],m[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.cL)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return i.aC(v,v,this.pixelMatrix),v[3]>0?new i.P(v[0]/v[3],v[1]/v[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new i.P(c,s)),T=this.pointLocation3D(new i.P(v,s)),P=this.pointLocation3D(new i.P(v,m)),O=this.pointLocation3D(new i.P(c,m));let D=Math.min(w.lng,T.lng,P.lng,O.lng),F=Math.max(w.lng,T.lng,P.lng,O.lng),W=Math.min(w.lat,T.lat,P.lat,O.lat),H=Math.max(w.lat,T.lat,P.lat,O.lat);const q=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Y=(ae,oe,de,me,fe)=>{const Pe=(ae+de)/2,be=(oe+me)/2,Ae=new i.P(Pe,be),{lng:xe,lat:ye}=this.pointLocation3D(Ae),Ce=Math.max(0,D-xe,W-ye,xe-F,ye-H);D=Math.min(D,xe),F=Math.max(F,xe),W=Math.min(W,ye),H=Math.max(H,ye),(fe<ee||Ce>q)&&(Y(ae,oe,Pe,be,fe+1),Y(Pe,be,de,me,fe+1))};if(Y(c,s,v,s,1),Y(v,s,v,m,1),Y(v,m,c,m,1),Y(c,m,c,s,1),this.projection.name==="globe"){const[ae,oe]=i.cM(this);ae?(H=90,F=180,D=-180):oe&&(W=-90,F=180,D=-180)}return new i.aI(new i.aT(D,W),new i.aT(F,H))}_getBoundsRectangular(s,c){const{top:m,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,P=new i.P(v,m),O=new i.P(T,m),D=new i.P(T,w),F=new i.P(v,w);let W=this.pointCoordinate(P,s),H=this.pointCoordinate(O,s);const q=this.pointCoordinate(D,c),ee=this.pointCoordinate(F,c),Y=(ae,oe)=>(oe.y-ae.y)/(oe.x-ae.x);return W.y>1&&H.y>=0?W=new i.ae((1-ee.y)/Y(ee,W)+ee.x,1):W.y<0&&H.y<=1&&(W=new i.ae(-ee.y/Y(ee,W)+ee.x,0)),H.y>1&&W.y>=0?H=new i.ae((1-q.y)/Y(q,H)+q.x,1):H.y<0&&W.y<=1&&(H=new i.ae(-q.y/Y(q,H)+q.x,0)),new i.aI().extend(this.coordinateLocation(W)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((m,v)=>{if(v.dem){const w=v.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.cJ,this.maxLat=i.cJ,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,m=this._distanceTileDataCache;if(m[c])return m[c];const v=s.canonical,w=1/this.height,T=this.cameraWorldSize,P=T/this.zoomScale(v.z),O=(v.x+Math.pow(2,v.z)*s.wrap)*P,D=v.y*P,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const W=this.angle,H=Math.sin(-W),q=-Math.cos(-W);return m[c]={bearing:[H,q],center:[(F.x-O)*w,(F.y-D)*w],scale:P/i.al*w},m[c]}calculateFogTileMatrix(s){const c=s.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.aB(v,this.worldToFogMatrix,v),m[c]=new Float32Array(v),m[c]}calculateProjMatrix(s,c=!1,m=!1){const v=s.key;let w;if(w=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const T=this.calculatePosMatrix(s,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.aB(T,P,T),w[v]=new Float32Array(T),w[v]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const v=i.cN(s,this);return m[c]=v,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=i.bq([],[s,s,s]);return i.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=i.cf(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),v=this._camera.forward(),w=i.cf(1,this._center.lat);m[2]/=w,v[2]/=w,i.aw(v,v);const T=s.raycast(m,v,s.exaggeration());if(T){const P=i.bH([],m,v,T),O=new i.ae(P[0],P[1],i.cf(P[2],i.a$(P[1]))),D=(O.z+i.ag([O.x-m[0],O.y-m[1],O.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,m=i.cf(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),w=c.getAtPointOrZero(new i.ae(...v)),T=this.pixelsPerMeter/this.worldSize*w,P=this._minimumHeightOverTerrain(),O=v[2]-T;if(O<=P)if(O<0||s){const D=this.locationCoordinate(this._center,this._centerAltitude),F=[v[0],v[1],D.z-v[2]],W=i.ag(F);F[2]-=(P-O)/this._pixelsPerMercatorPixel;const H=i.ag(F);if(H===0)return;i.c5(F,F,W/H*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],D.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const H=this.center;return H.lat=i.aA(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(H.lng=i.aA(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:v}=this.point;let w=0,T=m,P=v;const O=this.width/2,D=this.height/2,F=this.worldMinY*this.scale,W=this.worldMaxY*this.scale;if(v-D<F&&(P=F+D),v+D>W&&(P=W-D),W-F<this.height&&(w=Math.max(w,this.height/(W-F)),P=(W+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,ee=this.worldSize/2-(H+q)/2;T=(m+ee+this.worldSize)%this.worldSize-ee,T-O<H&&(T=H+O),T+O>q&&(T=q-O),q-H<this.width&&(w=Math.max(w,this.width/(q-H)),T=(q+H)/2)}T===m&&P===v||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(T,P))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.cf(1,this.center.lat)/i.cf(1,i.d2));const v=i.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?m:1,T=this._camera.getWorldToCamera(this.worldSize,w);let P;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-s.x/this.width,O[9]=2*s.y/this.height,this.isOrthographic){let ye=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ce=ye*this.aspect,$e=-Ce,Ne=-ye;Ce-=s.x,$e-=s.x,ye+=s.y,Ne+=s.y,P=this._camera.getCameraToClipOrthographic($e,Ce,Ne,ye,this._nearZ,this._farZ),((et,tt,dt,Tt)=>{for(let Ze=0;Ze<16;Ze++)et[Ze]=i.ak(tt[Ze],dt[Ze],Tt)})(P,P,O,i.d0(this.pitch>=ja?1:this.pitch/ja))}else P=O;const D=i.cP([],O,T);let F=i.cP([],P,T);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),Ce=i.bA([]);i.br(Ce,Ce,[ye.x*this.worldSize,ye.y*this.worldSize,0]),i.aB(Ce,Ce,i.cQ(this)),i.br(Ce,Ce,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),i.aB(F,F,Ce),i.aB(D,D,Ce),this.inverseAdjustmentMatrix=i.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cS([],F,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=F,this.invProjMatrix=i.bl(new Float64Array(16),this.projMatrix),c){const ye=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ye[8]=2*-s.x/this.width,ye[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.cP([],ye,T)}else this.expandedFarZProjMatrix=this.projMatrix;const W=i.bl([],P);this.frustumCorners=i.cT.fromInvProjectionMatrix(W,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const H=new Float32Array(16);i.bA(H),i.cS(H,H,[1,-1,1]),i.cU(H,H,this._pitch),i.bB(H,H,this.angle);const q=i.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bz(q);const ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-s.x/this.width,q[9]=2*(s.y+ee)/this.height,this.skyboxMatrix=i.aB(H,q,H);const Y=this.point,ae=Y.x,oe=Y.y,de=this.width%2/2,me=this.height%2/2,fe=Math.cos(this.angle),Pe=Math.sin(this.angle),be=ae-Math.round(ae)+fe*de+Pe*me,Ae=oe-Math.round(oe)+fe*me+Pe*de,xe=new Float64Array(F);if(i.br(xe,xe,[be>.5?be-1:be,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=xe,F=i.bC(),i.cS(F,F,[this.width/2,-this.height/2,1]),i.br(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=i.bC(),i.cS(F,F,[1,-1,1]),i.br(F,F,[-1,-1,0]),i.cS(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},F=i.bl(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cV(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(ye,ye,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[s,s,c];i.c5(w,w,v),i.c5(m,m,-1),i.cW(m,m,w);const T=i.bC();i.br(T,T,m),i.cS(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,v)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*w,v.y/this.worldSize-m[1]*w,s/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=s[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((c-m)/v,1)),this._camera.position=i.bH([],this._camera.position,s,w),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),w=i.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),P=Math.max((s[2]-w)/Math.cos(m),T),O=this._zoomFromMercatorZ(P);i.bH(s,s,c,P),this._pitch=i.aA(m,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bT(v,-Math.PI,Math.PI),this._setZoom(i.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,m=i.cL,v=0,w=1/0;for(;m-c>1e-6&&m>c;){const T=c+.5*(m-c),P=this.tileSize*Math.pow(2,T),O=this.getCameraToCenterDistance(this.projection,T,P),D=this.scaleZoom(O/(Math.max(0,s)*this.tileSize)),F=Math.abs(T-D);F<w&&(w=F,v=T),T<D?c=T:m=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const m=Math.min(s.x,c.x),v=Math.max(s.x,c.x),w=Math.min(s.y,c.y),T=Math.max(s.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new i.P(m,w),new i.P(v,T),new i.P(m,T),new i.P(v,w)],O=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const F of P){const W=this.pointRayIntersection(F);if(W.t<0)return!0;const H=this.rayIntersectionCoordinate(W);if(H.x<O||H.y<0||H.x>D||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,c){const m=i.ag(i.av([],this._camera.position,s)),v=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([c,m,v],w){const T=[c,m,v,1];i.aC(T,T,w);const P=T[3]=Math.max(T[3],1e-6);return T[0]/=P,T[1]/=P,T[2]/=P,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,m=this.worldSize){const v=i.cO(s,c,this.width,this.height,1024),w=s.pixelSpaceConversion(this.center.lat,m,v);let T=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(T=i.ak(1,T,i.d0(this.pitch>=ja?1:this.pitch/ja))),T}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(s,s,this.globeMatrix),s}getFrustum(s){return i.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const wc=(p,s)=>{if(s>0&&p.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,m=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?i.ah(60,45,c.pitch):i.ah(30,15,c.pitch),w=c._farZ-c._nearZ,T=s*c.height,P=((1-(O=v))*c.cameraToCenterDistance+O*(c._farZ+T))*m;var O;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(P-c._nearZ)/w,(P-T-c._nearZ)/w]}}},ha=2048;class Ah{constructor(s,c){this.aabb=s,this.lastCascade=c}}class x2{add(s,c){const m=this.receivers[s.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[s.key]=new Ah(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,m){const v=i.d9.fromPoints(s.points);let w=0;for(const T in this.receivers){const P=this.receivers[T];if(!P||!v.intersectsAabb(P.aabb))continue;P.aabb.min=v.closestPoint(P.aabb.min),P.aabb.max=v.closestPoint(P.aabb.max);const O=P.aabb.getCorners();for(let D=0;D<m.length;D++){let F=!0;for(const W of O){const H=[W[0]*c,W[1]*c,W[2]];if(i.af(H,H,m[D].matrix),H[0]<-1||H[0]>1||H[1]<-1||H[1]>1){F=!1;break}}if(P.lastCascade=D,w=Math.max(w,D),F)break}}return w+1}}class ld{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new x2,this._depthMode=new ir(s.context.gl.LEQUAL,ir.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce((ee,Y)=>{const ae=m.style._mergedLayers[Y];return ee+(ae.hasShadowPass()&&!ae.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,T=ha,P=ha;if(this._cascades.length===0||ha!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<2;++ee){const Y=m._shadowMapDebug,ae=w.gl,oe=w.createFramebuffer(T,P,Y?1:0,"texture"),de=new i.T(w,{width:T,height:P,data:null},ae.DEPTH_COMPONENT16);if(oe.depthAttachment.set(de.texture),Y){const me=new i.T(w,{width:T,height:P,data:null},ae.RGBA8);oe.colorAttachment0.set(me.texture)}this._cascades.push({framebuffer:oe,texture:de,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cB,scale:0})}}this.shadowDirection=Ph(c);let O=0;if(s.elevation){const ee=s.elevation,Y=[1e4,-1e4];ee.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const oe=ae.dem.tree;Y[0]=Math.min(Y[0],oe.minimums[0]),Y[1]=Math.max(Y[1],oe.maximums[0])}),Y[0]!==1e4&&(O=(Y[1]-Y[0])*ee.exaggeration())}const D=1.5*s.cameraToCenterDistance,F=3*D,W=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){const Y=this._cascades[ee];let ae=s.height/50,oe=1;ee===0?oe=D:(ae=D,oe=F);const[de,me]=Sc(s,this.shadowDirection,ae,oe,ha,O);Y.scale=s.scale,Y.matrix=de,Y.boundingSphereRadius=me,i.bl(W,Y.matrix),Y.frustum=i.cB.fromInvProjectionMatrix(W,1,0,!0),Y.far=oe}const H=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[H].far,this._cascades[H].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=ha,this._uniformValues.u_shadowmap_0=Oo.ShadowMap0,this._uniformValues.u_shadowmap_1=Oo.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=m.transform.elevation;for(const ee of this._groundShadowTiles){let Y={min:0,max:0};if(q){const ae=q.getMinMaxForTile(ee);ae&&(Y=ae)}this.addShadowReceiver(ee.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this.enabled)return;const m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,ha,ha]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:i.ao.white,depth:1});for(const T of s.order){const P=s._mergedLayers[T];if(!P.hasShadowPass()||P.isHidden(m.transform.zoom))continue;const O=s.getLayerSourceCache(P),D=O?c[O.id]:void 0;(P.type==="model"||D&&D.length)&&m.renderLayer(m,O,P,D)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,c=s.style,m=s.context,v=m.gl,w=c.directionalLight,T=c.ambientLight;if(!w||!T)return;const P=[],O=wc(s,s.longestCutoffRange);O.shouldRenderCutoff&&P.push("RENDER_CUTOFF"),P.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&P.push("NORMAL_OFFSET");const D=Ol(c,w,T),F=new ir(v.LEQUAL,ir.ReadOnly,s.depthRangeFor3D),W=new Ar({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const H of this._groundShadowTiles){const q=H.toUnwrapped(),ee=s.isTileAffectedByFog(H),Y=s.getOrCreateProgram("groundShadow",{defines:P,overrideFog:ee});this.setupShadows(q,Y),s.uploadCommonUniforms(m,Y,q,null,O);const ae={u_matrix:s.transform.calculateProjMatrix(q),u_ground_shadow_factor:D};Y.draw(s,v.TRIANGLES,F,W,Nr.multiply,wr.disabled,ae,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Nr.unblended:Nr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,m=c.calculatePosMatrix(s,c.worldSize);return i.aB(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(s){const c=i.bz(s);return i.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,s),c}setupShadows(s,c,m){if(!this.enabled)return;const v=this.painter.transform,w=this.painter.context,T=w.gl,P=this._uniformValues,O=new Float64Array(16),D=v.calculatePosMatrix(s,v.worldSize);for(let F=0;F<this._cascades.length;F++)i.aB(O,this._cascades[F].matrix,D),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),w.activeTexture.set(T.TEXTURE0+Oo.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const F=i.d7(s.canonical),W=2/v.tileSize*i.al/ha,H=W*this._cascades[0].boundingSphereRadius,q=W*this._cascades[this._cascades.length-1].boundingSphereRadius,ee=(m==="vector-tile"?1:3)*function(Y,ae,oe,de,me){const fe=i.aA((Y-22)/-22,0,1);return .125*(1-fe)+4*fe}(v.zoom);P.u_shadow_normal_offset=[F,H*ee,q*ee],P.u_shadow_bias=[1e-4,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,P)}setupShadowsFromMatrix(s,c,m=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,T=this._uniformValues,P=new Float64Array(16);for(let O=0;O<2;O++)i.aB(P,this._cascades[O].matrix,s),T[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),v.activeTexture.set(w.TEXTURE0+Oo.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);this.useNormalOffset=m,m?(T.u_shadow_normal_offset=[1,3,3],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,m,v){if(v[2]>=0)return{};const w=function(O,D,F){const W=F/(1<<O.canonical.z);return new i.d9([O.canonical.x*W+O.wrap*F,O.canonical.y*W+O.wrap*F,0],[(O.canonical.x+1)*W+O.wrap*F,(O.canonical.y+1)*W+O.wrap*F,D])}(s,c,m).getCorners(),T=c/-v[2];v[0]<0?(i.d8(w[0],w[0],[v[0]*T,0,0]),i.d8(w[3],w[3],[v[0]*T,0,0])):v[0]>0&&(i.d8(w[1],w[1],[v[0]*T,0,0]),i.d8(w[2],w[2],[v[0]*T,0,0])),v[1]<0?(i.d8(w[0],w[0],[0,v[1]*T,0]),i.d8(w[1],w[1],[0,v[1]*T,0])):v[1]>0&&(i.d8(w[2],w[2],[0,v[1]*T,0]),i.d8(w[3],w[3],[0,v[1]*T,0]));const P={};return P.vertices=w,P.planes=[Eh(w[1],w[0],w[4]),Eh(w[2],w[1],w[5]),Eh(w[3],w[2],w[6]),Eh(w[0],w[3],w[7])],P}addShadowReceiver(s,c,m){this._receivers.add(s,i.d9.fromTileIdAndHeight(s,c,m))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function Eh(p,s,c){const m=i.av([],c,s),v=i.av([],p,s),w=i.bI([],m,v),T=i.ag(w);return T===0?[0,0,1,0]:(i.c5(w,w,1/T),[w[0],w[1],w[2],-i.bJ(w,s)])}function Ph(p){const s=p.properties.get("direction"),c=i.d4(s.x,s.y,s.z);c[2]=i.aA(c[2],0,75);const m=i.d6([c[0],c[1],c[2]]);return i.d5(m.x,m.y,m.z)}function Ol(p,s,c){const m=s.properties.get("color-use-theme")==="none",v=s.properties.get("color"),w=s.properties.get("intensity"),T=s.properties.get("direction"),P=[T.x,T.y,T.z],O=c.properties.get("color-use-theme")==="none",D=c.properties.get("color"),F=c.properties.get("intensity"),W=Math.max(i.bJ([0,0,1],P),0),H=[0,0,0];i.c5(H,D.toPremultipliedRenderColor(O?null:p.getLut(s.scope)).toArray01Linear().slice(0,3),F);const q=[0,0,0];return i.c5(q,v.toPremultipliedRenderColor(m?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),W*w),i.db([H[0]>0?H[0]/(H[0]+q[0]):0,H[1]>0?H[1]/(H[1]+q[1]):0,H[2]>0?H[2]/(H[2]+q[2]):0])}function Sc(p,s,c,m,v,w){const T=p.zoom,P=p.scale,O=p.worldSize,D=1/O,F=p.aspect,W=Math.sqrt(1+F*F)*Math.tan(.5*p.fovX),H=W*W,q=m-c,ee=m+c;let Y,ae;H>q/ee?(Y=m,ae=m*W):(Y=.5*ee*(1+H),ae=.5*Math.sqrt(q*q+2*(m*m+c*c)*H+ee*ee*H*H));const oe=p.projection.pixelsPerMeter(p.center.lat,O),de=p._camera.getCameraToWorldMercator(),me=[0,0,-Y*D];i.af(me,me,de);let fe=ae*D;const Pe=p._edgeInsets;if(!(Pe.left===0&&Pe.top===0&&Pe.right===0&&Pe.bottom===0||Pe.left===Pe.right&&Pe.top===Pe.bottom)){const gt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?oe:1),Rt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,m);Rt[8]=2*-p.centerOffset.x/p.width,Rt[9]=2*p.centerOffset.y/p.height;const Vt=new Float64Array(16);i.cP(Vt,Rt,gt);const It=new Float64Array(16);i.bl(It,Vt);const At=i.cB.fromInvProjectionMatrix(It,O,T,!0);for(const tr of At.points){const Jt=((be=tr)[0]/=P,be[1]/=P,be[2]=i.cf(be[2],p._center.lat),be);fe=Math.max(fe,i.c6(i.da([],me,Jt)))}}var be;fe*=v/(v-1);const Ae=Math.acos(s[2]),xe=Math.atan2(-s[0],-s[1]),ye=new wp;ye.position=me,ye.setPitchBearing(Ae,xe);const Ce=ye.getWorldToCamera(O,oe),$e=fe*O,Ne=Math.min(p._mercatorZfromZoom(17)*O*-2,-2*$e),et=ye.getCameraToClipOrthographic(-$e,$e,-$e,$e,Ne,($e+w*oe)/s[2]),tt=new Float64Array(16);i.aB(tt,et,Ce);const dt=i.d5(Math.floor(1e6*me[0])/1e6*O,Math.floor(1e6*me[1])/1e6*O,0),Tt=.5*v,Ze=[0,0,0];i.af(Ze,dt,tt),i.c5(Ze,Ze,Tt);const ke=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],st=[0,0,0];i.av(st,Ze,ke),i.c5(st,st,-1/Tt);const Ye=new Float64Array(16);return i.bA(Ye),i.br(Ye,Ye,st),i.aB(tt,Ye,tt),[tt,$e]}class b2 extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,c){return i.dc(this.requestManager.transformRequest(c,i.R.Model).url).then(m=>{if(!m)return;const v=i.dd(m),w=new i.de(s,c,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&m.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${s} from ${c}: ${m.message}`)))})}load(s,c,m={forceReload:!1}){this.models[c]||(this.models[c]={});const v=Object.keys(s),w=[],T=[];for(const P of v){const O=s[P];this.hasURLBeenRequested(O)&&!m.forceReload||(this.modelByURL[O]={modelId:P,scope:c},w.push(this.loadModel(P,O)),T.push(P)),this.models[c][P]||(this.models[c][P]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+T.length,Promise.allSettled(w).then(P=>{for(let O=0;O<P.length;O++){const{status:D}=P[O];if(D==="rejected")continue;const{value:F}=P[O];this.models[c][T[O]]||(this.models[c][T[O]]={model:null,numReferences:1}),this.models[c][T[O]].model=F}this.numModelsLoading[c]-=T.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(P=>{this.fire(new i.y(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(s,c):this.getModelByURL(this.modelUris[c][s]))}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]?this.models[c][s].model:void 0}getModelByURL(s){if(!s)return null;const c=this.modelByURL[s];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(s,c){return this.models[c]&&this.models[c][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,c,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const v=this.requestManager.normalizeModelURL(c);if((this.hasModel(s,m,{exactIdMatch:!0})||this.hasModelBeenAdded(s,m))&&this.modelUris[m][s]===v)this.models[m][s].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:w,modelId:T}=this.modelByURL[v];this.models[w][T].numReferences++}else this.modelUris[m][s]=v,this.load({[s]:this.modelUris[m][s]},m)}addModelURLs(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.modelUris[c];for(const v in s)m[v]=this.requestManager.normalizeModelURL(s[v])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m={};for(const v of s)this.hasModel(v,c,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[c][v].numReferences++:this.modelUris[c][v]&&!this.hasURLBeenRequested(v)?m[v]=this.modelUris[c][v]:!this.hasURLBeenRequested(v)&&i.df(v,!1)&&(this.modelUris[c][v]=this.requestManager.normalizeModelURL(v),m[v]=this.modelUris[c][v]);this.load(m,c)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,c,m=!1,v=!1){if(this.models[c]&&this.models[c][s]&&(this.models[c][s].numReferences--,this.models[c][s].numReferences===0||v)){const w=this.modelUris[c][s];m||delete this.modelUris[c][s],delete this.modelByURL[w];const T=this.models[c][s].model;if(!T)return;delete this.models[c][s],T.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const c of Object.keys(this.models[s])){const m=this.models[s][c].model;delete this.models[s][c],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const m in this.models[c])this.models[c][m].model&&this.models[c][m].model.upload(s.context)}}const Ny=i.a6.colorTheme,w2=new i.a9({data:new i.aa(Ny.data)});function Cx(p){if(!p.metadata||!p.metadata.content_area)return;const s=i.o.devicePixelRatio,{left:c,top:m,width:v,height:w}=p.metadata.content_area,T=c*s,P=m*s;return[T,P,T+v*s,P+w*s]}function Ix(p){if(p)return p.map(([s,c])=>[s*i.o.devicePixelRatio,c*i.o.devicePixelRatio])}class zy{constructor(s,c,m){this.id=s,this.scope=c,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return s;const m=this.sourceCache.getSource();if(!(m instanceof ss))return s;const v=c.map(T=>this.sourceCache.getTile(T)),w=m.getImages(v,Array.from(this.pendingRequests));for(const[T,P]of w)s.set(i.I.from({name:T,iconsetId:this.id}),P),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),s}}const Tc=(p,s)=>ge(p,s&&s.filter(c=>c.identifier!=="source.canvas")),Mx=i.aH(yn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ox=i.aH(yn,["setCenter","setZoom","setBearing","setPitch"]),Tp=new Set(["background","sky","slot","custom"]),Ac={version:8,layers:[],sources:{}},Ch={duration:300,delay:0};class fa extends i.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},Ch),this._buildingIndex=new _2(this),this.crossTileSymbolIndex=new ka,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=c.styleChanges||new Qn,this._hasDataDrivenEmissive=!1,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.dh(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new gs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.di(s._requestManager,c.localFontFamily?i.dj.all:c.localIdeographFontFamily?i.dj.ideographs:i.dj.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new b2(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._indoorDependentLayers=c.indoorDependentLayers?c.indoorDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.dk());const m=this;this._rtlTextPluginCallback=fa.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,T)=>{if(i.dl(w),T&&T.every(P=>P))for(const P in m._sourceCaches){const O=m._sourceCaches[P],D=O.getSource().type;D!=="vector"&&D!=="geojson"||O.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const P=this._layers[T];P.source===w.id&&this._validateLayer(P)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.h(s))return s;const c=i.dm(s);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.dn(JSON.stringify(s))}`}_diffStyle(s,c,m){this.globalId=this._getGlobalId(s);const v=(w,T)=>{try{T(null,this.setState(w,m))}catch(P){T(P,!1)}};if(typeof s=="string"){const w=this.map._requestManager.normalizeStyleURL(s),T=this.map._requestManager.transformRequest(w,i.R.Style);i.m(T,(P,O)=>{P?this.fire(new i.y(P)):O&&v(O,c)})}else typeof s=="object"&&v(s,c)}loadURL(s,c={}){this.fire(new i.z("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!i.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const v=this.importsCache.get(s);if(v)return this._load(v,m);const w=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.m(w,(T,P)=>{if(this._request=null,T)this.fire(new i.y(T));else if(P)return this.importsCache.set(s,P),this._load(P,m)})}loadJSON(s,c={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.o.frame(()=>{this._request=null,this._load(s,c.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(Ac,!1)}_loadImports(s,c,m){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of s){const T=this._createFragmentStyle(w),P=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(v.push(P),this.resolvedImports.has(w.url)){T.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(T.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(T.globalId=null)):w.url?T.loadURL(w.url,{validate:c}):T.loadEmpty();const D={style:T,id:w.id,config:w.config};if(m){const F=this.fragments.findIndex(({id:W})=>W===m);this.fragments=this.fragments.slice(0,F).concat(D).concat(this.fragments.slice(F))}else this.fragments.push(D)}return Promise.allSettled(v)}getImportGlobalIds(s=this,c=new Set){for(const m of s.fragments)m.style.globalId&&c.add(m.style.globalId),this.getImportGlobalIds(m.style,c);return[...c.values()]}_createFragmentStyle(s){const c=this.scope?i.B(s.id,this.scope):s.id;let m;const v=this._initialConfig&&this._initialConfig[c];(s.config||v)&&(m=Object.assign({},s.config,v));const w=new fa(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,c){if(this._isInternalStyle(s)){const w=Object.assign({},Ac,{imports:[{id:"basemap",data:s,url:""}]},s.center?{center:s.center}:{},s.bearing?{bearing:s.bearing}:{},s.pitch?{pitch:s.pitch}:{},s.zoom?{zoom:s.zoom}:{},s.light?{light:s.light}:{});return this._importedAsBasemap=!0,void this._load(w,c)}if(this.updateConfig(this._config,s.schema),c&&Tc(this,ei(s)))return;this._loaded=!0,this.stylesheet=i.dp(s);const m=()=>{for(const O in s.sources)this.addSource(O,s.sources[O],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const O in s.iconsets)this.addIconset(O,s.iconsets[O]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const w=gh(this.stylesheet.layers);if(this._order=w.map(O=>O.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new Fe(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Fe(this.stylesheet.light)),this._layers={};for(const O of w){const D=i.du(O,this.scope,this._styleColorTheme.lut,this.options);D.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(D.fqid),this._hasAppearances=this._hasAppearances||D.getAppearances().length!==0,D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const F=this.getOwnLayerSourceCache(D),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&D.canCastShadows()&&W&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const P=this.isRootStyle();s.imports?this._loadImports(s.imports,c).then(()=>{this._reloadImports(),this.fire(new i.z(P?"style.load":"style.import.load"))}).catch(O=>{this.fire(new i.y(new Error("Failed to load imports",O))),this.fire(new i.z(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const w=this._evaluateColorThemeData(v);this._loadColorTheme(w).then(()=>{m()}).catch(T=>{i.w(`Couldn't load color theme from the stylesheet: ${T}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(s=>s.style.hasAppearances())}mergeAll(){let s,c,m,v,w,T,P,O,D,F;const W={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(H=>{if(H.stylesheet){if(H.light!=null&&(s=H.light),H.stylesheet.lights)for(const q of H.stylesheet.lights)q.type==="ambient"&&H.ambientLight!=null&&(c=H.ambientLight),q.type==="directional"&&H.directionalLight!=null&&(m=H.directionalLight);v=this._prioritizeTerrain(v,H.terrain,H.stylesheet.terrain),H.stylesheet.fog&&H.fog!=null&&(w=H.fog),H.stylesheet.snow&&H.snow!=null&&(T=H.snow),H.stylesheet.rain&&H.rain!=null&&(P=H.rain),H.stylesheet.camera!=null&&(F=H.stylesheet.camera),H.stylesheet.projection!=null&&(O=H.stylesheet.projection),H.stylesheet.transition!=null&&(D=H.stylesheet.transition),W[H.scope]=H._styleColorTheme}}),this.light=s,this.ambientLight=c,this.directionalLight=m,this.fog=w,this.snow=T,this.rain=P,this._styleColorThemeForScope=W,v===null?delete this.terrain:this.terrain=v,this.camera=F||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},Ch,D),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(s){const c=m=>{for(const v of m.fragments)c(v.style);s(m)};c(this)}_prioritizeTerrain(s,c,m){const v=s&&s.drapeRenderMode===0;return m===null?c&&c.drapeRenderMode===0?c:v?s:null:c!=null&&(!s||v||c&&c.drapeRenderMode===1)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},m={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const T=i.B(w,v.scope);s[T]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const T=i.B(w,v.scope);c[T]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const T=i.B(w,v.scope);m[T]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeIndoor(){this.forEachFragmentStyle(s=>{if(s.stylesheet&&s.stylesheet.indoor)for(const c of Object.values(s.stylesheet.indoor)){const m=c,v=i.B(m.sourceId,s.scope);this._mergedIndoor[v]=new Set(m.sourceLayers||[])}})}mergeLayers(){const s={},c=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const P of T._order){const O=T._layers[P];if(O.type==="slot"){const D=i.dq(P);if(s[D])continue;s[D]=[]}O.slot&&s[O.slot]?s[O.slot].push(O):c.push(O)}}),this._mergedOrder=[];let v=-1;const w=(T=[])=>{for(const P of T)if(P.type==="slot"){const O=i.dq(P.id);s[O]&&w(s[O]),this._mergedSlots.push(O)}else{const O=i.B(P.id,P.scope);this._mergedOrder.push(O),m[O]=P,P.is3D(!!this.terrain)&&(this._has3DLayers=!0,v=this._mergedOrder.length-1),P.type==="circle"&&(this._hasCircleLayers=!0),P.type==="symbol"&&(this._hasSymbolLayers=!0),P.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(c),this._has3DLayers){const T={};for(let P=0;P<this._mergedOrder.length;++P){const O=this._mergedOrder[P];T[O]=P===v?1:P<v?m[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((P,O)=>T[P]-T[O])}this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(c,m,v,w){const T=Object.assign({},m);for(const O of Object.keys(Ny))T[O]===void 0&&(T[O]=Ny[O].default);const P=new i.a8(w2,c,new Map(v));return P.setTransitionOrValue(T,v),P.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,v)=>{const w="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let T=s;T.startsWith(w)||(T=w+T);const P=i.I.from("mapbox-reserved-lut"),O=new Image;O.src=T,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void m();this._styleColorTheme.lutLoading=!1;const{width:D,height:F,data:W}=i.o.getImageData(O);if(F>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==F*F)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new i.q({width:D,height:F},W),pixelRatio:1,sdf:!1,usvg:!1,version:0});const H=this.imageManager.getImage(P,this.scope);H?(this._styleColorTheme.lut={image:H.data,data:s},m()):v(new Error("Missing LUT image."))}})}getLut(s){const c=this._styleColorThemeForScope[s];return c?c.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,m,v){let w,T,P;const O=i.o.devicePixelRatio>1?"@2x":"";let D=i.m(m.transformRequest(m.normalizeSpriteURL(c,O,".json"),i.R.SpriteJSON),(H,q)=>{D=null,P||(P=H,w=q,W())}),F=i.n(m.transformRequest(m.normalizeSpriteURL(c,O,".png"),i.R.SpriteImage),(H,q)=>{F=null,P||(P=H,T=q,W())});function W(){if(P)v(P);else if(w&&T){const H=i.o.getImageData(T),q={};for(const ee in w){const{width:Y,height:ae,x:oe,y:de,sdf:me,pixelRatio:fe,stretchX:Pe,stretchY:be,content:Ae}=w[ee],xe=new i.q({width:Y,height:ae});i.q.copy(H,xe,{x:oe,y:de},{x:0,y:0},{width:Y,height:ae},null),q[ee]={data:xe,pixelRatio:fe!==void 0?fe:1,sdf:me!==void 0&&me,stretchX:Pe,stretchY:be,content:Ae,usvg:!1,version:0}}v(null,q)}}return{cancel(){D&&(D.cancel(),D=null),F&&(F.cancel(),F=null)}}}(s,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new i.y(c));else if(m){const v=new Map;for(const w in m)v.set(i.I.from(w),m[w]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(s,c){if(c.type==="sprite")return void this._loadSprite(c.url);const m=this.getOwnSourceCache(c.source);if(!m)return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const v=m.getSource();if(v.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${c.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const w=new zy(s,this.scope,m);this.imageManager.addImageProvider(w,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!i.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const c=this.map._spriteFormat==="auto";var m,v;this._spriteRequest=(v=(w,T)=>{if(this._spriteRequest=null,w)c?this._loadSprite(s):this.fire(new i.y(w));else if(T){const P=new Map;for(const O in T)P.set(i.I.from(O),T[O]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bu((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(s),i.R.Iconset),(w,T)=>{if(w)return void v(w);const P={},O=i.dg(new i.bt(T));for(const D of O.icons){const F={version:1,pixelRatio:i.o.devicePixelRatio,content:Cx(D),stretchX:D.metadata?Ix(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?Ix(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};P[D.name]=F}v(null,P)}))}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const m=s.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new i.y(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const m=this.fragments[c];return m&&m.style&&(s.data=m.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();s[m.id]||(s[m.id]=m.serialize())}return s}_serializeLayers(s){const c=[];for(const m of s){const v=this._layers[m];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const s in this._mergedLayers){const c=this._mergedLayers[s];if(c._transitionablePaint&&c._transitionablePaint._values){const m=c._transitionablePaint._values["line-emissive-strength"];if(m&&m.value&&m.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new i.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new i.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,c){const m=this.map.painter;if(m)for(let v=s.minzoom||0;v<(s.maxzoom||25.5);v++){const w=s.getProgramIds();if(w)for(const T of w){const P=s.getDefaultProgramParams(T,c.zoom,this._styleColorTheme.lut);P&&(m.style=this,this.fog&&(m._fogVisible=!0,P.overrideFog=!0,m.getOrCreateProgram(T,P)),m._fogVisible=!1,P.overrideFog=!1,m.getOrCreateProgram(T,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,m.getOrCreateProgram(T,P)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const O in P){const{updatedIds:D,removedIds:F}=P[O];(D||F)&&(this._updateWorkerLayers(O,D,F),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const w={};for(const P in this._mergedSourceCaches){const O=this._mergedSourceCaches[P];w[P]=O.used,O.used=!1,O.tileCoverLift=0}for(const P of this._mergedOrder){const O=this._mergedLayers[P];if(O.visibility!=="none"&&O.recalculate(s,this._availableImages),!O.isHidden(s.zoom)){const D=this.getLayerSourceCache(O);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,s)}):this.precompilePrograms(O,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const P of T)P.sourceCache.used=!0;for(const P in w){const O=this._mergedSourceCaches[P];w[P]!==O.used&&O.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const c of s){const m=c.resolvePendingRequests(),v=this.getFragmentStyle(c.scope);v&&v.addImages(m)}}_updateTilesForChangedImages(){const s={};for(const c in this._mergedSourceCaches){const m=this._mergedSourceCaches[c].getSource().scope;s[m]=s[m]||this._changes.getUpdatedImages(m),s[m].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s[m])}for(const c in s)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(s,c,m){const v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:s,removedIds:m||[],options:v.options})}setState(s,c){if(this._checkLoaded(),Tc(this,ei(s)))return!1;(s=i.dp(s)).layers=gh(s.layers);const m=function(T,P){if(!T)return[{command:yn.setStyle,args:[P]}];let O=[];try{if(!i.by(T.version,P.version))return[{command:yn.setStyle,args:[P]}];if(i.by(T.center,P.center)||O.push({command:yn.setCenter,args:[P.center]}),i.by(T.zoom,P.zoom)||O.push({command:yn.setZoom,args:[P.zoom]}),i.by(T.bearing,P.bearing)||O.push({command:yn.setBearing,args:[P.bearing]}),i.by(T.pitch,P.pitch)||O.push({command:yn.setPitch,args:[P.pitch]}),i.by(T.sprite,P.sprite)||O.push({command:yn.setSprite,args:[P.sprite]}),i.by(T.glyphs,P.glyphs)||O.push({command:yn.setGlyphs,args:[P.glyphs]}),i.by(T.imports,P.imports)||function(q=[],ee=[],Y){ee=ee||[];const ae=(q=q||[]).map(yh),oe=ee.map(yh),de=q.reduce(_h,{}),me=ee.reduce(_h,{}),fe=ae.slice();let Pe,be,Ae,xe;for(Pe=0,be=0;Pe<ae.length;Pe++)Ae=ae[Pe],me.hasOwnProperty(Ae)?be++:(Y.push({command:yn.removeImport,args:[Ae]}),fe.splice(fe.indexOf(Ae,be),1));for(Pe=0,be=0;Pe<oe.length;Pe++)Ae=oe[oe.length-1-Pe],fe[fe.length-1-Pe]!==Ae&&(de.hasOwnProperty(Ae)?(Y.push({command:yn.removeImport,args:[Ae]}),fe.splice(fe.lastIndexOf(Ae,fe.length-be),1)):be++,xe=fe[fe.length-Pe],Y.push({command:yn.addImport,args:[me[Ae],xe]}),fe.splice(fe.length-Pe,0,Ae));for(const ye of ee){const Ce=de[ye.id];Ce&&(delete Ce.data,i.by(Ce,ye)||Y.push({command:yn.updateImport,args:[ye.id,ye]}))}}(T.imports,P.imports,O),i.by(T.transition,P.transition)||O.push({command:yn.setTransition,args:[P.transition]}),i.by(T.light,P.light)||O.push({command:yn.setLight,args:[P.light]}),i.by(T.fog,P.fog)||O.push({command:yn.setFog,args:[P.fog]}),i.by(T.snow,P.snow)||O.push({command:yn.setSnow,args:[P.snow]}),i.by(T.rain,P.rain)||O.push({command:yn.setRain,args:[P.rain]}),i.by(T.projection,P.projection)||O.push({command:yn.setProjection,args:[P.projection]}),i.by(T.lights,P.lights)||O.push({command:yn.setLights,args:[P.lights]}),i.by(T.camera,P.camera)||O.push({command:yn.setCamera,args:[P.camera]}),i.by(T.iconsets,P.iconsets)||function(q,ee,Y){let ae;for(ae in ee=ee||{},q=q||{})q.hasOwnProperty(ae)&&(ee.hasOwnProperty(ae)||Y.push({command:yn.removeIconset,args:[ae]}));for(ae in ee){if(!ee.hasOwnProperty(ae))continue;const oe=ee[ae];q.hasOwnProperty(ae)?i.by(q[ae],oe)||(Y.push({command:yn.removeIconset,args:[ae]}),Y.push({command:yn.addIconset,args:[ae,oe]})):Y.push({command:yn.addIconset,args:[ae,oe]})}}(T.iconsets,P.iconsets,O),!i.by(T["color-theme"],P["color-theme"]))return[{command:yn.setStyle,args:[P]}];const D={},F=[];(function(q,ee,Y,ae){let oe;for(oe in ee=ee||{},q=q||{})q.hasOwnProperty(oe)&&(ee.hasOwnProperty(oe)||Cy(oe,Y,ae));for(oe in ee){if(!ee.hasOwnProperty(oe))continue;const de=ee[oe];q.hasOwnProperty(oe)?i.by(q[oe],de)||(q[oe].type==="geojson"&&de.type==="geojson"&&Tx(q,ee,oe)?Y.push({command:yn.setGeoJSONSourceData,args:[oe,de.data]}):Sx(oe,ee,Y,ae)):fp(oe,ee,Y)}})(T.sources,P.sources,F,D);const W=[];T.layers&&T.layers.forEach(q=>{q.source&&D[q.source]?O.push({command:yn.removeLayer,args:[q.id]}):W.push(q)});let H=T.terrain;H&&D[H.source]&&(O.push({command:yn.setTerrain,args:[void 0]}),H=void 0),O=O.concat(F),i.by(H,P.terrain)||O.push({command:yn.setTerrain,args:[P.terrain]}),function(q,ee,Y){ee=ee||[];const ae=(q=q||[]).map(yh),oe=ee.map(yh),de=q.reduce(_h,{}),me=ee.reduce(_h,{}),fe=ae.slice(),Pe=Object.create(null);let be,Ae,xe,ye,Ce,$e,Ne;for(be=0,Ae=0;be<ae.length;be++)xe=ae[be],me.hasOwnProperty(xe)?Ae++:(Y.push({command:yn.removeLayer,args:[xe]}),fe.splice(fe.indexOf(xe,Ae),1));for(be=0,Ae=0;be<oe.length;be++)xe=oe[oe.length-1-be],fe[fe.length-1-be]!==xe&&(de.hasOwnProperty(xe)?(Y.push({command:yn.removeLayer,args:[xe]}),fe.splice(fe.lastIndexOf(xe,fe.length-Ae),1)):Ae++,$e=fe[fe.length-be],Y.push({command:yn.addLayer,args:[me[xe],$e]}),fe.splice(fe.length-be,0,xe),Pe[xe]=!0);for(be=0;be<oe.length;be++)if(xe=oe[be],ye=de[xe],Ce=me[xe],!Pe[xe]&&!i.by(ye,Ce))if(i.by(ye.source,Ce.source)&&i.by(ye["source-layer"],Ce["source-layer"])&&i.by(ye.type,Ce.type)){for(Ne in vc(ye.layout,Ce.layout,Y,xe,null,yn.setLayoutProperty),vc(ye.paint,Ce.paint,Y,xe,null,yn.setPaintProperty),i.by(ye.slot,Ce.slot)||Y.push({command:yn.setSlot,args:[xe,Ce.slot]}),i.by(ye.filter,Ce.filter)||Y.push({command:yn.setFilter,args:[xe,Ce.filter]}),i.by(ye.minzoom,Ce.minzoom)&&i.by(ye.maxzoom,Ce.maxzoom)||Y.push({command:yn.setLayerZoomRange,args:[xe,Ce.minzoom,Ce.maxzoom]}),ye)ye.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?vc(ye[Ne],Ce[Ne],Y,xe,Ne.slice(6),yn.setPaintProperty):i.by(ye[Ne],Ce[Ne])||Y.push({command:yn.setLayerProperty,args:[xe,Ne,Ce[Ne]]}));for(Ne in Ce)Ce.hasOwnProperty(Ne)&&!ye.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&Ne!=="slot"&&(Ne.indexOf("paint.")===0?vc(ye[Ne],Ce[Ne],Y,xe,Ne.slice(6),yn.setPaintProperty):i.by(ye[Ne],Ce[Ne])||Y.push({command:yn.setLayerProperty,args:[xe,Ne,Ce[Ne]]}))}else Y.push({command:yn.removeLayer,args:[xe]}),$e=fe[fe.lastIndexOf(xe)+1],Y.push({command:yn.addLayer,args:[Ce,$e]})}(W,P.layers,O)}catch(D){console.warn("Unable to compute style diff:",D),O=[{command:yn.setStyle,args:[P]}]}return O}(this.serialize(),s).filter(T=>!(T.command in Ox));if(m.length===0)return!1;const v=m.filter(T=>!(T.command in Mx));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const w=[];return m.forEach(T=>{w.push(this[T.command](...T.args))}),c&&Promise.all(w).then(c).catch(c),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[c,m]of s.entries()){if(this.getImage(c))return this.fire(new i.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,m),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(s,c){return this.getImage(s)?this.fire(new i.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,c),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(s,c,m=!1){this.imageManager.updateImage(s,this.scope,c),m&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(s){return this.modelManager.addModelURLs(s,this.getActualScope()),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(s,c,m={}){return this._checkLoaded(),this._validate(ne,`models.${s}`,c,null,m)||(this.modelManager.addModel(s,c,this.getActualScope()),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.getActualScope())}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.getActualScope(),!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(s,c,m={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Vo,`sources.${s}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=So(s,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=T=>{const P=(T?"symbol:":"other:")+v.id,O=i.B(P,this.scope),D=this._sourceCaches[P]=new Bs(O,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=D,D.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([w,T])=>T.type==="source"&&T.source===s);if(v)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while iconset "${v[0]}" is using it.`)))}const m=this.getOwnSourceCaches(s);for(const v of m){const w=i.dq(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const m=this.getOwnSourceCache(c);m&&s.push(m.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const m=s[c]._tiles;for(const v in m){const w=m[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const w of s){if(this._validate(qo,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(w),T.updateTransitions(c)}else this.ambientLight=new gn(w,Wi||(Wi=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(w),T.updateTransitions(c)}else this.directionalLight=new gn(w,Oi||(Oi=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(c,{worldview:this.map.getWorldview()}),v=new i.ac(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const m=H=>.2126*(H[0]<=.03928?H[0]/12.92:Math.pow((H[0]+.055)/1.055,2.4))+.7152*(H[1]<=.03928?H[1]/12.92:Math.pow((H[1]+.055)/1.055,2.4))+.0722*(H[2]<=.03928?H[2]/12.92:Math.pow((H[2]+.055)/1.055,2.4)),v=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=s.properties.get("intensity"),T=s.properties.get("direction"),P=1-i.d4(T.x,T.y,T.z)[2]/90,O=m(v)*w*P,D=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=c.properties.get("intensity"),W=m(D)*F;return Number(((O+W)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(i.dr(s)){const c=i.ds(s),m=this.fragments.find(({id:w})=>w===c);if(!m)return;const v=i.dq(s);return m.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:m})=>m===s);return c?c.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const c={},m=(v,w="")=>`${v}::${w}`;this._featuresetSelectors={};for(const v in s){const w=this._featuresetSelectors[v]=[];for(const T of s[v].selectors){if(T.featureNamespace){const O=this.getOwnLayer(T.layer);if(!O){i.w(`Layer is undefined for selector: ${T.layer}`);continue}const D=m(O.source,O.sourceLayer);if(D in c&&c[D]!==T.featureNamespace){i.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}c[D]=T.featureNamespace}let P;if(T.properties)for(const O in T.properties){const D=i.U(T.properties[O]);D.result==="success"&&(P=P||{},P[O]=D.value)}w.push({layerId:T.layer,namespace:T.featureNamespace,properties:P,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const c=this.getFragmentStyle(s);if(!c||!c.stylesheet.featuresets)return[];const m=[];for(const v in c.stylesheet.featuresets)m.push({featuresetId:v,importId:c.scope?c.scope:void 0});return m}getFeaturesetLayers(s,c){const m=this.getFragmentStyle(c),v=m.stylesheet.featuresets;if(!v||!v[s])return this.fire(new i.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const T of v[s].selectors){const P=m.getOwnLayer(T.layer);P&&w.push(P)}return w}getConfigProperty(s,c){const m=this.getFragmentStyle(s);if(!m)return null;const v=i.B(c,m.scope),w=m.options.get(v),T=w?w.value||w.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(s,c){const m=i.B(s,c);return this._mergedIndoor[m]}setIndoorData(s,c){this.map.indoor.setIndoorData(c)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(s,c,m){const v=this.getFragmentStyle(s);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[c])return;const T=i.U(m);if(T.result!=="success")return void Tc(this,T.value);const P=T.value.expression,O=i.B(c,v.scope),D=v.options.get(O);if(!D)return;let F;const{minValue:W,maxValue:H,stepValue:q,type:ee,values:Y}=w[c],ae=i.U(w[c].default);ae.result==="success"&&(F=ae.value.expression),F?(this.options.set(O,Object.assign({},D,{value:P,default:F,minValue:W,maxValue:H,stepValue:q,type:ee,values:Y})),this.updateConfigDependencies(c)):this.fire(new i.y(new Error(`No schema defined for the config option "${c}" in the "${s}" fragment.`)))}getConfig(s){const c=this.getFragmentStyle(s);if(!c)return null;const m=c.stylesheet.schema;if(!m)return null;const v={};for(const w in m){const T=i.B(w,c.scope),P=c.options.get(T),O=P?P.value||P.default:null;v[w]=O?O.serialize():null}return v}setConfig(s,c){const m=this.getFragmentStyle(s);m&&(m.updateConfig(c,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const c=this.getFragmentStyle(s);return c?c.stylesheet.schema:null}setSchema(s,c){const m=this.getFragmentStyle(s);m&&(m.stylesheet.schema=c,m.updateConfig(m._config,c),this.updateConfigDependencies())}updateConfig(s,c){if(this._config=s,s||c)if(c)for(const m in c){let v,w;const T=i.U(c[m].default);if(T.result==="success"&&(v=T.value.expression),s&&s[m]!==void 0){const H=i.U(s[m]);H.result==="success"&&(w=H.value.expression)}const{minValue:P,maxValue:O,stepValue:D,type:F,values:W}=c[m];if(v){const H=i.B(m,this.scope);this.options.set(H,{default:v,value:w,minValue:P,maxValue:O,stepValue:D,type:F,values:W})}else this.fire(new i.y(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(s,c=()=>!0){for(const m of s){const v=this.getLayer(m);v&&c(v)&&(v.possiblyEvaluateVisibility(),this._updateLayer(v),this._changes.setDirty())}}updateConfigDependencies(s){this._updateLayers(this._configDependentLayers,c=>!s||c.expressionDependencies.configDependencies.has(s)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const m=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(m){const v=c._evaluateColorThemeData(m);(!c._styleColorTheme.lut&&v!==""||c._styleColorTheme.lut&&v!==c._styleColorTheme.lut.data)&&c.setColorTheme(m)}}),this._changes.setDirty()}addLayer(s,c,m={}){this._checkLoaded();const v=s.id;if(this._layers[v])return void this.fire(new i.y(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(s.type==="custom"){if(Tc(this,i.dt(s)))return;w=i.du(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=i.dp(s),s=Object.assign(s,{source:v})),this._validate(Py,`layers.${v}`,s,{arrayIndex:-1},m))return;w=i.du(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}})}const T=i.B(w.source,w.scope);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let P=this._order.length;if(c){const W=this._order.indexOf(c);if(W===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?P=W:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const O=this.getOwnLayerSourceCache(w),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();O&&w.canCastShadows()&&D&&(O.castsShadows=!0);const F=this._changes.getRemovedLayer(w);if(F&&w.source&&O&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const W=i.B(w.source,w.scope);F.type!==w.type?this._changes.updateSourceCache(W,"clear"):(this._changes.updateSourceCache(W,"reload"),O.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const m=this._checkLayer(s);if(!m||s===c)return;const v=this._order.indexOf(s);this._order.splice(v,1);let w=this._order.length;if(c){const T=this._order.indexOf(c);if(T===-1)return void this.fire(new i.y(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?w=T:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._indoorDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let w=!1;for(const T in this._layers)if(this._layers[T].source===c.source&&this._layers[T].canCastShadows()){w=!0;break}v.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,m){this._checkLoaded();const v=this._checkLayer(s);v&&(v.minzoom===c&&v.maxzoom===m||(c!=null&&(v.minzoom=c),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,c){this._checkLoaded();const m=this._checkLayer(s);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(s,c,m={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!i.by(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(au,`layers.${v.id}.filter`,c,{layerType:v.type},m)||(v.filter=i.dp(c),this._updateLayer(v)))}getFilter(s){const c=this._checkLayer(s);if(c)return i.dp(c.filter)}setLayoutProperty(s,c,m,v={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!i.by(w.getLayoutProperty(c),m)){if(m!=null&&(!v||v.validate!==!1)&&Tc(w,We.call(ei,{key:`layers.${s}.layout.${c}`,layerType:w.type,objectKey:c,value:m,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,m),w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),this._updateLayer(w)}}setLayerProperty(s,c,m,v={}){this._checkLoaded();const w=this._checkLayer(s);w&&(c==="appearances"?(w.setAppearances(m),this._changes.setDirty()):w.isPaintProperty(c)?this.setPaintProperty(s,c,m,v):this.setLayoutProperty(s,c,m,v))}getLayoutProperty(s,c){const m=this._checkLayer(s);if(m)return m.getLayoutProperty(c)}setPaintProperty(s,c,m,v={}){this._checkLoaded();const w=this._checkLayer(s);if(!w||i.by(w.getPaintProperty(c),m)||m!=null&&(!v||v.validate!==!1)&&Tc(w,fh.call(ei,{key:`layers.${s}.paint.${c}`,layerType:w.type,objectKey:c,value:m,styleSpec:i.a6})))return;const T=w.setPaintProperty(c,m);w.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),w.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w.fqid),T&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(s,c){const m=this._checkLayer(s);if(m)return m.getPaintProperty(c)}setFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:D}=s.target,F=this.getFragmentStyle(D),W=F.getFeaturesetLayers(O);for(const{source:H,sourceLayer:q}of W)F.setFeatureState({id:s.id,source:H,sourceLayer:q},c)}else if("layerId"in s.target){const{layerId:O}=s.target,D=this.getLayer(O);this.setFeatureState({id:s.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const m=s.source,v=s.sourceLayer,w=this._checkSource(m);if(!w)return;const T=w.type;if(T==="geojson"&&v)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(m);for(const O of P)O.setFeatureState(v,s.id,c)}removeFeatureState(s,c){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:D}=s.target,F=this.getFragmentStyle(D),W=F.getFeaturesetLayers(O);for(const{source:H,sourceLayer:q}of W)F.removeFeatureState({id:s.id,source:H,sourceLayer:q},c)}else if("layerId"in s.target){const{layerId:O}=s.target,D=this.getLayer(O);this.removeFeatureState({id:s.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const m=s.source,v=this._checkSource(m);if(!v)return;const w=v.type,T=w==="vector"?s.sourceLayer:void 0;if(w==="vector"&&!T)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(m);for(const O of P)O.removeFeatureState(T,s.id,c)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let w;if("featuresetId"in s.target){const{featuresetId:T,importId:P}=s.target,O=this.getFragmentStyle(P),D=O.getFeaturesetLayers(T);for(const{source:F,sourceLayer:W}of D){const H=O.getFeatureState({id:s.id,source:F,sourceLayer:W});if(H&&!w)w=H;else if(!i.by(w,H))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:T}=s.target,P=this.getLayer(T);w=this.getFeatureState({id:s.id,source:P.source,sourceLayer:P.sourceLayer})}return w}const c=s.source,m=s.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||m)return s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,s.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(s){for(const c of Object.values(this._mergedLayers))s(c)&&this._updateLayer(c)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),m=i.B(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[m]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=P=>this._mergedLayers[P].is3D(!!this.terrain),m=this.order,v={},w=[];for(let P=m.length-1;P>=0;P--){const O=m[P];if(c(O)){v[O]=P;for(const D of s){const F=D[O];if(F)for(const W of F)w.push(W)}}}w.sort((P,O)=>O.intersectionZ-P.intersectionZ);const T=[];for(let P=m.length-1;P>=0;P--){const O=m[P];if(c(O))for(let D=w.length-1;D>=0;D--){const F=w[D].feature;if(F.layer&&v[F.layer.id]<P)break;T.push(F),w.pop()}else for(const D of s){const F=D[O];if(F)for(const W of F)T.push(W.feature)}}return T}queryRasterValue(s,c,m){const v=this.getOwnSource(s);return v?v.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):v.queryRasterArrayValue(c,m):(this.fire(new i.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,c,m){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(au,"queryRenderedFeatures.filter",c.filter,null,c),v=i.b6(c.filter));const w={},T=F=>{if(Tp.has(F.type))return;const W=this.getOwnLayerSourceCache(F),H=w[W.id]=w[W.id]||{sourceCache:W,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(H.has3DLayers=!0),H.layers[F.fqid]=H.layers[F.fqid]||{styleLayer:F,targets:[]},H.layers[F.fqid].targets.push({filter:v})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const F of c.layers){const W=this._layers[F];if(!W)return this.fire(new i.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(W)}}else for(const F in this._layers)T(this._layers[F]);const P=this._queryRenderedFeatures(s,w,m),O=this._flattenAndSortRenderedFeatures(P),D=[];for(const F of O)i.dw(F.layer.id)===this.scope&&D.push(F);return D}queryRenderedFeatureset(s,c,m){let v;c&&!Array.isArray(c)&&c.filter&&(this._validate(au,"queryRenderedFeatures.filter",c.filter,null,c),v=i.b6(c.filter));const w="mock",T=[];if(c&&c.target)T.push(Object.assign({},c,{targetId:w,filter:v}));else{const F=this.getFeaturesetDescriptors();for(const W of F)T.push({targetId:w,filter:v,target:W});for(const{style:W}of this.fragments){const H=W.getFeaturesetDescriptors();for(const q of H)T.push({targetId:w,filter:v,target:q})}}const P=this.queryRenderedTargets(s,T,m),O=[],D=new Set;for(const F of P)for(const W of F.variants[w])id(W,F,D)||O.push(new i.dx(F,W));return O}queryRenderedTargets(s,c,m){const v={},w=(P,O,D,F)=>{const W=v[O.id]=v[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(W.layers[P.fqid]=W.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(W.has3DLayers=!0),!F)return D.uniqueFeatureID=!1,void W.layers[P.fqid].targets.push(D);W.layers[P.fqid].targets.push(Object.assign({},D,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const P of c)if("featuresetId"in P.target){const{featuresetId:O,importId:D}=P.target,F=this.getFragmentStyle(D);if(!F||!F._featuresetSelectors)continue;const W=F._featuresetSelectors[O];if(!W){this.fire(new i.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const H of W){const q=F.getOwnLayer(H.layerId);q&&!Tp.has(q.type)&&w(q,F.getOwnLayerSourceCache(q),P,H)}}else if("layerId"in P.target){const{layerId:O}=P.target,D=this.getLayer(O);if(!D||Tp.has(D.type))continue;w(D,this.getLayerSourceCache(D),P)}const T=this._queryRenderedFeatures(s,v,m);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(s,c,m){const v=[],w=!!this.map._showQueryGeometry,T=Si.createFromScreenPoints(s,m);for(const P in c){const O=ap(T,c[P],this._availableImages,m,w);Object.keys(O).length&&v.push(O)}if(this.placement)for(const P in c){if(!c[P].sourceCache._onlySymbols)continue;const O=lp(T.screenGeometry,c[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&v.push(O)}return v}querySourceFeatures(s,c){const m=c&&c.filter;m&&this._validate(au,"querySourceFeatures.filter",m,null,c);let v=[];const w=this.getOwnSourceCaches(s);for(const T of w)v=v.concat(cp(T,c));return v}addSourceType(s,c,m){return fa.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(fa.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,m={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const P in s)if(!i.by(s[P],v[P])){w=!0;break}if(!w)return;const T=this._getTransitionParameters();this.light.setLight(s,c,m),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=s;const v=!("source"in s)||s.source==null;if(c===1){if(this.disableElevatedTerrain)return;if("source"in m&&typeof m.source=="object"){const P="terrain-dem-src";this.addSource(P,m.source),m=i.dp(m),m=Object.assign(m,{source:P})}const w=Object.assign({},m),T={};if(this.terrain&&v){w.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(T.style=P.serialize())}if(this._validate(Ia,"terrain",w,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new i.z("data",{dataType:"style"}))}else{const w=this.terrain,T=w.get();for(const P of Object.keys(i.a6.terrain))!m.hasOwnProperty(P)&&i.a6.terrain[P].default&&(m[P]=i.a6.terrain[P].default);for(const P in s)if(!i.by(s[P],T[P])){w.set(s,this.options),this.stylesheet.terrain=s;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new jr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createSnow(s){const c=this.snow=new Ji(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_createRain(s){const c=this.rain=new wi(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.snow=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.by(c.get(),s)){c.set(s,this.options),this.stylesheet.rain=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void s();const m=this._evaluateColorThemeData(c);this._loadColorTheme(m).then(()=>{this.fire(new i.z("colorthemeset")),s()}).catch(v=>{i.w(`Couldn't set color theme: ${v}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,c){const m=this.getFragmentStyle(s);m&&(m._styleColorTheme.colorThemeOverride=c,m._reloadColorTheme())}_getTransitionParameters(s){return{now:i.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?s.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const m=this.terrain=new Ue(s,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,m,v,w={}){if(w&&w.validate===!1)return!1;const T=Object.assign({},this.serialize());return Tc(this,s.call(ei,Object.assign({key:c,style:T,value:m,styleSpec:i.a6},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const m of c)m.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const c=this._mergedLayers[s];c._clear&&c._clear()}}reloadSource(s){const c=this.getSourceCaches(s);for(const m of c)m.resume(),m.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let c;this.directionalLight&&(c=Ph(this.directionalLight));const m=new Set,v=new Set;for(const w in this._mergedLayers){const T=this._mergedLayers[w];T.type==="building"&&m.add(T.source),T.hasElevation()&&!v.has(T.source)&&v.add(T.source)}for(const w in this._mergedSourceCaches){const T=this._mergedSourceCaches[w],P=v.has(T._source.id);m.has(T._source.id)&&(T._source.reparseOverscaled=!1),T.update(s,void 0,void 0,c,P)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,m,v,w,T,P=!1){let O=!1,D=!1;const F={},W={};for(const Y of this._mergedOrder){const ae=this._mergedLayers[Y];if(ae.type!=="symbol")continue;const oe=i.B(ae.source,ae.scope);let de=F[oe];if(!de){const fe=this.getLayerSourceCache(ae);if(!fe)continue;const Pe=fe.getRenderableIds(!0).map(be=>fe.getTileByID(be));W[oe]=Pe.slice(),de=F[oe]=Pe.sort((be,Ae)=>Ae.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(Ae.tileID)?-1:1))}const me=this.crossTileSymbolIndex.addLayer(ae,de,c.center.lng,c.projection);O=O||me}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new i.z("neworder"));const H=!!(this.placement&&!c.equals(this.placement.transform)),q=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!T||this.placement.lastReplacementSourceUpdateTime!==T.updateTime)),ee=(H||q||O||this.placement&&this.placement.isStale())&&v===0;if((P||!this.pauseablePlacement||ee||v!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),c.zoom))&&(this.pauseablePlacement=new To(c,this._mergedOrder,P||v===0,m,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,W,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),D=!0),O&&this.pauseablePlacement.placement.setStale()),D||O){this._buildingIndex.onNewFrame(c.zoom);for(let Y=0;Y<this._mergedOrder.length;Y++){const ae=this._mergedLayers[this._mergedOrder[Y]];if(ae.type!=="symbol"||ae.visibility==="none")continue;const oe=this.isLayerClipped(ae);this.placement.updateLayerOpacities(ae,F[i.B(ae.source,ae.scope)],Y,oe?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:w})=>w===s.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return m.push(s),this._loadImports([s],!0);const v=m.findIndex(({id:w})=>w===c);return v===-1&&this.fire(new i.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(s).concat(m.slice(v)),this._loadImports([s],!0,c)}updateImport(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof c=="string"?(this.setImportUrl(s,c),this):(c.url&&c.url!==m[v].url&&this.setImportUrl(s,c.url),i.by(c.config,m[v].config)||this.setImportConfig(s,c.config,c.data.schema),i.by(c.data,m[v].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let m=this.stylesheet.imports||[];const v=this.getImportIndex(s);if(v===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const T=m[v],P=this.fragments[v];return m=m.filter(({id:O})=>O!==s),this.fragments=this.fragments.filter(({id:O})=>O!==s),this.stylesheet.imports=m.slice(0,w).concat(T).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(P).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;m[v].url=c;const w=this.fragments[v];return w.style=this._createFragmentStyle(m[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const m=this.getImportIndex(s),v=this.stylesheet.imports||[];return m===-1?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(s,v[m].url))}setImportConfig(s,c,m){this._checkLoaded();const v=this.getImportIndex(s),w=this.stylesheet.imports||[];if(v===-1)return this;c?w[v].config=c:delete w[v].config;const T=this.fragments[v];m&&T.style.stylesheet&&(T.style.stylesheet.schema=m);const P=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=c,T.style.updateConfig(c,P),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(s);m!==-1&&(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(m=>m.id===s);return c===-1&&this.fire(new i.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[c];m&&s.push(m.getSource())}return s}getSource(s,c){const m=this.getSourceCache(s,c);return m&&m.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const m=i.B(s,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(s){const c=i.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const m=s[c];m==="reload"?this.reloadSource(c):m==="clear"&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const m of c){const v=this.getLayer(m);v&&v.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,c,m){this.imageManager.getImages(c.images,c.scope,m),this._updateTilesForChangedImages();const v=T=>{if(T){const P=c.images.map(O=>i.I.toString(O));T.setDependencies(c.tileID.key,c.type,P)}},w=i.B(c.source,c.scope);v(this._mergedOtherSourceCaches[w]),v(this._mergedSymbolSourceCaches[w]),c.images.some(T=>T.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(s,c,m){this.imageManager.rasterizeImages(c,m)}getGlyphs(s,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(s,c,m){return i.dz(c,m)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return c.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${s}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,c){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const m=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),v=s.type==="building";if(s.is3D(!!this.terrain)){if(m||v||c&&c.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}fa.getSourceType=function(p){return Ya[p]},fa.setSourceType=function(p,s){Ya[p]=s},fa.registerForPluginStateChange=i.dA;class Rx extends i.E{constructor(s){super(),this._style=s,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(s){s===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=s,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(s){this._activeFloorsVisible=s,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(s){for(const[c,m]of Object.entries(s.buildings))if(this._buildings[c])for(const v of m.floorIds)this._buildings[c].floors[v]||(this._buildings[c].floors[v]=m.floors[v]);else this._buildings[c]=m;for(const c of s.activeFloors)this._activeFloors.add(c);this._updateIndoorSelector()}getIndoorTileOptions(s,c){const m=this._style.getIndoorSourceLayers(s,c);return m&&this._indoorState?{sourceLayers:m,indoorState:this._indoorState}:null}_updateUI(s,c,m){const v=function(w,T,P,O){let D=null,F=Number.MAX_SAFE_INTEGER;if(O<16)return null;for(const[W,H]of Object.entries(w)){const q=H.center;if(q){const ee=T.distanceTo(i.aT.convert(q));ee<F&&P.contains(q)&&(F=ee,D=W)}}return D}(this._buildings,c,m,s);v!==this._closestBuildingId&&(this._closestBuildingId=v,this._updateIndoorSelector())}_updateIndoorSelector(){const s=this._buildings,c=this._closestBuildingId,m=c&&s?s[c]:void 0;if(!m)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let v=null;for(const T of m.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){v=T;break}const w=Array.from(m.floorIds).map(T=>({id:T,name:m.floors[T].name,zIndex:m.floors[T].zIndex})).sort((T,P)=>P.zIndex-T.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:v,activeFloorsVisible:this._activeFloorsVisible,floors:w}))}_updateActiveFloors(){const s=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:s,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var cd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ud=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Fy=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ap="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Ks=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Ep=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Mt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,By=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Pp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Cp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,$y=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ih=/#include\s+"([^"]+)"/g,il=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Vy=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,mu=new Set(["ifdef","ifndef","elif","if","defined"]),gu=new Set;Pc(cd,gu),Pc(Fy,gu),Pc(ud,gu);const Ec={"_prelude_fog.vertex.glsl":Ep,"_prelude_terrain.vertex.glsl":Ks,"_prelude_shadow.vertex.glsl":Cp,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Mt,"_prelude_shadow.fragment.glsl":$y,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":By,"_prelude_raster_particle.glsl":Pp},Ip={};hn("",Ks),hn(Mt,Ep),hn($y,Cp),hn(By,""),hn(Pp,"");const kx=hn(ud,Fy),Mp=cd,S2=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Mp,kx.fragmentSource].join(`
`),jx=["precision highp float;",Mp,kx.vertexSource].join(`
`);var Uy={background:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:hn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:hn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:hn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:hn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:hn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:hn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:hn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:hn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:hn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:hn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:hn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:hn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:hn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:hn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ap),skyboxGradient:hn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ap),skyboxCapture:hn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:hn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:hn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:hn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:hn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:hn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:hn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:hn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Pc(p,s){const c=p.split(`
`);for(let m of c){if(m=m.trimStart(),m[0]!=="#"||!m.includes("if")||m.startsWith("#endif"))continue;const v=m.match(Vy);if(v)for(const w of v)mu.has(w)||s.add(w)}}function hn(p,s){const c=new Set,m=[],v=[];p=p.replace(Ih,(T,P)=>(v.push(P),"")),s=s.replace(Ih,(T,P)=>(m.push(P),""));let w=new Set(gu);Pc(p,w),Pc(s,w);for(const T of[...m,...v])Ip[T]||(Ip[T]=new Set,Pc(Ec[T],Ip[T])),w=new Set([...w,...Ip[T]]);return{fragmentSource:p=p.replace(il,(T,P,O,D,F)=>(c.add(F),P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${O} ${D} ${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${O} ${D} ${F} = u_${F};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${O} ${D} ${F};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(il,(T,P,O,D,F)=>{const W=`MATERIAL_ATTRIBUTE_OFFSET_${F}`,H=D==="float"?"vec2":D,q=`GET_ATTRIBUTE_${H}(a_${F}, materialInfo, ${W})`,ee=F.match(/color/)?"color":H;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${O} ${D} a_${F};
#endif
`:c.has(F)?P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
    #if !defined(${W})
        in ${O} ${H} a_${F};
    #endif
out ${O} ${D} ${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${F})
    #ifdef ${W}
        ${F} = unpack_mix_${ee}(${q}, u_${F}_t);
    #else
        ${F} = unpack_mix_${ee}(a_${F}, u_${F}_t);
    #endif
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${O} ${D} a_${F};
    out ${O} ${D} ${F};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
    #if !defined(${W})
        in ${O} ${H} a_${F};
    #endif
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${O} ${D} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${H} a_${F};
#else
uniform ${O} ${D} u_${F};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${O} ${D} ${F} = a_${F};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    #ifdef ${W}
        ${O} ${D} ${F} = ${q};
    #else
        ${O} ${D} ${F} = a_${F};
    #endif
#else
    ${O} ${D} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    #ifdef ${W}
        ${O} ${D} ${F} = unpack_mix_${ee}(${q}, u_${F}_t);
    #else
        ${O} ${D} ${F} = unpack_mix_${ee}(a_${F}, u_${F}_t);
    #endif
#else
    ${O} ${D} ${F} = u_${F};
#endif
`}),usedDefines:w,vertexIncludes:m,fragmentIncludes:v}}class T2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,m,v,w,T,P,O){this.context=s;let D=this.boundPaintVertexBuffers.length!==v.length;for(let W=0;!D&&W<v.length;W++)this.boundPaintVertexBuffers[W]!==v[W]&&(D=!0);let F=this.boundDynamicVertexBuffers.length!==P.length;for(let W=0;!F&&W<P.length;W++)this.boundDynamicVertexBuffers[W]!==P[W]&&(F=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||D||F||this.boundIndexBuffer!==w||this.boundVertexOffset!==T)this.freshBind(c,m,v,w,T,P,O);else{s.bindVertexArrayOES.set(this.vao);for(const W of P)W&&(W.bind(),O&&W.instanceCount&&W.setVertexAttribDivisor(s.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(s,c,m,v,w,T,P){const O=this.context,D=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=T,c.enableAttributes(D,s),c.bind(),c.setVertexAttribPointers(D,s,w);for(const F of m)F.enableAttributes(D,s),F.bind(),F.setVertexAttribPointers(D,s,w);for(const F of T)F&&(F.enableAttributes(D,s),F.bind(),F.setVertexAttribPointers(D,s,w),P&&F.instanceCount&&F.setVertexAttribDivisor(D,s,P));v&&v.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function A2(p,s){const c=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new i.ae(0,m/c).toLngLat().lat,new i.ae(0,(m+1)/c).toLngLat().lat]}function E2(p,s,c,m,v,w,T){const P=p.context,O=P.gl,D=c.hillshadeFBO;if(!D)return;p.prepareDrawTile();const F=p.isTileAffectedByFog(s),W=[];p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1");const H=p.getOrCreateProgram("hillshade",{overrideFog:F,defines:W});P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,D.colorAttachment0.get());const q=((oe,de,me,fe)=>{const Pe=me.paint.get("hillshade-shadow-color"),be=me.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=me.paint.get("hillshade-highlight-color"),xe=me.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=me.paint.get("hillshade-accent-color"),Ce=me.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",$e=me.paint.get("hillshade-emissive-strength");let Ne=i.an(me.paint.get("hillshade-illumination-direction"));if(me.paint.get("hillshade-illumination-anchor")==="viewport")Ne-=oe.transform.angle;else if(oe.style&&oe.style.enable3dLights()&&oe.style.directionalLight){const tt=oe.style.directionalLight.properties.get("direction"),dt=i.d4(tt.x,tt.y,tt.z);Ne=i.an(dt[1])}const et=!oe.options.moving;return{u_matrix:fe||oe.transform.calculateProjMatrix(de.tileID.toUnwrapped(),et),u_image:0,u_latrange:A2(0,de.tileID),u_light:[me.paint.get("hillshade-exaggeration"),Ne],u_shadow:Pe.toPremultipliedRenderColor(be?null:me.lut),u_highlight:Ae.toPremultipliedRenderColor(xe?null:me.lut),u_emissive_strength:$e,u_accent:ye.toPremultipliedRenderColor(Ce?null:me.lut)}})(p,c,m,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(P,H,s.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:Y,tileBoundsSegments:ae}=p.getTileBoundsBuffers(c);H.draw(p,O.TRIANGLES,v,w,T,wr.disabled,q,m.id,ee,Y,ae)}function Gy(p,s,c){if(!s.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(c.stride);const w=c.getPixels();s.demTexture?s.demTexture.update(w,{premultiply:!1}):s.demTexture=new i.T(m,w,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function P2(p,s,c){const m=p.context,v=m.gl;if(!s.dem)return;const w=s.dem;if(m.activeTexture.set(v.TEXTURE1),Gy(p,s,w),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=w.dim;m.activeTexture.set(v.TEXTURE0);let P=s.hillshadeFBO;if(!P){const H=new i.T(m,{width:T,height:T,data:null},v.RGBA8);H.bind(v.LINEAR,v.CLAMP_TO_EDGE),P=s.hillshadeFBO=m.createFramebuffer(T,T,1,"renderbuffer"),P.colorAttachment0.set(H.texture)}m.bindFramebuffer.set(P.framebuffer),m.viewport.set([0,0,T,T]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:D,tileBoundsSegments:F}=p.getMercatorTileBoundsBuffers(),W=[];p.linearFloatFilteringSupported()&&W.push("TERRAIN_DEM_FLOAT_FORMAT"),p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&W.push("USE_MRT1"),p.getOrCreateProgram("hillshadePrepare",{defines:W}).draw(p,v.TRIANGLES,ir.disabled,Ar.disabled,Nr.unblended,wr.disabled,((H,q)=>{const ee=q.stride,Y=i.bC();return i.ce(Y,0,i.al,-i.al,0,0,1),i.br(Y,Y,[0,-i.al,0]),{u_matrix:Y,u_image:1,u_dimension:[ee,ee],u_zoom:H.overscaledZ}})(s.tileID,w),c.id,O,D,F),s.needsHillshadePrepare=!1}class gi{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class C2 extends gi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Dx extends gi{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Hy extends gi{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Op extends gi{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Wy extends gi{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class yu extends gi{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class dd extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Mh extends gi{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class hd extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Lx extends gi{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class qy extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class Nx extends gi{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class fd extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Rp extends gi{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class kp extends gi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Zy extends gi{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class jp extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class Oh extends gi{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class zx extends gi{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Fx=class extends gi{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Bx extends gi{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class pd extends gi{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class $x extends gi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class I2 extends gi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class M2 extends gi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class O2 extends gi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Ky extends gi{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Xy extends gi{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class Yy extends gi{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Jy extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Vx extends gi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Dp extends gi{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Lp extends Dp{constructor(s,c,m=0){super(s,c),this.attachmentPoint=s.gl.COLOR_ATTACHMENT0+m}setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachmentPoint,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class md extends Dp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Rh extends Dp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ux extends md{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Xs=(p,s,c,m)=>({u_matrix:p,u_image0:0,u_image1:1,u_skirt_height:s,u_ground_shadow_factor:c,u_emissive_texture_available:m}),Np=(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_image1:1,u_frustum_tl:T,u_frustum_tr:P,u_frustum_br:O,u_frustum_bl:D,u_globe_pos:F,u_globe_radius:W,u_viewport:H,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:ee,u_emissive_texture_available:Y});function kh(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const Rl=new class{constructor(){this.operations={}}newMorphing(p,s,c,m,v){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:v,from:s,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const c=this.operations[s];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},zp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Fp(p,s,c){if(s===0)return 0;const m=s<1&&c===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*m}function Qy(p,s){const c=1<<p.z;return!s&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}function gd(p,s){if(!p.style||!p.style.enable3dLights())return;const c=p.context,m=c.gl;c.activeTexture.set(m.TEXTURE1),s?s.bind(m.LINEAR,m.CLAMP_TO_EDGE):p.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}const jh=p=>({u_matrix:p});function Dh(p,s,c,m,v){if(v>0){const w=i.o.now(),T=(w-p.timeAdded)/v,P=s?(w-s.timeAdded)/v:-1,O=c.getSource(),D=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),F=!s||Math.abs(s.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),W=F&&p.refreshedUponExpiration?1:i.aA(F?T:1-P,0,1);return s?{opacity:1,mix:1-W,isFading:T<1}:{opacity:W,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Bp extends Bs{constructor(s){const c=So("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class e_ extends Bs{constructor(s){const c=So("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,m){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const P=new du(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);P.state="loaded",this._tiles[T.key]=P}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class t_ extends i.aQ{constructor(s,c,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class r_ extends i.bV{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,w]=function(O){const D=new i.bd,F=new i.b0,W=131;D.reserve(17161),F.reserve(33800);const H=i.al/128,q=i.al+H/2,ee=q+H;for(let ae=-H;ae<ee;ae+=H)for(let oe=-H;oe<ee;oe+=H){const de=oe<0||oe>q||ae<0||ae>q?24575:0,me=i.aA(Math.round(oe),0,i.al),fe=i.aA(Math.round(ae),0,i.al);D.emplaceBack(me+de,fe)}const Y=(ae,oe)=>{const de=oe*W+ae;F.emplaceBack(de+1,de,de+W),F.emplaceBack(de+W,de+W+1,de+1)};for(let ae=1;ae<129;ae++)for(let oe=1;oe<129;oe++)Y(oe,ae);return[0,129].forEach(ae=>{for(let oe=0;oe<130;oe++)Y(oe,ae),Y(ae,oe)}),[D,F,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(m,i.bf.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=i.bg.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=i.bg.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new e_(c.map),this.orthoMatrix=i.bC(),i.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const P=T.gl;this._overlapStencilMode=new Ar({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Bp(c.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,m){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const v=s.terrain.properties,w=s.terrain.drapeRenderMode===0,T=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const P=s.terrain&&s.terrain.scope,O=v.get("source"),D=w?this._mockSourceCache:s.getSourceCache(O,P);if(!D)return void i.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=D,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const W=this.getScaledDemTileSize();this.sourceCache.update(c,W,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const c=this._previousCameraAltitude,m=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=m;const v=c!=null?m-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=s.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(w);let P=w-this._previousZoom;const O=this._previousUpdateTimestamp;let D=w;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(w-D)>.5&&(P=.5*(w-D+P)),P*v<0&&(D+=P)),this._evaluationZoom=D;const F=T.getExaggeration(D),W=F===T.getExaggeration(Math.max(0,D-.1));if(W&&Math.abs(F-this._exaggeration)<.01)return F;let H=Math.min(.1,.00375*(this._updateTimestamp-O));return(W||F<.1||Math.abs(P)<1e-4)&&(H=Math.min(.2,4*H)),i.ak(this._exaggeration,F,H)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(O=>{const D=c.getTileByID(O).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(O,D){const F=D.transform.pointCoordinate(D.transform.getCameraPoint()),W=new i.P(F.x,F.y);O.sort((H,q)=>{if(q.overscaledZ-H.overscaledZ)return q.overscaledZ-H.overscaledZ;const ee=new i.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Y=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ae=W.mult(1<<H.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(ee)-ae.distSqr(Y)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const O in T){const D=T[O];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,s[O],w),D.usedForTerrain))continue;const F=s[O];D.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[c.id]=v.map(O=>new t_(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const D=this.terrainTileForTile[O.key];if(!D)continue;const F=D.tileID.key;F in P||(this._visibleDemTiles.push(D),P[F]=F)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),Gy(this.painter,v,w))}}_prepareDemTileUniforms(s,c,m,v){if(!c||c.demTexture==null)return!1;const w=s.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-w.z),P=v||"";return m[`u_dem_tl${P}`]=[w.x*T%1,w.y*T%1],m[`u_dem_scale${P}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const c=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const w=v.dem.tree.minimums[0];return w>0&&s++,m+w},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new i.dL({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new i.T(s,v,c.R32F,{premultiply:!1}),w}setupElevationDraw(s,c,m){const v=this.painter.context,w=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let P=null,O=null,D=1;if(m&&m.morphing&&this._useVertexMorphing){const q=m.morphing.srcDemTile,ee=m.morphing.dstDemTile;D=m.morphing.phase,q&&ee&&(this._prepareDemTileUniforms(s,q,T,"_prev")&&(O=q),this._prepareDemTileUniforms(s,ee,T)&&(P=ee))}const F=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let W=null;var H;if(this.enabled?O&&P?(W=P.demTexture,v.activeTexture.set(w.TEXTURE4),O.demTexture.bind(F(O),w.CLAMP_TO_EDGE),T.u_dem_lerp=D):(P=this.terrainTileForTile[s.tileID.key],W=this._prepareDemTileUniforms(s,P,T)?P.demTexture:this.emptyDEMTexture):W=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),W&&(T.u_dem_size=(H=W).size[0]===1?1:H.size[0]-2,W.bind(F(P),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,c,T),m&&m.useMeterToDem&&P){const q=(1<<P.tileID.canonical.z)*i.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=q}if(m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,q)}}globeUniformValues(s,c,m){const v=s.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,i.al,0),u_tile_br_up:v.upVector(c,i.al,i.al),u_tile_bl_up:v.upVector(c,0,i.al),u_tile_up_scale:m?i.dM(1):v.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,T,P,O){if(v.transform.projection.name==="globe")(function(D,F,W,H,q){const ee=D.context,Y=ee.gl;let ae,oe;const de=D.transform,me=i.dE(D,ee,de),fe=(et,tt)=>{if(oe===tt)return;const dt=[zp[tt],"PROJECTION_GLOBE_VIEW"];me&&dt.push("CUSTOM_ANTIALIASING");const Tt=D.isTileAffectedByFog(et);ae=D.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:Tt}),oe=tt},Pe=D.colorModeForRenderPass(),be=new ir(Y.LEQUAL,ir.ReadWrite,D.depthRangeFor3D);Rl.update(q);const Ae=i.dF(de),xe=[i.aF(de.center.lng),i.aJ(de.center.lat)],ye=D.globeSharedBuffers,Ce=[de.width*i.o.devicePixelRatio,de.height*i.o.devicePixelRatio],$e=Float32Array.from(de.globeMatrix),Ne={useDenormalizedUpVectorScale:!0};{const et=D.transform,tt=Fp(et.zoom,F.exaggeration(),F.sourceCache._source.tileSize);oe=-1;const dt=Y.TRIANGLES;for(const Tt of H){const Ze=W.getTile(Tt),ke=Ar.disabled,st=F.prevTerrainTileForTile[Tt.key],Ye=F.terrainTileForTile[Tt.key];kh(st,Ye)&&Rl.newMorphing(Tt.key,st,Ye,q,250),gd(D,Ze.emissiveTexture),ee.activeTexture.set(Y.TEXTURE0),Ze.texture&&Ze.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const gt=Rl.getMorphValuesForProxy(Tt.key),Rt=gt?1:0;gt&&Object.assign(Ne,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:i.dD(gt.phase)}});const Vt=i.dG(Tt.canonical),It=i.dH(Vt.getCenter().lat),At=i.dI(Tt.canonical,Vt,It,et.worldSize/et._pixelsPerMercatorPixel),tr=i.bk(i.dJ(Tt.canonical)),Jt=D.emissiveMode==="mrt-fallback"?1:0,zt=Np(et.expandedFarZProjMatrix,$e,Ae,tr,i.aj(et.zoom),xe,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,Ce,tt,et._farZ,Jt,At);if(fe(Tt,Rt),ae&&(F.setupElevationDraw(Ze,ae,Ne),D.uploadCommonUniforms(ee,ae,Tt.toUnwrapped()),ye)){const[Gt,hr,Or]=ye.getGridBuffers(It,tt!==0);ae.draw(D,dt,be,ke,Pe,wr.backCCW,zt,"globe_raster",Gt,hr,Or)}}}if(ye&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&et.push("CUSTOM_ANTIALIASING"),ae=D.getOrCreateProgram("globeRaster",{defines:et});for(const tt of H){const{x:dt,y:Tt,z:Ze}=tt.canonical,ke=Tt===0,st=Tt===(1<<Ze)-1,[Ye,gt,Rt,Vt]=ye.getPoleBuffers(Ze,!1);if(Vt&&(ke||st)){const It=W.getTile(tt);gd(D,It.emissiveTexture),ee.activeTexture.set(Y.TEXTURE0),It.texture&&It.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let At=i.dK(Ze,dt,de);const tr=i.bk(i.dJ(tt.canonical)),Jt=D.emissiveMode==="mrt-fallback"?1:0,zt=(Gt,hr)=>Gt.draw(D,Y.TRIANGLES,be,Ar.disabled,Pe,wr.disabled,Np(de.expandedFarZProjMatrix,At,At,tr,0,xe,de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.globeCenterInViewSpace,de.globeRadius,Ce,0,de._farZ,Jt),"globe_pole_raster",hr,Rt,Vt);F.setupElevationDraw(It,ae,Ne),D.uploadCommonUniforms(ee,ae,tt.toUnwrapped()),ke&&D.renderDefaultNorthPole&&zt(ae,Ye),st&&D.renderDefaultSouthPole&&(At=i.cS(i.bC(),At,[1,-1,1]),zt(ae,gt))}}}})(v,w,T,P,O);else{const D=v.context,F=D.gl;let W,H;const q=v.shadowRenderer,ee=wc(v,v.longestCutoffRange),Y=Pe=>{if(H===Pe)return;const be=[];be.push(zp[Pe]),ee.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),q&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&be.push("NORMAL_OFFSET")),W=v.getOrCreateProgram("terrainRaster",{defines:be}),H=Pe},ae=v.colorModeForRenderPass(),oe=new ir(F.LEQUAL,ir.ReadWrite,v.depthRangeFor3D);Rl.update(O);const de=v.transform,me=Fp(de.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let fe=[0,0,0];if(q){const Pe=v.style.directionalLight,be=v.style.ambientLight;Pe&&be&&(fe=Ol(v.style,Pe,be))}{H=-1;const Pe=F.TRIANGLES,[be,Ae]=[w.gridIndexBuffer,w.gridSegments];for(const xe of P){const ye=T.getTile(xe),Ce=Ar.disabled,$e=w.prevTerrainTileForTile[xe.key],Ne=w.terrainTileForTile[xe.key];kh($e,Ne)&&Rl.newMorphing(xe.key,$e,Ne,O,250),gd(v,ye.emissiveTexture),D.activeTexture.set(F.TEXTURE0),ye.texture&&ye.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const et=Rl.getMorphValuesForProxy(xe.key),tt=et?1:0;let dt;et&&(dt={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:i.dD(et.phase)}});const Tt=v.emissiveMode==="mrt-fallback"?1:0,Ze=Xs(xe.projMatrix,Qy(xe.canonical,de.renderWorldCopies)?me/10:me,fe,Tt);if(Y(tt),!W)continue;w.setupElevationDraw(ye,W,dt);const ke=xe.toUnwrapped();q&&q.setupShadows(ke,W),v.uploadCommonUniforms(D,W,ke,null,ee),W.draw(v,Pe,oe,Ce,ae,wr.backCCW,Ze,"terrain_raster",w.gridBuffer,be,Ae)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),P=c.style.order,O=[];this._updateFBOs(c.emissiveMode==="mrt-fallback");let D=0;for(const F of w){const W=v.getTileByID(F.proxyTileKey),H=v.proxyCachedFBO[F.key]?v.proxyCachedFBO[F.key][s]:void 0,q=H!==void 0?v.renderCache[H]:this.pool[D++],ee=H!==void 0;if(W.texture=q.tex,W.emissiveTexture=q.emissiveTex,ee&&!q.dirty){O.push(W.tileID);continue}m.bindFramebuffer.set(q.fb.framebuffer);const Y=m.gl;let ae;Y.drawBuffers(c.emissiveMode==="mrt-fallback"?[Y.COLOR_ATTACHMENT0,Y.COLOR_ATTACHMENT1]:[Y.COLOR_ATTACHMENT0]),this.renderedToTile=!1,q.dirty&&(m.clear({color:i.ao.transparent,stencil:0}),q.dirty=!1);for(let oe=T.start;oe<=T.end;++oe){const de=c.style._mergedLayers[P[oe]];if(de.isHidden(c.transform.zoom))continue;const me=c.style.getLayerSourceCache(de),fe=me?this.proxyToSource[F.key][me.id]:[F];if(!fe)continue;const Pe=fe;m.viewport.set([0,0,q.fb.width,q.fb.height]),ae!==(me?me.id:null)&&(this._setupStencil(q,fe,de,me),ae=me?me.id:null),c.renderLayer(c,me,de,Pe)}if(Y.drawBuffers([Y.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const oe of this._pendingGroundEffectLayers){const de=c.style._mergedLayers[P[oe]];if(de.isHidden(c.transform.zoom))continue;const me=c.style.getLayerSourceCache(de),fe=me?this.proxyToSource[F.key][me.id]:[F];if(!fe)continue;const Pe=fe;m.viewport.set([0,0,q.fb.width,q.fb.height]),ae!==(me?me.id:null)&&(this._setupStencil(q,fe,de,me),ae=me?me.id:null),c.renderLayer(c,me,de,Pe)}this.renderedToTile?(q.dirty=!0,O.push(W.tileID)):ee||--D,D===5&&(D=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let m=-1,v=c;for(let w=0;w<c;++w)this._style.isLayerDraped(s._mergedLayers[s.order[w]])?m=Math.max(m,w):v=Math.min(v,w);return v>m}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,c,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,P=1<<T.overscaledZ,{x:O,y:D}=T.canonical,F=O/P,W=(O+1)/P,H=D/P,q=(D+1)/P;return{minx:F,miny:H,maxx:W,maxy:q,t:w.dem.tree.raycastRoot(F,H,W,q,s,c,m),tile:w}});v.sort((w,T)=>(w.t!==null?w.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,s,c,m);if(T!=null)return T}return null}_createFBO(){const s=this.painter.context,c=s.gl,m=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const v=new i.T(s,{width:m[0],height:m[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=s.createFramebuffer(m[0],m[1],1,null);let T;return w.colorAttachment0.set(v.texture),this._emissiveTexture&&(T=new i.T(s,{width:m[0],height:m[1],data:null},c.R8),T.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.createColorAttachment(s,1),w.colorAttachment1.set(T.texture)),w.depthAttachment=new Ux(s,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:w,tex:v,emissiveTex:T,dirty:!1}}_updateFBOs(s){if(this._emissiveTexture!==s){for(const c of this.pool)this._updateFBO(c,s);for(const c of this.proxySourceCache.renderCache)this._updateFBO(c,s);this._emissiveTexture=s}}_updateFBO(s,c){const m=s.fb,v=this.painter.context,w=v.gl,T=this.drapeBufferSize;if(c){const P=new i.T(v,{width:T[0],height:T[1],data:null},w.R8);P.bind(w.LINEAR,w.CLAMP_TO_EDGE),s.emissiveTex=P,m.createColorAttachment(v,1),m.colorAttachment1.set(P.texture)}else s.emissiveTex=void 0,m.removeColorAttachment(v,1);s.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],m=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style.getSources())if(m instanceof lu){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="line")continue;const T=v.widthExpression(),P=v.emissiveStrengthExpression();if(T instanceof i.ad||P instanceof i.ad){c[w.id]=!0;for(const O of this.proxyCoords){const D=this.proxyToSource[O.key][w.id];if(D)for(const F of D)this._clearRenderCacheForTile(w.id,F)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Mo){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][w.id];if(O)for(const D of O){const F=Dh(w.getTile(D),w.findLoadedParent(D,0),w,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(w.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,c=s.length;if(c===0)return;const m=[];this._pendingGroundEffectLayers=[];let v,w=0,T=this._style._mergedLayers[s[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<c;)T=this._style._mergedLayers[s[w]];for(;w<c;++w){const P=this._style._mergedLayers[s[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?v===void 0&&(v=w):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(m.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:w-1}),m.length!==0){const P=m[m.length-1];this._pendingGroundEffectLayers.every(O=>O>P.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let P=0;P<T.length;++P){const O=Object.values(T[P]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const P=m[T];if(c.getTileByID(P.key),c.proxyCachedFBO[P.key]!==void 0){const O=s[P.key],D=this.proxyToSource[P.key];let F=0;for(const W in D){const H=D[W],q=O[W];if(!q||q.length!==H.length||H.some((ee,Y)=>ee!==q[Y]||v[W]&&v[W].hasOwnProperty(ee.key))){F=-1;break}++F}for(const W in c.proxyCachedFBO[P.key])c.renderCache[c.proxyCachedFBO[P.key][W]].dirty=F<0||F!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((T,P)=>P.end-P.start-(T.end-T.start));for(const T of w)for(const P of m){if(c.proxyCachedFBO[P.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[P.key]={},c.proxyCachedFBO[P.key][T.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let P;if(m.isTileClipped())P=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Ar.disabled}_renderTileClippingMasks(s,c){const m=this.painter,v=this.painter.context,w=v.gl;m._tileClippingMaskIDs={},v.setColorMode(Nr.disabled),v.setDepthMode(ir.disabled);const T=m.getOrCreateProgram("clippingMask");for(const P of s){const O=m._tileClippingMaskIDs[P.key]=--c;T.draw(m,w.TRIANGLES,ir.disabled,new Ar({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),Nr.disabled,wr.disabled,jh(P.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const m=[s.x,s.y,1,1];i.aC(m,m,c.pixelMatrixInverse),i.cK(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const v=c._camera.position,w=i.cf(1,c.center.lat),T=[v[0],v[1],v[2]/w,0],P=i.da([],m.slice(0,3),T);i.aw(P,P);const O=this.raycast(T,P,this._exaggeration);return O!==null&&O?(i.bH(T,T,P,O),T[3]=T[2],T[2]*=w,T):null}_setupProxiedCoordsForOrtho(s,c,m){if(s.getSource()instanceof i.aU)return this._setupProxiedCoordsForImageSource(s,c,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const D=w[O],F=this._findTileCoveringTileID(D,s);if(F){const W=this._createProxiedId(D,F,m[D.key]&&m[D.key][s.id]);v.push(W),this.proxyToSource[D.key][s.id]=[W]}}let T=!1;const P=new Set;for(let O=0;O<c.length;O++){const D=s.getTile(c[O]);if(!D||!D.hasData())continue;const F=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==D.tileID.canonical.z){const W=this.proxyToSource[F.tileID.key][s.id],H=this._createProxiedId(F.tileID,D,m[F.tileID.key]&&m[F.tileID.key][s.id]);W?W.splice(W.length-1,0,H):this.proxyToSource[F.tileID.key][s.id]=[H];const q=this.proxyToSource[F.tileID.key][s.id];P.has(q)||P.add(q),v.push(H),T=!0}}if(this._sourceTilesOverlap[s.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const O of P)O.sort((D,F)=>F.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,m){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],w=this.proxyCoords,T=s.getSource(),P=T.tileID;if(!P)return;const O=new i.P(P.x,P.y)._div(1<<P.z),D=T.coordinates.map(i.ae.fromLngLat).reduce((W,H)=>(W.min.x=Math.min(W.min.x,H.x-O.x),W.min.y=Math.min(W.min.y,H.y-O.y),W.max.x=Math.max(W.max.x,H.x-O.x),W.max.y=Math.max(W.max.y,H.y-O.y),W),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(W,H)=>{const q=W.wrap+W.canonical.x/(1<<W.canonical.z),ee=W.canonical.y/(1<<W.canonical.z),Y=i.al/(1<<W.canonical.z),ae=H.wrap+H.canonical.x/(1<<H.canonical.z),oe=H.canonical.y/(1<<H.canonical.z);return q+Y<ae+D.min.x||q>ae+D.max.x||ee+Y<oe+D.min.y||ee>oe+D.max.y};for(let W=0;W<w.length;W++){const H=w[W];for(let q=0;q<c.length;q++){const ee=s.getTile(c[q]);if(!ee||!ee.hasData()||F(H,ee.tileID))continue;const Y=this._createProxiedId(H,ee,m[H.key]&&m[H.key][s.id]),ae=this.proxyToSource[H.key][s.id];ae?ae.push(Y):this.proxyToSource[H.key][s.id]=[Y],v.push(Y)}}}_createProxiedId(s,c,m){let v=this.orthoMatrix;if(m){const w=m.find(T=>T.key===c.tileID.key);if(w)return w}if(c.tileID.key!==s.key){const w=s.canonical.z-c.tileID.canonical.z;let T,P,O;v=i.bC();const D=c.tileID.wrap-s.wrap<<s.overscaledZ;w>0?(T=i.al>>w,P=T*((c.tileID.canonical.x<<w)-s.canonical.x+D),O=T*((c.tileID.canonical.y<<w)-s.canonical.y)):(T=i.al<<-w,P=i.al*(c.tileID.canonical.x-(s.canonical.x+D<<-w)),O=i.al*(c.tileID.canonical.y-(s.canonical.y<<-w))),i.ce(v,0,T,0,T,0,1),i.br(v,v,[P,O,0])}return new t_(c.tileID,s.key,v)}_findTileCoveringTileID(s,c){let m=c.getTile(s);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[c.id],w=v[s.key];if(m=w?c.getTileByID(w):null,m&&m.hasData()||w===null)return m;let T=m?m.tileID:s,P=T.overscaledZ;const O=c.getSource().minzoom,D=[];if(!w){const W=c.getSource().maxzoom;if(s.canonical.z>=W){const H=s.canonical.z-W;c.getSource().reparseOverscaled?(P=Math.max(s.canonical.z+2,c.transform.tileZoom),T=new i.aQ(P,s.wrap,W,s.canonical.x>>H,s.canonical.y>>H)):H!==0&&(P=W,T=new i.aQ(P,s.wrap,W,s.canonical.x>>H,s.canonical.y>>H))}T.key!==s.key&&(D.push(T.key),m=c.getTile(T))}const F=W=>{D.forEach(H=>{v[H]=W}),D.length=0};for(P-=1;P>=O&&(!m||!m.hasData());P--){m&&F(m.tileID.key);const W=T.calculateScaledKey(P);if(m=c.getTileByID(W),m&&m.hasData())break;const H=v[W];if(H===null)break;H===void 0?D.push(W):m=c.getTileByID(H)}return F(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[c.key]=!0}}function yd(p,s,c){const m=function(P,O,D){const F=i.bJ(O,P),W=i.bJ(D,[.2126,.7152,.0722]),H=(ee,Y,ae)=>(1-ae)*ee+ae*Y,q=H(1-.3*Math.min(W,1),1,Math.min(F+1,1));return H(.92,1,Math.asin(i.aA(O[2],-1,1))/Math.PI+.5)*q}(p,[0,0,1],s),v=[0,0,0];i.c5(v,c.slice(0,3),m);const w=[0,0,0];i.c5(w,s.slice(0,3),p[2]);const T=[0,0,0];return i.d8(T,v,w),i.db(T)}const R2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],k2=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Gx{static cacheKey(s,c,m,v){const w=[c];v&&w.push(v.cacheKey);for(const T of m)s.usedDefines.has(T)&&w.push(T);return w.join("/")}constructor(s,c,m,v,w,T){const P=s.gl;this.program=P.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...T];const O=`#version 300 es
${(v?v.defines():[]).concat(T.map(Y=>`#define ${Y}`)).join(`
`)}`,D=[O,S2];for(const Y of m.fragmentIncludes)D.push(Ec[Y]);D.push(m.fragmentSource);const F=D.join(`
`),W=[O,jx];for(const Y of m.vertexIncludes)W.push(Ec[Y]);this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&m.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&W.push("uniform int u_instanceID;"),W.push(m.vertexSource);let H=W.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const q=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(q,F),P.compileShader(q),P.attachShader(this.program,q);const ee=P.createShader(P.VERTEX_SHADER);P.isContextLost()?this.failedToCreate=!0:(P.shaderSource(ee,H),P.compileShader(ee),P.attachShader(this.program,ee),this.attributes={},P.linkProgram(this.program),P.deleteShader(ee),P.deleteShader(q),this.fixedUniforms=w(s),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=v?v.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new i.ch(Y)}))(s)),(T.includes("TERRAIN")||c.includes("symbol")||c.includes("circle"))&&(this.terrainUniforms=(Y=>({u_dem:new i.ch(Y),u_dem_prev:new i.ch(Y),u_dem_tl:new i.ck(Y),u_dem_scale:new i.cj(Y),u_dem_tl_prev:new i.ck(Y),u_dem_scale_prev:new i.cj(Y),u_dem_size:new i.cj(Y),u_dem_lerp:new i.cj(Y),u_exaggeration:new i.cj(Y),u_depth:new i.ch(Y),u_depth_size_inv:new i.ck(Y),u_depth_range_unpack:new i.ck(Y),u_occluder_half_size:new i.cj(Y),u_occlusion_depth_offset:new i.cj(Y),u_meter_to_dem:new i.cj(Y),u_label_plane_matrix_inv:new i.cl(Y)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new i.ci(Y),u_tile_tr_up:new i.ci(Y),u_tile_br_up:new i.ci(Y),u_tile_bl_up:new i.ci(Y),u_tile_up_scale:new i.cj(Y)}))(s)),T.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new i.cl(Y),u_fog_range:new i.ck(Y),u_fog_color:new i.d3(Y),u_fog_horizon_blend:new i.cj(Y),u_fog_vertical_limit:new i.ck(Y),u_fog_temporal_offset:new i.cj(Y),u_frustum_tl:new i.ci(Y),u_frustum_tr:new i.ci(Y),u_frustum_br:new i.ci(Y),u_frustum_bl:new i.ci(Y),u_globe_pos:new i.ci(Y),u_globe_radius:new i.cj(Y),u_globe_transition:new i.cj(Y),u_is_globe:new i.ch(Y),u_viewport:new i.ck(Y)}))(s)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new i.d3(Y)}))(s)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new i.ci(Y),u_lighting_directional_dir:new i.ci(Y),u_lighting_directional_color:new i.ci(Y),u_ground_radiance:new i.ci(Y)}))(s)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new i.cl(Y),u_light_matrix_1:new i.cl(Y),u_fade_range:new i.ck(Y),u_shadow_normal_offset:new i.ci(Y),u_shadow_intensity:new i.cj(Y),u_shadow_texel_size:new i.cj(Y),u_shadow_map_resolution:new i.cj(Y),u_shadow_direction:new i.ci(Y),u_shadow_bias:new i.ci(Y),u_shadowmap_0:new i.ch(Y),u_shadowmap_1:new i.ch(Y)}))(s)))}getAttributeLocation(s,c){let m=this.attributes[c];return m===void 0&&(m=this.attributes[c]=s.getAttribLocation(this.program,c)),m}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)m[v]&&m[v].set(this.program,v,c[v])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;s.program.set(this.program);for(const v in c)m[v].set(this.program,v,c[v])}_drawDebugWireframe(s,c,m,v,w,T,P,O,D,F){const W=s.options.wireframe;if(W.terrain===!1&&W.layers2D===!1&&W.layers3D===!1)return;const H=s.context;if(!(!(!W.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!W.layers2D||s._terrain&&s._terrain.renderingToTexture||!R2.includes(this.name))||!(!W.layers3D||!k2.includes(this.name))))return;const q=H.gl,ee=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,w,H);if(!ee)return;const Y=[...this.fixedDefines,"DEBUG_WIREFRAME"],ae=s.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});H.program.set(ae.program);const oe=(fe,Pe,be)=>{if(Pe[fe]&&be[fe])for(const Ae in Pe[fe])be[fe][Ae]&&be[fe][Ae].set(be.program,Ae,Pe[fe][Ae].current)};D&&D.setUniforms(ae.program,H,ae.binderUniforms,P,{zoom:O}),oe("fixedUniforms",this,ae),oe("terrainUniforms",this,ae),oe("globeUniforms",this,ae),oe("fogUniforms",this,ae),oe("lightsUniforms",this,ae),oe("shadowUniforms",this,ae),ee.bind(),H.setColorMode(new Nr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],i.ao.transparent,[!0,!0,!0,!1])),H.setDepthMode(new ir(c.func===q.LESS?q.LEQUAL:c.func,ir.ReadOnly,c.range)),H.setStencilMode(Ar.disabled);const de=3*T.primitiveLength*2,me=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=F||1;for(let Pe=0;Pe<fe;++Pe)ae.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),q.drawElements(q.LINES,de,q.UNSIGNED_SHORT,me)}else F&&F>1?q.drawElementsInstanced(q.LINES,de,q.UNSIGNED_SHORT,me,F):q.drawElements(q.LINES,de,q.UNSIGNED_SHORT,me);w.bind(),H.program.set(this.program),H.setDepthMode(c),H.setStencilMode(m),H.setColorMode(v)}checkUniforms(s,c,m){if(this.fixedDefines.includes(c)){for(const v of Object.keys(m))if(!m[v].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${v} not set but required by ${c} being defined`)}}draw(s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae){const oe=s.context,de=oe.gl;if(this.failedToCreate)return;oe.program.set(this.program),oe.setDepthMode(m),oe.setStencilMode(v),oe.setColorMode(w),oe.setCullFace(T);for(const[xe,ye]of this.fixedUniformsEntries)ye.set(this.program,xe,P[xe]);ee&&ee.setUniforms(this.program,oe,this.binderUniforms,H,{zoom:q});const me={[de.POINTS]:1,[de.LINES]:2,[de.TRIANGLES]:3,[de.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const fe=Y||[],Pe=ee?ee.getPaintVertexBuffers():[],be=c===de.TRIANGLES&&F,Ae=ae&&ae>0?1:void 0;for(const xe of W.get()){const ye=xe.vaos||(xe.vaos={});if((ye[O]||(ye[O]=new T2)).bind(oe,this,D,Pe,F,xe.vertexOffset,fe,Ae),this.forceManualRenderingForInstanceIDShaders){const Ce=ae||1;for(let $e=0;$e<Ce;++$e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",$e),F?de.drawElements(c,xe.primitiveLength*me,de.UNSIGNED_SHORT,xe.primitiveOffset*me*2):de.drawArrays(c,xe.vertexOffset,xe.vertexLength)}else ae&&ae>1?de.drawElementsInstanced(c,xe.primitiveLength*me,de.UNSIGNED_SHORT,xe.primitiveOffset*me*2,ae):F?de.drawElements(c,xe.primitiveLength*me,de.UNSIGNED_SHORT,xe.primitiveOffset*me*2):de.drawArrays(c,xe.vertexOffset,xe.vertexLength);be&&this._drawDebugWireframe(s,m,v,w,F,xe,H,q,ee,ae)}}}function Hx(p,s,c=0){const m=Math.pow(2,s.tileID.overscaledZ),v=s.tileSize*Math.pow(2,p.transform.tileZoom)/m,w=v*(s.tileID.canonical.x+s.tileID.wrap*m),T=v*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(s,1,p.transform.tileZoom),u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T],u_pattern_transition:c}}const $p={terrain:0,flat:1},j2=i.bC(),Vp=(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe)=>{const de=s.style.light,me=de.properties.get("position"),fe=[me.x,me.y,me.z],Pe=i.dO();de.properties.get("anchor")==="viewport"&&(i.dP(Pe,-s.transform.angle),i.dQ(fe,fe,Pe));const be=de.properties.get("color").toPremultipliedRenderColor(null),Ae=s.transform,xe={u_matrix:p,u_lightpos:fe,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:j2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:$p[D],u_base_type:$p[F],u_ao:v,u_edge_radius:w,u_width_scale:T,u_flood_light_color:ee,u_vertical_scale:Y,u_flood_light_intensity:ae,u_ground_shadow_factor:oe};return Ae.projection.name==="globe"&&(xe.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],xe.u_zoom_transition=W,xe.u_inv_rot_matrix=q,xe.u_merc_center=H,xe.u_up_dir=Ae.projection.upVector(new i.cD(0,0,0),H[0]*i.al,H[1]*i.al),xe.u_height_lift=O),xe},n_=(p,s,c,m,v,w)=>({u_matrix:p,u_edge_radius:s,u_width_scale:c,u_vertical_scale:m,u_height_type:$p[v],u_base_type:$p[w]}),Wx=(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe)=>{const de=Vp(p,s,c,m,v,w,T,P,D,F,W,H,q,ee,Y,ae,1,[0,0,0]),me={u_height_factor:-Math.pow(2,P.overscaledZ)/O.tileSize/8};return Object.assign(de,Hx(s,O,oe),me)},_d=(p,s,c,m,v,w,T,P,O,D,F)=>({u_matrix:s,u_opacity:c,u_ao_pass:m?1:0,u_meter_to_tile:v,u_ao:w,u_flood_light_intensity:T,u_flood_light_color:P,u_attenuation:O,u_edge_radius:D,u_fb:0,u_fb_size:F,u_dynamic_offset:1}),i_=(p,s,c)=>({u_matrix:p,u_emissive_strength:s,u_ground_shadow_factor:c}),o_=(p,s,c,m,v,w=0)=>Object.assign(i_(p,s,v),Hx(c,m,w)),qx=(p,s,c,m)=>({u_matrix:p,u_world:c,u_emissive_strength:s,u_ground_shadow_factor:m}),s_=(p,s,c,m,v,w,T=0)=>Object.assign(o_(p,s,c,m,w,T),{u_world:v}),Cc=(p,s)=>({u_matrix:p,u_ground_shadow_factor:s}),_u=(p,s,c,m,v)=>({u_matrix:p,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:c,u_height_scale:m,u_reset_depth:v}),Up=(p,s,c,m,v,w,T,P,O)=>({u_matrix:p,u_normal_matrix:s,u_opacity:c,u_faux_facade_ao_intensity:m,u_camera_pos:v,u_tile_to_meter:w,u_facade_emissive_chance:T,u_flood_light_color:P,u_flood_light_intensity:O}),Zx=p=>({u_matrix:p}),Ic=p=>({u_matrix:p}),a_=(p,s,c,m,v,w,T,P)=>{const O=i.al/w.tileSize;return{u_matrix:p,u_inv_rot_matrix:s,u_camera_to_center_distance:c.getCameraToCenterDistance(P),u_extrude_scale:[c.pixelsToGLUnits[0]/O,c.pixelsToGLUnits[1]/O],u_zoom_transition:m,u_tile_id:T,u_merc_center:v}},Lh=(p,s,c=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:c}),Kx=i.bC(),Xx=(p,s,c,m,v,w,T)=>{const P=p.transform,O=P.projection.name==="globe",D=O?i.dR(P.zoom,s.canonical)*P._pixelsPerMercatorPixel:i.ay(c,1,w),F={u_matrix:s.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:Kx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){F.u_inv_rot_matrix=m,F.u_merc_center=v,F.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],F.u_zoom_transition=i.aj(P.zoom);const W=v[0]*i.al,H=v[1]*i.al;F.u_up_dir=P.projection.upVector(new i.cD(0,0,0),W,H)}return F};function Gp(p,[s,c,m,v],[w,T]){if(w===T)return[0,0,0,0];const P=255*(p-1)/(p*(T-w));return[s*P,c*P,m*P,v*P]}function Hp(p,s,[c,m]){return c===m?0:.5/p+(s-c)*(p-1)/(p*(m-c))}const Yx=(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de,me,fe)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:D,u_fade_t:F.mix,u_opacity:F.opacity*W.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:W.paint.get("raster-brightness-min"),u_brightness_high:W.paint.get("raster-brightness-max"),u_saturation_factor:i.dT(W.paint.get("raster-saturation")),u_contrast_factor:i.dS(W.paint.get("raster-contrast")),u_spin_weights:Jx(W.paint.get("raster-hue-rotate")),u_perspective_transform:H,u_raster_elevation:q,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:O,u_colorization_mix:Gp(i.dU,Y,oe),u_colorization_offset:Hp(i.dU,ae,oe),u_color_ramp:ee,u_texture_offset:[me/(de+2*me),de/(de+2*me)],u_texture_res:[de+2*me,de+2*me],u_emissive_strength:fe});function Jx(p){p*=Math.PI/180;const s=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const ol=.05,D2=(p,s,c,m,v,w,T,P,O,D,F,W)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:D,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:W,u_zoom_transition:T,u_merc_center:P,u_cutoff_params:O}),L2=(p,s,c,m,v,w,T,P,O,D)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_tile_offset:c,u_velocity:m,u_color_ramp:w,u_velocity_res:v,u_max_speed:T,u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[ol,ol]}),Qx=(p,s,c,m,v,w,T,P,O,D)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_velocity:c,u_velocity_res:m,u_max_speed:v,u_speed_factor:w,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[ol,ol]}),eb=i.bC(),Wp=(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de,me,fe,Pe,be,Ae)=>{const xe=v.transform,ye={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(de),u_rotate_symbol:+c,u_aspect_ratio:xe.width/xe.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+D,u_elevation_from_sea:O?1:0,u_pitch_with_map:+m,u_texsize:F,u_texsize_icon:W,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:eb,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:eb,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:be||0,u_gamma_scale:m?v.transform.getCameraToCenterDistance(de)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ae||1,u_ground_shadow_factor:me,u_inv_matrix:i.bl(i.bC(),T),u_normal_scale:fe,u_lutTexture:Oo.LUT};return de.name==="globe"&&(ye.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],ye.u_zoom_transition=ee,ye.u_inv_rot_matrix=ae,ye.u_merc_center=Y,ye.u_camera_forward=xe._camera.forward(),ye.u_ecef_origin=i.dV(xe.globeMatrix,q.toUnwrapped()),ye.u_tile_matrix=Float32Array.from(xe.globeMatrix),ye.u_up_vector=oe),ye},Nh=(p,s,c,m)=>({u_matrix:p,u_emissive_strength:s,u_opacity:c,u_color:m}),Mc=(p,s,c,m,v,w,T,P,O)=>Object.assign(function(D,F,W,H,q,ee){const{width:Y,height:ae}=H.imageManager.getPixelSize(F),oe=Math.pow(2,ee.tileID.overscaledZ),de=ee.tileSize*Math.pow(2,H.transform.tileZoom)/oe,me=de*(ee.tileID.canonical.x+ee.tileID.wrap*oe),fe=de*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:W.tl,u_pattern_br:W.br,u_texsize:[Y,ae],u_pattern_size:W.displaySize,u_pattern_units_to_pixels:q?[H.transform.width,-1*H.transform.height]:[1/i.ay(ee,1,H.transform.tileZoom),1/i.ay(ee,1,H.transform.tileZoom)],u_pixel_coord_upper:[me>>16,fe>>16],u_pixel_coord_lower:[65535&me,65535&fe]}}(0,w,T,m,P,O),{u_matrix:p,u_emissive_strength:s,u_opacity:c}),vd=new Float32Array(i.bA([])),vu=(p,s,c,m,v,w,T,P,O,D,F,W,H,q=[0,0,0],ee,Y,ae)=>{const oe=v.style.light,de=oe.properties.get("position"),me=[-de.x,-de.y,de.z],fe=i.dO();oe.properties.get("anchor")==="viewport"&&(i.dP(fe,-v.transform.angle),i.dQ(me,me,fe));const Pe=F.alphaMode==="MASK",be=oe.properties.get("color").toNonPremultipliedRenderColor(null),Ae=H.paint.get("model-ambient-occlusion-intensity"),xe=H.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return xe.a=H.paint.get("model-color-mix-intensity").constantOr(0),ae&&(xe.r=ae[0],xe.g=ae[1],xe.b=ae[2],xe.a=ae[3]),Y&&(xe.r=Y.color.r,xe.g=Y.color.g,xe.b=Y.color.b,xe.a=Y.colorMix,W=Y.emissionStrength,w*=Y.opacity),{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:c,u_node_matrix:m||vd,u_lightpos:me,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_camera_pos:q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Pe,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:D,u_baseColorTexture:Oo.BaseColor,u_metallicRoughnessTexture:Oo.MetallicRoughness,u_normalTexture:Oo.Normal,u_occlusionTexture:Oo.Occlusion,u_emissionTexture:Oo.Emission,u_lutTexture:Oo.LUT,u_color_mix:xe.toArray01(),u_aoIntensity:Ae,u_emissive_strength:W,u_occlusionTextureTransform:ee||[0,0,0,0]}},l_=(p,s=vd,c=vd)=>({u_matrix:p,u_instance:s,u_node_matrix:c}),qp={fillExtrusion:p=>({u_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_vertical_gradient:new i.cj(p),u_opacity:new i.cj(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_ao:new i.ck(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_up_dir:new i.ci(p),u_height_lift:new i.cj(p),u_flood_light_color:new i.ci(p),u_vertical_scale:new i.cj(p),u_flood_light_intensity:new i.cj(p),u_ground_shadow_factor:new i.ci(p)}),fillExtrusionDepth:p=>({u_matrix:new i.cl(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_vertical_scale:new i.cj(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p)}),fillExtrusionPattern:p=>({u_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_vertical_gradient:new i.cj(p),u_height_factor:new i.cj(p),u_edge_radius:new i.cj(p),u_width_scale:new i.cj(p),u_ao:new i.ck(p),u_height_type:new i.ch(p),u_base_type:new i.ch(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_up_dir:new i.ci(p),u_height_lift:new i.cj(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_opacity:new i.cj(p),u_pattern_transition:new i.cj(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new i.cl(p),u_opacity:new i.cj(p),u_ao_pass:new i.cj(p),u_meter_to_tile:new i.cj(p),u_ao:new i.ck(p),u_flood_light_intensity:new i.cj(p),u_flood_light_color:new i.ci(p),u_attenuation:new i.cj(p),u_edge_radius:new i.cj(p),u_fb:new i.ch(p),u_fb_size:new i.cj(p),u_dynamic_offset:new i.cj(p)}),fill:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_ground_shadow_factor:new i.ci(p)}),fillPattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_pattern_transition:new i.cj(p)}),fillOutline:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_world:new i.ck(p),u_ground_shadow_factor:new i.ci(p)}),fillOutlinePattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_world:new i.ck(p),u_image:new i.ch(p),u_texsize:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_tile_units_to_pixels:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_pattern_transition:new i.cj(p)}),building:p=>({u_matrix:new i.cl(p),u_normal_matrix:new i.cl(p),u_opacity:new i.cj(p),u_faux_facade_ao_intensity:new i.cj(p),u_camera_pos:new i.ci(p),u_tile_to_meter:new i.cj(p),u_facade_emissive_chance:new i.cj(p),u_flood_light_color:new i.ci(p),u_flood_light_intensity:new i.cj(p)}),buildingBloom:p=>({u_matrix:new i.cl(p)}),buildingDepth:p=>({u_matrix:new i.cl(p)}),elevatedStructuresDepth:p=>({u_matrix:new i.cl(p),u_depth_bias:new i.cj(p)}),elevatedStructures:p=>({u_matrix:new i.cl(p),u_ground_shadow_factor:new i.ci(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new i.cl(p),u_camera_pos:new i.ci(p),u_depth_bias:new i.cj(p),u_height_scale:new i.cj(p),u_reset_depth:new i.cj(p)}),circle:i.dY,collisionBox:p=>({u_matrix:new i.cl(p),u_inv_rot_matrix:new i.cl(p),u_camera_to_center_distance:new i.cj(p),u_extrude_scale:new i.ck(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_tile_id:new i.ci(p)}),collisionCircle:p=>({u_matrix:new i.cl(p),u_inv_matrix:new i.cl(p),u_camera_to_center_distance:new i.cj(p),u_viewport_size:new i.ck(p)}),debug:p=>({u_color:new i.dB(p),u_matrix:new i.cl(p),u_overlay:new i.ch(p),u_overlay_scale:new i.cj(p)}),clippingMask:p=>({u_matrix:new i.cl(p)}),heatmap:p=>({u_extrude_scale:new i.cj(p),u_intensity:new i.cj(p),u_matrix:new i.cl(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_up_dir:new i.ci(p)}),heatmapTexture:p=>({u_image:new i.ch(p),u_color_ramp:new i.ch(p),u_opacity:new i.cj(p)}),hillshade:p=>({u_matrix:new i.cl(p),u_image:new i.ch(p),u_latrange:new i.ck(p),u_light:new i.ck(p),u_shadow:new i.dB(p),u_highlight:new i.dB(p),u_emissive_strength:new i.cj(p),u_accent:new i.dB(p)}),hillshadePrepare:p=>({u_matrix:new i.cl(p),u_image:new i.ch(p),u_dimension:new i.ck(p),u_zoom:new i.cj(p)}),line:i.dX,linePattern:i.dW,raster:p=>({u_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_grid_matrix:new i.dC(p),u_tl_parent:new i.ck(p),u_scale_parent:new i.cj(p),u_fade_t:new i.cj(p),u_opacity:new i.cj(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_brightness_low:new i.cj(p),u_brightness_high:new i.cj(p),u_saturation_factor:new i.cj(p),u_contrast_factor:new i.cj(p),u_spin_weights:new i.ci(p),u_perspective_transform:new i.ck(p),u_raster_elevation:new i.cj(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_cutoff_params:new i.d3(p),u_colorization_mix:new i.d3(p),u_colorization_offset:new i.cj(p),u_color_ramp:new i.ch(p),u_texture_offset:new i.ck(p),u_texture_res:new i.ck(p),u_emissive_strength:new i.cj(p)}),rasterParticle:p=>({u_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_grid_matrix:new i.dC(p),u_tl_parent:new i.ck(p),u_scale_parent:new i.cj(p),u_fade_t:new i.cj(p),u_opacity:new i.cj(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_raster_elevation:new i.cj(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_cutoff_params:new i.d3(p)}),rasterParticleTexture:p=>({u_texture:new i.ch(p),u_opacity:new i.cj(p)}),rasterParticleDraw:p=>({u_particle_texture:new i.ch(p),u_particle_texture_side_len:new i.cj(p),u_tile_offset:new i.ck(p),u_velocity:new i.ch(p),u_color_ramp:new i.ch(p),u_velocity_res:new i.ck(p),u_max_speed:new i.cj(p),u_uv_offset:new i.ck(p),u_data_scale:new i.ck(p),u_data_offset:new i.cj(p),u_particle_pos_scale:new i.cj(p),u_particle_pos_offset:new i.ck(p)}),rasterParticleUpdate:p=>({u_particle_texture:new i.ch(p),u_particle_texture_side_len:new i.cj(p),u_velocity:new i.ch(p),u_velocity_res:new i.ck(p),u_max_speed:new i.cj(p),u_speed_factor:new i.cj(p),u_reset_rate:new i.cj(p),u_rand_seed:new i.cj(p),u_uv_offset:new i.ck(p),u_data_scale:new i.ck(p),u_data_offset:new i.cj(p),u_particle_pos_scale:new i.cj(p),u_particle_pos_offset:new i.ck(p)}),symbol:p=>({u_is_size_zoom_constant:new i.ch(p),u_is_size_feature_constant:new i.ch(p),u_size_t:new i.cj(p),u_size:new i.cj(p),u_camera_to_center_distance:new i.cj(p),u_rotate_symbol:new i.ch(p),u_aspect_ratio:new i.cj(p),u_fade_change:new i.cj(p),u_matrix:new i.cl(p),u_label_plane_matrix:new i.cl(p),u_coord_matrix:new i.cl(p),u_is_text:new i.ch(p),u_elevation_from_sea:new i.ch(p),u_pitch_with_map:new i.ch(p),u_texsize:new i.ck(p),u_texsize_icon:new i.ck(p),u_texture:new i.ch(p),u_texture_icon:new i.ch(p),u_gamma_scale:new i.cj(p),u_device_pixel_ratio:new i.cj(p),u_tile_id:new i.ci(p),u_zoom_transition:new i.cj(p),u_inv_rot_matrix:new i.cl(p),u_merc_center:new i.ck(p),u_camera_forward:new i.ci(p),u_tile_matrix:new i.cl(p),u_up_vector:new i.ci(p),u_ecef_origin:new i.ci(p),u_is_halo:new i.ch(p),u_icon_transition:new i.cj(p),u_color_adj_mat:new i.cl(p),u_scale_factor:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_inv_matrix:new i.cl(p),u_normal_scale:new i.cj(p),u_lutTexture:new i.ch(p)}),background:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_opacity:new i.cj(p),u_color:new i.dB(p)}),backgroundPattern:p=>({u_matrix:new i.cl(p),u_emissive_strength:new i.cj(p),u_opacity:new i.cj(p),u_image:new i.ch(p),u_pattern_tl:new i.ck(p),u_pattern_br:new i.ck(p),u_texsize:new i.ck(p),u_pattern_size:new i.ck(p),u_pixel_coord_upper:new i.ck(p),u_pixel_coord_lower:new i.ck(p),u_pattern_units_to_pixels:new i.ck(p)}),terrainRaster:p=>({u_matrix:new i.cl(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_skirt_height:new i.cj(p),u_ground_shadow_factor:new i.ci(p),u_emissive_texture_available:new i.cj(p)}),skybox:p=>({u_matrix:new i.cl(p),u_sun_direction:new i.ci(p),u_cubemap:new i.ch(p),u_opacity:new i.cj(p),u_temporal_offset:new i.cj(p)}),skyboxGradient:p=>({u_matrix:new i.cl(p),u_color_ramp:new i.ch(p),u_center_direction:new i.ci(p),u_radius:new i.cj(p),u_opacity:new i.cj(p),u_temporal_offset:new i.cj(p)}),skyboxCapture:p=>({u_matrix_3f:new i.dC(p),u_sun_direction:new i.ci(p),u_sun_intensity:new i.cj(p),u_color_tint_r:new i.d3(p),u_color_tint_m:new i.d3(p),u_luminance:new i.cj(p)}),globeRaster:p=>({u_proj_matrix:new i.cl(p),u_globe_matrix:new i.cl(p),u_normalize_matrix:new i.cl(p),u_merc_matrix:new i.cl(p),u_zoom_transition:new i.cj(p),u_merc_center:new i.ck(p),u_image0:new i.ch(p),u_image1:new i.ch(p),u_grid_matrix:new i.dC(p),u_skirt_height:new i.cj(p),u_far_z_cutoff:new i.cj(p),u_frustum_tl:new i.ci(p),u_frustum_tr:new i.ci(p),u_frustum_br:new i.ci(p),u_frustum_bl:new i.ci(p),u_globe_pos:new i.ci(p),u_globe_radius:new i.cj(p),u_viewport:new i.ck(p),u_emissive_texture_available:new i.cj(p)}),globeAtmosphere:p=>({u_frustum_tl:new i.ci(p),u_frustum_tr:new i.ci(p),u_frustum_br:new i.ci(p),u_frustum_bl:new i.ci(p),u_horizon:new i.cj(p),u_transition:new i.cj(p),u_fadeout_range:new i.cj(p),u_atmosphere_fog_color:new i.d3(p),u_high_color:new i.d3(p),u_space_color:new i.d3(p),u_temporal_offset:new i.cj(p),u_horizon_angle:new i.cj(p)}),model:p=>({u_matrix:new i.cl(p),u_lighting_matrix:new i.cl(p),u_normal_matrix:new i.cl(p),u_node_matrix:new i.cl(p),u_lightpos:new i.ci(p),u_lightintensity:new i.cj(p),u_lightcolor:new i.ci(p),u_camera_pos:new i.ci(p),u_opacity:new i.cj(p),u_baseColorFactor:new i.d3(p),u_emissiveFactor:new i.d3(p),u_metallicFactor:new i.cj(p),u_roughnessFactor:new i.cj(p),u_baseTextureIsAlpha:new i.ch(p),u_alphaMask:new i.ch(p),u_alphaCutoff:new i.cj(p),u_baseColorTexture:new i.ch(p),u_metallicRoughnessTexture:new i.ch(p),u_normalTexture:new i.ch(p),u_occlusionTexture:new i.ch(p),u_emissionTexture:new i.ch(p),u_lutTexture:new i.ch(p),u_color_mix:new i.d3(p),u_aoIntensity:new i.cj(p),u_emissive_strength:new i.cj(p),u_occlusionTextureTransform:new i.d3(p)}),modelDepth:p=>({u_matrix:new i.cl(p),u_instance:new i.cl(p),u_node_matrix:new i.cl(p)}),groundShadow:p=>({u_matrix:new i.cl(p),u_ground_shadow_factor:new i.ci(p)}),stars:p=>({u_matrix:new i.cl(p),u_up:new i.ci(p),u_right:new i.ci(p),u_intensity_multiplier:new i.cj(p)}),snowParticle:p=>({u_modelview:new i.cl(p),u_projection:new i.cl(p),u_time:new i.cj(p),u_cam_pos:new i.ci(p),u_velocityConeAperture:new i.cj(p),u_velocity:new i.cj(p),u_horizontalOscillationRadius:new i.cj(p),u_horizontalOscillationRate:new i.cj(p),u_boxSize:new i.cj(p),u_billboardSize:new i.cj(p),u_simpleShapeParameters:new i.ck(p),u_screenSize:new i.ck(p),u_thinningCenterPos:new i.ck(p),u_thinningShape:new i.ci(p),u_thinningAffectedRatio:new i.cj(p),u_thinningParticleOffset:new i.cj(p),u_particleColor:new i.d3(p),u_direction:new i.ci(p)}),rainParticle:p=>({u_modelview:new i.cl(p),u_projection:new i.cl(p),u_time:new i.cj(p),u_cam_pos:new i.ci(p),u_texScreen:new i.ch(p),u_velocityConeAperture:new i.cj(p),u_velocity:new i.cj(p),u_boxSize:new i.cj(p),u_rainDropletSize:new i.ck(p),u_distortionStrength:new i.cj(p),u_rainDirection:new i.ci(p),u_color:new i.d3(p),u_screenSize:new i.ck(p),u_thinningCenterPos:new i.ck(p),u_thinningShape:new i.ci(p),u_thinningAffectedRatio:new i.cj(p),u_thinningParticleOffset:new i.cj(p),u_shapeDirectionalPower:new i.cj(p),u_shapeNormalPower:new i.cj(p),u_mode:new i.cj(p)}),vignette:p=>({u_vignetteShape:new i.ci(p),u_vignetteColor:new i.d3(p)}),occlusion:p=>({u_matrix:new i.cl(p),u_anchorPos:new i.ci(p),u_screenSizePx:new i.ck(p),u_occluderSizePx:new i.ck(p),u_color:new i.d3(p)})};class Da{constructor(s,c,m,v){this.id=Da.uniqueIdxCounter,Da.uniqueIdxCounter++,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Da.uniqueIdxCounter,Da.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Da.uniqueIdxCounter=0;const c_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tb{constructor(s,c,m,v,w,T){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=s;const P=s.gl;this.buffer=P.createBuffer(),s.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let m=0;m<this.attributes.length;m++){const v=c.getAttributeLocation(s,this.attributes[m].name);v!==-1&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,c,m){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],T=c.getAttributeLocation(s,w.name);T!==-1&&s.vertexAttribPointer(T,w.components,s[c_[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(s,c,m){for(let v=0;v<this.attributes.length;v++){const w=c.getAttributeLocation(s,this.attributes[v].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rb{constructor(s,c,m,v,w){this.context=s,this.width=c,this.height=m;const T=this.framebuffer=s.gl.createFramebuffer();v>0&&(this.colorAttachment0=new Lp(s,T,0)),v>1&&(this.colorAttachment1=new Lp(s,T,1)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new md(s,T):new Rh(s,T))}createColorAttachment(s,c){c===0?this.colorAttachment0=new Lp(s,this.framebuffer,0):c===1&&(this.colorAttachment1=new Lp(s,this.framebuffer,1))}removeColorAttachment(s,c){const m=this.context.gl;let v;c===0?(v=this.colorAttachment0.get(),this.colorAttachment0=void 0):c===1&&(v=this.colorAttachment1.get(),this.colorAttachment1=void 0),v&&m.deleteTexture(v)}destroy(){const s=this.context.gl;if(this.colorAttachment0){const c=this.colorAttachment0.get();c&&s.deleteTexture(c)}if(this.colorAttachment1){const c=this.colorAttachment1.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class xd{constructor(s,c){this.gl=s,this.clearColor=new C2(this),this.clearDepth=new Dx(this),this.clearStencil=new Hy(this),this.colorMask=new Op(this),this.depthMask=new Wy(this),this.stencilMask=new yu(this),this.stencilFunc=new dd(this),this.stencilOp=new Mh(this),this.stencilTest=new hd(this),this.depthRange=new Lx(this),this.depthTest=new qy(this),this.depthFunc=new Nx(this),this.blend=new fd(this),this.blendFunc=new Rp(this),this.blendColor=new kp(this),this.blendEquation=new Zy(this),this.cullFace=new jp(this),this.cullFaceSide=new Oh(this),this.frontFace=new zx(this),this.program=new Fx(this),this.activeTexture=new Bx(this),this.viewport=new pd(this),this.bindFramebuffer=new $x(this),this.bindRenderbuffer=new I2(this),this.bindTexture=new M2(this),this.bindVertexBuffer=new O2(this),this.bindElementBuffer=new Ky(this),this.bindVertexArrayOES=new Xy(this),this.pixelStoreUnpack=new Yy(this),this.pixelStoreUnpackPremultiplyAlpha=new Jy(this),this.pixelStoreUnpackFlipY=new Vx(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=s.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,m){return new Da(this,s,c,m)}createVertexBuffer(s,c,m,v,w){return new tb(this,s,c,m,v,w)}createRenderbuffer(s,c,m){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,s,c,m),this.bindRenderbuffer.set(null),w}createFramebuffer(s,c,m,v){return new rb(this,s,c,m,v)}clear({color:s,depth:c,stencil:m,colorMask:v}){const w=this.gl;let T=0;s&&(T|=w.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(T|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(T|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){i.by(s.blendFunction,Nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let xu;function Yt(p,s,c,m,v,w,T){const P=p.context,O=P.gl,D=p.transform,F=[i.aF(D.center.lng),i.aJ(D.center.lat)],W=c.layout.get("symbol-placement"),H=c.layout.get("text-variable-anchor"),q=c.layout.get("icon-rotation-alignment")==="map",ee=c.layout.get("text-rotation-alignment")==="map",Y=W!=="point",ae=[];let oe=0,de=0;for(let ye=0;ye<m.length;ye++){const Ce=m[ye],$e=s.getTile(Ce),Ne=$e.getBucket(c);if(!Ne)continue;const et=Ne.getProjection().createInversionMatrix(D,Ce.canonical),tt=[],dt=pp(Ce,Ne,D),Tt=!T&&q&&Y,Ze=T&&ee&&Y,ke=H&&Ne.hasTextData(),st=Ne.hasIconTextFit()&&ke&&Ne.hasIconData(),Ye=Tt||Ze||T&&ke||st,gt=Ne.projection.name==="globe",Rt=gt?i.aj(D.zoom):0;gt&&(tt.push("PROJECTION_GLOBE_VIEW"),Ye&&tt.push("PROJECTED_POS_ON_VIEWPORT"));const Vt=p.getOrCreateProgram("collisionBox",{defines:tt});let It=dt;v[0]===0&&v[1]===0||(It=p.translatePosMatrix(dt,$e,v,w));const At=T?Ne.textCollisionBox:Ne.iconCollisionBox,tr=Ne.collisionCircleArray;if(tr.length>0){const zt=i.bC(),Gt=It;i.cP(zt,Ne.placementInvProjMatrix,D.glCoordMatrix),i.cP(zt,zt,Ne.placementViewportMatrix),ae.push({circleArray:tr,circleOffset:de,transform:Gt,invTransform:zt,projection:Ne.getProjection()}),oe+=tr.length/4,de=oe}if(!At)continue;p.terrain&&p.terrain.setupElevationDraw($e,Vt);const Jt=gt?[Ce.canonical.x,Ce.canonical.y,1<<Ce.canonical.z]:[0,0,0];Vt.draw(p,O.LINES,ir.disabled,Ar.disabled,p.colorModeForRenderPass(),wr.disabled,a_(It,et,D,Rt,F,$e,Jt,Ne.getProjection()),c.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,D.zoom,null,[At.collisionVertexBuffer,At.collisionVertexBufferExt])}if(!T||!ae.length)return;const me=p.getOrCreateProgram("collisionCircle"),fe=new i.dZ;fe.resize(4*oe),fe._trim();let Pe=0;for(const ye of ae)for(let Ce=0;Ce<ye.circleArray.length/4;Ce++){const $e=4*Ce,Ne=ye.circleArray[$e+0],et=ye.circleArray[$e+1],tt=ye.circleArray[$e+2],dt=ye.circleArray[$e+3];fe.emplace(Pe++,Ne,et,tt,dt,0),fe.emplace(Pe++,Ne,et,tt,dt,1),fe.emplace(Pe++,Ne,et,tt,dt,2),fe.emplace(Pe++,Ne,et,tt,dt,3)}(!xu||xu.length<2*oe)&&(xu=function(ye){const Ce=2*ye,$e=new i.b0;$e.resize(Ce),$e._trim();for(let Ne=0;Ne<Ce;Ne++){const et=6*Ne;$e.uint16[et+0]=4*Ne+0,$e.uint16[et+1]=4*Ne+1,$e.uint16[et+2]=4*Ne+2,$e.uint16[et+3]=4*Ne+2,$e.uint16[et+4]=4*Ne+3,$e.uint16[et+5]=4*Ne+0}return $e}(oe));const be=P.createIndexBuffer(xu,!0),Ae=P.createVertexBuffer(fe,i.d_.members,!0);for(const ye of ae){const Ce={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(xe=D).getCameraToCenterDistance(ye.projection),u_viewport_size:[xe.width,xe.height]};me.draw(p,O.TRIANGLES,ir.disabled,Ar.disabled,p.colorModeForRenderPass(),wr.disabled,Ce,c.id,Ae,be,i.bg.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,D.zoom)}var xe;Ae.destroy(),be.destroy()}const zh=i.bC();function kl(p){const s=p._camera.getWorldToCamera(p.worldSize,1),c=i.aB([],s,p.globeMatrix);i.bl(c,c);const m=[0,0,0],v=[0,1,0,0];return i.aC(v,v,c),m[0]=v[0],m[1]=v[1],m[2]=v[2],i.aw(m,m),m}function Oc({width:p,height:s,anchor:c,textOffset:m,textScale:v},w){const{horizontalAlign:T,verticalAlign:P}=i.c1(c),O=-(T-.5)*p,D=-(P-.5)*s,F=i.c2(c,m);return new i.P((O/v+F[0])*w,(D/v+F[1])*w)}function mr(p,s,c,m,v,w,T,P,O,D){const F=p.text.placedSymbolArray,W=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,q={},ee=p.getProjection(),Y=el(T,ee,v),ae=v.elevation,oe=ee.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;W.clear();for(let de=0;de<F.length;de++){const me=F.get(de),{tileAnchorX:fe,tileAnchorY:Pe,numGlyphs:be}=me,Ae=me.hidden||!me.crossTileID||p.allowVerticalPlacement&&!me.placedOrientation?null:m[me.crossTileID];if(Ae){let xe=0,ye=0,Ce=0;const $e=p.elevationType==="road";if(ae||$e){const Ye=$e?p.getElevationFeatureForText(de):null,gt=i.bV.getAtTileOffset(T,new i.P(fe,Pe),ae,Ye),[Rt,Vt,It]=ee.upVector(T.canonical,fe,Pe);xe=gt*Rt*oe,ye=gt*Vt*oe,Ce=gt*It*oe}let[Ne,et,tt,dt]=ca(me.projectedAnchorX+xe,me.projectedAnchorY+ye,me.projectedAnchorZ+Ce,c?Y:w);const Tt=kn(v.getCameraToCenterDistance(ee),dt);let Ze=i.bM(p.textSizeData,O,me)*Tt/i.bY;c&&(Ze*=p.tilePixelRatio/P);const ke=Oc(Ae,Ze);c?({x:Ne,y:et,z:tt}=ee.projectTilePoint(fe+ke.x,Pe+ke.y,T.canonical),[Ne,et,tt]=ca(Ne+xe,et+ye,tt+Ce,w)):(s&&ke._rotate(-v.angle),Ne+=ke.x,et+=ke.y,tt=0);const st=p.allowVerticalPlacement&&me.placedOrientation===i.bL.vertical?Math.PI/2:0;for(let Ye=0;Ye<be;Ye++)i.bO(W,Ne,et,tt,st);D&&me.associatedIconIndex>=0&&(q[me.associatedIconIndex]={x:Ne,y:et,z:tt,angle:st})}else Ra(be,W)}if(D){H.clear();const de=p.icon.placedSymbolArray;for(let me=0;me<de.length;me++){const fe=de.get(me),{numGlyphs:Pe}=fe,be=q[me];if(fe.hidden||!be)Ra(Pe,H);else{const{x:Ae,y:xe,z:ye,angle:Ce}=be;for(let $e=0;$e<Pe;$e++)i.bO(H,Ae,xe,ye,Ce)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(W)}function Fh(p,s,c,m,v,w,T={}){const P=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),D=c.paint.get("icon-translate-anchor"),F=c.paint.get("text-translate-anchor"),W=c.layout.get("icon-rotation-alignment"),H=c.layout.get("text-rotation-alignment"),q=c.layout.get("icon-pitch-alignment"),ee=c.layout.get("text-pitch-alignment"),Y=c.layout.get("icon-keep-upright"),ae=c.layout.get("text-keep-upright"),oe=c.paint.get("icon-color-saturation"),de=c.paint.get("icon-color-contrast"),me=c.paint.get("icon-color-brightness-min"),fe=c.paint.get("icon-color-brightness-max"),Pe=c.layout.get("symbol-elevation-reference")==="sea",be=c.layout.get("icon-image-use-theme")==="none",Ae=p.context,xe=Ae.gl,ye=p.transform,Ce=W==="map",$e=H==="map",Ne=q==="map",et=ee==="map",tt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let dt=!1;const Tt=p.depthModeForSublayer(0,ir.ReadOnly),Ze=new ir(p.context.gl.LEQUAL,ir.ReadOnly,p.depthRangeFor3D),ke=[i.aF(ye.center.lng),i.aJ(ye.center.lat)],st=c.layout.get("text-variable-anchor"),Ye=ye.projection.name==="globe",gt=[],Rt=[0,-1,0];for(const Vt of m){const It=s.getTile(Vt),At=It.getBucket(c);if(!At||At.projection.name==="mercator"&&Ye||At.fullyClipped)continue;const tr=At.projection.name==="globe",Jt=tr?i.aj(ye.zoom):0,zt=el(Vt,At.getProjection(),ye),Gt=ye.calculatePixelsToTileUnitsMatrix(It),hr=st&&At.hasTextData(),Or=At.hasIconTextFit()&&hr&&At.hasIconData(),Qr=At.getProjection().createInversionMatrix(ye,Vt.canonical),wn=(1<<It.tileID.canonical.z)*i.al/p.transform.worldSize,rr=Cn=>{let fn=[0,0,0];if(Cn){const $r=p.style.directionalLight,ci=p.style.ambientLight;$r&&ci&&(fn=Ol(p.style,$r,ci))}return fn},vn=Cn=>{ye.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||p.terrain)&&(Cn.push("DEPTH_D24"),Cn.push("DEPTH_OCCLUSION"))},Mr=Cn=>{c.lut&&!be&&(c.lut.texture||(c.lut.texture=new i.d$(p.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Ae.gl.RGBA8)),Ae.activeTexture.set(Ae.gl.TEXTURE0+Oo.LUT),c.lut.texture&&c.lut.texture.bind(Ae.gl.LINEAR,Ae.gl.CLAMP_TO_EDGE),Cn.push("APPLY_LUT_ON_GPU"))},Pn=()=>{const Cn=Ce&&c.layout.get("symbol-placement")!=="point",fn=[];vn(fn),Mr(fn);const $r=Cn||Or,ci=At.elevationType==="road",ki=p.shadowRenderer,vi=ci&&Ne&&!!ki&&ki.enabled,Kn=rr(vi),ws=ci&&Ne&&!p.terrain?Ze:Tt,Ho=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ne&&fn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(fn.push("PROJECTION_GLOBE_VIEW"),$r&&fn.push("PROJECTED_POS_ON_VIEWPORT")),Ho>0&&At.hasAnySecondaryIcon&&fn.push("ICON_TRANSITION"),!At.icon.zOffsetVertexBuffer||ci&&p.terrain||fn.push("Z_OFFSET"),oe===0&&de===0&&me===0&&fe===1||fn.push("COLOR_ADJUSTMENT"),At.sdfIcons&&fn.push("RENDER_SDF"),vi&&fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ci&&Ne&&!p.terrain&&At.icon.orientationVertexBuffer&&fn.push("ELEVATED_ROADS");const no=At.icon.programConfigurations.get(c.id),Yo=p.getOrCreateProgram("symbol",{config:no,defines:fn}),Jo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],No=At.iconSizeData,Qs=i.bK(No,ye.zoom),ya=Ne||!ye.isOrthographic,ks=as(zt,It.tileID.canonical,Ne,Ce,ye,At.getProjection(),Gt),Ci=xh(zt,It.tileID.canonical,Ne,Ce,ye,At.getProjection(),Gt),zi=p.translatePosMatrix(Ci,It,P,D,!0),Xn=p.translatePosMatrix(zt,It,P,D),Vi=$r?zh:ks,Ai=Ce&&!Ne&&!Cn;let xi=Rt;!Ye&&!ye.mercatorFromTransition||Ce||(xi=kl(ye));const _a=tr?xi:Rt,Yh=c.getColorAdjustmentMatrix(oe,de,me,fe),za=Wp(No.kind,Qs,Ai,Ne,p,Xn,Vi,zi,Pe,!1,Jo,[0,0],0,Vt,Jt,ke,Qr,_a,At.getProjection(),Kn,wn,Yh,Ho,null),Jh=It.imageAtlasTexture?It.imageAtlasTexture:null,Id=c.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear,ul=At.sdfIcons||p.options.rotating||p.options.zooming||Id||ya?xe.LINEAR:xe.NEAREST,Vl=At.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Md=p.terrain&&Ne&&Cn?i.bl(i.bC(),ks):zh;if(Cn&&At.icon){const Lc=i.bV.getAtTileOffsetFunc(Vt,ye.center.lat,ye.worldSize,At.getProjection()),Ul=mp(zt,It.tileID.canonical,Ne,Ce,ye,At.getProjection(),Gt),Fa=c.layout.get("icon-size-scale-range"),Gl=i.aA(p.scaleFactor,Fa[0],Fa[1]);Ex(At,zt,p,!1,Ul,Ci,Ne,Y,Lc,Vt,Gl)}return{program:Yo,buffers:At.icon,uniformValues:za,atlasTexture:Jh,atlasTextureIcon:null,atlasInterpolation:ul,atlasInterpolationIcon:null,isSDF:At.sdfIcons,hasHalo:Vl,depthMode:ws,tile:It,renderWithShadows:vi,labelPlaneMatrixInv:Md}},Bn=()=>{const Cn=$e&&c.layout.get("symbol-placement")!=="point",fn=[],$r=Cn||st||Or,ci=At.elevationType==="road",ki=p.shadowRenderer,vi=ci&&et&&!!ki&&ki.enabled,Kn=rr(vi),ws=ci&&et&&!p.terrain?Ze:Tt;p.terrainRenderModeElevated()&&et&&fn.push("PITCH_WITH_MAP_TERRAIN"),tr&&(fn.push("PROJECTION_GLOBE_VIEW"),$r&&fn.push("PROJECTED_POS_ON_VIEWPORT")),!At.text.zOffsetVertexBuffer||ci&&p.terrain||fn.push("Z_OFFSET"),At.iconsInText&&fn.push("RENDER_TEXT_AND_SYMBOL"),fn.push("RENDER_SDF"),vi&&fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ci&&et&&!p.terrain&&At.text.orientationVertexBuffer&&fn.push("ELEVATED_ROADS"),vn(fn);const Ho=At.text.programConfigurations.get(c.id),no=p.getOrCreateProgram("symbol",{config:Ho,defines:fn});let Yo,Jo=[0,0],No=null;const Qs=At.textSizeData;At.iconsInText&&(Jo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],No=It.imageAtlasTexture?It.imageAtlasTexture:null,Yo=et||!ye.isOrthographic||p.options.rotating||p.options.zooming||Qs.kind==="composite"||Qs.kind==="camera"?xe.LINEAR:xe.NEAREST);const ya=It.glyphAtlasTexture?It.glyphAtlasTexture.size:[0,0],ks=c.layout.get("text-size-scale-range"),Ci=i.aA(p.scaleFactor,ks[0],ks[1]),zi=i.bK(Qs,ye.zoom,Ci),Xn=as(zt,It.tileID.canonical,et,$e,ye,At.getProjection(),Gt),Vi=xh(zt,It.tileID.canonical,et,$e,ye,At.getProjection(),Gt),Ai=p.translatePosMatrix(Vi,It,O,F,!0),xi=p.translatePosMatrix(zt,It,O,F),_a=$r?zh:Xn,Yh=$e&&!et&&!Cn;let za=Rt;!Ye&&!ye.mercatorFromTransition||$e||(za=kl(ye));const Jh=Wp(Qs.kind,zi,Yh,et,p,xi,_a,Ai,Pe,!0,ya,Jo,0,Vt,Jt,ke,Qr,tr?za:Rt,At.getProjection(),Kn,wn,null,null,Ci),Id=It.glyphAtlasTexture?It.glyphAtlasTexture:null,ul=xe.LINEAR,Vl=c.paint.get("text-halo-width").constantOr(1)!==0,Md=p.terrain&&et&&Cn?i.bl(i.bC(),Xn):zh;if(Cn&&At.text){const Lc=i.bV.getAtTileOffsetFunc(Vt,ye.center.lat,ye.worldSize,At.getProjection()),Ul=mp(zt,It.tileID.canonical,et,$e,ye,At.getProjection(),Gt);Ex(At,zt,p,!0,Ul,Vi,et,ae,Lc,Vt,Ci)}return{program:no,buffers:At.text,uniformValues:Jh,atlasTexture:Id,atlasTextureIcon:No,atlasInterpolation:ul,atlasInterpolationIcon:Yo,isSDF:!0,hasHalo:Vl,depthMode:ws,tile:It,renderWithShadows:vi,labelPlaneMatrixInv:Md}},jn=At.icon.segments.get().length,_n=At.text.segments.get().length,Br=jn&&!T.onlyText?Pn():null,An=_n&&!T.onlyIcons?Bn():null,Ti=c.paint.get("icon-opacity").constantOr(1),pi=c.paint.get("text-opacity").constantOr(1);if(tt&&At.canOverlap){dt=!0;const Cn=Ti&&!T.onlyText?At.icon.segments.get():[],fn=pi&&!T.onlyIcons?At.text.segments.get():[];for(const $r of Cn)gt.push({segments:new i.bg([$r]),sortKey:$r.sortKey,state:Br});for(const $r of fn)gt.push({segments:new i.bg([$r]),sortKey:$r.sortKey,state:An})}else T.onlyText||gt.push({segments:Ti?At.icon.segments:new i.bg([]),sortKey:0,state:Br}),T.onlyIcons||gt.push({segments:pi?At.text.segments:new i.bg([]),sortKey:0,state:An})}dt&&gt.sort((Vt,It)=>Vt.sortKey-It.sortKey);for(const Vt of gt){const It=Vt.state;if(It)if(p.terrain?p.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:It.labelPlaneMatrixInv}):p.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,It.program),Ae.activeTexture.set(xe.TEXTURE0),It.atlasTexture&&It.atlasTexture.bind(It.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),It.atlasTextureIcon&&(Ae.activeTexture.set(xe.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),It.renderWithShadows&&p.shadowRenderer.setupShadows(It.tile.tileID.toUnwrapped(),It.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,It.program),It.hasHalo){const At=It.uniformValues;At.u_is_halo=1,u_(It.buffers,Vt.segments,c,p,It.program,It.depthMode,v,w,At,2),At.u_is_halo=0}else{if(It.isSDF){const At=It.uniformValues;It.hasHalo&&(At.u_is_halo=1,u_(It.buffers,Vt.segments,c,p,It.program,It.depthMode,v,w,At,1)),At.u_is_halo=0}u_(It.buffers,Vt.segments,c,p,It.program,It.depthMode,v,w,It.uniformValues,1)}}}function u_(p,s,c,m,v,w,T,P,O,D){const F=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];v.draw(m,m.context.gl.TRIANGLES,w,T,P,wr.disabled,O,c.id,p.layoutVertexBuffer,p.indexBuffer,s,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),F,D)}function nb(p,s){const c=1<<p.canonical.z,m=(s.x*c-p.canonical.x-p.wrap*c)*i.al,v=(s.y*c-p.canonical.y)*i.al,w=i.e8(s.z,s.y);return i.d5(m,v,w)}function Zp(p,s,c,m,v){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const w=p.context.gl,T=new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D),P=new ir(p.context.gl.GREATER,ir.ReadWrite,p.depthRangeFor3D),O=function(q){let ee=.01;return q.isOrthographic&&(ee=i.ak(1e-4,ee,i.d0(q.pitch>=ja?1:q.pitch/ja))),2*ee}(p.transform),D=p.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",W=p.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),H=p.getOrCreateProgram(F);for(const q of m){const ee=s.getTile(q),Y=ee.getBucket(c);if(!Y)continue;const ae=Y.elevatedStructures;if(!ae)continue;const oe=Y.elevationBufferData.heightRange,de=nb(q.toUnwrapped(),D),me=p.translatePosMatrix(q.projMatrix,ee,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let fe,Pe,be,Ae;if(v==="initialize"){if(!oe||oe.min>=1||ae.depthSegments.segments[0].primitiveLength===0)continue;fe=_u(me,de,O,1,0),Pe=T,be=ae.depthSegments,Ae=W}else if(v==="reset"){if(!oe||oe.min>=0||ae.maskSegments.segments[0].primitiveLength===0)continue;fe=_u(me,de,0,0,1),Pe=P,be=ae.maskSegments,Ae=W}else if(v==="geometry"){if(ae.depthSegments.segments[0].primitiveLength===0)continue;fe=_u(me,de,O,1,0),Pe=T,be=ae.depthSegments,Ae=H}Ae.draw(p,w.TRIANGLES,Pe,Ar.disabled,Nr.disabled,wr.disabled,fe,c.id,ae.vertexBuffer,ae.indexBuffer,be,c.paint,p.transform.zoom)}}function Kp(p,s,c,m){const{painter:v,sourceCache:w,layer:T,coords:P,colorMode:O,elevationType:D,terrainEnabled:F,pass:W}=p,H=v.context.gl,q=T.paint.get("fill-pattern"),ee=T.paint.get("fill-pattern-cross-fade"),Y=q.constantOr(null);let ae=D;D!=="road"||s&&!F||(ae="none");const oe=ae==="road",de=p.painter.shadowRenderer,me=oe&&!!de&&de.enabled,fe=new ir(v.context.gl.LEQUAL,ir.ReadOnly,v.depthRangeFor3D);let Pe=[0,0,0];if(me){const ye=v.style.directionalLight,Ce=v.style.ambientLight;ye&&Ce&&(Pe=Ol(v.style,ye,Ce))}const be=q&&q.constantOr(1),Ae=v.terrain&&v.terrain.renderingToTexture,xe=(ye,Ce)=>{let $e,Ne,et,tt,dt;Ce?($e=be&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",et=H.LINES):($e=be?"fillPattern":"fill",et=H.TRIANGLES);for(const Tt of P){const Ze=w.getTile(Tt);if(be&&!Ze.patternsLoaded())continue;const ke=Ze.getBucket(T);if(!ke)continue;const st=s?ke.elevationBufferData:ke.bufferData;if(st.isEmpty())continue;v.prepareDrawTile();const Ye=st.programConfigurations.get(T.id),gt=v.isTileAffectedByFog(Tt),Rt=[],Vt=[];oe&&(Rt.push("ELEVATED_ROADS"),Vt.push(st.elevatedLayoutVertexBuffer)),me&&Rt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ae&&c&&Rt.push("USE_MRT1"),be&&(v.context.activeTexture.set(H.TEXTURE0),Ze.imageAtlasTexture&&Ze.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ye.updatePaintBuffers());let It=!1;if(Y&&Ze.imageAtlas){const Gt=Ze.imageAtlas,hr=i.e3.from(Y),Or=hr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Qr=hr.getSecondary(),wn=Gt.patternPositions.get(Or),rr=Qr?Gt.patternPositions.get(Qr.scaleSelf(i.o.devicePixelRatio).toString()):null;It=!!wn&&!!rr,wn&&Ye.setConstantPatternPositions(wn,rr)}ee>0&&(It||Ye.getPatternTransitionVertexBuffer("fill-pattern"))&&Rt.push("FILL_PATTERN_TRANSITION");const At=v.getOrCreateProgram($e,{config:Ye,overrideFog:gt,defines:Rt}),tr=v.translatePosMatrix(Tt.projMatrix,Ze,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor"));me&&de.setupShadows(Ze.tileID.toUnwrapped(),At,"vector-tile");const Jt=T.paint.get("fill-emissive-strength");if(Ce){tt=st.lineIndexBuffer,dt=st.lineSegments;const Gt=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];Ne=$e==="fillOutlinePattern"&&be?s_(tr,Jt,v,Ze,Gt,Pe,ee):qx(tr,Jt,Gt,Pe)}else tt=st.indexBuffer,dt=st.triangleSegments,Ne=be?o_(tr,Jt,v,Ze,Pe,ee):i_(tr,Jt,Pe);v.uploadCommonUniforms(v.context,At,Tt.toUnwrapped());let zt=ye;(D==="road"&&!F||D==="offset")&&(zt=fe),At.draw(v,et,zt,m||v.stencilModeForClipping(Tt),O,wr.disabled,Ne,T.id,st.layoutVertexBuffer,tt,dt,T.paint,v.transform.zoom,Ye,Vt)}};v.renderPass===W&&xe(v.depthModeForSublayer(1,v.renderPass==="opaque"?ir.ReadWrite:ir.ReadOnly),!1),ae==="none"&&v.renderPass==="translucent"&&T.paint.get("fill-antialias")&&xe(v.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,ir.ReadOnly),!0)}function Xp(p,s,c,m,v,w,T,P){c.resetLayerRenderingStats(p);const O=p.context,D=O.gl,F=p.transform,W=c.paint.get("fill-extrusion-pattern"),H=c.paint.get("fill-extrusion-pattern-cross-fade"),q=W.constantOr(null),ee=W.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),ae=p.style.enable3dLights(),oe=c.paint.get(ae&&!ee?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),de=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],me=c.layout.get("fill-extrusion-edge-radius"),fe=me>0&&!c.paint.get("fill-extrusion-rounded-roof"),Pe=fe?0:me,be=F.projection.name==="globe"?i.eb():0,Ae=F.projection.name==="globe",xe=Ae?i.aj(F.zoom):0,ye=[i.aF(F.center.lng),i.aJ(F.center.lat)],Ce=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",$e=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ce?null:c.lut).toArray01().slice(0,3),Ne=c.paint.get("fill-extrusion-flood-light-intensity"),et=c.paint.get("fill-extrusion-vertical-scale"),tt=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,dt=c.paint.get("fill-extrusion-height-alignment"),Tt=c.paint.get("fill-extrusion-base-alignment"),Ze=wc(p,c.paint.get("fill-extrusion-cutoff-fade-range")),ke=[];let st;Ae&&ke.push("PROJECTION_GLOBE_VIEW"),de[0]>0&&ke.push("FAUX_AO"),fe&&ke.push("ZERO_ROOF_RADIUS"),P&&ke.push("HAS_CENTROID"),Ne>0&&ke.push("FLOOD_LIGHT"),Ze.shouldRenderCutoff&&ke.push("RENDER_CUTOFF"),tt&&ke.push("RENDER_WALL_MODE");const Ye=p.renderPass==="shadow",gt=p.shadowRenderer,Rt=Ye&&!!gt,Vt=Ye?wr.disabled:wr.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let It=[0,0,0];if(gt){const Jt=p.style.directionalLight,zt=p.style.ambientLight;Jt&&zt&&(It=Ol(p.style,Jt,zt)),Ye||(ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&ke.push("NORMAL_OFFSET")),st=ke.concat(["SHADOWS_SINGLE_CASCADE"])}const At=Rt?"fillExtrusionDepth":ee?"fillExtrusionPattern":"fillExtrusion",tr=c.getLayerRenderingStats();for(const Jt of m){const zt=s.getTile(Jt),Gt=zt.getBucket(c);if(!Gt||Gt.projection.name!==F.projection.name)continue;let hr=!1;gt&&(hr=gt.getMaxCascadeForTile(Jt.toUnwrapped())===0);const Or=p.isTileAffectedByFog(Jt),Qr=Gt.programConfigurations.get(c.id);let wn=!1;if(q&&zt.imageAtlas){const _n=zt.imageAtlas,Br=i.e3.from(q),An=Br.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Ti=Br.getSecondary(),pi=_n.patternPositions.get(An),Cn=Ti?_n.patternPositions.get(Ti.scaleSelf(i.o.devicePixelRatio).toString()):null;wn=!!pi&&!!Cn,pi&&Qr.setConstantPatternPositions(pi,Cn)}H>0&&(wn||Qr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ke.push("FILL_EXTRUSION_PATTERN_TRANSITION");const rr=p.getOrCreateProgram(At,{config:Qr,defines:hr?st:ke,overrideFog:Or});if(p.terrain&&p.terrain.setupElevationDraw(zt,rr,{useMeterToDem:!0}),!Gt.centroidVertexBuffer){const _n=rr.getAttributeLocation(D,"a_centroid_pos");_n!==-1&&D.vertexAttrib2f(_n,0,0)}!Ye&&gt&&gt.setupShadows(zt.tileID.toUnwrapped(),rr,"vector-tile"),ee&&(p.context.activeTexture.set(D.TEXTURE0),zt.imageAtlasTexture&&zt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Qr.updatePaintBuffers());const vn=c.paint.get("fill-extrusion-vertical-gradient"),Mr=1/Gt.tileToMeter;let Pn;if(Ye&&gt){if(Dl(zt.tileID,Gt.maxHeight,p))continue;const _n=gt.calculateShadowPassMatrixFromTile(zt.tileID.toUnwrapped());Pn=n_(_n,Pe,Mr,et,dt,Tt)}else{const _n=p.translatePosMatrix(Jt.expandedProjMatrix,zt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Br=F.projection.createInversionMatrix(F,Jt.canonical);Pn=ee?Wx(_n,p,vn,Y,de,Pe,Mr,Jt,zt,be,dt,Tt,xe,ye,Br,$e,et,H):Vp(_n,p,vn,Y,de,Pe,Mr,Jt,be,dt,Tt,xe,ye,Br,$e,et,Ne,It)}p.uploadCommonUniforms(O,rr,Jt.toUnwrapped(),null,Ze);let Bn=Gt.segments;if(F.projection.name==="mercator"&&!Ye&&(Bn=Gt.getVisibleSegments(zt.tileID,p.terrain,p.transform.getFrustum(0)),!Bn.get().length))continue;if(tr)if(Ye)for(const _n of Bn.get())tr.numRenderedVerticesInShadowPass+=_n.primitiveLength;else for(const _n of Bn.get())tr.numRenderedVerticesInTransparentPass+=_n.primitiveLength;const jn=[];(p.terrain||P)&&jn.push(Gt.centroidVertexBuffer),Ae&&jn.push(Gt.layoutVertexExtBuffer),tt&&jn.push(Gt.wallVertexBuffer),rr.draw(p,O.gl.TRIANGLES,v,w,T,Vt,Pn,c.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Bn,c.paint,p.transform.zoom,Qr,jn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class d_{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function jl(p,s,c,m,v,w,T,P,O,D,F,W,H,q,ee,Y,ae,oe,de,me){const fe=s.context,Pe=fe.gl,be=s.transform,Ae=s.transform.zoom,xe=[],ye=p.translate,Ce=p.translateAnchor,$e=p.edgeRadius,Ne=wc(s,p.cutoffFadeRange);F==="clear"?(xe.push("CLEAR_SUBPASS"),me&&(xe.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(Pe.TEXTURE0),me.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):F==="sdf"?xe.push("SDF_SUBPASS"):F==="emissive"&&(xe.push("USE_MRT1"),fe.activeTexture.set(Pe.TEXTURE0),me.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)),oe&&xe.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const et=(tt,dt,Tt,Ze,ke)=>{let st=xe;dt.groundRadiusBuffer!=null&&(st=xe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ye=dt.programConfigurations.get(m.id),gt=s.isTileAffectedByFog(tt),Rt=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ye,defines:st,overrideFog:gt}),Vt=_d(s,Ze,W,D,ke,[H,q*ke],ee,Y,ae,Ae>=17?0:$e*ke,me?me.size[0]:0),It=[];oe&&It.push(dt.hiddenByLandmarkVertexBuffer),dt.groundRadiusBuffer!=null&&It.push(dt.groundRadiusBuffer),s.uploadCommonUniforms(fe,Rt,tt.toUnwrapped(),null,Ne),Rt.draw(s,fe.gl.TRIANGLES,w,T,P,O,Vt,m.id,dt.vertexBuffer,dt.indexBuffer,Tt,m.paint,Ae,Ye,It)};for(const tt of v){const dt=c.getTile(tt),Tt=dt.getBucket(m);if(!Tt||Tt.projection.name!==be.projection.name||!Tt.groundEffect||Tt.groundEffect&&!Tt.groundEffect.hasData())continue;const Ze=Tt.groundEffect,ke=1/Tt.tileToMeter;{const st=s.translatePosMatrix(tt.projMatrix,dt,ye,Ce),Ye=Ze.getDefaultSegment();et(tt,Ze,Ye,st,ke)}if(de)for(let st=0;st<4;st++){const Ye=i.e9[st](tt),gt=c.getTile(Ye);if(!gt)continue;const Rt=gt.getBucket(m);if(!Rt||Rt.projection.name!==be.projection.name||!Rt.groundEffect||Rt.groundEffect&&!Rt.groundEffect.hasData())continue;const Vt=Rt.groundEffect;let It,At;st===0?(It=[-i.al,0,0],At=1):st===1?(It=[i.al,0,0],At=0):st===2?(It=[0,-i.al,0],At=3):(It=[0,i.al,0],At=2);const tr=Vt.regionSegments[At];if(!tr)continue;const Jt=new Float32Array(16);i.br(Jt,tt.projMatrix,It),et(tt,Vt,tr,s.translatePosMatrix(Jt,dt,ye,Ce),ke)}}}function N2(p,s,c,m,v,w,T){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const P=w?w.findDEMTileFor(c):null;if(!(P&&P.dem||T))return;w&&P&&P.dem&&m.selfDEMTileTimestamp!==P.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=P.dem._timestamp);const O=oe=>new i.P(Math.ceil((oe+i.ed)*i.ee),0),D=oe=>{const de=s.getSource().minzoom,me=Pe=>{const be=s.getTileByID(Pe);if(be&&be.hasData())return be.getBucket(v)},fe=[0,-1,1];for(const Pe of fe){if(oe.overscaledZ+Pe<de)continue;const be=me(oe.calculateScaledKey(oe.overscaledZ+Pe));if(be)return be}},F=[0,0,0],W=(oe,de)=>(F[0]=Math.min(oe.min.y,de.min.y),F[1]=Math.max(oe.max.y,de.max.y),F[2]=i.al-de.min.x>oe.max.x?de.min.x-i.al:oe.max.x,F),H=(oe,de)=>(F[0]=Math.min(oe.min.x,de.min.x),F[1]=Math.max(oe.max.x,de.max.x),F[2]=i.al-de.min.y>oe.max.y?de.min.y-i.al:oe.max.y,F),q=[(oe,de)=>W(oe,de),(oe,de)=>W(de,oe),(oe,de)=>H(oe,de),(oe,de)=>H(de,oe)],ee=(oe,de,me,fe,Pe,be,Ae)=>{if(!w)return 0;const xe=[[be?me:oe,be?oe:me,0],[be?me:de,be?de:me,0]],ye=Ae<0?i.al+Ae:Ae,Ce=[be?ye:(oe+de)/2,be?(oe+de)/2:ye,0];return me===0&&Ae<0||me!==0&&Ae>0?w.getForTilePoints(Pe,[Ce],!0,fe):xe.push(Ce),w.getForTilePoints(c,xe,!0,P),Math.max(xe[0][2],xe[1][2],Ce[2])/w.exaggeration()};for(let oe=0;oe<4;oe++){const de=m.borderFeatureIndices[oe];if(de.length===0)continue;const me=i.e9[oe](c),fe=D(me);if(!(fe&&fe instanceof i.ea))continue;const Pe=w?w.findDEMTileFor(me):null;if(!(Pe&&Pe.dem||T)||(w&&Pe&&Pe.dem&&m.borderDEMTileTimestamp[oe]!==Pe.dem._timestamp&&(m.borderDoneWithNeighborZ[oe]=-1,m.borderDEMTileTimestamp[oe]=Pe.dem._timestamp),m.borderDoneWithNeighborZ[oe]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const be=(oe<2?1:5)-oe,Ae=fe.borderDoneWithNeighborZ[be]!==m.canonical.z,xe=fe.borderFeatureIndices[be];let ye=0;if(m.canonical.z!==fe.canonical.z){for(const Ce of de)m.showCentroid(m.featuresOnBorder[Ce]);if(Ae)for(const Ce of xe)fe.showCentroid(fe.featuresOnBorder[Ce]);m.borderDoneWithNeighborZ[oe]=fe.canonical.z,fe.borderDoneWithNeighborZ[be]=m.canonical.z}for(const Ce of de){const $e=m.featuresOnBorder[Ce],Ne=m.centroidData[$e.centroidDataIndex],et=$e.borders[oe];let tt;for(;ye<xe.length;){tt=fe.featuresOnBorder[xe[ye]];const dt=tt.borders[be];if(dt[1]>et[0]+3||dt[0]>et[0]-3)break;fe.showCentroid(tt),ye++}if(tt&&ye<xe.length){const dt=ye;let Tt=0;for(;!(tt.borders[be][0]>et[1]-3)&&(Tt++,++ye!==xe.length);)tt=fe.featuresOnBorder[xe[ye]];tt=fe.featuresOnBorder[xe[dt]];let Ze=!1;if(Tt>=1){const Ye=tt.borders[be];Math.abs(et[0]-Ye[0])<3&&Math.abs(et[1]-Ye[1])<3&&(Tt=1,Ze=!0,ye=dt+1)}else if(Tt===0){m.showCentroid($e);continue}const ke=fe.centroidData[tt.centroidDataIndex];T&&Ze&&(((Y=Ne).flags|(ae=ke).flags)&i.ec?(Y.flags|=i.ec,ae.flags|=i.ec):(Y.flags&=~i.ec,ae.flags&=~i.ec));const st=$e.intersectsCount()>1||tt.intersectsCount()>1;if(Tt>1)ye=dt,Ne.centroidXY=ke.centroidXY=new i.P(0,0);else if(Pe&&Pe.dem&&!st){const Ye=q[oe](Ne,ke),gt=oe%2?i.al-1:0,Rt=ee(Ye[0],Math.min(i.al-1,Ye[1]),gt,Pe,me,oe<2,Ye[2]);Ne.centroidXY=ke.centroidXY=O(Rt)}else st?Ne.centroidXY=ke.centroidXY=new i.P(0,0):(Ne.centroidXY=m.encodeBorderCentroid($e),ke.centroidXY=fe.encodeBorderCentroid(tt));m.writeCentroidToBuffer(Ne),fe.writeCentroidToBuffer(ke)}else m.showCentroid($e)}m.borderDoneWithNeighborZ[oe]=fe.canonical.z,fe.borderDoneWithNeighborZ[be]=m.canonical.z}var Y,ae;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const $s=[1,0,0],h_=[0,1,0],xs=[0,0,1];function Dl(p,s,c){const m=c.transform,v=c.shadowRenderer;if(!v)return!0;const w=p.toUnwrapped(),T=m.tileSize*v._cascades[c.currentShadowCascade].scale;let P=s;if(m.elevation){const Y=m.elevation.getMinMaxForTile(p);Y&&(P+=Y.max)}const O=[...v.shadowDirection];O[2]=-O[2];const D=v.computeSimplifiedTileShadowVolume(w,P,T,O);if(!D)return!1;const F=[$s,h_,xs,O,[O[0],0,O[2]],[0,O[1],O[2]]],W=m.projection.name==="globe",H=m.scaleZoom(T),q=i.cB.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,H,!W),ee=v.getCurrentCascadeFrustum();return q.intersectsPrecise(D.vertices,D.planes,F)===0||ee.intersectsPrecise(D.vertices,D.planes,F)===0}function Bh(p){const{painter:s,source:c,layer:m,coords:v}=p;let w=p.defines;const T=s.context,P=s.renderPass==="shadow",O=s.renderPass==="light-beam",D=s.shadowRenderer,F=i.ef(s.transform.center.lat,s.transform.zoom),W=wc(s,m.paint.get("building-cutoff-fade-range"));W.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF")),p.floodLightIntensity>0&&(w=w.concat("FLOOD_LIGHT"));for(const H of v){const q=c.getTile(H),ee=q.getBucket(m);if(!ee)continue;D&&D.getMaxCascadeForTile(H.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const Y=ee.programConfigurations.get(m.id);let ae,oe,de,me=s.translatePosMatrix(H.expandedProjMatrix,q,[0,0],"map");if(me=i.cS(i.bC(),me,[1,1,p.verticalScale]),P&&D){if(Dl(q.tileID,ee.maxHeight*F,s))continue;let Pe=D.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());Pe=i.cS(i.bC(),Pe,[1,1,p.verticalScale]),de=Ic(Pe),ae=oe=s.getOrCreateProgram("buildingDepth",{config:Y,defines:w,overrideFog:!1})}else if(O)ae=oe=s.getOrCreateProgram("buildingBloom",{config:Y,defines:w,overrideFog:!1}),de=Zx(me);else{const Pe=s.transform.calculatePosMatrix(H.toUnwrapped(),s.transform.worldSize);i.cS(Pe,Pe,[1,1,p.verticalScale]);const be=i.bC();i.cS(be,Pe,[1,-1,1/F]),i.bl(be,be),i.eg(be,be);const Ae=s.transform.getFreeCameraOptions().position,xe=1<<H.canonical.z;if(de=Up(me,be,p.opacity,p.facadeAOIntensity,[((Ae.x-H.wrap)*xe-H.canonical.x)*i.al,(Ae.y*xe-H.canonical.y)*i.al,Ae.z*xe*i.al],ee.tileToMeter,p.facadeEmissiveChance,p.floodLightColor,p.floodLightIntensity),oe=s.getOrCreateProgram("building",{config:Y,defines:w,overrideFog:!1}),p.depthOnly===!0)ae=oe;else{const ye=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ae=s.getOrCreateProgram("building",{config:Y,defines:ye,overrideFog:!1})}D&&(D.setupShadowsFromMatrix(Pe,oe,!0),ae!==oe&&D.setupShadowsFromMatrix(Pe,ae,!0))}const fe=(Pe,be)=>{if(O){const Ae=Pe.entranceBloom;be.draw(s,T.gl.TRIANGLES,p.depthMode,Ar.disabled,p.blendMode,wr.disabled,de,m.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segmentsBucket,m.paint,s.transform.zoom,Y,[Ae.layoutAttenuationBuffer,Ae.layoutColorBuffer])}else{const Ae=Pe.segmentsBucket;let xe=[Pe.layoutNormalBuffer,Pe.layoutCentroidBuffer,Pe.layoutColorBuffer,Pe.layoutFloodLightDataBuffer];Pe.layoutFacadePaintBuffer&&(xe=xe.concat([Pe.layoutFacadeDataBuffer,Pe.layoutFacadeVerticalRangeBuffer,Pe.layoutFacadePaintBuffer])),be.draw(s,T.gl.TRIANGLES,p.depthMode,Ar.disabled,p.blendMode,P?wr.disabled:wr.backCW,de,m.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Ae,m.paint,s.transform.zoom,Y,xe)}};s.uploadCommonUniforms(T,oe,H.toUnwrapped(),null,W),ee.buildingWithoutFacade&&fe(ee.buildingWithoutFacade,oe),ee.buildingWithFacade&&(ae!==oe&&s.uploadCommonUniforms(T,ae,H.toUnwrapped(),null,W),fe(ee.buildingWithFacade,ae))}}function Yp(p,s,c,m,v,w,T,P,O,D,F,W,H){const q=p.context.gl,ee=p.depthModeForSublayer(1,ir.ReadOnly,q.LEQUAL,!0),Y=.1*(1-(ae=F))+3*ae;var ae;const oe=p._showOverdrawInspector,de=W,me=new d_;oe||jl(me,p,s,c,m,ee,new Ar({func:q.ALWAYS,mask:255},255,255,q.KEEP,q.KEEP,q.REPLACE),new Nr([q.ONE,q.ONE,q.ONE,q.ONE],i.ao.transparent,[!1,!1,!1,!0],q.MIN),wr.disabled,v,"sdf",w,T,P,O,D,Y,de,!1);{const fe=oe?Ar.disabled:new Ar({func:q.EQUAL,mask:255},255,255,q.KEEP,q.DECR,q.DECR),Pe=oe?p.colorModeForRenderPass():new Nr([q.ONE_MINUS_DST_ALPHA,q.DST_ALPHA,q.ONE,q.ONE],i.ao.transparent,[!0,!0,!0,!0]);jl(me,p,s,c,m,ee,fe,Pe,wr.disabled,v,"color",w,T,P,O,D,Y,de,!1)}}function Jp(p){return[p[0]*i.eh,p[1]*i.eh,p[2]*i.eh,0]}function $h(p,s,c,m,v,w,T,P,O){const D=m.getSource(),F=c.globeSharedBuffers;if(!F)return;let W,H,q;if(s&&(W=m.getTile(s)),D instanceof i.aU?(H=D.texture,q=i.dK(0,0,c.transform)):W&&s&&(H=W.texture,q=i.dK(s.canonical.z,s.canonical.x,c.transform)),!H||!q)return;p||(q=i.cS(i.bC(),q,[1,-1,1]));const ee=c.context,Y=ee.gl,ae=v.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,oe=c.colorModeForDrapableLayerRenderPass(w),de=T.defines;de.push("GLOBE_POLES");const me=new ir(Y.LEQUAL,ir.ReadWrite,c.depthRangeFor3D),fe=Float32Array.from(c.transform.expandedFarZProjMatrix),Pe=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ee.activeTexture.set(Y.TEXTURE0),H.bind(ae,Y.CLAMP_TO_EDGE),ee.activeTexture.set(Y.TEXTURE1),H.bind(ae,Y.CLAMP_TO_EDGE),"useMipmap"in H&&ee.extTextureFilterAnisotropic&&c.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const[be,Ae,xe,ye]=s?F.getPoleBuffers(s.canonical.z,!1):F.getPoleBuffers(0,!0),Ce=v.paint.get("raster-elevation");let $e;p?($e=be,c.renderDefaultNorthPole=Ce!==0):($e=Ae,c.renderDefaultSouthPole=Ce!==0);const Ne=Jp(T.mix),et=((dt,Tt,Ze,ke,st,Ye,gt,Rt,Vt,It,At,tr,Jt)=>Yx(dt,Tt,Ze,new Float32Array(16),new Float32Array(9),[0,0],ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],Rt,2,It,At,tr,1,0,Jt))(fe,Pe,q,i.aj(c.transform.zoom),0,v,0,Ce,0,Ne,T.offset,T.range,w),tt=c.getOrCreateProgram("raster",{defines:de});c.uploadCommonUniforms(ee,tt,null),tt.draw(c,Y.TRIANGLES,me,O,oe,P,et,v.id,$e,xe,ye)}function ib(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,v=.2*p.height,w=s+v;return[s,c,(w-v-s)/m,(w-s)/m]}function Ll(p,s,c,m){if(p)return s instanceof ss&&p instanceof dp?s.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Jp(m.mix),offset:m.offset,buffer:0,tileSize:1}}var si=i.ei([{name:"a_index",type:"Int16",components:1}]);class Qp{constructor(s,c,m,v){const w={width:m[0],height:m[1],data:null},T=s.gl;this.targetColorTexture=new i.T(s,w,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,w,T.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(s,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,v=c.width*c.height;this.particleTexture0=new i.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,m.RGBA8,{premultiply:!1,useMipmap:!1});const w=new i.ej;w.reserve(v);for(let T=0;T<v;T++)w.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(w,si.members,!0),this.particleSegment=i.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function f_(p,s,c){if(!p)return null;const m=s.getTextureDescriptor(p,c,!0);if(!m)return null;let{texture:v,mix:w,offset:T,tileSize:P,buffer:O,format:D}=m;if(!v||!D)return null;let F=!1;return D==="uint32"&&(F=!0,w[3]=0,w=Gp(i.ek,w,[0,c.paint.get("raster-particle-max-speed")]),T=Hp(i.ek,T,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[O/(P+2*O),P/(P+2*O)],tileSize:P,scalarData:F,scale:w,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function ob(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,v=.2*p.height,w=s+v;return[s,c,(w-v-s)/m,(w-s)/m]}const sb=new i.ao(1,0,0,1),ab=new i.ao(0,1,0,1),lb=new i.ao(0,0,1,1),bu=new i.ao(1,0,1,1),wu=new i.ao(0,1,1,1);function Ct(p,s,c,m,v,w){for(let T=0;T<c.length;T++)if(v){const D=new i.ao(m.r*.8,m.g*.8,m.b*.8,1);kt(p,s,c[T],m,-1,-1,w),kt(p,s,c[T],m,-1,1,w),kt(p,s,c[T],m,1,1,w),kt(p,s,c[T],m,1,-1,w),kt(p,s,c[T],D,0,0,w)}else kt(p,s,c[T],m,0,0,w)}function kt(p,s,c,m,v,w,T){const P=p.context,O=p.transform,D=P.gl,F=O.projection.name==="globe",W=F?["PROJECTION_GLOBE_VIEW"]:[];let H=i.bz(c.projMatrix);if(F&&i.aj(O.zoom)>0){const Ne=i.bj(c.canonical,O),et=i.el(Ne);H=i.aB(new Float32Array(16),O.globeMatrix,et),i.aB(H,O.projMatrix,H)}const q=i.bC();q[12]+=2*v/(i.o.devicePixelRatio*O.width),q[13]+=2*w/(i.o.devicePixelRatio*O.height),i.aB(H,q,H);const ee=p.getOrCreateProgram("debug",{defines:W}),Y=s.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(Y,ee);const ae=ir.disabled,oe=Ar.disabled,de=p.colorModeForRenderPass(),me="$debug";P.activeTexture.set(D.TEXTURE0),p.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),F?Y._makeGlobeTileDebugBuffers(p.context,O):Y._makeDebugTileBoundsBuffers(p.context,O.projection);const fe=Y._tileDebugBuffer||p.debugBuffer,Pe=Y._tileDebugIndexBuffer||p.debugIndexBuffer,be=Y._tileDebugSegments||p.debugSegments;if(ee.draw(p,D.LINE_STRIP,ae,oe,de,wr.disabled,Lh(H,m.toPremultipliedRenderColor(null)),me,fe,Pe,be,null,null,null,[Y._globeTileDebugBorderBuffer]),T){const Ne=Y.latestRawTileData,et=Math.floor((Ne&&Ne.byteLength||0)/1024);let tt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(tt+=` => ${c.overscaledZ}`),tt+=` ${Y.state}`,tt+=` ${et}kb`,function(dt,Tt){dt.initDebugOverlayCanvas();const Ze=dt.debugOverlayCanvas,ke=dt.context.gl,st=dt.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Ze.width,Ze.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Tt,5,5),st.strokeText(Tt,5,5),dt.debugOverlayTexture.update(Ze),dt.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(p,tt)}const Ae=s.getTile(c).tileSize,xe=512/Math.min(Ae,512)*(c.overscaledZ/O.zoom)*.5,ye=Y._tileDebugTextBuffer||p.debugBuffer,Ce=Y._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,$e=Y._tileDebugTextSegments||p.debugSegments;ee.draw(p,D.TRIANGLES,ae,oe,Nr.alphaBlended,wr.disabled,Lh(H,i.ao.transparent.toPremultipliedRenderColor(null),xe),me,ye,Ce,$e,null,null,null,[Y._globeTileDebugTextBuffer])}function Su(p,s,c,m){He(p,0,s+c/2,p.transform.width,c,m)}function Pi(p,s,c,m){He(p,s-c/2,0,c,p.transform.height,m)}function He(p,s,c,m,v,w){const T=p.context,P=T.gl;P.enable(P.SCISSOR_TEST),P.scissor(s*i.o.devicePixelRatio,c*i.o.devicePixelRatio,m*i.o.devicePixelRatio,v*i.o.devicePixelRatio),T.clear({color:w}),P.disable(P.SCISSOR_TEST)}const cb=i.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:em}=cb;function sl(p,s,c,m){p.emplaceBack(s,c,m)}class tm{constructor(s){this.vertexArray=new i.em,this.indices=new i.b0,sl(this.vertexArray,-1,-1,1),sl(this.vertexArray,1,-1,1),sl(this.vertexArray,-1,1,1),sl(this.vertexArray,1,1,1),sl(this.vertexArray,-1,-1,-1),sl(this.vertexArray,1,-1,-1),sl(this.vertexArray,-1,1,-1),sl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,em),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.bg.simpleSegment(0,0,36,12)}}function Tu(p,s,c,m,v,w){const T=p.context.gl,P=s.paint.get("sky-atmosphere-color"),O=s.paint.get("sky-atmosphere-halo-color"),D=s.paint.get("sky-atmosphere-sun-intensity"),F=((W,H,q,ee,Y)=>({u_matrix_3f:W,u_sun_direction:H,u_sun_intensity:q,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(i.eo(i.dO(),m),v,D,P.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,s.skyboxTexture,0),c.draw(p,T.TRIANGLES,ir.disabled,Ar.disabled,Nr.unblended,wr.frontCW,F,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const ub=i.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bd{constructor(s){const c=new i.ep;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new i.b0;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,ub.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=i.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const z2=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class F2{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class db{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Nr([1,rl,1,rl],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Nr([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new F2,this.updateNeeded=!0}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new bd(c);const m=this.params.sizeRange,v=this.params.intensityRange,w=function(F){const W=i.eq(30),H=[];for(let q=0;q<F;++q){const ee=2*Math.PI*W(),Y=Math.acos(1-2*W())-.5*Math.PI;H.push(i.d5(Math.cos(Y)*Math.cos(ee),Math.cos(Y)*Math.sin(ee),Math.sin(Y)))}return H}(this.params.starsCount),T=i.eq(300),P=new i.er,O=new i.b0;let D=0;for(let F=0;F<w.length;++F){const W=i.c5([],w[F],200),H=Math.max(0,1+.01*m*(1*T()-.5)),q=Math.max(0,1+.01*v*(1*T()-.5));P.emplaceBack(W[0],W[1],W[2],-1,-1,H,q),P.emplaceBack(W[0],W[1],W[2],1,-1,H,q),P.emplaceBack(W[0],W[1],W[2],1,1,H,q),P.emplaceBack(W[0],W[1],W[2],-1,1,H,q),O.emplaceBack(D+0,D+1,D+2),O.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=c.createVertexBuffer(P,z2.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=i.bg.simpleSegment(0,0,P.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const m=s.context,v=m.gl,w=s.transform,T=new ir(v.LEQUAL,ir.ReadOnly,[0,1]),P=i.aj(w.zoom),O=s.style.getLut(c.scope),D=c.properties.get("color-use-theme")==="none",F=c.properties.get("color").toNonPremultipliedRenderColor(D?null:O),W=c.properties.get("high-color-use-theme")==="none",H=c.properties.get("high-color").toNonPremultipliedRenderColor(W?null:O),q=c.properties.get("space-color-use-theme")==="none",ee=c.properties.get("space-color").toNonPremultipliedRenderColor(q?null:O),Y=5e-4,ae=i.es(c.properties.get("horizon-blend"),0,1,Y,.25),oe=i.dE(s,m,w)&&ae===Y?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,de=s.frameCounter/1e3%1,me=i.ag(w.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(me,2)-Math.pow(oe,2)),Pe=Math.acos(fe/me),be=Ae=>{const xe=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ae&&xe.push("ALPHA_PASS");const ye=s.getOrCreateProgram("globeAtmosphere",{defines:xe}),Ce=((Ne,et,tt,dt,Tt,Ze,ke,st,Ye,gt,Rt,Vt)=>({u_frustum_tl:Ne,u_frustum_tr:et,u_frustum_br:tt,u_frustum_bl:dt,u_horizon:Tt,u_transition:Ze,u_fadeout_range:ke,u_atmosphere_fog_color:st.toArray01(),u_high_color:Ye.toArray01(),u_space_color:gt.toArray01(),u_temporal_offset:Rt,u_horizon_angle:Vt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,P,ae,F,H,ee,de,Pe);s.uploadCommonUniforms(m,ye);const $e=this.atmosphereBuffer;$e&&ye.draw(s,v.TRIANGLES,T,Ar.disabled,Ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,wr.backCW,Ce,Ae?"atmosphere_glow_alpha":"atmosphere_glow",$e.vertexBuffer,$e.indexBuffer,$e.segments)};be(!1),be(!0)}drawStars(s,c){const m=i.aA(c.properties.get("star-intensity"),0,1);if(m===0)return;const v=s.context,w=v.gl,T=s.transform,P=s.getOrCreateProgram("stars"),O=i.c7([]);i.c9(O,O,-T._pitch),i.c8(O,O,-T.angle),i.c9(O,O,i.an(T._center.lat)),i.et(O,O,-i.an(T._center.lng));const D=i.cc(new Float32Array(16),O),F=i.aB([],T.starsProjMatrix,D),W=i.eo([],D),H=i.eu([],W),q=[0,1,0];i.dQ(q,q,H),i.c5(q,q,this.params.sizeMultiplier);const ee=[1,0,0];i.dQ(ee,ee,H),i.c5(ee,ee,this.params.sizeMultiplier);const Y=(ae=q,oe=ee,de=m,{u_matrix:Float32Array.from(F),u_up:ae,u_right:oe,u_intensity_multiplier:de});var ae,oe,de;s.uploadCommonUniforms(v,P),this.starsVx&&this.starsIdx&&P.draw(s,w.TRIANGLES,ir.disabled,Ar.disabled,this.colorModeAlphaBlendedWriteRGB,wr.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class rm{constructor(){this.visibleTiles=[]}updateBorders(s,c){const m=[],v=[],w=s._getRenderableCoordinates(!1,!0);for(const O of w){const D=s.getTile(O);if(!D.hasData())continue;const F=D.getBucket(c);F&&(F.isEmpty()||(m.push(O.key),v.push({bucket:F,tileID:O.canonical})))}let T=m.length!==this.visibleTiles.length;if(!T){m.sort();for(let O=0;O<m.length;O++)if(m[O]!==this.visibleTiles[O]){T=!0;break}}if(!T)return;const P=new Set;this.visibleTiles=m,v.sort((O,D)=>O.tileID.z-D.tileID.z||O.tileID.x-D.tileID.x||O.tileID.y-D.tileID.y);for(const O of v){const D=new Array,F=new Array,W=O.bucket;for(const H of W.featuresOnBorder)P.has(H.featureId)?F.push(H.footprintIndex):(P.add(H.featureId),D.push(H.footprintIndex));W.updateFootprintHiddenFlags(D,i.ev,!1),W.updateFootprintHiddenFlags(F,i.ev,!0)}}}function nm(p,s){const c=[...p],m=s.cameraWorldSizeForFog/s.worldSize,v=i.bA([]);return i.cS(v,v,[m,m,1]),i.aB(c,v,c),i.aB(c,s.worldToFogMatrix,c),c}function im(p,s,c,m,v){const w=c.material,T=m.context,{baseColorTexture:P,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:F,emissionTexture:W}=w;function H(ee,Y,ae){if(ee&&(p.push(Y),T.activeTexture.set(T.gl.TEXTURE0+ae),ee.gfxTexture)){const{minFilter:oe,magFilter:de,wrapS:me,wrapT:fe}=ee.sampler;ee.gfxTexture.bindExtraParam(oe,de,me,fe)}}H(P,"HAS_TEXTURE_u_baseColorTexture",Oo.BaseColor),H(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Oo.MetallicRoughness),H(D,"HAS_TEXTURE_u_normalTexture",Oo.Normal),H(F,"HAS_TEXTURE_u_occlusionTexture",Oo.Occlusion),H(W,"HAS_TEXTURE_u_emissionTexture",Oo.Emission),v&&(v.texture||(v.texture=new i.d$(m.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Oo.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED");const q=m.shadowRenderer;q&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&p.push("NORMAL_OFFSET"))}function om(p,s,c,m,v,w){const T=p.modelOpacity,P=s.context,O=new ir(s.context.gl.LEQUAL,p.isLightMesh?ir.ReadOnly:ir.ReadWrite,s.depthRangeFor3D),D=s.transform,F=p.mesh,W=F.material,H=W.pbrMetallicRoughness,q=s.style.fog;let ee;ee=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:i.aB([],m.zScaleMatrix,p.nodeModelMatrix),i.aB(ee,m.negCameraPosMatrix,ee);const Y=i.bl([],ee);i.eg(Y,Y);const ae=c.paint.get("model-color-use-theme").constantOr("default")==="none",oe=c.paint.get("model-emissive-strength").constantOr(0),de=vu(new Float32Array(p.worldViewProjection),new Float32Array(ee),new Float32Array(Y),null,s,T,H.baseColorFactor,W.emissiveFactor,H.metallicFactor,H.roughnessFactor,W,oe,c,void 0,void 0,p.materialOverride,p.modelColor),me={defines:[]},fe=[],Pe=s.shadowRenderer;Pe&&(Pe.useNormalOffset=!1),im(me.defines,fe,F,s,ae?null:c.lut);let be=null;if(q){const ye=nm(p.nodeModelMatrix,s.transform);if(be=new Float32Array(ye),D.projection.name!=="globe"){const Ce=F.aabb.min,$e=F.aabb.max,[Ne,et]=q.getOpacityForBounds(ye,Ce[0],Ce[1],$e[0],$e[1]);me.overrideFog=Ne>=ht||et>=ht}}const Ae=wc(s,c.paint.get("model-cutoff-fade-range"));Ae.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const xe=s.getOrCreateProgram("model",me);s.uploadCommonUniforms(P,xe,null,be,Ae),s.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(p.nodeModelMatrix,xe),xe.draw(s,P.gl.TRIANGLES,O,v,w,F.material.doubleSided?wr.disabled:wr.backCCW,de,c.id,F.vertexBuffer,F.indexBuffer,F.segments,c.paint,s.transform.zoom,void 0,fe)}function Vh(p,s){return p.style._importedAsBasemap?"basemap":s.scope}function Au(p,s,c,m,v,w,T,P,O,D){const F=p.transform,W=!!s.isGeometryBloom&&s.isGeometryBloom;if(W&&p.renderPass==="shadow")return;const H=F.projection.name==="globe"?i.eD(c,F):[...c];i.aB(H,H,s.globalMatrix);const q=i.aB([],m,H);if(s.meshes)for(const ee of s.meshes){const Y=P.get(ee.material.name);if(Y&&Y.opacity<=0)continue;if(ee.material.alphaMode!=="BLEND"){T.push({mesh:ee,depth:0,modelIndex:v,worldViewProjection:q,nodeModelMatrix:H,isLightMesh:W,materialOverride:Y,modelOpacity:O,modelColor:D});continue}const ae=i.af([],ee.centroid,q);!F.isOrthographic&&ae[2]<=0||w.push({mesh:ee,depth:ae[2],modelIndex:v,worldViewProjection:q,nodeModelMatrix:H,isLightMesh:W,materialOverride:Y,modelOpacity:O,modelColor:D})}if(s.children)for(const ee of s.children)Au(p,ee,c,m,v,w,T,P,O,D)}function La(p,s,c,m){const v=c.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),P=v.calculateShadowPassMatrixFromMatrix(s),O=l_(P);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,Ar.disabled,T,wr.disabled,O,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,c.transform.zoom,void 0,void 0)}function hb(p,s,c,m,v,w){for(const T of v){const P=Object.assign({},m);P.part=T;const O={type:"Unknown",id:s,properties:P},D={orientation:p.paint.get("model-rotation").evaluate(O,c)};w.set(T,D)}}function fb(p,s,c,m,v,w){for(const T of v){const P=Object.assign({},m);P.part=T;const O={type:"Unknown",id:s,properties:P},D={color:p.paint.get("model-color").evaluate(O,c),colorMix:p.paint.get("model-color-mix-intensity").evaluate(O,c),opacity:p.paint.get("model-opacity").evaluate(O,c),emissionStrength:p.paint.get("model-emissive-strength").evaluate(O,c)};w.set(T,D)}}function pb(p,s,c,m,v){let w=!1;for(const P of m)P.modelOpacity!==1&&(om(P,p,s,v[P.modelIndex],Ar.disabled,Nr.disabled),w=!0);for(const P of m)om(P,p,s,v[P.modelIndex],P.modelOpacity!==1?p.stencilModeFor3D():Ar.disabled,p.colorModeForRenderPass());w&&p.resetStencilClippingMasks();const T=Nr.additive;for(const P of c)om(P,p,s,v[P.modelIndex],Ar.disabled,P.isLightMesh?T:p.colorModeForRenderPass())}function mb(p,s,c){const m=s.updateZoomBasedPaintProperties(),v=function(w,T,P){let O,D,F,W=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&W>0){const H=w.terrain,q=H.findDEMTileFor(P);q&&q.dem?O=i.eF.create(H,P,q):W=0}if(W===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),W===T.validForExaggeration&&(W===0||O&&O._demTile&&O._demTile.tileID===T.validForDEMTile.id&&O._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const H in T.instancesPerModel){const q=T.instancesPerModel[H];for(let ee=0;ee<q.instancedDataArray.length;++ee){const Y=(O?W*O.getElevationAt(0|q.instancedDataArray.float32[16*ee],0|q.instancedDataArray.float32[16*ee+1],!0,!0):0)+q.instancesEvaluatedElevation[ee];q.instancedDataArray.float32[16*ee+6]=Y,D=D?Math.min(T.terrainElevationMin,Y):Y,F=F?Math.max(T.terrainElevationMax,Y):Y}}return T.terrainElevationMin=D||0,T.terrainElevationMax=F||0,T.validForExaggeration=W,T.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,c);(m||v)&&(s.uploaded=!1,s.upload(p.context))}const al={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d9([0,0,0],[i.al,i.al,0])};function bs(p,s){const c=1<<p.canonical.z,m=s.getFreeCameraOptions().position,v=s.elevation,w=p.canonical.x/c,T=(p.canonical.x+1)/c,P=p.canonical.y/c,O=(p.canonical.y+1)/c;let D=s._centerAltitude;if(v){const q=v.getMinMaxForTile(p);q&&q.max>D&&(D=q.max)}const F=i.aA(m.x,w,T)-m.x,W=i.aA(m.y,P,O)-m.y,H=i.cf(D,s.center.lat)-m.z;return s._zoomFromMercatorZ(Math.sqrt(F*F+W*W+H*H))}function gb(p,s,c,m,v,w,T){const P=p.context,O=p.renderPass==="shadow",D=p.shadowRenderer,F=O&&D?D.getShadowPassDepthMode():new ir(P.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D),W=p.isTileAffectedByFog(w),H=p.transform.projection.name==="globe";if(c.meshes)for(const q of c.meshes){const ee=H?[]:["MODEL_POSITION_ON_GPU"],Y=[];let ae,oe,de;const me=!H&&m.instancedDataArray.length>20;me&&ee.push("INSTANCED_ARRAYS");const fe=wc(p,s.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&ee.push("RENDER_CUTOFF"),O&&D)ae=p.getOrCreateProgram("modelDepth",{defines:ee}),oe=l_(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(c.globalMatrix)),de=D.getShadowPassColorMode();else{im(ee,Y,q,p,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),ae=p.getOrCreateProgram("model",{defines:ee,overrideFog:W});const be=q.material,Ae=be.pbrMetallicRoughness,xe=s.paint.get("model-opacity").constantOr(1),ye=s.paint.get("model-emissive-strength").constantOr(0);oe=vu(w.expandedProjMatrix,Float32Array.from(c.globalMatrix),new Float32Array(16),null,p,xe,Ae.baseColorFactor,be.emissiveFactor,Ae.metallicFactor,Ae.roughnessFactor,be,ye,s,v),D&&(T.shadowUniformsInitialized?ae.setShadowUniformValues(P,D.getShadowUniformValues()):(D.setupShadows(w.toUnwrapped(),ae,"model-tile"),T.shadowUniformsInitialized=!0)),de=fe.shouldRenderCutoff||xe<1||be.alphaMode!=="OPAQUE"?Nr.alphaBlended:Nr.unblended}p.uploadCommonUniforms(P,ae,w.toUnwrapped(),null,fe);const Pe=q.material.doubleSided?wr.disabled:wr.backCCW;if(me)Y.push(m.instancedDataBuffer),ae.draw(p,P.gl.TRIANGLES,F,Ar.disabled,de,Pe,oe,s.id,q.vertexBuffer,q.indexBuffer,q.segments,s.paint,p.transform.zoom,void 0,Y,m.instancedDataArray.length);else{const be=O?"u_instance":"u_normal_matrix";for(let Ae=0;Ae<m.instancedDataArray.length;++Ae)oe[be]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Ae,16),ae.draw(p,P.gl.TRIANGLES,F,Ar.disabled,de,Pe,oe,s.id,q.vertexBuffer,q.indexBuffer,q.segments,s.paint,p.transform.zoom,void 0,Y)}}if(c.children)for(const q of c.children)gb(p,s,q,m,v,w,T)}const Uh=[1,-1,1];function B2(p,s,c,m){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,T=s.aabb;let P=!0,O=p.maxHeight;if(O===0){let F=0;for(const W in p.instancesPerModel){const H=v.getModel(W,m);H?F=Math.max(F,Math.max(Math.max(H.aabb.max[0],H.aabb.max[1]),H.aabb.max[2])):P=!1}O=p.maxScale*F*1.41+p.maxVerticalOffset,P&&(p.maxHeight=O)}T.max[2]=O,T.min[2]+=p.terrainElevationMin,T.max[2]+=p.terrainElevationMax,i.af(T.min,T.min,s.tileMatrix),i.af(T.max,T.max,s.tileMatrix);const D=T.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=D===2),D===0}function fi(p,s){const c=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return m===c||w===v?1:i.aA(((s-c)/(m-c)-v)/(w-v),0,1)}function Kr(p,s,c,m){if(s.pitch<20)return 1;const v=s.getWorldToCameraMatrix();i.aB(v,v,p);const w=i.bU(c.min[0],c.min[1],c.min[2],1);let T=i.aC(i.eG(),w,v),P=T,O=T;w[1]=c.max[1],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O,w[0]=c.max[0],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O,w[1]=c.min[1],T=i.aC(i.eG(),w,v),P=T[1]<P[1]?T:P,O=T[1]>O[1]?T:O;const D=i.aA(m[0],0,1),F=100*s.pixelsPerMeter*i.aA(m[1],0,1),W=i.aA(m[2],0,1),H=i.eH(i.eG(),P,O,D),q=Math.tan(.5*s.fovX),ee=-H[2]*q;if(F===0)return H[1]<-Math.abs(ee)?W:1;const Y=(-Math.abs(ee)-H[1])/F,ae=(de,me,fe)=>(1-fe)*de+fe*me,oe=i.aA(ae(1,W,Y),W,1);return ae(1,oe,i.aA((s.pitch-20)/20,0,1))}class yb{}class Rc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,m){{const W=this._storage.get(c.id);if(W)return W.lastUsedFrameIdx=s,W.buf}const v=m.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(w),P=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const O=new i.eJ;for(let W=0;W<w/2;W+=3){const H=P[W],q=P[W+1],ee=P[W+2];O.emplaceBack(H,q),O.emplaceBack(q,ee),O.emplaceBack(ee,H)}const D=m.bindVertexArrayOES.current,F=new yb;return F.buf=new Da(m,O),F.lastUsedFrameIdx=s,this._storage.set(c.id,F),m.bindVertexArrayOES.set(D),F.buf}update(s){for(const[c,m]of this._storage)s-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class wd{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Sd=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Nl{constructor(s){this.revealStart=11,this.revealRange=2}}const p_=i.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class m_{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,c){const m=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new i.eK,P=new i.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(T,p_.members),this.vignetteIdx=s.context.createIndexBuffer(P)}const v=i.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,m);const T={u_vignetteShape:(w={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};m.draw(s,s.context.gl.TRIANGLES,ir.disabled,Ar.disabled,Nr.alphaBlended,wr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v)}var w}}class g_{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,c){const m=s.getFreeCameraOptions().position,v=m.toAltitude(),w=m.toLngLat(),T=i.an(w.lng),P=i.an(w.lat),O=s.pixelsPerMeter/c,D=T*i.eM,F=i.eM*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const W=-this._offsetYPrev+F,H=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*O,this._accumulatedOffsetY+=W*O,this._accumulatedElevation+=H*O,this._offsetXPrev=D,this._offsetYPrev=F,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function sm(p,s){return[-(p[0]-Math.floor(p[0]/s)*s),-(p[1]-Math.floor(p[1]/s)*s),-(p[2]-Math.floor(p[2]/s)*s)]}function Ys(p){const s=i.eq(1323123451230),c=[];for(let m=0;m<p;++m){const v=2*s()-1,w=2*s()-1,T=2*s()-1;c.push(i.d5(v,w,T))}return c}function Os(p,s,c,m,v){const w=i.aA((v-c)/(m-c),0,1);return(1-w)*p+w*s}class Eu{constructor(s){this._movement=new g_,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new m_,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,c){const m=s.transform;this._movement.update(m,this._ppmScaleFactor);const v=m.starsProjMatrix,w=i.c7([]);i.c9(w,w,i.an(90)-m._pitch),i.c8(w,w,-m.angle);const T=i.cc(new Float32Array(16),w),P=i.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=i.eg([],P),D=i.aB([],O,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*c,this._prevTime=F,{projectionMatrix:v,modelviewMatrix:D}}}class am extends Eu{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Nl("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const m=Ys(this.particlesCount),v=new i.eN,w=new i.b0;let T=0;const P=i.eq(1323123451230);for(let O=0;O<m.length;++O){const D=m[O],F=[2*P()-1,P(),P(),P()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...F),v.emplaceBack(D[0],D[1],D[2],1,-1,...F),v.emplaceBack(D[0],D[1],D[2],1,1,...F),v.emplaceBack(D[0],D[1],D[2],-1,1,...F),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(v,Sd.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=s.transform.zoom;if(c.revealStart>m)return;const v=Os(0,1,c.revealStart,c.revealStart+c.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let T=[-w.direction.x,w.direction.y,-100];i.aw(T,T);const P=structuredClone(this._vignetteParams);P.strength*=v,w.overrideStyleParameters||(w.intensity=s.style.rain.state.density,w.timeFactor=s.style.rain.state.intensity,w.color=structuredClone(s.style.rain.state.color),T=structuredClone(s.style.rain.state.direction),w.screenThinning.intensity=s.style.rain.state.centerThinning,w.dropletSizeX=s.style.rain.state.dropletSize[0],w.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],w.distortionStrength=100*s.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(s.style.rain.state.vignetteColor));const O=this.updateOnRender(s,w.timeFactor),D=s.context,F=D.gl,W=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new i.T(D,{width:s.width,height:s.height,data:null},F.RGBA8)),w.distortionStrength>0&&(D.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const H=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(D,H),D.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const q=[w.color.r,w.color.g,w.color.b,w.color.a],ee=(Y,ae)=>{const oe=sm(this._movement.getPosition(),Y),de=w.dropletSizeX,me=w.dropletSizeX*w.dropletSizeYScale,fe=s.width/2,Pe=s.height/2,be=Os(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Ae=Os(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),xe=Os(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),ye=(Ce={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:Y,rainDropletSize:[de,me],distortionStrength:w.distortionStrength,rainDirection:T,color:q,screenSize:[W.width,W.height],thinningCenterPos:[fe,Pe],thinningShape:[be,Ae,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:xe,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:ae?0:1},{u_modelview:Float32Array.from(Ce.modelview),u_projection:Float32Array.from(Ce.projection),u_time:Ce.time,u_cam_pos:Ce.camPos,u_texScreen:0,u_velocityConeAperture:Ce.velocityConeAperture,u_velocity:Ce.velocity,u_boxSize:Ce.boxSize,u_rainDropletSize:Ce.rainDropletSize,u_distortionStrength:Ce.distortionStrength,u_rainDirection:Ce.rainDirection,u_color:Ce.color,u_screenSize:Ce.screenSize,u_thinningCenterPos:Ce.thinningCenterPos,u_thinningShape:Ce.thinningShape,u_thinningAffectedRatio:Ce.thinningAffectedRatio,u_thinningParticleOffset:Ce.thinningParticleOffset,u_shapeDirectionalPower:Ce.shapeDirectionalPower,u_shapeNormalPower:Ce.shapeNormalPower,u_mode:Ce.mode});var Ce;const $e=Math.round(w.intensity*this.particlesCount),Ne=i.bg.simpleSegment(0,0,4*$e,2*$e);H.draw(s,F.TRIANGLES,ir.disabled,Ar.disabled,Nr.alphaBlended,wr.disabled,ye,"rain_particles",this.particlesVx,this.particlesIdx,Ne)};w.distortionStrength>0&&ee(w.boxSize,!0),ee(w.boxSize,!1),this._vignette.draw(s,P)}}const y_=i.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class __ extends Eu{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Nl("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const c=s.context;if(!this.particlesVx){const m=Ys(this.particlesCount),v=new i.eO,w=new i.b0;let T=0;const P=i.eq(1323123451230);for(let O=0;O<m.length;++O){const D=m[O],F=P(),W=P(),H=P(),q=[O/m.length,F,W,H],ee=[P(),P()];v.emplaceBack(D[0],D[1],D[2],-1,-1,...q,...ee),v.emplaceBack(D[0],D[1],D[2],1,-1,...q,...ee),v.emplaceBack(D[0],D[1],D[2],1,1,...q,...ee),v.emplaceBack(D[0],D[1],D[2],-1,1,...q,...ee),w.emplaceBack(T+0,T+1,T+2),w.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=c.createVertexBuffer(v,y_.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const c=structuredClone(this._params);let m=[-c.direction.x,c.direction.y,-100];i.aw(m,m);const v=structuredClone(this._vignetteParams),w=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=s.transform.zoom;if(w.revealStart>T)return;const P=Os(0,1,w.revealStart,w.revealStart+w.revealRange,T);v.strength*=P,c.overrideStyleParameters||(c.intensity=s.style.snow.state.density,c.timeFactor=s.style.snow.state.intensity,c.color=structuredClone(s.style.snow.state.color),m=structuredClone(s.style.snow.state.direction),c.screenThinning.intensity=s.style.snow.state.centerThinning,c.billboardSize=2.79*s.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(s.style.snow.state.vignetteColor));const O=this.updateOnRender(s,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=s.context,F=D.gl,W=s.transform,H=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(D,H),((q,ee,Y)=>{const ae=sm(this._movement.getPosition(),q),oe=W.width/2,de=W.height/2,me=Os(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),fe=Os(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Pe=Os(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),be=(Ae={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:q,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[W.width,W.height],thinningCenterPos:[oe,de],thinningShape:[me,fe,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Pe,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:m},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_horizontalOscillationRadius:Ae.horizontalOscillationRadius,u_horizontalOscillationRate:Ae.horizontalOscillationRate,u_boxSize:Ae.boxSize,u_billboardSize:Ae.billboardSize,u_simpleShapeParameters:Ae.simpleShapeParameters,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_particleColor:Ae.color,u_direction:Ae.direction});var Ae;const xe=Math.round(Y.intensity*this.particlesCount),ye=i.bg.simpleSegment(0,0,4*xe,2*xe);this.particlesVx&&this.particlesIdx&&H.draw(s,F.TRIANGLES,ir.disabled,Ar.disabled,Nr.alphaBlended,wr.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,ye)})(c.boxSize,0,c),this._vignette.draw(s,v)}}const kc={symbol:function(p,s,c,m,v){if(p.renderPass!=="translucent")return;const w=Ar.disabled,T=p.colorModeForRenderPass(),P=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),D=i.aA(p.scaleFactor,O[0],O[1]);P&&function(H,q,ee,Y,ae,oe,de,me){const fe=q.transform,Pe=ae==="map",be=oe==="map";for(const Ae of H){const xe=Y.getTile(Ae),ye=xe.getBucket(ee);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const Ce=i.bK(ye.textSizeData,fe.zoom,me),$e=el(Ae,ye.getProjection(),fe),Ne=fe.calculatePixelsToTileUnitsMatrix(xe),et=as($e,xe.tileID.canonical,be,Pe,fe,ye.getProjection(),Ne),tt=ye.hasIconTextFit()&&ye.hasIconData();Ce&&mr(ye,Pe,be,de,fe,et,Ae,Math.pow(2,fe.zoom-xe.tileID.overscaledZ),Ce,tt)}}(m,p,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v,D);const F=c.paint.get("icon-opacity").constantOr(1)!==0,W=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||W)?Fh(p,s,c,m,w,T):(F&&Fh(p,s,c,m,w,T,{onlyIcons:!0}),W&&Fh(p,s,c,m,w,T,{onlyText:!0})),s.map.showCollisionBoxes&&(Yt(p,s,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yt(p,s,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,c,m){if(p.renderPass!=="translucent")return;const v=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),P=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||T.constantOr(1)===0))return;const D=p.context,F=D.gl,W=p.transform,H=!(!p.terrain||!p.terrain.enabled),q=c.layout.get("circle-elevation-reference"),ee=p.depthModeForSublayer(0,ir.ReadOnly),Y=new ir(p.context.gl.LEQUAL,ir.ReadOnly,p.depthRangeFor3D),ae=q==="none"||H?ee:Y,oe=Ar.disabled,de=p.colorModeForDrapableLayerRenderPass(O),me=W.projection.name==="globe",fe=[i.aF(W.center.lng),i.aJ(W.center.lat)],Pe=[];for(let Ae=0;Ae<m.length;Ae++){const xe=m[Ae],ye=s.getTile(xe),Ce=ye.getBucket(c);if(!Ce||Ce.projection.name!==W.projection.name)continue;const $e=Ce.programConfigurations.get(c.id),Ne=Ce.layoutVertexBuffer,et=Ce.globeExtVertexBuffer,tt=Ce.indexBuffer,dt=i.e0(c),Tt=[et],Ze=p.isTileAffectedByFog(xe);me&&dt.push("PROJECTION_GLOBE_VIEW"),dt.push("DEPTH_D24"),p.terrain&&W.depthOcclusionForSymbolsAndCircles&&dt.push("DEPTH_OCCLUSION"),Ce.hasElevation&&!p.terrain&&(dt.push("ELEVATED_ROADS"),Tt.push(Ce.elevatedLayoutVertexBuffer));const ke=p.getOrCreateProgram("circle",{config:$e,defines:dt,overrideFog:Ze}),st=W.projection.createInversionMatrix(W,xe.canonical),Ye={programConfiguration:$e,program:ke,layoutVertexBuffer:Ne,dynamicBuffers:Tt,indexBuffer:tt,uniformValues:i.e1(p,xe,ye,st,fe,c),tile:ye};if(P){const gt=Ce.segments.get();for(const Rt of gt)Pe.push({segments:new i.bg([Rt]),sortKey:Rt.sortKey,state:Ye})}else Pe.push({segments:Ce.segments,sortKey:0,state:Ye})}P&&Pe.sort((Ae,xe)=>Ae.sortKey-xe.sortKey);const be={useDepthForOcclusion:W.depthOcclusionForSymbolsAndCircles};for(const Ae of Pe){const{programConfiguration:xe,program:ye,layoutVertexBuffer:Ce,dynamicBuffers:$e,indexBuffer:Ne,uniformValues:et,tile:tt}=Ae.state,dt=Ae.segments;p.terrain&&p.terrain.setupElevationDraw(tt,ye,be),p.uploadCommonUniforms(D,ye,tt.tileID.toUnwrapped()),ye.draw(p,F.TRIANGLES,ae,oe,de,wr.disabled,et,c.id,Ce,Ne,dt,c.paint,W.zoom,xe,$e)}},heatmap:function(p,s,c,m){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,w=v.gl,T=Ar.disabled,P=new Nr([w.ONE,w.ONE,w.ONE,w.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(q,ee,Y,ae){const oe=q.gl,de=ee.width*ae,me=ee.height*ae;q.activeTexture.set(oe.TEXTURE1),q.viewport.set([0,0,de,me]);let fe=Y.heatmapFbo;if(!fe||fe&&(fe.width!==de||fe.height!==me)){fe&&fe.destroy();const Pe=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,Pe),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),fe=Y.heatmapFbo=q.createFramebuffer(de,me,1,null),function(be,Ae,xe,ye,Ce,$e){const Ne=be.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,Ce,$e,0,Ne.RGBA,be.extRenderToTextureHalfFloat?Ne.HALF_FLOAT:Ne.UNSIGNED_BYTE,null),ye.colorAttachment0.set(xe)}(q,0,Pe,fe,de,me)}else oe.bindTexture(oe.TEXTURE_2D,fe.colorAttachment0.get()),q.bindFramebuffer.set(fe.framebuffer)})(v,p,c,p.transform.projection.name==="globe"?.5:.25),v.clear({color:i.ao.transparent});const O=p.transform,D=O.projection.name==="globe",F=D?["PROJECTION_GLOBE_VIEW"]:[],W=D?wr.frontCCW:wr.disabled,H=[i.aF(O.center.lng),i.aJ(O.center.lat)];for(let q=0;q<m.length;q++){const ee=m[q];if(s.hasRenderableParent(ee))continue;const Y=s.getTile(ee),ae=Y.getBucket(c);if(!ae||ae.projection.name!==O.projection.name)continue;const oe=p.isTileAffectedByFog(ee),de=ae.programConfigurations.get(c.id),me=p.getOrCreateProgram("heatmap",{config:de,defines:F,overrideFog:oe}),{zoom:fe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(Y,me),p.uploadCommonUniforms(v,me,ee.toUnwrapped());const Pe=O.projection.createInversionMatrix(O,ee.canonical);me.draw(p,w.TRIANGLES,ir.disabled,T,P,W,Xx(p,ee,Y,Pe,H,fe,c.paint.get("heatmap-intensity")),c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,c.paint,p.transform.zoom,de,D?[ae.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,w){const T=v.context,P=T.gl,O=w.heatmapFbo;if(!O)return;T.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment0.get()),T.activeTexture.set(P.TEXTURE1);let D=w.colorRampTexture;D||(D=w.colorRampTexture=new i.T(T,w.colorRamp,P.RGBA8)),D.bind(P.LINEAR,P.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,P.TRIANGLES,ir.disabled,Ar.disabled,v.colorModeForRenderPass(),wr.disabled,((F,W,H,q)=>({u_image:0,u_color_ramp:1,u_opacity:W.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(p,c))},line:function(p,s,c,m){if(p.renderPass!=="translucent")return;const v=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const T=c.paint.get("line-emissive-strength").isConstant(),P=c.paint.get("line-emissive-strength").constantOr(0),O=c.paint.get("line-occlusion-opacity"),D=c.layout.get("line-elevation-reference"),F=c.layout.get("line-width-unit")==="meters",W=D==="sea",H=!(!p.terrain||!p.terrain.enabled),q=p.context,ee=q.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const Y=c.layout.get("line-cross-slope"),ae=Y!==void 0,oe=Y<1,de=p.colorModeForDrapableLayerRenderPass(T?P:null),me=p.terrain&&p.terrain.renderingToTexture,fe=me?1:i.o.devicePixelRatio,Pe=c.paint.get("line-dasharray"),be=Pe.constantOr(1),Ae=c.layout.get("line-cap"),xe=Pe.constantOr(null),ye=Ae.constantOr(null),Ce=c.paint.get("line-pattern"),$e=Ce.constantOr(1),Ne=c.paint.get("line-pattern-cross-fade"),et=Ce.constantOr(null),tt=c.paint.get("line-opacity").constantOr(1);let dt=!$e&&tt!==1||p.depthOcclusion&&O>0&&O<1;const Tt=c.paint.get("line-gradient"),Ze=$e?"linePattern":"line",ke=i.e2(c);let st;if(me&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(dt=!1),O!==0&&p.depthOcclusion){const Vt=c.paint._values["line-opacity"];Vt&&Vt.value&&Vt.value.kind==="constant"?st=Vt.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&ke.push("VARIABLE_LINE_WIDTH"),me&&(p.emissiveMode!=="dual-source-blending"||T?p.emissiveMode==="mrt-fallback"&&ke.push("USE_MRT1"):ke.push("DUAL_SOURCE_BLENDING"));const Ye=(Vt,It,At,tr,Jt,zt)=>{for(const Gt of Vt){const hr=s.getTile(Gt);if($e&&!hr.patternsLoaded())continue;const Or=hr.getBucket(c);if(!Or||Or.elevationType!=="none"&&!Jt||Or.elevationType==="none"&&Jt)continue;p.prepareDrawTile();const Qr=[...It],wn=p.shadowRenderer,rr=Or.elevationType==="road"&&!!wn&&wn.enabled;let vn=[0,0,0];if(rr){const $r=p.style.directionalLight,ci=p.style.ambientLight;$r&&ci&&(vn=Ol(p.style,$r,ci)),Qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mr=Or.programConfigurations.get(c.id);let Pn=!1;if(et&&hr.imageAtlas){const $r=i.e3.from(et),ci=$r.getPrimary().scaleSelf(fe).toString(),ki=hr.imageAtlas.patternPositions.get(ci),vi=$r.getSecondary(),Kn=vi?hr.imageAtlas.patternPositions.get(vi.scaleSelf(fe).toString()):null;Pn=!!ki&&!!Kn,ki&&Mr.setConstantPatternPositions(ki,Kn)}Ne>0&&(Pn||Mr.getPatternTransitionVertexBuffer("line-pattern"))&&Qr.push("LINE_PATTERN_TRANSITION");const Bn=p.isTileAffectedByFog(Gt),jn=p.getOrCreateProgram(Ze,{config:Mr,defines:Qr,overrideFog:Bn});if(!$e&&xe&&ye&&hr.lineAtlas){const $r=hr.lineAtlas.getDash(xe,ye);$r&&Mr.setConstantPatternPositions($r)}rr&&wn.setupShadows(hr.tileID.toUnwrapped(),jn,"vector-tile");let[_n,Br]=c.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&_n!==Br&&(_n===0&&(_n-=1),Br===1&&(Br+=1));const An=me?Gt.projMatrix:null,Ti=F?1/Or.tileToMeter/i.ay(hr,1,p.transform.zoom):1,pi=F?1/Or.tileToMeter/i.ay(hr,1,Math.floor(p.transform.zoom)):1,Cn=$e?i.e4(p,hr,c,An,fe,Ti,pi,[_n,Br],vn,Ne):i.e5(p,hr,c,An,Or.lineClipsArray.length,fe,Ti,pi,[_n,Br],vn);if(Tt){const $r=Or.gradients[c.id];let ci=$r.texture;if(c.gradientVersion!==$r.version){let ki=256;if(c.stepInterpolant){const vi=s.getSource().maxzoom,Kn=Gt.canonical.z===vi?Math.ceil(1<<p.transform.maxZoom-Gt.canonical.z):1;ki=i.aA(i.e6(Or.maxLineLength/i.al*1024*Kn),256,q.maxTextureSize)}$r.gradient=i.e7({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ki,image:$r.gradient||void 0,clips:Or.lineClipsArray}),$r.texture?$r.texture.update($r.gradient):$r.texture=new i.T(q,$r.gradient,ee.RGBA8),$r.version=c.gradientVersion,ci=$r.texture}q.activeTexture.set(ee.TEXTURE1),ci.bind(c.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}be&&(q.activeTexture.set(ee.TEXTURE0),hr.lineAtlasTexture&&hr.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),Mr.updatePaintBuffers()),$e&&(q.activeTexture.set(ee.TEXTURE0),hr.imageAtlasTexture&&hr.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Mr.updatePaintBuffers()),Jt&&!W&&p.terrain.setupElevationDraw(hr,jn),p.uploadCommonUniforms(q,jn,Gt.toUnwrapped());const fn=$r=>{st!=null&&(st.value=tt*O),jn.draw(p,ee.TRIANGLES,At,$r,de,wr.disabled,Cn,c.id,Or.layoutVertexBuffer,Or.indexBuffer,Or.segments,c.paint,p.transform.zoom,Mr,[Or.layoutVertexBuffer2,Or.patternVertexBuffer,Or.zOffsetVertexBuffer]),st!=null&&(st.value=tt)};if(dt&&!Jt){const $r=p.stencilModeForClipping(Gt).ref;$r===0&&me&&q.clear({stencil:0});const ci={func:ee.EQUAL,mask:255};Cn.u_alpha_discard_threshold=.8,fn(new Ar(ci,$r,255,ee.KEEP,ee.KEEP,ee.INVERT)),Cn.u_alpha_discard_threshold=0,fn(new Ar(ci,$r,255,ee.KEEP,ee.KEEP,ee.KEEP))}else Cn.u_alpha_discard_threshold=dt&&Jt&&zt?.8:0,fn(Jt?tr:p.stencilModeForClipping(Gt))}};let gt=p.depthModeForSublayer(0,ir.ReadOnly);const Rt=new ir(p.depthOcclusion?ee.GREATER:ee.LEQUAL,ir.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){const Vt=!me&&p.terrain;O!==0&&Vt?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):Vt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Ye(m,ke,gt,Ar.disabled,!1,!0)}if(c.hasElevatedBuckets){D==="hd-road-markup"?H||(gt=Rt,ke.push("ELEVATED_ROADS")):(ke.push("ELEVATED"),gt=Rt,ae&&ke.push(oe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),W&&ke.push("ELEVATION_REFERENCE_SEA"));const Vt=dt?p.stencilModeFor3D():Ar.disabled;p.forceTerrainMode=!0,Ye(m,ke,gt,Vt,!0,!0),dt&&Ye(m,ke,gt,Vt,!0,!1),p.forceTerrainMode=!1}dt&&(p.resetStencilClippingMasks(),me&&q.clear({stencil:0})),O===0||p.depthOcclusion||me||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,s,c,m){const v=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const T=c.paint.get("fill-emissive-strength"),P=p.colorModeForDrapableLayerRenderPass(T),O=c.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!O.constantOr(1)&&v.constantOr(i.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let F="none";c.layout.get("fill-elevation-reference")!=="none"?F="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const W=!(!p.terrain||!p.terrain.enabled),H={painter:p,sourceCache:s,layer:c,coords:m,colorMode:P,elevationType:F,terrainEnabled:W,pass:D};if(p.renderPass==="shadow")return void(p.shadowRenderer&&F==="road"&&!W&&function(ee){const{painter:Y,sourceCache:ae,layer:oe,coords:de}=ee,me=Y.context.gl,fe=ee.painter.shadowRenderer;for(const Pe of de){const be=ae.getTile(Pe),Ae=be.getBucket(oe);if(!Ae)continue;const xe=Ae.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ye=Ae.bufferData.programConfigurations.get(oe.id),Ce=Y.isTileAffectedByFog(Pe),$e=Y.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:Ce}),Ne=fe.calculateShadowPassMatrixFromTile(be.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,$e,Pe.toUnwrapped());const et={u_matrix:Ne,u_depth_bias:0};$e.draw(Y,me.TRIANGLES,fe.getShadowPassDepthMode(),Ar.disabled,fe.getShadowPassColorMode(),wr.disabled,et,oe.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,oe.paint,Y.transform.zoom,ye)}}(H));const q=p.emissiveMode==="mrt-fallback";if(F!=="offset"){if(Kp(H,!1,q),F==="road"){const ee=!W&&p.renderPass==="translucent";ee&&Zp(p,s,c,m,"geometry"),Kp(H,!0,q,Ar.disabled),ee&&function(Y){const{painter:ae,sourceCache:oe,layer:de,coords:me,colorMode:fe}=Y,Pe=ae.context.gl,be=Y.painter.shadowRenderer,Ae=!!be&&be.enabled,xe=new ir(ae.context.gl.LEQUAL,ir.ReadOnly,ae.depthRangeFor3D);let ye=[0,0,0];if(Ae){const $e=ae.style.directionalLight,Ne=ae.style.ambientLight;$e&&Ne&&(ye=Ol(ae.style,$e,Ne))}const Ce=$e=>{for(const Ne of me){const et=oe.getTile(Ne),tt=et.getBucket(de);if(!tt)continue;const dt=tt.elevatedStructures;if(!dt)continue;let Tt,Ze;if($e?(Tt=dt.renderableBridgeSegments,Ze=dt.bridgeProgramConfigurations.get(de.id)):(Tt=dt.renderableTunnelSegments,Ze=dt.tunnelProgramConfigurations.get(de.id)),!Tt||Tt.segments[0].primitiveLength===0)continue;Ze.updatePaintBuffers(),ae.prepareDrawTile();const ke=ae.isTileAffectedByFog(Ne),st=[];Ae&&st.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ye=ae.getOrCreateProgram("elevatedStructures",{config:Ze,overrideFog:ke,defines:st}),gt=ae.translatePosMatrix(Ne.projMatrix,et,de.paint.get("fill-translate"),de.paint.get("fill-translate-anchor"));Ae&&be.setupShadows(et.tileID.toUnwrapped(),Ye,"vector-tile");const Rt=Cc(gt,ye);ae.uploadCommonUniforms(ae.context,Ye,Ne.toUnwrapped()),Ye.draw(ae,Pe.TRIANGLES,xe,Ar.disabled,fe,wr.backCCW,Rt,de.id,dt.vertexBuffer,dt.indexBuffer,Tt,de.paint,ae.transform.zoom,Ze,[dt.vertexBufferNormal])}};Ce(!0),Ce(!1)}(H)}}else Kp(H,!1,q,p.stencilModeFor3D())},"fill-extrusion":function(p,s,c,m){const v=c.paint.get("fill-extrusion-opacity"),w=p.context,T=w.gl,P=p.terrain,O=P&&P.renderingToTexture;if(v===0)return;const D=p.emissiveMode==="mrt-fallback",F=p.conflationActive&&p.style.isLayerClipped(c,s.getSource()),W=p.style.order.indexOf(c.fqid);if(F&&function(H,q,ee,Y,ae){for(const oe of Y){const de=q.getTile(oe).getBucket(ee);de&&(de.updateReplacement(oe,H.replacementSource,ae),de.uploadCentroid(H.context))}}(p,s,c,m,W),P||F)for(const H of m){const q=s.getTile(H).getBucket(c);q&&N2(p.context,s,H,q,c,P,F)}if(p.renderPass==="shadow"&&p.shadowRenderer){const H=p.shadowRenderer;if(P&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const q=H.getShadowPassDepthMode(),ee=H.getShadowPassColorMode();Xp(p,s,c,m,q,Ar.disabled,ee,F)}else if(p.renderPass==="translucent"){const H=!c.paint.get("fill-extrusion-pattern").constantOr(1),q=c.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!O&&q.a!==0){const ee=new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D);v===1&&H?Xp(p,s,c,m,ee,Ar.disabled,Nr.unblended,F):(Xp(p,s,c,m,ee,Ar.disabled,Nr.disabled,F),Xp(p,s,c,m,ee,p.stencilModeFor3D(),p.colorModeForRenderPass(),F),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&H&&(!P&&p.transform.projection.name!=="globe"||O)){const ee=c.paint.get("fill-extrusion-opacity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=c.paint.get("fill-extrusion-flood-light-intensity"),de=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",me=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(de?null:c.lut).toArray01().slice(0,3),fe=Y>0&&ae>0,Pe=oe>0,be=(ye,Ce,$e)=>(1-$e)*ye+$e*Ce,Ae=new d_;Ae.translate=c.paint.get("fill-extrusion-translate"),Ae.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const xe=ye=>{const Ce=p.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!0),$e=c.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=be(.1,3,$e),et=p._showOverdrawInspector;if(!et){const tt=new Ar({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),dt=new Nr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);jl(Ae,p,s,c,m,Ce,tt,dt,wr.disabled,ye,"sdf",ee,Y,ae,oe,me,Ne,F,!1)}{const tt=et?Ar.disabled:new Ar({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),dt=et?p.colorModeForRenderPass():new Nr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],i.ao.transparent,[!0,!0,!0,!0]);jl(Ae,p,s,c,m,Ce,tt,dt,wr.disabled,ye,"color",ee,Y,ae,oe,me,Ne,F,!1)}};if(O){const ye=()=>{const $e=P.drapeBufferSize[0],Ne=P.drapeBufferSize[1];let et=P.framebufferCopyTexture;return et&&(!et||et.size[0]===$e&&et.size[1]===Ne)||(et&&et.destroy(),et=P.framebufferCopyTexture=new i.T(w,new i.q({width:$e,height:Ne}),T.RGBA8)),et.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,$e,Ne),et},Ce=($e,Ne,et)=>{const tt=p.depthModeForSublayer(1,ir.ReadOnly,T.LEQUAL,!1),dt=c.paint.get($e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Tt=be(.1,3,dt);{const Ze=new Nr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0]);jl(Ae,p,s,c,m,tt,Ar.disabled,Ze,wr.disabled,$e,"clear",ee,Y,ae,oe,me,Tt,F,Ne)}{const Ze=new Ar({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ke=new Nr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!1,!1,!1,!0],T.MIN);jl(Ae,p,s,c,m,tt,Ze,ke,wr.disabled,$e,"sdf",ee,Y,ae,oe,me,Tt,F,Ne)}D&&!$e&&(et=ye());{const Ze=$e?T.ZERO:T.ONE_MINUS_DST_ALPHA,ke=new Ar({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),st=new Nr([Ze,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],i.ao.transparent,[!0,!0,!0,!0]);jl(Ae,p,s,c,m,tt,ke,st,wr.disabled,$e,"color",ee,Y,ae,oe,me,Tt,F,Ne)}if(!D||$e){const Ze=new Nr([T.ONE,T.ONE,T.ONE,$e?T.ZERO:T.ONE],i.ao.transparent,[!1,!1,!1,!0],$e?T.FUNC_ADD:T.MAX);jl(Ae,p,s,c,m,tt,Ar.disabled,Ze,wr.disabled,$e,"clear",ee,Y,ae,oe,me,Tt,F,Ne,et)}else{T.drawBuffers([T.NONE,T.COLOR_ATTACHMENT1]);const Ze=new Ar({func:T.EQUAL,mask:255},254,255,T.KEEP,T.DECR,T.DECR),ke=new Nr([T.ONE,T.ONE,T.ONE,T.ONE],i.ao.transparent,[!0,!1,!1,!1],T.MAX);jl(Ae,p,s,c,m,tt,Ze,ke,wr.disabled,$e,"emissive",ee,Y,ae,oe,me,Tt,F,Ne,et),T.drawBuffers([T.COLOR_ATTACHMENT0])}};if(fe||Pe){let $e;p.prepareDrawTile(),D&&!fe||($e=ye()),fe&&Ce(!0,!1,$e),Pe&&Ce(!1,!0,$e)}}else fe&&xe(!0),Pe&&xe(!1),(fe||Pe)&&p.resetStencilClippingMasks()}}},building:function(p,s,c,m){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const v=c.paint.get("building-ambient-occlusion-ground-intensity"),w=c.paint.get("building-ambient-occlusion-ground-radius"),T=c.paint.get("building-ambient-occlusion-ground-attenuation"),P=c.paint.get("building-opacity");if(P<=0)return;let O=v>0&&w>0,D=!0;const F=c.paint.get("building-vertical-scale");if(F<=0)return;p.shadowRenderer||(D=!1);const W=p.conflationActive&&p.style.isLayerClipped(c,s.getSource()),H=p.style.order.indexOf(c.fqid);if(function(q,ee,Y,ae,oe,de){for(const me of de){const fe=ee.getTile(me).getBucket(Y);fe&&(oe&&fe.updateReplacement(me,q.replacementSource,ae),fe.uploadUpdatedIndexBuffer(q.context))}}(p,s,c,H,W,m),function(q,ee,Y,ae){for(const oe of ae){const de=ee.getTile(oe).getBucket(Y);de&&de.needsEvaluation()&&de.uploadUpdatedColorBuffer(q.context)}}(p,s,c,m),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const q=p.shadowRenderer,ee=[],Y=q.getShadowPassDepthMode();Bh({painter:p,source:s,layer:c,coords:m,defines:ee,blendMode:q.getShadowPassColorMode(),depthMode:Y,opacity:P,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(p.renderPass==="translucent"){let q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(q=q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer&&p.shadowRenderer.useNormalOffset&&(q=q.concat("NORMAL_OFFSET"));const ee=c.paint.get("building-facade-emissive-chance"),Y=c.paint.get("building-ambient-occlusion-intensity"),ae=c.paint.get("building-flood-light-intensity"),oe=c.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",de=c.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(oe?null:c.lut).toArray01().slice(0,3),me=c.paint.get("building-flood-light-ground-attenuation"),fe=ae>0,Pe=new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D);P<1&&Bh({painter:p,source:s,layer:c,coords:m,defines:q,blendMode:Nr.disabled,depthMode:Pe,opacity:P,verticalScale:F,facadeEmissiveChance:ee,facadeAOIntensity:Y,floodLightIntensity:ae,floodLightColor:de,depthOnly:!0});const be=p.colorModeForRenderPass();Bh({painter:p,source:s,layer:c,coords:m,defines:q,blendMode:be,depthMode:Pe,opacity:P,verticalScale:F,facadeEmissiveChance:ee,facadeAOIntensity:Y,floodLightIntensity:ae,floodLightColor:de}),O&&Yp(p,s,c,m,!0,P,v,w,ae,de,T,W),fe&&Yp(p,s,c,m,!1,P,v,w,ae,de,me,W)}else if(p.renderPass==="light-beam"){const q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],ee=new ir(p.context.gl.LEQUAL,ir.ReadOnly,p.depthRangeFor3D);Bh({painter:p,source:s,layer:c,coords:m,defines:q,blendMode:Nr.alphaBlended,depthMode:ee,opacity:P,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,s,c,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const v=p.context,w=p.terrain&&p.terrain.renderingToTexture,[T,P]=p.renderPass!=="translucent"||w?[{},m]:p.stencilConfigForOverlap(m);for(const O of P){const D=s.getTile(O);if(D.needsHillshadePrepare&&p.renderPass==="offscreen")P2(p,D,c);else if(p.renderPass==="translucent"){const F=p.depthModeForSublayer(0,ir.ReadOnly),W=c.paint.get("hillshade-emissive-strength"),H=p.colorModeForDrapableLayerRenderPass(W),q=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):T[O.overscaledZ];E2(p,O,D,c,F,q,H)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,c,m,v,w){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const T=p.transform.projection.name==="globe",P=c.paint.get("raster-elevation")!==0,O=P&&T;if(p.renderElevatedRasterBackface&&!O)return;const D=p.context,F=D.gl,W=s.getSource(),H=function(be,Ae,xe,ye,Ce){const $e=Ae.paint.get("raster-color"),Ne=be.type==="raster-array",et=[],tt=Ae.paint.get("raster-resampling"),dt=Ae.paint.get("raster-color-mix");let Tt=Ae.paint.get("raster-color-range");const Ze=[dt[0],dt[1],dt[2],0],ke=dt[3];let st=tt==="nearest"?ye.NEAREST:ye.LINEAR;if(Ne&&(et.push("RASTER_ARRAY"),$e||et.push("RASTER_COLOR"),tt==="linear"&&et.push("RASTER_ARRAY_LINEAR"),st=ye.NEAREST,!Tt&&be.rasterLayers)){const Ye=be.rasterLayers.find(({id:gt})=>gt===Ae.sourceLayer);Ye&&Ye.fields&&Ye.fields.range&&(Tt=Ye.fields.range)}if(Tt=Tt||[0,1],$e){et.push("RASTER_COLOR"),xe.activeTexture.set(ye.TEXTURE2),Ae.updateColorRamp(Tt);let Ye=Ae.colorRampTexture;Ye||(Ye=Ae.colorRampTexture=new i.T(xe,Ae.colorRamp,ye.RGBA8)),Ye.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}return Ce&&et.push("USE_MRT1"),{mix:Ze,range:Tt,offset:ke,defines:et,resampling:st}}(W,c,D,F,p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback");if(W instanceof i.aU&&!m.length&&!T)return;const q=c.paint.get("raster-emissive-strength"),ee=p.colorModeForDrapableLayerRenderPass(q),Y=p.terrain&&p.terrain.renderingToTexture,ae=!p.options.moving,oe=c.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(W instanceof i.aU&&!m.length&&(W.onNorthPole||W.onSouthPole)){const be=P?p.stencilModeFor3D():Ar.disabled;return void $h(!!W.onNorthPole,null,p,s,c,q,H,wr.disabled,be)}if(!m.length)return;const[de,me]=W instanceof i.aU||Y?[{},m]:p.stencilConfigForOverlap(m),fe=me[me.length-1].overscaledZ;O&&H.defines.push("PROJECTION_GLOBE_VIEW"),P&&H.defines.push("RENDER_CUTOFF");const Pe=(be,Ae,xe)=>{for(const ye of be){const Ce=ye.toUnwrapped(),$e=s.getTile(ye);if(Y&&(!$e||!$e.hasData()))continue;D.activeTexture.set(F.TEXTURE0);const Ne=Ll($e,W,c,H);if(!Ne||!Ne.texture)continue;const{texture:et,mix:tt,offset:dt,tileSize:Tt,buffer:Ze}=Ne;let ke,st;Y?(ke=ir.disabled,st=ye.projMatrix):P?(ke=new ir(F.LEQUAL,ir.ReadWrite,p.depthRangeFor3D),st=T?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Ce,ae)):(ke=p.depthModeForSublayer(ye.overscaledZ-fe,c.paint.get("raster-opacity")===1?ir.ReadWrite:ir.ReadOnly,F.LESS),st=p.transform.calculateProjMatrix(Ce,ae));const Ye=p.terrain&&Y?p.terrain.stencilModeForRTTOverlap(ye):de[ye.overscaledZ],gt=w?0:c.paint.get("raster-fade-duration");$e.registerFadeDuration(gt);const Rt=s.findLoadedParent(ye,0),Vt=Dh($e,Rt,s,p.transform,gt);let It,At;!Vt.isFading&&$e.refreshedUponExpiration&&($e.refreshedUponExpiration=!1),p.terrain&&p.terrain.prepareDrawTile(),D.activeTexture.set(F.TEXTURE0),et.bind(oe,F.CLAMP_TO_EDGE),D.activeTexture.set(F.TEXTURE1),Rt?(Rt.texture&&Rt.texture.bind(oe,F.CLAMP_TO_EDGE),It=Math.pow(2,Rt.tileID.overscaledZ-$e.tileID.overscaledZ),At=[$e.tileID.canonical.x*It%1,$e.tileID.canonical.y*It%1]):et.bind(oe,F.CLAMP_TO_EDGE),"useMipmap"in et&&D.extTextureFilterAnisotropic&&p.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const tr=p.transform;let Jt;const zt=P?ib(tr):[0,0,0,0];let Gt,hr,Or,Qr,wn,rr=0;if(O&&W instanceof i.aU&&W.coordinates.length>3)Gt=Float32Array.from(i.bk(i.dJ(new i.cD(0,0,0)))),hr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(i.dF(tr)),Qr=[i.aF(tr.center.lng),i.aJ(tr.center.lat)],Jt=W.elevatedGlobePerspectiveTransform,wn=W.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Bn=i.dG(ye.canonical);rr=i.dH(Bn.getCenter().lat),Gt=Float32Array.from(i.bk(i.dJ(ye.canonical))),hr=Float32Array.from(tr.globeMatrix),Or=Float32Array.from(i.dF(tr)),Qr=[i.aF(tr.center.lng),i.aJ(tr.center.lat)],Jt=[0,0],wn=Float32Array.from(i.dI(ye.canonical,Bn,rr,tr.worldSize/tr._pixelsPerMercatorPixel))}else Jt=W instanceof i.aU?W.perspectiveTransform:[0,0],Gt=new Float32Array(16),hr=new Float32Array(9),Or=new Float32Array(16),Qr=[0,0],wn=new Float32Array(9);const vn=Yx(st,Gt,hr,Or,wn,At||[0,0],i.aj(p.transform.zoom),Qr,zt,It||1,Vt,c,Jt,P?c.paint.get("raster-elevation"):0,2,tt,dt,H.range,Tt,Ze,q),Mr=p.isTileAffectedByFog(ye),Pn=p.getOrCreateProgram("raster",{defines:H.defines,overrideFog:Mr});if(p.uploadCommonUniforms(D,Pn,Ce),W instanceof i.aU){const Bn=W.elevatedGlobeVertexBuffer,jn=W.elevatedGlobeIndexBuffer;if(Y||!T)W.boundsBuffer&&W.boundsSegments&&Pn.draw(p,F.TRIANGLES,ke,Ar.disabled,ee,wr.disabled,vn,c.id,W.boundsBuffer,p.quadTriangleIndexBuffer,W.boundsSegments);else if(Bn&&jn){const _n=tr.zoom<=i.c_?W.elevatedGlobeSegments:W.getSegmentsForLongitude(tr.center.lng);_n&&Pn.draw(p,F.TRIANGLES,ke,Ar.disabled,ee,Ae,vn,c.id,Bn,jn,_n)}}else if(O){ke=new ir(F.LEQUAL,ir.ReadOnly,p.depthRangeFor3D);const Bn=p.globeSharedBuffers;if(Bn){const[jn,_n,Br]=Bn.getGridBuffers(rr,!1);Pn.draw(p,F.TRIANGLES,ke,xe||Ye,p.colorModeForRenderPass(),Ae,vn,c.id,jn,_n,Br)}}else{const{tileBoundsBuffer:Bn,tileBoundsIndexBuffer:jn,tileBoundsSegments:_n}=p.getTileBoundsBuffers($e);Pn.draw(p,F.TRIANGLES,ke,Ye,ee,wr.disabled,vn,c.id,Bn,jn,_n)}}if(!(W instanceof i.aU)&&O)for(const ye of be){const Ce=ye.canonical.y===(1<<ye.canonical.z)-1;ye.canonical.y===0&&$h(!0,ye,p,s,c,q,H,Ae,xe||Ar.disabled),Ce&&$h(!1,ye,p,s,c,q,H,Ae===wr.frontCW?wr.backCW:wr.frontCW,xe||Ar.disabled)}};O?Pe(me,p.renderElevatedRasterBackface?wr.backCW:wr.frontCW,p.stencilModeFor3D()):Pe(me,wr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,c,m,v,w){p.renderPass==="offscreen"&&function(T,P,O,D){if(!D.length)return;const F=T.context,W=F.gl,H=P.getSource();if(!(H instanceof ss))return;const q=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let ee=O.particlePositionRGBAImage;if(!ee||ee.width!==q){const me=function(fe){const Pe=fe*fe,be=new Uint8Array(4*Pe),Ae=function(ye){return ye|=0,ye=Math.imul(2747636419^ye,2654435769),ye=Math.imul(ye^ye>>>16,2654435769),((ye=Math.imul(ye^ye>>>16,2654435769))>>>0)/4294967296},xe=1/1.1;for(let ye=0;ye<Pe;ye++){const Ce=xe*(Ae(2*ye+0)+ol),$e=xe*(Ae(2*ye+1)+ol),Ne=255*Ce%1,et=255*$e%1,tt=Ne,dt=$e-et/255,Tt=et;be[4*ye+0]=255*(Ce-Ne/255),be[4*ye+1]=255*tt,be[4*ye+2]=255*dt,be[4*ye+3]=255*Tt}return be}(q);ee=O.particlePositionRGBAImage=new i.q({width:q,height:q},me)}let Y=O.particleFramebuffer;Y?Y.width!==q&&(Y.destroy(),Y=O.particleFramebuffer=F.createFramebuffer(q,q,1,null)):Y=O.particleFramebuffer=F.createFramebuffer(q,q,1,null);const ae=[];for(const me of D){const fe=P.getTile(me);if(!(fe instanceof dp))continue;const Pe=f_(fe,H,O);if(!Pe)continue;const be=[fe.tileSize,fe.tileSize];let Ae=O.tileFramebuffer;Ae||(Ae=O.tileFramebuffer=F.createFramebuffer(be[0],be[1],1,null));let xe=fe.rasterParticleState;xe||(xe=fe.rasterParticleState=new Qp(F,me,be,ee));const ye=xe.update(O.lastInvalidatedAt);xe.particleTextureDimension!==q&&xe.updateParticleTexture(me,ee);const Ce=xe.targetColorTexture;xe.targetColorTexture=xe.backgroundColorTexture,xe.backgroundColorTexture=Ce;const $e=xe.particleTexture0;xe.particleTexture0=xe.particleTexture1,xe.particleTexture1=$e,ae.push([me,Pe,xe,ye])}if(ae.length===0)return;const oe=i.o.now(),de=O.previousDrawTimestamp?.001*(oe-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=oe,O.hasColorMap()){F.activeTexture.set(W.TEXTURE0+2);let me=O.colorRampTexture;me||(me=O.colorRampTexture=new i.T(F,O.colorRamp,W.RGBA8)),me.bind(W.LINEAR,W.CLAMP_TO_EDGE)}F.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(me,fe,Pe){const be=me.context,Ae=be.gl,xe=fe.tileFramebuffer;be.activeTexture.set(Ae.TEXTURE0);const ye={u_texture:0,u_opacity:1.05*($e=fe.paint.get("raster-particle-fade-opacity-factor"))/($e+.05)},Ce=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var $e;for(const Ne of Pe){const[,,et,tt]=Ne;xe.colorAttachment0.set(et.targetColorTexture.texture),be.viewport.set([0,0,xe.width,xe.height]),be.clear({color:i.ao.transparent}),tt&&(et.backgroundColorTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE),Ce.draw(me,Ae.TRIANGLES,ir.disabled,Ar.disabled,Nr.alphaBlended,wr.disabled,ye,fe.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(T,O,ae),function(me,fe,Pe,be){const Ae=me.context,xe=Ae.gl,ye=Pe.tileFramebuffer,Ce=me.transform.projection.name==="globe",$e=Pe.paint.get("raster-particle-max-speed");for(const Ne of be){const[et,tt,dt]=Ne;Ae.activeTexture.set(xe.TEXTURE0+0),tt.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),ye.colorAttachment0.set(dt.targetColorTexture.texture);const Tt=me.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});Ae.activeTexture.set(xe.TEXTURE0+1);const Ze=tt.scalarData?[]:[0,1,2,3].map(Ye=>i.e9[Ye](et));Ze.push(et);const ke=et.canonical.x,st=et.canonical.y;for(const Ye of Ze){const gt=fe.getTile(Ce?Ye.wrapped():Ye);if(!gt)continue;const Rt=gt.rasterParticleState;if(!Rt)continue;const Vt=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-et.wrap),It=Ye.canonical.y;Rt.particleTexture0.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const At=L2(1,Rt.particleTexture0.size[0],[Vt-ke,It-st],0,tt.texture.size,2,$e,tt.textureOffset,tt.scale,tt.offset);Tt.draw(me,xe.POINTS,ir.disabled,Ar.disabled,Nr.alphaBlended,wr.disabled,At,Pe.id,Rt.particleIndexBuffer,void 0,Rt.particleSegment)}}}(T,P,O,ae),F.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(me,fe,Pe,be){const Ae=me.context,xe=Ae.gl,ye=fe.paint.get("raster-particle-max-speed"),Ce=be*fe.paint.get("raster-particle-speed-factor")*.15,$e=function(et){return Math.pow(et,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),Ne=fe.particleFramebuffer;Ae.viewport.set([0,0,Ne.width,Ne.height]);for(const et of Pe){const[,tt,dt]=et;Ae.activeTexture.set(xe.TEXTURE0+0),tt.texture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ae.activeTexture.set(xe.TEXTURE0+1);const Tt=dt.particleTexture0;Tt.bind(xe.NEAREST,xe.CLAMP_TO_EDGE);const Ze=Qx(1,Tt.size[0],0,tt.texture.size,ye,Ce,$e,tt.textureOffset,tt.scale,tt.offset);Ne.colorAttachment0.set(dt.particleTexture1.texture),Ae.clear({color:i.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(me,xe.TRIANGLES,ir.disabled,Ar.disabled,Nr.unblended,wr.disabled,Ze,fe.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(T,O,ae,de)}(p,s,c,m),p.renderPass==="translucent"&&(function(T,P,O,D,F){const W=T.context,H=W.gl,q=P.getSource().tileSize,ee=5*(1-i.ah(i.cL,i.cL+1,T.transform.zoom))*q+O.paint.get("raster-particle-elevation"),Y=!T.options.moving,ae=T.transform.projection.name==="globe";if(!D.length)return;const[oe,de]=T.stencilConfigForOverlap(D),me=[];ae&&me.push("PROJECTION_GLOBE_VIEW");const fe=T.stencilModeFor3D();for(const Pe of de){const be=Pe.toUnwrapped(),Ae=P.getTile(Pe);if(!Ae.rasterParticleState)continue;const xe=Ae.rasterParticleState,ye=100;Ae.registerFadeDuration(ye);const Ce=P.findLoadedParent(Pe,0),$e=Dh(Ae,Ce,P,T.transform,ye);let Ne,et;T.terrain&&T.terrain.prepareDrawTile(),W.activeTexture.set(H.TEXTURE0),xe.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),W.activeTexture.set(H.TEXTURE1),Ce&&Ce.rasterParticleState?(Ce.rasterParticleState.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ne=Math.pow(2,Ce.tileID.overscaledZ-Ae.tileID.overscaledZ),et=[Ae.tileID.canonical.x*Ne%1,Ae.tileID.canonical.y*Ne%1]):xe.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const tt=ae?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(be,Y),dt=T.transform,Tt=ob(dt),Ze=i.dG(Pe.canonical),ke=i.dH(Ze.getCenter().lat);let st,Ye,gt,Rt,Vt;ae?(st=Float32Array.from(i.bk(i.dJ(Pe.canonical))),Ye=Float32Array.from(dt.globeMatrix),gt=Float32Array.from(i.dF(dt)),Rt=[i.aF(dt.center.lng),i.aJ(dt.center.lat)],Vt=Float32Array.from(i.dI(Pe.canonical,Ze,ke,dt.worldSize/dt._pixelsPerMercatorPixel))):(st=new Float32Array(16),Ye=new Float32Array(9),gt=new Float32Array(16),Rt=[0,0],Vt=new Float32Array(9));const It=D2(tt,st,Ye,gt,Vt,et||[0,0],i.aj(T.transform.zoom),Rt,Tt,Ne||1,$e,ee),At=T.isTileAffectedByFog(Pe),tr=T.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:At});if(T.uploadCommonUniforms(W,tr,be),ae){const Jt=new ir(H.LEQUAL,ir.ReadOnly,T.depthRangeFor3D),zt=0,Gt=T.globeSharedBuffers;if(Gt){const[hr,Or,Qr]=Gt.getGridBuffers(ke,zt!==0);tr.draw(T,H.TRIANGLES,Jt,fe,Nr.alphaBlended,T.renderElevatedRasterBackface?wr.frontCCW:wr.backCCW,It,O.id,hr,Or,Qr)}}else{const Jt=T.depthModeForSublayer(0,ir.ReadOnly),zt=oe[Pe.overscaledZ],{tileBoundsBuffer:Gt,tileBoundsIndexBuffer:hr,tileBoundsSegments:Or}=T.getTileBoundsBuffers(Ae);tr.draw(T,H.TRIANGLES,Jt,zt,Nr.alphaBlended,wr.disabled,It,O.id,Gt,hr,Or)}}T.resetStencilClippingMasks()}(p,s,c,m),p.style.map.triggerRepaint())},background:function(p,s,c,m){const v=c.paint.get("background-color"),w=c.paint.get("background-color-use-theme").constantOr("default")==="none",T=c.paint.get("background-opacity"),P=c.paint.get("background-emissive-strength"),O=c.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const D=p.context,F=D.gl,W=p.transform,H=W.tileSize,q=c.paint.get("background-pattern");let ee;if(q!==void 0&&(q===null||(ee=p.imageManager.getPattern(i.I.from(q.toString()),c.scope,p.style.getLut(c.scope)),!ee)))return;const Y=!q&&v.a===1&&T===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==Y)return;const ae=Ar.disabled,oe=p.depthModeForSublayer(0,Y==="opaque"?ir.ReadWrite:ir.ReadOnly),de=p.colorModeForDrapableLayerRenderPass(P),me=q?"backgroundPattern":"background";let fe,Pe=m;Pe||(fe=p.getBackgroundTiles(),Pe=Object.values(fe).map(Ae=>Ae.tileID)),q&&(D.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context,c.scope));const be=[];if(p.terrain&&p.terrain.renderingToTexture&&p.emissiveMode==="mrt-fallback"&&be.push("USE_MRT1"),O){const Ae=p.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0,defines:be}),xe=new Float32Array(i.bA([])),ye=new i.aQ(0,0,0,0,0),Ce=q?Mc(xe,P,T,p,0,c.scope,ee,O,{tileID:ye,tileSize:H}):Nh(xe,P,T,v.toPremultipliedRenderColor(w?null:c.lut));Ae.draw(p,F.TRIANGLES,oe,ae,de,wr.disabled,Ce,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Ae of Pe){const xe=p.isTileAffectedByFog(Ae),ye=p.getOrCreateProgram(me,{overrideFog:xe,defines:be}),Ce=Ae.toUnwrapped(),$e=m?Ae.projMatrix:p.transform.calculateProjMatrix(Ce);p.prepareDrawTile();const Ne=s?s.getTile(Ae):fe?fe[Ae.key]:new du(Ae,H,W.zoom,p),et=q?Mc($e,P,T,p,0,c.scope,ee,O,{tileID:Ae,tileSize:H}):Nh($e,P,T,v.toPremultipliedRenderColor(w?null:c.lut));p.uploadCommonUniforms(D,ye,Ce);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:dt,tileBoundsSegments:Tt}=p.getTileBoundsBuffers(Ne);ye.draw(p,F.TRIANGLES,oe,ae,de,wr.disabled,et,c.id,tt,dt,Tt)}},sky:function(p,s,c){const m=p._atmosphere?i.aj(p.transform.zoom):1,v=c.paint.get("sky-opacity")*m;if(v===0)return;const w=p.context,T=c.paint.get("sky-type"),P=new ir(w.gl.LEQUAL,ir.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;T==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(D,F,W,H){const q=D.context,ee=q.gl;let Y=F.skyboxFbo;if(!Y){Y=F.skyboxFbo=q.createFramebuffer(32,32,1,null),F.skyboxGeometry=new tm(q),F.skyboxTexture=q.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,F.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let me=0;me<6;++me)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Y.framebuffer),q.viewport.set([0,0,32,32]);const ae=F.getCenter(D,!0),oe=D.getOrCreateProgram("skyboxCapture"),de=new Float64Array(16);i.bA(de),i.en(de,de,.5*-Math.PI),Tu(D,F,oe,de,ae,0),i.bA(de),i.en(de,de,.5*Math.PI),Tu(D,F,oe,de,ae,1),i.bA(de),i.cU(de,de,.5*-Math.PI),Tu(D,F,oe,de,ae,2),i.bA(de),i.cU(de,de,.5*Math.PI),Tu(D,F,oe,de,ae,3),i.bA(de),Tu(D,F,oe,de,ae,4),i.bA(de),i.en(de,de,Math.PI),Tu(D,F,oe,de,ae,5),q.viewport.set([0,0,D.width,D.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(D,F,W,H,q){const ee=D.context,Y=ee.gl,ae=D.transform,oe=D.getOrCreateProgram("skybox");ee.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,F.skyboxTexture);const de=((me,fe,Pe,be,Ae)=>({u_matrix:me,u_sun_direction:fe,u_cubemap:0,u_opacity:be,u_temporal_offset:Ae}))(ae.skyboxMatrix,F.getCenter(D,!1),0,H,q);D.uploadCommonUniforms(ee,oe),oe.draw(D,Y.TRIANGLES,W,Ar.disabled,D.colorModeForRenderPass(),wr.backCW,de,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,c,P,v,O):T==="gradient"&&p.renderPass==="sky"&&function(D,F,W,H,q){const ee=D.context,Y=ee.gl,ae=D.transform,oe=D.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new tm(ee)),ee.activeTexture.set(Y.TEXTURE0);let de=F.colorRampTexture;de||(de=F.colorRampTexture=new i.T(ee,F.colorRamp,Y.RGBA8)),de.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const me=((fe,Pe,be,Ae,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:Pe,u_radius:i.an(be),u_opacity:Ae,u_temporal_offset:xe}))(ae.skyboxMatrix,F.getCenter(D,!1),F.paint.get("sky-gradient-radius"),H,q);D.uploadCommonUniforms(ee,oe),oe.draw(D,Y.TRIANGLES,W,Ar.disabled,D.colorModeForRenderPass(),wr.backCW,me,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,c,P,v,O)},custom:function(p,s,c,m){const v=p.context,w=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(s)){if(p.renderPass==="offscreen"){const T=w.prerender;if(T){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const P=p.transform.pointMerc;T.call(w,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[P.x,P.y],p.transform.pixelsPerMeterRatio)}else T.call(w,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const P=w.renderToTile;if(P){const O=m[0].canonical,D={x:O.x+m[0].wrap*(w.wrapTileId?0:1<<O.z),y:O.y,z:O.z};v.setDepthMode(ir.disabled),v.setStencilMode(Ar.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),P.call(w,v.gl,D),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(Ar.disabled);const T=w.renderingMode==="3d"?new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,ir.ReadOnly);if(v.setDepthMode(T),p.transform.projection.name==="globe"){const P=p.transform.pointMerc;w.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),i.aj(p.transform.zoom),[P.x,P.y],p.transform.pixelsPerMeterRatio)}else w.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,c,m){if(p.renderPass==="opaque")return;const v=c.paint.get("model-opacity").constantOr(1),w=c.paint.get("model-elevation-reference"),T=w==="ground",P=w==="ground";if(v===0)return;const O=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!O||p.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const D=p.shadowRenderer,F=c.paint.get("model-receive-shadows");D&&(D.useNormalOffset=!0,F||(D.enabled=!1));const W=()=>{D&&(D.useNormalOffset=!0,F||(D.enabled=!0))},H=s.getSource();if(p.renderPass==="light-beam"&&H.type!=="batched-model")return;if(H.type==="vector"||H.type==="geojson")return function(fe,Pe,be,Ae,xe){const ye=fe.transform,Ce=ye.projection.name==="globe",$e=ye.getFreeCameraOptions().position;if(!fe.modelManager)return;const Ne=fe.modelManager;be.modelManager=Ne;const et=fe.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const tt=be._unevaluatedLayout._values["model-id"],dt=Object.assign({},be.layout.get("model-id").parameters),Tt=fe.style.order.indexOf(be.fqid),Ze=be.paint.get("model-opacity").constantOr(1);for(const ke of Ae){const st=Pe.getTile(ke).getBucket(be);if(!st||st.projection.name!==ye.projection.name)continue;const Ye=st.getModelUris();if(Ye&&!st.modelsRequested&&(Ne.addModelsFromBucket(Ye,xe),st.modelsRequested=!0),Ce)dt.zoom=ke.overscaledZ;else{const zt=bs(ke,ye);dt.zoom=zt}const gt=tt.possiblyEvaluate(dt);if(mb(fe,st,ke),al.shadowUniformsInitialized=!1,al.useSingleShadowCascade=!!et&&et.getMaxCascadeForTile(ke.toUnwrapped())===0,fe.renderPass==="shadow"&&et){if(fe.currentShadowCascade===1&&st.isInsideFirstShadowMapFrustum)continue;const zt=ye.calculatePosMatrix(ke.toUnwrapped(),ye.worldSize);if(al.tileMatrix.set(zt),al.shadowTileMatrix=Float32Array.from(et.calculateShadowPassMatrixFromMatrix(zt)),al.aabb.min=[0,0,0],al.aabb.max[0]=al.aabb.max[1]=i.al,al.aabb.max[2]=0,B2(st,al,fe,be.scope))continue}const Rt=1<<ke.canonical.z,Vt=[(($e.x-ke.wrap)*Rt-ke.canonical.x)*i.al,($e.y*Rt-ke.canonical.y)*i.al,$e.z*Rt*i.al];fe.conflationActive&&Object.keys(st.instancesPerModel).length>0&&fe.style.isLayerClipped(be,Pe.getSource())&&st.updateReplacement(ke,fe.replacementSource,Tt,be.scope)&&(st.uploaded=!1,st.upload(fe.context));let It=0;const At=new Array,tr=new Array,Jt=new Array;for(let zt in st.instancesPerModel){const Gt=st.instancesPerModel[zt];Gt.features.length>0&&!Ce&&(zt=gt.evaluate(Gt.features[0].feature,{}));const hr=Ne.getModel(zt,xe);if(hr||Ne.hasURLBeenRequested(zt)||st.modelUris.includes(zt)||(st.modelUris.push(zt),st.modelsRequested=!1),hr&&hr.uploaded)if(Ce){const Or=i.c5([],[$e.x,$e.y,$e.z],fe.transform.worldSize);i.ew(Or,Or);for(let Qr=0;Qr<Gt.instancedDataArray.length;++Qr){const wn=[0,0,0],rr=[1,1,1],vn=i.ex(),Mr=Gt.tileCoordinatesForInstance(Qr),Pn=Gt.transformForInstance(Qr);i.ey(rr,Pn),i.ez(vn,Pn),i.eA(wn,vn);const Bn=Gt.translationForInstance(Qr),jn=new i.aT(0,0);i.eB(st.canonical,jn,Mr.x,Mr.y);const _n=i.bC();i.eC(_n,hr,fe.transform,jn,wn,rr,Bn,!0,!1,!1);const Br=Gt.colorForInstance(Qr),An=i.bA([]),Ti=i.ef(jn.lat,fe.transform.zoom),pi=i.bq([],[1,1,1/Ti]);i.br(An,An,Or),Jt.push({zScaleMatrix:pi,negCameraPosMatrix:An});for(const Cn of hr.nodes)Au(fe,Cn,_n,fe.transform.expandedFarZProjMatrix,It,At,tr,hr.materialOverrides,Ze,Br);++It}}else for(const Or of hr.nodes)gb(fe,be,Or,Gt,Vt,ke,al)}if(Ce)if(fe.renderPass==="shadow"){for(const zt of tr)La(zt.mesh,zt.nodeModelMatrix,fe,be);for(const zt of At)La(zt.mesh,zt.nodeModelMatrix,fe,be)}else pb(fe,be,At,tr,Jt)}}(p,s,c,m,Vh(p,c)),void W();if(!H.loaded())return;if(H.type==="batched-model")return function(fe,Pe,be,Ae){be.resetLayerRenderingStats(fe);const xe=fe.context,ye=fe.transform,Ce=fe.style.fog,$e=fe.shadowRenderer;if(ye.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const Ne=fe.transform.getFreeCameraOptions().position,et=i.c5([],[Ne.x,Ne.y,Ne.z],fe.transform.worldSize),tt=i.ew([],et),dt=i.bA([]),Tt=i.ef(ye.center.lat,ye.zoom),Ze=i.bq([],[1,1,1/Tt]);i.br(dt,dt,tt);const ke=be.paint.get("model-opacity").constantOr(1),st=new ir(xe.gl.LEQUAL,ir.ReadWrite,fe.depthRangeFor3D),Ye=new ir(xe.gl.LEQUAL,ir.ReadOnly,fe.depthRangeFor3D),gt=new i.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Rt=fe.renderPass==="shadow",Vt=Rt&&$e?$e.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),It=be.paint.get("model-front-cutoff"),At=It[2]<1,tr=wc(fe,be.paint.get("model-cutoff-fade-range")),Jt=be.getLayerRenderingStats();(function(zt,Gt,hr,Or){const Qr=zt.terrain?zt.terrain.exaggeration():0,wn=zt.transform.zoom;for(const rr of Or){const vn=Gt.getTile(rr).getBucket(hr);vn&&(vn.setFilter(hr.filter),zt.conflationActive&&vn.updateReplacement(rr,zt.replacementSource),vn.evaluateTransform(zt,hr),zt.terrain&&Qr>0&&vn.elevationUpdate(zt.terrain,Qr,rr,hr.source),vn.needsReEvaluation(zt,wn,hr)&&vn.evaluate(hr))}})(fe,Pe,be,Ae),function(){let zt,Gt,hr;At?(zt=Ae.length-1,Gt=-1,hr=-1):(zt=0,Gt=Ae.length,hr=1);const Or=new Float64Array(16),Qr=i.cA(),wn=new i.P(0,0);for(let rr=zt;rr!==Gt;rr+=hr){const vn=Ae[rr],Mr=Pe.getTile(vn).getBucket(be);if(!Mr||!Mr.uploaded)continue;let Pn=!1;$e&&(Pn=$e.getMaxCascadeForTile(vn.toUnwrapped())===0);const Bn=ye.calculatePosMatrix(vn.toUnwrapped(),ye.worldSize),jn=Mr.modelTraits;!Rt&&At&&(i.bl(Or,Bn),i.af(Qr,et,Or),wn.x=Qr[0],wn.y=Qr[1]);const _n=[];Mr.setFilter(be.filter);for(const Br of Mr.getNodesInfo()){if(Br.hiddenByReplacement||!Br.node.meshes)continue;const An=Br.node;let Ti=0;fe.terrain&&An.elevation&&(Ti=An.elevation*fe.terrain.exaggeration());const pi=(()=>{const Yo=Br.aabb;return gt.min=[...Yo.min],gt.max=[...Yo.max],gt.min[2]+=Ti,gt.max[2]+=Ti,i.af(gt.min,gt.min,Bn),i.af(gt.max,gt.max,Bn),gt})(),Cn=Br.evaluatedScale;if(Cn[0]<=1&&Cn[1]<=1&&Cn[2]<=1&&pi.intersects(Vt)===0)continue;if(!Rt&&At){const Yo=.16666666666666666;Br.cameraCollisionOpacity=et[0]>pi.min[0]&&et[0]<pi.max[0]&&et[1]>pi.min[1]&&et[1]<pi.max[1]&&et[2]*Tt<pi.max[2]&&An.footprint&&i.c0(wn,An.footprint)?Math.max(Br.cameraCollisionOpacity-Yo,0):Math.min(1,Br.cameraCollisionOpacity+Yo)}const fn=[...Bn],$r=1/i.d7(vn.canonical),ci=An.anchor?An.anchor[0]:0,ki=An.anchor?An.anchor[1]:0;i.br(fn,fn,[ci*(Cn[0]-1)+Br.evaluatedTranslation[0]*$r,ki*(Cn[1]-1)+Br.evaluatedTranslation[1]*$r,Ti+Br.evaluatedTranslation[2]]),i.cq(Cn,i.eE)||i.cS(fn,fn,Cn);const vi=i.aB([],fn,An.globalMatrix),Kn=i.aB([],ye.expandedFarZProjMatrix,vi),ws=i.aB([],ye.expandedFarZProjMatrix,fn),Ho=i.aC([],[ci,ki,Ti,1],Kn)[2];An.hidden=!1;let no=ke;Rt||(At&&(no*=Br.cameraCollisionOpacity,no*=Kr(fn,ye,Br.aabb,It)),no*=fi(tr,Ho)),no!==0?_n.push({nodeInfo:Br,depth:Ho,opacity:no,wvpForNode:Kn,wvpForTile:ws,nodeModelMatrix:vi,tileModelMatrix:fn}):An.hidden=!0}Rt||_n.sort((Br,An)=>!At||Br.opacity===1&&An.opacity===1?Br.depth<An.depth?-1:1:Br.opacity===1?-1:An.opacity===1?1:Br.depth>An.depth?-1:1);for(const Br of _n){const An=Br.nodeInfo,Ti=An.node;let pi=i.aB([],Ze,Br.tileModelMatrix);i.aB(pi,dt,pi);const Cn=i.bl([],pi);i.eg(Cn,Cn),i.cS(Cn,Cn,Uh),pi=i.aB(pi,pi,Ti.globalMatrix);const fn=fe.renderPass==="light-beam",$r=be.paint.get("model-color-use-theme").constantOr("default")==="none",ci=jn&i.eI.HasMapboxMeshFeatures,ki=ci?0:An.evaluatedRMEA[0][2];for(let vi=0;vi<Ti.meshes.length;++vi){const Kn=Ti.meshes[vi],ws=vi===Ti.lightMeshIndex;let Ho=Br.wvpForNode;if(ws){if(!fn&&!fe.terrain&&fe.shadowRenderer){fe.currentLayer<fe.firstLightBeamLayer&&(fe.firstLightBeamLayer=fe.currentLayer);continue}Ho=Br.wvpForTile}else if(fn)continue;const no={defines:[]},Yo=[];if(!Rt&&$e&&($e.useNormalOffset=!!Kn.normalBuffer),im(no.defines,Yo,Kn,fe,$r?null:be.lut),ci||no.defines.push("DIFFUSE_SHADED"),Pn&&no.defines.push("SHADOWS_SINGLE_CASCADE"),Jt&&(Rt?Jt.numRenderedVerticesInShadowPass+=Kn.vertexArray.length:Jt.numRenderedVerticesInTransparentPass+=Kn.vertexArray.length),Rt){La(Kn,Br.nodeModelMatrix,fe,be);continue}let Jo=null;if(Ce){const zi=nm(Br.nodeModelMatrix,fe.transform);if(Jo=new Float32Array(zi),ye.projection.name!=="globe"){const Xn=Kn.aabb.min,Vi=Kn.aabb.max,[Ai,xi]=Ce.getOpacityForBounds(zi,Xn[0],Xn[1],Vi[0],Vi[1]);no.overrideFog=Ai>=ht||xi>=ht}}const No=Kn.material;let Qs;No.occlusionTexture&&No.occlusionTexture.offsetScale&&(Qs=No.occlusionTexture.offsetScale,no.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ya=fe.getOrCreateProgram("model",no);!Rt&&$e&&$e.setupShadowsFromMatrix(Br.tileModelMatrix,ya,$e.useNormalOffset),fe.uploadCommonUniforms(xe,ya,null,Jo);const ks=No.pbrMetallicRoughness;ks.metallicFactor=.9,ks.roughnessFactor=.5;const Ci=vu(new Float32Array(Ho),new Float32Array(pi),new Float32Array(Cn),new Float32Array(Ti.globalMatrix),fe,Br.opacity,ks.baseColorFactor,No.emissiveFactor,ks.metallicFactor,ks.roughnessFactor,No,ki,be,[0,0,0],Qs);!ws&&(An.hasTranslucentParts||Br.opacity<1)&&ya.draw(fe,xe.gl.TRIANGLES,st,Ar.disabled,Nr.disabled,wr.backCCW,Ci,be.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,be.paint,fe.transform.zoom,void 0,Yo),ya.draw(fe,xe.gl.TRIANGLES,ws?Ye:st,Ar.disabled,ws||Br.opacity<1||An.hasTranslucentParts?Nr.alphaBlended:Nr.unblended,wr.backCCW,Ci,be.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,be.paint,fe.transform.zoom,void 0,Yo)}}}}()}(p,s,c,m),void W();if(H.type!=="model")return;const q=H.getModels(),ee=[],Y=p.transform.getFreeCameraOptions().position,ae=i.c5([],[Y.x,Y.y,Y.z],p.transform.worldSize);i.ew(ae,ae);const oe=[],de=[];let me=0;for(const fe of q){const Pe=s.getFeatureState("",fe.id),be={type:"Unknown",id:fe.id,properties:fe.featureProperties},Ae=c.paint.get("model-rotation").evaluate(be,Pe),xe=c.paint.get("model-scale").evaluate(be,Pe),ye=c.paint.get("model-translation").evaluate(be,Pe),Ce=c.paint.get("model-opacity").evaluate(be,Pe);hb(c,fe.id,Pe,fe.featureProperties,fe.nodeOverrideNames,fe.nodeOverrides),fb(c,fe.id,Pe,fe.featureProperties,fe.materialOverrideNames,fe.materialOverrides),fe.nodeOverrides.size>0&&fe.computeBoundsAndApplyParent(),fe.computeModelMatrix(p,Ae,xe,ye,P,T,!1);const $e=i.bA([]),Ne=i.ef(fe.position.lat,p.transform.zoom),et=i.bq([],[1,1,1/Ne]);i.br($e,$e,ae),ee.push({zScaleMatrix:et,negCameraPosMatrix:$e});for(const tt of fe.nodes)Au(p,tt,fe.matrix,p.transform.expandedFarZProjMatrix,me,oe,de,fe.materialOverrides,Ce);me++}if(oe.sort((fe,Pe)=>Pe.depth-fe.depth),p.renderPass!=="shadow")pb(p,c,oe,de,ee),W();else{for(const fe of de)La(fe.mesh,fe.nodeModelMatrix,p,c);for(const fe of oe)La(fe.mesh,fe.nodeModelMatrix,p,c);W()}}},lm={line:function(p,s,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const m=s.getVisibleCoordinates();for(const v of m){const w=s.getTile(v).getBucket(p);if(w&&(w.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,s,c){const m=s.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,Vh(c,p)));if(m.type==="batched-model"||m.type!=="model")return;const v=m.getModels();for(const w of v)w.upload(c.context)},raster:function(p,s,c){const m=s.getSource();if(!(m instanceof ss&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-array-band")||m.getInitialBand(v);if(w==null)return;const T=s.getIds().map(P=>s.getTileByID(P));for(const P of T)P.updateNeeded(p.id,w)&&m.prepareTile(P,v,p.id,w)},"raster-particle":function(p,s,c){const m=s.getSource();if(!(m instanceof ss&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const w=p.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(w==null)return;const T=s.getIds().map(P=>s.getTileByID(P));for(const P of T)P.updateNeeded(p.id,w)&&m.prepareTile(P,v,p.id,w)}},Js={fill:Zp},cm={fill:function(p,s,c,m){if(!c.layout||c.layout.get("fill-elevation-reference")==="none"||c.paint.get("fill-opacity").constantOr(1)===0)return;const v=p.context.gl,w=new ir(v.LEQUAL,ir.ReadOnly,p.depthRangeFor3D),T=new Ar({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),P=p.transform.getFreeCameraOptions().position,O=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of m){const F=s.getTile(D),W=F.getBucket(c);if(!W)continue;const H=W.elevatedStructures;if(!H||H.depthSegments.segments[0].primitiveLength===0)continue;const q=nb(D.toUnwrapped(),P),ee=p.translatePosMatrix(D.projMatrix,F,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Y=_u(ee,q,0,1,0);O.draw(p,v.TRIANGLES,w,T,Nr.disabled,wr.disabled,Y,c.id,H.vertexBuffer,H.indexBuffer,H.depthSegments,c.paint,p.transform.zoom)}}};class um{constructor(s,c,m,v,w){this.context=new xd(s,c),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const O of T)this._debugParams.enabledLayers[O]=!0;for(const O of T);this.occlusionParams=new wd,this.setup(),this.numSublayers=Bs.maxUnderzooming+Bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ld(this),this._wireframeDebugCache=new Rc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const P=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,P,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=w,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(s,c){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new r_(this,s));const v=this._terrain;this.transform.elevation=m?v:null,v.update(s,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=c.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const w=m+.78*(v-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new r_(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*i.o.devicePixelRatio,this.height=c*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const s=this.context,c=new i.bd;c.emplaceBack(0,0),c.emplaceBack(i.al,0),c.emplaceBack(0,i.al),c.emplaceBack(i.al,i.al),this.tileExtentBuffer=s.createVertexBuffer(c,i.bf.members),this.tileExtentSegments=i.bg.simpleSegment(0,0,4,2);const m=new i.bd;m.emplaceBack(0,0),m.emplaceBack(i.al,0),m.emplaceBack(0,i.al),m.emplaceBack(i.al,i.al),this.debugBuffer=s.createVertexBuffer(m,i.bf.members),this.debugSegments=i.bg.simpleSegment(0,0,4,5);const v=new i.bd;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,i.bf.members),this.viewportSegments=i.bg.simpleSegment(0,0,4,2);const w=new i.b1;w.emplaceBack(0,0,0,0),w.emplaceBack(i.al,0,i.al,0),w.emplaceBack(0,i.al,0,i.al),w.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=s.createVertexBuffer(w,i.bi.members),this.mercatorBoundsSegments=i.bg.simpleSegment(0,0,4,2);const T=new i.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const P=new i.be;for(const D of[0,1,3,2,0])P.emplaceBack(D);this.debugIndexBuffer=s.createIndexBuffer(P),this.emptyTexture=new i.T(s,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=i.bC();const O=this.context.gl;this.stencilClearMode=new Ar({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,ir.disabled,this.stencilClearMode,Nr.disabled,wr.disabled,jh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,m){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const O of m)if(this._tileClippingMaskIDs[O.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=c.id;const v=this.context,w=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode(Nr.disabled),v.setDepthMode(ir.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of m){const O=c.getTile(P),D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:W,tileBoundsSegments:H}=this.getTileBoundsBuffers(O);T.draw(this,w.TRIANGLES,ir.disabled,new Ar({func:w.ALWAYS,mask:0},D,255,w.KEEP,w.KEEP,w.REPLACE),Nr.disabled,wr.disabled,jh(P.projMatrix),"$clipping",F,W,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Ar({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Ar({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,m=s.sort((T,P)=>P.overscaledZ-T.overscaledZ),v=m[m.length-1].overscaledZ,w=m[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let P=0;P<w;P++)T[P+v]=new Ar({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[T,m]}return[{[v]:Ar.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Nr([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Nr.unblended:Nr.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?s!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Nr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,s??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Nr([c.ONE,c.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,c.ONE_MINUS_SRC_ALPHA],i.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(s,c,m,v=!1){if(this.depthOcclusion)return new ir(this.context.gl.GREATER,ir.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return ir.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new ir(m||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,c=Math.ceil(this.width),m=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&m!==0&&(this.depthFBO=new rb(this.context,c,m,0,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:m,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),s.bindTexture(s.TEXTURE_2D,w),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,c,m,0,0,c,m,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,c)=>s+c/this._fpsHistory.length,0))}render(s,c){const m=i.o.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=c;const v=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(w).filter(Ze=>{const ke=v[Ze];return!(ke.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ke.type]});let P=T(),O=!1,D=!1,F=null,W=0,H=!1;for(const Ze of P){const ke=v[Ze];ke.visibility!=="none"&&(ke.type==="circle"?O=!0:ke.type==="building"?(F=ke,++W):ke.type==="symbol"&&(ke.hasOcclusionOpacityProperties?D=!0:O=!0))}this.updateEmissiveMode();let q=P.map(Ze=>v[Ze]);const ee=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();for(const Ze in ee){const ke=ee[Ze];ke.used&&(ke.prepare(this.context),ke.getSource().usedInConflation&&++W)}let Y=!1;for(const Ze of q)Ze.isHidden(this.transform.zoom)||(Ze.type==="clip"&&(Y=!0),this.prepareLayer(Ze));const ae={},oe={},de={},me={},fe={};for(const Ze in ee){const ke=ee[Ze];ae[Ze]=ke.getVisibleCoordinates(),oe[Ze]=ae[Ze].slice().reverse(),de[Ze]=ke.getVisibleCoordinates(!0).reverse(),me[Ze]=ke.getShadowCasterCoordinates(),fe[Ze]=ke.sortCoordinatesByDistance(ae[Ze])}const Pe=Ze=>{const ke=this.style.getLayerSourceCache(Ze);return ke&&ke.used?ke.getSource():null};if(W||Y||this._clippingActiveLastFrame){const Ze=[],ke=[];let st=0;for(const Ye of q)this.isSourceForClippingOrConflation(Ye,Pe(Ye))&&(Ze.push(Ye),ke.push(st)),st++;if(Ze&&(Y||Ze.length>1)||this._clippingActiveLastFrame){Y=!1;const Ye=[];for(let gt=0;gt<Ze.length;gt++){const Rt=Ze[gt],Vt=ke[gt],It=this.style.getLayerSourceCache(Rt);if(!It||!It.used||!It.getSource().usedInConflation&&Rt.type!=="clip"&&Rt.type!=="building")continue;let At=i.eQ,tr=i.b_.None;const Jt=[];let zt=!0;if(Rt.type==="building")At=i.eS;else if(Rt.type==="clip"){At=Vt;for(const Gt of Rt.layout.get("clip-layer-types"))tr|=Gt==="model"?i.b_.Model:Gt==="symbol"?i.b_.Symbol:i.b_.FillExtrusion;for(const Gt of Rt.layout.get("clip-layer-scope"))Jt.push(Gt);Rt.isHidden(this.transform.zoom)?zt=!1:Y=!0}zt&&Ye.push({layer:Rt.fqid,cache:It,order:At,clipMask:tr,clipScope:Jt})}this.replacementSource.setSources(Ye),H=!0}}this._clippingActiveLastFrame=Y,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ze=0;Ze<q.length;Ze++){const ke=q[Ze];if(ke.visibility==="none")continue;const st=ke.cutoffRange();if(this.longestCutoffRange=Math.max(st,this.longestCutoffRange),st>0){const Ye=Pe(ke);Ye&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom)),ke.minzoom&&(this.minCutoffZoom=Math.max(ke.minzoom,this.minCutoffZoom))}ke.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ze),this._lastOcclusionLayer=Ze)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(de),this.opaquePassCutoff=0,P=T(),q=P.map(Ze=>v[Ze]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ze in ee)for(const ke of ae[Ze]){let st={min:0,max:0};this.terrain&&(st=this.terrain.getMinMaxForTile(ke)||st),Ae.addShadowReceiver(ke.toUnwrapped(),st.min,st.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new db(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new __(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new am(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new rm);const Ze=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(Ze,F)}if(!Hn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ze of q){const ke=s.getLayerSourceCache(Ze);if(!Ze.hasOffscreenPass()||Ze.isHidden(this.transform.zoom))continue;const st=ke?oe[ke.id]:void 0;(Ze.type==="custom"||Ze.type==="raster"||Ze.type==="raster-particle"||Ze.isSky()||st&&st.length)&&this.renderLayer(this,ke,Ze,st)}this.depthRangeFor3D=[0,1-(q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),$e=(()=>{if(c.showOverdrawInspector)return i.ao.black;const Ze=this.style.fog;if(Ze&&this.transform.projection.supportsFog){const ke=this.style.getLut(Ze.scope);if(!Ce){const st=Ze.properties.get("color-use-theme")==="none",Ye=Ze.properties.get("color").toNonPremultipliedRenderColor(st?null:ke).toArray01();return new i.ao(...Ye)}if(Ce){const st=Ze.properties.get("space-color-use-theme")==="none",Ye=Ze.properties.get("space-color").toNonPremultipliedRenderColor(st?null:ke).toArray01();return new i.ao(...Ye)}}return i.ao.transparent})();if(this.context.clear({color:$e,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const Ze=q[this.currentLayer],ke=s.getLayerSourceCache(Ze);if(Ze.isSky())continue;const st=ke?(Ze.is3D(w)?fe:oe)[ke.id]:void 0;this._renderTileClippingMasks(Ze,ke,st),this.renderLayer(this,ke,Ze,st)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Ze=q[this.currentLayer],ke=s.getLayerSourceCache(Ze);Ze.isSky()&&this.renderLayer(this,ke,Ze,ke?oe[ke.id]:void 0)}function Ne(Ze,ke){let st;return ke&&(st=(Ze.type==="symbol"?de:Ze.is3D(w)?fe:oe)[ke.id]),st}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const Ze=q[this.currentLayer];if(Ze.type==="raster"||Ze.type==="raster-particle"){const ke=s.getLayerSourceCache(Ze);this.renderLayer(this,ke,Ze,Ne(Ze,ke))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let et=0;Ae&&(et=Ae.getShadowCastingLayerCount());let tt=!1,dt=-1;for(let Ze=0;Ze<P.length;++Ze){const ke=q[Ze];ke.isHidden(this.transform.zoom)||ke.is3D(w)&&(dt=Ze)}D&&dt===-1&&(O=!0);let Tt=!1;for(;this.currentLayer<P.length;){const Ze=q[this.currentLayer],ke=s.getLayerSourceCache(Ze);if(Ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ze)){if(Ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Tt&&Ze.is3D(w)&&!w){const st=this.currentLayer,Ye=gt=>{for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Rt=q[this.currentLayer];if(Js[Rt.type]){const Vt=this.style.getLayerSourceCache(Rt);Js[Rt.type](this,Vt,Rt,Ne(Rt,Vt),gt)}}};Ye("initialize"),Ye("reset"),this.currentLayer=st,Tt=!0}if(O&&!tt&&this.terrain&&!this.transform.isOrthographic&&(tt=!0,this.blitDepth()),D&&dt!==-1&&this.currentLayer===dt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ze,ke,ke?ae[ke.id]:void 0),this.renderLayer(this,ke,Ze,Ne(Ze,ke)),!this.terrain&&Ae&&et>0&&Ze.hasShadowPass()&&--et==0){{this.clearStencil(),this.resetStencilClippingMasks();const st=this.currentLayer;for(this.currentLayer=0;this.currentLayer<q.length;this.currentLayer++){const Ye=q[this.currentLayer];if(cm[Ye.type]){const gt=this.style.getLayerSourceCache(Ye);cm[Ye.type](this,gt,Ye,Ne(Ye,gt))}}this.currentLayer=st}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const st=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=st;this.currentLayer++){const Ye=q[this.currentLayer];if(!Ye.hasLightBeamPass())continue;const gt=s.getLayerSourceCache(Ye);this.renderLayer(this,gt,Ye,gt?oe[gt.id]:void 0)}this.currentLayer=st,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const st=this.currentLayer;this.depthOcclusion=!0;for(const Ye of this.layersWithOcclusionOpacity){this.currentLayer=Ye;const gt=q[this.currentLayer],Rt=s.getLayerSourceCache(gt),Vt=Rt?oe[Rt.id]:void 0;this.terrain||this._renderTileClippingMasks(gt,Rt,Rt?ae[Rt.id]:void 0),this.renderLayer(this,Rt,gt,Vt)}this.depthOcclusion=!1,this.currentLayer=st,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ze=null;q.forEach(ke=>{const st=s.getLayerSourceCache(ke);st&&!ke.isHidden(this.transform.zoom)&&st.getVisibleCoordinates().length&&(!Ze||Ze.getSource().maxzoom<st.getSource().maxzoom)&&(Ze=st)}),Ze&&this.options.showTileBoundaries&&Ct(this,Ze,Ze.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ct(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ze){const ke=Ze.transform.padding;Su(Ze,Ze.transform.height-(ke.top||0),3,sb),Su(Ze,ke.bottom||0,3,ab),Pi(Ze,ke.left||0,3,lb),Pi(Ze,Ze.transform.width-(ke.right||0),3,bu);const st=Ze.transform.centerPoint;(function(Ye,gt,Rt,Vt){He(Ye,gt-1,Rt-10,2,20,Vt),He(Ye,gt-10,Rt-1,20,2,Vt)})(Ze,st.x,Ze.transform.height-st.y,wu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(s.type);if(lm[s.type]&&(m||this.terrain&&s.type==="custom")){const v=this.style.getLayerSourceCache(s);lm[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,c,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(m.type)&&(!s.terrain||m.type!=="custom")||m.type==="clip"||kc[m.type](s,c,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,m=this.context.gl;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(s.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const m in s){const v=s[m],w=this.context.extTimerQuery,T=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),c[m]=T}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let m=0;for(const v of s)m+=c.getQueryParameter(v,c.QUERY_RESULT)/1e6,c.deleteQuery(v);return m}translatePosMatrix(s,c,m,v,w){if(!m[0]&&!m[1])return s;const T=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),F=Math.cos(T);m=[m[0]*F-m[1]*D,m[0]*D+m[1]*F]}const P=[w?m[0]:i.ay(c,m[0],this.transform.zoom),w?m[1]:i.ay(c,m[1],this.transform.zoom),0],O=new Float32Array(16);return i.br(O,s,P),O}saveTileTexture(s){if(s.context!==this.context)return;const c=s.size[0],m=this._tileTextures[c];m?m.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,c,m){const v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(s,c){this.cache=this.cache||{};const m=c&&c.defines||[],v=c&&c.config,w=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(m),T=Gx.cacheKey(Uy[s],s,w,v);return this.cache[T]||(this.cache[T]=new Gx(this.context,s,Uy[s],v,qp[s],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){const w=((T,P,O)=>{const D=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",W=T.properties.get("color").toNonPremultipliedRenderColor(F?null:O.getLut(T.scope)).toArray01(),H=T.properties.get("intensity"),q=P.properties.get("color-use-theme")==="none",ee=P.properties.get("color").toNonPremultipliedRenderColor(q?null:O.getLut(P.scope)).toArray01(),Y=P.properties.get("intensity"),ae=[D.x,D.y,D.z],oe=i.dN(ee,Y),de=i.dN(W,H);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:ae,u_lighting_directional_color:de,u_ground_radiance:yd(ae,de,oe)}})(m,v,this.style);c.setLightsUniformValues(s,w)}}}uploadCommonUniforms(s,c,m,v,w){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const P=T.getOpacity(this.transform.pitch),O=((D,F,W,H,q,ee,Y,ae,oe,de,me,fe)=>{const Pe=D.transform,be=F.properties.get("color-use-theme")==="none",Ae=F.properties.get("color").toNonPremultipliedRenderColor(be?null:D.style.getLut(F.scope)).toArray01();Ae[3]=H;const xe=D.frameCounter/1e3%1,[ye,Ce]=F.properties.get("vertical-range");return{u_fog_matrix:W?Pe.calculateFogTileMatrix(W):fe||D.identityMat,u_fog_range:F.getFovAdjustedRange(Pe._fov),u_fog_color:Ae,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ye,Ce),Ce],u_fog_temporal_offset:xe,u_frustum_tl:q,u_frustum_tr:ee,u_frustum_br:Y,u_frustum_bl:ae,u_globe_pos:oe,u_globe_radius:de,u_viewport:me,u_globe_transition:i.aj(Pe.zoom),u_is_globe:+(Pe.projection.name==="globe")}})(this,T,m,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],v);c.setFogUniformValues(s,O)}w&&c.setCutoffUniformValues(s,w.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)c[v.key]=s[v.key]||new du(v,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,c){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=ht||c[1]>=ht}setupDepthForOcclusion(s,c,m){const v=this.context,w=v.gl,T=!!m;var P;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),T||c.setTerrainUniformValues(v,m)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const s=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=s?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function dm(p,s){let c=!1,m=null;const v=()=>{m=null,c&&(p(),m=setTimeout(v,s),c=!1)};return()=>(c=!0,m||v(),m)}class v_{constructor(s){this._hashName=s&&encodeURIComponent(s),i.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dm(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=to(s);if(this._hashName){const m=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(T=>{const P=T.split("=")[0];return P===m?(v=!0,`${P}=${c}`):T}).filter(T=>T);return v||w.push(`${m}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(Number(m)))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function to(p,s){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),T=Math.round(c.lng*w)/w,P=Math.round(c.lat*w)/w,O=p.getBearing(),D=p.getPitch();let F=s?`/${T}/${P}/${m}`:`${m}/${P}/${T}`;return(O||D)&&(F+="/"+Math.round(10*O)/10),D&&(F+=`/${Math.round(D)}`),F}const Td={linearity:.3,easing:i.eT(0,0,.3,1)},x_=Object.assign({deceleration:2500,maxSpeed:1400},Td),b_=Object.assign({deceleration:20,maxSpeed:1400},Td),Pu=Object.assign({deceleration:1e3,maxSpeed:360},Td),w_=Object.assign({deceleration:1e3,maxSpeed:90},Td);class S_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=i.o.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const w=ll(c.pan.mag(),m,Object.assign({},x_,s||{}));v.offset=c.pan.mult(w.amount/c.pan.mag()),v.center=this._map.transform.center,Ad(v,w)}if(c.zoom){const w=ll(c.zoom,m,b_);v.zoom=this._map.transform.zoom+w.amount,Ad(v,w)}if(c.bearing){const w=ll(c.bearing,m,Pu);v.bearing=this._map.transform.bearing+i.aA(w.amount,-179,179),Ad(v,w)}if(c.pitch){const w=ll(c.pitch,m,w_);v.pitch=this._map.transform.pitch+w.amount,Ad(v,w)}if(v.zoom||v.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Ad(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function ll(p,s,c){const{maxSpeed:m,linearity:v,deceleration:w}=c,T=i.aA(p*v/(s/1e3),-m,m),P=Math.abs(T)/(w*v);return{easing:c.easing,duration:1e3*P,amount:T*(P/2)}}class Rs extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m,v={}){const w=we(c.getCanvasContainer(),m),T=c.unproject(w);super(s,Object.assign({point:w,lngLat:T,originalEvent:m},v)),this._defaultPrevented=!1,this.target=c}}class jc extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){const v=s==="touchend"?m.changedTouches:m.touches,w=ze(c.getCanvasContainer(),v),T=w.map(O=>c.unproject(O)),P=w.reduce((O,D,F,W)=>O.add(D.div(W.length)),new i.P(0,0));super(s,{points:w,point:P,lngLats:T,lngLat:c.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class T_ extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class hm{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new T_(this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new Rs(s.type,this._map,s))}mouseup(s){this._map.fire(new Rs(s.type,this._map,s))}preclick(s){const c=new MouseEvent("preclick",s);this._map.fire(new Rs(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Rs(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Rs(s.type,this._map,s))}mouseover(s){this._map.fire(new Rs(s.type,this._map,s))}mouseout(s){this._map.fire(new Rs(s.type,this._map,s))}touchstart(s){return this._firePreventable(new jc(s.type,this._map,s))}touchmove(s){this._map.fire(new jc(s.type,this._map,s))}touchend(s){this._map.fire(new jc(s.type,this._map,s))}touchcancel(s){this._map.fire(new jc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class A_{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Rs(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Rs(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fm{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(ie(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const m=c,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const T=Math.min(v.x,m.x),P=Math.max(v.x,m.x),O=Math.min(v.y,m.y),D=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${O}px)`,this._box.style.width=P-T+"px",this._box.style.height=D-O+"px")})}mouseupWindow(s,c){if(!this._active)return;const m=this._startPos,v=c;if(m&&s.button===0){if(this.reset(),he(),m.x!==v.x||m.y!==v.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),J(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new i.z(s,{originalEvent:c}))}}function pm(p,s){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=s[m];return c}class _b{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const w=new i.P(0,0);for(const T of v)w._add(T);return w.div(v.length)}(c),this.touches=pm(m,c)))}touchmove(s,c,m){if(this.aborted||!this.centroid)return;const v=pm(m,c);for(const w in this.touches){const T=v[w];(!T||T.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,c,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class mm{constructor(s){this.singleTap=new _b(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,m){this.singleTap.touchstart(s,c,m)}touchmove(s,c,m){this.singleTap.touchmove(s,c,m)}touchend(s,c,m){const v=this.singleTap.touchend(s,c,m);if(v){const w=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(w&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class vb{constructor(){this._zoomIn=new mm({numTouches:1,numTaps:2}),this._zoomOut=new mm({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,m){this._zoomIn.touchstart(s,c,m),this._zoomOut.touchstart(s,c,m)}touchmove(s,c,m){this._zoomIn.touchmove(s,c,m),this._zoomOut.touchmove(s,c,m)}touchend(s,c,m){const v=this._zoomIn.touchend(s,c,m),w=this._zoomOut.touchend(s,c,m);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xb={0:1,2:2},E_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class gm{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const m=je(s);this._correctButton(s,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(s,c){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(v,w){const T=xb[w];return v.buttons===void 0||(v.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(s){this._lastPoint&&je(s)===this._eventButton&&(this._moved&&he(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bb extends gm{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class P_ extends gm{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?E_[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const m=.8*(c.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class C_ extends gm{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?E_[s.pitchRotateKey]:void 0}_correctButton(s,c){return this._pitchRotateKey?c===0&&s[this._pitchRotateKey]:c===0&&s.ctrlKey||c===2}_move(s,c){const m=-.5*(c.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class wb{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,c,m){return this._calculateTransform(s,c,m)}touchmove(s,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!i.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,m)}}touchend(s,c,m){this._calculateTransform(s,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,m){m.length>0&&(this._active=!0);const v=pm(m,c),w=new i.P(0,0),T=new i.P(0,0);let P=0;for(const D in v){const F=v[D],W=this._touches[D];W&&(w._add(F),T._add(F.sub(W)),P++,v[D]=F)}if(this._touches=v,P<this._minTouches||!T.mag())return;const O=T.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ym{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,m){return{}}touchstart(s,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,m){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[w,T]=v,P=Gh(m,c,w),O=Gh(m,c,T);if(!P||!O)return;const D=this._aroundCenter?null:P.add(O).div(2);return this._move([P,O],D,s)}touchend(s,c,m){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,T=Gh(m,c,v),P=Gh(m,c,w);T&&P||(this._active&&he(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gh(p,s,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return s[m]}function Sb(p,s){return Math.log2(p/s)}class $2 extends ym{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Sb(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sb(this._distance,m),pinchAround:c}}}function Tb(p,s){return 180*p.angleWith(s)/Math.PI}class _i extends ym{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Tb(this._vector,m),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=Tb(s,m);return Math.abs(v)<c}}function _m(p){return Math.abs(p.y)>Math.abs(p.x)}class V2 extends ym{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,_m(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,m){const v=this._lastPoints;if(!v)return;const w=s[0].sub(v[0]),T=s[1].sub(v[1]);return this._map._cooperativeGestures&&!i.eU()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(s,c,m){if(this._valid!==void 0)return this._valid;const v=s.mag()>=2,w=c.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=s.y>0==c.y>0;return _m(s)&&_m(c)&&T}}const U2={panStep:100,bearingStep:15,pitchStep:10};class G2{constructor(){const s=U2;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,m=0,v=0,w=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:P=>{const O=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Hh,zoom:c?Math.round(O)+c*(s.shiftKey?2:1):O,bearing:P.getBearing()+m*this._bearingStep,pitch:P.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:P.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hh(p){return p*(2-p)}const I_=4.000244140625,M_=1/450;class vm{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=M_,i.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=i.o.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%I_==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=we(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>I_?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&F!==0&&(F=1/F);const W=c(),H=Math.pow(2,W),q=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(q*F))),this._type==="wheel"&&(this._startZoom=W,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,w=this._easing;let T,P=!1;if(this._type==="wheel"&&v&&w){const D=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),F=w(D);T=i.ak(v,m,F),D<1?this._frameId||(this._frameId=!0):P=!0}else T=m,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=T-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=i.eV;if(this._prevEase){const m=this._prevEase,v=(i.o.now()-m.start)/m.duration,w=m.easing(v+.01)-m.easing(v),T=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-T*T);c=i.eT(T,P,.25,1)}return this._prevEase={start:i.o.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class zl{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro{constructor(){this._tap=new mm({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,c,m))}touchmove(s,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=c[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,c,m)}touchend(s,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,c,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cl{constructor(s,c,m){this._el=s,this._mousePan=c,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wh{constructor(s,c,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bm{constructor(s,c,m,v){this._el=s,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qh=p=>p.zoom||p.drag||p.pitch||p.rotate;class H2 extends i.z{}class Zh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const m=i.av([],c,s);this.radius=i.ag(m[2]<0?i.eX([],m,this.constants):[m[0],m[1],0])}projectRay(s){i.eX(s,s,this.constants),i.aw(s,s),i.eY(s,s,this.constants);const c=i.c5([],s,this.radius);if(c[2]>0){const m=i.c5([],[0,0,1],i.bJ(c,[0,0,1])),v=i.c5([],i.aw([],[c[0],c[1],0]),this.radius),w=i.d8([],c,i.c5([],i.av([],i.d8([],v,m),c),2));c[0]=w[0],c[1]=w[1]}return c}}function wm(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class W2{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new S_(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Zh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,T]of this._listeners){const P=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,P,T)}}destroy(){for(const[s,c,m]of this._listeners){const v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,v,m)}}_addDefaultHandlers(s){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new hm(c,s));const v=c.boxZoom=new fm(c,s);this._add("boxZoom",v);const w=new vb,T=new xm;c.doubleClickZoom=new zl(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const P=new ro;this._add("tapDragZoom",P);const O=c.touchPitch=new V2(c);this._add("touchPitch",O);const D=new P_(s),F=new C_(s);c.dragRotate=new Wh(s,D,F),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const W=new bb(s),H=new wb(c,s);c.dragPan=new cl(m,W,H),this._add("mousePan",W),this._add("touchPan",H,["touchZoom","touchRotate"]);const q=new _i,ee=new $2;c.touchZoomRotate=new bm(m,ee,q,P),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new A_(c));const Y=c.scrollZoom=new vm(c,this);this._add("scrollZoom",Y,["mousePan"]);const ae=c.keyboard=new G2;this._add("keyboard",ae);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[oe]&&c[oe].enable(s[oe])}_add(s,c,m){this._handlers.push({handlerName:s,handler:c,allowed:m}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,m){for(const v in s)if(v!==m&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const m of s)this._el.contains(m.target)&&c.push(m);return c}handleEvent(s,c){this._updatingCamera=!0;const m=s.type==="renderFrame",v=m?void 0:s,w={needsRenderFrame:!1},T={},P={},O=s.touches?this._getMapTouches(s.touches):void 0,D=O?ze(this._el,O):m?void 0:we(this._el,s);for(const{handlerName:H,handler:q,allowed:ee}of this._handlers){if(!q.isEnabled())continue;let Y;this._blockedByActive(P,ee,H)?q.reset():q[c||s.type]&&(Y=q[c||s.type](s,D,O),this.mergeHandlerResult(w,T,Y,H,v),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||q.isActive())&&(P[H]=q)}const F={};for(const H in this._previousActiveHandlers)P[H]||(F[H]=v);this._previousActiveHandlers=P,(Object.keys(F).length||wm(w))&&(this._changes.push([w,T,F]),this._triggerRenderFrame()),(Object.keys(P).length||wm(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=w;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))}mergeHandlerResult(s,c,m,v,w){if(!m)return;Object.assign(s,m);const T={handlerName:v,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(c.zoom=T),m.panDelta!==void 0&&(c.drag=T),m.pitchDelta!==void 0&&(c.pitch=T),m.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const s={},c={},m={};for(const[v,w,T]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),Object.assign(c,w),Object.assign(m,T);this._updateMapTransform(s,c,m),this._changes=[]}_updateMapTransform(s,c,m){const v=this._map,w=v.transform,T=de=>[de.x,de.y,de.z];if((de=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!wm(s)){const de=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),de!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!wm(s))return void this._fireEvents(c,m,!0);let{panDelta:P,zoomDelta:O,bearingDelta:D,pitchDelta:F,around:W,aroundCoord:H,pinchAround:q}=s;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),q!==void 0&&(W=q),(O||(de=>c[de]&&!this._eventsInProgress[de])("drag"))&&W&&(this._dragOrigin=T(w.pointCoordinate3D(W)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),W=W||v.transform.centerPoint,D&&(w.bearing+=D),F&&(w.pitch+=F),w._updateCameraState();const ee=[0,0,0];if(P)if(w.projection.name==="mercator"){const de=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(W).dir),me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(W.sub(P)).dir);ee[0]=me[0]-de[0],ee[1]=me[1]-de[1]}else{const de=w.pointCoordinate(W);if(w.projection.name==="globe"){P=P.rotate(-w.angle);const me=w._pixelsPerMercatorPixel/w.worldSize;ee[0]=-P.x*i.eW(i.a$(de.y))*me,ee[1]=-P.y*i.eW(w.center.lat)*me}else{const me=w.pointCoordinate(W.sub(P));de&&me&&(ee[0]=me.x-de.x,ee[1]=me.y-de.y)}}const Y=w.zoom,ae=[0,0,0];if(O){const de=T(H||w.pointCoordinate3D(W)),me={dir:i.aw([],i.av([],de,w._camera.position))};if(me.dir[2]<0){const fe=w.zoomDeltaToMovement(de,O);i.c5(ae,me.dir,fe)}}const oe=i.d8(ee,ee,ae);w._translateCameraConstrained(oe),O&&Math.abs(w.zoom-Y)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,m,!0)}_fireEvents(s,c,m){const v=qh(this._eventsInProgress),w=qh(s),T={};for(const F in s){const{originalEvent:W}=s[F];this._eventsInProgress[F]||(T[`${F}start`]=W),this._eventsInProgress[F]=s[F]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const F in T)this._fireEvent(F,T[F]);w&&this._fireEvent("move",w.originalEvent);for(const F in s){const{originalEvent:W}=s[F];this._fireEvent(F,W)}const P={};let O;for(const F in this._eventsInProgress){const{handlerName:W,originalEvent:H}=this._eventsInProgress[F];this._handlersById[W].isActive()||(delete this._eventsInProgress[F],O=c[W]||H,P[`${F}end`]=O)}for(const F in P)this._fireEvent(F,P[F]);const D=qh(this._eventsInProgress);if(m&&(v||w)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;F?(W(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:O})):(this._map.fire(new i.z("moveend",{originalEvent:O})),W(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new i.z(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new H2("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Sm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class O_ extends i.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aY(["_renderFrameCallback"],this)}getCenter(){return new i.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,m){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},c),m)}panTo(s,c,m){return this.easeTo(Object.assign({center:s},c),m)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,m){return this.easeTo(Object.assign({zoom:s},c),m)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,m){return this.easeTo(Object.assign({bearing:s},c),m)}resetNorth(s,c){return this.rotateTo(0,Object.assign({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=i.aI.convert(s);const m=c&&c.bearing||0,v=c&&c.pitch||0,w=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,w,T,m,v,c)}_extendPadding(s){const c={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},c,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},c,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,c){const m=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return m/v>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,m,v,w,T){const P=s.clone(),O=this._extendCameraOptions(T);P.bearing=v,P.pitch=w;const D=i.aT.convert(c),F=i.aT.convert(m),W=.5*(D.lat+F.lat),H=.5*(D.lng+F.lng),q=i.eZ(W,H),ee=i.aw([],q),Y=i.aw([],i.bI([],ee,[0,1,0])),ae=i.bI([],Y,ee),oe=[Y[0],Y[1],Y[2],0,ae[0],ae[1],ae[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],de=[q,i.eZ(D.lat,D.lng),i.eZ(F.lat,D.lng),i.eZ(F.lat,F.lng),i.eZ(D.lat,F.lng),i.eZ(W,D.lng),i.eZ(W,F.lng),i.eZ(D.lat,H),i.eZ(F.lat,H)];let me=i.d9.fromPoints(de.map(Ye=>[i.bJ(Y,Ye),i.bJ(ae,Ye),i.bJ(ee,Ye)]));const fe=i.af([],me.center,oe);i.e_(fe)===0&&i.e$(fe,0,0,1),i.aw(fe,fe),i.c5(fe,fe,i.aD),P.center=i.f0(fe);const Pe=P.getWorldToCameraMatrix(),be=i.bl(new Float64Array(16),Pe);me=i.d9.applyTransform(me,i.aB([],Pe,oe));const Ae=this._extendAABB(me,P,O,v);if(!Ae)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Ae,i.af(fe,fe,Pe);const xe=.5*(me.max[2]-me.min[2]),ye=this._minimumAABBFrustumDistance(P,me),Ce=i.c5([],[0,0,1],xe),$e=i.d8(Ce,fe,Ce),Ne=ye+(P.pitch===0?0:i.bG(fe,$e)),et=P.globeCenterInViewSpace,tt=i.av([],fe,[et[0],et[1],et[2]]);i.aw(tt,tt),i.c5(tt,tt,Ne);const dt=i.d8([],fe,tt);i.af(dt,dt,be);const Tt=i.eM/i.aD,Ze=i.ag(dt),ke=i.cf(Math.max(Ze*Tt-i.eM,Number.EPSILON),0),st=Math.min(P.zoomFromMercatorZAdjusted(ke),O.maxZoom);return st>.5*(i.c_+i.cL)?(P.setProjection({name:"mercator"}),P.zoom=st,this._cameraForBounds(P,c,m,v,w,T)):{center:P.center,zoom:st,bearing:v,pitch:w}}_extendAABB(s,c,m,v){const w=.5*((m.padding.left||0)+(m.padding.right||0)),T=.5*((m.padding.top||0)+(m.padding.bottom||0)),P=T,O=w,D=w,F=T,W=c.width-(O+D),H=c.height-(P+F),q=i.av([],s.max,s.min),ee=Math.min(W/q[0],H/q[1]),Y=Math.min(c.scaleZoom(c.scale*ee),m.maxZoom);if(isNaN(Y))return null;const ae=c.scale/c.zoomScale(Y),oe=new i.d9([s.min[0]-O*ae,s.min[1]-F*ae,s.min[2]],[s.max[0]+D*ae,s.max[1]+P*ae,s.max[2]]),de=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new i.P(m.offset.x,m.offset.y):i.P.convert(m.offset)).rotate(-i.an(v));return oe.center[0]-=de.x*ae,oe.center[1]+=de.y*ae,oe}queryTerrainElevation(s,c){const m=this.transform.elevation;return m?(c=Object.assign({},{exaggerated:!0},c),m.getAtPoint(i.ae.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,m,v,w,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,m,v,w,T);const P=s.clone(),O=this._extendCameraOptions(T);P.bearing=v,P.pitch=w;const D=i.aT.convert(c),F=i.aT.convert(m),W=new i.aT(D.lng,F.lat),H=new i.aT(F.lng,D.lat),q=P.project(D),ee=P.project(F),Y=this.queryTerrainElevation(D),ae=this.queryTerrainElevation(F),oe=this.queryTerrainElevation(W),de=this.queryTerrainElevation(H),me=[[q.x,q.y,Math.min(Y||0,ae||0,oe||0,de||0)],[ee.x,ee.y,Math.max(Y||0,ae||0,oe||0,de||0)]];let fe=i.d9.fromPoints(me);const Pe=P.getWorldToCameraMatrix(),be=i.bl(new Float64Array(16),Pe);fe=i.d9.applyTransform(fe,Pe);const Ae=this._extendAABB(fe,P,O,v);if(!Ae)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Ae;const xe=.5*i.av([],fe.max,fe.min)[2],ye=this._minimumAABBFrustumDistance(P,fe),Ce=[0,0,1,0];i.aC(Ce,Ce,Pe),i.f1(Ce,Ce);const $e=i.c5([],Ce,ye+xe),Ne=i.d8([],fe.center,$e);i.af(fe.center,fe.center,be),i.af(Ne,Ne,be);const et=P.unproject(new i.P(fe.center[0],fe.center[1])),tt=i.f2(P.projection,et),dt=Math.pow(2,tt),Tt=Math.min(P._zoomFromMercatorZ(Ne[2]*P.pixelsPerMeter*dt/P.worldSize),O.maxZoom);return P.mercatorFromTransition&&Tt<.5*(i.c_+i.cL)?(P.setProjection({name:"globe"}),P.zoom=Tt,this._cameraForBounds(P,c,m,v,w,T)):{center:et,zoom:Tt,bearing:v,pitch:w}}fitBounds(s,c,m){const v=this.cameraForBounds(s,c);return this._fitInternal(v,c,m)}fitScreenCoordinates(s,c,m,v,w){const T=i.P.convert(s),P=i.P.convert(c),O=new i.P(Math.min(T.x,P.x),Math.min(T.y,P.y)),D=new i.P(Math.max(T.x,P.x),Math.max(T.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,P))return this;const F=this.transform.pointLocation3D(O),W=this.transform.pointLocation3D(D),H=this.transform.pointLocation3D(new i.P(O.x,D.y)),q=this.transform.pointLocation3D(new i.P(D.x,O.y)),ee=[Math.min(F.lng,W.lng,H.lng,q.lng),Math.min(F.lat,W.lat,H.lat,q.lat)],Y=[Math.max(F.lng,W.lng,H.lng,q.lng),Math.max(F.lat,W.lat,H.lat,q.lat)],ae=v&&v.pitch?v.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,ee,Y,m,ae,v);return this._fitInternal(oe,v,w)}_fitInternal(s,c,m){return s?(c=Object.assign(s,c)).linear?this.easeTo(c,m):this.flyTo(c,m):this}jumpTo(s,c){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,T=!1;"zoom"in s&&m.zoom!==+s.zoom&&(v=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=i.aT.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(w=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(T=!0,m.pitch=+s.pitch);const P=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!m.isPaddingEqual(P))if(s.retainPadding===!1){const O=m.clone();O.padding=P,m.setLocationAtPoint(m.center,O.centerPoint)}else m.padding=P;return s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),v&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),w&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),T&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Sm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return i.w(Sm),this;this.stop();const v=m.zoom,w=m.pitch,T=m.bearing;m.setFreeCameraOptions(s);const P=v!==m.zoom,O=w!==m.pitch,D=T!==m.bearing;return this.fire(new i.z("movestart",c)).fire(new i.z("move",c)),P&&this.fire(new i.z("zoomstart",c)).fire(new i.z("zoom",c)).fire(new i.z("zoomend",c)),D&&this.fire(new i.z("rotatestart",c)).fire(new i.z("rotate",c)).fire(new i.z("rotateend",c)),O&&this.fire(new i.z("pitchstart",c)).fire(new i.z("pitch",c)).fire(new i.z("pitchend",c)),this.fire(new i.z("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:i.eV},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,v=this.getZoom(),w=this.getBearing(),T=this.getPitch(),P=this.getPadding(),O="zoom"in s?+s.zoom:v,D="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:T,W=this._extendPadding(s.padding),H=i.P.convert(s.offset);let q,ee,Y;if(m.projection.name==="globe"){const Ce=i.ae.fromLngLat(m.center),$e=H.rotate(-m.angle);Ce.x+=$e.x/m.worldSize,Ce.y+=$e.y/m.worldSize;const Ne=Ce.toLngLat(),et=i.aT.convert(s.center||Ne);this._normalizeCenter(et),q=m.centerPoint.add($e),ee=new i.P(Ce.x,Ce.y).mult(m.worldSize),Y=new i.P(i.aF(et.lng),i.aJ(et.lat)).mult(m.worldSize).sub(ee)}else{q=m.centerPoint.add(H);const Ce=m.pointLocation(q),$e=i.aT.convert(s.center||Ce);this._normalizeCenter($e),ee=m.project(Ce),Y=m.project($e).sub(ee)}const ae=m.zoomScale(O-v);let oe,de;s.around&&(oe=i.aT.convert(s.around),de=m.locationPoint(oe));const me=this._zooming||O!==v,fe=this._rotating||w!==D,Pe=this._pitching||F!==T,be=!m.isPaddingEqual(W),Ae=s.retainPadding===!1?m.clone():m,xe=Ce=>$e=>{if(me&&(Ce.zoom=i.ak(v,O,$e)),fe&&(Ce.bearing=i.ak(w,D,$e)),Pe&&(Ce.pitch=i.ak(T,F,$e)),be&&(Ae.interpolatePadding(P,W,$e),q=Ae.centerPoint.add(H)),oe)Ce.setLocationAtPoint(oe,de);else{const Ne=Ce.zoomScale(Ce.zoom-v),et=O>v?Math.min(2,ae):Math.max(.5,ae),tt=Math.pow(et,1-$e),dt=Ce.unproject(ee.add(Y.mult($e*tt)).mult(Ne));Ce.setLocationAtPoint(Ce.renderWorldCopies?dt.wrap():dt,q)}return s.preloadOnly||this._fireMoveEvents(c),Ce};if(s.preloadOnly){const Ce=this._emulate(xe,s.duration,m);return this._preloadTiles(Ce),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=fe,this._pitching=Pe,this._padding=be,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,ye),this._ease(xe(m),Ce=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(c,Ce)},s),this}_prepareEase(s,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new i.z("movestart",s)),this._zooming&&!m.zooming&&this.fire(new i.z("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new i.z("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new i.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.z("move",s)),this._zooming&&this.fire(new i.z("zoom",s)),this._rotating&&this.fire(new i.z("rotate",s)),this._pitching&&this.fire(new i.z("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new i.z("zoomend",s)),v&&this.fire(new i.z("rotateend",s)),w&&this.fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const Ye=i.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ye,c)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eV},s);const m=this.transform,v=this.getZoom(),w=this.getBearing(),T=this.getPitch(),P=this.getPadding(),O="zoom"in s?i.aA(+s.zoom,m.minZoom,m.maxZoom):v,D="bearing"in s?this._normalizeBearing(s.bearing,w):w,F="pitch"in s?+s.pitch:T,W=this._extendPadding(s.padding),H=m.zoomScale(O-v),q=i.P.convert(s.offset);let ee=m.centerPoint.add(q);const Y=m.pointLocation(ee),ae=i.aT.convert(s.center||Y);this._normalizeCenter(ae);const oe=m.project(Y),de=m.project(ae).sub(oe);let me=s.curve;const fe=Math.max(m.width,m.height),Pe=fe/H,be=de.mag();if("minZoom"in s){const Ye=i.aA(Math.min(s.minZoom,v,O),m.minZoom,m.maxZoom),gt=fe/m.zoomScale(Ye-v);me=Math.sqrt(gt/be*2)}const Ae=me*me;function xe(Ye){const gt=(Pe*Pe-fe*fe+(Ye?-1:1)*Ae*Ae*be*be)/(2*(Ye?Pe:fe)*Ae*be);return Math.log(Math.sqrt(gt*gt+1)-gt)}function ye(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Ce(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const $e=xe(0);let Ne=function(Ye){return Ce($e)/Ce($e+me*Ye)},et=function(Ye){return fe*((Ce($e)*(ye(gt=$e+me*Ye)/Ce(gt))-ye($e))/Ae)/be;var gt},tt=(xe(1)-$e)/me;if(Math.abs(be)<1e-6||!isFinite(tt)){if(Math.abs(fe-Pe)<1e-6)return this.easeTo(s,c);const Ye=Pe<fe?-1:1;tt=Math.abs(Math.log(Pe/fe))/me,et=function(){return 0},Ne=function(gt){return Math.exp(Ye*me*gt)}}s.duration="duration"in s?+s.duration:1e3*tt/("screenSpeed"in s?+s.screenSpeed/me:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const dt=w!==D,Tt=F!==T,Ze=!m.isPaddingEqual(W),ke=s.retainPadding===!1?m.clone():m,st=Ye=>gt=>{const Rt=gt*tt,Vt=1/Ne(Rt);Ye.zoom=gt===1?O:v+Ye.scaleZoom(Vt),dt&&(Ye.bearing=i.ak(w,D,gt)),Tt&&(Ye.pitch=i.ak(T,F,gt)),Ze&&(ke.interpolatePadding(P,W,gt),ee=ke.centerPoint.add(q));const It=gt===1?ae:Ye.unproject(oe.add(de.mult(et(Rt))).mult(Vt));return Ye.setLocationAtPoint(Ye.renderWorldCopies?It.wrap():It,ee),Ye._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),Ye};if(s.preloadOnly){const Ye=this._emulate(st,s.duration,m);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=dt,this._pitching=Tt,this._padding=Ze,this._prepareEase(c,!1),this._ease(st(m),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,c,m){m.animate===!1||m.duration===0?(s(1),c()):(this._easeStart=i.o.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=i.bT(s,-180,180);const m=Math.abs(s-c);return Math.abs(s-360-c)<m&&(s-=360),Math.abs(s+360-c)<m&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const m=s.lng-c.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,m){const v=Math.ceil(15*c/1e3),w=[],T=s(m.clone());for(let P=0;P<=v;P++){const O=T(P/v);w.push(O.clone())}return w}_preloadTiles(s,c){}}class Kh{constructor(s={}){this.options=s,i.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact,m=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const v=z("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",m),this._innerContainer=z("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(s){const m=c.reduce((v,w,T)=>(w.value&&(v+=`${w.key}=${w.value}${T<c.length-1?"&":""}`),v),"?");s.href=`${i.e.FEEDBACK_URL}/${m}#${to(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const w=c[v];if(w.used){const T=w.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((v,w)=>v.length-w.length),s=s.filter((v,w)=>{for(let T=w+1;T<s.length;T++)if(s[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.map(v=>function(w){const T=new DOMParser().parseFromString(w,"text/html");return Array.from(T.body.querySelectorAll("*")).forEach(P=>{const O=P.textContent||"";if(P.tagName!=="A")return void P.replaceWith(T.createTextNode(O));const D=P.getAttribute("href");if(!D||!/^(https?:|mailto:)/i.test(D))return void P.replaceWith(T.createTextNode(O));const F=T.createElement("a");F.href=D,F.textContent=O,F.rel="noopener nofollow";const W=P.getAttribute("class");W&&(F.className=W),P.replaceWith(F)}),T.body.innerHTML}(v)).join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xh{constructor(){i.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=z("div","mapboxgl-ctrl");const c=z("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const m=s[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Ed{constructor(){i.aY(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",c=>this._onIndoorUpdate(c)),this._container}_createButton(s,c){const m=z("button",s,this._container);return m.type="button",m.addEventListener("click",c),m}_createSeparator(){return z("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,c){this._map&&(s.setAttribute("aria-label",c),s.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return this._model=s,void(this._container.style.display="none");const c=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px",c&&Array.from(this._container.children).forEach(m=>m.remove()),s.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(s.floors,s.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const s=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const c=this._map;this._model&&c&&c._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});z("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&s.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(s),this._createSeparator()}_updateBuildingsButtonState(){const s=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");s&&this._model&&(this._model.activeFloorsVisible?s.classList.remove("mapboxgl-ctrl-level-button-selected"):s.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(s,c){for(let m=0;m<s.length;m++){const v=s[m],w=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(v.id)});this._setButtonTitle(w,v.zIndex.toString()),this._model&&v.id===this._model.selectedFloorId&&c&&w.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(w),m<s.length-1&&this._createSeparator()}}}class Fl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const v of m)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Bl{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=i.dD((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,m){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+m}}const $l={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Dc extends i.z{constructor(s,c,m,v){const{point:w,lngLat:T,originalEvent:P,target:O}=s;super(s.type,{point:w,lngLat:T,originalEvent:P,target:O}),this.preventDefault=()=>{s.preventDefault()},this.id=c,this.interaction=m,this.feature=v}}class Na{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,c){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const m=c.filter;let v=c.type;m&&this.filters.set(s,i.b6(m)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const w=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,c)):w.size===0&&this.map.on(v,this.handleType),w.size===0&&this.interactionsByType.set(v,w),w.set(s,c),this.typeById.set(s,v)}get(s){const c=this.typeById.get(s);if(!c)return;const m=this.interactionsByType.get(c);return m?m.get(s):void 0}remove(s){const c=this.typeById.get(s);if(!c)return;this.typeById.delete(s),this.filters.delete(s);const m=this.interactionsByType.get(c);m&&(m.delete(s),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(c,this.handleType))}queryTargets(s,c){const m=[];for(const[v,w]of c)w.target&&m.push({targetId:v,target:w.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(s,m,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());c.length&&(s.type="mouseenter",this.handleType(s,c));const m=new Map;for(const[v,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||m.set(w.id,w);m.size&&(s.type="mouseleave",this.handleType(s,Array.from(m.values())))}handleOut(s){const c=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);c.length&&(s.type="mouseleave",this.handleType(s,c)),this.hoveredFeatures.clear()}handleType(s,c){const m=s.type==="mouseenter";if(m&&!this.interactionsByType.has(s.type))return void i.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(s.type)).reverse(),w=!!c;c=c||this.queryTargets(s.point,v);let T=!1;const P=new Set;for(const O of c){for(const[D,F]of v){if(!F.target)continue;const W=O.variants?O.variants[D]:null;if(W){for(const H of W){if(id(H,O,P,D))continue;const q=new i.dx(O,H),ee=cu(H,O,D);w&&q.id!==void 0&&(q.state=this.map.getFeatureState(q));const Y=m?this.prevHoveredFeatures.get(ee):null,ae=new Dc(s,D,F,q),oe=Y?Y.stop:F.handler(ae);if(m&&this.hoveredFeatures.set(ee,{feature:O,stop:oe}),oe!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[O,D]of v){const{handler:F,target:W}=D;if(!W&&F(new Dc(s,O,D,null))!==!1)break}}}function q2(p,s){if(Array.isArray(p)&&Array.isArray(s)){const c=new Set(p),m=new Set(s);return c.size===m.size&&p.every(v=>m.has(v))}return i.by(p,s)}const Z2={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},K2={showCompass:!0,showZoom:!0,visualizePitch:!1};class X2{constructor(s,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new P_({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new C_({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),ie()}move(s,c){const m=this.map,v=this.mouseRotate.mousemoveWindow(s,c),w=v&&v.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(s,c),P=T&&T.pitchDelta;P&&m.setPitch(m.getPitch()+P)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){J(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),we(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,we(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ze(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=ze(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function R_(p,s,c){if(p=new i.aT(p.lng,p.lat),s){const m=new i.aT(p.lng-360,p.lat),v=new i.aT(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),T=c.locationPoint3D(p).distSqr(s),P=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint3D(m).distSqr(s)<T&&(P||Math.abs(m.lng-c.center.lng)<w)?p=m:c.locationPoint3D(v).distSqr(s)<T&&(P||Math.abs(v.lng-c.center.lng)<w)&&(p=v)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Xo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},pa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Tm extends i.E{constructor(s,c){super(),(s instanceof HTMLElement||c)&&(s=Object.assign({element:s},c)),i.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:v="#3FB1CE",scale:w=1,draggable:T=!1,clickTolerance:P=0,rotation:O=pa.rotation,rotationAlignment:D=pa.rotationAlignment,pitchAlignment:F=pa.pitchAlignment,occludedOpacity:W=pa.occludedOpacity,altitude:H=pa.altitude}=s||{};this._anchor=m,this._color=v,this._scale=w,this._draggable=T,this._clickTolerance=P,this._rotation=O,this._rotationAlignment=D,this._pitchAlignment=F,this._occludedOpacity=W,this._altitude=H,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const q=this._element.classList;for(const Y in Xo)q.remove(`mapboxgl-marker-anchor-${Y}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ee=s&&s.className?s.className.trim().split(/\s+/):[];q.add(...ee),this._popup=null}_createDefaultMarker(){const s=z("div"),c=V("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const m=V("radialGradient",{id:"shadowGradient"},V("defs",{},c));V("stop",{offset:"10%","stop-opacity":.4},m),V("stop",{offset:"100%","stop-opacity":.05},m),V("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return V("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),V("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),V("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.aT.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||pa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,m=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const m=s.unproject(c,this._altitude),v=s.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(c,this._altitude);let v;s._showingGlobe()&&i.f5(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Xo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!s||m!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const v=i.cX(i.f6(c.transform,this._lngLat)),w=s.sub(i.f7(c.transform)),T=Math.abs(w.x)+Math.abs(w.y);if(T===0)return"";const P=v/T;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){const w=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=c.project(new i.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);m=i.cX(Math.atan2(T.y,T.x))-90}else m=-c.getBearing();else if(v==="horizon"){const w=i.ah(4,6,c.getZoom()),T=i.f7(c.transform);T.y+=w*c.transform.height;const P=s.sub(T),O=i.cX(Math.atan2(P.y,P.x));m=(O>90?O-270:O+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=R_(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(s.point.dist(m)<w)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,m=this._pos;c&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||pa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||pa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||pa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||pa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Y2={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pd={maxWidth:100,unit:"metric"},k_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ma={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ga=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cu(p=new i.P(0,0),s="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new i.P(0,p);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-p);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(p,0);case"right":return new i.P(-p,0)}return new i.P(0,0)}return p instanceof i.P||Array.isArray(p)?i.P.convert(p):i.P.convert(p[s]||[0,0])}return{version:S,supported:G.supported,setRTLTextPlugin:i.fb,getRTLTextPluginStatus:i.fa,Map:class extends O_{constructor(p){I.mark(E.create);const s=p;if((p=Object.assign({},Z2,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&i.f3(window)&&(p.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ly(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Fl,this._domRenderTaskQueue=new Fl,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b2(),this._locale=Object.assign({},$l,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new Xe(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,i.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new W2(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||i.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new v_(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Kh({customAttribution:p.customAttribution})),this._logoControl=new Xh,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.z(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.z(`${c.dataType}dataloading`,c))}),this._interactions=new Na(this)}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new i.z("movestart",p)).fire(new i.z("move",p)),this.fire(new i.z("resize",p)),s&&this.fire(new i.z("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(i.aI.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let c;s==="globe"&&p.zoom>=i.cL?(p.setMercatorFromTransition(),c=!0):s==="mercator"&&p.zoom<i.cL&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;const c=this.transform.mercatorFromTransition;s=p.name==="globe"&&this.transform.zoom>=i.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate();const m=this.transform.getProjection().name==="mercator"&&c!==this.transform.mercatorFromTransition;return(s||m)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,s){return this.transform.locationPoint3D(i.aT.convert(p),s)}unproject(p,s){return this.transform.pointLocation3D(i.P.convert(p),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,c){const m=v=>{let w=[];if(Array.isArray(s)){const T=s.filter(P=>this.getLayer(P));w=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else w=this.queryRenderedFeatures(v,{target:s});return w};if(p==="mouseenter"||p==="mouseover"){let v=!1;return{listener:c,targets:s,delegates:{mousemove:T=>{const P=m(T.point);P.length?v||(v=!0,c.call(this,new Rs(p,this,T.originalEvent,{features:P}))):v=!1},mouseout:()=>{v=!1}}}}if(p==="mouseleave"||p==="mouseout"){let v=!1;return{listener:c,targets:s,delegates:{mousemove:P=>{m(P.point).length?v=!0:v&&(v=!1,c.call(this,new Rs(p,this,P.originalEvent)))},mouseout:P=>{v&&(v=!1,c.call(this,new Rs(p,this,P.originalEvent)))}}}}{const v=w=>{const T=m(w.point);T.length&&(w.features=T,c.call(this,w),delete w.features)};return{listener:c,targets:s,delegates:{[p]:v}}}}on(p,s,c){if(typeof s=="function"||c===void 0)return super.on(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,s,c){if(typeof s=="function"||c===void 0)return super.once(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,c);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,s,c){if(typeof s=="function"||c===void 0)return super.off(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(v=>{for(let w=0;w<v.length;w++){const T=v[w];if(T.listener===c&&q2(T.targets,s)){for(const P in T.delegates)this.off(P,T.delegates[P]);return v.splice(w,1),this}}})(m),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(p===void 0||p instanceof i.P||Array.isArray(p)||s!==void 0||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!s){const w=this.style.queryRenderedFeatures(p,void 0,this.transform),T=this.style.queryRenderedFeatureset(p,void 0,this.transform);return w.concat(T)}let c=!0;if(s.target&&(c=this._isTargetValid(s.target),c&&!s.layers))return this.style.queryRenderedFeatureset(p,s,this.transform);let m=!0;if(s.layers&&Array.isArray(s.layers)){for(const w of s.layers)if(!this._isValidId(w)){m=!1;break}if(m&&!s.target)return this.style.queryRenderedFeatures(p,s,this.transform)}let v=[];return m&&(v=v.concat(this.style.queryRenderedFeatures(p,s,this.transform))),c&&(v=v.concat(this.style.queryRenderedFeatureset(p,s,this.transform))),v}querySourceFeatures(p,s){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,s)}queryRasterValue(p,s,c){return this._isValidId(p)?this.style.queryRasterValue(p,s,c):Promise.resolve(null)}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(p))}addInteraction(p,s){return this._interactions.add(p,s),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&p&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(p,(c,m)=>{if(c){const v=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(p,s)}else m&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=Object.assign({},s);s&&s.config&&(c.initialConfig=s.config,delete c.config),this.style=new fa(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new fa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dr(p)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const s of p)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(p)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:c=1,sdf:m=!1,stretchX:v,stretchY:w,content:T}={}){this._lazyInitEmptyStyle();const P=i.I.from(p);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:O,height:D,data:F}=i.o.getImageData(s);this.style.addImage(P,{data:new i.q({width:O,height:D},F),pixelRatio:c,stretchX:v,stretchY:w,content:T,sdf:m,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:D}=s,F=s;this.style.addImage(P,{data:new i.q({width:O,height:D},new Uint8Array(F.data)),pixelRatio:c,stretchX:v,stretchY:w,content:T,sdf:m,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();const c=i.I.from(p),m=this.style.getImage(c);if(!m)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.o.getImageData(s):s,{width:w,height:T,data:P}=v;if(w===void 0||T===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||T!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${w}, ${T})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const O=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let D=!1;m.usvg?(m.data=new i.q({width:w,height:T},new Uint8Array(P)),m.usvg=!1,m.icon=void 0,D=!0):m.data.replace(P,O),this.style.updateImage(c,m,D)}hasImage(p){return p?!!this.style&&!!this.style.getImage(i.I.from(p)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(i.I.from(p))}loadImage(p,s){i.n(this._requestManager.transformRequest(p,i.R.Image),(c,m)=>{s(c,m instanceof HTMLImageElement?i.o.getImageData(m):m)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){const s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s).catch(c=>this.fire(new i.y(new Error("Failed to add import",c)))),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const s=this.style.getOwnLayer(p);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,s,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,c),this._update(!0)):this}setFilter(p,s,c={}){return this._isValidId(p)?(this.style.setFilter(p,s,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,c,m),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,c,m),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}setLayerProperty(p,s,c,m={}){return this._isValidId(p)?(s==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(p,s,c,m),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,s){return this.style.setSchema(p,s),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,s){return this.style.setConfig(p,s),this._update(!0)}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,c){return this.style.setConfigProperty(p,s,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,s),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aT.convert(p),this.transform):0}setFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,s),this._update())}removeFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,s),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_setIndoorActiveFloorsVisibility(p){this.indoor.setActiveFloorsVisibility(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ed),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,m,v,w=this._container;for(;w&&(!m||!v);){const T=window.getComputedStyle(w).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),w=w.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Rx(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=z("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=z("div","mapboxgl-canvas-container",p);this._canvas=z("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=z("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{m[v]=z("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const c=i.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=Object.assign({},G.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(zn(s,!0),this.painter=new um(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(s)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new i.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,m=i.o.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,F=this.transform.pitch,W=i.o.now(),H=new i.ac(D,{now:W,fadeDuration:w,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(H)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(m);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(E.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const D=i.o.now()-m;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const F=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new i.z("gpu-timing-frame",{cpuTime:D,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(D);this.fire(new i.z("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(D);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:F}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(O||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(T=this._updateAverageElevation(m,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,I.mark(E.fullLoad),this._performanceMetricsCollection&&zr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const T=Math.abs(v-w);if(T>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,p,300)}else if(T>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){hi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===qe||p.status===401)){const s=this.painter.context.gl;zn(s,!1),this._logoControl instanceof Xh&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&lr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Lt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){pr(this._requestManager._customAccessToken)}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function v(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(p,s,c){let m=c[1]-c[0];const v=p.length/4;for(let w=0;w<s.length;w++){const T=s[w];let P=0;for(let O=0;O<T.length;O+=4)T[O]===p[O]&&T[O+1]===p[O+1]&&T[O+2]===p[O+2]&&T[O+3]===p[O+3]&&(P+=1);m+=(c[w+2]-c[w+1])*(1-P/v)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Hn.delete(this.painter.context.gl),un.remove(),br.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=i.o.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(p){const s=this.style?this.style.getSourceCaches():[];return i.bw(s,(c,m)=>c._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this.style&&p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){i.f4(p,s)}get version(){return S}},NavigationControl:class{constructor(p={}){this.options=Object.assign({},K2,p),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(i.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),c=s===p.getMaxZoom(),m=s===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new X2(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const c=z("button",p,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(p,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(p={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},Y2,p),i.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dm(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>s(c.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),c=p.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:p.coords,timestamp:p.timestamp},p.toJSON?{toJSON:p.toJSON.bind(p)}:{}))),this._finish()}}_updateCamera(p){const s=new i.aT(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),v=Object.assign({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),v,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new i.aT(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=i.cf(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=z("button","mapboxgl-ctrl-geolocate",this._container),z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z("div","mapboxgl-user-location"),this._dotElement.appendChild(z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Tm({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tm({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kh,ScaleControl:class{constructor(p={}){this.options=Object.assign({},Pd,p),i.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,m=s._containerWidth/2-p/2,v=s.unproject([m,c]),w=s.unproject([m+p,c]),T=v.distanceTo(w);if(this.options.unit==="imperial"){const P=3.2808*T;P>5280?this._setScale(p,P/5280,"mile"):this._setScale(p,P,"foot")}else this.options.unit==="nautical"?this._setScale(p,T/1852,"nautical-mile"):T>=1e3?this._setScale(p,T/1e3,"kilometer"):this._setScale(p,T,"meter")}_setScale(p,s,c){this._map._requestDomTask(()=>{const m=function(w){const T=Math.pow(10,`${Math.floor(w)}`.length-1);let P=w/T;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const D=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*D)/D}(P),T*P}(s),v=m/s;this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${k_[c]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:i.w("Full screen control 'container' must be a DOM element.")),i.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ed,Popup:class extends i.E{constructor(p){super(),this.options=Object.assign(Object.create(ma),p),this._altitude=this.options.altitude,i.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=i.aT.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const s=document.createDocumentFragment(),c=document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=z("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const c=this._closeButton=z("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,m=this._pos;if(!s||!c||!m)return"bottom";const v=c.offsetWidth,w=c.offsetHeight,T=m.x<v/2,P=m.x>s.transform.width-v/2;if(m.y+p<w)return T?"top-left":P?"top-right":"top";if(m.y>s.transform.height-w){if(T)return"bottom-left";if(P)return"bottom-right"}return T?"left":P?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=z("div","mapboxgl-popup",s.getContainer()),this._tip=z("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=R_(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p instanceof i.P?p:s.project(this._lngLat,this._altitude),w=Cu(this.options.offset),T=this._anchor=this._getAnchor(w.y),P=Cu(this.options.offset,T),O=v.add(P).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Xo[T]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=i.f5(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(ga);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Tm,Style:fa,LngLat:i.aT,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:vs,Evented:i.E,config:i.e,prewarm:i.f9,clearPrewarmedResources:i.f8,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(p){i.e.ACCESS_TOKEN=p},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(p){i.e.API_URL=p},get workerCount(){return i.fi.workerCount},set workerCount(p){i.fi.workerCount=p},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){i.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){i.fh(p)},get workerUrl(){return i.fg.workerUrl},set workerUrl(p){i.fg.workerUrl=p},get workerClass(){return i.fg.workerClass},set workerClass(p){i.fg.workerClass=p},get workerParams(){return i.fg.workerParams},set workerParams(p){i.fg.workerParams=p},get dracoUrl(){return i.ff()},set dracoUrl(p){i.fe(p)},get meshoptUrl(){return i.fd()},set meshoptUrl(p){i.fc(p)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var _=d;return _})})(DW);var eNe=DW.exports;const Z1=Ni(eNe);function jS(e,[t,n]){return Math.min(n,Math.max(t,e))}var tNe=B.createContext(void 0);function s2(e){const t=B.useContext(tNe);return e||t||"ltr"}function FR(e){const t=B.useRef({value:e,previous:e});return B.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var rNe=[" ","Enter","ArrowUp","ArrowDown"],nNe=[" ","Enter"],Kf="Select",[a2,l2,iNe]=X0(Kf),[Ay,VFe]=fc(Kf,[iNe,oy]),c2=oy(),[oNe,dh]=Ay(Kf),[sNe,aNe]=Ay(Kf),NW=e=>{const{__scopeSelect:t,children:n,open:o,defaultOpen:d,onOpenChange:f,value:_,defaultValue:i,onValueChange:S,dir:E,name:I,autoComplete:M,disabled:j,required:N,form:G}=e,z=c2(t),[V,K]=B.useState(null),[Q,X]=B.useState(null),[ie,J]=B.useState(!1),se=s2(E),[he,we]=Qd({prop:o,defaultProp:d??!1,onChange:f,caller:Kf}),[ze,je]=Qd({prop:_,defaultProp:i,onChange:S,caller:Kf}),Oe=B.useRef(null),Be=V?G||!!V.closest("form"):!0,[qe,Xe]=B.useState(new Set),it=Array.from(qe).map(Ge=>Ge.props.value).join(";");return x.jsx(q$,{...z,children:x.jsxs(oNe,{required:N,scope:t,trigger:V,onTriggerChange:K,valueNode:Q,onValueNodeChange:X,valueNodeHasChildren:ie,onValueNodeHasChildrenChange:J,contentId:$u(),value:ze,onValueChange:je,open:he,onOpenChange:we,dir:se,triggerPointerDownPosRef:Oe,disabled:j,children:[x.jsx(a2.Provider,{scope:t,children:x.jsx(sNe,{scope:e.__scopeSelect,onNativeOptionAdd:B.useCallback(Ge=>{Xe(Ke=>new Set(Ke).add(Ge))},[]),onNativeOptionRemove:B.useCallback(Ge=>{Xe(Ke=>{const ut=new Set(Ke);return ut.delete(Ge),ut})},[]),children:n})}),Be?x.jsxs(aq,{"aria-hidden":!0,required:N,tabIndex:-1,name:I,autoComplete:M,value:ze,onChange:Ge=>je(Ge.target.value),disabled:j,form:G,children:[ze===void 0?x.jsx("option",{value:""}):null,Array.from(qe)]},it):null]})})};NW.displayName=Kf;var zW="SelectTrigger",FW=B.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:o=!1,...d}=e,f=c2(n),_=dh(zW,n),i=_.disabled||o,S=di(t,_.onTriggerChange),E=l2(n),I=B.useRef("touch"),[M,j,N]=cq(z=>{const V=E().filter(X=>!X.disabled),K=V.find(X=>X.value===_.value),Q=uq(V,z,K);Q!==void 0&&_.onValueChange(Q.value)}),G=z=>{i||(_.onOpenChange(!0),N()),z&&(_.triggerPointerDownPosRef.current={x:Math.round(z.pageX),y:Math.round(z.pageY)})};return x.jsx(jM,{asChild:!0,...f,children:x.jsx(En.button,{type:"button",role:"combobox","aria-controls":_.contentId,"aria-expanded":_.open,"aria-required":_.required,"aria-autocomplete":"none",dir:_.dir,"data-state":_.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":lq(_.value)?"":void 0,...d,ref:S,onClick:Pr(d.onClick,z=>{z.currentTarget.focus(),I.current!=="mouse"&&G(z)}),onPointerDown:Pr(d.onPointerDown,z=>{I.current=z.pointerType;const V=z.target;V.hasPointerCapture(z.pointerId)&&V.releasePointerCapture(z.pointerId),z.button===0&&z.ctrlKey===!1&&z.pointerType==="mouse"&&(G(z),z.preventDefault())}),onKeyDown:Pr(d.onKeyDown,z=>{const V=M.current!=="";!(z.ctrlKey||z.altKey||z.metaKey)&&z.key.length===1&&j(z.key),!(V&&z.key===" ")&&rNe.includes(z.key)&&(G(),z.preventDefault())})})})});FW.displayName=zW;var BW="SelectValue",$W=B.forwardRef((e,t)=>{const{__scopeSelect:n,className:o,style:d,children:f,placeholder:_="",...i}=e,S=dh(BW,n),{onValueNodeHasChildrenChange:E}=S,I=f!==void 0,M=di(t,S.onValueNodeChange);return Ns(()=>{E(I)},[E,I]),x.jsx(En.span,{...i,ref:M,style:{pointerEvents:"none"},children:lq(S.value)?x.jsx(x.Fragment,{children:_}):f})});$W.displayName=BW;var lNe="SelectIcon",VW=B.forwardRef((e,t)=>{const{__scopeSelect:n,children:o,...d}=e;return x.jsx(En.span,{"aria-hidden":!0,...d,ref:t,children:o||""})});VW.displayName=lNe;var cNe="SelectPortal",UW=e=>x.jsx(Y0,{asChild:!0,...e});UW.displayName=cNe;var Xf="SelectContent",GW=B.forwardRef((e,t)=>{const n=dh(Xf,e.__scopeSelect),[o,d]=B.useState();if(Ns(()=>{d(new DocumentFragment)},[]),!n.open){const f=o;return f?ey.createPortal(x.jsx(HW,{scope:e.__scopeSelect,children:x.jsx(a2.Slot,{scope:e.__scopeSelect,children:x.jsx("div",{children:e.children})})}),f):null}return x.jsx(WW,{...e,ref:t})});GW.displayName=Xf;var rc=10,[HW,hh]=Ay(Xf),uNe="SelectContentImpl",dNe=Rf("SelectContent.RemoveScroll"),WW=B.forwardRef((e,t)=>{const{__scopeSelect:n,position:o="item-aligned",onCloseAutoFocus:d,onEscapeKeyDown:f,onPointerDownOutside:_,side:i,sideOffset:S,align:E,alignOffset:I,arrowPadding:M,collisionBoundary:j,collisionPadding:N,sticky:G,hideWhenDetached:z,avoidCollisions:V,...K}=e,Q=dh(Xf,n),[X,ie]=B.useState(null),[J,se]=B.useState(null),he=di(t,lr=>ie(lr)),[we,ze]=B.useState(null),[je,Oe]=B.useState(null),Be=l2(n),[qe,Xe]=B.useState(!1),it=B.useRef(!1);B.useEffect(()=>{if(X)return AO(X)},[X]),TO();const Ge=B.useCallback(lr=>{const[an,...Lt]=Be().map(Nt=>Nt.ref.current),[nr]=Lt.slice(-1),pr=document.activeElement;for(const Nt of lr)if(Nt===pr||(Nt?.scrollIntoView({block:"nearest"}),Nt===an&&J&&(J.scrollTop=0),Nt===nr&&J&&(J.scrollTop=J.scrollHeight),Nt?.focus(),document.activeElement!==pr))return},[Be,J]),Ke=B.useCallback(()=>Ge([we,X]),[Ge,we,X]);B.useEffect(()=>{qe&&Ke()},[qe,Ke]);const{onOpenChange:ut,triggerPointerDownPosRef:rt}=Q;B.useEffect(()=>{if(X){let lr={x:0,y:0};const an=nr=>{lr={x:Math.abs(Math.round(nr.pageX)-(rt.current?.x??0)),y:Math.abs(Math.round(nr.pageY)-(rt.current?.y??0))}},Lt=nr=>{lr.x<=10&&lr.y<=10?nr.preventDefault():X.contains(nr.target)||ut(!1),document.removeEventListener("pointermove",an),rt.current=null};return rt.current!==null&&(document.addEventListener("pointermove",an),document.addEventListener("pointerup",Lt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",an),document.removeEventListener("pointerup",Lt,{capture:!0})}}},[X,ut,rt]),B.useEffect(()=>{const lr=()=>ut(!1);return window.addEventListener("blur",lr),window.addEventListener("resize",lr),()=>{window.removeEventListener("blur",lr),window.removeEventListener("resize",lr)}},[ut]);const[Xt,cr]=cq(lr=>{const an=Be().filter(pr=>!pr.disabled),Lt=an.find(pr=>pr.ref.current===document.activeElement),nr=uq(an,lr,Lt);nr&&setTimeout(()=>nr.ref.current.focus())}),Bt=B.useCallback((lr,an,Lt)=>{const nr=!it.current&&!Lt;(Q.value!==void 0&&Q.value===an||nr)&&(ze(lr),nr&&(it.current=!0))},[Q.value]),$t=B.useCallback(()=>X?.focus(),[X]),br=B.useCallback((lr,an,Lt)=>{const nr=!it.current&&!Lt;(Q.value!==void 0&&Q.value===an||nr)&&Oe(lr)},[Q.value]),nn=o==="popper"?rM:qW,qn=nn===rM?{side:i,sideOffset:S,align:E,alignOffset:I,arrowPadding:M,collisionBoundary:j,collisionPadding:N,sticky:G,hideWhenDetached:z,avoidCollisions:V}:{};return x.jsx(HW,{scope:n,content:X,viewport:J,onViewportChange:se,itemRefCallback:Bt,selectedItem:we,onItemLeave:$t,itemTextRefCallback:br,focusSelectedItem:Ke,selectedItemText:je,position:o,isPositioned:qe,searchRef:Xt,children:x.jsx(lT,{as:dNe,allowPinchZoom:!0,children:x.jsx(sT,{asChild:!0,trapped:Q.open,onMountAutoFocus:lr=>{lr.preventDefault()},onUnmountAutoFocus:Pr(d,lr=>{Q.trigger?.focus({preventScroll:!0}),lr.preventDefault()}),children:x.jsx(ty,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:lr=>lr.preventDefault(),onDismiss:()=>Q.onOpenChange(!1),children:x.jsx(nn,{role:"listbox",id:Q.contentId,"data-state":Q.open?"open":"closed",dir:Q.dir,onContextMenu:lr=>lr.preventDefault(),...K,...qn,onPlaced:()=>Xe(!0),ref:he,style:{display:"flex",flexDirection:"column",outline:"none",...K.style},onKeyDown:Pr(K.onKeyDown,lr=>{const an=lr.ctrlKey||lr.altKey||lr.metaKey;if(lr.key==="Tab"&&lr.preventDefault(),!an&&lr.key.length===1&&cr(lr.key),["ArrowUp","ArrowDown","Home","End"].includes(lr.key)){let nr=Be().filter(pr=>!pr.disabled).map(pr=>pr.ref.current);if(["ArrowUp","End"].includes(lr.key)&&(nr=nr.slice().reverse()),["ArrowUp","ArrowDown"].includes(lr.key)){const pr=lr.target,Nt=nr.indexOf(pr);nr=nr.slice(Nt+1)}setTimeout(()=>Ge(nr)),lr.preventDefault()}})})})})})})});WW.displayName=uNe;var hNe="SelectItemAlignedPosition",qW=B.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:o,...d}=e,f=dh(Xf,n),_=hh(Xf,n),[i,S]=B.useState(null),[E,I]=B.useState(null),M=di(t,he=>I(he)),j=l2(n),N=B.useRef(!1),G=B.useRef(!0),{viewport:z,selectedItem:V,selectedItemText:K,focusSelectedItem:Q}=_,X=B.useCallback(()=>{if(f.trigger&&f.valueNode&&i&&E&&z&&V&&K){const he=f.trigger.getBoundingClientRect(),we=E.getBoundingClientRect(),ze=f.valueNode.getBoundingClientRect(),je=K.getBoundingClientRect();if(f.dir!=="rtl"){const pr=je.left-we.left,Nt=ze.left-pr,zr=he.left-Nt,un=he.width+zr,hi=Math.max(un,we.width),Hn=window.innerWidth-rc,zn=jS(Nt,[rc,Math.max(rc,Hn-hi)]);i.style.minWidth=un+"px",i.style.left=zn+"px"}else{const pr=we.right-je.right,Nt=window.innerWidth-ze.right-pr,zr=window.innerWidth-he.right-Nt,un=he.width+zr,hi=Math.max(un,we.width),Hn=window.innerWidth-rc,zn=jS(Nt,[rc,Math.max(rc,Hn-hi)]);i.style.minWidth=un+"px",i.style.right=zn+"px"}const Oe=j(),Be=window.innerHeight-rc*2,qe=z.scrollHeight,Xe=window.getComputedStyle(E),it=parseInt(Xe.borderTopWidth,10),Ge=parseInt(Xe.paddingTop,10),Ke=parseInt(Xe.borderBottomWidth,10),ut=parseInt(Xe.paddingBottom,10),rt=it+Ge+qe+ut+Ke,Xt=Math.min(V.offsetHeight*5,rt),cr=window.getComputedStyle(z),Bt=parseInt(cr.paddingTop,10),$t=parseInt(cr.paddingBottom,10),br=he.top+he.height/2-rc,nn=Be-br,qn=V.offsetHeight/2,lr=V.offsetTop+qn,an=it+Ge+lr,Lt=rt-an;if(an<=br){const pr=Oe.length>0&&V===Oe[Oe.length-1].ref.current;i.style.bottom="0px";const Nt=E.clientHeight-z.offsetTop-z.offsetHeight,zr=Math.max(nn,qn+(pr?$t:0)+Nt+Ke),un=an+zr;i.style.height=un+"px"}else{const pr=Oe.length>0&&V===Oe[0].ref.current;i.style.top="0px";const zr=Math.max(br,it+z.offsetTop+(pr?Bt:0)+qn)+Lt;i.style.height=zr+"px",z.scrollTop=an-br+z.offsetTop}i.style.margin=`${rc}px 0`,i.style.minHeight=Xt+"px",i.style.maxHeight=Be+"px",o?.(),requestAnimationFrame(()=>N.current=!0)}},[j,f.trigger,f.valueNode,i,E,z,V,K,f.dir,o]);Ns(()=>X(),[X]);const[ie,J]=B.useState();Ns(()=>{E&&J(window.getComputedStyle(E).zIndex)},[E]);const se=B.useCallback(he=>{he&&G.current===!0&&(X(),Q?.(),G.current=!1)},[X,Q]);return x.jsx(pNe,{scope:n,contentWrapper:i,shouldExpandOnScrollRef:N,onScrollButtonChange:se,children:x.jsx("div",{ref:S,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ie},children:x.jsx(En.div,{...d,ref:M,style:{boxSizing:"border-box",maxHeight:"100%",...d.style}})})})});qW.displayName=hNe;var fNe="SelectPopperPosition",rM=B.forwardRef((e,t)=>{const{__scopeSelect:n,align:o="start",collisionPadding:d=rc,...f}=e,_=c2(n);return x.jsx(DM,{..._,...f,ref:t,align:o,collisionPadding:d,style:{boxSizing:"border-box",...f.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});rM.displayName=fNe;var[pNe,BR]=Ay(Xf,{}),nM="SelectViewport",ZW=B.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:o,...d}=e,f=hh(nM,n),_=BR(nM,n),i=di(t,f.onViewportChange),S=B.useRef(0);return x.jsxs(x.Fragment,{children:[x.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),x.jsx(a2.Slot,{scope:n,children:x.jsx(En.div,{"data-radix-select-viewport":"",role:"presentation",...d,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...d.style},onScroll:Pr(d.onScroll,E=>{const I=E.currentTarget,{contentWrapper:M,shouldExpandOnScrollRef:j}=_;if(j?.current&&M){const N=Math.abs(S.current-I.scrollTop);if(N>0){const G=window.innerHeight-rc*2,z=parseFloat(M.style.minHeight),V=parseFloat(M.style.height),K=Math.max(z,V);if(K<G){const Q=K+N,X=Math.min(G,Q),ie=Q-X;M.style.height=X+"px",M.style.bottom==="0px"&&(I.scrollTop=ie>0?ie:0,M.style.justifyContent="flex-end")}}}S.current=I.scrollTop})})})]})});ZW.displayName=nM;var KW="SelectGroup",[mNe,gNe]=Ay(KW),yNe=B.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,d=$u();return x.jsx(mNe,{scope:n,id:d,children:x.jsx(En.div,{role:"group","aria-labelledby":d,...o,ref:t})})});yNe.displayName=KW;var XW="SelectLabel",YW=B.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,d=gNe(XW,n);return x.jsx(En.div,{id:d.id,...o,ref:t})});YW.displayName=XW;var DS="SelectItem",[_Ne,JW]=Ay(DS),QW=B.forwardRef((e,t)=>{const{__scopeSelect:n,value:o,disabled:d=!1,textValue:f,..._}=e,i=dh(DS,n),S=hh(DS,n),E=i.value===o,[I,M]=B.useState(f??""),[j,N]=B.useState(!1),G=di(t,Q=>S.itemRefCallback?.(Q,o,d)),z=$u(),V=B.useRef("touch"),K=()=>{d||(i.onValueChange(o),i.onOpenChange(!1))};if(o==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return x.jsx(_Ne,{scope:n,value:o,disabled:d,textId:z,isSelected:E,onItemTextChange:B.useCallback(Q=>{M(X=>X||(Q?.textContent??"").trim())},[]),children:x.jsx(a2.ItemSlot,{scope:n,value:o,disabled:d,textValue:I,children:x.jsx(En.div,{role:"option","aria-labelledby":z,"data-highlighted":j?"":void 0,"aria-selected":E&&j,"data-state":E?"checked":"unchecked","aria-disabled":d||void 0,"data-disabled":d?"":void 0,tabIndex:d?void 0:-1,..._,ref:G,onFocus:Pr(_.onFocus,()=>N(!0)),onBlur:Pr(_.onBlur,()=>N(!1)),onClick:Pr(_.onClick,()=>{V.current!=="mouse"&&K()}),onPointerUp:Pr(_.onPointerUp,()=>{V.current==="mouse"&&K()}),onPointerDown:Pr(_.onPointerDown,Q=>{V.current=Q.pointerType}),onPointerMove:Pr(_.onPointerMove,Q=>{V.current=Q.pointerType,d?S.onItemLeave?.():V.current==="mouse"&&Q.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Pr(_.onPointerLeave,Q=>{Q.currentTarget===document.activeElement&&S.onItemLeave?.()}),onKeyDown:Pr(_.onKeyDown,Q=>{S.searchRef?.current!==""&&Q.key===" "||(nNe.includes(Q.key)&&K(),Q.key===" "&&Q.preventDefault())})})})})});QW.displayName=DS;var $v="SelectItemText",eq=B.forwardRef((e,t)=>{const{__scopeSelect:n,className:o,style:d,...f}=e,_=dh($v,n),i=hh($v,n),S=JW($v,n),E=aNe($v,n),[I,M]=B.useState(null),j=di(t,K=>M(K),S.onItemTextChange,K=>i.itemTextRefCallback?.(K,S.value,S.disabled)),N=I?.textContent,G=B.useMemo(()=>x.jsx("option",{value:S.value,disabled:S.disabled,children:N},S.value),[S.disabled,S.value,N]),{onNativeOptionAdd:z,onNativeOptionRemove:V}=E;return Ns(()=>(z(G),()=>V(G)),[z,V,G]),x.jsxs(x.Fragment,{children:[x.jsx(En.span,{id:S.textId,...f,ref:j}),S.isSelected&&_.valueNode&&!_.valueNodeHasChildren?ey.createPortal(f.children,_.valueNode):null]})});eq.displayName=$v;var tq="SelectItemIndicator",rq=B.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e;return JW(tq,n).isSelected?x.jsx(En.span,{"aria-hidden":!0,...o,ref:t}):null});rq.displayName=tq;var iM="SelectScrollUpButton",nq=B.forwardRef((e,t)=>{const n=hh(iM,e.__scopeSelect),o=BR(iM,e.__scopeSelect),[d,f]=B.useState(!1),_=di(t,o.onScrollButtonChange);return Ns(()=>{if(n.viewport&&n.isPositioned){let i=function(){const E=S.scrollTop>0;f(E)};const S=n.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),d?x.jsx(oq,{...e,ref:_,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=n;i&&S&&(i.scrollTop=i.scrollTop-S.offsetHeight)}}):null});nq.displayName=iM;var oM="SelectScrollDownButton",iq=B.forwardRef((e,t)=>{const n=hh(oM,e.__scopeSelect),o=BR(oM,e.__scopeSelect),[d,f]=B.useState(!1),_=di(t,o.onScrollButtonChange);return Ns(()=>{if(n.viewport&&n.isPositioned){let i=function(){const E=S.scrollHeight-S.clientHeight,I=Math.ceil(S.scrollTop)<E;f(I)};const S=n.viewport;return i(),S.addEventListener("scroll",i),()=>S.removeEventListener("scroll",i)}},[n.viewport,n.isPositioned]),d?x.jsx(oq,{...e,ref:_,onAutoScroll:()=>{const{viewport:i,selectedItem:S}=n;i&&S&&(i.scrollTop=i.scrollTop+S.offsetHeight)}}):null});iq.displayName=oM;var oq=B.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:o,...d}=e,f=hh("SelectScrollButton",n),_=B.useRef(null),i=l2(n),S=B.useCallback(()=>{_.current!==null&&(window.clearInterval(_.current),_.current=null)},[]);return B.useEffect(()=>()=>S(),[S]),Ns(()=>{i().find(I=>I.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),x.jsx(En.div,{"aria-hidden":!0,...d,ref:t,style:{flexShrink:0,...d.style},onPointerDown:Pr(d.onPointerDown,()=>{_.current===null&&(_.current=window.setInterval(o,50))}),onPointerMove:Pr(d.onPointerMove,()=>{f.onItemLeave?.(),_.current===null&&(_.current=window.setInterval(o,50))}),onPointerLeave:Pr(d.onPointerLeave,()=>{S()})})}),vNe="SelectSeparator",sq=B.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e;return x.jsx(En.div,{"aria-hidden":!0,...o,ref:t})});sq.displayName=vNe;var sM="SelectArrow",xNe=B.forwardRef((e,t)=>{const{__scopeSelect:n,...o}=e,d=c2(n),f=dh(sM,n),_=hh(sM,n);return f.open&&_.position==="popper"?x.jsx(LM,{...d,...o,ref:t}):null});xNe.displayName=sM;var bNe="SelectBubbleInput",aq=B.forwardRef(({__scopeSelect:e,value:t,...n},o)=>{const d=B.useRef(null),f=di(o,d),_=FR(t);return B.useEffect(()=>{const i=d.current;if(!i)return;const S=window.HTMLSelectElement.prototype,I=Object.getOwnPropertyDescriptor(S,"value").set;if(_!==t&&I){const M=new Event("change",{bubbles:!0});I.call(i,t),i.dispatchEvent(M)}},[_,t]),x.jsx(En.select,{...n,style:{...$4,...n.style},ref:f,defaultValue:t})});aq.displayName=bNe;function lq(e){return e===""||e===void 0}function cq(e){const t=Aa(e),n=B.useRef(""),o=B.useRef(0),d=B.useCallback(_=>{const i=n.current+_;t(i),function S(E){n.current=E,window.clearTimeout(o.current),E!==""&&(o.current=window.setTimeout(()=>S(""),1e3))}(i)},[t]),f=B.useCallback(()=>{n.current="",window.clearTimeout(o.current)},[]);return B.useEffect(()=>()=>window.clearTimeout(o.current),[]),[n,d,f]}function uq(e,t,n){const d=t.length>1&&Array.from(t).every(E=>E===t[0])?t[0]:t,f=n?e.indexOf(n):-1;let _=wNe(e,Math.max(f,0));d.length===1&&(_=_.filter(E=>E!==n));const S=_.find(E=>E.textValue.toLowerCase().startsWith(d.toLowerCase()));return S!==n?S:void 0}function wNe(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var SNe=NW,dq=FW,TNe=$W,ANe=VW,ENe=UW,hq=GW,PNe=ZW,fq=YW,pq=QW,CNe=eq,INe=rq,mq=nq,gq=iq,yq=sq;const Fu=SNe,Bu=TNe,Gc=B.forwardRef(({className:e,children:t,...n},o)=>x.jsxs(dq,{ref:o,className:kr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,x.jsx(ANe,{asChild:!0,children:x.jsx(u$,{className:"h-4 w-4 opacity-50"})})]}));Gc.displayName=dq.displayName;const _q=B.forwardRef(({className:e,...t},n)=>x.jsx(mq,{ref:n,className:kr("flex cursor-default items-center justify-center py-1",e),...t,children:x.jsx(d$,{className:"h-4 w-4"})}));_q.displayName=mq.displayName;const vq=B.forwardRef(({className:e,...t},n)=>x.jsx(gq,{ref:n,className:kr("flex cursor-default items-center justify-center py-1",e),...t,children:x.jsx(u$,{className:"h-4 w-4"})}));vq.displayName=gq.displayName;const Hc=B.forwardRef(({className:e,children:t,position:n="popper",...o},d)=>x.jsx(ENe,{children:x.jsxs(hq,{ref:d,className:kr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...o,children:[x.jsx(_q,{}),x.jsx(PNe,{className:kr("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),x.jsx(vq,{})]})}));Hc.displayName=hq.displayName;const MNe=B.forwardRef(({className:e,...t},n)=>x.jsx(fq,{ref:n,className:kr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));MNe.displayName=fq.displayName;const Yi=B.forwardRef(({className:e,children:t,...n},o)=>x.jsxs(pq,{ref:o,className:kr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(INe,{children:x.jsx($S,{className:"h-4 w-4"})})}),x.jsx(CNe,{children:t})]}));Yi.displayName=pq.displayName;const ONe=B.forwardRef(({className:e,...t},n)=>x.jsx(yq,{ref:n,className:kr("-mx-1 my-1 h-px bg-muted",e),...t}));ONe.displayName=yq.displayName;const RNe=["house","apartment"],kNe=({form:e,setForm:t,locationSearch:n,setLocationSearch:o,searchLocation:d,getCurrentLocation:f,isLocating:_,useUpload:i,setUseUpload:S,existingImages:E,uploadProgress:I,handleImageUpload:M,handleVideoUpload:j,removeImage:N,removeVideo:G})=>{const[z,V]=B.useState(!1),K=RNe.includes(e.property_type),Q=async()=>{if(!e.title.trim()){rn({title:"Error",description:"Please enter a property title first",variant:"destructive"});return}V(!0);try{const ie=`Write a compelling property description for a real estate listing in Kenya with these details: ${[e.title,e.location&&`located in ${e.location}`,e.size&&`size: ${e.size}`,e.property_type&&`property type: ${e.property_type}`,e.price&&`price: KES ${Number(e.price).toLocaleString()}`,K&&e.bathrooms&&`${e.bathrooms} bathrooms`].filter(Boolean).join(", ")}. Make it professional, highlight key selling points, and keep it under 200 words.`,se=await Sr.functions.invoke("chat",{body:{messages:[{role:"user",content:ie}],isAdmin:!0,type:"generate_blog"}});if(se.error)throw se.error;const he=se.data;let we="";he?typeof he=="string"?we=he:we=he?.response||he?.reply||he?.message||JSON.stringify(he):we="",t(ze=>({...ze,description:we})),rn({title:"Success",description:"Description generated successfully"})}catch(X){console.error("Error generating description:",X),rn({title:"Error",description:"Failed to generate description. Please try again.",variant:"destructive"})}finally{V(!1)}};return x.jsxs("div",{className:"grid gap-4",children:[x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx($n,{placeholder:"Property Title *",value:e.title,onChange:X=>t(ie=>({...ie,title:X.target.value})),className:"col-span-2"}),x.jsx($n,{placeholder:"Location *",value:e.location,onChange:X=>t(ie=>({...ie,location:X.target.value}))}),x.jsx($n,{placeholder:"Price (KES) *",type:"number",value:e.price,onChange:X=>t(ie=>({...ie,price:X.target.value}))})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs(Fu,{value:e.property_type,onValueChange:X=>t(ie=>({...ie,property_type:X})),children:[x.jsx(Gc,{children:x.jsx(Bu,{placeholder:"Property Type"})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"land",children:"Land"}),x.jsx(Yi,{value:"plot",children:"Plot"}),x.jsx(Yi,{value:"house",children:"House"}),x.jsx(Yi,{value:"apartment",children:"Apartment"}),x.jsx(Yi,{value:"commercial",children:"Commercial"})]})]}),x.jsx($n,{placeholder:"Size (e.g., 1/8 Acre, 50x100)",value:e.size,onChange:X=>t(ie=>({...ie,size:X.target.value}))})]}),K&&x.jsx("div",{className:"grid grid-cols-3 gap-4",children:x.jsx($n,{placeholder:"Bathrooms",type:"number",value:e.bathrooms,onChange:X=>t(ie=>({...ie,bathrooms:X.target.value}))})}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx("span",{className:"text-sm font-medium text-foreground",children:"Description"}),x.jsxs(Tr,{type:"button",variant:"ghost",size:"sm",onClick:Q,disabled:z,children:[x.jsx(dg,{className:"h-4 w-4 mr-1"}),z?"Generating...":"AI Generate"]})]}),x.jsx(bl,{placeholder:"Property description...",value:e.description,onChange:X=>t(ie=>({...ie,description:X.target.value})),className:"min-h-24"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx($n,{placeholder:"Seller name",value:e.seller_name,onChange:X=>t(ie=>({...ie,seller_name:X.target.value}))}),x.jsx($n,{placeholder:"Seller phone",value:e.seller_phone,onChange:X=>t(ie=>({...ie,seller_phone:X.target.value}))})]}),x.jsxs("div",{className:"border border-border rounded-lg p-4",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(Jc,{size:20}),"Property Location"]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex gap-2",children:[x.jsx($n,{placeholder:"Search for a location...",value:n,onChange:X=>o(X.target.value),onKeyPress:X=>X.key==="Enter"&&d(),className:"flex-1"}),x.jsx(Tr,{type:"button",onClick:d,variant:"outline",size:"sm",children:"Search"})]}),x.jsx("div",{className:"flex gap-2",children:x.jsxs(Tr,{type:"button",onClick:f,variant:"outline",size:"sm",disabled:_,className:"flex items-center gap-2",children:[x.jsx(mJ,{size:16}),_?"Getting Location...":"Use My Location"]})}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx($n,{placeholder:"Latitude",type:"number",step:"any",value:e.latitude,onChange:X=>t(ie=>({...ie,latitude:X.target.value}))}),x.jsx($n,{placeholder:"Longitude",type:"number",step:"any",value:e.longitude,onChange:X=>t(ie=>({...ie,longitude:X.target.value}))})]}),e.latitude&&e.longitude&&x.jsxs("div",{className:"text-sm text-muted-foreground",children:["Coordinates: ",parseFloat(e.latitude).toFixed(6),", ",parseFloat(e.longitude).toFixed(6)]}),x.jsx("div",{id:"property-map",className:"w-full h-64 rounded-lg border border-border"})]})]}),x.jsxs("div",{className:"border border-border rounded-lg p-4",children:[x.jsxs("div",{className:"flex items-center gap-6 mb-4",children:[x.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[x.jsx("input",{type:"radio",checked:i,onChange:()=>S(!0),className:"w-4 h-4"}),x.jsx("span",{className:"text-sm font-medium text-foreground",children:"Upload Images"})]}),x.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[x.jsx("input",{type:"radio",checked:!i,onChange:()=>S(!1),className:"w-4 h-4"}),x.jsx("span",{className:"text-sm font-medium text-foreground",children:"Image URLs"})]})]}),E.length>0&&x.jsxs("div",{className:"mb-4",children:[x.jsx("p",{className:"text-sm font-medium text-foreground mb-2",children:"Current Images"}),x.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.map((X,ie)=>x.jsxs("div",{className:"relative group",children:[x.jsx("img",{src:X,alt:`Property ${ie+1}`,className:"w-full h-20 object-cover rounded-lg border border-border"}),x.jsx("button",{type:"button",onClick:()=>N(ie),className:"absolute -top-2 -right-2 bg-destructive text-destructive-foreground rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:x.jsx(Tl,{size:12})})]},ie))})]}),i?x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[x.jsx(EJ,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag and drop images here, or click to select"}),x.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:M,className:"hidden",id:"image-upload"}),x.jsx("label",{htmlFor:"image-upload",children:x.jsx(Tr,{type:"button",variant:"outline",size:"sm",asChild:!0,children:x.jsx("span",{children:"Choose Images"})})})]}),I&&x.jsx("div",{className:"mt-4",children:x.jsx("p",{className:"text-xs text-muted-foreground",children:I})})]}),x.jsx(bl,{placeholder:"Or enter image URLs (one per line)",value:e.images,onChange:X=>t(ie=>({...ie,images:X.target.value})),className:"min-h-20"})]}):x.jsx(bl,{placeholder:"Enter image URLs (one per line)",value:e.images,onChange:X=>t(ie=>({...ie,images:X.target.value})),className:"min-h-20"})]}),x.jsxs("div",{className:"border border-border rounded-lg p-4",children:[x.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[x.jsx(nN,{size:20}),"Property Videos"]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center",children:[x.jsx(nN,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),x.jsxs("div",{className:"space-y-2",children:[x.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag and drop videos here, or click to select"}),x.jsx("input",{type:"file",multiple:!0,accept:"video/*",onChange:j,className:"hidden",id:"video-upload"}),x.jsx("label",{htmlFor:"video-upload",children:x.jsx(Tr,{type:"button",variant:"outline",size:"sm",asChild:!0,children:x.jsx("span",{children:"Choose Videos"})})})]})]}),x.jsx(bl,{placeholder:"Or enter video URLs (one per line)",value:e.videos,onChange:X=>t(ie=>({...ie,videos:X.target.value})),className:"min-h-20"})]})]})]})},jNe=({selectedProperties:e,openAddDialog:t,bulkUpdateStatus:n,bulkDeleteProperties:o})=>x.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-foreground",children:"Properties"}),x.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage all properties in your portfolio"})]}),x.jsxs("div",{className:"flex flex-wrap gap-3",children:[x.jsxs(Tr,{onClick:t,className:"bg-primary hover:bg-primary/90 inline-flex items-center gap-2",children:[x.jsx(Yue,{className:"h-4 w-4 mr-2"}),"Add Property"]}),e.length>0&&x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Tr,{onClick:()=>n("available"),variant:"outline",size:"sm",className:"text-green-600 border-green-600 hover:bg-green-50",children:"Mark Available"}),x.jsx(Tr,{onClick:()=>n("sold"),variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",children:"Mark Sold"}),x.jsx(Tr,{onClick:o,variant:"outline",size:"sm",className:"text-red-600 border-red-600 hover:bg-red-50",children:"Delete Selected"})]})]})]}),DNe=({searchQuery:e,setSearchQuery:t,statusFilter:n,setStatusFilter:o,typeFilter:d,setTypeFilter:f})=>x.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[x.jsxs("div",{className:"relative flex-1",children:[x.jsx(kf,{className:"absolute left-3 top-3 text-muted-foreground",size:20}),x.jsx($n,{placeholder:"Search properties by title or location...",value:e,onChange:_=>t(_.target.value),className:"pl-10 py-2 h-10"})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsxs(Fu,{value:n,onValueChange:o,children:[x.jsx(Gc,{className:"w-32 h-10",children:x.jsx(Bu,{placeholder:"Status"})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"all",children:"All Status"}),x.jsx(Yi,{value:"available",children:"Available"}),x.jsx(Yi,{value:"pending",children:"Pending"}),x.jsx(Yi,{value:"sold",children:"Sold"})]})]}),x.jsxs(Fu,{value:d,onValueChange:f,children:[x.jsx(Gc,{className:"w-36 h-10",children:x.jsx(Bu,{placeholder:"Type"})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"all",children:"All Types"}),x.jsx(Yi,{value:"house",children:"House"}),x.jsx(Yi,{value:"apartment",children:"Apartment"}),x.jsx(Yi,{value:"land",children:"Land"}),x.jsx(Yi,{value:"plot",children:"Plot"}),x.jsx(Yi,{value:"commercial",children:"Commercial"})]})]})]})]});var CP="rovingFocusGroup.onEntryFocus",LNe={bubbles:!1,cancelable:!0},_x="RovingFocusGroup",[aM,xq,NNe]=X0(_x),[zNe,bq]=fc(_x,[NNe]),[FNe,BNe]=zNe(_x),wq=B.forwardRef((e,t)=>x.jsx(aM.Provider,{scope:e.__scopeRovingFocusGroup,children:x.jsx(aM.Slot,{scope:e.__scopeRovingFocusGroup,children:x.jsx($Ne,{...e,ref:t})})}));wq.displayName=_x;var $Ne=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:o,loop:d=!1,dir:f,currentTabStopId:_,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:S,onEntryFocus:E,preventScrollOnEntryFocus:I=!1,...M}=e,j=B.useRef(null),N=di(t,j),G=s2(f),[z,V]=Qd({prop:_,defaultProp:i??null,onChange:S,caller:_x}),[K,Q]=B.useState(!1),X=Aa(E),ie=xq(n),J=B.useRef(!1),[se,he]=B.useState(0);return B.useEffect(()=>{const we=j.current;if(we)return we.addEventListener(CP,X),()=>we.removeEventListener(CP,X)},[X]),x.jsx(FNe,{scope:n,orientation:o,dir:G,loop:d,currentTabStopId:z,onItemFocus:B.useCallback(we=>V(we),[V]),onItemShiftTab:B.useCallback(()=>Q(!0),[]),onFocusableItemAdd:B.useCallback(()=>he(we=>we+1),[]),onFocusableItemRemove:B.useCallback(()=>he(we=>we-1),[]),children:x.jsx(En.div,{tabIndex:K||se===0?-1:0,"data-orientation":o,...M,ref:N,style:{outline:"none",...e.style},onMouseDown:Pr(e.onMouseDown,()=>{J.current=!0}),onFocus:Pr(e.onFocus,we=>{const ze=!J.current;if(we.target===we.currentTarget&&ze&&!K){const je=new CustomEvent(CP,LNe);if(we.currentTarget.dispatchEvent(je),!je.defaultPrevented){const Oe=ie().filter(Ge=>Ge.focusable),Be=Oe.find(Ge=>Ge.active),qe=Oe.find(Ge=>Ge.id===z),it=[Be,qe,...Oe].filter(Boolean).map(Ge=>Ge.ref.current);Aq(it,I)}}J.current=!1}),onBlur:Pr(e.onBlur,()=>Q(!1))})})}),Sq="RovingFocusGroupItem",Tq=B.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:o=!0,active:d=!1,tabStopId:f,children:_,...i}=e,S=$u(),E=f||S,I=BNe(Sq,n),M=I.currentTabStopId===E,j=xq(n),{onFocusableItemAdd:N,onFocusableItemRemove:G,currentTabStopId:z}=I;return B.useEffect(()=>{if(o)return N(),()=>G()},[o,N,G]),x.jsx(aM.ItemSlot,{scope:n,id:E,focusable:o,active:d,children:x.jsx(En.span,{tabIndex:M?0:-1,"data-orientation":I.orientation,...i,ref:t,onMouseDown:Pr(e.onMouseDown,V=>{o?I.onItemFocus(E):V.preventDefault()}),onFocus:Pr(e.onFocus,()=>I.onItemFocus(E)),onKeyDown:Pr(e.onKeyDown,V=>{if(V.key==="Tab"&&V.shiftKey){I.onItemShiftTab();return}if(V.target!==V.currentTarget)return;const K=GNe(V,I.orientation,I.dir);if(K!==void 0){if(V.metaKey||V.ctrlKey||V.altKey||V.shiftKey)return;V.preventDefault();let X=j().filter(ie=>ie.focusable).map(ie=>ie.ref.current);if(K==="last")X.reverse();else if(K==="prev"||K==="next"){K==="prev"&&X.reverse();const ie=X.indexOf(V.currentTarget);X=I.loop?HNe(X,ie+1):X.slice(ie+1)}setTimeout(()=>Aq(X))}}),children:typeof _=="function"?_({isCurrentTabStop:M,hasTabStop:z!=null}):_})})});Tq.displayName=Sq;var VNe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function UNe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function GNe(e,t,n){const o=UNe(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return VNe[o]}function Aq(e,t=!1){const n=document.activeElement;for(const o of e)if(o===n||(o.focus({preventScroll:t}),document.activeElement!==n))return}function HNe(e,t){return e.map((n,o)=>e[(t+o)%e.length])}var WNe=wq,qNe=Tq,lM=["Enter"," "],ZNe=["ArrowDown","PageUp","Home"],Eq=["ArrowUp","PageDown","End"],KNe=[...ZNe,...Eq],XNe={ltr:[...lM,"ArrowRight"],rtl:[...lM,"ArrowLeft"]},YNe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},vx="Menu",[Z0,JNe,QNe]=X0(vx),[op,Pq]=fc(vx,[QNe,oy,bq]),u2=oy(),Cq=bq(),[e3e,sp]=op(vx),[t3e,xx]=op(vx),Iq=e=>{const{__scopeMenu:t,open:n=!1,children:o,dir:d,onOpenChange:f,modal:_=!0}=e,i=u2(t),[S,E]=B.useState(null),I=B.useRef(!1),M=Aa(f),j=s2(d);return B.useEffect(()=>{const N=()=>{I.current=!0,document.addEventListener("pointerdown",G,{capture:!0,once:!0}),document.addEventListener("pointermove",G,{capture:!0,once:!0})},G=()=>I.current=!1;return document.addEventListener("keydown",N,{capture:!0}),()=>{document.removeEventListener("keydown",N,{capture:!0}),document.removeEventListener("pointerdown",G,{capture:!0}),document.removeEventListener("pointermove",G,{capture:!0})}},[]),x.jsx(q$,{...i,children:x.jsx(e3e,{scope:t,open:n,onOpenChange:M,content:S,onContentChange:E,children:x.jsx(t3e,{scope:t,onClose:B.useCallback(()=>M(!1),[M]),isUsingKeyboardRef:I,dir:j,modal:_,children:o})})})};Iq.displayName=vx;var r3e="MenuAnchor",$R=B.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,d=u2(n);return x.jsx(jM,{...d,...o,ref:t})});$R.displayName=r3e;var VR="MenuPortal",[n3e,Mq]=op(VR,{forceMount:void 0}),Oq=e=>{const{__scopeMenu:t,forceMount:n,children:o,container:d}=e,f=sp(VR,t);return x.jsx(n3e,{scope:t,forceMount:n,children:x.jsx(pc,{present:n||f.open,children:x.jsx(Y0,{asChild:!0,container:d,children:o})})})};Oq.displayName=VR;var Sl="MenuContent",[i3e,UR]=op(Sl),Rq=B.forwardRef((e,t)=>{const n=Mq(Sl,e.__scopeMenu),{forceMount:o=n.forceMount,...d}=e,f=sp(Sl,e.__scopeMenu),_=xx(Sl,e.__scopeMenu);return x.jsx(Z0.Provider,{scope:e.__scopeMenu,children:x.jsx(pc,{present:o||f.open,children:x.jsx(Z0.Slot,{scope:e.__scopeMenu,children:_.modal?x.jsx(o3e,{...d,ref:t}):x.jsx(s3e,{...d,ref:t})})})})}),o3e=B.forwardRef((e,t)=>{const n=sp(Sl,e.__scopeMenu),o=B.useRef(null),d=di(t,o);return B.useEffect(()=>{const f=o.current;if(f)return AO(f)},[]),x.jsx(GR,{...e,ref:d,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Pr(e.onFocusOutside,f=>f.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),s3e=B.forwardRef((e,t)=>{const n=sp(Sl,e.__scopeMenu);return x.jsx(GR,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),a3e=Rf("MenuContent.ScrollLock"),GR=B.forwardRef((e,t)=>{const{__scopeMenu:n,loop:o=!1,trapFocus:d,onOpenAutoFocus:f,onCloseAutoFocus:_,disableOutsidePointerEvents:i,onEntryFocus:S,onEscapeKeyDown:E,onPointerDownOutside:I,onFocusOutside:M,onInteractOutside:j,onDismiss:N,disableOutsideScroll:G,...z}=e,V=sp(Sl,n),K=xx(Sl,n),Q=u2(n),X=Cq(n),ie=JNe(n),[J,se]=B.useState(null),he=B.useRef(null),we=di(t,he,V.onContentChange),ze=B.useRef(0),je=B.useRef(""),Oe=B.useRef(0),Be=B.useRef(null),qe=B.useRef("right"),Xe=B.useRef(0),it=G?lT:B.Fragment,Ge=G?{as:a3e,allowPinchZoom:!0}:void 0,Ke=rt=>{const Xt=je.current+rt,cr=ie().filter(lr=>!lr.disabled),Bt=document.activeElement,$t=cr.find(lr=>lr.ref.current===Bt)?.textValue,br=cr.map(lr=>lr.textValue),nn=v3e(br,Xt,$t),qn=cr.find(lr=>lr.textValue===nn)?.ref.current;(function lr(an){je.current=an,window.clearTimeout(ze.current),an!==""&&(ze.current=window.setTimeout(()=>lr(""),1e3))})(Xt),qn&&setTimeout(()=>qn.focus())};B.useEffect(()=>()=>window.clearTimeout(ze.current),[]),TO();const ut=B.useCallback(rt=>qe.current===Be.current?.side&&b3e(rt,Be.current?.area),[]);return x.jsx(i3e,{scope:n,searchRef:je,onItemEnter:B.useCallback(rt=>{ut(rt)&&rt.preventDefault()},[ut]),onItemLeave:B.useCallback(rt=>{ut(rt)||(he.current?.focus(),se(null))},[ut]),onTriggerLeave:B.useCallback(rt=>{ut(rt)&&rt.preventDefault()},[ut]),pointerGraceTimerRef:Oe,onPointerGraceIntentChange:B.useCallback(rt=>{Be.current=rt},[]),children:x.jsx(it,{...Ge,children:x.jsx(sT,{asChild:!0,trapped:d,onMountAutoFocus:Pr(f,rt=>{rt.preventDefault(),he.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:_,children:x.jsx(ty,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:E,onPointerDownOutside:I,onFocusOutside:M,onInteractOutside:j,onDismiss:N,children:x.jsx(WNe,{asChild:!0,...X,dir:K.dir,orientation:"vertical",loop:o,currentTabStopId:J,onCurrentTabStopIdChange:se,onEntryFocus:Pr(S,rt=>{K.isUsingKeyboardRef.current||rt.preventDefault()}),preventScrollOnEntryFocus:!0,children:x.jsx(DM,{role:"menu","aria-orientation":"vertical","data-state":Zq(V.open),"data-radix-menu-content":"",dir:K.dir,...Q,...z,ref:we,style:{outline:"none",...z.style},onKeyDown:Pr(z.onKeyDown,rt=>{const cr=rt.target.closest("[data-radix-menu-content]")===rt.currentTarget,Bt=rt.ctrlKey||rt.altKey||rt.metaKey,$t=rt.key.length===1;cr&&(rt.key==="Tab"&&rt.preventDefault(),!Bt&&$t&&Ke(rt.key));const br=he.current;if(rt.target!==br||!KNe.includes(rt.key))return;rt.preventDefault();const qn=ie().filter(lr=>!lr.disabled).map(lr=>lr.ref.current);Eq.includes(rt.key)&&qn.reverse(),y3e(qn)}),onBlur:Pr(e.onBlur,rt=>{rt.currentTarget.contains(rt.target)||(window.clearTimeout(ze.current),je.current="")}),onPointerMove:Pr(e.onPointerMove,K0(rt=>{const Xt=rt.target,cr=Xe.current!==rt.clientX;if(rt.currentTarget.contains(Xt)&&cr){const Bt=rt.clientX>Xe.current?"right":"left";qe.current=Bt,Xe.current=rt.clientX}}))})})})})})})});Rq.displayName=Sl;var l3e="MenuGroup",HR=B.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return x.jsx(En.div,{role:"group",...o,ref:t})});HR.displayName=l3e;var c3e="MenuLabel",kq=B.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return x.jsx(En.div,{...o,ref:t})});kq.displayName=c3e;var LS="MenuItem",_4="menu.itemSelect",d2=B.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:o,...d}=e,f=B.useRef(null),_=xx(LS,e.__scopeMenu),i=UR(LS,e.__scopeMenu),S=di(t,f),E=B.useRef(!1),I=()=>{const M=f.current;if(!n&&M){const j=new CustomEvent(_4,{bubbles:!0,cancelable:!0});M.addEventListener(_4,N=>o?.(N),{once:!0}),yM(M,j),j.defaultPrevented?E.current=!1:_.onClose()}};return x.jsx(jq,{...d,ref:S,disabled:n,onClick:Pr(e.onClick,I),onPointerDown:M=>{e.onPointerDown?.(M),E.current=!0},onPointerUp:Pr(e.onPointerUp,M=>{E.current||M.currentTarget?.click()}),onKeyDown:Pr(e.onKeyDown,M=>{const j=i.searchRef.current!=="";n||j&&M.key===" "||lM.includes(M.key)&&(M.currentTarget.click(),M.preventDefault())})})});d2.displayName=LS;var jq=B.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:o=!1,textValue:d,...f}=e,_=UR(LS,n),i=Cq(n),S=B.useRef(null),E=di(t,S),[I,M]=B.useState(!1),[j,N]=B.useState("");return B.useEffect(()=>{const G=S.current;G&&N((G.textContent??"").trim())},[f.children]),x.jsx(Z0.ItemSlot,{scope:n,disabled:o,textValue:d??j,children:x.jsx(qNe,{asChild:!0,...i,focusable:!o,children:x.jsx(En.div,{role:"menuitem","data-highlighted":I?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...f,ref:E,onPointerMove:Pr(e.onPointerMove,K0(G=>{o?_.onItemLeave(G):(_.onItemEnter(G),G.defaultPrevented||G.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Pr(e.onPointerLeave,K0(G=>_.onItemLeave(G))),onFocus:Pr(e.onFocus,()=>M(!0)),onBlur:Pr(e.onBlur,()=>M(!1))})})})}),u3e="MenuCheckboxItem",Dq=B.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:o,...d}=e;return x.jsx(Bq,{scope:e.__scopeMenu,checked:n,children:x.jsx(d2,{role:"menuitemcheckbox","aria-checked":NS(n)?"mixed":n,...d,ref:t,"data-state":qR(n),onSelect:Pr(d.onSelect,()=>o?.(NS(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Dq.displayName=u3e;var Lq="MenuRadioGroup",[d3e,h3e]=op(Lq,{value:void 0,onValueChange:()=>{}}),Nq=B.forwardRef((e,t)=>{const{value:n,onValueChange:o,...d}=e,f=Aa(o);return x.jsx(d3e,{scope:e.__scopeMenu,value:n,onValueChange:f,children:x.jsx(HR,{...d,ref:t})})});Nq.displayName=Lq;var zq="MenuRadioItem",Fq=B.forwardRef((e,t)=>{const{value:n,...o}=e,d=h3e(zq,e.__scopeMenu),f=n===d.value;return x.jsx(Bq,{scope:e.__scopeMenu,checked:f,children:x.jsx(d2,{role:"menuitemradio","aria-checked":f,...o,ref:t,"data-state":qR(f),onSelect:Pr(o.onSelect,()=>d.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Fq.displayName=zq;var WR="MenuItemIndicator",[Bq,f3e]=op(WR,{checked:!1}),$q=B.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:o,...d}=e,f=f3e(WR,n);return x.jsx(pc,{present:o||NS(f.checked)||f.checked===!0,children:x.jsx(En.span,{...d,ref:t,"data-state":qR(f.checked)})})});$q.displayName=WR;var p3e="MenuSeparator",Vq=B.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e;return x.jsx(En.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});Vq.displayName=p3e;var m3e="MenuArrow",Uq=B.forwardRef((e,t)=>{const{__scopeMenu:n,...o}=e,d=u2(n);return x.jsx(LM,{...d,...o,ref:t})});Uq.displayName=m3e;var g3e="MenuSub",[UFe,Gq]=op(g3e),Vv="MenuSubTrigger",Hq=B.forwardRef((e,t)=>{const n=sp(Vv,e.__scopeMenu),o=xx(Vv,e.__scopeMenu),d=Gq(Vv,e.__scopeMenu),f=UR(Vv,e.__scopeMenu),_=B.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:S}=f,E={__scopeMenu:e.__scopeMenu},I=B.useCallback(()=>{_.current&&window.clearTimeout(_.current),_.current=null},[]);return B.useEffect(()=>I,[I]),B.useEffect(()=>{const M=i.current;return()=>{window.clearTimeout(M),S(null)}},[i,S]),x.jsx($R,{asChild:!0,...E,children:x.jsx(jq,{id:d.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":d.contentId,"data-state":Zq(n.open),...e,ref:FS(t,d.onTriggerChange),onClick:M=>{e.onClick?.(M),!(e.disabled||M.defaultPrevented)&&(M.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Pr(e.onPointerMove,K0(M=>{f.onItemEnter(M),!M.defaultPrevented&&!e.disabled&&!n.open&&!_.current&&(f.onPointerGraceIntentChange(null),_.current=window.setTimeout(()=>{n.onOpenChange(!0),I()},100))})),onPointerLeave:Pr(e.onPointerLeave,K0(M=>{I();const j=n.content?.getBoundingClientRect();if(j){const N=n.content?.dataset.side,G=N==="right",z=G?-5:5,V=j[G?"left":"right"],K=j[G?"right":"left"];f.onPointerGraceIntentChange({area:[{x:M.clientX+z,y:M.clientY},{x:V,y:j.top},{x:K,y:j.top},{x:K,y:j.bottom},{x:V,y:j.bottom}],side:N}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>f.onPointerGraceIntentChange(null),300)}else{if(f.onTriggerLeave(M),M.defaultPrevented)return;f.onPointerGraceIntentChange(null)}})),onKeyDown:Pr(e.onKeyDown,M=>{const j=f.searchRef.current!=="";e.disabled||j&&M.key===" "||XNe[o.dir].includes(M.key)&&(n.onOpenChange(!0),n.content?.focus(),M.preventDefault())})})})});Hq.displayName=Vv;var Wq="MenuSubContent",qq=B.forwardRef((e,t)=>{const n=Mq(Sl,e.__scopeMenu),{forceMount:o=n.forceMount,...d}=e,f=sp(Sl,e.__scopeMenu),_=xx(Sl,e.__scopeMenu),i=Gq(Wq,e.__scopeMenu),S=B.useRef(null),E=di(t,S);return x.jsx(Z0.Provider,{scope:e.__scopeMenu,children:x.jsx(pc,{present:o||f.open,children:x.jsx(Z0.Slot,{scope:e.__scopeMenu,children:x.jsx(GR,{id:i.contentId,"aria-labelledby":i.triggerId,...d,ref:E,align:"start",side:_.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:I=>{_.isUsingKeyboardRef.current&&S.current?.focus(),I.preventDefault()},onCloseAutoFocus:I=>I.preventDefault(),onFocusOutside:Pr(e.onFocusOutside,I=>{I.target!==i.trigger&&f.onOpenChange(!1)}),onEscapeKeyDown:Pr(e.onEscapeKeyDown,I=>{_.onClose(),I.preventDefault()}),onKeyDown:Pr(e.onKeyDown,I=>{const M=I.currentTarget.contains(I.target),j=YNe[_.dir].includes(I.key);M&&j&&(f.onOpenChange(!1),i.trigger?.focus(),I.preventDefault())})})})})})});qq.displayName=Wq;function Zq(e){return e?"open":"closed"}function NS(e){return e==="indeterminate"}function qR(e){return NS(e)?"indeterminate":e?"checked":"unchecked"}function y3e(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function _3e(e,t){return e.map((n,o)=>e[(t+o)%e.length])}function v3e(e,t,n){const d=t.length>1&&Array.from(t).every(E=>E===t[0])?t[0]:t,f=n?e.indexOf(n):-1;let _=_3e(e,Math.max(f,0));d.length===1&&(_=_.filter(E=>E!==n));const S=_.find(E=>E.toLowerCase().startsWith(d.toLowerCase()));return S!==n?S:void 0}function x3e(e,t){const{x:n,y:o}=e;let d=!1;for(let f=0,_=t.length-1;f<t.length;_=f++){const i=t[f],S=t[_],E=i.x,I=i.y,M=S.x,j=S.y;I>o!=j>o&&n<(M-E)*(o-I)/(j-I)+E&&(d=!d)}return d}function b3e(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return x3e(n,t)}function K0(e){return t=>t.pointerType==="mouse"?e(t):void 0}var w3e=Iq,S3e=$R,T3e=Oq,A3e=Rq,E3e=HR,P3e=kq,C3e=d2,I3e=Dq,M3e=Nq,O3e=Fq,R3e=$q,k3e=Vq,j3e=Uq,D3e=Hq,L3e=qq,h2="DropdownMenu",[N3e,GFe]=fc(h2,[Pq]),aa=Pq(),[z3e,Kq]=N3e(h2),Xq=e=>{const{__scopeDropdownMenu:t,children:n,dir:o,open:d,defaultOpen:f,onOpenChange:_,modal:i=!0}=e,S=aa(t),E=B.useRef(null),[I,M]=Qd({prop:d,defaultProp:f??!1,onChange:_,caller:h2});return x.jsx(z3e,{scope:t,triggerId:$u(),triggerRef:E,contentId:$u(),open:I,onOpenChange:M,onOpenToggle:B.useCallback(()=>M(j=>!j),[M]),modal:i,children:x.jsx(w3e,{...S,open:I,onOpenChange:M,dir:o,modal:i,children:n})})};Xq.displayName=h2;var Yq="DropdownMenuTrigger",Jq=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:o=!1,...d}=e,f=Kq(Yq,n),_=aa(n);return x.jsx(S3e,{asChild:!0,..._,children:x.jsx(En.button,{type:"button",id:f.triggerId,"aria-haspopup":"menu","aria-expanded":f.open,"aria-controls":f.open?f.contentId:void 0,"data-state":f.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...d,ref:FS(t,f.triggerRef),onPointerDown:Pr(e.onPointerDown,i=>{!o&&i.button===0&&i.ctrlKey===!1&&(f.onOpenToggle(),f.open||i.preventDefault())}),onKeyDown:Pr(e.onKeyDown,i=>{o||(["Enter"," "].includes(i.key)&&f.onOpenToggle(),i.key==="ArrowDown"&&f.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});Jq.displayName=Yq;var F3e="DropdownMenuPortal",Qq=e=>{const{__scopeDropdownMenu:t,...n}=e,o=aa(t);return x.jsx(T3e,{...o,...n})};Qq.displayName=F3e;var e9="DropdownMenuContent",t9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=Kq(e9,n),f=aa(n),_=B.useRef(!1);return x.jsx(A3e,{id:d.contentId,"aria-labelledby":d.triggerId,...f,...o,ref:t,onCloseAutoFocus:Pr(e.onCloseAutoFocus,i=>{_.current||d.triggerRef.current?.focus(),_.current=!1,i.preventDefault()}),onInteractOutside:Pr(e.onInteractOutside,i=>{const S=i.detail.originalEvent,E=S.button===0&&S.ctrlKey===!0,I=S.button===2||E;(!d.modal||I)&&(_.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});t9.displayName=e9;var B3e="DropdownMenuGroup",$3e=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(E3e,{...d,...o,ref:t})});$3e.displayName=B3e;var V3e="DropdownMenuLabel",r9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(P3e,{...d,...o,ref:t})});r9.displayName=V3e;var U3e="DropdownMenuItem",n9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(C3e,{...d,...o,ref:t})});n9.displayName=U3e;var G3e="DropdownMenuCheckboxItem",i9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(I3e,{...d,...o,ref:t})});i9.displayName=G3e;var H3e="DropdownMenuRadioGroup",W3e=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(M3e,{...d,...o,ref:t})});W3e.displayName=H3e;var q3e="DropdownMenuRadioItem",o9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(O3e,{...d,...o,ref:t})});o9.displayName=q3e;var Z3e="DropdownMenuItemIndicator",s9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(R3e,{...d,...o,ref:t})});s9.displayName=Z3e;var K3e="DropdownMenuSeparator",a9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(k3e,{...d,...o,ref:t})});a9.displayName=K3e;var X3e="DropdownMenuArrow",Y3e=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(j3e,{...d,...o,ref:t})});Y3e.displayName=X3e;var J3e="DropdownMenuSubTrigger",l9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(D3e,{...d,...o,ref:t})});l9.displayName=J3e;var Q3e="DropdownMenuSubContent",c9=B.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...o}=e,d=aa(n);return x.jsx(L3e,{...d,...o,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});c9.displayName=Q3e;var eze=Xq,tze=Jq,rze=Qq,u9=t9,d9=r9,h9=n9,f9=i9,p9=o9,m9=s9,g9=a9,y9=l9,_9=c9;const nze=eze,ize=tze,oze=B.forwardRef(({className:e,inset:t,children:n,...o},d)=>x.jsxs(y9,{ref:d,className:kr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...o,children:[n,x.jsx(wM,{className:"ml-auto h-4 w-4"})]}));oze.displayName=y9.displayName;const sze=B.forwardRef(({className:e,...t},n)=>x.jsx(_9,{ref:n,className:kr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));sze.displayName=_9.displayName;const v9=B.forwardRef(({className:e,sideOffset:t=4,...n},o)=>x.jsx(rze,{children:x.jsx(u9,{ref:o,sideOffset:t,className:kr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));v9.displayName=u9.displayName;const _f=B.forwardRef(({className:e,inset:t,...n},o)=>x.jsx(h9,{ref:o,className:kr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...n}));_f.displayName=h9.displayName;const aze=B.forwardRef(({className:e,children:t,checked:n,...o},d)=>x.jsxs(f9,{ref:d,className:kr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:n,...o,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(m9,{children:x.jsx($S,{className:"h-4 w-4"})})}),t]}));aze.displayName=f9.displayName;const lze=B.forwardRef(({className:e,children:t,...n},o)=>x.jsxs(p9,{ref:o,className:kr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[x.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:x.jsx(m9,{children:x.jsx(tJ,{className:"h-2 w-2 fill-current"})})}),t]}));lze.displayName=p9.displayName;const cze=B.forwardRef(({className:e,inset:t,...n},o)=>x.jsx(d9,{ref:o,className:kr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));cze.displayName=d9.displayName;const uze=B.forwardRef(({className:e,...t},n)=>x.jsx(g9,{ref:n,className:kr("-mx-1 my-1 h-px bg-muted",e),...t}));uze.displayName=g9.displayName;const dze=({properties:e,loading:t,filteredProperties:n,selectedProperties:o,setSelectedProperties:d,updateStatus:f,openEditDialog:_,deleteProperty:i,shareToFacebook:S,shareToTwitter:E,shareToWhatsApp:I,shareToTelegram:M,shareToInstagram:j,shareToTikTok:N})=>x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:t?x.jsxs("div",{className:"p-8 text-center",children:[x.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-muted border-t-primary rounded-full"}),x.jsx("p",{className:"mt-2 text-muted-foreground",children:"Loading properties..."})]}):n.length===0?x.jsx("div",{className:"p-8 text-center",children:x.jsx("p",{className:"text-muted-foreground text-lg",children:"No properties found matching your filters"})}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full",children:[x.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-4 py-4 text-left",children:x.jsx("input",{type:"checkbox",checked:o.length===n.length&&n.length>0,onChange:G=>{G.target.checked?d(n.map(z=>z.id)):d([])},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Property"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden md:table-cell",children:"Location"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden lg:table-cell",children:"Price"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground",children:"Status"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-foreground hidden sm:table-cell",children:"Type"}),x.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-foreground",children:"Actions"})]})}),x.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:n.map(G=>x.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[x.jsx("td",{className:"px-4 py-4",children:x.jsx("input",{type:"checkbox",checked:o.includes(G.id),onChange:z=>{z.target.checked?d([...o,G.id]):d(o.filter(V=>V!==G.id))},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs("div",{className:"relative",children:[G.images?.[0]?x.jsx("img",{src:G.images[0],alt:G.title,className:"w-12 h-12 rounded-lg object-cover"}):x.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:x.jsx(Kue,{className:"h-5 w-5 text-muted-foreground"})}),G.video_url&&x.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full p-1",children:x.jsx(ode,{className:"h-3 w-3"})})]}),x.jsxs("div",{className:"min-w-0 flex-1",children:[x.jsx("div",{className:"font-medium text-foreground truncate",children:G.title}),x.jsx("div",{className:"text-xs text-muted-foreground md:hidden",children:G.location}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[G.images?.length||0," img",G.video_url?", 1 vid":""]})]})]})}),x.jsx("td",{className:"px-6 py-4 text-muted-foreground hidden md:table-cell",children:G.location||""}),x.jsxs("td",{className:"px-6 py-4 font-medium text-foreground hidden lg:table-cell",children:["KES ",Number(G.price||0).toLocaleString()]}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs(Fu,{value:G.status||"available",onValueChange:z=>f(G.id,z),children:[x.jsx(Gc,{className:"w-24 h-8 text-xs",children:x.jsx(Bu,{})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"available",children:"Available"}),x.jsx(Yi,{value:"sold",children:"Sold"}),x.jsx(Yi,{value:"pending",children:"Pending"})]})]})}),x.jsx("td",{className:"px-6 py-4 hidden sm:table-cell",children:x.jsx(Ws,{variant:"outline",className:"capitalize text-xs",children:G.property_type||"land"})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("div",{className:"flex items-center justify-center gap-1",children:[x.jsx(Tr,{size:"sm",variant:"ghost",onClick:()=>_(G),className:"h-8 w-8 p-0 text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white",children:x.jsx(que,{className:"h-4 w-4"})}),x.jsxs(nze,{children:[x.jsx(ize,{asChild:!0,children:x.jsx(Tr,{size:"sm",variant:"ghost",className:"h-8 w-8 p-0 text-primary hover:text-primary/80 hover:bg-primary/5",children:x.jsx(Que,{className:"h-4 w-4"})})}),x.jsxs(v9,{align:"end",className:"w-48",children:[x.jsxs(_f,{onClick:()=>S(G),className:"flex items-center gap-2",children:[x.jsx(Vue,{className:"h-4 w-4 text-blue-600"}),"Share on Facebook"]}),x.jsxs(_f,{onClick:()=>E(G),className:"flex items-center gap-2",children:[x.jsx(Cue,{className:"h-4 w-4 text-blue-400"}),"Share on X (Twitter)"]}),x.jsxs(_f,{onClick:()=>I(G),className:"flex items-center gap-2",children:[x.jsx(H6,{className:"h-4 w-4 text-green-600"}),"Share on WhatsApp"]}),x.jsxs(_f,{onClick:()=>M(G),className:"flex items-center gap-2",children:[x.jsx(Hue,{className:"h-4 w-4 text-blue-500"}),"Share on Telegram"]}),x.jsxs(_f,{onClick:()=>j(G),className:"flex items-center gap-2",children:[x.jsx(jue,{className:"h-4 w-4 text-pink-600"}),"Copy for Instagram"]}),x.jsxs(_f,{onClick:()=>N(G),className:"flex items-center gap-2",children:[x.jsx("div",{className:"w-4 h-4 bg-black rounded-sm flex items-center justify-center",children:x.jsx("span",{className:"text-white text-xs font-bold",children:"T"})}),"Copy for TikTok"]})]})]}),x.jsx(Tr,{size:"sm",variant:"ghost",onClick:()=>i(G.id),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-950",children:x.jsx(p$,{size:16})})]})})]},G.id))})]})})}),IP="https://fakkzdfwpucpgndofgcu.supabase.co",MP={title:"",location:"",price:"",property_type:"land",description:"",seller_name:"",seller_phone:"",size:"",images:"",videos:"",latitude:"",longitude:"",bathrooms:""},hze=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(!1),[_,i]=B.useState(!1),[S,E]=B.useState(null),[I,M]=B.useState(MP),[j,N]=B.useState(!0);B.useState(!0);const[G,z]=B.useState([]),[V,K]=B.useState([]),[Q,X]=B.useState([]),[ie,J]=B.useState([]),[se,he]=B.useState(null),[we,ze]=B.useState(""),[je,Oe]=B.useState("all"),[Be,qe]=B.useState("all"),[Xe,it]=B.useState([]);B.useState(!1);const[Ge,Ke]=B.useState(""),[ut,rt]=B.useState(null),[Xt,cr]=B.useState(null),[Bt,$t]=B.useState(""),[br,nn]=B.useState(!1),qn=e.filter(Zt=>Zt.title.toLowerCase().includes(we.toLowerCase())||Zt.location.toLowerCase().includes(we.toLowerCase())).filter(Zt=>!(je!=="all"&&Zt.status!==je||Be!=="all"&&Zt.property_type!==Be));B.useEffect(()=>{lr()},[]),B.useEffect(()=>{(async()=>{try{const qt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",Ir=await(await aQ(`${IP}/functions/v1/get-mapbox-token`,{headers:{"Content-Type":"application/json",apikey:qt,Authorization:`Bearer ${qt}`}},1e4)).json();Ir.token&&Ke(Ir.token)}catch(qt){console.error("Failed to fetch Mapbox token:",qt)}})()},[]),B.useEffect(()=>{if(!_||!Ge)return;const Zt=setTimeout(()=>{const qt=document.getElementById("property-map");if(!qt)return;const fr=I.latitude?parseFloat(I.latitude):-1.2921,Ir=I.longitude?parseFloat(I.longitude):36.8219;Z1.accessToken=Ge;const On=new Z1.Map({container:qt,style:"mapbox://styles/mapbox/streets-v12",center:[Ir,fr],zoom:I.latitude&&I.longitude?15:10});On.addControl(new Z1.NavigationControl,"top-right");const Ii=new Z1.Marker({color:"#2563eb",draggable:!0}).setLngLat([Ir,fr]).addTo(On);return Ii.on("dragend",()=>{const eo=Ii.getLngLat();M($o=>({...$o,latitude:eo.lat.toString(),longitude:eo.lng.toString()}))}),rt(On),cr(Ii),()=>{On.remove(),rt(null),cr(null)}},100);return()=>clearTimeout(Zt)},[_,Ge,I.latitude,I.longitude]),B.useEffect(()=>{if(Xt&&I.latitude&&I.longitude){const Zt=parseFloat(I.latitude),qt=parseFloat(I.longitude);Xt.setLngLat([qt,Zt]),ut?.setCenter([qt,Zt])}},[I.latitude,I.longitude,Xt,ut]);const lr=async()=>{o(!0);const{data:Zt,error:qt}=await Sr.from("properties").select("*").order("created_at",{ascending:!1});qt&&console.error(qt),t(Zt||[]),o(!1)},an=async(Zt,qt)=>{try{await Sr.from("properties").update({status:qt}).eq("id",Zt),t(fr=>fr.map(Ir=>Ir.id===Zt?{...Ir,status:qt}:Ir))}catch(fr){console.error(fr),rn({title:"Error",description:"Failed to update status",variant:"destructive"})}},Lt=Zt=>{const fr=Array.from(Zt.target.files||[]).filter(On=>On.size>5*1024*1024?(rn({title:"File too large",description:`${On.name} exceeds 5MB limit`,variant:"destructive"}),!1):["image/jpeg","image/png","image/webp","image/gif"].includes(On.type)?!0:(rn({title:"Invalid file type",description:`${On.name} is not a supported image format`,variant:"destructive"}),!1));if(V.length+G.length+fr.length>10){rn({title:"Too many images",description:"Maximum 10 images allowed",variant:"destructive"});return}z(On=>[...On,...fr])},nr=Zt=>{const fr=Array.from(Zt.target.files||[]).filter(On=>On.size>50*1024*1024?(rn({title:"File too large",description:`${On.name} exceeds 50MB limit`,variant:"destructive"}),!1):["video/mp4","video/avi","video/mov","video/wmv","video/webm"].includes(On.type)?!0:(rn({title:"Invalid file type",description:`${On.name} is not a supported video format`,variant:"destructive"}),!1));if(ie.length+Q.length+fr.length>3){rn({title:"Too many videos",description:"Maximum 3 videos allowed",variant:"destructive"});return}X(On=>[...On,...fr])},pr=Lt,Nt=nr,zr=Zt=>{K(qt=>qt.filter((fr,Ir)=>Ir!==Zt))},un=Zt=>{J(qt=>qt.filter((fr,Ir)=>Ir!==Zt))},hi=()=>{if(nn(!0),!navigator.geolocation){rn({title:"Error",description:"Geolocation is not supported by this browser.",variant:"destructive"}),nn(!1);return}navigator.geolocation.getCurrentPosition(Zt=>{const{latitude:qt,longitude:fr}=Zt.coords;M(Ir=>({...Ir,latitude:qt.toString(),longitude:fr.toString()})),rn({title:"Location captured",description:"Your current location has been set."}),nn(!1)},Zt=>{console.error("Geolocation error:",Zt),rn({title:"Location error",description:"Failed to get your location. Please check permissions.",variant:"destructive"}),nn(!1)},{enableHighAccuracy:!0,timeout:1e4})},Hn=async()=>{if(!(!Bt.trim()||!Ge))try{const qt=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Bt)}.json?access_token=${Ge}&limit=1`)).json();if(qt.features&&qt.features.length>0){const[fr,Ir]=qt.features[0].center;M(On=>({...On,latitude:Ir.toString(),longitude:fr.toString()})),rn({title:"Location found",description:`Coordinates set for: ${qt.features[0].place_name}`})}else rn({title:"Location not found",description:"Please try a different search term.",variant:"destructive"})}catch(Zt){console.error("Geocoding error:",Zt),rn({title:"Search error",description:"Failed to search location.",variant:"destructive"})}},zn=Zt=>{const qt=Zt.title,fr=`KES ${Number(Zt.price||0).toLocaleString()}`,Ir=Zt.location||"Kenya",On=`https://julina.co.ke/properties/${Zt.id}`,Ii=Zt.images?.[0]||"";return{title:qt,price:fr,location:Ir,propertyUrl:On,imageUrl:Ii,description:`${qt} - ${fr} located in ${Ir}. View more details and contact seller.`}},Qn=Zt=>{const qt=zn(Zt),fr=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(qt.propertyUrl)}&quote=${encodeURIComponent(qt.description)}`;window.open(fr,"_blank","width=600,height=400")},zs=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}. ${qt.propertyUrl}`,Ir=`https://twitter.com/intent/tweet?text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank","width=600,height=400")},gs=Zt=>{const qt=zn(Zt),fr=`*${qt.title}*

 Price: ${qt.price}
 Location: ${qt.location}

${qt.description}

View details: ${qt.propertyUrl}`,Ir=`https://wa.me/?text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank")},co=Zt=>{const qt=zn(Zt),fr=`${qt.title}

 ${qt.price}
 ${qt.location}

${qt.description}

${qt.propertyUrl}`,Ir=`https://t.me/share/url?url=${encodeURIComponent(qt.propertyUrl)}&text=${encodeURIComponent(fr)}`;window.open(Ir,"_blank")},Co=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}

${qt.description}

View: ${qt.propertyUrl}`;navigator.clipboard.writeText(fr).then(()=>{rn({title:"Copied to clipboard",description:"Paste this content into Instagram"})}).catch(()=>{rn({title:"Copy failed",description:"Please copy the content manually",variant:"destructive"})})},wo=Zt=>{const qt=zn(Zt),fr=`${qt.title} - ${qt.price} in ${qt.location}

${qt.description}

View: ${qt.propertyUrl}`;navigator.clipboard.writeText(fr).then(()=>{rn({title:"Copied to clipboard",description:"Paste this content into TikTok"})}).catch(()=>{rn({title:"Copy failed",description:"Please copy the content manually",variant:"destructive"})})},Hi=async Zt=>{const qt=[];for(let fr=0;fr<Q.length;fr++){const Ir=Q[fr];he(`Uploading video ${fr+1}/${Q.length}...`);const On=Ir.name.split(".").pop(),Ii=`${Zt}/videos/${Date.now()}-${fr}.${On}`,{error:eo}=await Sr.storage.from("property-images").upload(Ii,Ir,{cacheControl:"3600",upsert:!1});if(eo)throw console.error("Video upload error:",eo),new Error(`Failed to upload ${Ir.name}: ${eo.message}`);const $o=`${IP}/storage/v1/object/public/property-images/${Ii}`;qt.push($o)}return qt},is=async Zt=>{const qt=[];for(let fr=0;fr<G.length;fr++){const Ir=G[fr];he(`Uploading image ${fr+1}/${G.length}...`);const On=Ir.name.split(".").pop(),Ii=`${Zt}/images/${Date.now()}-${fr}.${On}`,{error:eo}=await Sr.storage.from("property-images").upload(Ii,Ir,{cacheControl:"3600",upsert:!1});if(eo)throw console.error("Image upload error:",eo),new Error(`Failed to upload ${Ir.name}: ${eo.message}`);const $o=`${IP}/storage/v1/object/public/property-images/${Ii}`;qt.push($o)}return qt},Io=()=>{E(null),M(MP),z([]),X([]),K([]),J([]),N(!0),i(!0)},jo=Zt=>{E(Zt.id),M({title:Zt.title||"",location:Zt.location||"",price:Zt.price?.toString()||"",property_type:Zt.property_type||"land",description:Zt.description||"",seller_name:Zt.seller_name||"",seller_phone:Zt.seller_phone||"",size:Zt.size||"",images:"",videos:"",latitude:Zt.latitude?.toString()||"",longitude:Zt.longitude?.toString()||"",bathrooms:Zt.bathrooms?.toString()||""}),K(Zt.images||[]),J(Zt.video_url?[Zt.video_url]:[]),z([]),X([]),N(!0),i(!0)},qs=async()=>{f(!0);try{if(!I.title.trim())throw new Error("Title is required");if(!I.location.trim())throw new Error("Location is required");if(!I.price||Number(I.price)<=0)throw new Error("Price must be a positive number");let Zt=[...V],qt=[...ie];const fr=Mi=>Mi?Mi.split(/\s|,|\n/).map(ln=>ln.trim()).filter(Boolean):[],Ir=Mi=>/^(https?:\/\/|data:|\/\/)/i.test(Mi),On=fr(I.images).filter(Ir),Ii=fr(I.videos).filter(Ir);if(Zt=[...Zt,...On],qt=[...qt,...Ii],Zt.length+G.length>10)throw new Error("Maximum 10 images allowed. Please remove some images or URLs.");if(qt.length+Q.length>3)throw new Error("Maximum 3 videos allowed. Please remove some videos or URLs.");let Lo=I.description.trim();try{if(!Lo&&I.title.trim()){const Mi=Sr.functions.invoke("chat",{body:{type:"enhance_description",title:I.title.trim(),description:I.description,isAdmin:!0}}),ln=8e3,ui=await Promise.race([Mi,new Promise(on=>setTimeout(()=>on({error:"timeout"}),ln))]);try{const on=ui;if(!(!on||on.error)){const Zn=on.data;if(typeof Zn=="string")Lo=Zn;else if(Zn&&typeof Zn=="object"){const ei=Zn,Vo=ei.response??ei.reply??ei.message??ei.enhanced;Lo=typeof Vo=="string"?Vo:""}else Lo=""}}catch(on){console.warn("AI response parsing failed, continuing without it",on)}}}catch(Mi){console.warn("AI description generation failed, continuing without it",Mi)}const Ca={title:I.title.trim(),description:Lo||null,property_type:I.property_type,price:Number(I.price),location:I.location.trim(),size:I.size.trim()||null,seller_name:I.seller_name.trim()||null,seller_phone:I.seller_phone.trim()||null,latitude:I.latitude?Number(I.latitude):null,longitude:I.longitude?Number(I.longitude):null,bathrooms:I.bathrooms?Number(I.bathrooms):null,is_admin_property:!0,updated_at:new Date().toISOString()};if(S){if(j&&G.length>0){const ln=await is(S);Zt=[...Zt,...ln]}if(j&&Q.length>0){const ln=await Hi(S);qt=[...qt,...ln]}const{error:Mi}=await Sr.from("properties").update({...Ca,images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null}).eq("id",S);if(Mi)throw Mi;t(ln=>ln.map(ui=>ui.id===S?{...ui,...Ca,images:Zt,video_url:qt[0]||null}:ui)),rn({title:"Success",description:"Property updated successfully."})}else{const{data:Mi,error:ln}=await Sr.from("properties").insert({...Ca,images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null,status:"available"}).select().single();if(ln)throw ln;if(j&&G.length>0){const ui=await is(Mi.id);Zt=[...Zt,...ui]}if(j&&Q.length>0){const ui=await Hi(Mi.id);qt=[...qt,...ui]}if(j&&G.length>0||j&&Q.length>0){const{error:ui}=await Sr.from("properties").update({images:Zt.length>0?Zt:null,video_url:qt.length>0?qt[0]:null}).eq("id",Mi.id);if(ui)throw ui;Mi.images=Zt,Mi.video_url=qt[0]||null}t(ui=>[Mi,...ui]),rn({title:"Success",description:"Property created successfully."})}i(!1),M(MP),z([]),K([]),E(null)}catch(Zt){console.error(Zt);const qt=Zt instanceof Error?Zt.message:String(Zt);rn({title:"Error",description:qt||"Failed to save property.",variant:"destructive"})}finally{f(!1),he("")}},Do=async Zt=>{if(confirm("Are you sure you want to delete this property?"))try{const qt=e.find(Ir=>Ir.id===Zt);if(qt?.images?.length){const Ir=qt.images.map(On=>{const Ii=On.match(/property-images\/(.+)$/);return Ii?Ii[1]:null}).filter(Boolean);Ir.length>0&&await Sr.storage.from("property-images").remove(Ir)}const{error:fr}=await Sr.from("properties").delete().eq("id",Zt);if(fr)throw fr;t(Ir=>Ir.filter(On=>On.id!==Zt)),rn({title:"Deleted",description:"Property removed successfully."})}catch(qt){console.error(qt);const fr=qt instanceof Error?qt.message:String(qt);rn({title:"Error",description:fr||"Failed to delete property.",variant:"destructive"})}},Fs=async()=>{if(confirm(`Are you sure you want to delete ${Xe.length} properties?`))try{o(!0);for(const qt of Xe){const fr=e.find(Ir=>Ir.id===qt);if(fr?.images?.length){const Ir=fr.images.map(On=>{const Ii=On.match(/property-images\/(.+)$/);return Ii?Ii[1]:null}).filter(Boolean);Ir.length>0&&await Sr.storage.from("property-images").remove(Ir)}}const{error:Zt}=await Sr.from("properties").delete().in("id",Xe);if(Zt)throw Zt;t(qt=>qt.filter(fr=>!Xe.includes(fr.id))),it([]),rn({title:"Deleted",description:`${Xe.length} properties removed successfully.`})}catch(Zt){console.error(Zt);const qt=Zt instanceof Error?Zt.message:String(Zt);rn({title:"Error",description:qt||"Failed to delete properties.",variant:"destructive"})}finally{o(!1)}},Pa=async Zt=>{try{o(!0);const{error:qt}=await Sr.from("properties").update({status:Zt,updated_at:new Date().toISOString()}).in("id",Xe);if(qt)throw qt;t(fr=>fr.map(Ir=>Xe.includes(Ir.id)?{...Ir,status:Zt}:Ir)),it([]),rn({title:"Updated",description:`${Xe.length} properties updated to ${Zt}.`})}catch(qt){console.error(qt);const fr=qt instanceof Error?qt.message:String(qt);rn({title:"Error",description:fr||"Failed to update properties.",variant:"destructive"})}finally{o(!1)}};return x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6",children:[x.jsx(jNe,{selectedProperties:Xe,openAddDialog:Io,bulkUpdateStatus:Pa,bulkDeleteProperties:Fs}),x.jsx(DNe,{searchQuery:we,setSearchQuery:ze,statusFilter:je,setStatusFilter:Oe,typeFilter:Be,setTypeFilter:qe}),x.jsx(dze,{properties:e,loading:n,filteredProperties:qn,selectedProperties:Xe,setSelectedProperties:it,updateStatus:an,openEditDialog:jo,deleteProperty:Do,shareToFacebook:Qn,shareToTwitter:zs,shareToWhatsApp:gs,shareToTelegram:co,shareToInstagram:Co,shareToTikTok:wo}),x.jsx(Zu,{open:_,onOpenChange:Zt=>{i(Zt),Zt||(z([]),X([]),he(""),E(null),$t(""),nn(!1),ut&&(ut.remove(),rt(null),cr(null)))},children:x.jsxs(tu,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[x.jsxs(sh,{children:[x.jsx(Qu,{className:"text-2xl",children:S?"Edit Property":"Add New Property"}),x.jsx(IO,{children:S?"Update the property details below.":"Fill in the details to add a new property."})]}),x.jsx(kNe,{form:I,setForm:M,locationSearch:Bt,setLocationSearch:$t,searchLocation:Hn,getCurrentLocation:hi,isLocating:br,useUpload:j,setUseUpload:N,existingImages:V,uploadProgress:se,handleImageUpload:pr,handleVideoUpload:Nt,removeImage:zr,removeVideo:un}),x.jsxs(ax,{children:[x.jsx(Tr,{variant:"outline",onClick:()=>i(!1),disabled:d,children:"Cancel"}),x.jsx(Tr,{onClick:qs,disabled:d,className:"bg-primary hover:bg-primary/90",children:d?se||"Saving...":S?"Update Property":"Create Property"})]})]})})]})})},f2=B.forwardRef(({className:e,...t},n)=>x.jsx("div",{className:"relative w-full overflow-auto",children:x.jsx("table",{ref:n,className:kr("w-full caption-bottom text-sm",e),...t})}));f2.displayName="Table";const p2=B.forwardRef(({className:e,...t},n)=>x.jsx("thead",{ref:n,className:kr("[&_tr]:border-b",e),...t}));p2.displayName="TableHeader";const m2=B.forwardRef(({className:e,...t},n)=>x.jsx("tbody",{ref:n,className:kr("[&_tr:last-child]:border-0",e),...t}));m2.displayName="TableBody";const fze=B.forwardRef(({className:e,...t},n)=>x.jsx("tfoot",{ref:n,className:kr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));fze.displayName="TableFooter";const Yf=B.forwardRef(({className:e,...t},n)=>x.jsx("tr",{ref:n,className:kr("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Yf.displayName="TableRow";const xa=B.forwardRef(({className:e,...t},n)=>x.jsx("th",{ref:n,className:kr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));xa.displayName="TableHead";const ba=B.forwardRef(({className:e,...t},n)=>x.jsx("td",{ref:n,className:kr("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));ba.displayName="TableCell";const pze=B.forwardRef(({className:e,...t},n)=>x.jsx("caption",{ref:n,className:kr("mt-4 text-sm text-muted-foreground",e),...t}));pze.displayName="TableCaption";var mze="Label",x9=B.forwardRef((e,t)=>x.jsx(En.label,{...e,ref:t,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(e.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));x9.displayName=mze;var b9=x9;const gze=Q0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),go=B.forwardRef(({className:e,...t},n)=>x.jsx(b9,{ref:n,className:kr(gze(),e),...t}));go.displayName=b9.displayName;var g2="Checkbox",[yze,HFe]=fc(g2),[_ze,ZR]=yze(g2);function vze(e){const{__scopeCheckbox:t,checked:n,children:o,defaultChecked:d,disabled:f,form:_,name:i,onCheckedChange:S,required:E,value:I="on",internal_do_not_use_render:M}=e,[j,N]=Qd({prop:n,defaultProp:d??!1,onChange:S,caller:g2}),[G,z]=B.useState(null),[V,K]=B.useState(null),Q=B.useRef(!1),X=G?!!_||!!G.closest("form"):!0,ie={checked:j,disabled:f,setChecked:N,control:G,setControl:z,name:i,form:_,value:I,hasConsumerStoppedPropagationRef:Q,required:E,defaultChecked:Jd(d)?!1:d,isFormControl:X,bubbleInput:V,setBubbleInput:K};return x.jsx(_ze,{scope:t,...ie,children:xze(M)?M(ie):o})}var w9="CheckboxTrigger",S9=B.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...o},d)=>{const{control:f,value:_,disabled:i,checked:S,required:E,setControl:I,setChecked:M,hasConsumerStoppedPropagationRef:j,isFormControl:N,bubbleInput:G}=ZR(w9,e),z=di(d,I),V=B.useRef(S);return B.useEffect(()=>{const K=f?.form;if(K){const Q=()=>M(V.current);return K.addEventListener("reset",Q),()=>K.removeEventListener("reset",Q)}},[f,M]),x.jsx(En.button,{type:"button",role:"checkbox","aria-checked":Jd(S)?"mixed":S,"aria-required":E,"data-state":C9(S),"data-disabled":i?"":void 0,disabled:i,value:_,...o,ref:z,onKeyDown:Pr(t,K=>{K.key==="Enter"&&K.preventDefault()}),onClick:Pr(n,K=>{M(Q=>Jd(Q)?!0:!Q),G&&N&&(j.current=K.isPropagationStopped(),j.current||K.stopPropagation())})})});S9.displayName=w9;var KR=B.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:o,checked:d,defaultChecked:f,required:_,disabled:i,value:S,onCheckedChange:E,form:I,...M}=e;return x.jsx(vze,{__scopeCheckbox:n,checked:d,defaultChecked:f,disabled:i,required:_,onCheckedChange:E,name:o,form:I,value:S,internal_do_not_use_render:({isFormControl:j})=>x.jsxs(x.Fragment,{children:[x.jsx(S9,{...M,ref:t,__scopeCheckbox:n}),j&&x.jsx(P9,{__scopeCheckbox:n})]})})});KR.displayName=g2;var T9="CheckboxIndicator",A9=B.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:o,...d}=e,f=ZR(T9,n);return x.jsx(pc,{present:o||Jd(f.checked)||f.checked===!0,children:x.jsx(En.span,{"data-state":C9(f.checked),"data-disabled":f.disabled?"":void 0,...d,ref:t,style:{pointerEvents:"none",...e.style}})})});A9.displayName=T9;var E9="CheckboxBubbleInput",P9=B.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:o,hasConsumerStoppedPropagationRef:d,checked:f,defaultChecked:_,required:i,disabled:S,name:E,value:I,form:M,bubbleInput:j,setBubbleInput:N}=ZR(E9,e),G=di(n,N),z=FR(f),V=OM(o);B.useEffect(()=>{const Q=j;if(!Q)return;const X=window.HTMLInputElement.prototype,J=Object.getOwnPropertyDescriptor(X,"checked").set,se=!d.current;if(z!==f&&J){const he=new Event("click",{bubbles:se});Q.indeterminate=Jd(f),J.call(Q,Jd(f)?!1:f),Q.dispatchEvent(he)}},[j,z,f,d]);const K=B.useRef(Jd(f)?!1:f);return x.jsx(En.input,{type:"checkbox","aria-hidden":!0,defaultChecked:_??K.current,required:i,disabled:S,name:E,value:I,form:M,...t,tabIndex:-1,ref:G,style:{...t.style,...V,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});P9.displayName=E9;function xze(e){return typeof e=="function"}function Jd(e){return e==="indeterminate"}function C9(e){return Jd(e)?"indeterminate":e?"checked":"unchecked"}const I9=B.forwardRef(({className:e,...t},n)=>x.jsx(KR,{ref:n,className:kr("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:x.jsx(A9,{className:kr("flex items-center justify-center text-current"),children:x.jsx($S,{className:"h-4 w-4"})})}));I9.displayName=KR.displayName;const bze="https://fakkzdfwpucpgndofgcu.supabase.co",wze=({blog:e,onSave:t,onCancel:n})=>{const[o,d]=B.useState({title:e?.title||"",slug:e?.slug||"",excerpt:e?.excerpt||"",content:e?.content||"",featured_image:e?.featured_image||"",author_name:e?.author_name||"",published:e?.published||!1,tags:e?.tags||[],seo_title:e?.seo_title||"",seo_description:e?.seo_description||"",seo_keywords:e?.seo_keywords||[]}),[f,_]=B.useState(""),[i,S]=B.useState(""),[E,I]=B.useState(!1),[M,j]=B.useState(null),[N,G]=B.useState(!1),[z,V]=B.useState(0),K=je=>je.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),Q=je=>{d(Oe=>({...Oe,title:je,slug:K(je),seo_title:Oe.seo_title||je}))},X=()=>{f.trim()&&!o.tags.includes(f.trim())&&(d(je=>({...je,tags:[...je.tags,f.trim()]})),_(""))},ie=je=>{d(Oe=>({...Oe,tags:Oe.tags.filter(Be=>Be!==je)}))},J=()=>{i.trim()&&!o.seo_keywords.includes(i.trim())&&(d(je=>({...je,seo_keywords:[...je.seo_keywords,i.trim()]})),S(""))},se=je=>{d(Oe=>({...Oe,seo_keywords:Oe.seo_keywords.filter(Be=>Be!==je)}))},he=async je=>{if(!o.title.trim()){ds.error("Please enter a title first");return}I(!0);try{const{data:Oe,error:Be}=await Sr.functions.invoke("chat",{body:{type:"generate_blog",topic:o.title}});if(Be)throw Be;Oe&&(je==="content"&&Oe.content?d(qe=>({...qe,content:Oe.content})):je==="excerpt"&&Oe.excerpt?d(qe=>({...qe,excerpt:Oe.excerpt})):je==="seo"&&d(qe=>({...qe,seo_title:Oe.seo_title||qe.title,seo_description:Oe.seo_description||qe.excerpt})),ds.success("AI content generated!"))}catch(Oe){console.error("Error generating with AI:",Oe),ds.error("Failed to generate content")}finally{I(!1)}},we=()=>{(async()=>{try{if(!o.title.trim())return ds.error("Title is required");if(!o.slug.trim())return ds.error("Slug is required");const je={title:o.title.trim(),slug:o.slug.trim(),excerpt:o.excerpt||null,content:o.content||null,featured_image:o.featured_image||null,author_name:o.author_name||null,published:!!o.published,tags:o.tags&&o.tags.length?o.tags:null,seo_title:o.seo_title||null,seo_description:o.seo_description||null,seo_keywords:o.seo_keywords&&o.seo_keywords.length?o.seo_keywords:null,updated_at:new Date().toISOString()};if(e&&e.id){const{data:Oe,error:Be}=await Sr.from("blogs").update(je).eq("id",e.id).select().single();if(Be)throw Be;ds.success("Blog updated"),t&&t(Oe)}else{je.created_at=new Date().toISOString(),je.view_count=0,je.published&&(je.published_at=new Date().toISOString());const{data:Oe,error:Be}=await Sr.from("blogs").insert(je).select().single();if(Be)throw Be;ds.success("Blog created"),t&&t(Oe)}}catch(je){console.error("Blog save error:",je);const Oe=je instanceof Error?je.message:String(je);ds.error(Oe||"Failed to save blog")}})()},ze=async je=>{if(!je)return;if(!["image/jpeg","image/png","image/webp"].includes(je.type))return ds.error("Unsupported image format. Use JPG, PNG or WebP.");if(je.size>5*1024*1024)return ds.error("Featured image must be under 5MB");const Be=new Image,qe=URL.createObjectURL(je);if(!await new Promise(it=>{Be.onload=()=>{const Ge=Be.width>=600&&Be.height>=300;URL.revokeObjectURL(qe),it(Ge)},Be.onerror=()=>{URL.revokeObjectURL(qe),it(!1)},Be.src=qe}))return ds.error("Image must be at least 600x300 pixels");G(!0),V(0);try{const it=je.name.split(".").pop(),Ge=`blogs/${Date.now()}-${Math.random().toString(36).slice(2,8)}.${it}`,{error:Ke}=await Sr.storage.from("blog-images").upload(Ge,je,{cacheControl:"3600",upsert:!1});if(Ke)throw console.error("Featured upload error:",Ke),Ke;const ut=`${bze.replace(/\/$/,"")}/storage/v1/object/public/blog-images/${encodeURIComponent(Ge)}`;d(rt=>({...rt,featured_image:ut})),j(je),V(100),ds.success("Featured image uploaded")}catch(it){console.error("Featured upload error:",it);const Ge=it instanceof Error?it.message:String(it);ds.error(Ge||"Failed to upload image")}finally{G(!1),setTimeout(()=>V(0),800)}};return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsx(go,{htmlFor:"title",children:"Title *"}),x.jsx($n,{id:"title",value:o.title,onChange:je=>Q(je.target.value),placeholder:"Enter blog title"})]}),x.jsxs("div",{children:[x.jsx(go,{htmlFor:"slug",children:"Slug"}),x.jsx($n,{id:"slug",value:o.slug,onChange:je=>d(Oe=>({...Oe,slug:je.target.value})),placeholder:"url-friendly-slug"})]}),x.jsxs("div",{children:[x.jsx(go,{htmlFor:"author",children:"Author Name"}),x.jsx($n,{id:"author",value:o.author_name,onChange:je=>d(Oe=>({...Oe,author_name:je.target.value})),placeholder:"Author name"})]}),x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(go,{htmlFor:"excerpt",children:"Excerpt"}),x.jsxs(Tr,{type:"button",variant:"ghost",size:"sm",onClick:()=>he("excerpt"),disabled:E,children:[x.jsx(dg,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),x.jsx(bl,{id:"excerpt",value:o.excerpt,onChange:je=>d(Oe=>({...Oe,excerpt:je.target.value})),placeholder:"Brief description of the blog post",rows:3})]}),x.jsxs("div",{className:"flex items-center space-x-2",children:[x.jsx(I9,{id:"published",checked:o.published,onCheckedChange:je=>d(Oe=>({...Oe,published:je}))}),x.jsx(go,{htmlFor:"published",children:"Publish immediately"})]})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(go,{htmlFor:"content",children:"Content *"}),x.jsxs(Tr,{type:"button",variant:"ghost",size:"sm",onClick:()=>he("content"),disabled:E,children:[x.jsx(dg,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),x.jsx(bl,{id:"content",value:o.content,onChange:je=>d(Oe=>({...Oe,content:je.target.value})),placeholder:"Write your blog content here...",rows:12})]}),x.jsxs("div",{children:[x.jsx(go,{children:"Featured Image"}),x.jsxs("div",{className:"flex items-start gap-4",children:[x.jsx("div",{className:"w-40 h-24 rounded overflow-hidden bg-slate-100 border border-border flex items-center justify-center",children:o.featured_image?x.jsx("img",{src:o.featured_image,alt:"featured image",className:"w-full h-full object-cover"}):x.jsx("div",{className:"text-xs text-muted-foreground p-2",children:"No image"})}),x.jsxs("div",{className:"flex-1",children:[x.jsx("input",{id:"featured_file",type:"file",accept:"image/*",onChange:je=>ze(je.target.files?je.target.files[0]:null)}),x.jsxs("div",{className:"mt-2",children:[x.jsx(go,{htmlFor:"featured_image",children:"Or image URL"}),x.jsx($n,{id:"featured_image",value:o.featured_image,onChange:je=>d(Oe=>({...Oe,featured_image:je.target.value})),placeholder:"https://example.com/image.jpg"})]}),N&&x.jsxs("div",{className:"mt-2",children:[x.jsxs("p",{className:"text-xs text-muted-foreground",children:["Uploading featured image... ",z,"%"]}),x.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 mt-1 overflow-hidden",children:x.jsx("div",{className:"bg-primary h-2",style:{width:`${z}%`}})})]})]})]})]})]})]}),x.jsxs("div",{children:[x.jsx(go,{children:"Tags"}),x.jsxs("div",{className:"flex gap-2 mt-2",children:[x.jsx($n,{value:f,onChange:je=>_(je.target.value),placeholder:"Add a tag",onKeyPress:je=>je.key==="Enter"&&(je.preventDefault(),X())}),x.jsx(Tr,{type:"button",onClick:X,variant:"outline",children:"Add"})]}),x.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.tags.map(je=>x.jsxs(Ws,{variant:"secondary",className:"flex items-center gap-1",children:[je,x.jsx(Tl,{className:"h-3 w-3 cursor-pointer",onClick:()=>ie(je)})]},je))})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[x.jsxs("div",{children:[x.jsxs("div",{className:"flex items-center justify-between mb-2",children:[x.jsx(go,{htmlFor:"seo_title",children:"SEO Title"}),x.jsxs(Tr,{type:"button",variant:"ghost",size:"sm",onClick:()=>he("seo"),disabled:E,children:[x.jsx(dg,{className:"h-4 w-4 mr-1"}),"AI Generate"]})]}),x.jsx($n,{id:"seo_title",value:o.seo_title,onChange:je=>d(Oe=>({...Oe,seo_title:je.target.value})),placeholder:"SEO optimized title"})]}),x.jsxs("div",{children:[x.jsx(go,{htmlFor:"seo_description",children:"SEO Description"}),x.jsx(bl,{id:"seo_description",value:o.seo_description,onChange:je=>d(Oe=>({...Oe,seo_description:je.target.value})),placeholder:"SEO meta description",rows:3})]})]}),x.jsxs("div",{children:[x.jsx(go,{children:"SEO Keywords"}),x.jsxs("div",{className:"flex gap-2 mt-2",children:[x.jsx($n,{value:i,onChange:je=>S(je.target.value),placeholder:"Add a keyword",onKeyPress:je=>je.key==="Enter"&&(je.preventDefault(),J())}),x.jsx(Tr,{type:"button",onClick:J,variant:"outline",children:"Add"})]}),x.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.seo_keywords.map(je=>x.jsxs(Ws,{variant:"outline",className:"flex items-center gap-1",children:[je,x.jsx(Tl,{className:"h-3 w-3 cursor-pointer",onClick:()=>se(je)})]},je))})]}),x.jsxs("div",{className:"flex justify-end gap-4",children:[n&&x.jsx(Tr,{variant:"outline",onClick:n,children:"Cancel"}),x.jsx(Tr,{onClick:we,children:e?"Update":"Create"})]})]})},Sze=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!1),[d,f]=B.useState([]),[_,i]=B.useState(!1),[S,E]=B.useState(!1),[I,M]=B.useState(null),j=async()=>{o(!0);try{const{data:z,error:V}=await Sr.functions.invoke("chat",{body:{type:"blog_suggestion"}});if(V)throw V;z?.suggestions&&(t(z.suggestions),ds.success("Blog suggestions generated!"))}catch(z){console.error("Error generating suggestions:",z),t(["5 Things to Check Before Buying Land in Kenya","How to Verify a Land Title Deed","Best Counties for Real Estate Investment in 2024","Understanding Property Taxes in Kenya","Tips for First-Time Home Buyers"]),ds.success("Sample suggestions loaded")}finally{o(!1)}},N=async()=>{i(!0);try{const{data:z,error:V}=await Sr.from("blogs").select("*").order("created_at",{ascending:!1});if(V)throw V;f(z||[])}catch(z){console.error("Failed to load blogs:",z),f([])}finally{i(!1)}};B.useEffect(()=>{N()},[]);const G=z=>new Date(z).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Blog Posts"}),x.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your blog content"})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsxs(Tr,{onClick:()=>{M(null),E(!0)},children:[x.jsx(yJ,{className:"h-4 w-4 mr-2"}),"New Blog Post"]}),x.jsx(Tr,{onClick:N,variant:"outline",children:"Refresh"})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Total Posts"}),x.jsx(bM,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold",children:d.length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"From database"})]})]}),x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Published"}),x.jsx($c,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold",children:d.filter(z=>z.published).length}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"From database"})]})]}),x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Total Views"}),x.jsx($c,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold",children:d.reduce((z,V)=>z+(V.view_count??0),0)}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"From database"})]})]})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsxs(xo,{className:"flex items-center gap-2",children:[x.jsx(aJ,{className:"h-5 w-5 text-primary"}),"AI Blog Suggestions"]})}),x.jsxs(bo,{className:"space-y-4",children:[x.jsxs(Tr,{onClick:j,disabled:n,variant:"outline",children:[x.jsx(dg,{className:"mr-2 h-4 w-4"}),n?"Generating...":"Generate Blog Ideas"]}),e.length>0&&x.jsx("div",{className:"grid gap-2",children:e.map((z,V)=>x.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[x.jsx("span",{className:"text-sm",children:z}),x.jsx(Ws,{variant:"outline",children:"Idea"})]},V))})]})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Blog Posts"})}),x.jsx(bo,{children:x.jsxs(f2,{children:[x.jsx(p2,{children:x.jsxs(Yf,{children:[x.jsx(xa,{children:"Title"}),x.jsx(xa,{children:"Status"}),x.jsx(xa,{children:"Author"}),x.jsx(xa,{children:"Published"}),x.jsx(xa,{children:"Views"}),x.jsx(xa,{children:"Actions"})]})}),x.jsx(m2,{children:d.map(z=>x.jsxs(Yf,{children:[x.jsx(ba,{className:"font-medium max-w-xs",children:x.jsx("div",{className:"truncate",title:z.title,children:z.title})}),x.jsx(ba,{children:x.jsx(Ws,{variant:z.published?"default":"secondary",children:z.published?"Published":"Draft"})}),x.jsx(ba,{children:z.author_name||"-"}),x.jsx(ba,{children:z.published_at?G(z.published_at):"-"}),x.jsx(ba,{children:z.view_count??0}),x.jsx(ba,{children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(Tr,{variant:"ghost",size:"sm",onClick:async()=>{try{const{data:V,error:K}=await Sr.from("blogs").update({published:!z.published,published_at:z.published?null:new Date().toISOString()}).eq("id",z.id).select().single();if(K)throw K;ds.success("Publish status updated"),N()}catch(V){console.error(V),ds.error("Failed to update")}},children:z.published?x.jsx(f$,{className:"h-4 w-4"}):x.jsx($c,{className:"h-4 w-4"})}),x.jsx(Tr,{variant:"ghost",size:"sm",onClick:()=>{M(z),E(!0)},children:x.jsx(SJ,{className:"h-4 w-4"})}),x.jsx(Tr,{variant:"ghost",size:"sm",onClick:async()=>{if(confirm("Delete this blog post?"))try{const{error:V}=await Sr.from("blogs").delete().eq("id",z.id);if(V)throw V;ds.success("Blog deleted"),N()}catch(V){console.error(V),ds.error("Delete failed")}},children:x.jsx(p$,{className:"h-4 w-4"})}),x.jsx(Tr,{variant:"ghost",size:"sm",asChild:!0,children:x.jsx("a",{href:`/blog/${z.slug}`,target:"_blank",rel:"noopener noreferrer",children:x.jsx($c,{className:"h-4 w-4"})})})]})})]},z.id))})]})})]}),x.jsx(Zu,{open:S,onOpenChange:z=>E(z),children:x.jsxs(tu,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[x.jsx(sh,{children:x.jsx(Qu,{children:I?"Edit Blog":"New Blog"})}),x.jsx("div",{className:"py-4",children:x.jsx(wze,{blog:I,onSave:z=>{E(!1),N()},onCancel:()=>E(!1)})})]})})]})})},Tze=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(""),_=e.filter(z=>z.title.toLowerCase().includes(d.toLowerCase())||z.seller_name.toLowerCase().includes(d.toLowerCase()));B.useEffect(()=>{(async()=>{o(!0);const{data:V,error:K}=await Sr.from("property_submissions").select("*").order("created_at",{ascending:!1});K&&console.error(K),t(V||[]),o(!1)})()},[]);const i=async z=>{try{await Sr.from("property_submissions").update({status:"rejected",reviewed_at:new Date().toISOString()}).eq("id",z.id),t(V=>V.filter(K=>K.id!==z.id)),rn({title:"Rejected",description:"Submission rejected."})}catch(V){console.error(V),rn({title:"Error",description:"Failed to reject submission.",variant:"destructive"})}},[S,E]=B.useState(null),[I,M]=B.useState({title:"",price:"",location:"",description:"",seller_name:"",seller_phone:""}),j=z=>{E(z),M({title:z.title||"",price:String(z.price||""),location:"",description:"",seller_name:z.seller_name||"",seller_phone:z.seller_phone||""})},N=()=>{E(null)},G=async()=>{if(S)try{const z={title:I.title,description:I.description||null,property_type:S.property_type||"land",price:Number(I.price||0),location:I.location||"",images:S.images||null,seller_name:I.seller_name,seller_phone:I.seller_phone,is_admin_property:!1,approved_at:new Date().toISOString()},{data:V,error:K}=await Sr.from("properties").insert([z]).select().single();if(K)throw K;await Sr.from("property_submissions").update({status:"approved",created_property_id:V.id,reviewed_at:new Date().toISOString()}).eq("id",S.id),t(Q=>Q.filter(X=>X.id!==S.id)),N()}catch(z){console.error(z);const V=z instanceof Error?z.message:String(z);rn({title:"Error",description:V||"Failed to approve submission.",variant:"destructive"})}};return x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Property Submissions"}),x.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Review and approve seller submissions"})]}),x.jsxs("div",{className:"relative",children:[x.jsx(kf,{className:"absolute left-3 top-3 text-slate-400",size:20}),x.jsx($n,{placeholder:"Search by property title or seller name...",value:d,onChange:z=>f(z.target.value),className:"pl-10 py-2 h-10"})]}),n?x.jsx("div",{className:"space-y-3",children:[1,2,3].map(z=>x.jsx("div",{className:"h-24 bg-slate-100 dark:bg-slate-700 rounded-lg animate-pulse"},z))}):_.length===0?x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-8 text-center",children:x.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:d?"No submissions found matching your search":"No pending submissions"})}):x.jsx("div",{className:"grid gap-4",children:_.map(z=>x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[x.jsxs("div",{className:"col-span-2",children:[x.jsxs("div",{className:"flex items-start justify-between mb-3",children:[x.jsxs("div",{children:[x.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:z.title}),x.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["Submitted by ",x.jsx("strong",{children:z.seller_name})]})]}),x.jsx(Ws,{variant:"secondary",className:"ml-2",children:"Pending"})]}),x.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400",children:[x.jsxs("p",{children:[x.jsx("strong",{children:"Price:"})," KES ",Number(z.price).toLocaleString()]}),x.jsxs("p",{children:[x.jsx("strong",{children:"Seller Phone:"})," ",z.seller_phone]}),z.images&&z.images.length>0&&x.jsxs("p",{children:[x.jsx("strong",{children:"Images:"})," ",z.images.length," file(s)"]})]})]}),x.jsxs("div",{className:"flex flex-col gap-2 md:justify-start",children:[x.jsxs(Tr,{onClick:()=>j(z),className:"bg-blue-600 hover:bg-blue-700 inline-flex items-center justify-center gap-2",children:[x.jsx($c,{size:18}),"Review"]}),x.jsxs(Tr,{onClick:()=>i(z),variant:"destructive",className:"inline-flex items-center justify-center gap-2",children:[x.jsx(Tl,{size:18}),"Reject"]})]})]})},z.id))}),x.jsx(Zu,{open:!!S,onOpenChange:z=>{z||N()},children:x.jsxs(tu,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[x.jsx(sh,{children:x.jsx(Qu,{className:"text-2xl",children:"Review & Approve Submission"})}),S&&x.jsxs("div",{className:"grid gap-4",children:[x.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 p-4 rounded-lg",children:[x.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Original Submission Details"}),x.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[x.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:S.title}),x.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Seller: ",S.seller_name]}),x.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Phone: ",S.seller_phone]}),x.jsxs("p",{className:"text-slate-600 dark:text-slate-400",children:["Price: KES ",Number(S.price).toLocaleString()]})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Property Title"}),x.jsx($n,{value:I.title,onChange:z=>M(V=>({...V,title:z.target.value})),className:"h-10"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Price (KES)"}),x.jsx($n,{value:I.price,onChange:z=>M(V=>({...V,price:z.target.value})),type:"number",className:"h-10"})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Location"}),x.jsx($n,{placeholder:"Location",value:I.location,onChange:z=>M(V=>({...V,location:z.target.value})),className:"h-10"})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Description"}),x.jsx(bl,{placeholder:"Description",value:I.description,onChange:z=>M(V=>({...V,description:z.target.value})),className:"min-h-24"})]}),x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Seller Name"}),x.jsx($n,{placeholder:"Seller name",value:I.seller_name,onChange:z=>M(V=>({...V,seller_name:z.target.value})),className:"h-10"})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2 block",children:"Seller Phone"}),x.jsx($n,{placeholder:"Seller phone",value:I.seller_phone,onChange:z=>M(V=>({...V,seller_phone:z.target.value})),className:"h-10"})]})]})]}),x.jsxs(ax,{className:"flex gap-2 sm:justify-end",children:[x.jsx(Tr,{variant:"outline",onClick:N,children:"Cancel"}),x.jsxs(Tr,{onClick:G,className:"bg-green-600 hover:bg-green-700 inline-flex items-center gap-2",children:[x.jsx($S,{size:18}),"Approve & Publish"]})]})]})})]})})},Aze=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(""),_=e.filter(S=>S.buyer_name.toLowerCase().includes(d.toLowerCase())||S.buyer_phone.includes(d)||(S.message||"").toLowerCase().includes(d.toLowerCase()));B.useEffect(()=>{(async()=>{o(!0);const{data:E,error:I}=await Sr.from("buyer_inquiries").select("*").order("created_at",{ascending:!1});I&&console.error(I),t(E||[]),o(!1)})()},[]);const i=async(S,E)=>{try{await Sr.from("buyer_inquiries").update({lead_status:E}).eq("id",S),t(I=>I.map(M=>M.id===S?{...M,lead_status:E}:M))}catch(I){console.error(I);const M=I instanceof Error?I.message:String(I);rn({title:"Error",description:M||"Failed to update lead status",variant:"destructive"})}};return x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Buyer Inquiries"}),x.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Track and manage buyer leads"})]}),x.jsxs("div",{className:"relative",children:[x.jsx(kf,{className:"absolute left-3 top-3 text-slate-400",size:20}),x.jsx($n,{placeholder:"Search by name, phone, or message...",value:d,onChange:S=>f(S.target.value),className:"pl-10 py-2 h-10"})]}),x.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden",children:n?x.jsxs("div",{className:"p-8 text-center",children:[x.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-4 border-slate-300 border-t-blue-600 rounded-full"}),x.jsx("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:"Loading inquiries..."})]}):_.length===0?x.jsx("div",{className:"p-8 text-center",children:x.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg",children:d?"No inquiries found matching your search":"No inquiries yet"})}):x.jsx("div",{className:"overflow-x-auto",children:x.jsxs("table",{className:"w-full",children:[x.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600",children:x.jsxs("tr",{children:[x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Buyer"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Contact"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Message"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Lead Status"}),x.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-slate-900 dark:text-white",children:"Date"})]})}),x.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:_.map(S=>x.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[x.jsx("td",{className:"px-6 py-4",children:x.jsx("div",{className:"font-medium text-slate-900 dark:text-white",children:S.buyer_name})}),x.jsx("td",{className:"px-6 py-4",children:x.jsx("div",{className:"flex flex-col gap-2",children:x.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[x.jsx(Jf,{size:16}),x.jsx("a",{href:`tel:${S.buyer_phone}`,className:"hover:text-blue-600 dark:hover:text-blue-400",children:S.buyer_phone})]})})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 max-w-xs truncate",children:[(S.message||"").slice(0,50),(S.message||"").length>50?"...":""]})}),x.jsx("td",{className:"px-6 py-4",children:x.jsxs(Fu,{value:S.lead_status||"warm",onValueChange:E=>i(S.id,E),children:[x.jsx(Gc,{className:"w-32 h-8 text-xs",children:x.jsx(Bu,{})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"hot",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Hot"]})}),x.jsx(Yi,{value:"warm",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"w-2 h-2 bg-orange-500 rounded-full"}),"Warm"]})}),x.jsx(Yi,{value:"cold",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Cold"]})})]})]})}),x.jsx("td",{className:"px-6 py-4 text-sm text-slate-600 dark:text-slate-400",children:S.created_at?new Date(S.created_at).toLocaleDateString():""})]},S.id))})]})})})]})})},v4={positive:{emoji:"",label:"Positive"},neutral:{emoji:"",label:"Neutral"},negative:{emoji:"",label:"Negative"}},Eze=({page:e="chat",accent:t="emerald",onSubmit:n})=>{const[o,d]=B.useState(0),[f,_]=B.useState(0),[i,S]=B.useState(""),[E,I]=B.useState(!1),M=B.useMemo(()=>o>=4?"positive":o===3?"neutral":o>0?"negative":null,[o]),j=B.useMemo(()=>o>=4?"What did you love most?":o===3?"What could we improve?":o>0?"What went wrong?":"How was your experience?",[o]),N=()=>{if(!(!o||!M)){I(!0);try{n?.({rating:o,sentiment:M,feedback:i.trim()||null})}finally{I(!1)}}};return x.jsx("div",{className:"flex h-full items-center justify-center p-4",children:x.jsxs(_o,{className:"w-full max-w-md",children:[x.jsxs(vo,{className:"text-center",children:[x.jsx(mn.div,{initial:{scale:0},animate:{scale:1},className:`mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-${t}-100`,children:x.jsx(r0,{className:`h-7 w-7 text-${t}-600`})}),x.jsx(xo,{className:"text-xl",children:j}),M&&x.jsxs("p",{className:"mt-1 text-sm text-muted-foreground flex justify-center gap-2",children:[x.jsx("span",{children:v4[M].emoji}),v4[M].label]})]}),x.jsxs(bo,{className:"space-y-6",children:[x.jsx("div",{className:"flex justify-center gap-1",children:[1,2,3,4,5].map(G=>x.jsx(mn.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onMouseEnter:()=>_(G),onMouseLeave:()=>_(0),onClick:()=>d(G),children:x.jsx(Pf,{className:`h-8 w-8 transition ${G<=(f||o)?`fill-${t}-400 text-${t}-400`:"text-muted"}`})},G))}),o>0&&x.jsx("textarea",{rows:3,value:i,onChange:G=>S(G.target.value),placeholder:"Tell us more (optional)",className:`w-full resize-none rounded-lg border p-3 focus:ring-2 focus:ring-${t}-500`}),x.jsx(Tr,{disabled:!o||E,onClick:N,className:"w-full",children:E?"Submitting":"Send feedback"})]})]})})},Pze=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(null),[_,i]=B.useState([]),[S,E]=B.useState(!1);B.useEffect(()=>{I()},[]);const I=async()=>{try{o(!0);const{data:J,error:se}=await Sr.from("chat_conversations").select("*").order("started_at",{ascending:!1}).limit(100);if(se)throw se;t(J||[])}catch(J){console.error("Error fetching conversations:",J);const se=J instanceof Error?J.message:String(J);rn({title:"Error",description:se||"Failed to load conversations",variant:"destructive"})}finally{o(!1)}},M=async J=>{try{E(!0);const{data:se,error:he}=await Sr.from("chat_messages").select("*").eq("session_id",J).order("created_at",{ascending:!0});if(he)throw he;i(se||[])}catch(se){console.error("Error fetching messages:",se);const he=se instanceof Error?se.message:String(se);rn({title:"Error",description:he||"Failed to load messages",variant:"destructive"})}finally{E(!1)}},j=J=>{f(J),M(J.id)},N=J=>J?new Date(J).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",G=J=>{if(J.summary)try{return JSON.parse(J.summary).rating||null}catch{return null}return null},z=J=>{if(J.summary)try{return JSON.parse(J.summary).feedback||null}catch{return null}return null},V=e.length,K=e.filter(J=>G(J)!==null),Q=K.length>0?(K.reduce((J,se)=>J+(G(se)||0),0)/K.length).toFixed(1):"-",X=e.filter(J=>{const se=G(J);return se!==null&&se<=2}).length,ie=e.filter(J=>{if(!J.started_at)return!1;const se=new Date;return new Date(J.started_at).toDateString()===se.toDateString()}).length;return x.jsx(hc,{children:x.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsx("h1",{className:"text-3xl font-bold",children:"Chat Analytics Dashboard"}),x.jsx(Tr,{onClick:I,variant:"outline",children:"Refresh"})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Total Conversations"}),x.jsx(xf,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold",children:V}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"All time user chats"})]})]}),x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Average Rating"}),x.jsx(Pf,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsxs("div",{className:"text-2xl font-bold",children:[Q,"/5"]}),x.jsxs("p",{className:"text-xs text-muted-foreground",children:[K.length," rated conversations"]})]})]}),x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Low Ratings"}),x.jsx(AJ,{className:"h-4 w-4 text-red-500"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold text-red-600",children:X}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Ratings 2 or below"})]})]}),x.jsxs(_o,{children:[x.jsxs(vo,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[x.jsx(xo,{className:"text-sm font-medium",children:"Active Today"}),x.jsx(m$,{className:"h-4 w-4 text-muted-foreground"})]}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-2xl font-bold",children:ie}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Conversations today"})]})]})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsxs(xo,{className:"flex items-center gap-2",children:[x.jsx(xf,{className:"h-5 w-5 text-primary"}),"Recent Conversations"]})}),x.jsx(bo,{children:n?x.jsxs("div",{className:"text-center py-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),x.jsx("p",{children:"Loading conversations..."})]}):e.length===0?x.jsxs("div",{className:"text-center py-12",children:[x.jsx(xf,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),x.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No conversations yet"}),x.jsx("p",{className:"text-muted-foreground",children:"User conversations will appear here when visitors use the chat feature."})]}):x.jsxs(f2,{children:[x.jsx(p2,{children:x.jsxs(Yf,{children:[x.jsx(xa,{children:"User"}),x.jsx(xa,{children:"Started"}),x.jsx(xa,{children:"Last Message"}),x.jsx(xa,{children:"Rating"}),x.jsx(xa,{children:"Actions"})]})}),x.jsx(m2,{children:e.map(J=>{const se=G(J);return x.jsxs(Yf,{children:[x.jsx(ba,{className:"font-medium",children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(jf,{className:"h-4 w-4 text-muted-foreground"}),J.user_display_name||"Anonymous"]})}),x.jsx(ba,{children:x.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[x.jsx(hw,{className:"h-3 w-3"}),N(J.started_at)]})}),x.jsx(ba,{className:"max-w-xs",children:x.jsx("div",{className:"truncate text-sm text-muted-foreground",children:J.last_message||"No messages"})}),x.jsx(ba,{children:se?x.jsxs(Ws,{variant:se>=4?"default":se>=3?"secondary":"destructive",children:[x.jsx(Pf,{className:"h-3 w-3 mr-1 fill-current"}),se,"/5"]}):x.jsx("span",{className:"text-muted-foreground text-sm",children:"Not rated"})}),x.jsx(ba,{children:x.jsx(Tr,{variant:"ghost",size:"sm",onClick:()=>j(J),children:x.jsx($c,{className:"h-4 w-4"})})})]},J.id)})})]})})]}),x.jsx(Zu,{open:!!d,onOpenChange:()=>f(null),children:x.jsxs(tu,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[x.jsx(sh,{children:x.jsxs(Qu,{className:"flex items-center gap-2",children:[x.jsx(xf,{className:"h-5 w-5"}),"Conversation with ",d?.user_display_name||"Anonymous"]})}),x.jsxs("div",{className:"space-y-4",children:[d&&x.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[x.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"Name:"})," ",d.user_display_name||"Anonymous"]}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"Started:"})," ",N(d.started_at)]}),x.jsxs("div",{children:[x.jsx("span",{className:"font-medium",children:"Rating:"})," ",G(d)?`${G(d)}/5`:"Not rated"]})]}),z(d)&&x.jsxs("div",{className:"mt-2",children:[x.jsx("span",{className:"font-medium",children:"Feedback:"})," ",z(d)]})]}),d&&!G(d)&&x.jsxs("div",{children:[x.jsx("h3",{className:"text-sm font-medium mb-2",children:"Add rating / feedback"}),x.jsx(Eze,{page:"admin",onSubmit:async({rating:J,sentiment:se,feedback:he})=>{try{const we={rating:J,rating_feedback:he};try{const Be=d.summary?JSON.parse(d.summary):{};we.summary=JSON.stringify({...Be,rating:J,feedback:he})}catch{we.summary=JSON.stringify({rating:J,feedback:he})}const{data:ze,error:je}=await Sr.from("chat_conversations").update(we).eq("id",d.id).select().maybeSingle?.();if(je)throw je;await I();const Oe=await Sr.from("chat_conversations").select("*").eq("id",d.id).maybeSingle();f(Be=>({...Be,...Oe?.data||{}})),rn({title:"Saved",description:"Rating saved."})}catch(we){console.error("Failed to save rating",we),rn({title:"Error",description:"Failed to save rating",variant:"destructive"})}}})]}),x.jsx("div",{className:"space-y-3",children:S?x.jsx("div",{className:"text-center py-8",children:x.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto"})}):_.length===0?x.jsx("p",{className:"text-center text-muted-foreground py-4",children:"No messages found"}):_.map(J=>x.jsx("div",{className:"space-y-2",children:x.jsxs("div",{className:`p-3 rounded-lg ${J.role==="user"?"bg-primary/10 ml-8":"bg-muted mr-8"}`,children:[x.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[x.jsx(Ws,{variant:J.role==="user"?"default":"secondary",className:"text-xs",children:J.role==="user"?"User":"AI Assistant"}),x.jsx("span",{className:"text-xs text-muted-foreground",children:N(J.created_at)})]}),x.jsx("p",{className:"text-sm whitespace-pre-wrap",children:J.content})]})},J.id))})]})]})})]})})};var Cze="Separator",x4="horizontal",Ize=["horizontal","vertical"],M9=B.forwardRef((e,t)=>{const{decorative:n,orientation:o=x4,...d}=e,f=Mze(o)?o:x4,i=n?{role:"none"}:{"aria-orientation":f==="vertical"?f:void 0,role:"separator"};return x.jsx(En.div,{"data-orientation":f,...i,...d,ref:t})});M9.displayName=Cze;function Mze(e){return Ize.includes(e)}var O9=M9;const R9=B.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...o},d)=>x.jsx(O9,{ref:d,decorative:n,orientation:t,className:kr("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...o}));R9.displayName=O9.displayName;const Oze=()=>{const[e,t]=B.useState(!0),[n,o]=B.useState(!1),[d,f]=B.useState(!1),[_,i]=B.useState(null),[S,E]=B.useState({full_name:"",phone:""}),[I,M]=B.useState({current:"",new:"",confirm:""});B.useEffect(()=>{j()},[]);const j=async()=>{t(!0);try{const{data:{user:z}}=await Sr.auth.getUser();if(!z)return;i(z);const{data:V}=await Sr.from("profiles").select("*").eq("user_id",z.id).maybeSingle();V&&E({full_name:V.full_name||"",phone:V.phone||""})}catch(z){console.error("Error loading profile:",z)}finally{t(!1)}},N=async()=>{if(_){o(!0);try{const{error:z}=await Sr.from("profiles").upsert({user_id:_.id,full_name:S.full_name.trim()||null,phone:S.phone.trim()||null,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(z)throw z;rn({title:"Success",description:"Profile updated successfully"})}catch(z){console.error(z);const V=z instanceof Error?z.message:String(z);rn({title:"Error",description:V||"Failed to update profile",variant:"destructive"})}finally{o(!1)}}},G=async()=>{if(!I.new||!I.confirm){rn({title:"Error",description:"Please fill in all password fields",variant:"destructive"});return}if(I.new!==I.confirm){rn({title:"Error",description:"New passwords do not match",variant:"destructive"});return}if(I.new.length<6){rn({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"});return}f(!0);try{const{error:z}=await Sr.auth.updateUser({password:I.new});if(z)throw z;M({current:"",new:"",confirm:""}),rn({title:"Success",description:"Password changed successfully"})}catch(z){console.error(z);const V=z instanceof Error?z.message:String(z);rn({title:"Error",description:V||"Failed to change password",variant:"destructive"})}finally{f(!1)}};return e?x.jsx("div",{className:"flex items-center justify-center py-12",children:x.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-muted border-t-primary rounded-full"})}):x.jsx(hc,{children:x.jsxs("div",{className:"space-y-6 max-w-2xl",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Profile Settings"}),x.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your account settings and preferences"})]}),x.jsxs(_o,{children:[x.jsxs(vo,{children:[x.jsxs(xo,{className:"flex items-center gap-2",children:[x.jsx(jf,{size:20}),"Profile Information"]}),x.jsx(EC,{children:"Update your personal details"})]}),x.jsxs(bo,{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{htmlFor:"email",className:"flex items-center gap-2",children:[x.jsx(US,{size:14}),"Email Address"]}),x.jsx($n,{id:"email",value:_?.email||"",disabled:!0,className:"bg-muted"}),x.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{htmlFor:"full_name",className:"flex items-center gap-2",children:[x.jsx(jf,{size:14}),"Full Name"]}),x.jsx($n,{id:"full_name",value:S.full_name,onChange:z=>E(V=>({...V,full_name:z.target.value})),placeholder:"Enter your full name"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{htmlFor:"phone",className:"flex items-center gap-2",children:[x.jsx(Jf,{size:14}),"Phone Number"]}),x.jsx($n,{id:"phone",value:S.phone,onChange:z=>E(V=>({...V,phone:z.target.value})),placeholder:"Enter your phone number"})]}),x.jsxs(Tr,{onClick:N,disabled:n,children:[x.jsx(_J,{size:16,className:"mr-2"}),n?"Saving...":"Save Changes"]})]})]}),x.jsx(R9,{}),x.jsxs(_o,{children:[x.jsxs(vo,{children:[x.jsxs(xo,{className:"flex items-center gap-2",children:[x.jsx(fw,{size:20}),"Change Password"]}),x.jsx(EC,{children:"Update your account password"})]}),x.jsxs(bo,{className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx(go,{htmlFor:"new_password",children:"New Password"}),x.jsx($n,{id:"new_password",type:"password",value:I.new,onChange:z=>M(V=>({...V,new:z.target.value})),placeholder:"Enter new password"})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(go,{htmlFor:"confirm_password",children:"Confirm New Password"}),x.jsx($n,{id:"confirm_password",type:"password",value:I.confirm,onChange:z=>M(V=>({...V,confirm:z.target.value})),placeholder:"Confirm new password"})]}),x.jsxs(Tr,{onClick:G,disabled:d,variant:"outline",children:[x.jsx(fw,{size:16,className:"mr-2"}),d?"Changing...":"Change Password"]})]})]})]})})},Rze={light:"",dark:".dark"},k9=B.createContext(null);function j9(){const e=B.useContext(k9);if(!e)throw new Error("useChart must be used within a <ChartContainer />");return e}const cM=B.forwardRef(({id:e,className:t,children:n,config:o,...d},f)=>{const _=B.useId(),i=`chart-${e||_.replace(/:/g,"")}`;return x.jsx(k9.Provider,{value:{config:o},children:x.jsxs("div",{"data-chart":i,ref:f,className:kr("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...d,children:[x.jsx(kze,{id:i,config:o}),x.jsx(JC,{children:n})]})})});cM.displayName="Chart";const kze=({id:e,config:t})=>{const n=Object.entries(t).filter(([o,d])=>d.theme||d.color);return n.length?x.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Rze).map(([o,d])=>`
${d} [data-chart=${e}] {
${n.map(([f,_])=>{const i=_.theme?.[o]||_.color;return i?`  --color-${f}: ${i};`:null}).join(`
`)}
}
`).join(`
`)}}):null},uM=B.forwardRef(({active:e,payload:t,className:n,indicator:o="dot",hideLabel:d=!1,hideIndicator:f=!1,label:_,labelFormatter:i,labelClassName:S,formatter:E,color:I,nameKey:M,labelKey:j},N)=>{const{config:G}=j9(),z=B.useMemo(()=>{if(d||!t?.length)return null;const[K]=t,Q=`${j||K.dataKey||K.name||"value"}`,X=hM(G,K,Q),ie=!j&&typeof _=="string"?G[_]?.label||_:X?.label;return i?x.jsx("div",{className:kr("font-medium",S),children:i(ie,t)}):ie?x.jsx("div",{className:kr("font-medium",S),children:ie}):null},[_,i,t,d,S,G,j]);if(!e||!t?.length)return null;const V=t.length===1&&o!=="dot";return x.jsxs("div",{ref:N,className:kr("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",n),children:[V?null:z,x.jsx("div",{className:"grid gap-1.5",children:t.map((K,Q)=>{const X=`${M||K.name||K.dataKey||"value"}`,ie=hM(G,K,X),J=I||K.payload.fill||K.color;return x.jsx("div",{className:kr("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",o==="dot"&&"items-center"),children:E&&K?.value!==void 0&&K.name?E(K.value,K.name,K,Q,K.payload):x.jsxs(x.Fragment,{children:[ie?.icon?x.jsx(ie.icon,{}):!f&&x.jsx("div",{className:kr("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":o==="dot","w-1":o==="line","w-0 border-[1.5px] border-dashed bg-transparent":o==="dashed","my-0.5":V&&o==="dashed"}),style:{"--color-bg":J,"--color-border":J}}),x.jsxs("div",{className:kr("flex flex-1 justify-between leading-none",V?"items-end":"items-center"),children:[x.jsxs("div",{className:"grid gap-1.5",children:[V?z:null,x.jsx("span",{className:"text-muted-foreground",children:ie?.label||K.name})]}),K.value&&x.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:K.value.toLocaleString()})]})]})},K.dataKey)})})]})});uM.displayName="ChartTooltip";const dM=B.forwardRef(({className:e,hideIcon:t=!1,payload:n,verticalAlign:o="bottom",nameKey:d},f)=>{const{config:_}=j9();return n?.length?x.jsx("div",{ref:f,className:kr("flex items-center justify-center gap-4",o==="top"?"pb-3":"pt-3",e),children:n.map(i=>{const S=`${d||i.dataKey||"value"}`,E=hM(_,i,S);return x.jsxs("div",{className:kr("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[E?.icon&&!t?x.jsx(E.icon,{}):x.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:i.color}}),E?.label]},i.value)})}):null});dM.displayName="ChartLegend";function hM(e,t,n){if(typeof t!="object"||t===null)return;const o="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let d=n;return n in t&&typeof t[n]=="string"?d=t[n]:o&&n in o&&typeof o[n]=="string"&&(d=o[n]),d in e?e[d]:e[n]}const b4=({size:e=36})=>x.jsx("div",{role:"status","aria-live":"polite",className:"inline-flex items-center justify-center",style:{width:e,height:e},children:x.jsxs("svg",{className:"animate-spin",width:e,height:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[x.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"var(--muted-foreground, #e5e7eb)",strokeWidth:"4"}),x.jsx("path",{d:"M22 12a10 10 0 00-10-10",stroke:"var(--primary, #0369a1)",strokeWidth:"4",strokeLinecap:"round"})]})}),jze={day:1,week:7,month:30,year:365};function Dze(){const[e,t]=B.useState("week"),[n,o]=B.useState([]),[d,f]=B.useState(!1);B.useEffect(()=>{_()},[e]);const _=async()=>{f(!0);try{const I=new Date(Date.now()-jze[e]*24*60*60*1e3).toISOString(),{data:M,error:j}=await Sr.from("page_views").select("id,path,url,referrer,user_agent,created_at").gte("created_at",I).order("created_at",{ascending:!1}).limit(1e4);if(j)throw j;o(M||[])}catch(I){console.error("Failed to load page views:",I),o([])}finally{f(!1)}},i=n.length,S=n.reduce((I,M)=>{const j=new Date(M.created_at).toISOString().slice(0,10);return I[j]=(I[j]||0)+1,I},{}),E=Object.entries(n.reduce((I,M)=>(I[M.path]=(I[M.path]||0)+1,I),{})).sort((I,M)=>M[1]-I[1]);return x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center justify-between",children:[x.jsxs("div",{children:[x.jsx("h1",{className:"text-2xl font-bold",children:"Analytics"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Website visitors and page views"})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{onClick:()=>t("day"),className:`px-3 py-1 rounded ${e==="day"?"bg-slate-200":"border"}`,children:"Day"}),x.jsx("button",{onClick:()=>t("week"),className:`px-3 py-1 rounded ${e==="week"?"bg-slate-200":"border"}`,children:"Week"}),x.jsx("button",{onClick:()=>t("month"),className:`px-3 py-1 rounded ${e==="month"?"bg-slate-200":"border"}`,children:"Month"}),x.jsx("button",{onClick:()=>t("year"),className:`px-3 py-1 rounded ${e==="year"?"bg-slate-200":"border"}`,children:"Year"})]})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Total Views"})}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-3xl font-bold",children:i}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Views in selected range"})]})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Unique Pages"})}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-3xl font-bold",children:Object.keys(E).length}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Distinct page paths"})]})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Top Page"})}),x.jsxs(bo,{children:[x.jsx("div",{className:"text-lg font-medium",children:E[0]?.[0]??"-"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Most visited path"})]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[x.jsxs(_o,{className:"lg:col-span-2",children:[x.jsx(vo,{children:x.jsx(xo,{children:"Views Over Time"})}),x.jsx(bo,{children:d?x.jsx("div",{className:"flex items-center justify-center p-8",children:x.jsx(b4,{})}):x.jsx(cM,{config:{views:{label:"Views",color:"hsl(220 90% 56%)"}},style:{height:260},children:x.jsxs(jW,{data:Object.entries(S).map(([I,M])=>({date:I,views:M})).sort((I,M)=>I.date.localeCompare(M.date)),children:[x.jsx(NR,{strokeDasharray:"3 3"}),x.jsx(qf,{dataKey:"date"}),x.jsx(Zf,{}),x.jsx(Ty,{type:"monotone",dataKey:"views",stroke:"var(--color-views)",strokeWidth:3,dot:{r:3}}),x.jsx(Ga,{content:x.jsx(uM,{})}),x.jsx(Xd,{content:x.jsx(dM,{})})]})})})]}),x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Top Pages"})}),x.jsx(bo,{children:d?x.jsx("div",{className:"flex items-center justify-center p-8",children:x.jsx(b4,{})}):x.jsxs("div",{className:"space-y-4",children:[x.jsx(cM,{config:{pages:{label:"Pages",color:"hsl(260 80% 60%)"}},style:{height:240},children:x.jsxs(YLe,{children:[x.jsx(nd,{data:E.slice(0,8).map(([I,M])=>({name:I,value:M})),dataKey:"value",nameKey:"name",innerRadius:50,outerRadius:80,paddingAngle:4,label:({percent:I})=>`${Math.round((I||0)*100)}%`}),x.jsx(Ga,{content:x.jsx(uM,{})}),x.jsx(Xd,{content:x.jsx(dM,{})})]})}),x.jsx("div",{className:"max-h-48 overflow-y-auto",children:x.jsxs(f2,{children:[x.jsx(p2,{children:x.jsxs(Yf,{children:[x.jsx(xa,{children:"Path"}),x.jsx(xa,{children:"Views"})]})}),x.jsx(m2,{children:E.slice(0,20).map(([I,M])=>x.jsxs(Yf,{children:[x.jsx(ba,{className:"font-medium truncate max-w-lg",children:I}),x.jsx(ba,{children:M})]},I))})]})})]})})]})]})]})}function Lze({text:e,speed:t=40,className:n="",cursor:o=!0}){const[d,f]=B.useState("");return B.useEffect(()=>{let _=0;f("");const i=setInterval(()=>{f(S=>S+e.charAt(_)),_+=1,_>=e.length&&clearInterval(i)},t);return()=>clearInterval(i)},[e,t]),x.jsxs("span",{className:n,"aria-label":e,children:[d,o&&x.jsx("span",{"aria-hidden":"true",className:"inline-block ml-1 w-[0.6ch] align-middle animate-blink",children:"|"})]})}const Nze=z6,zze=F6,Fze=B6,D9=B.forwardRef(({className:e,...t},n)=>x.jsx(uT,{className:kr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));D9.displayName=uT.displayName;const Bze=Q0("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),L9=B.forwardRef(({side:e="right",className:t,children:n,...o},d)=>x.jsxs(Fze,{children:[x.jsx(D9,{}),x.jsxs(dT,{ref:d,className:kr(Bze({side:e}),t),...o,children:[n,x.jsxs($6,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[x.jsx(Tl,{className:"h-4 w-4"}),x.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));L9.displayName=dT.displayName;const N9=({className:e,...t})=>x.jsx("div",{className:kr("flex flex-col space-y-2 text-center sm:text-left",e),...t});N9.displayName="SheetHeader";const z9=B.forwardRef(({className:e,...t},n)=>x.jsx(hT,{ref:n,className:kr("text-lg font-semibold text-foreground",e),...t}));z9.displayName=hT.displayName;const $ze=B.forwardRef(({className:e,...t},n)=>x.jsx(fT,{ref:n,className:kr("text-sm text-muted-foreground",e),...t}));$ze.displayName=fT.displayName;var F9=["PageUp","PageDown"],B9=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$9={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Ey="Slider",[fM,Vze,Uze]=X0(Ey),[V9,WFe]=fc(Ey,[Uze]),[Gze,y2]=V9(Ey),U9=B.forwardRef((e,t)=>{const{name:n,min:o=0,max:d=100,step:f=1,orientation:_="horizontal",disabled:i=!1,minStepsBetweenThumbs:S=0,defaultValue:E=[o],value:I,onValueChange:M=()=>{},onValueCommit:j=()=>{},inverted:N=!1,form:G,...z}=e,V=B.useRef(new Set),K=B.useRef(0),X=_==="horizontal"?Hze:Wze,[ie=[],J]=Qd({prop:I,defaultProp:E,onChange:Oe=>{[...V.current][K.current]?.focus(),M(Oe)}}),se=B.useRef(ie);function he(Oe){const Be=Yze(ie,Oe);je(Oe,Be)}function we(Oe){je(Oe,K.current)}function ze(){const Oe=se.current[K.current];ie[K.current]!==Oe&&j(ie)}function je(Oe,Be,{commit:qe}={commit:!1}){const Xe=tFe(f),it=rFe(Math.round((Oe-o)/f)*f+o,Xe),Ge=jS(it,[o,d]);J((Ke=[])=>{const ut=Kze(Ke,Ge,Be);if(eFe(ut,S*f)){K.current=ut.indexOf(Ge);const rt=String(ut)!==String(Ke);return rt&&qe&&j(ut),rt?ut:Ke}else return Ke})}return x.jsx(Gze,{scope:e.__scopeSlider,name:n,disabled:i,min:o,max:d,valueIndexToChangeRef:K,thumbs:V.current,values:ie,orientation:_,form:G,children:x.jsx(fM.Provider,{scope:e.__scopeSlider,children:x.jsx(fM.Slot,{scope:e.__scopeSlider,children:x.jsx(X,{"aria-disabled":i,"data-disabled":i?"":void 0,...z,ref:t,onPointerDown:Pr(z.onPointerDown,()=>{i||(se.current=ie)}),min:o,max:d,inverted:N,onSlideStart:i?void 0:he,onSlideMove:i?void 0:we,onSlideEnd:i?void 0:ze,onHomeKeyDown:()=>!i&&je(o,0,{commit:!0}),onEndKeyDown:()=>!i&&je(d,ie.length-1,{commit:!0}),onStepKeyDown:({event:Oe,direction:Be})=>{if(!i){const it=F9.includes(Oe.key)||Oe.shiftKey&&B9.includes(Oe.key)?10:1,Ge=K.current,Ke=ie[Ge],ut=f*it*Be;je(Ke+ut,Ge,{commit:!0})}}})})})})});U9.displayName=Ey;var[G9,H9]=V9(Ey,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Hze=B.forwardRef((e,t)=>{const{min:n,max:o,dir:d,inverted:f,onSlideStart:_,onSlideMove:i,onSlideEnd:S,onStepKeyDown:E,...I}=e,[M,j]=B.useState(null),N=di(t,X=>j(X)),G=B.useRef(void 0),z=s2(d),V=z==="ltr",K=V&&!f||!V&&f;function Q(X){const ie=G.current||M.getBoundingClientRect(),J=[0,ie.width],he=XR(J,K?[n,o]:[o,n]);return G.current=ie,he(X-ie.left)}return x.jsx(G9,{scope:e.__scopeSlider,startEdge:K?"left":"right",endEdge:K?"right":"left",direction:K?1:-1,size:"width",children:x.jsx(W9,{dir:z,"data-orientation":"horizontal",...I,ref:N,style:{...I.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:X=>{const ie=Q(X.clientX);_?.(ie)},onSlideMove:X=>{const ie=Q(X.clientX);i?.(ie)},onSlideEnd:()=>{G.current=void 0,S?.()},onStepKeyDown:X=>{const J=$9[K?"from-left":"from-right"].includes(X.key);E?.({event:X,direction:J?-1:1})}})})}),Wze=B.forwardRef((e,t)=>{const{min:n,max:o,inverted:d,onSlideStart:f,onSlideMove:_,onSlideEnd:i,onStepKeyDown:S,...E}=e,I=B.useRef(null),M=di(t,I),j=B.useRef(void 0),N=!d;function G(z){const V=j.current||I.current.getBoundingClientRect(),K=[0,V.height],X=XR(K,N?[o,n]:[n,o]);return j.current=V,X(z-V.top)}return x.jsx(G9,{scope:e.__scopeSlider,startEdge:N?"bottom":"top",endEdge:N?"top":"bottom",size:"height",direction:N?1:-1,children:x.jsx(W9,{"data-orientation":"vertical",...E,ref:M,style:{...E.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:z=>{const V=G(z.clientY);f?.(V)},onSlideMove:z=>{const V=G(z.clientY);_?.(V)},onSlideEnd:()=>{j.current=void 0,i?.()},onStepKeyDown:z=>{const K=$9[N?"from-bottom":"from-top"].includes(z.key);S?.({event:z,direction:K?-1:1})}})})}),W9=B.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:d,onSlideEnd:f,onHomeKeyDown:_,onEndKeyDown:i,onStepKeyDown:S,...E}=e,I=y2(Ey,n);return x.jsx(En.span,{...E,ref:t,onKeyDown:Pr(e.onKeyDown,M=>{M.key==="Home"?(_(M),M.preventDefault()):M.key==="End"?(i(M),M.preventDefault()):F9.concat(B9).includes(M.key)&&(S(M),M.preventDefault())}),onPointerDown:Pr(e.onPointerDown,M=>{const j=M.target;j.setPointerCapture(M.pointerId),M.preventDefault(),I.thumbs.has(j)?j.focus():o(M)}),onPointerMove:Pr(e.onPointerMove,M=>{M.target.hasPointerCapture(M.pointerId)&&d(M)}),onPointerUp:Pr(e.onPointerUp,M=>{const j=M.target;j.hasPointerCapture(M.pointerId)&&(j.releasePointerCapture(M.pointerId),f(M))})})}),q9="SliderTrack",Z9=B.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,d=y2(q9,n);return x.jsx(En.span,{"data-disabled":d.disabled?"":void 0,"data-orientation":d.orientation,...o,ref:t})});Z9.displayName=q9;var pM="SliderRange",K9=B.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,d=y2(pM,n),f=H9(pM,n),_=B.useRef(null),i=di(t,_),S=d.values.length,E=d.values.map(j=>J9(j,d.min,d.max)),I=S>1?Math.min(...E):0,M=100-Math.max(...E);return x.jsx(En.span,{"data-orientation":d.orientation,"data-disabled":d.disabled?"":void 0,...o,ref:i,style:{...e.style,[f.startEdge]:I+"%",[f.endEdge]:M+"%"}})});K9.displayName=pM;var mM="SliderThumb",X9=B.forwardRef((e,t)=>{const n=Vze(e.__scopeSlider),[o,d]=B.useState(null),f=di(t,i=>d(i)),_=B.useMemo(()=>o?n().findIndex(i=>i.ref.current===o):-1,[n,o]);return x.jsx(qze,{...e,ref:f,index:_})}),qze=B.forwardRef((e,t)=>{const{__scopeSlider:n,index:o,name:d,...f}=e,_=y2(mM,n),i=H9(mM,n),[S,E]=B.useState(null),I=di(t,Q=>E(Q)),M=S?_.form||!!S.closest("form"):!0,j=OM(S),N=_.values[o],G=N===void 0?0:J9(N,_.min,_.max),z=Xze(o,_.values.length),V=j?.[i.size],K=V?Jze(V,G,i.direction):0;return B.useEffect(()=>{if(S)return _.thumbs.add(S),()=>{_.thumbs.delete(S)}},[S,_.thumbs]),x.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${G}% + ${K}px)`},children:[x.jsx(fM.ItemSlot,{scope:e.__scopeSlider,children:x.jsx(En.span,{role:"slider","aria-label":e["aria-label"]||z,"aria-valuemin":_.min,"aria-valuenow":N,"aria-valuemax":_.max,"aria-orientation":_.orientation,"data-orientation":_.orientation,"data-disabled":_.disabled?"":void 0,tabIndex:_.disabled?void 0:0,...f,ref:I,style:N===void 0?{display:"none"}:e.style,onFocus:Pr(e.onFocus,()=>{_.valueIndexToChangeRef.current=o})})}),M&&x.jsx(Y9,{name:d??(_.name?_.name+(_.values.length>1?"[]":""):void 0),form:_.form,value:N},o)]})});X9.displayName=mM;var Zze="RadioBubbleInput",Y9=B.forwardRef(({__scopeSlider:e,value:t,...n},o)=>{const d=B.useRef(null),f=di(d,o),_=FR(t);return B.useEffect(()=>{const i=d.current;if(!i)return;const S=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(S,"value").set;if(_!==t&&I){const M=new Event("input",{bubbles:!0});I.call(i,t),i.dispatchEvent(M)}},[_,t]),x.jsx(En.input,{style:{display:"none"},...n,ref:f,defaultValue:t})});Y9.displayName=Zze;function Kze(e=[],t,n){const o=[...e];return o[n]=t,o.sort((d,f)=>d-f)}function J9(e,t,n){const f=100/(n-t)*(e-t);return jS(f,[0,100])}function Xze(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Yze(e,t){if(e.length===1)return 0;const n=e.map(d=>Math.abs(d-t)),o=Math.min(...n);return n.indexOf(o)}function Jze(e,t,n){const o=e/2,f=XR([0,50],[0,o]);return(o-f(t)*n)*n}function Qze(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function eFe(e,t){if(t>0){const n=Qze(e);return Math.min(...n)>=t}return!0}function XR(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(n-e[0])}}function tFe(e){return(String(e).split(".")[1]||"").length}function rFe(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var Q9=U9,nFe=Z9,iFe=K9,oFe=X9;const e7=B.forwardRef(({className:e,...t},n)=>x.jsxs(Q9,{ref:n,className:kr("relative flex w-full touch-none select-none items-center",e),...t,children:[x.jsx(nFe,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:x.jsx(iFe,{className:"absolute h-full bg-primary"})}),x.jsx(oFe,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));e7.displayName=Q9.displayName;const w4=[{value:"plot",label:"Plot",icon:Jc},{value:"house",label:"House",icon:Bc},{value:"land",label:"Land",icon:Jc},{value:"apartment",label:"Apartment",icon:QY},{value:"commercial",label:"Commercial",icon:iJ}],S4=[{value:"newest",label:"Newest First"},{value:"oldest",label:"Oldest First"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"}],T4=({type:e,setType:t,minPrice:n,setMinPrice:o,maxPrice:d,setMaxPrice:f,sortBy:_,setSortBy:i,priceRange:S,setPriceRange:E,clearFilters:I,getActiveFiltersCount:M,isMobile:j=!1})=>j?x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Property Type"}),x.jsxs(Fu,{value:e??"",onValueChange:N=>t(N==="all"?void 0:N),children:[x.jsx(Gc,{children:x.jsx(Bu,{placeholder:"All Types"})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"all",children:"All Types"}),w4.map(N=>x.jsx(Yi,{value:N.value,children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(N.icon,{size:16}),N.label]})},N.value))]})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Sort By"}),x.jsxs(Fu,{value:_,onValueChange:i,children:[x.jsx(Gc,{children:x.jsx(Bu,{})}),x.jsx(Hc,{children:S4.map(N=>x.jsx(Yi,{value:N.value,children:N.label},N.value))})]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Price Range"}),x.jsxs("div",{className:"space-y-4",children:[x.jsx(e7,{value:S,onValueChange:E,max:1e8,min:0,step:1e5,className:"w-full"}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx($n,{placeholder:"Min Price",type:"number",value:n,onChange:N=>o(N.target.value)}),x.jsx($n,{placeholder:"Max Price",type:"number",value:d,onChange:N=>f(N.target.value)})]})]})]}),M()>0&&x.jsx(Tr,{onClick:I,variant:"outline",className:"w-full",children:"Clear All Filters"})]}):x.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[x.jsxs(Fu,{value:e??"",onValueChange:N=>t(N==="all"?void 0:N),children:[x.jsx(Gc,{className:"w-40",children:x.jsx(Bu,{placeholder:"All Types"})}),x.jsxs(Hc,{children:[x.jsx(Yi,{value:"all",children:"All Types"}),w4.map(N=>x.jsx(Yi,{value:N.value,children:x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx(N.icon,{size:16}),N.label]})},N.value))]})]}),x.jsxs(Fu,{value:_,onValueChange:i,children:[x.jsx(Gc,{className:"w-44",children:x.jsx(Bu,{})}),x.jsx(Hc,{children:S4.map(N=>x.jsx(Yi,{value:N.value,children:N.label},N.value))})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx($n,{placeholder:"Min Price",type:"number",value:n,onChange:N=>o(N.target.value),className:"w-28"}),x.jsx("span",{className:"text-muted-foreground",children:"-"}),x.jsx($n,{placeholder:"Max Price",type:"number",value:d,onChange:N=>f(N.target.value),className:"w-28"})]}),M()>0&&x.jsxs(Tr,{variant:"ghost",onClick:I,className:"text-muted-foreground hover:text-foreground",children:[x.jsx(Tl,{className:"h-4 w-4 mr-2"}),"Clear (",M(),")"]})]}),sFe=({query:e,setQuery:t,type:n,setType:o,minPrice:d,setMinPrice:f,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:E,priceRange:I,setPriceRange:M,clearFilters:j,getActiveFiltersCount:N,filtersOpen:G,setFiltersOpen:z})=>x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[x.jsx(kf,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),x.jsx($n,{placeholder:"Search properties by title, location, or features...",value:e,onChange:V=>t(V.target.value),className:"pl-12 pr-4 py-3 text-lg"})]}),x.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[x.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:x.jsx(T4,{type:n,setType:o,minPrice:d,setMinPrice:f,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:E,priceRange:I,setPriceRange:M,clearFilters:j,getActiveFiltersCount:N,isMobile:!1})}),x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsxs(Nze,{open:G,onOpenChange:z,children:[x.jsx(zze,{asChild:!0,children:x.jsxs(Tr,{variant:"outline",className:"lg:hidden relative",children:[x.jsx(wJ,{className:"h-4 w-4 mr-2"}),"Filters",N()>0&&x.jsx(Ws,{className:"ml-2 h-5 w-5 p-0 flex items-center justify-center text-xs",children:N()})]})}),x.jsxs(L9,{side:"right",className:"w-80",children:[x.jsx(N9,{children:x.jsx(z9,{children:"Filters"})}),x.jsx("div",{className:"mt-6",children:x.jsx(T4,{type:n,setType:o,minPrice:d,setMinPrice:f,maxPrice:_,setMaxPrice:i,sortBy:S,setSortBy:E,priceRange:I,setPriceRange:M,clearFilters:j,getActiveFiltersCount:N,isMobile:!0})})]})]}),N()>0&&x.jsxs(Tr,{variant:"ghost",onClick:j,className:"text-muted-foreground hover:text-foreground",children:[x.jsx(Tl,{className:"h-4 w-4 mr-2"}),"Clear (",N(),")"]})]})]})]}),aFe=({properties:e,loading:t,errorMsg:n,fetchProperties:o,clearFilters:d})=>t?x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((f,_)=>x.jsxs("div",{className:"bg-card rounded-lg border border-border p-4 animate-pulse",children:[x.jsx("div",{className:"h-48 bg-muted rounded-lg mb-4"}),x.jsx("div",{className:"h-4 bg-muted rounded mb-2"}),x.jsx("div",{className:"h-4 bg-muted rounded w-3/4 mb-2"}),x.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]},_))}):n?x.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-xl p-6 text-center",children:[x.jsx("p",{className:"font-semibold mb-2",children:"Unable to load properties"}),x.jsx("p",{className:"text-sm mb-4",children:n}),x.jsx(Tr,{onClick:o,variant:"outline",children:"Try Again"})]}):e.length===0?x.jsxs("div",{className:"text-center py-16",children:[x.jsx("div",{className:"w-24 h-24 bg-muted rounded-full flex items-center justify-center mx-auto mb-6",children:x.jsx(c$,{className:"h-12 w-12 text-muted-foreground"})}),x.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"No properties found"}),x.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"We couldn't find any properties matching your criteria. Try adjusting your filters or search terms."}),x.jsx(Tr,{onClick:d,children:"Clear All Filters"})]}):x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"flex items-center justify-between mb-6",children:x.jsxs("p",{className:"text-muted-foreground",children:["Showing ",x.jsx("span",{className:"font-semibold text-foreground",children:e.length})," properties"]})}),x.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:e.map((f,_)=>x.jsx(G6,{property:Object.assign(f,{__delay:_*70})},f.id))})]}),lFe=()=>{const e=Kd(),[t,n]=B.useState(""),[o,d]=B.useState(void 0),[f,_]=B.useState(""),[i,S]=B.useState(""),[E,I]=B.useState("newest"),[M,j]=B.useState([]),[N,G]=B.useState([]),[z,V]=B.useState(!1),[K,Q]=B.useState(null),[X,ie]=B.useState(!1),[J,se]=B.useState([0,1e8]),he=async()=>{V(!0),Q(null);try{const{data:Oe,error:Be}=await Sr.from("properties").select("*").eq("status","available").order("created_at",{ascending:!1});if(Be)throw Be;const qe=Oe||[];G(qe),we(qe)}catch(Oe){console.error("Error fetching properties:",Oe);const Be=Oe instanceof Error?Oe.message:String(Oe);Q(Be||"Failed to load properties")}finally{V(!1)}},we=Oe=>{let Be=Oe;Be=Be.filter(qe=>{if(o&&qe.property_type!==o||f&&Number(qe.price)<Number(f)||i&&Number(qe.price)>Number(i))return!1;if(t){const Xe=t.toLowerCase(),it=qe.location?.toLowerCase().includes(Xe),Ge=qe.title?.toLowerCase().includes(Xe),Ke=qe.county?.toLowerCase().includes(Xe);if(!it&&!Ge&&!Ke)return!1}return!0}),Be.sort((qe,Xe)=>{switch(E){case"newest":return new Date(Xe.created_at).getTime()-new Date(qe.created_at).getTime();case"oldest":return new Date(qe.created_at).getTime()-new Date(Xe.created_at).getTime();case"price-low":return Number(qe.price)-Number(Xe.price);case"price-high":return Number(Xe.price)-Number(qe.price);default:return 0}}),j(Be)};B.useEffect(()=>{he();const Oe=Sr.channel("properties-page-realtime").on("postgres_changes",{event:"*",schema:"public",table:"properties"},Be=>{console.log("Real-time update:",Be),he()}).subscribe();return()=>{Sr.removeChannel(Oe)}},[]),B.useEffect(()=>{we(N)},[t,o,f,i,E]);const ze=()=>{n(""),d(void 0),_(""),S(""),I("newest"),se([0,1e8])},je=()=>{let Oe=0;return t&&Oe++,o&&Oe++,f&&Oe++,i&&Oe++,E!=="newest"&&Oe++,Oe};return x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"Properties  Julin Real Estate"}),x.jsx("meta",{name:"description",content:"Browse verified properties for sale and rent in Kenya."})]}),x.jsxs("div",{className:"min-h-screen bg-slate-50",children:[x.jsx(zf,{}),x.jsx("main",{className:"pt-24 pb-20",children:x.jsxs("div",{className:"container mx-auto px-4",children:[x.jsxs("div",{ref:e.ref,className:`mb-8 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"} text-center`,children:[x.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:"Properties"}),x.jsx("div",{className:"mx-auto max-w-2xl",children:x.jsx(Lze,{text:"Discover your perfect property from our curated collection",speed:28,className:"text-lg text-primary/80"})})]}),x.jsx(sFe,{query:t,setQuery:n,type:o,setType:d,sortBy:E,setSortBy:I,minPrice:f,setMinPrice:_,maxPrice:i,setMaxPrice:S,priceRange:J,setPriceRange:se,filtersOpen:X,setFiltersOpen:ie,clearFilters:ze,getActiveFiltersCount:je}),x.jsx(aFe,{properties:M,loading:z,errorMsg:K,fetchProperties:he,clearFilters:ze})]})}),x.jsx(Bf,{})]})]})};function K1({className:e,...t}){return x.jsx("div",{className:kr("animate-pulse rounded-md bg-muted",e),...t})}const cFe=()=>{const{id:e}=r6(),t=uy(),[n,o]=B.useState(null),[d,f]=B.useState(!0),[_,i]=B.useState(null),[S,E]=B.useState(!1),[I,M]=B.useState(""),[j,N]=B.useState(""),[G,z]=B.useState(""),[V,K]=B.useState(!1);B.useEffect(()=>{(async()=>{if(!e){i("Property not found"),f(!1);return}try{const{data:se,error:he}=await Sr.from("properties").select("*").eq("id",e).eq("status","available").single();if(he)throw he;if(!se)throw new Error("Property not found");if(se.id){const{data:we}=await Sr.storage.from("properties").list(),ze=new Map(we?.map(Oe=>[Oe.name.split(".")[0],Oe.name])||[]),je=ze.has(se.id)?Sr.storage.from("properties").getPublicUrl(ze.get(se.id)).data.publicUrl:"";o({...se,image:je})}}catch(se){console.error("Error fetching property:",se),i("Failed to load property details. Please try again.")}finally{f(!1)}})()},[e]);const Q=async()=>{if(!(!I||!j||!n)){K(!0);try{const{error:J}=await Sr.from("buyer_inquiries").insert({property_id:n.id,buyer_name:I,buyer_phone:j,message:G,inquiry_source:"property_detail_page"});if(J)throw J;const se=TC(n.seller_phone),he=`Hi! I'm interested in "${n.title}" listed at KES ${n.price.toLocaleString()}. ${G||"Please provide more details."}`,we=Rw(se,he);window.open(we,"_blank"),M(""),N(""),z(""),E(!1)}catch(J){console.error("Error recording inquiry:",J),alert("Failed to send inquiry. Please try again.")}finally{K(!1)}}};if(d)return x.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4",children:x.jsxs("div",{className:"max-w-4xl mx-auto",children:[x.jsx(K1,{className:"h-96 w-full mb-6"}),x.jsx(K1,{className:"h-8 w-2/3 mb-4"}),x.jsx(K1,{className:"h-4 w-1/2 mb-8"}),x.jsx(K1,{className:"h-32 w-full"})]})});if(_||!n)return x.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4 flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("p",{className:"text-xl text-slate-700 mb-4",children:_||"Property not found"}),x.jsx(Tr,{onClick:()=>t("/properties"),children:"Back to Properties"})]})});const X=n.description.substring(0,160)||`${n.title} in ${n.location} at KES ${n.price.toLocaleString()}. Contact ${n.seller_name} for details.`,ie={"@context":"https://schema.org","@type":"RealEstateProperty",name:n.title,description:n.description,image:n.image,price:n.price,priceCurrency:"KES",url:`/julin/#/properties/${n.id}`,address:{"@type":"PostalAddress",addressLocality:n.location,addressCountry:"KE"},seller:{"@type":"Person",name:n.seller_name,telephone:n.seller_phone},datePublished:new Date(n.created_at).toISOString(),dateModified:new Date(n.updated_at).toISOString()};return x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsxs("title",{children:[n.title," - KES ",n.price.toLocaleString()," | Julin Real Estate"]}),x.jsx("meta",{name:"description",content:X}),x.jsx("meta",{name:"keywords",content:`${n.property_type}, ${n.location}, Kenya, real estate, property for sale`}),x.jsx("meta",{property:"og:type",content:"website"}),x.jsx("meta",{property:"og:url",content:`/julin/#/properties/${n.id}`}),x.jsx("meta",{property:"og:title",content:n.title}),x.jsx("meta",{property:"og:description",content:X}),x.jsx("meta",{property:"og:image",content:n.image||""}),x.jsx("meta",{property:"og:site_name",content:"Julin Real Estate"}),x.jsx("meta",{property:"twitter:card",content:"summary_large_image"}),x.jsx("meta",{property:"twitter:url",content:`/julin/#/properties/${n.id}`}),x.jsx("meta",{property:"twitter:title",content:n.title}),x.jsx("meta",{property:"twitter:description",content:X}),x.jsx("meta",{property:"twitter:image",content:n.image||""}),x.jsx("link",{rel:"canonical",href:`/julin/#/properties/${n.id}`}),x.jsx("script",{type:"application/ld+json",children:JSON.stringify(ie)})]}),x.jsx("div",{className:"min-h-screen bg-slate-50 py-8 px-4",children:x.jsxs("div",{className:"max-w-4xl mx-auto",children:[x.jsx(Tr,{variant:"outline",onClick:()=>t("/properties"),className:"mb-6",children:" Back to Properties"}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[x.jsxs("div",{className:"lg:col-span-2",children:[x.jsx("div",{className:"bg-white rounded-lg overflow-hidden shadow-md mb-6",children:n.image?x.jsx("img",{src:n.image,alt:n.title,loading:"eager",width:800,height:600,className:"w-full h-auto object-cover"}):x.jsx("div",{className:"w-full h-96 bg-gradient-to-br from-slate-300 to-slate-400 flex items-center justify-center",children:x.jsx("span",{className:"text-slate-600",children:"Image not available"})})}),x.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[x.jsxs("div",{className:"mb-4",children:[x.jsx(Ws,{className:"bg-blue-600 hover:bg-blue-700 text-white mb-3",children:n.property_type.charAt(0).toUpperCase()+n.property_type.slice(1)}),x.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:n.title}),x.jsxs("div",{className:"flex items-center text-slate-600 mb-4",children:[x.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:x.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),n.location]})]}),x.jsxs("div",{className:"border-b border-slate-200 pb-4 mb-4",children:[x.jsx("p",{className:"text-slate-600 text-sm font-medium mb-1",children:"Price"}),x.jsxs("p",{className:"text-4xl font-bold text-green-600",children:["KES ",n.price.toLocaleString()]})]}),x.jsxs("div",{className:"mb-6",children:[x.jsx("h2",{className:"text-xl font-semibold text-slate-900 mb-3",children:"Description"}),x.jsx("p",{className:"text-slate-700 leading-relaxed whitespace-pre-wrap",children:n.description})]}),x.jsxs("div",{className:"bg-slate-50 rounded-md p-4",children:[x.jsx("p",{className:"text-sm text-slate-600 mb-2",children:"Listed by"}),x.jsx("p",{className:"text-lg font-semibold text-slate-900",children:n.seller_name}),x.jsxs("p",{className:"text-sm text-slate-600",children:["Phone: ",n.seller_phone]})]})]})]}),x.jsx("div",{className:"lg:col-span-1",children:x.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-4",children:[x.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Interested?"}),x.jsxs("p",{className:"text-slate-600 mb-6",children:["Connect with ",n.seller_name," via WhatsApp to discuss this property."]}),x.jsx(Tr,{onClick:()=>E(!0),size:"lg",className:"w-full bg-green-600 hover:bg-green-700 text-white mb-3",children:"Contact via WhatsApp"}),x.jsx(Tr,{variant:"outline",size:"lg",className:"w-full",onClick:()=>{const J=Rw(TC(n.seller_phone),`Hi! I'm interested in "${n.title}". Can you provide more information?`);window.open(J,"_blank")},children:"Direct WhatsApp"}),x.jsxs("div",{className:"mt-6 space-y-3 pt-6 border-t border-slate-200",children:[x.jsxs("div",{children:[x.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Property Type"}),x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.property_type.charAt(0).toUpperCase()+n.property_type.slice(1)})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Location"}),x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.location})]}),x.jsxs("div",{children:[x.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Listed"}),x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:new Date(n.created_at).toLocaleDateString()})]})]})]})})]})]})}),x.jsx(Zu,{open:S,onOpenChange:E,children:x.jsxs(tu,{className:"sm:max-w-md",children:[x.jsx(sh,{children:x.jsxs(Qu,{children:["Send Inquiry to ",n.seller_name]})}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"bg-slate-100 p-3 rounded-md",children:[x.jsx("p",{className:"text-sm font-semibold text-slate-900",children:n.title}),x.jsxs("p",{className:"text-sm text-slate-600",children:["KES ",n.price.toLocaleString(),"  ",n.location]})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Your Name"}),x.jsx($n,{type:"text",placeholder:"John Doe",value:I,onChange:J=>M(J.target.value),disabled:V})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Your Phone (WhatsApp)"}),x.jsx($n,{type:"tel",placeholder:"07XXXXXXXX",value:j,onChange:J=>N(J.target.value),disabled:V})]}),x.jsxs("div",{children:[x.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Message"}),x.jsx(bl,{placeholder:"Ask about the property...",value:G,onChange:J=>z(J.target.value),disabled:V,rows:3})]}),x.jsx(Tr,{onClick:Q,disabled:V||!I||!j,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:V?"Sending...":"Send via WhatsApp"})]})]})})]})},OP=9,uFe=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(!0),[d,f]=B.useState(null),[_,i]=B.useState(""),[S,E]=B.useState(null),[I,M]=B.useState(1),[j,N]=B.useState(!1),G=X=>X?new Date(X).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",z=async X=>{o(!0),f(null);try{const ie=X?.reset?0:(I-1)*OP,{data:J,error:se}=await Sr.from("blogs").select("id, slug, title, excerpt, featured_image, author_name, published_at, tags, view_count").eq("published",!0).order("published_at",{ascending:!1}).range(ie,ie+OP-1);if(se)throw se;const he=J||[];X?.reset?t(he):t(we=>[...we,...he]),N(he.length===OP)}catch(ie){console.warn("Failed to fetch blogs:",ie),f("Failed to load blog posts")}finally{o(!1)}};B.useEffect(()=>{M(1),t([]),z({reset:!0})},[]),B.useEffect(()=>{I!==1&&z()},[I]);const V=B.useMemo(()=>{const X=_.trim().toLowerCase();return e.filter(ie=>S&&!(ie.tags||[]).includes(S)?!1:X?ie.title.toLowerCase().includes(X)||(ie.excerpt||"").toLowerCase().includes(X)||(ie.tags||[]).join(" ").toLowerCase().includes(X):!0)},[e,_,S]),K=B.useMemo(()=>{const X=new Set;return e.forEach(ie=>(ie.tags||[]).forEach(J=>X.add(J))),Array.from(X).slice(0,40)},[e]),Q=X=>{if(!X)return"1 min";const ie=X.split(/\s+/).length;return`${Math.max(1,Math.round(ie/200))} min`};return x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"Blog - Julin Real Estate"}),x.jsx("meta",{name:"description",content:"Read our latest blog posts about real estate, property investment, and market insights in Kenya."})]}),x.jsx(zf,{}),x.jsxs("main",{className:"min-h-screen bg-background",children:[x.jsx("section",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground py-20",children:x.jsx("div",{className:"container mx-auto px-4",children:x.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[x.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Real Estate Insights"}),x.jsx("p",{className:"text-lg text-primary-foreground/90 mb-6",children:"Actionable guides, market updates and expert tips for property buyers and investors in Kenya."}),x.jsxs("div",{className:"mt-6 flex items-center gap-3 justify-center",children:[x.jsxs("div",{className:"relative w-full max-w-xl",children:[x.jsx("input",{"aria-label":"Search blogs",className:"w-full rounded-full py-3 pl-12 pr-4 shadow-sm border border-transparent focus:outline-none focus:ring-2 focus:ring-primary/60 text-foreground bg-background",placeholder:"Search by title, excerpt or tag...",value:_,onChange:X=>i(X.target.value)}),x.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:x.jsx(kf,{})})]}),x.jsx(Tr,{onClick:()=>{i(""),E(null)},children:"Reset"})]})]})})}),x.jsx("section",{className:"py-12",children:x.jsx("div",{className:"container mx-auto px-4",children:x.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[x.jsx("aside",{className:"w-full lg:w-72",children:x.jsxs(_o,{children:[x.jsx(vo,{children:x.jsx(xo,{children:"Filters"})}),x.jsxs(bo,{children:[x.jsxs("div",{className:"mb-4",children:[x.jsx("div",{className:"text-sm font-medium mb-2",children:"Tags"}),x.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.jsx("button",{className:`px-2 py-1 rounded text-sm ${S===null?"bg-primary text-primary-foreground":"bg-muted"}`,onClick:()=>E(null),children:"All"}),K.map(X=>x.jsx("button",{className:`px-2 py-1 rounded text-sm ${S===X?"bg-primary text-primary-foreground":"bg-muted"}`,onClick:()=>E(ie=>ie===X?null:X),children:X},X))]})]}),x.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",x.jsx("strong",{children:V.length})," posts"]})]})]})}),x.jsxs("div",{className:"flex-1",children:[d&&x.jsxs("div",{className:"text-center py-10 text-destructive",children:[x.jsx("p",{children:d}),x.jsx(Tr,{variant:"outline",className:"mt-4",onClick:()=>z({reset:!0}),children:"Retry"})]}),!d&&x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:V.length===0&&!n?x.jsxs("div",{className:"col-span-full text-center py-20 text-muted-foreground",children:[x.jsx(hw,{className:"mx-auto mb-4 opacity-50 w-14 h-14"}),x.jsx("h3",{className:"text-xl font-semibold",children:"No posts found"}),x.jsx("p",{className:"mt-2",children:"Try a different search or check back later."})]}):(n?Array.from({length:6}):V).map((X,ie)=>{if(n)return x.jsx("div",{className:"h-72 rounded-xl bg-muted animate-pulse"},ie);const J=X;return x.jsx(hc,{delay:ie*.04,children:x.jsxs(_o,{className:"group hover:shadow-2xl transition-shadow overflow-hidden h-full flex flex-col",children:[x.jsx("div",{className:"aspect-[16/9] overflow-hidden",children:x.jsx("img",{src:J.featured_image||"/placeholder.svg",alt:J.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),x.jsxs(vo,{className:"pb-2",children:[x.jsxs("div",{className:"flex items-center gap-2 flex-wrap text-xs text-muted-foreground mb-2",children:[x.jsxs("span",{className:"flex items-center gap-1",children:[x.jsx(jf,{className:"w-3 h-3"})," ",J.author_name||"Julin"]}),x.jsx("span",{children:""}),x.jsxs("span",{className:"flex items-center gap-1",children:[x.jsx(hw,{className:"w-3 h-3"})," ",G(J.published_at)]}),x.jsx("span",{children:""}),x.jsx("span",{children:Q(J.excerpt)}),x.jsx("span",{children:""}),x.jsxs("span",{className:"flex items-center gap-1",children:[x.jsx($c,{className:"w-3 h-3"})," ",J.view_count??0]})]}),x.jsx(xo,{className:"line-clamp-2 text-lg",children:x.jsx(ps,{to:`/blog/${J.slug}`,className:"hover:text-primary transition-colors",children:J.title})})]}),x.jsxs(bo,{className:"flex-1 flex flex-col",children:[x.jsx("p",{className:"text-muted-foreground mb-4 line-clamp-3 flex-1",children:J.excerpt}),x.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[x.jsx("div",{className:"flex flex-wrap gap-1",children:(J.tags||[]).slice(0,2).map(se=>x.jsx(Ws,{variant:"secondary",className:"text-xs",children:se},se))}),x.jsx(ps,{to:`/blog/${J.slug}`,children:x.jsx(Tr,{variant:"ghost",size:"sm",children:"Read more"})})]})]})]})},J.id)})}),j&&!n&&x.jsx("div",{className:"mt-8 flex justify-center",children:x.jsx(Tr,{onClick:()=>M(X=>X+1),variant:"outline",children:"Load more"})})]})]})})})]}),x.jsx(Bf,{})]})},dFe={"guide-to-buying-land-in-kenya":{id:"1",title:"Complete Guide to Buying Land in Kenya",excerpt:"Everything you need to know about purchasing land in Kenya, from legal requirements to due diligence steps.",content:`<h2>Introduction</h2>
<p>Buying land in Kenya is one of the most significant investments you can make. Whether you're looking to build your dream home, start a farming venture, or make a strategic investment, understanding the process is crucial.</p>

<h2>Step 1: Conduct a Land Search</h2>
<p>Before purchasing any land, conduct a thorough search at the Ministry of Lands. This will reveal:</p>
<ul>
<li>The registered owner of the land</li>
<li>Any existing encumbrances or charges</li>
<li>The size and boundaries of the property</li>
</ul>

<h2>Step 2: Verify the Title Deed</h2>
<p>Ensure the seller has a valid title deed. In Kenya, there are several types of titles:</p>
<ul>
<li><strong>Freehold:</strong> Absolute ownership with no time limit</li>
<li><strong>Leasehold:</strong> Ownership for a specified period (usually 99 years)</li>
<li><strong>Sectional Titles:</strong> For apartments and units in buildings</li>
</ul>

<h2>Step 3: Physical Verification</h2>
<p>Always visit the land physically to:</p>
<ul>
<li>Confirm the boundaries match the title deed</li>
<li>Check for any disputes or unauthorized occupation</li>
<li>Assess accessibility and infrastructure</li>
</ul>

<h2>Step 4: Engage a Lawyer</h2>
<p>A qualified lawyer will help with:</p>
<ul>
<li>Drafting the sale agreement</li>
<li>Conducting due diligence</li>
<li>Handling the transfer process</li>
</ul>

<h2>Step 5: Pay Stamp Duty and Register</h2>
<p>After completing the sale:</p>
<ul>
<li>Pay stamp duty (4% in urban areas, 2% in rural areas)</li>
<li>Register the transfer at the Lands Registry</li>
</ul>

<h2>Conclusion</h2>
<p>Buying land in Kenya requires careful planning and due diligence. Work with reputable agents like Julin Real Estate to ensure a smooth transaction.</p>`,featured_image:"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=1200",author_name:"Julin Real Estate",published_at:"2024-12-01",tags:["Land","Buying Guide","Kenya"],view_count:156,seo_title:"Complete Guide to Buying Land in Kenya | Julin Real Estate",seo_description:"Learn everything about buying land in Kenya - from legal requirements to due diligence steps. Expert guide from Julin Real Estate."},"top-investment-areas-nairobi-2024":{id:"2",title:"Top Investment Areas in Nairobi for 2024",excerpt:"Discover the most promising neighborhoods for real estate investment in Nairobi this year.",content:`<h2>Introduction</h2>
<p>Nairobi's real estate market continues to evolve, with certain areas showing exceptional growth potential. Here are the top investment areas for 2024.</p>

<h2>1. Ruaka</h2>
<p>Ruaka has transformed from a quiet suburb to a bustling residential area:</p>
<ul>
<li>Close proximity to major shopping centers</li>
<li>Excellent road infrastructure</li>
<li>Growing demand for rental properties</li>
</ul>

<h2>2. Kiambu Road Corridor</h2>
<p>The areas along Kiambu Road offer:</p>
<ul>
<li>Access to quality schools</li>
<li>Serene environment</li>
<li>Appreciating land values</li>
</ul>

<h2>3. Syokimau</h2>
<p>With the SGR terminus nearby:</p>
<ul>
<li>Industrial and commercial growth</li>
<li>Affordable land prices</li>
<li>Infrastructure development</li>
</ul>

<h2>4. Konza Technopolis</h2>
<p>The "Silicon Savannah" is attracting:</p>
<ul>
<li>Tech companies and startups</li>
<li>Long-term investment potential</li>
<li>Government-backed development</li>
</ul>

<h2>Investment Tips</h2>
<ul>
<li>Research thoroughly before investing</li>
<li>Consider infrastructure development plans</li>
<li>Work with reputable real estate agents</li>
</ul>

<h2>Conclusion</h2>
<p>These areas present excellent opportunities for investors looking to capitalize on Nairobi's growth trajectory.</p>`,featured_image:"https://images.unsplash.com/photo-1611348586804-61bf6c080437?w=1200",author_name:"Julin Real Estate",published_at:"2024-11-15",tags:["Investment","Nairobi","Market Analysis"],view_count:243,seo_title:"Top Investment Areas in Nairobi 2024 | Julin Real Estate",seo_description:"Discover the most promising neighborhoods for real estate investment in Nairobi. Expert market analysis from Julin Real Estate."},"understanding-land-titles-kenya":{id:"3",title:"Understanding Land Titles in Kenya",excerpt:"A comprehensive breakdown of different land title types and what they mean for property owners.",content:`<h2>Introduction</h2>
<p>Understanding land titles is essential for any property transaction in Kenya. This guide breaks down the different types of titles you'll encounter.</p>

<h2>Types of Land Tenure</h2>

<h3>1. Freehold</h3>
<ul>
<li>Absolute ownership of land</li>
<li>No time restrictions</li>
<li>Can be passed on through inheritance</li>
<li>Highest form of land ownership</li>
</ul>

<h3>2. Leasehold</h3>
<ul>
<li>Ownership for a specific period (usually 99 years)</li>
<li>Land reverts to government after lease expires</li>
<li>Can be renewed upon expiration</li>
<li>Common in urban areas</li>
</ul>

<h3>3. Community Land</h3>
<ul>
<li>Held collectively by a community</li>
<li>Registered under community name</li>
<li>Protected under Community Land Act 2016</li>
</ul>

<h2>Title Deed Components</h2>
<p>A valid title deed contains:</p>
<ul>
<li>Land reference number</li>
<li>Registered owner's details</li>
<li>Size of the property</li>
<li>Any encumbrances or charges</li>
</ul>

<h2>Common Issues to Watch</h2>
<ul>
<li>Forged title deeds</li>
<li>Double allocations</li>
<li>Disputed boundaries</li>
<li>Unpaid land rates</li>
</ul>

<h2>How to Verify a Title</h2>
<ol>
<li>Conduct official search at Lands Registry</li>
<li>Visit the physical location</li>
<li>Engage a qualified lawyer</li>
<li>Check for any caveats or charges</li>
</ol>

<h2>Conclusion</h2>
<p>Always verify the authenticity of any title deed before proceeding with a purchase. Julin Real Estate can assist with proper due diligence.</p>`,featured_image:"https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=1200",author_name:"Julin Real Estate",published_at:"2024-11-01",tags:["Legal","Land Titles","Documentation"],view_count:189,seo_title:"Understanding Land Titles in Kenya | Julin Real Estate",seo_description:"Complete guide to land title types in Kenya - freehold, leasehold, and community land. Learn what each means for property owners."},"benefits-of-owning-property-kenya":{id:"4",title:"Benefits of Owning Property in Kenya",excerpt:"Why investing in Kenyan real estate is a smart financial decision for your future.",content:`<h2>Introduction</h2>
<p>Owning property in Kenya offers numerous benefits beyond just having a place to call home. Here's why real estate investment makes sense.</p>

<h2>Financial Benefits</h2>

<h3>1. Appreciation</h3>
<ul>
<li>Land values consistently increase over time</li>
<li>Urban areas see particularly high appreciation</li>
<li>Protection against inflation</li>
</ul>

<h3>2. Rental Income</h3>
<ul>
<li>Generate passive income from tenants</li>
<li>Consistent cash flow</li>
<li>Helps pay off mortgages</li>
</ul>

<h3>3. Tax Benefits</h3>
<ul>
<li>Mortgage interest deductions</li>
<li>Depreciation benefits</li>
<li>Capital gains advantages</li>
</ul>

<h2>Personal Benefits</h2>

<h3>Security</h3>
<ul>
<li>Stable housing for your family</li>
<li>Asset to pass to future generations</li>
<li>Collateral for loans</li>
</ul>

<h3>Freedom</h3>
<ul>
<li>Customize your property</li>
<li>No landlord restrictions</li>
<li>Build equity over time</li>
</ul>

<h2>Why Kenya?</h2>
<ul>
<li>Growing economy</li>
<li>Increasing urbanization</li>
<li>Strong demand for housing</li>
<li>Government support for homeownership</li>
</ul>

<h2>Getting Started</h2>
<ol>
<li>Assess your budget</li>
<li>Choose the right location</li>
<li>Work with trusted agents</li>
<li>Conduct proper due diligence</li>
</ol>

<h2>Conclusion</h2>
<p>Property ownership in Kenya is a journey worth taking. Contact Julin Real Estate to start your investment journey today.</p>`,featured_image:"https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=1200",author_name:"Julin Real Estate",published_at:"2024-10-20",tags:["Investment","Benefits","Property"],view_count:98,seo_title:"Benefits of Owning Property in Kenya | Julin Real Estate",seo_description:"Discover why investing in Kenyan real estate is a smart financial decision. Learn about appreciation, rental income, and more."}},hFe=()=>{const{slug:e}=r6(),t=e?dFe[e]:null,[n,o]=B.useState(null);B.useEffect(()=>{let _=!0;if(t){if(typeof window>"u"){o(t.content);return}return SO(()=>import("./purify.es-C_uT9hQ1.js"),[]).then(i=>{if(!_)return;const S=i,E=S.default??S;o(E.sanitize(t.content))}).catch(()=>{o(t.content)}),()=>{_=!1}}},[t]);const d=_=>new Date(_).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),f=async()=>{if(navigator.share&&t)try{await navigator.share({title:t.title,text:t.excerpt,url:window.location.href})}catch(_){console.log("Error sharing:",_)}else navigator.clipboard.writeText(window.location.href)};return t?x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:t.seo_title}),x.jsx("meta",{name:"description",content:t.seo_description})]}),x.jsx(zf,{}),x.jsxs("main",{className:"min-h-screen bg-background",children:[x.jsx("section",{className:"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground py-16",children:x.jsx("div",{className:"container mx-auto px-4",children:x.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[x.jsxs(ps,{to:"/blog",className:"inline-flex items-center text-primary-foreground/80 hover:text-primary-foreground mb-6",children:[x.jsx(LP,{className:"mr-2",size:16}),"Back to Blogs"]}),x.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:t.title}),x.jsx("p",{className:"text-xl text-primary-foreground/80 max-w-2xl mx-auto",children:t.excerpt})]})})}),x.jsx("section",{className:"py-16",children:x.jsx("div",{className:"container mx-auto px-4",children:x.jsxs("article",{className:"max-w-4xl mx-auto",children:[x.jsx("div",{className:"aspect-video rounded-lg overflow-hidden mb-8",children:x.jsx("img",{src:t.featured_image,alt:t.title,className:"w-full h-full object-cover"})}),x.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-8 p-4 bg-muted rounded-lg border",children:[x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(jf,{size:14}),x.jsx("span",{children:t.author_name})]}),x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx(hw,{size:14}),x.jsx("span",{children:d(t.published_at)})]}),x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx($c,{size:14}),x.jsxs("span",{children:[t.view_count," views"]})]}),x.jsxs(Tr,{variant:"ghost",size:"sm",onClick:f,className:"ml-auto",children:[x.jsx(xJ,{size:14,className:"mr-1"}),"Share"]})]}),x.jsx("div",{className:"flex flex-wrap gap-2 mb-8",children:t.tags.map(_=>x.jsx(Ws,{variant:"secondary",children:_},_))}),x.jsx("div",{className:"prose prose-lg max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:n??t.content}}),x.jsxs("div",{className:"mt-12 p-6 bg-muted rounded-lg",children:[x.jsx("h3",{className:"text-xl font-bold mb-2",children:"Need Help with Your Property Search?"}),x.jsx("p",{className:"text-muted-foreground mb-4",children:"Julin Real Estate is here to help you find the perfect property. Contact us today for expert guidance."}),x.jsx(ps,{to:"/contact",children:x.jsx(Tr,{children:"Contact Us"})})]})]})})})]}),x.jsx(Bf,{})]}):x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"Blog Not Found - Julin Real Estate"}),x.jsx("meta",{name:"description",content:"The blog post you're looking for could not be found."})]}),x.jsx(zf,{}),x.jsx("main",{className:"min-h-screen bg-background",children:x.jsx("section",{className:"py-20",children:x.jsxs("div",{className:"container mx-auto px-4 max-w-4xl text-center",children:[x.jsx("div",{className:"mx-auto h-20 w-20 rounded-full bg-destructive/10 flex items-center justify-center mb-6",children:x.jsx(bM,{className:"h-10 w-10 text-destructive"})}),x.jsx("h1",{className:"text-3xl font-bold text-foreground mb-4",children:"Blog Post Not Found"}),x.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"The blog post you're looking for doesn't exist or has been removed."}),x.jsx(ps,{to:"/blog",children:x.jsxs(Tr,{children:[x.jsx(LP,{className:"mr-2",size:16}),"Back to Blogs"]})})]})})}),x.jsx(Bf,{})]})},fFe=()=>{const e=Kd(),t=Kd(),n=Kd(),o=[{title:"Verified property listings in Kenya",icon:bE,description:"Every property undergoes rigorous verification for authenticity and legal compliance."},{title:"Professional property photography",icon:xE,description:"High-quality visuals that showcase properties in their best light."},{title:"Transparent pricing with market rates",icon:VS,description:"Real-time market analysis ensures fair and competitive pricing."},{title:"Local market expertise",icon:Jc,description:"Deep understanding of Kenya's 47 counties and property markets."},{title:"Secure transaction support",icon:bE,description:"Bank-grade security for all your real estate transactions."},{title:"Legal documentation assistance",icon:Pf,description:"Expert guidance through Kenya's property registration process."},{title:"Property valuation services",icon:Bc,description:"Accurate valuation using latest market data and trends."}];return x.jsx("section",{id:"about",className:"py-20 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('https://images.unsplash.com/photo-1501183638710-841dd1904471?auto=format&fit=crop&w=1600&q=80')"},children:x.jsx("div",{className:"backdrop-blur-sm bg-white/70 py-10",children:x.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-20",children:[x.jsxs("div",{ref:e.ref,className:`text-center max-w-3xl mx-auto mb-16 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full\r
              bg-gradient-to-r from-primary/15 to-primary/5\r
             text-primary font-semibold text-sm uppercase tracking-wide\r
             border border-primary/20 shadow-sm mb-6`,children:[x.jsx(xE,{className:"h-4 w-4 text-primary"}),"Trusted Since 2022"]}),x.jsxs("h1",{className:"font-display text-4xl md:text-5xl lg:text-6xl font-bold text-foreground leading-[1.15] mb-6",children:["Your Trusted Partner in",x.jsx("span",{className:"block text-primary font-serif tracking-tight",children:"Kenyan Real Estate"})]}),x.jsx("p",{className:"text-lg md:text-xl text-muted-foreground leading-relaxed",children:"Transforming property transactions across Kenya with transparency, expertise, and commitment to excellence."})]}),x.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16 items-start",children:[x.jsxs("div",{ref:t.ref,className:`space-y-12 transition-all duration-700 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("div",{className:"w-3 h-12 bg-primary rounded-full"}),x.jsxs("div",{children:[x.jsx("h2",{className:"font-display text-2xl md:text-3xl font-bold text-foreground",children:"About Julin Real Estate"}),x.jsx("p",{className:"text-muted-foreground mt-2",children:"Pioneering excellence in Kenya since 2022"})]})]}),x.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"At Julin Real Estate, weve redefined property transactions in Kenya by combining local market expertise with modern technology."}),x.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"From Nairobis urban spaces to serene countryside locations, thousands trust us to guide them through Kenyas property market."})]}),x.jsxs("div",{className:"space-y-8",children:[x.jsxs("h3",{className:"font-display text-2xl font-bold text-foreground flex items-center gap-3",children:[x.jsx("div",{className:"w-8 h-1 bg-primary"})," Our Core Values"]}),x.jsx("div",{className:"grid gap-6",children:[{title:"Transparency & Honesty",desc:"Clear communication, no hidden costs  full trust from start to finish.",icon:$c,bg:"bg-primary/10",hover:"group-hover:bg-primary/20",border:"hover:border-primary/20"},{title:"Client-Centric Approach",desc:"Your goals shape our service. We provide tailored realestate guidance.",icon:TJ,bg:"bg-accent/10",hover:"group-hover:bg-accent/20",border:"hover:border-accent/20"},{title:"Integrity & Security",desc:"Ethical, legally sound transactions backed by secure processes.",icon:bE,bg:"bg-green-100",hover:"group-hover:bg-green-200",border:"hover:border-green-500/20"}].map((d,f)=>x.jsx("div",{style:{transitionDelay:`${f*80}ms`},className:`group p-6 bg-card rounded-2xl border border-gray-200 ${d.border} hover:shadow-lg transition-all duration-500 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:x.jsxs("div",{className:"flex gap-4 items-start",children:[x.jsx("div",{className:`w-14 h-14 ${d.bg} rounded-xl flex items-center justify-center ${d.hover} transition-colors`,children:x.jsx(d.icon,{className:"h-7 w-7 text-primary"})}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-display text-xl font-semibold mb-2",children:d.title}),x.jsx("p",{className:"text-muted-foreground",children:d.desc})]})]})},f))})]}),x.jsx("div",{className:"pt-6",children:x.jsx(ps,{to:"/contact",children:x.jsxs(Tr,{className:"h-14 px-8 rounded-xl bg-primary hover:bg-primary/90 shadow-lg hover:shadow-xl transition-all duration-300 group",children:["Start Your Property Journey",x.jsx(wM,{className:"h-5 w-5 ml-2 group-hover:translate-x-1 transition-transform"})]})})})]}),x.jsxs("div",{ref:n.ref,className:`space-y-10 transition-all duration-700 ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsxs("div",{className:"bg-card rounded-3xl p-8 shadow-xl border border-gray-100",children:[x.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[x.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center shadow-lg",children:x.jsx(xE,{className:"h-6 w-6 text-white"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"font-display text-2xl font-bold",children:"Why Choose Julin?"}),x.jsx("p",{className:"text-muted-foreground text-sm",children:"Experience real estate done right."})]})]}),x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:o.map((d,f)=>x.jsx("div",{style:{transitionDelay:`${f*65}ms`},className:`group p-5 bg-gradient-to-b from-white to-gray-50 rounded-xl border border-gray-100 hover:border-primary/30 hover:shadow-md transition-all duration-500 cursor-pointer ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-3"}`,children:x.jsxs("div",{className:"flex items-start gap-4",children:[x.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:x.jsx(d.icon,{className:"h-5 w-5 text-primary"})}),x.jsxs("div",{children:[x.jsx("h4",{className:"font-semibold group-hover:text-primary transition-colors",children:d.title}),x.jsx("p",{className:"text-sm text-muted-foreground",children:d.description})]})]})},f))})]}),x.jsxs("div",{className:"relative rounded-3xl overflow-hidden shadow-2xl group",children:[x.jsxs("div",{className:"aspect-video relative",children:[x.jsx("img",{src:"https://images.unsplash.com/photo-1502005097973-6a7082348e28?auto=format&fit=crop&w=1600&q=80",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-700",loading:"lazy",alt:"Luxury property Kenya"}),x.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"})]}),x.jsxs("div",{className:"absolute bottom-10 left-8",children:[x.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white/10 backdrop-blur-md rounded-full text-white text-sm mb-3",children:[x.jsx(Jc,{className:"h-4 w-4"})," Featured  Nairobi"]}),x.jsx("h3",{className:"text-white text-2xl font-bold mb-2",children:"Luxury Living in Kenya"}),x.jsx("p",{className:"text-white/90 max-w-sm",children:"Premium properties blending elegance with modern comfort."})]}),x.jsx("div",{className:"absolute bottom-6 left-0 w-full px-8",children:x.jsx(ps,{to:"/properties",children:x.jsx(Tr,{className:"w-full h-14 bg-white text-foreground rounded-xl hover:bg-white/95 shadow-xl",children:"Explore Premium Properties"})})})]})]})]})]})})})},pFe=()=>x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"About  Julin Real Estate"}),x.jsx("meta",{name:"description",content:"About Julin Real Estate  trusted property listings and verified sellers in Kenya."}),x.jsx("meta",{name:"robots",content:"index, follow"}),x.jsx("link",{rel:"canonical",href:"/julin/about"}),x.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),x.jsx("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),x.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Great+Vibes&display=swap",rel:"stylesheet"})]}),x.jsxs("div",{className:"flex flex-col min-h-screen font-sans text-gray-900 bg-gray-50",children:[x.jsx(zf,{}),x.jsx("main",{className:"flex-grow pt-28 px-4 sm:px-6 lg:px-20",children:x.jsx(fFe,{})}),x.jsx(Bf,{})]})]}),mFe=()=>{const e=Kd(),t=Kd(),n=Kd(),o=[{icon:Jf,label:"Phone",value:"+254725671504",href:"tel:+254725671504",description:"Call us anytime"},{icon:US,label:"Email",value:"juliusmurigi90@gmail.com",href:"mailto:juliusmurigi90@gmail.com",description:"Response within 24 hours"},{icon:Jc,label:"Office Location",value:"Nairobi, Kenya",href:"https://maps.google.com/?q=Nairobi+Kenya",description:"Visit our headquarters"},{icon:h$,label:"Working Hours",value:"Mon - Sat: 8AM - 6PM",href:"#",description:"Sunday: 10AM - 4PM"}];return x.jsx("section",{id:"contact",className:"py-12 md:py-20 lg:py-24 bg-gradient-to-b from-slate-50 via-white to-slate-50 scroll-mt-16",children:x.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:[x.jsxs("div",{ref:e.ref,className:`text-center max-w-3xl mx-auto mb-12 md:mb-20 transition-all duration-700 ${e.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsx("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary/10 rounded-full text-primary font-semibold text-sm uppercase tracking-wider mb-6",children:"Get in Touch"}),x.jsx("h2",{className:"font-display text-3xl md:text-4xl lg:text-5xl font-bold mb-4 text-foreground",children:"Contact Us Today"}),x.jsx("p",{className:"text-muted-foreground text-base md:text-lg leading-relaxed",children:"Have questions about properties or need real estate support? Reach out to our expert team. We're here to help with any inquiry."})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 lg:gap-10",children:[x.jsxs("div",{ref:t.ref,className:`lg:col-span-1 space-y-6 transition-all duration-700 ${t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[o.map((d,f)=>x.jsxs("a",{href:d.href,"aria-label":`${d.label}: ${d.value}`,target:d.href.startsWith("http")?"_blank":void 0,rel:d.href.startsWith("http")?"noopener noreferrer":void 0,style:{transitionDelay:`${f*80}ms`},className:kr("flex items-start gap-4 p-5 sm:p-6 bg-white rounded-2xl border border-slate-200","hover:border-primary/30 hover:shadow-lg hover:bg-slate-50 transition-all duration-500",t.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-3"),children:[x.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-primary/80 rounded-xl flex items-center justify-center flex-shrink-0",children:x.jsx(d.icon,{className:"h-6 w-6 text-white"})}),x.jsxs("div",{className:"flex-1",children:[x.jsx("p",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:d.label}),x.jsx("p",{className:"font-semibold text-slate-900 text-sm md:text-base mt-1",children:d.value}),d.description&&x.jsx("p",{className:"text-xs text-slate-600 mt-1",children:d.description})]})]},f)),x.jsxs("div",{className:"p-5 sm:p-6 bg-gradient-to-br from-primary/5 to-accent/5 rounded-2xl border border-primary/10 mt-8",children:[x.jsxs("h3",{className:"font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[x.jsx(VS,{className:"h-5 w-5 text-primary"}),"Why Choose Us"]}),x.jsxs("ul",{className:"space-y-3",children:[x.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[x.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),x.jsx("span",{children:"24/7 Real Estate Support"})]}),x.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[x.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),x.jsx("span",{children:"Property Valuation"})]}),x.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-600",children:[x.jsx("span",{className:"w-1.5 h-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),x.jsx("span",{children:"Verified Listings"})]})]})]})]}),x.jsx("div",{className:"lg:col-span-2",children:x.jsxs("div",{ref:n.ref,className:`bg-white rounded-3xl p-8 md:p-10 shadow-xl border border-slate-100 transition-all duration-700 ${n.inView?"opacity-100 translate-y-0":"opacity-0 translate-y-6"}`,children:[x.jsx("h3",{className:"font-display text-2xl md:text-3xl font-bold text-slate-900 mb-2",children:"Send Us a Message"}),x.jsx("p",{className:"text-slate-600 mb-8 text-sm md:text-base",children:"Fill in your details below. We'll save your inquiry and you'll be redirected to WhatsApp to continue the conversation."}),x.jsx(gFe,{})]})})]})]})})},gFe=()=>{const{toast:e}=D4(),[t,n]=B.useState({name:"",phone:"",email:"",message:"",inquiryType:"general"}),[o,d]=B.useState({}),[f,_]=B.useState(!1),[i,S]=B.useState(!1),E="+254725671504",I=()=>{const N={};return t.name.trim()?t.name.trim().length<2&&(N.name="Name must be at least 2 characters"):N.name="Name is required",t.phone.trim()?/^(\+254|0)[0-9]{9}$/.test(t.phone.replace(/\s+/g,""))||(N.phone="Invalid Kenyan phone number"):N.phone="Phone number is required",t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(N.email="Invalid email address"):N.email="Email is required",t.message.trim()?t.message.trim().length<10&&(N.message="Message must be at least 10 characters"):N.message="Message is required",d(N),Object.keys(N).length===0},M=(N,G)=>{n(z=>({...z,[N]:G})),o[N]&&d(z=>({...z,[N]:void 0}))},j=async N=>{if(N.preventDefault(),!I()){e({title:"Validation Error",description:"Please check all fields and try again.",variant:"destructive"});return}_(!0);try{const G=await fetch("https://fakkzdfwpucpgndofgcu.supabase.co/rest/v1/contact_submissions",{method:"POST",headers:{"Content-Type":"application/json",apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk"},body:JSON.stringify({name:t.name.trim(),phone:t.phone.trim(),email:t.email.trim(),message:t.message.trim(),subject:t.subject||"General Inquiry",inquiry_type:t.inquiryType||"general",status:"new"})});if(!G.ok){const K=await G.json();throw console.error("Supabase error:",K),new Error("Failed to save message")}e({title:"Success!",description:"Your message has been saved. Redirecting to WhatsApp...",variant:"default"}),S(!0);const z=`Hi! I'm reaching out about: ${t.message.substring(0,100)}${t.message.length>100?"...":""}%0A%0AYou can reach me at: ${t.phone}`,V=Rw(E,z);setTimeout(()=>{window.open(V,"_blank"),n({name:"",phone:"",email:"",message:"",inquiryType:"general"}),S(!1)},1e3)}catch(G){console.error("Form submission error:",G),e({title:"Error",description:"Failed to save your message. Please try again.",variant:"destructive"}),S(!1)}finally{_(!1)}};return x.jsxs("form",{onSubmit:j,className:"space-y-5 md:space-y-6",children:[x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{className:"text-sm font-semibold text-slate-700",children:["Full Name ",x.jsx("span",{className:"text-red-500",children:"*"})]}),x.jsx($n,{value:t.name,onChange:N=>M("name",N.target.value),placeholder:"John Doe",className:kr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",o.name&&"border-red-500 focus:border-red-500"),disabled:f}),o.name&&x.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[x.jsx(x1,{className:"h-3 w-3"})," ",o.name]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsx(go,{className:"text-sm font-semibold text-slate-700",children:"Inquiry Type"}),x.jsxs("select",{value:t.inquiryType,onChange:N=>M("inquiryType",N.target.value),className:kr("h-11 px-4 rounded-xl border border-slate-200 bg-white text-slate-900","focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all","text-sm font-medium disabled:bg-slate-50 disabled:text-slate-500"),disabled:f,children:[x.jsx("option",{value:"general",children:"General Inquiry"}),x.jsx("option",{value:"property_inquiry",children:"Property Inquiry"}),x.jsx("option",{value:"support",children:"Support"}),x.jsx("option",{value:"partnership",children:"Partnership"})]})]})]}),x.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{className:"text-sm font-semibold text-slate-700",children:["Phone Number ",x.jsx("span",{className:"text-red-500",children:"*"})]}),x.jsx($n,{value:t.phone,onChange:N=>M("phone",N.target.value),placeholder:"+254 712 345 678",className:kr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",o.phone&&"border-red-500 focus:border-red-500"),disabled:f}),o.phone&&x.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[x.jsx(x1,{className:"h-3 w-3"})," ",o.phone]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{className:"text-sm font-semibold text-slate-700",children:["Email Address ",x.jsx("span",{className:"text-red-500",children:"*"})]}),x.jsx($n,{type:"email",value:t.email,onChange:N=>M("email",N.target.value),placeholder:"you@example.com",className:kr("h-11 rounded-xl border-slate-200 focus:border-primary focus:ring-primary",o.email&&"border-red-500 focus:border-red-500"),disabled:f}),o.email&&x.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[x.jsx(x1,{className:"h-3 w-3"})," ",o.email]})]})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{className:"text-sm font-semibold text-slate-700",children:["Message ",x.jsx("span",{className:"text-red-500",children:"*"}),x.jsxs("span",{className:"text-xs text-slate-500 font-normal ml-2",children:["(",t.message.length,"/500)"]})]}),x.jsx(bl,{value:t.message,onChange:N=>{N.target.value.length<=500&&M("message",N.target.value)},placeholder:"Tell us what you need assistance with...",className:kr("rounded-xl border-slate-200 focus:border-primary focus:ring-primary min-h-28 resize-none",o.message&&"border-red-500 focus:border-red-500"),maxLength:500,disabled:f}),o.message&&x.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1",children:[x.jsx(x1,{className:"h-3 w-3"})," ",o.message]}),x.jsx("p",{className:"text-xs text-slate-500",children:"Keep your message brief. You'll continue on WhatsApp after submission."})]}),x.jsx(Tr,{type:"submit",disabled:f||i,className:kr("w-full h-12 text-base font-semibold rounded-xl transition-all duration-300","flex items-center justify-center gap-2",i&&"bg-green-600 hover:bg-green-600"),children:f?x.jsxs(x.Fragment,{children:[x.jsx(uJ,{className:"h-5 w-5 animate-spin"}),x.jsx("span",{children:"Saving and redirecting..."})]}):i?x.jsxs(x.Fragment,{children:[x.jsx(VS,{className:"h-5 w-5"}),x.jsx("span",{children:"Redirecting to WhatsApp..."})]}):x.jsxs(x.Fragment,{children:[x.jsx(xf,{className:"h-5 w-5"}),x.jsx("span",{children:"Send and WhatsApp"})]})}),x.jsx("p",{className:"text-xs text-slate-600 text-center",children:"Your message will be saved in our system and you'll continue the conversation on WhatsApp."})]})},yFe=()=>x.jsxs(x.Fragment,{children:[x.jsxs(nh,{children:[x.jsx("title",{children:"Contact  Julin Real Estate"}),x.jsx("meta",{name:"description",content:"Contact Julin Real Estate for inquiries, listings, and support."})]}),x.jsxs("div",{className:"min-h-screen",children:[x.jsx(zf,{}),x.jsx("main",{children:x.jsx(mFe,{})}),x.jsx(Bf,{})]})]}),t7=({userRole:e,userInfo:t})=>{const n=t?.name||"",o=e==="admin";return x.jsx("div",{className:"mb-4 pb-4 border-b border-border",children:x.jsxs("div",{className:"flex items-center gap-3",children:[x.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center shadow-lg",children:x.jsx(r0,{className:"h-6 w-6 text-primary-foreground"})}),x.jsxs("div",{className:"flex-1",children:[x.jsxs("h1",{className:"text-xl font-bold text-foreground flex items-center gap-2",children:["Mary  AI Property Assistant",o&&x.jsxs("span",{className:"inline-flex items-center gap-1 text-xs font-medium bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full",children:[x.jsx(dg,{className:"h-3 w-3"})," Admin"]})]}),x.jsx("p",{className:"text-sm text-muted-foreground",children:o?`Welcome back${n?`, ${n}`:""}! You have access to enhanced admin features.`:n?`Hi ${n}! How can I help you find your perfect property today?`:"How can I help you find your perfect property today?"})]})]})})},r7=({messages:e,messagesEndRef:t})=>x.jsx("div",{className:"bg-muted/30 rounded-xl border border-border shadow-sm mb-4 flex-1 overflow-y-auto",children:x.jsxs("div",{className:"p-4 space-y-4",children:[e.length===0&&x.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[x.jsx(r0,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),x.jsx("p",{className:"text-sm",children:"Start a conversation by typing a message below."}),x.jsx("p",{className:"text-xs mt-2",children:"Ask about properties, locations, prices, or get help with your search!"})]}),e.map((n,o)=>x.jsxs("div",{className:`flex gap-3 ${n.role==="user"?"justify-end":"justify-start"}`,children:[n.role!=="user"&&x.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:x.jsx(r0,{className:"h-4 w-4 text-primary"})}),x.jsx("div",{className:`max-w-[80%] p-3 rounded-2xl ${n.role==="user"?"bg-primary text-primary-foreground rounded-br-md":"bg-background border border-border text-foreground rounded-bl-md shadow-sm"}`,children:x.jsx("div",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:n.content})}),n.role==="user"&&x.jsx("div",{className:"h-8 w-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:x.jsx(jf,{className:"h-4 w-4 text-primary-foreground"})})]},o)),x.jsx("div",{ref:t})]})}),n7=({input:e,setInput:t,sendMessage:n,loading:o})=>{const d=f=>{f.preventDefault(),!o&&e.trim()&&n()};return x.jsxs("form",{onSubmit:d,className:"flex gap-2",children:[x.jsx("div",{className:"flex-1 relative",children:x.jsx("input",{value:e,onChange:f=>t(f.target.value),placeholder:"Ask about properties, locations, prices...",disabled:o,className:"w-full rounded-xl border border-border bg-background px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all disabled:opacity-50","aria-label":"Type your message"})}),x.jsx(Tr,{type:"submit",disabled:o||!e.trim(),size:"icon",className:"h-12 w-12 rounded-xl","aria-label":"Send message",children:o?x.jsx(cJ,{className:"h-5 w-5 animate-spin"}):x.jsx(vJ,{className:"h-5 w-5"})})]})},i7=({onSubmit:e,onCancel:t})=>{const[n,o]=B.useState({name:"",phone:""}),[d,f]=B.useState({}),_=(E,I)=>{o(M=>({...M,[E]:I})),f(M=>({...M,[E]:void 0}))},i=()=>{const E={},I=n.phone.replace(/\s/g,"");return n.name.trim()||(E.name="Full name is required"),I?/^(\+254|0)[17]\d{8}$/.test(I)||(E.phone="Enter a valid Kenyan phone number"):E.phone="Phone number is required",f(E),Object.keys(E).length===0},S=E=>{if(E.preventDefault(),console.log("[PreChatForm] submit",{name:n.name,phone:n.phone}),!i()){console.log("[PreChatForm] validation failed",{errors:d});return}console.log("[PreChatForm] calling onSubmit with",{name:n.name.trim(),phone:n.phone.trim()}),e({name:n.name.trim(),phone:n.phone.trim()})};return x.jsx("div",{className:"flex h-full items-center justify-center p-4",children:x.jsxs(_o,{className:"w-full max-w-md",children:[x.jsxs(vo,{className:"text-center",children:[x.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:x.jsx(r0,{className:"h-6 w-6 text-primary"})}),x.jsx(xo,{className:"text-xl",children:"Mary  Virtual Assistant"}),x.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Share your contact details so I can assist you better and follow up on your property inquiries."})]}),x.jsxs(bo,{children:[x.jsxs("form",{onSubmit:S,className:"space-y-4",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{htmlFor:"name",className:"flex items-center gap-2",children:[x.jsx(jf,{className:"h-4 w-4"}),"Full Name"]}),x.jsx($n,{id:"name",value:n.name,placeholder:"Enter your full name",onChange:E=>_("name",E.target.value),"aria-invalid":!!d.name,"aria-describedby":d.name?"name-error":void 0,className:d.name?"border-destructive":""}),d.name&&x.jsx("p",{id:"name-error",className:"text-sm text-destructive",children:d.name})]}),x.jsxs("div",{className:"space-y-2",children:[x.jsxs(go,{htmlFor:"phone",className:"flex items-center gap-2",children:[x.jsx(Jf,{className:"h-4 w-4"}),"Phone Number"]}),x.jsx($n,{id:"phone",type:"tel",value:n.phone,placeholder:"+254 712 345 678 or 0712 345 678",onChange:E=>_("phone",E.target.value),"aria-invalid":!!d.phone,"aria-describedby":d.phone?"phone-error":void 0,className:d.phone?"border-destructive":""}),d.phone&&x.jsx("p",{id:"phone-error",className:"text-sm text-destructive",children:d.phone})]}),x.jsxs("div",{className:"flex gap-3 pt-4",children:[x.jsx(Tr,{type:"button",variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),x.jsx(Tr,{type:"submit",className:"flex-1",children:"Start Chat"})]})]}),x.jsx("p",{className:"mt-4 text-center text-xs text-muted-foreground",children:"Your information is used strictly for follow-up and handled confidentially."})]})]})})},_Fe="https://fakkzdfwpucpgndofgcu.supabase.co",A4="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",Qg="".replace(/\/$/,"");async function vFe(e){const t={...e},n=()=>{const d=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID().slice(0,10):Math.random().toString(36).slice(2,12);return`conv_${Date.now()}_${d}`};return t.id||(t.id=n()),t.conversation_id||(t.conversation_id=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`cid_${Date.now()}_${Math.random().toString(36).slice(2,8)}`),pw(Qg?async()=>{const f=await fetch(`${Qg}/api/chat/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!f.ok)throw new Error(`proxy upsert failed: ${f.status}`);return f.json().catch(()=>null)}:async()=>{const{data:d,error:f}=await Sr.from("chat_conversations").upsert([t],{onConflict:"conversation_id"}).select();if(f)throw f;return d},3,200)}async function o7(e){return pw(Qg?async()=>{const o=await fetch(`${Qg}/api/chat/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok)throw new Error(`proxy insert failed: ${o.status}`);return o.json().catch(()=>null)}:async()=>{const{data:n,error:o}=await Sr.from("chat_messages").insert(e);if(o)throw o;return n},3,200)}async function s7(e,t){if(Qg){const d=await fetch(`${Qg}/api/chat/conversations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,...t})});if(!d.ok)throw new Error(`proxy patch failed: ${d.status}`);return d.json().catch(()=>null)}const{data:n,error:o}=await Sr.from("chat_conversations").update(t).eq("conversation_id",e).select();if(o)throw o;return n}async function a7(e,t=15e3){const n=`${_Fe}/functions/v1/chat`;console.debug("[chatService] fetchReply called",{url:n,payload:e});const o=new AbortController,d=setTimeout(()=>o.abort(),t);try{const f=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",apikey:A4,Authorization:`Bearer ${A4}`},body:JSON.stringify(e),signal:o.signal});if(clearTimeout(d),!f.ok){const i=await f.text().catch(()=>"");throw console.error("[chatService] edge function responded with error",{status:f.status,body:i}),new Error(`edge function error ${f.status}: ${i}`)}const _=await f.json().catch(()=>null);return console.debug("[chatService] fetchReply response",_),_}finally{clearTimeout(d)}}const xFe=()=>{lx();const[e,t]=B.useState([]),[n,o]=B.useState(""),[d,f]=B.useState(!1),[_,i]=B.useState("chat"),[S]=B.useState(()=>`conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),E=B.useRef(""),I=B.useRef(null);B.useEffect(()=>{let N=zP("chat_session_id");N||(N=`s_${Date.now()}`,lQ("chat_session_id",N)),E.current=N,zP(`chat:${N}`)||t([{role:"assistant",content:"Hello Admin! I'm your AI property assistant with enhanced capabilities."}])},[]),B.useEffect(()=>I.current?.scrollIntoView({behavior:"smooth"}),[e]);const M=async(N,G)=>{await o7({conversation_id:S,session_id:E.current,role:N,content:G}),await s7(S,{last_message:G.substring(0,100)})},j=async()=>{const N=n.trim();if(!N)return;o("");const G={role:"user",content:N};t(z=>[...z,G]),f(!0),await M("user",N);try{const z={message:N,session_id:E.current,conversation_id:S,user_role:"admin"},V=await a7(z);V?.reply&&(await M("assistant",V.reply),t(K=>[...K,{role:"assistant",content:V.reply}]))}catch{t(V=>[...V,{role:"assistant",content:"Failed to get reply."}])}finally{f(!1)}};return _==="form"?x.jsx(i7,{onSubmit:()=>i("chat"),onCancel:()=>{}}):x.jsx("div",{className:"h-full flex flex-col",children:x.jsxs("div",{className:"flex-1 p-4 overflow-hidden",children:[x.jsx(t7,{userRole:"admin",userInfo:null}),x.jsx(r7,{messages:e,messagesEndRef:I}),x.jsx(n7,{input:n,setInput:o,sendMessage:j,loading:d})]})})},bFe=()=>{const[e,t]=B.useState([]),[n,o]=B.useState(""),[d,f]=B.useState(!1),[_,i]=B.useState("form"),[S,E]=B.useState(null),[I]=B.useState(()=>`conv_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),M=B.useRef(""),j=B.useRef(null);B.useEffect(()=>{let V=zP("chat_session_id");V||(V=`s_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),M.current=V},[]),B.useEffect(()=>j.current?.scrollIntoView({behavior:"smooth"}),[e]);const N=async(V,K)=>{const Q="https://fakkzdfwpucpgndofgcu.supabase.co",X="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZha2t6ZGZ3cHVjcGduZG9mZ2N1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzODkzMjcsImV4cCI6MjA4MDk2NTMyN30.C_V3yvLOJ30JdY28luXjuX0gLJ_ML0QXxQh181Zvunk",ie="".replace(/\/$/,"");if(!ie&&!X){const J="Chat not configured: missing Supabase URL or publishable key in site build.";throw console.error("[CustomerChat] createConversation aborted",{SUPABASE_URL:Q,SUPABASE_PUBLISHABLE_KEY:X,SERVER_API:ie}),new Error(J)}await vFe({conversation_id:I,user_display_name:V,user_phone:K,started_at:new Date().toISOString(),summary:JSON.stringify({phone:K})})},G=async(V,K)=>{await o7({conversation_id:I,session_id:M.current,role:V,content:K}),await s7(I,{last_message:K.substring(0,100)})},z=async()=>{const V=n.trim();if(!V)return;o("");const K={role:"user",content:V};t(Q=>[...Q,K]),f(!0),await G("user",V);try{const Q={message:V,session_id:M.current,conversation_id:I,user_role:"user",user_info:S?{name:S.name,phone:S.phone}:void 0},X=await a7(Q);X?.reply&&(await G("assistant",X.reply),t(ie=>[...ie,{role:"assistant",content:X.reply}]))}catch(Q){console.error("[CustomerChat] sendMessage error",Q),t(X=>[...X,{role:"assistant",content:"Unable to reach chat service. Please try again."}])}finally{f(!1)}};return _==="form"?x.jsx(i7,{onSubmit:async V=>{try{await N(V.name,V.phone),E(V),i("chat"),t([{role:"assistant",content:`Hello ${V.name}!  Welcome to Julin Real Estate. I'm Mary, your virtual property assistant. How can I help you find your perfect property today?`}])}catch(K){console.error("[CustomerChat] createConversation failed",K),alert("Failed to start chat. Please check your connection and try again.")}},onCancel:()=>{window.history.back()}}):x.jsx("div",{className:"h-full flex flex-col",children:x.jsxs("div",{className:"flex-1 p-4 overflow-hidden flex flex-col",children:[x.jsx(t7,{userRole:"user",userInfo:S}),x.jsx(r7,{messages:e,messagesEndRef:j}),x.jsx(n7,{input:n,setInput:o,sendMessage:z,loading:d})]})})},wFe=()=>{const{isAdmin:e}=lx();return e?x.jsx(xFe,{}):x.jsx(bFe,{})},l7=()=>x.jsx(wFe,{}),SFe=Object.freeze(Object.defineProperty({__proto__:null,default:l7},Symbol.toStringTag,{value:"Module"})),TFe=B.lazy(()=>SO(()=>Promise.resolve().then(()=>SFe),void 0)),E4="chat_session_id",P4="chat_unread",C4="chat_sound_enabled",I4="chat_first_visit_done",Bd={get(e){try{if(typeof window>"u")return null;if(typeof window.sessionStorage<"u"){const t=sessionStorage.getItem(e);if(t!==null)return t}return typeof window.localStorage<"u"?localStorage.getItem(e):null}catch{return null}},set(e,t){try{if(typeof window>"u")return;try{if(typeof window.sessionStorage<"u"){sessionStorage.setItem(e,t);return}}catch{}typeof window.localStorage<"u"&&localStorage.setItem(e,t)}catch{}}},AFe=()=>{const[e,t]=B.useState(!1),[n,o]=B.useState(!1),[d,f]=B.useState(()=>Bd.get(C4)!=="0"),[_,i]=B.useState(!1),S=B.useRef(null);B.useRef(null);const{isAdmin:E}=lx();B.useEffect(()=>{let N=null;if(E&&(N=Bd.get(E4)),N||(N=`s_${Date.now()}`,E&&Bd.set(E4,N)),!Bd.get(I4)){const G=setTimeout(()=>{i(!0),setTimeout(()=>i(!1),5e3)},3e3);return Bd.set(I4,"1"),()=>clearTimeout(G)}o(Bd.get(P4)==="1")},[E]);const I=B.useCallback(()=>{if(d)try{S.current||(S.current=new AudioContext);const N=S.current,G=N.createOscillator(),z=N.createGain();G.frequency.value=680,z.gain.value=.03,G.connect(z),z.connect(N.destination),G.start(),setTimeout(()=>G.stop(),120)}catch{}},[d]),M=()=>{f(N=>(Bd.set(C4,N?"0":"1"),!N))},j=B.useCallback(()=>{o(!1),Bd.set(P4,"0")},[]);return B.useEffect(()=>{e&&(j(),i(!1))},[e,j]),B.useEffect(()=>{},[e,I,j]),x.jsxs(x.Fragment,{children:[x.jsx(bg,{children:x.jsx("div",{"aria-live":"polite",children:n?"New message received":""})}),x.jsx("div",{className:"fixed bottom-24 right-6 z-50",children:x.jsx(Tr,{size:"icon",variant:"ghost",onClick:M,"aria-label":d?"Disable chat sound":"Enable chat sound",className:"h-9 w-9 rounded-full bg-background shadow-md border border-border",children:d?x.jsx(PJ,{className:"h-4 w-4 text-muted-foreground"}):x.jsx(CJ,{className:"h-4 w-4 text-muted-foreground"})})}),x.jsxs(Zu,{open:e,onOpenChange:t,children:[x.jsx(V6,{asChild:!0,children:x.jsxs("div",{className:"fixed bottom-6 right-6 z-50",children:[x.jsx(Lf,{children:_&&!e&&x.jsx(mn.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full right-0 mb-3 w-64",children:x.jsxs("div",{className:"bg-foreground text-background p-3 rounded-xl shadow-xl text-sm relative",children:[x.jsx("button",{onClick:N=>{N.stopPropagation(),i(!1)},className:"absolute top-1 right-1 p-1 hover:bg-background/20 rounded",children:x.jsx(Tl,{className:"h-3 w-3"})}),x.jsx("p",{className:"font-medium mb-1",children:" Need help finding property?"}),x.jsx("p",{className:"text-xs opacity-80",children:"Chat with Mary, our AI assistant!"}),x.jsx("div",{className:"absolute bottom-0 right-6 translate-y-1/2 rotate-45 w-3 h-3 bg-foreground"})]})})}),x.jsx(Tr,{size:"icon","aria-label":"Chat with our AI property assistant",className:"group h-14 w-14 rounded-full bg-primary shadow-xl hover:bg-primary/90 hover:scale-105 transition-all duration-200",children:x.jsxs("div",{className:"relative",children:[x.jsx(xf,{className:"h-6 w-6 text-primary-foreground"}),x.jsx(Lf,{children:n&&x.jsxs(mn.span,{initial:{scale:0},animate:{scale:1},exit:{scale:0},className:"absolute -top-1 -right-1",children:[x.jsx("span",{className:"absolute inset-0 h-4 w-4 rounded-full bg-destructive opacity-60 animate-ping"}),x.jsx("span",{className:"absolute inset-0 h-4 w-4 rounded-full bg-destructive"})]})})]})})]})}),x.jsxs(tu,{className:"h-[85vh] max-h-[700px] w-[95vw] max-w-2xl p-0 gap-0",children:[x.jsxs(bg,{children:[x.jsx(Qu,{children:"Chat with Mary - AI Property Assistant"}),x.jsx(IO,{children:"Chat with our AI assistant about properties, pricing, and real estate in Kenya."})]}),x.jsx("div",{className:"h-full overflow-hidden rounded-lg",children:x.jsx(B.Suspense,{fallback:x.jsx("div",{className:"h-full flex items-center justify-center",children:x.jsxs("div",{className:"text-center",children:[x.jsx("div",{className:"h-8 w-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-2"}),x.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading chat..."})]})}),children:x.jsx(TFe,{})})})]})]})]})},EFe=()=>{const{user:e,isAdmin:t}=lx(),n=uy(),o=mc(),d=B.useRef(null);return B.useEffect(()=>{!d.current&&e&&t&&!o.pathname.startsWith("/admin")&&n("/admin",{replace:!0}),d.current=e},[e,t,n,o.pathname]),null},PFe=new uae,CFe=()=>x.jsx(h6,{children:x.jsx(hae,{client:PFe,children:x.jsxs(Cte,{children:[x.jsx(Mte,{}),x.jsx(hQ,{}),x.jsx(GQ,{}),x.jsxs(fle,{children:[x.jsx(Tue,{}),x.jsx(EFe,{}),x.jsxs(ole,{children:[x.jsx(es,{path:"/",element:x.jsx(vue,{})}),x.jsx(es,{path:"/properties",element:x.jsx(lFe,{})}),x.jsx(es,{path:"/property/:id",element:x.jsx(cFe,{})}),x.jsx(es,{path:"/blogs",element:x.jsx(uFe,{})}),x.jsx(es,{path:"/blog/:slug",element:x.jsx(hFe,{})}),x.jsx(es,{path:"/about",element:x.jsx(pFe,{})}),x.jsx(es,{path:"/contact",element:x.jsx(yFe,{})}),x.jsx(es,{path:"/chat",element:x.jsx(l7,{})}),x.jsx(es,{path:"/admin/login",element:x.jsx(ude,{})}),x.jsxs(es,{path:"/admin",element:x.jsx(cde,{}),children:[x.jsx(es,{index:!0,element:x.jsx(QLe,{})}),x.jsx(es,{path:"properties",element:x.jsx(hze,{})}),x.jsx(es,{path:"blogs",element:x.jsx(Sze,{})}),x.jsx(es,{path:"analytics",element:x.jsx(Dze,{})}),x.jsx(es,{path:"submissions",element:x.jsx(Tze,{})}),x.jsx(es,{path:"inquiries",element:x.jsx(Aze,{})}),x.jsx(es,{path:"chats",element:x.jsx(Pze,{})}),x.jsx(es,{path:"profile",element:x.jsx(Oze,{})})]}),x.jsx(es,{path:"*",element:x.jsx(Sue,{})})]}),x.jsx(AFe,{})]}),x.jsx(Bse,{})]})})}),IFe=({children:e})=>{const[t,n]=B.useState(null),[o,d]=B.useState(null),[f,_]=B.useState(!1),[i,S]=B.useState(!0),E=async j=>{try{const{data:N}=await Sr.from("user_roles").select("role").eq("user_id",j).eq("role","admin").maybeSingle();_(!!N)}catch(N){console.error("Failed to check user role",N),_(!1)}};B.useEffect(()=>{let j=!0;const{data:{subscription:N}}=Sr.auth.onAuthStateChange((G,z)=>{j&&(d(z),n(z?.user??null),z?.user?setTimeout(()=>{j&&E(z.user.id)},0):_(!1),S(!1))});return Sr.auth.getSession().then(({data:{session:G}})=>{j&&(d(G),n(G?.user??null),G?.user&&E(G.user.id),S(!1))}),()=>{j=!1,N.unsubscribe()}},[]);const I=async(j,N)=>{if(N){const{error:G}=await Sr.auth.signInWithPassword({email:j,password:N});if(G)throw G}else{const{error:G}=await Sr.auth.signInWithOtp({email:j});if(G)throw G}},M=async()=>{await Sr.auth.signOut(),n(null),d(null),_(!1)};return x.jsx(q6.Provider,{value:{user:t,isAdmin:f,loading:i,signInWithEmail:I,signOut:M},children:e})};j4(document.getElementById("root")).render(x.jsx(IFe,{children:x.jsx(CFe,{})}));function MFe(){const e=async()=>{try{await Sr.from("page_views").insert({path:location.pathname,url:location.href,referrer:document.referrer||null,user_agent:navigator.userAgent||null})}catch(o){console.debug("page view log failed",o)}};try{e()}catch{}const t=history.pushState.bind(history);history.pushState=function(o,d,f){const _=t(o,d,f);try{e()}catch{}return _};const n=history.replaceState.bind(history);history.replaceState=function(o,d,f){const _=n(o,d,f);try{e()}catch{}return _},window.addEventListener("popstate",()=>{try{e()}catch{}})}typeof window<"u"&&MFe();typeof navigator<"u"&&"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/julin/sw.js").then(t=>{console.log("Service worker registered:",t.scope)}).catch(t=>{console.warn("Service worker registration failed:",t)})});
